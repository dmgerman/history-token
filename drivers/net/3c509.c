multiline_comment|/* 3c509.c: A 3c509 EtherLink3 ethernet driver for linux. */
multiline_comment|/*&n;&t;Written 1993-2000 by Donald Becker.&n;&n;&t;Copyright 1994-2000 by Donald Becker.&n;&t;Copyright 1993 United States Government as represented by the&n;&t;Director, National Security Agency.&t; This software may be used and&n;&t;distributed according to the terms of the GNU General Public License,&n;&t;incorporated herein by reference.&n;&n;&t;This driver is for the 3Com EtherLinkIII series.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;Known limitations:&n;&t;Because of the way 3c509 ISA detection works it&squot;s difficult to predict&n;&t;a priori which of several ISA-mode cards will be detected first.&n;&n;&t;This driver does not use predictive interrupt mode, resulting in higher&n;&t;packet latency but lower overhead.  If interrupts are disabled for an&n;&t;unusually long time it could also result in missed packets, but in&n;&t;practice this rarely happens.&n;&n;&n;&t;FIXES:&n;&t;&t;Alan Cox:       Removed the &squot;Unexpected interrupt&squot; bug.&n;&t;&t;Michael Meskes:&t;Upgraded to Donald Becker&squot;s version 1.07.&n;&t;&t;Alan Cox:&t;Increased the eeprom delay. Regardless of &n;&t;&t;&t;&t;what the docs say some people definitely&n;&t;&t;&t;&t;get problems with lower (but in card spec)&n;&t;&t;&t;&t;delays&n;&t;&t;v1.10 4/21/97 Fixed module code so that multiple cards may be detected,&n;&t;&t;&t;&t;other cleanups.  -djb&n;&t;&t;Andrea Arcangeli:&t;Upgraded to Donald Becker&squot;s version 1.12.&n;&t;&t;Rick Payne:&t;Fixed SMP race condition&n;&t;&t;v1.13 9/8/97 Made &squot;max_interrupt_work&squot; an insmod-settable variable -djb&n;&t;&t;v1.14 10/15/97 Avoided waiting..discard message for fast machines -djb&n;&t;&t;v1.15 1/31/98 Faster recovery for Tx errors. -djb&n;&t;&t;v1.16 2/3/98 Different ID port handling to avoid sound cards. -djb&n;&t;&t;v1.18 12Mar2001 Andrew Morton &lt;andrewm@uow.edu.au&gt;&n;&t;&t;&t;- Avoid bogus detect of 3c590&squot;s (Andrzej Krzysztofowicz)&n;&t;&t;&t;- Reviewed against 1.18 from scyld.com&n;&t;&t;v1.18a 17Nov2001 Jeff Garzik &lt;jgarzik@pobox.com&gt;&n;&t;&t;&t;- ethtool support&n;&t;&t;v1.18b 1Mar2002 Zwane Mwaikambo &lt;zwane@commfireservices.com&gt;&n;&t;&t;&t;- Power Management support&n;&t;&t;v1.18c 1Mar2002 David Ruggiero &lt;jdr@farfalle.com&gt;&n;&t;&t;&t;- Full duplex support&n;&t;&t;v1.19  16Oct2002 Zwane Mwaikambo &lt;zwane@linuxpower.ca&gt;&n;&t;&t;&t;- Additional ethtool features&n;&t;&t;v1.19a 28Oct2002 Davud Ruggiero &lt;jdr@farfalle.com&gt;&n;&t;&t;&t;- Increase *read_eeprom udelay to workaround oops with 2 cards.&n;&t;&t;v1.19b 08Nov2002 Marc Zyngier &lt;maz@wild-wind.fr.eu.org&gt;&n;&t;&t;    - Introduce driver model for EISA cards.&n;*/
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;3c509&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.19b&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&quot;08Nov2002&quot;
multiline_comment|/* A few values that may be tweaked. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (400*HZ/1000)
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|10
suffix:semicolon
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#ifdef CONFIG_MCA
macro_line|#include &lt;linux/mca.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;&t;/* for udelay() */
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/eisa.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|variable|__initdata
r_static
r_char
id|versionA
(braket
)braket
id|__initdata
op_assign
id|DRV_NAME
l_string|&quot;.c:&quot;
id|DRV_VERSION
l_string|&quot; &quot;
id|DRV_RELDATE
l_string|&quot; becker@scyld.com&bslash;n&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|versionB
(braket
)braket
id|__initdata
op_assign
l_string|&quot;http://www.scyld.com/network/3c509.html&bslash;n&quot;
suffix:semicolon
macro_line|#ifdef EL3_DEBUG
DECL|variable|el3_debug
r_static
r_int
id|el3_debug
op_assign
id|EL3_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|el3_debug
r_static
r_int
id|el3_debug
op_assign
l_int|2
suffix:semicolon
macro_line|#endif
multiline_comment|/* Used to do a global count of all the cards in the system.  Must be&n; * a global variable so that the mca/eisa probe routines can increment&n; * it */
DECL|variable|el3_cards
r_static
r_int
id|el3_cards
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* To minimize the size of the driver source I only define operating&n;   constants if they are used several times.  You&squot;ll need the manual&n;   anyway if you want to understand driver details. */
multiline_comment|/* Offsets from base I/O address. */
DECL|macro|EL3_DATA
mdefine_line|#define EL3_DATA 0x00
DECL|macro|EL3_CMD
mdefine_line|#define EL3_CMD 0x0e
DECL|macro|EL3_STATUS
mdefine_line|#define EL3_STATUS 0x0e
DECL|macro|EEPROM_READ
mdefine_line|#define&t; EEPROM_READ 0x80
DECL|macro|EL3_IO_EXTENT
mdefine_line|#define EL3_IO_EXTENT&t;16
DECL|macro|EL3WINDOW
mdefine_line|#define EL3WINDOW(win_num) outw(SelectWindow + (win_num), ioaddr + EL3_CMD)
multiline_comment|/* The top five bits written to EL3_CMD are a command, the lower&n;   11 bits are the parameter, if applicable. */
DECL|enum|c509cmd
r_enum
id|c509cmd
(brace
DECL|enumerator|TotalReset
DECL|enumerator|SelectWindow
DECL|enumerator|StartCoax
id|TotalReset
op_assign
l_int|0
op_lshift
l_int|11
comma
id|SelectWindow
op_assign
l_int|1
op_lshift
l_int|11
comma
id|StartCoax
op_assign
l_int|2
op_lshift
l_int|11
comma
DECL|enumerator|RxDisable
DECL|enumerator|RxEnable
DECL|enumerator|RxReset
DECL|enumerator|RxDiscard
id|RxDisable
op_assign
l_int|3
op_lshift
l_int|11
comma
id|RxEnable
op_assign
l_int|4
op_lshift
l_int|11
comma
id|RxReset
op_assign
l_int|5
op_lshift
l_int|11
comma
id|RxDiscard
op_assign
l_int|8
op_lshift
l_int|11
comma
DECL|enumerator|TxEnable
DECL|enumerator|TxDisable
DECL|enumerator|TxReset
id|TxEnable
op_assign
l_int|9
op_lshift
l_int|11
comma
id|TxDisable
op_assign
l_int|10
op_lshift
l_int|11
comma
id|TxReset
op_assign
l_int|11
op_lshift
l_int|11
comma
DECL|enumerator|FakeIntr
DECL|enumerator|AckIntr
DECL|enumerator|SetIntrEnb
id|FakeIntr
op_assign
l_int|12
op_lshift
l_int|11
comma
id|AckIntr
op_assign
l_int|13
op_lshift
l_int|11
comma
id|SetIntrEnb
op_assign
l_int|14
op_lshift
l_int|11
comma
DECL|enumerator|SetStatusEnb
DECL|enumerator|SetRxFilter
DECL|enumerator|SetRxThreshold
id|SetStatusEnb
op_assign
l_int|15
op_lshift
l_int|11
comma
id|SetRxFilter
op_assign
l_int|16
op_lshift
l_int|11
comma
id|SetRxThreshold
op_assign
l_int|17
op_lshift
l_int|11
comma
DECL|enumerator|SetTxThreshold
DECL|enumerator|SetTxStart
DECL|enumerator|StatsEnable
id|SetTxThreshold
op_assign
l_int|18
op_lshift
l_int|11
comma
id|SetTxStart
op_assign
l_int|19
op_lshift
l_int|11
comma
id|StatsEnable
op_assign
l_int|21
op_lshift
l_int|11
comma
DECL|enumerator|StatsDisable
DECL|enumerator|StopCoax
DECL|enumerator|PowerUp
id|StatsDisable
op_assign
l_int|22
op_lshift
l_int|11
comma
id|StopCoax
op_assign
l_int|23
op_lshift
l_int|11
comma
id|PowerUp
op_assign
l_int|27
op_lshift
l_int|11
comma
DECL|enumerator|PowerDown
DECL|enumerator|PowerAuto
id|PowerDown
op_assign
l_int|28
op_lshift
l_int|11
comma
id|PowerAuto
op_assign
l_int|29
op_lshift
l_int|11
)brace
suffix:semicolon
DECL|enum|c509status
r_enum
id|c509status
(brace
DECL|enumerator|IntLatch
DECL|enumerator|AdapterFailure
DECL|enumerator|TxComplete
id|IntLatch
op_assign
l_int|0x0001
comma
id|AdapterFailure
op_assign
l_int|0x0002
comma
id|TxComplete
op_assign
l_int|0x0004
comma
DECL|enumerator|TxAvailable
DECL|enumerator|RxComplete
DECL|enumerator|RxEarly
id|TxAvailable
op_assign
l_int|0x0008
comma
id|RxComplete
op_assign
l_int|0x0010
comma
id|RxEarly
op_assign
l_int|0x0020
comma
DECL|enumerator|IntReq
DECL|enumerator|StatsFull
DECL|enumerator|CmdBusy
id|IntReq
op_assign
l_int|0x0040
comma
id|StatsFull
op_assign
l_int|0x0080
comma
id|CmdBusy
op_assign
l_int|0x1000
comma
)brace
suffix:semicolon
multiline_comment|/* The SetRxFilter command accepts the following classes: */
DECL|enum|RxFilter
r_enum
id|RxFilter
(brace
DECL|enumerator|RxStation
DECL|enumerator|RxMulticast
DECL|enumerator|RxBroadcast
DECL|enumerator|RxProm
id|RxStation
op_assign
l_int|1
comma
id|RxMulticast
op_assign
l_int|2
comma
id|RxBroadcast
op_assign
l_int|4
comma
id|RxProm
op_assign
l_int|8
)brace
suffix:semicolon
multiline_comment|/* Register window 1 offsets, the window used in normal operation. */
DECL|macro|TX_FIFO
mdefine_line|#define TX_FIFO&t;&t;0x00
DECL|macro|RX_FIFO
mdefine_line|#define RX_FIFO&t;&t;0x00
DECL|macro|RX_STATUS
mdefine_line|#define RX_STATUS &t;0x08
DECL|macro|TX_STATUS
mdefine_line|#define TX_STATUS &t;0x0B
DECL|macro|TX_FREE
mdefine_line|#define TX_FREE&t;&t;0x0C&t;&t;/* Remaining free bytes in Tx buffer. */
DECL|macro|WN0_CONF_CTRL
mdefine_line|#define WN0_CONF_CTRL&t;0x04&t;&t;/* Window 0: Configuration control register */
DECL|macro|WN0_ADDR_CONF
mdefine_line|#define WN0_ADDR_CONF&t;0x06&t;&t;/* Window 0: Address configuration register */
DECL|macro|WN0_IRQ
mdefine_line|#define WN0_IRQ&t;&t;0x08&t;&t;/* Window 0: Set IRQ line in bits 12-15. */
DECL|macro|WN4_MEDIA
mdefine_line|#define WN4_MEDIA&t;0x0A&t;&t;/* Window 4: Various transcvr/media bits. */
DECL|macro|MEDIA_TP
mdefine_line|#define&t;MEDIA_TP&t;0x00C0&t;&t;/* Enable link beat and jabber for 10baseT. */
DECL|macro|WN4_NETDIAG
mdefine_line|#define WN4_NETDIAG&t;0x06&t;&t;/* Window 4: Net diagnostic */
DECL|macro|FD_ENABLE
mdefine_line|#define FD_ENABLE&t;0x8000&t;&t;/* Enable full-duplex (&quot;external loopback&quot;) */  
multiline_comment|/*&n; * Must be a power of two (we use a binary and in the&n; * circular queue)&n; */
DECL|macro|SKB_QUEUE_SIZE
mdefine_line|#define SKB_QUEUE_SIZE&t;64
DECL|struct|el3_private
r_struct
id|el3_private
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|next_dev
r_struct
id|net_device
op_star
id|next_dev
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* skb send-queue */
DECL|member|head
DECL|member|size
r_int
id|head
comma
id|size
suffix:semicolon
DECL|member|queue
r_struct
id|sk_buff
op_star
id|queue
(braket
id|SKB_QUEUE_SIZE
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|member|pmdev
r_struct
id|pm_dev
op_star
id|pmdev
suffix:semicolon
macro_line|#endif
r_enum
(brace
DECL|enumerator|EL3_MCA
id|EL3_MCA
comma
DECL|enumerator|EL3_PNP
id|EL3_PNP
comma
DECL|enumerator|EL3_EISA
id|EL3_EISA
comma
DECL|member|type
)brace
id|type
suffix:semicolon
multiline_comment|/* type of device */
DECL|member|dev
r_struct
id|device
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|id_port
id|__initdata
op_assign
l_int|0x110
suffix:semicolon
multiline_comment|/* Start with 0x110 to avoid new sound cards.*/
DECL|variable|el3_root_dev
r_static
r_struct
id|net_device
op_star
id|el3_root_dev
suffix:semicolon
r_static
id|ushort
id|id_read_eeprom
c_func
(paren
r_int
id|index
)paren
suffix:semicolon
r_static
id|ushort
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|index
)paren
suffix:semicolon
r_static
r_int
id|el3_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|el3_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|update_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|el3_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|el3_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|el3_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|el3_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|el3_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|ethtool_ops
r_static
r_struct
id|ethtool_ops
id|ethtool_ops
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_static
r_int
id|el3_suspend
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
)paren
suffix:semicolon
r_static
r_int
id|el3_resume
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
)paren
suffix:semicolon
r_static
r_int
id|el3_pm_callback
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* generic device remove for all device types */
macro_line|#if defined(CONFIG_EISA) || defined(CONFIG_MCA)
r_static
r_int
id|el3_device_remove
(paren
r_struct
id|device
op_star
id|device
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
r_static
r_void
id|el3_poll_controller
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_EISA
DECL|variable|el3_eisa_ids
r_struct
id|eisa_device_id
id|el3_eisa_ids
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;TCM5092&quot;
)brace
comma
(brace
l_string|&quot;TCM5093&quot;
)brace
comma
(brace
l_string|&quot;&quot;
)brace
)brace
suffix:semicolon
r_static
r_int
id|el3_eisa_probe
(paren
r_struct
id|device
op_star
id|device
)paren
suffix:semicolon
DECL|variable|el3_eisa_driver
r_struct
id|eisa_driver
id|el3_eisa_driver
op_assign
(brace
dot
id|id_table
op_assign
id|el3_eisa_ids
comma
dot
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;3c509&quot;
comma
dot
id|probe
op_assign
id|el3_eisa_probe
comma
dot
id|remove
op_assign
id|__devexit_p
(paren
id|el3_device_remove
)paren
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MCA
r_static
r_int
id|el3_mca_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|el3_mca_adapter_ids
(braket
)braket
id|__initdata
op_assign
(brace
l_int|0x627c
comma
l_int|0x627d
comma
l_int|0x62db
comma
l_int|0x62f6
comma
l_int|0x62f7
comma
l_int|0x0000
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
op_star
id|el3_mca_adapter_names
(braket
)braket
id|__initdata
op_assign
(brace
l_string|&quot;3Com 3c529 EtherLink III (10base2)&quot;
comma
l_string|&quot;3Com 3c529 EtherLink III (10baseT)&quot;
comma
l_string|&quot;3Com 3c529 EtherLink III (test mode)&quot;
comma
l_string|&quot;3Com 3c529 EtherLink III (TP or coax)&quot;
comma
l_string|&quot;3Com 3c529 EtherLink III (TP)&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|el3_mca_driver
r_static
r_struct
id|mca_driver
id|el3_mca_driver
op_assign
(brace
dot
id|id_table
op_assign
id|el3_mca_adapter_ids
comma
dot
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;3c529&quot;
comma
dot
id|bus
op_assign
op_amp
id|mca_bus_type
comma
dot
id|probe
op_assign
id|el3_mca_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|el3_device_remove
)paren
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_MCA */
macro_line|#if defined(__ISAPNP__)
DECL|variable|__initdata
r_static
r_struct
id|isapnp_device_id
id|el3_isapnp_adapters
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;T&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x5090
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III (TP)&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;T&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x5091
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;T&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x5094
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III (combo)&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;T&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x5095
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III (TPO)&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;T&squot;
comma
l_char|&squot;C&squot;
comma
l_char|&squot;M&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x5098
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III (TPC)&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;P&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;P&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x80f7
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III compatible&quot;
)brace
comma
(brace
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_VENDOR
c_func
(paren
l_char|&squot;P&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;P&squot;
)paren
comma
id|ISAPNP_FUNCTION
c_func
(paren
l_int|0x80f8
)paren
comma
(paren
r_int
)paren
l_string|&quot;3Com Etherlink III compatible&quot;
)brace
comma
(brace
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
DECL|variable|el3_isapnp_phys_addr
r_static
id|u16
id|el3_isapnp_phys_addr
(braket
l_int|8
)braket
(braket
l_int|3
)braket
suffix:semicolon
DECL|variable|nopnp
r_static
r_int
id|nopnp
suffix:semicolon
macro_line|#endif /* __ISAPNP__ */
multiline_comment|/* With the driver model introduction for EISA devices, both init&n; * and cleanup have been split :&n; * - EISA devices probe/remove starts in el3_eisa_probe/el3_device_remove&n; * - MCA/ISA still use el3_probe&n; *&n; * Both call el3_common_init/el3_common_remove. */
DECL|function|el3_common_init
r_static
r_int
id|__init
id|el3_common_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
op_amp
l_int|0x05
)paren
(brace
multiline_comment|/* xcvr codes 1/3/4/12 */
id|dev-&gt;if_port
op_assign
(paren
id|dev-&gt;mem_start
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* xcvr codes 0/8 */
multiline_comment|/* use eeprom value, but save user&squot;s full-duplex selection */
id|dev-&gt;if_port
op_or_assign
(paren
id|dev-&gt;mem_start
op_amp
l_int|0x08
)paren
suffix:semicolon
)brace
multiline_comment|/* The EL3-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|el3_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|el3_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|el3_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|el3_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast_list
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|el3_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
id|dev-&gt;poll_controller
op_assign
id|el3_poll_controller
suffix:semicolon
macro_line|#endif
id|SET_ETHTOOL_OPS
c_func
(paren
id|dev
comma
op_amp
id|ethtool_ops
)paren
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed to register 3c5x9 at %#3.3lx, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|EL3_IO_EXTENT
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
(brace
r_const
r_char
op_star
id|if_names
(braket
)braket
op_assign
(brace
l_string|&quot;10baseT&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;undefined&quot;
comma
l_string|&quot;BNC&quot;
)brace
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: 3c5x9 found at %#3.3lx, %s port, address &quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|if_names
(braket
(paren
id|dev-&gt;if_port
op_amp
l_int|0x03
)paren
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Read in the station address. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|versionA
comma
id|versionB
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|el3_common_remove
r_static
r_void
id|el3_common_remove
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
(paren
r_void
)paren
id|lp
suffix:semicolon
multiline_comment|/* Keep gcc quiet... */
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|lp-&gt;pmdev
)paren
id|pm_unregister
c_func
(paren
id|lp-&gt;pmdev
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(__ISAPNP__)
r_if
c_cond
(paren
id|lp-&gt;type
op_eq
id|EL3_PNP
)paren
id|pnp_device_detach
c_func
(paren
id|to_pnp_dev
c_func
(paren
id|lp-&gt;dev
)paren
)paren
suffix:semicolon
macro_line|#endif
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
id|EL3_IO_EXTENT
)paren
suffix:semicolon
id|free_netdev
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|el3_probe
r_static
r_int
id|__init
id|el3_probe
c_func
(paren
r_int
id|card_idx
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|lrs_state
op_assign
l_int|0xff
comma
id|i
suffix:semicolon
r_int
id|ioaddr
comma
id|irq
comma
id|if_port
suffix:semicolon
id|u16
id|phys_addr
(braket
l_int|3
)braket
suffix:semicolon
r_static
r_int
id|current_tag
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
macro_line|#if defined(__ISAPNP__)
r_static
r_int
id|pnp_cards
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|idev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|nopnp
op_eq
l_int|1
)paren
r_goto
id|no_pnp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|el3_isapnp_adapters
(braket
id|i
)braket
dot
id|vendor
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_while
c_loop
(paren
(paren
id|idev
op_assign
id|pnp_find_dev
c_func
(paren
l_int|NULL
comma
id|el3_isapnp_adapters
(braket
id|i
)braket
dot
id|vendor
comma
id|el3_isapnp_adapters
(braket
id|i
)braket
dot
id|function
comma
id|idev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pnp_device_attach
c_func
(paren
id|idev
)paren
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pnp_activate_dev
c_func
(paren
id|idev
)paren
OL
l_int|0
)paren
(brace
id|__again
suffix:colon
id|pnp_device_detach
c_func
(paren
id|idev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pnp_port_valid
c_func
(paren
id|idev
comma
l_int|0
)paren
op_logical_or
op_logical_neg
id|pnp_irq_valid
c_func
(paren
id|idev
comma
l_int|0
)paren
)paren
r_goto
id|__again
suffix:semicolon
id|ioaddr
op_assign
id|pnp_port_start
c_func
(paren
id|idev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
comma
l_string|&quot;3c509 PnP&quot;
)paren
)paren
(brace
id|pnp_device_detach
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|irq
op_assign
id|pnp_irq
c_func
(paren
id|idev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
(paren
l_string|&quot;ISAPnP reports %s at i/o 0x%x, irq %d&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|el3_isapnp_adapters
(braket
id|i
)braket
dot
id|driver_data
comma
id|ioaddr
comma
id|irq
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|3
suffix:semicolon
id|j
op_increment
)paren
id|el3_isapnp_phys_addr
(braket
id|pnp_cards
)braket
(braket
id|j
)braket
op_assign
id|phys_addr
(braket
id|j
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|j
)paren
)paren
suffix:semicolon
id|if_port
op_assign
id|read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|8
)paren
op_rshift
l_int|14
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|el3_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|release_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
)paren
suffix:semicolon
id|pnp_device_detach
c_func
(paren
id|idev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|idev-&gt;dev
)paren
suffix:semicolon
id|pnp_cards
op_increment
suffix:semicolon
id|netdev_boot_setup_check
c_func
(paren
id|dev
)paren
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
)brace
id|no_pnp
suffix:colon
macro_line|#endif /* __ISAPNP__ */
multiline_comment|/* Select an open I/O location at 0x1*0 to do contention select. */
r_for
c_loop
(paren
suffix:semicolon
id|id_port
OL
l_int|0x200
suffix:semicolon
id|id_port
op_add_assign
l_int|0x10
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|id_port
comma
l_int|1
comma
l_string|&quot;3c509&quot;
)paren
)paren
r_continue
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|id_port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|id_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|id_port
)paren
op_amp
l_int|0x01
)paren
(brace
id|release_region
c_func
(paren
id|id_port
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|release_region
c_func
(paren
id|id_port
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id_port
op_ge
l_int|0x200
)paren
(brace
multiline_comment|/* Rare -- do we really need a warning? */
id|printk
c_func
(paren
l_string|&quot; WARNING: No I/O port available for 3c509 activation.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Next check for all ISA bus boards by sending the ID sequence to the&n;&t;   ID_PORT.  We find cards past the first by setting the &squot;current_tag&squot;&n;&t;   on cards as they are found.  Cards with their tag set will not&n;&t;   respond to subsequent ID sequences. */
id|outb
c_func
(paren
l_int|0x00
comma
id|id_port
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|id_port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|255
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|lrs_state
comma
id|id_port
)paren
suffix:semicolon
id|lrs_state
op_lshift_assign
l_int|1
suffix:semicolon
id|lrs_state
op_assign
id|lrs_state
op_amp
l_int|0x100
ques
c_cond
id|lrs_state
op_xor
l_int|0xcf
suffix:colon
id|lrs_state
suffix:semicolon
)brace
multiline_comment|/* For the first probe, clear all board&squot;s tag registers. */
r_if
c_cond
(paren
id|current_tag
op_eq
l_int|0
)paren
id|outb
c_func
(paren
l_int|0xd0
comma
id|id_port
)paren
suffix:semicolon
r_else
multiline_comment|/* Otherwise kill off already-found boards. */
id|outb
c_func
(paren
l_int|0xd8
comma
id|id_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id_read_eeprom
c_func
(paren
l_int|7
)paren
op_ne
l_int|0x6d50
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Read in EEPROM data, which does contention-select.&n;&t;   Only the lowest address board will stay &quot;on-line&quot;.&n;&t;   3Com got the byte order backwards. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|phys_addr
(braket
id|i
)braket
op_assign
id|htons
c_func
(paren
id|id_read_eeprom
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(__ISAPNP__)
r_if
c_cond
(paren
id|nopnp
op_eq
l_int|0
)paren
(brace
multiline_comment|/* The ISA PnP 3c509 cards respond to the ID sequence.&n;&t;&t;   This check is needed in order not to register them twice. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pnp_cards
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|phys_addr
(braket
l_int|0
)braket
op_eq
id|el3_isapnp_phys_addr
(braket
id|i
)braket
(braket
l_int|0
)braket
op_logical_and
id|phys_addr
(braket
l_int|1
)braket
op_eq
id|el3_isapnp_phys_addr
(braket
id|i
)braket
(braket
l_int|1
)braket
op_logical_and
id|phys_addr
(braket
l_int|2
)braket
op_eq
id|el3_isapnp_phys_addr
(braket
id|i
)braket
(braket
l_int|2
)braket
)paren
(brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;3c509 with address %02x %02x %02x %02x %02x %02x was found by ISAPnP&bslash;n&quot;
comma
id|phys_addr
(braket
l_int|0
)braket
op_amp
l_int|0xff
comma
id|phys_addr
(braket
l_int|0
)braket
op_rshift
l_int|8
comma
id|phys_addr
(braket
l_int|1
)braket
op_amp
l_int|0xff
comma
id|phys_addr
(braket
l_int|1
)braket
op_rshift
l_int|8
comma
id|phys_addr
(braket
l_int|2
)braket
op_amp
l_int|0xff
comma
id|phys_addr
(braket
l_int|2
)braket
op_rshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Set the adaptor tag so that the next card can be found. */
id|outb
c_func
(paren
l_int|0xd0
op_plus
op_increment
id|current_tag
comma
id|id_port
)paren
suffix:semicolon
r_goto
id|no_pnp
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* __ISAPNP__ */
(brace
r_int
r_int
id|iobase
op_assign
id|id_read_eeprom
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|if_port
op_assign
id|iobase
op_rshift
l_int|14
suffix:semicolon
id|ioaddr
op_assign
l_int|0x200
op_plus
(paren
(paren
id|iobase
op_amp
l_int|0x1f
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
id|irq
op_assign
id|id_read_eeprom
c_func
(paren
l_int|9
)paren
op_rshift
l_int|12
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|el3_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netdev_boot_setup_check
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Set passed-in IRQ or I/O Addr. */
r_if
c_cond
(paren
id|dev-&gt;irq
OG
l_int|1
op_logical_and
id|dev-&gt;irq
OL
l_int|16
)paren
id|irq
op_assign
id|dev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;base_addr
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;mem_end
op_eq
l_int|0x3c509
multiline_comment|/* Magic key */
op_logical_and
id|dev-&gt;base_addr
op_ge
l_int|0x200
op_logical_and
id|dev-&gt;base_addr
op_le
l_int|0x3e0
)paren
id|ioaddr
op_assign
id|dev-&gt;base_addr
op_amp
l_int|0x3f0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;base_addr
op_ne
id|ioaddr
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
comma
l_string|&quot;3c509&quot;
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set the adaptor tag so that the next card can be found. */
id|outb
c_func
(paren
l_int|0xd0
op_plus
op_increment
id|current_tag
comma
id|id_port
)paren
suffix:semicolon
multiline_comment|/* Activate the adaptor at the EEPROM location. */
id|outb
c_func
(paren
(paren
id|ioaddr
op_rshift
l_int|4
)paren
op_or
l_int|0xe0
comma
id|id_port
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
)paren
op_ne
l_int|0x6d50
)paren
r_goto
id|out1
suffix:semicolon
multiline_comment|/* Free the interrupt so that some other card can use it. */
id|outw
c_func
(paren
l_int|0x0f00
comma
id|ioaddr
op_plus
id|WN0_IRQ
)paren
suffix:semicolon
macro_line|#if defined(__ISAPNP__)
id|found
suffix:colon
multiline_comment|/* PNP jumps here... */
macro_line|#endif /* __ISAPNP__ */
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|phys_addr
comma
r_sizeof
(paren
id|phys_addr
)paren
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|if_port
suffix:semicolon
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#if defined(__ISAPNP__)
id|lp-&gt;dev
op_assign
op_amp
id|idev-&gt;dev
suffix:semicolon
macro_line|#endif
id|err
op_assign
id|el3_common_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out1
suffix:semicolon
macro_line|#ifdef CONFIG_PM
multiline_comment|/* register power management */
id|lp-&gt;pmdev
op_assign
id|pm_register
c_func
(paren
id|PM_ISA_DEV
comma
id|card_idx
comma
id|el3_pm_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;pmdev
)paren
(brace
r_struct
id|pm_dev
op_star
id|p
suffix:semicolon
id|p
op_assign
id|lp-&gt;pmdev
suffix:semicolon
id|p-&gt;data
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev
suffix:semicolon
)brace
macro_line|#endif
id|el3_cards
op_increment
suffix:semicolon
id|lp-&gt;next_dev
op_assign
id|el3_root_dev
suffix:semicolon
id|el3_root_dev
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out1
suffix:colon
macro_line|#if defined(__ISAPNP__)
r_if
c_cond
(paren
id|idev
)paren
id|pnp_device_detach
c_func
(paren
id|idev
)paren
suffix:semicolon
macro_line|#endif
id|out
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MCA
DECL|function|el3_mca_probe
r_static
r_int
id|__init
id|el3_mca_probe
c_func
(paren
r_struct
id|device
op_star
id|device
)paren
(brace
multiline_comment|/* Based on Erik Nygren&squot;s (nygren@mit.edu) 3c529 patch,&n;&t; * heavily modified by Chris Beauregard&n;&t; * (cpbeaure@csclub.uwaterloo.ca) to support standard MCA&n;&t; * probing.&n;&t; *&n;&t; * redone for multi-card detection by ZP Gu (zpg@castle.net)&n;&t; * now works as a module */
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
comma
id|irq
comma
id|if_port
suffix:semicolon
id|u16
id|phys_addr
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|u_char
id|pos4
comma
id|pos5
suffix:semicolon
r_struct
id|mca_device
op_star
id|mdev
op_assign
id|to_mca_device
c_func
(paren
id|device
)paren
suffix:semicolon
r_int
id|slot
op_assign
id|mdev-&gt;slot
suffix:semicolon
r_int
id|err
suffix:semicolon
id|pos4
op_assign
id|mca_device_read_stored_pos
c_func
(paren
id|mdev
comma
l_int|4
)paren
suffix:semicolon
id|pos5
op_assign
id|mca_device_read_stored_pos
c_func
(paren
id|mdev
comma
l_int|5
)paren
suffix:semicolon
id|ioaddr
op_assign
(paren
(paren
r_int
)paren
(paren
(paren
id|pos4
op_amp
l_int|0xfc
)paren
op_or
l_int|0x02
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|irq
op_assign
id|pos5
op_amp
l_int|0x0f
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;3c529: found %s at slot %d&bslash;n&quot;
comma
id|el3_mca_adapter_names
(braket
id|mdev-&gt;index
)braket
comma
id|slot
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* claim the slot */
id|strncpy
c_func
(paren
id|mdev-&gt;name
comma
id|el3_mca_adapter_names
(braket
id|mdev-&gt;index
)braket
comma
r_sizeof
(paren
id|mdev-&gt;name
)paren
)paren
suffix:semicolon
id|mca_device_set_claim
c_func
(paren
id|mdev
comma
l_int|1
)paren
suffix:semicolon
id|if_port
op_assign
id|pos4
op_amp
l_int|0x03
suffix:semicolon
id|irq
op_assign
id|mca_device_transform_irq
c_func
(paren
id|mdev
comma
id|irq
)paren
suffix:semicolon
id|ioaddr
op_assign
id|mca_device_transform_ioport
c_func
(paren
id|mdev
comma
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;3c529: irq %d  ioaddr 0x%x  ifport %d&bslash;n&quot;
comma
id|irq
comma
id|ioaddr
comma
id|if_port
)paren
suffix:semicolon
)brace
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|phys_addr
(braket
id|i
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
)paren
)paren
suffix:semicolon
)brace
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|el3_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|release_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netdev_boot_setup_check
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|phys_addr
comma
r_sizeof
(paren
id|phys_addr
)paren
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|if_port
suffix:semicolon
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;dev
op_assign
id|device
suffix:semicolon
id|lp-&gt;type
op_assign
id|EL3_MCA
suffix:semicolon
id|device-&gt;driver_data
op_assign
id|dev
suffix:semicolon
id|err
op_assign
id|el3_common_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|device-&gt;driver_data
op_assign
l_int|NULL
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|el3_cards
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_MCA */
macro_line|#ifdef CONFIG_EISA
DECL|function|el3_eisa_probe
r_static
r_int
id|__init
id|el3_eisa_probe
(paren
r_struct
id|device
op_star
id|device
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ioaddr
comma
id|irq
comma
id|if_port
suffix:semicolon
id|u16
id|phys_addr
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|eisa_device
op_star
id|edev
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Yeepee, The driver framework is calling us ! */
id|edev
op_assign
id|to_eisa_device
(paren
id|device
)paren
suffix:semicolon
id|ioaddr
op_assign
id|edev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
comma
l_string|&quot;3c509&quot;
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* Change the register set to the configuration window 0. */
id|outw
c_func
(paren
id|SelectWindow
op_or
l_int|0
comma
id|ioaddr
op_plus
l_int|0xC80
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|irq
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN0_IRQ
)paren
op_rshift
l_int|12
suffix:semicolon
id|if_port
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|6
)paren
op_rshift
l_int|14
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
id|phys_addr
(braket
id|i
)braket
op_assign
id|htons
c_func
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
)paren
)paren
suffix:semicolon
multiline_comment|/* Restore the &quot;Product ID&quot; to the EEPROM read register. */
id|read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|3
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|el3_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|release_region
c_func
(paren
id|ioaddr
comma
id|EL3_IO_EXTENT
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netdev_boot_setup_check
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|phys_addr
comma
r_sizeof
(paren
id|phys_addr
)paren
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|if_port
suffix:semicolon
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;dev
op_assign
id|device
suffix:semicolon
id|lp-&gt;type
op_assign
id|EL3_EISA
suffix:semicolon
id|eisa_set_drvdata
(paren
id|edev
comma
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|el3_common_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|eisa_set_drvdata
(paren
id|edev
comma
l_int|NULL
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|el3_cards
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_EISA) || defined(CONFIG_MCA)
multiline_comment|/* This remove works for all device types.&n; *&n; * The net dev must be stored in the driver_data field */
DECL|function|el3_device_remove
r_static
r_int
id|__devexit
id|el3_device_remove
(paren
r_struct
id|device
op_star
id|device
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|device-&gt;driver_data
suffix:semicolon
id|el3_common_remove
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Read a word from the EEPROM using the regular EEPROM access register.&n;   Assume that we are in register window zero.&n; */
DECL|function|read_eeprom
r_static
id|ushort
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|index
)paren
(brace
id|outw
c_func
(paren
id|EEPROM_READ
op_plus
id|index
comma
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Pause for at least 162 us. for the read to take place. &n;&t;   Some chips seem to require much longer */
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_return
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
)brace
multiline_comment|/* Read a word from the EEPROM when in the ISA ID probe state. */
DECL|function|id_read_eeprom
r_static
id|ushort
id|__init
id|id_read_eeprom
c_func
(paren
r_int
id|index
)paren
(brace
r_int
id|bit
comma
id|word
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Issue read command, and pause for at least 162 us. for it to complete.&n;&t;   Assume extra-fast 16Mhz bus. */
id|outb
c_func
(paren
id|EEPROM_READ
op_plus
id|index
comma
id|id_port
)paren
suffix:semicolon
multiline_comment|/* Pause for at least 162 us. for the read to take place. */
multiline_comment|/* Some chips seem to require much longer */
id|mdelay
c_func
(paren
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|15
suffix:semicolon
id|bit
op_ge
l_int|0
suffix:semicolon
id|bit
op_decrement
)paren
id|word
op_assign
(paren
id|word
op_lshift
l_int|1
)paren
op_plus
(paren
id|inb
c_func
(paren
id|id_port
)paren
op_amp
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;  3c509 EEPROM word %d %#4.4x.&bslash;n&quot;
comma
id|index
comma
id|word
)paren
suffix:semicolon
r_return
id|word
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_open
id|el3_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|outw
c_func
(paren
id|TxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|RxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetStatusEnb
op_or
l_int|0x00
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|i
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|el3_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Opening, IRQ %d&t; status@%x %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|ioaddr
op_plus
id|EL3_STATUS
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
id|el3_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Opened 3c509  IRQ %d  status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|el3_tx_timeout
id|el3_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, Tx_status %2.2x status %4.4x &quot;
l_string|&quot;Tx FIFO room %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TX_FREE
)paren
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Issue TX_RESET and TX_START commands. */
id|outw
c_func
(paren
id|TxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_start_xmit
id|el3_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: el3_start_xmit(length = %u) called, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
macro_line|#if 0
macro_line|#ifndef final_version
(brace
multiline_comment|/* Error-checking code, delete someday. */
id|ushort
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0001
multiline_comment|/* IRQ line active, missed one. */
op_logical_and
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|1
)paren
(brace
multiline_comment|/* Make sure. */
id|printk
c_func
(paren
l_string|&quot;%s: Missed interrupt, status then %04x now %04x&quot;
l_string|&quot;  Tx %2.2x Rx %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RX_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Fake interrupt trigger by masking, acknowledge interrupts. */
id|outw
c_func
(paren
id|SetStatusEnb
op_or
l_int|0x00
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntLatch
op_or
id|TxAvailable
op_or
id|RxEarly
op_or
id|IntReq
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetStatusEnb
op_or
l_int|0xff
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#endif
multiline_comment|/*&n;&t; *&t;We lock the driver against other processors. Note&n;&t; *&t;we don&squot;t need to lock versus the IRQ as we suspended&n;&t; *&t;that. This means that we lose the ability to take&n;&t; *&t;an RX during a TX upload. That sucks a bit with SMP&n;&t; *&t;on an original 3c509 (2K buffer)&n;&t; *&n;&t; *&t;Using disable_irq stops us crapping on other&n;&t; *&t;time sensitive devices.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Put out the doubleword header... */
id|outw
c_func
(paren
id|skb-&gt;len
comma
id|ioaddr
op_plus
id|TX_FIFO
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TX_FIFO
)paren
suffix:semicolon
multiline_comment|/* ... and the packet rounded to a doubleword. */
macro_line|#ifdef  __powerpc__
id|outsl_ns
c_func
(paren
id|ioaddr
op_plus
id|TX_FIFO
comma
id|skb-&gt;data
comma
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
macro_line|#else
id|outsl
c_func
(paren
id|ioaddr
op_plus
id|TX_FIFO
comma
id|skb-&gt;data
comma
(paren
id|skb-&gt;len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
macro_line|#endif
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|TX_FREE
)paren
OG
l_int|1536
)paren
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
multiline_comment|/* Interrupt us when the FIFO has room for max-sized packet. */
id|outw
c_func
(paren
id|SetTxThreshold
op_plus
l_int|1536
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* Clear the Tx status stack. */
(brace
r_int
id|tx_status
suffix:semicolon
r_int
id|i
op_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|i
OG
l_int|0
op_logical_and
(paren
id|tx_status
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x38
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x30
)paren
id|outw
c_func
(paren
id|TxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x3C
)paren
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TX_STATUS
)paren
suffix:semicolon
multiline_comment|/* Pop the status stack. */
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The EL3 interrupt handler. */
r_static
id|irqreturn_t
DECL|function|el3_interrupt
id|el3_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
comma
id|status
suffix:semicolon
r_int
id|i
op_assign
id|max_interrupt_work
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;el3_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
(brace
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
op_amp
(paren
id|IntLatch
op_or
id|RxComplete
op_or
id|StatsFull
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|RxComplete
)paren
id|el3_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxAvailable
)paren
(brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;&t;TX room bit was handled.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* There&squot;s room in the FIFO for a full-sized packet. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|TxAvailable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|AdapterFailure
op_or
id|RxEarly
op_or
id|StatsFull
op_or
id|TxComplete
)paren
)paren
(brace
multiline_comment|/* Handle all uncommon interrupts. */
r_if
c_cond
(paren
id|status
op_amp
id|StatsFull
)paren
multiline_comment|/* Empty statistics. */
id|update_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxEarly
)paren
(brace
multiline_comment|/* Rx early is unused. */
id|el3_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|AckIntr
op_or
id|RxEarly
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|TxComplete
)paren
(brace
multiline_comment|/* Really Tx error. */
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|tx_status
suffix:semicolon
r_int
id|i
op_assign
l_int|4
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|i
OG
l_int|0
op_logical_and
(paren
id|tx_status
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|TX_STATUS
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x38
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x30
)paren
id|outw
c_func
(paren
id|TxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x3C
)paren
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|TX_STATUS
)paren
suffix:semicolon
multiline_comment|/* Pop the status stack. */
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|AdapterFailure
)paren
(brace
multiline_comment|/* Adapter failure requires Rx reset and reinit. */
id|outw
c_func
(paren
id|RxReset
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Set the Rx filter to the current state. */
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxBroadcast
op_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
ques
c_cond
id|RxMulticast
suffix:colon
l_int|0
)paren
op_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
ques
c_cond
id|RxProm
suffix:colon
l_int|0
)paren
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|RxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Re-enable the receiver. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|AdapterFailure
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_decrement
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Infinite loop in interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupts. */
id|outw
c_func
(paren
id|AckIntr
op_or
l_int|0xFF
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Acknowledge the IRQ. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntReq
op_or
id|IntLatch
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack IRQ */
)brace
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: exiting interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
multiline_comment|/*&n; * Polling receive - used by netconsole and other diagnostic tools&n; * to allow network i/o with interrupts disabled.&n; */
DECL|function|el3_poll_controller
r_static
r_void
id|el3_poll_controller
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|el3_interrupt
c_func
(paren
id|dev-&gt;irq
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_struct
id|net_device_stats
op_star
DECL|function|el3_get_stats
id|el3_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/*&n;&t; *&t;This is fast enough not to bother with disable IRQ&n;&t; *&t;stuff.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*  Update statistics.  We change to register window 6, so this should be run&n;&t;single-threaded if the device is active. This is expected to be a rare&n;&t;operation, and it&squot;s simpler for the rest of the driver to assume that&n;&t;window 1 is always valid rather than use a special window-state variable.&n;&t;*/
DECL|function|update_stats
r_static
r_void
id|update_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;   Updating the statistics.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Turn off statistics updates while reading. */
id|outw
c_func
(paren
id|StatsDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Switch to the stats window, and read everything. */
id|EL3WINDOW
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|lp-&gt;stats.tx_carrier_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0
)paren
suffix:semicolon
id|lp-&gt;stats.tx_heartbeat_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Multiple collisions. */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|2
)paren
suffix:semicolon
id|lp-&gt;stats.collisions
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|3
)paren
suffix:semicolon
id|lp-&gt;stats.tx_window_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|4
)paren
suffix:semicolon
id|lp-&gt;stats.rx_fifo_errors
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|5
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_add_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|6
)paren
suffix:semicolon
multiline_comment|/* Rx packets&t;*/
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|7
)paren
suffix:semicolon
multiline_comment|/* Tx deferrals */
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|8
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Total Rx and Tx octets. */
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* Back to window 1, and turn statistics back on. */
id|EL3WINDOW
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|outw
c_func
(paren
id|StatsEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_rx
id|el3_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|rx_status
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;   In rx_packet(), status %4.4x, rx_status %4.4x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RX_STATUS
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rx_status
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|RX_STATUS
)paren
)paren
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|rx_status
op_amp
l_int|0x4000
)paren
(brace
multiline_comment|/* Error, update stats. */
r_int
id|error
op_assign
id|rx_status
op_amp
l_int|0x3800
suffix:semicolon
id|outw
c_func
(paren
id|RxDiscard
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|error
)paren
(brace
r_case
l_int|0x0000
suffix:colon
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0800
suffix:colon
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1000
suffix:colon
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1800
suffix:colon
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2000
suffix:colon
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2800
suffix:colon
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|pkt_len
op_assign
id|rx_status
op_amp
l_int|0x7ff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|5
)paren
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;Receiving packet size %d status %4.4x.&bslash;n&quot;
comma
id|pkt_len
comma
id|rx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Align IP on 16 byte */
multiline_comment|/* &squot;skb-&gt;data&squot; points to the start of sk_buff data area. */
macro_line|#ifdef  __powerpc__
id|insl_ns
c_func
(paren
id|ioaddr
op_plus
id|RX_FIFO
comma
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
macro_line|#else
id|insl
c_func
(paren
id|ioaddr
op_plus
id|RX_FIFO
comma
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
(paren
id|pkt_len
op_plus
l_int|3
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
macro_line|#endif
id|outw
c_func
(paren
id|RxDiscard
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Pop top Rx packet. */
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|outw
c_func
(paren
id|RxDiscard
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Couldn&squot;t allocate a sk_buff of size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
)paren
suffix:semicolon
)brace
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
suffix:semicolon
multiline_comment|/* Delay. */
r_while
c_loop
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;&t;Waiting for 3c509 to discard packet, status %x.&bslash;n&quot;
comma
id|inw
c_func
(paren
id|ioaddr
op_plus
id|EL3_STATUS
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *     Set or clear the multicast filter for this adaptor.&n; */
r_static
r_void
DECL|function|set_multicast_list
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|1
)paren
(brace
r_static
r_int
id|old
suffix:semicolon
r_if
c_cond
(paren
id|old
op_ne
id|dev-&gt;mc_count
)paren
(brace
id|old
op_assign
id|dev-&gt;mc_count
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Setting Rx mode to %d addresses.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mc_count
)paren
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxMulticast
op_or
id|RxBroadcast
op_or
id|RxProm
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxMulticast
op_or
id|RxBroadcast
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
)brace
r_else
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxBroadcast
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_close
id|el3_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Shutting down ethercard.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|el3_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Switching back to window 0 disables the IRQ. */
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;type
op_ne
id|EL3_EISA
)paren
(brace
multiline_comment|/* But we explicitly zero the IRQ line select anyway. Don&squot;t do&n;&t;&t; * it on EISA cards, it prevents the module from getting an&n;&t;&t; * IRQ after unload+reload... */
id|outw
c_func
(paren
l_int|0x0f00
comma
id|ioaddr
op_plus
id|WN0_IRQ
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_link_ok
id|el3_link_ok
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
id|tmp
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_MEDIA
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
id|tmp
op_amp
(paren
l_int|1
op_lshift
l_int|11
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_netdev_get_ecmd
id|el3_netdev_get_ecmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
id|u16
id|tmp
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* obtain current transceiver via WN4_MEDIA? */
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN0_ADDR_CONF
)paren
suffix:semicolon
id|ecmd-&gt;transceiver
op_assign
id|XCVR_INTERNAL
suffix:semicolon
r_switch
c_cond
(paren
id|tmp
op_rshift
l_int|14
)paren
(brace
r_case
l_int|0
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_TP
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_AUI
suffix:semicolon
id|ecmd-&gt;transceiver
op_assign
id|XCVR_EXTERNAL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_BNC
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|ecmd-&gt;supported
op_assign
l_int|0
suffix:semicolon
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN0_CONF_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
id|ecmd-&gt;supported
op_or_assign
id|SUPPORTED_AUI
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
id|ecmd-&gt;supported
op_or_assign
id|SUPPORTED_BNC
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
(brace
id|ecmd-&gt;supported
op_or_assign
id|SUPPORTED_TP
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
suffix:semicolon
multiline_comment|/* hmm... */
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_NETDIAG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|FD_ENABLE
)paren
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
)brace
id|ecmd-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_netdev_set_ecmd
id|el3_netdev_set_ecmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
id|u16
id|tmp
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_ne
id|SPEED_10
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_HALF
)paren
op_logical_and
(paren
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_FULL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ecmd-&gt;transceiver
op_ne
id|XCVR_INTERNAL
)paren
op_logical_and
(paren
id|ecmd-&gt;transceiver
op_ne
id|XCVR_EXTERNAL
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* change XCVR type */
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN0_ADDR_CONF
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ecmd-&gt;port
)paren
(brace
r_case
id|PORT_TP
suffix:colon
id|tmp
op_and_assign
op_complement
(paren
l_int|3
op_lshift
l_int|14
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_AUI
suffix:colon
id|tmp
op_or_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_BNC
suffix:colon
id|tmp
op_or_assign
(paren
l_int|3
op_lshift
l_int|14
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outw
c_func
(paren
id|tmp
comma
id|ioaddr
op_plus
id|WN0_ADDR_CONF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|3
)paren
(brace
multiline_comment|/* fire up the DC-DC convertor if BNC gets enabled */
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN0_ADDR_CONF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
(paren
l_int|3
op_lshift
l_int|14
)paren
)paren
(brace
id|outw
c_func
(paren
id|StartCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|800
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|tmp
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_NETDIAG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_FULL
)paren
id|tmp
op_or_assign
id|FD_ENABLE
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|FD_ENABLE
suffix:semicolon
id|outw
c_func
(paren
id|tmp
comma
id|ioaddr
op_plus
id|WN4_NETDIAG
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|el3_get_drvinfo
r_static
r_void
id|el3_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
id|strcpy
c_func
(paren
id|info-&gt;driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;version
comma
id|DRV_VERSION
)paren
suffix:semicolon
)brace
DECL|function|el3_get_settings
r_static
r_int
id|el3_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|ret
op_assign
id|el3_netdev_get_ecmd
c_func
(paren
id|dev
comma
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|el3_set_settings
r_static
r_int
id|el3_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|ret
op_assign
id|el3_netdev_set_ecmd
c_func
(paren
id|dev
comma
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|el3_get_link
r_static
id|u32
id|el3_get_link
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|ret
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|ret
op_assign
id|el3_link_ok
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|el3_get_msglevel
r_static
id|u32
id|el3_get_msglevel
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|el3_debug
suffix:semicolon
)brace
DECL|function|el3_set_msglevel
r_static
r_void
id|el3_set_msglevel
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|v
)paren
(brace
id|el3_debug
op_assign
id|v
suffix:semicolon
)brace
DECL|variable|ethtool_ops
r_static
r_struct
id|ethtool_ops
id|ethtool_ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|el3_get_drvinfo
comma
dot
id|get_settings
op_assign
id|el3_get_settings
comma
dot
id|set_settings
op_assign
id|el3_set_settings
comma
dot
id|get_link
op_assign
id|el3_get_link
comma
dot
id|get_msglevel
op_assign
id|el3_get_msglevel
comma
dot
id|set_msglevel
op_assign
id|el3_set_msglevel
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|el3_down
id|el3_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Turn off statistics ASAP.  We update lp-&gt;stats below. */
id|outw
c_func
(paren
id|StatsDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Disable the receiver and transmitter. */
id|outw
c_func
(paren
id|RxDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|TxDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|3
)paren
multiline_comment|/* Turn off thinnet power.  Green! */
id|outw
c_func
(paren
id|StopCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Disable link beat and jabber, if_port may change here next open(). */
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|outw
c_func
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_MEDIA
)paren
op_amp
op_complement
id|MEDIA_TP
comma
id|ioaddr
op_plus
id|WN4_MEDIA
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
id|SetIntrEnb
op_or
l_int|0x0000
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|update_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|el3_up
id|el3_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|sw_info
comma
id|net_diag
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Activating the board required and does no harm otherwise */
id|outw
c_func
(paren
l_int|0x0001
comma
id|ioaddr
op_plus
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Set the IRQ line. */
id|outw
c_func
(paren
(paren
id|dev-&gt;irq
op_lshift
l_int|12
)paren
op_or
l_int|0x0f00
comma
id|ioaddr
op_plus
id|WN0_IRQ
)paren
suffix:semicolon
multiline_comment|/* Set the station address in window 2 each time opened. */
id|EL3WINDOW
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|outb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;if_port
op_amp
l_int|0x03
)paren
op_eq
l_int|3
)paren
multiline_comment|/* BNC interface */
multiline_comment|/* Start the thinnet transceiver. We should really wait 50ms...*/
id|outw
c_func
(paren
id|StartCoax
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;if_port
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* 10baseT interface */
multiline_comment|/* Combine secondary sw_info word (the adapter level) and primary&n;&t;&t;&t;sw_info word (duplex setting plus other useless bits) */
id|EL3WINDOW
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|sw_info
op_assign
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|0x14
)paren
op_amp
l_int|0x400f
)paren
op_or
(paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|0x0d
)paren
op_amp
l_int|0xBff0
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|net_diag
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_NETDIAG
)paren
suffix:semicolon
id|net_diag
op_assign
(paren
id|net_diag
op_or
id|FD_ENABLE
)paren
suffix:semicolon
multiline_comment|/* temporarily assume full-duplex will be set */
id|printk
c_func
(paren
l_string|&quot;%s: &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
op_amp
l_int|0x0c
)paren
(brace
r_case
l_int|12
suffix:colon
multiline_comment|/* force full-duplex mode if 3c5x9b */
r_if
c_cond
(paren
id|sw_info
op_amp
l_int|0x000f
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Forcing 3c5x9b full-duplex mode&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
multiline_comment|/* set full-duplex mode based on eeprom config setting */
r_if
c_cond
(paren
(paren
id|sw_info
op_amp
l_int|0x000f
)paren
op_logical_and
(paren
id|sw_info
op_amp
l_int|0x8000
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Setting 3c5x9b full-duplex mode (from EEPROM configuration bit)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/* xcvr=(0 || 4) OR user has an old 3c5x9 non &quot;B&quot; model */
id|printk
c_func
(paren
l_string|&quot;Setting 3c5x9/3c5x9B half-duplex mode&quot;
)paren
suffix:semicolon
id|net_diag
op_assign
(paren
id|net_diag
op_amp
op_complement
id|FD_ENABLE
)paren
suffix:semicolon
multiline_comment|/* disable full duplex */
)brace
id|outw
c_func
(paren
id|net_diag
comma
id|ioaddr
op_plus
id|WN4_NETDIAG
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; if_port: %d, sw_info: %4.4x&bslash;n&quot;
comma
id|dev-&gt;if_port
comma
id|sw_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|el3_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot;%s: 3c5x9 net diag word is now: %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|net_diag
)paren
suffix:semicolon
multiline_comment|/* Enable link beat and jabber check. */
id|outw
c_func
(paren
id|inw
c_func
(paren
id|ioaddr
op_plus
id|WN4_MEDIA
)paren
op_or
id|MEDIA_TP
comma
id|ioaddr
op_plus
id|WN4_MEDIA
)paren
suffix:semicolon
)brace
multiline_comment|/* Switch to the stats window, and clear all stats by reading. */
id|outw
c_func
(paren
id|StatsDisable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|EL3WINDOW
c_func
(paren
l_int|6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|10
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/* Switch to register set 1 for normal use. */
id|EL3WINDOW
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Accept b-case and phys addr only. */
id|outw
c_func
(paren
id|SetRxFilter
op_or
id|RxStation
op_or
id|RxBroadcast
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|StatsEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Turn on statistics. */
id|outw
c_func
(paren
id|RxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable the receiver. */
id|outw
c_func
(paren
id|TxEnable
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Enable transmitter. */
multiline_comment|/* Allow status bits to be seen. */
id|outw
c_func
(paren
id|SetStatusEnb
op_or
l_int|0xff
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
multiline_comment|/* Ack all pending events, and set active indicator mask. */
id|outw
c_func
(paren
id|AckIntr
op_or
id|IntLatch
op_or
id|TxAvailable
op_or
id|RxEarly
op_or
id|IntReq
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|outw
c_func
(paren
id|SetIntrEnb
op_or
id|IntLatch
op_or
id|TxAvailable
op_or
id|TxComplete
op_or
id|RxComplete
op_or
id|StatsFull
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Power Management support functions */
macro_line|#ifdef CONFIG_PM
r_static
r_int
DECL|function|el3_suspend
id|el3_suspend
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev
op_logical_and
op_logical_neg
id|pdev-&gt;data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|pdev-&gt;data
suffix:semicolon
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|el3_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outw
c_func
(paren
id|PowerDown
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_resume
id|el3_resume
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|el3_private
op_star
id|lp
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev
op_logical_and
op_logical_neg
id|pdev-&gt;data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|pdev-&gt;data
suffix:semicolon
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|outw
c_func
(paren
id|PowerUp
comma
id|ioaddr
op_plus
id|EL3_CMD
)paren
suffix:semicolon
id|el3_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|el3_pm_callback
id|el3_pm_callback
c_func
(paren
r_struct
id|pm_dev
op_star
id|pdev
comma
id|pm_request_t
id|rqst
comma
r_void
op_star
id|data
)paren
(brace
r_switch
c_cond
(paren
id|rqst
)paren
(brace
r_case
id|PM_SUSPEND
suffix:colon
r_return
id|el3_suspend
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_case
id|PM_RESUME
suffix:colon
r_return
id|el3_resume
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
multiline_comment|/* Parameters that may be passed into the module. */
DECL|variable|debug
r_static
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|xcvr
r_static
r_int
id|xcvr
(braket
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|irq
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|xcvr
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|max_interrupt_work
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;debug level (0-6)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;IRQ number(s) (assigned)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|xcvr
comma
l_string|&quot;transceiver(s) (0=internal, 1=external)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;maximum events handled per interrupt&quot;
)paren
suffix:semicolon
macro_line|#if defined(__ISAPNP__)
id|module_param
c_func
(paren
id|nopnp
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nopnp
comma
l_string|&quot;disable ISA PnP support (0-1)&quot;
)paren
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|isapnp
comma
id|el3_isapnp_adapters
)paren
suffix:semicolon
macro_line|#endif&t;/* __ISAPNP__ */
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;3Com Etherlink III (3c509, 3c509B) ISA/PnP ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|el3_init_module
r_static
r_int
id|__init
id|el3_init_module
c_func
(paren
r_void
)paren
(brace
id|el3_cards
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|debug
op_ge
l_int|0
)paren
id|el3_debug
op_assign
id|debug
suffix:semicolon
id|el3_root_dev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|el3_probe
c_func
(paren
id|el3_cards
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|irq
(braket
id|el3_cards
)braket
OG
l_int|1
)paren
id|el3_root_dev-&gt;irq
op_assign
id|irq
(braket
id|el3_cards
)braket
suffix:semicolon
r_if
c_cond
(paren
id|xcvr
(braket
id|el3_cards
)braket
op_ge
l_int|0
)paren
id|el3_root_dev-&gt;if_port
op_assign
id|xcvr
(braket
id|el3_cards
)braket
suffix:semicolon
id|el3_cards
op_increment
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_EISA
r_if
c_cond
(paren
id|eisa_driver_register
(paren
op_amp
id|el3_eisa_driver
)paren
OL
l_int|0
)paren
(brace
id|eisa_driver_unregister
(paren
op_amp
id|el3_eisa_driver
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MCA
id|mca_register_driver
c_func
(paren
op_amp
id|el3_mca_driver
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|el3_cleanup_module
r_static
r_void
id|__exit
id|el3_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|next_dev
suffix:semicolon
r_while
c_loop
(paren
id|el3_root_dev
)paren
(brace
r_struct
id|el3_private
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|el3_root_dev
)paren
suffix:semicolon
id|next_dev
op_assign
id|lp-&gt;next_dev
suffix:semicolon
id|el3_common_remove
(paren
id|el3_root_dev
)paren
suffix:semicolon
id|el3_root_dev
op_assign
id|next_dev
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_EISA
id|eisa_driver_unregister
(paren
op_amp
id|el3_eisa_driver
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MCA
id|mca_unregister_driver
c_func
(paren
op_amp
id|el3_mca_driver
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|el3_init_module
id|module_init
(paren
id|el3_init_module
)paren
suffix:semicolon
DECL|variable|el3_cleanup_module
id|module_exit
(paren
id|el3_cleanup_module
)paren
suffix:semicolon
eof
