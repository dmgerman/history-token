multiline_comment|/*&n; *  linux/drivers/acorn/net/etherh.c&n; *&n; *  Copyright (C) 2000-2002 Russell King&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; * NS8390 I-cubed EtherH and ANT EtherM specific driver&n; * Thanks to I-Cubed for information on their cards.&n; * EtherM conversion (C) 1999 Chris Kemp and Tim Watterton&n; * EtherM integration (C) 2000 Aleph One Ltd (Tak-Shing Chan)&n; * EtherM integration re-engineered by Russell King.&n; *&n; * Changelog:&n; *  08-12-1996&t;RMK&t;1.00&t;Created&n; *&t;&t;RMK&t;1.03&t;Added support for EtherLan500 cards&n; *  23-11-1997&t;RMK&t;1.04&t;Added media autodetection&n; *  16-04-1998&t;RMK&t;1.05&t;Improved media autodetection&n; *  10-02-2000&t;RMK&t;1.06&t;Updated for 2.3.43&n; *  13-05-2000&t;RMK&t;1.07&t;Updated for 2.3.99-pre8&n; *  12-10-1999  CK/TEW&t;&t;EtherM driver first release&n; *  21-12-2000&t;TTC&t;&t;EtherH/EtherM integration&n; *  25-12-2000&t;RMK&t;1.08&t;Clean integration of EtherM into this driver.&n; *  03-01-2002&t;RMK&t;1.09&t;Always enable IRQs if we&squot;re in the nic slot.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ecard.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &quot;../8390.h&quot;
DECL|macro|NET_DEBUG
mdefine_line|#define NET_DEBUG  0
DECL|macro|DEBUG_INIT
mdefine_line|#define DEBUG_INIT 2
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;etherh&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.11&quot;
DECL|variable|net_debug
r_static
r_int
r_int
id|net_debug
op_assign
id|NET_DEBUG
suffix:semicolon
DECL|struct|etherh_priv
r_struct
id|etherh_priv
(brace
DECL|member|ioc_fast
r_void
id|__iomem
op_star
id|ioc_fast
suffix:semicolon
DECL|member|memc
r_void
id|__iomem
op_star
id|memc
suffix:semicolon
DECL|member|dma_base
r_void
id|__iomem
op_star
id|dma_base
suffix:semicolon
DECL|member|id
r_int
r_int
id|id
suffix:semicolon
DECL|member|ctrl_port
r_void
id|__iomem
op_star
id|ctrl_port
suffix:semicolon
DECL|member|ctrl
r_int
r_char
id|ctrl
suffix:semicolon
DECL|member|supported
id|u32
id|supported
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|etherh_data
r_struct
id|etherh_data
(brace
DECL|member|ns8390_offset
r_int
r_int
id|ns8390_offset
suffix:semicolon
DECL|member|dataport_offset
r_int
r_int
id|dataport_offset
suffix:semicolon
DECL|member|ctrlport_offset
r_int
r_int
id|ctrlport_offset
suffix:semicolon
DECL|member|ctrl_ioc
r_int
id|ctrl_ioc
suffix:semicolon
DECL|member|name
r_const
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|supported
id|u32
id|supported
suffix:semicolon
DECL|member|tx_start_page
r_int
r_char
id|tx_start_page
suffix:semicolon
DECL|member|stop_page
r_int
r_char
id|stop_page
suffix:semicolon
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Russell King&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;EtherH/EtherM driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|version
(braket
)braket
id|__initdata
op_assign
l_string|&quot;EtherH/EtherM Driver (c) 2002-2004 Russell King &quot;
id|DRV_VERSION
l_string|&quot;&bslash;n&quot;
suffix:semicolon
DECL|macro|ETHERH500_DATAPORT
mdefine_line|#define ETHERH500_DATAPORT&t;0x800&t;/* MEMC */
DECL|macro|ETHERH500_NS8390
mdefine_line|#define ETHERH500_NS8390&t;0x000&t;/* MEMC */
DECL|macro|ETHERH500_CTRLPORT
mdefine_line|#define ETHERH500_CTRLPORT&t;0x800&t;/* IOC  */
DECL|macro|ETHERH600_DATAPORT
mdefine_line|#define ETHERH600_DATAPORT&t;0x040&t;/* MEMC */
DECL|macro|ETHERH600_NS8390
mdefine_line|#define ETHERH600_NS8390&t;0x800&t;/* MEMC */
DECL|macro|ETHERH600_CTRLPORT
mdefine_line|#define ETHERH600_CTRLPORT&t;0x200&t;/* MEMC */
DECL|macro|ETHERH_CP_IE
mdefine_line|#define ETHERH_CP_IE&t;&t;1
DECL|macro|ETHERH_CP_IF
mdefine_line|#define ETHERH_CP_IF&t;&t;2
DECL|macro|ETHERH_CP_HEARTBEAT
mdefine_line|#define ETHERH_CP_HEARTBEAT&t;2
DECL|macro|ETHERH_TX_START_PAGE
mdefine_line|#define ETHERH_TX_START_PAGE&t;1
DECL|macro|ETHERH_STOP_PAGE
mdefine_line|#define ETHERH_STOP_PAGE&t;127
multiline_comment|/*&n; * These came from CK/TEW&n; */
DECL|macro|ETHERM_DATAPORT
mdefine_line|#define ETHERM_DATAPORT&t;&t;0x200&t;/* MEMC */
DECL|macro|ETHERM_NS8390
mdefine_line|#define ETHERM_NS8390&t;&t;0x800&t;/* MEMC */
DECL|macro|ETHERM_CTRLPORT
mdefine_line|#define ETHERM_CTRLPORT&t;&t;0x23c&t;/* MEMC */
DECL|macro|ETHERM_TX_START_PAGE
mdefine_line|#define ETHERM_TX_START_PAGE&t;64
DECL|macro|ETHERM_STOP_PAGE
mdefine_line|#define ETHERM_STOP_PAGE&t;127
multiline_comment|/* ------------------------------------------------------------------------ */
DECL|macro|etherh_priv
mdefine_line|#define etherh_priv(dev) &bslash;&n; ((struct etherh_priv *)(((char *)netdev_priv(dev)) + sizeof(struct ei_device)))
DECL|function|etherh_set_ctrl
r_static
r_inline
r_void
id|etherh_set_ctrl
c_func
(paren
r_struct
id|etherh_priv
op_star
id|eh
comma
r_int
r_char
id|mask
)paren
(brace
r_int
r_char
id|ctrl
op_assign
id|eh-&gt;ctrl
op_or
id|mask
suffix:semicolon
id|eh-&gt;ctrl
op_assign
id|ctrl
suffix:semicolon
id|writeb
c_func
(paren
id|ctrl
comma
id|eh-&gt;ctrl_port
)paren
suffix:semicolon
)brace
DECL|function|etherh_clr_ctrl
r_static
r_inline
r_void
id|etherh_clr_ctrl
c_func
(paren
r_struct
id|etherh_priv
op_star
id|eh
comma
r_int
r_char
id|mask
)paren
(brace
r_int
r_char
id|ctrl
op_assign
id|eh-&gt;ctrl
op_amp
op_complement
id|mask
suffix:semicolon
id|eh-&gt;ctrl
op_assign
id|ctrl
suffix:semicolon
id|writeb
c_func
(paren
id|ctrl
comma
id|eh-&gt;ctrl_port
)paren
suffix:semicolon
)brace
DECL|function|etherh_get_stat
r_static
r_inline
r_int
r_int
id|etherh_get_stat
c_func
(paren
r_struct
id|etherh_priv
op_star
id|eh
)paren
(brace
r_return
id|readb
c_func
(paren
id|eh-&gt;ctrl_port
)paren
suffix:semicolon
)brace
DECL|function|etherh_irq_enable
r_static
r_void
id|etherh_irq_enable
c_func
(paren
id|ecard_t
op_star
id|ec
comma
r_int
id|irqnr
)paren
(brace
r_struct
id|etherh_priv
op_star
id|eh
op_assign
id|ec-&gt;irq_data
suffix:semicolon
id|etherh_set_ctrl
c_func
(paren
id|eh
comma
id|ETHERH_CP_IE
)paren
suffix:semicolon
)brace
DECL|function|etherh_irq_disable
r_static
r_void
id|etherh_irq_disable
c_func
(paren
id|ecard_t
op_star
id|ec
comma
r_int
id|irqnr
)paren
(brace
r_struct
id|etherh_priv
op_star
id|eh
op_assign
id|ec-&gt;irq_data
suffix:semicolon
id|etherh_clr_ctrl
c_func
(paren
id|eh
comma
id|ETHERH_CP_IE
)paren
suffix:semicolon
)brace
DECL|variable|etherh_ops
r_static
id|expansioncard_ops_t
id|etherh_ops
op_assign
(brace
dot
id|irqenable
op_assign
id|etherh_irq_enable
comma
dot
id|irqdisable
op_assign
id|etherh_irq_disable
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|etherh_setif
id|etherh_setif
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_void
id|__iomem
op_star
id|addr
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* set the interface type */
r_switch
c_cond
(paren
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|id
)paren
(brace
r_case
id|PROD_I3_ETHERLAN600
suffix:colon
r_case
id|PROD_I3_ETHERLAN600A
suffix:colon
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
op_plus
id|EN0_RCNTHI
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|IF_PORT_10BASE2
suffix:colon
id|writeb
c_func
(paren
(paren
id|readb
c_func
(paren
id|addr
)paren
op_amp
l_int|0xf8
)paren
op_or
l_int|1
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
id|writeb
c_func
(paren
(paren
id|readb
c_func
(paren
id|addr
)paren
op_amp
l_int|0xf8
)paren
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PROD_I3_ETHERLAN500
suffix:colon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|IF_PORT_10BASE2
suffix:colon
id|etherh_clr_ctrl
c_func
(paren
id|etherh_priv
c_func
(paren
id|dev
)paren
comma
id|ETHERH_CP_IF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
id|etherh_set_ctrl
c_func
(paren
id|etherh_priv
c_func
(paren
id|dev
)paren
comma
id|ETHERH_CP_IF
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|etherh_getifstat
id|etherh_getifstat
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|addr
suffix:semicolon
r_int
id|stat
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|id
)paren
(brace
r_case
id|PROD_I3_ETHERLAN600
suffix:colon
r_case
id|PROD_I3_ETHERLAN600A
suffix:colon
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
op_plus
id|EN0_RCNTHI
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|IF_PORT_10BASE2
suffix:colon
id|stat
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
id|stat
op_assign
id|readb
c_func
(paren
id|addr
)paren
op_amp
l_int|4
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PROD_I3_ETHERLAN500
suffix:colon
r_switch
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_case
id|IF_PORT_10BASE2
suffix:colon
id|stat
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
id|stat
op_assign
id|etherh_get_stat
c_func
(paren
id|etherh_priv
c_func
(paren
id|dev
)paren
)paren
op_amp
id|ETHERH_CP_HEARTBEAT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|stat
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|stat
op_ne
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Configure the interface.  Note that we ignore the other&n; * parts of ifmap, since its mostly meaningless for this driver.&n; */
DECL|function|etherh_set_config
r_static
r_int
id|etherh_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_switch
c_cond
(paren
id|map-&gt;port
)paren
(brace
r_case
id|IF_PORT_10BASE2
suffix:colon
r_case
id|IF_PORT_10BASET
suffix:colon
multiline_comment|/*&n;&t;&t; * If the user explicitly sets the interface&n;&t;&t; * media type, turn off automedia detection.&n;&t;&t; */
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_AUTOMEDIA
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Reset the 8390 (hard reset).  Note that we can&squot;t actually do this.&n; */
r_static
r_void
DECL|function|etherh_reset
id|etherh_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|writeb
c_func
(paren
id|E8390_NODMA
op_plus
id|E8390_PAGE0
op_plus
id|E8390_STOP
comma
id|addr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * See if we need to change the interface type.&n;&t; * Note that we use &squot;interface_num&squot; as a flag&n;&t; * to indicate that we need to change the media.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_AUTOMEDIA
op_logical_and
id|ei_local-&gt;interface_num
)paren
(brace
id|ei_local-&gt;interface_num
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|IF_PORT_10BASET
)paren
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASE2
suffix:semicolon
r_else
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Write a block of data out to the 8390&n; */
r_static
r_void
DECL|function|etherh_block_output
id|etherh_block_output
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|count
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|start_page
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|dma_start
suffix:semicolon
r_void
id|__iomem
op_star
id|dma_base
comma
op_star
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: DMAing conflict in etherh_block_input: &quot;
l_string|&quot; DMAstat %d irqlock %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_local-&gt;dmaing
comma
id|ei_local-&gt;irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Make sure we have a round number of bytes if we&squot;re in word mode.&n;&t; */
r_if
c_cond
(paren
id|count
op_amp
l_int|1
op_logical_and
id|ei_local-&gt;word16
)paren
id|count
op_increment
suffix:semicolon
id|ei_local-&gt;dmaing
op_assign
l_int|1
suffix:semicolon
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|dma_base
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|dma_base
suffix:semicolon
id|count
op_assign
(paren
id|count
op_plus
l_int|1
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|writeb
(paren
id|E8390_NODMA
op_or
id|E8390_PAGE0
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x42
comma
id|addr
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x00
comma
id|addr
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x42
comma
id|addr
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x00
comma
id|addr
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|writeb
(paren
id|E8390_RREAD
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|udelay
(paren
l_int|1
)paren
suffix:semicolon
id|writeb
(paren
id|ENISR_RDC
comma
id|addr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
id|writeb
(paren
id|count
comma
id|addr
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|writeb
(paren
id|count
op_rshift
l_int|8
comma
id|addr
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|writeb
(paren
l_int|0
comma
id|addr
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|writeb
(paren
id|start_page
comma
id|addr
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|writeb
(paren
id|E8390_RWRITE
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;word16
)paren
id|writesw
(paren
id|dma_base
comma
id|buf
comma
id|count
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|writesb
(paren
id|dma_base
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|dma_start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
(paren
id|readb
(paren
id|addr
op_plus
id|EN0_ISR
)paren
op_amp
id|ENISR_RDC
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|jiffies
op_minus
id|dma_start
OG
l_int|2
op_star
id|HZ
op_div
l_int|100
)paren
(brace
multiline_comment|/* 20ms */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: timeout waiting for TX RDC&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|etherh_reset
(paren
id|dev
)paren
suffix:semicolon
id|NS8390_init
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|writeb
(paren
id|ENISR_RDC
comma
id|addr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
id|ei_local-&gt;dmaing
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a block of data from the 8390&n; */
r_static
r_void
DECL|function|etherh_block_input
id|etherh_block_input
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|count
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|ring_offset
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_char
op_star
id|buf
suffix:semicolon
r_void
id|__iomem
op_star
id|dma_base
comma
op_star
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: DMAing conflict in etherh_block_input: &quot;
l_string|&quot; DMAstat %d irqlock %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_local-&gt;dmaing
comma
id|ei_local-&gt;irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ei_local-&gt;dmaing
op_assign
l_int|1
suffix:semicolon
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|dma_base
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|dma_base
suffix:semicolon
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
id|writeb
(paren
id|E8390_NODMA
op_or
id|E8390_PAGE0
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|writeb
(paren
id|count
comma
id|addr
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|writeb
(paren
id|count
op_rshift
l_int|8
comma
id|addr
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|writeb
(paren
id|ring_offset
comma
id|addr
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|writeb
(paren
id|ring_offset
op_rshift
l_int|8
comma
id|addr
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|writeb
(paren
id|E8390_RREAD
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;word16
)paren
(brace
id|readsw
(paren
id|dma_base
comma
id|buf
comma
id|count
op_rshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_amp
l_int|1
)paren
id|buf
(braket
id|count
op_minus
l_int|1
)braket
op_assign
id|readb
(paren
id|dma_base
)paren
suffix:semicolon
)brace
r_else
id|readsb
(paren
id|dma_base
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|writeb
(paren
id|ENISR_RDC
comma
id|addr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
id|ei_local-&gt;dmaing
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a header from the 8390&n; */
r_static
r_void
DECL|function|etherh_get_header
id|etherh_get_header
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|e8390_pkt_hdr
op_star
id|hdr
comma
r_int
id|ring_page
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|dma_base
comma
op_star
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: DMAing conflict in etherh_get_header: &quot;
l_string|&quot; DMAstat %d irqlock %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_local-&gt;dmaing
comma
id|ei_local-&gt;irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ei_local-&gt;dmaing
op_assign
l_int|1
suffix:semicolon
id|addr
op_assign
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|dma_base
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|dma_base
suffix:semicolon
id|writeb
(paren
id|E8390_NODMA
op_or
id|E8390_PAGE0
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|writeb
(paren
r_sizeof
(paren
op_star
id|hdr
)paren
comma
id|addr
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|writeb
(paren
l_int|0
comma
id|addr
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|writeb
(paren
l_int|0
comma
id|addr
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|writeb
(paren
id|ring_page
comma
id|addr
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|writeb
(paren
id|E8390_RREAD
op_or
id|E8390_START
comma
id|addr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_local-&gt;word16
)paren
id|readsw
(paren
id|dma_base
comma
id|hdr
comma
r_sizeof
(paren
op_star
id|hdr
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|readsb
(paren
id|dma_base
comma
id|hdr
comma
r_sizeof
(paren
op_star
id|hdr
)paren
)paren
suffix:semicolon
id|writeb
(paren
id|ENISR_RDC
comma
id|addr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
id|ei_local-&gt;dmaing
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Open/initialize the board.  This is called (in the current kernel)&n; * sometime after booting when the &squot;ifconfig&squot; program is run.&n; *&n; * This routine should set everything up anew at each open, even&n; * registers that &quot;should&quot; only need to be set once at boot, so that&n; * there is non-reboot way to recover if something goes wrong.&n; */
r_static
r_int
DECL|function|etherh_open
id|etherh_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|ei_device
op_star
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_valid_ether_addr
c_func
(paren
id|dev-&gt;dev_addr
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: invalid ethernet MAC address&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|ei_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure that we aren&squot;t going to change the&n;&t; * media type on the next reset - we are about to&n;&t; * do automedia manually now.&n;&t; */
id|ei_local-&gt;interface_num
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * If we are doing automedia detection, do it now.&n;&t; * This is more reliable than the 8390&squot;s detection.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_AUTOMEDIA
)paren
(brace
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|etherh_getifstat
c_func
(paren
id|dev
)paren
)paren
(brace
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASE2
suffix:semicolon
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
id|etherh_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ei_open
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * The inverse routine to etherh_open().&n; */
r_static
r_int
DECL|function|etherh_close
id|etherh_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ei_close
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialisation&n; */
DECL|function|etherh_banner
r_static
r_void
id|__init
id|etherh_banner
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|version_printed
suffix:semicolon
r_if
c_cond
(paren
id|net_debug
op_logical_and
id|version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Read the ethernet address string from the on board rom.&n; * This is an ascii string...&n; */
DECL|function|etherh_addr
r_static
r_int
id|__init
id|etherh_addr
c_func
(paren
r_char
op_star
id|addr
comma
r_struct
id|expansion_card
op_star
id|ec
)paren
(brace
r_struct
id|in_chunk_dir
id|cd
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ecard_readchunk
c_func
(paren
op_amp
id|cd
comma
id|ec
comma
l_int|0xf5
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to read podule description string&bslash;n&quot;
comma
id|ec-&gt;dev.bus_id
)paren
suffix:semicolon
r_goto
id|no_addr
suffix:semicolon
)brace
id|s
op_assign
id|strchr
c_func
(paren
id|cd.d.string
comma
l_char|&squot;(&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|addr
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|s
op_plus
l_int|1
comma
op_amp
id|s
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|s
op_ne
(paren
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot;)&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|6
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to parse MAC address: %s&bslash;n&quot;
comma
id|ec-&gt;dev.bus_id
comma
id|cd.d.string
)paren
suffix:semicolon
id|no_addr
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n; * Create an ethernet address from the system serial number.&n; */
DECL|function|etherm_addr
r_static
r_int
id|__init
id|etherm_addr
c_func
(paren
r_char
op_star
id|addr
)paren
(brace
r_int
r_int
id|serial
suffix:semicolon
r_if
c_cond
(paren
id|system_serial_low
op_eq
l_int|0
op_logical_and
id|system_serial_high
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|serial
op_assign
id|system_serial_low
op_or
id|system_serial_high
suffix:semicolon
id|addr
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|addr
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|addr
(braket
l_int|2
)braket
op_assign
l_int|0xa4
suffix:semicolon
id|addr
(braket
l_int|3
)braket
op_assign
l_int|0x10
op_plus
(paren
id|serial
op_rshift
l_int|24
)paren
suffix:semicolon
id|addr
(braket
l_int|4
)braket
op_assign
id|serial
op_rshift
l_int|16
suffix:semicolon
id|addr
(braket
l_int|5
)braket
op_assign
id|serial
op_rshift
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|etherh_get_drvinfo
r_static
r_void
id|etherh_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
id|strlcpy
c_func
(paren
id|info-&gt;driver
comma
id|DRV_NAME
comma
r_sizeof
(paren
id|info-&gt;driver
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info-&gt;version
comma
id|DRV_VERSION
comma
r_sizeof
(paren
id|info-&gt;version
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info-&gt;bus_info
comma
id|dev-&gt;class_dev.dev-&gt;bus_id
comma
r_sizeof
(paren
id|info-&gt;bus_info
)paren
)paren
suffix:semicolon
)brace
DECL|function|etherh_get_settings
r_static
r_int
id|etherh_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
id|cmd-&gt;supported
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|supported
suffix:semicolon
id|cmd-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|cmd-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|cmd-&gt;port
op_assign
id|dev-&gt;if_port
op_eq
id|IF_PORT_10BASET
ques
c_cond
id|PORT_TP
suffix:colon
id|PORT_BNC
suffix:semicolon
id|cmd-&gt;autoneg
op_assign
id|dev-&gt;flags
op_amp
id|IFF_AUTOMEDIA
ques
c_cond
id|AUTONEG_ENABLE
suffix:colon
id|AUTONEG_DISABLE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|etherh_set_settings
r_static
r_int
id|etherh_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_switch
c_cond
(paren
id|cmd-&gt;autoneg
)paren
(brace
r_case
id|AUTONEG_ENABLE
suffix:colon
id|dev-&gt;flags
op_or_assign
id|IFF_AUTOMEDIA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTONEG_DISABLE
suffix:colon
r_switch
c_cond
(paren
id|cmd-&gt;port
)paren
(brace
r_case
id|PORT_TP
suffix:colon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_BNC
suffix:colon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASE2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_AUTOMEDIA
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|etherh_setif
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|etherh_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|etherh_ethtool_ops
op_assign
(brace
dot
id|get_settings
op_assign
id|etherh_get_settings
comma
dot
id|set_settings
op_assign
id|etherh_set_settings
comma
dot
id|get_drvinfo
op_assign
id|etherh_get_drvinfo
comma
)brace
suffix:semicolon
DECL|variable|etherh_regoffsets
r_static
id|u32
id|etherh_regoffsets
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|etherm_regoffsets
r_static
id|u32
id|etherm_regoffsets
(braket
l_int|16
)braket
suffix:semicolon
r_static
r_int
id|__init
DECL|function|etherh_probe
id|etherh_probe
c_func
(paren
r_struct
id|expansion_card
op_star
id|ec
comma
r_const
r_struct
id|ecard_id
op_star
id|id
)paren
(brace
r_const
r_struct
id|etherh_data
op_star
id|data
op_assign
id|id-&gt;data
suffix:semicolon
r_struct
id|ei_device
op_star
id|ei_local
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|etherh_priv
op_star
id|eh
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
id|etherh_banner
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|ecard_request_resources
c_func
(paren
id|ec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out
suffix:semicolon
id|dev
op_assign
id|__alloc_ei_netdev
c_func
(paren
r_sizeof
(paren
r_struct
id|etherh_priv
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|release
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|ec-&gt;dev
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|etherh_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|etherh_close
suffix:semicolon
id|dev-&gt;set_config
op_assign
id|etherh_set_config
suffix:semicolon
id|dev-&gt;irq
op_assign
id|ec-&gt;irq
suffix:semicolon
id|dev-&gt;ethtool_ops
op_assign
op_amp
id|etherh_ethtool_ops
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;supported
op_amp
id|SUPPORTED_Autoneg
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_AUTOMEDIA
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;supported
op_amp
id|SUPPORTED_TP
)paren
(brace
id|dev-&gt;flags
op_or_assign
id|IFF_PORTSEL
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|data-&gt;supported
op_amp
id|SUPPORTED_BNC
)paren
(brace
id|dev-&gt;flags
op_or_assign
id|IFF_PORTSEL
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASE2
suffix:semicolon
)brace
r_else
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
id|eh
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|eh-&gt;supported
op_assign
id|data-&gt;supported
suffix:semicolon
id|eh-&gt;ctrl
op_assign
l_int|0
suffix:semicolon
id|eh-&gt;id
op_assign
id|ec-&gt;cid.product
suffix:semicolon
id|eh-&gt;memc
op_assign
id|ioremap
c_func
(paren
id|ecard_resource_start
c_func
(paren
id|ec
comma
id|ECARD_RES_MEMC
)paren
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eh-&gt;memc
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|free
suffix:semicolon
)brace
id|eh-&gt;ctrl_port
op_assign
id|eh-&gt;memc
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;ctrl_ioc
)paren
(brace
id|eh-&gt;ioc_fast
op_assign
id|ioremap
c_func
(paren
id|ecard_resource_start
c_func
(paren
id|ec
comma
id|ECARD_RES_IOCFAST
)paren
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eh-&gt;ioc_fast
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|free
suffix:semicolon
)brace
id|eh-&gt;ctrl_port
op_assign
id|eh-&gt;ioc_fast
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|eh-&gt;memc
op_plus
id|data-&gt;ns8390_offset
suffix:semicolon
id|eh-&gt;dma_base
op_assign
id|eh-&gt;memc
op_plus
id|data-&gt;dataport_offset
suffix:semicolon
id|eh-&gt;ctrl_port
op_add_assign
id|data-&gt;ctrlport_offset
suffix:semicolon
multiline_comment|/*&n;&t; * IRQ and control port handling - only for non-NIC slot cards.&n;&t; */
r_if
c_cond
(paren
id|ec-&gt;slot_no
op_ne
l_int|8
)paren
(brace
id|ec-&gt;ops
op_assign
op_amp
id|etherh_ops
suffix:semicolon
id|ec-&gt;irq_data
op_assign
id|eh
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * If we&squot;re in the NIC slot, make sure the IRQ is enabled&n;&t;&t; */
id|etherh_set_ctrl
c_func
(paren
id|eh
comma
id|ETHERH_CP_IE
)paren
suffix:semicolon
)brace
id|ei_local
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|ei_local-&gt;page_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ec-&gt;cid.product
op_eq
id|PROD_ANT_ETHERM
)paren
(brace
id|etherm_addr
c_func
(paren
id|dev-&gt;dev_addr
)paren
suffix:semicolon
id|ei_local-&gt;reg_offset
op_assign
id|etherm_regoffsets
suffix:semicolon
)brace
r_else
(brace
id|etherh_addr
c_func
(paren
id|dev-&gt;dev_addr
comma
id|ec
)paren
suffix:semicolon
id|ei_local-&gt;reg_offset
op_assign
id|etherh_regoffsets
suffix:semicolon
)brace
id|ei_local-&gt;name
op_assign
id|dev-&gt;name
suffix:semicolon
id|ei_local-&gt;word16
op_assign
l_int|1
suffix:semicolon
id|ei_local-&gt;tx_start_page
op_assign
id|data-&gt;tx_start_page
suffix:semicolon
id|ei_local-&gt;rx_start_page
op_assign
id|ei_local-&gt;tx_start_page
op_plus
id|TX_PAGES
suffix:semicolon
id|ei_local-&gt;stop_page
op_assign
id|data-&gt;stop_page
suffix:semicolon
id|ei_local-&gt;reset_8390
op_assign
id|etherh_reset
suffix:semicolon
id|ei_local-&gt;block_input
op_assign
id|etherh_block_input
suffix:semicolon
id|ei_local-&gt;block_output
op_assign
id|etherh_block_output
suffix:semicolon
id|ei_local-&gt;get_8390_hdr
op_assign
id|etherh_get_header
suffix:semicolon
id|ei_local-&gt;interface_num
op_assign
l_int|0
suffix:semicolon
id|etherh_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|NS8390_init
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|ret
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|free
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s in slot %d, &quot;
comma
id|dev-&gt;name
comma
id|data-&gt;name
comma
id|ec-&gt;slot_no
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x%c&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot;&bslash;n&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
id|ecard_set_drvdata
c_func
(paren
id|ec
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free
suffix:colon
r_if
c_cond
(paren
id|eh-&gt;ioc_fast
)paren
id|iounmap
c_func
(paren
id|eh-&gt;ioc_fast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eh-&gt;memc
)paren
id|iounmap
c_func
(paren
id|eh-&gt;memc
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release
suffix:colon
id|ecard_release_resources
c_func
(paren
id|ec
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|etherh_remove
r_static
r_void
id|__devexit
id|etherh_remove
c_func
(paren
r_struct
id|expansion_card
op_star
id|ec
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|ecard_get_drvdata
c_func
(paren
id|ec
)paren
suffix:semicolon
r_struct
id|etherh_priv
op_star
id|eh
op_assign
id|etherh_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ecard_set_drvdata
c_func
(paren
id|ec
comma
l_int|NULL
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ec-&gt;ops
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|eh-&gt;ioc_fast
)paren
id|iounmap
c_func
(paren
id|eh-&gt;ioc_fast
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|eh-&gt;memc
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ecard_release_resources
c_func
(paren
id|ec
)paren
suffix:semicolon
)brace
DECL|variable|etherm_data
r_static
r_struct
id|etherh_data
id|etherm_data
op_assign
(brace
dot
id|ns8390_offset
op_assign
id|ETHERM_NS8390
comma
dot
id|dataport_offset
op_assign
id|ETHERM_NS8390
op_plus
id|ETHERM_DATAPORT
comma
dot
id|ctrlport_offset
op_assign
id|ETHERM_NS8390
op_plus
id|ETHERM_CTRLPORT
comma
dot
id|name
op_assign
l_string|&quot;ANT EtherM&quot;
comma
dot
id|supported
op_assign
id|SUPPORTED_10baseT_Half
comma
dot
id|tx_start_page
op_assign
id|ETHERM_TX_START_PAGE
comma
dot
id|stop_page
op_assign
id|ETHERM_STOP_PAGE
comma
)brace
suffix:semicolon
DECL|variable|etherlan500_data
r_static
r_struct
id|etherh_data
id|etherlan500_data
op_assign
(brace
dot
id|ns8390_offset
op_assign
id|ETHERH500_NS8390
comma
dot
id|dataport_offset
op_assign
id|ETHERH500_NS8390
op_plus
id|ETHERH500_DATAPORT
comma
dot
id|ctrlport_offset
op_assign
id|ETHERH500_CTRLPORT
comma
dot
id|ctrl_ioc
op_assign
l_int|1
comma
dot
id|name
op_assign
l_string|&quot;i3 EtherH 500&quot;
comma
dot
id|supported
op_assign
id|SUPPORTED_10baseT_Half
comma
dot
id|tx_start_page
op_assign
id|ETHERH_TX_START_PAGE
comma
dot
id|stop_page
op_assign
id|ETHERH_STOP_PAGE
comma
)brace
suffix:semicolon
DECL|variable|etherlan600_data
r_static
r_struct
id|etherh_data
id|etherlan600_data
op_assign
(brace
dot
id|ns8390_offset
op_assign
id|ETHERH600_NS8390
comma
dot
id|dataport_offset
op_assign
id|ETHERH600_NS8390
op_plus
id|ETHERH600_DATAPORT
comma
dot
id|ctrlport_offset
op_assign
id|ETHERH600_NS8390
op_plus
id|ETHERH600_CTRLPORT
comma
dot
id|name
op_assign
l_string|&quot;i3 EtherH 600&quot;
comma
dot
id|supported
op_assign
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_TP
op_or
id|SUPPORTED_BNC
op_or
id|SUPPORTED_Autoneg
comma
dot
id|tx_start_page
op_assign
id|ETHERH_TX_START_PAGE
comma
dot
id|stop_page
op_assign
id|ETHERH_STOP_PAGE
comma
)brace
suffix:semicolon
DECL|variable|etherlan600a_data
r_static
r_struct
id|etherh_data
id|etherlan600a_data
op_assign
(brace
dot
id|ns8390_offset
op_assign
id|ETHERH600_NS8390
comma
dot
id|dataport_offset
op_assign
id|ETHERH600_NS8390
op_plus
id|ETHERH600_DATAPORT
comma
dot
id|ctrlport_offset
op_assign
id|ETHERH600_NS8390
op_plus
id|ETHERH600_CTRLPORT
comma
dot
id|name
op_assign
l_string|&quot;i3 EtherH 600A&quot;
comma
dot
id|supported
op_assign
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_TP
op_or
id|SUPPORTED_BNC
op_or
id|SUPPORTED_Autoneg
comma
dot
id|tx_start_page
op_assign
id|ETHERH_TX_START_PAGE
comma
dot
id|stop_page
op_assign
id|ETHERH_STOP_PAGE
comma
)brace
suffix:semicolon
DECL|variable|etherh_ids
r_static
r_const
r_struct
id|ecard_id
id|etherh_ids
(braket
)braket
op_assign
(brace
(brace
id|MANU_ANT
comma
id|PROD_ANT_ETHERM
comma
op_amp
id|etherm_data
)brace
comma
(brace
id|MANU_I3
comma
id|PROD_I3_ETHERLAN500
comma
op_amp
id|etherlan500_data
)brace
comma
(brace
id|MANU_I3
comma
id|PROD_I3_ETHERLAN600
comma
op_amp
id|etherlan600_data
)brace
comma
(brace
id|MANU_I3
comma
id|PROD_I3_ETHERLAN600A
comma
op_amp
id|etherlan600a_data
)brace
comma
(brace
l_int|0xffff
comma
l_int|0xffff
)brace
)brace
suffix:semicolon
DECL|variable|etherh_driver
r_static
r_struct
id|ecard_driver
id|etherh_driver
op_assign
(brace
dot
id|probe
op_assign
id|etherh_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|etherh_remove
)paren
comma
dot
id|id_table
op_assign
id|etherh_ids
comma
dot
id|drv
op_assign
(brace
dot
id|name
op_assign
id|DRV_NAME
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|etherh_init
r_static
r_int
id|__init
id|etherh_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|etherh_regoffsets
(braket
id|i
)braket
op_assign
id|i
op_lshift
l_int|2
suffix:semicolon
id|etherm_regoffsets
(braket
id|i
)braket
op_assign
id|i
op_lshift
l_int|5
suffix:semicolon
)brace
r_return
id|ecard_register_driver
c_func
(paren
op_amp
id|etherh_driver
)paren
suffix:semicolon
)brace
DECL|function|etherh_exit
r_static
r_void
id|__exit
id|etherh_exit
c_func
(paren
r_void
)paren
(brace
id|ecard_remove_driver
c_func
(paren
op_amp
id|etherh_driver
)paren
suffix:semicolon
)brace
DECL|variable|etherh_init
id|module_init
c_func
(paren
id|etherh_init
)paren
suffix:semicolon
DECL|variable|etherh_exit
id|module_exit
c_func
(paren
id|etherh_exit
)paren
suffix:semicolon
eof
