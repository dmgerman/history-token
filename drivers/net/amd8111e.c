multiline_comment|/* Advanced  Micro Devices Inc. AMD8111E Linux Network Driver &n; * Copyright (C) 2004 Advanced Micro Devices &n; *&n; * &n; * Copyright 2001,2002 Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt; [ 8139cp.c,tg3.c ]&n; * Copyright (C) 2001, 2002 David S. Miller (davem@redhat.com)[ tg3.c]&n; * Copyright 1996-1999 Thomas Bogendoerfer [ pcnet32.c ]&n; * Derived from the lance driver written 1993,1994,1995 by Donald Becker.&n; * Copyright 1993 United States Government as represented by the&n; *&t;Director, National Security Agency.[ pcnet32.c ]&n; * Carsten Langgaard, carstenl@mips.com [ pcnet32.c ]&n; * Copyright (C) 2000 MIPS Technologies, Inc.  All rights reserved.&n; *&n; * &n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 &n; * USA&n;  &n;Module Name:&n;&n;&t;amd8111e.c&n;&n;Abstract:&n;&t;&n; &t; AMD8111 based 10/100 Ethernet Controller Driver. &n;&n;Environment:&n;&n;&t;Kernel Mode&n;&n;Revision History:&n; &t;3.0.0&n;&t;   Initial Revision.&n;&t;3.0.1&n;&t; 1. Dynamic interrupt coalescing.&n;&t; 2. Removed prev_stats.&n;&t; 3. MII support.&n;&t; 4. Dynamic IPG support&n;&t;3.0.2  05/29/2003&n;&t; 1. Bug fix: Fixed failure to send jumbo packets larger than 4k.&n;&t; 2. Bug fix: Fixed VLAN support failure.&n;&t; 3. Bug fix: Fixed receive interrupt coalescing bug.&n;&t; 4. Dynamic IPG support is disabled by default.&n;&t;3.0.3 06/05/2003&n;&t; 1. Bug fix: Fixed failure to close the interface if SMP is enabled.&n;&t;3.0.4 12/09/2003&n;&t; 1. Added set_mac_address routine for bonding driver support.&n;&t; 2. Tested the driver for bonding support&n;&t; 3. Bug fix: Fixed mismach in actual receive buffer lenth and lenth &n;&t;    indicated to the h/w.&n;&t; 4. Modified amd8111e_rx() routine to receive all the received packets &n;&t;    in the first interrupt.&n;&t; 5. Bug fix: Corrected  rx_errors  reported in get_stats() function.&n;&t;3.0.5 03/22/2004&n;&t; 1. Added NAPI support  &n;&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/if_vlan.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;&t;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#if defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE)
DECL|macro|AMD8111E_VLAN_TAG_USED
mdefine_line|#define AMD8111E_VLAN_TAG_USED 1
macro_line|#else
DECL|macro|AMD8111E_VLAN_TAG_USED
mdefine_line|#define AMD8111E_VLAN_TAG_USED 0
macro_line|#endif
macro_line|#include &quot;amd8111e.h&quot;
DECL|macro|MODULE_NAME
mdefine_line|#define MODULE_NAME&t;&quot;amd8111e&quot;
DECL|macro|MODULE_VERS
mdefine_line|#define MODULE_VERS&t;&quot;3.0.5&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Advanced Micro Devices, Inc.&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;AMD8111 based 10/100 Ethernet Controller. Driver Version 3.0.3&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|speed_duplex
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|speed_duplex
comma
l_string|&quot;Set device speed and duplex modes, 0: Auto Negotitate, 1: 10Mbps Half Duplex, 2: 10Mbps Full Duplex, 3: 100Mbps Half Duplex, 4: 100Mbps Full Duplex&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|coalesce
comma
r_bool
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|coalesce
comma
l_string|&quot;Enable or Disable interrupt coalescing, 1: Enable, 0: Disable&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|dynamic_ipg
comma
r_bool
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dynamic_ipg
comma
l_string|&quot;Enable or Disable dynamic IPG, 1: Enable, 0: Disable&quot;
)paren
suffix:semicolon
DECL|variable|amd8111e_pci_tbl
r_static
r_struct
id|pci_device_id
id|amd8111e_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_AMD
comma
id|PCI_DEVICE_ID_AMD8111E_7462
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* &n;This function will read the PHY registers.&n;*/
DECL|function|amd8111e_read_phy
r_static
r_int
id|amd8111e_read_phy
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
comma
r_int
id|phy_id
comma
r_int
id|reg
comma
id|u32
op_star
id|val
)paren
(brace
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
r_int
id|reg_val
suffix:semicolon
r_int
r_int
id|repeat
op_assign
id|REPEAT_CNT
suffix:semicolon
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
r_while
c_loop
(paren
id|reg_val
op_amp
id|PHY_CMD_ACTIVE
)paren
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
id|writel
c_func
(paren
id|PHY_RD_CMD
op_or
(paren
(paren
id|phy_id
op_amp
l_int|0x1f
)paren
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|reg
op_amp
l_int|0x1f
)paren
op_lshift
l_int|16
)paren
comma
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
r_do
(brace
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* It takes 30 us to read/write data */
)brace
r_while
c_loop
(paren
op_decrement
id|repeat
op_logical_and
(paren
id|reg_val
op_amp
id|PHY_CMD_ACTIVE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_val
op_amp
id|PHY_RD_ERR
)paren
(brace
r_goto
id|err_phy_read
suffix:semicolon
)brace
op_star
id|val
op_assign
id|reg_val
op_amp
l_int|0xffff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_phy_read
suffix:colon
op_star
id|val
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* &n;This function will write into PHY registers. &n;*/
DECL|function|amd8111e_write_phy
r_static
r_int
id|amd8111e_write_phy
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
comma
r_int
id|phy_id
comma
r_int
id|reg
comma
id|u32
id|val
)paren
(brace
r_int
r_int
id|repeat
op_assign
id|REPEAT_CNT
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
r_int
id|reg_val
suffix:semicolon
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
r_while
c_loop
(paren
id|reg_val
op_amp
id|PHY_CMD_ACTIVE
)paren
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
id|writel
c_func
(paren
id|PHY_WR_CMD
op_or
(paren
(paren
id|phy_id
op_amp
l_int|0x1f
)paren
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|reg
op_amp
l_int|0x1f
)paren
op_lshift
l_int|16
)paren
op_or
id|val
comma
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
r_do
(brace
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|PHY_ACCESS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* It takes 30 us to read/write the data */
)brace
r_while
c_loop
(paren
op_decrement
id|repeat
op_logical_and
(paren
id|reg_val
op_amp
id|PHY_CMD_ACTIVE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_val
op_amp
id|PHY_RD_ERR
)paren
(brace
r_goto
id|err_phy_write
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_phy_write
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* &n;This is the mii register read function provided to the mii interface.&n;*/
DECL|function|amd8111e_mdio_read
r_static
r_int
id|amd8111e_mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|reg_num
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|reg_val
suffix:semicolon
id|amd8111e_read_phy
c_func
(paren
id|lp
comma
id|phy_id
comma
id|reg_num
comma
op_amp
id|reg_val
)paren
suffix:semicolon
r_return
id|reg_val
suffix:semicolon
)brace
multiline_comment|/* &n;This is the mii register write function provided to the mii interface.&n;*/
DECL|function|amd8111e_mdio_write
r_static
r_void
id|amd8111e_mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|reg_num
comma
r_int
id|val
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|amd8111e_write_phy
c_func
(paren
id|lp
comma
id|phy_id
comma
id|reg_num
comma
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;This function will set PHY speed. During initialization sets the original speed to 100 full.&n;*/
DECL|function|amd8111e_set_ext_phy
r_static
r_void
id|amd8111e_set_ext_phy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|bmcr
comma
id|advert
comma
id|tmp
suffix:semicolon
multiline_comment|/* Determine mii register values to set the speed */
id|advert
op_assign
id|amd8111e_mdio_read
c_func
(paren
id|dev
comma
id|lp-&gt;ext_phy_addr
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|tmp
op_assign
id|advert
op_amp
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|lp-&gt;ext_phy_option
)paren
(brace
r_default
suffix:colon
r_case
id|SPEED_AUTONEG
suffix:colon
multiline_comment|/* advertise all values */
id|tmp
op_or_assign
(paren
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED10_HALF
suffix:colon
id|tmp
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED10_FULL
suffix:colon
id|tmp
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED100_HALF
suffix:colon
id|tmp
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED100_FULL
suffix:colon
id|tmp
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|advert
op_ne
id|tmp
)paren
(brace
id|amd8111e_mdio_write
c_func
(paren
id|dev
comma
id|lp-&gt;ext_phy_addr
comma
id|MII_ADVERTISE
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* Restart auto negotiation */
id|bmcr
op_assign
id|amd8111e_mdio_read
c_func
(paren
id|dev
comma
id|lp-&gt;ext_phy_addr
comma
id|MII_BMCR
)paren
suffix:semicolon
id|bmcr
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|amd8111e_mdio_write
c_func
(paren
id|dev
comma
id|lp-&gt;ext_phy_addr
comma
id|MII_BMCR
comma
id|bmcr
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;This function will unmap skb-&gt;data space and will free &n;all transmit and receive skbuffs.&n;*/
DECL|function|amd8111e_free_skbs
r_static
r_int
id|amd8111e_free_skbs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|rx_skbuff
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Freeing transmit skbs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;tx_dma_addr
(braket
id|i
)braket
comma
id|lp-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|lp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|lp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;tx_dma_addr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Freeing previously allocated receive buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rx_skbuff
op_assign
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rx_skbuff
op_ne
l_int|NULL
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;rx_dma_addr
(braket
id|i
)braket
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;rx_dma_addr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;This will set the receive buffer length corresponding to the mtu size of networkinterface.&n;*/
DECL|function|amd8111e_set_rx_buff_len
r_static
r_inline
r_void
id|amd8111e_set_rx_buff_len
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|mtu
op_assign
id|dev-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OG
id|ETH_DATA_LEN
)paren
(brace
multiline_comment|/* MTU + ethernet header + FCS&n;&t;&t;+ optional VLAN tag + skb reserve space 2 */
id|lp-&gt;rx_buff_len
op_assign
id|mtu
op_plus
id|ETH_HLEN
op_plus
l_int|10
suffix:semicolon
id|lp-&gt;options
op_or_assign
id|OPTION_JUMBO_ENABLE
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;rx_buff_len
op_assign
id|PKT_BUFF_SZ
suffix:semicolon
id|lp-&gt;options
op_and_assign
op_complement
id|OPTION_JUMBO_ENABLE
suffix:semicolon
)brace
)brace
multiline_comment|/* &n;This function will free all the previously allocated buffers, determine new receive buffer length  and will allocate new receive buffers. This function also allocates and initializes both the transmitter and receive hardware descriptors.&n; */
DECL|function|amd8111e_init_ring
r_static
r_int
id|amd8111e_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|lp-&gt;rx_idx
op_assign
id|lp-&gt;tx_idx
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tx_complete_idx
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tx_ring_idx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;opened
)paren
(brace
multiline_comment|/* Free previously allocated transmit and receive skbs */
id|amd8111e_free_skbs
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* allocate the tx and rx descriptors */
r_if
c_cond
(paren
(paren
id|lp-&gt;tx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_tx_dr
)paren
op_star
id|NUM_TX_RING_DR
comma
op_amp
id|lp-&gt;tx_ring_dma_addr
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|err_no_mem
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_rx_dr
)paren
op_star
id|NUM_RX_RING_DR
comma
op_amp
id|lp-&gt;rx_ring_dma_addr
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_goto
id|err_free_tx_ring
suffix:semicolon
)brace
)brace
multiline_comment|/* Set new receive buff size */
id|amd8111e_set_rx_buff_len
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Allocating receive  skbs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|dev_alloc_skb
c_func
(paren
id|lp-&gt;rx_buff_len
)paren
)paren
)paren
(brace
multiline_comment|/* Release previos allocated skbs */
r_for
c_loop
(paren
op_decrement
id|i
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_goto
id|err_free_rx_ring
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
comma
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* Initilaizing receive descriptors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_BUFFERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;rx_dma_addr
(braket
id|i
)braket
op_assign
id|pci_map_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|data
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buff_phy_addr
op_assign
id|cpu_to_le32
c_func
(paren
id|lp-&gt;rx_dma_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buff_count
op_assign
id|cpu_to_le16
c_func
(paren
id|lp-&gt;rx_buff_len
op_minus
l_int|2
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|i
)braket
dot
id|rx_flags
op_assign
id|cpu_to_le16
c_func
(paren
id|OWN_BIT
)paren
suffix:semicolon
)brace
multiline_comment|/* Initializing transmit descriptors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_RING_DR
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;tx_ring
(braket
id|i
)braket
dot
id|buff_phy_addr
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|i
)braket
dot
id|tx_flags
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|i
)braket
dot
id|buff_count
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_free_rx_ring
suffix:colon
id|pci_free_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_rx_dr
)paren
op_star
id|NUM_RX_RING_DR
comma
id|lp-&gt;rx_ring
comma
id|lp-&gt;rx_ring_dma_addr
)paren
suffix:semicolon
id|err_free_tx_ring
suffix:colon
id|pci_free_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_tx_dr
)paren
op_star
id|NUM_TX_RING_DR
comma
id|lp-&gt;tx_ring
comma
id|lp-&gt;tx_ring_dma_addr
)paren
suffix:semicolon
id|err_no_mem
suffix:colon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* This function will set the interrupt coalescing according to the input arguments */
DECL|function|amd8111e_set_coalesce
r_static
r_int
id|amd8111e_set_coalesce
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_enum
id|coal_mode
id|cmod
)paren
(brace
r_int
r_int
id|timeout
suffix:semicolon
r_int
r_int
id|event_count
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_struct
id|amd8111e_coalesce_conf
op_star
id|coal_conf
op_assign
op_amp
id|lp-&gt;coal_conf
suffix:semicolon
r_switch
c_cond
(paren
id|cmod
)paren
(brace
r_case
id|RX_INTR_COAL
suffix:colon
id|timeout
op_assign
id|coal_conf-&gt;rx_timeout
suffix:semicolon
id|event_count
op_assign
id|coal_conf-&gt;rx_event_count
suffix:semicolon
r_if
c_cond
(paren
id|timeout
OG
id|MAX_TIMEOUT
op_logical_or
id|event_count
OG
id|MAX_EVENT_COUNT
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|timeout
op_assign
id|timeout
op_star
id|DELAY_TIMER_CONV
suffix:semicolon
id|writel
c_func
(paren
id|VAL0
op_or
id|STINTEN
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|DLY_INT_A_R0
op_or
(paren
id|event_count
op_lshift
l_int|16
)paren
op_or
id|timeout
comma
id|mmio
op_plus
id|DLY_INT_A
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX_INTR_COAL
suffix:colon
id|timeout
op_assign
id|coal_conf-&gt;tx_timeout
suffix:semicolon
id|event_count
op_assign
id|coal_conf-&gt;tx_event_count
suffix:semicolon
r_if
c_cond
(paren
id|timeout
OG
id|MAX_TIMEOUT
op_logical_or
id|event_count
OG
id|MAX_EVENT_COUNT
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|timeout
op_assign
id|timeout
op_star
id|DELAY_TIMER_CONV
suffix:semicolon
id|writel
c_func
(paren
id|VAL0
op_or
id|STINTEN
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|DLY_INT_B_T0
op_or
(paren
id|event_count
op_lshift
l_int|16
)paren
op_or
id|timeout
comma
id|mmio
op_plus
id|DLY_INT_B
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISABLE_COAL
suffix:colon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|STVAL
)paren
suffix:semicolon
id|writel
c_func
(paren
id|STINTEN
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|DLY_INT_B
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|DLY_INT_A
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENABLE_COAL
suffix:colon
multiline_comment|/* Start the timer */
id|writel
c_func
(paren
(paren
id|u32
)paren
id|SOFT_TIMER_FREQ
comma
id|mmio
op_plus
id|STVAL
)paren
suffix:semicolon
multiline_comment|/*  0.5 sec */
id|writel
c_func
(paren
id|VAL0
op_or
id|STINTEN
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;This function initializes the device registers  and starts the device.  &n;*/
DECL|function|amd8111e_restart
r_static
r_int
id|amd8111e_restart
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
id|i
comma
id|reg_val
suffix:semicolon
multiline_comment|/* stop the chip */
id|writel
c_func
(paren
id|RUN
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd8111e_init_ring
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* enable the port manager and set auto negotiation always */
id|writel
c_func
(paren
(paren
id|u32
)paren
id|VAL1
op_or
id|EN_PMGR
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|XPHYANE
op_or
id|XPHYRST
comma
id|mmio
op_plus
id|CTRL2
)paren
suffix:semicolon
id|amd8111e_set_ext_phy
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set control registers */
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|CTRL1
)paren
suffix:semicolon
id|reg_val
op_and_assign
op_complement
id|XMTSP_MASK
suffix:semicolon
id|writel
c_func
(paren
id|reg_val
op_or
id|XMTSP_128
op_or
id|CACHE_ALIGN
comma
id|mmio
op_plus
id|CTRL1
)paren
suffix:semicolon
multiline_comment|/* enable interrupt */
id|writel
c_func
(paren
id|APINT5EN
op_or
id|APINT4EN
op_or
id|APINT3EN
op_or
id|APINT2EN
op_or
id|APINT1EN
op_or
id|APINT0EN
op_or
id|MIIPDTINTEN
op_or
id|MCCIINTEN
op_or
id|MCCINTEN
op_or
id|MREINTEN
op_or
id|SPNDINTEN
op_or
id|MPINTEN
op_or
id|SINTEN
op_or
id|STINTEN
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL3
op_or
id|LCINTEN
op_or
id|VAL1
op_or
id|TINTEN0
op_or
id|VAL0
op_or
id|RINTEN0
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
multiline_comment|/* initialize tx and rx ring base addresses */
id|writel
c_func
(paren
(paren
id|u32
)paren
id|lp-&gt;tx_ring_dma_addr
comma
id|mmio
op_plus
id|XMT_RING_BASE_ADDR0
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|lp-&gt;rx_ring_dma_addr
comma
id|mmio
op_plus
id|RCV_RING_BASE_ADDR0
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|u32
)paren
id|NUM_TX_RING_DR
comma
id|mmio
op_plus
id|XMT_RING_LEN0
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|u16
)paren
id|NUM_RX_RING_DR
comma
id|mmio
op_plus
id|RCV_RING_LEN0
)paren
suffix:semicolon
multiline_comment|/* set default IPG to 96 */
id|writew
c_func
(paren
(paren
id|u32
)paren
id|DEFAULT_IPG
comma
id|mmio
op_plus
id|IPG
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|u32
)paren
(paren
id|DEFAULT_IPG
op_minus
id|IFS1_DELTA
)paren
comma
id|mmio
op_plus
id|IFS1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_JUMBO_ENABLE
)paren
(brace
id|writel
c_func
(paren
(paren
id|u32
)paren
id|VAL2
op_or
id|JUMBO
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
multiline_comment|/* Reset REX_UFLO */
id|writel
c_func
(paren
id|REX_UFLO
comma
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
multiline_comment|/* Should not set REX_UFLO for jumbo frames */
id|writel
c_func
(paren
id|VAL0
op_or
id|APAD_XMT
op_or
id|REX_RTRY
comma
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
)brace
r_else
(brace
id|writel
c_func
(paren
id|VAL0
op_or
id|APAD_XMT
op_or
id|REX_RTRY
op_or
id|REX_UFLO
comma
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|JUMBO
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
)brace
macro_line|#if AMD8111E_VLAN_TAG_USED
id|writel
c_func
(paren
(paren
id|u32
)paren
id|VAL2
op_or
id|VSIZE
op_or
id|VL_TAG_DEL
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|VAL0
op_or
id|APAD_XMT
op_or
id|REX_RTRY
comma
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
multiline_comment|/* Setting the MAC address to the device */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writeb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|mmio
op_plus
id|PADR
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable interrupt coalesce */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_INTR_COAL_ENABLE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Interrupt Coalescing Enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|ENABLE_COAL
)paren
suffix:semicolon
)brace
multiline_comment|/* set RUN bit to start the chip */
id|writel
c_func
(paren
id|VAL2
op_or
id|RDMD0
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL0
op_or
id|INTREN
op_or
id|RUN
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* To avoid PCI posting bug */
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;This function clears necessary the device registers. &n;*/
DECL|function|amd8111e_init_hw_default
r_static
r_void
id|amd8111e_init_hw_default
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
r_int
r_int
id|reg_val
suffix:semicolon
r_int
r_int
id|logic_filter
(braket
l_int|2
)braket
op_assign
initialization_block
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
multiline_comment|/* stop the chip */
id|writel
c_func
(paren
id|RUN
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* AUTOPOLL0 Register */
multiline_comment|/*TBD default value is 8100 in FPS */
id|writew
c_func
(paren
l_int|0x8100
op_or
id|lp-&gt;ext_phy_addr
comma
id|mmio
op_plus
id|AUTOPOLL0
)paren
suffix:semicolon
multiline_comment|/* Clear RCV_RING_BASE_ADDR */
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|RCV_RING_BASE_ADDR0
)paren
suffix:semicolon
multiline_comment|/* Clear XMT_RING_BASE_ADDR */
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|XMT_RING_BASE_ADDR0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|XMT_RING_BASE_ADDR1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|XMT_RING_BASE_ADDR2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|mmio
op_plus
id|XMT_RING_BASE_ADDR3
)paren
suffix:semicolon
multiline_comment|/* Clear CMD0  */
id|writel
c_func
(paren
id|CMD0_CLEAR
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* Clear CMD2 */
id|writel
c_func
(paren
id|CMD2_CLEAR
comma
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
multiline_comment|/* Clear CMD7 */
id|writel
c_func
(paren
id|CMD7_CLEAR
comma
id|mmio
op_plus
id|CMD7
)paren
suffix:semicolon
multiline_comment|/* Clear DLY_INT_A and DLY_INT_B */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|DLY_INT_A
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|DLY_INT_B
)paren
suffix:semicolon
multiline_comment|/* Clear FLOW_CONTROL */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|FLOW_CONTROL
)paren
suffix:semicolon
multiline_comment|/* Clear INT0  write 1 to clear register */
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|reg_val
comma
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
multiline_comment|/* Clear STVAL */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|STVAL
)paren
suffix:semicolon
multiline_comment|/* Clear INTEN0 */
id|writel
c_func
(paren
id|INTEN0_CLEAR
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
multiline_comment|/* Clear LADRF */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|LADRF
)paren
suffix:semicolon
multiline_comment|/* Set SRAM_SIZE &amp; SRAM_BOUNDARY registers  */
id|writel
c_func
(paren
l_int|0x80010
comma
id|mmio
op_plus
id|SRAM_SIZE
)paren
suffix:semicolon
multiline_comment|/* Clear RCV_RING0_LEN */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|RCV_RING_LEN0
)paren
suffix:semicolon
multiline_comment|/* Clear XMT_RING0/1/2/3_LEN */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|XMT_RING_LEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|XMT_RING_LEN1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|XMT_RING_LEN2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|XMT_RING_LEN3
)paren
suffix:semicolon
multiline_comment|/* Clear XMT_RING_LIMIT */
id|writel
c_func
(paren
l_int|0x0
comma
id|mmio
op_plus
id|XMT_RING_LIMIT
)paren
suffix:semicolon
multiline_comment|/* Clear MIB */
id|writew
c_func
(paren
id|MIB_CLEAR
comma
id|mmio
op_plus
id|MIB_ADDR
)paren
suffix:semicolon
multiline_comment|/* Clear LARF */
id|amd8111e_writeq
c_func
(paren
op_star
(paren
id|u64
op_star
)paren
id|logic_filter
comma
id|mmio
op_plus
id|LADRF
)paren
suffix:semicolon
multiline_comment|/* SRAM_SIZE register */
id|reg_val
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|SRAM_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_JUMBO_ENABLE
)paren
(brace
id|writel
c_func
(paren
id|VAL2
op_or
id|JUMBO
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
)brace
macro_line|#if AMD8111E_VLAN_TAG_USED
id|writel
c_func
(paren
id|VAL2
op_or
id|VSIZE
op_or
id|VL_TAG_DEL
comma
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Set default value to CTRL1 Register */
id|writel
c_func
(paren
id|CTRL1_DEFAULT
comma
id|mmio
op_plus
id|CTRL1
)paren
suffix:semicolon
multiline_comment|/* To avoid PCI posting bug */
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;This function disables the interrupt and clears all the pending &n;interrupts in INT0&n; */
DECL|function|amd8111e_disable_interrupt
r_static
r_void
id|amd8111e_disable_interrupt
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
id|u32
id|intr0
suffix:semicolon
multiline_comment|/* Disable interrupt */
id|writel
c_func
(paren
id|INTREN
comma
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* Clear INT0 */
id|intr0
op_assign
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|INT0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|intr0
comma
id|lp-&gt;mmio
op_plus
id|INT0
)paren
suffix:semicolon
multiline_comment|/* To avoid PCI posting bug */
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|INT0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;This function stops the chip. &n;*/
DECL|function|amd8111e_stop_chip
r_static
r_void
id|amd8111e_stop_chip
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
id|writel
c_func
(paren
id|RUN
comma
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* To avoid PCI posting bug */
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;This function frees the  transmiter and receiver descriptor rings.&n;*/
DECL|function|amd8111e_free_ring
r_static
r_void
id|amd8111e_free_ring
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
multiline_comment|/* Free transmit and receive skbs */
id|amd8111e_free_skbs
c_func
(paren
id|lp-&gt;amd8111e_net_dev
)paren
suffix:semicolon
multiline_comment|/* Free transmit and receive descriptor rings */
r_if
c_cond
(paren
id|lp-&gt;rx_ring
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_rx_dr
)paren
op_star
id|NUM_RX_RING_DR
comma
id|lp-&gt;rx_ring
comma
id|lp-&gt;rx_ring_dma_addr
)paren
suffix:semicolon
id|lp-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;tx_ring
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|lp-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|amd8111e_tx_dr
)paren
op_star
id|NUM_TX_RING_DR
comma
id|lp-&gt;tx_ring
comma
id|lp-&gt;tx_ring_dma_addr
)paren
suffix:semicolon
id|lp-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
macro_line|#if AMD8111E_VLAN_TAG_USED&t;
multiline_comment|/* &n;This is the receive indication function for packets with vlan tag.&n;*/
DECL|function|amd8111e_vlan_rx
r_static
r_int
id|amd8111e_vlan_rx
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|vlan_tag
)paren
(brace
macro_line|#ifdef CONFIG_AMD8111E_NAPI
r_return
id|vlan_hwaccel_receive_skb
c_func
(paren
id|skb
comma
id|lp-&gt;vlgrp
comma
id|vlan_tag
)paren
suffix:semicolon
macro_line|#else
r_return
id|vlan_hwaccel_rx
c_func
(paren
id|skb
comma
id|lp-&gt;vlgrp
comma
id|vlan_tag
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_AMD8111E_NAPI */
)brace
macro_line|#endif
multiline_comment|/*&n;This function will free all the transmit skbs that are actually transmitted by the device. It will check the ownership of the skb before freeing the skb. &n;*/
DECL|function|amd8111e_tx
r_static
r_int
id|amd8111e_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|tx_index
op_assign
id|lp-&gt;tx_complete_idx
op_amp
id|TX_RING_DR_MOD_MASK
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/* Complete all the transmit packet */
r_while
c_loop
(paren
id|lp-&gt;tx_complete_idx
op_ne
id|lp-&gt;tx_idx
)paren
(brace
id|tx_index
op_assign
id|lp-&gt;tx_complete_idx
op_amp
id|TX_RING_DR_MOD_MASK
suffix:semicolon
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|tx_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|OWN_BIT
)paren
(brace
r_break
suffix:semicolon
)brace
multiline_comment|/* It still hasn&squot;t been Txed */
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|buff_phy_addr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We must free the original skb */
r_if
c_cond
(paren
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;tx_dma_addr
(braket
id|tx_index
)braket
comma
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
(paren
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
)paren
suffix:semicolon
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;tx_dma_addr
(braket
id|tx_index
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|lp-&gt;tx_complete_idx
op_increment
suffix:semicolon
multiline_comment|/*COAL update tx coalescing parameters */
id|lp-&gt;coal_conf.tx_packets
op_increment
suffix:semicolon
id|lp-&gt;coal_conf.tx_bytes
op_add_assign
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|buff_count
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
op_logical_and
id|lp-&gt;tx_complete_idx
OG
id|lp-&gt;tx_idx
op_minus
id|NUM_TX_BUFFERS
op_plus
l_int|2
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tbusy. */
multiline_comment|/* lp-&gt;tx_full = 0; */
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_AMD8111E_NAPI
multiline_comment|/* This function handles the driver receive operation in polling mode */
DECL|function|amd8111e_rx_poll
r_static
r_int
id|amd8111e_rx_poll
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
op_star
id|budget
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|rx_index
op_assign
id|lp-&gt;rx_idx
op_amp
id|RX_RING_DR_MOD_MASK
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|new_skb
suffix:semicolon
r_int
id|min_pkt_len
comma
id|status
suffix:semicolon
r_int
r_int
id|intr0
suffix:semicolon
r_int
id|num_rx_pkt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*int max_rx_pkt = NUM_RX_BUFFERS;*/
r_int
id|pkt_len
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;
r_int
id|vtag
suffix:semicolon
macro_line|#endif
r_int
id|rx_pkt_limit
op_assign
id|dev-&gt;quota
suffix:semicolon
r_do
(brace
multiline_comment|/* process receive packets until we use the quota*/
multiline_comment|/* If we own the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|OWN_BIT
)paren
r_break
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * There is a tricky error noted by John Murphy,&n;&t;&t;&t; * &lt;murf@perftech.com&gt; to Russ Nelson: Even with&n;&t;&t;&t; * full-sized * buffers it&squot;s possible for a  &n;&t;&t;&t; * jabber packet to use two buffers, with only &n;&t;&t;&t; * the last correctly noting the error.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|status
op_amp
id|ERR_BIT
)paren
(brace
multiline_comment|/* reseting flags */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
multiline_comment|/* check for STP and ENP */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|status
op_amp
id|STP_BIT
)paren
op_logical_and
(paren
id|status
op_amp
id|ENP_BIT
)paren
)paren
)paren
(brace
multiline_comment|/* reseting flags */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
id|pkt_len
op_assign
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|msg_count
)paren
op_minus
l_int|4
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;
id|vtag
op_assign
id|status
op_amp
id|TT_MASK
suffix:semicolon
multiline_comment|/*MAC will strip vlan tag*/
r_if
c_cond
(paren
id|lp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
id|vtag
op_ne
l_int|0
)paren
(brace
id|min_pkt_len
op_assign
id|MIN_PKT_LEN
op_minus
l_int|4
suffix:semicolon
)brace
r_else
macro_line|#endif
id|min_pkt_len
op_assign
id|MIN_PKT_LEN
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OL
id|min_pkt_len
)paren
(brace
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
id|lp-&gt;drv_rx_errors
op_increment
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|rx_pkt_limit
OL
l_int|0
)paren
(brace
r_goto
id|rx_not_empty
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|lp-&gt;rx_buff_len
)paren
)paren
)paren
(brace
multiline_comment|/* if allocation fail, &n;&t;&t;&t;&t;   ignore that pkt and go to next one */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
id|lp-&gt;drv_rx_errors
op_increment
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|new_skb
comma
l_int|2
)paren
suffix:semicolon
id|skb
op_assign
id|lp-&gt;rx_skbuff
(braket
id|rx_index
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;rx_skbuff
(braket
id|rx_index
)braket
op_assign
id|new_skb
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
op_assign
id|pci_map_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|new_skb-&gt;data
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;
r_if
c_cond
(paren
id|lp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
(paren
id|vtag
op_eq
id|TT_VLAN_TAGGED
)paren
)paren
(brace
id|amd8111e_vlan_rx
c_func
(paren
id|lp
comma
id|skb
comma
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|tag_ctrl_info
)paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|netif_receive_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/*COAL update rx coalescing parameters*/
id|lp-&gt;coal_conf.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;coal_conf.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|num_rx_pkt
op_increment
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|err_next_pkt
suffix:colon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|buff_phy_addr
op_assign
id|cpu_to_le32
c_func
(paren
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|buff_count
op_assign
id|cpu_to_le16
c_func
(paren
id|lp-&gt;rx_buff_len
op_minus
l_int|2
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_or_assign
id|cpu_to_le16
c_func
(paren
id|OWN_BIT
)paren
suffix:semicolon
id|rx_index
op_assign
(paren
op_increment
id|lp-&gt;rx_idx
)paren
op_amp
id|RX_RING_DR_MOD_MASK
suffix:semicolon
)brace
multiline_comment|/* Check the interrupt status register for more packets in the &n;&t;&t;   mean time. Process them since we have not used up our quota.*/
id|intr0
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
multiline_comment|/*Ack receive packets */
id|writel
c_func
(paren
id|intr0
op_amp
id|RINT0
comma
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|intr0
op_amp
id|RINT0
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* Receive descriptor is empty now */
id|dev-&gt;quota
op_sub_assign
id|num_rx_pkt
suffix:semicolon
op_star
id|budget
op_sub_assign
id|num_rx_pkt
suffix:semicolon
id|netif_rx_complete
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* enable receive interrupt */
id|writel
c_func
(paren
id|VAL0
op_or
id|RINTEN0
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL2
op_or
id|RDMD0
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|rx_not_empty
suffix:colon
multiline_comment|/* Do not call a netif_rx_complete */
id|dev-&gt;quota
op_sub_assign
id|num_rx_pkt
suffix:semicolon
op_star
id|budget
op_sub_assign
id|num_rx_pkt
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#else
multiline_comment|/* &n;This function will check the ownership of receive buffers and descriptors. It will indicate to kernel up to half the number of maximum receive buffers in the descriptor ring, in a single receive interrupt. It will also replenish the descriptors with new skbs.&n;*/
DECL|function|amd8111e_rx
r_static
r_int
id|amd8111e_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|new_skb
suffix:semicolon
r_int
id|rx_index
op_assign
id|lp-&gt;rx_idx
op_amp
id|RX_RING_DR_MOD_MASK
suffix:semicolon
r_int
id|min_pkt_len
comma
id|status
suffix:semicolon
r_int
id|num_rx_pkt
op_assign
l_int|0
suffix:semicolon
r_int
id|max_rx_pkt
op_assign
id|NUM_RX_BUFFERS
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;
r_int
id|vtag
suffix:semicolon
macro_line|#endif
multiline_comment|/* If we own the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
op_increment
id|num_rx_pkt
op_le
id|max_rx_pkt
)paren
(brace
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|OWN_BIT
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check if err summary bit is set */
r_if
c_cond
(paren
id|status
op_amp
id|ERR_BIT
)paren
(brace
multiline_comment|/* &n;&t;&t;&t; * There is a tricky error noted by John Murphy,&n;&t;&t;&t; * &lt;murf@perftech.com&gt; to Russ Nelson: Even with full-sized&n;&t;&t;&t; * buffers it&squot;s possible for a jabber packet to use two&n;&t;&t;&t; * buffers, with only the last correctly noting the error.&t;&t;&t; */
multiline_comment|/* reseting flags */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
multiline_comment|/* check for STP and ENP */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|status
op_amp
id|STP_BIT
)paren
op_logical_and
(paren
id|status
op_amp
id|ENP_BIT
)paren
)paren
)paren
(brace
multiline_comment|/* reseting flags */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
id|pkt_len
op_assign
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|msg_count
)paren
op_minus
l_int|4
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;
id|vtag
op_assign
id|status
op_amp
id|TT_MASK
suffix:semicolon
multiline_comment|/*MAC will strip vlan tag*/
r_if
c_cond
(paren
id|lp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
id|vtag
op_ne
l_int|0
)paren
(brace
id|min_pkt_len
op_assign
id|MIN_PKT_LEN
op_minus
l_int|4
suffix:semicolon
)brace
r_else
macro_line|#endif
id|min_pkt_len
op_assign
id|MIN_PKT_LEN
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OL
id|min_pkt_len
)paren
(brace
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
id|lp-&gt;drv_rx_errors
op_increment
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|lp-&gt;rx_buff_len
)paren
)paren
)paren
(brace
multiline_comment|/* if allocation fail, &n;&t;&t;&t;&t;ignore that pkt and go to next one */
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_and_assign
id|RESET_RX_FLAGS
suffix:semicolon
id|lp-&gt;drv_rx_errors
op_increment
suffix:semicolon
r_goto
id|err_next_pkt
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|new_skb
comma
l_int|2
)paren
suffix:semicolon
id|skb
op_assign
id|lp-&gt;rx_skbuff
(braket
id|rx_index
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;rx_skbuff
(braket
id|rx_index
)braket
op_assign
id|new_skb
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
op_assign
id|pci_map_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|new_skb-&gt;data
comma
id|lp-&gt;rx_buff_len
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED&t;&t;&t;&t;
r_if
c_cond
(paren
id|lp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
(paren
id|vtag
op_eq
id|TT_VLAN_TAGGED
)paren
)paren
(brace
id|amd8111e_vlan_rx
c_func
(paren
id|lp
comma
id|skb
comma
id|le16_to_cpu
c_func
(paren
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|tag_ctrl_info
)paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|netif_rx
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/*COAL update rx coalescing parameters*/
id|lp-&gt;coal_conf.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;coal_conf.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|err_next_pkt
suffix:colon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|buff_phy_addr
op_assign
id|cpu_to_le32
c_func
(paren
id|lp-&gt;rx_dma_addr
(braket
id|rx_index
)braket
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|buff_count
op_assign
id|cpu_to_le16
c_func
(paren
id|lp-&gt;rx_buff_len
op_minus
l_int|2
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;rx_ring
(braket
id|rx_index
)braket
dot
id|rx_flags
op_or_assign
id|cpu_to_le16
c_func
(paren
id|OWN_BIT
)paren
suffix:semicolon
id|rx_index
op_assign
(paren
op_increment
id|lp-&gt;rx_idx
)paren
op_amp
id|RX_RING_DR_MOD_MASK
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMD8111E_NAPI */
multiline_comment|/* &n;This function will indicate the link status to the kernel.&n;*/
DECL|function|amd8111e_link_change
r_static
r_int
id|amd8111e_link_change
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|status0
comma
id|speed
suffix:semicolon
multiline_comment|/* read the link change */
id|status0
op_assign
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|STAT0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status0
op_amp
id|LINK_STATS
)paren
(brace
r_if
c_cond
(paren
id|status0
op_amp
id|AUTONEG_COMPLETE
)paren
(brace
id|lp-&gt;link_config.autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
)brace
r_else
id|lp-&gt;link_config.autoneg
op_assign
id|AUTONEG_DISABLE
suffix:semicolon
r_if
c_cond
(paren
id|status0
op_amp
id|FULL_DPLX
)paren
(brace
id|lp-&gt;link_config.duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
)brace
r_else
id|lp-&gt;link_config.duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|speed
op_assign
(paren
id|status0
op_amp
id|SPEED_MASK
)paren
op_rshift
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|speed
op_eq
id|PHY_SPEED_10
)paren
(brace
id|lp-&gt;link_config.speed
op_assign
id|SPEED_10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|speed
op_eq
id|PHY_SPEED_100
)paren
(brace
id|lp-&gt;link_config.speed
op_assign
id|SPEED_100
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Link is Up. Speed is %s Mbps %s Duplex&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|lp-&gt;link_config.speed
op_eq
id|SPEED_100
)paren
ques
c_cond
l_string|&quot;100&quot;
suffix:colon
l_string|&quot;10&quot;
comma
(paren
id|lp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
ques
c_cond
l_string|&quot;Full&quot;
suffix:colon
l_string|&quot;Half&quot;
)paren
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;link_config.speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|lp-&gt;link_config.duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
id|lp-&gt;link_config.autoneg
op_assign
id|AUTONEG_INVALID
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Link is Down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;This function reads the mib counters. &t; &n;*/
DECL|function|amd8111e_read_mib
r_static
r_int
id|amd8111e_read_mib
c_func
(paren
r_void
id|__iomem
op_star
id|mmio
comma
id|u8
id|MIB_COUNTER
)paren
(brace
r_int
r_int
id|status
suffix:semicolon
r_int
r_int
id|data
suffix:semicolon
r_int
r_int
id|repeat
op_assign
id|REPEAT_CNT
suffix:semicolon
id|writew
c_func
(paren
id|MIB_RD_CMD
op_or
id|MIB_COUNTER
comma
id|mmio
op_plus
id|MIB_ADDR
)paren
suffix:semicolon
r_do
(brace
id|status
op_assign
id|readw
c_func
(paren
id|mmio
op_plus
id|MIB_ADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
multiline_comment|/* controller takes MAX 2 us to get mib data */
)brace
r_while
c_loop
(paren
op_decrement
id|repeat
op_logical_and
(paren
id|status
op_amp
id|MIB_CMD_ACTIVE
)paren
)paren
suffix:semicolon
id|data
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|MIB_DATA
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
multiline_comment|/*&n;This function reads the mib registers and returns the hardware statistics. It  updates previous internal driver statistics with new values.&n;*/
DECL|function|amd8111e_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|amd8111e_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* struct net_device_stats *prev_stats = &amp;lp-&gt;prev_stats; */
r_struct
id|net_device_stats
op_star
id|new_stats
op_assign
op_amp
id|lp-&gt;stats
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;opened
)paren
(brace
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
id|spin_lock_irqsave
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* stats.rx_packets */
id|new_stats-&gt;rx_packets
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_broadcast_pkts
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_multicast_pkts
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_unicast_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.tx_packets */
id|new_stats-&gt;tx_packets
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_packets
)paren
suffix:semicolon
multiline_comment|/*stats.rx_bytes */
id|new_stats-&gt;rx_bytes
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_octets
)paren
suffix:semicolon
multiline_comment|/* stats.tx_bytes */
id|new_stats-&gt;tx_bytes
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_octets
)paren
suffix:semicolon
multiline_comment|/* stats.rx_errors */
multiline_comment|/* hw errors + errors driver reported */
id|new_stats-&gt;rx_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_undersize_pkts
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_fragments
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_jabbers
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_alignment_errors
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_fcs_errors
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_miss_pkts
)paren
op_plus
id|lp-&gt;drv_rx_errors
suffix:semicolon
multiline_comment|/* stats.tx_errors */
id|new_stats-&gt;tx_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_underrun_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.rx_dropped*/
id|new_stats-&gt;rx_dropped
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_miss_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.tx_dropped*/
id|new_stats-&gt;tx_dropped
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_underrun_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.multicast*/
id|new_stats-&gt;multicast
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_multicast_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.collisions*/
id|new_stats-&gt;collisions
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_collisions
)paren
suffix:semicolon
multiline_comment|/* stats.rx_length_errors*/
id|new_stats-&gt;rx_length_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_undersize_pkts
)paren
op_plus
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_oversize_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.rx_over_errors*/
id|new_stats-&gt;rx_over_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_miss_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.rx_crc_errors*/
id|new_stats-&gt;rx_crc_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_fcs_errors
)paren
suffix:semicolon
multiline_comment|/* stats.rx_frame_errors*/
id|new_stats-&gt;rx_frame_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_alignment_errors
)paren
suffix:semicolon
multiline_comment|/* stats.rx_fifo_errors */
id|new_stats-&gt;rx_fifo_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_miss_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.rx_missed_errors */
id|new_stats-&gt;rx_missed_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|rcv_miss_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.tx_aborted_errors*/
id|new_stats-&gt;tx_aborted_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_excessive_collision
)paren
suffix:semicolon
multiline_comment|/* stats.tx_carrier_errors*/
id|new_stats-&gt;tx_carrier_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_loss_carrier
)paren
suffix:semicolon
multiline_comment|/* stats.tx_fifo_errors*/
id|new_stats-&gt;tx_fifo_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_underrun_pkts
)paren
suffix:semicolon
multiline_comment|/* stats.tx_window_errors*/
id|new_stats-&gt;tx_window_errors
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_late_collision
)paren
suffix:semicolon
multiline_comment|/* Reset the mibs for collecting new statistics */
multiline_comment|/* writew(MIB_CLEAR, mmio + MIB_ADDR);*/
id|spin_unlock_irqrestore
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|new_stats
suffix:semicolon
)brace
multiline_comment|/* This function recalculate the interupt coalescing  mode on every interrupt &n;according to the datarate and the packet rate.&n;*/
DECL|function|amd8111e_calc_coalesce
r_static
r_int
id|amd8111e_calc_coalesce
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|amd8111e_coalesce_conf
op_star
id|coal_conf
op_assign
op_amp
id|lp-&gt;coal_conf
suffix:semicolon
r_int
id|tx_pkt_rate
suffix:semicolon
r_int
id|rx_pkt_rate
suffix:semicolon
r_int
id|tx_data_rate
suffix:semicolon
r_int
id|rx_data_rate
suffix:semicolon
r_int
id|rx_pkt_size
suffix:semicolon
r_int
id|tx_pkt_size
suffix:semicolon
id|tx_pkt_rate
op_assign
id|coal_conf-&gt;tx_packets
op_minus
id|coal_conf-&gt;tx_prev_packets
suffix:semicolon
id|coal_conf-&gt;tx_prev_packets
op_assign
id|coal_conf-&gt;tx_packets
suffix:semicolon
id|tx_data_rate
op_assign
id|coal_conf-&gt;tx_bytes
op_minus
id|coal_conf-&gt;tx_prev_bytes
suffix:semicolon
id|coal_conf-&gt;tx_prev_bytes
op_assign
id|coal_conf-&gt;tx_bytes
suffix:semicolon
id|rx_pkt_rate
op_assign
id|coal_conf-&gt;rx_packets
op_minus
id|coal_conf-&gt;rx_prev_packets
suffix:semicolon
id|coal_conf-&gt;rx_prev_packets
op_assign
id|coal_conf-&gt;rx_packets
suffix:semicolon
id|rx_data_rate
op_assign
id|coal_conf-&gt;rx_bytes
op_minus
id|coal_conf-&gt;rx_prev_bytes
suffix:semicolon
id|coal_conf-&gt;rx_prev_bytes
op_assign
id|coal_conf-&gt;rx_bytes
suffix:semicolon
r_if
c_cond
(paren
id|rx_pkt_rate
OL
l_int|800
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;rx_coal_type
op_ne
id|NO_COALESCE
)paren
(brace
id|coal_conf-&gt;rx_timeout
op_assign
l_int|0x0
suffix:semicolon
id|coal_conf-&gt;rx_event_count
op_assign
l_int|0
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|RX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;rx_coal_type
op_assign
id|NO_COALESCE
suffix:semicolon
)brace
)brace
r_else
(brace
id|rx_pkt_size
op_assign
id|rx_data_rate
op_div
id|rx_pkt_rate
suffix:semicolon
r_if
c_cond
(paren
id|rx_pkt_size
OL
l_int|128
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;rx_coal_type
op_ne
id|NO_COALESCE
)paren
(brace
id|coal_conf-&gt;rx_timeout
op_assign
l_int|0
suffix:semicolon
id|coal_conf-&gt;rx_event_count
op_assign
l_int|0
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|RX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;rx_coal_type
op_assign
id|NO_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|rx_pkt_size
op_ge
l_int|128
)paren
op_logical_and
(paren
id|rx_pkt_size
OL
l_int|512
)paren
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;rx_coal_type
op_ne
id|LOW_COALESCE
)paren
(brace
id|coal_conf-&gt;rx_timeout
op_assign
l_int|1
suffix:semicolon
id|coal_conf-&gt;rx_event_count
op_assign
l_int|4
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|RX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;rx_coal_type
op_assign
id|LOW_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|rx_pkt_size
op_ge
l_int|512
)paren
op_logical_and
(paren
id|rx_pkt_size
OL
l_int|1024
)paren
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;rx_coal_type
op_ne
id|MEDIUM_COALESCE
)paren
(brace
id|coal_conf-&gt;rx_timeout
op_assign
l_int|1
suffix:semicolon
id|coal_conf-&gt;rx_event_count
op_assign
l_int|4
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|RX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;rx_coal_type
op_assign
id|MEDIUM_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|rx_pkt_size
op_ge
l_int|1024
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;rx_coal_type
op_ne
id|HIGH_COALESCE
)paren
(brace
id|coal_conf-&gt;rx_timeout
op_assign
l_int|2
suffix:semicolon
id|coal_conf-&gt;rx_event_count
op_assign
l_int|3
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|RX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;rx_coal_type
op_assign
id|HIGH_COALESCE
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* NOW FOR TX INTR COALESC */
r_if
c_cond
(paren
id|tx_pkt_rate
OL
l_int|800
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;tx_coal_type
op_ne
id|NO_COALESCE
)paren
(brace
id|coal_conf-&gt;tx_timeout
op_assign
l_int|0x0
suffix:semicolon
id|coal_conf-&gt;tx_event_count
op_assign
l_int|0
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|TX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;tx_coal_type
op_assign
id|NO_COALESCE
suffix:semicolon
)brace
)brace
r_else
(brace
id|tx_pkt_size
op_assign
id|tx_data_rate
op_div
id|tx_pkt_rate
suffix:semicolon
r_if
c_cond
(paren
id|tx_pkt_size
OL
l_int|128
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;tx_coal_type
op_ne
id|NO_COALESCE
)paren
(brace
id|coal_conf-&gt;tx_timeout
op_assign
l_int|0
suffix:semicolon
id|coal_conf-&gt;tx_event_count
op_assign
l_int|0
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|TX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;tx_coal_type
op_assign
id|NO_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|tx_pkt_size
op_ge
l_int|128
)paren
op_logical_and
(paren
id|tx_pkt_size
OL
l_int|512
)paren
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;tx_coal_type
op_ne
id|LOW_COALESCE
)paren
(brace
id|coal_conf-&gt;tx_timeout
op_assign
l_int|1
suffix:semicolon
id|coal_conf-&gt;tx_event_count
op_assign
l_int|2
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|TX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;tx_coal_type
op_assign
id|LOW_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|tx_pkt_size
op_ge
l_int|512
)paren
op_logical_and
(paren
id|tx_pkt_size
OL
l_int|1024
)paren
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;tx_coal_type
op_ne
id|MEDIUM_COALESCE
)paren
(brace
id|coal_conf-&gt;tx_timeout
op_assign
l_int|2
suffix:semicolon
id|coal_conf-&gt;tx_event_count
op_assign
l_int|5
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|TX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;tx_coal_type
op_assign
id|MEDIUM_COALESCE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|tx_pkt_size
op_ge
l_int|1024
)paren
(brace
r_if
c_cond
(paren
id|tx_pkt_size
op_ge
l_int|1024
)paren
(brace
r_if
c_cond
(paren
id|coal_conf-&gt;tx_coal_type
op_ne
id|HIGH_COALESCE
)paren
(brace
id|coal_conf-&gt;tx_timeout
op_assign
l_int|4
suffix:semicolon
id|coal_conf-&gt;tx_event_count
op_assign
l_int|8
suffix:semicolon
id|amd8111e_set_coalesce
c_func
(paren
id|dev
comma
id|TX_INTR_COAL
)paren
suffix:semicolon
id|coal_conf-&gt;tx_coal_type
op_assign
id|HIGH_COALESCE
suffix:semicolon
)brace
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;This is device interrupt function. It handles transmit, receive,link change and hardware timer interrupts.&n;*/
DECL|function|amd8111e_interrupt
r_static
id|irqreturn_t
id|amd8111e_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
r_int
id|intr0
suffix:semicolon
r_int
r_int
id|handled
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|regs
)paren
id|spin_lock
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* disabling interrupt */
id|writel
c_func
(paren
id|INTREN
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
multiline_comment|/* Read interrupt status */
id|intr0
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
multiline_comment|/* Process all the INT event until INTR bit is clear. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|intr0
op_amp
id|INTR
)paren
)paren
(brace
id|handled
op_assign
l_int|0
suffix:semicolon
r_goto
id|err_no_interrupt
suffix:semicolon
)brace
multiline_comment|/* Current driver processes 4 interrupts : RINT,TINT,LCINT,STINT */
id|writel
c_func
(paren
id|intr0
comma
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
multiline_comment|/* Check if Receive Interrupt has occurred. */
macro_line|#if CONFIG_AMD8111E_NAPI
r_if
c_cond
(paren
id|intr0
op_amp
id|RINT0
)paren
(brace
r_if
c_cond
(paren
id|netif_rx_schedule_prep
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* Disable receive interupts */
id|writel
c_func
(paren
id|RINTEN0
comma
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
multiline_comment|/* Schedule a polling routine */
id|__netif_rx_schedule
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;************Driver bug! &bslash;&n;&t;&t;&t;&t;interrupt while in poll&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Fix by disabling interrupts */
id|writel
c_func
(paren
id|RINT0
comma
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
r_if
c_cond
(paren
id|intr0
op_amp
id|RINT0
)paren
(brace
id|amd8111e_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL2
op_or
id|RDMD0
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_AMD8111E_NAPI */
multiline_comment|/* Check if  Transmit Interrupt has occurred. */
r_if
c_cond
(paren
id|intr0
op_amp
id|TINT0
)paren
(brace
id|amd8111e_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Check if  Link Change Interrupt has occurred. */
r_if
c_cond
(paren
id|intr0
op_amp
id|LCINT
)paren
id|amd8111e_link_change
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Check if Hardware Timer Interrupt has occurred. */
r_if
c_cond
(paren
id|intr0
op_amp
id|STINT
)paren
id|amd8111e_calc_coalesce
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_no_interrupt
suffix:colon
id|writel
c_func
(paren
id|VAL0
op_or
id|INTREN
comma
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs
)paren
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
DECL|function|amd8111e_poll
r_static
r_void
id|amd8111e_poll
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|local_save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|amd8111e_interrupt
c_func
(paren
l_int|0
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;This function closes the network interface and updates the statistics so that most recent statistics will be available after the interface is down.&n;*/
DECL|function|amd8111e_close
r_static
r_int
id|amd8111e_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|amd8111e_disable_interrupt
c_func
(paren
id|lp
)paren
suffix:semicolon
id|amd8111e_stop_chip
c_func
(paren
id|lp
)paren
suffix:semicolon
id|amd8111e_free_ring
c_func
(paren
id|lp
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|lp-&gt;amd8111e_net_dev
)paren
suffix:semicolon
multiline_comment|/* Delete ipg timer */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_DYN_IPG_ENABLE
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Update the statistics before closing */
id|amd8111e_get_stats
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;opened
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* This function opens new interface.It requests irq for the device, initializes the device,buffers and descriptors, and starts the device. &n;*/
DECL|function|amd8111e_open
r_static
r_int
id|amd8111e_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
l_int|0
op_logical_or
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|amd8111e_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|amd8111e_init_hw_default
c_func
(paren
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd8111e_restart
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Start ipg timer */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_DYN_IPG_ENABLE
)paren
(brace
id|add_timer
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Dynamic IPG Enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|lp-&gt;opened
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;This function checks if there is any transmit  descriptors available to queue more packet.&n;*/
DECL|function|amd8111e_tx_queue_avail
r_static
r_int
id|amd8111e_tx_queue_avail
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
r_int
id|tx_index
op_assign
id|lp-&gt;tx_idx
op_amp
id|TX_BUFF_MOD_MASK
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
op_ne
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;This function will queue the transmit packets to the descriptors and will trigger the send operation. It also initializes the transmit descriptors with buffer physical address, byte count, ownership to hardware etc.&n;*/
DECL|function|amd8111e_start_xmit
r_static
r_int
id|amd8111e_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|tx_index
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tx_index
op_assign
id|lp-&gt;tx_idx
op_amp
id|TX_RING_DR_MOD_MASK
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|buff_count
op_assign
id|cpu_to_le16
c_func
(paren
id|skb-&gt;len
)paren
suffix:semicolon
id|lp-&gt;tx_skbuff
(braket
id|tx_index
)braket
op_assign
id|skb
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|tx_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED
r_if
c_cond
(paren
(paren
id|lp-&gt;vlgrp
op_ne
l_int|NULL
)paren
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
(brace
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|tag_ctrl_cmd
op_or_assign
id|cpu_to_le16
c_func
(paren
id|TCC_VLAN_INSERT
)paren
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|tag_ctrl_info
op_assign
id|cpu_to_le16
c_func
(paren
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|lp-&gt;tx_dma_addr
(braket
id|tx_index
)braket
op_assign
id|pci_map_single
c_func
(paren
id|lp-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|buff_phy_addr
op_assign
(paren
id|u32
)paren
id|cpu_to_le32
c_func
(paren
id|lp-&gt;tx_dma_addr
(braket
id|tx_index
)braket
)paren
suffix:semicolon
multiline_comment|/*  Set FCS and LTINT bits */
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;tx_ring
(braket
id|tx_index
)braket
dot
id|tx_flags
op_or_assign
id|cpu_to_le16
c_func
(paren
id|OWN_BIT
op_or
id|STP_BIT
op_or
id|ENP_BIT
op_or
id|ADD_FCS_BIT
op_or
id|LTINT_BIT
)paren
suffix:semicolon
id|lp-&gt;tx_idx
op_increment
suffix:semicolon
multiline_comment|/* Trigger an immediate send poll. */
id|writel
c_func
(paren
id|VAL1
op_or
id|TDMD0
comma
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL2
op_or
id|RDMD0
comma
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|amd8111e_tx_queue_avail
c_func
(paren
id|lp
)paren
OL
l_int|0
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;This function returns all the memory mapped registers of the device.&n;*/
DECL|function|amd8111e_read_regs
r_static
r_void
id|amd8111e_read_regs
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
comma
id|u32
op_star
id|buf
)paren
(brace
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
multiline_comment|/* Read only necessary registers */
id|buf
(braket
l_int|0
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|XMT_RING_BASE_ADDR0
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|XMT_RING_LEN0
)paren
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|RCV_RING_BASE_ADDR0
)paren
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|RCV_RING_LEN0
)paren
suffix:semicolon
id|buf
(braket
l_int|4
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD0
)paren
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD2
)paren
suffix:semicolon
id|buf
(braket
l_int|6
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD3
)paren
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|CMD7
)paren
suffix:semicolon
id|buf
(braket
l_int|8
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|INT0
)paren
suffix:semicolon
id|buf
(braket
l_int|9
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|INTEN0
)paren
suffix:semicolon
id|buf
(braket
l_int|10
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|LADRF
)paren
suffix:semicolon
id|buf
(braket
l_int|11
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|LADRF
op_plus
l_int|4
)paren
suffix:semicolon
id|buf
(braket
l_int|12
)braket
op_assign
id|readl
c_func
(paren
id|mmio
op_plus
id|STAT0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;amd8111e crc generator implementation is different from the kernel&n;ether_crc() function.&n;*/
DECL|function|amd8111e_ether_crc
r_int
id|amd8111e_ether_crc
c_func
(paren
r_int
id|len
comma
r_char
op_star
id|mac_addr
)paren
(brace
r_int
id|i
comma
id|byte
suffix:semicolon
r_int
r_char
id|octet
suffix:semicolon
id|u32
id|crc
op_assign
id|INITCRC
suffix:semicolon
r_for
c_loop
(paren
id|byte
op_assign
l_int|0
suffix:semicolon
id|byte
OL
id|len
suffix:semicolon
id|byte
op_increment
)paren
(brace
id|octet
op_assign
id|mac_addr
(braket
id|byte
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/*If the next bit form the input stream is 1,subtract&t;&t;&t;&t; the divisor (CRC32) from the dividend(crc).*/
r_if
c_cond
(paren
(paren
id|octet
op_amp
l_int|0x1
)paren
op_xor
(paren
id|crc
op_amp
l_int|0x1
)paren
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|CRC32
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|octet
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
multiline_comment|/*&n;This function sets promiscuos mode, all-multi mode or the multicast address &n;list to the device.&n;*/
DECL|function|amd8111e_set_multicast_list
r_static
r_void
id|amd8111e_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|mc_ptr
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|i
comma
id|bit_num
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Setting  promiscuous mode.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL2
op_or
id|PROM
comma
id|lp-&gt;mmio
op_plus
id|CMD2
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|writel
c_func
(paren
id|PROM
comma
id|lp-&gt;mmio
op_plus
id|CMD2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
op_logical_or
id|dev-&gt;mc_count
OG
id|MAX_FILTER_SIZE
)paren
(brace
multiline_comment|/* get all multicast packet */
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
id|lp-&gt;mc_list
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|lp-&gt;options
op_or_assign
id|OPTION_MULTICAST_ENABLE
suffix:semicolon
id|amd8111e_writeq
c_func
(paren
op_star
(paren
id|u64
op_star
)paren
id|mc_filter
comma
id|lp-&gt;mmio
op_plus
id|LADRF
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_eq
l_int|0
)paren
(brace
multiline_comment|/* get only own packets */
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;mc_list
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;options
op_and_assign
op_complement
id|OPTION_MULTICAST_ENABLE
suffix:semicolon
id|amd8111e_writeq
c_func
(paren
op_star
(paren
id|u64
op_star
)paren
id|mc_filter
comma
id|lp-&gt;mmio
op_plus
id|LADRF
)paren
suffix:semicolon
multiline_comment|/* disable promiscous mode */
id|writel
c_func
(paren
id|PROM
comma
id|lp-&gt;mmio
op_plus
id|CMD2
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* load all the multicast addresses in the logic filter */
id|lp-&gt;options
op_or_assign
id|OPTION_MULTICAST_ENABLE
suffix:semicolon
id|lp-&gt;mc_list
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mc_ptr
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mc_ptr
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mc_ptr
op_assign
id|mc_ptr-&gt;next
)paren
(brace
id|bit_num
op_assign
(paren
id|amd8111e_ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mc_ptr-&gt;dmi_addr
)paren
op_rshift
l_int|26
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|mc_filter
(braket
id|bit_num
op_rshift
l_int|5
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|bit_num
op_amp
l_int|31
)paren
suffix:semicolon
)brace
id|amd8111e_writeq
c_func
(paren
op_star
(paren
id|u64
op_star
)paren
id|mc_filter
comma
id|lp-&gt;mmio
op_plus
id|LADRF
)paren
suffix:semicolon
multiline_comment|/* To eliminate PCI posting bug */
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|CMD2
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_get_drvinfo
r_static
r_void
id|amd8111e_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
id|lp-&gt;pci_dev
suffix:semicolon
id|strcpy
(paren
id|info-&gt;driver
comma
id|MODULE_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info-&gt;version
comma
id|MODULE_VERS
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|info-&gt;fw_version
comma
l_string|&quot;%u&quot;
comma
id|chip_version
)paren
suffix:semicolon
id|strcpy
(paren
id|info-&gt;bus_info
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_get_regs_len
r_static
r_int
id|amd8111e_get_regs_len
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|AMD8111E_REG_DUMP_LEN
suffix:semicolon
)brace
DECL|function|amd8111e_get_regs
r_static
r_void
id|amd8111e_get_regs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_regs
op_star
id|regs
comma
r_void
op_star
id|buf
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|regs-&gt;version
op_assign
l_int|0
suffix:semicolon
id|amd8111e_read_regs
c_func
(paren
id|lp
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_get_settings
r_static
r_int
id|amd8111e_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|mii_ethtool_gset
c_func
(paren
op_amp
id|lp-&gt;mii_if
comma
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amd8111e_set_settings
r_static
r_int
id|amd8111e_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|res
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|res
op_assign
id|mii_ethtool_sset
c_func
(paren
op_amp
id|lp-&gt;mii_if
comma
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|amd8111e_nway_reset
r_static
r_int
id|amd8111e_nway_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|mii_nway_restart
c_func
(paren
op_amp
id|lp-&gt;mii_if
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_get_link
r_static
id|u32
id|amd8111e_get_link
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|mii_link_ok
c_func
(paren
op_amp
id|lp-&gt;mii_if
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_get_wol
r_static
r_void
id|amd8111e_get_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wol_info
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wol_info-&gt;supported
op_assign
id|WAKE_MAGIC
op_or
id|WAKE_PHY
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_WOL_ENABLE
)paren
id|wol_info-&gt;wolopts
op_assign
id|WAKE_MAGIC
suffix:semicolon
)brace
DECL|function|amd8111e_set_wol
r_static
r_int
id|amd8111e_set_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wol_info
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wol_info-&gt;wolopts
op_amp
op_complement
(paren
id|WAKE_MAGIC
op_or
id|WAKE_PHY
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wol_info-&gt;wolopts
op_amp
id|WAKE_MAGIC
)paren
id|lp-&gt;options
op_or_assign
(paren
id|OPTION_WOL_ENABLE
op_or
id|OPTION_WAKE_MAGIC_ENABLE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|wol_info-&gt;wolopts
op_amp
id|WAKE_PHY
)paren
(brace
id|lp-&gt;options
op_or_assign
(paren
id|OPTION_WOL_ENABLE
op_or
id|OPTION_WAKE_PHY_ENABLE
)paren
suffix:semicolon
)brace
r_else
id|lp-&gt;options
op_and_assign
op_complement
id|OPTION_WOL_ENABLE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ops
r_static
r_struct
id|ethtool_ops
id|ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|amd8111e_get_drvinfo
comma
dot
id|get_regs_len
op_assign
id|amd8111e_get_regs_len
comma
dot
id|get_regs
op_assign
id|amd8111e_get_regs
comma
dot
id|get_settings
op_assign
id|amd8111e_get_settings
comma
dot
id|set_settings
op_assign
id|amd8111e_set_settings
comma
dot
id|nway_reset
op_assign
id|amd8111e_nway_reset
comma
dot
id|get_link
op_assign
id|amd8111e_get_link
comma
dot
id|get_wol
op_assign
id|amd8111e_get_wol
comma
dot
id|set_wol
op_assign
id|amd8111e_set_wol
comma
)brace
suffix:semicolon
multiline_comment|/*&n;This function handles all the  ethtool ioctls. It gives driver info, gets/sets driver speed, gets memory mapped register values, forces auto negotiation, sets/gets WOL options for ethtool application. &n;*/
DECL|function|amd8111e_ioctl
r_static
r_int
id|amd8111e_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
id|if_mii
c_func
(paren
id|ifr
)paren
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|u32
id|mii_regval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGMIIPHY
suffix:colon
id|data-&gt;phy_id
op_assign
id|lp-&gt;ext_phy_addr
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|SIOCGMIIREG
suffix:colon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|amd8111e_read_phy
c_func
(paren
id|lp
comma
id|data-&gt;phy_id
comma
id|data-&gt;reg_num
op_amp
id|PHY_REG_ADDR_MASK
comma
op_amp
id|mii_regval
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|data-&gt;val_out
op_assign
id|mii_regval
suffix:semicolon
r_return
id|err
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|amd8111e_write_phy
c_func
(paren
id|lp
comma
id|data-&gt;phy_id
comma
id|data-&gt;reg_num
op_amp
id|PHY_REG_ADDR_MASK
comma
id|data-&gt;val_in
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|amd8111e_set_mac_address
r_static
r_int
id|amd8111e_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Setting the MAC address to the device */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writeb
c_func
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|lp-&gt;mmio
op_plus
id|PADR
op_plus
id|i
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;This function changes the mtu of the device. It restarts the device  to initialize the descriptor with new receive buffers.&n;*/
DECL|function|amd8111e_change_mtu
r_int
id|amd8111e_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
OL
id|AMD8111E_MIN_MTU
)paren
op_logical_or
(paren
id|new_mtu
OG
id|AMD8111E_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* new_mtu will be used&n;&t;&t;   when device starts netxt time */
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* stop the chip */
id|writel
c_func
(paren
id|RUN
comma
id|lp-&gt;mmio
op_plus
id|CMD0
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|err
op_assign
id|amd8111e_restart
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#if AMD8111E_VLAN_TAG_USED
DECL|function|amd8111e_vlan_rx_register
r_static
r_void
id|amd8111e_vlan_rx_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|vlan_group
op_star
id|grp
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|lp-&gt;vlgrp
op_assign
id|grp
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_vlan_rx_kill_vid
r_static
r_void
id|amd8111e_vlan_rx_kill_vid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;vlgrp
)paren
id|lp-&gt;vlgrp-&gt;vlan_devices
(braket
id|vid
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|amd8111e_enable_magicpkt
r_static
r_int
id|amd8111e_enable_magicpkt
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
id|writel
c_func
(paren
id|VAL1
op_or
id|MPPLBA
comma
id|lp-&gt;mmio
op_plus
id|CMD3
)paren
suffix:semicolon
id|writel
c_func
(paren
id|VAL0
op_or
id|MPEN_SW
comma
id|lp-&gt;mmio
op_plus
id|CMD7
)paren
suffix:semicolon
multiline_comment|/* To eliminate PCI posting bug */
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|CMD7
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amd8111e_enable_link_change
r_static
r_int
id|amd8111e_enable_link_change
c_func
(paren
r_struct
id|amd8111e_priv
op_star
id|lp
)paren
(brace
multiline_comment|/* Adapter is already stoped/suspended/interrupt-disabled */
id|writel
c_func
(paren
id|VAL0
op_or
id|LCMODE_SW
comma
id|lp-&gt;mmio
op_plus
id|CMD7
)paren
suffix:semicolon
multiline_comment|/* To eliminate PCI posting bug */
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|CMD7
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* This function is called when a packet transmission fails to complete within a  resonable period, on the assumption that an interrupts have been failed or the  interface is locked up. This function will reinitialize the hardware */
DECL|function|amd8111e_tx_timeout
r_static
r_void
id|amd8111e_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: transmit timed out, resetting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|amd8111e_restart
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|amd8111e_suspend
r_static
r_int
id|amd8111e_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* disable the interrupt */
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|amd8111e_disable_interrupt
c_func
(paren
id|lp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* stop chip */
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_DYN_IPG_ENABLE
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
)paren
suffix:semicolon
)brace
id|amd8111e_stop_chip
c_func
(paren
id|lp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_WOL_ENABLE
)paren
(brace
multiline_comment|/* enable wol */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_WAKE_MAGIC_ENABLE
)paren
(brace
id|amd8111e_enable_magicpkt
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_WAKE_PHY_ENABLE
)paren
(brace
id|amd8111e_enable_link_change
c_func
(paren
id|lp
)paren
suffix:semicolon
)brace
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|3
comma
l_int|1
)paren
suffix:semicolon
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* D3 cold */
)brace
r_else
(brace
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* 4 == D3 cold */
)brace
id|pci_save_state
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|pci_dev
comma
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amd8111e_resume
r_static
r_int
id|amd8111e_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|pci_restore_state
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|pci_enable_wake
c_func
(paren
id|pci_dev
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* D3 cold */
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|amd8111e_restart
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Restart ipg timer */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_DYN_IPG_ENABLE
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
comma
id|jiffies
op_plus
id|IPG_CONVERGE_JIFFIES
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amd8111e_remove_one
r_static
r_void
id|__devexit
id|amd8111e_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
(paren
r_struct
id|amd8111e_priv
op_star
)paren
id|netdev_priv
c_func
(paren
id|dev
)paren
)paren
op_member_access_from_pointer
id|mmio
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
DECL|function|amd8111e_config_ipg
r_static
r_void
id|amd8111e_config_ipg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|ipg_info
op_star
id|ipg_data
op_assign
op_amp
id|lp-&gt;ipg_data
suffix:semicolon
r_void
id|__iomem
op_star
id|mmio
op_assign
id|lp-&gt;mmio
suffix:semicolon
r_int
r_int
id|prev_col_cnt
op_assign
id|ipg_data-&gt;col_cnt
suffix:semicolon
r_int
r_int
id|total_col_cnt
suffix:semicolon
r_int
r_int
id|tmp_ipg
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
(brace
id|ipg_data-&gt;ipg
op_assign
id|DEFAULT_IPG
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipg_data-&gt;ipg_state
op_eq
id|SSTATE
)paren
(brace
r_if
c_cond
(paren
id|ipg_data-&gt;timer_tick
op_eq
id|IPG_STABLE_TIME
)paren
(brace
id|ipg_data-&gt;timer_tick
op_assign
l_int|0
suffix:semicolon
id|ipg_data-&gt;ipg
op_assign
id|MIN_IPG
op_minus
id|IPG_STEP
suffix:semicolon
id|ipg_data-&gt;current_ipg
op_assign
id|MIN_IPG
suffix:semicolon
id|ipg_data-&gt;diff_col_cnt
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|ipg_data-&gt;ipg_state
op_assign
id|CSTATE
suffix:semicolon
)brace
r_else
id|ipg_data-&gt;timer_tick
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ipg_data-&gt;ipg_state
op_eq
id|CSTATE
)paren
(brace
multiline_comment|/* Get the current collision count */
id|total_col_cnt
op_assign
id|ipg_data-&gt;col_cnt
op_assign
id|amd8111e_read_mib
c_func
(paren
id|mmio
comma
id|xmt_collisions
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|total_col_cnt
op_minus
id|prev_col_cnt
)paren
OL
(paren
id|ipg_data-&gt;diff_col_cnt
)paren
)paren
(brace
id|ipg_data-&gt;diff_col_cnt
op_assign
id|total_col_cnt
op_minus
id|prev_col_cnt
suffix:semicolon
id|ipg_data-&gt;ipg
op_assign
id|ipg_data-&gt;current_ipg
suffix:semicolon
)brace
id|ipg_data-&gt;current_ipg
op_add_assign
id|IPG_STEP
suffix:semicolon
r_if
c_cond
(paren
id|ipg_data-&gt;current_ipg
op_le
id|MAX_IPG
)paren
id|tmp_ipg
op_assign
id|ipg_data-&gt;current_ipg
suffix:semicolon
r_else
(brace
id|tmp_ipg
op_assign
id|ipg_data-&gt;ipg
suffix:semicolon
id|ipg_data-&gt;ipg_state
op_assign
id|SSTATE
suffix:semicolon
)brace
id|writew
c_func
(paren
(paren
id|u32
)paren
id|tmp_ipg
comma
id|mmio
op_plus
id|IPG
)paren
suffix:semicolon
id|writew
c_func
(paren
(paren
id|u32
)paren
(paren
id|tmp_ipg
op_minus
id|IFS1_DELTA
)paren
comma
id|mmio
op_plus
id|IFS1
)paren
suffix:semicolon
)brace
id|mod_timer
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
comma
id|jiffies
op_plus
id|IPG_CONVERGE_JIFFIES
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|amd8111e_probe_ext_phy
r_static
r_void
id|__devinit
id|amd8111e_probe_ext_phy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|amd8111e_priv
op_star
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x1e
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|u32
id|id1
comma
id|id2
suffix:semicolon
r_if
c_cond
(paren
id|amd8111e_read_phy
c_func
(paren
id|lp
comma
id|i
comma
id|MII_PHYSID1
comma
op_amp
id|id1
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|amd8111e_read_phy
c_func
(paren
id|lp
comma
id|i
comma
id|MII_PHYSID2
comma
op_amp
id|id2
)paren
)paren
r_continue
suffix:semicolon
id|lp-&gt;ext_phy_id
op_assign
(paren
id|id1
op_lshift
l_int|16
)paren
op_or
id|id2
suffix:semicolon
id|lp-&gt;ext_phy_addr
op_assign
id|i
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lp-&gt;ext_phy_id
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;ext_phy_addr
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|amd8111e_probe_one
r_static
r_int
id|__devinit
id|amd8111e_probe_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
id|err
comma
id|i
comma
id|pm_cap
suffix:semicolon
r_int
r_int
id|reg_addr
comma
id|reg_len
suffix:semicolon
r_struct
id|amd8111e_priv
op_star
id|lp
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Cannot enable new PCI device,&quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Cannot find PCI base address&quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_disable_pdev
suffix:semicolon
)brace
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|MODULE_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Cannot obtain PCI resources, &quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_disable_pdev
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* Find power-management capability. */
r_if
c_cond
(paren
(paren
id|pm_cap
op_assign
id|pci_find_capability
c_func
(paren
id|pdev
comma
id|PCI_CAP_ID_PM
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: No Power Management capability, &quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_free_reg
suffix:semicolon
)brace
multiline_comment|/* Initialize DMA */
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pdev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: DMA not supported,&quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_free_reg
suffix:semicolon
)brace
r_else
id|pdev-&gt;dma_mask
op_assign
l_int|0xffffffff
suffix:semicolon
id|reg_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|reg_len
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|amd8111e_priv
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Etherdev alloc failed, exiting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_free_reg
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
macro_line|#if AMD8111E_VLAN_TAG_USED
id|dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
id|dev-&gt;vlan_rx_register
op_assign
id|amd8111e_vlan_rx_register
suffix:semicolon
id|dev-&gt;vlan_rx_kill_vid
op_assign
id|amd8111e_vlan_rx_kill_vid
suffix:semicolon
macro_line|#endif&t;
id|lp
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|lp-&gt;amd8111e_net_dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;pm_cap
op_assign
id|pm_cap
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|lp-&gt;mmio
op_assign
id|ioremap
c_func
(paren
id|reg_addr
comma
id|reg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;mmio
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Cannot map device registers, &quot;
l_string|&quot;exiting&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_free_dev
suffix:semicolon
)brace
multiline_comment|/* Initializing MAC address */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETH_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
id|lp-&gt;mmio
op_plus
id|PADR
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Setting user defined parametrs */
id|lp-&gt;ext_phy_option
op_assign
id|speed_duplex
(braket
id|card_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|coalesce
(braket
id|card_idx
)braket
)paren
(brace
id|lp-&gt;options
op_or_assign
id|OPTION_INTR_COAL_ENABLE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dynamic_ipg
(braket
id|card_idx
op_increment
)braket
)paren
(brace
id|lp-&gt;options
op_or_assign
id|OPTION_DYN_IPG_ENABLE
suffix:semicolon
)brace
multiline_comment|/* Initialize driver entry points */
id|dev-&gt;open
op_assign
id|amd8111e_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|amd8111e_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
id|amd8111e_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|amd8111e_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|amd8111e_set_multicast_list
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|amd8111e_set_mac_address
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|amd8111e_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|amd8111e_change_mtu
suffix:semicolon
id|SET_ETHTOOL_OPS
c_func
(paren
id|dev
comma
op_amp
id|ops
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|amd8111e_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|AMD8111E_TX_TIMEOUT
suffix:semicolon
macro_line|#ifdef CONFIG_AMD8111E_NAPI
id|dev-&gt;poll
op_assign
id|amd8111e_rx_poll
suffix:semicolon
id|dev-&gt;weight
op_assign
l_int|32
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
id|dev-&gt;poll_controller
op_assign
id|amd8111e_poll
suffix:semicolon
macro_line|#endif
macro_line|#if AMD8111E_VLAN_TAG_USED
id|dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
id|dev-&gt;vlan_rx_register
op_assign
id|amd8111e_vlan_rx_register
suffix:semicolon
id|dev-&gt;vlan_rx_kill_vid
op_assign
id|amd8111e_vlan_rx_kill_vid
suffix:semicolon
macro_line|#endif&t;
multiline_comment|/* Probe the external PHY */
id|amd8111e_probe_ext_phy
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* setting mii default values */
id|lp-&gt;mii_if.dev
op_assign
id|dev
suffix:semicolon
id|lp-&gt;mii_if.mdio_read
op_assign
id|amd8111e_mdio_read
suffix:semicolon
id|lp-&gt;mii_if.mdio_write
op_assign
id|amd8111e_mdio_write
suffix:semicolon
id|lp-&gt;mii_if.phy_id
op_assign
id|lp-&gt;ext_phy_addr
suffix:semicolon
multiline_comment|/* Set receive buffer length and set jumbo option*/
id|amd8111e_set_rx_buff_len
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;amd8111e: Cannot register net device, &quot;
l_string|&quot;exiting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_iounmap
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Initialize software ipg timer */
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPTION_DYN_IPG_ENABLE
)paren
(brace
id|init_timer
c_func
(paren
op_amp
id|lp-&gt;ipg_data.ipg_timer
)paren
suffix:semicolon
id|lp-&gt;ipg_data.ipg_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|lp-&gt;ipg_data.ipg_timer.function
op_assign
(paren
r_void
op_star
)paren
op_amp
id|amd8111e_config_ipg
suffix:semicolon
id|lp-&gt;ipg_data.ipg_timer.expires
op_assign
id|jiffies
op_plus
id|IPG_CONVERGE_JIFFIES
suffix:semicolon
id|lp-&gt;ipg_data.ipg
op_assign
id|DEFAULT_IPG
suffix:semicolon
id|lp-&gt;ipg_data.ipg_state
op_assign
id|CSTATE
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*  display driver and device information */
id|chip_version
op_assign
(paren
id|readl
c_func
(paren
id|lp-&gt;mmio
op_plus
id|CHIPID
)paren
op_amp
l_int|0xf0000000
)paren
op_rshift
l_int|28
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: AMD-8111e Driver Version: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|MODULE_VERS
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: [ Rev %x ] PCI 10/100BaseT Ethernet &quot;
comma
id|dev-&gt;name
comma
id|chip_version
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x%c&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;ext_phy_id
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Found MII PHY ID 0x%08x at address 0x%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;ext_phy_id
comma
id|lp-&gt;ext_phy_addr
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Couldn&squot;t detect MII PHY, assuming address 0x01&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_iounmap
suffix:colon
id|iounmap
c_func
(paren
id|lp-&gt;mmio
)paren
suffix:semicolon
id|err_free_dev
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_free_reg
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_disable_pdev
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|amd8111e_driver
r_static
r_struct
id|pci_driver
id|amd8111e_driver
op_assign
(brace
dot
id|name
op_assign
id|MODULE_NAME
comma
dot
id|id_table
op_assign
id|amd8111e_pci_tbl
comma
dot
id|probe
op_assign
id|amd8111e_probe_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|amd8111e_remove_one
)paren
comma
dot
id|suspend
op_assign
id|amd8111e_suspend
comma
dot
id|resume
op_assign
id|amd8111e_resume
)brace
suffix:semicolon
DECL|function|amd8111e_init
r_static
r_int
id|__init
id|amd8111e_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|amd8111e_driver
)paren
suffix:semicolon
)brace
DECL|function|amd8111e_cleanup
r_static
r_void
id|__exit
id|amd8111e_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|amd8111e_driver
)paren
suffix:semicolon
)brace
DECL|variable|amd8111e_init
id|module_init
c_func
(paren
id|amd8111e_init
)paren
suffix:semicolon
DECL|variable|amd8111e_cleanup
id|module_exit
c_func
(paren
id|amd8111e_cleanup
)paren
suffix:semicolon
eof
