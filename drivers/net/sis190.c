multiline_comment|/* SiS190.c: A Linux PCI Ethernet driver for the SiS190 chips. */
multiline_comment|/*&n;=========================================================================&n; SiS190.c: A SiS190 Gigabit Ethernet driver for Linux kernel 2.6.x.&n; --------------------------------------------------------------------&n;&n;&t;drivers/net/SiS190.c&n;&n;&t;Maintained by K.M. Liu &lt;kmliu@sis.com&gt;&n;&n;        Modified from the driver which is originally written by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n; History:&n;=========================================================================&n; VERSION 1.0&t;&lt;2003/8/7&gt; K.M. Liu, Test 100bps Full in 2.6.0 O.K.&n;         1.1    &lt;2003/8/8&gt; K.M. Liu, Add mode detection.&n;&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|SiS190_VERSION
mdefine_line|#define SiS190_VERSION &quot;1.1&quot;
DECL|macro|MODULENAME
mdefine_line|#define MODULENAME &quot;SiS190&quot;
DECL|macro|SiS190_DRIVER_NAME
mdefine_line|#define SiS190_DRIVER_NAME   MODULENAME &quot; Gigabit Ethernet driver &quot; SiS190_VERSION
DECL|macro|PFX
mdefine_line|#define PFX MODULENAME &quot;: &quot;
macro_line|#ifdef SiS190_DEBUG
DECL|macro|assert
mdefine_line|#define assert(expr) &bslash;&n;        if(unlikely(!(expr))) {&t;&t;&t;&t;&t;&bslash;&n;&t;        printk( &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&t;&bslash;&n;        &t;#expr,__FILE__,__FUNCTION__,__LINE__);&t;&t;&bslash;&n;        }
macro_line|#else
DECL|macro|assert
mdefine_line|#define assert(expr) do {} while (0)
macro_line|#endif
multiline_comment|/* media options */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast).&n;   The chips use a 64 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* MAC address length*/
DECL|macro|MAC_ADDR_LEN
mdefine_line|#define MAC_ADDR_LEN&t;6
multiline_comment|/* max supported gigabit ethernet frame size -- must be at least (dev-&gt;mtu+14+4).*/
DECL|macro|MAX_ETH_FRAME_SIZE
mdefine_line|#define MAX_ETH_FRAME_SIZE&t;1536
DECL|macro|TX_FIFO_THRESH
mdefine_line|#define TX_FIFO_THRESH 256&t;/* In bytes */
DECL|macro|RX_FIFO_THRESH
mdefine_line|#define RX_FIFO_THRESH&t;7&t;/* 7 means NO threshold, Rx buffer level before first PCI xfer.  */
DECL|macro|RX_DMA_BURST
mdefine_line|#define RX_DMA_BURST&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|TX_DMA_BURST
mdefine_line|#define TX_DMA_BURST&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|EarlyTxThld
mdefine_line|#define EarlyTxThld &t;0x3F&t;/* 0x3F means NO early transmit */
DECL|macro|RxPacketMaxSize
mdefine_line|#define RxPacketMaxSize&t;0x0800&t;/* Maximum size supported is 16K-1 */
DECL|macro|InterFrameGap
mdefine_line|#define InterFrameGap&t;0x03&t;/* 3 means InterFrameGap = the shortest one */
DECL|macro|NUM_TX_DESC
mdefine_line|#define NUM_TX_DESC&t;64&t;/* Number of Tx descriptor registers */
DECL|macro|NUM_RX_DESC
mdefine_line|#define NUM_RX_DESC&t;64&t;/* Number of Rx descriptor registers */
DECL|macro|TX_DESC_TOTAL_SIZE
mdefine_line|#define TX_DESC_TOTAL_SIZE&t;(NUM_TX_DESC * sizeof (struct TxDesc))
DECL|macro|RX_DESC_TOTAL_SIZE
mdefine_line|#define RX_DESC_TOTAL_SIZE&t;(NUM_RX_DESC * sizeof (struct RxDesc))
DECL|macro|RX_BUF_SIZE
mdefine_line|#define RX_BUF_SIZE&t;1536&t;/* Rx Buffer size */
DECL|macro|SiS190_MIN_IO_SIZE
mdefine_line|#define SiS190_MIN_IO_SIZE 0x80
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (6*HZ)
multiline_comment|/* enhanced PHY access register bit definitions */
DECL|macro|EhnMIIread
mdefine_line|#define EhnMIIread      0x0000
DECL|macro|EhnMIIwrite
mdefine_line|#define EhnMIIwrite     0x0020
DECL|macro|EhnMIIdataShift
mdefine_line|#define EhnMIIdataShift 16
DECL|macro|EhnMIIpmdShift
mdefine_line|#define EhnMIIpmdShift  6&t;/* 7016 only */
DECL|macro|EhnMIIregShift
mdefine_line|#define EhnMIIregShift  11
DECL|macro|EhnMIIreq
mdefine_line|#define EhnMIIreq       0x0010
DECL|macro|EhnMIInotDone
mdefine_line|#define EhnMIInotDone   0x0010
singleline_comment|//-------------------------------------------------------------------------
singleline_comment|// Bit Mask definitions
singleline_comment|//-------------------------------------------------------------------------
DECL|macro|BIT_0
mdefine_line|#define BIT_0&t;0x0001
DECL|macro|BIT_1
mdefine_line|#define BIT_1&t;0x0002
DECL|macro|BIT_2
mdefine_line|#define BIT_2&t;0x0004
DECL|macro|BIT_3
mdefine_line|#define BIT_3&t;0x0008
DECL|macro|BIT_4
mdefine_line|#define BIT_4&t;0x0010
DECL|macro|BIT_5
mdefine_line|#define BIT_5&t;0x0020
DECL|macro|BIT_6
mdefine_line|#define BIT_6&t;0x0040
DECL|macro|BIT_7
mdefine_line|#define BIT_7&t;0x0080
DECL|macro|BIT_8
mdefine_line|#define BIT_8&t;0x0100
DECL|macro|BIT_9
mdefine_line|#define BIT_9&t;0x0200
DECL|macro|BIT_10
mdefine_line|#define BIT_10&t;0x0400
DECL|macro|BIT_11
mdefine_line|#define BIT_11&t;0x0800
DECL|macro|BIT_12
mdefine_line|#define BIT_12&t;0x1000
DECL|macro|BIT_13
mdefine_line|#define BIT_13&t;0x2000
DECL|macro|BIT_14
mdefine_line|#define BIT_14&t;0x4000
DECL|macro|BIT_15
mdefine_line|#define BIT_15&t;0x8000
DECL|macro|BIT_16
mdefine_line|#define BIT_16&t;0x10000
DECL|macro|BIT_17
mdefine_line|#define BIT_17&t;0x20000
DECL|macro|BIT_18
mdefine_line|#define BIT_18&t;0x40000
DECL|macro|BIT_19
mdefine_line|#define BIT_19&t;0x80000
DECL|macro|BIT_20
mdefine_line|#define BIT_20&t;0x100000
DECL|macro|BIT_21
mdefine_line|#define BIT_21&t;0x200000
DECL|macro|BIT_22
mdefine_line|#define BIT_22&t;0x400000
DECL|macro|BIT_23
mdefine_line|#define BIT_23&t;0x800000
DECL|macro|BIT_24
mdefine_line|#define BIT_24&t;0x1000000
DECL|macro|BIT_25
mdefine_line|#define BIT_25&t;0x2000000
DECL|macro|BIT_26
mdefine_line|#define BIT_26&t;0x04000000
DECL|macro|BIT_27
mdefine_line|#define BIT_27&t;0x08000000
DECL|macro|BIT_28
mdefine_line|#define BIT_28&t;0x10000000
DECL|macro|BIT_29
mdefine_line|#define BIT_29&t;0x20000000
DECL|macro|BIT_30
mdefine_line|#define BIT_30&t;0x40000000
DECL|macro|BIT_31
mdefine_line|#define BIT_31&t;0x80000000
multiline_comment|/* write/read MMIO register */
DECL|macro|SiS_W8
mdefine_line|#define SiS_W8(reg, val8)&t;writeb ((val8), ioaddr + (reg))
DECL|macro|SiS_W16
mdefine_line|#define SiS_W16(reg, val16)&t;writew ((val16), ioaddr + (reg))
DECL|macro|SiS_W32
mdefine_line|#define SiS_W32(reg, val32)&t;writel ((val32), ioaddr + (reg))
DECL|macro|SiS_R8
mdefine_line|#define SiS_R8(reg)&t;&t;readb (ioaddr + (reg))
DECL|macro|SiS_R16
mdefine_line|#define SiS_R16(reg)&t;&t;readw (ioaddr + (reg))
DECL|macro|SiS_R32
mdefine_line|#define SiS_R32(reg)&t;&t;((unsigned long) readl (ioaddr + (reg)))
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|board_info
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;SiS190 Gigabit Ethernet&quot;
)brace
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|sis190_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1039
comma
l_int|0x0190
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|sis190_pci_tbl
)paren
suffix:semicolon
DECL|enum|SiS190_registers
r_enum
id|SiS190_registers
(brace
DECL|enumerator|TxControl
id|TxControl
op_assign
l_int|0x0
comma
DECL|enumerator|TxDescStartAddr
id|TxDescStartAddr
op_assign
l_int|0x4
comma
DECL|enumerator|TxNextDescAddr
id|TxNextDescAddr
op_assign
l_int|0x0c
comma
DECL|enumerator|RxControl
id|RxControl
op_assign
l_int|0x10
comma
DECL|enumerator|RxDescStartAddr
id|RxDescStartAddr
op_assign
l_int|0x14
comma
DECL|enumerator|RxNextDescAddr
id|RxNextDescAddr
op_assign
l_int|0x1c
comma
DECL|enumerator|IntrStatus
id|IntrStatus
op_assign
l_int|0x20
comma
DECL|enumerator|IntrMask
id|IntrMask
op_assign
l_int|0x24
comma
DECL|enumerator|IntrControl
id|IntrControl
op_assign
l_int|0x28
comma
DECL|enumerator|IntrTimer
id|IntrTimer
op_assign
l_int|0x2c
comma
DECL|enumerator|PMControl
id|PMControl
op_assign
l_int|0x30
comma
DECL|enumerator|ROMControl
id|ROMControl
op_assign
l_int|0x38
comma
DECL|enumerator|ROMInterface
id|ROMInterface
op_assign
l_int|0x3c
comma
DECL|enumerator|StationControl
id|StationControl
op_assign
l_int|0x40
comma
DECL|enumerator|GMIIControl
id|GMIIControl
op_assign
l_int|0x44
comma
DECL|enumerator|TxMacControl
id|TxMacControl
op_assign
l_int|0x50
comma
DECL|enumerator|RxMacControl
id|RxMacControl
op_assign
l_int|0x60
comma
DECL|enumerator|RxMacAddr
id|RxMacAddr
op_assign
l_int|0x62
comma
DECL|enumerator|RxHashTable
id|RxHashTable
op_assign
l_int|0x68
comma
DECL|enumerator|RxWakeOnLan
id|RxWakeOnLan
op_assign
l_int|0x70
comma
DECL|enumerator|RxMPSControl
id|RxMPSControl
op_assign
l_int|0x78
comma
)brace
suffix:semicolon
DECL|enum|sis190_register_content
r_enum
id|sis190_register_content
(brace
multiline_comment|/*InterruptStatusBits */
DECL|enumerator|SoftInt
id|SoftInt
op_assign
l_int|0x40000000
comma
DECL|enumerator|Timeup
id|Timeup
op_assign
l_int|0x20000000
comma
DECL|enumerator|PauseFrame
id|PauseFrame
op_assign
l_int|0x80000
comma
DECL|enumerator|MagicPacket
id|MagicPacket
op_assign
l_int|0x40000
comma
DECL|enumerator|WakeupFrame
id|WakeupFrame
op_assign
l_int|0x20000
comma
DECL|enumerator|LinkChange
id|LinkChange
op_assign
l_int|0x10000
comma
DECL|enumerator|RxQEmpty
id|RxQEmpty
op_assign
l_int|0x80
comma
DECL|enumerator|RxQInt
id|RxQInt
op_assign
l_int|0x40
comma
DECL|enumerator|TxQ1Empty
id|TxQ1Empty
op_assign
l_int|0x20
comma
DECL|enumerator|TxQ1Int
id|TxQ1Int
op_assign
l_int|0x10
comma
DECL|enumerator|TxQ0Empty
id|TxQ0Empty
op_assign
l_int|0x08
comma
DECL|enumerator|TxQ0Int
id|TxQ0Int
op_assign
l_int|0x04
comma
DECL|enumerator|RxHalt
id|RxHalt
op_assign
l_int|0x02
comma
DECL|enumerator|TxHalt
id|TxHalt
op_assign
l_int|0x01
comma
multiline_comment|/*RxStatusDesc */
DECL|enumerator|RxRES
id|RxRES
op_assign
l_int|0x00200000
comma
DECL|enumerator|RxCRC
id|RxCRC
op_assign
l_int|0x00080000
comma
DECL|enumerator|RxRUNT
id|RxRUNT
op_assign
l_int|0x00100000
comma
DECL|enumerator|RxRWT
id|RxRWT
op_assign
l_int|0x00400000
comma
multiline_comment|/*ChipCmdBits */
DECL|enumerator|CmdReset
id|CmdReset
op_assign
l_int|0x10
comma
DECL|enumerator|CmdRxEnb
id|CmdRxEnb
op_assign
l_int|0x08
comma
DECL|enumerator|CmdTxEnb
id|CmdTxEnb
op_assign
l_int|0x01
comma
DECL|enumerator|RxBufEmpty
id|RxBufEmpty
op_assign
l_int|0x01
comma
multiline_comment|/*Cfg9346Bits */
DECL|enumerator|Cfg9346_Lock
id|Cfg9346_Lock
op_assign
l_int|0x00
comma
DECL|enumerator|Cfg9346_Unlock
id|Cfg9346_Unlock
op_assign
l_int|0xC0
comma
multiline_comment|/*rx_mode_bits */
DECL|enumerator|AcceptErr
id|AcceptErr
op_assign
l_int|0x20
comma
DECL|enumerator|AcceptRunt
id|AcceptRunt
op_assign
l_int|0x10
comma
DECL|enumerator|AcceptBroadcast
id|AcceptBroadcast
op_assign
l_int|0x0800
comma
DECL|enumerator|AcceptMulticast
id|AcceptMulticast
op_assign
l_int|0x0400
comma
DECL|enumerator|AcceptMyPhys
id|AcceptMyPhys
op_assign
l_int|0x0200
comma
DECL|enumerator|AcceptAllPhys
id|AcceptAllPhys
op_assign
l_int|0x0100
comma
multiline_comment|/*RxConfigBits */
DECL|enumerator|RxCfgFIFOShift
id|RxCfgFIFOShift
op_assign
l_int|13
comma
DECL|enumerator|RxCfgDMAShift
id|RxCfgDMAShift
op_assign
l_int|8
comma
multiline_comment|/*TxConfigBits */
DECL|enumerator|TxInterFrameGapShift
id|TxInterFrameGapShift
op_assign
l_int|24
comma
DECL|enumerator|TxDMAShift
id|TxDMAShift
op_assign
l_int|8
comma
multiline_comment|/* DMA burst value (0-7) is shift this many bits */
multiline_comment|/*_PHYstatus */
DECL|enumerator|TBI_Enable
id|TBI_Enable
op_assign
l_int|0x80
comma
DECL|enumerator|TxFlowCtrl
id|TxFlowCtrl
op_assign
l_int|0x40
comma
DECL|enumerator|RxFlowCtrl
id|RxFlowCtrl
op_assign
l_int|0x20
comma
DECL|enumerator|_1000bpsF
id|_1000bpsF
op_assign
l_int|0x1c
comma
DECL|enumerator|_1000bpsH
id|_1000bpsH
op_assign
l_int|0x0c
comma
DECL|enumerator|_100bpsF
id|_100bpsF
op_assign
l_int|0x18
comma
DECL|enumerator|_100bpsH
id|_100bpsH
op_assign
l_int|0x08
comma
DECL|enumerator|_10bpsF
id|_10bpsF
op_assign
l_int|0x14
comma
DECL|enumerator|_10bpsH
id|_10bpsH
op_assign
l_int|0x04
comma
DECL|enumerator|LinkStatus
id|LinkStatus
op_assign
l_int|0x02
comma
DECL|enumerator|FullDup
id|FullDup
op_assign
l_int|0x01
comma
multiline_comment|/*GIGABIT_PHY_registers */
DECL|enumerator|PHY_CTRL_REG
id|PHY_CTRL_REG
op_assign
l_int|0
comma
DECL|enumerator|PHY_STAT_REG
id|PHY_STAT_REG
op_assign
l_int|1
comma
DECL|enumerator|PHY_AUTO_NEGO_REG
id|PHY_AUTO_NEGO_REG
op_assign
l_int|4
comma
DECL|enumerator|PHY_1000_CTRL_REG
id|PHY_1000_CTRL_REG
op_assign
l_int|9
comma
multiline_comment|/*GIGABIT_PHY_REG_BIT */
DECL|enumerator|PHY_Restart_Auto_Nego
id|PHY_Restart_Auto_Nego
op_assign
l_int|0x0200
comma
DECL|enumerator|PHY_Enable_Auto_Nego
id|PHY_Enable_Auto_Nego
op_assign
l_int|0x1000
comma
singleline_comment|//PHY_STAT_REG = 1;
DECL|enumerator|PHY_Auto_Neco_Comp
id|PHY_Auto_Neco_Comp
op_assign
l_int|0x0020
comma
singleline_comment|//PHY_AUTO_NEGO_REG = 4;
DECL|enumerator|PHY_Cap_10_Half
id|PHY_Cap_10_Half
op_assign
l_int|0x0020
comma
DECL|enumerator|PHY_Cap_10_Full
id|PHY_Cap_10_Full
op_assign
l_int|0x0040
comma
DECL|enumerator|PHY_Cap_100_Half
id|PHY_Cap_100_Half
op_assign
l_int|0x0080
comma
DECL|enumerator|PHY_Cap_100_Full
id|PHY_Cap_100_Full
op_assign
l_int|0x0100
comma
singleline_comment|//PHY_1000_CTRL_REG = 9;
DECL|enumerator|PHY_Cap_1000_Full
id|PHY_Cap_1000_Full
op_assign
l_int|0x0200
comma
DECL|enumerator|PHY_Cap_Null
id|PHY_Cap_Null
op_assign
l_int|0x0
comma
multiline_comment|/*_MediaType*/
DECL|enumerator|_10_Half
id|_10_Half
op_assign
l_int|0x01
comma
DECL|enumerator|_10_Full
id|_10_Full
op_assign
l_int|0x02
comma
DECL|enumerator|_100_Half
id|_100_Half
op_assign
l_int|0x04
comma
DECL|enumerator|_100_Full
id|_100_Full
op_assign
l_int|0x08
comma
DECL|enumerator|_1000_Full
id|_1000_Full
op_assign
l_int|0x10
comma
multiline_comment|/*_TBICSRBit*/
DECL|enumerator|TBILinkOK
id|TBILinkOK
op_assign
l_int|0x02000000
comma
)brace
suffix:semicolon
r_const
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|version
id|u8
id|version
suffix:semicolon
multiline_comment|/* depend on docs */
DECL|member|RxConfigMask
id|u32
id|RxConfigMask
suffix:semicolon
multiline_comment|/* should clear the bits supported by this chip */
DECL|variable|sis_chip_info
)brace
id|sis_chip_info
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;SiS-0190&quot;
comma
l_int|0x00
comma
l_int|0xff7e1880
comma
)brace
comma
)brace
suffix:semicolon
DECL|enum|_DescStatusBit
r_enum
id|_DescStatusBit
(brace
DECL|enumerator|OWNbit
id|OWNbit
op_assign
l_int|0x80000000
comma
DECL|enumerator|INTbit
id|INTbit
op_assign
l_int|0x40000000
comma
DECL|enumerator|DEFbit
id|DEFbit
op_assign
l_int|0x200000
comma
DECL|enumerator|CRCbit
id|CRCbit
op_assign
l_int|0x20000
comma
DECL|enumerator|PADbit
id|PADbit
op_assign
l_int|0x10000
comma
DECL|enumerator|ENDbit
id|ENDbit
op_assign
l_int|0x80000000
comma
)brace
suffix:semicolon
DECL|struct|TxDesc
r_struct
id|TxDesc
(brace
DECL|member|PSize
id|u32
id|PSize
suffix:semicolon
DECL|member|status
id|u32
id|status
suffix:semicolon
DECL|member|buf_addr
id|u32
id|buf_addr
suffix:semicolon
DECL|member|buf_Len
id|u32
id|buf_Len
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|RxDesc
r_struct
id|RxDesc
(brace
DECL|member|PSize
id|u32
id|PSize
suffix:semicolon
DECL|member|status
id|u32
id|status
suffix:semicolon
DECL|member|buf_addr
id|u32
id|buf_addr
suffix:semicolon
DECL|member|buf_Len
id|u32
id|buf_Len
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sis190_private
r_struct
id|sis190_private
(brace
DECL|member|mmio_addr
r_void
op_star
id|mmio_addr
suffix:semicolon
multiline_comment|/* memory map physical address */
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
multiline_comment|/* Index of PCI device  */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
multiline_comment|/* statistics of net device */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* spin lock flag */
DECL|member|chipset
r_int
id|chipset
suffix:semicolon
DECL|member|cur_rx
r_int
r_int
id|cur_rx
suffix:semicolon
multiline_comment|/* Index into the Rx descriptor buffer of next Rx pkt. */
DECL|member|cur_tx
r_int
r_int
id|cur_tx
suffix:semicolon
multiline_comment|/* Index into the Tx descriptor buffer of next Rx pkt. */
DECL|member|dirty_tx
r_int
r_int
id|dirty_tx
suffix:semicolon
DECL|member|tx_dma
id|dma_addr_t
id|tx_dma
suffix:semicolon
DECL|member|rx_dma
id|dma_addr_t
id|rx_dma
suffix:semicolon
DECL|member|TxDescArray
r_struct
id|TxDesc
op_star
id|TxDescArray
suffix:semicolon
multiline_comment|/* Index of 256-alignment Tx Descriptor buffer */
DECL|member|RxDescArray
r_struct
id|RxDesc
op_star
id|RxDescArray
suffix:semicolon
multiline_comment|/* Index of 256-alignment Rx Descriptor buffer */
DECL|member|RxBufferRings
r_int
r_char
op_star
id|RxBufferRings
suffix:semicolon
multiline_comment|/* Index of Rx Buffer  */
DECL|member|RxBufferRing
r_int
r_char
op_star
id|RxBufferRing
(braket
id|NUM_RX_DESC
)braket
suffix:semicolon
multiline_comment|/* Index of Rx Buffer array */
DECL|member|Tx_skbuff
r_struct
id|sk_buff
op_star
id|Tx_skbuff
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
multiline_comment|/* Index of Transmit data buffer */
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;K.M. Liu &lt;kmliu@sis.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS SiS190 Gigabit Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|media
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
r_static
r_int
id|SiS190_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SiS190_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|SiS190_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|SiS190_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|SiS190_hw_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SiS190_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|SiS190_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|SiS190_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|SiS190_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
suffix:semicolon
DECL|variable|sis190_intr_mask
r_static
r_const
id|u32
id|sis190_intr_mask
op_assign
id|RxQEmpty
op_or
id|RxQInt
op_or
id|TxQ1Empty
op_or
id|TxQ1Int
op_or
id|TxQ0Empty
op_or
id|TxQ0Int
op_or
id|RxHalt
op_or
id|TxHalt
suffix:semicolon
r_void
DECL|function|smdio_write
id|smdio_write
c_func
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|RegAddr
comma
r_int
id|value
)paren
(brace
id|u32
id|l
suffix:semicolon
id|u16
id|i
suffix:semicolon
id|u32
id|pmd
suffix:semicolon
id|pmd
op_assign
l_int|1
suffix:semicolon
id|l
op_assign
l_int|0
suffix:semicolon
id|l
op_assign
id|EhnMIIwrite
op_or
(paren
(paren
(paren
id|u32
)paren
id|RegAddr
)paren
op_lshift
id|EhnMIIregShift
)paren
op_or
id|EhnMIIreq
op_or
(paren
(paren
(paren
id|u32
)paren
id|value
)paren
op_lshift
id|EhnMIIdataShift
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|pmd
)paren
op_lshift
id|EhnMIIpmdShift
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|GMIIControl
comma
id|l
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SiS_R32
c_func
(paren
id|GMIIControl
)paren
op_amp
id|EhnMIInotDone
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
OG
l_int|999
)paren
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Phy write Error!!!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_int
DECL|function|smdio_read
id|smdio_read
c_func
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|RegAddr
)paren
(brace
id|u32
id|l
suffix:semicolon
id|u16
id|i
suffix:semicolon
id|u32
id|pmd
suffix:semicolon
id|pmd
op_assign
l_int|1
suffix:semicolon
id|l
op_assign
l_int|0
suffix:semicolon
id|l
op_assign
id|EhnMIIread
op_or
id|EhnMIIreq
op_or
(paren
(paren
(paren
id|u32
)paren
id|RegAddr
)paren
op_lshift
id|EhnMIIregShift
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|pmd
)paren
op_lshift
id|EhnMIIpmdShift
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|GMIIControl
comma
id|l
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|l
op_eq
id|SiS_R32
c_func
(paren
id|GMIIControl
)paren
)paren
op_amp
id|EhnMIInotDone
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OG
l_int|999
)paren
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Phy Read Error!!!&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|l
op_assign
id|SiS_R32
c_func
(paren
id|GMIIControl
)paren
suffix:semicolon
r_return
(paren
(paren
id|u16
)paren
(paren
id|l
op_rshift
id|EhnMIIdataShift
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|ReadEEprom
id|ReadEEprom
c_func
(paren
r_void
op_star
id|ioaddr
comma
id|u32
id|RegAddr
)paren
(brace
id|u16
id|data
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|u32
id|ulValue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|SiS_R32
c_func
(paren
id|ROMControl
)paren
op_amp
id|BIT_1
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|ulValue
op_assign
(paren
id|BIT_7
op_or
(paren
l_int|0x2
op_lshift
l_int|8
)paren
op_or
(paren
id|RegAddr
op_lshift
l_int|10
)paren
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|ROMInterface
comma
id|ulValue
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|200
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|SiS_R32
c_func
(paren
id|ROMInterface
)paren
op_amp
id|BIT_7
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
id|data
op_assign
(paren
id|u16
)paren
(paren
(paren
id|SiS_R32
c_func
(paren
id|ROMInterface
)paren
op_amp
l_int|0xffff0000
)paren
op_rshift
l_int|16
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|SiS190_init_board
id|SiS190_init_board
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|net_device
op_star
op_star
id|dev_out
comma
r_void
op_star
op_star
id|ioaddr_out
)paren
(brace
r_void
op_star
id|ioaddr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sis190_private
op_star
id|tp
suffix:semicolon
id|u16
id|rc
suffix:semicolon
r_int
r_int
id|mmio_start
comma
id|mmio_end
comma
id|mmio_flags
comma
id|mmio_len
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr_out
op_ne
l_int|NULL
)paren
suffix:semicolon
op_star
id|ioaddr_out
op_assign
l_int|NULL
suffix:semicolon
op_star
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|// dev zeroed in init_etherdev 
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to alloc new ethernet&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
singleline_comment|// enable device (incl. PCI PM wakeup and hotplug setup)
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out
suffix:semicolon
id|mmio_start
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mmio_end
op_assign
id|pci_resource_end
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mmio_flags
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mmio_len
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// make sure PCI base addr 0 is MMIO
r_if
c_cond
(paren
op_logical_neg
(paren
id|mmio_flags
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;region #0 not an MMIO resource, aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
singleline_comment|// check for weird/broken PCI region reporting
r_if
c_cond
(paren
id|mmio_len
OL
id|SiS190_MIN_IO_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Invalid PCI region size(s), aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out
suffix:semicolon
singleline_comment|// enable PCI bus-mastering
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
singleline_comment|// ioremap MMIO region 
id|ioaddr
op_assign
id|ioremap
c_func
(paren
id|mmio_start
comma
id|mmio_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioaddr
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot remap MMIO, aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
singleline_comment|// Soft reset the chip. 
id|SiS_W32
c_func
(paren
id|IntrControl
comma
l_int|0x8000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|IntrControl
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|TxControl
comma
l_int|0x1a00
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|RxControl
comma
l_int|0x1a00
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
op_star
id|ioaddr_out
op_assign
id|ioaddr
suffix:semicolon
op_star
id|dev_out
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|SiS190_init_one
id|SiS190_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sis190_private
op_star
id|tp
op_assign
l_int|NULL
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_int
id|printed_version
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
id|u16
id|reg31
suffix:semicolon
r_int
id|val
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ent
op_ne
l_int|NULL
)paren
suffix:semicolon
id|board_idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|SiS190_DRIVER_NAME
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
id|printed_version
op_assign
l_int|1
suffix:semicolon
)brace
id|i
op_assign
id|SiS190_init_board
c_func
(paren
id|pdev
comma
op_amp
id|dev
comma
op_amp
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
r_return
id|i
suffix:semicolon
)brace
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
singleline_comment|// Get MAC address //
singleline_comment|// Read node address from the EEPROM
r_if
c_cond
(paren
id|SiS_R32
c_func
(paren
id|ROMControl
)paren
op_amp
l_int|0x2
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|SiS_W16
c_func
(paren
id|RxMacAddr
op_plus
id|i
comma
id|ReadEEprom
c_func
(paren
id|ioaddr
comma
l_int|3
op_plus
(paren
id|i
op_div
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|SiS_W32
c_func
(paren
id|RxMacAddr
comma
l_int|0x11111100
)paren
suffix:semicolon
singleline_comment|//If 9346 does not exist
id|SiS_W32
c_func
(paren
id|RxMacAddr
op_plus
l_int|2
comma
l_int|0x00111111
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|SiS_R8
c_func
(paren
id|RxMacAddr
op_plus
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SiS_R8(RxMacAddr+%x)= %x &quot;
comma
id|i
comma
id|SiS_R8
c_func
(paren
id|RxMacAddr
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|dev-&gt;open
op_assign
id|SiS190_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|SiS190_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|SiS190_get_stats
suffix:semicolon
id|dev-&gt;stop
op_assign
id|SiS190_close
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|SiS190_tx_timeout
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|SiS190_set_rx_mode
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioaddr
suffix:semicolon
singleline_comment|//      dev-&gt;do_ioctl           = mii_ioctl;
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
singleline_comment|// private data //
id|tp-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;mmio_addr
op_assign
id|ioaddr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Identified chip type is &squot;%s&squot;.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sis_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|name
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|rc
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iounmap
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Identified chip type is &squot;%s&squot;.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sis_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|name
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
l_string|&quot;%2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x, &quot;
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|board_info
(braket
id|ent-&gt;driver_data
)braket
dot
id|name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|val
op_assign
id|smdio_read
c_func
(paren
id|ioaddr
comma
id|PHY_AUTO_NEGO_REG
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Auto-negotiation Enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
singleline_comment|// enable 10/100 Full/Half Mode, leave PHY_AUTO_NEGO_REG bit4:0 unchanged
id|smdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_AUTO_NEGO_REG
comma
id|PHY_Cap_10_Half
op_or
id|PHY_Cap_10_Full
op_or
id|PHY_Cap_100_Half
op_or
id|PHY_Cap_100_Full
op_or
(paren
id|val
op_amp
l_int|0x1F
)paren
)paren
suffix:semicolon
singleline_comment|// enable 1000 Full Mode
id|smdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_1000_CTRL_REG
comma
id|PHY_Cap_1000_Full
)paren
suffix:semicolon
singleline_comment|// Enable auto-negotiation and restart auto-nigotiation
id|smdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_CTRL_REG
comma
id|PHY_Enable_Auto_Nego
op_or
id|PHY_Restart_Auto_Nego
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
singleline_comment|// wait for auto-negotiation process
r_for
c_loop
(paren
id|i
op_assign
l_int|10000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
singleline_comment|//check if auto-negotiation complete
r_if
c_cond
(paren
id|smdio_read
c_func
(paren
id|ioaddr
comma
id|PHY_STAT_REG
)paren
op_amp
id|PHY_Auto_Neco_Comp
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|reg31
op_assign
id|smdio_read
c_func
(paren
id|ioaddr
comma
l_int|31
)paren
suffix:semicolon
id|reg31
op_and_assign
l_int|0x1c
suffix:semicolon
singleline_comment|//bit 4:2
r_switch
c_cond
(paren
id|reg31
)paren
(brace
r_case
id|_1000bpsF
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x1c01
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 1000 bps Full Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_1000bpsH
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x0c01
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 1000 bps Half Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_100bpsF
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x1801
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 100 bps Full Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_100bpsH
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x0801
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 100 bps Half Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_10bpsF
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x1401
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 10 bps Full Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_10bpsH
suffix:colon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x0401
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;SiS190 Link on 10 bps Half Duplex mode. &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Error! SiS190 Can not detect mode !!! &bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// end for-loop to wait for auto-negotiation process
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__devexit
DECL|function|SiS190_remove_one
id|SiS190_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|sis190_private
op_star
id|tp
op_assign
(paren
r_struct
id|sis190_private
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|tp-&gt;mmio_addr
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
singleline_comment|// poison memory before freeing 
id|memset
c_func
(paren
id|dev
comma
l_int|0xBC
comma
r_sizeof
(paren
r_struct
id|net_device
)paren
op_plus
r_sizeof
(paren
r_struct
id|sis190_private
)paren
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|SiS190_open
id|SiS190_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|SiS190_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * Rx and Tx descriptors need 256 bytes alignment.&n;&t; * pci_alloc_consistent() guarantees a stronger alignment.&n;&t; */
id|tp-&gt;TxDescArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_DESC_TOTAL_SIZE
comma
op_amp
id|tp-&gt;tx_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;TxDescArray
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
id|tp-&gt;RxDescArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_DESC_TOTAL_SIZE
comma
op_amp
id|tp-&gt;rx_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;RxDescArray
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_tx
suffix:semicolon
)brace
id|tp-&gt;RxBufferRings
op_assign
id|kmalloc
c_func
(paren
id|RX_BUF_SIZE
op_star
id|NUM_RX_DESC
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;RxBufferRings
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: allocate RxBufferRing failed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_rx
suffix:semicolon
)brace
id|SiS190_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SiS190_hw_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|err_out_free_rx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_DESC_TOTAL_SIZE
comma
id|tp-&gt;RxDescArray
comma
id|tp-&gt;rx_dma
)paren
suffix:semicolon
id|err_out_free_tx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_DESC_TOTAL_SIZE
comma
id|tp-&gt;TxDescArray
comma
id|tp-&gt;tx_dma
)paren
suffix:semicolon
id|err_out
suffix:colon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|SiS190_hw_start
id|SiS190_hw_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|SiS_W32
c_func
(paren
id|IntrControl
comma
l_int|0x8000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|IntrControl
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x0
comma
l_int|0x01a00
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x4
comma
id|tp-&gt;tx_dma
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x10
comma
l_int|0x1a00
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x14
comma
id|tp-&gt;rx_dma
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x20
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x24
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W16
c_func
(paren
l_int|0x40
comma
l_int|0x1901
)paren
suffix:semicolon
singleline_comment|//default is 100Mbps
id|SiS_W32
c_func
(paren
l_int|0x44
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x50
comma
l_int|0x60
)paren
suffix:semicolon
id|SiS_W16
c_func
(paren
l_int|0x60
comma
l_int|0x02
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x68
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x6c
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x70
comma
l_int|0x0
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x74
comma
l_int|0x0
)paren
suffix:semicolon
singleline_comment|// Set Rx Config register
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|SiS190_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|SiS_W32
c_func
(paren
id|IntrMask
comma
id|sis190_intr_mask
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x0
comma
l_int|0x1a01
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
l_int|0x10
comma
l_int|0x1a1d
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|SiS190_init_ring
id|SiS190_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;TxDescArray
comma
l_int|0x0
comma
id|NUM_TX_DESC
op_star
r_sizeof
(paren
r_struct
id|TxDesc
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;RxDescArray
comma
l_int|0x0
comma
id|NUM_RX_DESC
op_star
r_sizeof
(paren
r_struct
id|RxDesc
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;Tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;RxDescArray
(braket
id|i
)braket
dot
id|PSize
op_assign
l_int|0x0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
(paren
id|NUM_RX_DESC
op_minus
l_int|1
)paren
)paren
id|tp-&gt;RxDescArray
(braket
id|i
)braket
dot
id|buf_Len
op_assign
id|BIT_31
op_plus
id|RX_BUF_SIZE
suffix:semicolon
singleline_comment|//bit 31 is End bit
r_else
id|tp-&gt;RxDescArray
(braket
id|i
)braket
dot
id|buf_Len
op_assign
id|RX_BUF_SIZE
suffix:semicolon
macro_line|#warning Replace virt_to_bus with DMA mapping
id|tp-&gt;RxBufferRing
(braket
id|i
)braket
op_assign
op_amp
(paren
id|tp-&gt;RxBufferRings
(braket
id|i
op_star
id|RX_BUF_SIZE
)braket
)paren
suffix:semicolon
id|tp-&gt;RxDescArray
(braket
id|i
)braket
dot
id|buf_addr
op_assign
id|virt_to_bus
c_func
(paren
id|tp-&gt;RxBufferRing
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;RxDescArray
(braket
id|i
)braket
dot
id|status
op_assign
id|OWNbit
op_or
id|INTbit
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|SiS190_tx_clear
id|SiS190_tx_clear
c_func
(paren
r_struct
id|sis190_private
op_star
id|tp
)paren
(brace
r_int
id|i
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;Tx_skbuff
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|tp-&gt;Tx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pci_dev
comma
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|i
)braket
dot
id|buf_addr
)paren
comma
id|skb-&gt;len
OL
id|ETH_ZLEN
ques
c_cond
id|ETH_ZLEN
suffix:colon
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;Tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|SiS190_tx_timeout
id|SiS190_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
multiline_comment|/* disable Tx, if not already */
id|tmp8
op_assign
id|SiS_R8
c_func
(paren
id|TxControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp8
op_amp
id|CmdTxEnb
)paren
id|SiS_W8
c_func
(paren
id|TxControl
comma
id|tmp8
op_amp
op_complement
id|CmdTxEnb
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|SiS_W32
c_func
(paren
id|IntrMask
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Stop a shared interrupt from scavenging while we are. */
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|SiS190_tx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* ...and finally, reset everything */
id|SiS190_hw_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|SiS190_start_xmit
id|SiS190_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
id|u32
id|len
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb-&gt;len
OL
id|ETH_ZLEN
)paren
)paren
(brace
id|skb
op_assign
id|skb_padto
c_func
(paren
id|skb
comma
id|ETH_ZLEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|drop_tx
suffix:semicolon
id|len
op_assign
id|ETH_ZLEN
suffix:semicolon
)brace
r_else
(brace
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
)paren
op_amp
id|OWNbit
)paren
op_eq
l_int|0
)paren
(brace
id|dma_addr_t
id|mapping
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|buf_addr
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|PSize
op_assign
id|cpu_to_le32
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
(paren
id|NUM_TX_DESC
op_minus
l_int|1
)paren
)paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|buf_Len
op_assign
id|cpu_to_le32
c_func
(paren
id|len
)paren
suffix:semicolon
r_else
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|buf_Len
op_assign
id|cpu_to_le32
c_func
(paren
id|len
op_or
id|ENDbit
)paren
suffix:semicolon
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
op_or_assign
id|cpu_to_le32
c_func
(paren
id|OWNbit
op_or
id|INTbit
op_or
id|DEFbit
op_or
id|CRCbit
op_or
id|PADbit
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|TxControl
comma
l_int|0x1a11
)paren
suffix:semicolon
singleline_comment|//Start Send
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_goto
id|drop_tx
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;cur_tx
op_minus
id|NUM_TX_DESC
)paren
op_eq
id|tp-&gt;dirty_tx
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|drop_tx
suffix:colon
id|tp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|SiS190_tx_interrupt
id|SiS190_tx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sis190_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
r_int
id|dirty_tx
comma
id|tx_left
op_assign
l_int|0
suffix:semicolon
r_int
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|tx_left
op_assign
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
suffix:semicolon
r_while
c_loop
(paren
id|tx_left
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
)paren
op_amp
id|OWNbit
)paren
op_eq
l_int|0
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pci_dev
comma
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|buf_addr
)paren
comma
id|skb-&gt;len
OL
id|ETH_ZLEN
ques
c_cond
id|ETH_ZLEN
suffix:colon
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|dirty_tx
op_increment
suffix:semicolon
id|tx_left
op_decrement
suffix:semicolon
id|entry
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tp-&gt;dirty_tx
op_ne
id|dirty_tx
)paren
(brace
id|tp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|SiS190_rx_interrupt
id|SiS190_rx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sis190_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
id|cur_rx
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|pkt_size
op_assign
l_int|0
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|cur_rx
op_assign
id|tp-&gt;cur_rx
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|status
op_amp
id|OWNbit
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|PSize
op_amp
l_int|0x0080000
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Rx ERROR!!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|PSize
op_amp
l_int|0x0010000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Rx ERROR!!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|tp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|pkt_size
op_assign
(paren
r_int
)paren
(paren
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|PSize
op_amp
l_int|0x0000FFFF
)paren
op_minus
l_int|4
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_size
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
singleline_comment|// 16 byte align the IP fields. //
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|tp-&gt;RxBufferRing
(braket
id|cur_rx
)braket
comma
id|pkt_size
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_size
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|PSize
op_assign
l_int|0x0
suffix:semicolon
r_if
c_cond
(paren
id|cur_rx
op_eq
(paren
id|NUM_RX_DESC
op_minus
l_int|1
)paren
)paren
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|buf_Len
op_assign
id|ENDbit
op_plus
id|RX_BUF_SIZE
suffix:semicolon
r_else
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|buf_Len
op_assign
id|RX_BUF_SIZE
suffix:semicolon
macro_line|#warning Replace virt_to_bus with DMA mapping
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|buf_addr
op_assign
id|virt_to_bus
c_func
(paren
id|tp-&gt;RxBufferRing
(braket
id|cur_rx
)braket
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;stats.rx_bytes
op_add_assign
id|pkt_size
suffix:semicolon
id|tp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|tp-&gt;RxDescArray
(braket
id|cur_rx
)braket
dot
id|status
op_assign
id|OWNbit
op_or
id|INTbit
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze, deferring packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* We should check that some rx space is free.&n;&t;&t;&t;&t;   If not, free one and mark stats-&gt;rx_dropped++. */
id|tp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
)brace
id|cur_rx
op_assign
(paren
id|cur_rx
op_plus
l_int|1
)paren
op_mod
id|NUM_RX_DESC
suffix:semicolon
)brace
id|tp-&gt;cur_rx
op_assign
id|cur_rx
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up after the Tx thread. */
r_static
id|irqreturn_t
DECL|function|SiS190_interrupt
id|SiS190_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|status
op_assign
id|SiS_R32
c_func
(paren
id|IntrStatus
)paren
suffix:semicolon
multiline_comment|/* h/w no longer present (hotplug?) or major error, bail */
id|SiS_W32
c_func
(paren
id|IntrStatus
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|TxQ0Int
op_or
id|RxQInt
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
singleline_comment|// Rx interrupt 
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxQInt
)paren
)paren
(brace
id|SiS190_rx_interrupt
c_func
(paren
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
singleline_comment|// Tx interrupt
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxQ0Int
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|SiS190_tx_interrupt
c_func
(paren
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
id|boguscnt
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
id|boguscnt
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|boguscnt
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work at interrupt!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupt sources. */
id|SiS_W32
c_func
(paren
id|IntrStatus
comma
l_int|0xffffffff
)paren
suffix:semicolon
)brace
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|SiS190_close
id|SiS190_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx DMA processes. */
id|SiS_W32
c_func
(paren
id|TxControl
comma
l_int|0x1a00
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|RxControl
comma
l_int|0x1a00
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|SiS_W32
c_func
(paren
id|IntrMask
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
singleline_comment|//tp-&gt;stats.rx_missed_errors += _R32(RxMissed);
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|SiS190_tx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_DESC_TOTAL_SIZE
comma
id|tp-&gt;TxDescArray
comma
id|tp-&gt;tx_dma
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_DESC_TOTAL_SIZE
comma
id|tp-&gt;RxDescArray
comma
id|tp-&gt;rx_dma
)paren
suffix:semicolon
id|tp-&gt;TxDescArray
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;RxDescArray
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|tp-&gt;RxBufferRings
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;RxBufferRing
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|SiS190_set_rx_mode
id|SiS190_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|i
comma
id|rx_mode
suffix:semicolon
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
op_or
id|AcceptAllPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|bit_nr
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
suffix:semicolon
id|mc_filter
(braket
id|bit_nr
op_rshift
l_int|5
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|bit_nr
op_amp
l_int|31
)paren
suffix:semicolon
id|rx_mode
op_or_assign
id|AcceptMulticast
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|rx_mode
op_or
l_int|0x2
suffix:semicolon
id|SiS_W16
c_func
(paren
id|RxMacControl
comma
id|tmp
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|RxHashTable
comma
id|mc_filter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|SiS_W32
c_func
(paren
id|RxHashTable
op_plus
l_int|4
comma
id|mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_struct
id|net_device_stats
op_star
DECL|function|SiS190_get_stats
id|SiS190_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sis190_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
DECL|variable|sis190_pci_driver
r_static
r_struct
id|pci_driver
id|sis190_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|MODULENAME
comma
dot
id|id_table
op_assign
id|sis190_pci_tbl
comma
dot
id|probe
op_assign
id|SiS190_init_one
comma
dot
id|remove
op_assign
id|SiS190_remove_one
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|SiS190_init_module
id|SiS190_init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|sis190_pci_driver
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|SiS190_cleanup_module
id|SiS190_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|sis190_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|SiS190_init_module
id|module_init
c_func
(paren
id|SiS190_init_module
)paren
suffix:semicolon
DECL|variable|SiS190_cleanup_module
id|module_exit
c_func
(paren
id|SiS190_cleanup_module
)paren
suffix:semicolon
eof
