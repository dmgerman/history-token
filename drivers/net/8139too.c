multiline_comment|/*&n;&n;&t;8139too.c: A RealTek RTL-8139 Fast Ethernet driver for Linux.&n;&n;&t;Maintained by Jeff Garzik &lt;jgarzik@pobox.com&gt;&n;&t;Copyright 2000-2002 Jeff Garzik&n;&n;&t;Much code comes from Donald Becker&squot;s rtl8139.c driver,&n;&t;versions 1.13 and older.  This driver was originally based&n;&t;on rtl8139.c version 1.07.  Header of rtl8139.c version 1.13:&n;&n;&t;-----&lt;snip&gt;-----&n;&n;        &t;Written 1997-2001 by Donald Becker.&n;&t;&t;This software may be used and distributed according to the&n;&t;&t;terms of the GNU General Public License (GPL), incorporated&n;&t;&t;herein by reference.  Drivers based on or derived from this&n;&t;&t;code fall under the GPL and must retain the authorship,&n;&t;&t;copyright and license notice.  This file is not a complete&n;&t;&t;program and may only be used when the entire operating&n;&t;&t;system is licensed under the GPL.&n;&n;&t;&t;This driver is for boards based on the RTL8129 and RTL8139&n;&t;&t;PCI ethernet chips.&n;&n;&t;&t;The author may be reached as becker@scyld.com, or C/O Scyld&n;&t;&t;Computing Corporation 410 Severn Ave., Suite 210 Annapolis&n;&t;&t;MD 21403&n;&n;&t;&t;Support and updates available at&n;&t;&t;http://www.scyld.com/network/rtl8139.html&n;&n;&t;&t;Twister-tuning table provided by Kinston&n;&t;&t;&lt;shangh@realtek.com.tw&gt;.&n;&n;&t;-----&lt;snip&gt;-----&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU General Public License, incorporated herein by reference.&n;&n;&t;Contributors:&n;&n;&t;&t;Donald Becker - he wrote the original driver, kudos to him!&n;&t;&t;(but please don&squot;t e-mail him for support, this isn&squot;t his driver)&n;&n;&t;&t;Tigran Aivazian - bug fixes, skbuff free cleanup&n;&n;&t;&t;Martin Mares - suggestions for PCI cleanup&n;&n;&t;&t;David S. Miller - PCI DMA and softnet updates&n;&n;&t;&t;Ernst Gill - fixes ported from BSD driver&n;&n;&t;&t;Daniel Kobras - identified specific locations of&n;&t;&t;&t;posted MMIO write bugginess&n;&n;&t;&t;Gerard Sharp - bug fix, testing and feedback&n;&n;&t;&t;David Ford - Rx ring wrap fix&n;&n;&t;&t;Dan DeMaggio - swapped RTL8139 cards with me, and allowed me&n;&t;&t;to find and fix a crucial bug on older chipsets.&n;&n;&t;&t;Donald Becker/Chris Butterworth/Marcus Westergren -&n;&t;&t;Noticed various Rx packet size-related buglets.&n;&n;&t;&t;Santiago Garcia Mantinan - testing and feedback&n;&n;&t;&t;Jens David - 2.2.x kernel backports&n;&n;&t;&t;Martin Dennett - incredibly helpful insight on undocumented&n;&t;&t;features of the 8139 chips&n;&n;&t;&t;Jean-Jacques Michel - bug fix&n;&n;&t;&t;Tobias Ringstr&#xfffd;m - Rx interrupt status checking suggestion&n;&n;&t;&t;Andrew Morton - Clear blocked signals, avoid&n;&t;&t;buffer overrun setting current-&gt;comm.&n;&n;&t;&t;Kalle Olavi Niemitalo - Wake-on-LAN ioctls&n;&n;&t;&t;Robert Kuebel - Save kernel thread from dying on any signal.&n;&n;&t;Submitting bug reports:&n;&n;&t;&t;&quot;rtl8139-diag -mmmaaavvveefN&quot; output&n;&t;&t;enable RTL8139_DEBUG below, and look at &squot;dmesg&squot; or kernel log&n;&n;&t;&t;See 8139too.txt for more details.&n;&n;*/
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;8139too&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;0.9.27&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/completion.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;linux/suspend.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
DECL|macro|RTL8139_DRIVER_NAME
mdefine_line|#define RTL8139_DRIVER_NAME   DRV_NAME &quot; Fast Ethernet driver &quot; DRV_VERSION
DECL|macro|PFX
mdefine_line|#define PFX DRV_NAME &quot;: &quot;
multiline_comment|/* Default Message level */
DECL|macro|RTL8139_DEF_MSG_ENABLE
mdefine_line|#define RTL8139_DEF_MSG_ENABLE   (NETIF_MSG_DRV   | &bslash;&n;                                 NETIF_MSG_PROBE  | &bslash;&n;                                 NETIF_MSG_LINK)
multiline_comment|/* enable PIO instead of MMIO, if CONFIG_8139TOO_PIO is selected */
macro_line|#ifdef CONFIG_8139TOO_PIO
DECL|macro|USE_IO_OPS
mdefine_line|#define USE_IO_OPS 1
macro_line|#endif
multiline_comment|/* define to 1 to enable copious debugging info */
DECL|macro|RTL8139_DEBUG
macro_line|#undef RTL8139_DEBUG
multiline_comment|/* define to 1 to disable lightweight runtime debugging checks */
DECL|macro|RTL8139_NDEBUG
macro_line|#undef RTL8139_NDEBUG
macro_line|#ifdef RTL8139_DEBUG
multiline_comment|/* note: prints function name for you */
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __FUNCTION__ , ## args)
macro_line|#else
DECL|macro|DPRINTK
macro_line|#  define DPRINTK(fmt, args...)
macro_line|#endif
macro_line|#ifdef RTL8139_NDEBUG
DECL|macro|assert
macro_line|#  define assert(expr) do {} while (0)
macro_line|#else
DECL|macro|assert
macro_line|#  define assert(expr) &bslash;&n;        if(unlikely(!(expr))) {&t;&t;&t;&t;        &bslash;&n;        printk(KERN_ERR &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&t;&bslash;&n;        #expr,__FILE__,__FUNCTION__,__LINE__);&t;&t;        &bslash;&n;        }
macro_line|#endif
multiline_comment|/* A few user-configurable values. */
multiline_comment|/* media options */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
DECL|variable|media
r_static
r_int
id|media
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast).&n;   The RTL chips use a 64 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* bitmapped message enable number */
DECL|variable|debug
r_static
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n; * Receive ring size &n; * Warning: 64K ring has hardware issues and may lock up.&n; */
macro_line|#if defined(CONFIG_SH_DREAMCAST)
DECL|macro|RX_BUF_IDX
mdefine_line|#define RX_BUF_IDX&t;1&t;/* 16K ring */
macro_line|#else
DECL|macro|RX_BUF_IDX
mdefine_line|#define RX_BUF_IDX&t;2&t;/* 32K ring */
macro_line|#endif
DECL|macro|RX_BUF_LEN
mdefine_line|#define RX_BUF_LEN&t;(8192 &lt;&lt; RX_BUF_IDX)
DECL|macro|RX_BUF_PAD
mdefine_line|#define RX_BUF_PAD&t;16
DECL|macro|RX_BUF_WRAP_PAD
mdefine_line|#define RX_BUF_WRAP_PAD 2048 /* spare padding to handle lack of packet wrap */
macro_line|#if RX_BUF_LEN == 65536
DECL|macro|RX_BUF_TOT_LEN
mdefine_line|#define RX_BUF_TOT_LEN&t;RX_BUF_LEN
macro_line|#else
DECL|macro|RX_BUF_TOT_LEN
mdefine_line|#define RX_BUF_TOT_LEN&t;(RX_BUF_LEN + RX_BUF_PAD + RX_BUF_WRAP_PAD)
macro_line|#endif
multiline_comment|/* Number of Tx descriptor registers. */
DECL|macro|NUM_TX_DESC
mdefine_line|#define NUM_TX_DESC&t;4
multiline_comment|/* max supported ethernet frame size -- must be at least (dev-&gt;mtu+14+4).*/
DECL|macro|MAX_ETH_FRAME_SIZE
mdefine_line|#define MAX_ETH_FRAME_SIZE&t;1536
multiline_comment|/* Size of the Tx bounce buffers -- must be at least (dev-&gt;mtu+14+4). */
DECL|macro|TX_BUF_SIZE
mdefine_line|#define TX_BUF_SIZE&t;MAX_ETH_FRAME_SIZE
DECL|macro|TX_BUF_TOT_LEN
mdefine_line|#define TX_BUF_TOT_LEN&t;(TX_BUF_SIZE * NUM_TX_DESC)
multiline_comment|/* PCI Tuning Parameters&n;   Threshold is bytes transferred to chip before transmission starts. */
DECL|macro|TX_FIFO_THRESH
mdefine_line|#define TX_FIFO_THRESH 256&t;/* In bytes, rounded down to 32 byte units. */
multiline_comment|/* The following settings are log_2(bytes)-4:  0 == 16 bytes .. 6==1024, 7==end of packet. */
DECL|macro|RX_FIFO_THRESH
mdefine_line|#define RX_FIFO_THRESH&t;7&t;/* Rx buffer level before first PCI xfer.  */
DECL|macro|RX_DMA_BURST
mdefine_line|#define RX_DMA_BURST&t;7&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|TX_DMA_BURST
mdefine_line|#define TX_DMA_BURST&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|TX_RETRY
mdefine_line|#define TX_RETRY&t;8&t;/* 0-15.  retries = 16 + (TX_RETRY * 16) */
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (6*HZ)
r_enum
(brace
DECL|enumerator|HAS_MII_XCVR
id|HAS_MII_XCVR
op_assign
l_int|0x010000
comma
DECL|enumerator|HAS_CHIP_XCVR
id|HAS_CHIP_XCVR
op_assign
l_int|0x020000
comma
DECL|enumerator|HAS_LNK_CHNG
id|HAS_LNK_CHNG
op_assign
l_int|0x040000
comma
)brace
suffix:semicolon
DECL|macro|RTL_NUM_STATS
mdefine_line|#define RTL_NUM_STATS 4&t;&t;/* number of ETHTOOL_GSTATS u64&squot;s */
DECL|macro|RTL_REGS_VER
mdefine_line|#define RTL_REGS_VER 1&t;&t;/* version of reg. data in ETHTOOL_GREGS */
DECL|macro|RTL_MIN_IO_SIZE
mdefine_line|#define RTL_MIN_IO_SIZE 0x80
DECL|macro|RTL8139B_IO_SIZE
mdefine_line|#define RTL8139B_IO_SIZE 256
DECL|macro|RTL8129_CAPS
mdefine_line|#define RTL8129_CAPS&t;HAS_MII_XCVR
DECL|macro|RTL8139_CAPS
mdefine_line|#define RTL8139_CAPS&t;HAS_CHIP_XCVR|HAS_LNK_CHNG
r_typedef
r_enum
(brace
DECL|enumerator|RTL8139
id|RTL8139
op_assign
l_int|0
comma
DECL|enumerator|RTL8129
id|RTL8129
comma
DECL|typedef|board_t
)brace
id|board_t
suffix:semicolon
multiline_comment|/* indexed by board_t, above */
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|hw_flags
id|u32
id|hw_flags
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|board_info
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_string|&quot;RealTek RTL8139&quot;
comma
id|RTL8139_CAPS
)brace
comma
(brace
l_string|&quot;RealTek RTL8129&quot;
comma
id|RTL8129_CAPS
)brace
comma
)brace
suffix:semicolon
DECL|variable|rtl8139_pci_tbl
r_static
r_struct
id|pci_device_id
id|rtl8139_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x10ec
comma
l_int|0x8139
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x10ec
comma
l_int|0x8138
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1113
comma
l_int|0x1211
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1500
comma
l_int|0x1360
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x4033
comma
l_int|0x1360
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1186
comma
l_int|0x1300
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1186
comma
l_int|0x1340
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x13d1
comma
l_int|0xab06
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1259
comma
l_int|0xa117
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1259
comma
l_int|0xa11e
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x14ea
comma
l_int|0xab06
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x14ea
comma
l_int|0xab07
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x11db
comma
l_int|0x1234
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1432
comma
l_int|0x9130
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x02ac
comma
l_int|0x1012
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x018a
comma
l_int|0x0106
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x126c
comma
l_int|0x1211
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x1743
comma
l_int|0x8139
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0x021b
comma
l_int|0x8139
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
macro_line|#ifdef CONFIG_SH_SECUREEDGE5410
multiline_comment|/* Bogus 8139 silicon reports 8129 without external PROM :-( */
(brace
l_int|0x10ec
comma
l_int|0x8129
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
macro_line|#endif
macro_line|#ifdef CONFIG_8139TOO_8129
(brace
l_int|0x10ec
comma
l_int|0x8129
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|RTL8129
)brace
comma
macro_line|#endif
multiline_comment|/* some crazy cards report invalid vendor ids like&n;&t; * 0x0001 here.  The other ids are valid and constant,&n;&t; * so we simply don&squot;t match on the main vendor id.&n;&t; */
(brace
id|PCI_ANY_ID
comma
l_int|0x8139
comma
l_int|0x10ec
comma
l_int|0x8139
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
id|PCI_ANY_ID
comma
l_int|0x8139
comma
l_int|0x1186
comma
l_int|0x1300
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
id|PCI_ANY_ID
comma
l_int|0x8139
comma
l_int|0x13d1
comma
l_int|0xab06
comma
l_int|0
comma
l_int|0
comma
id|RTL8139
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|pci
comma
id|rtl8139_pci_tbl
)paren
suffix:semicolon
r_static
r_struct
(brace
DECL|member|str
r_const
r_char
id|str
(braket
id|ETH_GSTRING_LEN
)braket
suffix:semicolon
DECL|variable|ethtool_stats_keys
)brace
id|ethtool_stats_keys
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;early_rx&quot;
)brace
comma
(brace
l_string|&quot;tx_buf_mapped&quot;
)brace
comma
(brace
l_string|&quot;tx_timeouts&quot;
)brace
comma
(brace
l_string|&quot;rx_lost_in_ring&quot;
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* The rest of these values should never change. */
multiline_comment|/* Symbolic offsets to registers. */
DECL|enum|RTL8139_registers
r_enum
id|RTL8139_registers
(brace
DECL|enumerator|MAC0
id|MAC0
op_assign
l_int|0
comma
multiline_comment|/* Ethernet hardware address. */
DECL|enumerator|MAR0
id|MAR0
op_assign
l_int|8
comma
multiline_comment|/* Multicast filter. */
DECL|enumerator|TxStatus0
id|TxStatus0
op_assign
l_int|0x10
comma
multiline_comment|/* Transmit status (Four 32bit registers). */
DECL|enumerator|TxAddr0
id|TxAddr0
op_assign
l_int|0x20
comma
multiline_comment|/* Tx descriptors (also four 32bit). */
DECL|enumerator|RxBuf
id|RxBuf
op_assign
l_int|0x30
comma
DECL|enumerator|ChipCmd
id|ChipCmd
op_assign
l_int|0x37
comma
DECL|enumerator|RxBufPtr
id|RxBufPtr
op_assign
l_int|0x38
comma
DECL|enumerator|RxBufAddr
id|RxBufAddr
op_assign
l_int|0x3A
comma
DECL|enumerator|IntrMask
id|IntrMask
op_assign
l_int|0x3C
comma
DECL|enumerator|IntrStatus
id|IntrStatus
op_assign
l_int|0x3E
comma
DECL|enumerator|TxConfig
id|TxConfig
op_assign
l_int|0x40
comma
DECL|enumerator|RxConfig
id|RxConfig
op_assign
l_int|0x44
comma
DECL|enumerator|Timer
id|Timer
op_assign
l_int|0x48
comma
multiline_comment|/* A general-purpose counter. */
DECL|enumerator|RxMissed
id|RxMissed
op_assign
l_int|0x4C
comma
multiline_comment|/* 24 bits valid, write clears. */
DECL|enumerator|Cfg9346
id|Cfg9346
op_assign
l_int|0x50
comma
DECL|enumerator|Config0
id|Config0
op_assign
l_int|0x51
comma
DECL|enumerator|Config1
id|Config1
op_assign
l_int|0x52
comma
DECL|enumerator|FlashReg
id|FlashReg
op_assign
l_int|0x54
comma
DECL|enumerator|MediaStatus
id|MediaStatus
op_assign
l_int|0x58
comma
DECL|enumerator|Config3
id|Config3
op_assign
l_int|0x59
comma
DECL|enumerator|Config4
id|Config4
op_assign
l_int|0x5A
comma
multiline_comment|/* absent on RTL-8139A */
DECL|enumerator|HltClk
id|HltClk
op_assign
l_int|0x5B
comma
DECL|enumerator|MultiIntr
id|MultiIntr
op_assign
l_int|0x5C
comma
DECL|enumerator|TxSummary
id|TxSummary
op_assign
l_int|0x60
comma
DECL|enumerator|BasicModeCtrl
id|BasicModeCtrl
op_assign
l_int|0x62
comma
DECL|enumerator|BasicModeStatus
id|BasicModeStatus
op_assign
l_int|0x64
comma
DECL|enumerator|NWayAdvert
id|NWayAdvert
op_assign
l_int|0x66
comma
DECL|enumerator|NWayLPAR
id|NWayLPAR
op_assign
l_int|0x68
comma
DECL|enumerator|NWayExpansion
id|NWayExpansion
op_assign
l_int|0x6A
comma
multiline_comment|/* Undocumented registers, but required for proper operation. */
DECL|enumerator|FIFOTMS
id|FIFOTMS
op_assign
l_int|0x70
comma
multiline_comment|/* FIFO Control and test. */
DECL|enumerator|CSCR
id|CSCR
op_assign
l_int|0x74
comma
multiline_comment|/* Chip Status and Configuration Register. */
DECL|enumerator|PARA78
id|PARA78
op_assign
l_int|0x78
comma
DECL|enumerator|PARA7c
id|PARA7c
op_assign
l_int|0x7c
comma
multiline_comment|/* Magic transceiver parameter register. */
DECL|enumerator|Config5
id|Config5
op_assign
l_int|0xD8
comma
multiline_comment|/* absent on RTL-8139A */
)brace
suffix:semicolon
DECL|enum|ClearBitMasks
r_enum
id|ClearBitMasks
(brace
DECL|enumerator|MultiIntrClear
id|MultiIntrClear
op_assign
l_int|0xF000
comma
DECL|enumerator|ChipCmdClear
id|ChipCmdClear
op_assign
l_int|0xE2
comma
DECL|enumerator|Config1Clear
id|Config1Clear
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
op_or
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|3
)paren
op_or
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|enum|ChipCmdBits
r_enum
id|ChipCmdBits
(brace
DECL|enumerator|CmdReset
id|CmdReset
op_assign
l_int|0x10
comma
DECL|enumerator|CmdRxEnb
id|CmdRxEnb
op_assign
l_int|0x08
comma
DECL|enumerator|CmdTxEnb
id|CmdTxEnb
op_assign
l_int|0x04
comma
DECL|enumerator|RxBufEmpty
id|RxBufEmpty
op_assign
l_int|0x01
comma
)brace
suffix:semicolon
multiline_comment|/* Interrupt register bits, using my own meaningful names. */
DECL|enum|IntrStatusBits
r_enum
id|IntrStatusBits
(brace
DECL|enumerator|PCIErr
id|PCIErr
op_assign
l_int|0x8000
comma
DECL|enumerator|PCSTimeout
id|PCSTimeout
op_assign
l_int|0x4000
comma
DECL|enumerator|RxFIFOOver
id|RxFIFOOver
op_assign
l_int|0x40
comma
DECL|enumerator|RxUnderrun
id|RxUnderrun
op_assign
l_int|0x20
comma
DECL|enumerator|RxOverflow
id|RxOverflow
op_assign
l_int|0x10
comma
DECL|enumerator|TxErr
id|TxErr
op_assign
l_int|0x08
comma
DECL|enumerator|TxOK
id|TxOK
op_assign
l_int|0x04
comma
DECL|enumerator|RxErr
id|RxErr
op_assign
l_int|0x02
comma
DECL|enumerator|RxOK
id|RxOK
op_assign
l_int|0x01
comma
DECL|enumerator|RxAckBits
id|RxAckBits
op_assign
id|RxFIFOOver
op_or
id|RxOverflow
op_or
id|RxOK
comma
)brace
suffix:semicolon
DECL|enum|TxStatusBits
r_enum
id|TxStatusBits
(brace
DECL|enumerator|TxHostOwns
id|TxHostOwns
op_assign
l_int|0x2000
comma
DECL|enumerator|TxUnderrun
id|TxUnderrun
op_assign
l_int|0x4000
comma
DECL|enumerator|TxStatOK
id|TxStatOK
op_assign
l_int|0x8000
comma
DECL|enumerator|TxOutOfWindow
id|TxOutOfWindow
op_assign
l_int|0x20000000
comma
DECL|enumerator|TxAborted
id|TxAborted
op_assign
l_int|0x40000000
comma
DECL|enumerator|TxCarrierLost
id|TxCarrierLost
op_assign
l_int|0x80000000
comma
)brace
suffix:semicolon
DECL|enum|RxStatusBits
r_enum
id|RxStatusBits
(brace
DECL|enumerator|RxMulticast
id|RxMulticast
op_assign
l_int|0x8000
comma
DECL|enumerator|RxPhysical
id|RxPhysical
op_assign
l_int|0x4000
comma
DECL|enumerator|RxBroadcast
id|RxBroadcast
op_assign
l_int|0x2000
comma
DECL|enumerator|RxBadSymbol
id|RxBadSymbol
op_assign
l_int|0x0020
comma
DECL|enumerator|RxRunt
id|RxRunt
op_assign
l_int|0x0010
comma
DECL|enumerator|RxTooLong
id|RxTooLong
op_assign
l_int|0x0008
comma
DECL|enumerator|RxCRCErr
id|RxCRCErr
op_assign
l_int|0x0004
comma
DECL|enumerator|RxBadAlign
id|RxBadAlign
op_assign
l_int|0x0002
comma
DECL|enumerator|RxStatusOK
id|RxStatusOK
op_assign
l_int|0x0001
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in RxConfig. */
DECL|enum|rx_mode_bits
r_enum
id|rx_mode_bits
(brace
DECL|enumerator|AcceptErr
id|AcceptErr
op_assign
l_int|0x20
comma
DECL|enumerator|AcceptRunt
id|AcceptRunt
op_assign
l_int|0x10
comma
DECL|enumerator|AcceptBroadcast
id|AcceptBroadcast
op_assign
l_int|0x08
comma
DECL|enumerator|AcceptMulticast
id|AcceptMulticast
op_assign
l_int|0x04
comma
DECL|enumerator|AcceptMyPhys
id|AcceptMyPhys
op_assign
l_int|0x02
comma
DECL|enumerator|AcceptAllPhys
id|AcceptAllPhys
op_assign
l_int|0x01
comma
)brace
suffix:semicolon
multiline_comment|/* Bits in TxConfig. */
DECL|enum|tx_config_bits
r_enum
id|tx_config_bits
(brace
DECL|enumerator|TxIFG1
id|TxIFG1
op_assign
(paren
l_int|1
op_lshift
l_int|25
)paren
comma
multiline_comment|/* Interframe Gap Time */
DECL|enumerator|TxIFG0
id|TxIFG0
op_assign
(paren
l_int|1
op_lshift
l_int|24
)paren
comma
multiline_comment|/* Enabling these bits violates IEEE 802.3 */
DECL|enumerator|TxLoopBack
id|TxLoopBack
op_assign
(paren
l_int|1
op_lshift
l_int|18
)paren
op_or
(paren
l_int|1
op_lshift
l_int|17
)paren
comma
multiline_comment|/* enable loopback test mode */
DECL|enumerator|TxCRC
id|TxCRC
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
multiline_comment|/* DISABLE appending CRC to end of Tx packets */
DECL|enumerator|TxClearAbt
id|TxClearAbt
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* Clear abort (WO) */
DECL|enumerator|TxDMAShift
id|TxDMAShift
op_assign
l_int|8
comma
multiline_comment|/* DMA burst value (0-7) is shifted this many bits */
DECL|enumerator|TxRetryShift
id|TxRetryShift
op_assign
l_int|4
comma
multiline_comment|/* TXRR value (0-15) is shifted this many bits */
DECL|enumerator|TxVersionMask
id|TxVersionMask
op_assign
l_int|0x7C800000
comma
multiline_comment|/* mask out version bits 30-26, 23 */
)brace
suffix:semicolon
multiline_comment|/* Bits in Config1 */
DECL|enum|Config1Bits
r_enum
id|Config1Bits
(brace
DECL|enumerator|Cfg1_PM_Enable
id|Cfg1_PM_Enable
op_assign
l_int|0x01
comma
DECL|enumerator|Cfg1_VPD_Enable
id|Cfg1_VPD_Enable
op_assign
l_int|0x02
comma
DECL|enumerator|Cfg1_PIO
id|Cfg1_PIO
op_assign
l_int|0x04
comma
DECL|enumerator|Cfg1_MMIO
id|Cfg1_MMIO
op_assign
l_int|0x08
comma
DECL|enumerator|LWAKE
id|LWAKE
op_assign
l_int|0x10
comma
multiline_comment|/* not on 8139, 8139A */
DECL|enumerator|Cfg1_Driver_Load
id|Cfg1_Driver_Load
op_assign
l_int|0x20
comma
DECL|enumerator|Cfg1_LED0
id|Cfg1_LED0
op_assign
l_int|0x40
comma
DECL|enumerator|Cfg1_LED1
id|Cfg1_LED1
op_assign
l_int|0x80
comma
DECL|enumerator|SLEEP
id|SLEEP
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* only on 8139, 8139A */
DECL|enumerator|PWRDN
id|PWRDN
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* only on 8139, 8139A */
)brace
suffix:semicolon
multiline_comment|/* Bits in Config3 */
DECL|enum|Config3Bits
r_enum
id|Config3Bits
(brace
DECL|enumerator|Cfg3_FBtBEn
id|Cfg3_FBtBEn
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* 1 = Fast Back to Back */
DECL|enumerator|Cfg3_FuncRegEn
id|Cfg3_FuncRegEn
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* 1 = enable CardBus Function registers */
DECL|enumerator|Cfg3_CLKRUN_En
id|Cfg3_CLKRUN_En
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
multiline_comment|/* 1 = enable CLKRUN */
DECL|enumerator|Cfg3_CardB_En
id|Cfg3_CardB_En
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/* 1 = enable CardBus registers */
DECL|enumerator|Cfg3_LinkUp
id|Cfg3_LinkUp
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
multiline_comment|/* 1 = wake up on link up */
DECL|enumerator|Cfg3_Magic
id|Cfg3_Magic
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
multiline_comment|/* 1 = wake up on Magic Packet (tm) */
DECL|enumerator|Cfg3_PARM_En
id|Cfg3_PARM_En
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* 0 = software can set twister parameters */
DECL|enumerator|Cfg3_GNTSel
id|Cfg3_GNTSel
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
multiline_comment|/* 1 = delay 1 clock from PCI GNT signal */
)brace
suffix:semicolon
multiline_comment|/* Bits in Config4 */
DECL|enum|Config4Bits
r_enum
id|Config4Bits
(brace
DECL|enumerator|LWPTN
id|LWPTN
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
multiline_comment|/* not on 8139, 8139A */
)brace
suffix:semicolon
multiline_comment|/* Bits in Config5 */
DECL|enum|Config5Bits
r_enum
id|Config5Bits
(brace
DECL|enumerator|Cfg5_PME_STS
id|Cfg5_PME_STS
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* 1 = PCI reset resets PME_Status */
DECL|enumerator|Cfg5_LANWake
id|Cfg5_LANWake
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* 1 = enable LANWake signal */
DECL|enumerator|Cfg5_LDPS
id|Cfg5_LDPS
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
multiline_comment|/* 0 = save power when link is down */
DECL|enumerator|Cfg5_FIFOAddrPtr
id|Cfg5_FIFOAddrPtr
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/* Realtek internal SRAM testing */
DECL|enumerator|Cfg5_UWF
id|Cfg5_UWF
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
multiline_comment|/* 1 = accept unicast wakeup frame */
DECL|enumerator|Cfg5_MWF
id|Cfg5_MWF
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
multiline_comment|/* 1 = accept multicast wakeup frame */
DECL|enumerator|Cfg5_BWF
id|Cfg5_BWF
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* 1 = accept broadcast wakeup frame */
)brace
suffix:semicolon
DECL|enum|RxConfigBits
r_enum
id|RxConfigBits
(brace
multiline_comment|/* rx fifo threshold */
DECL|enumerator|RxCfgFIFOShift
id|RxCfgFIFOShift
op_assign
l_int|13
comma
DECL|enumerator|RxCfgFIFONone
id|RxCfgFIFONone
op_assign
(paren
l_int|7
op_lshift
id|RxCfgFIFOShift
)paren
comma
multiline_comment|/* Max DMA burst */
DECL|enumerator|RxCfgDMAShift
id|RxCfgDMAShift
op_assign
l_int|8
comma
DECL|enumerator|RxCfgDMAUnlimited
id|RxCfgDMAUnlimited
op_assign
(paren
l_int|7
op_lshift
id|RxCfgDMAShift
)paren
comma
multiline_comment|/* rx ring buffer length */
DECL|enumerator|RxCfgRcv8K
id|RxCfgRcv8K
op_assign
l_int|0
comma
DECL|enumerator|RxCfgRcv16K
id|RxCfgRcv16K
op_assign
(paren
l_int|1
op_lshift
l_int|11
)paren
comma
DECL|enumerator|RxCfgRcv32K
id|RxCfgRcv32K
op_assign
(paren
l_int|1
op_lshift
l_int|12
)paren
comma
DECL|enumerator|RxCfgRcv64K
id|RxCfgRcv64K
op_assign
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
comma
multiline_comment|/* Disable packet wrap at end of Rx buffer. (not possible with 64k) */
DECL|enumerator|RxNoWrap
id|RxNoWrap
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* Twister tuning parameters from RealTek.&n;   Completely undocumented, but required to tune bad links on some boards. */
DECL|enum|CSCRBits
r_enum
id|CSCRBits
(brace
DECL|enumerator|CSCR_LinkOKBit
id|CSCR_LinkOKBit
op_assign
l_int|0x0400
comma
DECL|enumerator|CSCR_LinkChangeBit
id|CSCR_LinkChangeBit
op_assign
l_int|0x0800
comma
DECL|enumerator|CSCR_LinkStatusBits
id|CSCR_LinkStatusBits
op_assign
l_int|0x0f000
comma
DECL|enumerator|CSCR_LinkDownOffCmd
id|CSCR_LinkDownOffCmd
op_assign
l_int|0x003c0
comma
DECL|enumerator|CSCR_LinkDownCmd
id|CSCR_LinkDownCmd
op_assign
l_int|0x0f3c0
comma
)brace
suffix:semicolon
DECL|enum|Cfg9346Bits
r_enum
id|Cfg9346Bits
(brace
DECL|enumerator|Cfg9346_Lock
id|Cfg9346_Lock
op_assign
l_int|0x00
comma
DECL|enumerator|Cfg9346_Unlock
id|Cfg9346_Unlock
op_assign
l_int|0xC0
comma
)brace
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|CH_8139
id|CH_8139
op_assign
l_int|0
comma
DECL|enumerator|CH_8139_K
id|CH_8139_K
comma
DECL|enumerator|CH_8139A
id|CH_8139A
comma
DECL|enumerator|CH_8139A_G
id|CH_8139A_G
comma
DECL|enumerator|CH_8139B
id|CH_8139B
comma
DECL|enumerator|CH_8130
id|CH_8130
comma
DECL|enumerator|CH_8139C
id|CH_8139C
comma
DECL|enumerator|CH_8100
id|CH_8100
comma
DECL|enumerator|CH_8100B_8139D
id|CH_8100B_8139D
comma
DECL|enumerator|CH_8101
id|CH_8101
comma
DECL|typedef|chip_t
)brace
id|chip_t
suffix:semicolon
DECL|enum|chip_flags
r_enum
id|chip_flags
(brace
DECL|enumerator|HasHltClk
id|HasHltClk
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
DECL|enumerator|HasLWake
id|HasLWake
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|macro|HW_REVID
mdefine_line|#define HW_REVID(b30, b29, b28, b27, b26, b23, b22) &bslash;&n;&t;(b30&lt;&lt;30 | b29&lt;&lt;29 | b28&lt;&lt;28 | b27&lt;&lt;27 | b26&lt;&lt;26 | b23&lt;&lt;23 | b22&lt;&lt;22)
DECL|macro|HW_REVID_MASK
mdefine_line|#define HW_REVID_MASK&t;HW_REVID(1, 1, 1, 1, 1, 1, 1)
multiline_comment|/* directly indexed by chip_t, above */
r_const
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|version
id|u32
id|version
suffix:semicolon
multiline_comment|/* from RTL8139C/RTL8139D docs */
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|variable|rtl_chip_info
)brace
id|rtl_chip_info
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;RTL-8139&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasHltClk
comma
)brace
comma
(brace
l_string|&quot;RTL-8139 rev K&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasHltClk
comma
)brace
comma
(brace
l_string|&quot;RTL-8139A&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasHltClk
comma
multiline_comment|/* XXX undocumented? */
)brace
comma
(brace
l_string|&quot;RTL-8139A rev G&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|HasHltClk
comma
multiline_comment|/* XXX undocumented? */
)brace
comma
(brace
l_string|&quot;RTL-8139B&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasLWake
comma
)brace
comma
(brace
l_string|&quot;RTL-8130&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasLWake
comma
)brace
comma
(brace
l_string|&quot;RTL-8139C&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
comma
id|HasLWake
comma
)brace
comma
(brace
l_string|&quot;RTL-8100&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|HasLWake
comma
)brace
comma
(brace
l_string|&quot;RTL-8100B/8139D&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|1
)paren
comma
id|HasLWake
comma
)brace
comma
(brace
l_string|&quot;RTL-8101&quot;
comma
id|HW_REVID
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|1
)paren
comma
id|HasLWake
comma
)brace
comma
)brace
suffix:semicolon
DECL|struct|rtl_extra_stats
r_struct
id|rtl_extra_stats
(brace
DECL|member|early_rx
r_int
r_int
id|early_rx
suffix:semicolon
DECL|member|tx_buf_mapped
r_int
r_int
id|tx_buf_mapped
suffix:semicolon
DECL|member|tx_timeouts
r_int
r_int
id|tx_timeouts
suffix:semicolon
DECL|member|rx_lost_in_ring
r_int
r_int
id|rx_lost_in_ring
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|rtl8139_private
r_struct
id|rtl8139_private
(brace
DECL|member|mmio_addr
r_void
op_star
id|mmio_addr
suffix:semicolon
DECL|member|drv_flags
r_int
id|drv_flags
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|pci_state
id|u32
id|pci_state
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|msg_enable
id|u32
id|msg_enable
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|rx_ring
r_int
r_char
op_star
id|rx_ring
suffix:semicolon
DECL|member|cur_rx
r_int
r_int
id|cur_rx
suffix:semicolon
multiline_comment|/* Index into the Rx buffer of next Rx pkt. */
DECL|member|tx_flag
r_int
r_int
id|tx_flag
suffix:semicolon
DECL|member|cur_tx
r_int
r_int
id|cur_tx
suffix:semicolon
DECL|member|dirty_tx
r_int
r_int
id|dirty_tx
suffix:semicolon
DECL|member|tx_buf
r_int
r_char
op_star
id|tx_buf
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
multiline_comment|/* Tx bounce buffers */
DECL|member|tx_bufs
r_int
r_char
op_star
id|tx_bufs
suffix:semicolon
multiline_comment|/* Tx bounce buffer region. */
DECL|member|rx_ring_dma
id|dma_addr_t
id|rx_ring_dma
suffix:semicolon
DECL|member|tx_bufs_dma
id|dma_addr_t
id|tx_bufs_dma
suffix:semicolon
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|twistie
DECL|member|twist_row
DECL|member|twist_col
r_char
id|twistie
comma
id|twist_row
comma
id|twist_col
suffix:semicolon
multiline_comment|/* Twister tune state. */
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|rx_lock
id|spinlock_t
id|rx_lock
suffix:semicolon
DECL|member|chipset
id|chip_t
id|chipset
suffix:semicolon
DECL|member|thr_pid
id|pid_t
id|thr_pid
suffix:semicolon
DECL|member|thr_wait
id|wait_queue_head_t
id|thr_wait
suffix:semicolon
DECL|member|thr_exited
r_struct
id|completion
id|thr_exited
suffix:semicolon
DECL|member|rx_config
id|u32
id|rx_config
suffix:semicolon
DECL|member|xstats
r_struct
id|rtl_extra_stats
id|xstats
suffix:semicolon
DECL|member|time_to_die
r_int
id|time_to_die
suffix:semicolon
DECL|member|mii
r_struct
id|mii_if_info
id|mii
suffix:semicolon
DECL|member|regs_len
r_int
r_int
id|regs_len
suffix:semicolon
)brace
suffix:semicolon
id|MODULE_AUTHOR
(paren
l_string|&quot;Jeff Garzik &lt;jgarzik@pobox.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;RealTek RTL-8139 Fast Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|media
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|debug
comma
l_string|&quot;8139too bitmapped message enable number&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|multicast_filter_limit
comma
l_string|&quot;8139too maximum number of filtered multicast addresses&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|media
comma
l_string|&quot;8139too: Bits 4+9: force full duplex, bit 5: 100Mbps&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|full_duplex
comma
l_string|&quot;8139too: Force full duplex for board(s) (1)&quot;
)paren
suffix:semicolon
r_static
r_int
id|read_eeprom
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|location
comma
r_int
id|addr_len
)paren
suffix:semicolon
r_static
r_int
id|rtl8139_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_inline
r_void
id|rtl8139_start_thread
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8139_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8139_init_ring
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|rtl8139_start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|rtl8139_poll
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
op_star
id|budget
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
r_static
r_void
id|rtl8139_poll_controller
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif
r_static
id|irqreturn_t
id|rtl8139_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|rtl8139_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|netdev_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|rtl8139_get_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8139_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|__set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8139_hw_start
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|rtl8139_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|rtl8139_ethtool_ops
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
DECL|macro|RTL_R8
mdefine_line|#define RTL_R8(reg)&t;&t;inb (((unsigned long)ioaddr) + (reg))
DECL|macro|RTL_R16
mdefine_line|#define RTL_R16(reg)&t;&t;inw (((unsigned long)ioaddr) + (reg))
DECL|macro|RTL_R32
mdefine_line|#define RTL_R32(reg)&t;&t;((unsigned long) inl (((unsigned long)ioaddr) + (reg)))
DECL|macro|RTL_W8
mdefine_line|#define RTL_W8(reg, val8)&t;outb ((val8), ((unsigned long)ioaddr) + (reg))
DECL|macro|RTL_W16
mdefine_line|#define RTL_W16(reg, val16)&t;outw ((val16), ((unsigned long)ioaddr) + (reg))
DECL|macro|RTL_W32
mdefine_line|#define RTL_W32(reg, val32)&t;outl ((val32), ((unsigned long)ioaddr) + (reg))
DECL|macro|RTL_W8_F
mdefine_line|#define RTL_W8_F&t;&t;RTL_W8
DECL|macro|RTL_W16_F
mdefine_line|#define RTL_W16_F&t;&t;RTL_W16
DECL|macro|RTL_W32_F
mdefine_line|#define RTL_W32_F&t;&t;RTL_W32
DECL|macro|readb
macro_line|#undef readb
DECL|macro|readw
macro_line|#undef readw
DECL|macro|readl
macro_line|#undef readl
DECL|macro|writeb
macro_line|#undef writeb
DECL|macro|writew
macro_line|#undef writew
DECL|macro|writel
macro_line|#undef writel
DECL|macro|readb
mdefine_line|#define readb(addr) inb((unsigned long)(addr))
DECL|macro|readw
mdefine_line|#define readw(addr) inw((unsigned long)(addr))
DECL|macro|readl
mdefine_line|#define readl(addr) inl((unsigned long)(addr))
DECL|macro|writeb
mdefine_line|#define writeb(val,addr) outb((val),(unsigned long)(addr))
DECL|macro|writew
mdefine_line|#define writew(val,addr) outw((val),(unsigned long)(addr))
DECL|macro|writel
mdefine_line|#define writel(val,addr) outl((val),(unsigned long)(addr))
macro_line|#else
multiline_comment|/* write MMIO register, with flush */
multiline_comment|/* Flush avoids rtl8139 bug w/ posted MMIO writes */
DECL|macro|RTL_W8_F
mdefine_line|#define RTL_W8_F(reg, val8)&t;do { writeb ((val8), ioaddr + (reg)); readb (ioaddr + (reg)); } while (0)
DECL|macro|RTL_W16_F
mdefine_line|#define RTL_W16_F(reg, val16)&t;do { writew ((val16), ioaddr + (reg)); readw (ioaddr + (reg)); } while (0)
DECL|macro|RTL_W32_F
mdefine_line|#define RTL_W32_F(reg, val32)&t;do { writel ((val32), ioaddr + (reg)); readl (ioaddr + (reg)); } while (0)
DECL|macro|MMIO_FLUSH_AUDIT_COMPLETE
mdefine_line|#define MMIO_FLUSH_AUDIT_COMPLETE 1
macro_line|#if MMIO_FLUSH_AUDIT_COMPLETE
multiline_comment|/* write MMIO register */
DECL|macro|RTL_W8
mdefine_line|#define RTL_W8(reg, val8)&t;writeb ((val8), ioaddr + (reg))
DECL|macro|RTL_W16
mdefine_line|#define RTL_W16(reg, val16)&t;writew ((val16), ioaddr + (reg))
DECL|macro|RTL_W32
mdefine_line|#define RTL_W32(reg, val32)&t;writel ((val32), ioaddr + (reg))
macro_line|#else
multiline_comment|/* write MMIO register, then flush */
DECL|macro|RTL_W8
mdefine_line|#define RTL_W8&t;&t;RTL_W8_F
DECL|macro|RTL_W16
mdefine_line|#define RTL_W16&t;&t;RTL_W16_F
DECL|macro|RTL_W32
mdefine_line|#define RTL_W32&t;&t;RTL_W32_F
macro_line|#endif /* MMIO_FLUSH_AUDIT_COMPLETE */
multiline_comment|/* read MMIO register */
DECL|macro|RTL_R8
mdefine_line|#define RTL_R8(reg)&t;&t;readb (ioaddr + (reg))
DECL|macro|RTL_R16
mdefine_line|#define RTL_R16(reg)&t;&t;readw (ioaddr + (reg))
DECL|macro|RTL_R32
mdefine_line|#define RTL_R32(reg)&t;&t;((unsigned long) readl (ioaddr + (reg)))
macro_line|#endif /* USE_IO_OPS */
DECL|variable|rtl8139_intr_mask
r_static
r_const
id|u16
id|rtl8139_intr_mask
op_assign
id|PCIErr
op_or
id|PCSTimeout
op_or
id|RxUnderrun
op_or
id|RxOverflow
op_or
id|RxFIFOOver
op_or
id|TxErr
op_or
id|TxOK
op_or
id|RxErr
op_or
id|RxOK
suffix:semicolon
DECL|variable|rtl8139_norx_intr_mask
r_static
r_const
id|u16
id|rtl8139_norx_intr_mask
op_assign
id|PCIErr
op_or
id|PCSTimeout
op_or
id|RxUnderrun
op_or
id|TxErr
op_or
id|TxOK
op_or
id|RxErr
suffix:semicolon
macro_line|#if RX_BUF_IDX == 0
DECL|variable|rtl8139_rx_config
r_static
r_const
r_int
r_int
id|rtl8139_rx_config
op_assign
id|RxCfgRcv8K
op_or
id|RxNoWrap
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
macro_line|#elif RX_BUF_IDX == 1
DECL|variable|rtl8139_rx_config
r_static
r_const
r_int
r_int
id|rtl8139_rx_config
op_assign
id|RxCfgRcv16K
op_or
id|RxNoWrap
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
macro_line|#elif RX_BUF_IDX == 2
DECL|variable|rtl8139_rx_config
r_static
r_const
r_int
r_int
id|rtl8139_rx_config
op_assign
id|RxCfgRcv32K
op_or
id|RxNoWrap
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
macro_line|#elif RX_BUF_IDX == 3
DECL|variable|rtl8139_rx_config
r_static
r_const
r_int
r_int
id|rtl8139_rx_config
op_assign
id|RxCfgRcv64K
op_or
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
macro_line|#else
macro_line|#error &quot;Invalid configuration for 8139_RXBUF_IDX&quot;
macro_line|#endif
DECL|variable|rtl8139_tx_config
r_static
r_const
r_int
r_int
id|rtl8139_tx_config
op_assign
(paren
id|TX_DMA_BURST
op_lshift
id|TxDMAShift
)paren
op_or
(paren
id|TX_RETRY
op_lshift
id|TxRetryShift
)paren
suffix:semicolon
DECL|function|__rtl8139_cleanup_dev
r_static
r_void
id|__rtl8139_cleanup_dev
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev-&gt;priv
op_ne
l_int|NULL
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|tp-&gt;pci_dev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|pdev
op_assign
id|tp-&gt;pci_dev
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
r_if
c_cond
(paren
id|tp-&gt;mmio_addr
)paren
id|iounmap
(paren
id|tp-&gt;mmio_addr
)paren
suffix:semicolon
macro_line|#endif /* !USE_IO_OPS */
multiline_comment|/* it&squot;s ok to call this even if we have no regions to free */
id|pci_release_regions
(paren
id|pdev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_chip_reset
r_static
r_void
id|rtl8139_chip_reset
(paren
r_void
op_star
id|ioaddr
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|RTL_W8
(paren
id|ChipCmd
comma
id|CmdReset
)paren
suffix:semicolon
multiline_comment|/* Check that the chip has finished the reset. */
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|RTL_R8
(paren
id|ChipCmd
)paren
op_amp
id|CmdReset
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
DECL|function|rtl8139_init_board
r_static
r_int
id|__devinit
id|rtl8139_init_board
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|net_device
op_star
op_star
id|dev_out
)paren
(brace
r_void
op_star
id|ioaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u32
id|pio_start
comma
id|pio_end
comma
id|pio_flags
comma
id|pio_len
suffix:semicolon
r_int
r_int
id|mmio_start
comma
id|mmio_end
comma
id|mmio_flags
comma
id|mmio_len
suffix:semicolon
id|u32
id|version
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
op_star
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* dev and dev-&gt;priv zeroed in alloc_etherdev */
id|dev
op_assign
id|alloc_etherdev
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Unable to alloc new net device&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
multiline_comment|/* enable device (incl. PCI PM wakeup and hotplug setup) */
id|rc
op_assign
id|pci_enable_device
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out
suffix:semicolon
id|pio_start
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|pio_end
op_assign
id|pci_resource_end
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|pio_flags
op_assign
id|pci_resource_flags
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|pio_len
op_assign
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|mmio_start
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_end
op_assign
id|pci_resource_end
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_flags
op_assign
id|pci_resource_flags
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_len
op_assign
id|pci_resource_len
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* set this immediately, we need to know before&n;&t; * we talk to the chip directly */
id|DPRINTK
c_func
(paren
l_string|&quot;PIO region size == 0x%02X&bslash;n&quot;
comma
id|pio_len
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;MMIO region size == 0x%02lX&bslash;n&quot;
comma
id|mmio_len
)paren
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
multiline_comment|/* make sure PCI base addr 0 is PIO */
r_if
c_cond
(paren
op_logical_neg
(paren
id|pio_flags
op_amp
id|IORESOURCE_IO
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: region #0 not a PIO resource, aborting&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* check for weird/broken PCI region reporting */
r_if
c_cond
(paren
id|pio_len
OL
id|RTL_MIN_IO_SIZE
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Invalid PCI I/O region size(s), aborting&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
macro_line|#else
multiline_comment|/* make sure PCI base addr 1 is MMIO */
r_if
c_cond
(paren
op_logical_neg
(paren
id|mmio_flags
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: region #1 not an MMIO resource, aborting&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mmio_len
OL
id|RTL_MIN_IO_SIZE
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Invalid PCI mem region size(s), aborting&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
macro_line|#endif
id|rc
op_assign
id|pci_request_regions
(paren
id|pdev
comma
l_string|&quot;8139too&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out
suffix:semicolon
multiline_comment|/* enable PCI bus-mastering */
id|pci_set_master
(paren
id|pdev
)paren
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
id|ioaddr
op_assign
(paren
r_void
op_star
)paren
id|pio_start
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|pio_start
suffix:semicolon
id|tp-&gt;mmio_addr
op_assign
id|ioaddr
suffix:semicolon
id|tp-&gt;regs_len
op_assign
id|pio_len
suffix:semicolon
macro_line|#else
multiline_comment|/* ioremap MMIO region */
id|ioaddr
op_assign
id|ioremap
(paren
id|mmio_start
comma
id|mmio_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioaddr
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: cannot remap MMIO, aborting&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
(paren
r_int
)paren
id|ioaddr
suffix:semicolon
id|tp-&gt;mmio_addr
op_assign
id|ioaddr
suffix:semicolon
id|tp-&gt;regs_len
op_assign
id|mmio_len
suffix:semicolon
macro_line|#endif /* USE_IO_OPS */
multiline_comment|/* Bring old chips out of low-power mode. */
id|RTL_W8
(paren
id|HltClk
comma
l_char|&squot;R&squot;
)paren
suffix:semicolon
multiline_comment|/* check for missing/broken hardware */
r_if
c_cond
(paren
id|RTL_R32
(paren
id|TxConfig
)paren
op_eq
l_int|0xFFFFFFFF
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Chip not responding, ignoring board&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* identify chip attached to board */
id|version
op_assign
id|RTL_R32
(paren
id|TxConfig
)paren
op_amp
id|HW_REVID_MASK
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
(paren
id|rtl_chip_info
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|version
op_eq
id|rtl_chip_info
(braket
id|i
)braket
dot
id|version
)paren
(brace
id|tp-&gt;chipset
op_assign
id|i
suffix:semicolon
r_goto
id|match
suffix:semicolon
)brace
multiline_comment|/* if unknown chip, assume array element #0, original RTL-8139 in this case */
id|printk
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;%s: unknown chip version, assuming RTL-8139&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
)paren
suffix:semicolon
id|printk
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;%s: TxConfig = 0x%lx&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
comma
id|RTL_R32
(paren
id|TxConfig
)paren
)paren
suffix:semicolon
id|tp-&gt;chipset
op_assign
l_int|0
suffix:semicolon
id|match
suffix:colon
id|DPRINTK
(paren
l_string|&quot;chipset id (%d) == index %d, &squot;%s&squot;&bslash;n&quot;
comma
id|version
comma
id|i
comma
id|rtl_chip_info
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chipset
op_ge
id|CH_8139B
)paren
(brace
id|u8
id|new_tmp8
op_assign
id|tmp8
op_assign
id|RTL_R8
(paren
id|Config1
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;PCI PM wakeup&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasLWake
)paren
op_logical_and
(paren
id|tmp8
op_amp
id|LWAKE
)paren
)paren
id|new_tmp8
op_and_assign
op_complement
id|LWAKE
suffix:semicolon
id|new_tmp8
op_or_assign
id|Cfg1_PM_Enable
suffix:semicolon
r_if
c_cond
(paren
id|new_tmp8
op_ne
id|tmp8
)paren
(brace
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Config1
comma
id|tmp8
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasLWake
)paren
(brace
id|tmp8
op_assign
id|RTL_R8
(paren
id|Config4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp8
op_amp
id|LWPTN
)paren
(brace
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Config4
comma
id|tmp8
op_amp
op_complement
id|LWPTN
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Old chip wakeup&bslash;n&quot;
)paren
suffix:semicolon
id|tmp8
op_assign
id|RTL_R8
(paren
id|Config1
)paren
suffix:semicolon
id|tmp8
op_and_assign
op_complement
(paren
id|SLEEP
op_or
id|PWRDN
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Config1
comma
id|tmp8
)paren
suffix:semicolon
)brace
id|rtl8139_chip_reset
(paren
id|ioaddr
)paren
suffix:semicolon
op_star
id|dev_out
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|__rtl8139_cleanup_dev
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|rtl8139_init_one
r_static
r_int
id|__devinit
id|rtl8139_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
suffix:semicolon
r_int
id|i
comma
id|addr_len
comma
id|option
suffix:semicolon
r_void
op_star
id|ioaddr
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
id|u8
id|pci_rev
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ent
op_ne
l_int|NULL
)paren
suffix:semicolon
id|board_idx
op_increment
suffix:semicolon
multiline_comment|/* when we&squot;re built into the kernel, the driver version message&n;&t; * is only printed if at least one 8139 board has been found&n;&t; */
macro_line|#ifndef MODULE
(brace
r_static
r_int
id|printed_version
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
(paren
id|KERN_INFO
id|RTL8139_DRIVER_NAME
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|pci_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_REALTEK
op_logical_and
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_REALTEK_8139
op_logical_and
id|pci_rev
op_ge
l_int|0x20
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;pci dev %s (id %04x:%04x rev %02x) is an enhanced 8139C+ chip&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
comma
id|pdev-&gt;vendor
comma
id|pdev-&gt;device
comma
id|pci_rev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Use the &bslash;&quot;8139cp&bslash;&quot; driver for improved performance and stability.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|i
op_assign
id|rtl8139_init_board
(paren
id|pdev
comma
op_amp
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
r_return
id|i
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|addr_len
op_assign
id|read_eeprom
(paren
id|ioaddr
comma
l_int|0
comma
l_int|8
)paren
op_eq
l_int|0x8129
ques
c_cond
l_int|8
suffix:colon
l_int|6
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
(paren
id|read_eeprom
(paren
id|ioaddr
comma
id|i
op_plus
l_int|7
comma
id|addr_len
)paren
)paren
suffix:semicolon
multiline_comment|/* The Rtl8139-specific entries in the device structure. */
id|dev-&gt;open
op_assign
id|rtl8139_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|rtl8139_start_xmit
suffix:semicolon
id|dev-&gt;poll
op_assign
id|rtl8139_poll
suffix:semicolon
id|dev-&gt;weight
op_assign
l_int|64
suffix:semicolon
id|dev-&gt;stop
op_assign
id|rtl8139_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|rtl8139_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|rtl8139_set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|netdev_ioctl
suffix:semicolon
id|dev-&gt;ethtool_ops
op_assign
op_amp
id|rtl8139_ethtool_ops
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|rtl8139_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
id|dev-&gt;poll_controller
op_assign
id|rtl8139_poll_controller
suffix:semicolon
macro_line|#endif
multiline_comment|/* note: the hardware is not capable of sg/csum/highdma, however&n;&t; * through the use of skb_copy_and_csum_dev we enable these&n;&t; * features&n;&t; */
id|dev-&gt;features
op_or_assign
id|NETIF_F_SG
op_or
id|NETIF_F_HW_CSUM
op_or
id|NETIF_F_HIGHDMA
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
multiline_comment|/* dev-&gt;priv/tp zeroed and aligned in alloc_etherdev */
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* note: tp-&gt;chipset set in rtl8139_init_board */
id|tp-&gt;drv_flags
op_assign
id|board_info
(braket
id|ent-&gt;driver_data
)braket
dot
id|hw_flags
suffix:semicolon
id|tp-&gt;mmio_addr
op_assign
id|ioaddr
suffix:semicolon
id|tp-&gt;msg_enable
op_assign
(paren
id|debug
OL
l_int|0
ques
c_cond
id|RTL8139_DEF_MSG_ENABLE
suffix:colon
(paren
(paren
l_int|1
op_lshift
id|debug
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|tp-&gt;rx_lock
)paren
suffix:semicolon
id|init_waitqueue_head
(paren
op_amp
id|tp-&gt;thr_wait
)paren
suffix:semicolon
id|init_completion
(paren
op_amp
id|tp-&gt;thr_exited
)paren
suffix:semicolon
id|tp-&gt;mii.dev
op_assign
id|dev
suffix:semicolon
id|tp-&gt;mii.mdio_read
op_assign
id|mdio_read
suffix:semicolon
id|tp-&gt;mii.mdio_write
op_assign
id|mdio_write
suffix:semicolon
id|tp-&gt;mii.phy_id_mask
op_assign
l_int|0x3f
suffix:semicolon
id|tp-&gt;mii.reg_num_mask
op_assign
l_int|0x1f
suffix:semicolon
multiline_comment|/* dev is fully set up and ready to use now */
id|DPRINTK
c_func
(paren
l_string|&quot;about to register device named %s (%p)...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
id|i
op_assign
id|register_netdev
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_goto
id|err_out
suffix:semicolon
id|pci_set_drvdata
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
l_string|&quot;%2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x, &quot;
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|board_info
(braket
id|ent-&gt;driver_data
)braket
dot
id|name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Identified 8139 chip type &squot;%s&squot;&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|name
)paren
suffix:semicolon
multiline_comment|/* Find the connected MII xcvrs.&n;&t;   Doing this in open() would allow detecting external xcvrs later, but&n;&t;   takes too much time. */
macro_line|#ifdef CONFIG_8139TOO_8129
r_if
c_cond
(paren
id|tp-&gt;drv_flags
op_amp
id|HAS_MII_XCVR
)paren
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|0
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|tp-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|u16
id|advertising
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|4
)paren
suffix:semicolon
id|tp-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII transceiver %d status 0x%4.4x &quot;
l_string|&quot;advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_status
comma
id|advertising
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No MII transceivers found!  Assuming SYM &quot;
l_string|&quot;transceiver.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|32
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|32
suffix:semicolon
id|tp-&gt;mii.phy_id
op_assign
id|tp-&gt;phys
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
id|option
op_assign
(paren
id|board_idx
op_ge
id|MAX_UNITS
)paren
ques
c_cond
l_int|0
suffix:colon
id|media
(braket
id|board_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|option
OG
l_int|0
)paren
(brace
id|tp-&gt;mii.full_duplex
op_assign
(paren
id|option
op_amp
l_int|0x210
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;default_port
op_assign
id|option
op_amp
l_int|0xFF
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;default_port
)paren
id|tp-&gt;mii.force_media
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|board_idx
template_param
l_int|0
)paren
id|tp-&gt;mii.full_duplex
op_assign
id|full_duplex
(braket
id|board_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mii.full_duplex
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media type forced to Full Duplex.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Changing the MII-advertised media because might prevent&n;&t;&t;   re-connection. */
id|tp-&gt;mii.force_media
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;default_port
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;  Forcing %dMbps %s-duplex operation.&bslash;n&quot;
comma
(paren
id|option
op_amp
l_int|0x20
ques
c_cond
l_int|100
suffix:colon
l_int|10
)paren
comma
(paren
id|option
op_amp
l_int|0x10
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|0
comma
(paren
(paren
id|option
op_amp
l_int|0x20
)paren
ques
c_cond
l_int|0x2000
suffix:colon
l_int|0
)paren
op_or
multiline_comment|/* 100Mbps? */
(paren
(paren
id|option
op_amp
l_int|0x10
)paren
ques
c_cond
l_int|0x0100
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* Full duplex? */
)brace
multiline_comment|/* Put the chip into low-power mode. */
r_if
c_cond
(paren
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasHltClk
)paren
id|RTL_W8
(paren
id|HltClk
comma
l_char|&squot;H&squot;
)paren
suffix:semicolon
multiline_comment|/* &squot;R&squot; would leave the clock running. */
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|__rtl8139_cleanup_dev
(paren
id|dev
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|rtl8139_remove_one
r_static
r_void
id|__devexit
id|rtl8139_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|np
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|np
op_ne
l_int|NULL
)paren
suffix:semicolon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|__rtl8139_cleanup_dev
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Serial EEPROM section. */
multiline_comment|/*  EEPROM_Ctrl bits. */
DECL|macro|EE_SHIFT_CLK
mdefine_line|#define EE_SHIFT_CLK&t;0x04&t;/* EEPROM shift clock. */
DECL|macro|EE_CS
mdefine_line|#define EE_CS&t;&t;&t;0x08&t;/* EEPROM chip select. */
DECL|macro|EE_DATA_WRITE
mdefine_line|#define EE_DATA_WRITE&t;0x02&t;/* EEPROM chip data in. */
DECL|macro|EE_WRITE_0
mdefine_line|#define EE_WRITE_0&t;&t;0x00
DECL|macro|EE_WRITE_1
mdefine_line|#define EE_WRITE_1&t;&t;0x02
DECL|macro|EE_DATA_READ
mdefine_line|#define EE_DATA_READ&t;0x01&t;/* EEPROM chip data out. */
DECL|macro|EE_ENB
mdefine_line|#define EE_ENB&t;&t;&t;(0x80 | EE_CS)
multiline_comment|/* Delay between EEPROM clock transitions.&n;   No extra delay is needed with 33Mhz PCI, but 66Mhz may change this.&n; */
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay()&t;readl(ee_addr)
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|macro|EE_WRITE_CMD
mdefine_line|#define EE_WRITE_CMD&t;(5)
DECL|macro|EE_READ_CMD
mdefine_line|#define EE_READ_CMD&t;&t;(6)
DECL|macro|EE_ERASE_CMD
mdefine_line|#define EE_ERASE_CMD&t;(7)
DECL|function|read_eeprom
r_static
r_int
id|__devinit
id|read_eeprom
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|location
comma
r_int
id|addr_len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_void
op_star
id|ee_addr
op_assign
id|ioaddr
op_plus
id|Cfg9346
suffix:semicolon
r_int
id|read_cmd
op_assign
id|location
op_or
(paren
id|EE_READ_CMD
op_lshift
id|addr_len
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|4
op_plus
id|addr_len
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_DATA_WRITE
suffix:colon
l_int|0
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_or
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_or
id|dataval
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
)brace
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writeb
(paren
id|EE_ENB
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readb
(paren
id|ee_addr
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|writeb
(paren
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* MII serial management: mostly bogus for now. */
multiline_comment|/* Read and write the MII management registers using software-generated&n;   serial MDIO protocol.&n;   The maximum data clock rate is 2.5 Mhz.  The minimum timing is usually&n;   met by back-to-back PCI I/O cycles, but we insert a delay to avoid&n;   &quot;overclocking&quot; issues. */
DECL|macro|MDIO_DIR
mdefine_line|#define MDIO_DIR&t;&t;0x80
DECL|macro|MDIO_DATA_OUT
mdefine_line|#define MDIO_DATA_OUT&t;0x04
DECL|macro|MDIO_DATA_IN
mdefine_line|#define MDIO_DATA_IN&t;0x02
DECL|macro|MDIO_CLK
mdefine_line|#define MDIO_CLK&t;&t;0x01
DECL|macro|MDIO_WRITE0
mdefine_line|#define MDIO_WRITE0 (MDIO_DIR)
DECL|macro|MDIO_WRITE1
mdefine_line|#define MDIO_WRITE1 (MDIO_DIR | MDIO_DATA_OUT)
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay(mdio_addr)&t;readb(mdio_addr)
DECL|variable|mii_2_8139_map
r_static
r_char
id|mii_2_8139_map
(braket
l_int|8
)braket
op_assign
(brace
id|BasicModeCtrl
comma
id|BasicModeStatus
comma
l_int|0
comma
l_int|0
comma
id|NWayAdvert
comma
id|NWayLPAR
comma
id|NWayExpansion
comma
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_8139TOO_8129
multiline_comment|/* Syncronize the MII management interface by shifting 32 one bits out. */
DECL|function|mdio_sync
r_static
r_void
id|mdio_sync
(paren
r_void
op_star
id|mdio_addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|32
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writeb
(paren
id|MDIO_WRITE1
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writeb
(paren
id|MDIO_WRITE1
op_or
id|MDIO_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|mdio_read
r_static
r_int
id|mdio_read
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_8139TOO_8129
r_void
op_star
id|mdio_addr
op_assign
id|tp-&gt;mmio_addr
op_plus
id|Config4
suffix:semicolon
r_int
id|mii_cmd
op_assign
(paren
l_int|0xf6
op_lshift
l_int|10
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|5
)paren
op_or
id|location
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|phy_id
OG
l_int|31
)paren
(brace
multiline_comment|/* Really a 8139.  Use internal registers. */
r_return
id|location
OL
l_int|8
op_logical_and
id|mii_2_8139_map
(braket
id|location
)braket
ques
c_cond
id|readw
(paren
id|tp-&gt;mmio_addr
op_plus
id|mii_2_8139_map
(braket
id|location
)braket
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_8139TOO_8129
id|mdio_sync
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_DATA_OUT
suffix:colon
l_int|0
suffix:semicolon
id|writeb
(paren
id|MDIO_DIR
op_or
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writeb
(paren
id|MDIO_DIR
op_or
id|dataval
op_or
id|MDIO_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the two transition, 16 data, and wire-idle bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|19
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writeb
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readb
(paren
id|mdio_addr
)paren
op_amp
id|MDIO_DATA_IN
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writeb
(paren
id|MDIO_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
(paren
id|retval
op_rshift
l_int|1
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
macro_line|#ifdef CONFIG_8139TOO_8129
r_void
op_star
id|mdio_addr
op_assign
id|tp-&gt;mmio_addr
op_plus
id|Config4
suffix:semicolon
r_int
id|mii_cmd
op_assign
(paren
l_int|0x5002
op_lshift
l_int|16
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|23
)paren
op_or
(paren
id|location
op_lshift
l_int|18
)paren
op_or
id|value
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|phy_id
OG
l_int|31
)paren
(brace
multiline_comment|/* Really a 8139.  Use internal registers. */
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_if
c_cond
(paren
id|location
op_eq
l_int|0
)paren
(brace
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W16
(paren
id|BasicModeCtrl
comma
id|value
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|location
OL
l_int|8
op_logical_and
id|mii_2_8139_map
(braket
id|location
)braket
)paren
id|RTL_W16
(paren
id|mii_2_8139_map
(braket
id|location
)braket
comma
id|value
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_8139TOO_8129
id|mdio_sync
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_WRITE1
suffix:colon
id|MDIO_WRITE0
suffix:semicolon
id|writeb
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writeb
(paren
id|dataval
op_or
id|MDIO_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear out extra bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writeb
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
id|writeb
(paren
id|MDIO_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
(paren
id|mdio_addr
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|rtl8139_open
r_static
r_int
id|rtl8139_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|retval
op_assign
id|request_irq
(paren
id|dev-&gt;irq
comma
id|rtl8139_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|tp-&gt;tx_bufs
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_BUF_TOT_LEN
comma
op_amp
id|tp-&gt;tx_bufs_dma
)paren
suffix:semicolon
id|tp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_BUF_TOT_LEN
comma
op_amp
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tx_bufs
op_eq
l_int|NULL
op_logical_or
id|tp-&gt;rx_ring
op_eq
l_int|NULL
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tx_bufs
)paren
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_BUF_TOT_LEN
comma
id|tp-&gt;tx_bufs
comma
id|tp-&gt;tx_bufs_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;rx_ring
)paren
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_BUF_TOT_LEN
comma
id|tp-&gt;rx_ring
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|tp-&gt;mii.full_duplex
op_assign
id|tp-&gt;mii.force_media
suffix:semicolon
id|tp-&gt;tx_flag
op_assign
(paren
id|TX_FIFO_THRESH
op_lshift
l_int|11
)paren
op_amp
l_int|0x003f0000
suffix:semicolon
id|rtl8139_init_ring
(paren
id|dev
)paren
suffix:semicolon
id|rtl8139_hw_start
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_ifup
c_func
(paren
id|tp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rtl8139_open() ioaddr %#lx IRQ %d&quot;
l_string|&quot; GP Pins %2.2x %s-duplex.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_resource_start
(paren
id|tp-&gt;pci_dev
comma
l_int|1
)paren
comma
id|dev-&gt;irq
comma
id|RTL_R8
(paren
id|MediaStatus
)paren
comma
id|tp-&gt;mii.full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
id|rtl8139_start_thread
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl_check_media
r_static
r_void
id|rtl_check_media
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|init_media
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phys
(braket
l_int|0
)braket
op_ge
l_int|0
)paren
(brace
id|mii_check_media
c_func
(paren
op_amp
id|tp-&gt;mii
comma
id|netif_msg_link
c_func
(paren
id|tp
)paren
comma
id|init_media
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Start the hardware at open or resume. */
DECL|function|rtl8139_hw_start
r_static
r_void
id|rtl8139_hw_start
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|u8
id|tmp
suffix:semicolon
multiline_comment|/* Bring old chips out of low-power mode. */
r_if
c_cond
(paren
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasHltClk
)paren
id|RTL_W8
(paren
id|HltClk
comma
l_char|&squot;R&squot;
)paren
suffix:semicolon
id|rtl8139_chip_reset
(paren
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* unlock Config[01234] and BMCR register writes */
id|RTL_W8_F
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
multiline_comment|/* Restore our idea of the MAC address. */
id|RTL_W32_F
(paren
id|MAC0
op_plus
l_int|0
comma
id|cpu_to_le32
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|RTL_W32_F
(paren
id|MAC0
op_plus
l_int|4
comma
id|cpu_to_le32
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Must enable Tx/Rx before setting transfer thresholds! */
id|RTL_W8
(paren
id|ChipCmd
comma
id|CmdRxEnb
op_or
id|CmdTxEnb
)paren
suffix:semicolon
id|tp-&gt;rx_config
op_assign
id|rtl8139_rx_config
op_or
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|RTL_W32
(paren
id|RxConfig
comma
id|tp-&gt;rx_config
)paren
suffix:semicolon
multiline_comment|/* Check this value: the documentation for IFG contradicts ifself. */
id|RTL_W32
(paren
id|TxConfig
comma
id|rtl8139_tx_config
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|rtl_check_media
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chipset
op_ge
id|CH_8139B
)paren
(brace
multiline_comment|/* Disable magic packet scanning, which is enabled&n;&t;&t; * when PM is enabled in Config1.  It can be reenabled&n;&t;&t; * via ETHTOOL_SWOL if desired.  */
id|RTL_W8
(paren
id|Config3
comma
id|RTL_R8
(paren
id|Config3
)paren
op_amp
op_complement
id|Cfg3_Magic
)paren
suffix:semicolon
)brace
id|DPRINTK
c_func
(paren
l_string|&quot;init buffer addresses&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Lock Config[01234] and BMCR register writes */
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
multiline_comment|/* init Rx ring buffer DMA address */
id|RTL_W32_F
(paren
id|RxBuf
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
multiline_comment|/* init Tx buffer DMA addresses */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
id|RTL_W32_F
(paren
id|TxAddr0
op_plus
(paren
id|i
op_star
l_int|4
)paren
comma
id|tp-&gt;tx_bufs_dma
op_plus
(paren
id|tp-&gt;tx_buf
(braket
id|i
)braket
op_minus
id|tp-&gt;tx_bufs
)paren
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|rtl8139_set_rx_mode
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* no early-rx interrupts */
id|RTL_W16
(paren
id|MultiIntr
comma
id|RTL_R16
(paren
id|MultiIntr
)paren
op_amp
id|MultiIntrClear
)paren
suffix:semicolon
multiline_comment|/* make sure RxTx has started */
id|tmp
op_assign
id|RTL_R8
(paren
id|ChipCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|CmdRxEnb
)paren
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|CmdTxEnb
)paren
)paren
)paren
id|RTL_W8
(paren
id|ChipCmd
comma
id|CmdRxEnb
op_or
id|CmdTxEnb
)paren
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|RTL_W16
(paren
id|IntrMask
comma
id|rtl8139_intr_mask
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|rtl8139_init_ring
r_static
r_void
id|rtl8139_init_ring
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
id|tp-&gt;tx_buf
(braket
id|i
)braket
op_assign
op_amp
id|tp-&gt;tx_bufs
(braket
id|i
op_star
id|TX_BUF_SIZE
)braket
suffix:semicolon
)brace
multiline_comment|/* This must be global for CONFIG_8139TOO_TUNE_TWISTER case */
DECL|variable|next_tick
r_static
r_int
id|next_tick
op_assign
l_int|3
op_star
id|HZ
suffix:semicolon
macro_line|#ifndef CONFIG_8139TOO_TUNE_TWISTER
DECL|function|rtl8139_tune_twister
r_static
r_inline
r_void
id|rtl8139_tune_twister
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
)paren
(brace
)brace
macro_line|#else
DECL|enum|TwisterParamVals
r_enum
id|TwisterParamVals
(brace
DECL|enumerator|PARA78_default
id|PARA78_default
op_assign
l_int|0x78fa8388
comma
DECL|enumerator|PARA7c_default
id|PARA7c_default
op_assign
l_int|0xcb38de43
comma
multiline_comment|/* param[0][3] */
DECL|enumerator|PARA7c_xxx
id|PARA7c_xxx
op_assign
l_int|0xcb38de43
comma
)brace
suffix:semicolon
DECL|variable|param
r_static
r_const
r_int
r_int
id|param
(braket
l_int|4
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
l_int|0xcb39de43
comma
l_int|0xcb39ce43
comma
l_int|0xfb38de03
comma
l_int|0xcb38de43
)brace
comma
(brace
l_int|0xcb39de43
comma
l_int|0xcb39ce43
comma
l_int|0xcb39ce83
comma
l_int|0xcb39ce83
)brace
comma
(brace
l_int|0xcb39de43
comma
l_int|0xcb39ce43
comma
l_int|0xcb39ce83
comma
l_int|0xcb39ce83
)brace
comma
(brace
l_int|0xbb39de43
comma
l_int|0xbb39ce43
comma
l_int|0xbb39ce83
comma
l_int|0xbb39ce83
)brace
)brace
suffix:semicolon
DECL|function|rtl8139_tune_twister
r_static
r_void
id|rtl8139_tune_twister
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
)paren
(brace
r_int
id|linkcase
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
multiline_comment|/* This is a complicated state machine to configure the &quot;twister&quot; for&n;&t;   impedance/echos based on the cable length.&n;&t;   All of this is magic and undocumented.&n;&t; */
r_switch
c_cond
(paren
id|tp-&gt;twistie
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|RTL_R16
(paren
id|CSCR
)paren
op_amp
id|CSCR_LinkOKBit
)paren
(brace
multiline_comment|/* We have link beat, let us tune the twister. */
id|RTL_W16
(paren
id|CSCR
comma
id|CSCR_LinkDownOffCmd
)paren
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Change to state 2. */
id|next_tick
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Just put in some reasonable defaults for when beat returns. */
id|RTL_W16
(paren
id|CSCR
comma
id|CSCR_LinkDownCmd
)paren
suffix:semicolon
id|RTL_W32
(paren
id|FIFOTMS
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* Turn on cable test mode. */
id|RTL_W32
(paren
id|PARA78
comma
id|PARA78_default
)paren
suffix:semicolon
id|RTL_W32
(paren
id|PARA7c
comma
id|PARA7c_default
)paren
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Bail from future actions. */
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Read how long it took to hear the echo. */
id|linkcase
op_assign
id|RTL_R16
(paren
id|CSCR
)paren
op_amp
id|CSCR_LinkStatusBits
suffix:semicolon
r_if
c_cond
(paren
id|linkcase
op_eq
l_int|0x7000
)paren
id|tp-&gt;twist_row
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|linkcase
op_eq
l_int|0x3000
)paren
id|tp-&gt;twist_row
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|linkcase
op_eq
l_int|0x1000
)paren
id|tp-&gt;twist_row
op_assign
l_int|1
suffix:semicolon
r_else
id|tp-&gt;twist_row
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;twist_col
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Change to state 2. */
id|next_tick
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* Put out four tuning parameters, one per 100msec. */
r_if
c_cond
(paren
id|tp-&gt;twist_col
op_eq
l_int|0
)paren
id|RTL_W16
(paren
id|FIFOTMS
comma
l_int|0
)paren
suffix:semicolon
id|RTL_W32
(paren
id|PARA7c
comma
id|param
(braket
(paren
r_int
)paren
id|tp-&gt;twist_row
)braket
(braket
(paren
r_int
)paren
id|tp-&gt;twist_col
)braket
)paren
suffix:semicolon
id|next_tick
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|tp-&gt;twist_col
op_ge
l_int|4
)paren
(brace
multiline_comment|/* For short cables we are done.&n;&t;&t;&t;   For long cables (row == 3) check for mistune. */
id|tp-&gt;twistie
op_assign
(paren
id|tp-&gt;twist_row
op_eq
l_int|3
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* Special case for long cables: check for mistune. */
r_if
c_cond
(paren
(paren
id|RTL_R16
(paren
id|CSCR
)paren
op_amp
id|CSCR_LinkStatusBits
)paren
op_eq
l_int|0x7000
)paren
(brace
id|tp-&gt;twistie
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|RTL_W32
(paren
id|PARA7c
comma
l_int|0xfb38de03
)paren
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|5
suffix:semicolon
id|next_tick
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
multiline_comment|/* Retune for shorter cable (column 2). */
id|RTL_W32
(paren
id|FIFOTMS
comma
l_int|0x20
)paren
suffix:semicolon
id|RTL_W32
(paren
id|PARA78
comma
id|PARA78_default
)paren
suffix:semicolon
id|RTL_W32
(paren
id|PARA7c
comma
id|PARA7c_default
)paren
suffix:semicolon
id|RTL_W32
(paren
id|FIFOTMS
comma
l_int|0x00
)paren
suffix:semicolon
id|tp-&gt;twist_row
op_assign
l_int|2
suffix:semicolon
id|tp-&gt;twist_col
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|3
suffix:semicolon
id|next_tick
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_8139TOO_TUNE_TWISTER */
DECL|function|rtl8139_thread_iter
r_static
r_inline
r_void
id|rtl8139_thread_iter
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
id|mii_lpa
suffix:semicolon
id|mii_lpa
op_assign
id|mdio_read
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_LPA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;mii.force_media
op_logical_and
id|mii_lpa
op_ne
l_int|0xffff
)paren
(brace
r_int
id|duplex
op_assign
(paren
id|mii_lpa
op_amp
id|LPA_100FULL
)paren
op_logical_or
(paren
id|mii_lpa
op_amp
l_int|0x01C0
)paren
op_eq
l_int|0x0040
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mii.full_duplex
op_ne
id|duplex
)paren
(brace
id|tp-&gt;mii.full_duplex
op_assign
id|duplex
suffix:semicolon
r_if
c_cond
(paren
id|mii_lpa
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Setting %s-duplex based on MII #%d link&quot;
l_string|&quot; partner ability of %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;mii.full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|mii_lpa
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: media is unconnected, link down, or incompatible connection&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Config1
comma
id|tp-&gt;mii.full_duplex
ques
c_cond
l_int|0x60
suffix:colon
l_int|0x20
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
id|next_tick
op_assign
id|HZ
op_star
l_int|60
suffix:semicolon
id|rtl8139_tune_twister
(paren
id|dev
comma
id|tp
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s: Media selection tick, Link partner %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R16
(paren
id|NWayLPAR
)paren
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s:  Other registers are IntMask %4.4x IntStatus %4.4x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R16
(paren
id|IntrMask
)paren
comma
id|RTL_R16
(paren
id|IntrStatus
)paren
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s:  Chip config %2.2x %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R8
(paren
id|Config0
)paren
comma
id|RTL_R8
(paren
id|Config1
)paren
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_thread
r_static
r_int
id|rtl8139_thread
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|data
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|timeout
suffix:semicolon
id|daemonize
c_func
(paren
l_string|&quot;%s&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|allow_signal
c_func
(paren
id|SIGTERM
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|timeout
op_assign
id|next_tick
suffix:semicolon
r_do
(brace
id|timeout
op_assign
id|interruptible_sleep_on_timeout
(paren
op_amp
id|tp-&gt;thr_wait
comma
id|timeout
)paren
suffix:semicolon
multiline_comment|/* make swsusp happy with our thread */
r_if
c_cond
(paren
id|current-&gt;flags
op_amp
id|PF_FREEZE
)paren
id|refrigerator
c_func
(paren
id|PF_FREEZE
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|signal_pending
(paren
id|current
)paren
op_logical_and
(paren
id|timeout
OG
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
(paren
id|current
)paren
)paren
(brace
id|flush_signals
c_func
(paren
id|current
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;time_to_die
)paren
r_break
suffix:semicolon
id|rtnl_lock
(paren
)paren
suffix:semicolon
id|rtl8139_thread_iter
(paren
id|dev
comma
id|tp
comma
id|tp-&gt;mmio_addr
)paren
suffix:semicolon
id|rtnl_unlock
(paren
)paren
suffix:semicolon
)brace
id|complete_and_exit
(paren
op_amp
id|tp-&gt;thr_exited
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_start_thread
r_static
r_inline
r_void
id|rtl8139_start_thread
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;thr_pid
op_assign
op_minus
l_int|1
suffix:semicolon
id|tp-&gt;twistie
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;time_to_die
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chipset
op_eq
id|CH_8139_K
)paren
id|tp-&gt;twistie
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;drv_flags
op_amp
id|HAS_LNK_CHNG
)paren
r_return
suffix:semicolon
id|tp-&gt;thr_pid
op_assign
id|kernel_thread
c_func
(paren
id|rtl8139_thread
comma
id|dev
comma
id|CLONE_FS
op_or
id|CLONE_FILES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;thr_pid
OL
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_WARNING
l_string|&quot;%s: unable to start kernel thread&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|rtl8139_tx_clear
r_static
r_inline
r_void
id|rtl8139_tx_clear
(paren
r_struct
id|rtl8139_private
op_star
id|tp
)paren
(brace
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* XXX account for unsent Tx packets in tp-&gt;stats.tx_dropped */
)brace
DECL|function|rtl8139_tx_timeout
r_static
r_void
id|rtl8139_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit timeout, status %2.2x %4.4x %4.4x &quot;
l_string|&quot;media %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R8
(paren
id|ChipCmd
)paren
comma
id|RTL_R16
c_func
(paren
id|IntrStatus
)paren
comma
id|RTL_R16
c_func
(paren
id|IntrMask
)paren
comma
id|RTL_R8
c_func
(paren
id|MediaStatus
)paren
)paren
suffix:semicolon
multiline_comment|/* Emit info to figure out what went wrong. */
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx queue start entry %ld  dirty entry %ld.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;dirty_tx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s:  Tx descriptor %d is %8.8lx.%s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
comma
id|RTL_R32
(paren
id|TxStatus0
op_plus
(paren
id|i
op_star
l_int|4
)paren
)paren
comma
id|i
op_eq
id|tp-&gt;dirty_tx
op_mod
id|NUM_TX_DESC
ques
c_cond
l_string|&quot; (queue head)&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|tp-&gt;xstats.tx_timeouts
op_increment
suffix:semicolon
multiline_comment|/* disable Tx ASAP, if not already */
id|tmp8
op_assign
id|RTL_R8
(paren
id|ChipCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp8
op_amp
id|CmdTxEnb
)paren
id|RTL_W8
(paren
id|ChipCmd
comma
id|CmdRxEnb
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;rx_lock
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|RTL_W16
(paren
id|IntrMask
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Stop a shared interrupt from scavenging while we are. */
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rtl8139_tx_clear
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* ...and finally, reset everything */
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|rtl8139_hw_start
(paren
id|dev
)paren
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;rx_lock
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_start_xmit
r_static
r_int
id|rtl8139_start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
multiline_comment|/* Note: the chip doesn&squot;t have auto-pad! */
r_if
c_cond
(paren
id|likely
c_func
(paren
id|len
OL
id|TX_BUF_SIZE
)paren
)paren
(brace
r_if
c_cond
(paren
id|len
OL
id|ETH_ZLEN
)paren
id|memset
c_func
(paren
id|tp-&gt;tx_buf
(braket
id|entry
)braket
comma
l_int|0
comma
id|ETH_ZLEN
)paren
suffix:semicolon
id|skb_copy_and_csum_dev
c_func
(paren
id|skb
comma
id|tp-&gt;tx_buf
(braket
id|entry
)braket
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|RTL_W32_F
(paren
id|TxStatus0
op_plus
(paren
id|entry
op_star
r_sizeof
(paren
id|u32
)paren
)paren
comma
id|tp-&gt;tx_flag
op_or
id|max
c_func
(paren
id|len
comma
(paren
r_int
r_int
)paren
id|ETH_ZLEN
)paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;cur_tx
op_minus
id|NUM_TX_DESC
)paren
op_eq
id|tp-&gt;dirty_tx
)paren
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_tx_queued
c_func
(paren
id|tp
)paren
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: Queued Tx packet size %u to slot %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
comma
id|entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8139_tx_interrupt
r_static
r_void
id|rtl8139_tx_interrupt
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
r_int
id|dirty_tx
comma
id|tx_left
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|tx_left
op_assign
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
suffix:semicolon
r_while
c_loop
(paren
id|tx_left
OG
l_int|0
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
r_int
id|txstatus
suffix:semicolon
id|txstatus
op_assign
id|RTL_R32
(paren
id|TxStatus0
op_plus
(paren
id|entry
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|txstatus
op_amp
(paren
id|TxStatOK
op_or
id|TxUnderrun
op_or
id|TxAborted
)paren
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been Txed */
multiline_comment|/* Note: TxCarrierLost is always asserted at 100mbps. */
r_if
c_cond
(paren
id|txstatus
op_amp
(paren
id|TxOutOfWindow
op_or
id|TxAborted
)paren
)paren
(brace
multiline_comment|/* There was an major error, log it. */
r_if
c_cond
(paren
id|netif_msg_tx_err
c_func
(paren
id|tp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit error, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|txstatus
)paren
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
id|TxAborted
)paren
(brace
id|tp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|RTL_W32
(paren
id|TxConfig
comma
id|TxClearAbt
)paren
suffix:semicolon
id|RTL_W16
(paren
id|IntrStatus
comma
id|TxErr
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|txstatus
op_amp
id|TxCarrierLost
)paren
id|tp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|txstatus
op_amp
id|TxOutOfWindow
)paren
id|tp-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|txstatus
op_amp
id|TxUnderrun
)paren
(brace
multiline_comment|/* Add 64 to the Tx FIFO threshold. */
r_if
c_cond
(paren
id|tp-&gt;tx_flag
OL
l_int|0x00300000
)paren
id|tp-&gt;tx_flag
op_add_assign
l_int|0x00020000
suffix:semicolon
id|tp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
)brace
id|tp-&gt;stats.collisions
op_add_assign
(paren
id|txstatus
op_rshift
l_int|24
)paren
op_amp
l_int|15
suffix:semicolon
id|tp-&gt;stats.tx_bytes
op_add_assign
id|txstatus
op_amp
l_int|0x7ff
suffix:semicolon
id|tp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
id|dirty_tx
op_increment
suffix:semicolon
id|tx_left
op_decrement
suffix:semicolon
)brace
macro_line|#ifndef RTL8139_NDEBUG
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OG
id|NUM_TX_DESC
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: Out-of-sync dirty pointer, %ld vs. %ld.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dirty_tx
comma
id|tp-&gt;cur_tx
)paren
suffix:semicolon
id|dirty_tx
op_add_assign
id|NUM_TX_DESC
suffix:semicolon
)brace
macro_line|#endif /* RTL8139_NDEBUG */
multiline_comment|/* only wake the queue if we did work, and the queue is stopped */
r_if
c_cond
(paren
id|tp-&gt;dirty_tx
op_ne
id|dirty_tx
)paren
(brace
id|tp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* TODO: clean this up!  Rx reset need not be this intensive */
DECL|function|rtl8139_rx_err
r_static
r_void
id|rtl8139_rx_err
(paren
id|u32
id|rx_status
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
id|u8
id|tmp8
suffix:semicolon
macro_line|#ifdef CONFIG_8139_OLD_RX_RESET
r_int
id|tmp_work
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|netif_msg_rx_err
(paren
id|tp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Ethernet frame had errors, status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rx_status
op_amp
id|RxStatusOK
)paren
)paren
(brace
r_if
c_cond
(paren
id|rx_status
op_amp
id|RxTooLong
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;%s: Oversized Ethernet frame, status %4.4x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
multiline_comment|/* A.C.: The chip hangs here. */
)brace
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RxBadSymbol
op_or
id|RxBadAlign
)paren
)paren
id|tp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RxRunt
op_or
id|RxTooLong
)paren
)paren
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|RxCRCErr
)paren
id|tp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;xstats.rx_lost_in_ring
op_increment
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_8139_OLD_RX_RESET
id|tmp8
op_assign
id|RTL_R8
(paren
id|ChipCmd
)paren
suffix:semicolon
id|RTL_W8
(paren
id|ChipCmd
comma
id|tmp8
op_amp
op_complement
id|CmdRxEnb
)paren
suffix:semicolon
id|RTL_W8
(paren
id|ChipCmd
comma
id|tmp8
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxConfig
comma
id|tp-&gt;rx_config
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
macro_line|#else
multiline_comment|/* Reset the receiver, based on RealTek recommendation. (Bug?) */
multiline_comment|/* disable receive */
id|RTL_W8_F
(paren
id|ChipCmd
comma
id|CmdTxEnb
)paren
suffix:semicolon
id|tmp_work
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|tmp_work
OG
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp8
op_assign
id|RTL_R8
(paren
id|ChipCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp8
op_amp
id|CmdRxEnb
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp_work
op_le
l_int|0
)paren
id|printk
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;rx stop wait too long&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* restart receive */
id|tmp_work
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|tmp_work
OG
l_int|0
)paren
(brace
id|RTL_W8_F
(paren
id|ChipCmd
comma
id|CmdRxEnb
op_or
id|CmdTxEnb
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp8
op_assign
id|RTL_R8
(paren
id|ChipCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp8
op_amp
id|CmdRxEnb
)paren
op_logical_and
(paren
id|tmp8
op_amp
id|CmdTxEnb
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp_work
op_le
l_int|0
)paren
id|printk
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;tx/rx enable wait too long&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* and reinitialize all rx related registers */
id|RTL_W8_F
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
multiline_comment|/* Must enable Tx/Rx before setting transfer thresholds! */
id|RTL_W8
(paren
id|ChipCmd
comma
id|CmdRxEnb
op_or
id|CmdTxEnb
)paren
suffix:semicolon
id|tp-&gt;rx_config
op_assign
id|rtl8139_rx_config
op_or
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|RTL_W32
(paren
id|RxConfig
comma
id|tp-&gt;rx_config
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;init buffer addresses&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Lock Config[01234] and BMCR register writes */
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
multiline_comment|/* init Rx ring buffer DMA address */
id|RTL_W32_F
(paren
id|RxBuf
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
multiline_comment|/* A.C.: Reset the multicast list. */
id|__set_rx_mode
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#if RX_BUF_IDX == 3
DECL|function|wrap_copy
r_static
id|__inline__
r_void
id|wrap_copy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_const
r_int
r_char
op_star
id|ring
comma
id|u32
id|offset
comma
r_int
r_int
id|size
)paren
(brace
id|u32
id|left
op_assign
id|RX_BUF_LEN
op_minus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|left
)paren
(brace
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|ring
op_plus
id|offset
comma
id|left
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
op_plus
id|left
comma
id|ring
comma
id|size
op_minus
id|left
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|ring
op_plus
id|offset
comma
id|size
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rtl8139_rx
r_static
r_int
id|rtl8139_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
comma
r_int
id|budget
)paren
(brace
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|received
op_assign
l_int|0
suffix:semicolon
r_int
r_char
op_star
id|rx_ring
op_assign
id|tp-&gt;rx_ring
suffix:semicolon
r_int
r_int
id|cur_rx
op_assign
id|tp-&gt;cur_rx
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s: In rtl8139_rx(), current %4.4x BufAddr %4.4x,&quot;
l_string|&quot; free to %4.4x, Cmd %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cur_rx
comma
id|RTL_R16
(paren
id|RxBufAddr
)paren
comma
id|RTL_R16
(paren
id|RxBufPtr
)paren
comma
id|RTL_R8
(paren
id|ChipCmd
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|netif_running
c_func
(paren
id|dev
)paren
op_logical_and
id|received
OL
id|budget
op_logical_and
(paren
id|RTL_R8
(paren
id|ChipCmd
)paren
op_amp
id|RxBufEmpty
)paren
op_eq
l_int|0
)paren
(brace
id|u32
id|ring_offset
op_assign
id|cur_rx
op_mod
id|RX_BUF_LEN
suffix:semicolon
id|u32
id|rx_status
suffix:semicolon
r_int
r_int
id|rx_size
suffix:semicolon
r_int
r_int
id|pkt_size
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* read size+status of next frame from DMA ring buffer */
id|rx_status
op_assign
id|le32_to_cpu
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|rx_ring
op_plus
id|ring_offset
)paren
)paren
suffix:semicolon
id|rx_size
op_assign
id|rx_status
op_rshift
l_int|16
suffix:semicolon
id|pkt_size
op_assign
id|rx_size
op_minus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_rx_status
c_func
(paren
id|tp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s:  rtl8139_rx() status %4.4x, size %4.4x,&quot;
l_string|&quot; cur %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
comma
id|rx_size
comma
id|cur_rx
)paren
suffix:semicolon
macro_line|#if RTL8139_DEBUG &gt; 2
(brace
r_int
id|i
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s: Frame contents &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|70
suffix:semicolon
id|i
op_increment
)paren
id|printk
(paren
l_string|&quot; %2.2x&quot;
comma
id|rx_ring
(braket
id|ring_offset
op_plus
id|i
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Packet copy from FIFO still in progress.&n;&t;&t; * Theoretically, this should never happen&n;&t;&t; * since EarlyRx is disabled.&n;&t;&t; */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|rx_size
op_eq
l_int|0xfff0
)paren
)paren
(brace
id|tp-&gt;xstats.early_rx
op_increment
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* If Rx err or invalid rx_size/rx_status received&n;&t;&t; * (which happens if we get lost in the ring),&n;&t;&t; * Rx process gets reset, so we abort any further&n;&t;&t; * Rx processing.&n;&t;&t; */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
(paren
id|rx_size
OG
(paren
id|MAX_ETH_FRAME_SIZE
op_plus
l_int|4
)paren
)paren
op_logical_or
(paren
id|rx_size
OL
l_int|8
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|rx_status
op_amp
id|RxStatusOK
)paren
)paren
)paren
)paren
(brace
id|rtl8139_rx_err
(paren
id|rx_status
comma
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Malloc up new buffer, compatible with net-2e. */
multiline_comment|/* Omit the four octet CRC from the length. */
id|skb
op_assign
id|dev_alloc_skb
(paren
id|pkt_size
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|skb
)paren
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP fields. */
macro_line|#if RX_BUF_IDX == 3
id|wrap_copy
c_func
(paren
id|skb
comma
id|rx_ring
comma
id|ring_offset
op_plus
l_int|4
comma
id|pkt_size
)paren
suffix:semicolon
macro_line|#else
id|eth_copy_and_sum
(paren
id|skb
comma
op_amp
id|rx_ring
(braket
id|ring_offset
op_plus
l_int|4
)braket
comma
id|pkt_size
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|skb_put
(paren
id|skb
comma
id|pkt_size
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;stats.rx_bytes
op_add_assign
id|pkt_size
suffix:semicolon
id|tp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|netif_receive_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
id|received
op_increment
suffix:semicolon
id|cur_rx
op_assign
(paren
id|cur_rx
op_plus
id|rx_size
op_plus
l_int|4
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|RTL_W16
(paren
id|RxBufPtr
comma
(paren
id|u16
)paren
(paren
id|cur_rx
op_minus
l_int|16
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear out errors and receive interrupts */
id|status
op_assign
id|RTL_R16
(paren
id|IntrStatus
)paren
op_amp
id|RxAckBits
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_amp
(paren
id|RxFIFOOver
op_or
id|RxOverflow
)paren
)paren
)paren
(brace
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxFIFOOver
)paren
id|tp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
id|RTL_W16_F
(paren
id|IntrStatus
comma
id|RxAckBits
)paren
suffix:semicolon
)brace
)brace
id|done
suffix:colon
macro_line|#if RTL8139_DEBUG &gt; 1
id|DPRINTK
(paren
l_string|&quot;%s: Done rtl8139_rx(), current %4.4x BufAddr %4.4x,&quot;
l_string|&quot; free to %4.4x, Cmd %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cur_rx
comma
id|RTL_R16
(paren
id|RxBufAddr
)paren
comma
id|RTL_R16
(paren
id|RxBufPtr
)paren
comma
id|RTL_R8
(paren
id|ChipCmd
)paren
)paren
suffix:semicolon
macro_line|#endif
id|tp-&gt;cur_rx
op_assign
id|cur_rx
suffix:semicolon
r_return
id|received
suffix:semicolon
)brace
DECL|function|rtl8139_weird_interrupt
r_static
r_void
id|rtl8139_weird_interrupt
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8139_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
comma
r_int
id|status
comma
r_int
id|link_changed
)paren
(brace
id|DPRINTK
(paren
l_string|&quot;%s: Abnormal interrupt, status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Update the error count. */
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|RxUnderrun
)paren
op_logical_and
id|link_changed
op_logical_and
(paren
id|tp-&gt;drv_flags
op_amp
id|HAS_LNK_CHNG
)paren
)paren
(brace
id|rtl_check_media
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|status
op_and_assign
op_complement
id|RxUnderrun
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxUnderrun
op_or
id|RxErr
)paren
)paren
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PCSTimeout
)paren
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxUnderrun
)paren
id|tp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PCIErr
)paren
(brace
id|u16
id|pci_cmd_status
suffix:semicolon
id|pci_read_config_word
(paren
id|tp-&gt;pci_dev
comma
id|PCI_STATUS
comma
op_amp
id|pci_cmd_status
)paren
suffix:semicolon
id|pci_write_config_word
(paren
id|tp-&gt;pci_dev
comma
id|PCI_STATUS
comma
id|pci_cmd_status
)paren
suffix:semicolon
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: PCI Bus error %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_cmd_status
)paren
suffix:semicolon
)brace
)brace
DECL|function|rtl8139_poll
r_static
r_int
id|rtl8139_poll
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
op_star
id|budget
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|orig_budget
op_assign
id|min
c_func
(paren
op_star
id|budget
comma
id|dev-&gt;quota
)paren
suffix:semicolon
r_int
id|done
op_assign
l_int|1
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;rx_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|RTL_R16
c_func
(paren
id|IntrStatus
)paren
op_amp
id|RxAckBits
)paren
)paren
(brace
r_int
id|work_done
suffix:semicolon
id|work_done
op_assign
id|rtl8139_rx
c_func
(paren
id|dev
comma
id|tp
comma
id|orig_budget
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|work_done
OG
l_int|0
)paren
)paren
(brace
op_star
id|budget
op_sub_assign
id|work_done
suffix:semicolon
id|dev-&gt;quota
op_sub_assign
id|work_done
suffix:semicolon
id|done
op_assign
(paren
id|work_done
OL
id|orig_budget
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|done
)paren
(brace
multiline_comment|/*&n;&t;&t; * Order is important since data can get interrupted&n;&t;&t; * again when we think we are done.&n;&t;&t; */
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|RTL_W16_F
c_func
(paren
id|IntrMask
comma
id|rtl8139_intr_mask
)paren
suffix:semicolon
id|__netif_rx_complete
c_func
(paren
id|dev
)paren
suffix:semicolon
id|local_irq_enable
c_func
(paren
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;rx_lock
)paren
suffix:semicolon
r_return
op_logical_neg
id|done
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|rtl8139_interrupt
r_static
id|irqreturn_t
id|rtl8139_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u16
id|status
comma
id|ackstat
suffix:semicolon
r_int
id|link_changed
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* avoid bogus &quot;uninit&quot; warning */
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|spin_lock
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|status
op_assign
id|RTL_R16
(paren
id|IntrStatus
)paren
suffix:semicolon
multiline_comment|/* shared irq? */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
(paren
id|status
op_amp
id|rtl8139_intr_mask
)paren
op_eq
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* h/w no longer present (hotplug?) or major error, bail */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_eq
l_int|0xFFFF
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* close possible race&squot;s with dev_close */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|RTL_W16
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP, but&n;&t;   an first get an additional status bit from CSCR. */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_amp
id|RxUnderrun
)paren
)paren
id|link_changed
op_assign
id|RTL_R16
(paren
id|CSCR
)paren
op_amp
id|CSCR_LinkChangeBit
suffix:semicolon
id|ackstat
op_assign
id|status
op_amp
op_complement
(paren
id|RxAckBits
op_or
id|TxErr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ackstat
)paren
id|RTL_W16
(paren
id|IntrStatus
comma
id|ackstat
)paren
suffix:semicolon
multiline_comment|/* Receive packets are processed by poll routine.&n;&t;   If not running start it now. */
r_if
c_cond
(paren
id|status
op_amp
id|RxAckBits
)paren
(brace
r_if
c_cond
(paren
id|netif_rx_schedule_prep
c_func
(paren
id|dev
)paren
)paren
(brace
id|RTL_W16_F
(paren
id|IntrMask
comma
id|rtl8139_norx_intr_mask
)paren
suffix:semicolon
id|__netif_rx_schedule
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Check uncommon events with one test. */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_amp
(paren
id|PCIErr
op_or
id|PCSTimeout
op_or
id|RxUnderrun
op_or
id|RxErr
)paren
)paren
)paren
id|rtl8139_weird_interrupt
(paren
id|dev
comma
id|tp
comma
id|ioaddr
comma
id|status
comma
id|link_changed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxOK
op_or
id|TxErr
)paren
)paren
(brace
id|rtl8139_tx_interrupt
(paren
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxErr
)paren
id|RTL_W16
(paren
id|IntrStatus
comma
id|TxErr
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s: exiting interrupt, intr_status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R16
(paren
id|IntrStatus
)paren
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_POLL_CONTROLLER
multiline_comment|/*&n; * Polling receive - used by netconsole and other diagnostic tools&n; * to allow network i/o with interrupts disabled.&n; */
DECL|function|rtl8139_poll_controller
r_static
r_void
id|rtl8139_poll_controller
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|rtl8139_interrupt
c_func
(paren
id|dev-&gt;irq
comma
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rtl8139_close
r_static
r_int
id|rtl8139_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;thr_pid
op_ge
l_int|0
)paren
(brace
id|tp-&gt;time_to_die
op_assign
l_int|1
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|kill_proc
(paren
id|tp-&gt;thr_pid
comma
id|SIGTERM
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: unable to signal thread&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|wait_for_completion
(paren
op_amp
id|tp-&gt;thr_exited
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_msg_ifdown
c_func
(paren
id|tp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was 0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|RTL_R16
(paren
id|IntrStatus
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx DMA processes. */
id|RTL_W8
(paren
id|ChipCmd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|RTL_W16
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|synchronize_irq
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* racy, but that&squot;s ok here */
id|free_irq
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|rtl8139_tx_clear
(paren
id|tp
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|RX_BUF_TOT_LEN
comma
id|tp-&gt;rx_ring
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pci_dev
comma
id|TX_BUF_TOT_LEN
comma
id|tp-&gt;tx_bufs
comma
id|tp-&gt;tx_bufs_dma
)paren
suffix:semicolon
id|tp-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_bufs
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Green! Put the chip in low-power mode. */
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasHltClk
)paren
id|RTL_W8
(paren
id|HltClk
comma
l_char|&squot;H&squot;
)paren
suffix:semicolon
multiline_comment|/* &squot;R&squot; would leave the clock running. */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Get the ethtool Wake-on-LAN settings.  Assumes that wol points to&n;   kernel memory, *wol has been initialized as {ETHTOOL_GWOL}, and&n;   other threads or interrupts aren&squot;t messing with the 8139.  */
DECL|function|rtl8139_get_wol
r_static
r_void
id|rtl8139_get_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wol
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|np-&gt;mmio_addr
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtl_chip_info
(braket
id|np-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasLWake
)paren
(brace
id|u8
id|cfg3
op_assign
id|RTL_R8
(paren
id|Config3
)paren
suffix:semicolon
id|u8
id|cfg5
op_assign
id|RTL_R8
(paren
id|Config5
)paren
suffix:semicolon
id|wol-&gt;supported
op_assign
id|WAKE_PHY
op_or
id|WAKE_MAGIC
op_or
id|WAKE_UCAST
op_or
id|WAKE_MCAST
op_or
id|WAKE_BCAST
suffix:semicolon
id|wol-&gt;wolopts
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cfg3
op_amp
id|Cfg3_LinkUp
)paren
id|wol-&gt;wolopts
op_or_assign
id|WAKE_PHY
suffix:semicolon
r_if
c_cond
(paren
id|cfg3
op_amp
id|Cfg3_Magic
)paren
id|wol-&gt;wolopts
op_or_assign
id|WAKE_MAGIC
suffix:semicolon
multiline_comment|/* (KON)FIXME: See how netdev_set_wol() handles the&n;&t;&t;   following constants.  */
r_if
c_cond
(paren
id|cfg5
op_amp
id|Cfg5_UWF
)paren
id|wol-&gt;wolopts
op_or_assign
id|WAKE_UCAST
suffix:semicolon
r_if
c_cond
(paren
id|cfg5
op_amp
id|Cfg5_MWF
)paren
id|wol-&gt;wolopts
op_or_assign
id|WAKE_MCAST
suffix:semicolon
r_if
c_cond
(paren
id|cfg5
op_amp
id|Cfg5_BWF
)paren
id|wol-&gt;wolopts
op_or_assign
id|WAKE_BCAST
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the ethtool Wake-on-LAN settings.  Return 0 or -errno.  Assumes&n;   that wol points to kernel memory and other threads or interrupts&n;   aren&squot;t messing with the 8139.  */
DECL|function|rtl8139_set_wol
r_static
r_int
id|rtl8139_set_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wol
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|np-&gt;mmio_addr
suffix:semicolon
id|u32
id|support
suffix:semicolon
id|u8
id|cfg3
comma
id|cfg5
suffix:semicolon
id|support
op_assign
(paren
(paren
id|rtl_chip_info
(braket
id|np-&gt;chipset
)braket
dot
id|flags
op_amp
id|HasLWake
)paren
ques
c_cond
(paren
id|WAKE_PHY
op_or
id|WAKE_MAGIC
op_or
id|WAKE_UCAST
op_or
id|WAKE_MCAST
op_or
id|WAKE_BCAST
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
op_complement
id|support
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|cfg3
op_assign
id|RTL_R8
(paren
id|Config3
)paren
op_amp
op_complement
(paren
id|Cfg3_LinkUp
op_or
id|Cfg3_Magic
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
id|WAKE_PHY
)paren
id|cfg3
op_or_assign
id|Cfg3_LinkUp
suffix:semicolon
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
id|WAKE_MAGIC
)paren
id|cfg3
op_or_assign
id|Cfg3_Magic
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Config3
comma
id|cfg3
)paren
suffix:semicolon
id|RTL_W8
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
id|cfg5
op_assign
id|RTL_R8
(paren
id|Config5
)paren
op_amp
op_complement
(paren
id|Cfg5_UWF
op_or
id|Cfg5_MWF
op_or
id|Cfg5_BWF
)paren
suffix:semicolon
multiline_comment|/* (KON)FIXME: These are untested.  We may have to set the&n;&t;   CRC0, Wakeup0 and LSBCRC0 registers too, but I have no&n;&t;   documentation.  */
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
id|WAKE_UCAST
)paren
id|cfg5
op_or_assign
id|Cfg5_UWF
suffix:semicolon
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
id|WAKE_MCAST
)paren
id|cfg5
op_or_assign
id|Cfg5_MWF
suffix:semicolon
r_if
c_cond
(paren
id|wol-&gt;wolopts
op_amp
id|WAKE_BCAST
)paren
id|cfg5
op_or_assign
id|Cfg5_BWF
suffix:semicolon
id|RTL_W8
(paren
id|Config5
comma
id|cfg5
)paren
suffix:semicolon
multiline_comment|/* need not unlock via Cfg9346 */
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8139_get_drvinfo
r_static
r_void
id|rtl8139_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;bus_info
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
id|info-&gt;regdump_len
op_assign
id|np-&gt;regs_len
suffix:semicolon
)brace
DECL|function|rtl8139_get_settings
r_static
r_int
id|rtl8139_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|mii_ethtool_gset
c_func
(paren
op_amp
id|np-&gt;mii
comma
id|cmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8139_set_settings
r_static
r_int
id|rtl8139_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|rc
op_assign
id|mii_ethtool_sset
c_func
(paren
op_amp
id|np-&gt;mii
comma
id|cmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|rtl8139_nway_reset
r_static
r_int
id|rtl8139_nway_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
id|mii_nway_restart
c_func
(paren
op_amp
id|np-&gt;mii
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_get_link
r_static
id|u32
id|rtl8139_get_link
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
id|mii_link_ok
c_func
(paren
op_amp
id|np-&gt;mii
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_get_msglevel
r_static
id|u32
id|rtl8139_get_msglevel
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
id|np-&gt;msg_enable
suffix:semicolon
)brace
DECL|function|rtl8139_set_msglevel
r_static
r_void
id|rtl8139_set_msglevel
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|datum
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|np-&gt;msg_enable
op_assign
id|datum
suffix:semicolon
)brace
multiline_comment|/* TODO: we are too slack to do reg dumping for pio, for now */
macro_line|#ifdef CONFIG_8139TOO_PIO
DECL|macro|rtl8139_get_regs_len
mdefine_line|#define rtl8139_get_regs_len&t;NULL
DECL|macro|rtl8139_get_regs
mdefine_line|#define rtl8139_get_regs&t;NULL
macro_line|#else
DECL|function|rtl8139_get_regs_len
r_static
r_int
id|rtl8139_get_regs_len
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
id|np-&gt;regs_len
suffix:semicolon
)brace
DECL|function|rtl8139_get_regs
r_static
r_void
id|rtl8139_get_regs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_regs
op_star
id|regs
comma
r_void
op_star
id|regbuf
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|regs-&gt;version
op_assign
id|RTL_REGS_VER
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|regbuf
comma
id|np-&gt;mmio_addr
comma
id|regs-&gt;len
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_8139TOO_MMIO */
DECL|function|rtl8139_get_stats_count
r_static
r_int
id|rtl8139_get_stats_count
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|RTL_NUM_STATS
suffix:semicolon
)brace
DECL|function|rtl8139_get_ethtool_stats
r_static
r_void
id|rtl8139_get_ethtool_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_stats
op_star
id|stats
comma
id|u64
op_star
id|data
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|np-&gt;xstats.early_rx
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|np-&gt;xstats.tx_buf_mapped
suffix:semicolon
id|data
(braket
l_int|2
)braket
op_assign
id|np-&gt;xstats.tx_timeouts
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|np-&gt;xstats.rx_lost_in_ring
suffix:semicolon
)brace
DECL|function|rtl8139_get_strings
r_static
r_void
id|rtl8139_get_strings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|stringset
comma
id|u8
op_star
id|data
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|ethtool_stats_keys
comma
r_sizeof
(paren
id|ethtool_stats_keys
)paren
)paren
suffix:semicolon
)brace
DECL|variable|rtl8139_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|rtl8139_ethtool_ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|rtl8139_get_drvinfo
comma
dot
id|get_settings
op_assign
id|rtl8139_get_settings
comma
dot
id|set_settings
op_assign
id|rtl8139_set_settings
comma
dot
id|get_regs_len
op_assign
id|rtl8139_get_regs_len
comma
dot
id|get_regs
op_assign
id|rtl8139_get_regs
comma
dot
id|nway_reset
op_assign
id|rtl8139_nway_reset
comma
dot
id|get_link
op_assign
id|rtl8139_get_link
comma
dot
id|get_msglevel
op_assign
id|rtl8139_get_msglevel
comma
dot
id|set_msglevel
op_assign
id|rtl8139_set_msglevel
comma
dot
id|get_wol
op_assign
id|rtl8139_get_wol
comma
dot
id|set_wol
op_assign
id|rtl8139_set_wol
comma
dot
id|get_strings
op_assign
id|rtl8139_get_strings
comma
dot
id|get_stats_count
op_assign
id|rtl8139_get_stats_count
comma
dot
id|get_ethtool_stats
op_assign
id|rtl8139_get_ethtool_stats
comma
)brace
suffix:semicolon
DECL|function|netdev_ioctl
r_static
r_int
id|netdev_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|rc
op_assign
id|generic_mii_ioctl
c_func
(paren
op_amp
id|np-&gt;mii
comma
id|data
comma
id|cmd
comma
l_int|NULL
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|rtl8139_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|rtl8139_get_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   This routine is not state sensitive and need not be SMP locked. */
DECL|function|__set_rx_mode
r_static
r_void
id|__set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|i
comma
id|rx_mode
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|DPRINTK
(paren
l_string|&quot;%s:   rtl8139_set_rx_mode(%4.4x) done -- Rx config %8.8lx.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;flags
comma
id|RTL_R32
(paren
id|RxConfig
)paren
)paren
suffix:semicolon
multiline_comment|/* Note: do not reorder, GCC is clever about common statements. */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Unconditionally log net taps. */
id|printk
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
op_or
id|AcceptAllPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|bit_nr
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
suffix:semicolon
id|mc_filter
(braket
id|bit_nr
op_rshift
l_int|5
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|bit_nr
op_amp
l_int|31
)paren
suffix:semicolon
id|rx_mode
op_or_assign
id|AcceptMulticast
suffix:semicolon
)brace
)brace
multiline_comment|/* We can safely update without stopping the chip. */
id|tmp
op_assign
id|rtl8139_rx_config
op_or
id|rx_mode
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;rx_config
op_ne
id|tmp
)paren
(brace
id|RTL_W32_F
(paren
id|RxConfig
comma
id|tmp
)paren
suffix:semicolon
id|tp-&gt;rx_config
op_assign
id|tmp
suffix:semicolon
)brace
id|RTL_W32_F
(paren
id|MAR0
op_plus
l_int|0
comma
id|mc_filter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|RTL_W32_F
(paren
id|MAR0
op_plus
l_int|4
comma
id|mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_set_rx_mode
r_static
r_void
id|rtl8139_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|__set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|rtl8139_suspend
r_static
r_int
id|rtl8139_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|pci_save_state
(paren
id|pdev
comma
id|tp-&gt;pci_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts, stop Tx and Rx. */
id|RTL_W16
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
id|RTL_W8
(paren
id|ChipCmd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|pci_set_power_state
(paren
id|pdev
comma
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8139_resume
r_static
r_int
id|rtl8139_resume
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|rtl8139_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pci_restore_state
(paren
id|pdev
comma
id|tp-&gt;pci_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|pci_set_power_state
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|rtl8139_init_ring
(paren
id|dev
)paren
suffix:semicolon
id|rtl8139_hw_start
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_attach
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|variable|rtl8139_pci_driver
r_static
r_struct
id|pci_driver
id|rtl8139_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|DRV_NAME
comma
dot
id|id_table
op_assign
id|rtl8139_pci_tbl
comma
dot
id|probe
op_assign
id|rtl8139_init_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|rtl8139_remove_one
)paren
comma
macro_line|#ifdef CONFIG_PM
dot
id|suspend
op_assign
id|rtl8139_suspend
comma
dot
id|resume
op_assign
id|rtl8139_resume
comma
macro_line|#endif /* CONFIG_PM */
)brace
suffix:semicolon
DECL|function|rtl8139_init_module
r_static
r_int
id|__init
id|rtl8139_init_module
(paren
r_void
)paren
(brace
multiline_comment|/* when we&squot;re a module, we always print a version message,&n;&t; * even if no 8139 board is found.&n;&t; */
macro_line|#ifdef MODULE
id|printk
(paren
id|KERN_INFO
id|RTL8139_DRIVER_NAME
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
(paren
op_amp
id|rtl8139_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|rtl8139_cleanup_module
r_static
r_void
id|__exit
id|rtl8139_cleanup_module
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|rtl8139_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|rtl8139_init_module
id|module_init
c_func
(paren
id|rtl8139_init_module
)paren
suffix:semicolon
DECL|variable|rtl8139_cleanup_module
id|module_exit
c_func
(paren
id|rtl8139_cleanup_module
)paren
suffix:semicolon
eof
