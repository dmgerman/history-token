multiline_comment|/******************************************************************************&n; *&n; * Name:&t;skaddr.c&n; * Project:&t;Gigabit Ethernet Adapters, ADDR-Module&n; * Version:&t;$Revision: 1.52 $&n; * Date:&t;$Date: 2003/06/02 13:46:15 $&n; * Purpose:&t;Manage Addresses (Multicast and Unicast) and Promiscuous Mode.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998-2002 SysKonnect GmbH.&n; *&t;(C)Copyright 2002-2003 Marvell.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * Description:&n; *&n; * This module is intended to manage multicast addresses, address override,&n; * and promiscuous mode on GEnesis and Yukon adapters.&n; *&n; * Address Layout:&n; *&t;port address:&t;&t;physical MAC address&n; *&t;1st exact match:&t;logical MAC address (GEnesis only)&n; *&t;2nd exact match:&t;RLMT multicast (GEnesis only)&n; *&t;exact match 3-13:&t;OS-specific multicasts (GEnesis only)&n; *&n; * Include File Hierarchy:&n; *&n; *&t;&quot;skdrv1st.h&quot;&n; *&t;&quot;skdrv2nd.h&quot;&n; *&n; ******************************************************************************/
macro_line|#if (defined(DEBUG) || ((!defined(LINT)) &amp;&amp; (!defined(SK_SLIM))))
DECL|variable|SysKonnectFileId
r_static
r_const
r_char
id|SysKonnectFileId
(braket
)braket
op_assign
l_string|&quot;@(#) $Id: skaddr.c,v 1.52 2003/06/02 13:46:15 tschilli Exp $ (C) Marvell.&quot;
suffix:semicolon
macro_line|#endif /* DEBUG ||!LINT || !SK_SLIM */
DECL|macro|__SKADDR_C
mdefine_line|#define __SKADDR_C
macro_line|#ifdef __cplusplus
r_extern
l_string|&quot;C&quot;
(brace
macro_line|#endif&t;/* cplusplus */
macro_line|#include &quot;h/skdrv1st.h&quot;
macro_line|#include &quot;h/skdrv2nd.h&quot;
multiline_comment|/* defines ********************************************************************/
DECL|macro|XMAC_POLY
mdefine_line|#define XMAC_POLY&t;0xEDB88320UL&t;/* CRC32-Poly - XMAC: Little Endian */
DECL|macro|GMAC_POLY
mdefine_line|#define GMAC_POLY&t;0x04C11DB7L&t;/* CRC16-Poly - GMAC: Little Endian */
DECL|macro|HASH_BITS
mdefine_line|#define HASH_BITS&t;6&t;&t;&t;&t;/* #bits in hash */
DECL|macro|SK_MC_BIT
mdefine_line|#define&t;SK_MC_BIT&t;0x01
multiline_comment|/* Error numbers and messages. */
DECL|macro|SKERR_ADDR_E001
mdefine_line|#define SKERR_ADDR_E001&t;&t;(SK_ERRBASE_ADDR + 0)
DECL|macro|SKERR_ADDR_E001MSG
mdefine_line|#define SKERR_ADDR_E001MSG&t;&quot;Bad Flags.&quot;
DECL|macro|SKERR_ADDR_E002
mdefine_line|#define SKERR_ADDR_E002&t;&t;(SKERR_ADDR_E001 + 1)
DECL|macro|SKERR_ADDR_E002MSG
mdefine_line|#define SKERR_ADDR_E002MSG&t;&quot;New Error.&quot;
multiline_comment|/* typedefs *******************************************************************/
multiline_comment|/* None. */
multiline_comment|/* global variables ***********************************************************/
multiline_comment|/* 64-bit hash values with all bits set. */
DECL|variable|OnesHash
r_static
r_const
id|SK_U16
id|OnesHash
(braket
l_int|4
)braket
op_assign
(brace
l_int|0xFFFF
comma
l_int|0xFFFF
comma
l_int|0xFFFF
comma
l_int|0xFFFF
)brace
suffix:semicolon
multiline_comment|/* local variables ************************************************************/
macro_line|#ifdef DEBUG
DECL|variable|Next0
r_static
r_int
id|Next0
(braket
id|SK_MAX_MACS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* functions ******************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrInit - initialize data, set state to init&n; *&n; * Description:&n; *&n; *&t;SK_INIT_DATA&n; *&t;============&n; *&n; *&t;This routine clears the multicast tables and resets promiscuous mode.&n; *&t;Some entries are reserved for the &quot;logical MAC address&quot;, the&n; *&t;SK-RLMT multicast address, and the BPDU multicast address.&n; *&n; *&n; *&t;SK_INIT_IO&n; *&t;==========&n; *&n; *&t;All permanent MAC addresses are read from EPROM.&n; *&t;If the current MAC addresses are not already set in software,&n; *&t;they are set to the values of the permanent addresses.&n; *&t;The current addresses are written to the corresponding MAC.&n; *&n; *&n; *&t;SK_INIT_RUN&n; *&t;===========&n; *&n; *&t;Nothing.&n; *&n; * Context:&n; *&t;init, pageable&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; */
DECL|function|SkAddrInit
r_int
id|SkAddrInit
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* the adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
r_int
id|Level
)paren
multiline_comment|/* initialization level */
(brace
r_int
id|j
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_U8
op_star
id|InAddr
suffix:semicolon
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
r_switch
c_cond
(paren
id|Level
)paren
(brace
r_case
id|SK_INIT_DATA
suffix:colon
id|SK_MEMSET
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pAC-&gt;Addr
comma
(paren
id|SK_U8
)paren
l_int|0
comma
(paren
id|SK_U16
)paren
r_sizeof
(paren
id|SK_ADDR
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
suffix:semicolon
id|pAPort-&gt;PromMode
op_assign
id|SK_PROM_MODE_NONE
suffix:semicolon
id|pAPort-&gt;FirstExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
id|pAPort-&gt;FirstExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
id|pAPort-&gt;NextExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
id|pAPort-&gt;NextExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
)brace
macro_line|#ifdef xDEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|4
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_DATA; */
r_break
suffix:semicolon
r_case
id|SK_INIT_IO
suffix:colon
macro_line|#ifndef SK_NO_RLMT
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_NETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|ActivePort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|ActivePort
suffix:semicolon
)brace
macro_line|#endif /* !SK_NO_RLMT */
macro_line|#ifdef xDEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|8
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* Read permanent logical MAC address from Control Register File. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|InAddr
op_assign
(paren
id|SK_U8
op_star
)paren
op_amp
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|PermanentMacAddress.a
(braket
id|j
)braket
suffix:semicolon
id|SK_IN8
c_func
(paren
id|IoC
comma
id|B2_MAC_1
op_plus
id|j
comma
id|InAddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
multiline_comment|/* Set the current logical MAC address to the permanent one. */
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|CurrentMacAddress
op_assign
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|PermanentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/* Set the current logical MAC address. */
id|pAC-&gt;Addr.Port
(braket
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|ActivePort
)braket
dot
id|Exact
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|CurrentMacAddress
suffix:semicolon
macro_line|#if SK_MAX_NETS &gt; 1
multiline_comment|/* Set logical MAC address for net 2 to (log | 3). */
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|PermanentMacAddress
op_assign
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|PermanentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|5
)braket
op_or_assign
l_int|3
suffix:semicolon
multiline_comment|/* Set the current logical MAC address to the permanent one. */
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|CurrentMacAddress
op_assign
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|PermanentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
macro_line|#endif&t;/* SK_MAX_NETS &gt; 1 */
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Permanent MAC Address (Net%d): %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|i
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;Logical MAC Address (Net%d): %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|i
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
)brace
macro_line|#endif&t;/* DEBUG */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Read permanent port addresses from Control Register File. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|j
op_increment
)paren
(brace
id|InAddr
op_assign
(paren
id|SK_U8
op_star
)paren
op_amp
id|pAPort-&gt;PermanentMacAddress.a
(braket
id|j
)braket
suffix:semicolon
id|SK_IN8
c_func
(paren
id|IoC
comma
id|B2_MAC_2
op_plus
l_int|8
op_star
id|i
op_plus
id|j
comma
id|InAddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAPort-&gt;CurrentMacAddressSet
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Set the current and previous physical MAC address&n;&t;&t;&t;&t; * of this port to its permanent MAC address.&n;&t;&t;&t;&t; */
id|pAPort-&gt;CurrentMacAddress
op_assign
id|pAPort-&gt;PermanentMacAddress
suffix:semicolon
id|pAPort-&gt;PreviousMacAddress
op_assign
id|pAPort-&gt;PermanentMacAddress
suffix:semicolon
id|pAPort-&gt;CurrentMacAddressSet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
multiline_comment|/* Set port&squot;s current physical MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
suffix:semicolon
macro_line|#ifdef GENESIS
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|i
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
)brace
macro_line|#endif /* GENESIS */
macro_line|#ifdef YUKON
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|GM_OUTADDR
c_func
(paren
id|IoC
comma
id|i
comma
id|GM_SRC_ADDR_1L
comma
id|OutAddr
)paren
suffix:semicolon
)brace
macro_line|#endif /* YUKON */
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;SkAddrInit: Permanent Physical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;SkAddrInit: Physical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif /* DEBUG */
)brace
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_IO; */
r_break
suffix:semicolon
r_case
id|SK_INIT_RUN
suffix:colon
macro_line|#ifdef xDEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|i
)braket
op_or_assign
l_int|16
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* pAC-&gt;Addr.InitDone = SK_INIT_RUN; */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* error */
r_break
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrInit */
macro_line|#ifndef SK_SLIM
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcClear - clear the multicast table&n; *&n; * Description:&n; *&t;This routine clears the multicast table.&n; *&n; *&t;If not suppressed by Flag SK_MC_SW_ONLY, the hardware is updated&n; *&t;immediately.&n; *&n; *&t;It calls either SkAddrXmacMcClear or SkAddrGmacMcClear, according&n; *&t;to the adapter in use. The real work is done there.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called starting with SK_INIT_DATA with flag SK_MC_SW_ONLY&n; *&t;may be called after SK_INIT_IO without limitation&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrMcClear
r_int
id|SkAddrMcClear
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Index of affected port */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-perm, sw-only */
(brace
r_int
id|ReturnCode
suffix:semicolon
r_if
c_cond
(paren
id|PortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrXmacMcClear
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|Flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|ReturnCode
op_assign
id|SkAddrGmacMcClear
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|Flags
)paren
suffix:semicolon
)brace
r_return
(paren
id|ReturnCode
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrMcClear */
macro_line|#endif /* !SK_SLIM */
macro_line|#ifndef SK_SLIM
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrXmacMcClear - clear the multicast table&n; *&n; * Description:&n; *&t;This routine clears the multicast table&n; *&t;(either entry 2 or entries 3-16 and InexactFilter) of the given port.&n; *&t;If not suppressed by Flag SK_MC_SW_ONLY, the hardware is updated&n; *&t;immediately.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called starting with SK_INIT_DATA with flag SK_MC_SW_ONLY&n; *&t;may be called after SK_INIT_IO without limitation&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrXmacMcClear
r_int
id|SkAddrXmacMcClear
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Index of affected port */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-perm, sw-only */
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
multiline_comment|/* permanent =&gt; RLMT */
multiline_comment|/* Clear RLMT multicast addresses. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchRlmt
op_assign
id|SK_ADDR_FIRST_MATCH_RLMT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* not permanent =&gt; DRV */
multiline_comment|/* Clear InexactFilter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Clear DRV multicast addresses. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchDrv
op_assign
id|SK_ADDR_FIRST_MATCH_DRV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|Flags
op_amp
id|SK_MC_SW_ONLY
)paren
)paren
(brace
(paren
r_void
)paren
id|SkAddrXmacMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrXmacMcClear */
macro_line|#endif /* !SK_SLIM */
macro_line|#ifndef SK_SLIM
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrGmacMcClear - clear the multicast table&n; *&n; * Description:&n; *&t;This routine clears the multicast hashing table (InexactFilter)&n; *&t;(either the RLMT or the driver bits) of the given port.&n; *&n; *&t;If not suppressed by Flag SK_MC_SW_ONLY, the hardware is updated&n; *&t;immediately.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called starting with SK_INIT_DATA with flag SK_MC_SW_ONLY&n; *&t;may be called after SK_INIT_IO without limitation&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrGmacMcClear
r_int
id|SkAddrGmacMcClear
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Index of affected port */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-perm, sw-only */
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;GMAC InexactFilter (not cleared): %02X %02X %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|5
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|6
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|7
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* Clear InexactFilter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
multiline_comment|/* permanent =&gt; RLMT */
multiline_comment|/* Copy DRV bits to InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Clear InexactRlmtFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* not permanent =&gt; DRV */
multiline_comment|/* Copy RLMT bits to InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Clear InexactDrvFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;GMAC InexactFilter (cleared): %02X %02X %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|5
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|6
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|7
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
op_logical_neg
(paren
id|Flags
op_amp
id|SK_MC_SW_ONLY
)paren
)paren
(brace
(paren
r_void
)paren
id|SkAddrGmacMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrGmacMcClear */
macro_line|#ifndef SK_ADDR_CHEAT
multiline_comment|/******************************************************************************&n; *&n; *&t;SkXmacMcHash - hash multicast address&n; *&n; * Description:&n; *&t;This routine computes the hash value for a multicast address.&n; *&t;A CRC32 algorithm is used.&n; *&n; * Notes:&n; *&t;The code was adapted from the XaQti data sheet.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&n; * Returns:&n; *&t;Hash value of multicast address.&n; */
DECL|function|SkXmacMcHash
id|SK_U32
id|SkXmacMcHash
c_func
(paren
r_int
r_char
op_star
id|pMc
)paren
multiline_comment|/* Multicast address */
(brace
id|SK_U32
id|Idx
suffix:semicolon
id|SK_U32
id|Bit
suffix:semicolon
id|SK_U32
id|Data
suffix:semicolon
id|SK_U32
id|Crc
suffix:semicolon
id|Crc
op_assign
l_int|0xFFFFFFFFUL
suffix:semicolon
r_for
c_loop
(paren
id|Idx
op_assign
l_int|0
suffix:semicolon
id|Idx
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|Idx
op_increment
)paren
(brace
id|Data
op_assign
op_star
id|pMc
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|Bit
op_assign
l_int|0
suffix:semicolon
id|Bit
OL
l_int|8
suffix:semicolon
id|Bit
op_increment
comma
id|Data
op_rshift_assign
l_int|1
)paren
(brace
id|Crc
op_assign
(paren
id|Crc
op_rshift
l_int|1
)paren
op_xor
(paren
(paren
(paren
id|Crc
op_xor
id|Data
)paren
op_amp
l_int|1
)paren
ques
c_cond
id|XMAC_POLY
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
id|Crc
op_amp
(paren
(paren
l_int|1
op_lshift
id|HASH_BITS
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* SkXmacMcHash */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkGmacMcHash - hash multicast address&n; *&n; * Description:&n; *&t;This routine computes the hash value for a multicast address.&n; *&t;A CRC16 algorithm is used.&n; *&n; * Notes:&n; *&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&n; * Returns:&n; *&t;Hash value of multicast address.&n; */
DECL|function|SkGmacMcHash
id|SK_U32
id|SkGmacMcHash
c_func
(paren
r_int
r_char
op_star
id|pMc
)paren
multiline_comment|/* Multicast address */
(brace
id|SK_U32
id|Data
suffix:semicolon
id|SK_U32
id|TmpData
suffix:semicolon
id|SK_U32
id|Crc
suffix:semicolon
r_int
id|Byte
suffix:semicolon
r_int
id|Bit
suffix:semicolon
id|Crc
op_assign
l_int|0xFFFFFFFFUL
suffix:semicolon
r_for
c_loop
(paren
id|Byte
op_assign
l_int|0
suffix:semicolon
id|Byte
OL
l_int|6
suffix:semicolon
id|Byte
op_increment
)paren
(brace
multiline_comment|/* Get next byte. */
id|Data
op_assign
(paren
id|SK_U32
)paren
id|pMc
(braket
id|Byte
)braket
suffix:semicolon
multiline_comment|/* Change bit order in byte. */
id|TmpData
op_assign
id|Data
suffix:semicolon
r_for
c_loop
(paren
id|Bit
op_assign
l_int|0
suffix:semicolon
id|Bit
OL
l_int|8
suffix:semicolon
id|Bit
op_increment
)paren
(brace
r_if
c_cond
(paren
id|TmpData
op_amp
l_int|1L
)paren
(brace
id|Data
op_or_assign
l_int|1L
op_lshift
(paren
l_int|7
op_minus
id|Bit
)paren
suffix:semicolon
)brace
r_else
(brace
id|Data
op_and_assign
op_complement
(paren
l_int|1L
op_lshift
(paren
l_int|7
op_minus
id|Bit
)paren
)paren
suffix:semicolon
)brace
id|TmpData
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|Crc
op_xor_assign
(paren
id|Data
op_lshift
l_int|24
)paren
suffix:semicolon
r_for
c_loop
(paren
id|Bit
op_assign
l_int|0
suffix:semicolon
id|Bit
OL
l_int|8
suffix:semicolon
id|Bit
op_increment
)paren
(brace
r_if
c_cond
(paren
id|Crc
op_amp
l_int|0x80000000
)paren
(brace
id|Crc
op_assign
(paren
id|Crc
op_lshift
l_int|1
)paren
op_xor
id|GMAC_POLY
suffix:semicolon
)brace
r_else
(brace
id|Crc
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_return
(paren
id|Crc
op_amp
(paren
(paren
l_int|1
op_lshift
id|HASH_BITS
)paren
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGmacMcHash */
macro_line|#endif&t;/* !SK_ADDR_CHEAT */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcAdd - add a multicast address to a port&n; *&n; * Description:&n; *&t;This routine enables reception for a given address on the given port.&n; *&n; *&t;It calls either SkAddrXmacMcAdd or SkAddrGmacMcAdd, according to the&n; *&t;adapter in use. The real work is done there.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_DATA&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_MC_ILLEGAL_ADDRESS&n; *&t;SK_MC_ILLEGAL_PORT&n; *&t;SK_MC_RLMT_OVERFLOW&n; */
DECL|function|SkAddrMcAdd
r_int
id|SkAddrMcAdd
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Port Number */
id|SK_MAC_ADDR
op_star
id|pMc
comma
multiline_comment|/* multicast address to be added */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-permanent */
(brace
r_int
id|ReturnCode
suffix:semicolon
r_if
c_cond
(paren
id|PortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrXmacMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pMc
comma
id|Flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|ReturnCode
op_assign
id|SkAddrGmacMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pMc
comma
id|Flags
)paren
suffix:semicolon
)brace
r_return
(paren
id|ReturnCode
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrMcAdd */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrXmacMcAdd - add a multicast address to a port&n; *&n; * Description:&n; *&t;This routine enables reception for a given address on the given port.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; *&t;The multicast bit is only checked if there are no free exact match&n; *&t;entries.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_DATA&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_MC_ILLEGAL_ADDRESS&n; *&t;SK_MC_RLMT_OVERFLOW&n; */
DECL|function|SkAddrXmacMcAdd
r_int
id|SkAddrXmacMcAdd
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Port Number */
id|SK_MAC_ADDR
op_star
id|pMc
comma
multiline_comment|/* multicast address to be added */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-permanent */
(brace
r_int
id|i
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
macro_line|#ifndef SK_ADDR_CHEAT
id|SK_U32
id|HashBit
suffix:semicolon
macro_line|#endif&t;/* !defined(SK_ADDR_CHEAT) */
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
multiline_comment|/* permanent =&gt; RLMT */
macro_line|#ifdef xDEBUG
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchRlmt
OL
id|SK_ADDR_FIRST_MATCH_RLMT
)paren
(brace
id|Next0
(braket
id|PortNumber
)braket
op_or_assign
l_int|1
suffix:semicolon
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchRlmt
OG
id|SK_ADDR_LAST_MATCH_RLMT
)paren
(brace
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
multiline_comment|/* Set a RLMT multicast address. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchRlmt
op_increment
)braket
op_assign
op_star
id|pMc
suffix:semicolon
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
macro_line|#ifdef xDEBUG
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchDrv
OL
id|SK_ADDR_FIRST_MATCH_DRV
)paren
(brace
id|Next0
(braket
id|PortNumber
)braket
op_or_assign
l_int|2
suffix:semicolon
r_return
(paren
id|SK_MC_RLMT_OVERFLOW
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchDrv
op_le
id|SK_ADDR_LAST_MATCH_DRV
)paren
(brace
multiline_comment|/* Set exact match entry. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|NextExactMatchDrv
op_increment
)braket
op_assign
op_star
id|pMc
suffix:semicolon
multiline_comment|/* Clear InexactFilter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pMc-&gt;a
(braket
l_int|0
)braket
op_amp
id|SK_MC_BIT
)paren
)paren
(brace
multiline_comment|/* Hashing only possible with multicast addresses */
r_return
(paren
id|SK_MC_ILLEGAL_ADDRESS
)paren
suffix:semicolon
)brace
macro_line|#ifndef SK_ADDR_CHEAT
multiline_comment|/* Compute hash value of address. */
id|HashBit
op_assign
l_int|63
op_minus
id|SkXmacMcHash
c_func
(paren
op_amp
id|pMc-&gt;a
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Add bit to InexactFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|HashBit
op_div
l_int|8
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|HashBit
op_mod
l_int|8
)paren
suffix:semicolon
macro_line|#else&t;/* SK_ADDR_CHEAT */
multiline_comment|/* Set all bits in InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0xFF
suffix:semicolon
)brace
macro_line|#endif&t;/* SK_ADDR_CHEAT */
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
op_logical_and
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SkAddrXmacMcAdd */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrGmacMcAdd - add a multicast address to a port&n; *&n; * Description:&n; *&t;This routine enables reception for a given address on the given port.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_DATA&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_MC_ILLEGAL_ADDRESS&n; */
DECL|function|SkAddrGmacMcAdd
r_int
id|SkAddrGmacMcAdd
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Port Number */
id|SK_MAC_ADDR
op_star
id|pMc
comma
multiline_comment|/* multicast address to be added */
r_int
id|Flags
)paren
multiline_comment|/* permanent/non-permanent */
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifndef SK_ADDR_CHEAT
id|SK_U32
id|HashBit
suffix:semicolon
macro_line|#endif&t;/* !defined(SK_ADDR_CHEAT) */
r_if
c_cond
(paren
op_logical_neg
(paren
id|pMc-&gt;a
(braket
l_int|0
)braket
op_amp
id|SK_MC_BIT
)paren
)paren
(brace
multiline_comment|/* Hashing only possible with multicast addresses */
r_return
(paren
id|SK_MC_ILLEGAL_ADDRESS
)paren
suffix:semicolon
)brace
macro_line|#ifndef SK_ADDR_CHEAT
multiline_comment|/* Compute hash value of address. */
id|HashBit
op_assign
id|SkGmacMcHash
c_func
(paren
op_amp
id|pMc-&gt;a
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PERMANENT
)paren
(brace
multiline_comment|/* permanent =&gt; RLMT */
multiline_comment|/* Add bit to InexactRlmtFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
id|HashBit
op_div
l_int|8
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|HashBit
op_mod
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Copy bit to InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;GMAC InexactRlmtFilter: %02X %02X %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|5
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|6
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactRlmtFilter.Bytes
(braket
l_int|7
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
)brace
r_else
(brace
multiline_comment|/* not permanent =&gt; DRV */
multiline_comment|/* Add bit to InexactDrvFilter. */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
id|HashBit
op_div
l_int|8
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|HashBit
op_mod
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Copy bit to InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;GMAC InexactDrvFilter: %02X %02X %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|5
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|6
)braket
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactDrvFilter.Bytes
(braket
l_int|7
)braket
)paren
)paren
macro_line|#endif&t;/* DEBUG */
)brace
macro_line|#else&t;/* SK_ADDR_CHEAT */
multiline_comment|/* Set all bits in InexactFilter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
l_int|0xFF
suffix:semicolon
)brace
macro_line|#endif&t;/* SK_ADDR_CHEAT */
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrGmacMcAdd */
macro_line|#endif /* !SK_SLIM */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrMcUpdate - update the HW MC address table and set the MAC address&n; *&n; * Description:&n; *&t;This routine enables reception of the addresses contained in a local&n; *&t;table for a given port.&n; *&t;It also programs the port&squot;s current physical MAC address.&n; *&n; *&t;It calls either SkAddrXmacMcUpdate or SkAddrGmacMcUpdate, according&n; *&t;to the adapter in use. The real work is done there.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrMcUpdate
r_int
id|SkAddrMcUpdate
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port Number */
(brace
r_int
id|ReturnCode
op_assign
l_int|0
suffix:semicolon
macro_line|#if (!defined(SK_SLIM) || defined(DEBUG))
r_if
c_cond
(paren
id|PortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
macro_line|#endif /* !SK_SLIM || DEBUG */
macro_line|#ifdef GENESIS
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrXmacMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
macro_line|#endif /* GENESIS */
macro_line|#ifdef YUKON
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrGmacMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
macro_line|#endif /* YUKON */
r_return
(paren
id|ReturnCode
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrMcUpdate */
macro_line|#ifdef GENESIS
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrXmacMcUpdate - update the HW MC address table and set the MAC address&n; *&n; * Description:&n; *&t;This routine enables reception of the addresses contained in a local&n; *&t;table for a given port.&n; *&t;It also programs the port&squot;s current physical MAC address.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrXmacMcUpdate
r_int
id|SkAddrXmacMcUpdate
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port Number */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrXmacMcUpdate on Port %u.&bslash;n&quot;
comma
id|PortNumber
)paren
)paren
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Next0 on Port %d: %d&bslash;n&quot;
comma
id|PortNumber
comma
id|Next0
(braket
id|PortNumber
)braket
)paren
)paren
macro_line|#endif /* DEBUG */
multiline_comment|/* Start with 0 to also program the logical MAC address. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAPort-&gt;NextExactMatchRlmt
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Set exact match address i on XMAC */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|OutAddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear other permanent exact match addresses on XMAC */
r_if
c_cond
(paren
id|pAPort-&gt;NextExactMatchRlmt
op_le
id|SK_ADDR_LAST_MATCH_RLMT
)paren
(brace
id|SkXmClrExactAddr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pAPort-&gt;NextExactMatchRlmt
comma
id|SK_ADDR_LAST_MATCH_RLMT
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|pAPort-&gt;FirstExactMatchDrv
suffix:semicolon
id|i
OL
id|pAPort-&gt;NextExactMatchDrv
suffix:semicolon
id|i
op_increment
)paren
(brace
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|OutAddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear other non-permanent exact match addresses on XMAC */
r_if
c_cond
(paren
id|pAPort-&gt;NextExactMatchDrv
op_le
id|SK_ADDR_LAST_MATCH_DRV
)paren
(brace
id|SkXmClrExactAddr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pAPort-&gt;NextExactMatchDrv
comma
id|SK_ADDR_LAST_MATCH_DRV
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAPort-&gt;InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
(brace
multiline_comment|/* Set all bits in 64-bit hash register. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_HSM
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Inexact
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_HSM
comma
op_amp
id|pAPort-&gt;InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_ne
id|SK_PROM_MODE_NONE
)paren
(brace
(paren
r_void
)paren
id|SkAddrXmacPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pAPort-&gt;PromMode
)paren
suffix:semicolon
)brace
multiline_comment|/* Set port&squot;s current physical MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
suffix:semicolon
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
macro_line|#ifdef xDEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAPort-&gt;NextExactMatchRlmt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_U8
id|InAddr8
(braket
l_int|6
)braket
suffix:semicolon
id|SK_U16
op_star
id|InAddr
suffix:semicolon
multiline_comment|/* Get exact match address i from port PortNumber. */
id|InAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|InAddr8
(braket
l_int|0
)braket
suffix:semicolon
id|XM_INADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_EXM
c_func
(paren
id|i
)paren
comma
id|InAddr
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrXmacMcUpdate: MC address %d on Port %u: &quot;
comma
l_string|&quot;%02x %02x %02x %02x %02x %02x -- %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|i
comma
id|PortNumber
comma
id|InAddr8
(braket
l_int|0
)braket
comma
id|InAddr8
(braket
l_int|1
)braket
comma
id|InAddr8
(braket
l_int|2
)braket
comma
id|InAddr8
(braket
l_int|3
)braket
comma
id|InAddr8
(braket
l_int|4
)braket
comma
id|InAddr8
(braket
l_int|5
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;Exact
(braket
id|i
)braket
dot
id|a
(braket
l_int|5
)braket
)paren
)paren
)brace
macro_line|#endif /* DEBUG */
multiline_comment|/* Determine return value. */
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
op_logical_and
id|pAPort-&gt;PromMode
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SkAddrXmacMcUpdate */
macro_line|#endif  /* GENESIS */
macro_line|#ifdef YUKON
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrGmacMcUpdate - update the HW MC address table and set the MAC address&n; *&n; * Description:&n; *&t;This routine enables reception of the addresses contained in a local&n; *&t;table for a given port.&n; *&t;It also programs the port&squot;s current physical MAC address.&n; *&n; * Notes:&n; *&t;The return code is only valid for SK_PROM_MODE_NONE.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_MC_FILTERING_EXACT&n; *&t;SK_MC_FILTERING_INEXACT&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrGmacMcUpdate
r_int
id|SkAddrGmacMcUpdate
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port Number */
(brace
macro_line|#ifndef SK_SLIM
id|SK_U32
id|i
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
macro_line|#endif&t;/* not SK_SLIM */
id|SK_U16
op_star
id|OutAddr
suffix:semicolon
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrGmacMcUpdate on Port %u.&bslash;n&quot;
comma
id|PortNumber
)paren
)paren
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Next0 on Port %d: %d&bslash;n&quot;
comma
id|PortNumber
comma
id|Next0
(braket
id|PortNumber
)braket
)paren
)paren
macro_line|#endif /* DEBUG */
macro_line|#ifndef SK_SLIM
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAPort-&gt;InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|GM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_MC_ADDR_H1
comma
op_amp
id|pAPort-&gt;InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
(brace
multiline_comment|/* Set all bits in 64-bit hash register. */
id|GM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_MC_ADDR_H1
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Enable Hashing. */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAPort-&gt;PromMode
op_ne
id|SK_PROM_MODE_NONE
)paren
(brace
(paren
r_void
)paren
id|SkAddrGmacPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pAPort-&gt;PromMode
)paren
suffix:semicolon
)brace
macro_line|#else /* SK_SLIM */
multiline_comment|/* Set all bits in 64-bit hash register. */
id|GM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_MC_ADDR_H1
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
(paren
r_void
)paren
id|SkAddrGmacPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|pAPort-&gt;PromMode
)paren
suffix:semicolon
macro_line|#endif /* SK_SLIM */
multiline_comment|/* Set port&squot;s current physical MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
suffix:semicolon
id|GM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_SRC_ADDR_1L
comma
id|OutAddr
)paren
suffix:semicolon
multiline_comment|/* Set port&squot;s current logical MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|0
)braket
suffix:semicolon
id|GM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_SRC_ADDR_2L
comma
id|OutAddr
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrGmacMcUpdate: Permanent Physical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;Exact
(braket
l_int|0
)braket
dot
id|a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrGmacMcUpdate: Physical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif /* DEBUG */
macro_line|#ifndef SK_SLIM
multiline_comment|/* Determine return value. */
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
op_logical_and
id|pAPort-&gt;PromMode
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|SK_MC_FILTERING_EXACT
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
)brace
macro_line|#else /* SK_SLIM */
r_return
(paren
id|SK_MC_FILTERING_INEXACT
)paren
suffix:semicolon
macro_line|#endif /* SK_SLIM */
)brace
multiline_comment|/* SkAddrGmacMcUpdate */
macro_line|#endif /* YUKON */
macro_line|#ifndef SK_NO_MAO
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrOverride - override a port&squot;s MAC address&n; *&n; * Description:&n; *&t;This routine overrides the MAC address of one port.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS if successful.&n; *&t;SK_ADDR_DUPLICATE_ADDRESS if duplicate MAC address.&n; *&t;SK_ADDR_MULTICAST_ADDRESS if multicast or broadcast address.&n; *&t;SK_ADDR_TOO_EARLY if SK_INIT_IO was not executed before.&n; */
DECL|function|SkAddrOverride
r_int
id|SkAddrOverride
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Port Number */
id|SK_MAC_ADDR
id|SK_FAR
op_star
id|pNewAddr
comma
multiline_comment|/* new MAC address */
r_int
id|Flags
)paren
multiline_comment|/* logical/physical MAC address */
(brace
macro_line|#ifndef SK_NO_RLMT
id|SK_EVPARA
id|Para
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
id|SK_U32
id|NetNumber
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_U16
id|SK_FAR
op_star
id|OutAddr
suffix:semicolon
macro_line|#ifndef SK_NO_RLMT
id|NetNumber
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;NetNumber
suffix:semicolon
macro_line|#else
id|NetNumber
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* SK_NO_RLMT */
macro_line|#if (!defined(SK_SLIM) || defined(DEBUG))
r_if
c_cond
(paren
id|PortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
macro_line|#endif /* !SK_SLIM || DEBUG */
r_if
c_cond
(paren
id|pNewAddr
op_ne
l_int|NULL
op_logical_and
(paren
id|pNewAddr-&gt;a
(braket
l_int|0
)braket
op_amp
id|SK_MC_BIT
)paren
op_ne
l_int|0
)paren
(brace
r_return
(paren
id|SK_ADDR_MULTICAST_ADDRESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_SET_LOGICAL
)paren
(brace
multiline_comment|/* Activate logical MAC address. */
multiline_comment|/* Parameter *pNewAddr is ignored. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef SK_NO_RLMT
multiline_comment|/* Set PortNumber to number of net&squot;s active port. */
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetNumber
)braket
dot
id|Port
(braket
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress
suffix:semicolon
multiline_comment|/* Write address to first exact match entry of active port. */
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_CLEAR_LOGICAL
)paren
(brace
multiline_comment|/* Deactivate logical MAC address. */
multiline_comment|/* Parameter *pNewAddr is ignored. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef SK_NO_RLMT
multiline_comment|/* Set PortNumber to number of net&squot;s active port. */
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetNumber
)braket
dot
id|Port
(braket
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
l_int|0
)braket
dot
id|a
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Write address to first exact match entry of active port. */
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Flags
op_amp
id|SK_ADDR_PHYSICAL_ADDRESS
)paren
(brace
multiline_comment|/* Physical MAC address. */
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|PortNumber
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
)brace
)brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PreviousMacAddress
op_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
multiline_comment|/* Change port&squot;s physical MAC address. */
id|OutAddr
op_assign
(paren
id|SK_U16
id|SK_FAR
op_star
)paren
id|pNewAddr
suffix:semicolon
macro_line|#ifdef GENESIS
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|XM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_SA
comma
id|OutAddr
)paren
suffix:semicolon
)brace
macro_line|#endif /* GENESIS */
macro_line|#ifdef YUKON
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|GM_OUTADDR
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_SRC_ADDR_1L
comma
id|OutAddr
)paren
suffix:semicolon
)brace
macro_line|#endif /* YUKON */
macro_line|#ifndef SK_NO_RLMT
multiline_comment|/* Report address change to RLMT. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORT_ADDR
comma
id|Para
)paren
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
)brace
r_else
(brace
multiline_comment|/* Logical MAC address. */
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddressSet
)paren
(brace
r_return
(paren
id|SK_ADDR_TOO_EARLY
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pNewAddr-&gt;a
comma
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
dot
id|CurrentMacAddress.a
)paren
)paren
(brace
r_return
(paren
id|SK_ADDR_DUPLICATE_ADDRESS
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * In case that the physical and the logical MAC addresses are equal&n;&t;&t; * we must also change the physical MAC address here.&n;&t;&t; * In this case we have an adapter which initially was programmed with&n;&t;&t; * two identical MAC addresses.&n;&t;&t; */
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress.a
comma
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
l_int|0
)braket
dot
id|a
)paren
)paren
(brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PreviousMacAddress
op_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
macro_line|#ifndef SK_NO_RLMT
multiline_comment|/* Report address change to RLMT. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORT_ADDR
comma
id|Para
)paren
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
)brace
macro_line|#ifndef SK_NO_RLMT
multiline_comment|/* Set PortNumber to number of net&squot;s active port. */
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetNumber
)braket
dot
id|Port
(braket
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
macro_line|#endif /* !SK_NO_RLMT */
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress
op_assign
op_star
id|pNewAddr
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|Exact
(braket
l_int|0
)braket
op_assign
op_star
id|pNewAddr
suffix:semicolon
macro_line|#ifdef DEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrOverride: Permanent MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|PermanentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_ADDR
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkAddrOverride: New logical MAC Address: %02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|0
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|1
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|2
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|3
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|4
)braket
comma
id|pAC-&gt;Addr.Net
(braket
id|NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|5
)braket
)paren
)paren
macro_line|#endif /* DEBUG */
multiline_comment|/* Write address to first exact match entry of active port. */
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrOverride */
macro_line|#endif /* SK_NO_MAO */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrPromiscuousChange - set promiscuous mode for given port&n; *&n; * Description:&n; *&t;This routine manages promiscuous mode:&n; *&t;- none&n; *&t;- all LLC frames&n; *&t;- all MC frames&n; *&n; *&t;It calls either SkAddrXmacPromiscuousChange or&n; *&t;SkAddrGmacPromiscuousChange, according to the adapter in use.&n; *&t;The real work is done there.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrPromiscuousChange
r_int
id|SkAddrPromiscuousChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* port whose promiscuous mode changes */
r_int
id|NewPromMode
)paren
multiline_comment|/* new promiscuous mode */
(brace
r_int
id|ReturnCode
op_assign
l_int|0
suffix:semicolon
macro_line|#if (!defined(SK_SLIM) || defined(DEBUG))
r_if
c_cond
(paren
id|PortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
macro_line|#endif /* !SK_SLIM || DEBUG */
macro_line|#ifdef GENESIS
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrXmacPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|NewPromMode
)paren
suffix:semicolon
)brace
macro_line|#endif /* GENESIS */
macro_line|#ifdef YUKON
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|ReturnCode
op_assign
id|SkAddrGmacPromiscuousChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|NewPromMode
)paren
suffix:semicolon
)brace
macro_line|#endif /* YUKON */
r_return
(paren
id|ReturnCode
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrPromiscuousChange */
macro_line|#ifdef GENESIS
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrXmacPromiscuousChange - set promiscuous mode for given port&n; *&n; * Description:&n; *&t;This routine manages promiscuous mode:&n; *&t;- none&n; *&t;- all LLC frames&n; *&t;- all MC frames&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrXmacPromiscuousChange
r_int
id|SkAddrXmacPromiscuousChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* port whose promiscuous mode changes */
r_int
id|NewPromMode
)paren
multiline_comment|/* new promiscuous mode */
(brace
r_int
id|i
suffix:semicolon
id|SK_BOOL
id|InexactModeBit
suffix:semicolon
id|SK_U8
id|Inexact
suffix:semicolon
id|SK_U8
id|HwInexact
suffix:semicolon
id|SK_FILTER64
id|HwInexactFilter
suffix:semicolon
id|SK_U16
id|LoMode
suffix:semicolon
multiline_comment|/* Lower 16 bits of XMAC Mode Register. */
r_int
id|CurPromMode
op_assign
id|SK_PROM_MODE_NONE
suffix:semicolon
multiline_comment|/* Read CurPromMode from Hardware. */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|LoMode
op_amp
id|XM_MD_ENA_PROM
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Promiscuous mode! */
id|CurPromMode
op_or_assign
id|SK_PROM_MODE_LLC
suffix:semicolon
)brace
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0xFF
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_and_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0xFF
)paren
(brace
id|CurPromMode
op_or_assign
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Get InexactModeBit (bit XM_MD_ENA_HASH in mode register) */
id|XM_IN16
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_MODE
comma
op_amp
id|LoMode
)paren
suffix:semicolon
id|InexactModeBit
op_assign
(paren
id|LoMode
op_amp
id|XM_MD_ENA_HASH
)paren
op_ne
l_int|0
suffix:semicolon
multiline_comment|/* Read 64-bit hash register from XMAC */
id|XM_INHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_HSM
comma
op_amp
id|HwInexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|HwInexact
op_assign
l_int|0xFF
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|HwInexact
op_and_assign
id|HwInexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|InexactModeBit
op_logical_and
(paren
id|HwInexact
op_eq
l_int|0xFF
)paren
)paren
(brace
id|CurPromMode
op_or_assign
id|SK_PROM_MODE_ALL_MC
suffix:semicolon
)brace
)brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_assign
id|NewPromMode
suffix:semicolon
r_if
c_cond
(paren
id|NewPromMode
op_eq
id|CurPromMode
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* All MC. */
multiline_comment|/* Set all bits in 64-bit hash register. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_HSM
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* Norm MC. */
r_for
c_loop
(paren
id|Inexact
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Inexact
op_or_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Inexact
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Disable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|XM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|XM_HSM
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Prom. LLC */
multiline_comment|/* Set the MAC in Promiscuous Mode */
id|SkMacPromiscMode
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Norm. LLC. */
multiline_comment|/* Clear Promiscuous Mode */
id|SkMacPromiscMode
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrXmacPromiscuousChange */
macro_line|#endif /* GENESIS */
macro_line|#ifdef YUKON
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrGmacPromiscuousChange - set promiscuous mode for given port&n; *&n; * Description:&n; *&t;This routine manages promiscuous mode:&n; *&t;- none&n; *&t;- all LLC frames&n; *&t;- all MC frames&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrGmacPromiscuousChange
r_int
id|SkAddrGmacPromiscuousChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* port whose promiscuous mode changes */
r_int
id|NewPromMode
)paren
multiline_comment|/* new promiscuous mode */
(brace
id|SK_U16
id|ReceiveControl
suffix:semicolon
multiline_comment|/* GMAC Receive Control Register */
r_int
id|CurPromMode
op_assign
id|SK_PROM_MODE_NONE
suffix:semicolon
multiline_comment|/* Read CurPromMode from Hardware. */
id|GM_IN16
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_RX_CTRL
comma
op_amp
id|ReceiveControl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ReceiveControl
op_amp
(paren
id|GM_RXCR_UCF_ENA
op_or
id|GM_RXCR_MCF_ENA
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Promiscuous mode! */
id|CurPromMode
op_or_assign
id|SK_PROM_MODE_LLC
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ReceiveControl
op_amp
id|GM_RXCR_MCF_ENA
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* All Multicast mode! */
id|CurPromMode
op_or_assign
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
suffix:semicolon
)brace
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_assign
id|NewPromMode
suffix:semicolon
r_if
c_cond
(paren
id|NewPromMode
op_eq
id|CurPromMode
)paren
(brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* All MC */
multiline_comment|/* Set all bits in 64-bit hash register. */
id|GM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_MC_ADDR_H1
comma
op_amp
id|OnesHash
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_ALL_MC
)paren
)paren
(brace
multiline_comment|/* Norm. MC */
multiline_comment|/* Set 64-bit hash register to InexactFilter. */
id|GM_OUTHASH
c_func
(paren
id|IoC
comma
id|PortNumber
comma
id|GM_MC_ADDR_H1
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Enable Hashing. */
id|SkMacHashing
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Prom. LLC */
multiline_comment|/* Set the MAC to Promiscuous Mode. */
id|SkMacPromiscMode
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_TRUE
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|CurPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_and
op_logical_neg
(paren
id|NewPromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
)paren
(brace
multiline_comment|/* Norm. LLC */
multiline_comment|/* Clear Promiscuous Mode. */
id|SkMacPromiscMode
c_func
(paren
id|pAC
comma
id|IoC
comma
(paren
r_int
)paren
id|PortNumber
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrGmacPromiscuousChange */
macro_line|#endif /* YUKON */
macro_line|#ifndef SK_SLIM
multiline_comment|/******************************************************************************&n; *&n; *&t;SkAddrSwap - swap address info&n; *&n; * Description:&n; *&t;This routine swaps address info of two ports.&n; *&n; * Context:&n; *&t;runtime, pageable&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;SK_ADDR_SUCCESS&n; *&t;SK_ADDR_ILLEGAL_PORT&n; */
DECL|function|SkAddrSwap
r_int
id|SkAddrSwap
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O context */
id|SK_U32
id|FromPortNumber
comma
multiline_comment|/* Port1 Index */
id|SK_U32
id|ToPortNumber
)paren
multiline_comment|/* Port2 Index */
(brace
r_int
id|i
suffix:semicolon
id|SK_U8
id|Byte
suffix:semicolon
id|SK_MAC_ADDR
id|MacAddr
suffix:semicolon
id|SK_U32
id|DWord
suffix:semicolon
r_if
c_cond
(paren
id|FromPortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ToPortNumber
op_ge
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|FromPortNumber
)braket
dot
id|Net
op_ne
id|pAC-&gt;Rlmt.Port
(braket
id|ToPortNumber
)braket
dot
id|Net
)paren
(brace
r_return
(paren
id|SK_ADDR_ILLEGAL_PORT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Swap:&n;&t; * - Exact Match Entries (GEnesis and Yukon)&n;&t; *   Yukon uses first entry for the logical MAC&n;&t; *   address (stored in the second GMAC register).&n;&t; * - FirstExactMatchRlmt (GEnesis only)&n;&t; * - NextExactMatchRlmt (GEnesis only)&n;&t; * - FirstExactMatchDrv (GEnesis only)&n;&t; * - NextExactMatchDrv (GEnesis only)&n;&t; * - 64-bit filter (InexactFilter)&n;&t; * - Promiscuous Mode&n;&t; * of ports.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_ADDR_EXACT_MATCHES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|MacAddr
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|Exact
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|Exact
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|Exact
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|Exact
(braket
id|i
)braket
op_assign
id|MacAddr
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Byte
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|InexactFilter.Bytes
(braket
id|i
)braket
op_assign
id|Byte
suffix:semicolon
)brace
id|i
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|PromMode
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|PromMode
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|PromMode
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|PromMode
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIGenesis
)paren
(brace
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|FirstExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|FirstExactMatchRlmt
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|FirstExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|FirstExactMatchRlmt
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|NextExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|NextExactMatchRlmt
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|NextExactMatchRlmt
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|NextExactMatchRlmt
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|FirstExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|FirstExactMatchDrv
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|FirstExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|FirstExactMatchDrv
op_assign
id|DWord
suffix:semicolon
id|DWord
op_assign
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|NextExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|FromPortNumber
)braket
dot
id|NextExactMatchDrv
op_assign
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|NextExactMatchDrv
suffix:semicolon
id|pAC-&gt;Addr.Port
(braket
id|ToPortNumber
)braket
dot
id|NextExactMatchDrv
op_assign
id|DWord
suffix:semicolon
)brace
multiline_comment|/* CAUTION: Solution works if only ports of one adapter are in use. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SK_U32
)paren
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|pAC-&gt;Rlmt.Port
(braket
id|ToPortNumber
)braket
dot
id|Net-&gt;NetNumber
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|pAC-&gt;Rlmt.Port
(braket
id|ToPortNumber
)braket
dot
id|Net-&gt;NetNumber
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
op_eq
id|ToPortNumber
)paren
(brace
id|pAC-&gt;Addr.Net
(braket
id|pAC-&gt;Rlmt.Port
(braket
id|ToPortNumber
)braket
dot
id|Net-&gt;NetNumber
)braket
dot
id|ActivePort
op_assign
id|i
suffix:semicolon
multiline_comment|/* 20001207 RA: Was &quot;ToPortNumber;&quot;. */
)brace
)brace
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPortNumber
)paren
suffix:semicolon
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPortNumber
)paren
suffix:semicolon
r_return
(paren
id|SK_ADDR_SUCCESS
)paren
suffix:semicolon
)brace
multiline_comment|/* SkAddrSwap */
macro_line|#endif /* !SK_SLIM */
macro_line|#ifdef __cplusplus
)brace
macro_line|#endif&t;/* __cplusplus */
eof
