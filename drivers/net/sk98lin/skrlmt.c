multiline_comment|/******************************************************************************&n; *&n; * Name:&t;skrlmt.c&n; * Project:&t;GEnesis, PCI Gigabit Ethernet Adapter&n; * Version:&t;$Revision: 1.61 $&n; * Date:&t;$Date: 2001/03/14 12:52:08 $&n; * Purpose:&t;Manage links on SK-NET Adapters, esp. redundant ones.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998-2001 SysKonnect GmbH.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * History:&n; *&n; *&t;$Log: skrlmt.c,v $&n; *&t;Revision 1.61  2001/03/14 12:52:08  rassmann&n; *&t;Fixed reporting of active port up/down to PNMI.&n; *&t;&n; *&t;Revision 1.60  2001/02/21 16:02:25  gklug&n; *&t;fix: when RLMT starts set Active Port for PNMI&n; *&t;&n; *&t;Revision 1.59  2001/02/16 14:38:19  rassmann&n; *&t;Initializing some pointers earlier in the init phase.&n; *&t;Rx Mbufs are freed if the net which they belong to is stopped.&n; *&t;&n; *&t;Revision 1.58  2001/02/14 14:06:31  rassmann&n; *&t;Editorial changes.&n; *&t;&n; *&t;Revision 1.57  2001/02/05 14:25:26  rassmann&n; *&t;Prepared RLMT for transparent operation.&n; *&t;&n; *&t;Revision 1.56  2001/01/30 10:29:09  rassmann&n; *&t;Not checking switching befor RlmtStart.&n; *&t;Editorial changes.&n; *&t;&n; *&t;Revision 1.55  2001/01/22 13:41:38  rassmann&n; *&t;Supporting two nets on dual-port adapters.&n; *&t;&n; *&t;Revision 1.54  2000/11/30 13:25:07  rassmann&n; *&t;Setting SK_TICK_INCR to 1 by default.&n; *&t;&n; *&t;Revision 1.53  2000/11/30 10:48:07  cgoos&n; *&t;Changed definition of SK_RLMT_BC_DELTA.&n; *&t;&n; *&t;Revision 1.52  2000/11/27 12:50:03  rassmann&n; *&t;Checking ports after receiving broadcasts.&n; *&t;&n; *&t;Revision 1.51  2000/11/17 08:58:00  rassmann&n; *&t;Moved CheckSwitch from SK_RLMT_PACKET_RECEIVED to SK_RLMT_TIM event.&n; *&t;&n; *&t;Revision 1.50  2000/11/09 12:24:34  rassmann&n; *&t;Indicating that segmentation check is not running anymore after&n; *&t;  SkRlmtCheckSeg().&n; *&t;Restarting segmentation timer after segmentation log.&n; *&t;Editorial changes.&n; *&t;&n; *&t;Revision 1.49  1999/11/22 13:38:02  cgoos&n; *&t;Changed license header to GPL.&n; *&t;Added initialization to some variables to avoid compiler warnings.&n; *&t;&n; *&t;Revision 1.48  1999/10/04 14:01:17  rassmann&n; *&t;Corrected reaction to reception of BPDU frames (#10441).&n; *&t;&n; *&t;Revision 1.47  1999/07/20 12:53:36  rassmann&n; *&t;Fixed documentation errors for lookahead macros.&n; *&t;&n; *&t;Revision 1.46  1999/05/28 13:29:16  rassmann&n; *&t;Replaced C++-style comment.&n; *&t;&n; *&t;Revision 1.45  1999/05/28 13:28:08  rassmann&n; *&t;Corrected syntax error (xxx).&n; *&t;&n; *&t;Revision 1.44  1999/05/28 11:15:54  rassmann&n; *&t;Changed behaviour to reflect Design Spec v1.2.&n; *&t;Controlling Link LED(s).&n; *&t;Introduced RLMT Packet Version field in RLMT Packet.&n; *&t;Newstyle lookahead macros (checking meta-information before looking at&n; *&t;  the packet).&n; *&t;&n; *&t;Revision 1.43  1999/01/28 13:12:43  rassmann&n; *&t;Corrected Lookahead (bug introduced in previous Rev.).&n; *&t;&n; *&t;Revision 1.42  1999/01/28 12:50:41  rassmann&n; *&t;Not using broadcast time stamps in CheckLinkState mode.&n; *&t;&n; *&t;Revision 1.41  1999/01/27 14:13:02  rassmann&n; *&t;Monitoring broadcast traffic.&n; *&t;Switching more reliably and not too early if switch is&n; *&t; configured for spanning tree.&n; *&t;&n; *&t;Revision 1.40  1999/01/22 13:17:30  rassmann&n; *&t;Informing PNMI of NET_UP.&n; *&t;Clearing RLMT multicast addresses before setting them for the first time.&n; *&t;Reporting segmentation earlier, setting a &quot;quiet time&quot;&n; *&t; after a report.&n; *&t;&n; *&t;Revision 1.39  1998/12/10 15:29:53  rassmann&n; *&t;Corrected SuspectStatus in SkRlmtBuildCheckChain().&n; *&t;Corrected CHECK_SEG mode.&n; *&t;&n; *&t;Revision 1.38  1998/12/08 13:11:23  rassmann&n; *&t;Stopping SegTimer at RlmtStop.&n; *&t;&n; *&t;Revision 1.37  1998/12/07 16:51:42  rassmann&n; *&t;Corrected comments.&n; *&t;&n; *&t;Revision 1.36  1998/12/04 10:58:56  rassmann&n; *&t;Setting next pointer to NULL when receiving.&n; *&t;&n; *&t;Revision 1.35  1998/12/03 16:12:42  rassmann&n; *&t;Ignoring/correcting illegal PrefPort values.&n; *&t;&n; *&t;Revision 1.34  1998/12/01 11:45:35  rassmann&n; *&t;Code cleanup.&n; *&t;&n; *&t;Revision 1.33  1998/12/01 10:29:32  rassmann&n; *&t;Starting standby ports before getting the net up.&n; *&t;Checking if a port is started when the link comes up.&n; *&t;&n; *&t;Revision 1.32  1998/11/30 16:19:50  rassmann&n; *&t;New default for PortNoRx.&n; *&t;&n; *&t;Revision 1.31  1998/11/27 19:17:13  rassmann&n; *&t;Corrected handling of LINK_DOWN coming shortly after LINK_UP.&n; *&t;&n; *&t;Revision 1.30  1998/11/24 12:37:31  rassmann&n; *&t;Implemented segmentation check.&n; *&t;&n; *&t;Revision 1.29  1998/11/18 13:04:32  rassmann&n; *&t;Secured PortUpTimer event.&n; *&t;Waiting longer before starting standby port(s).&n; *&t;&n; *&t;Revision 1.28  1998/11/17 13:43:04  rassmann&n; *&t;Handling (logical) tx failure.&n; *&t;Sending packet on logical address after PORT_SWITCH.&n; *&t;&n; *&t;Revision 1.27  1998/11/13 17:09:50  rassmann&n; *&t;Secured some events against being called in wrong state.&n; *&t;&n; *&t;Revision 1.26  1998/11/13 16:56:54  rassmann&n; *&t;Added macro version of SkRlmtLookaheadPacket.&n; *&t;&n; *&t;Revision 1.25  1998/11/06 18:06:04  rassmann&n; *&t;Corrected timing when RLMT checks fail.&n; *&t;Clearing tx counter earlier in periodical checks.&n; *&t;&n; *&t;Revision 1.24  1998/11/05 10:37:27  rassmann&n; *&t;Checking destination address in Lookahead.&n; *&t;&n; *&t;Revision 1.23  1998/11/03 13:53:49  rassmann&n; *&t;RLMT should switch now (at least in mode 3).&n; *&t;&n; *&t;Revision 1.22  1998/10/29 14:34:49  rassmann&n; *&t;Clearing SK_RLMT struct at startup.&n; *&t;Initializing PortsUp during SK_RLMT_START.&n; *&t;&n; *&t;Revision 1.21  1998/10/28 11:30:17  rassmann&n; *&t;Default mode is now SK_RLMT_CHECK_LOC_LINK.&n; *&t;&n; *&t;Revision 1.20  1998/10/26 16:02:03  rassmann&n; *&t;Ignoring LINK_DOWN for links that are down.&n; *&t;&n; *&t;Revision 1.19  1998/10/22 15:54:01  rassmann&n; *&t;Corrected EtherLen.&n; *&t;Starting Link Check when second port comes up.&n; *&t;&n; *&t;Revision 1.18  1998/10/22 11:39:50  rassmann&n; *&t;Corrected signed/unsigned mismatches.&n; *&t;Corrected receive list handling and address recognition.&n; *&t;&n; *&t;Revision 1.17  1998/10/19 17:01:20  rassmann&n; *&t;More detailed checking of received packets.&n; *&t;&n; *&t;Revision 1.16  1998/10/15 15:16:34  rassmann&n; *&t;Finished Spanning Tree checking.&n; *&t;Checked with lint.&n; *&t;&n; *&t;Revision 1.15  1998/09/24 19:16:07  rassmann&n; *&t;Code cleanup.&n; *&t;Introduced Timer for PORT_DOWN due to no RX.&n; *&t;&n; *&t;Revision 1.14  1998/09/18 20:27:14  rassmann&n; *&t;Added address override.&n; *&t;&n; *&t;Revision 1.13  1998/09/16 11:31:48  rassmann&n; *&t;Including skdrv1st.h again. :(&n; *&t;&n; *&t;Revision 1.12  1998/09/16 11:09:50  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.11  1998/09/15 12:32:03  rassmann&n; *&t;Syntax correction.&n; *&t;&n; *&t;Revision 1.10  1998/09/15 11:28:49  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.9  1998/09/14 17:07:37  rassmann&n; *&t;Added code for port checking via LAN.&n; *&t;Changed Mbuf definition.&n; *&t;&n; *&t;Revision 1.8  1998/09/07 11:14:14  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.7  1998/09/07 09:06:07  rassmann&n; *&t;Syntax corrections.&n; *&t;&n; *&t;Revision 1.6  1998/09/04 19:41:33  rassmann&n; *&t;Syntax corrections.&n; *&t;Started entering code for checking local links.&n; *&t;&n; *&t;Revision 1.5  1998/09/04 12:14:27  rassmann&n; *&t;Interface cleanup.&n; *&t;&n; *&t;Revision 1.4  1998/09/02 16:55:28  rassmann&n; *&t;Updated to reflect new DRV/HWAC/RLMT interface.&n; *&t;&n; *&t;Revision 1.3  1998/08/27 14:29:03  rassmann&n; *&t;Code cleanup.&n; *&t;&n; *&t;Revision 1.2  1998/08/27 14:26:24  rassmann&n; *&t;Updated interface.&n; *&t;&n; *&t;Revision 1.1  1998/08/21 08:26:49  rassmann&n; *&t;First public version.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * Description:&n; *&n; * This module contains code for Link ManagemenT (LMT) of SK-NET Adapters.&n; * It is mainly intended for adapters with more than one link.&n; * For such adapters, this module realizes Redundant Link ManagemenT (RLMT).&n; *&n; * Include File Hierarchy:&n; *&n; *&t;&quot;skdrv1st.h&quot;&n; *&t;&quot;skdrv2nd.h&quot;&n; *&n; ******************************************************************************/
macro_line|#ifndef&t;lint
DECL|variable|SysKonnectFileId
r_static
r_const
r_char
id|SysKonnectFileId
(braket
)braket
op_assign
l_string|&quot;@(#) $Id: skrlmt.c,v 1.61 2001/03/14 12:52:08 rassmann Exp $ (C) SysKonnect.&quot;
suffix:semicolon
macro_line|#endif&t;/* !defined(lint) */
DECL|macro|__SKRLMT_C
mdefine_line|#define __SKRLMT_C
macro_line|#ifdef __cplusplus
macro_line|#error C++ is not yet supported.
r_extern
l_string|&quot;C&quot;
(brace
macro_line|#endif&t;/* cplusplus */
macro_line|#include &quot;h/skdrv1st.h&quot;
macro_line|#include &quot;h/skdrv2nd.h&quot;
multiline_comment|/* defines ********************************************************************/
macro_line|#ifndef SK_HWAC_LINK_LED
DECL|macro|SK_HWAC_LINK_LED
mdefine_line|#define SK_HWAC_LINK_LED(a,b,c,d)
macro_line|#endif&t;/* !defined(SK_HWAC_LINK_LED) */
macro_line|#ifndef DEBUG
DECL|macro|RLMT_STATIC
mdefine_line|#define RLMT_STATIC&t;static
macro_line|#else&t;/* DEBUG */
DECL|macro|RLMT_STATIC
mdefine_line|#define RLMT_STATIC
macro_line|#ifndef SK_LITTLE_ENDIAN
multiline_comment|/* First 32 bits */
DECL|macro|OFFS_LO32
mdefine_line|#define OFFS_LO32&t;1
multiline_comment|/* Second 32 bits */
DECL|macro|OFFS_HI32
mdefine_line|#define OFFS_HI32&t;0
macro_line|#else&t;/* SK_LITTLE_ENDIAN */
multiline_comment|/* First 32 bits */
DECL|macro|OFFS_LO32
mdefine_line|#define OFFS_LO32&t;0
multiline_comment|/* Second 32 bits */
DECL|macro|OFFS_HI32
mdefine_line|#define OFFS_HI32&t;1
macro_line|#endif&t;/* SK_LITTLE_ENDIAN */
macro_line|#endif&t;/* DEBUG */
multiline_comment|/* ----- Private timeout values ----- */
DECL|macro|SK_RLMT_MIN_TO_VAL
mdefine_line|#define SK_RLMT_MIN_TO_VAL&t;&t;&t;   125000&t;/* 1/8 sec. */
DECL|macro|SK_RLMT_DEF_TO_VAL
mdefine_line|#define SK_RLMT_DEF_TO_VAL&t;&t;&t;  1000000&t;/* 1 sec. */
DECL|macro|SK_RLMT_PORTDOWN_TIM_VAL
mdefine_line|#define SK_RLMT_PORTDOWN_TIM_VAL&t;   900000&t;/* another 0.9 sec. */
DECL|macro|SK_RLMT_PORTSTART_TIM_VAL
mdefine_line|#define SK_RLMT_PORTSTART_TIM_VAL&t;   100000&t;/* 0.1 sec. */
DECL|macro|SK_RLMT_PORTUP_TIM_VAL
mdefine_line|#define SK_RLMT_PORTUP_TIM_VAL&t;&t;  2500000&t;/* 2.5 sec. */
DECL|macro|SK_RLMT_SEG_TO_VAL
mdefine_line|#define SK_RLMT_SEG_TO_VAL&t;&t;&t;900000000&t;/* 15 min. */
multiline_comment|/* Assume tick counter increment is 1 - may be set OS-dependent. */
macro_line|#ifndef SK_TICK_INCR
DECL|macro|SK_TICK_INCR
mdefine_line|#define SK_TICK_INCR&t;SK_CONSTU64(1)
macro_line|#endif&t;/* !defined(SK_TICK_INCR) */
multiline_comment|/*&n; * Amount that a time stamp must be later to be recognized as &quot;substantially&n; * later&quot;. This is about 1/128 sec, but above 1 tick counter increment.&n; */
DECL|macro|SK_RLMT_BC_DELTA
mdefine_line|#define SK_RLMT_BC_DELTA&t;&t;(1 + ((SK_TICKS_PER_SEC &gt;&gt; 7) &gt; SK_TICK_INCR ? &bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;(SK_TICKS_PER_SEC &gt;&gt; 7) : SK_TICK_INCR))
multiline_comment|/* ----- Private RLMT defaults ----- */
DECL|macro|SK_RLMT_DEF_PREF_PORT
mdefine_line|#define SK_RLMT_DEF_PREF_PORT&t;0&t;&t;&t;&t;&t;/* &quot;Lower&quot; port. */
DECL|macro|SK_RLMT_DEF_MODE
mdefine_line|#define SK_RLMT_DEF_MODE &t;&t;SK_RLMT_CHECK_LINK&t;/* Default RLMT Mode. */
multiline_comment|/* ----- Private RLMT checking states ----- */
DECL|macro|SK_RLMT_RCS_SEG
mdefine_line|#define SK_RLMT_RCS_SEG&t;&t;&t;1&t;&t;/* RLMT Check State: check seg. */
DECL|macro|SK_RLMT_RCS_START_SEG
mdefine_line|#define SK_RLMT_RCS_START_SEG&t;2&t;&t;/* RLMT Check State: start check seg. */
DECL|macro|SK_RLMT_RCS_SEND_SEG
mdefine_line|#define SK_RLMT_RCS_SEND_SEG&t;4&t;&t;/* RLMT Check State: send BPDU packet */
DECL|macro|SK_RLMT_RCS_REPORT_SEG
mdefine_line|#define SK_RLMT_RCS_REPORT_SEG&t;8&t;&t;/* RLMT Check State: report seg. */
multiline_comment|/* ----- Private PORT checking states ----- */
DECL|macro|SK_RLMT_PCS_TX
mdefine_line|#define SK_RLMT_PCS_TX&t;&t;&t;1&t;&t;/* Port Check State: check tx. */
DECL|macro|SK_RLMT_PCS_RX
mdefine_line|#define SK_RLMT_PCS_RX&t;&t;&t;2&t;&t;/* Port Check State: check rx. */
multiline_comment|/* ----- Private PORT events ----- */
multiline_comment|/* Note: Update simulation when changing these. */
DECL|macro|SK_RLMT_PORTSTART_TIM
mdefine_line|#define SK_RLMT_PORTSTART_TIM&t;1100&t;/* Port start timeout. */
DECL|macro|SK_RLMT_PORTUP_TIM
mdefine_line|#define SK_RLMT_PORTUP_TIM&t;&t;1101&t;/* Port can now go up. */
DECL|macro|SK_RLMT_PORTDOWN_RX_TIM
mdefine_line|#define SK_RLMT_PORTDOWN_RX_TIM&t;1102&t;/* Port did not receive once ... */
DECL|macro|SK_RLMT_PORTDOWN
mdefine_line|#define SK_RLMT_PORTDOWN&t;&t;1103&t;/* Port went down. */
DECL|macro|SK_RLMT_PORTDOWN_TX_TIM
mdefine_line|#define SK_RLMT_PORTDOWN_TX_TIM&t;1104&t;/* Partner did not receive ... */
multiline_comment|/* ----- Private RLMT events ----- */
multiline_comment|/* Note: Update simulation when changing these. */
DECL|macro|SK_RLMT_TIM
mdefine_line|#define SK_RLMT_TIM&t;&t;&t;&t;2100&t;/* RLMT timeout. */
DECL|macro|SK_RLMT_SEG_TIM
mdefine_line|#define SK_RLMT_SEG_TIM&t;&t;&t;2101&t;/* RLMT segmentation check timeout. */
DECL|macro|TO_SHORTEN
mdefine_line|#define TO_SHORTEN(tim)&t;((tim) / 2)
multiline_comment|/* Error numbers and messages. */
DECL|macro|SKERR_RLMT_E001
mdefine_line|#define SKERR_RLMT_E001&t;&t;(SK_ERRBASE_RLMT + 0)
DECL|macro|SKERR_RLMT_E001_MSG
mdefine_line|#define SKERR_RLMT_E001_MSG&t;&quot;No Packet.&quot;
DECL|macro|SKERR_RLMT_E002
mdefine_line|#define SKERR_RLMT_E002&t;&t;(SKERR_RLMT_E001 + 1)
DECL|macro|SKERR_RLMT_E002_MSG
mdefine_line|#define SKERR_RLMT_E002_MSG&t;&quot;Short Packet.&quot;
DECL|macro|SKERR_RLMT_E003
mdefine_line|#define SKERR_RLMT_E003&t;&t;(SKERR_RLMT_E002 + 1)
DECL|macro|SKERR_RLMT_E003_MSG
mdefine_line|#define SKERR_RLMT_E003_MSG&t;&quot;Unknown RLMT event.&quot;
DECL|macro|SKERR_RLMT_E004
mdefine_line|#define SKERR_RLMT_E004&t;&t;(SKERR_RLMT_E003 + 1)
DECL|macro|SKERR_RLMT_E004_MSG
mdefine_line|#define SKERR_RLMT_E004_MSG&t;&quot;PortsUp incorrect.&quot;
DECL|macro|SKERR_RLMT_E005
mdefine_line|#define SKERR_RLMT_E005&t;&t;(SKERR_RLMT_E004 + 1)
DECL|macro|SKERR_RLMT_E005_MSG
mdefine_line|#define SKERR_RLMT_E005_MSG&t;&bslash;&n; &quot;Net seems to be segmented (different root bridges are reported on the ports).&quot;
DECL|macro|SKERR_RLMT_E006
mdefine_line|#define SKERR_RLMT_E006&t;&t;(SKERR_RLMT_E005 + 1)
DECL|macro|SKERR_RLMT_E006_MSG
mdefine_line|#define SKERR_RLMT_E006_MSG&t;&quot;Duplicate MAC Address detected.&quot;
DECL|macro|SKERR_RLMT_E007
mdefine_line|#define SKERR_RLMT_E007&t;&t;(SKERR_RLMT_E006 + 1)
DECL|macro|SKERR_RLMT_E007_MSG
mdefine_line|#define SKERR_RLMT_E007_MSG&t;&quot;LinksUp incorrect.&quot;
DECL|macro|SKERR_RLMT_E008
mdefine_line|#define SKERR_RLMT_E008&t;&t;(SKERR_RLMT_E007 + 1)
DECL|macro|SKERR_RLMT_E008_MSG
mdefine_line|#define SKERR_RLMT_E008_MSG&t;&quot;Port not started but link came up.&quot;
DECL|macro|SKERR_RLMT_E009
mdefine_line|#define SKERR_RLMT_E009&t;&t;(SKERR_RLMT_E008 + 1)
DECL|macro|SKERR_RLMT_E009_MSG
mdefine_line|#define SKERR_RLMT_E009_MSG&t;&quot;Corrected illegal setting of Preferred Port.&quot;
DECL|macro|SKERR_RLMT_E010
mdefine_line|#define SKERR_RLMT_E010&t;&t;(SKERR_RLMT_E009 + 1)
DECL|macro|SKERR_RLMT_E010_MSG
mdefine_line|#define SKERR_RLMT_E010_MSG&t;&quot;Ignored illegal Preferred Port.&quot;
multiline_comment|/* LLC field values. */
DECL|macro|LLC_COMMAND_RESPONSE_BIT
mdefine_line|#define LLC_COMMAND_RESPONSE_BIT&t;&t;1
DECL|macro|LLC_TEST_COMMAND
mdefine_line|#define LLC_TEST_COMMAND&t;&t;&t;&t;0xE3
DECL|macro|LLC_UI
mdefine_line|#define LLC_UI&t;&t;&t;&t;&t;&t;&t;0x03
multiline_comment|/* RLMT Packet fields. */
DECL|macro|SK_RLMT_DSAP
mdefine_line|#define&t;SK_RLMT_DSAP&t;&t;&t;&t;&t;0
DECL|macro|SK_RLMT_SSAP
mdefine_line|#define&t;SK_RLMT_SSAP&t;&t;&t;&t;&t;0
DECL|macro|SK_RLMT_CTRL
mdefine_line|#define SK_RLMT_CTRL&t;&t;&t;&t;&t;(LLC_TEST_COMMAND)
DECL|macro|SK_RLMT_INDICATOR0
mdefine_line|#define SK_RLMT_INDICATOR0&t;&t;&t;&t;0x53&t;/* S */
DECL|macro|SK_RLMT_INDICATOR1
mdefine_line|#define SK_RLMT_INDICATOR1&t;&t;&t;&t;0x4B&t;/* K */
DECL|macro|SK_RLMT_INDICATOR2
mdefine_line|#define SK_RLMT_INDICATOR2&t;&t;&t;&t;0x2D&t;/* - */
DECL|macro|SK_RLMT_INDICATOR3
mdefine_line|#define SK_RLMT_INDICATOR3&t;&t;&t;&t;0x52&t;/* R */
DECL|macro|SK_RLMT_INDICATOR4
mdefine_line|#define SK_RLMT_INDICATOR4&t;&t;&t;&t;0x4C&t;/* L */
DECL|macro|SK_RLMT_INDICATOR5
mdefine_line|#define SK_RLMT_INDICATOR5&t;&t;&t;&t;0x4D&t;/* M */
DECL|macro|SK_RLMT_INDICATOR6
mdefine_line|#define SK_RLMT_INDICATOR6&t;&t;&t;&t;0x54&t;/* T */
DECL|macro|SK_RLMT_PACKET_VERSION
mdefine_line|#define SK_RLMT_PACKET_VERSION&t;&t;&t;0
multiline_comment|/* RLMT SPT Flag values. */
DECL|macro|SK_RLMT_SPT_FLAG_CHANGE
mdefine_line|#define&t;SK_RLMT_SPT_FLAG_CHANGE&t;&t;&t;0x01
DECL|macro|SK_RLMT_SPT_FLAG_CHANGE_ACK
mdefine_line|#define&t;SK_RLMT_SPT_FLAG_CHANGE_ACK&t;&t;0x80
multiline_comment|/* RLMT SPT Packet fields. */
DECL|macro|SK_RLMT_SPT_DSAP
mdefine_line|#define&t;SK_RLMT_SPT_DSAP&t;&t;&t;&t;0x42
DECL|macro|SK_RLMT_SPT_SSAP
mdefine_line|#define&t;SK_RLMT_SPT_SSAP&t;&t;&t;&t;0x42
DECL|macro|SK_RLMT_SPT_CTRL
mdefine_line|#define SK_RLMT_SPT_CTRL&t;&t;&t;&t;(LLC_UI)
DECL|macro|SK_RLMT_SPT_PROTOCOL_ID0
mdefine_line|#define&t;SK_RLMT_SPT_PROTOCOL_ID0&t;&t;0x00
DECL|macro|SK_RLMT_SPT_PROTOCOL_ID1
mdefine_line|#define&t;SK_RLMT_SPT_PROTOCOL_ID1&t;&t;0x00
DECL|macro|SK_RLMT_SPT_PROTOCOL_VERSION_ID
mdefine_line|#define&t;SK_RLMT_SPT_PROTOCOL_VERSION_ID&t;0x00
DECL|macro|SK_RLMT_SPT_BPDU_TYPE
mdefine_line|#define&t;SK_RLMT_SPT_BPDU_TYPE&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_FLAGS
mdefine_line|#define&t;SK_RLMT_SPT_FLAGS&t;&t;&t;&t;0x00&t;/* ?? */
DECL|macro|SK_RLMT_SPT_ROOT_ID0
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_ID0&t;&t;&t;0xFF&t;/* Lowest possible priority. */
DECL|macro|SK_RLMT_SPT_ROOT_ID1
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_ID1&t;&t;&t;0xFF&t;/* Lowest possible priority. */
multiline_comment|/* Remaining 6 bytes will be the current port address. */
DECL|macro|SK_RLMT_SPT_ROOT_PATH_COST0
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_PATH_COST0&t;&t;0x00
DECL|macro|SK_RLMT_SPT_ROOT_PATH_COST1
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_PATH_COST1&t;&t;0x00
DECL|macro|SK_RLMT_SPT_ROOT_PATH_COST2
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_PATH_COST2&t;&t;0x00
DECL|macro|SK_RLMT_SPT_ROOT_PATH_COST3
mdefine_line|#define&t;SK_RLMT_SPT_ROOT_PATH_COST3&t;&t;0x00
DECL|macro|SK_RLMT_SPT_BRIDGE_ID0
mdefine_line|#define&t;SK_RLMT_SPT_BRIDGE_ID0&t;&t;&t;0xFF&t;/* Lowest possible priority. */
DECL|macro|SK_RLMT_SPT_BRIDGE_ID1
mdefine_line|#define&t;SK_RLMT_SPT_BRIDGE_ID1&t;&t;&t;0xFF&t;/* Lowest possible priority. */
multiline_comment|/* Remaining 6 bytes will be the current port address. */
DECL|macro|SK_RLMT_SPT_PORT_ID0
mdefine_line|#define&t;SK_RLMT_SPT_PORT_ID0&t;&t;&t;0xFF&t;/* Lowest possible priority. */
DECL|macro|SK_RLMT_SPT_PORT_ID1
mdefine_line|#define&t;SK_RLMT_SPT_PORT_ID1&t;&t;&t;0xFF&t;/* Lowest possible priority. */
DECL|macro|SK_RLMT_SPT_MSG_AGE0
mdefine_line|#define&t;SK_RLMT_SPT_MSG_AGE0&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_MSG_AGE1
mdefine_line|#define&t;SK_RLMT_SPT_MSG_AGE1&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_MAX_AGE0
mdefine_line|#define&t;SK_RLMT_SPT_MAX_AGE0&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_MAX_AGE1
mdefine_line|#define&t;SK_RLMT_SPT_MAX_AGE1&t;&t;&t;0xFF
DECL|macro|SK_RLMT_SPT_HELLO_TIME0
mdefine_line|#define&t;SK_RLMT_SPT_HELLO_TIME0&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_HELLO_TIME1
mdefine_line|#define&t;SK_RLMT_SPT_HELLO_TIME1&t;&t;&t;0xFF
DECL|macro|SK_RLMT_SPT_FWD_DELAY0
mdefine_line|#define&t;SK_RLMT_SPT_FWD_DELAY0&t;&t;&t;0x00
DECL|macro|SK_RLMT_SPT_FWD_DELAY1
mdefine_line|#define&t;SK_RLMT_SPT_FWD_DELAY1&t;&t;&t;0x40
multiline_comment|/* Size defines. */
DECL|macro|SK_RLMT_MIN_PACKET_SIZE
mdefine_line|#define SK_RLMT_MIN_PACKET_SIZE&t;&t;&t;34
DECL|macro|SK_RLMT_MAX_PACKET_SIZE
mdefine_line|#define SK_RLMT_MAX_PACKET_SIZE&t;&t;&t;(SK_RLMT_MAX_TX_BUF_SIZE)
DECL|macro|SK_PACKET_DATA_LEN
mdefine_line|#define SK_PACKET_DATA_LEN&t;&t;&t;&t;(SK_RLMT_MAX_PACKET_SIZE - &bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;SK_RLMT_MIN_PACKET_SIZE)
multiline_comment|/* ----- RLMT packet types ----- */
DECL|macro|SK_PACKET_ANNOUNCE
mdefine_line|#define SK_PACKET_ANNOUNCE&t;&t;&t;&t;1&t;/* Port announcement. */
DECL|macro|SK_PACKET_ALIVE
mdefine_line|#define SK_PACKET_ALIVE&t;&t;&t;&t;&t;2&t;/* Alive packet to port. */
DECL|macro|SK_PACKET_ADDR_CHANGED
mdefine_line|#define SK_PACKET_ADDR_CHANGED&t;&t;&t;3&t;/* Port address changed. */
DECL|macro|SK_PACKET_CHECK_TX
mdefine_line|#define SK_PACKET_CHECK_TX&t;&t;&t;&t;4&t;/* Check your tx line. */
macro_line|#ifdef SK_LITTLE_ENDIAN
DECL|macro|SK_U16_TO_NETWORK_ORDER
mdefine_line|#define SK_U16_TO_NETWORK_ORDER(Val,Addr) { &bslash;&n;&t;SK_U8&t;*_Addr = (SK_U8*)(Addr); &bslash;&n;&t;SK_U16&t;_Val = (SK_U16)(Val); &bslash;&n;&t;*_Addr++ = (SK_U8)(_Val &gt;&gt; 8); &bslash;&n;&t;*_Addr = (SK_U8)(_Val &amp; 0xFF); &bslash;&n;}
macro_line|#endif&t;/* SK_LITTLE_ENDIAN */
macro_line|#ifdef SK_BIG_ENDIAN
DECL|macro|SK_U16_TO_NETWORK_ORDER
mdefine_line|#define SK_U16_TO_NETWORK_ORDER(Val,Addr) (*(SK_U16*)(Addr) = (SK_U16)(Val))
macro_line|#endif&t;/* SK_BIG_ENDIAN */
DECL|macro|AUTONEG_FAILED
mdefine_line|#define AUTONEG_FAILED&t;SK_FALSE
DECL|macro|AUTONEG_SUCCESS
mdefine_line|#define AUTONEG_SUCCESS&t;SK_TRUE
multiline_comment|/* typedefs *******************************************************************/
multiline_comment|/* RLMT packet.  Length: SK_RLMT_MAX_PACKET_SIZE (60) bytes. */
DECL|struct|s_RlmtPacket
r_typedef
r_struct
id|s_RlmtPacket
(brace
DECL|member|DstAddr
id|SK_U8
id|DstAddr
(braket
id|SK_MAC_ADDR_LEN
)braket
suffix:semicolon
DECL|member|SrcAddr
id|SK_U8
id|SrcAddr
(braket
id|SK_MAC_ADDR_LEN
)braket
suffix:semicolon
DECL|member|TypeLen
id|SK_U8
id|TypeLen
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|DSap
id|SK_U8
id|DSap
suffix:semicolon
DECL|member|SSap
id|SK_U8
id|SSap
suffix:semicolon
DECL|member|Ctrl
id|SK_U8
id|Ctrl
suffix:semicolon
DECL|member|Indicator
id|SK_U8
id|Indicator
(braket
l_int|7
)braket
suffix:semicolon
DECL|member|RlmtPacketType
id|SK_U8
id|RlmtPacketType
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|Align1
id|SK_U8
id|Align1
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|Random
id|SK_U8
id|Random
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* Random value of requesting(!) station. */
DECL|member|RlmtPacketVersion
id|SK_U8
id|RlmtPacketVersion
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* RLMT Packet version. */
DECL|member|Data
id|SK_U8
id|Data
(braket
id|SK_PACKET_DATA_LEN
)braket
suffix:semicolon
DECL|typedef|SK_RLMT_PACKET
)brace
id|SK_RLMT_PACKET
suffix:semicolon
DECL|struct|s_SpTreeRlmtPacket
r_typedef
r_struct
id|s_SpTreeRlmtPacket
(brace
DECL|member|DstAddr
id|SK_U8
id|DstAddr
(braket
id|SK_MAC_ADDR_LEN
)braket
suffix:semicolon
DECL|member|SrcAddr
id|SK_U8
id|SrcAddr
(braket
id|SK_MAC_ADDR_LEN
)braket
suffix:semicolon
DECL|member|TypeLen
id|SK_U8
id|TypeLen
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|DSap
id|SK_U8
id|DSap
suffix:semicolon
DECL|member|SSap
id|SK_U8
id|SSap
suffix:semicolon
DECL|member|Ctrl
id|SK_U8
id|Ctrl
suffix:semicolon
DECL|member|ProtocolId
id|SK_U8
id|ProtocolId
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ProtocolVersionId
id|SK_U8
id|ProtocolVersionId
suffix:semicolon
DECL|member|BpduType
id|SK_U8
id|BpduType
suffix:semicolon
DECL|member|Flags
id|SK_U8
id|Flags
suffix:semicolon
DECL|member|RootId
id|SK_U8
id|RootId
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|RootPathCost
id|SK_U8
id|RootPathCost
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|BridgeId
id|SK_U8
id|BridgeId
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|PortId
id|SK_U8
id|PortId
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|MessageAge
id|SK_U8
id|MessageAge
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|MaxAge
id|SK_U8
id|MaxAge
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|HelloTime
id|SK_U8
id|HelloTime
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ForwardDelay
id|SK_U8
id|ForwardDelay
(braket
l_int|2
)braket
suffix:semicolon
DECL|typedef|SK_SPTREE_PACKET
)brace
id|SK_SPTREE_PACKET
suffix:semicolon
multiline_comment|/* global variables ***********************************************************/
DECL|variable|SkRlmtMcAddr
id|SK_MAC_ADDR
id|SkRlmtMcAddr
op_assign
(brace
(brace
l_int|0x01
comma
l_int|0x00
comma
l_int|0x5A
comma
l_int|0x52
comma
l_int|0x4C
comma
l_int|0x4D
)brace
)brace
suffix:semicolon
DECL|variable|BridgeMcAddr
id|SK_MAC_ADDR
id|BridgeMcAddr
op_assign
(brace
(brace
l_int|0x01
comma
l_int|0x80
comma
l_int|0xC2
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
suffix:semicolon
DECL|variable|BcAddr
id|SK_MAC_ADDR
id|BcAddr
op_assign
(brace
(brace
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
comma
l_int|0xFF
)brace
)brace
suffix:semicolon
multiline_comment|/* local variables ************************************************************/
multiline_comment|/* None. */
multiline_comment|/* functions ******************************************************************/
id|RLMT_STATIC
r_void
id|SkRlmtCheckSwitch
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
id|SK_IOC
id|IoC
comma
id|SK_U32
id|NetIdx
)paren
suffix:semicolon
id|RLMT_STATIC
r_void
id|SkRlmtCheckSeg
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
id|SK_IOC
id|IoC
comma
id|SK_U32
id|NetIdx
)paren
suffix:semicolon
id|RLMT_STATIC
r_void
id|SkRlmtEvtSetNets
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
id|SK_IOC
id|IoC
comma
id|SK_EVPARA
id|Para
)paren
suffix:semicolon
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtInit - initialize data, set state to init&n; *&n; * Description:&n; *&n; *&t;SK_INIT_DATA&n; *&t;============&n; *&n; *&t;This routine initializes all RLMT-related variables to a known state.&n; *&t;The initial state is SK_RLMT_RS_INIT.&n; *&t;All ports are initialized to SK_RLMT_PS_INIT.&n; *&n; *&n; *&t;SK_INIT_IO&n; *&t;==========&n; *&n; *&t;Nothing.&n; *&n; *&n; *&t;SK_INIT_RUN&n; *&t;===========&n; *&n; *&t;Determine the adapter&squot;s random value.&n; *&t;Set the hw registers, the &quot;logical MAC address&quot;, the&n; *&t;RLMT multicast address, and eventually the BPDU multicast address.&n; *&n; * Context:&n; *&t;init, pageable&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtInit
r_void
id|SkRlmtInit
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
r_int
id|Level
)paren
multiline_comment|/* Initialization Level */
(brace
id|SK_U32
id|i
comma
id|j
suffix:semicolon
id|SK_U64
id|Random
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;RLMT Init level %d.&bslash;n&quot;
comma
id|Level
)paren
)paren
r_switch
c_cond
(paren
id|Level
)paren
(brace
r_case
id|SK_INIT_DATA
suffix:colon
multiline_comment|/* Initialize data structures. */
id|SK_MEMSET
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pAC-&gt;Rlmt
comma
l_int|0
comma
r_sizeof
(paren
id|SK_RLMT
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortState
op_assign
id|SK_RLMT_PS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|LinkDown
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortDown
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortStarted
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortNoRx
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortNumber
op_assign
id|i
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|Net
op_assign
op_amp
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|AddrPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|i
)braket
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.NumNets
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_NETS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|Preference
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
multiline_comment|/* Automatic. */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
op_assign
id|SK_RLMT_DEF_PREF_PORT
suffix:semicolon
multiline_comment|/* Just assuming. */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|ActivePort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtMode
op_assign
id|SK_RLMT_DEF_MODE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|TimeoutValue
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|NetNumber
op_assign
id|i
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Port
(braket
l_int|0
)braket
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
l_int|0
)braket
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Port
(braket
l_int|1
)braket
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#if SK_MAX_NETS &gt; 1
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|Port
(braket
l_int|0
)braket
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
l_int|1
)braket
suffix:semicolon
macro_line|#endif&t;/* SK_MAX_NETS &gt; 1 */
r_break
suffix:semicolon
r_case
id|SK_INIT_IO
suffix:colon
multiline_comment|/* GIMacsFound first available here. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_INIT
comma
(paren
l_string|&quot;RLMT: %d MACs were detected.&bslash;n&quot;
comma
id|pAC-&gt;GIni.GIMacsFound
)paren
)paren
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|NumPorts
op_assign
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
multiline_comment|/* Initialize HW registers? */
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIMacsFound
OL
l_int|2
)paren
(brace
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_MODE_CLS
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
(paren
r_void
)paren
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_MODE_CHANGE
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_INIT_RUN
suffix:colon
multiline_comment|/* Ensure RLMT is set to one net. */
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NumNets
OG
l_int|1
)paren
(brace
id|Para.Para32
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkRlmtEvtSetNets
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|Random
op_assign
id|SkOsGetTime
c_func
(paren
id|pAC
)paren
suffix:semicolon
op_star
(paren
id|SK_U32
op_star
)paren
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|Random
op_assign
op_star
(paren
id|SK_U32
op_star
)paren
op_amp
id|Random
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|Random
(braket
id|j
)braket
op_xor_assign
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|AddrPort
op_member_access_from_pointer
id|CurrentMacAddress.a
(braket
id|SK_MAC_ADDR_LEN
op_minus
l_int|1
op_minus
id|j
)braket
suffix:semicolon
)brace
(paren
r_void
)paren
id|SkAddrMcClear
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
id|SK_ADDR_PERMANENT
op_or
id|SK_MC_SW_ONLY
)paren
suffix:semicolon
multiline_comment|/* Add RLMT MC address. */
(paren
r_void
)paren
id|SkAddrMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
op_amp
id|SkRlmtMcAddr
comma
id|SK_ADDR_PERMANENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
(brace
multiline_comment|/* Add BPDU MC address. */
(paren
r_void
)paren
id|SkAddrMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
comma
op_amp
id|BridgeMcAddr
comma
id|SK_ADDR_PERMANENT
)paren
suffix:semicolon
)brace
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* error */
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtInit */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtBuildCheckChain - build the check chain&n; *&n; * Description:&n; *&t;This routine builds the local check chain:&n; *&t;- Each port that is up checks the next port.&n; *&t;- The last port that is up checks the first port that is up.&n; *&n; * Notes:&n; *&t;- Currently only local ports are considered when building the chain.&n; *&t;- Currently the SuspectState is just reset;&n; *&t;  it would be better to save it ...&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtBuildCheckChain
id|RLMT_STATIC
r_void
id|SkRlmtBuildCheckChain
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_U32
id|NetIdx
)paren
multiline_comment|/* Net Number */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_U32
id|NumMacsUp
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|FirstMacUp
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|PrevMacUp
suffix:semicolon
id|FirstMacUp
op_assign
l_int|NULL
suffix:semicolon
id|PrevMacUp
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortsChecked
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
multiline_comment|/* Done. */
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkRlmtBuildCheckChain.&bslash;n&quot;
)paren
)paren
id|NumMacsUp
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortsChecked
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortsSuspect
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|CheckingState
op_and_assign
op_complement
(paren
id|SK_RLMT_PCS_RX
op_or
id|SK_RLMT_PCS_TX
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If more than two links are detected we should consider&n;&t;&t; * checking at least two other ports:&n;&t;&t; * 1. the next port that is not LinkDown and&n;&t;&t; * 2. the next port that is not PortDown.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|LinkDown
)paren
(brace
r_if
c_cond
(paren
id|NumMacsUp
op_eq
l_int|0
)paren
(brace
id|FirstMacUp
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortCheck
(braket
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortsChecked
)braket
dot
id|CheckAddr
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|AddrPort-&gt;CurrentMacAddress
suffix:semicolon
id|PrevMacUp-&gt;PortCheck
(braket
id|PrevMacUp-&gt;PortsChecked
)braket
dot
id|SuspectTx
op_assign
id|SK_FALSE
suffix:semicolon
id|PrevMacUp-&gt;PortsChecked
op_increment
suffix:semicolon
)brace
id|PrevMacUp
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
suffix:semicolon
id|NumMacsUp
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|NumMacsUp
OG
l_int|1
)paren
(brace
id|PrevMacUp-&gt;PortCheck
(braket
id|PrevMacUp-&gt;PortsChecked
)braket
dot
id|CheckAddr
op_assign
id|FirstMacUp-&gt;AddrPort-&gt;CurrentMacAddress
suffix:semicolon
id|PrevMacUp-&gt;PortCheck
(braket
id|PrevMacUp-&gt;PortsChecked
)braket
dot
id|SuspectTx
op_assign
id|SK_FALSE
suffix:semicolon
id|PrevMacUp-&gt;PortsChecked
op_increment
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Port %d checks %d other ports: %2X.&bslash;n&quot;
comma
id|NetIdx
comma
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortsChecked
comma
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortCheck
(braket
l_int|0
)braket
dot
id|CheckAddr.a
(braket
l_int|5
)braket
)paren
)paren
)brace
macro_line|#endif&t;/* DEBUG */
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtBuildCheckChain */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtBuildPacket - build an RLMT packet&n; *&n; * Description:&n; *&t;This routine sets up an RLMT packet.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;NULL or pointer to RLMT mbuf&n; */
DECL|function|SkRlmtBuildPacket
id|RLMT_STATIC
id|SK_MBUF
op_star
id|SkRlmtBuildPacket
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
comma
multiline_comment|/* Sending port */
id|SK_U16
id|PacketType
comma
multiline_comment|/* RLMT packet type */
id|SK_MAC_ADDR
op_star
id|SrcAddr
comma
multiline_comment|/* Source address */
id|SK_MAC_ADDR
op_star
id|DestAddr
)paren
multiline_comment|/* Destination address */
(brace
r_int
id|i
suffix:semicolon
id|SK_U16
id|Length
suffix:semicolon
id|SK_MBUF
op_star
id|pMb
suffix:semicolon
id|SK_RLMT_PACKET
op_star
id|pPacket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pMb
op_assign
id|SkDrvAllocRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_MAX_PACKET_SIZE
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pPacket
op_assign
(paren
id|SK_RLMT_PACKET
op_star
)paren
id|pMb-&gt;pData
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pPacket-&gt;DstAddr
(braket
id|i
)braket
op_assign
id|DestAddr-&gt;a
(braket
id|i
)braket
suffix:semicolon
id|pPacket-&gt;SrcAddr
(braket
id|i
)braket
op_assign
id|SrcAddr-&gt;a
(braket
id|i
)braket
suffix:semicolon
)brace
id|pPacket-&gt;DSap
op_assign
id|SK_RLMT_DSAP
suffix:semicolon
id|pPacket-&gt;SSap
op_assign
id|SK_RLMT_SSAP
suffix:semicolon
id|pPacket-&gt;Ctrl
op_assign
id|SK_RLMT_CTRL
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_INDICATOR0
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_INDICATOR1
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|2
)braket
op_assign
id|SK_RLMT_INDICATOR2
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|3
)braket
op_assign
id|SK_RLMT_INDICATOR3
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|4
)braket
op_assign
id|SK_RLMT_INDICATOR4
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|5
)braket
op_assign
id|SK_RLMT_INDICATOR5
suffix:semicolon
id|pPacket-&gt;Indicator
(braket
l_int|6
)braket
op_assign
id|SK_RLMT_INDICATOR6
suffix:semicolon
id|SK_U16_TO_NETWORK_ORDER
c_func
(paren
id|PacketType
comma
op_amp
id|pPacket-&gt;RlmtPacketType
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pPacket-&gt;Random
(braket
id|i
)braket
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Random
(braket
id|i
)braket
suffix:semicolon
)brace
id|SK_U16_TO_NETWORK_ORDER
c_func
(paren
id|SK_RLMT_PACKET_VERSION
comma
op_amp
id|pPacket-&gt;RlmtPacketVersion
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_PACKET_DATA_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pPacket-&gt;Data
(braket
id|i
)braket
op_assign
l_int|0x00
suffix:semicolon
)brace
id|Length
op_assign
id|SK_RLMT_MAX_PACKET_SIZE
suffix:semicolon
multiline_comment|/* Or smaller. */
id|pMb-&gt;Length
op_assign
id|Length
suffix:semicolon
id|pMb-&gt;PortIdx
op_assign
id|PortNumber
suffix:semicolon
id|Length
op_sub_assign
l_int|14
suffix:semicolon
id|SK_U16_TO_NETWORK_ORDER
c_func
(paren
id|Length
comma
op_amp
id|pPacket-&gt;TypeLen
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PacketType
op_eq
id|SK_PACKET_ALIVE
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|TxHelloCts
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
id|pMb
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtBuildPacket */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtBuildSpanningTreePacket - build spanning tree check packet&n; *&n; * Description:&n; *&t;This routine sets up a BPDU packet for spanning tree check.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;NULL or pointer to RLMT mbuf&n; */
DECL|function|SkRlmtBuildSpanningTreePacket
id|RLMT_STATIC
id|SK_MBUF
op_star
id|SkRlmtBuildSpanningTreePacket
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Sending port */
(brace
r_int
id|i
suffix:semicolon
id|SK_U16
id|Length
suffix:semicolon
id|SK_MBUF
op_star
id|pMb
suffix:semicolon
id|SK_SPTREE_PACKET
op_star
id|pSPacket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pMb
op_assign
id|SkDrvAllocRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_MAX_PACKET_SIZE
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pSPacket
op_assign
(paren
id|SK_SPTREE_PACKET
op_star
)paren
id|pMb-&gt;pData
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pSPacket-&gt;DstAddr
(braket
id|i
)braket
op_assign
id|BridgeMcAddr.a
(braket
id|i
)braket
suffix:semicolon
id|pSPacket-&gt;SrcAddr
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress.a
(braket
id|i
)braket
suffix:semicolon
)brace
id|pSPacket-&gt;DSap
op_assign
id|SK_RLMT_SPT_DSAP
suffix:semicolon
id|pSPacket-&gt;SSap
op_assign
id|SK_RLMT_SPT_SSAP
suffix:semicolon
id|pSPacket-&gt;Ctrl
op_assign
id|SK_RLMT_SPT_CTRL
suffix:semicolon
id|pSPacket-&gt;ProtocolId
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_PROTOCOL_ID0
suffix:semicolon
id|pSPacket-&gt;ProtocolId
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_PROTOCOL_ID1
suffix:semicolon
id|pSPacket-&gt;ProtocolVersionId
op_assign
id|SK_RLMT_SPT_PROTOCOL_VERSION_ID
suffix:semicolon
id|pSPacket-&gt;BpduType
op_assign
id|SK_RLMT_SPT_BPDU_TYPE
suffix:semicolon
id|pSPacket-&gt;Flags
op_assign
id|SK_RLMT_SPT_FLAGS
suffix:semicolon
id|pSPacket-&gt;RootId
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_ROOT_ID0
suffix:semicolon
id|pSPacket-&gt;RootId
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_ROOT_ID1
suffix:semicolon
id|pSPacket-&gt;RootPathCost
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_ROOT_PATH_COST0
suffix:semicolon
id|pSPacket-&gt;RootPathCost
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_ROOT_PATH_COST1
suffix:semicolon
id|pSPacket-&gt;RootPathCost
(braket
l_int|2
)braket
op_assign
id|SK_RLMT_SPT_ROOT_PATH_COST2
suffix:semicolon
id|pSPacket-&gt;RootPathCost
(braket
l_int|3
)braket
op_assign
id|SK_RLMT_SPT_ROOT_PATH_COST3
suffix:semicolon
id|pSPacket-&gt;BridgeId
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_BRIDGE_ID0
suffix:semicolon
id|pSPacket-&gt;BridgeId
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_BRIDGE_ID1
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Use logical MAC address as bridge ID and filter these packets&n;&t;&t; * on receive.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pSPacket-&gt;BridgeId
(braket
id|i
op_plus
l_int|2
)braket
op_assign
id|pSPacket-&gt;RootId
(braket
id|i
op_plus
l_int|2
)braket
op_assign
id|pAC-&gt;Addr.Net
(braket
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
id|i
)braket
suffix:semicolon
)brace
id|pSPacket-&gt;PortId
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_PORT_ID0
suffix:semicolon
id|pSPacket-&gt;PortId
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_PORT_ID1
suffix:semicolon
id|pSPacket-&gt;MessageAge
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_MSG_AGE0
suffix:semicolon
id|pSPacket-&gt;MessageAge
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_MSG_AGE1
suffix:semicolon
id|pSPacket-&gt;MaxAge
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_MAX_AGE0
suffix:semicolon
id|pSPacket-&gt;MaxAge
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_MAX_AGE1
suffix:semicolon
id|pSPacket-&gt;HelloTime
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_HELLO_TIME0
suffix:semicolon
id|pSPacket-&gt;HelloTime
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_HELLO_TIME1
suffix:semicolon
id|pSPacket-&gt;ForwardDelay
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_SPT_FWD_DELAY0
suffix:semicolon
id|pSPacket-&gt;ForwardDelay
(braket
l_int|1
)braket
op_assign
id|SK_RLMT_SPT_FWD_DELAY1
suffix:semicolon
id|Length
op_assign
id|SK_RLMT_MAX_PACKET_SIZE
suffix:semicolon
multiline_comment|/* Or smaller. */
id|pMb-&gt;Length
op_assign
id|Length
suffix:semicolon
id|pMb-&gt;PortIdx
op_assign
id|PortNumber
suffix:semicolon
id|Length
op_sub_assign
l_int|14
suffix:semicolon
id|SK_U16_TO_NETWORK_ORDER
c_func
(paren
id|Length
comma
op_amp
id|pSPacket-&gt;TypeLen
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|TxSpHelloReqCts
op_increment
suffix:semicolon
)brace
r_return
(paren
id|pMb
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtBuildSpanningTreePacket */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSend - build and send check packets&n; *&n; * Description:&n; *&t;Depending on the RLMT state and the checking state, several packets&n; *&t;are sent through the indicated port.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtSend
id|RLMT_STATIC
r_void
id|SkRlmtSend
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Sending port */
(brace
r_int
id|j
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
(brace
r_if
c_cond
(paren
id|pRPort-&gt;CheckingState
op_amp
(paren
id|SK_RLMT_PCS_TX
op_or
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
multiline_comment|/* Port is suspicious. Send the RLMT packet to the RLMT mc addr. */
r_if
c_cond
(paren
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|SK_PACKET_ALIVE
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|SkRlmtMcAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * Send a directed RLMT packet to all ports that are&n;&t;&t;&t; * checked by the indicated port.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|pRPort-&gt;PortsChecked
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|SK_PACKET_ALIVE
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|CheckAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_amp
id|SK_RLMT_RCS_SEND_SEG
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Send a BPDU packet to make a connected switch tell us&n;&t;&t; * the correct root bridge.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildSpanningTreePacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_RCS_SEND_SEG
suffix:semicolon
id|pRPort-&gt;RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_TX
comma
(paren
l_string|&quot;SkRlmtSend: BPDU Packet on Port %u.&bslash;n&quot;
comma
id|PortNumber
)paren
)paren
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSend */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtPortReceives - check if port is (going) down and bring it up&n; *&n; * Description:&n; *&t;This routine checks if a port who received a non-BPDU packet&n; *&t;needs to go up or needs to be stopped going down.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtPortReceives
id|RLMT_STATIC
r_void
id|SkRlmtPortReceives
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port to check */
(brace
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
suffix:semicolon
id|pRPort-&gt;PortNoRx
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pRPort-&gt;PortState
op_eq
id|SK_RLMT_PS_DOWN
)paren
op_logical_and
op_logical_neg
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_TX
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Port is marked down (rx), but received a non-BPDU packet.&n;&t;&t; * Bring it up.&n;&t;&t; */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Received on PortDown.&bslash;n&quot;
)paren
)paren
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_GOING_UP
suffix:semicolon
id|pRPort-&gt;GuTimeStamp
op_assign
id|SkOsGetTime
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;UpTimer
comma
id|SK_RLMT_PORTUP_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTUP_TIM
comma
id|Para
)paren
suffix:semicolon
id|pRPort-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_PCS_RX
suffix:semicolon
multiline_comment|/* pAC-&gt;Rlmt.CheckSwitch = SK_TRUE; */
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
multiline_comment|/* PortDown &amp;&amp; !SuspectTx */
r_else
r_if
c_cond
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Stop bringing port down.&bslash;n&quot;
)paren
)paren
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownRxTimer
)paren
suffix:semicolon
id|pRPort-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_PCS_RX
suffix:semicolon
multiline_comment|/* pAC-&gt;Rlmt.CheckSwitch = SK_TRUE; */
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
multiline_comment|/* PortGoingDown */
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtPortReceives */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtPacketReceive - receive a packet for closer examination&n; *&n; * Description:&n; *&t;This routine examines a packet more closely than SK_RLMT_LOOKAHEAD.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtPacketReceive
id|RLMT_STATIC
r_void
id|SkRlmtPacketReceive
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_MBUF
op_star
id|pMb
)paren
multiline_comment|/* Received packet */
(brace
macro_line|#ifdef xDEBUG
r_extern
r_void
id|DumpData
c_func
(paren
r_char
op_star
id|p
comma
r_int
id|size
)paren
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
id|SK_U16
id|PacketType
suffix:semicolon
id|SK_U32
id|PortNumber
suffix:semicolon
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_RLMT_PACKET
op_star
id|pRPacket
suffix:semicolon
id|SK_SPTREE_PACKET
op_star
id|pSPacket
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
id|PortNumber
op_assign
id|pMb-&gt;PortIdx
suffix:semicolon
id|pAPort
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: PortNumber == %d.&bslash;n&quot;
comma
id|PortNumber
)paren
)paren
id|pRPacket
op_assign
(paren
id|SK_RLMT_PACKET
op_star
)paren
id|pMb-&gt;pData
suffix:semicolon
id|pSPacket
op_assign
(paren
id|SK_SPTREE_PACKET
op_star
)paren
id|pRPacket
suffix:semicolon
macro_line|#ifdef xDEBUG
id|DumpData
c_func
(paren
(paren
r_char
op_star
)paren
id|pRPacket
comma
l_int|32
)paren
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
(paren
id|pRPort-&gt;PacketsPerTimeSlot
op_minus
id|pRPort-&gt;BpduPacketsPerTimeSlot
)paren
op_ne
l_int|0
)paren
(brace
id|SkRlmtPortReceives
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
)brace
multiline_comment|/* Check destination address. */
r_if
c_cond
(paren
op_logical_neg
id|SK_ADDR_EQUAL
c_func
(paren
id|pAPort-&gt;CurrentMacAddress.a
comma
id|pRPacket-&gt;DstAddr
)paren
op_logical_and
op_logical_neg
id|SK_ADDR_EQUAL
c_func
(paren
id|SkRlmtMcAddr.a
comma
id|pRPacket-&gt;DstAddr
)paren
op_logical_and
op_logical_neg
id|SK_ADDR_EQUAL
c_func
(paren
id|BridgeMcAddr.a
comma
id|pRPacket-&gt;DstAddr
)paren
)paren
(brace
multiline_comment|/* Not sent to current MAC or registered MC address =&gt; Trash it. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Not for me.&bslash;n&quot;
)paren
)paren
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pAPort-&gt;CurrentMacAddress.a
comma
id|pRPacket-&gt;SrcAddr
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Was sent by same port (may happen during port switching&n;&t;&t; * or in case of duplicate MAC addresses).&n;&t;&t; */
multiline_comment|/*&n;&t;&t; * Check for duplicate address here:&n;&t;&t; * If Packet.Random != My.Random =&gt; DupAddr.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|pRPort-&gt;Random
(braket
id|i
)braket
op_ne
id|pRPacket-&gt;Random
(braket
id|i
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * CAUTION: Do not check for duplicate MAC address in RLMT Alive Reply&n;&t;&t; * packets (they have the LLC_COMMAND_RESPONSE_BIT set in&n;&t;&t; * pRPacket-&gt;SSap).&n;&t;&t; */
r_if
c_cond
(paren
id|i
op_ge
l_int|0
op_logical_and
id|pRPacket-&gt;DSap
op_eq
id|SK_RLMT_DSAP
op_logical_and
id|pRPacket-&gt;Ctrl
op_eq
id|SK_RLMT_CTRL
op_logical_and
id|pRPacket-&gt;SSap
op_eq
id|SK_RLMT_SSAP
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|0
)braket
op_eq
id|SK_RLMT_INDICATOR0
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|1
)braket
op_eq
id|SK_RLMT_INDICATOR1
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|2
)braket
op_eq
id|SK_RLMT_INDICATOR2
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|3
)braket
op_eq
id|SK_RLMT_INDICATOR3
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|4
)braket
op_eq
id|SK_RLMT_INDICATOR4
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|5
)braket
op_eq
id|SK_RLMT_INDICATOR5
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|6
)braket
op_eq
id|SK_RLMT_INDICATOR6
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Duplicate MAC Address.&bslash;n&quot;
)paren
)paren
multiline_comment|/* Error Log entry. */
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_COMM
comma
id|SKERR_RLMT_E006
comma
id|SKERR_RLMT_E006_MSG
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Simply trash it. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Sent by me.&bslash;n&quot;
)paren
)paren
)brace
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Check SuspectTx entries. */
r_if
c_cond
(paren
id|pRPort-&gt;PortsSuspect
OG
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|pRPort-&gt;PortsChecked
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|SuspectTx
op_logical_and
id|SK_ADDR_EQUAL
c_func
(paren
id|pRPacket-&gt;SrcAddr
comma
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|CheckAddr.a
)paren
)paren
(brace
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|SuspectTx
op_assign
id|SK_FALSE
suffix:semicolon
id|pRPort-&gt;PortsSuspect
op_decrement
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Determine type of packet. */
r_if
c_cond
(paren
id|pRPacket-&gt;DSap
op_eq
id|SK_RLMT_DSAP
op_logical_and
id|pRPacket-&gt;Ctrl
op_eq
id|SK_RLMT_CTRL
op_logical_and
(paren
id|pRPacket-&gt;SSap
op_amp
op_complement
id|LLC_COMMAND_RESPONSE_BIT
)paren
op_eq
id|SK_RLMT_SSAP
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|0
)braket
op_eq
id|SK_RLMT_INDICATOR0
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|1
)braket
op_eq
id|SK_RLMT_INDICATOR1
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|2
)braket
op_eq
id|SK_RLMT_INDICATOR2
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|3
)braket
op_eq
id|SK_RLMT_INDICATOR3
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|4
)braket
op_eq
id|SK_RLMT_INDICATOR4
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|5
)braket
op_eq
id|SK_RLMT_INDICATOR5
op_logical_and
id|pRPacket-&gt;Indicator
(braket
l_int|6
)braket
op_eq
id|SK_RLMT_INDICATOR6
)paren
(brace
multiline_comment|/* It&squot;s an RLMT packet. */
id|PacketType
op_assign
(paren
id|SK_U16
)paren
(paren
(paren
id|pRPacket-&gt;RlmtPacketType
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|pRPacket-&gt;RlmtPacketType
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|PacketType
)paren
(brace
r_case
id|SK_PACKET_ANNOUNCE
suffix:colon
multiline_comment|/* Not yet used. */
macro_line|#if 0
multiline_comment|/* Build the check chain. */
id|SkRlmtBuildCheckChain
c_func
(paren
id|pAC
)paren
suffix:semicolon
macro_line|#endif&t;/* 0 */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Announce.&bslash;n&quot;
)paren
)paren
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_PACKET_ALIVE
suffix:colon
r_if
c_cond
(paren
id|pRPacket-&gt;SSap
op_amp
id|LLC_COMMAND_RESPONSE_BIT
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Alive Reply.&bslash;n&quot;
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|PromMode
op_amp
id|SK_PROM_MODE_LLC
)paren
op_logical_or
id|SK_ADDR_EQUAL
c_func
(paren
id|pRPacket-&gt;DstAddr
comma
id|pAPort-&gt;CurrentMacAddress.a
)paren
)paren
(brace
multiline_comment|/* Obviously we could send something. */
r_if
c_cond
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_TX
)paren
(brace
id|pRPort-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_PCS_TX
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownTxTimer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pRPort-&gt;PortState
op_eq
id|SK_RLMT_PS_DOWN
)paren
op_logical_and
op_logical_neg
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_GOING_UP
suffix:semicolon
id|pRPort-&gt;GuTimeStamp
op_assign
id|SkOsGetTime
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownTxTimer
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;UpTimer
comma
id|SK_RLMT_PORTUP_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTUP_TIM
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Mark sending port as alive? */
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Alive Request Packet. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Alive Request.&bslash;n&quot;
)paren
)paren
id|pRPort-&gt;RxHelloCts
op_increment
suffix:semicolon
multiline_comment|/* Answer. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pRPacket-&gt;DstAddr
(braket
id|i
)braket
op_assign
id|pRPacket-&gt;SrcAddr
(braket
id|i
)braket
suffix:semicolon
id|pRPacket-&gt;SrcAddr
(braket
id|i
)braket
op_assign
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress.a
(braket
id|i
)braket
suffix:semicolon
)brace
id|pRPacket-&gt;SSap
op_or_assign
id|LLC_COMMAND_RESPONSE_BIT
suffix:semicolon
id|Para.pParaPtr
op_assign
id|pMb
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_PACKET_CHECK_TX
suffix:colon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Check your tx line.&bslash;n&quot;
)paren
)paren
multiline_comment|/* A port checking us requests us to check our tx line. */
id|pRPort-&gt;CheckingState
op_or_assign
id|SK_RLMT_PCS_TX
suffix:semicolon
multiline_comment|/* Start PortDownTx timer. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownTxTimer
comma
id|SK_RLMT_PORTDOWN_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTDOWN_TX_TIM
comma
id|Para
)paren
suffix:semicolon
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|SK_PACKET_ALIVE
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|SkRlmtMcAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_PACKET_ADDR_CHANGED
suffix:colon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Address Change.&bslash;n&quot;
)paren
)paren
multiline_comment|/* Build the check chain. */
id|SkRlmtBuildCheckChain
c_func
(paren
id|pAC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Unknown RLMT packet.&bslash;n&quot;
)paren
)paren
multiline_comment|/* RA;:;: ??? */
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pSPacket-&gt;DSap
op_eq
id|SK_RLMT_SPT_DSAP
op_logical_and
id|pSPacket-&gt;Ctrl
op_eq
id|SK_RLMT_SPT_CTRL
op_logical_and
(paren
id|pSPacket-&gt;SSap
op_amp
op_complement
id|LLC_COMMAND_RESPONSE_BIT
)paren
op_eq
id|SK_RLMT_SPT_SSAP
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: BPDU Packet.&bslash;n&quot;
)paren
)paren
multiline_comment|/* Spanning Tree packet. */
id|pRPort-&gt;RxSpHelloCts
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|SK_ADDR_EQUAL
c_func
(paren
op_amp
id|pSPacket-&gt;RootId
(braket
l_int|2
)braket
comma
op_amp
id|pAC-&gt;Addr.Net
(braket
id|pAC-&gt;Rlmt
dot
id|Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;NetNumber
)braket
dot
id|CurrentMacAddress.a
(braket
l_int|0
)braket
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Check segmentation if a new root bridge is set and&n;&t;&t;&t; * the segmentation check is not currently running.&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|SK_ADDR_EQUAL
c_func
(paren
op_amp
id|pSPacket-&gt;RootId
(braket
l_int|2
)braket
comma
op_amp
id|pRPort-&gt;Root.Id
(braket
l_int|2
)braket
)paren
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;LinksUp
OG
l_int|1
)paren
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_ne
l_int|0
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_amp
id|SK_RLMT_RCS_SEG
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_or_assign
id|SK_RLMT_RCS_START_SEG
op_or
id|SK_RLMT_RCS_SEND_SEG
suffix:semicolon
)brace
multiline_comment|/* Store tree view of this port. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pRPort-&gt;Root.Id
(braket
id|i
)braket
op_assign
id|pSPacket-&gt;RootId
(braket
id|i
)braket
suffix:semicolon
)brace
id|pRPort-&gt;RootIdSet
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_DUMP
comma
(paren
l_string|&quot;Root ID %d: %02x %02x %02x %02x %02x %02x %02x %02x.&bslash;n&quot;
comma
id|PortNumber
comma
id|pRPort-&gt;Root.Id
(braket
l_int|0
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|1
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|2
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|3
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|4
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|5
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|6
)braket
comma
id|pRPort-&gt;Root.Id
(braket
l_int|7
)braket
)paren
)paren
)brace
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_amp
id|SK_RLMT_RCS_REPORT_SEG
)paren
op_ne
l_int|0
)paren
(brace
id|SkRlmtCheckSeg
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_RX
comma
(paren
l_string|&quot;SkRlmtPacketReceive: Unknown Packet Type.&bslash;n&quot;
)paren
)paren
multiline_comment|/* Unknown packet. */
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtPacketReceive */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtCheckPort - check if a port works&n; *&n; * Description:&n; *&t;This routine checks if a port whose link is up received something&n; *&t;and if it seems to transmit successfully.&n; *&n; *&t;# PortState: PsInit, PsLinkDown, PsDown, PsGoingUp, PsUp&n; *&t;# PortCheckingState (Bitfield): ChkTx, ChkRx, ChkSeg&n; *&t;# RlmtCheckingState (Bitfield): ChkSeg, StartChkSeg, ReportSeg&n; *&n; *&t;if (Rx - RxBpdu == 0) {&t;# No rx.&n; *&t;&t;if (state == PsUp) {&n; *&t;&t;&t;PortCheckingState |= ChkRx&n; *&t;&t;}&n; *&t;&t;if (ModeCheckSeg &amp;&amp; (Timeout ==&n; *&t;&t;&t;TO_SHORTEN(RLMT_DEFAULT_TIMEOUT))) {&n; *&t;&t;&t;RlmtCheckingState |= ChkSeg)&n; *&t;&t;&t;PortCheckingState |= ChkSeg&n; *&t;&t;}&n; *&t;&t;NewTimeout = TO_SHORTEN(Timeout)&n; *&t;&t;if (NewTimeout &lt; RLMT_MIN_TIMEOUT) {&n; *&t;&t;&t;NewTimeout = RLMT_MIN_TIMEOUT&n; *&t;&t;&t;PortState = PsDown&n; *&t;&t;&t;...&n; *&t;&t;}&n; *&t;}&n; *&t;else {&t;# something was received&n; *&t;&t;# Set counter to 0 at LinkDown?&n; *&t;&t;#   No - rx may be reported after LinkDown ???&n; *&t;&t;PortCheckingState &amp;= ~ChkRx&n; *&t;&t;NewTimeout = RLMT_DEFAULT_TIMEOUT&n; *&t;&t;if (RxAck == 0) {&n; *&t;&t;&t;possible reasons:&n; *&t;&t;&t;is my tx line bad? --&n; *&t;&t;&t;&t;send RLMT multicast and report&n; *&t;&t;&t;&t;back internally? (only possible&n; *&t;&t;&t;&t;between ports on same adapter)&n; *&t;&t;}&n; *&t;&t;if (RxChk == 0) {&n; *&t;&t;&t;possible reasons:&n; *&t;&t;&t;- tx line of port set to check me&n; *&t;&t;&t;  maybe bad&n; *&t;&t;&t;- no other port/adapter available or set&n; *&t;&t;&t;  to check me&n; *&t;&t;&t;- adapter checking me has a longer&n; *&t;&t;&t;  timeout&n; *&t;&t;&t;??? anything that can be done here?&n; *&t;&t;}&n; *&t;}&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;New timeout value.&n; */
DECL|function|SkRlmtCheckPort
id|RLMT_STATIC
id|SK_U32
id|SkRlmtCheckPort
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port to check */
(brace
r_int
id|i
suffix:semicolon
id|SK_U32
id|NewTimeout
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_EVPARA
id|Para
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pRPort-&gt;PacketsPerTimeSlot
op_minus
id|pRPort-&gt;BpduPacketsPerTimeSlot
)paren
op_eq
l_int|0
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkRlmtCheckPort %d: No (%d) receives in last time slot.&bslash;n&quot;
comma
id|PortNumber
comma
id|pRPort-&gt;PacketsPerTimeSlot
)paren
)paren
multiline_comment|/*&n;&t;&t; * Check segmentation if there was no receive at least twice&n;&t;&t; * in a row (PortNoRx is already set) and the segmentation&n;&t;&t; * check is not currently running.&n;&t;&t; */
r_if
c_cond
(paren
id|pRPort-&gt;PortNoRx
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;LinksUp
OG
l_int|1
)paren
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_logical_and
op_logical_neg
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_amp
id|SK_RLMT_RCS_SEG
)paren
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;CheckingState
op_or_assign
id|SK_RLMT_RCS_START_SEG
op_or
id|SK_RLMT_RCS_SEND_SEG
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkRlmtCheckPort: PortsSuspect %d, PcsRx %d.&bslash;n&quot;
comma
id|pRPort-&gt;PortsSuspect
comma
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
r_if
c_cond
(paren
id|pRPort-&gt;PortState
op_ne
id|SK_RLMT_PS_DOWN
)paren
(brace
id|NewTimeout
op_assign
id|TO_SHORTEN
c_func
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|Net-&gt;TimeoutValue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NewTimeout
OL
id|SK_RLMT_MIN_TO_VAL
)paren
(brace
id|NewTimeout
op_assign
id|SK_RLMT_MIN_TO_VAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|pRPort-&gt;CheckingState
op_or_assign
id|SK_RLMT_PCS_RX
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * What shall we do if the port checked by this one receives&n;&t;&t;&t;&t; * our request frames?  What&squot;s bad - our rx line or his tx line?&n;&t;&t;&t;&t; */
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownRxTimer
comma
id|SK_RLMT_PORTDOWN_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTDOWN_RX_TIM
comma
id|Para
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pRPort-&gt;PortsChecked
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pRPort-&gt;PortCheck
(braket
id|i
)braket
dot
id|SuspectTx
)paren
(brace
r_continue
suffix:semicolon
)brace
id|pRPort-&gt;PortCheck
(braket
id|i
)braket
dot
id|SuspectTx
op_assign
id|SK_TRUE
suffix:semicolon
id|pRPort-&gt;PortsSuspect
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
comma
id|SK_PACKET_CHECK_TX
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|PortNumber
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|pRPort-&gt;PortCheck
(braket
id|i
)braket
dot
id|CheckAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* PortDown -- or all partners suspect. */
id|NewTimeout
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
)brace
id|pRPort-&gt;PortNoRx
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* A non-BPDU packet was received. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SkRlmtCheckPort %d: %d (%d) receives in last time slot.&bslash;n&quot;
comma
id|PortNumber
comma
id|pRPort-&gt;PacketsPerTimeSlot
op_minus
id|pRPort-&gt;BpduPacketsPerTimeSlot
comma
id|pRPort-&gt;PacketsPerTimeSlot
)paren
)paren
id|SkRlmtPortReceives
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.CheckSwitch
)paren
(brace
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
id|NewTimeout
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
)brace
r_return
(paren
id|NewTimeout
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtCheckPort */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSelectBcRx - select new active port, criteria 1 (CLP)&n; *&n; * Description:&n; *&t;This routine selects the port that received a broadcast frame&n; *&t;substantially later than all other ports.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;SK_BOOL&n; */
DECL|function|SkRlmtSelectBcRx
id|RLMT_STATIC
id|SK_BOOL
id|SkRlmtSelectBcRx
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Active
comma
multiline_comment|/* Active port */
id|SK_U32
id|PrefPort
comma
multiline_comment|/* Preferred port */
id|SK_U32
op_star
id|pSelect
)paren
multiline_comment|/* New active port */
(brace
id|SK_U64
id|BcTimeStamp
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|BcTimeStamp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not totally necessary, but feeling better. */
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Select port with the latest TimeStamp. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef xDEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;TimeStamp Port %d: %08x %08x.&bslash;n&quot;
comma
id|i
comma
op_star
(paren
(paren
id|SK_U32
op_star
)paren
(paren
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
)paren
op_plus
id|OFFS_HI32
)paren
comma
op_star
(paren
(paren
id|SK_U32
op_star
)paren
(paren
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
)paren
op_plus
id|OFFS_LO32
)paren
)paren
)paren
macro_line|#endif&t;/* DEBUG */
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortDown
op_logical_and
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortNoRx
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
op_logical_or
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
OG
id|BcTimeStamp
)paren
(brace
id|BcTimeStamp
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
suffix:semicolon
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|PortFound
)paren
(brace
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Port %d received the last broadcast.&bslash;n&quot;
comma
op_star
id|pSelect
)paren
)paren
macro_line|#endif&t;/* 0 */
multiline_comment|/* Look if another port&squot;s time stamp is similar. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
op_star
id|pSelect
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortDown
op_logical_and
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortNoRx
op_logical_and
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
OG
id|BcTimeStamp
op_minus
id|SK_RLMT_BC_DELTA
op_logical_or
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|BcTimeStamp
op_plus
id|SK_RLMT_BC_DELTA
OG
id|BcTimeStamp
)paren
)paren
(brace
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
macro_line|#ifdef xDEBUG
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Port %d received a broadcast at a similar time.&bslash;n&quot;
comma
id|i
)paren
)paren
macro_line|#endif&t;/* DEBUG */
r_break
suffix:semicolon
)brace
)brace
)brace
macro_line|#ifdef xDEBUG
r_if
c_cond
(paren
id|PortFound
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_CHECK_SWITCH found Port %d receiving the substantially latest broadcast (%d).&bslash;n&quot;
comma
op_star
id|pSelect
comma
id|BcTimeStamp
op_minus
id|pAC-&gt;Rlmt.Port
(braket
l_int|1
op_minus
op_star
id|pSelect
)braket
dot
id|BcTimeStamp
)paren
)paren
)brace
macro_line|#endif&t;/* DEBUG */
r_return
(paren
id|PortFound
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSelectBcRx */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSelectNotSuspect - select new active port, criteria 2 (CLP)&n; *&n; * Description:&n; *&t;This routine selects a good port (it is PortUp &amp;&amp; !SuspectRx).&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;SK_BOOL&n; */
DECL|function|SkRlmtSelectNotSuspect
id|RLMT_STATIC
id|SK_BOOL
id|SkRlmtSelectNotSuspect
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Active
comma
multiline_comment|/* Active port */
id|SK_U32
id|PrefPort
comma
multiline_comment|/* Preferred port */
id|SK_U32
op_star
id|pSelect
)paren
multiline_comment|/* New active port */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Select first port that is PortUp &amp;&amp; !SuspectRx. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortDown
op_logical_and
op_logical_neg
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|Active
)braket
dot
id|PortDown
op_logical_and
op_logical_neg
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|Active
)braket
dot
id|CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
op_star
id|pSelect
op_assign
id|Active
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|PrefPort
)braket
dot
id|PortDown
op_logical_and
op_logical_neg
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PrefPort
)braket
dot
id|CheckingState
op_amp
id|SK_RLMT_PCS_RX
)paren
)paren
(brace
op_star
id|pSelect
op_assign
id|PrefPort
suffix:semicolon
)brace
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_CHECK_SWITCH found Port %d up and not check RX.&bslash;n&quot;
comma
op_star
id|pSelect
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|PortFound
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSelectNotSuspect */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSelectUp - select new active port, criteria 3, 4 (CLP)&n; *&n; * Description:&n; *&t;This routine selects a port that is up.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;SK_BOOL&n; */
DECL|function|SkRlmtSelectUp
id|RLMT_STATIC
id|SK_BOOL
id|SkRlmtSelectUp
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Active
comma
multiline_comment|/* Active port */
id|SK_U32
id|PrefPort
comma
multiline_comment|/* Preferred port */
id|SK_U32
op_star
id|pSelect
comma
multiline_comment|/* New active port */
id|SK_BOOL
id|AutoNegDone
)paren
multiline_comment|/* Successfully auto-negotiated? */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Select first port that is PortUp. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_UP
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|Active
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_UP
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|Active
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|Active
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PrefPort
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_UP
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|PrefPort
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|PrefPort
suffix:semicolon
)brace
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_CHECK_SWITCH found Port %d up.&bslash;n&quot;
comma
op_star
id|pSelect
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|PortFound
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSelectUp */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSelectGoingUp - select new active port, criteria 5, 6 (CLP)&n; *&n; * Description:&n; *&t;This routine selects the port that is going up for the longest time.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;SK_BOOL&n; */
DECL|function|SkRlmtSelectGoingUp
id|RLMT_STATIC
id|SK_BOOL
id|SkRlmtSelectGoingUp
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Active
comma
multiline_comment|/* Active port */
id|SK_U32
id|PrefPort
comma
multiline_comment|/* Preferred port */
id|SK_U32
op_star
id|pSelect
comma
multiline_comment|/* New active port */
id|SK_BOOL
id|AutoNegDone
)paren
multiline_comment|/* Successfully auto-negotiated? */
(brace
id|SK_U64
id|GuTimeStamp
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|GuTimeStamp
op_assign
l_int|0
suffix:semicolon
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Select port that is PortGoingUp for the longest time. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_GOING_UP
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
id|GuTimeStamp
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|GuTimeStamp
suffix:semicolon
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
r_return
(paren
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
op_star
id|pSelect
op_plus
l_int|1
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_GOING_UP
op_logical_and
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|GuTimeStamp
OL
id|GuTimeStamp
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
id|GuTimeStamp
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|GuTimeStamp
suffix:semicolon
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
)brace
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_CHECK_SWITCH found Port %d going up.&bslash;n&quot;
comma
op_star
id|pSelect
)paren
)paren
r_return
(paren
id|SK_TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSelectGoingUp */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtSelectDown - select new active port, criteria 7, 8 (CLP)&n; *&n; * Description:&n; *&t;This routine selects a port that is down.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;SK_BOOL&n; */
DECL|function|SkRlmtSelectDown
id|RLMT_STATIC
id|SK_BOOL
id|SkRlmtSelectDown
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Active
comma
multiline_comment|/* Active port */
id|SK_U32
id|PrefPort
comma
multiline_comment|/* Preferred port */
id|SK_U32
op_star
id|pSelect
comma
multiline_comment|/* New active port */
id|SK_BOOL
id|AutoNegDone
)paren
multiline_comment|/* Successfully auto-negotiated? */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Select first port that is PortDown. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_DOWN
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|i
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|Active
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_DOWN
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|Active
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|Active
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PrefPort
)braket
dot
id|PortState
op_eq
id|SK_RLMT_PS_DOWN
op_logical_and
id|pAC-&gt;GIni.GP
(braket
id|PrefPort
)braket
dot
id|PAutoNegFail
op_ne
id|AutoNegDone
)paren
(brace
op_star
id|pSelect
op_assign
id|PrefPort
suffix:semicolon
)brace
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_CHECK_SWITCH found Port %d down.&bslash;n&quot;
comma
op_star
id|pSelect
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|PortFound
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtSelectDown */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtCheckSwitch - select new active port and switch to it&n; *&n; * Description:&n; *&t;This routine decides which port should be the active one and queues&n; *&t;port switching if necessary.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtCheckSwitch
id|RLMT_STATIC
r_void
id|SkRlmtCheckSwitch
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|NetIdx
)paren
multiline_comment|/* Net index */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_U32
id|Active
suffix:semicolon
id|SK_U32
id|PrefPort
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_BOOL
id|PortFound
suffix:semicolon
id|Active
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|ActivePort
suffix:semicolon
multiline_comment|/* Index of active port. */
id|PrefPort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|PrefPort
suffix:semicolon
multiline_comment|/* Index of preferred port. */
id|PortFound
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.CheckSwitch
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|LinksUp
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Last link went down - shut down the net. */
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_NET_DOWN
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_NET_DOWN_TEMP
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|NetIdx
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_NET_DOWN
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|NetIdx
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_ACTIVE_DOWN
comma
id|Para
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* pAC-&gt;Rlmt.LinksUp == 0 */
r_else
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|LinksUp
op_eq
l_int|1
op_logical_and
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtState
op_eq
id|SK_RLMT_RS_NET_DOWN
)paren
(brace
multiline_comment|/* First link came up - get the net up. */
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_NET_UP
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If pAC-&gt;Rlmt.ActivePort != Para.Para32[0],&n;&t;&t; * the DRV switches to the port that came up.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|LinkDown
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|Active
)braket
op_member_access_from_pointer
id|LinkDown
)paren
(brace
id|i
op_assign
id|Active
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|PrefPort
)braket
op_member_access_from_pointer
id|LinkDown
)paren
(brace
id|i
op_assign
id|PrefPort
suffix:semicolon
)brace
id|PortFound
op_assign
id|SK_TRUE
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|PortFound
)paren
(brace
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|NetIdx
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_ACTIVE_UP
comma
id|Para
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|ActivePort
op_assign
id|i
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|NetIdx
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_NET_UP
comma
id|Para
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_TRANSPARENT
)paren
op_eq
l_int|0
op_logical_and
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
comma
id|SK_PACKET_ANNOUNCE
comma
op_amp
id|pAC-&gt;Addr.Net
(braket
id|NetIdx
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|SkRlmtMcAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Send announce packet to RLMT multicast address to force&n;&t;&t;&t;&t; * switches to learn the new location of the logical MAC address.&n;&t;&t;&t;&t; */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E007
comma
id|SKERR_RLMT_E007_MSG
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* LinksUp == 1 &amp;&amp; RlmtState == SK_RLMT_RS_NET_DOWN */
r_else
(brace
multiline_comment|/* Cannot be reached in dual-net mode. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|Active
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Preselection:&n;&t;&t; *&t;If RLMT Mode != CheckLinkState&n;&t;&t; *&t;&t;select port that received a broadcast frame substantially later&n;&t;&t; *&t;&t;than all other ports&n;&t;&t; *&t;else select first port that is not SuspectRx&n;&t;&t; *&t;else select first port that is PortUp&n;&t;&t; *&t;else select port that is PortGoingUp for the longest time&n;&t;&t; *&t;else select first port that is PortDown&n;&t;&t; *&t;else stop.&n;&t;&t; *&n;&t;&t; * For the preselected port:&n;&t;&t; *&t;If ActivePort is equal in quality, select ActivePort.&n;&t;&t; *&n;&t;&t; *&t;If PrefPort is equal in quality, select PrefPort.&n;&t;&t; *&n;&t;&t; *&t;If ActivePort != SelectedPort,&n;&t;&t; *&t;&t;If old ActivePort is LinkDown,&n;&t;&t; *&t;&t;&t;SwitchHard&n;&t;&t; *&t;&t;else&n;&t;&t; *&t;&t;&t;SwitchSoft&n;&t;&t; */
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|RlmtMode
op_ne
id|SK_RLMT_MODE_CLS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectBcRx
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectNotSuspect
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* pAC-&gt;Rlmt.RlmtMode != SK_RLMT_MODE_CLS */
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_FAILED
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectGoingUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectGoingUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_FAILED
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|RlmtMode
op_ne
id|SK_RLMT_MODE_CLS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_SUCCESS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|PortFound
)paren
(brace
id|PortFound
op_assign
id|SkRlmtSelectDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Active
comma
id|PrefPort
comma
op_amp
id|Para.Para32
(braket
l_int|1
)braket
comma
id|AUTONEG_FAILED
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* pAC-&gt;Rlmt.RlmtMode != SK_RLMT_MODE_CLS */
r_if
c_cond
(paren
id|PortFound
)paren
(brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
id|Active
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Active: %d, Para1: %d.&bslash;n&quot;
comma
id|Active
comma
id|Para.Para32
(braket
l_int|1
)braket
)paren
)paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|ActivePort
op_assign
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|SK_HWAC_LINK_LED
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|1
)braket
comma
id|SK_LED_ACTIVE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|Active
)braket
dot
id|LinkDown
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_SWITCH_HARD
comma
id|Para
)paren
suffix:semicolon
)brace
r_else
(brace
id|SK_HWAC_LINK_LED
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_LED_STANDBY
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_SWITCH_SOFT
comma
id|Para
)paren
suffix:semicolon
)brace
id|Para.Para32
(braket
l_int|1
)braket
op_assign
id|NetIdx
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_ACTIVE_DOWN
comma
id|Para
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|Port
(braket
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_ACTIVE_UP
comma
id|Para
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_TRANSPARENT
)paren
op_eq
l_int|0
op_logical_and
(paren
id|Para.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_PACKET_ANNOUNCE
comma
op_amp
id|pAC-&gt;Addr.Net
(braket
id|NetIdx
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|SkRlmtMcAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Send announce packet to RLMT multicast address to force&n;&t;&t;&t;&t;&t; * switches to learn the new location of the logical&n;&t;&t;&t;&t;&t; * MAC address.&n;&t;&t;&t;&t;&t; */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para
)paren
suffix:semicolon
)brace
multiline_comment|/* (Para.pParaPtr = SkRlmtBuildPacket(...)) != NULL */
)brace
multiline_comment|/* Para.Para32[1] != Active */
)brace
multiline_comment|/* PortFound */
r_else
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E004
comma
id|SKERR_RLMT_E004_MSG
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* LinksUp &gt; 1 || LinksUp == 1 &amp;&amp; RlmtState != SK_RLMT_RS_NET_DOWN */
r_return
suffix:semicolon
)brace
multiline_comment|/* SkRlmtCheckSwitch */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtCheckSeg - Report if segmentation is detected&n; *&n; * Description:&n; *&t;This routine checks if the ports see different root bridges and reports&n; *&t;segmentation in such a case.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing.&n; */
DECL|function|SkRlmtCheckSeg
id|RLMT_STATIC
r_void
id|SkRlmtCheckSeg
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|NetIdx
)paren
multiline_comment|/* Net number */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
id|SK_RLMT_NET
op_star
id|pNet
suffix:semicolon
id|SK_U32
id|i
comma
id|j
suffix:semicolon
id|SK_BOOL
id|Equal
suffix:semicolon
id|pNet
op_assign
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|NetIdx
)braket
suffix:semicolon
id|pNet-&gt;RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|Equal
op_assign
id|SK_TRUE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pNet-&gt;NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|LinkDown
op_logical_or
op_logical_neg
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|RootIdSet
)paren
(brace
r_continue
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_DUMP
comma
(paren
l_string|&quot;Root ID %d: %02x %02x %02x %02x %02x %02x %02x %02x.&bslash;n&quot;
comma
id|i
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|0
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|1
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|2
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|3
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|4
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|5
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|6
)braket
comma
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
l_int|7
)braket
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
id|pNet-&gt;RootIdSet
)paren
(brace
id|pNet-&gt;Root
op_assign
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root
suffix:semicolon
id|pNet-&gt;RootIdSet
op_assign
id|SK_TRUE
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|Equal
op_and_assign
id|pNet-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|Root.Id
(braket
id|j
)braket
op_eq
id|pNet-&gt;Root.Id
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|Equal
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|Equal
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_COMM
comma
id|SKERR_RLMT_E005
comma
id|SKERR_RLMT_E005_MSG
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|NetIdx
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_SEGMENTATION
comma
id|Para
)paren
suffix:semicolon
id|pNet-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_RCS_REPORT_SEG
suffix:semicolon
multiline_comment|/* 2000-03-06 RA: New. */
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|NetIdx
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pNet-&gt;SegTimer
comma
id|SK_RLMT_SEG_TO_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SEG_TIM
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* for (i = 0; i &lt; pNet-&gt;NumPorts; i++) */
multiline_comment|/* 2000-03-06 RA: Moved here. */
multiline_comment|/* Segmentation check not running anymore. */
id|pNet-&gt;CheckingState
op_and_assign
op_complement
id|SK_RLMT_RCS_SEG
suffix:semicolon
)brace
multiline_comment|/* SkRlmtCheckSeg */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtPortStart - initialize port variables and start port&n; *&n; * Description:&n; *&t;This routine initializes a port&squot;s variables and issues a PORT_START&n; *&t;to the HWAC module.  This handles retries if the start fails or the&n; *&t;link eventually goes down.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtPortStart
id|RLMT_STATIC
r_void
id|SkRlmtPortStart
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|PortNumber
)paren
multiline_comment|/* Port number */
(brace
id|SK_EVPARA
id|Para
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortState
op_assign
id|SK_RLMT_PS_LINK_DOWN
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortStarted
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|LinkDown
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortDown
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|CheckingState
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|Para.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_START
comma
id|Para
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtPortStart */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPortStartTim - PORT_START_TIM&n; *&n; * Description:&n; *&t;This routine handles PORT_START_TIM events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPortStartTim
id|RLMT_STATIC
r_void
id|SkRlmtEvtPortStartTim
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 -1 */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTSTART_TIMEOUT Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTSTART_TIMEOUT Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Used to start non-preferred ports if the preferred one&n;&t; * does not come up.&n;&t; * This timeout needs only be set when starting the first&n;&t; * (preferred) port.&n;&t; */
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinkDown
)paren
(brace
multiline_comment|/* PORT_START failed. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Net-&gt;NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Net-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortStarted
)paren
(brace
id|SkRlmtPortStart
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Net-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
)brace
)brace
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTSTART_TIMEOUT Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtPortStartTim */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtLinkUp - LINK_UP&n; *&n; * Description:&n; *&t;This routine handles LLINK_UP events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtLinkUp
id|RLMT_STATIC
r_void
id|SkRlmtEvtLinkUp
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 Undefined */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_EVPARA
id|Para2
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_UP Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;PortStarted
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E008
comma
id|SKERR_RLMT_E008_MSG
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_UP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;LinkDown
)paren
(brace
multiline_comment|/* RA;:;: Any better solution? */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_UP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;UpTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownRxTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownTxTimer
)paren
suffix:semicolon
multiline_comment|/* Do something if timer already fired? */
id|pRPort-&gt;LinkDown
op_assign
id|SK_FALSE
suffix:semicolon
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_GOING_UP
suffix:semicolon
id|pRPort-&gt;GuTimeStamp
op_assign
id|SkOsGetTime
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|pRPort-&gt;BcTimeStamp
op_assign
l_int|0
suffix:semicolon
id|pRPort-&gt;Net-&gt;LinksUp
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;LinksUp
op_eq
l_int|1
)paren
(brace
id|SK_HWAC_LINK_LED
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_LED_ACTIVE
)paren
suffix:semicolon
)brace
r_else
(brace
id|SK_HWAC_LINK_LED
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_LED_STANDBY
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pRPort-&gt;Net-&gt;NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;Net-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortStarted
)paren
(brace
id|SkRlmtPortStart
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
)brace
)brace
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;LinksUp
op_ge
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
(brace
multiline_comment|/* Build the check chain. */
id|SkRlmtBuildCheckChain
c_func
(paren
id|pAC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* If the first link comes up, start the periodical RLMT timeout. */
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;NumPorts
OG
l_int|1
op_logical_and
id|pRPort-&gt;Net-&gt;LinksUp
op_eq
l_int|1
op_logical_and
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_OTHERS
)paren
op_ne
l_int|0
)paren
(brace
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|pRPort-&gt;Net-&gt;NetNumber
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;Net-&gt;LocTimer
comma
id|pRPort-&gt;Net-&gt;TimeoutValue
comma
id|SKGE_RLMT
comma
id|SK_RLMT_TIM
comma
id|Para2
)paren
suffix:semicolon
)brace
id|Para2
op_assign
id|Para
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;UpTimer
comma
id|SK_RLMT_PORTUP_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTUP_TIM
comma
id|Para2
)paren
suffix:semicolon
multiline_comment|/* Later: if (pAC-&gt;Rlmt.RlmtMode &amp; SK_RLMT_CHECK_LOC_LINK) &amp;&amp; */
r_if
c_cond
(paren
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_TRANSPARENT
)paren
op_eq
l_int|0
op_logical_and
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_LINK
)paren
op_ne
l_int|0
op_logical_and
(paren
id|Para2.pParaPtr
op_assign
id|SkRlmtBuildPacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_PACKET_ANNOUNCE
comma
op_amp
id|pAC-&gt;Addr.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CurrentMacAddress
comma
op_amp
id|SkRlmtMcAddr
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* Send &quot;new&quot; packet to RLMT multicast address. */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
(brace
r_if
c_cond
(paren
(paren
id|Para2.pParaPtr
op_assign
id|SkRlmtBuildSpanningTreePacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pRPort-&gt;Net-&gt;CheckingState
op_or_assign
id|SK_RLMT_RCS_SEG
op_or
id|SK_RLMT_RCS_REPORT_SEG
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para2
)paren
suffix:semicolon
id|Para.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;Net-&gt;SegTimer
comma
id|SK_RLMT_SEG_TO_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SEG_TIM
comma
id|Para
)paren
suffix:semicolon
)brace
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_UP Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtLinkUp */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPortUpTim - PORT_UP_TIM&n; *&n; * Description:&n; *&t;This routine handles PORT_UP_TIM events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPortUpTim
id|RLMT_STATIC
r_void
id|SkRlmtEvtPortUpTim
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 -1 */
(brace
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTUP_TIM Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTUP_TIM Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pRPort-&gt;LinkDown
op_logical_or
(paren
id|pRPort-&gt;PortState
op_eq
id|SK_RLMT_PS_UP
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTUP_TIM Port %d Event EMPTY.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_return
suffix:semicolon
)brace
id|pRPort-&gt;PortDown
op_assign
id|SK_FALSE
suffix:semicolon
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_UP
suffix:semicolon
id|pRPort-&gt;Net-&gt;PortsUp
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;RlmtState
op_ne
id|SK_RLMT_RS_INIT
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NumNets
op_le
l_int|1
)paren
(brace
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_PORT_UP
comma
id|Para
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTUP_TIM Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtPortUpTim */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPortDownTim - PORT_DOWN_*&n; *&n; * Description:&n; *&t;This routine handles PORT_DOWN_* events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPortDownX
id|RLMT_STATIC
r_void
id|SkRlmtEvtPortDownX
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Event
comma
multiline_comment|/* Event code */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 -1 */
(brace
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTDOWN* Port %d Event (%d) BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|Event
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTDOWN* Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;PortStarted
op_logical_or
(paren
id|Event
op_eq
id|SK_RLMT_PORTDOWN_TX_TIM
op_logical_and
op_logical_neg
(paren
id|pRPort-&gt;CheckingState
op_amp
id|SK_RLMT_PCS_TX
)paren
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTDOWN* Event (%d) EMPTY.&bslash;n&quot;
comma
id|Event
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Stop port&squot;s timers. */
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;UpTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownRxTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pRPort-&gt;DownTxTimer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pRPort-&gt;PortState
op_ne
id|SK_RLMT_PS_LINK_DOWN
)paren
(brace
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_DOWN
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;PortDown
)paren
(brace
id|pRPort-&gt;Net-&gt;PortsUp
op_decrement
suffix:semicolon
id|pRPort-&gt;PortDown
op_assign
id|SK_TRUE
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_PORT_DOWN
comma
id|Para
)paren
suffix:semicolon
)brace
id|pRPort-&gt;PacketsPerTimeSlot
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* pRPort-&gt;DataPacketsPerTimeSlot = 0; */
id|pRPort-&gt;BpduPacketsPerTimeSlot
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * RA;:;: To be checked:&n;&t; * - actions at RLMT_STOP: We should not switch anymore.&n;&t; */
r_if
c_cond
(paren
id|pRPort-&gt;Net-&gt;RlmtState
op_ne
id|SK_RLMT_RS_INIT
)paren
(brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
id|pRPort-&gt;Net-&gt;Port
(braket
id|pRPort-&gt;Net-&gt;ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
)paren
(brace
multiline_comment|/* Active Port went down. */
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORTDOWN* Event (%d) END.&bslash;n&quot;
comma
id|Event
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtPortDownX */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtLinkDown - LINK_DOWN&n; *&n; * Description:&n; *&t;This routine handles LINK_DOWN events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtLinkDown
id|RLMT_STATIC
r_void
id|SkRlmtEvtLinkDown
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 Undefined */
(brace
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_DOWN Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinkDown
)paren
(brace
id|pRPort-&gt;Net-&gt;LinksUp
op_decrement
suffix:semicolon
id|pRPort-&gt;LinkDown
op_assign
id|SK_TRUE
suffix:semicolon
id|pRPort-&gt;PortState
op_assign
id|SK_RLMT_PS_LINK_DOWN
suffix:semicolon
id|SK_HWAC_LINK_LED
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
comma
id|SK_LED_OFF
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pRPort-&gt;Net-&gt;RlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Build the check chain. */
id|SkRlmtBuildCheckChain
c_func
(paren
id|pAC
comma
id|pRPort-&gt;Net-&gt;NetNumber
)paren
suffix:semicolon
)brace
multiline_comment|/* Ensure that port is marked down. */
id|Para.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
(paren
r_void
)paren
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_PORTDOWN
comma
id|Para
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_LINK_DOWN Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtLinkDown */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPortAddr - PORT_ADDR&n; *&n; * Description:&n; *&t;This routine handles PORT_ADDR events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPortAddr
id|RLMT_STATIC
r_void
id|SkRlmtEvtPortAddr
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortNumber; SK_U32 -1 */
(brace
id|SK_U32
id|i
comma
id|j
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_MAC_ADDR
op_star
id|pOldMacAddr
suffix:semicolon
id|SK_MAC_ADDR
op_star
id|pNewMacAddr
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORT_ADDR Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORT_ADDR Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Port&squot;s physical MAC address changed. */
id|pOldMacAddr
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|PreviousMacAddress
suffix:semicolon
id|pNewMacAddr
op_assign
op_amp
id|pAC-&gt;Addr.Port
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CurrentMacAddress
suffix:semicolon
multiline_comment|/*&n;&t; * NOTE: This is not scalable for solutions where ports are&n;&t; *&t; checked remotely.  There, we need to send an RLMT&n;&t; *&t; address change packet - and how do we ensure delivery?&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|pRPort-&gt;PortsChecked
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SK_ADDR_EQUAL
c_func
(paren
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|CheckAddr.a
comma
id|pOldMacAddr-&gt;a
)paren
)paren
(brace
id|pRPort-&gt;PortCheck
(braket
id|j
)braket
dot
id|CheckAddr
op_assign
op_star
id|pNewMacAddr
suffix:semicolon
)brace
)brace
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PORT_ADDR Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtPortAddr */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtStart - START&n; *&n; * Description:&n; *&t;This routine handles START events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtStart
id|RLMT_STATIC
r_void
id|SkRlmtEvtStart
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
id|SK_EVPARA
id|Para2
suffix:semicolon
id|SK_U32
id|PortIdx
suffix:semicolon
id|SK_U32
id|PortNumber
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Net %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtState
op_ne
id|SK_RLMT_RS_INIT
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NetsStarted
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;All nets should have been started.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|PrefPort
op_ge
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E009
comma
id|SKERR_RLMT_E009_MSG
)paren
suffix:semicolon
multiline_comment|/* Change PrefPort to internal default. */
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
(paren
r_void
)paren
id|SkRlmtEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_RLMT_PREFPORT_CHANGE
comma
id|Para2
)paren
suffix:semicolon
)brace
id|PortIdx
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|PrefPort
suffix:semicolon
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|PortIdx
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinksUp
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|PortsUp
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CheckingState
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_NET_DOWN
suffix:semicolon
multiline_comment|/* Start preferred port. */
id|SkRlmtPortStart
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
multiline_comment|/* Start Timer (for first port only). */
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|UpTimer
comma
id|SK_RLMT_PORTSTART_TIM_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PORTSTART_TIM
comma
id|Para2
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.NetsStarted
op_increment
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_START Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtStart */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtStop - STOP&n; *&n; * Description:&n; *&t;This routine handles STOP events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtStop
id|RLMT_STATIC
r_void
id|SkRlmtEvtStop
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
id|SK_EVPARA
id|Para2
suffix:semicolon
id|SK_U32
id|PortNumber
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Net %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtState
op_eq
id|SK_RLMT_RS_INIT
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NetsStarted
op_eq
l_int|0
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;All nets are stopped.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Stop RLMT timers. */
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LocTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|SegTimer
)paren
suffix:semicolon
multiline_comment|/* Stop net. */
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|SK_RLMT_NET_DOWN_FINAL
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Net# */
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_NET_DOWN
comma
id|Para2
)paren
suffix:semicolon
multiline_comment|/* Stop ports. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortState
op_ne
id|SK_RLMT_PS_INIT
)paren
(brace
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|UpTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|DownRxTimer
)paren
suffix:semicolon
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|DownTxTimer
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortState
op_assign
id|SK_RLMT_PS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
dot
id|PortStarted
op_assign
id|SK_FALSE
suffix:semicolon
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|PortNumber
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_HWAC
comma
id|SK_HWEV_PORT_STOP
comma
id|Para2
)paren
suffix:semicolon
)brace
)brace
id|pAC-&gt;Rlmt.NetsStarted
op_decrement
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STOP Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtStop */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtTim - TIM&n; *&n; * Description:&n; *&t;This routine handles TIM events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtTim
id|RLMT_STATIC
r_void
id|SkRlmtEvtTim
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_U32
id|Timeout
suffix:semicolon
id|SK_U32
id|NewTimeout
suffix:semicolon
id|SK_U32
id|PortNumber
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_TIM Event BEGIN.&bslash;n&quot;
)paren
)paren
macro_line|#endif&t;/* 0 */
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_TIM Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_OTHERS
)paren
op_eq
l_int|0
op_logical_or
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinksUp
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Mode changed or all links down: No more link checking. */
r_return
suffix:semicolon
)brace
macro_line|#if 0
id|pAC-&gt;Rlmt.SwitchCheckCounter
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.SwitchCheckCounter
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;Rlmt.SwitchCheckCounter
suffix:semicolon
)brace
macro_line|#endif&t;/* 0 */
id|NewTimeout
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|PortNumber
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
suffix:semicolon
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|PortNumber
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pRPort-&gt;LinkDown
)paren
(brace
id|Timeout
op_assign
id|SkRlmtCheckPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|PortNumber
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Timeout
OL
id|NewTimeout
)paren
(brace
id|NewTimeout
op_assign
id|Timeout
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * These counters should be set to 0 for all ports before the&n;&t;&t;&t; * first frame is sent in the next loop.&n;&t;&t;&t; */
id|pRPort-&gt;PacketsPerTimeSlot
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* pRPort-&gt;DataPacketsPerTimeSlot = 0; */
id|pRPort-&gt;BpduPacketsPerTimeSlot
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|TimeoutValue
op_assign
id|NewTimeout
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinksUp
OG
l_int|1
)paren
(brace
multiline_comment|/*&n;&t;&t; * If checking remote ports, also send packets if&n;&t;&t; *   (LinksUp == 1) &amp;&amp;&n;&t;&t; *   this port checks at least one (remote) port.&n;&t;&t; */
multiline_comment|/*&n;&t;&t; * Must be new loop, as SkRlmtCheckPort can request to&n;&t;&t; * check segmentation when e.g. checking the last port.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|LinkDown
)paren
(brace
id|SkRlmtSend
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
)brace
)brace
)brace
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LocTimer
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|TimeoutValue
comma
id|SKGE_RLMT
comma
id|SK_RLMT_TIM
comma
id|Para
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|LinksUp
OG
l_int|1
op_logical_and
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_logical_and
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CheckingState
op_amp
id|SK_RLMT_RCS_START_SEG
)paren
)paren
(brace
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|SegTimer
comma
id|SK_RLMT_SEG_TO_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SEG_TIM
comma
id|Para
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CheckingState
op_and_assign
op_complement
id|SK_RLMT_RCS_START_SEG
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|CheckingState
op_or_assign
id|SK_RLMT_RCS_SEG
op_or
id|SK_RLMT_RCS_REPORT_SEG
suffix:semicolon
)brace
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_TIM Event END.&bslash;n&quot;
)paren
)paren
macro_line|#endif&t;/* 0 */
)brace
multiline_comment|/* SkRlmtEvtTim */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtSegTim - SEG_TIM&n; *&n; * Description:&n; *&t;This routine handles SEG_TIM events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtSegTim
id|RLMT_STATIC
r_void
id|SkRlmtEvtSegTim
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
macro_line|#ifdef XDEBUG
r_int
id|j
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SEG_TIM Event BEGIN.&bslash;n&quot;
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SEG_TIM Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
macro_line|#ifdef xDEBUG
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|j
op_increment
)paren
(brace
id|SK_ADDR_PORT
op_star
id|pAPort
suffix:semicolon
id|SK_U32
id|k
suffix:semicolon
id|SK_U16
op_star
id|InAddr
suffix:semicolon
id|SK_U8
id|InAddr8
(braket
l_int|6
)braket
suffix:semicolon
id|InAddr
op_assign
(paren
id|SK_U16
op_star
)paren
op_amp
id|InAddr8
(braket
l_int|0
)braket
suffix:semicolon
id|pAPort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|j
)braket
op_member_access_from_pointer
id|AddrPort
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|pAPort-&gt;NextExactMatchRlmt
suffix:semicolon
id|k
op_increment
)paren
(brace
multiline_comment|/* Get exact match address k from port j. */
id|XM_INADDR
c_func
(paren
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|j
)braket
op_member_access_from_pointer
id|PortNumber
comma
id|XM_EXM
c_func
(paren
id|k
)paren
comma
id|InAddr
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;MC address %d on Port %u: %02x %02x %02x %02x %02x %02x --  %02x %02x %02x %02x %02x %02x.&bslash;n&quot;
comma
id|k
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|j
)braket
op_member_access_from_pointer
id|PortNumber
comma
id|InAddr8
(braket
l_int|0
)braket
comma
id|InAddr8
(braket
l_int|1
)braket
comma
id|InAddr8
(braket
l_int|2
)braket
comma
id|InAddr8
(braket
l_int|3
)braket
comma
id|InAddr8
(braket
l_int|4
)braket
comma
id|InAddr8
(braket
l_int|5
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|0
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|1
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|2
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|3
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|4
)braket
comma
id|pAPort-&gt;Exact
(braket
id|k
)braket
dot
id|a
(braket
l_int|5
)braket
)paren
)paren
)brace
)brace
macro_line|#endif&t;/* DEBUG */
id|SkRlmtCheckSeg
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SEG_TIM Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtSegTim */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPacketRx - PACKET_RECEIVED&n; *&n; * Description:&n; *&t;This routine handles PACKET_RECEIVED events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPacketRx
id|RLMT_STATIC
r_void
id|SkRlmtEvtPacketRx
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_MBUF *pMb */
(brace
id|SK_MBUF
op_star
id|pMb
suffix:semicolon
id|SK_MBUF
op_star
id|pNextMb
suffix:semicolon
id|SK_U32
id|NetNumber
suffix:semicolon
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PACKET_RECEIVED Event BEGIN.&bslash;n&quot;
)paren
)paren
macro_line|#endif&t;/* 0 */
multiline_comment|/* Should we ignore frames during port switching? */
macro_line|#ifdef DEBUG
id|pMb
op_assign
id|Para.pParaPtr
suffix:semicolon
r_if
c_cond
(paren
id|pMb
op_eq
l_int|NULL
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;No mbuf.&bslash;n&quot;
)paren
)paren
)brace
r_else
r_if
c_cond
(paren
id|pMb-&gt;pNext
op_ne
l_int|NULL
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;More than one mbuf or pMb-&gt;pNext not set.&bslash;n&quot;
)paren
)paren
)brace
macro_line|#endif&t;/* DEBUG */
r_for
c_loop
(paren
id|pMb
op_assign
id|Para.pParaPtr
suffix:semicolon
id|pMb
op_ne
l_int|NULL
suffix:semicolon
id|pMb
op_assign
id|pNextMb
)paren
(brace
id|pNextMb
op_assign
id|pMb-&gt;pNext
suffix:semicolon
id|pMb-&gt;pNext
op_assign
l_int|NULL
suffix:semicolon
id|NetNumber
op_assign
id|pAC-&gt;Rlmt.Port
(braket
id|pMb-&gt;PortIdx
)braket
dot
id|Net-&gt;NetNumber
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|NetNumber
)braket
dot
id|RlmtState
op_eq
id|SK_RLMT_RS_INIT
)paren
(brace
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
)brace
r_else
(brace
id|SkRlmtPacketReceive
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pMb
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PACKET_RECEIVED Event END.&bslash;n&quot;
)paren
)paren
macro_line|#endif&t;/* 0 */
)brace
multiline_comment|/* SkRlmtEvtPacketRx */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtStatsClear - STATS_CLEAR&n; *&n; * Description:&n; *&t;This routine handles STATS_CLEAR events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtStatsClear
id|RLMT_STATIC
r_void
id|SkRlmtEvtStatsClear
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
id|SK_U32
id|i
suffix:semicolon
id|SK_RLMT_PORT
op_star
id|pRPort
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_CLEAR Event BEGIN.&bslash;n&quot;
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_CLEAR Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_CLEAR Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Clear statistics for logical and physical ports. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pRPort
op_assign
op_amp
id|pAC-&gt;Rlmt.Port
(braket
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|0
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
)braket
suffix:semicolon
id|pRPort-&gt;TxHelloCts
op_assign
l_int|0
suffix:semicolon
id|pRPort-&gt;RxHelloCts
op_assign
l_int|0
suffix:semicolon
id|pRPort-&gt;TxSpHelloReqCts
op_assign
l_int|0
suffix:semicolon
id|pRPort-&gt;RxSpHelloCts
op_assign
l_int|0
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_CLEAR Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtStatsClear */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtStatsUpdate - STATS_UPDATE&n; *&n; * Description:&n; *&t;This routine handles STATS_UPDATE events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtStatsUpdate
id|RLMT_STATIC
r_void
id|SkRlmtEvtStatsUpdate
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NetNumber; SK_U32 -1 */
(brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_UPDATE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_UPDATE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
macro_line|#if 0
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_UPDATE Event BEGIN.&bslash;n&quot;
)paren
)paren
multiline_comment|/* Update statistics - currently always up-to-date. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_STATS_UPDATE Event END.&bslash;n&quot;
)paren
)paren
macro_line|#endif&t;/* 0 */
)brace
multiline_comment|/* SkRlmtEvtStatsUpdate */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtPrefportChange - PREFPORT_CHANGE&n; *&n; * Description:&n; *&t;This routine handles PREFPORT_CHANGE events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtPrefportChange
id|RLMT_STATIC
r_void
id|SkRlmtEvtPrefportChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 PortIndex; SK_U32 NetNumber */
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PREFPORT_CHANGE to Port %d Event BEGIN.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|1
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PREFPORT_CHANGE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* 0xFFFFFFFF == auto-mode. */
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
l_int|0xFFFFFFFF
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|PrefPort
op_assign
id|SK_RLMT_DEF_PREF_PORT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_ge
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|NumPorts
)paren
(brace
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E010
comma
id|SKERR_RLMT_E010_MSG
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PREFPORT_CHANGE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|PrefPort
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Preference
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtState
op_ne
id|SK_RLMT_RS_INIT
)paren
(brace
id|SkRlmtCheckSwitch
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para.Para32
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_PREFPORT_CHANGE Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtPrefportChange */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtSetNets - SET_NETS&n; *&n; * Description:&n; *&t;This routine handles SET_NETS events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtSetNets
id|RLMT_STATIC
r_void
id|SkRlmtEvtSetNets
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NumNets; SK_U32 -1 */
(brace
r_int
id|i
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event BEGIN.&bslash;n&quot;
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ne
(paren
id|SK_U32
)paren
op_minus
l_int|1
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad Parameter.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|Para.Para32
(braket
l_int|0
)braket
OG
id|SK_MAX_NETS
op_logical_or
id|Para.Para32
(braket
l_int|0
)braket
OG
(paren
id|SK_U32
)paren
id|pAC-&gt;GIni.GIMacsFound
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad number of nets: %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|0
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
multiline_comment|/* No change. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Entering and leaving dual mode only allowed while nets are stopped. */
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NetsStarted
OG
l_int|0
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Changing dual mode only allowed while all nets are stopped.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.NumNets
OG
l_int|1
)paren
(brace
multiline_comment|/* Clear logical MAC addr from second net&squot;s active port. */
(paren
r_void
)paren
id|SkAddrOverride
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|Port
(braket
id|pAC-&gt;Addr
dot
id|Net
(braket
l_int|1
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
comma
l_int|NULL
comma
id|SK_ADDR_CLEAR_LOGICAL
)paren
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|NumPorts
op_assign
l_int|0
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.NumNets
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SK_U32
)paren
id|i
OL
id|pAC-&gt;Rlmt.NumNets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|Preference
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
multiline_comment|/* &quot;Automatic&quot; */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
op_assign
id|SK_RLMT_DEF_PREF_PORT
suffix:semicolon
multiline_comment|/* Just assuming. */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|ActivePort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtMode
op_assign
id|SK_RLMT_DEF_MODE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|TimeoutValue
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|NetNumber
op_assign
id|i
suffix:semicolon
)brace
id|pAC-&gt;Rlmt.Port
(braket
l_int|1
)braket
dot
id|Net
op_assign
op_amp
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|NumPorts
op_assign
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_SET_NETS
comma
id|Para
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;RLMT: Changed to one net with two ports.&bslash;n&quot;
)paren
)paren
)brace
r_else
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|0
)braket
op_eq
l_int|2
)paren
(brace
id|pAC-&gt;Rlmt.Port
(braket
l_int|1
)braket
dot
id|Net
op_assign
op_amp
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|NumPorts
op_assign
id|pAC-&gt;GIni.GIMacsFound
op_minus
l_int|1
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|NumPorts
op_assign
id|pAC-&gt;GIni.GIMacsFound
op_minus
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|NumPorts
suffix:semicolon
id|pAC-&gt;Rlmt.NumNets
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|SK_U32
)paren
id|i
OL
id|pAC-&gt;Rlmt.NumNets
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtState
op_assign
id|SK_RLMT_RS_INIT
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|Preference
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
multiline_comment|/* &quot;Automatic&quot; */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
op_assign
id|SK_RLMT_DEF_PREF_PORT
suffix:semicolon
multiline_comment|/* Just assuming. */
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|ActivePort
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|PrefPort
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|RlmtMode
op_assign
id|SK_RLMT_DEF_MODE
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|TimeoutValue
op_assign
id|SK_RLMT_DEF_TO_VAL
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|i
)braket
dot
id|NetNumber
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/* Set logical MAC addr on second net&squot;s active port. */
(paren
r_void
)paren
id|SkAddrOverride
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
l_int|1
)braket
dot
id|Port
(braket
id|pAC-&gt;Addr
dot
id|Net
(braket
l_int|1
)braket
dot
id|ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
comma
l_int|NULL
comma
id|SK_ADDR_SET_LOGICAL
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_PNMI
comma
id|SK_PNMI_EVT_RLMT_SET_NETS
comma
id|Para
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;RLMT: Changed to two nets with one port each.&bslash;n&quot;
)paren
)paren
)brace
r_else
(brace
multiline_comment|/* Not implemented for more than two nets. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SetNets not implemented for more than two nets.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_SET_NETS Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtSetNets */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvtModeChange - MODE_CHANGE&n; *&n; * Description:&n; *&t;This routine handles MODE_CHANGE events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkRlmtEvtModeChange
id|RLMT_STATIC
r_void
id|SkRlmtEvtModeChange
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* SK_U32 NewMode; SK_U32 NetNumber */
(brace
id|SK_EVPARA
id|Para2
suffix:semicolon
id|SK_U32
id|i
suffix:semicolon
id|SK_U32
id|PrevRlmtMode
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_MODE_CHANGE Event BEGIN.&bslash;n&quot;
)paren
)paren
r_if
c_cond
(paren
id|Para.Para32
(braket
l_int|1
)braket
op_ge
id|pAC-&gt;Rlmt.NumNets
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Bad NetNumber %d.&bslash;n&quot;
comma
id|Para.Para32
(braket
l_int|1
)braket
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_MODE_CHANGE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
id|Para.Para32
(braket
l_int|0
)braket
op_or_assign
id|SK_RLMT_CHECK_LINK
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|NumPorts
OL
l_int|2
op_logical_and
id|Para.Para32
(braket
l_int|0
)braket
op_ne
id|SK_RLMT_MODE_CLS
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_assign
id|SK_RLMT_MODE_CLS
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Forced RLMT mode to CLS on single port net.&bslash;n&quot;
)paren
)paren
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_MODE_CHANGE Event EMPTY.&bslash;n&quot;
)paren
)paren
r_return
suffix:semicolon
)brace
multiline_comment|/* Update RLMT mode. */
id|PrevRlmtMode
op_assign
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_assign
id|Para.Para32
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|PrevRlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
op_ne
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_LOC_LINK
)paren
)paren
(brace
multiline_comment|/* SK_RLMT_CHECK_LOC_LINK bit changed. */
r_if
c_cond
(paren
(paren
id|PrevRlmtMode
op_amp
id|SK_RLMT_CHECK_OTHERS
)paren
op_eq
l_int|0
op_logical_and
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|NumPorts
OG
l_int|1
op_logical_and
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|PortsUp
op_ge
l_int|1
)paren
(brace
multiline_comment|/* 20001207 RA: Was &quot;PortsUp == 1&quot;. */
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|LocTimer
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|TimeoutValue
comma
id|SKGE_RLMT
comma
id|SK_RLMT_TIM
comma
id|Para2
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|PrevRlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_ne
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
)paren
(brace
multiline_comment|/* SK_RLMT_CHECK_SEG bit changed. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|NumPorts
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
r_void
)paren
id|SkAddrMcClear
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
comma
id|SK_ADDR_PERMANENT
op_or
id|SK_MC_SW_ONLY
)paren
suffix:semicolon
multiline_comment|/* Add RLMT MC address. */
(paren
r_void
)paren
id|SkAddrMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
comma
op_amp
id|SkRlmtMcAddr
comma
id|SK_ADDR_PERMANENT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Add BPDU MC address. */
(paren
r_void
)paren
id|SkAddrMcAdd
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
comma
op_amp
id|BridgeMcAddr
comma
id|SK_ADDR_PERMANENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtState
op_ne
id|SK_RLMT_RS_INIT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|LinkDown
op_logical_and
(paren
id|Para2.pParaPtr
op_assign
id|SkRlmtBuildSpanningTreePacket
c_func
(paren
id|pAC
comma
id|IoC
comma
id|i
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|RootIdSet
op_assign
id|SK_FALSE
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_RLMT_SEND
comma
id|Para2
)paren
suffix:semicolon
)brace
)brace
)brace
(paren
r_void
)paren
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|Port
(braket
id|i
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
)brace
multiline_comment|/* for ... */
r_if
c_cond
(paren
(paren
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|RlmtMode
op_amp
id|SK_RLMT_CHECK_SEG
)paren
op_ne
l_int|0
)paren
(brace
id|Para2.Para32
(braket
l_int|0
)braket
op_assign
id|Para.Para32
(braket
l_int|1
)braket
suffix:semicolon
id|Para2.Para32
(braket
l_int|1
)braket
op_assign
(paren
id|SK_U32
)paren
op_minus
l_int|1
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|IoC
comma
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|Para.Para32
(braket
l_int|1
)braket
)braket
dot
id|SegTimer
comma
id|SK_RLMT_SEG_TO_VAL
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SEG_TIM
comma
id|Para2
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* SK_RLMT_CHECK_SEG bit changed. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;SK_RLMT_MODE_CHANGE Event END.&bslash;n&quot;
)paren
)paren
)brace
multiline_comment|/* SkRlmtEvtModeChange */
multiline_comment|/******************************************************************************&n; *&n; *&t;SkRlmtEvent - a PORT- or an RLMT-specific event happened&n; *&n; * Description:&n; *&t;This routine calls subroutines to handle PORT- and RLMT-specific events.&n; *&n; * Context:&n; *&t;runtime, pageable?&n; *&t;may be called after SK_INIT_IO&n; *&n; * Returns:&n; *&t;0&n; */
DECL|function|SkRlmtEvent
r_int
id|SkRlmtEvent
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* I/O Context */
id|SK_U32
id|Event
comma
multiline_comment|/* Event code */
id|SK_EVPARA
id|Para
)paren
multiline_comment|/* Event-specific parameter */
(brace
r_switch
c_cond
(paren
id|Event
)paren
(brace
multiline_comment|/* ----- PORT events ----- */
r_case
id|SK_RLMT_PORTSTART_TIM
suffix:colon
multiline_comment|/* From RLMT via TIME. */
id|SkRlmtEvtPortStartTim
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_LINK_UP
suffix:colon
multiline_comment|/* From SIRQ. */
id|SkRlmtEvtLinkUp
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_PORTUP_TIM
suffix:colon
multiline_comment|/* From RLMT via TIME. */
id|SkRlmtEvtPortUpTim
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_PORTDOWN
suffix:colon
multiline_comment|/* From RLMT. */
r_case
id|SK_RLMT_PORTDOWN_RX_TIM
suffix:colon
multiline_comment|/* From RLMT via TIME. */
r_case
id|SK_RLMT_PORTDOWN_TX_TIM
suffix:colon
multiline_comment|/* From RLMT via TIME. */
id|SkRlmtEvtPortDownX
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Event
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_LINK_DOWN
suffix:colon
multiline_comment|/* From SIRQ. */
id|SkRlmtEvtLinkDown
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_PORT_ADDR
suffix:colon
multiline_comment|/* From ADDR. */
id|SkRlmtEvtPortAddr
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* ----- RLMT events ----- */
r_case
id|SK_RLMT_START
suffix:colon
multiline_comment|/* From DRV. */
id|SkRlmtEvtStart
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_STOP
suffix:colon
multiline_comment|/* From DRV. */
id|SkRlmtEvtStop
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_TIM
suffix:colon
multiline_comment|/* From RLMT via TIME. */
id|SkRlmtEvtTim
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_SEG_TIM
suffix:colon
id|SkRlmtEvtSegTim
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_PACKET_RECEIVED
suffix:colon
multiline_comment|/* From DRV. */
id|SkRlmtEvtPacketRx
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_STATS_CLEAR
suffix:colon
multiline_comment|/* From PNMI. */
id|SkRlmtEvtStatsClear
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_STATS_UPDATE
suffix:colon
multiline_comment|/* From PNMI. */
id|SkRlmtEvtStatsUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_PREFPORT_CHANGE
suffix:colon
multiline_comment|/* From PNMI. */
id|SkRlmtEvtPrefportChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_MODE_CHANGE
suffix:colon
multiline_comment|/* From PNMI. */
id|SkRlmtEvtModeChange
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_RLMT_SET_NETS
suffix:colon
multiline_comment|/* From DRV. */
id|SkRlmtEvtSetNets
c_func
(paren
id|pAC
comma
id|IoC
comma
id|Para
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* ----- Unknown events ----- */
r_default
suffix:colon
multiline_comment|/* Create error log entry. */
id|SK_DBG_MSG
c_func
(paren
id|pAC
comma
id|SK_DBGMOD_RLMT
comma
id|SK_DBGCAT_CTRL
comma
(paren
l_string|&quot;Unknown RLMT Event %d.&bslash;n&quot;
comma
id|Event
)paren
)paren
id|SK_ERR_LOG
c_func
(paren
id|pAC
comma
id|SK_ERRCL_SW
comma
id|SKERR_RLMT_E003
comma
id|SKERR_RLMT_E003_MSG
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* switch() */
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkRlmtEvent */
macro_line|#ifdef __cplusplus
)brace
macro_line|#endif&t;/* __cplusplus */
eof
