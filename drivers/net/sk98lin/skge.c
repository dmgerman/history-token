multiline_comment|/******************************************************************************&n; *&n; * Name:&t;skge.c&n; * Project:&t;GEnesis, PCI Gigabit Ethernet Adapter&n; * Version:&t;$Revision: 1.42 $&n; * Date:       &t;$Date: 2003/12/12 10:05:43 $&n; * Purpose:&t;The main driver source module&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998-2002 SysKonnect GmbH.&n; *&t;(C)Copyright 2002-2003 Marvell.&n; *&n; *&t;Driver for Marvell Yukon chipset and SysKonnect Gigabit Ethernet &n; *      Server Adapters.&n; *&n; *&t;Created 10-Feb-1999, based on Linux&squot; acenic.c, 3c59x.c and&n; *&t;SysKonnects GEnesis Solaris driver&n; *&t;Author: Christoph Goos (cgoos@syskonnect.de)&n; *&t;        Mirko Lindner (mlindner@syskonnect.de)&n; *&n; *&t;Address all question to: linux@syskonnect.de&n; *&n; *&t;The technical manual for the adapters is available from SysKonnect&squot;s&n; *&t;web pages: www.syskonnect.com&n; *&t;Goto &quot;Support&quot; and search Knowledge Base for &quot;manual&quot;.&n; *&t;&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * History:&n; *&n; *&t;$Log: skge.c,v $&n; *&t;Revision 1.42  2003/12/12 10:05:43  mlindner&n; *&t;Fix: Format of error message corrected&n; *&t;&n; *&t;Revision 1.41  2003/12/11 16:03:57  mlindner&n; *&t;Fix: Create backup from pnmi data structure&n; *&t;&n; *&t;Revision 1.40  2003/12/11 12:14:48  mlindner&n; *&t;Fix: Initalize Board before network configuration&n; *&t;Fix: Change device names to driver name&n; *&t;&n; *&t;Revision 1.39  2003/12/10 08:57:38  rroesler&n; *&t;Fix: Modifications regarding try_module_get() and capable()&n; *&t;&n; *&t;Revision 1.38  2003/12/01 17:16:50  mlindner&n; *&t;Fix: Remove useless register_netdev&n; *&t;&n; *&t;Revision 1.37  2003/12/01 17:11:30  mlindner&n; *&t;Fix: Register net device before SkGeBoardInit&n; *&t;&n; *&t;Revision 1.36  2003/11/28 13:04:27  rroesler&n; *&t;Fix: do not print interface status in case DIAG is used&n; *&t;&n; *&t;Revision 1.35  2003/11/17 14:41:06  mlindner&n; *&t;Fix: Endif command&n; *&t;&n; *&t;Revision 1.34  2003/11/17 13:29:05  mlindner&n; *&t;Fix: Editorial changes&n; *&t;&n; *&t;Revision 1.33  2003/11/14 14:56:54  rroesler&n; *&t;Fix: corrected compilation warnings kernel 2.2&n; *&t;&n; *&t;Revision 1.32  2003/11/13 14:18:47  rroesler&n; *&t;Fix: added latest changes regarding the use of the proc system&n; *&t;&n; *&t;Revision 1.31  2003/11/13 09:28:35  rroesler&n; *&t;Fix: removed kernel warning &squot;driver changed get_stats after register&squot;&n; *&t;&n; *&t;Revision 1.30  2003/11/11 13:15:27  rroesler&n; *&t;Fix: use suitables kernel usage count macros when using the diag&n; *&t;&n; *&t;Revision 1.29  2003/11/10 09:38:26  rroesler&n; *&t;Fix: restore PNMI structure backup for DIAG actions&n; *&t;&n; *&t;Revision 1.28  2003/11/07 17:28:45  rroesler&n; *&t;Fix: Additions for the LeaveDiagMode&n; *&t;&n; *&t;Revision 1.27  2003/11/03 13:21:14  mlindner&n; *&t;Add: SkGeBuffPad function for padding to ensure the trailing bytes exist&n; *&t;&n; *&t;Revision 1.26  2003/10/30 09:20:40  mlindner&n; *&t;Fix: Control bit check&n; *&t;&n; *&t;Revision 1.25  2003/10/29 07:43:37  rroesler&n; *&t;Fix: Implemented full None values handling for parameter Moderation&n; *&t;&n; *&t;Revision 1.24  2003/10/22 14:18:12  rroesler&n; *&t;Fix: DIAG handling for DualNet cards&n; *&t;&n; *&t;Revision 1.23  2003/10/17 10:05:13  mlindner&n; *&t;Add: New blinkmode for Morvell cards&n; *&t;&n; *&t;Revision 1.22  2003/10/15 12:31:25  rroesler&n; *&t;Fix: Corrected bugreport #10954 (Linux System crash when using vlans)&n; *&t;&n; *&t;Revision 1.21  2003/10/07 12:32:28  mlindner&n; *&t;Fix: Editorial changes&n; *&t;&n; *&t;Revision 1.20  2003/10/07 12:22:40  mlindner&n; *&t;Fix: Compiler warnings&n; *&t;&n; *&t;Revision 1.19  2003/10/07 09:33:40  mlindner&n; *&t;Fix: No warnings for illegal values of Mod and IntsPerSec&n; *&t;Fix: Speed 100 in Half Duplex not allowed for Yukon&n; *&t;Fix: PrefPort=B not allowed on single NICs&n; *&t;&n; *&t;Revision 1.18  2003/10/07 08:17:08  mlindner&n; *&t;Fix: Copyright changes&n; *&t;&n; *&t;Revision 1.17  2003/09/29 12:06:59  mlindner&n; *&t;*** empty log message ***&n; *&t;&n; *&t;Revision 1.16  2003/09/23 11:07:35  mlindner&n; *&t;Fix: IO-control return race condition&n; *&t;Fix: Interrupt moderation value check&n; *&t;&n; *&t;Revision 1.15  2003/09/22 08:40:05  mlindner&n; *&t;Add: Added DRIVER_FILE_NAME and DRIVER_REL_DATE&n; *&t;&n; *&t;Revision 1.14  2003/09/22 08:11:10  mlindner&n; *&t;Add: New function for PCI initialization (SkGeInitPCI)&n; *&t;Add: Yukon Plus changes (ChipID, PCI...)&n; *&t;Fix: TCP and UDP Checksum calculation&n; *&t;&n; *&t;Revision 1.13  2003/09/01 13:30:08  rroesler&n; *&t;Fix: Corrected missing defines&n; *&t;&n; *&t;Revision 1.12  2003/09/01 13:12:02  rroesler&n; *&t;Add: Code for improved DIAG Attach/Detach interface&n; *&t;&n; *&t;Revision 1.11  2003/08/26 16:05:19  mlindner&n; *&t;Fix: Compiler warnings (void *)&n; *&t;&n; *&t;Revision 1.10  2003/08/25 09:24:08  mlindner&n; *&t;Add: Dynamic Interrupt Moderation (DIM) port up message&n; *&t;&n; *&t;Revision 1.9  2003/08/21 14:09:43  mlindner&n; *&t;Fix: Disable Half Duplex with Gigabit-Speed (Yukon). Enable Full Duplex.&n; *&t;&n; *&t;Revision 1.8  2003/08/19 15:09:18  mlindner&n; *&t;Fix: Ignore ConType parameter if empty value&n; *&t;&n; *&t;Revision 1.7  2003/08/13 12:00:35  mlindner&n; *&t;Fix: Removed useless defines&n; *&t;&n; *&t;Revision 1.6  2003/08/12 16:49:41  mlindner&n; *&t;Fix: UDP and TCP HW-CSum calculation (Kernel 2.5/2.6)&n; *&t;Fix: UDP and TCP Proto checks&n; *&t;Fix: Build without ProcFS&n; *&t;Fix: Kernel 2.6 editorial changes&n; *&t;&n; *&t;Revision 1.5  2003/08/07 12:25:07  mlindner&n; *&t;Fix: ConType parameter check and error detection&n; *&t;Fix: Insert various fixes applied to the kernel tree&n; *&t;&n; *&t;Revision 1.4  2003/08/07 10:50:21  mlindner&n; *&t;Add: Speed and HW-Csum support for Yukon Lite chipset&n; *&t;&n; *&t;Revision 1.3  2003/08/06 11:24:08  mlindner&n; *&t;Add: Kernel updates&n; *&t;&n; *&t;Revision 1.2  2003/07/21 08:28:47  rroesler&n; *&t;Fix: Handle padded bytes using skb_put()&n; *&t;&n; *&t;Revision 1.63  2003/07/15 09:26:23  rroesler&n; *&t;Fix: Removed memory leak when sending short padded frames&n; *&t;&n; *&t;Revision 1.62  2003/07/09 11:11:16  rroesler&n; *&t;Fix: Call of ReceiveIrq() performed with parameter SK_FALSE in&n; *&t;     order not to hang the system with multiple spinlocks&n; *&t;&n; *&t;Revision 1.61  2003/07/08 07:32:41  rroesler&n; *&t;Fix: Correct Kernel-version&n; *&t;&n; *&t;Revision 1.60  2003/07/07 15:42:30  rroesler&n; *&t;Fix: Removed function pci_present() for 2.5/2.6 kernels (deprecated)&n; *&t;Fix: Corrected warning in GetConfiguration()&n; *&t;&n; *&t;Revision 1.59  2003/07/07 09:44:32  rroesler&n; *&t;Add: HW checksumming on kernel 2.5/2.6&n; *&t;Add: padding of short frames (&lt;60 bytes) with 0x00 instead of 0xaa&n; *&t;Add: ConType parameter combining multiple other parameters into one&n; *&t;Fix: Corrected bugreport #10721 (warning when changing MTU size)&n; *&t;Fix: Removed obsolete function SetQueueSize()&n; *&t;Fix: Function ChangeMtuSize() returns new MTU size in kernel 2.5/2.6&n; *&t;&n; *&t;Revision 1.58  2003/06/17 07:14:29  mlindner&n; *&t;Add: Disable checksum functionality&n; *&t;Fix: Unload module (Kernel 2.5)&n; *&t;&n; *&t;Revision 1.57  2003/06/05 14:55:27  mlindner&n; *&t;Fix: ProcFS creation (Kernel 2.2.x)&n; *&t;Fix: ProcFS OWNER (Kernel 2.2.x)&n; *&t;&n; *&t;Revision 1.56  2003/06/03 14:34:29  mlindner&n; *&t;Add: Additions for SK_SLIM&n; *&t;Fix: SkGeIoctl SK_IOCTL_GEN&n; *&t;&n; *&t;Revision 1.55  2003/05/26 13:00:52  mlindner&n; *&t;Add: Support for Kernel 2.5/2.6&n; *&t;Add: Support for new IO-control MIB data structure&n; *&t;Add: New SkOsGetTime function&n; *&t;Fix: Race condition with broken LM80 chip&n; *&t;Fix: Race condition with padded frames&n; *&t;&n; *&t;Revision 1.54  2003/04/28 13:07:27  mlindner&n; *&t;Fix: Delay race condition with some server machines&n; *&t;&n; *&t;Revision 1.53  2003/04/28 12:49:49  mlindner&n; *&t;Fix: Code optimization&n; *&t;&n; *&t;Revision 1.52  2003/04/28 12:24:32  mlindner&n; *&t;Fix: Disabled HW Error IRQ on 32-bit Yukon if sensor IRQ occurs&n; *&t;&n; *&t;Revision 1.51  2003/04/16 08:31:14  mlindner&n; *&t;Fix: Kernel 2.2 compilation&n; *&t;&n; *&t;Revision 1.49  2003/04/10 09:08:51  mlindner&n; *&t;Add: Blink mode verification&n; *&t;Fix: Checksum calculation&n; *&t;&n; *&t;Revision 1.48  2003/03/21 14:48:38  rroesler&n; *&t;Added code for interrupt moderation&n; *&t;&n; *&t;Revision 1.47  2003/03/12 13:56:15  mlindner&n; *&t;Fix: Mac update during SK_DRV_NET_UP&n; *&t;&n; *&t;Revision 1.46  2003/02/25 14:16:36  mlindner&n; *&t;Fix: Copyright statement&n; *&t;&n; *&t;Revision 1.45  2003/02/25 13:25:55  mlindner&n; *&t;Add: Performance improvements&n; *&t;Add: Support for various vendors&n; *&t;Fix: Init function&n; *&t;&n; *&t;Revision 1.44  2003/01/09 09:25:26  mlindner&n; *&t;Fix: Remove useless init_module/cleanup_module forward declarations&n; *&t;&n; *&t;Revision 1.43  2002/11/29 08:42:41  mlindner&n; *&t;Fix: Boot message&n; *&t;&n; *&t;Revision 1.42  2002/11/28 13:30:23  mlindner&n; *&t;Add: New frame check&n; *&t;&n; *&t;Revision 1.41  2002/11/27 13:55:18  mlindner&n; *&t;Fix: Drop wrong csum packets&n; *&t;Fix: Initialize proc_entry after hw check&n; *&t;&n; *&t;Revision 1.40  2002/10/31 07:50:37  tschilli&n; *&t;Function SkGeInitAssignRamToQueues() from common module inserted.&n; *&t;Autonegotiation is set to ON for all adapters.&n; *&t;LinkSpeedUsed is used in link up status report.&n; *&t;Role parameter will show up for 1000 Mbps links only.&n; *&t;GetConfiguration() inserted after init level 1 in SkGeChangeMtu().&n; *&t;All return values of SkGeInit() and SkGeInitPort() are checked.&n; *&t;&n; *&t;Revision 1.39  2002/10/02 12:56:05  mlindner&n; *&t;Add: Support for Yukon&n; *&t;Add: Support for ZEROCOPY, scatter-gather and hw checksum&n; *&t;Add: New transmit ring function (use SG and TCP/UDP hardware checksumming)&n; *&t;Add: New init function&n; *&t;Add: Speed check and setup&n; *&t;Add: Merge source for kernel 2.2.x and 2.4.x&n; *&t;Add: Opcode check for tcp&n; *&t;Add: Frame length check&n; *&t;Fix: Transmit complete interrupt&n; *&t;Fix: Interrupt moderation&n; *&t;&n; *&t;Revision 1.29.2.13  2002/01/14 12:44:52  mlindner&n; *&t;Fix: Rlmt modes&n; *&t;&n; *&t;Revision 1.29.2.12  2001/12/07 12:06:18  mlindner&n; *&t;Fix: malloc -&gt; slab changes&n; *&t;&n; *&t;Revision 1.29.2.11  2001/12/06 15:19:20  mlindner&n; *&t;Add: DMA attributes&n; *&t;Fix: Module initialisation&n; *&t;Fix: pci_map_single and pci_unmap_single replaced&n; *&t;&n; *&t;Revision 1.29.2.10  2001/12/06 09:56:50  mlindner&n; *&t;Corrected some printk&squot;s&n; *&t;&n; *&t;Revision 1.29.2.9  2001/09/05 12:15:34  mlindner&n; *&t;Add: LBFO Changes&n; *&t;Fix: Counter Errors (Jumbo == to long errors)&n; *&t;Fix: Changed pAC-&gt;PciDev declaration&n; *&t;Fix: too short counters&n; *&t;&n; *&t;Revision 1.29.2.8  2001/06/25 12:10:44  mlindner&n; *&t;fix: ReceiveIrq() changed.&n; *&t;&n; *&t;Revision 1.29.2.7  2001/06/25 08:07:05  mlindner&n; *&t;fix: RLMT locking in ReceiveIrq() changed.&n; *&t;&n; *&t;Revision 1.29.2.6  2001/05/21 07:59:29  mlindner&n; *&t;fix: MTU init problems&n; *&t;&n; *&t;Revision 1.29.2.5  2001/05/08 11:25:08  mlindner&n; *&t;fix: removed VLAN error message&n; *&t;&n; *&t;Revision 1.29.2.4  2001/05/04 13:31:43  gklug&n; *&t;fix: do not handle eth_copy on bad fragments received.&n; *&t;&n; *&t;Revision 1.29.2.3  2001/04/23 08:06:43  mlindner&n; *&t;Fix: error handling&n; *&t;&n; *&t;Revision 1.29.2.2  2001/03/15 12:04:54  mlindner&n; *&t;Fixed memory problem&n; *&t;&n; *&t;Revision 1.29.2.1  2001/03/12 16:41:44  mlindner&n; *&t;add: procfs function&n; *&t;add: dual-net function&n; *&t;add: RLMT networks&n; *&t;add: extended PNMI features&n; *&t;&n; *&t;Kernel 2.4.x specific:&n; *&t;Revision 1.xx  2000/09/12 13:31:56  cgoos&n; *&t;Fixed missign &quot;dev=NULL in skge_probe.&n; *&t;Added counting for jumbo frames (corrects error statistic).&n; *&t;Removed VLAN tag check (enables VLAN support).&n; *&t;&n; *&t;Kernel 2.2.x specific:&n; *&t;Revision 1.29  2000/02/21 13:31:56  cgoos&n; *&t;Fixed &quot;unused&quot; warning for UltraSPARC change.&n; *&t;&n; *&t;Partially kernel 2.2.x specific:&n; *&t;Revision 1.28  2000/02/21 10:32:36  cgoos&n; *&t;Added fixes for UltraSPARC.&n; *&t;Now printing RlmtMode and PrefPort setting at startup.&n; *&t;Changed XmitFrame return value.&n; *&t;Fixed rx checksum calculation for BIG ENDIAN systems.&n; *&t;Fixed rx jumbo frames counted as ierrors.&n; *&t;&n; *&t;&n; *&t;Revision 1.27  1999/11/25 09:06:28  cgoos&n; *&t;Changed base_addr to unsigned long.&n; *&t;&n; *&t;Revision 1.26  1999/11/22 13:29:16  cgoos&n; *&t;Changed license header to GPL.&n; *&t;Changes for inclusion in linux kernel (2.2.13).&n; *&t;Removed 2.0.x defines.&n; *&t;Changed SkGeProbe to skge_probe.&n; *&t;Added checks in SkGeIoctl.&n; *&t;&n; *&t;Revision 1.25  1999/10/07 14:47:52  cgoos&n; *&t;Changed 984x to 98xx.&n; *&t;&n; *&t;Revision 1.24  1999/09/30 07:21:01  cgoos&n; *&t;Removed SK_RLMT_SLOW_LOOKAHEAD option.&n; *&t;Giving spanning tree packets also to OS now.&n; *&t;&n; *&t;Revision 1.23  1999/09/29 07:36:50  cgoos&n; *&t;Changed assignment for IsBc/IsMc.&n; *&t;&n; *&t;Revision 1.22  1999/09/28 12:57:09  cgoos&n; *&t;Added CheckQueue also to Single-Port-ISR.&n; *&t;&n; *&t;Revision 1.21  1999/09/28 12:42:41  cgoos&n; *&t;Changed parameter strings for RlmtMode.&n; *&t;&n; *&t;Revision 1.20  1999/09/28 12:37:57  cgoos&n; *&t;Added CheckQueue for fast delivery of RLMT frames.&n; *&t;&n; *&t;Revision 1.19  1999/09/16 07:57:25  cgoos&n; *&t;Copperfield changes.&n; *&t;&n; *&t;Revision 1.18  1999/09/03 13:06:30  cgoos&n; *&t;Fixed RlmtMode=CheckSeg bug: wrong DEV_KFREE_SKB in RLMT_SEND caused&n; *&t;double allocated skb&squot;s.&n; *&t;FrameStat in ReceiveIrq was accessed via wrong Rxd.&n; *&t;Queue size for async. standby Tx queue was zero.&n; *&t;FillRxLimit of 0 could cause problems with ReQueue, changed to 1.&n; *&t;Removed debug output of checksum statistic.&n; *&t;&n; *&t;Revision 1.17  1999/08/11 13:55:27  cgoos&n; *&t;Transmit descriptor polling was not reenabled after SkGePortInit.&n; *&t;&n; *&t;Revision 1.16  1999/07/27 15:17:29  cgoos&n; *&t;Added some &quot;&bslash;n&quot; in output strings (removed while debuging...).&n; *&t;&n; *&t;Revision 1.15  1999/07/23 12:09:30  cgoos&n; *&t;Performance optimization, rx checksumming, large frame support.&n; *&t;&n; *&t;Revision 1.14  1999/07/14 11:26:27  cgoos&n; *&t;Removed Link LED settings (now in RLMT).&n; *&t;Added status output at NET UP.&n; *&t;Fixed SMP problems with Tx and SWITCH running in parallel.&n; *&t;Fixed return code problem at RLMT_SEND event.&n; *&t;&n; *&t;Revision 1.13  1999/04/07 10:11:42  cgoos&n; *&t;Fixed Single Port problems.&n; *&t;Fixed Multi-Adapter problems.&n; *&t;Always display startup string.&n; *&t;&n; *&t;Revision 1.12  1999/03/29 12:26:37  cgoos&n; *&t;Reversed locking to fine granularity.&n; *&t;Fixed skb double alloc problem (caused by incorrect xmit return code).&n; *&t;Enhanced function descriptions.&n; *&t;&n; *&t;Revision 1.11  1999/03/15 13:10:51  cgoos&n; *&t;Changed device identifier in output string to ethX.&n; *&t;&n; *&t;Revision 1.10  1999/03/15 12:12:34  cgoos&n; *&t;Changed copyright notice.&n; *&t;&n; *&t;Revision 1.9  1999/03/15 12:10:17  cgoos&n; *&t;Changed locking to one driver lock.&n; *&t;Added check of SK_AC-size (for consistency with library).&n; *&t;&n; *&t;Revision 1.8  1999/03/08 11:44:02  cgoos&n; *&t;Fixed missing dev-&gt;tbusy in SkGeXmit.&n; *&t;Changed large frame (jumbo) buffer number.&n; *&t;Added copying of short frames.&n; *&t;&n; *&t;Revision 1.7  1999/03/04 13:26:57  cgoos&n; *&t;Fixed spinlock calls for SMP.&n; *&t;&n; *&t;Revision 1.6  1999/03/02 09:53:51  cgoos&n; *&t;Added descriptor revertion for big endian machines.&n; *&t;&n; *&t;Revision 1.5  1999/03/01 08:50:59  cgoos&n; *&t;Fixed SkGeChangeMtu.&n; *&t;Fixed pci config space accesses.&n; *&t;&n; *&t;Revision 1.4  1999/02/18 15:48:44  cgoos&n; *&t;Corrected some printk&squot;s.&n; *&t;&n; *&t;Revision 1.3  1999/02/18 12:45:55  cgoos&n; *&t;Changed SK_MAX_CARD_PARAM to default 16&n; *&t;&n; *&t;Revision 1.2  1999/02/18 10:55:32  cgoos&n; *&t;Removed SkGeDrvTimeStamp function.&n; *&t;Printing &quot;ethX:&quot; before adapter type at adapter init.&n; *&t;&n; *&n; *&t;10-Feb-1999 cg&t;Created, based on Linux&squot; acenic.c, 3c59x.c and&n; *&t;&t;&t;SysKonnects GEnesis Solaris driver&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * Possible compiler options (#define xxx / -Dxxx):&n; *&n; *&t;debugging can be enable by changing SK_DEBUG_CHKMOD and&n; *&t;SK_DEBUG_CHKCAT in makefile (described there).&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * Description:&n; *&n; *&t;This is the main module of the Linux GE driver.&n; *&t;&n; *&t;All source files except skge.c, skdrv1st.h, skdrv2nd.h and sktypes.h&n; *&t;are part of SysKonnect&squot;s COMMON MODULES for the SK-98xx adapters.&n; *&t;Those are used for drivers on multiple OS&squot;, so some thing may seem&n; *&t;unnecessary complicated on Linux. Please do not try to &squot;clean up&squot;&n; *&t;them without VERY good reasons, because this will make it more&n; *&t;difficult to keep the Linux driver in synchronisation with the&n; *&t;other versions.&n; *&n; * Include file hierarchy:&n; *&n; *&t;&lt;linux/module.h&gt;&n; *&n; *&t;&quot;h/skdrv1st.h&quot;&n; *&t;&t;&lt;linux/types.h&gt;&n; *&t;&t;&lt;linux/kernel.h&gt;&n; *&t;&t;&lt;linux/string.h&gt;&n; *&t;&t;&lt;linux/errno.h&gt;&n; *&t;&t;&lt;linux/ioport.h&gt;&n; *&t;&t;&lt;linux/slab.h&gt;&n; *&t;&t;&lt;linux/interrupt.h&gt;&n; *&t;&t;&lt;linux/pci.h&gt;&n; *&t;&t;&lt;asm/byteorder.h&gt;&n; *&t;&t;&lt;asm/bitops.h&gt;&n; *&t;&t;&lt;asm/io.h&gt;&n; *&t;&t;&lt;linux/netdevice.h&gt;&n; *&t;&t;&lt;linux/etherdevice.h&gt;&n; *&t;&t;&lt;linux/skbuff.h&gt;&n; *&t;    those three depending on kernel version used:&n; *&t;&t;&lt;linux/bios32.h&gt;&n; *&t;&t;&lt;linux/init.h&gt;&n; *&t;&t;&lt;asm/uaccess.h&gt;&n; *&t;&t;&lt;net/checksum.h&gt;&n; *&n; *&t;&t;&quot;h/skerror.h&quot;&n; *&t;&t;&quot;h/skdebug.h&quot;&n; *&t;&t;&quot;h/sktypes.h&quot;&n; *&t;&t;&quot;h/lm80.h&quot;&n; *&t;&t;&quot;h/xmac_ii.h&quot;&n; *&n; *      &quot;h/skdrv2nd.h&quot;&n; *&t;&t;&quot;h/skqueue.h&quot;&n; *&t;&t;&quot;h/skgehwt.h&quot;&n; *&t;&t;&quot;h/sktimer.h&quot;&n; *&t;&t;&quot;h/ski2c.h&quot;&n; *&t;&t;&quot;h/skgepnmi.h&quot;&n; *&t;&t;&quot;h/skvpd.h&quot;&n; *&t;&t;&quot;h/skgehw.h&quot;&n; *&t;&t;&quot;h/skgeinit.h&quot;&n; *&t;&t;&quot;h/skaddr.h&quot;&n; *&t;&t;&quot;h/skgesirq.h&quot;&n; *&t;&t;&quot;h/skcsum.h&quot;&n; *&t;&t;&quot;h/skrlmt.h&quot;&n; *&n; ******************************************************************************/
macro_line|#include&t;&quot;h/skversion.h&quot;
macro_line|#include&t;&lt;linux/module.h&gt;
macro_line|#include&t;&lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#include &t;&lt;linux/proc_fs.h&gt;
macro_line|#endif
macro_line|#include&t;&quot;h/skdrv1st.h&quot;
macro_line|#include&t;&quot;h/skdrv2nd.h&quot;
multiline_comment|/*******************************************************************************&n; *&n; * Defines&n; *&n; ******************************************************************************/
multiline_comment|/* for debuging on x86 only */
multiline_comment|/* #define BREAKPOINT() asm(&quot; int $3&quot;); */
multiline_comment|/* use the transmit hw checksum driver functionality */
DECL|macro|USE_SK_TX_CHECKSUM
mdefine_line|#define USE_SK_TX_CHECKSUM
multiline_comment|/* use the receive hw checksum driver functionality */
DECL|macro|USE_SK_RX_CHECKSUM
mdefine_line|#define USE_SK_RX_CHECKSUM
multiline_comment|/* use the scatter-gather functionality with sendfile() */
DECL|macro|SK_ZEROCOPY
mdefine_line|#define SK_ZEROCOPY
multiline_comment|/* use of a transmit complete interrupt */
DECL|macro|USE_TX_COMPLETE
mdefine_line|#define USE_TX_COMPLETE
multiline_comment|/*&n; * threshold for copying small receive frames&n; * set to 0 to avoid copying, set to 9001 to copy all frames&n; */
DECL|macro|SK_COPY_THRESHOLD
mdefine_line|#define SK_COPY_THRESHOLD&t;50
multiline_comment|/* number of adapters that can be configured via command line params */
DECL|macro|SK_MAX_CARD_PARAM
mdefine_line|#define SK_MAX_CARD_PARAM&t;16
multiline_comment|/*&n; * use those defines for a compile-in version of the driver instead&n; * of command line parameters&n; */
singleline_comment|// #define LINK_SPEED_A&t;{&quot;Auto&quot;, }
singleline_comment|// #define LINK_SPEED_B&t;{&quot;Auto&quot;, }
singleline_comment|// #define AUTO_NEG_A&t;{&quot;Sense&quot;, }
singleline_comment|// #define AUTO_NEG_B&t;{&quot;Sense&quot;, }
singleline_comment|// #define DUP_CAP_A&t;{&quot;Both&quot;, }
singleline_comment|// #define DUP_CAP_B&t;{&quot;Both&quot;, }
singleline_comment|// #define FLOW_CTRL_A&t;{&quot;SymOrRem&quot;, }
singleline_comment|// #define FLOW_CTRL_B&t;{&quot;SymOrRem&quot;, }
singleline_comment|// #define ROLE_A&t;{&quot;Auto&quot;, }
singleline_comment|// #define ROLE_B&t;{&quot;Auto&quot;, }
singleline_comment|// #define PREF_PORT&t;{&quot;A&quot;, }
singleline_comment|// #define CON_TYPE &t;{&quot;Auto&quot;, }
singleline_comment|// #define RLMT_MODE&t;{&quot;CheckLinkState&quot;, }
DECL|macro|DEV_KFREE_SKB
mdefine_line|#define DEV_KFREE_SKB(skb) dev_kfree_skb(skb)
DECL|macro|DEV_KFREE_SKB_IRQ
mdefine_line|#define DEV_KFREE_SKB_IRQ(skb) dev_kfree_skb_irq(skb)
DECL|macro|DEV_KFREE_SKB_ANY
mdefine_line|#define DEV_KFREE_SKB_ANY(skb) dev_kfree_skb_any(skb)
multiline_comment|/* Set blink mode*/
DECL|macro|OEM_CONFIG_VALUE
mdefine_line|#define OEM_CONFIG_VALUE (&t;SK_ACT_LED_BLINK | &bslash;&n;&t;&t;&t;&t;SK_DUP_LED_NORMAL | &bslash;&n;&t;&t;&t;&t;SK_LED_LINK100_ON)
multiline_comment|/* Isr return value */
DECL|macro|SkIsrRetVar
mdefine_line|#define SkIsrRetVar&t;irqreturn_t
DECL|macro|SkIsrRetNone
mdefine_line|#define SkIsrRetNone&t;IRQ_NONE
DECL|macro|SkIsrRetHandled
mdefine_line|#define SkIsrRetHandled&t;IRQ_HANDLED
multiline_comment|/*******************************************************************************&n; *&n; * Local Function Prototypes&n; *&n; ******************************************************************************/
r_static
r_void
id|FreeResources
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SkGeBoardInit
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
id|SK_BOOL
id|BoardAllocMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_void
id|BoardFreeMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_void
id|BoardInitMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_void
id|SetupRing
c_func
(paren
id|SK_AC
op_star
comma
r_void
op_star
comma
r_uintptr
comma
id|RXD
op_star
op_star
comma
id|RXD
op_star
op_star
comma
id|RXD
op_star
op_star
comma
r_int
op_star
comma
id|SK_BOOL
)paren
suffix:semicolon
r_static
id|SkIsrRetVar
id|SkGeIsr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
suffix:semicolon
r_static
id|SkIsrRetVar
id|SkGeIsrOnePort
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
suffix:semicolon
r_static
r_int
id|SkGeOpen
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SkGeClose
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SkGeXmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SkGeSetMacAddr
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_void
op_star
id|p
)paren
suffix:semicolon
r_static
r_void
id|SkGeSetRxMode
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|SkGeStats
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|SkGeIoctl
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|GetConfiguration
c_func
(paren
id|SK_AC
op_star
)paren
suffix:semicolon
r_static
r_void
id|ProductStr
c_func
(paren
id|SK_AC
op_star
)paren
suffix:semicolon
r_static
r_int
id|XmitFrame
c_func
(paren
id|SK_AC
op_star
comma
id|TX_PORT
op_star
comma
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|FreeTxDescriptors
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
id|TX_PORT
op_star
)paren
suffix:semicolon
r_static
r_void
id|FillRxRing
c_func
(paren
id|SK_AC
op_star
comma
id|RX_PORT
op_star
)paren
suffix:semicolon
r_static
id|SK_BOOL
id|FillRxDescriptor
c_func
(paren
id|SK_AC
op_star
comma
id|RX_PORT
op_star
)paren
suffix:semicolon
r_static
r_void
id|ReceiveIrq
c_func
(paren
id|SK_AC
op_star
comma
id|RX_PORT
op_star
comma
id|SK_BOOL
)paren
suffix:semicolon
r_static
r_void
id|ClearAndStartRx
c_func
(paren
id|SK_AC
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ClearTxIrq
c_func
(paren
id|SK_AC
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|ClearRxRing
c_func
(paren
id|SK_AC
op_star
comma
id|RX_PORT
op_star
)paren
suffix:semicolon
r_static
r_void
id|ClearTxRing
c_func
(paren
id|SK_AC
op_star
comma
id|TX_PORT
op_star
)paren
suffix:semicolon
r_static
r_int
id|SkGeChangeMtu
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_int
id|new_mtu
)paren
suffix:semicolon
r_static
r_void
id|PortReInitBmu
c_func
(paren
id|SK_AC
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|SkGeIocMib
c_func
(paren
id|DEV_NET
op_star
comma
r_int
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|SkGeInitPCI
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_void
id|StartDrvCleanupTimer
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_void
id|StopDrvCleanupTimer
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_static
r_int
id|XmitFrameSG
c_func
(paren
id|SK_AC
op_star
comma
id|TX_PORT
op_star
comma
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
r_static
id|SK_U32
id|ParseDeviceNbrFromSlotName
c_func
(paren
r_const
r_char
op_star
id|SlotName
)paren
suffix:semicolon
r_static
r_int
id|SkDrvInitAdapter
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
r_int
id|devNbr
)paren
suffix:semicolon
r_static
r_int
id|SkDrvDeInitAdapter
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
r_int
id|devNbr
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*******************************************************************************&n; *&n; * Extern Function Prototypes&n; *&n; ******************************************************************************/
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|SK_Root_Dir_entry
r_static
r_const
r_char
id|SK_Root_Dir_entry
(braket
)braket
op_assign
l_string|&quot;sk98lin&quot;
suffix:semicolon
DECL|variable|pSkRootDir
r_static
r_struct
id|proc_dir_entry
op_star
id|pSkRootDir
op_assign
l_int|NULL
suffix:semicolon
r_extern
r_struct
id|file_operations
id|sk_proc_fops
suffix:semicolon
macro_line|#endif
r_extern
r_void
id|SkDimEnableModerationIfNeeded
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_extern
r_void
id|SkDimDisplayModerationSettings
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_extern
r_void
id|SkDimStartModerationTimer
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
r_extern
r_void
id|SkDimModerate
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_static
r_void
id|DumpMsg
c_func
(paren
r_struct
id|sk_buff
op_star
comma
r_char
op_star
)paren
suffix:semicolon
r_static
r_void
id|DumpData
c_func
(paren
r_char
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|DumpLong
c_func
(paren
r_char
op_star
comma
r_int
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* global variables *********************************************************/
DECL|variable|BootString
r_static
r_const
r_char
op_star
id|BootString
op_assign
id|BOOT_STRING
suffix:semicolon
DECL|variable|SkGeRootDev
r_struct
id|SK_NET_DEVICE
op_star
id|SkGeRootDev
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|__initdata
r_static
r_int
id|probed
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|DoPrintInterfaceChange
r_static
id|SK_BOOL
id|DoPrintInterfaceChange
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/* local variables **********************************************************/
DECL|variable|TxQueueAddr
r_static
r_uintptr
id|TxQueueAddr
(braket
id|SK_MAX_MACS
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
l_int|0x680
comma
l_int|0x600
)brace
comma
(brace
l_int|0x780
comma
l_int|0x700
)brace
)brace
suffix:semicolon
DECL|variable|RxQueueAddr
r_static
r_uintptr
id|RxQueueAddr
(braket
id|SK_MAX_MACS
)braket
op_assign
(brace
l_int|0x400
comma
l_int|0x480
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|pSkRootDir
r_static
r_struct
id|proc_dir_entry
op_star
id|pSkRootDir
suffix:semicolon
macro_line|#endif
multiline_comment|/*****************************************************************************&n; *&n; * &t;skge_probe - find all SK-98xx adapters&n; *&n; * Description:&n; *&t;This function scans the PCI bus for SK-98xx adapters. Resources for&n; *&t;each adapter are allocated and the adapter is brought into Init 1&n; *&t;state.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|skge_probe
r_static
r_int
id|__init
id|skge_probe
(paren
r_void
)paren
(brace
r_int
id|boards_found
op_assign
l_int|0
suffix:semicolon
r_int
id|vendor_flag
op_assign
id|SK_FALSE
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
id|DEV_NET
op_star
id|pNet
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|SK_NET_DEVICE
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|SK_BOOL
id|DeviceFound
op_assign
id|SK_FALSE
suffix:semicolon
id|SK_BOOL
id|BootStringCount
op_assign
id|SK_FALSE
suffix:semicolon
r_int
id|retval
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_int
id|proc_root_initialized
op_assign
l_int|0
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|pProcFile
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|probed
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|probed
op_increment
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_class
c_func
(paren
id|PCI_CLASS_NETWORK_ETHERNET
op_lshift
l_int|8
comma
id|pdev
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|pNet
op_assign
l_int|NULL
suffix:semicolon
id|SK_PCI_ISCOMPLIANT
c_func
(paren
id|vendor_flag
comma
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vendor_flag
)paren
r_continue
suffix:semicolon
multiline_comment|/* Configure DMA attributes. */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
(paren
id|u64
)paren
l_int|0xffffffffffffffffULL
)paren
op_logical_and
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
(paren
id|u64
)paren
l_int|0xffffffff
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
id|DEV_NET
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate etherdev &quot;
l_string|&quot;structure!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pNet
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pNet-&gt;pAC
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|SK_AC
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pNet-&gt;pAC
op_eq
l_int|NULL
)paren
(brace
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate adapter &quot;
l_string|&quot;structure!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Print message */
r_if
c_cond
(paren
op_logical_neg
id|BootStringCount
)paren
(brace
multiline_comment|/* set display flag to TRUE so that */
multiline_comment|/* we only display this string ONCE */
id|BootStringCount
op_assign
id|SK_TRUE
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|BootString
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pNet-&gt;pAC
comma
l_int|0
comma
r_sizeof
(paren
id|SK_AC
)paren
)paren
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|pAC-&gt;PciDev
op_assign
id|pdev
suffix:semicolon
id|pAC-&gt;PciDevId
op_assign
id|pdev-&gt;device
suffix:semicolon
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_assign
id|dev
suffix:semicolon
id|pAC-&gt;dev
(braket
l_int|1
)braket
op_assign
id|dev
suffix:semicolon
id|sprintf
c_func
(paren
id|pAC-&gt;Name
comma
l_string|&quot;SysKonnect SK-98xx&quot;
)paren
suffix:semicolon
id|pAC-&gt;CheckQueue
op_assign
id|SK_FALSE
suffix:semicolon
id|pNet-&gt;Mtu
op_assign
l_int|1500
suffix:semicolon
id|pNet-&gt;Up
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|retval
op_assign
id|SkGeInitPCI
c_func
(paren
id|pAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SKGE: PCI setup failed: %i&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
op_amp
id|SkGeOpen
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|SkGeClose
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|SkGeXmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|SkGeStats
suffix:semicolon
id|dev-&gt;last_stats
op_assign
op_amp
id|SkGeStats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|SkGeSetRxMode
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|SkGeSetMacAddr
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|SkGeIoctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
op_amp
id|SkGeChangeMtu
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
macro_line|#ifdef SK_ZEROCOPY
macro_line|#ifdef USE_SK_TX_CHECKSUM
r_if
c_cond
(paren
id|pAC-&gt;ChipsetType
)paren
(brace
multiline_comment|/* Use only if yukon hardware */
multiline_comment|/* SK and ZEROCOPY - fly baby... */
id|dev-&gt;features
op_or_assign
id|NETIF_F_SG
op_or
id|NETIF_F_IP_CSUM
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
id|pAC-&gt;Index
op_assign
id|boards_found
suffix:semicolon
r_if
c_cond
(paren
id|SkGeBoardInit
c_func
(paren
id|dev
comma
id|pAC
)paren
)paren
(brace
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* Register net device */
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SKGE: Could not register device.&bslash;n&quot;
)paren
suffix:semicolon
id|FreeResources
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* Print adapter specific string from vpd */
id|ProductStr
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pAC-&gt;DeviceStr
)paren
suffix:semicolon
multiline_comment|/* Print configuration settings */
id|printk
c_func
(paren
l_string|&quot;      PrefPort:%c  RlmtMode:%s&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Port
(braket
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
)braket
op_member_access_from_pointer
id|PortNumber
comma
(paren
id|pAC-&gt;RlmtMode
op_eq
l_int|0
)paren
ques
c_cond
l_string|&quot;Check Link State&quot;
suffix:colon
(paren
(paren
id|pAC-&gt;RlmtMode
op_eq
l_int|1
)paren
ques
c_cond
l_string|&quot;Check Link State&quot;
suffix:colon
(paren
(paren
id|pAC-&gt;RlmtMode
op_eq
l_int|3
)paren
ques
c_cond
l_string|&quot;Check Local Port&quot;
suffix:colon
(paren
(paren
id|pAC-&gt;RlmtMode
op_eq
l_int|7
)paren
ques
c_cond
l_string|&quot;Check Segmentation&quot;
suffix:colon
(paren
(paren
id|pAC-&gt;RlmtMode
op_eq
l_int|17
)paren
ques
c_cond
l_string|&quot;Dual Check Link State&quot;
suffix:colon
l_string|&quot;Error&quot;
)paren
)paren
)paren
)paren
)paren
suffix:semicolon
id|SkGeYellowLED
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|dev-&gt;dev_addr
comma
(paren
id|caddr_t
)paren
op_amp
id|pAC-&gt;Addr.Net
(braket
l_int|0
)braket
dot
id|CurrentMacAddress
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* First adapter... Create proc and print message */
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
op_logical_neg
id|DeviceFound
)paren
(brace
id|DeviceFound
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_MEMCPY
c_func
(paren
op_amp
id|SK_Root_Dir_entry
comma
id|BootString
comma
r_sizeof
(paren
id|SK_Root_Dir_entry
)paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/*Create proc (directory)*/
r_if
c_cond
(paren
op_logical_neg
id|pSkRootDir
)paren
(brace
id|pSkRootDir
op_assign
id|proc_mkdir
c_func
(paren
id|SK_Root_Dir_entry
comma
id|proc_net
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pSkRootDir
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to create /proc/net/%s&quot;
comma
id|dev-&gt;name
comma
id|SK_Root_Dir_entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|pSkRootDir-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Create proc file */
r_if
c_cond
(paren
id|pSkRootDir
op_logical_and
(paren
id|pProcFile
op_assign
id|create_proc_entry
c_func
(paren
id|dev-&gt;name
comma
id|S_IRUGO
comma
id|pSkRootDir
)paren
)paren
)paren
(brace
id|pProcFile-&gt;proc_fops
op_assign
op_amp
id|sk_proc_fops
suffix:semicolon
id|pProcFile-&gt;data
op_assign
id|dev
suffix:semicolon
)brace
macro_line|#endif
id|pNet-&gt;PortNr
op_assign
l_int|0
suffix:semicolon
id|pNet-&gt;NetNr
op_assign
l_int|0
suffix:semicolon
id|boards_found
op_increment
suffix:semicolon
multiline_comment|/* More then one port found */
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
id|DEV_NET
)paren
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to allocate etherdev &quot;
l_string|&quot;structure!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pAC-&gt;dev
(braket
l_int|1
)braket
op_assign
id|dev
suffix:semicolon
id|pNet
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pNet-&gt;PortNr
op_assign
l_int|1
suffix:semicolon
id|pNet-&gt;NetNr
op_assign
l_int|1
suffix:semicolon
id|pNet-&gt;pAC
op_assign
id|pAC
suffix:semicolon
id|pNet-&gt;Mtu
op_assign
l_int|1500
suffix:semicolon
id|pNet-&gt;Up
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;open
op_assign
op_amp
id|SkGeOpen
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|SkGeClose
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|SkGeXmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|SkGeStats
suffix:semicolon
id|dev-&gt;last_stats
op_assign
op_amp
id|SkGeStats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|SkGeSetRxMode
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|SkGeSetMacAddr
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|SkGeIoctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
op_amp
id|SkGeChangeMtu
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
macro_line|#ifdef SK_ZEROCOPY
macro_line|#ifdef USE_SK_TX_CHECKSUM
r_if
c_cond
(paren
id|pAC-&gt;ChipsetType
)paren
(brace
multiline_comment|/* SG and ZEROCOPY - fly baby... */
id|dev-&gt;features
op_or_assign
id|NETIF_F_SG
op_or
id|NETIF_F_IP_CSUM
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SKGE: Could not register device.&bslash;n&quot;
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pAC-&gt;dev
(braket
l_int|1
)braket
op_assign
id|pAC-&gt;dev
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef CONFIG_PROC_FS
r_if
c_cond
(paren
id|pSkRootDir
op_logical_and
(paren
id|pProcFile
op_assign
id|create_proc_entry
c_func
(paren
id|dev-&gt;name
comma
id|S_IRUGO
comma
id|pSkRootDir
)paren
)paren
)paren
(brace
id|pProcFile-&gt;proc_fops
op_assign
op_amp
id|sk_proc_fops
suffix:semicolon
id|pProcFile-&gt;data
op_assign
id|dev
suffix:semicolon
)brace
macro_line|#endif
id|memcpy
c_func
(paren
(paren
id|caddr_t
)paren
op_amp
id|dev-&gt;dev_addr
comma
(paren
id|caddr_t
)paren
op_amp
id|pAC-&gt;Addr.Net
(braket
l_int|1
)braket
dot
id|CurrentMacAddress
comma
l_int|6
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pAC-&gt;DeviceStr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;      PrefPort:B  RlmtMode:Dual Check Link State&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Save the hardware revision */
id|pAC-&gt;HWRevision
op_assign
(paren
(paren
(paren
id|pAC-&gt;GIni.GIPciHwRev
op_rshift
l_int|4
)paren
op_amp
l_int|0x0F
)paren
op_star
l_int|10
)paren
op_plus
(paren
id|pAC-&gt;GIni.GIPciHwRev
op_amp
l_int|0x0F
)paren
suffix:semicolon
multiline_comment|/* Set driver globals */
id|pAC-&gt;Pnmi.pDriverFileName
op_assign
id|DRIVER_FILE_NAME
suffix:semicolon
id|pAC-&gt;Pnmi.pDriverReleaseDate
op_assign
id|DRIVER_REL_DATE
suffix:semicolon
id|SK_MEMSET
c_func
(paren
op_amp
(paren
id|pAC-&gt;PnmiBackup
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|SK_MEMCPY
c_func
(paren
op_amp
(paren
id|pAC-&gt;PnmiBackup
)paren
comma
op_amp
(paren
id|pAC-&gt;PnmiStruct
)paren
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * This is bollocks, but we need to tell the net-init&n;&t;&t; * code that it shall go for the next device.&n;&t;&t; */
macro_line|#ifndef MODULE
id|dev-&gt;base_addr
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&t; * If we&squot;re at this point we&squot;re going through skge_probe() for&n;&t; * the first time.  Return success (0) if we&squot;ve initialized 1&n;&t; * or more boards. Otherwise, return failure (-ENODEV).&n;&t; */
r_return
id|boards_found
suffix:semicolon
)brace
multiline_comment|/* skge_probe */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeInitPCI - Init the PCI resources&n; *&n; * Description:&n; *&t;This function initialize the PCI resources and IO&n; *&n; * Returns: N/A&n; *&t;&n; */
DECL|function|SkGeInitPCI
r_int
id|SkGeInitPCI
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
r_struct
id|SK_NET_DEVICE
op_star
id|dev
op_assign
id|pAC-&gt;dev
(braket
l_int|0
)braket
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|pAC-&gt;PciDev
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
op_ne
l_int|0
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|dev-&gt;mem_start
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|pAC-&gt;Name
)paren
op_ne
l_int|0
)paren
(brace
id|retval
op_assign
l_int|2
suffix:semicolon
r_goto
id|out_disable
suffix:semicolon
)brace
macro_line|#ifdef SK_BIG_ENDIAN
multiline_comment|/*&n;&t; * On big endian machines, we use the adapter&squot;s aibility of&n;&t; * reading the descriptors as big endian.&n;&t; */
(brace
id|SK_U32
id|our2
suffix:semicolon
id|SkPciReadCfgDWord
c_func
(paren
id|pAC
comma
id|PCI_OUR_REG_2
comma
op_amp
id|our2
)paren
suffix:semicolon
id|our2
op_or_assign
id|PCI_REV_DESC
suffix:semicolon
id|SkPciWriteCfgDWord
c_func
(paren
id|pAC
comma
id|PCI_OUR_REG_2
comma
id|our2
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * Remap the regs into kernel space.&n;&t; */
id|pAC-&gt;IoBase
op_assign
(paren
r_char
op_star
)paren
id|ioremap_nocache
c_func
(paren
id|dev-&gt;mem_start
comma
l_int|0x4000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pAC-&gt;IoBase
)paren
(brace
id|retval
op_assign
l_int|3
suffix:semicolon
r_goto
id|out_release
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|out_release
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * &t;FreeResources - release resources allocated for adapter&n; *&n; * Description:&n; *&t;This function releases the IRQ, unmaps the IO and&n; *&t;frees the desriptor ring.&n; *&n; * Returns: N/A&n; *&t;&n; */
DECL|function|FreeResources
r_static
r_void
id|FreeResources
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|SK_U32
id|AllocFlag
suffix:semicolon
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
)paren
(brace
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|AllocFlag
op_assign
id|pAC-&gt;AllocFlag
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;PciDev
)paren
(brace
id|pci_release_regions
c_func
(paren
id|pAC-&gt;PciDev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AllocFlag
op_amp
id|SK_ALLOC_IRQ
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;IoBase
)paren
(brace
id|iounmap
c_func
(paren
id|pAC-&gt;IoBase
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;pDescrMem
)paren
(brace
id|BoardFreeMem
c_func
(paren
id|pAC
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* FreeResources */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Mirko Lindner &lt;mlindner@syskonnect.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SysKonnect SK-NET Gigabit Ethernet SK-98xx driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Speed_A
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Speed_B
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|AutoNeg_A
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|AutoNeg_B
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|DupCap_A
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|DupCap_B
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|FlowCtrl_A
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|FlowCtrl_B
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Role_A
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Role_B
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ConType
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|PrefPort
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|RlmtMode
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
multiline_comment|/* not used, just there because every driver should have them: */
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* used for interrupt moderation */
id|MODULE_PARM
c_func
(paren
id|IntsPerSec
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Moderation
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|Stats
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ModerationMask
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|AutoSizing
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SK_MAX_CARD_PARAM
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
macro_line|#ifdef LINK_SPEED_A
DECL|variable|Speed_A
r_static
r_char
op_star
id|Speed_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|LINK_SPEED
suffix:semicolon
macro_line|#else
DECL|variable|Speed_A
r_static
r_char
op_star
id|Speed_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef LINK_SPEED_B
DECL|variable|Speed_B
r_static
r_char
op_star
id|Speed_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|LINK_SPEED
suffix:semicolon
macro_line|#else
DECL|variable|Speed_B
r_static
r_char
op_star
id|Speed_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef AUTO_NEG_A
DECL|variable|AutoNeg_A
r_static
r_char
op_star
id|AutoNeg_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|AUTO_NEG_A
suffix:semicolon
macro_line|#else
DECL|variable|AutoNeg_A
r_static
r_char
op_star
id|AutoNeg_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DUP_CAP_A
DECL|variable|DupCap_A
r_static
r_char
op_star
id|DupCap_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|DUP_CAP_A
suffix:semicolon
macro_line|#else
DECL|variable|DupCap_A
r_static
r_char
op_star
id|DupCap_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FLOW_CTRL_A
DECL|variable|FlowCtrl_A
r_static
r_char
op_star
id|FlowCtrl_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|FLOW_CTRL_A
suffix:semicolon
macro_line|#else
DECL|variable|FlowCtrl_A
r_static
r_char
op_star
id|FlowCtrl_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ROLE_A
DECL|variable|Role_A
r_static
r_char
op_star
id|Role_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|ROLE_A
suffix:semicolon
macro_line|#else
DECL|variable|Role_A
r_static
r_char
op_star
id|Role_A
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef AUTO_NEG_B
DECL|variable|AutoNeg_B
r_static
r_char
op_star
id|AutoNeg_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|AUTO_NEG_B
suffix:semicolon
macro_line|#else
DECL|variable|AutoNeg_B
r_static
r_char
op_star
id|AutoNeg_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DUP_CAP_B
DECL|variable|DupCap_B
r_static
r_char
op_star
id|DupCap_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|DUP_CAP_B
suffix:semicolon
macro_line|#else
DECL|variable|DupCap_B
r_static
r_char
op_star
id|DupCap_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef FLOW_CTRL_B
DECL|variable|FlowCtrl_B
r_static
r_char
op_star
id|FlowCtrl_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|FLOW_CTRL_B
suffix:semicolon
macro_line|#else
DECL|variable|FlowCtrl_B
r_static
r_char
op_star
id|FlowCtrl_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ROLE_B
DECL|variable|Role_B
r_static
r_char
op_star
id|Role_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|ROLE_B
suffix:semicolon
macro_line|#else
DECL|variable|Role_B
r_static
r_char
op_star
id|Role_B
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CON_TYPE
DECL|variable|ConType
r_static
r_char
op_star
id|ConType
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|CON_TYPE
suffix:semicolon
macro_line|#else
DECL|variable|ConType
r_static
r_char
op_star
id|ConType
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PREF_PORT
DECL|variable|PrefPort
r_static
r_char
op_star
id|PrefPort
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|PREF_PORT
suffix:semicolon
macro_line|#else
DECL|variable|PrefPort
r_static
r_char
op_star
id|PrefPort
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef RLMT_MODE
DECL|variable|RlmtMode
r_static
r_char
op_star
id|RlmtMode
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
id|RLMT_MODE
suffix:semicolon
macro_line|#else
DECL|variable|RlmtMode
r_static
r_char
op_star
id|RlmtMode
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_string|&quot;&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
DECL|variable|options
r_static
r_int
id|options
(braket
id|SK_MAX_CARD_PARAM
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* not used */
DECL|variable|IntsPerSec
r_static
r_int
id|IntsPerSec
(braket
id|SK_MAX_CARD_PARAM
)braket
suffix:semicolon
DECL|variable|Moderation
r_static
r_char
op_star
id|Moderation
(braket
id|SK_MAX_CARD_PARAM
)braket
suffix:semicolon
DECL|variable|ModerationMask
r_static
r_char
op_star
id|ModerationMask
(braket
id|SK_MAX_CARD_PARAM
)braket
suffix:semicolon
DECL|variable|AutoSizing
r_static
r_char
op_star
id|AutoSizing
(braket
id|SK_MAX_CARD_PARAM
)braket
suffix:semicolon
DECL|variable|Stats
r_static
r_char
op_star
id|Stats
(braket
id|SK_MAX_CARD_PARAM
)braket
suffix:semicolon
multiline_comment|/*****************************************************************************&n; *&n; * &t;skge_init_module - module initialization function&n; *&n; * Description:&n; *&t;Very simple, only call skge_probe and return approriate result.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|skge_init_module
r_static
r_int
id|__init
id|skge_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|cards
suffix:semicolon
id|SkGeRootDev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* just to avoid warnings ... */
id|debug
op_assign
l_int|0
suffix:semicolon
id|options
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|cards
op_assign
id|skge_probe
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cards
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: No adapter found.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|cards
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* skge_init_module */
multiline_comment|/*****************************************************************************&n; *&n; * &t;skge_cleanup_module - module unload function&n; *&n; * Description:&n; *&t;Disable adapter if it is still running, free resources,&n; *&t;free device struct.&n; *&n; * Returns: N/A&n; */
DECL|function|skge_cleanup_module
r_static
r_void
id|__exit
id|skge_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_struct
id|SK_NET_DEVICE
op_star
id|next
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|SK_EVPARA
id|EvPara
suffix:semicolon
r_while
c_loop
(paren
id|SkGeRootDev
)paren
(brace
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|SkGeRootDev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|next
op_assign
id|pAC-&gt;Next
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|SkGeRootDev
)paren
suffix:semicolon
id|SkGeYellowLED
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
op_eq
id|SK_INIT_RUN
)paren
(brace
multiline_comment|/* board is still alive */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
l_int|0
)paren
suffix:semicolon
id|SkGeDeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_DATA
suffix:semicolon
multiline_comment|/* We do NOT check here, if IRQ was pending, of course*/
)brace
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
op_eq
id|SK_INIT_IO
)paren
(brace
multiline_comment|/* board is still alive */
id|SkGeDeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_DATA
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
(brace
id|unregister_netdev
c_func
(paren
id|pAC-&gt;dev
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|pAC-&gt;dev
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|FreeResources
c_func
(paren
id|SkGeRootDev
)paren
suffix:semicolon
id|SkGeRootDev-&gt;get_stats
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * otherwise unregister_netdev calls get_stats with&n;&t;&t; * invalid IO ...  :-(&n;&t;&t; */
id|unregister_netdev
c_func
(paren
id|SkGeRootDev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|SkGeRootDev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkGeRootDev
op_assign
id|next
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/* clear proc-dir */
id|remove_proc_entry
c_func
(paren
id|pSkRootDir-&gt;name
comma
id|proc_net
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* skge_cleanup_module */
DECL|variable|skge_init_module
id|module_init
c_func
(paren
id|skge_init_module
)paren
suffix:semicolon
DECL|variable|skge_cleanup_module
id|module_exit
c_func
(paren
id|skge_cleanup_module
)paren
suffix:semicolon
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeBoardInit - do level 0 and 1 initialization&n; *&n; * Description:&n; *&t;This function prepares the board hardware for running. The desriptor&n; *&t;ring is set up, the IRQ is allocated and the configuration settings&n; *&t;are examined.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|SkGeBoardInit
r_static
r_int
id|__init
id|SkGeBoardInit
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
id|SK_AC
op_star
id|pAC
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
r_char
op_star
id|DescrString
op_assign
l_string|&quot;sk98lin: Driver for Linux&quot;
suffix:semicolon
multiline_comment|/* this is given to PNMI */
r_char
op_star
id|VerStr
op_assign
id|VER_STRING
suffix:semicolon
r_int
id|Ret
suffix:semicolon
multiline_comment|/* return code of request_irq */
id|SK_BOOL
id|DualNet
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;IoBase: %08lX&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|pAC-&gt;IoBase
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|HwAddr
op_assign
id|pAC-&gt;IoBase
op_plus
id|TxQueueAddr
(braket
id|i
)braket
(braket
l_int|0
)braket
suffix:semicolon
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|PortIndex
op_assign
id|i
suffix:semicolon
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|HwAddr
op_assign
id|pAC-&gt;IoBase
op_plus
id|RxQueueAddr
(braket
id|i
)braket
suffix:semicolon
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|PortIndex
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/* Initialize the mutexes */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_MACS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_init
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxDesRingLock
)paren
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
multiline_comment|/* level 0 init common modules here */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* Does a RESET on board ...*/
r_if
c_cond
(paren
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;HWInit (0) failed.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|SkI2cInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|SkEventInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|SkPnmiInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|SkAddrInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|SkRlmtInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|SkTimerInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_DATA
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_DATA
suffix:semicolon
id|pAC-&gt;RxBufSize
op_assign
id|ETH_BUF_SIZE
suffix:semicolon
id|SK_PNMI_SET_DRIVER_DESCR
c_func
(paren
id|pAC
comma
id|DescrString
)paren
suffix:semicolon
id|SK_PNMI_SET_DRIVER_VER
c_func
(paren
id|pAC
comma
id|VerStr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* level 1 init common modules here (HW init) */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: HWInit (1) failed.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|SkI2cInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkEventInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkPnmiInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkAddrInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkRlmtInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkTimerInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
multiline_comment|/* Set chipset type support */
id|pAC-&gt;ChipsetType
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_YUKON
)paren
op_logical_or
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_YUKON_LITE
)paren
)paren
(brace
id|pAC-&gt;ChipsetType
op_assign
l_int|1
suffix:semicolon
)brace
id|GetConfiguration
c_func
(paren
id|pAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
(brace
id|pAC-&gt;GIni.GIPortUsage
op_assign
id|SK_MUL_LINK
suffix:semicolon
)brace
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_IO
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
(brace
id|Ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|SkGeIsr
comma
id|SA_SHIRQ
comma
id|pAC-&gt;Name
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|1
)paren
(brace
id|Ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|SkGeIsrOnePort
comma
id|SA_SHIRQ
comma
id|pAC-&gt;Name
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sk98lin: Illegal number of ports: %d&bslash;n&quot;
comma
id|pAC-&gt;GIni.GIMacsFound
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sk98lin: Requested IRQ %d is busy.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|pAC-&gt;AllocFlag
op_or_assign
id|SK_ALLOC_IRQ
suffix:semicolon
multiline_comment|/* Alloc memory for this board (Mem for RxD/TxD) : */
r_if
c_cond
(paren
op_logical_neg
id|BoardAllocMem
c_func
(paren
id|pAC
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;No memory for descriptor rings.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|SkCsSetReceiveFlags
c_func
(paren
id|pAC
comma
id|SKCS_PROTO_IP
op_or
id|SKCS_PROTO_TCP
op_or
id|SKCS_PROTO_UDP
comma
op_amp
id|pAC-&gt;CsOfs1
comma
op_amp
id|pAC-&gt;CsOfs2
comma
l_int|0
)paren
suffix:semicolon
id|pAC-&gt;CsOfs
op_assign
(paren
id|pAC-&gt;CsOfs2
op_lshift
l_int|16
)paren
op_or
id|pAC-&gt;CsOfs1
suffix:semicolon
id|BoardInitMem
c_func
(paren
id|pAC
)paren
suffix:semicolon
multiline_comment|/* tschilling: New common function with minimum size check. */
id|DualNet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
(brace
id|DualNet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SkGeInitAssignRamToQueues
c_func
(paren
id|pAC
comma
id|pAC-&gt;ActivePort
comma
id|DualNet
)paren
)paren
(brace
id|BoardFreeMem
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;sk98lin: SkGeInitAssignRamToQueues failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Register the device here&n;&t; */
id|pAC-&gt;Next
op_assign
id|SkGeRootDev
suffix:semicolon
id|SkGeRootDev
op_assign
id|dev
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGeBoardInit */
multiline_comment|/*****************************************************************************&n; *&n; * &t;BoardAllocMem - allocate the memory for the descriptor rings&n; *&n; * Description:&n; *&t;This function allocates the memory for all descriptor rings.&n; *&t;Each ring is aligned for the desriptor alignment and no ring&n; *&t;has a 4 GByte boundary in it (because the upper 32 bit must&n; *&t;be constant for all descriptiors in one rings).&n; *&n; * Returns:&n; *&t;SK_TRUE, if all memory could be allocated&n; *&t;SK_FALSE, if not&n; */
DECL|function|BoardAllocMem
r_static
id|SK_BOOL
id|BoardAllocMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
id|caddr_t
id|pDescrMem
suffix:semicolon
multiline_comment|/* pointer to descriptor memory area */
r_int
id|AllocLength
suffix:semicolon
multiline_comment|/* length of complete descriptor area */
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
r_int
r_int
id|BusAddr
suffix:semicolon
multiline_comment|/* rings plus one for alignment (do not cross 4 GB boundary) */
multiline_comment|/* RX_RING_SIZE is assumed bigger than TX_RING_SIZE */
macro_line|#if (BITS_PER_LONG == 32)
id|AllocLength
op_assign
(paren
id|RX_RING_SIZE
op_plus
id|TX_RING_SIZE
)paren
op_star
id|pAC-&gt;GIni.GIMacsFound
op_plus
l_int|8
suffix:semicolon
macro_line|#else
id|AllocLength
op_assign
(paren
id|RX_RING_SIZE
op_plus
id|TX_RING_SIZE
)paren
op_star
id|pAC-&gt;GIni.GIMacsFound
op_plus
id|RX_RING_SIZE
op_plus
l_int|8
suffix:semicolon
macro_line|#endif
id|pDescrMem
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pAC-&gt;PciDev
comma
id|AllocLength
comma
op_amp
id|pAC-&gt;pDescrMemDMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pDescrMem
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
id|SK_FALSE
)paren
suffix:semicolon
)brace
id|pAC-&gt;pDescrMem
op_assign
id|pDescrMem
suffix:semicolon
id|BusAddr
op_assign
(paren
r_int
r_int
)paren
id|pAC-&gt;pDescrMemDMA
suffix:semicolon
multiline_comment|/* Descriptors need 8 byte alignment, and this is ensured&n;&t; * by pci_alloc_consistent.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;TX%d/A: pDescrMem: %lX,   PhysDescrMem: %lX&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|pDescrMem
comma
id|BusAddr
)paren
)paren
suffix:semicolon
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|pTxDescrRing
op_assign
id|pDescrMem
suffix:semicolon
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|VTxDescrRing
op_assign
id|BusAddr
suffix:semicolon
id|pDescrMem
op_add_assign
id|TX_RING_SIZE
suffix:semicolon
id|BusAddr
op_add_assign
id|TX_RING_SIZE
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;RX%d: pDescrMem: %lX,   PhysDescrMem: %lX&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|pDescrMem
comma
(paren
r_int
r_int
)paren
id|BusAddr
)paren
)paren
suffix:semicolon
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|pRxDescrRing
op_assign
id|pDescrMem
suffix:semicolon
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|VRxDescrRing
op_assign
id|BusAddr
suffix:semicolon
id|pDescrMem
op_add_assign
id|RX_RING_SIZE
suffix:semicolon
id|BusAddr
op_add_assign
id|RX_RING_SIZE
suffix:semicolon
)brace
multiline_comment|/* for */
r_return
(paren
id|SK_TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* BoardAllocMem */
multiline_comment|/****************************************************************************&n; *&n; *&t;BoardFreeMem - reverse of BoardAllocMem&n; *&n; * Description:&n; *&t;Free all memory allocated in BoardAllocMem: adapter context,&n; *&t;descriptor rings, locks.&n; *&n; * Returns:&t;N/A&n; */
DECL|function|BoardFreeMem
r_static
r_void
id|BoardFreeMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
r_int
id|AllocLength
suffix:semicolon
multiline_comment|/* length of complete descriptor area */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;BoardFreeMem&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#if (BITS_PER_LONG == 32)
id|AllocLength
op_assign
(paren
id|RX_RING_SIZE
op_plus
id|TX_RING_SIZE
)paren
op_star
id|pAC-&gt;GIni.GIMacsFound
op_plus
l_int|8
suffix:semicolon
macro_line|#else
id|AllocLength
op_assign
(paren
id|RX_RING_SIZE
op_plus
id|TX_RING_SIZE
)paren
op_star
id|pAC-&gt;GIni.GIMacsFound
op_plus
id|RX_RING_SIZE
op_plus
l_int|8
suffix:semicolon
macro_line|#endif
id|pci_free_consistent
c_func
(paren
id|pAC-&gt;PciDev
comma
id|AllocLength
comma
id|pAC-&gt;pDescrMem
comma
id|pAC-&gt;pDescrMemDMA
)paren
suffix:semicolon
id|pAC-&gt;pDescrMem
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* BoardFreeMem */
multiline_comment|/*****************************************************************************&n; *&n; * &t;BoardInitMem - initiate the descriptor rings&n; *&n; * Description:&n; *&t;This function sets the descriptor rings up in memory.&n; *&t;The adapter is initialized with the descriptor start addresses.&n; *&n; * Returns:&t;N/A&n; */
DECL|function|BoardInitMem
r_static
r_void
id|BoardInitMem
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
multiline_comment|/* pointer to adapter context */
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
r_int
id|RxDescrSize
suffix:semicolon
multiline_comment|/* the size of a rx descriptor rounded up to alignment*/
r_int
id|TxDescrSize
suffix:semicolon
multiline_comment|/* the size of a tx descriptor rounded up to alignment*/
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;BoardInitMem&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|RxDescrSize
op_assign
(paren
(paren
(paren
r_sizeof
(paren
id|RXD
)paren
op_minus
l_int|1
)paren
op_div
id|DESCR_ALIGN
)paren
op_plus
l_int|1
)paren
op_star
id|DESCR_ALIGN
suffix:semicolon
id|pAC-&gt;RxDescrPerRing
op_assign
id|RX_RING_SIZE
op_div
id|RxDescrSize
suffix:semicolon
id|TxDescrSize
op_assign
(paren
(paren
(paren
r_sizeof
(paren
id|TXD
)paren
op_minus
l_int|1
)paren
op_div
id|DESCR_ALIGN
)paren
op_plus
l_int|1
)paren
op_star
id|DESCR_ALIGN
suffix:semicolon
id|pAC-&gt;TxDescrPerRing
op_assign
id|TX_RING_SIZE
op_div
id|RxDescrSize
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SetupRing
c_func
(paren
id|pAC
comma
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|pTxDescrRing
comma
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|VTxDescrRing
comma
(paren
id|RXD
op_star
op_star
)paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|pTxdRingHead
comma
(paren
id|RXD
op_star
op_star
)paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|pTxdRingTail
comma
(paren
id|RXD
op_star
op_star
)paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|pTxdRingPrev
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
l_int|0
)braket
dot
id|TxdRingFree
comma
id|SK_TRUE
)paren
suffix:semicolon
id|SetupRing
c_func
(paren
id|pAC
comma
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|pRxDescrRing
comma
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|VRxDescrRing
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|pRxdRingHead
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|pRxdRingTail
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|pRxdRingPrev
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxdRingFree
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* BoardInitMem */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SetupRing - create one descriptor ring&n; *&n; * Description:&n; *&t;This function creates one descriptor ring in the given memory area.&n; *&t;The head, tail and number of free descriptors in the ring are set.&n; *&n; * Returns:&n; *&t;none&n; */
DECL|function|SetupRing
r_static
r_void
id|SetupRing
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
r_void
op_star
id|pMemArea
comma
multiline_comment|/* a pointer to the memory area for the ring */
r_uintptr
id|VMemArea
comma
multiline_comment|/* the virtual bus address of the memory area */
id|RXD
op_star
op_star
id|ppRingHead
comma
multiline_comment|/* address where the head should be written */
id|RXD
op_star
op_star
id|ppRingTail
comma
multiline_comment|/* address where the tail should be written */
id|RXD
op_star
op_star
id|ppRingPrev
comma
multiline_comment|/* address where the tail should be written */
r_int
op_star
id|pRingFree
comma
multiline_comment|/* address where the # of free descr. goes */
id|SK_BOOL
id|IsTx
)paren
multiline_comment|/* flag: is this a tx ring */
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
r_int
id|DescrSize
suffix:semicolon
multiline_comment|/* the size of a descriptor rounded up to alignment*/
r_int
id|DescrNum
suffix:semicolon
multiline_comment|/* number of descriptors per ring */
id|RXD
op_star
id|pDescr
suffix:semicolon
multiline_comment|/* pointer to a descriptor (receive or transmit) */
id|RXD
op_star
id|pNextDescr
suffix:semicolon
multiline_comment|/* pointer to the next descriptor */
id|RXD
op_star
id|pPrevDescr
suffix:semicolon
multiline_comment|/* pointer to the previous descriptor */
r_uintptr
id|VNextDescr
suffix:semicolon
multiline_comment|/* the virtual bus address of the next descriptor */
r_if
c_cond
(paren
id|IsTx
op_eq
id|SK_TRUE
)paren
(brace
id|DescrSize
op_assign
(paren
(paren
(paren
r_sizeof
(paren
id|TXD
)paren
op_minus
l_int|1
)paren
op_div
id|DESCR_ALIGN
)paren
op_plus
l_int|1
)paren
op_star
id|DESCR_ALIGN
suffix:semicolon
id|DescrNum
op_assign
id|TX_RING_SIZE
op_div
id|DescrSize
suffix:semicolon
)brace
r_else
(brace
id|DescrSize
op_assign
(paren
(paren
(paren
r_sizeof
(paren
id|RXD
)paren
op_minus
l_int|1
)paren
op_div
id|DESCR_ALIGN
)paren
op_plus
l_int|1
)paren
op_star
id|DESCR_ALIGN
suffix:semicolon
id|DescrNum
op_assign
id|RX_RING_SIZE
op_div
id|DescrSize
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;Descriptor size: %d   Descriptor Number: %d&bslash;n&quot;
comma
id|DescrSize
comma
id|DescrNum
)paren
)paren
suffix:semicolon
id|pDescr
op_assign
(paren
id|RXD
op_star
)paren
id|pMemArea
suffix:semicolon
id|pPrevDescr
op_assign
l_int|NULL
suffix:semicolon
id|pNextDescr
op_assign
(paren
id|RXD
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|pDescr
)paren
op_plus
id|DescrSize
)paren
suffix:semicolon
id|VNextDescr
op_assign
id|VMemArea
op_plus
id|DescrSize
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DescrNum
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* set the pointers right */
id|pDescr-&gt;VNextRxd
op_assign
id|VNextDescr
op_amp
l_int|0xffffffffULL
suffix:semicolon
id|pDescr-&gt;pNextRxd
op_assign
id|pNextDescr
suffix:semicolon
id|pDescr-&gt;TcpSumStarts
op_assign
id|pAC-&gt;CsOfs
suffix:semicolon
multiline_comment|/* advance one step */
id|pPrevDescr
op_assign
id|pDescr
suffix:semicolon
id|pDescr
op_assign
id|pNextDescr
suffix:semicolon
id|pNextDescr
op_assign
(paren
id|RXD
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|pDescr
)paren
op_plus
id|DescrSize
)paren
suffix:semicolon
id|VNextDescr
op_add_assign
id|DescrSize
suffix:semicolon
)brace
id|pPrevDescr-&gt;pNextRxd
op_assign
(paren
id|RXD
op_star
)paren
id|pMemArea
suffix:semicolon
id|pPrevDescr-&gt;VNextRxd
op_assign
id|VMemArea
suffix:semicolon
id|pDescr
op_assign
(paren
id|RXD
op_star
)paren
id|pMemArea
suffix:semicolon
op_star
id|ppRingHead
op_assign
(paren
id|RXD
op_star
)paren
id|pMemArea
suffix:semicolon
op_star
id|ppRingTail
op_assign
op_star
id|ppRingHead
suffix:semicolon
op_star
id|ppRingPrev
op_assign
id|pPrevDescr
suffix:semicolon
op_star
id|pRingFree
op_assign
id|DescrNum
suffix:semicolon
)brace
multiline_comment|/* SetupRing */
multiline_comment|/*****************************************************************************&n; *&n; * &t;PortReInitBmu - re-initiate the descriptor rings for one port&n; *&n; * Description:&n; *&t;This function reinitializes the descriptor rings of one port&n; *&t;in memory. The port must be stopped before.&n; *&t;The HW is initialized with the descriptor start addresses.&n; *&n; * Returns:&n; *&t;none&n; */
DECL|function|PortReInitBmu
r_static
r_void
id|PortReInitBmu
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
r_int
id|PortIndex
)paren
multiline_comment|/* index of the port for which to re-init */
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;PortReInitBmu &quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* set address of first descriptor of ring in BMU */
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|TxQueueAddr
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
op_plus
id|Q_DA_L
comma
(paren
r_uint32
)paren
(paren
(paren
(paren
id|caddr_t
)paren
(paren
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|pTxdRingHead
)paren
op_minus
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|pTxDescrRing
op_plus
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|VTxDescrRing
)paren
op_amp
l_int|0xFFFFFFFF
)paren
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|TxQueueAddr
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
op_plus
id|Q_DA_H
comma
(paren
r_uint32
)paren
(paren
(paren
(paren
id|caddr_t
)paren
(paren
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|pTxdRingHead
)paren
op_minus
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|pTxDescrRing
op_plus
id|pAC-&gt;TxPort
(braket
id|PortIndex
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|VTxDescrRing
)paren
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|RxQueueAddr
(braket
id|PortIndex
)braket
op_plus
id|Q_DA_L
comma
(paren
r_uint32
)paren
(paren
(paren
(paren
id|caddr_t
)paren
(paren
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|pRxdRingHead
)paren
op_minus
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|pRxDescrRing
op_plus
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|VRxDescrRing
)paren
op_amp
l_int|0xFFFFFFFF
)paren
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|RxQueueAddr
(braket
id|PortIndex
)braket
op_plus
id|Q_DA_H
comma
(paren
r_uint32
)paren
(paren
(paren
(paren
id|caddr_t
)paren
(paren
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|pRxdRingHead
)paren
op_minus
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|pRxDescrRing
op_plus
id|pAC-&gt;RxPort
(braket
id|PortIndex
)braket
dot
id|VRxDescrRing
)paren
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* PortReInitBmu */
multiline_comment|/****************************************************************************&n; *&n; *&t;SkGeIsr - handle adapter interrupts&n; *&n; * Description:&n; *&t;The interrupt routine is called when the network adapter&n; *&t;generates an interrupt. It may also be called if another device&n; *&t;shares this interrupt vector with the driver.&n; *&n; * Returns: N/A&n; *&n; */
DECL|function|SkGeIsr
r_static
id|SkIsrRetVar
id|SkGeIsr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_struct
id|SK_NET_DEVICE
op_star
id|dev
op_assign
(paren
r_struct
id|SK_NET_DEVICE
op_star
)paren
id|dev_id
suffix:semicolon
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
id|SK_U32
id|IntSrc
suffix:semicolon
multiline_comment|/* interrupts source register contents */
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
multiline_comment|/*&n;&t; * Check and process if its our interrupt&n;&t; */
id|SK_IN32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_SP_ISRC
comma
op_amp
id|IntSrc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_eq
l_int|0
)paren
(brace
r_return
id|SkIsrRetNone
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|IntSrc
op_amp
id|IRQ_MASK
)paren
op_amp
op_complement
id|SPECIAL_IRQS
)paren
op_ne
l_int|0
)paren
(brace
macro_line|#if 0 /* software irq currently not used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_IRQ_SW
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;Software IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF RX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
l_int|0
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|SK_PNMI_CNT_RX_INTR
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R2_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF RX2 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
l_int|1
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|SK_PNMI_CNT_RX_INTR
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_TX_COMPLETE /* only if tx complete interrupt used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF AS TX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA2_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF AS TX2 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|1
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
l_int|1
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|1
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* only if sync. queues used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XS1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF SY TX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XS2_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF SY TX2 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|1
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
l_int|1
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|1
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|1
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
multiline_comment|/* do all IO at once */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R1_F
)paren
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R2_F
)paren
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef USE_TX_COMPLETE /* only if tx complete interrupt used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA1_F
)paren
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA2_F
)paren
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|1
comma
id|TX_PRIO_LOW
)paren
suffix:semicolon
macro_line|#endif
id|SK_IN32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_ISRC
comma
op_amp
id|IntSrc
)paren
suffix:semicolon
)brace
multiline_comment|/* while (IntSrc &amp; IRQ_MASK != 0) */
id|IntSrc
op_and_assign
id|pAC-&gt;GIni.GIValIrqMask
suffix:semicolon
r_if
c_cond
(paren
(paren
id|IntSrc
op_amp
id|SPECIAL_IRQS
)paren
op_logical_or
id|pAC-&gt;CheckQueue
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;SPECIAL IRQ DP-Cards =&gt; %x&bslash;n&quot;
comma
id|IntSrc
)paren
)paren
suffix:semicolon
id|pAC-&gt;CheckQueue
op_assign
id|SK_FALSE
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_amp
id|SPECIAL_IRQS
)paren
id|SkGeSirqIsr
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|IntSrc
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * do it all again is case we cleared an interrupt that&n;&t; * came in after handling the ring (OUTs may be delayed&n;&t; * in hardware buffers, but are through after IN)&n;&t; *&n;&t; * rroesler: has been commented out and shifted to&n;&t; *           SkGeDrvEvent(), because it is timer&n;&t; *           guarded now&n;&t; *&n;&t;ReceiveIrq(pAC, &amp;pAC-&gt;RxPort[0], SK_TRUE);&n;&t;ReceiveIrq(pAC, &amp;pAC-&gt;RxPort[1], SK_TRUE);&n;&t; */
r_if
c_cond
(paren
id|pAC-&gt;CheckQueue
)paren
(brace
id|pAC-&gt;CheckQueue
op_assign
id|SK_FALSE
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
)brace
multiline_comment|/* IRQ is processed - Enable IRQs again*/
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
id|pAC-&gt;GIni.GIValIrqMask
)paren
suffix:semicolon
r_return
id|SkIsrRetHandled
suffix:semicolon
)brace
multiline_comment|/* SkGeIsr */
multiline_comment|/****************************************************************************&n; *&n; *&t;SkGeIsrOnePort - handle adapter interrupts for single port adapter&n; *&n; * Description:&n; *&t;The interrupt routine is called when the network adapter&n; *&t;generates an interrupt. It may also be called if another device&n; *&t;shares this interrupt vector with the driver.&n; *&t;This is the same as above, but handles only one port.&n; *&n; * Returns: N/A&n; *&n; */
DECL|function|SkGeIsrOnePort
r_static
id|SkIsrRetVar
id|SkGeIsrOnePort
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_struct
id|SK_NET_DEVICE
op_star
id|dev
op_assign
(paren
r_struct
id|SK_NET_DEVICE
op_star
)paren
id|dev_id
suffix:semicolon
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
id|SK_U32
id|IntSrc
suffix:semicolon
multiline_comment|/* interrupts source register contents */
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
multiline_comment|/*&n;&t; * Check and process if its our interrupt&n;&t; */
id|SK_IN32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_SP_ISRC
comma
op_amp
id|IntSrc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_eq
l_int|0
)paren
(brace
r_return
id|SkIsrRetNone
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|IntSrc
op_amp
id|IRQ_MASK
)paren
op_amp
op_complement
id|SPECIAL_IRQS
)paren
op_ne
l_int|0
)paren
(brace
macro_line|#if 0 /* software irq currently not used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_IRQ_SW
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;Software IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF RX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
l_int|0
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|SK_PNMI_CNT_RX_INTR
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_TX_COMPLETE /* only if tx complete interrupt used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF AS TX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* only if sync. queues used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XS1_F
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;EOF SY TX1 IRQ&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_TX_INTR
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
l_int|0
)braket
(braket
id|TX_PRIO_HIGH
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_HIGH
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif
multiline_comment|/* do all IO at once */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_R1_F
)paren
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef USE_TX_COMPLETE /* only if tx complete interrupt used */
r_if
c_cond
(paren
id|IntSrc
op_amp
id|IS_XA1_F
)paren
id|ClearTxIrq
c_func
(paren
id|pAC
comma
l_int|0
comma
id|TX_PRIO_LOW
)paren
suffix:semicolon
macro_line|#endif
id|SK_IN32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_ISRC
comma
op_amp
id|IntSrc
)paren
suffix:semicolon
)brace
multiline_comment|/* while (IntSrc &amp; IRQ_MASK != 0) */
id|IntSrc
op_and_assign
id|pAC-&gt;GIni.GIValIrqMask
suffix:semicolon
r_if
c_cond
(paren
(paren
id|IntSrc
op_amp
id|SPECIAL_IRQS
)paren
op_logical_or
id|pAC-&gt;CheckQueue
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_INT_SRC
comma
(paren
l_string|&quot;SPECIAL IRQ SP-Cards =&gt; %x&bslash;n&quot;
comma
id|IntSrc
)paren
)paren
suffix:semicolon
id|pAC-&gt;CheckQueue
op_assign
id|SK_FALSE
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IntSrc
op_amp
id|SPECIAL_IRQS
)paren
id|SkGeSirqIsr
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|IntSrc
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * do it all again is case we cleared an interrupt that&n;&t; * came in after handling the ring (OUTs may be delayed&n;&t; * in hardware buffers, but are through after IN)&n;&t; *&n;&t; * rroesler: has been commented out and shifted to&n;&t; *           SkGeDrvEvent(), because it is timer&n;&t; *           guarded now&n;&t; *&n;&t;ReceiveIrq(pAC, &amp;pAC-&gt;RxPort[0], SK_TRUE);&n;&t; */
multiline_comment|/* IRQ is processed - Enable IRQs again*/
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
id|pAC-&gt;GIni.GIValIrqMask
)paren
suffix:semicolon
r_return
id|SkIsrRetHandled
suffix:semicolon
)brace
multiline_comment|/* SkGeIsrOnePort */
multiline_comment|/****************************************************************************&n; *&n; *&t;SkGeOpen - handle start of initialized adapter&n; *&n; * Description:&n; *&t;This function starts the initialized adapter.&n; *&t;The board level variable is set and the adapter is&n; *&t;brought to full functionality.&n; *&t;The device flags are set for operation.&n; *&t;Do all necessary level 2 initialization, enable interrupts and&n; *&t;give start command to RLMT.&n; *&n; * Returns:&n; *&t;0 on success&n; *&t;!= 0 on error&n; */
DECL|function|SkGeOpen
r_static
r_int
id|SkGeOpen
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
multiline_comment|/* for spin lock */
r_int
id|i
suffix:semicolon
id|SK_EVPARA
id|EvPara
suffix:semicolon
multiline_comment|/* an event parameter union */
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeOpen: pAC=0x%lX:&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|pAC
)paren
)paren
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
r_if
c_cond
(paren
id|pAC-&gt;DiagModeActive
op_eq
id|DIAG_ACTIVE
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;Pnmi.DiagAttached
op_eq
id|SK_DIAG_RUNNING
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* still in use by diag; deny actions */
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|THIS_MODULE
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* increase of usage count not possible */
)brace
multiline_comment|/* Set blink mode */
r_if
c_cond
(paren
(paren
id|pAC-&gt;PciDev-&gt;vendor
op_eq
l_int|0x1186
)paren
op_logical_or
(paren
id|pAC-&gt;PciDev-&gt;vendor
op_eq
l_int|0x11ab
)paren
)paren
id|pAC-&gt;GIni.GILedBlinkCtrl
op_assign
id|OEM_CONFIG_VALUE
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
op_eq
id|SK_INIT_DATA
)paren
(brace
multiline_comment|/* level 1 init common modules here */
r_if
c_cond
(paren
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
op_ne
l_int|0
)paren
(brace
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
multiline_comment|/* decrease usage count */
id|printk
c_func
(paren
l_string|&quot;%s: HWInit (1) failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
id|pNet-&gt;PortNr
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|SkI2cInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkEventInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkPnmiInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkAddrInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkRlmtInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkTimerInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_IO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
op_ne
id|SK_INIT_RUN
)paren
(brace
multiline_comment|/* tschilling: Level 2 init modules here, check return value. */
r_if
c_cond
(paren
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
op_ne
l_int|0
)paren
(brace
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
multiline_comment|/* decrease usage count */
id|printk
c_func
(paren
l_string|&quot;%s: HWInit (2) failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
id|pNet-&gt;PortNr
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|SkI2cInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkEventInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkPnmiInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkAddrInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkRlmtInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkTimerInit
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_RUN
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Enable transmit descriptor polling. */
id|SkGePollTxD
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|i
comma
id|SK_TRUE
)paren
suffix:semicolon
id|FillRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|SkGeYellowLED
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
l_int|1
)paren
suffix:semicolon
id|StartDrvCleanupTimer
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkDimEnableModerationIfNeeded
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkDimDisplayModerationSettings
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|pAC-&gt;GIni.GIValIrqMask
op_and_assign
id|IRQ_MASK
suffix:semicolon
multiline_comment|/* enable Interrupts */
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
id|pAC-&gt;GIni.GIValIrqMask
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_HWE_IMSK
comma
id|IRQ_HWE_MASK
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;RlmtMode
op_ne
l_int|0
)paren
op_logical_and
(paren
id|pAC-&gt;MaxPorts
op_eq
l_int|0
)paren
)paren
(brace
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;RlmtNets
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SET_NETS
comma
id|EvPara
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;RlmtMode
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_MODE_CHANGE
comma
id|EvPara
)paren
suffix:semicolon
)brace
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pNet-&gt;NetNr
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_START
comma
id|EvPara
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|pAC-&gt;MaxPorts
op_increment
suffix:semicolon
id|pNet-&gt;Up
op_assign
l_int|1
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeOpen suceeded&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGeOpen */
multiline_comment|/****************************************************************************&n; *&n; *&t;SkGeClose - Stop initialized adapter&n; *&n; * Description:&n; *&t;Close initialized adapter.&n; *&n; * Returns:&n; *&t;0 - on success&n; *&t;error code - on error&n; */
DECL|function|SkGeClose
r_static
r_int
id|SkGeClose
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|DEV_NET
op_star
id|newPtrNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
multiline_comment|/* for spin lock */
r_int
id|i
suffix:semicolon
r_int
id|PortIdx
suffix:semicolon
id|SK_EVPARA
id|EvPara
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeClose: pAC=0x%lX &quot;
comma
(paren
r_int
r_int
)paren
id|pAC
)paren
)paren
suffix:semicolon
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
r_if
c_cond
(paren
id|pAC-&gt;DiagModeActive
op_eq
id|DIAG_ACTIVE
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;DiagFlowCtrl
op_eq
id|SK_FALSE
)paren
(brace
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;** notify that the interface which has been closed&n;&t;&t;&t;** by operator interaction must not be started up &n;&t;&t;&t;** again when the DIAG has finished. &n;&t;&t;&t;*/
id|newPtrNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|newPtrNet
op_eq
id|pNet
)paren
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|0
)braket
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|1
)braket
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* return to system everything is fine... */
)brace
r_else
(brace
id|pAC-&gt;DiagFlowCtrl
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
macro_line|#endif
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|1
)paren
id|PortIdx
op_assign
id|pAC-&gt;ActivePort
suffix:semicolon
r_else
id|PortIdx
op_assign
id|pNet-&gt;NetNr
suffix:semicolon
id|StopDrvCleanupTimer
c_func
(paren
id|pAC
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Clear multicast table, promiscuous mode ....&n;&t; */
id|SkAddrMcClear
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
l_int|0
)paren
suffix:semicolon
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
id|SK_PROM_MODE_NONE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;MaxPorts
op_eq
l_int|1
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
l_int|0
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pNet-&gt;NetNr
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* stop the hardware */
id|SkGeDeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_DATA
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pNet-&gt;NetNr
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* Stop port */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|pNet-&gt;PortNr
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|SkGeStopPort
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pNet-&gt;PortNr
comma
id|SK_STOP_ALL
comma
id|SK_HARD_RST
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|pNet-&gt;PortNr
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|1
)paren
(brace
multiline_comment|/* clear all descriptor rings */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|ClearRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
)paren
suffix:semicolon
id|ClearTxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* clear port descriptor rings */
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|pNet-&gt;PortNr
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|ClearRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|pNet-&gt;PortNr
)braket
)paren
suffix:semicolon
id|ClearTxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pNet-&gt;PortNr
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeClose: done &quot;
)paren
)paren
suffix:semicolon
id|SK_MEMSET
c_func
(paren
op_amp
(paren
id|pAC-&gt;PnmiBackup
)paren
comma
l_int|0
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|SK_MEMCPY
c_func
(paren
op_amp
(paren
id|pAC-&gt;PnmiBackup
)paren
comma
op_amp
(paren
id|pAC-&gt;PnmiStruct
)paren
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|pAC-&gt;MaxPorts
op_decrement
suffix:semicolon
id|pNet-&gt;Up
op_assign
l_int|0
suffix:semicolon
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGeClose */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeXmit - Linux frame transmit function&n; *&n; * Description:&n; *&t;The system calls this function to send frames onto the wire.&n; *&t;It puts the frame in the tx descriptor ring. If the ring is&n; *&t;full then, the &squot;tbusy&squot; flag is set.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; * WARNING: returning 1 in &squot;tbusy&squot; case caused system crashes (double&n; *&t;allocated skb&squot;s) !!!&n; */
DECL|function|SkGeXmit
r_static
r_int
id|SkGeXmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_int
id|Rc
suffix:semicolon
multiline_comment|/* return code of XmitFrame */
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
)paren
op_logical_or
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_GENESIS
)paren
)paren
(brace
multiline_comment|/* Don&squot;t activate scatter-gather and hardware checksum */
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
id|Rc
op_assign
id|XmitFrame
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pNet-&gt;PortNr
)braket
(braket
id|TX_PRIO_LOW
)braket
comma
id|skb
)paren
suffix:semicolon
r_else
id|Rc
op_assign
id|XmitFrame
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pAC-&gt;ActivePort
)braket
(braket
id|TX_PRIO_LOW
)braket
comma
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* scatter-gather and hardware TCP checksumming anabled*/
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
id|Rc
op_assign
id|XmitFrameSG
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pNet-&gt;PortNr
)braket
(braket
id|TX_PRIO_LOW
)braket
comma
id|skb
)paren
suffix:semicolon
r_else
id|Rc
op_assign
id|XmitFrameSG
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pAC-&gt;ActivePort
)braket
(braket
id|TX_PRIO_LOW
)braket
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/* Transmitter out of resources? */
r_if
c_cond
(paren
id|Rc
op_le
l_int|0
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* If not taken, give buffer ownership back to the&n;&t; * queueing layer.&n;&t; */
r_if
c_cond
(paren
id|Rc
OL
l_int|0
)paren
r_return
(paren
l_int|1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGeXmit */
multiline_comment|/*****************************************************************************&n; *&n; * &t;XmitFrame - fill one socket buffer into the transmit ring&n; *&n; * Description:&n; *&t;This function puts a message into the transmit descriptor ring&n; *&t;if there is a descriptors left.&n; *&t;Linux skb&squot;s consist of only one continuous buffer.&n; *&t;The first step locks the ring. It is held locked&n; *&t;all time to avoid problems with SWITCH_../PORT_RESET.&n; *&t;Then the descriptoris allocated.&n; *&t;The second part is linking the buffer to the descriptor.&n; *&t;At the very last, the Control field of the descriptor&n; *&t;is made valid for the BMU and a start TX command is given&n; *&t;if necessary.&n; *&n; * Returns:&n; *&t;&gt; 0 - on succes: the number of bytes in the message&n; *&t;= 0 - on resource shortage: this frame sent or dropped, now&n; *&t;&t;the ring is full ( -&gt; set tbusy)&n; *&t;&lt; 0 - on failure: other problems ( -&gt; return failure to upper layers)&n; */
DECL|function|XmitFrame
r_static
r_int
id|XmitFrame
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context           */
id|TX_PORT
op_star
id|pTxPort
comma
multiline_comment|/* pointer to struct of port to send to */
r_struct
id|sk_buff
op_star
id|pMessage
)paren
multiline_comment|/* pointer to send-message              */
(brace
id|TXD
op_star
id|pTxd
suffix:semicolon
multiline_comment|/* the rxd to fill */
id|TXD
op_star
id|pOldTxd
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|SK_U64
id|PhysAddr
suffix:semicolon
r_int
id|Protocol
suffix:semicolon
r_int
id|IpHeaderLength
suffix:semicolon
r_int
id|BytesSend
op_assign
id|pMessage-&gt;len
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;X&quot;
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
macro_line|#ifndef USE_TX_COMPLETE
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
id|pTxPort
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pTxPort-&gt;TxdRingFree
op_eq
l_int|0
)paren
(brace
multiline_comment|/* &n;&t;&t;** no enough free descriptors in ring at the moment.&n;&t;&t;** Maybe free&squot;ing some old one help?&n;&t;&t;*/
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
id|pTxPort
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pTxPort-&gt;TxdRingFree
op_eq
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|SK_PNMI_CNT_NO_TX_BUF
c_func
(paren
id|pAC
comma
id|pTxPort-&gt;PortIndex
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;XmitFrame failed&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;** the desired message can not be sent&n;&t;&t;&t;** Because tbusy seems to be set, the message &n;&t;&t;&t;** should not be freed here. It will be used &n;&t;&t;&t;** by the scheduler of the ethernet handler &n;&t;&t;&t;*/
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;** If the passed socket buffer is of smaller MTU-size than 60,&n;&t;** copy everything into new buffer and fill all bytes between&n;&t;** the original packet end and the new packet end of 60 with 0x00.&n;&t;** This is to resolve faulty padding by the HW with 0xaa bytes.&n;&t;*/
r_if
c_cond
(paren
id|BytesSend
OL
id|C_LEN_ETHERNET_MINSIZE
)paren
(brace
r_if
c_cond
(paren
(paren
id|pMessage
op_assign
id|skb_padto
c_func
(paren
id|pMessage
comma
id|C_LEN_ETHERNET_MINSIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|pMessage-&gt;len
op_assign
id|C_LEN_ETHERNET_MINSIZE
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** advance head counter behind descriptor needed for this frame, &n;&t;** so that needed descriptor is reserved from that on. The next&n;&t;** action will be to add the passed buffer to the TX-descriptor&n;&t;*/
id|pTxd
op_assign
id|pTxPort-&gt;pTxdRingHead
suffix:semicolon
id|pTxPort-&gt;pTxdRingHead
op_assign
id|pTxd-&gt;pNextTxd
suffix:semicolon
id|pTxPort-&gt;TxdRingFree
op_decrement
suffix:semicolon
macro_line|#ifdef SK_DUMP_TX
id|DumpMsg
c_func
(paren
id|pMessage
comma
l_string|&quot;XmitFrame&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* &n;&t;** First step is to map the data to be sent via the adapter onto&n;&t;** the DMA memory. Kernel 2.2 uses virt_to_bus(), but kernels 2.4&n;&t;** and 2.6 need to use pci_map_page() for that mapping.&n;&t;*/
id|PhysAddr
op_assign
(paren
id|SK_U64
)paren
id|pci_map_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|virt_to_page
c_func
(paren
id|pMessage-&gt;data
)paren
comma
(paren
(paren
r_int
r_int
)paren
id|pMessage-&gt;data
op_amp
op_complement
id|PAGE_MASK
)paren
comma
id|pMessage-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|pTxd-&gt;VDataLow
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|pTxd-&gt;VDataHigh
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_rshift
l_int|32
)paren
suffix:semicolon
id|pTxd-&gt;pMBuf
op_assign
id|pMessage
suffix:semicolon
r_if
c_cond
(paren
id|pMessage-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|Protocol
op_assign
(paren
(paren
id|SK_U8
)paren
id|pMessage-&gt;data
(braket
id|C_OFFSET_IPPROTO
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Protocol
op_eq
id|C_PROTO_ID_UDP
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipRev
op_eq
l_int|0
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_YUKON
)paren
)paren
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_TCP_CHECK
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_UDP_CHECK
suffix:semicolon
)brace
id|IpHeaderLength
op_assign
(paren
id|SK_U8
)paren
id|pMessage-&gt;data
(braket
id|C_OFFSET_IPHEADER
)braket
suffix:semicolon
id|IpHeaderLength
op_assign
(paren
id|IpHeaderLength
op_amp
l_int|0xf
)paren
op_star
l_int|4
suffix:semicolon
id|pTxd-&gt;TcpSumOfs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PH-Checksum already calculated */
id|pTxd-&gt;TcpSumSt
op_assign
id|C_LEN_ETHERMAC_HEADER
op_plus
id|IpHeaderLength
op_plus
(paren
id|Protocol
op_eq
id|C_PROTO_ID_UDP
ques
c_cond
id|C_OFFSET_UDPHEADER_UDPCS
suffix:colon
id|C_OFFSET_TCPHEADER_TCPCS
)paren
suffix:semicolon
id|pTxd-&gt;TcpSumWr
op_assign
id|C_LEN_ETHERMAC_HEADER
op_plus
id|IpHeaderLength
suffix:semicolon
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_OWN
op_or
id|BMU_STF
op_or
id|BMU_SW
op_or
id|BMU_EOF
op_or
macro_line|#ifdef USE_TX_COMPLETE
id|BMU_IRQ_EOF
op_or
macro_line|#endif
id|pMessage-&gt;len
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_OWN
op_or
id|BMU_STF
op_or
id|BMU_CHECK
op_or
id|BMU_SW
op_or
id|BMU_EOF
op_or
macro_line|#ifdef USE_TX_COMPLETE
id|BMU_IRQ_EOF
op_or
macro_line|#endif
id|pMessage-&gt;len
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** If previous descriptor already done, give TX start cmd &n;&t;*/
id|pOldTxd
op_assign
id|xchg
c_func
(paren
op_amp
id|pTxPort-&gt;pTxdRingPrev
comma
id|pTxd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pOldTxd-&gt;TBControl
op_amp
id|BMU_OWN
)paren
op_eq
l_int|0
)paren
(brace
id|SK_OUT8
c_func
(paren
id|pTxPort-&gt;HwAddr
comma
id|Q_CSR
comma
id|CSR_START
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** after releasing the lock, the skb may immediately be free&squot;d &n;&t;*/
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pTxPort-&gt;TxdRingFree
op_ne
l_int|0
)paren
(brace
r_return
(paren
id|BytesSend
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* XmitFrame */
multiline_comment|/*****************************************************************************&n; *&n; * &t;XmitFrameSG - fill one socket buffer into the transmit ring&n; *                (use SG and TCP/UDP hardware checksumming)&n; *&n; * Description:&n; *&t;This function puts a message into the transmit descriptor ring&n; *&t;if there is a descriptors left.&n; *&n; * Returns:&n; *&t;&gt; 0 - on succes: the number of bytes in the message&n; *&t;= 0 - on resource shortage: this frame sent or dropped, now&n; *&t;&t;the ring is full ( -&gt; set tbusy)&n; *&t;&lt; 0 - on failure: other problems ( -&gt; return failure to upper layers)&n; */
DECL|function|XmitFrameSG
r_static
r_int
id|XmitFrameSG
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context           */
id|TX_PORT
op_star
id|pTxPort
comma
multiline_comment|/* pointer to struct of port to send to */
r_struct
id|sk_buff
op_star
id|pMessage
)paren
multiline_comment|/* pointer to send-message              */
(brace
id|TXD
op_star
id|pTxd
suffix:semicolon
id|TXD
op_star
id|pTxdFst
suffix:semicolon
id|TXD
op_star
id|pTxdLst
suffix:semicolon
r_int
id|CurrFrag
suffix:semicolon
r_int
id|BytesSend
suffix:semicolon
r_int
id|IpHeaderLength
suffix:semicolon
r_int
id|Protocol
suffix:semicolon
id|skb_frag_t
op_star
id|sk_frag
suffix:semicolon
id|SK_U64
id|PhysAddr
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
macro_line|#ifndef USE_TX_COMPLETE
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
id|pTxPort
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|skb_shinfo
c_func
(paren
id|pMessage
)paren
op_member_access_from_pointer
id|nr_frags
op_plus
l_int|1
)paren
OG
id|pTxPort-&gt;TxdRingFree
)paren
(brace
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
id|pTxPort
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb_shinfo
c_func
(paren
id|pMessage
)paren
op_member_access_from_pointer
id|nr_frags
op_plus
l_int|1
)paren
OG
id|pTxPort-&gt;TxdRingFree
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|SK_PNMI_CNT_NO_TX_BUF
c_func
(paren
id|pAC
comma
id|pTxPort-&gt;PortIndex
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_TX_PROGRESS
comma
(paren
l_string|&quot;XmitFrameSG failed - Ring full&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* this message can not be sent now */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|pTxd
op_assign
id|pTxPort-&gt;pTxdRingHead
suffix:semicolon
id|pTxdFst
op_assign
id|pTxd
suffix:semicolon
id|pTxdLst
op_assign
id|pTxd
suffix:semicolon
id|BytesSend
op_assign
l_int|0
suffix:semicolon
id|Protocol
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t;** Map the first fragment (header) into the DMA-space&n;&t;*/
id|PhysAddr
op_assign
(paren
id|SK_U64
)paren
id|pci_map_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|virt_to_page
c_func
(paren
id|pMessage-&gt;data
)paren
comma
(paren
(paren
r_int
r_int
)paren
id|pMessage-&gt;data
op_amp
op_complement
id|PAGE_MASK
)paren
comma
id|skb_headlen
c_func
(paren
id|pMessage
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|pTxd-&gt;VDataLow
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|pTxd-&gt;VDataHigh
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_rshift
l_int|32
)paren
suffix:semicolon
multiline_comment|/* &n;&t;** Does the HW need to evaluate checksum for TCP or UDP packets? &n;&t;*/
r_if
c_cond
(paren
id|pMessage-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_STF
op_or
id|BMU_STFWD
op_or
id|skb_headlen
c_func
(paren
id|pMessage
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;** We have to use the opcode for tcp here,  because the&n;&t;&t;** opcode for udp is not working in the hardware yet &n;&t;&t;** (Revision 2.0)&n;&t;&t;*/
id|Protocol
op_assign
(paren
(paren
id|SK_U8
)paren
id|pMessage-&gt;data
(braket
id|C_OFFSET_IPPROTO
)braket
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Protocol
op_eq
id|C_PROTO_ID_UDP
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipRev
op_eq
l_int|0
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_YUKON
)paren
)paren
(brace
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_TCP_CHECK
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_UDP_CHECK
suffix:semicolon
)brace
id|IpHeaderLength
op_assign
(paren
(paren
id|SK_U8
)paren
id|pMessage-&gt;data
(braket
id|C_OFFSET_IPHEADER
)braket
op_amp
l_int|0xf
)paren
op_star
l_int|4
suffix:semicolon
id|pTxd-&gt;TcpSumOfs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PH-Checksum already claculated */
id|pTxd-&gt;TcpSumSt
op_assign
id|C_LEN_ETHERMAC_HEADER
op_plus
id|IpHeaderLength
op_plus
(paren
id|Protocol
op_eq
id|C_PROTO_ID_UDP
ques
c_cond
id|C_OFFSET_UDPHEADER_UDPCS
suffix:colon
id|C_OFFSET_TCPHEADER_TCPCS
)paren
suffix:semicolon
id|pTxd-&gt;TcpSumWr
op_assign
id|C_LEN_ETHERMAC_HEADER
op_plus
id|IpHeaderLength
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_CHECK
op_or
id|BMU_SW
op_or
id|BMU_STF
op_or
id|skb_headlen
c_func
(paren
id|pMessage
)paren
suffix:semicolon
)brace
id|pTxd
op_assign
id|pTxd-&gt;pNextTxd
suffix:semicolon
id|pTxPort-&gt;TxdRingFree
op_decrement
suffix:semicolon
id|BytesSend
op_add_assign
id|skb_headlen
c_func
(paren
id|pMessage
)paren
suffix:semicolon
multiline_comment|/* &n;&t;** Browse over all SG fragments and map each of them into the DMA space&n;&t;*/
r_for
c_loop
(paren
id|CurrFrag
op_assign
l_int|0
suffix:semicolon
id|CurrFrag
OL
id|skb_shinfo
c_func
(paren
id|pMessage
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|CurrFrag
op_increment
)paren
(brace
id|sk_frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|pMessage
)paren
op_member_access_from_pointer
id|frags
(braket
id|CurrFrag
)braket
suffix:semicolon
multiline_comment|/* &n;&t;&t;** we already have the proper value in entry&n;&t;&t;*/
id|PhysAddr
op_assign
(paren
id|SK_U64
)paren
id|pci_map_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|sk_frag-&gt;page
comma
id|sk_frag-&gt;page_offset
comma
id|sk_frag-&gt;size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|pTxd-&gt;VDataLow
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|pTxd-&gt;VDataHigh
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_rshift
l_int|32
)paren
suffix:semicolon
id|pTxd-&gt;pMBuf
op_assign
id|pMessage
suffix:semicolon
multiline_comment|/* &n;&t;&t;** Does the HW need to evaluate checksum for TCP or UDP packets? &n;&t;&t;*/
r_if
c_cond
(paren
id|pMessage-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_OWN
op_or
id|BMU_SW
op_or
id|BMU_STFWD
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;** We have to use the opcode for tcp here because the &n;&t;&t;&t;** opcode for udp is not working in the hardware yet &n;&t;&t;&t;** (revision 2.0)&n;&t;&t;&t;*/
r_if
c_cond
(paren
(paren
id|Protocol
op_eq
id|C_PROTO_ID_UDP
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipRev
op_eq
l_int|0
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_YUKON
)paren
)paren
(brace
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_TCP_CHECK
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_UDP_CHECK
suffix:semicolon
)brace
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_assign
id|BMU_CHECK
op_or
id|BMU_SW
op_or
id|BMU_OWN
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t;** Do we have the last fragment? &n;&t;&t;*/
r_if
c_cond
(paren
(paren
id|CurrFrag
op_plus
l_int|1
)paren
op_eq
id|skb_shinfo
c_func
(paren
id|pMessage
)paren
op_member_access_from_pointer
id|nr_frags
)paren
(brace
macro_line|#ifdef USE_TX_COMPLETE
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_EOF
op_or
id|BMU_IRQ_EOF
op_or
id|sk_frag-&gt;size
suffix:semicolon
macro_line|#else
id|pTxd-&gt;TBControl
op_or_assign
id|BMU_EOF
op_or
id|sk_frag-&gt;size
suffix:semicolon
macro_line|#endif
id|pTxdFst-&gt;TBControl
op_or_assign
id|BMU_OWN
op_or
id|BMU_SW
suffix:semicolon
)brace
r_else
(brace
id|pTxd-&gt;TBControl
op_or_assign
id|sk_frag-&gt;size
suffix:semicolon
)brace
id|pTxdLst
op_assign
id|pTxd
suffix:semicolon
id|pTxd
op_assign
id|pTxd-&gt;pNextTxd
suffix:semicolon
id|pTxPort-&gt;TxdRingFree
op_decrement
suffix:semicolon
id|BytesSend
op_add_assign
id|sk_frag-&gt;size
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** If previous descriptor already done, give TX start cmd &n;&t;*/
r_if
c_cond
(paren
(paren
id|pTxPort-&gt;pTxdRingPrev-&gt;TBControl
op_amp
id|BMU_OWN
)paren
op_eq
l_int|0
)paren
(brace
id|SK_OUT8
c_func
(paren
id|pTxPort-&gt;HwAddr
comma
id|Q_CSR
comma
id|CSR_START
)paren
suffix:semicolon
)brace
id|pTxPort-&gt;pTxdRingPrev
op_assign
id|pTxdLst
suffix:semicolon
id|pTxPort-&gt;pTxdRingHead
op_assign
id|pTxd
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pTxPort-&gt;TxdRingFree
OG
l_int|0
)paren
(brace
r_return
(paren
id|BytesSend
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*****************************************************************************&n; *&n; * &t;FreeTxDescriptors - release descriptors from the descriptor ring&n; *&n; * Description:&n; *&t;This function releases descriptors from a transmit ring if they&n; *&t;have been sent by the BMU.&n; *&t;If a descriptors is sent, it can be freed and the message can&n; *&t;be freed, too.&n; *&t;The SOFTWARE controllable bit is used to prevent running around a&n; *&t;completely free ring for ever. If this bit is no set in the&n; *&t;frame (by XmitFrame), this frame has never been sent or is&n; *&t;already freed.&n; *&t;The Tx descriptor ring lock must be held while calling this function !!!&n; *&n; * Returns:&n; *&t;none&n; */
DECL|function|FreeTxDescriptors
r_static
r_void
id|FreeTxDescriptors
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context */
id|TX_PORT
op_star
id|pTxPort
)paren
multiline_comment|/* pointer to destination port structure */
(brace
id|TXD
op_star
id|pTxd
suffix:semicolon
multiline_comment|/* pointer to the checked descriptor */
id|TXD
op_star
id|pNewTail
suffix:semicolon
multiline_comment|/* pointer to &squot;end&squot; of the ring */
id|SK_U32
id|Control
suffix:semicolon
multiline_comment|/* TBControl field of descriptor */
id|SK_U64
id|PhysAddr
suffix:semicolon
multiline_comment|/* address of DMA mapping */
id|pNewTail
op_assign
id|pTxPort-&gt;pTxdRingTail
suffix:semicolon
id|pTxd
op_assign
id|pNewTail
suffix:semicolon
multiline_comment|/*&n;&t;** loop forever; exits if BMU_SW bit not set in start frame&n;&t;** or BMU_OWN bit set in any frame&n;&t;*/
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|Control
op_assign
id|pTxd-&gt;TBControl
suffix:semicolon
r_if
c_cond
(paren
(paren
id|Control
op_amp
id|BMU_SW
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;** software controllable bit is set in first&n;&t;&t;&t;** fragment when given to BMU. Not set means that&n;&t;&t;&t;** this fragment was never sent or is already&n;&t;&t;&t;** freed ( -&gt; ring completely free now).&n;&t;&t;&t;*/
id|pTxPort-&gt;pTxdRingTail
op_assign
id|pTxd
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|pAC-&gt;dev
(braket
id|pTxPort-&gt;PortIndex
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Control
op_amp
id|BMU_OWN
)paren
(brace
id|pTxPort-&gt;pTxdRingTail
op_assign
id|pTxd
suffix:semicolon
r_if
c_cond
(paren
id|pTxPort-&gt;TxdRingFree
OG
l_int|0
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|pAC-&gt;dev
(braket
id|pTxPort-&gt;PortIndex
)braket
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t;** release the DMA mapping, because until not unmapped&n;&t;&t;** this buffer is considered being under control of the&n;&t;&t;** adapter card!&n;&t;&t;*/
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pTxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pTxd-&gt;VDataLow
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PhysAddr
comma
id|pTxd-&gt;pMBuf-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Control
op_amp
id|BMU_EOF
)paren
id|DEV_KFREE_SKB_ANY
c_func
(paren
id|pTxd-&gt;pMBuf
)paren
suffix:semicolon
multiline_comment|/* free message */
id|pTxPort-&gt;TxdRingFree
op_increment
suffix:semicolon
id|pTxd-&gt;TBControl
op_and_assign
op_complement
id|BMU_SW
suffix:semicolon
id|pTxd
op_assign
id|pTxd-&gt;pNextTxd
suffix:semicolon
multiline_comment|/* point behind fragment with EOF */
)brace
multiline_comment|/* while(forever) */
)brace
multiline_comment|/* FreeTxDescriptors */
multiline_comment|/*****************************************************************************&n; *&n; * &t;FillRxRing - fill the receive ring with valid descriptors&n; *&n; * Description:&n; *&t;This function fills the receive ring descriptors with data&n; *&t;segments and makes them valid for the BMU.&n; *&t;The active ring is filled completely, if possible.&n; *&t;The non-active ring is filled only partial to save memory.&n; *&n; * Description of rx ring structure:&n; *&t;head - points to the descriptor which will be used next by the BMU&n; *&t;tail - points to the next descriptor to give to the BMU&n; *&t;&n; * Returns:&t;N/A&n; */
DECL|function|FillRxRing
r_static
r_void
id|FillRxRing
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context */
id|RX_PORT
op_star
id|pRxPort
)paren
multiline_comment|/* ptr to port struct for which the ring&n;&t;&t;&t;&t;   should be filled */
(brace
r_int
r_int
id|Flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pRxPort-&gt;RxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|pRxPort-&gt;RxdRingFree
OG
id|pRxPort-&gt;RxFillLimit
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|FillRxDescriptor
c_func
(paren
id|pAC
comma
id|pRxPort
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pRxPort-&gt;RxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
)brace
multiline_comment|/* FillRxRing */
multiline_comment|/*****************************************************************************&n; *&n; * &t;FillRxDescriptor - fill one buffer into the receive ring&n; *&n; * Description:&n; *&t;The function allocates a new receive buffer and&n; *&t;puts it into the next descriptor.&n; *&n; * Returns:&n; *&t;SK_TRUE - a buffer was added to the ring&n; *&t;SK_FALSE - a buffer could not be added&n; */
DECL|function|FillRxDescriptor
r_static
id|SK_BOOL
id|FillRxDescriptor
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context struct */
id|RX_PORT
op_star
id|pRxPort
)paren
multiline_comment|/* ptr to port struct of ring to fill */
(brace
r_struct
id|sk_buff
op_star
id|pMsgBlock
suffix:semicolon
multiline_comment|/* pointer to a new message block */
id|RXD
op_star
id|pRxd
suffix:semicolon
multiline_comment|/* the rxd to fill */
id|SK_U16
id|Length
suffix:semicolon
multiline_comment|/* data fragment length */
id|SK_U64
id|PhysAddr
suffix:semicolon
multiline_comment|/* physical address of a rx buffer */
id|pMsgBlock
op_assign
id|alloc_skb
c_func
(paren
id|pAC-&gt;RxBufSize
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pMsgBlock
op_eq
l_int|NULL
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;%s: Allocation of rx buffer failed !&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
op_member_access_from_pointer
id|name
)paren
)paren
suffix:semicolon
id|SK_PNMI_CNT_NO_RX_BUF
c_func
(paren
id|pAC
comma
id|pRxPort-&gt;PortIndex
)paren
suffix:semicolon
r_return
id|SK_FALSE
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|pMsgBlock
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* to align IP frames */
multiline_comment|/* skb allocated ok, so add buffer */
id|pRxd
op_assign
id|pRxPort-&gt;pRxdRingTail
suffix:semicolon
id|pRxPort-&gt;pRxdRingTail
op_assign
id|pRxd-&gt;pNextRxd
suffix:semicolon
id|pRxPort-&gt;RxdRingFree
op_decrement
suffix:semicolon
id|Length
op_assign
id|pAC-&gt;RxBufSize
suffix:semicolon
id|PhysAddr
op_assign
(paren
id|SK_U64
)paren
id|pci_map_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|virt_to_page
c_func
(paren
id|pMsgBlock-&gt;data
)paren
comma
(paren
(paren
r_int
r_int
)paren
id|pMsgBlock-&gt;data
op_amp
op_complement
id|PAGE_MASK
)paren
comma
id|pAC-&gt;RxBufSize
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|pRxd-&gt;VDataLow
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|pRxd-&gt;VDataHigh
op_assign
(paren
id|SK_U32
)paren
(paren
id|PhysAddr
op_rshift
l_int|32
)paren
suffix:semicolon
id|pRxd-&gt;pMBuf
op_assign
id|pMsgBlock
suffix:semicolon
id|pRxd-&gt;RBControl
op_assign
id|BMU_OWN
op_or
id|BMU_STF
op_or
id|BMU_IRQ_EOF
op_or
id|BMU_TCP_CHECK
op_or
id|Length
suffix:semicolon
r_return
(paren
id|SK_TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* FillRxDescriptor */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ReQueueRxBuffer - fill one buffer back into the receive ring&n; *&n; * Description:&n; *&t;Fill a given buffer back into the rx ring. The buffer&n; *&t;has been previously allocated and aligned, and its phys.&n; *&t;address calculated, so this is no more necessary.&n; *&n; * Returns: N/A&n; */
DECL|function|ReQueueRxBuffer
r_static
r_void
id|ReQueueRxBuffer
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context struct */
id|RX_PORT
op_star
id|pRxPort
comma
multiline_comment|/* ptr to port struct of ring to fill */
r_struct
id|sk_buff
op_star
id|pMsg
comma
multiline_comment|/* pointer to the buffer */
id|SK_U32
id|PhysHigh
comma
multiline_comment|/* phys address high dword */
id|SK_U32
id|PhysLow
)paren
multiline_comment|/* phys address low dword */
(brace
id|RXD
op_star
id|pRxd
suffix:semicolon
multiline_comment|/* the rxd to fill */
id|SK_U16
id|Length
suffix:semicolon
multiline_comment|/* data fragment length */
id|pRxd
op_assign
id|pRxPort-&gt;pRxdRingTail
suffix:semicolon
id|pRxPort-&gt;pRxdRingTail
op_assign
id|pRxd-&gt;pNextRxd
suffix:semicolon
id|pRxPort-&gt;RxdRingFree
op_decrement
suffix:semicolon
id|Length
op_assign
id|pAC-&gt;RxBufSize
suffix:semicolon
id|pRxd-&gt;VDataLow
op_assign
id|PhysLow
suffix:semicolon
id|pRxd-&gt;VDataHigh
op_assign
id|PhysHigh
suffix:semicolon
id|pRxd-&gt;pMBuf
op_assign
id|pMsg
suffix:semicolon
id|pRxd-&gt;RBControl
op_assign
id|BMU_OWN
op_or
id|BMU_STF
op_or
id|BMU_IRQ_EOF
op_or
id|BMU_TCP_CHECK
op_or
id|Length
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* ReQueueRxBuffer */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ReceiveIrq - handle a receive IRQ&n; *&n; * Description:&n; *&t;This function is called when a receive IRQ is set.&n; *&t;It walks the receive descriptor ring and sends up all&n; *&t;frames that are complete.&n; *&n; * Returns:&t;N/A&n; */
DECL|function|ReceiveIrq
r_static
r_void
id|ReceiveIrq
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|RX_PORT
op_star
id|pRxPort
comma
multiline_comment|/* pointer to receive port struct */
id|SK_BOOL
id|SlowPathLock
)paren
multiline_comment|/* indicates if SlowPathLock is needed */
(brace
id|RXD
op_star
id|pRxd
suffix:semicolon
multiline_comment|/* pointer to receive descriptors */
id|SK_U32
id|Control
suffix:semicolon
multiline_comment|/* control field of descriptor */
r_struct
id|sk_buff
op_star
id|pMsg
suffix:semicolon
multiline_comment|/* pointer to message holding frame */
r_struct
id|sk_buff
op_star
id|pNewMsg
suffix:semicolon
multiline_comment|/* pointer to a new message for copying frame */
r_int
id|FrameLength
suffix:semicolon
multiline_comment|/* total length of received frame */
r_int
id|IpFrameLength
suffix:semicolon
id|SK_MBUF
op_star
id|pRlmtMbuf
suffix:semicolon
multiline_comment|/* ptr to a buffer for giving a frame to rlmt */
id|SK_EVPARA
id|EvPara
suffix:semicolon
multiline_comment|/* an event parameter union */
r_int
r_int
id|Flags
suffix:semicolon
multiline_comment|/* for spin lock */
r_int
id|PortIndex
op_assign
id|pRxPort-&gt;PortIndex
suffix:semicolon
r_int
r_int
id|Offset
suffix:semicolon
r_int
r_int
id|NumBytes
suffix:semicolon
r_int
r_int
id|ForRlmt
suffix:semicolon
id|SK_BOOL
id|IsBc
suffix:semicolon
id|SK_BOOL
id|IsMc
suffix:semicolon
id|SK_BOOL
id|IsBadFrame
suffix:semicolon
multiline_comment|/* Bad frame */
id|SK_U32
id|FrameStat
suffix:semicolon
r_int
r_int
id|Csum1
suffix:semicolon
r_int
r_int
id|Csum2
suffix:semicolon
r_int
r_int
id|Type
suffix:semicolon
r_int
id|Result
suffix:semicolon
id|SK_U64
id|PhysAddr
suffix:semicolon
id|rx_start
suffix:colon
multiline_comment|/* do forever; exit if BMU_OWN found */
r_for
c_loop
(paren
id|pRxd
op_assign
id|pRxPort-&gt;pRxdRingHead
suffix:semicolon
id|pRxPort-&gt;RxdRingFree
OL
id|pAC-&gt;RxDescrPerRing
suffix:semicolon
id|pRxd
op_assign
id|pRxd-&gt;pNextRxd
comma
id|pRxPort-&gt;pRxdRingHead
op_assign
id|pRxd
comma
id|pRxPort-&gt;RxdRingFree
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; * For a better understanding of this loop&n;&t;&t; * Go through every descriptor beginning at the head&n;&t;&t; * Please note: the ring might be completely received so the OWN bit&n;&t;&t; * set is not a good crirteria to leave that loop.&n;&t;&t; * Therefore the RingFree counter is used.&n;&t;&t; * On entry of this loop pRxd is a pointer to the Rxd that needs&n;&t;&t; * to be checked next.&n;&t;&t; */
id|Control
op_assign
id|pRxd-&gt;RBControl
suffix:semicolon
multiline_comment|/* check if this descriptor is ready */
r_if
c_cond
(paren
(paren
id|Control
op_amp
id|BMU_OWN
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* this descriptor is not yet ready */
multiline_comment|/* This is the usual end of the loop */
multiline_comment|/* We don&squot;t need to start the ring again */
id|FillRxRing
c_func
(paren
id|pAC
comma
id|pRxPort
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pAC-&gt;DynIrqModInfo.NbrProcessedDescr
op_increment
suffix:semicolon
multiline_comment|/* get length of frame and check it */
id|FrameLength
op_assign
id|Control
op_amp
id|BMU_BBC
suffix:semicolon
r_if
c_cond
(paren
id|FrameLength
OG
id|pAC-&gt;RxBufSize
)paren
(brace
r_goto
id|rx_failed
suffix:semicolon
)brace
multiline_comment|/* check for STF and EOF */
r_if
c_cond
(paren
(paren
id|Control
op_amp
(paren
id|BMU_STF
op_or
id|BMU_EOF
)paren
)paren
op_ne
(paren
id|BMU_STF
op_or
id|BMU_EOF
)paren
)paren
(brace
r_goto
id|rx_failed
suffix:semicolon
)brace
multiline_comment|/* here we have a complete frame in the ring */
id|pMsg
op_assign
id|pRxd-&gt;pMBuf
suffix:semicolon
id|FrameStat
op_assign
id|pRxd-&gt;FrameStat
suffix:semicolon
multiline_comment|/* check for frame length mismatch */
DECL|macro|XMR_FS_LEN_SHIFT
mdefine_line|#define XMR_FS_LEN_SHIFT        18
DECL|macro|GMR_FS_LEN_SHIFT
mdefine_line|#define GMR_FS_LEN_SHIFT        16
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_GENESIS
)paren
(brace
r_if
c_cond
(paren
id|FrameLength
op_ne
(paren
id|SK_U32
)paren
(paren
id|FrameStat
op_rshift
id|XMR_FS_LEN_SHIFT
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;skge: Frame length mismatch (%u/%u).&bslash;n&quot;
comma
id|FrameLength
comma
(paren
id|SK_U32
)paren
(paren
id|FrameStat
op_rshift
id|XMR_FS_LEN_SHIFT
)paren
)paren
)paren
suffix:semicolon
r_goto
id|rx_failed
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|FrameLength
op_ne
(paren
id|SK_U32
)paren
(paren
id|FrameStat
op_rshift
id|GMR_FS_LEN_SHIFT
)paren
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;skge: Frame length mismatch (%u/%u).&bslash;n&quot;
comma
id|FrameLength
comma
(paren
id|SK_U32
)paren
(paren
id|FrameStat
op_rshift
id|XMR_FS_LEN_SHIFT
)paren
)paren
)paren
suffix:semicolon
r_goto
id|rx_failed
suffix:semicolon
)brace
)brace
multiline_comment|/* Set Rx Status */
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_GENESIS
)paren
(brace
id|IsBc
op_assign
(paren
id|FrameStat
op_amp
id|XMR_FS_BC
)paren
op_ne
l_int|0
suffix:semicolon
id|IsMc
op_assign
(paren
id|FrameStat
op_amp
id|XMR_FS_MC
)paren
op_ne
l_int|0
suffix:semicolon
id|IsBadFrame
op_assign
(paren
id|FrameStat
op_amp
(paren
id|XMR_FS_ANY_ERR
op_or
id|XMR_FS_2L_VLAN
)paren
)paren
op_ne
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|IsBc
op_assign
(paren
id|FrameStat
op_amp
id|GMR_FS_BC
)paren
op_ne
l_int|0
suffix:semicolon
id|IsMc
op_assign
(paren
id|FrameStat
op_amp
id|GMR_FS_MC
)paren
op_ne
l_int|0
suffix:semicolon
id|IsBadFrame
op_assign
(paren
(paren
(paren
id|FrameStat
op_amp
id|GMR_FS_ANY_ERR
)paren
op_ne
l_int|0
)paren
op_logical_or
(paren
(paren
id|FrameStat
op_amp
id|GMR_FS_RX_OK
)paren
op_eq
l_int|0
)paren
)paren
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
l_int|0
comma
(paren
l_string|&quot;Received frame of length %d on port %d&bslash;n&quot;
comma
id|FrameLength
comma
id|PortIndex
)paren
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
l_int|0
comma
(paren
l_string|&quot;Number of free rx descriptors: %d&bslash;n&quot;
comma
id|pRxPort-&gt;RxdRingFree
)paren
)paren
suffix:semicolon
multiline_comment|/* DumpMsg(pMsg, &quot;Rx&quot;);&t;*/
r_if
c_cond
(paren
(paren
id|Control
op_amp
id|BMU_STAT_VAL
)paren
op_ne
id|BMU_STAT_VAL
op_logical_or
(paren
id|IsBadFrame
)paren
)paren
(brace
macro_line|#if 0
(paren
id|FrameStat
op_amp
(paren
id|XMR_FS_ANY_ERR
op_or
id|XMR_FS_2L_VLAN
)paren
)paren
op_ne
l_int|0
)paren
(brace
macro_line|#endif
multiline_comment|/* there is a receive error in this frame */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;skge: Error in received frame, dropped!&bslash;n&quot;
l_string|&quot;Control: %x&bslash;nRxStat: %x&bslash;n&quot;
comma
id|Control
comma
id|FrameStat
)paren
)paren
suffix:semicolon
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataLow
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|pAC-&gt;PciDev
comma
(paren
id|dma_addr_t
)paren
id|PhysAddr
comma
id|FrameLength
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|ReQueueRxBuffer
c_func
(paren
id|pAC
comma
id|pRxPort
comma
id|pMsg
comma
id|pRxd-&gt;VDataHigh
comma
id|pRxd-&gt;VDataLow
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * if short frame then copy data to reduce memory waste&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|FrameLength
OL
id|SK_COPY_THRESHOLD
)paren
op_logical_and
(paren
(paren
id|pNewMsg
op_assign
id|alloc_skb
c_func
(paren
id|FrameLength
op_plus
l_int|2
comma
id|GFP_ATOMIC
)paren
)paren
op_ne
l_int|NULL
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Short frame detected and allocation successfull&n;&t;&t;&t; */
multiline_comment|/* use new skb and copy data */
id|skb_reserve
c_func
(paren
id|pNewMsg
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|pNewMsg
comma
id|FrameLength
)paren
suffix:semicolon
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataLow
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|pAC-&gt;PciDev
comma
(paren
id|dma_addr_t
)paren
id|PhysAddr
comma
id|FrameLength
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|pNewMsg
comma
id|pMsg-&gt;data
comma
id|FrameLength
comma
l_int|0
)paren
suffix:semicolon
id|ReQueueRxBuffer
c_func
(paren
id|pAC
comma
id|pRxPort
comma
id|pMsg
comma
id|pRxd-&gt;VDataHigh
comma
id|pRxd-&gt;VDataLow
)paren
suffix:semicolon
id|pMsg
op_assign
id|pNewMsg
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * if large frame, or SKB allocation failed, pass&n;&t;&t;&t; * the SKB directly to the networking&n;&t;&t;&t; */
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataLow
suffix:semicolon
multiline_comment|/* release the DMA mapping */
id|pci_unmap_single
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PhysAddr
comma
id|pAC-&gt;RxBufSize
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* set length in message */
id|skb_put
c_func
(paren
id|pMsg
comma
id|FrameLength
)paren
suffix:semicolon
multiline_comment|/* hardware checksum */
id|Type
op_assign
id|ntohs
c_func
(paren
op_star
(paren
(paren
r_int
op_star
)paren
op_amp
id|pMsg-&gt;data
(braket
l_int|12
)braket
)paren
)paren
suffix:semicolon
macro_line|#ifdef USE_SK_RX_CHECKSUM
r_if
c_cond
(paren
id|Type
op_eq
l_int|0x800
)paren
(brace
id|Csum1
op_assign
id|le16_to_cpu
c_func
(paren
id|pRxd-&gt;TcpSums
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|Csum2
op_assign
id|le16_to_cpu
c_func
(paren
(paren
id|pRxd-&gt;TcpSums
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|IpFrameLength
op_assign
(paren
r_int
)paren
id|ntohs
c_func
(paren
(paren
r_int
r_int
)paren
(paren
(paren
r_int
r_int
op_star
)paren
id|pMsg-&gt;data
)paren
(braket
l_int|8
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Test: If frame is padded, a check is not possible!&n;&t;&t;&t;&t; * Frame not padded? Length difference must be 14 (0xe)!&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|FrameLength
op_minus
id|IpFrameLength
)paren
op_ne
l_int|0xe
)paren
(brace
multiline_comment|/* Frame padded =&gt; TCP offload not possible! */
id|pMsg-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Frame not padded =&gt; TCP offload! */
r_if
c_cond
(paren
(paren
(paren
(paren
id|Csum1
op_amp
l_int|0xfffe
)paren
op_logical_and
(paren
id|Csum2
op_amp
l_int|0xfffe
)paren
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIChipId
op_eq
id|CHIP_ID_GENESIS
)paren
)paren
op_logical_or
(paren
id|pAC-&gt;ChipsetType
)paren
)paren
(brace
id|Result
op_assign
id|SkCsGetReceiveInfo
c_func
(paren
id|pAC
comma
op_amp
id|pMsg-&gt;data
(braket
l_int|14
)braket
comma
id|Csum1
comma
id|Csum2
comma
id|pRxPort-&gt;PortIndex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Result
op_eq
id|SKCS_STATUS_IP_FRAGMENT
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_IP_CSUM_OK
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_TCP_CSUM_OK
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_UDP_CSUM_OK
)paren
(brace
id|pMsg-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Result
op_eq
id|SKCS_STATUS_TCP_CSUM_ERROR
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_UDP_CSUM_ERROR
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_IP_CSUM_ERROR_UDP
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_IP_CSUM_ERROR_TCP
op_logical_or
id|Result
op_eq
id|SKCS_STATUS_IP_CSUM_ERROR
)paren
(brace
multiline_comment|/* HW Checksum error */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;skge: CRC error. Frame dropped!&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_goto
id|rx_failed
suffix:semicolon
)brace
r_else
(brace
id|pMsg-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
)brace
)brace
multiline_comment|/* checksumControl calculation valid */
)brace
multiline_comment|/* Frame length check */
)brace
multiline_comment|/* IP frame */
macro_line|#else
id|pMsg-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* frame &gt; SK_COPY_TRESHOLD */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
l_int|1
comma
(paren
l_string|&quot;V&quot;
)paren
)paren
suffix:semicolon
id|ForRlmt
op_assign
id|SK_RLMT_RX_PROTOCOL
suffix:semicolon
macro_line|#if 0
id|IsBc
op_assign
(paren
id|FrameStat
op_amp
id|XMR_FS_BC
)paren
op_eq
id|XMR_FS_BC
suffix:semicolon
macro_line|#endif
id|SK_RLMT_PRE_LOOKAHEAD
c_func
(paren
id|pAC
comma
id|PortIndex
comma
id|FrameLength
comma
id|IsBc
comma
op_amp
id|Offset
comma
op_amp
id|NumBytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|NumBytes
op_ne
l_int|0
)paren
(brace
macro_line|#if 0
id|IsMc
op_assign
(paren
id|FrameStat
op_amp
id|XMR_FS_MC
)paren
op_eq
id|XMR_FS_MC
suffix:semicolon
macro_line|#endif
id|SK_RLMT_LOOKAHEAD
c_func
(paren
id|pAC
comma
id|PortIndex
comma
op_amp
id|pMsg-&gt;data
(braket
id|Offset
)braket
comma
id|IsBc
comma
id|IsMc
comma
op_amp
id|ForRlmt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ForRlmt
op_eq
id|SK_RLMT_RX_PROTOCOL
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
l_int|1
comma
(paren
l_string|&quot;W&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* send up only frames from active port */
r_if
c_cond
(paren
(paren
id|PortIndex
op_eq
id|pAC-&gt;ActivePort
)paren
op_logical_or
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
multiline_comment|/* frame for upper layer */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
l_int|1
comma
(paren
l_string|&quot;U&quot;
)paren
)paren
suffix:semicolon
macro_line|#ifdef xDEBUG
id|DumpMsg
c_func
(paren
id|pMsg
comma
l_string|&quot;Rx&quot;
)paren
suffix:semicolon
macro_line|#endif
id|SK_PNMI_CNT_RX_OCTETS_DELIVERED
c_func
(paren
id|pAC
comma
id|FrameLength
comma
id|pRxPort-&gt;PortIndex
)paren
suffix:semicolon
id|pMsg-&gt;dev
op_assign
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
suffix:semicolon
id|pMsg-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|pMsg
comma
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|pMsg
)paren
suffix:semicolon
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
op_member_access_from_pointer
id|last_rx
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* drop frame */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;D&quot;
)paren
)paren
suffix:semicolon
id|DEV_KFREE_SKB
c_func
(paren
id|pMsg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* if not for rlmt */
r_else
(brace
multiline_comment|/* packet for rlmt */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;R&quot;
)paren
)paren
suffix:semicolon
id|pRlmtMbuf
op_assign
id|SkDrvAllocRlmtMbuf
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|FrameLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pRlmtMbuf
op_ne
l_int|NULL
)paren
(brace
id|pRlmtMbuf-&gt;pNext
op_assign
l_int|NULL
suffix:semicolon
id|pRlmtMbuf-&gt;Length
op_assign
id|FrameLength
suffix:semicolon
id|pRlmtMbuf-&gt;PortIdx
op_assign
id|PortIndex
suffix:semicolon
id|EvPara.pParaPtr
op_assign
id|pRlmtMbuf
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
(paren
id|pRlmtMbuf-&gt;pData
)paren
comma
(paren
r_char
op_star
)paren
(paren
id|pMsg-&gt;data
)paren
comma
id|FrameLength
)paren
suffix:semicolon
multiline_comment|/* SlowPathLock needed? */
r_if
c_cond
(paren
id|SlowPathLock
op_eq
id|SK_TRUE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PACKET_RECEIVED
comma
id|EvPara
)paren
suffix:semicolon
id|pAC-&gt;CheckQueue
op_assign
id|SK_TRUE
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_PACKET_RECEIVED
comma
id|EvPara
)paren
suffix:semicolon
id|pAC-&gt;CheckQueue
op_assign
id|SK_TRUE
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_RX_PROGRESS
comma
(paren
l_string|&quot;Q&quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
op_member_access_from_pointer
id|flags
op_amp
(paren
id|IFF_PROMISC
op_or
id|IFF_ALLMULTI
)paren
)paren
op_ne
l_int|0
op_logical_or
(paren
id|ForRlmt
op_amp
id|SK_RLMT_RX_PROTOCOL
)paren
op_eq
id|SK_RLMT_RX_PROTOCOL
)paren
(brace
id|pMsg-&gt;dev
op_assign
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
suffix:semicolon
id|pMsg-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|pMsg
comma
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|pMsg
)paren
suffix:semicolon
id|pAC-&gt;dev
(braket
id|pRxPort-&gt;PortIndex
)braket
op_member_access_from_pointer
id|last_rx
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
id|DEV_KFREE_SKB
c_func
(paren
id|pMsg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* if packet for rlmt */
)brace
multiline_comment|/* for ... scanning the RXD ring */
multiline_comment|/* RXD ring is empty -&gt; fill and restart */
id|FillRxRing
c_func
(paren
id|pAC
comma
id|pRxPort
)paren
suffix:semicolon
multiline_comment|/* do not start if called from Close */
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
OG
id|SK_INIT_DATA
)paren
(brace
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
id|PortIndex
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
id|rx_failed
suffix:colon
multiline_comment|/* remove error frame */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ERROR
comma
(paren
l_string|&quot;Schrottdescriptor, length: 0x%x&bslash;n&quot;
comma
id|FrameLength
)paren
)paren
suffix:semicolon
multiline_comment|/* release the DMA mapping */
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataLow
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PhysAddr
comma
id|pAC-&gt;RxBufSize
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|DEV_KFREE_SKB_IRQ
c_func
(paren
id|pRxd-&gt;pMBuf
)paren
suffix:semicolon
id|pRxd-&gt;pMBuf
op_assign
l_int|NULL
suffix:semicolon
id|pRxPort-&gt;RxdRingFree
op_increment
suffix:semicolon
id|pRxPort-&gt;pRxdRingHead
op_assign
id|pRxd-&gt;pNextRxd
suffix:semicolon
r_goto
id|rx_start
suffix:semicolon
)brace
multiline_comment|/* ReceiveIrq */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ClearAndStartRx - give a start receive command to BMU, clear IRQ&n; *&n; * Description:&n; *&t;This function sends a start command and a clear interrupt&n; *&t;command for one receive queue to the BMU.&n; *&n; * Returns: N/A&n; *&t;none&n; */
DECL|function|ClearAndStartRx
r_static
r_void
id|ClearAndStartRx
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context */
r_int
id|PortIndex
)paren
multiline_comment|/* index of the receive port (XMAC) */
(brace
id|SK_OUT8
c_func
(paren
id|pAC-&gt;IoBase
comma
id|RxQueueAddr
(braket
id|PortIndex
)braket
op_plus
id|Q_CSR
comma
id|CSR_START
op_or
id|CSR_IRQ_CL_F
)paren
suffix:semicolon
)brace
multiline_comment|/* ClearAndStartRx */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ClearTxIrq - give a clear transmit IRQ command to BMU&n; *&n; * Description:&n; *&t;This function sends a clear tx IRQ command for one&n; *&t;transmit queue to the BMU.&n; *&n; * Returns: N/A&n; */
DECL|function|ClearTxIrq
r_static
r_void
id|ClearTxIrq
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to the adapter context */
r_int
id|PortIndex
comma
multiline_comment|/* index of the transmit port (XMAC) */
r_int
id|Prio
)paren
multiline_comment|/* priority or normal queue */
(brace
id|SK_OUT8
c_func
(paren
id|pAC-&gt;IoBase
comma
id|TxQueueAddr
(braket
id|PortIndex
)braket
(braket
id|Prio
)braket
op_plus
id|Q_CSR
comma
id|CSR_IRQ_CL_F
)paren
suffix:semicolon
)brace
multiline_comment|/* ClearTxIrq */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ClearRxRing - remove all buffers from the receive ring&n; *&n; * Description:&n; *&t;This function removes all receive buffers from the ring.&n; *&t;The receive BMU must be stopped before calling this function.&n; *&n; * Returns: N/A&n; */
DECL|function|ClearRxRing
r_static
r_void
id|ClearRxRing
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|RX_PORT
op_star
id|pRxPort
)paren
multiline_comment|/* pointer to rx port struct */
(brace
id|RXD
op_star
id|pRxd
suffix:semicolon
multiline_comment|/* pointer to the current descriptor */
r_int
r_int
id|Flags
suffix:semicolon
id|SK_U64
id|PhysAddr
suffix:semicolon
r_if
c_cond
(paren
id|pRxPort-&gt;RxdRingFree
op_eq
id|pAC-&gt;RxDescrPerRing
)paren
(brace
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pRxPort-&gt;RxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|pRxd
op_assign
id|pRxPort-&gt;pRxdRingHead
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|pRxd-&gt;pMBuf
op_ne
l_int|NULL
)paren
(brace
id|PhysAddr
op_assign
(paren
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataHigh
)paren
op_lshift
(paren
id|SK_U64
)paren
l_int|32
suffix:semicolon
id|PhysAddr
op_or_assign
(paren
id|SK_U64
)paren
id|pRxd-&gt;VDataLow
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PhysAddr
comma
id|pAC-&gt;RxBufSize
op_minus
l_int|2
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|DEV_KFREE_SKB
c_func
(paren
id|pRxd-&gt;pMBuf
)paren
suffix:semicolon
id|pRxd-&gt;pMBuf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|pRxd-&gt;RBControl
op_and_assign
id|BMU_OWN
suffix:semicolon
id|pRxd
op_assign
id|pRxd-&gt;pNextRxd
suffix:semicolon
id|pRxPort-&gt;RxdRingFree
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pRxd
op_ne
id|pRxPort-&gt;pRxdRingTail
)paren
suffix:semicolon
id|pRxPort-&gt;pRxdRingTail
op_assign
id|pRxPort-&gt;pRxdRingHead
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pRxPort-&gt;RxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
)brace
multiline_comment|/* ClearRxRing */
multiline_comment|/*****************************************************************************&n; *&n; *&t;ClearTxRing - remove all buffers from the transmit ring&n; *&n; * Description:&n; *&t;This function removes all transmit buffers from the ring.&n; *&t;The transmit BMU must be stopped before calling this function&n; *&t;and transmitting at the upper level must be disabled.&n; *&t;The BMU own bit of all descriptors is cleared, the rest is&n; *&t;done by calling FreeTxDescriptors.&n; *&n; * Returns: N/A&n; */
DECL|function|ClearTxRing
r_static
r_void
id|ClearTxRing
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|TX_PORT
op_star
id|pTxPort
)paren
multiline_comment|/* pointer to tx prt struct */
(brace
id|TXD
op_star
id|pTxd
suffix:semicolon
multiline_comment|/* pointer to the current descriptor */
r_int
id|i
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|pTxd
op_assign
id|pTxPort-&gt;pTxdRingHead
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;TxDescrPerRing
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pTxd-&gt;TBControl
op_and_assign
op_complement
id|BMU_OWN
suffix:semicolon
id|pTxd
op_assign
id|pTxd-&gt;pNextTxd
suffix:semicolon
)brace
id|FreeTxDescriptors
c_func
(paren
id|pAC
comma
id|pTxPort
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pTxPort-&gt;TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
)brace
multiline_comment|/* ClearTxRing */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeSetMacAddr - Set the hardware MAC address&n; *&n; * Description:&n; *&t;This function sets the MAC address used by the adapter.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|SkGeSetMacAddr
r_static
r_int
id|SkGeSetMacAddr
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
id|DEV_NET
op_star
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|SK_AC
op_star
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeSetMacAddr starts now...&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
id|SkAddrOverride
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pNet-&gt;NetNr
comma
(paren
id|SK_MAC_ADDR
op_star
)paren
id|dev-&gt;dev_addr
comma
id|SK_ADDR_VIRTUAL_ADDRESS
)paren
suffix:semicolon
r_else
id|SkAddrOverride
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pAC-&gt;ActivePort
comma
(paren
id|SK_MAC_ADDR
op_star
)paren
id|dev-&gt;dev_addr
comma
id|SK_ADDR_VIRTUAL_ADDRESS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkGeSetMacAddr */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeSetRxMode - set receive mode&n; *&n; * Description:&n; *&t;This function sets the receive mode of an adapter. The adapter&n; *&t;supports promiscuous mode, allmulticast mode and a number of&n; *&t;multicast addresses. If more multicast addresses the available&n; *&t;are selected, a hash function in the hardware is used.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|SkGeSetRxMode
r_static
r_void
id|SkGeSetRxMode
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|pMcList
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|PortIdx
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeSetRxMode starts now... &quot;
)paren
)paren
suffix:semicolon
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|1
)paren
id|PortIdx
op_assign
id|pAC-&gt;ActivePort
suffix:semicolon
r_else
id|PortIdx
op_assign
id|pNet-&gt;NetNr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;PROMISCUOUS mode&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
id|SK_PROM_MODE_LLC
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;ALLMULTI mode&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
id|SK_PROM_MODE_ALL_MC
)paren
suffix:semicolon
)brace
r_else
(brace
id|SkAddrPromiscuousChange
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
id|SK_PROM_MODE_NONE
)paren
suffix:semicolon
id|SkAddrMcClear
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
l_int|0
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;Number of MC entries: %d &quot;
comma
id|dev-&gt;mc_count
)paren
)paren
suffix:semicolon
id|pMcList
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|pMcList
op_assign
id|pMcList-&gt;next
)paren
(brace
id|SkAddrMcAdd
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
comma
(paren
id|SK_MAC_ADDR
op_star
)paren
id|pMcList-&gt;dmi_addr
comma
l_int|0
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_MCA
comma
(paren
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|0
)braket
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|1
)braket
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|2
)braket
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|3
)braket
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|4
)braket
comma
id|pMcList-&gt;dmi_addr
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
)brace
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|PortIdx
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* SkGeSetRxMode */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeChangeMtu - set the MTU to another value&n; *&n; * Description:&n; *&t;This function sets is called whenever the MTU size is changed&n; *&t;(ifconfig mtu xxx dev ethX). If the MTU is bigger than standard&n; *&t;ethernet MTU size, long frame support is activated.&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|SkGeChangeMtu
r_static
r_int
id|SkGeChangeMtu
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_int
id|NewMtu
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|DEV_NET
op_star
id|pOtherNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|SK_EVPARA
id|EvPara
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeChangeMtu starts now...&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NewMtu
OL
l_int|68
)paren
op_logical_or
(paren
id|NewMtu
OG
id|SK_JUMBO_MTU
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
op_ne
id|SK_INIT_RUN
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef SK_DIAG_SUPPORT
r_if
c_cond
(paren
id|pAC-&gt;DiagModeActive
op_eq
id|DIAG_ACTIVE
)paren
(brace
r_if
c_cond
(paren
id|pAC-&gt;DiagFlowCtrl
op_eq
id|SK_FALSE
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* still in use, deny any actions of MTU */
)brace
r_else
(brace
id|pAC-&gt;DiagFlowCtrl
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
macro_line|#endif
id|pNet-&gt;Mtu
op_assign
id|NewMtu
suffix:semicolon
id|pOtherNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|pAC-&gt;dev
(braket
l_int|1
op_minus
id|pNet-&gt;NetNr
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pOtherNet-&gt;Mtu
OG
l_int|1500
)paren
op_logical_and
(paren
id|NewMtu
op_le
l_int|1500
)paren
op_logical_and
(paren
id|pOtherNet-&gt;Up
op_eq
l_int|1
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|pAC-&gt;RxBufSize
op_assign
id|NewMtu
op_plus
l_int|32
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|NewMtu
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;New MTU: %d&bslash;n&quot;
comma
id|NewMtu
)paren
)paren
suffix:semicolon
multiline_comment|/* &n;&t;** Prevent any reconfiguration while changing the MTU &n;&t;** by disabling any interrupts &n;&t;*/
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* &n;&t;** Notify RLMT that any ports are to be stopped&n;&t;*/
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
)brace
r_else
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_STOP
comma
id|EvPara
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** After calling the SkEventDispatcher(), RLMT is aware about&n;&t;** the stopped ports -&gt; configuration can take place!&n;&t;*/
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|pAC-&gt;dev
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Depending on the desired MTU size change, a different number of &n;&t;** RX buffers need to be allocated&n;&t;*/
r_if
c_cond
(paren
id|NewMtu
OG
l_int|1500
)paren
(brace
multiline_comment|/* &n;&t;    ** Use less rx buffers &n;&t;    */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
id|pAC-&gt;RxDescrPerRing
op_minus
(paren
id|pAC-&gt;RxDescrPerRing
op_div
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i
op_eq
id|pAC-&gt;ActivePort
)paren
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
id|pAC-&gt;RxDescrPerRing
op_minus
(paren
id|pAC-&gt;RxDescrPerRing
op_div
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
id|pAC-&gt;RxDescrPerRing
op_minus
(paren
id|pAC-&gt;RxDescrPerRing
op_div
l_int|10
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
multiline_comment|/* &n;&t;    ** Use the normal amount of rx buffers &n;&t;    */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i
op_eq
id|pAC-&gt;ActivePort
)paren
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;RxPort
(braket
id|i
)braket
dot
id|RxFillLimit
op_assign
id|pAC-&gt;RxDescrPerRing
op_minus
(paren
id|pAC-&gt;RxDescrPerRing
op_div
l_int|4
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|SkGeDeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
multiline_comment|/*&n;&t;** enable/disable hardware support for long frames&n;&t;*/
r_if
c_cond
(paren
id|NewMtu
OG
l_int|1500
)paren
(brace
singleline_comment|// pAC-&gt;JumboActivated = SK_TRUE; /* is never set back !!! */
id|pAC-&gt;GIni.GIPortUsage
op_assign
id|SK_JUMBO_LINK
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
id|pAC-&gt;GIni.GIPortUsage
op_assign
id|SK_MUL_LINK
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;GIni.GIPortUsage
op_assign
id|SK_RED_LINK
suffix:semicolon
)brace
)brace
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkI2cInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkEventInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkPnmiInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkAddrInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkRlmtInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
id|SkTimerInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_IO
)paren
suffix:semicolon
multiline_comment|/*&n;&t;** tschilling:&n;&t;** Speed and others are set back to default in level 1 init!&n;&t;*/
id|GetConfiguration
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkGeInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkI2cInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkEventInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkPnmiInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkAddrInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkRlmtInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
id|SkTimerInit
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|SK_INIT_RUN
)paren
suffix:semicolon
multiline_comment|/*&n;&t;** clear and reinit the rx rings here&n;&t;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pAC-&gt;GIni.GIMacsFound
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
comma
id|SK_TRUE
)paren
suffix:semicolon
id|ClearRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
)paren
suffix:semicolon
id|FillRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t;** Enable transmit descriptor polling&n;&t;&t;*/
id|SkGePollTxD
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|i
comma
id|SK_TRUE
)paren
suffix:semicolon
id|FillRxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
suffix:semicolon
id|SkGeYellowLED
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
l_int|1
)paren
suffix:semicolon
id|SkDimEnableModerationIfNeeded
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkDimDisplayModerationSettings
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|pAC-&gt;dev
(braket
id|pNet-&gt;PortNr
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|pAC-&gt;GIni.GIMacsFound
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|i
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
)paren
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** Enable Interrupts again &n;&t;*/
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
id|pAC-&gt;GIni.GIValIrqMask
)paren
suffix:semicolon
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_HWE_IMSK
comma
id|IRQ_HWE_MASK
)paren
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_START
comma
id|EvPara
)paren
suffix:semicolon
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
multiline_comment|/* &n;&t;** Notify RLMT about the changing and restarting one (or more) ports&n;&t;*/
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
)paren
(brace
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;RlmtNets
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_SET_NETS
comma
id|EvPara
)paren
suffix:semicolon
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pNet-&gt;PortNr
suffix:semicolon
id|EvPara.Para32
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_START
comma
id|EvPara
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pOtherNet-&gt;Up
)paren
(brace
id|EvPara.Para32
(braket
l_int|0
)braket
op_assign
id|pOtherNet-&gt;PortNr
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_START
comma
id|EvPara
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_RLMT
comma
id|SK_RLMT_START
comma
id|EvPara
)paren
suffix:semicolon
)brace
id|SkEventDispatcher
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t;** While testing this driver with latest kernel 2.5 (2.5.70), it &n;&t;** seems as if upper layers have a problem to handle a successful&n;&t;** return value of &squot;0&squot;. If such a zero is returned, the complete &n;&t;** system hangs for several minutes (!), which is in acceptable.&n;&t;**&n;&t;** Currently it is not clear, what the exact reason for this problem&n;&t;** is. The implemented workaround for 2.5 is to return the desired &n;&t;** new MTU size if all needed changes for the new MTU size where &n;&t;** performed. In kernels 2.2 and 2.4, a zero value is returned,&n;&t;** which indicates the successful change of the mtu-size.&n;&t;*/
r_return
id|NewMtu
suffix:semicolon
)brace
multiline_comment|/* SkGeChangeMtu */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeStats - return ethernet device statistics&n; *&n; * Description:&n; *&t;This function return statistic data about the ethernet device&n; *&t;to the operating system.&n; *&n; * Returns:&n; *&t;pointer to the statistic structure.&n; */
DECL|function|SkGeStats
r_static
r_struct
id|net_device_stats
op_star
id|SkGeStats
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
)paren
(brace
id|DEV_NET
op_star
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|SK_AC
op_star
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|SK_PNMI_STRUCT_DATA
op_star
id|pPnmiStruct
suffix:semicolon
multiline_comment|/* structure for all Pnmi-Data */
id|SK_PNMI_STAT
op_star
id|pPnmiStat
suffix:semicolon
multiline_comment|/* pointer to virtual XMAC stat. data */
id|SK_PNMI_CONF
op_star
id|pPnmiConf
suffix:semicolon
multiline_comment|/* pointer to virtual link config. */
r_int
r_int
id|Size
suffix:semicolon
multiline_comment|/* size of pnmi struct */
r_int
r_int
id|Flags
suffix:semicolon
multiline_comment|/* for spin lock */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeStats starts now...&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|pPnmiStruct
op_assign
op_amp
id|pAC-&gt;PnmiStruct
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
r_if
c_cond
(paren
(paren
id|pAC-&gt;DiagModeActive
op_eq
id|DIAG_NOTACTIVE
)paren
op_logical_and
(paren
id|pAC-&gt;BoardLevel
op_eq
id|SK_INIT_RUN
)paren
)paren
(brace
macro_line|#endif
id|SK_MEMSET
c_func
(paren
id|pPnmiStruct
comma
l_int|0
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|Size
op_assign
id|SK_PNMI_STRUCT_SIZE
suffix:semicolon
id|SkPnmiGetStruct
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pPnmiStruct
comma
op_amp
id|Size
comma
id|pNet-&gt;NetNr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
)brace
macro_line|#endif
id|pPnmiStat
op_assign
op_amp
id|pPnmiStruct-&gt;Stat
(braket
l_int|0
)braket
suffix:semicolon
id|pPnmiConf
op_assign
op_amp
id|pPnmiStruct-&gt;Conf
(braket
l_int|0
)braket
suffix:semicolon
id|pAC-&gt;stats.rx_packets
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStruct-&gt;RxDeliveredCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.tx_packets
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxOkCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_bytes
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStruct-&gt;RxOctetsDeliveredCts
suffix:semicolon
id|pAC-&gt;stats.tx_bytes
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxOctetsOkCts
suffix:semicolon
r_if
c_cond
(paren
id|pNet-&gt;Mtu
op_le
l_int|1500
)paren
(brace
id|pAC-&gt;stats.rx_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStruct-&gt;InErrorsCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;stats.rx_errors
op_assign
(paren
id|SK_U32
)paren
(paren
(paren
id|pPnmiStruct-&gt;InErrorsCts
op_minus
id|pPnmiStat-&gt;StatRxTooLongCts
)paren
op_amp
l_int|0xFFFFFFFF
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pAC-&gt;GIni.GP
(braket
l_int|0
)braket
dot
id|PhyType
op_eq
id|SK_PHY_XMAC
op_logical_and
id|pAC-&gt;HWRevision
OL
l_int|12
)paren
id|pAC-&gt;stats.rx_errors
op_assign
id|pAC-&gt;stats.rx_errors
op_minus
id|pPnmiStat-&gt;StatRxShortsCts
suffix:semicolon
id|pAC-&gt;stats.tx_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxSingleCollisionCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_dropped
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStruct-&gt;RxNoBufCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.tx_dropped
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStruct-&gt;TxNoBufCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.multicast
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxMulticastOkCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.collisions
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxSingleCollisionCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
multiline_comment|/* detailed rx_errors: */
id|pAC-&gt;stats.rx_length_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxRuntCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_over_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxFifoOverflowCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_crc_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxFcsCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_frame_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxFramingCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_fifo_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxFifoOverflowCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.rx_missed_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatRxMissedCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
multiline_comment|/* detailed tx_errors */
id|pAC-&gt;stats.tx_aborted_errors
op_assign
(paren
id|SK_U32
)paren
l_int|0
suffix:semicolon
id|pAC-&gt;stats.tx_carrier_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxCarrierCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.tx_fifo_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxFifoUnderrunCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.tx_heartbeat_errors
op_assign
(paren
id|SK_U32
)paren
id|pPnmiStat-&gt;StatTxCarrierCts
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
id|pAC-&gt;stats.tx_window_errors
op_assign
(paren
id|SK_U32
)paren
l_int|0
suffix:semicolon
r_return
op_amp
id|pAC-&gt;stats
suffix:semicolon
)brace
multiline_comment|/* SkGeStats */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeIoctl - IO-control function&n; *&n; * Description:&n; *&t;This function is called if an ioctl is issued on the device.&n; *&t;There are three subfunction for reading, writing and test-writing&n; *&t;the private MIB data structure (usefull for SysKonnect-internal tools).&n; *&n; * Returns:&n; *&t;0, if everything is ok&n; *&t;!=0, on error&n; */
DECL|function|SkGeIoctl
r_static
r_int
id|SkGeIoctl
c_func
(paren
r_struct
id|SK_NET_DEVICE
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
id|DEV_NET
op_star
id|pNet
suffix:semicolon
id|SK_AC
op_star
id|pAC
suffix:semicolon
r_void
op_star
id|pMemBuf
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
l_int|NULL
suffix:semicolon
id|SK_GE_IOCTL
id|Ioctl
suffix:semicolon
r_int
r_int
id|Err
op_assign
l_int|0
suffix:semicolon
r_int
id|Size
op_assign
l_int|0
suffix:semicolon
r_int
id|Ret
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|Length
op_assign
l_int|0
suffix:semicolon
r_int
id|HeaderLength
op_assign
r_sizeof
(paren
id|SK_U32
)paren
op_plus
r_sizeof
(paren
id|SK_U32
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeIoctl starts now...&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|Ioctl
comma
id|rq-&gt;ifr_data
comma
r_sizeof
(paren
id|SK_GE_IOCTL
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SK_IOCTL_SETMIB
suffix:colon
r_case
id|SK_IOCTL_PRESETMIB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_case
id|SK_IOCTL_GETMIB
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|pAC-&gt;PnmiStruct
comma
id|Ioctl.pData
comma
id|Ioctl.Len
OL
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
ques
c_cond
id|Ioctl.Len
suffix:colon
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|Size
op_assign
id|SkGeIocMib
c_func
(paren
id|pNet
comma
id|Ioctl.Len
comma
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|Ioctl.pData
comma
op_amp
id|pAC-&gt;PnmiStruct
comma
id|Ioctl.Len
OL
id|Size
ques
c_cond
id|Ioctl.Len
suffix:colon
id|Size
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|Ioctl.Len
op_assign
id|Size
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|rq-&gt;ifr_data
comma
op_amp
id|Ioctl
comma
r_sizeof
(paren
id|SK_GE_IOCTL
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SK_IOCTL_GEN
suffix:colon
r_if
c_cond
(paren
id|Ioctl.Len
OL
(paren
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
op_plus
id|HeaderLength
)paren
)paren
(brace
id|Length
op_assign
id|Ioctl.Len
suffix:semicolon
)brace
r_else
(brace
id|Length
op_assign
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
op_plus
id|HeaderLength
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|pMemBuf
op_assign
id|kmalloc
c_func
(paren
id|Length
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|pMemBuf
comma
id|Ioctl.pData
comma
id|Length
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_gen
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|Ret
op_assign
id|SkPnmiGenIoctl
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pMemBuf
comma
op_amp
id|Length
comma
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_gen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|Ioctl.pData
comma
id|pMemBuf
comma
id|Length
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_gen
suffix:semicolon
)brace
id|Ioctl.Len
op_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|rq-&gt;ifr_data
comma
op_amp
id|Ioctl
comma
r_sizeof
(paren
id|SK_GE_IOCTL
)paren
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_gen
suffix:semicolon
)brace
id|fault_gen
suffix:colon
id|kfree
c_func
(paren
id|pMemBuf
)paren
suffix:semicolon
multiline_comment|/* cleanup everything */
r_break
suffix:semicolon
macro_line|#ifdef SK_DIAG_SUPPORT
r_case
id|SK_IOCTL_DIAG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|Ioctl.Len
OL
(paren
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
op_plus
id|HeaderLength
)paren
)paren
(brace
id|Length
op_assign
id|Ioctl.Len
suffix:semicolon
)brace
r_else
(brace
id|Length
op_assign
r_sizeof
(paren
id|pAC-&gt;PnmiStruct
)paren
op_plus
id|HeaderLength
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|pMemBuf
op_assign
id|kmalloc
c_func
(paren
id|Length
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|pMemBuf
comma
id|Ioctl.pData
comma
id|Length
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_diag
suffix:semicolon
)brace
id|pdev
op_assign
id|pAC-&gt;PciDev
suffix:semicolon
id|Length
op_assign
l_int|3
op_star
r_sizeof
(paren
id|SK_U32
)paren
suffix:semicolon
multiline_comment|/* Error, Bus and Device */
multiline_comment|/* &n;&t;&t;** While coding this new IOCTL interface, only a few lines of code&n;&t;&t;** are to to be added. Therefore no dedicated function has been &n;&t;&t;** added. If more functionality is added, a separate function &n;&t;&t;** should be used...&n;&t;&t;*/
op_star
(paren
(paren
id|SK_U32
op_star
)paren
id|pMemBuf
)paren
op_assign
l_int|0
suffix:semicolon
op_star
(paren
(paren
id|SK_U32
op_star
)paren
id|pMemBuf
op_plus
l_int|1
)paren
op_assign
id|pdev-&gt;bus-&gt;number
suffix:semicolon
op_star
(paren
(paren
id|SK_U32
op_star
)paren
id|pMemBuf
op_plus
l_int|2
)paren
op_assign
id|ParseDeviceNbrFromSlotName
c_func
(paren
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|Ioctl.pData
comma
id|pMemBuf
comma
id|Length
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_diag
suffix:semicolon
)brace
id|Ioctl.Len
op_assign
id|Length
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|rq-&gt;ifr_data
comma
op_amp
id|Ioctl
comma
r_sizeof
(paren
id|SK_GE_IOCTL
)paren
)paren
)paren
(brace
id|Err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|fault_diag
suffix:semicolon
)brace
id|fault_diag
suffix:colon
id|kfree
c_func
(paren
id|pMemBuf
)paren
suffix:semicolon
multiline_comment|/* cleanup everything */
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|Err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
id|Err
suffix:semicolon
)brace
multiline_comment|/* SkGeIoctl */
multiline_comment|/*****************************************************************************&n; *&n; * &t;SkGeIocMib - handle a GetMib, SetMib- or PresetMib-ioctl message&n; *&n; * Description:&n; *&t;This function reads/writes the MIB data using PNMI (Private Network&n; *&t;Management Interface).&n; *&t;The destination for the data must be provided with the&n; *&t;ioctl call and is given to the driver in the form of&n; *&t;a user space address.&n; *&t;Copying from the user-provided data area into kernel messages&n; *&t;and back is done by copy_from_user and copy_to_user calls in&n; *&t;SkGeIoctl.&n; *&n; * Returns:&n; *&t;returned size from PNMI call&n; */
DECL|function|SkGeIocMib
r_static
r_int
id|SkGeIocMib
c_func
(paren
id|DEV_NET
op_star
id|pNet
comma
multiline_comment|/* pointer to the adapter context */
r_int
r_int
id|Size
comma
multiline_comment|/* length of ioctl data */
r_int
id|mode
)paren
multiline_comment|/* flag for set/preset */
(brace
r_int
r_int
id|Flags
suffix:semicolon
multiline_comment|/* for spin lock */
id|SK_AC
op_star
id|pAC
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;SkGeIocMib starts now...&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
multiline_comment|/* access MIB */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|SK_IOCTL_GETMIB
suffix:colon
id|SkPnmiGetStruct
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
op_amp
id|pAC-&gt;PnmiStruct
comma
op_amp
id|Size
comma
id|pNet-&gt;NetNr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_IOCTL_PRESETMIB
suffix:colon
id|SkPnmiPreSetStruct
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
op_amp
id|pAC-&gt;PnmiStruct
comma
op_amp
id|Size
comma
id|pNet-&gt;NetNr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_IOCTL_SETMIB
suffix:colon
id|SkPnmiSetStruct
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
op_amp
id|pAC-&gt;PnmiStruct
comma
op_amp
id|Size
comma
id|pNet-&gt;NetNr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ENTRY
comma
(paren
l_string|&quot;MIB data access succeeded&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
(paren
id|Size
)paren
suffix:semicolon
)brace
multiline_comment|/* SkGeIocMib */
multiline_comment|/*****************************************************************************&n; *&n; * &t;GetConfiguration - read configuration information&n; *&n; * Description:&n; *&t;This function reads per-adapter configuration information from&n; *&t;the options provided on the command line.&n; *&n; * Returns:&n; *&t;none&n; */
DECL|function|GetConfiguration
r_static
r_void
id|GetConfiguration
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
multiline_comment|/* pointer to the adapter context structure */
(brace
id|SK_I32
id|Port
suffix:semicolon
multiline_comment|/* preferred port */
id|SK_BOOL
id|AutoSet
suffix:semicolon
id|SK_BOOL
id|DupSet
suffix:semicolon
r_int
id|LinkSpeed
op_assign
id|SK_LSPEED_AUTO
suffix:semicolon
multiline_comment|/* Link speed */
r_int
id|AutoNeg
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* autoneg off (0) or on (1) */
r_int
id|DuplexCap
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0=both,1=full,2=half */
r_int
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_SYM_OR_REM
suffix:semicolon
multiline_comment|/* FlowControl  */
r_int
id|MSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
multiline_comment|/* master/slave mode    */
id|SK_BOOL
id|IsConTypeDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_BOOL
id|IsLinkSpeedDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_BOOL
id|IsFlowCtrlDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_BOOL
id|IsRoleDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|SK_BOOL
id|IsModeDefined
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/*&n; *&t;The two parameters AutoNeg. and DuplexCap. map to one configuration&n; *&t;parameter. The mapping is described by this table:&n; *&t;DuplexCap -&gt;&t;|&t;both&t;|&t;full&t;|&t;half&t;|&n; *&t;AutoNeg&t;&t;|&t;&t;|&t;&t;|&t;&t;|&n; *&t;-----------------------------------------------------------------&n; *&t;Off&t;&t;|    illegal&t;|&t;Full&t;|&t;Half&t;|&n; *&t;-----------------------------------------------------------------&n; *&t;On&t;&t;|   AutoBoth&t;|   AutoFull&t;|   AutoHalf&t;|&n; *&t;-----------------------------------------------------------------&n; *&t;Sense&t;&t;|   AutoSense&t;|   AutoSense&t;|   AutoSense&t;|&n; */
r_int
id|Capabilities
(braket
l_int|3
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
op_minus
l_int|1
comma
id|SK_LMODE_FULL
comma
id|SK_LMODE_HALF
)brace
comma
(brace
id|SK_LMODE_AUTOBOTH
comma
id|SK_LMODE_AUTOFULL
comma
id|SK_LMODE_AUTOHALF
)brace
comma
(brace
id|SK_LMODE_AUTOSENSE
comma
id|SK_LMODE_AUTOSENSE
comma
id|SK_LMODE_AUTOSENSE
)brace
)brace
suffix:semicolon
DECL|macro|DC_BOTH
mdefine_line|#define DC_BOTH&t;0
DECL|macro|DC_FULL
mdefine_line|#define DC_FULL 1
DECL|macro|DC_HALF
mdefine_line|#define DC_HALF 2
DECL|macro|AN_OFF
mdefine_line|#define AN_OFF&t;0
DECL|macro|AN_ON
mdefine_line|#define AN_ON&t;1
DECL|macro|AN_SENS
mdefine_line|#define AN_SENS&t;2
DECL|macro|M_CurrPort
mdefine_line|#define M_CurrPort pAC-&gt;GIni.GP[Port]
multiline_comment|/*&n;&t;** Set the default values first for both ports!&n;&t;*/
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_ON
)braket
(braket
id|DC_BOTH
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_SYM_OR_REM
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_AUTO
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Check merged parameter ConType. If it has not been used,&n;&t;** verify any other parameter (e.g. AutoNeg) and use default values. &n;&t;**&n;&t;** Stating both ConType and other lowlevel link parameters is also&n;&t;** possible. If this is the case, the passed ConType-parameter is &n;&t;** overwritten by the lowlevel link parameter.&n;&t;**&n;&t;** The following settings are used for a merged ConType-parameter:&n;&t;**&n;&t;** ConType   DupCap   AutoNeg   FlowCtrl      Role      Speed&n;&t;** -------   ------   -------   --------   ----------   -----&n;&t;**  Auto      Both      On      SymOrRem      Auto       Auto&n;&t;**  100FD     Full      Off       None      &lt;ignored&gt;    100&n;&t;**  100HD     Half      Off       None      &lt;ignored&gt;    100&n;&t;**  10FD      Full      Off       None      &lt;ignored&gt;    10&n;&t;**  10HD      Half      Off       None      &lt;ignored&gt;    10&n;&t;** &n;&t;** This ConType parameter is used for all ports of the adapter!&n;&t;*/
r_if
c_cond
(paren
(paren
id|ConType
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
)paren
op_logical_and
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
)paren
(brace
multiline_comment|/* Check chipset family */
r_if
c_cond
(paren
(paren
op_logical_neg
id|pAC-&gt;ChipsetType
)paren
op_logical_and
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/* Set the speed parameter back */
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; &quot;
l_string|&quot;for ConType.&quot;
l_string|&quot; Using Auto.&bslash;n&quot;
comma
id|ConType
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsConTypeDefined
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* No ConType defined */
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_ON
)braket
(braket
id|DC_BOTH
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_SYM_OR_REM
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_AUTO
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;100FD&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_OFF
)braket
(braket
id|DC_FULL
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_100MBPS
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;100HD&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_OFF
)braket
(braket
id|DC_HALF
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_100MBPS
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;10FD&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_OFF
)braket
(braket
id|DC_FULL
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_10MBPS
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ConType
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;10HD&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|Port
op_assign
l_int|0
suffix:semicolon
id|Port
OL
id|SK_MAX_MACS
suffix:semicolon
id|Port
op_increment
)paren
(brace
id|M_CurrPort.PLinkModeConf
op_assign
id|Capabilities
(braket
id|AN_OFF
)braket
(braket
id|DC_HALF
)braket
suffix:semicolon
id|M_CurrPort.PFlowCtrlMode
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
id|M_CurrPort.PMSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
id|M_CurrPort.PLinkSpeed
op_assign
id|SK_LSPEED_10MBPS
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for ConType&bslash;n&quot;
comma
id|ConType
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsConTypeDefined
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* Wrong ConType defined */
)brace
)brace
r_else
(brace
id|IsConTypeDefined
op_assign
id|SK_FALSE
suffix:semicolon
multiline_comment|/* No ConType defined */
)brace
multiline_comment|/*&n;&t;** Parse any parameter settings for port A:&n;&t;** a) any LinkSpeed stated?&n;&t;*/
r_if
c_cond
(paren
id|Speed_A
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_AUTO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;10&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_10MBPS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;100&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_100MBPS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;1000&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_1000MBPS
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for Speed_A&bslash;n&quot;
comma
id|Speed_A
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** Check speed parameter: &n;&t;**    Only copper type adapter and GE V2 cards &n;&t;*/
r_if
c_cond
(paren
(paren
(paren
op_logical_neg
id|pAC-&gt;ChipsetType
)paren
op_logical_or
(paren
id|pAC-&gt;GIni.GICopperType
op_ne
id|SK_TRUE
)paren
)paren
op_logical_and
(paren
(paren
id|LinkSpeed
op_ne
id|SK_LSPEED_AUTO
)paren
op_logical_and
(paren
id|LinkSpeed
op_ne
id|SK_LSPEED_1000MBPS
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value for Speed_A. &quot;
l_string|&quot;Not a copper card or GE V2 card&bslash;n    Using &quot;
l_string|&quot;speed 1000&bslash;n&quot;
)paren
suffix:semicolon
id|LinkSpeed
op_assign
id|SK_LSPEED_1000MBPS
suffix:semicolon
)brace
multiline_comment|/*&t;&n;&t;** Decide whether to set new config value if somethig valid has&n;&t;** been received.&n;&t;*/
r_if
c_cond
(paren
id|IsLinkSpeedDefined
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|0
)braket
dot
id|PLinkSpeed
op_assign
id|LinkSpeed
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** b) Any Autonegotiation and DuplexCapabilities set?&n;&t;**    Please note that both belong together...&n;&t;*/
id|AutoNeg
op_assign
id|AN_ON
suffix:semicolon
multiline_comment|/* tschilling: Default: Autonegotiation on! */
id|AutoSet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|AutoNeg_A
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
id|AutoSet
op_assign
id|SK_TRUE
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoSet
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;On&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_ON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Off&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_OFF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Sense&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_SENS
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for AutoNeg_A&bslash;n&quot;
comma
id|AutoNeg_A
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
)brace
)brace
id|DuplexCap
op_assign
id|DC_BOTH
suffix:semicolon
id|DupSet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|DupCap_A
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
id|DupSet
op_assign
id|SK_TRUE
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DupSet
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Both&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_BOTH
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Full&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Half&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_HALF
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for DupCap_A&bslash;n&quot;
comma
id|DupCap_A
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* &n;&t;** Check for illegal combinations &n;&t;*/
r_if
c_cond
(paren
(paren
id|LinkSpeed
op_eq
id|SK_LSPEED_1000MBPS
)paren
op_logical_and
(paren
(paren
id|DuplexCap
op_eq
id|SK_LMODE_STAT_AUTOHALF
)paren
op_logical_or
(paren
id|DuplexCap
op_eq
id|SK_LMODE_STAT_HALF
)paren
)paren
op_logical_and
(paren
id|pAC-&gt;ChipsetType
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Half Duplex not possible with Gigabit speed!&bslash;n&quot;
l_string|&quot;    Using Full Duplex.&bslash;n&quot;
)paren
suffix:semicolon
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_SENS
op_logical_and
id|DupSet
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin, Port A: DuplexCapabilities&quot;
l_string|&quot; ignored using Sense mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_OFF
op_logical_and
id|DupSet
op_logical_and
id|DuplexCap
op_eq
id|DC_BOTH
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port A: Illegal combination&quot;
l_string|&quot; of values AutoNeg. and DuplexCap.&bslash;n    Using &quot;
l_string|&quot;Full Duplex&bslash;n&quot;
)paren
suffix:semicolon
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_OFF
op_logical_and
op_logical_neg
id|DupSet
)paren
(brace
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|AutoSet
op_logical_and
id|DupSet
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port A: Duplex setting not&quot;
l_string|&quot; possible in&bslash;n    default AutoNegotiation mode&quot;
l_string|&quot; (Sense).&bslash;n    Using AutoNegotiation On&bslash;n&quot;
)paren
suffix:semicolon
id|AutoNeg
op_assign
id|AN_ON
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** set the desired mode &n;&t;*/
r_if
c_cond
(paren
id|AutoSet
op_logical_or
id|DupSet
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|0
)braket
dot
id|PLinkModeConf
op_assign
id|Capabilities
(braket
id|AutoNeg
)braket
(braket
id|DuplexCap
)braket
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** c) Any Flowcontrol-parameter set?&n;&t;*/
r_if
c_cond
(paren
id|FlowCtrl_A
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SymOrRem&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_SYM_OR_REM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Sym&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_SYMMETRIC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;LocSend&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_LOC_SEND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;None&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for FlowCtrl_A&bslash;n&quot;
comma
id|FlowCtrl_A
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IsFlowCtrlDefined
)paren
(brace
r_if
c_cond
(paren
(paren
id|AutoNeg
op_eq
id|AN_OFF
)paren
op_logical_and
(paren
id|FlowCtrl
op_ne
id|SK_FLOW_MODE_NONE
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port A: FlowControl&quot;
l_string|&quot; impossible without AutoNegotiation,&quot;
l_string|&quot; disabled&bslash;n&quot;
)paren
suffix:semicolon
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
)brace
id|pAC-&gt;GIni.GP
(braket
l_int|0
)braket
dot
id|PFlowCtrlMode
op_assign
id|FlowCtrl
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** d) What is with the RoleParameter?&n;&t;*/
r_if
c_cond
(paren
id|Role_A
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|Role_A
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Master&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_MASTER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_A
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Slave&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_SLAVE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for Role_A&bslash;n&quot;
comma
id|Role_A
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IsRoleDefined
op_eq
id|SK_TRUE
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|0
)braket
dot
id|PMSMode
op_assign
id|MSMode
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** Parse any parameter settings for port B:&n;&t;** a) any LinkSpeed stated?&n;&t;*/
id|IsConTypeDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|IsLinkSpeedDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|IsFlowCtrlDefined
op_assign
id|SK_TRUE
suffix:semicolon
id|IsModeDefined
op_assign
id|SK_TRUE
suffix:semicolon
r_if
c_cond
(paren
id|Speed_B
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_AUTO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;10&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_10MBPS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;100&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_100MBPS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;1000&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|LinkSpeed
op_assign
id|SK_LSPEED_1000MBPS
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for Speed_B&bslash;n&quot;
comma
id|Speed_B
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsLinkSpeedDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** Check speed parameter:&n;&t;**    Only copper type adapter and GE V2 cards &n;&t;*/
r_if
c_cond
(paren
(paren
(paren
op_logical_neg
id|pAC-&gt;ChipsetType
)paren
op_logical_or
(paren
id|pAC-&gt;GIni.GICopperType
op_ne
id|SK_TRUE
)paren
)paren
op_logical_and
(paren
(paren
id|LinkSpeed
op_ne
id|SK_LSPEED_AUTO
)paren
op_logical_and
(paren
id|LinkSpeed
op_ne
id|SK_LSPEED_1000MBPS
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value for Speed_B. &quot;
l_string|&quot;Not a copper card or GE V2 card&bslash;n    Using &quot;
l_string|&quot;speed 1000&bslash;n&quot;
)paren
suffix:semicolon
id|LinkSpeed
op_assign
id|SK_LSPEED_1000MBPS
suffix:semicolon
)brace
multiline_comment|/*      &n;&t;** Decide whether to set new config value if somethig valid has&n;&t;** been received.&n;&t;*/
r_if
c_cond
(paren
id|IsLinkSpeedDefined
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|1
)braket
dot
id|PLinkSpeed
op_assign
id|LinkSpeed
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** b) Any Autonegotiation and DuplexCapabilities set?&n;&t;**    Please note that both belong together...&n;&t;*/
id|AutoNeg
op_assign
id|AN_SENS
suffix:semicolon
multiline_comment|/* default: do auto Sense */
id|AutoSet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|AutoNeg_B
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
id|AutoSet
op_assign
id|SK_TRUE
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoSet
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;On&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_ON
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Off&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_OFF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Sense&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|AutoNeg
op_assign
id|AN_SENS
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for AutoNeg_B&bslash;n&quot;
comma
id|AutoNeg_B
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
)brace
)brace
id|DuplexCap
op_assign
id|DC_BOTH
suffix:semicolon
id|DupSet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|DupCap_B
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
id|DupSet
op_assign
id|SK_TRUE
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DupSet
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Both&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_BOTH
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Full&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Half&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|DuplexCap
op_assign
id|DC_HALF
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for DupCap_B&bslash;n&quot;
comma
id|DupCap_B
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* &n;&t;** Check for illegal combinations &n;&t;*/
r_if
c_cond
(paren
(paren
id|LinkSpeed
op_eq
id|SK_LSPEED_1000MBPS
)paren
op_logical_and
(paren
(paren
id|DuplexCap
op_eq
id|SK_LMODE_STAT_AUTOHALF
)paren
op_logical_or
(paren
id|DuplexCap
op_eq
id|SK_LMODE_STAT_HALF
)paren
)paren
op_logical_and
(paren
id|pAC-&gt;ChipsetType
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Half Duplex not possible with Gigabit speed!&bslash;n&quot;
l_string|&quot;    Using Full Duplex.&bslash;n&quot;
)paren
suffix:semicolon
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_SENS
op_logical_and
id|DupSet
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin, Port B: DuplexCapabilities&quot;
l_string|&quot; ignored using Sense mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_OFF
op_logical_and
id|DupSet
op_logical_and
id|DuplexCap
op_eq
id|DC_BOTH
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port B: Illegal combination&quot;
l_string|&quot; of values AutoNeg. and DuplexCap.&bslash;n    Using &quot;
l_string|&quot;Full Duplex&bslash;n&quot;
)paren
suffix:semicolon
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSet
op_logical_and
id|AutoNeg
op_eq
id|AN_OFF
op_logical_and
op_logical_neg
id|DupSet
)paren
(brace
id|DuplexCap
op_assign
id|DC_FULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|AutoSet
op_logical_and
id|DupSet
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port B: Duplex setting not&quot;
l_string|&quot; possible in&bslash;n    default AutoNegotiation mode&quot;
l_string|&quot; (Sense).&bslash;n    Using AutoNegotiation On&bslash;n&quot;
)paren
suffix:semicolon
id|AutoNeg
op_assign
id|AN_ON
suffix:semicolon
)brace
multiline_comment|/* &n;&t;** set the desired mode &n;&t;*/
r_if
c_cond
(paren
id|AutoSet
op_logical_or
id|DupSet
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|1
)braket
dot
id|PLinkModeConf
op_assign
id|Capabilities
(braket
id|AutoNeg
)braket
(braket
id|DuplexCap
)braket
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** c) Any FlowCtrl parameter set?&n;&t;*/
r_if
c_cond
(paren
id|FlowCtrl_B
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SymOrRem&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_SYM_OR_REM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Sym&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_SYMMETRIC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;LocSend&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_LOC_SEND
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;None&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for FlowCtrl_B&bslash;n&quot;
comma
id|FlowCtrl_B
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsFlowCtrlDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IsFlowCtrlDefined
)paren
(brace
r_if
c_cond
(paren
(paren
id|AutoNeg
op_eq
id|AN_OFF
)paren
op_logical_and
(paren
id|FlowCtrl
op_ne
id|SK_FLOW_MODE_NONE
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Port B: FlowControl&quot;
l_string|&quot; impossible without AutoNegotiation,&quot;
l_string|&quot; disabled&bslash;n&quot;
)paren
suffix:semicolon
id|FlowCtrl
op_assign
id|SK_FLOW_MODE_NONE
suffix:semicolon
)brace
id|pAC-&gt;GIni.GP
(braket
l_int|1
)braket
dot
id|PFlowCtrlMode
op_assign
id|FlowCtrl
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** d) What is the RoleParameter?&n;&t;*/
r_if
c_cond
(paren
id|Role_B
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|Role_B
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Auto&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_AUTO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Master&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_MASTER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Role_B
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Slave&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|MSMode
op_assign
id|SK_MS_MODE_SLAVE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for Role_B&bslash;n&quot;
comma
id|Role_B
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|IsRoleDefined
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IsRoleDefined
)paren
(brace
id|pAC-&gt;GIni.GP
(braket
l_int|1
)braket
dot
id|PMSMode
op_assign
id|MSMode
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Evaluate settings for both ports&n;&t;*/
id|pAC-&gt;ActivePort
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|PrefPort
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|PrefPort
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|PrefPort
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Auto */
id|pAC-&gt;ActivePort
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Preference
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* auto */
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|PrefPort
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;A&quot;
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;** do not set ActivePort here, thus a port&n;&t;&t;&t;** switch is issued after net up.&n;&t;&t;&t;*/
id|Port
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Preference
op_assign
id|Port
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
op_assign
id|Port
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|PrefPort
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;B&quot;
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;** do not set ActivePort here, thus a port&n;&t;&t;&t;** switch is issued after net up.&n;&t;&t;&t;*/
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;B&bslash;&quot; for PrefPort.&bslash;n&quot;
l_string|&quot;      Port B not available on single port adapters.&bslash;n&quot;
)paren
suffix:semicolon
id|pAC-&gt;ActivePort
op_assign
l_int|0
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Preference
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* auto */
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|Port
op_assign
l_int|1
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|Preference
op_assign
id|Port
suffix:semicolon
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
op_assign
id|Port
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for PrefPort&bslash;n&quot;
comma
id|PrefPort
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
)brace
)brace
id|pAC-&gt;RlmtNets
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|RlmtMode
op_ne
l_int|NULL
op_logical_and
id|pAC-&gt;Index
OL
id|SK_MAX_CARD_PARAM
op_logical_and
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;RlmtMode
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;CheckLinkState&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;RlmtMode
op_assign
id|SK_RLMT_CHECK_LINK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;CheckLocalPort&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;RlmtMode
op_assign
id|SK_RLMT_CHECK_LINK
op_or
id|SK_RLMT_CHECK_LOC_LINK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;CheckSeg&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;RlmtMode
op_assign
id|SK_RLMT_CHECK_LINK
op_or
id|SK_RLMT_CHECK_LOC_LINK
op_or
id|SK_RLMT_CHECK_SEG
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|strcmp
c_func
(paren
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;DualNet&quot;
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
)paren
(brace
id|pAC-&gt;RlmtMode
op_assign
id|SK_RLMT_CHECK_LINK
suffix:semicolon
id|pAC-&gt;RlmtNets
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for&quot;
l_string|&quot; RlmtMode, using default&bslash;n&quot;
comma
id|RlmtMode
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|pAC-&gt;RlmtMode
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|pAC-&gt;RlmtMode
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Check the interrupt moderation parameters&n;&t;*/
r_if
c_cond
(paren
id|Moderation
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Moderation
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_NONE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Moderation
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Static&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_STATIC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Moderation
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Dynamic&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_DYNAMIC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Moderation
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;None&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_NONE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%s&bslash;&quot; for Moderation.&bslash;n&quot;
l_string|&quot;      Disable interrupt moderation.&bslash;n&quot;
comma
id|Moderation
(braket
id|pAC-&gt;Index
)braket
)paren
suffix:semicolon
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_NONE
suffix:semicolon
)brace
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_assign
id|C_INT_MOD_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Stats
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|Stats
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Yes&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.DisplayStats
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.DisplayStats
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.DisplayStats
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Rx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_ONLY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Tx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_TX_ONLY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;Sp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_SP_ONLY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;RxSp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_SP_RX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SpRx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_SP_RX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;RxTx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_TX_RX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;TxRx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_TX_RX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;TxSp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_SP_TX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SpTx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_SP_TX
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;RxTxSp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;RxSpTx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;TxRxSp&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;TxSpRx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SpTxRx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ModerationMask
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;SpRxTx&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_TX_SP
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* some rubbish */
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_RX_ONLY
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* operator has stated nothing */
id|pAC-&gt;DynIrqModInfo.MaskIrqModeration
op_assign
id|IRQ_MASK_TX_RX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|AutoSizing
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|AutoSizing
(braket
id|pAC-&gt;Index
)braket
comma
l_string|&quot;On&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|pAC-&gt;DynIrqModInfo.AutoSizing
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.AutoSizing
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* operator has stated nothing */
id|pAC-&gt;DynIrqModInfo.AutoSizing
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IntsPerSec
(braket
id|pAC-&gt;Index
)braket
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|IntsPerSec
(braket
id|pAC-&gt;Index
)braket
OL
id|C_INT_MOD_IPS_LOWER_RANGE
)paren
op_logical_or
(paren
id|IntsPerSec
(braket
id|pAC-&gt;Index
)braket
OG
id|C_INT_MOD_IPS_UPPER_RANGE
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;sk98lin: Illegal value &bslash;&quot;%d&bslash;&quot; for IntsPerSec. (Range: %d - %d)&bslash;n&quot;
l_string|&quot;      Using default value of %i.&bslash;n&quot;
comma
id|IntsPerSec
(braket
id|pAC-&gt;Index
)braket
comma
id|C_INT_MOD_IPS_LOWER_RANGE
comma
id|C_INT_MOD_IPS_UPPER_RANGE
comma
id|C_INTS_PER_SEC_DEFAULT
)paren
suffix:semicolon
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_assign
id|C_INTS_PER_SEC_DEFAULT
suffix:semicolon
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_assign
id|IntsPerSec
(braket
id|pAC-&gt;Index
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_assign
id|C_INTS_PER_SEC_DEFAULT
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Evaluate upper and lower moderation threshold&n;&t;*/
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSecUpperLimit
op_assign
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_plus
(paren
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_div
l_int|2
)paren
suffix:semicolon
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSecLowerLimit
op_assign
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_minus
(paren
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
op_div
l_int|2
)paren
suffix:semicolon
id|pAC-&gt;DynIrqModInfo.PrevTimeVal
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* initial value */
)brace
multiline_comment|/* GetConfiguration */
multiline_comment|/*****************************************************************************&n; *&n; * &t;ProductStr - return a adapter identification string from vpd&n; *&n; * Description:&n; *&t;This function reads the product name string from the vpd area&n; *&t;and puts it the field pAC-&gt;DeviceString.&n; *&n; * Returns: N/A&n; */
DECL|function|ProductStr
r_static
r_void
id|ProductStr
c_func
(paren
id|SK_AC
op_star
id|pAC
multiline_comment|/* pointer to adapter context */
)paren
(brace
r_int
id|StrLen
op_assign
l_int|80
suffix:semicolon
multiline_comment|/* length of the string, defined in SK_AC */
r_char
id|Keyword
(braket
)braket
op_assign
id|VPD_NAME
suffix:semicolon
multiline_comment|/* vpd productname identifier */
r_int
id|ReturnCode
suffix:semicolon
multiline_comment|/* return code from vpd_read */
r_int
r_int
id|Flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|ReturnCode
op_assign
id|VpdRead
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|Keyword
comma
id|pAC-&gt;DeviceStr
comma
op_amp
id|StrLen
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ReturnCode
op_ne
l_int|0
)paren
(brace
multiline_comment|/* there was an error reading the vpd data */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_ERROR
comma
(paren
l_string|&quot;Error reading VPD data: %d&bslash;n&quot;
comma
id|ReturnCode
)paren
)paren
suffix:semicolon
id|pAC-&gt;DeviceStr
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
multiline_comment|/* ProductStr */
multiline_comment|/*****************************************************************************&n; *&n; *      StartDrvCleanupTimer - Start timer to check for descriptors which&n; *                             might be placed in descriptor ring, but&n; *                             havent been handled up to now&n; *&n; * Description:&n; *      This function requests a HW-timer fo the Yukon card. The actions to&n; *      perform when this timer expires, are located in the SkDrvEvent().&n; *&n; * Returns: N/A&n; */
r_static
r_void
DECL|function|StartDrvCleanupTimer
id|StartDrvCleanupTimer
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
id|SK_EVPARA
id|EventParam
suffix:semicolon
multiline_comment|/* Event struct for timer event */
id|SK_MEMSET
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|EventParam
comma
l_int|0
comma
r_sizeof
(paren
id|EventParam
)paren
)paren
suffix:semicolon
id|EventParam.Para32
(braket
l_int|0
)braket
op_assign
id|SK_DRV_RX_CLEANUP_TIMER
suffix:semicolon
id|SkTimerStart
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
op_amp
id|pAC-&gt;DrvCleanupTimer
comma
id|SK_DRV_RX_CLEANUP_TIMER_LENGTH
comma
id|SKGE_DRV
comma
id|SK_DRV_TIMER
comma
id|EventParam
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; *      StopDrvCleanupTimer - Stop timer to check for descriptors&n; *&n; * Description:&n; *      This function requests a HW-timer fo the Yukon card. The actions to&n; *      perform when this timer expires, are located in the SkDrvEvent().&n; *&n; * Returns: N/A&n; */
r_static
r_void
DECL|function|StopDrvCleanupTimer
id|StopDrvCleanupTimer
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
id|SkTimerStop
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
op_amp
id|pAC-&gt;DrvCleanupTimer
)paren
suffix:semicolon
id|SK_MEMSET
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|pAC-&gt;DrvCleanupTimer
comma
l_int|0
comma
r_sizeof
(paren
id|SK_TIMER
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* functions for common modules *********************************************/
multiline_comment|/****************************************************************************/
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkDrvAllocRlmtMbuf - allocate an RLMT mbuf&n; *&n; * Description:&n; *&t;This routine returns an RLMT mbuf or NULL. The RLMT Mbuf structure&n; *&t;is embedded into a socket buff data area.&n; *&n; * Context:&n; *&t;runtime&n; *&n; * Returns:&n; *&t;NULL or pointer to Mbuf.&n; */
DECL|function|SkDrvAllocRlmtMbuf
id|SK_MBUF
op_star
id|SkDrvAllocRlmtMbuf
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* the IO-context */
r_int
id|BufferSize
)paren
multiline_comment|/* size of the requested buffer */
(brace
id|SK_MBUF
op_star
id|pRlmtMbuf
suffix:semicolon
multiline_comment|/* pointer to a new rlmt-mbuf structure */
r_struct
id|sk_buff
op_star
id|pMsgBlock
suffix:semicolon
multiline_comment|/* pointer to a new message block */
id|pMsgBlock
op_assign
id|alloc_skb
c_func
(paren
id|BufferSize
op_plus
r_sizeof
(paren
id|SK_MBUF
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pMsgBlock
op_eq
l_int|NULL
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|pRlmtMbuf
op_assign
(paren
id|SK_MBUF
op_star
)paren
id|pMsgBlock-&gt;data
suffix:semicolon
id|skb_reserve
c_func
(paren
id|pMsgBlock
comma
r_sizeof
(paren
id|SK_MBUF
)paren
)paren
suffix:semicolon
id|pRlmtMbuf-&gt;pNext
op_assign
l_int|NULL
suffix:semicolon
id|pRlmtMbuf-&gt;pOs
op_assign
id|pMsgBlock
suffix:semicolon
id|pRlmtMbuf-&gt;pData
op_assign
id|pMsgBlock-&gt;data
suffix:semicolon
multiline_comment|/* Data buffer. */
id|pRlmtMbuf-&gt;Size
op_assign
id|BufferSize
suffix:semicolon
multiline_comment|/* Data buffer size. */
id|pRlmtMbuf-&gt;Length
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Length of packet (&lt;= Size). */
r_return
(paren
id|pRlmtMbuf
)paren
suffix:semicolon
)brace
multiline_comment|/* SkDrvAllocRlmtMbuf */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkDrvFreeRlmtMbuf - free an RLMT mbuf&n; *&n; * Description:&n; *&t;This routine frees one or more RLMT mbuf(s).&n; *&n; * Context:&n; *&t;runtime&n; *&n; * Returns:&n; *&t;Nothing&n; */
DECL|function|SkDrvFreeRlmtMbuf
r_void
id|SkDrvFreeRlmtMbuf
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* the IO-context */
id|SK_MBUF
op_star
id|pMbuf
)paren
multiline_comment|/* size of the requested buffer */
(brace
id|SK_MBUF
op_star
id|pFreeMbuf
suffix:semicolon
id|SK_MBUF
op_star
id|pNextMbuf
suffix:semicolon
id|pFreeMbuf
op_assign
id|pMbuf
suffix:semicolon
r_do
(brace
id|pNextMbuf
op_assign
id|pFreeMbuf-&gt;pNext
suffix:semicolon
id|DEV_KFREE_SKB_ANY
c_func
(paren
id|pFreeMbuf-&gt;pOs
)paren
suffix:semicolon
id|pFreeMbuf
op_assign
id|pNextMbuf
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pFreeMbuf
op_ne
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* SkDrvFreeRlmtMbuf */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkOsGetTime - provide a time value&n; *&n; * Description:&n; *&t;This routine provides a time value. The unit is 1/HZ (defined by Linux).&n; *&t;It is not used for absolute time, but only for time differences.&n; *&n; *&n; * Returns:&n; *&t;Time value&n; */
DECL|function|SkOsGetTime
id|SK_U64
id|SkOsGetTime
c_func
(paren
id|SK_AC
op_star
id|pAC
)paren
(brace
id|SK_U64
id|PrivateJiffies
suffix:semicolon
id|SkOsGetTimeCurrent
c_func
(paren
id|pAC
comma
op_amp
id|PrivateJiffies
)paren
suffix:semicolon
r_return
id|PrivateJiffies
suffix:semicolon
)brace
multiline_comment|/* SkOsGetTime */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciReadCfgDWord - read a 32 bit value from pci config space&n; *&n; * Description:&n; *&t;This routine reads a 32 bit value from the pci configuration&n; *&t;space.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciReadCfgDWord
r_int
id|SkPciReadCfgDWord
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U32
op_star
id|pVal
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_read_config_dword
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|pVal
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciReadCfgDWord */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciReadCfgWord - read a 16 bit value from pci config space&n; *&n; * Description:&n; *&t;This routine reads a 16 bit value from the pci configuration&n; *&t;space.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciReadCfgWord
r_int
id|SkPciReadCfgWord
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U16
op_star
id|pVal
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_read_config_word
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|pVal
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciReadCfgWord */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciReadCfgByte - read a 8 bit value from pci config space&n; *&n; * Description:&n; *&t;This routine reads a 8 bit value from the pci configuration&n; *&t;space.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciReadCfgByte
r_int
id|SkPciReadCfgByte
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U8
op_star
id|pVal
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_read_config_byte
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|pVal
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciReadCfgByte */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciWriteCfgDWord - write a 32 bit value to pci config space&n; *&n; * Description:&n; *&t;This routine writes a 32 bit value to the pci configuration&n; *&t;space.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciWriteCfgDWord
r_int
id|SkPciWriteCfgDWord
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U32
id|Val
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_write_config_dword
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|Val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciWriteCfgDWord */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciWriteCfgWord - write a 16 bit value to pci config space&n; *&n; * Description:&n; *&t;This routine writes a 16 bit value to the pci configuration&n; *&t;space. The flag PciConfigUp indicates whether the config space&n; *&t;is accesible or must be set up first.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciWriteCfgWord
r_int
id|SkPciWriteCfgWord
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U16
id|Val
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_write_config_word
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|Val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciWriteCfgWord */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkPciWriteCfgWord - write a 8 bit value to pci config space&n; *&n; * Description:&n; *&t;This routine writes a 8 bit value to the pci configuration&n; *&t;space. The flag PciConfigUp indicates whether the config space&n; *&t;is accesible or must be set up first.&n; *&n; * Returns:&n; *&t;0 - indicate everything worked ok.&n; *&t;!= 0 - error indication&n; */
DECL|function|SkPciWriteCfgByte
r_int
id|SkPciWriteCfgByte
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* Adapter Control structure pointer */
r_int
id|PciAddr
comma
multiline_comment|/* PCI register address */
id|SK_U8
id|Val
)paren
multiline_comment|/* pointer to store the read value */
(brace
id|pci_write_config_byte
c_func
(paren
id|pAC-&gt;PciDev
comma
id|PciAddr
comma
id|Val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* SkPciWriteCfgByte */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkDrvEvent - handle driver events&n; *&n; * Description:&n; *&t;This function handles events from all modules directed to the driver&n; *&n; * Context:&n; *&t;Is called under protection of slow path lock.&n; *&n; * Returns:&n; *&t;0 if everything ok&n; *&t;&lt; 0  on error&n; *&t;&n; */
DECL|function|SkDrvEvent
r_int
id|SkDrvEvent
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context */
id|SK_IOC
id|IoC
comma
multiline_comment|/* io-context */
id|SK_U32
id|Event
comma
multiline_comment|/* event-id */
id|SK_EVPARA
id|Param
)paren
multiline_comment|/* event-parameter */
(brace
id|SK_MBUF
op_star
id|pRlmtMbuf
suffix:semicolon
multiline_comment|/* pointer to a rlmt-mbuf structure */
r_struct
id|sk_buff
op_star
id|pMsg
suffix:semicolon
multiline_comment|/* pointer to a message block */
r_int
id|FromPort
suffix:semicolon
multiline_comment|/* the port from which we switch away */
r_int
id|ToPort
suffix:semicolon
multiline_comment|/* the port we switch to */
id|SK_EVPARA
id|NewPara
suffix:semicolon
multiline_comment|/* parameter for further events */
r_int
id|Stat
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
id|SK_BOOL
id|DualNet
suffix:semicolon
r_switch
c_cond
(paren
id|Event
)paren
(brace
r_case
id|SK_DRV_ADAP_FAIL
suffix:colon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;ADAPTER FAIL EVENT&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Adapter failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|SK_OUT32
c_func
(paren
id|pAC-&gt;IoBase
comma
id|B0_IMSK
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* cgoos */
r_break
suffix:semicolon
r_case
id|SK_DRV_PORT_FAIL
suffix:colon
id|FromPort
op_assign
id|Param.Para32
(braket
l_int|0
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;PORT FAIL EVENT, Port: %d&bslash;n&quot;
comma
id|FromPort
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|FromPort
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Port A failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Port B failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|1
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
multiline_comment|/* cgoos */
r_break
suffix:semicolon
r_case
id|SK_DRV_PORT_RESET
suffix:colon
multiline_comment|/* SK_U32 PortIdx */
multiline_comment|/* action list 4 */
id|FromPort
op_assign
id|Param.Para32
(braket
l_int|0
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;PORT RESET EVENT, Port: %d &quot;
comma
id|FromPort
)paren
)paren
suffix:semicolon
id|NewPara.Para64
op_assign
id|FromPort
suffix:semicolon
id|SkPnmiEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_PNMI_EVT_XMAC_RESET
comma
id|NewPara
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|SkGeStopPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
comma
id|SK_STOP_ALL
comma
id|SK_HARD_RST
)paren
suffix:semicolon
id|pAC-&gt;dev
(braket
id|Param.Para32
(braket
l_int|0
)braket
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* clear rx ring from received frames */
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|FromPort
)braket
comma
id|SK_FALSE
)paren
suffix:semicolon
id|ClearTxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
multiline_comment|/* tschilling: Handling of return value inserted. */
r_if
c_cond
(paren
id|SkGeInitPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
)paren
(brace
r_if
c_cond
(paren
id|FromPort
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SkGeInitPort A failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SkGeInitPort B failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|1
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
)brace
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
suffix:semicolon
id|PortReInitBmu
c_func
(paren
id|pAC
comma
id|FromPort
)paren
suffix:semicolon
id|SkGePollTxD
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
comma
id|SK_TRUE
)paren
suffix:semicolon
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
id|FromPort
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_DRV_NET_UP
suffix:colon
multiline_comment|/* SK_U32 PortIdx */
multiline_comment|/* action list 5 */
id|FromPort
op_assign
id|Param.Para32
(braket
l_int|0
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;NET UP EVENT, Port: %d &quot;
comma
id|Param.Para32
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* Mac update */
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DoPrintInterfaceChange
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: network connection up using&quot;
l_string|&quot; port %c&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
id|Param.Para32
(braket
l_int|0
)braket
)braket
op_member_access_from_pointer
id|name
comma
l_char|&squot;A&squot;
op_plus
id|Param.Para32
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* tschilling: Values changed according to LinkSpeedUsed. */
id|Stat
op_assign
id|pAC-&gt;GIni.GP
(braket
id|FromPort
)braket
dot
id|PLinkSpeedUsed
suffix:semicolon
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_LSPEED_STAT_10MBPS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    speed:           10&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_LSPEED_STAT_100MBPS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    speed:           100&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_LSPEED_STAT_1000MBPS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    speed:           1000&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;    speed:           unknown&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|Stat
op_assign
id|pAC-&gt;GIni.GP
(braket
id|FromPort
)braket
dot
id|PLinkModeStatus
suffix:semicolon
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_LMODE_STAT_AUTOHALF
op_logical_or
id|Stat
op_eq
id|SK_LMODE_STAT_AUTOFULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    autonegotiation: yes&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;    autonegotiation: no&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_LMODE_STAT_AUTOHALF
op_logical_or
id|Stat
op_eq
id|SK_LMODE_STAT_HALF
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    duplex mode:     half&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;    duplex mode:     full&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|Stat
op_assign
id|pAC-&gt;GIni.GP
(braket
id|FromPort
)braket
dot
id|PFlowCtrlStatus
suffix:semicolon
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_FLOW_STAT_REM_SEND
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    flowctrl:        remote send&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_FLOW_STAT_LOC_SEND
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    flowctrl:        local send&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_FLOW_STAT_SYMMETRIC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    flowctrl:        symmetric&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;    flowctrl:        none&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* tschilling: Check against CopperType now. */
r_if
c_cond
(paren
(paren
id|pAC-&gt;GIni.GICopperType
op_eq
id|SK_TRUE
)paren
op_logical_and
(paren
id|pAC-&gt;GIni.GP
(braket
id|FromPort
)braket
dot
id|PLinkSpeedUsed
op_eq
id|SK_LSPEED_STAT_1000MBPS
)paren
)paren
(brace
id|Stat
op_assign
id|pAC-&gt;GIni.GP
(braket
id|FromPort
)braket
dot
id|PMSStatus
suffix:semicolon
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_MS_STAT_MASTER
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    role:            master&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|Stat
op_eq
id|SK_MS_STAT_SLAVE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;    role:            slave&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;    role:            ???&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* &n;&t;&t;   Display dim (dynamic interrupt moderation) &n;&t;&t;   informations&n;&t;&t; */
r_if
c_cond
(paren
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_eq
id|C_INT_MOD_STATIC
)paren
id|printk
c_func
(paren
l_string|&quot;    irq moderation:  static (%d ints/sec)&bslash;n&quot;
comma
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pAC-&gt;DynIrqModInfo.IntModTypeSelect
op_eq
id|C_INT_MOD_DYNAMIC
)paren
id|printk
c_func
(paren
l_string|&quot;    irq moderation:  dynamic (%d ints/sec)&bslash;n&quot;
comma
id|pAC-&gt;DynIrqModInfo.MaxModIntsPerSec
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;    irq moderation:  disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef SK_ZEROCOPY
r_if
c_cond
(paren
id|pAC-&gt;ChipsetType
)paren
macro_line|#ifdef USE_SK_TX_CHECKSUM
id|printk
c_func
(paren
l_string|&quot;    scatter-gather:  enabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;    tx-checksum:     disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_else
id|printk
c_func
(paren
l_string|&quot;    scatter-gather:  disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;    scatter-gather:  disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef USE_SK_RX_CHECKSUM
id|printk
c_func
(paren
l_string|&quot;    rx-checksum:     disabled&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|DoPrintInterfaceChange
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|Param.Para32
(braket
l_int|0
)braket
op_ne
id|pAC-&gt;ActivePort
)paren
op_logical_and
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|1
)paren
)paren
(brace
id|NewPara.Para32
(braket
l_int|0
)braket
op_assign
id|pAC-&gt;ActivePort
suffix:semicolon
id|NewPara.Para32
(braket
l_int|1
)braket
op_assign
id|Param.Para32
(braket
l_int|0
)braket
suffix:semicolon
id|SkEventQueue
c_func
(paren
id|pAC
comma
id|SKGE_DRV
comma
id|SK_DRV_SWITCH_INTERN
comma
id|NewPara
)paren
suffix:semicolon
)brace
multiline_comment|/* Inform the world that link protocol is up. */
id|pAC-&gt;dev
(braket
id|Param.Para32
(braket
l_int|0
)braket
)braket
op_member_access_from_pointer
id|flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_DRV_NET_DOWN
suffix:colon
multiline_comment|/* SK_U32 Reason */
multiline_comment|/* action list 7 */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;NET DOWN EVENT &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DoPrintInterfaceChange
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: network connection down&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
id|Param.Para32
(braket
l_int|1
)braket
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
id|DoPrintInterfaceChange
op_assign
id|SK_TRUE
suffix:semicolon
)brace
id|pAC-&gt;dev
(braket
id|Param.Para32
(braket
l_int|1
)braket
)braket
op_member_access_from_pointer
id|flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_DRV_SWITCH_HARD
suffix:colon
multiline_comment|/* SK_U32 FromPortIdx SK_U32 ToPortIdx */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;PORT SWITCH HARD &quot;
)paren
)paren
suffix:semicolon
r_case
id|SK_DRV_SWITCH_SOFT
suffix:colon
multiline_comment|/* SK_U32 FromPortIdx SK_U32 ToPortIdx */
multiline_comment|/* action list 6 */
id|printk
c_func
(paren
l_string|&quot;%s: switching to port %c&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
comma
l_char|&squot;A&squot;
op_plus
id|Param.Para32
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_case
id|SK_DRV_SWITCH_INTERN
suffix:colon
multiline_comment|/* SK_U32 FromPortIdx SK_U32 ToPortIdx */
id|FromPort
op_assign
id|Param.Para32
(braket
l_int|0
)braket
suffix:semicolon
id|ToPort
op_assign
id|Param.Para32
(braket
l_int|1
)braket
suffix:semicolon
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;PORT SWITCH EVENT, From: %d  To: %d (Pref %d) &quot;
comma
id|FromPort
comma
id|ToPort
comma
id|pAC-&gt;Rlmt.Net
(braket
l_int|0
)braket
dot
id|PrefPort
)paren
)paren
suffix:semicolon
id|NewPara.Para64
op_assign
id|FromPort
suffix:semicolon
id|SkPnmiEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_PNMI_EVT_XMAC_RESET
comma
id|NewPara
)paren
suffix:semicolon
id|NewPara.Para64
op_assign
id|ToPort
suffix:semicolon
id|SkPnmiEvent
c_func
(paren
id|pAC
comma
id|IoC
comma
id|SK_PNMI_EVT_XMAC_RESET
comma
id|NewPara
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|SkGeStopPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
comma
id|SK_STOP_ALL
comma
id|SK_SOFT_RST
)paren
suffix:semicolon
id|SkGeStopPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPort
comma
id|SK_STOP_ALL
comma
id|SK_SOFT_RST
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|FromPort
)braket
comma
id|SK_FALSE
)paren
suffix:semicolon
multiline_comment|/* clears rx ring */
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
id|ToPort
)braket
comma
id|SK_FALSE
)paren
suffix:semicolon
multiline_comment|/* clears rx ring */
id|ClearTxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|ClearTxRing
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|pAC-&gt;ActivePort
op_assign
id|ToPort
suffix:semicolon
macro_line|#if 0
id|SetQueueSizes
c_func
(paren
id|pAC
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* tschilling: New common function with minimum size check. */
id|DualNet
op_assign
id|SK_FALSE
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;RlmtNets
op_eq
l_int|2
)paren
(brace
id|DualNet
op_assign
id|SK_TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SkGeInitAssignRamToQueues
c_func
(paren
id|pAC
comma
id|pAC-&gt;ActivePort
comma
id|DualNet
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SkGeInitAssignRamToQueues failed.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* tschilling: Handling of return values inserted. */
r_if
c_cond
(paren
id|SkGeInitPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
op_logical_or
id|SkGeInitPort
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPort
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SkGeInitPort failed.&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Event
op_eq
id|SK_DRV_SWITCH_SOFT
)paren
(brace
id|SkMacRxTxEnable
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
suffix:semicolon
)brace
id|SkMacRxTxEnable
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPort
)paren
suffix:semicolon
id|SkAddrSwap
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
comma
id|ToPort
)paren
suffix:semicolon
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
)paren
suffix:semicolon
id|SkAddrMcUpdate
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPort
)paren
suffix:semicolon
id|PortReInitBmu
c_func
(paren
id|pAC
comma
id|FromPort
)paren
suffix:semicolon
id|PortReInitBmu
c_func
(paren
id|pAC
comma
id|ToPort
)paren
suffix:semicolon
id|SkGePollTxD
c_func
(paren
id|pAC
comma
id|IoC
comma
id|FromPort
comma
id|SK_TRUE
)paren
suffix:semicolon
id|SkGePollTxD
c_func
(paren
id|pAC
comma
id|IoC
comma
id|ToPort
comma
id|SK_TRUE
)paren
suffix:semicolon
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
id|FromPort
)paren
suffix:semicolon
id|ClearAndStartRx
c_func
(paren
id|pAC
comma
id|ToPort
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|ToPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;TxPort
(braket
id|FromPort
)braket
(braket
id|TX_PRIO_LOW
)braket
dot
id|TxDesRingLock
comma
id|Flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_DRV_RLMT_SEND
suffix:colon
multiline_comment|/* SK_MBUF *pMb */
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;RLS &quot;
)paren
)paren
suffix:semicolon
id|pRlmtMbuf
op_assign
(paren
id|SK_MBUF
op_star
)paren
id|Param.pParaPtr
suffix:semicolon
id|pMsg
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|pRlmtMbuf-&gt;pOs
suffix:semicolon
id|skb_put
c_func
(paren
id|pMsg
comma
id|pRlmtMbuf-&gt;Length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|XmitFrame
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;TxPort
(braket
id|pRlmtMbuf-&gt;PortIdx
)braket
(braket
id|TX_PRIO_LOW
)braket
comma
id|pMsg
)paren
OL
l_int|0
)paren
id|DEV_KFREE_SKB_ANY
c_func
(paren
id|pMsg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_DRV_TIMER
suffix:colon
r_if
c_cond
(paren
id|Param.Para32
(braket
l_int|0
)braket
op_eq
id|SK_DRV_MODERATION_TIMER
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;** expiration of the moderation timer implies that&n;&t;&t;&t;** dynamic moderation is to be applied&n;&t;&t;&t;*/
id|SkDimStartModerationTimer
c_func
(paren
id|pAC
)paren
suffix:semicolon
id|SkDimModerate
c_func
(paren
id|pAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;DynIrqModInfo.DisplayStats
)paren
(brace
id|SkDimDisplayModerationSettings
c_func
(paren
id|pAC
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|Param.Para32
(braket
l_int|0
)braket
op_eq
id|SK_DRV_RX_CLEANUP_TIMER
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;** check if we need to check for descriptors which&n;&t;&t;&t;** haven&squot;t been handled the last millisecs&n;&t;&t;&t;*/
id|StartDrvCleanupTimer
c_func
(paren
id|pAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;GIni.GIMacsFound
op_eq
l_int|2
)paren
(brace
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
l_int|1
)braket
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
id|ReceiveIrq
c_func
(paren
id|pAC
comma
op_amp
id|pAC-&gt;RxPort
(braket
l_int|0
)braket
comma
id|SK_FALSE
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Expiration of unknown timer&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|SK_DBG_MSG
c_func
(paren
l_int|NULL
comma
id|SK_DBGMOD_DRV
comma
id|SK_DBGCAT_DRV_EVENT
comma
(paren
l_string|&quot;END EVENT &quot;
)paren
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkDrvEvent */
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkErrorLog - log errors&n; *&n; * Description:&n; *&t;This function logs errors to the system buffer and to the console&n; *&n; * Returns:&n; *&t;0 if everything ok&n; *&t;&lt; 0  on error&n; *&t;&n; */
DECL|function|SkErrorLog
r_void
id|SkErrorLog
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
r_int
id|ErrClass
comma
r_int
id|ErrNum
comma
r_char
op_star
id|pErrorMsg
)paren
(brace
r_char
id|ClassStr
(braket
l_int|80
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|ErrClass
)paren
(brace
r_case
id|SK_ERRCL_OTHER
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Other error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_CONFIG
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Configuration error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_INIT
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Initialization error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_NORES
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Out of resources error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_SW
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;internal Software error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_HW
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Hardware failure&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SK_ERRCL_COMM
suffix:colon
id|strcpy
c_func
(paren
id|ClassStr
comma
l_string|&quot;Communication error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: -- ERROR --&bslash;n        Class:  %s&bslash;n&quot;
l_string|&quot;        Nr:  0x%x&bslash;n        Msg:  %s&bslash;n&quot;
comma
id|pAC-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|name
comma
id|ClassStr
comma
id|ErrNum
comma
id|pErrorMsg
)paren
suffix:semicolon
)brace
multiline_comment|/* SkErrorLog */
macro_line|#ifdef SK_DIAG_SUPPORT
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkDrvEnterDiagMode - handles DIAG attach request&n; *&n; * Description:&n; *&t;Notify the kernel to NOT access the card any longer due to DIAG&n; *&t;Deinitialize the Card&n; *&n; * Returns:&n; *&t;int&n; */
DECL|function|SkDrvEnterDiagMode
r_int
id|SkDrvEnterDiagMode
c_func
(paren
id|SK_AC
op_star
id|pAc
)paren
multiline_comment|/* pointer to adapter context */
(brace
id|SK_AC
op_star
id|pAC
op_assign
l_int|NULL
suffix:semicolon
id|DEV_NET
op_star
id|pNet
op_assign
l_int|NULL
suffix:semicolon
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|pAc-&gt;dev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
id|SK_MEMCPY
c_func
(paren
op_amp
(paren
id|pAc-&gt;PnmiBackup
)paren
comma
op_amp
(paren
id|pAc-&gt;PnmiStruct
)paren
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|pAC-&gt;DiagModeActive
op_assign
id|DIAG_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
id|pAC-&gt;BoardLevel
OG
id|SK_INIT_DATA
)paren
(brace
r_if
c_cond
(paren
id|pNet-&gt;Up
)paren
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|0
)braket
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;DiagFlowCtrl
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/* for SkGeClose      */
id|DoPrintInterfaceChange
op_assign
id|SK_FALSE
suffix:semicolon
id|SkDrvDeInitAdapter
c_func
(paren
id|pAC
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* performs SkGeClose */
)brace
r_else
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|0
)braket
op_assign
id|SK_FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pNet
op_ne
(paren
id|DEV_NET
op_star
)paren
id|pAc-&gt;dev
(braket
l_int|1
)braket
op_member_access_from_pointer
id|priv
)paren
(brace
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|pAc-&gt;dev
(braket
l_int|1
)braket
op_member_access_from_pointer
id|priv
suffix:semicolon
r_if
c_cond
(paren
id|pNet-&gt;Up
)paren
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|1
)braket
op_assign
id|SK_TRUE
suffix:semicolon
id|pAC-&gt;DiagFlowCtrl
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/* for SkGeClose */
id|DoPrintInterfaceChange
op_assign
id|SK_FALSE
suffix:semicolon
id|SkDrvDeInitAdapter
c_func
(paren
id|pAC
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* do SkGeClose  */
)brace
r_else
(brace
id|pAC-&gt;WasIfUp
(braket
l_int|1
)braket
op_assign
id|SK_FALSE
suffix:semicolon
)brace
)brace
id|pAC-&gt;BoardLevel
op_assign
id|SK_INIT_DATA
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; *&t;SkDrvLeaveDiagMode - handles DIAG detach request&n; *&n; * Description:&n; *&t;Notify the kernel to may access the card again after use by DIAG&n; *&t;Initialize the Card&n; *&n; * Returns:&n; * &t;int&n; */
DECL|function|SkDrvLeaveDiagMode
r_int
id|SkDrvLeaveDiagMode
c_func
(paren
id|SK_AC
op_star
id|pAc
)paren
multiline_comment|/* pointer to adapter control context */
(brace
id|SK_MEMCPY
c_func
(paren
op_amp
(paren
id|pAc-&gt;PnmiStruct
)paren
comma
op_amp
(paren
id|pAc-&gt;PnmiBackup
)paren
comma
r_sizeof
(paren
id|SK_PNMI_STRUCT_DATA
)paren
)paren
suffix:semicolon
id|pAc-&gt;DiagModeActive
op_assign
id|DIAG_NOTACTIVE
suffix:semicolon
id|pAc-&gt;Pnmi.DiagAttached
op_assign
id|SK_DIAG_IDLE
suffix:semicolon
r_if
c_cond
(paren
id|pAc-&gt;WasIfUp
(braket
l_int|0
)braket
op_eq
id|SK_TRUE
)paren
(brace
id|pAc-&gt;DiagFlowCtrl
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/* for SkGeClose */
id|DoPrintInterfaceChange
op_assign
id|SK_FALSE
suffix:semicolon
id|SkDrvInitAdapter
c_func
(paren
id|pAc
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* first device  */
)brace
r_if
c_cond
(paren
id|pAc-&gt;WasIfUp
(braket
l_int|1
)braket
op_eq
id|SK_TRUE
)paren
(brace
id|pAc-&gt;DiagFlowCtrl
op_assign
id|SK_TRUE
suffix:semicolon
multiline_comment|/* for SkGeClose */
id|DoPrintInterfaceChange
op_assign
id|SK_FALSE
suffix:semicolon
id|SkDrvInitAdapter
c_func
(paren
id|pAc
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* second device */
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; *&t;ParseDeviceNbrFromSlotName - Evaluate PCI device number&n; *&n; * Description:&n; * &t;This function parses the PCI slot name information string and will&n; *&t;retrieve the devcie number out of it. The slot_name maintianed by&n; *&t;linux is in the form of &squot;02:0a.0&squot;, whereas the first two characters &n; *&t;represent the bus number in hex (in the sample above this is &n; *&t;pci bus 0x02) and the next two characters the device number (0x0a).&n; *&n; * Returns:&n; *&t;SK_U32: The device number from the PCI slot name&n; */
DECL|function|ParseDeviceNbrFromSlotName
r_static
id|SK_U32
id|ParseDeviceNbrFromSlotName
c_func
(paren
r_const
r_char
op_star
id|SlotName
)paren
multiline_comment|/* pointer to pci slot name eg. &squot;02:0a.0&squot; */
(brace
r_char
op_star
id|CurrCharPos
op_assign
(paren
r_char
op_star
)paren
id|SlotName
suffix:semicolon
r_int
id|FirstNibble
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|SecondNibble
op_assign
op_minus
l_int|1
suffix:semicolon
id|SK_U32
id|Result
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_star
id|CurrCharPos
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_if
c_cond
(paren
op_star
id|CurrCharPos
op_eq
l_char|&squot;:&squot;
)paren
(brace
r_while
c_loop
(paren
op_star
id|CurrCharPos
op_ne
l_char|&squot;.&squot;
)paren
(brace
id|CurrCharPos
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|CurrCharPos
op_ge
l_char|&squot;0&squot;
)paren
op_logical_and
(paren
op_star
id|CurrCharPos
op_le
l_char|&squot;9&squot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|FirstNibble
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* dec. value for &squot;0&squot; */
id|FirstNibble
op_assign
op_star
id|CurrCharPos
op_minus
l_int|48
suffix:semicolon
)brace
r_else
(brace
id|SecondNibble
op_assign
op_star
id|CurrCharPos
op_minus
l_int|48
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
op_star
id|CurrCharPos
op_ge
l_char|&squot;a&squot;
)paren
op_logical_and
(paren
op_star
id|CurrCharPos
op_le
l_char|&squot;f&squot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|FirstNibble
op_eq
op_minus
l_int|1
)paren
(brace
id|FirstNibble
op_assign
op_star
id|CurrCharPos
op_minus
l_int|87
suffix:semicolon
)brace
r_else
(brace
id|SecondNibble
op_assign
op_star
id|CurrCharPos
op_minus
l_int|87
suffix:semicolon
)brace
)brace
r_else
(brace
id|Result
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|Result
op_assign
id|FirstNibble
suffix:semicolon
id|Result
op_assign
id|Result
op_lshift
l_int|4
suffix:semicolon
multiline_comment|/* first nibble is higher one */
id|Result
op_assign
id|Result
op_or
id|SecondNibble
suffix:semicolon
)brace
id|CurrCharPos
op_increment
suffix:semicolon
multiline_comment|/* next character */
)brace
r_return
(paren
id|Result
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; *&t;SkDrvDeInitAdapter - deinitialize adapter (this function is only &n; *&t;&t;&t;&t;called if Diag attaches to that card)&n; *&n; * Description:&n; *&t;Close initialized adapter.&n; *&n; * Returns:&n; *&t;0 - on success&n; *&t;error code - on error&n; */
DECL|function|SkDrvDeInitAdapter
r_static
r_int
id|SkDrvDeInitAdapter
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context   */
r_int
id|devNbr
)paren
multiline_comment|/* what device is to be handled */
(brace
r_struct
id|SK_NET_DEVICE
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|pAC-&gt;dev
(braket
id|devNbr
)braket
suffix:semicolon
multiline_comment|/*&n;&t;** Function SkGeClose() uses MOD_DEC_USE_COUNT (2.2/2.4)&n;&t;** or module_put() (2.6) to decrease the number of users for&n;&t;** a device, but if a device is to be put under control of &n;&t;** the DIAG, that count is OK already and does not need to &n;&t;** be adapted! Hence the opposite MOD_INC_USE_COUNT or &n;&t;** try_module_get() needs to be used again to correct that.&n;&t;*/
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|THIS_MODULE
)paren
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SkGeClose
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
(brace
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkDrvDeInitAdapter() */
multiline_comment|/****************************************************************************&n; *&n; *&t;SkDrvInitAdapter - Initialize adapter (this function is only &n; *&t;&t;&t;&t;called if Diag deattaches from that card)&n; *&n; * Description:&n; *&t;Close initialized adapter.&n; *&n; * Returns:&n; *&t;0 - on success&n; *&t;error code - on error&n; */
DECL|function|SkDrvInitAdapter
r_static
r_int
id|SkDrvInitAdapter
c_func
(paren
id|SK_AC
op_star
id|pAC
comma
multiline_comment|/* pointer to adapter context   */
r_int
id|devNbr
)paren
multiline_comment|/* what device is to be handled */
(brace
r_struct
id|SK_NET_DEVICE
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|pAC-&gt;dev
(braket
id|devNbr
)braket
suffix:semicolon
r_if
c_cond
(paren
id|SkGeOpen
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;** Function SkGeOpen() uses MOD_INC_USE_COUNT (2.2/2.4) &n;&t;&t;** or try_module_get() (2.6) to increase the number of &n;&t;&t;** users for a device, but if a device was just under &n;&t;&t;** control of the DIAG, that count is OK already and &n;&t;&t;** does not need to be adapted! Hence the opposite &n;&t;&t;** MOD_DEC_USE_COUNT or module_put() needs to be used &n;&t;&t;** again to correct that.&n;&t;&t;*/
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;** Use correct MTU size and indicate to kernel TX queue can be started&n;&t;*/
r_if
c_cond
(paren
id|SkGeChangeMtu
c_func
(paren
id|dev
comma
id|dev-&gt;mtu
)paren
op_ne
l_int|0
)paren
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* SkDrvInitAdapter */
macro_line|#endif
macro_line|#ifdef DEBUG
multiline_comment|/****************************************************************************/
multiline_comment|/* &quot;debug only&quot; section *****************************************************/
multiline_comment|/****************************************************************************/
multiline_comment|/*****************************************************************************&n; *&n; *&t;DumpMsg - print a frame&n; *&n; * Description:&n; *&t;This function prints frames to the system logfile/to the console.&n; *&n; * Returns: N/A&n; *&t;&n; */
DECL|function|DumpMsg
r_static
r_void
id|DumpMsg
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|str
)paren
(brace
r_int
id|msglen
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DumpMsg(): NULL-Message&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;data
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DumpMsg(): Message empty&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|msglen
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|msglen
OG
l_int|64
)paren
id|msglen
op_assign
l_int|64
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;--- Begin of message from %s , len %d (from %d) ----&bslash;n&quot;
comma
id|str
comma
id|msglen
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|DumpData
c_func
(paren
(paren
r_char
op_star
)paren
id|skb-&gt;data
comma
id|msglen
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;------- End of message ---------&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* DumpMsg */
multiline_comment|/*****************************************************************************&n; *&n; *&t;DumpData - print a data area&n; *&n; * Description:&n; *&t;This function prints a area of data to the system logfile/to the&n; *&t;console.&n; *&n; * Returns: N/A&n; *&t;&n; */
DECL|function|DumpData
r_static
r_void
id|DumpData
c_func
(paren
r_char
op_star
id|p
comma
r_int
id|size
)paren
(brace
r_register
r_int
id|i
suffix:semicolon
r_int
id|haddr
comma
id|addr
suffix:semicolon
r_char
id|hex_buffer
(braket
l_int|180
)braket
suffix:semicolon
r_char
id|asc_buffer
(braket
l_int|180
)braket
suffix:semicolon
r_char
id|HEXCHAR
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
id|haddr
op_assign
l_int|0
suffix:semicolon
id|hex_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|asc_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_star
id|p
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|p
op_le
l_char|&squot;z&squot;
)paren
id|asc_buffer
(braket
id|addr
)braket
op_assign
op_star
id|p
suffix:semicolon
r_else
id|asc_buffer
(braket
id|addr
)braket
op_assign
l_char|&squot;.&squot;
suffix:semicolon
id|addr
op_increment
suffix:semicolon
id|asc_buffer
(braket
id|addr
)braket
op_assign
l_int|0
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
op_star
id|p
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
op_star
id|p
op_amp
l_int|0x0f
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
l_int|0
suffix:semicolon
id|p
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|16
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s  %s&bslash;n&quot;
comma
id|hex_buffer
comma
id|asc_buffer
)paren
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
id|haddr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* DumpData */
multiline_comment|/*****************************************************************************&n; *&n; *&t;DumpLong - print a data area as long values&n; *&n; * Description:&n; *&t;This function prints a area of data to the system logfile/to the&n; *&t;console.&n; *&n; * Returns: N/A&n; *&t;&n; */
DECL|function|DumpLong
r_static
r_void
id|DumpLong
c_func
(paren
r_char
op_star
id|pc
comma
r_int
id|size
)paren
(brace
r_register
r_int
id|i
suffix:semicolon
r_int
id|haddr
comma
id|addr
suffix:semicolon
r_char
id|hex_buffer
(braket
l_int|180
)braket
suffix:semicolon
r_char
id|asc_buffer
(braket
l_int|180
)braket
suffix:semicolon
r_char
id|HEXCHAR
(braket
)braket
op_assign
l_string|&quot;0123456789ABCDEF&quot;
suffix:semicolon
r_int
op_star
id|p
suffix:semicolon
r_int
id|l
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
id|haddr
op_assign
l_int|0
suffix:semicolon
id|hex_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|asc_buffer
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
id|pc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
)paren
(brace
id|l
op_assign
(paren
r_int
)paren
op_star
id|p
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|28
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|24
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|20
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|16
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|12
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|8
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
(paren
id|l
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
id|HEXCHAR
(braket
id|l
op_amp
l_int|0x0f
)braket
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|haddr
op_increment
suffix:semicolon
id|hex_buffer
(braket
id|haddr
)braket
op_assign
l_int|0
suffix:semicolon
id|p
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%4x %s&bslash;n&quot;
comma
(paren
id|i
op_minus
l_int|8
)paren
op_star
l_int|4
comma
id|hex_buffer
)paren
suffix:semicolon
id|haddr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;------------------------&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* DumpLong */
macro_line|#endif
multiline_comment|/*******************************************************************************&n; *&n; * End of file&n; *&n; ******************************************************************************/
eof
