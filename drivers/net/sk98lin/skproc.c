multiline_comment|/******************************************************************************&n; *&n; * Name:    skproc.c&n; * Project:&t;GEnesis, PCI Gigabit Ethernet Adapter&n; * Version:&t;$Revision: 1.2.2.2 $&n; * Date:    $Date: 2001/03/15 12:50:13 $&n; * Purpose:&t;Funktions to display statictic data&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; *&t;(C)Copyright 1998-2001 SysKonnect GmbH.&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;Created 22-Nov-2000&n; *&t;Author: Mirko Lindner (mlindner@syskonnect.de)&n; *&n; *&t;The information in this file is provided &quot;AS IS&quot; without warranty.&n; *&n; ******************************************************************************/
multiline_comment|/******************************************************************************&n; *&n; * History:&n; *&n; *&t;$Log: skproc.c,v $&n; *&t;Revision 1.2.2.2  2001/03/15 12:50:13  mlindner&n; *&t;fix: ProcFS owner protection&n; *&t;&n; *&t;Revision 1.2.2.1  2001/03/12 16:43:48  mlindner&n; *&t;chg: 2.4 requirements for procfs&n; *&t;&n; *&t;Revision 1.1  2001/01/22 14:15:31  mlindner&n; *&t;added ProcFs functionality&n; *&t;Dual Net functionality integrated&n; *&t;Rlmt networks added&n; *&t;&n; *&n; ******************************************************************************/
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &quot;h/skdrv1st.h&quot;
macro_line|#include &quot;h/skdrv2nd.h&quot;
r_extern
id|spinlock_t
id|sk_devs_lock
suffix:semicolon
DECL|function|sk_show_dev
r_static
r_int
id|sk_show_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
id|DEV_NET
op_star
id|pNet
op_assign
(paren
id|DEV_NET
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|SK_AC
op_star
id|pAC
op_assign
id|pNet-&gt;pAC
suffix:semicolon
r_int
id|t
op_assign
id|pNet-&gt;PortNr
suffix:semicolon
id|SK_RLMT_NET
op_star
id|rlmt
op_assign
op_amp
id|pAC-&gt;Rlmt.Net
(braket
id|t
)braket
suffix:semicolon
r_int
r_int
id|Flags
suffix:semicolon
r_int
id|Size
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|SK_PNMI_STRUCT_DATA
op_star
id|pPnmiStruct
op_assign
op_amp
id|pAC-&gt;PnmiStruct
suffix:semicolon
id|SK_PNMI_STAT
op_star
id|pPnmiStat
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|Size
op_assign
id|SK_PNMI_STRUCT_SIZE
suffix:semicolon
id|SkPnmiGetStruct
c_func
(paren
id|pAC
comma
id|pAC-&gt;IoBase
comma
id|pPnmiStruct
comma
op_amp
id|Size
comma
id|t
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pAC-&gt;SlowPathLock
comma
id|Flags
)paren
suffix:semicolon
id|pPnmiStat
op_assign
op_amp
id|pPnmiStruct-&gt;Stat
(braket
l_int|0
)braket
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;nDetailed statistic for device %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;==================================&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Board statistics */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;nBoard statistics&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Active Port               %c&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|rlmt-&gt;Port
(braket
id|rlmt-&gt;ActivePort
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Preferred Port            %c&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|rlmt-&gt;Port
(braket
id|rlmt-&gt;PrefPort
)braket
op_member_access_from_pointer
id|PortNumber
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Bus speed (Mhz)           %d&bslash;n&quot;
comma
id|pPnmiStruct-&gt;BusSpeed
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Bus width (Bit)           %d&bslash;n&quot;
comma
id|pPnmiStruct-&gt;BusWidth
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SK_MAX_SENSORS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|SK_SENSOR
op_star
id|sens
op_assign
op_amp
id|pAC-&gt;I2c.SenTable
(braket
id|i
)braket
suffix:semicolon
id|SK_I32
id|val
op_assign
id|sens-&gt;SenValue
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|sens-&gt;SenDesc
comma
l_string|&quot;Temperature&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Temperature (C)           %d.%d&bslash;n&quot;
comma
id|val
op_div
l_int|10
comma
id|val
op_mod
l_int|10
)paren
suffix:semicolon
id|val
op_assign
id|val
op_star
l_int|18
op_plus
l_int|3200
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Temperature (F)           %d.%d&bslash;n&quot;
comma
id|val
op_div
l_int|100
comma
id|val
op_mod
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|sens-&gt;SenDesc
comma
l_string|&quot;Speed Fan&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Speed Fan                 %d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%-20s      %d.%d&bslash;n&quot;
comma
id|sens-&gt;SenDesc
comma
id|val
op_div
l_int|1000
comma
id|val
op_mod
l_int|1000
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*Receive statistics */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;nReceive statistics&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received bytes            %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxOctetsOkCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received packets          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxOkCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received errors           %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxFcsCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received dropped          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStruct-&gt;RxNoBufCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received multicast        %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxMulticastOkCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Received errors types&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   length errors          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxRuntCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   over errors            %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxFifoOverflowCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   crc errors             %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxFcsCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   frame errors           %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxFramingCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   fifo errors            %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxFifoOverflowCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   missed errors          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatRxMissedCts
)paren
suffix:semicolon
multiline_comment|/*Transmit statistics */
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;&bslash;nTransmit statistics&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmit bytes            %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxOctetsOkCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmit packets          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxOkCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmit errors           %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxSingleCollisionCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmit dropped          %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStruct-&gt;TxNoBufCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmit collisions       %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxSingleCollisionCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;Transmited errors types&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   aborted errors         %ld&bslash;n&quot;
comma
id|pAC-&gt;stats.tx_aborted_errors
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   carrier errors         %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxCarrierCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   fifo errors            %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxFifoUnderrunCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   heartbeat errors       %Ld&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|pPnmiStat-&gt;StatTxCarrierCts
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;   window errors          %ld&bslash;n&quot;
comma
id|pAC-&gt;stats.tx_window_errors
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|sk_read
r_static
id|ssize_t
id|sk_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|nbytes
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
id|PDE
c_func
(paren
id|inode
)paren
suffix:semicolon
r_char
op_star
id|page
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|loff_t
id|pos
op_assign
op_star
id|ppos
suffix:semicolon
id|ssize_t
id|res
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sk_devs_lock
)paren
suffix:semicolon
id|dev
op_assign
id|entry-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|len
op_assign
id|sk_show_dev
c_func
(paren
id|dev
comma
id|page
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sk_devs_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_ge
l_int|0
op_logical_and
id|pos
OL
id|len
)paren
(brace
id|res
op_assign
id|nbytes
suffix:semicolon
r_if
c_cond
(paren
id|res
OG
id|len
op_minus
id|pos
)paren
id|res
op_assign
id|len
op_minus
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|page
op_plus
id|pos
comma
id|buf
comma
id|nbytes
)paren
)paren
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
op_star
id|ppos
op_assign
id|pos
op_plus
id|res
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|page
)paren
suffix:semicolon
r_return
id|nbytes
suffix:semicolon
)brace
DECL|function|sk_lseek
r_static
id|loff_t
id|sk_lseek
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|loff_t
id|offset
comma
r_int
id|orig
)paren
(brace
r_switch
c_cond
(paren
id|orig
)paren
(brace
r_case
l_int|1
suffix:colon
id|offset
op_add_assign
id|file-&gt;f_pos
suffix:semicolon
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|offset
op_ge
l_int|0
)paren
r_return
id|file-&gt;f_pos
op_assign
id|offset
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|variable|sk_proc_fops
r_struct
id|file_operations
id|sk_proc_fops
op_assign
(brace
dot
id|read
op_assign
id|sk_read
comma
dot
id|llseek
op_assign
id|sk_lseek
comma
)brace
suffix:semicolon
eof
