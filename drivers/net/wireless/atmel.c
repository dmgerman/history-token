multiline_comment|/*** -*- linux-c -*- **********************************************************&n;&n;     Driver for Atmel at76c502 at76c504 and at76c506 wireless cards.&n;&n;        Copyright 2000-2001 ATMEL Corporation.&n;        Copyright 2003 Simon Kelley.&n;&n;    This code was developed from version 2.1.1 of the Atmel drivers, &n;    released by Atmel corp. under the GPL in December 2002. It also &n;    includes code from the Linux aironet drivers (C) Benjamin Reed, &n;    and the Linux PCMCIA package, (C) David Hinds and the Linux wireless&n;    extensions, (C) Jean Tourrilhes.&n;&n;    The firmware module for reading the MAC address of the card comes from&n;    net.russotto.AtmelMACFW, written by Matthew T. Russotto and copyright&n;    by him. net.russotto.AtmelMACFW is used under the GPL license version 2.&n;    This file contains the module in binary form and, under the terms&n;    of the GPL, in source form. The source is located at the end of the file.&n;&n;    For all queries about this code, please contact the current author, &n;    Simon Kelley &lt;simon@thekelleys.org.uk&gt; and not Atmel Corporation.&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This software is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with Atmel wireless lan drivers; if not, write to the Free Software&n;    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;&n;******************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;net/iw_handler.h&gt;
macro_line|#include &lt;linux/byteorder/generic.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/firmware.h&gt;
macro_line|#include &quot;ieee802_11.h&quot;
DECL|macro|DRIVER_MAJOR
mdefine_line|#define DRIVER_MAJOR 0
DECL|macro|DRIVER_MINOR
mdefine_line|#define DRIVER_MINOR 8
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Simon Kelley&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Support for Atmel at76c50x 802.11 wireless ethernet cards.&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;Atmel at76c50x wireless cards&quot;
)paren
suffix:semicolon
multiline_comment|/* The name of the firmware file to be loaded &n;   over-rides any automatic selection */
DECL|variable|firmware
r_static
r_char
op_star
id|firmware
op_assign
l_int|NULL
suffix:semicolon
id|module_param
c_func
(paren
id|firmware
comma
id|charp
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|MAX_SSID_LENGTH
mdefine_line|#define MAX_SSID_LENGTH 32
DECL|macro|MGMT_JIFFIES
mdefine_line|#define MGMT_JIFFIES (256 * HZ / 100)
DECL|macro|MAX_BSS_ENTRIES
mdefine_line|#define MAX_BSS_ENTRIES&t;64&t;
multiline_comment|/* registers */
DECL|macro|GCR
mdefine_line|#define GCR  0x00    
singleline_comment|//      (SIR0)  General Configuration Register        
DECL|macro|BSR
mdefine_line|#define BSR  0x02    
singleline_comment|//      (SIR1)  Bank Switching Select Register 
DECL|macro|AR
mdefine_line|#define AR   0x04
DECL|macro|DR
mdefine_line|#define DR   0x08
DECL|macro|MR1
mdefine_line|#define MR1  0x12    
singleline_comment|//      Mirror Register 1                  
DECL|macro|MR2
mdefine_line|#define MR2  0x14    
singleline_comment|//      Mirror Register 2  
DECL|macro|MR3
mdefine_line|#define MR3  0x16    
singleline_comment|//      Mirror Register 3  
DECL|macro|MR4
mdefine_line|#define MR4  0x18    
singleline_comment|//      Mirror Register 4   
DECL|macro|GPR1
mdefine_line|#define GPR1                            0x0c
DECL|macro|GPR2
mdefine_line|#define GPR2                            0x0e
DECL|macro|GPR3
mdefine_line|#define GPR3                            0x10
singleline_comment|//
singleline_comment|// Constants for the GCR register.
singleline_comment|//
DECL|macro|GCR_REMAP
mdefine_line|#define GCR_REMAP     0x0400          
singleline_comment|// Remap internal SRAM to 0
DECL|macro|GCR_SWRES
mdefine_line|#define GCR_SWRES     0x0080          
singleline_comment|// BIU reset (ARM and PAI are NOT reset) 
DECL|macro|GCR_CORES
mdefine_line|#define GCR_CORES     0x0060          
singleline_comment|// Core Reset (ARM and PAI are reset)
DECL|macro|GCR_ENINT
mdefine_line|#define GCR_ENINT     0x0002          
singleline_comment|// Enable Interrupts    
DECL|macro|GCR_ACKINT
mdefine_line|#define GCR_ACKINT    0x0008          
singleline_comment|// Acknowledge Interrupts
DECL|macro|BSS_SRAM
mdefine_line|#define BSS_SRAM      0x0200          
singleline_comment|// AMBA module selection --&gt; SRAM
DECL|macro|BSS_IRAM
mdefine_line|#define BSS_IRAM      0x0100          
singleline_comment|// AMBA module selection --&gt; IRAM
singleline_comment|//
singleline_comment|// Constants for the MR registers.
singleline_comment|//
DECL|macro|MAC_INIT_COMPLETE
mdefine_line|#define MAC_INIT_COMPLETE       0x0001        
singleline_comment|// MAC init has been completed
DECL|macro|MAC_BOOT_COMPLETE
mdefine_line|#define MAC_BOOT_COMPLETE       0x0010        
singleline_comment|// MAC boot has been completed
DECL|macro|MAC_INIT_OK
mdefine_line|#define MAC_INIT_OK             0x0002        
singleline_comment|// MAC boot has been completed
DECL|macro|C80211_SUBTYPE_MGMT_ASS_REQUEST
mdefine_line|#define C80211_SUBTYPE_MGMT_ASS_REQUEST                 0x00
DECL|macro|C80211_SUBTYPE_MGMT_ASS_RESPONSE
mdefine_line|#define C80211_SUBTYPE_MGMT_ASS_RESPONSE                0x10
DECL|macro|C80211_SUBTYPE_MGMT_REASS_REQUEST
mdefine_line|#define C80211_SUBTYPE_MGMT_REASS_REQUEST               0x20
DECL|macro|C80211_SUBTYPE_MGMT_REASS_RESPONSE
mdefine_line|#define C80211_SUBTYPE_MGMT_REASS_RESPONSE              0x30
DECL|macro|C80211_SUBTYPE_MGMT_ProbeRequest
mdefine_line|#define C80211_SUBTYPE_MGMT_ProbeRequest                0x40
DECL|macro|C80211_SUBTYPE_MGMT_ProbeResponse
mdefine_line|#define C80211_SUBTYPE_MGMT_ProbeResponse               0x50
DECL|macro|C80211_SUBTYPE_MGMT_BEACON
mdefine_line|#define C80211_SUBTYPE_MGMT_BEACON                      0x80
DECL|macro|C80211_SUBTYPE_MGMT_ATIM
mdefine_line|#define C80211_SUBTYPE_MGMT_ATIM                        0x90
DECL|macro|C80211_SUBTYPE_MGMT_DISASSOSIATION
mdefine_line|#define C80211_SUBTYPE_MGMT_DISASSOSIATION              0xA0
DECL|macro|C80211_SUBTYPE_MGMT_Authentication
mdefine_line|#define C80211_SUBTYPE_MGMT_Authentication              0xB0
DECL|macro|C80211_SUBTYPE_MGMT_Deauthentication
mdefine_line|#define C80211_SUBTYPE_MGMT_Deauthentication    0xC0
DECL|macro|C80211_MGMT_AAN_OPENSYSTEM
mdefine_line|#define C80211_MGMT_AAN_OPENSYSTEM              0x0000
DECL|macro|C80211_MGMT_AAN_SHAREDKEY
mdefine_line|#define C80211_MGMT_AAN_SHAREDKEY               0x0001
DECL|macro|C80211_MGMT_CAPABILITY_ESS
mdefine_line|#define C80211_MGMT_CAPABILITY_ESS              0x0001  
singleline_comment|// see 802.11 p.58
DECL|macro|C80211_MGMT_CAPABILITY_IBSS
mdefine_line|#define C80211_MGMT_CAPABILITY_IBSS             0x0002  
singleline_comment|//      - &quot; -
DECL|macro|C80211_MGMT_CAPABILITY_CFPollable
mdefine_line|#define C80211_MGMT_CAPABILITY_CFPollable       0x0004  
singleline_comment|//      - &quot; -
DECL|macro|C80211_MGMT_CAPABILITY_CFPollRequest
mdefine_line|#define C80211_MGMT_CAPABILITY_CFPollRequest    0x0008  
singleline_comment|//      - &quot; -
DECL|macro|C80211_MGMT_CAPABILITY_Privacy
mdefine_line|#define C80211_MGMT_CAPABILITY_Privacy          0x0010  
singleline_comment|//      - &quot; -
DECL|macro|C80211_MGMT_SC_Success
mdefine_line|#define C80211_MGMT_SC_Success                  0
DECL|macro|C80211_MGMT_SC_Unspecified
mdefine_line|#define C80211_MGMT_SC_Unspecified              1
DECL|macro|C80211_MGMT_SC_SupportCapabilities
mdefine_line|#define C80211_MGMT_SC_SupportCapabilities      10
DECL|macro|C80211_MGMT_SC_ReassDenied
mdefine_line|#define C80211_MGMT_SC_ReassDenied              11
DECL|macro|C80211_MGMT_SC_AssDenied
mdefine_line|#define C80211_MGMT_SC_AssDenied                12
DECL|macro|C80211_MGMT_SC_AuthAlgNotSupported
mdefine_line|#define C80211_MGMT_SC_AuthAlgNotSupported      13
DECL|macro|C80211_MGMT_SC_AuthTransSeqNumError
mdefine_line|#define C80211_MGMT_SC_AuthTransSeqNumError     14
DECL|macro|C80211_MGMT_SC_AuthRejectChallenge
mdefine_line|#define C80211_MGMT_SC_AuthRejectChallenge      15
DECL|macro|C80211_MGMT_SC_AuthRejectTimeout
mdefine_line|#define C80211_MGMT_SC_AuthRejectTimeout        16
DECL|macro|C80211_MGMT_SC_AssDeniedHandleAP
mdefine_line|#define C80211_MGMT_SC_AssDeniedHandleAP        17
DECL|macro|C80211_MGMT_SC_AssDeniedBSSRate
mdefine_line|#define C80211_MGMT_SC_AssDeniedBSSRate         18
DECL|macro|C80211_MGMT_ElementID_SSID
mdefine_line|#define C80211_MGMT_ElementID_SSID              0
DECL|macro|C80211_MGMT_ElementID_SupportedRates
mdefine_line|#define C80211_MGMT_ElementID_SupportedRates    1
DECL|macro|C80211_MGMT_ElementID_ChallengeText
mdefine_line|#define C80211_MGMT_ElementID_ChallengeText     16
DECL|macro|C80211_MGMT_CAPABILITY_ShortPreamble
mdefine_line|#define C80211_MGMT_CAPABILITY_ShortPreamble    0x0020
DECL|struct|get_set_mib
r_struct
id|get_set_mib
(brace
DECL|member|type
id|u8
id|type
suffix:semicolon
DECL|member|size
id|u8
id|size
suffix:semicolon
DECL|member|index
id|u8
id|index
suffix:semicolon
DECL|member|reserved
id|u8
id|reserved
suffix:semicolon
DECL|member|data
id|u8
id|data
(braket
l_int|72
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|rx_desc
r_struct
id|rx_desc
(brace
DECL|member|Next
id|u32
id|Next
suffix:semicolon
DECL|member|MsduPos
id|u16
id|MsduPos
suffix:semicolon
DECL|member|MsduSize
id|u16
id|MsduSize
suffix:semicolon
DECL|member|State
id|u8
id|State
suffix:semicolon
DECL|member|Status
id|u8
id|Status
suffix:semicolon
DECL|member|Rate
id|u8
id|Rate
suffix:semicolon
DECL|member|Rssi
id|u8
id|Rssi
suffix:semicolon
DECL|member|LinkQuality
id|u8
id|LinkQuality
suffix:semicolon
DECL|member|PreambleType
id|u8
id|PreambleType
suffix:semicolon
DECL|member|Duration
id|u16
id|Duration
suffix:semicolon
DECL|member|RxTime
id|u32
id|RxTime
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|RX_DESC_FLAG_VALID
mdefine_line|#define RX_DESC_FLAG_VALID       0x80
DECL|macro|RX_DESC_FLAG_CONSUMED
mdefine_line|#define RX_DESC_FLAG_CONSUMED    0x40
DECL|macro|RX_DESC_FLAG_IDLE
mdefine_line|#define RX_DESC_FLAG_IDLE        0x00
DECL|macro|RX_STATUS_SUCCESS
mdefine_line|#define RX_STATUS_SUCCESS        0x00
DECL|macro|RX_DESC_MSDU_POS_OFFSET
mdefine_line|#define RX_DESC_MSDU_POS_OFFSET      4
DECL|macro|RX_DESC_MSDU_SIZE_OFFSET
mdefine_line|#define RX_DESC_MSDU_SIZE_OFFSET     6
DECL|macro|RX_DESC_FLAGS_OFFSET
mdefine_line|#define RX_DESC_FLAGS_OFFSET         8
DECL|macro|RX_DESC_STATUS_OFFSET
mdefine_line|#define RX_DESC_STATUS_OFFSET        9
DECL|macro|RX_DESC_RSSI_OFFSET
mdefine_line|#define RX_DESC_RSSI_OFFSET          11
DECL|macro|RX_DESC_LINK_QUALITY_OFFSET
mdefine_line|#define RX_DESC_LINK_QUALITY_OFFSET  12
DECL|macro|RX_DESC_PREAMBLE_TYPE_OFFSET
mdefine_line|#define RX_DESC_PREAMBLE_TYPE_OFFSET 13
DECL|macro|RX_DESC_DURATION_OFFSET
mdefine_line|#define RX_DESC_DURATION_OFFSET      14
DECL|macro|RX_DESC_RX_TIME_OFFSET
mdefine_line|#define RX_DESC_RX_TIME_OFFSET       16
DECL|struct|tx_desc
r_struct
id|tx_desc
(brace
DECL|member|NextDescriptor
id|u32
id|NextDescriptor
suffix:semicolon
DECL|member|TxStartOfFrame
id|u16
id|TxStartOfFrame
suffix:semicolon
DECL|member|TxLength
id|u16
id|TxLength
suffix:semicolon
DECL|member|TxState
id|u8
id|TxState
suffix:semicolon
DECL|member|TxStatus
id|u8
id|TxStatus
suffix:semicolon
DECL|member|RetryCount
id|u8
id|RetryCount
suffix:semicolon
DECL|member|TxRate
id|u8
id|TxRate
suffix:semicolon
DECL|member|TxTime
id|u32
id|TxTime
suffix:semicolon
DECL|member|Reserved
id|u8
id|Reserved
suffix:semicolon
DECL|member|PacketType
id|u8
id|PacketType
suffix:semicolon
DECL|member|HostTxLength
id|u16
id|HostTxLength
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|TX_DESC_NEXT_OFFSET
mdefine_line|#define TX_DESC_NEXT_OFFSET        0
DECL|macro|TX_DESC_POS_OFFSET
mdefine_line|#define TX_DESC_POS_OFFSET         4
DECL|macro|TX_DESC_SIZE_OFFSET
mdefine_line|#define TX_DESC_SIZE_OFFSET        6
DECL|macro|TX_DESC_FLAGS_OFFSET
mdefine_line|#define TX_DESC_FLAGS_OFFSET       8
DECL|macro|TX_DESC_STATUS_OFFSET
mdefine_line|#define TX_DESC_STATUS_OFFSET      9
DECL|macro|TX_DESC_RETRY_OFFSET
mdefine_line|#define TX_DESC_RETRY_OFFSET       10
DECL|macro|TX_DESC_RATE_OFFSET
mdefine_line|#define TX_DESC_RATE_OFFSET        11
DECL|macro|TX_DESC_PACKET_TYPE_OFFSET
mdefine_line|#define TX_DESC_PACKET_TYPE_OFFSET 17
DECL|macro|TX_DESC_HOST_LENGTH_OFFSET
mdefine_line|#define TX_DESC_HOST_LENGTH_OFFSET 18
singleline_comment|///////////////////////////////////////////////////////
singleline_comment|// Host-MAC interface
singleline_comment|///////////////////////////////////////////////////////
DECL|macro|TX_STATUS_SUCCESS
mdefine_line|#define TX_STATUS_SUCCESS       0x00
DECL|macro|TX_FIRM_OWN
mdefine_line|#define TX_FIRM_OWN             0x80
DECL|macro|TX_DONE
mdefine_line|#define TX_DONE                 0x40
DECL|macro|TX_ERROR
mdefine_line|#define TX_ERROR                0x01
DECL|macro|TX_PACKET_TYPE_DATA
mdefine_line|#define TX_PACKET_TYPE_DATA     0x01
DECL|macro|TX_PACKET_TYPE_MGMT
mdefine_line|#define TX_PACKET_TYPE_MGMT     0x02
DECL|macro|ISR_EMPTY
mdefine_line|#define ISR_EMPTY               0x00        
singleline_comment|// no bits set in ISR
DECL|macro|ISR_TxCOMPLETE
mdefine_line|#define ISR_TxCOMPLETE          0x01        
singleline_comment|// packet transmitted
DECL|macro|ISR_RxCOMPLETE
mdefine_line|#define ISR_RxCOMPLETE          0x02        
singleline_comment|// packet received
DECL|macro|ISR_RxFRAMELOST
mdefine_line|#define ISR_RxFRAMELOST         0x04        
singleline_comment|// Rx Frame lost
DECL|macro|ISR_FATAL_ERROR
mdefine_line|#define ISR_FATAL_ERROR         0x08        
singleline_comment|// Fatal error
DECL|macro|ISR_COMMAND_COMPLETE
mdefine_line|#define ISR_COMMAND_COMPLETE    0x10        
singleline_comment|// command completed
DECL|macro|ISR_OUT_OF_RANGE
mdefine_line|#define ISR_OUT_OF_RANGE        0x20        
singleline_comment|// command completed
DECL|macro|ISR_IBSS_MERGE
mdefine_line|#define ISR_IBSS_MERGE          0x40        
singleline_comment|// (4.1.2.30): IBSS merge
DECL|macro|ISR_GENERIC_IRQ
mdefine_line|#define ISR_GENERIC_IRQ         0x80                
DECL|macro|Local_Mib_Type
mdefine_line|#define Local_Mib_Type          0x01
DECL|macro|Mac_Address_Mib_Type
mdefine_line|#define Mac_Address_Mib_Type    0x02
DECL|macro|Mac_Mib_Type
mdefine_line|#define Mac_Mib_Type            0x03
DECL|macro|Statistics_Mib_Type
mdefine_line|#define Statistics_Mib_Type     0x04
DECL|macro|Mac_Mgmt_Mib_Type
mdefine_line|#define Mac_Mgmt_Mib_Type       0x05
DECL|macro|Mac_Wep_Mib_Type
mdefine_line|#define Mac_Wep_Mib_Type        0x06
DECL|macro|Phy_Mib_Type
mdefine_line|#define Phy_Mib_Type            0x07
DECL|macro|Multi_Domain_MIB
mdefine_line|#define Multi_Domain_MIB        0x08
DECL|macro|MAC_MGMT_MIB_CUR_BSSID_POS
mdefine_line|#define MAC_MGMT_MIB_CUR_BSSID_POS            14
DECL|macro|MAC_MIB_FRAG_THRESHOLD_POS
mdefine_line|#define MAC_MIB_FRAG_THRESHOLD_POS            8
DECL|macro|MAC_MIB_RTS_THRESHOLD_POS
mdefine_line|#define MAC_MIB_RTS_THRESHOLD_POS             10
DECL|macro|MAC_MIB_SHORT_RETRY_POS
mdefine_line|#define MAC_MIB_SHORT_RETRY_POS               16
DECL|macro|MAC_MIB_LONG_RETRY_POS
mdefine_line|#define MAC_MIB_LONG_RETRY_POS                17
DECL|macro|MAC_MIB_SHORT_RETRY_LIMIT_POS
mdefine_line|#define MAC_MIB_SHORT_RETRY_LIMIT_POS         16
DECL|macro|MAC_MGMT_MIB_BEACON_PER_POS
mdefine_line|#define MAC_MGMT_MIB_BEACON_PER_POS           0
DECL|macro|MAC_MGMT_MIB_STATION_ID_POS
mdefine_line|#define MAC_MGMT_MIB_STATION_ID_POS           6
DECL|macro|MAC_MGMT_MIB_CUR_PRIVACY_POS
mdefine_line|#define MAC_MGMT_MIB_CUR_PRIVACY_POS          11
DECL|macro|MAC_MGMT_MIB_CUR_BSSID_POS
mdefine_line|#define MAC_MGMT_MIB_CUR_BSSID_POS            14
DECL|macro|MAC_MGMT_MIB_PS_MODE_POS
mdefine_line|#define MAC_MGMT_MIB_PS_MODE_POS              53
DECL|macro|MAC_MGMT_MIB_LISTEN_INTERVAL_POS
mdefine_line|#define MAC_MGMT_MIB_LISTEN_INTERVAL_POS      54
DECL|macro|MAC_MGMT_MIB_MULTI_DOMAIN_IMPLEMENTED
mdefine_line|#define MAC_MGMT_MIB_MULTI_DOMAIN_IMPLEMENTED 56
DECL|macro|MAC_MGMT_MIB_MULTI_DOMAIN_ENABLED
mdefine_line|#define MAC_MGMT_MIB_MULTI_DOMAIN_ENABLED     57
DECL|macro|PHY_MIB_CHANNEL_POS
mdefine_line|#define PHY_MIB_CHANNEL_POS                   14
DECL|macro|PHY_MIB_RATE_SET_POS
mdefine_line|#define PHY_MIB_RATE_SET_POS                  20
DECL|macro|PHY_MIB_REG_DOMAIN_POS
mdefine_line|#define PHY_MIB_REG_DOMAIN_POS                26
DECL|macro|LOCAL_MIB_AUTO_TX_RATE_POS
mdefine_line|#define LOCAL_MIB_AUTO_TX_RATE_POS            3
DECL|macro|LOCAL_MIB_SSID_SIZE
mdefine_line|#define LOCAL_MIB_SSID_SIZE                   5
DECL|macro|LOCAL_MIB_TX_PROMISCUOUS_POS
mdefine_line|#define LOCAL_MIB_TX_PROMISCUOUS_POS          6
DECL|macro|LOCAL_MIB_TX_MGMT_RATE_POS
mdefine_line|#define LOCAL_MIB_TX_MGMT_RATE_POS            7
DECL|macro|LOCAL_MIB_TX_CONTROL_RATE_POS
mdefine_line|#define LOCAL_MIB_TX_CONTROL_RATE_POS         8
DECL|macro|LOCAL_MIB_PREAMBLE_TYPE
mdefine_line|#define LOCAL_MIB_PREAMBLE_TYPE               9
DECL|macro|MAC_ADDR_MIB_MAC_ADDR_POS
mdefine_line|#define MAC_ADDR_MIB_MAC_ADDR_POS             0
DECL|macro|CMD_Set_MIB_Vars
mdefine_line|#define         CMD_Set_MIB_Vars              0x01
DECL|macro|CMD_Get_MIB_Vars
mdefine_line|#define         CMD_Get_MIB_Vars              0x02
DECL|macro|CMD_Scan
mdefine_line|#define         CMD_Scan                      0x03
DECL|macro|CMD_Join
mdefine_line|#define         CMD_Join                      0x04
DECL|macro|CMD_Start
mdefine_line|#define         CMD_Start                     0x05
DECL|macro|CMD_EnableRadio
mdefine_line|#define         CMD_EnableRadio               0x06
DECL|macro|CMD_DisableRadio
mdefine_line|#define         CMD_DisableRadio              0x07
DECL|macro|CMD_SiteSurvey
mdefine_line|#define         CMD_SiteSurvey                0x0B
DECL|macro|CMD_STATUS_IDLE
mdefine_line|#define         CMD_STATUS_IDLE                   0x00
DECL|macro|CMD_STATUS_COMPLETE
mdefine_line|#define         CMD_STATUS_COMPLETE               0x01
DECL|macro|CMD_STATUS_UNKNOWN
mdefine_line|#define         CMD_STATUS_UNKNOWN                0x02
DECL|macro|CMD_STATUS_INVALID_PARAMETER
mdefine_line|#define         CMD_STATUS_INVALID_PARAMETER      0x03
DECL|macro|CMD_STATUS_FUNCTION_NOT_SUPPORTED
mdefine_line|#define         CMD_STATUS_FUNCTION_NOT_SUPPORTED 0x04
DECL|macro|CMD_STATUS_TIME_OUT
mdefine_line|#define         CMD_STATUS_TIME_OUT               0x07
DECL|macro|CMD_STATUS_IN_PROGRESS
mdefine_line|#define         CMD_STATUS_IN_PROGRESS            0x08
DECL|macro|CMD_STATUS_REJECTED_RADIO_OFF
mdefine_line|#define         CMD_STATUS_REJECTED_RADIO_OFF     0x09
DECL|macro|CMD_STATUS_HOST_ERROR
mdefine_line|#define         CMD_STATUS_HOST_ERROR             0xFF
DECL|macro|CMD_STATUS_BUSY
mdefine_line|#define         CMD_STATUS_BUSY                   0xFE
DECL|macro|CMD_BLOCK_COMMAND_OFFSET
mdefine_line|#define CMD_BLOCK_COMMAND_OFFSET        0
DECL|macro|CMD_BLOCK_STATUS_OFFSET
mdefine_line|#define CMD_BLOCK_STATUS_OFFSET         1
DECL|macro|CMD_BLOCK_PARAMETERS_OFFSET
mdefine_line|#define CMD_BLOCK_PARAMETERS_OFFSET     4
DECL|macro|SCAN_OPTIONS_SITE_SURVEY
mdefine_line|#define SCAN_OPTIONS_SITE_SURVEY        0x80
DECL|macro|MGMT_FRAME_BODY_OFFSET
mdefine_line|#define MGMT_FRAME_BODY_OFFSET&t;&t;24
DECL|macro|MAX_AUTHENTICATION_RETRIES
mdefine_line|#define MAX_AUTHENTICATION_RETRIES&t;3
DECL|macro|MAX_ASSOCIATION_RETRIES
mdefine_line|#define MAX_ASSOCIATION_RETRIES &t;3
DECL|macro|AUTHENTICATION_RESPONSE_TIME_OUT
mdefine_line|#define AUTHENTICATION_RESPONSE_TIME_OUT  1000
DECL|macro|MAX_WIRELESS_BODY
mdefine_line|#define MAX_WIRELESS_BODY  2316 /* mtu is 2312, CRC is 4 */
DECL|macro|LOOP_RETRY_LIMIT
mdefine_line|#define LOOP_RETRY_LIMIT   500000
DECL|macro|ACTIVE_MODE
mdefine_line|#define ACTIVE_MODE &t;1
DECL|macro|PS_MODE
mdefine_line|#define PS_MODE &t;2
singleline_comment|///////////////////////////////////////////////////////////////////////////
singleline_comment|// 802.11 related definitions
singleline_comment|///////////////////////////////////////////////////////////////////////////
singleline_comment|//
singleline_comment|// Regulatory Domains
singleline_comment|//
DECL|macro|REG_DOMAIN_FCC
mdefine_line|#define REG_DOMAIN_FCC&t;&t;0x10&t;
singleline_comment|//Channels&t;1-11&t;USA
DECL|macro|REG_DOMAIN_DOC
mdefine_line|#define REG_DOMAIN_DOC&t;&t;0x20&t;
singleline_comment|//Channel&t;1-11&t;Canada
DECL|macro|REG_DOMAIN_ETSI
mdefine_line|#define REG_DOMAIN_ETSI&t;&t;0x30&t;
singleline_comment|//Channel&t;1-13&t;Europe (ex Spain/France)
DECL|macro|REG_DOMAIN_SPAIN
mdefine_line|#define REG_DOMAIN_SPAIN&t;0x31&t;
singleline_comment|//Channel&t;10-11&t;Spain
DECL|macro|REG_DOMAIN_FRANCE
mdefine_line|#define REG_DOMAIN_FRANCE&t;0x32&t;
singleline_comment|//Channel&t;10-13&t;France
DECL|macro|REG_DOMAIN_MKK
mdefine_line|#define REG_DOMAIN_MKK&t;&t;0x40&t;
singleline_comment|//Channel&t;14&t;Japan
DECL|macro|REG_DOMAIN_MKK1
mdefine_line|#define REG_DOMAIN_MKK1&t;&t;0x41&t;
singleline_comment|//Channel&t;1-14&t;Japan(MKK1)
DECL|macro|REG_DOMAIN_ISRAEL
mdefine_line|#define REG_DOMAIN_ISRAEL&t;0x50&t;
singleline_comment|//Channel&t;3-9&t;ISRAEL
DECL|macro|BSS_TYPE_AD_HOC
mdefine_line|#define BSS_TYPE_AD_HOC &t;1
DECL|macro|BSS_TYPE_INFRASTRUCTURE
mdefine_line|#define BSS_TYPE_INFRASTRUCTURE 2
DECL|macro|SCAN_TYPE_ACTIVE
mdefine_line|#define SCAN_TYPE_ACTIVE&t;0
DECL|macro|SCAN_TYPE_PASSIVE
mdefine_line|#define SCAN_TYPE_PASSIVE&t;1
DECL|macro|LONG_PREAMBLE
mdefine_line|#define LONG_PREAMBLE&t;&t;0
DECL|macro|SHORT_PREAMBLE
mdefine_line|#define SHORT_PREAMBLE&t;&t;1
DECL|macro|AUTO_PREAMBLE
mdefine_line|#define AUTO_PREAMBLE&t;&t;2
DECL|macro|DATA_FRAME_WS_HEADER_SIZE
mdefine_line|#define DATA_FRAME_WS_HEADER_SIZE   30
multiline_comment|/* promiscuous mode control */
DECL|macro|PROM_MODE_OFF
mdefine_line|#define PROM_MODE_OFF&t;&t;&t;0x0
DECL|macro|PROM_MODE_UNKNOWN
mdefine_line|#define PROM_MODE_UNKNOWN&t;&t;0x1
DECL|macro|PROM_MODE_CRC_FAILED
mdefine_line|#define PROM_MODE_CRC_FAILED&t;&t;0x2
DECL|macro|PROM_MODE_DUPLICATED
mdefine_line|#define PROM_MODE_DUPLICATED&t;&t;0x4
DECL|macro|PROM_MODE_MGMT
mdefine_line|#define PROM_MODE_MGMT&t;&t;&t;0x8
DECL|macro|PROM_MODE_CTRL
mdefine_line|#define PROM_MODE_CTRL&t;&t;&t;0x10
DECL|macro|PROM_MODE_BAD_PROTOCOL
mdefine_line|#define PROM_MODE_BAD_PROTOCOL&t;&t;0x20
DECL|macro|IFACE_INT_STATUS_OFFSET
mdefine_line|#define IFACE_INT_STATUS_OFFSET &t;0
DECL|macro|IFACE_INT_MASK_OFFSET
mdefine_line|#define IFACE_INT_MASK_OFFSET&t;&t;1
DECL|macro|IFACE_LOCKOUT_HOST_OFFSET
mdefine_line|#define IFACE_LOCKOUT_HOST_OFFSET&t;2
DECL|macro|IFACE_LOCKOUT_MAC_OFFSET
mdefine_line|#define IFACE_LOCKOUT_MAC_OFFSET&t;3
DECL|macro|IFACE_FUNC_CTRL_OFFSET
mdefine_line|#define IFACE_FUNC_CTRL_OFFSET&t;&t;28
DECL|macro|IFACE_MAC_STAT_OFFSET
mdefine_line|#define IFACE_MAC_STAT_OFFSET&t;&t;30
DECL|macro|IFACE_GENERIC_INT_TYPE_OFFSET
mdefine_line|#define IFACE_GENERIC_INT_TYPE_OFFSET&t;32
singleline_comment|//
singleline_comment|// IFACE MACROS &amp; definitions
singleline_comment|//
singleline_comment|//
singleline_comment|// FuncCtrl field: 
singleline_comment|//
DECL|macro|FUNC_CTRL_TxENABLE
mdefine_line|#define FUNC_CTRL_TxENABLE&t;&t;0x10
DECL|macro|FUNC_CTRL_RxENABLE
mdefine_line|#define FUNC_CTRL_RxENABLE&t;&t;0x20
DECL|macro|FUNC_CTRL_INIT_COMPLETE
mdefine_line|#define FUNC_CTRL_INIT_COMPLETE &t;0x01
multiline_comment|/* A stub firmware image which reads the MAC address from NVRAM on the card.&n;   For copyright information and source see the end of this file. */
DECL|variable|mac_reader
r_static
id|u8
id|mac_reader
(braket
)braket
op_assign
(brace
l_int|0x06
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xea
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xea
comma
l_int|0xfe
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xea
comma
l_int|0xd3
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0xf0
comma
l_int|0x21
comma
l_int|0xe1
comma
l_int|0x0e
comma
l_int|0x04
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x81
comma
l_int|0x11
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0x81
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x1c
comma
l_int|0x10
comma
l_int|0x90
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xc1
comma
l_int|0xe3
comma
l_int|0x1c
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x08
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0xb0
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0xb4
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0xb8
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0xbc
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0x56
comma
l_int|0xdc
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x21
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x0a
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x1a
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x10
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x07
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x02
comma
l_int|0x14
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0xb4
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0x4c
comma
l_int|0x10
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0xbc
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0xb8
comma
l_int|0x10
comma
l_int|0xc0
comma
l_int|0xe1
comma
l_int|0xfe
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xea
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x2d
comma
l_int|0xe9
comma
l_int|0x00
comma
l_int|0x20
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x02
comma
l_int|0x3c
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x28
comma
l_int|0x00
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0x37
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0xbd
comma
l_int|0xe8
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0x2d
comma
l_int|0xe9
comma
l_int|0x12
comma
l_int|0x2e
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x06
comma
l_int|0x30
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x2f
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0xbd
comma
l_int|0xe8
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x80
comma
l_int|0x01
comma
l_int|0x90
comma
l_int|0xe0
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x0a
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x50
comma
l_int|0xe2
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xea
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x80
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0xf3
comma
l_int|0x06
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x04
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x0e
comma
l_int|0x34
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x1c
comma
l_int|0x10
comma
l_int|0x93
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x1a
comma
l_int|0x81
comma
l_int|0xe3
comma
l_int|0x1c
comma
l_int|0x10
comma
l_int|0x83
comma
l_int|0xe5
comma
l_int|0x58
comma
l_int|0x11
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0x30
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x54
comma
l_int|0x11
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0x34
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x38
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x3c
comma
l_int|0x10
comma
l_int|0x80
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x10
comma
l_int|0x90
comma
l_int|0xe5
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x90
comma
l_int|0xe5
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0xf3
comma
l_int|0x16
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0x05
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x0c
comma
l_int|0x00
comma
l_int|0x81
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0xff
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x0c
comma
l_int|0x00
comma
l_int|0x81
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x91
comma
l_int|0xe5
comma
l_int|0xff
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xe2
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x30
comma
l_int|0x40
comma
l_int|0x2d
comma
l_int|0xe9
comma
l_int|0x00
comma
l_int|0x50
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0x03
comma
l_int|0x40
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0xa2
comma
l_int|0x02
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xe2
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0xe2
comma
l_int|0xd8
comma
l_int|0x10
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xc1
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x20
comma
l_int|0xc1
comma
l_int|0xe5
comma
l_int|0xe2
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xeb
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x1a
comma
l_int|0x14
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0xc4
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xeb
comma
l_int|0x04
comma
l_int|0x20
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0x05
comma
l_int|0x10
comma
l_int|0xa0
comma
l_int|0xe1
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xeb
comma
l_int|0x30
comma
l_int|0x40
comma
l_int|0xbd
comma
l_int|0xe8
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x70
comma
l_int|0x40
comma
l_int|0x2d
comma
l_int|0xe9
comma
l_int|0xf3
comma
l_int|0x46
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x30
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x50
comma
l_int|0xe3
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x9a
comma
l_int|0x8c
comma
l_int|0x50
comma
l_int|0x9f
comma
l_int|0xe5
comma
l_int|0x03
comma
l_int|0x60
comma
l_int|0xd5
comma
l_int|0xe7
comma
l_int|0x0c
comma
l_int|0x60
comma
l_int|0x84
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x60
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x16
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x01
comma
l_int|0x30
comma
l_int|0x83
comma
l_int|0xe2
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x53
comma
l_int|0xe1
comma
l_int|0xf7
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x3a
comma
l_int|0xff
comma
l_int|0x30
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x0c
comma
l_int|0x30
comma
l_int|0x84
comma
l_int|0xe5
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x00
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x10
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x52
comma
l_int|0xe3
comma
l_int|0x0b
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x9a
comma
l_int|0x10
comma
l_int|0x50
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x15
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x0c
comma
l_int|0x30
comma
l_int|0x84
comma
l_int|0xe5
comma
l_int|0x10
comma
l_int|0x50
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x15
comma
l_int|0xe3
comma
l_int|0xfc
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x0a
comma
l_int|0x08
comma
l_int|0x50
comma
l_int|0x94
comma
l_int|0xe5
comma
l_int|0x01
comma
l_int|0x50
comma
l_int|0xc1
comma
l_int|0xe4
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0xe2
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x50
comma
l_int|0xe1
comma
l_int|0xf3
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0x3a
comma
l_int|0xc8
comma
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xe3
comma
l_int|0x98
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xeb
comma
l_int|0x70
comma
l_int|0x40
comma
l_int|0xbd
comma
l_int|0xe8
comma
l_int|0x1e
comma
l_int|0xff
comma
l_int|0x2f
comma
l_int|0xe1
comma
l_int|0x01
comma
l_int|0x0c
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x02
)brace
suffix:semicolon
DECL|struct|atmel_private
r_struct
id|atmel_private
(brace
DECL|member|card
r_void
op_star
id|card
suffix:semicolon
multiline_comment|/* Bus dependent stucture varies for PCcard */
DECL|member|present_callback
r_int
(paren
op_star
id|present_callback
)paren
(paren
r_void
op_star
)paren
suffix:semicolon
multiline_comment|/* And callback which uses it */
DECL|member|firmware_id
r_char
id|firmware_id
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|firmware
r_int
r_char
op_star
id|firmware
suffix:semicolon
DECL|member|firmware_length
r_int
id|firmware_length
suffix:semicolon
DECL|member|management_timer
r_struct
id|timer_list
id|management_timer
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|sys_dev
r_struct
id|device
op_star
id|sys_dev
suffix:semicolon
DECL|member|wstats
r_struct
id|iw_statistics
id|wstats
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
singleline_comment|// device stats
DECL|member|irqlock
DECL|member|timerlock
id|spinlock_t
id|irqlock
comma
id|timerlock
suffix:semicolon
singleline_comment|// spinlocks
DECL|enumerator|BUS_TYPE_PCCARD
DECL|enumerator|BUS_TYPE_PCI
DECL|member|bus_type
r_enum
(brace
id|BUS_TYPE_PCCARD
comma
id|BUS_TYPE_PCI
)brace
id|bus_type
suffix:semicolon
r_enum
(brace
DECL|enumerator|CARD_TYPE_PARALLEL_FLASH
id|CARD_TYPE_PARALLEL_FLASH
comma
DECL|enumerator|CARD_TYPE_SPI_FLASH
id|CARD_TYPE_SPI_FLASH
comma
DECL|enumerator|CARD_TYPE_EEPROM
id|CARD_TYPE_EEPROM
DECL|member|card_type
)brace
id|card_type
suffix:semicolon
DECL|member|is3com
r_int
id|is3com
suffix:semicolon
multiline_comment|/* is this a 3com card? they are uniquely borken */
DECL|member|do_rx_crc
r_int
id|do_rx_crc
suffix:semicolon
multiline_comment|/* If we need to CRC incoming packets */
DECL|member|probe_crc
r_int
id|probe_crc
suffix:semicolon
multiline_comment|/* set if we don&squot;t yet know */
DECL|member|crc_ok_cnt
DECL|member|crc_ko_cnt
r_int
id|crc_ok_cnt
comma
id|crc_ko_cnt
suffix:semicolon
multiline_comment|/* counters for probing */
DECL|member|rx_desc_head
id|u16
id|rx_desc_head
suffix:semicolon
DECL|member|tx_desc_free
DECL|member|tx_desc_head
DECL|member|tx_desc_tail
DECL|member|tx_desc_previous
id|u16
id|tx_desc_free
comma
id|tx_desc_head
comma
id|tx_desc_tail
comma
id|tx_desc_previous
suffix:semicolon
DECL|member|tx_free_mem
DECL|member|tx_buff_head
DECL|member|tx_buff_tail
id|u16
id|tx_free_mem
comma
id|tx_buff_head
comma
id|tx_buff_tail
suffix:semicolon
DECL|member|frag_seq
DECL|member|frag_len
DECL|member|frag_no
id|u16
id|frag_seq
comma
id|frag_len
comma
id|frag_no
suffix:semicolon
DECL|member|frag_source
id|u8
id|frag_source
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|wep_key_len
r_int
id|wep_key_len
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* need to know these and not stored in Mib. */
r_struct
(brace
multiline_comment|/* NB this is matched to the hardware, don&squot;t change. */
DECL|member|wep_is_on
id|u8
id|wep_is_on
suffix:semicolon
DECL|member|default_key
id|u8
id|default_key
suffix:semicolon
multiline_comment|/* 0..3 */
DECL|member|reserved
id|u8
id|reserved
suffix:semicolon
DECL|member|exclude_unencrypted
id|u8
id|exclude_unencrypted
suffix:semicolon
DECL|member|WEPICV_error_count
id|u32
id|WEPICV_error_count
suffix:semicolon
DECL|member|WEP_excluded_count
id|u32
id|WEP_excluded_count
suffix:semicolon
DECL|member|wep_keys
id|u8
id|wep_keys
(braket
l_int|4
)braket
(braket
l_int|13
)braket
suffix:semicolon
DECL|member|encryption_level
id|u8
id|encryption_level
suffix:semicolon
multiline_comment|/* 0, 1, 2 */
DECL|member|reserved2
id|u8
id|reserved2
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|wep
)brace
id|wep
suffix:semicolon
DECL|member|host_info_base
id|u16
id|host_info_base
suffix:semicolon
DECL|struct|host_info_struct
r_struct
id|host_info_struct
(brace
multiline_comment|/* NB this is matched to the hardware, don&squot;t change. */
DECL|member|int_status
id|u8
r_volatile
id|int_status
suffix:semicolon
DECL|member|int_mask
id|u8
r_volatile
id|int_mask
suffix:semicolon
DECL|member|lockout_host
id|u8
r_volatile
id|lockout_host
suffix:semicolon
DECL|member|lockout_mac
id|u8
r_volatile
id|lockout_mac
suffix:semicolon
DECL|member|tx_buff_pos
id|u16
id|tx_buff_pos
suffix:semicolon
DECL|member|tx_buff_size
id|u16
id|tx_buff_size
suffix:semicolon
DECL|member|tx_desc_pos
id|u16
id|tx_desc_pos
suffix:semicolon
DECL|member|tx_desc_count
id|u16
id|tx_desc_count
suffix:semicolon
DECL|member|rx_buff_pos
id|u16
id|rx_buff_pos
suffix:semicolon
DECL|member|rx_buff_size
id|u16
id|rx_buff_size
suffix:semicolon
DECL|member|rx_desc_pos
id|u16
id|rx_desc_pos
suffix:semicolon
DECL|member|rx_desc_count
id|u16
id|rx_desc_count
suffix:semicolon
DECL|member|build_version
id|u16
id|build_version
suffix:semicolon
DECL|member|command_pos
id|u16
id|command_pos
suffix:semicolon
DECL|member|major_version
id|u16
id|major_version
suffix:semicolon
DECL|member|minor_version
id|u16
id|minor_version
suffix:semicolon
DECL|member|func_ctrl
id|u16
id|func_ctrl
suffix:semicolon
DECL|member|mac_status
id|u16
id|mac_status
suffix:semicolon
DECL|member|generic_IRQ_type
id|u16
id|generic_IRQ_type
suffix:semicolon
DECL|member|reserved
id|u8
id|reserved
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|host_info
)brace
id|host_info
suffix:semicolon
r_enum
(brace
DECL|enumerator|STATION_STATE_INITIALIZING
id|STATION_STATE_INITIALIZING
comma
DECL|enumerator|STATION_STATE_SCANNING
id|STATION_STATE_SCANNING
comma
DECL|enumerator|STATION_STATE_JOINNING
id|STATION_STATE_JOINNING
comma
DECL|enumerator|STATION_STATE_AUTHENTICATING
id|STATION_STATE_AUTHENTICATING
comma
DECL|enumerator|STATION_STATE_ASSOCIATING
id|STATION_STATE_ASSOCIATING
comma
DECL|enumerator|STATION_STATE_READY
id|STATION_STATE_READY
comma
DECL|enumerator|STATION_STATE_REASSOCIATING
id|STATION_STATE_REASSOCIATING
comma
DECL|enumerator|STATION_STATE_FORCED_JOINNING
id|STATION_STATE_FORCED_JOINNING
comma
DECL|enumerator|STATION_STATE_FORCED_JOIN_FAILURE
id|STATION_STATE_FORCED_JOIN_FAILURE
comma
DECL|enumerator|STATION_STATE_DOWN
id|STATION_STATE_DOWN
comma
DECL|enumerator|STATION_STATE_NO_CARD
id|STATION_STATE_NO_CARD
comma
DECL|enumerator|STATION_STATE_MGMT_ERROR
id|STATION_STATE_MGMT_ERROR
DECL|member|station_state
)brace
id|station_state
suffix:semicolon
DECL|member|operating_mode
DECL|member|power_mode
r_int
id|operating_mode
comma
id|power_mode
suffix:semicolon
DECL|member|last_qual
id|time_t
id|last_qual
suffix:semicolon
DECL|member|beacons_this_sec
r_int
id|beacons_this_sec
suffix:semicolon
DECL|member|channel
r_int
id|channel
suffix:semicolon
DECL|member|reg_domain
r_int
id|reg_domain
suffix:semicolon
DECL|member|tx_rate
r_int
id|tx_rate
suffix:semicolon
DECL|member|auto_tx_rate
r_int
id|auto_tx_rate
suffix:semicolon
suffix:semicolon
DECL|member|rts_threshold
r_int
id|rts_threshold
suffix:semicolon
DECL|member|frag_threshold
r_int
id|frag_threshold
suffix:semicolon
DECL|member|long_retry
DECL|member|short_retry
r_int
id|long_retry
comma
id|short_retry
suffix:semicolon
DECL|member|preamble
r_int
id|preamble
suffix:semicolon
DECL|member|default_beacon_period
DECL|member|beacon_period
DECL|member|listen_interval
r_int
id|default_beacon_period
comma
id|beacon_period
comma
id|listen_interval
suffix:semicolon
DECL|member|CurrentAuthentTransactionSeqNum
DECL|member|ExpectedAuthentTransactionSeqNum
r_int
id|CurrentAuthentTransactionSeqNum
comma
id|ExpectedAuthentTransactionSeqNum
suffix:semicolon
DECL|member|AuthenticationRequestRetryCnt
DECL|member|AssociationRequestRetryCnt
DECL|member|ReAssociationRequestRetryCnt
r_int
id|AuthenticationRequestRetryCnt
comma
id|AssociationRequestRetryCnt
comma
id|ReAssociationRequestRetryCnt
suffix:semicolon
r_enum
(brace
DECL|enumerator|SITE_SURVEY_IDLE
id|SITE_SURVEY_IDLE
comma
DECL|enumerator|SITE_SURVEY_IN_PROGRESS
id|SITE_SURVEY_IN_PROGRESS
comma
DECL|enumerator|SITE_SURVEY_COMPLETED
id|SITE_SURVEY_COMPLETED
DECL|member|site_survey_state
)brace
id|site_survey_state
suffix:semicolon
DECL|member|last_survey
id|time_t
id|last_survey
suffix:semicolon
DECL|member|station_was_associated
DECL|member|station_is_associated
r_int
id|station_was_associated
comma
id|station_is_associated
suffix:semicolon
DECL|member|fast_scan
r_int
id|fast_scan
suffix:semicolon
DECL|struct|bss_info
r_struct
id|bss_info
(brace
DECL|member|channel
r_int
id|channel
suffix:semicolon
DECL|member|SSIDsize
r_int
id|SSIDsize
suffix:semicolon
DECL|member|RSSI
r_int
id|RSSI
suffix:semicolon
DECL|member|UsingWEP
r_int
id|UsingWEP
suffix:semicolon
DECL|member|preamble
r_int
id|preamble
suffix:semicolon
DECL|member|beacon_period
r_int
id|beacon_period
suffix:semicolon
DECL|member|BSStype
r_int
id|BSStype
suffix:semicolon
DECL|member|BSSID
id|u8
id|BSSID
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|SSID
id|u8
id|SSID
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
DECL|member|BSSinfo
)brace
id|BSSinfo
(braket
id|MAX_BSS_ENTRIES
)braket
suffix:semicolon
DECL|member|BSS_list_entries
DECL|member|current_BSS
r_int
id|BSS_list_entries
comma
id|current_BSS
suffix:semicolon
DECL|member|connect_to_any_BSS
r_int
id|connect_to_any_BSS
suffix:semicolon
DECL|member|SSID_size
DECL|member|new_SSID_size
r_int
id|SSID_size
comma
id|new_SSID_size
suffix:semicolon
DECL|member|CurrentBSSID
DECL|member|BSSID
id|u8
id|CurrentBSSID
(braket
l_int|6
)braket
comma
id|BSSID
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|SSID
DECL|member|new_SSID
id|u8
id|SSID
(braket
id|MAX_SSID_LENGTH
)braket
comma
id|new_SSID
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
DECL|member|last_beacon_timestamp
id|u64
id|last_beacon_timestamp
suffix:semicolon
DECL|member|rx_buf
id|u8
id|rx_buf
(braket
id|MAX_WIRELESS_BODY
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|atmel_basic_rates
r_static
id|u8
id|atmel_basic_rates
(braket
l_int|4
)braket
op_assign
(brace
l_int|0x82
comma
l_int|0x84
comma
l_int|0x0b
comma
l_int|0x16
)brace
suffix:semicolon
r_static
r_int
id|atmel_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|atmel_copy_to_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|dest
comma
r_int
r_char
op_star
id|src
comma
id|u16
id|len
)paren
suffix:semicolon
r_static
r_void
id|atmel_copy_to_host
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_char
op_star
id|dest
comma
id|u16
id|src
comma
id|u16
id|len
)paren
suffix:semicolon
r_static
r_void
id|atmel_set_gcr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|mask
)paren
suffix:semicolon
r_static
r_void
id|atmel_clear_gcr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|mask
)paren
suffix:semicolon
r_static
r_int
id|atmel_lock_mac
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
suffix:semicolon
r_static
r_void
id|atmel_wmem32
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
comma
id|u32
id|data
)paren
suffix:semicolon
r_static
r_void
id|atmel_command_irq
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
suffix:semicolon
r_static
r_int
id|atmel_validate_channel
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|channel
)paren
suffix:semicolon
r_static
r_void
id|atmel_management_frame
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u16
id|frame_len
comma
id|u8
id|rssi
)paren
suffix:semicolon
r_static
r_void
id|atmel_management_timer
c_func
(paren
id|u_long
id|a
)paren
suffix:semicolon
r_static
r_void
id|atmel_send_command
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|command
comma
r_void
op_star
id|cmd
comma
r_int
id|cmd_size
)paren
suffix:semicolon
r_static
r_int
id|atmel_send_command_wait
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|command
comma
r_void
op_star
id|cmd
comma
r_int
id|cmd_size
)paren
suffix:semicolon
r_static
r_void
id|atmel_transmit_management_frame
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u8
op_star
id|body
comma
r_int
id|body_len
)paren
suffix:semicolon
r_static
id|u8
id|atmel_get_mib8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
)paren
suffix:semicolon
r_static
r_void
id|atmel_set_mib8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
id|data
)paren
suffix:semicolon
r_static
r_void
id|atmel_set_mib16
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u16
id|data
)paren
suffix:semicolon
r_static
r_void
id|atmel_set_mib
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
op_star
id|data
comma
r_int
id|data_len
)paren
suffix:semicolon
r_static
r_void
id|atmel_get_mib
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
op_star
id|data
comma
r_int
id|data_len
)paren
suffix:semicolon
r_static
r_void
id|atmel_scan
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|specific_ssid
)paren
suffix:semicolon
r_static
r_void
id|atmel_join_bss
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|bss_index
)paren
suffix:semicolon
r_static
r_void
id|atmel_smooth_qual
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
suffix:semicolon
r_static
r_void
id|atmel_writeAR
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|data
)paren
suffix:semicolon
r_static
r_int
id|probe_atmel_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_int
id|reset_atmel_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|atmel_enter_state
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|new_state
)paren
suffix:semicolon
DECL|function|atmel_hi
r_static
r_inline
id|u16
id|atmel_hi
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|offset
)paren
(brace
r_return
id|priv-&gt;host_info_base
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|atmel_co
r_static
r_inline
id|u16
id|atmel_co
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|offset
)paren
(brace
r_return
id|priv-&gt;host_info.command_pos
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|atmel_rx
r_static
r_inline
id|u16
id|atmel_rx
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|offset
comma
id|u16
id|desc
)paren
(brace
r_return
id|priv-&gt;host_info.rx_desc_pos
op_plus
(paren
r_sizeof
(paren
r_struct
id|rx_desc
)paren
op_star
id|desc
)paren
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|atmel_tx
r_static
r_inline
id|u16
id|atmel_tx
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|offset
comma
id|u16
id|desc
)paren
(brace
r_return
id|priv-&gt;host_info.tx_desc_pos
op_plus
(paren
r_sizeof
(paren
r_struct
id|tx_desc
)paren
op_star
id|desc
)paren
op_plus
id|offset
suffix:semicolon
)brace
DECL|function|atmel_read8
r_static
r_inline
id|u8
id|atmel_read8
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|offset
)paren
(brace
r_return
id|inb
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|atmel_write8
r_static
r_inline
r_void
id|atmel_write8
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|offset
comma
id|u8
id|data
)paren
(brace
id|outb
c_func
(paren
id|data
comma
id|dev-&gt;base_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|atmel_read16
r_static
r_inline
id|u16
id|atmel_read16
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|offset
)paren
(brace
r_return
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|atmel_write16
r_static
r_inline
r_void
id|atmel_write16
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|offset
comma
id|u16
id|data
)paren
(brace
id|outw
c_func
(paren
id|data
comma
id|dev-&gt;base_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|atmel_rmem8
r_static
r_inline
id|u8
id|atmel_rmem8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
)paren
(brace
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|pos
)paren
suffix:semicolon
r_return
id|atmel_read8
c_func
(paren
id|priv-&gt;dev
comma
id|DR
)paren
suffix:semicolon
)brace
DECL|function|atmel_wmem8
r_static
r_inline
r_void
id|atmel_wmem8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
comma
id|u16
id|data
)paren
(brace
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|pos
)paren
suffix:semicolon
id|atmel_write8
c_func
(paren
id|priv-&gt;dev
comma
id|DR
comma
id|data
)paren
suffix:semicolon
)brace
DECL|function|atmel_rmem16
r_static
r_inline
id|u16
id|atmel_rmem16
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
)paren
(brace
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|pos
)paren
suffix:semicolon
r_return
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|DR
)paren
suffix:semicolon
)brace
DECL|function|atmel_wmem16
r_static
r_inline
r_void
id|atmel_wmem16
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
comma
id|u16
id|data
)paren
(brace
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|pos
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|DR
comma
id|data
)paren
suffix:semicolon
)brace
DECL|variable|atmel_handler_def
r_static
r_const
r_struct
id|iw_handler_def
id|atmel_handler_def
suffix:semicolon
DECL|function|tx_done_irq
r_static
r_void
id|tx_done_irq
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_FLAGS_OFFSET
comma
id|priv-&gt;tx_desc_head
)paren
)paren
op_eq
id|TX_DONE
op_logical_and
id|i
OL
id|priv-&gt;host_info.tx_desc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
id|status
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_STATUS_OFFSET
comma
id|priv-&gt;tx_desc_head
)paren
)paren
suffix:semicolon
id|u16
id|msdu_size
op_assign
id|atmel_rmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_SIZE_OFFSET
comma
id|priv-&gt;tx_desc_head
)paren
)paren
suffix:semicolon
id|u8
id|type
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_PACKET_TYPE_OFFSET
comma
id|priv-&gt;tx_desc_head
)paren
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_FLAGS_OFFSET
comma
id|priv-&gt;tx_desc_head
)paren
comma
l_int|0
)paren
suffix:semicolon
id|priv-&gt;tx_free_mem
op_add_assign
id|msdu_size
suffix:semicolon
id|priv-&gt;tx_desc_free
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_buff_head
op_plus
id|msdu_size
OG
(paren
id|priv-&gt;host_info.tx_buff_pos
op_plus
id|priv-&gt;host_info.tx_buff_size
)paren
)paren
id|priv-&gt;tx_buff_head
op_assign
l_int|0
suffix:semicolon
r_else
id|priv-&gt;tx_buff_head
op_add_assign
id|msdu_size
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_desc_head
OL
(paren
id|priv-&gt;host_info.tx_desc_count
op_minus
l_int|1
)paren
)paren
id|priv-&gt;tx_desc_head
op_increment
suffix:semicolon
r_else
id|priv-&gt;tx_desc_head
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|TX_PACKET_TYPE_DATA
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
id|TX_STATUS_SUCCESS
)paren
id|priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
r_else
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|find_tx_buff
r_static
id|u16
id|find_tx_buff
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|len
)paren
(brace
id|u16
id|bottom_free
op_assign
id|priv-&gt;host_info.tx_buff_size
op_minus
id|priv-&gt;tx_buff_tail
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_desc_free
op_eq
l_int|3
op_logical_or
id|priv-&gt;tx_free_mem
OL
id|len
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bottom_free
op_ge
id|len
)paren
r_return
id|priv-&gt;host_info.tx_buff_pos
op_plus
id|priv-&gt;tx_buff_tail
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_free_mem
op_minus
id|bottom_free
op_ge
id|len
)paren
(brace
id|priv-&gt;tx_buff_tail
op_assign
l_int|0
suffix:semicolon
r_return
id|priv-&gt;host_info.tx_buff_pos
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tx_update_descriptor
r_static
r_void
id|tx_update_descriptor
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|len
comma
id|u16
id|buff
comma
id|u8
id|type
)paren
(brace
id|atmel_wmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_POS_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|buff
)paren
suffix:semicolon
id|atmel_wmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_SIZE_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|len
)paren
suffix:semicolon
id|atmel_wmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_HOST_LENGTH_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|len
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_PACKET_TYPE_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|type
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_RATE_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|priv-&gt;tx_rate
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_RETRY_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
l_int|0
)paren
suffix:semicolon
id|atmel_wmem32
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_NEXT_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
l_int|0x80000000L
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_FLAGS_OFFSET
comma
id|priv-&gt;tx_desc_tail
)paren
comma
id|TX_FIRM_OWN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_desc_previous
op_ne
id|priv-&gt;tx_desc_tail
)paren
id|atmel_wmem32
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_NEXT_OFFSET
comma
id|priv-&gt;tx_desc_previous
)paren
comma
l_int|0
)paren
suffix:semicolon
id|priv-&gt;tx_desc_previous
op_assign
id|priv-&gt;tx_desc_tail
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;tx_desc_tail
OL
(paren
id|priv-&gt;host_info.tx_desc_count
op_minus
l_int|1
)paren
)paren
id|priv-&gt;tx_desc_tail
op_increment
suffix:semicolon
r_else
id|priv-&gt;tx_desc_tail
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_desc_free
op_decrement
suffix:semicolon
id|priv-&gt;tx_free_mem
op_sub_assign
id|len
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_int
id|start_tx
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|ieee802_11_hdr
id|header
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u16
id|buff
comma
id|frame_ctl
comma
id|len
op_assign
(paren
id|ETH_ZLEN
OL
id|skb-&gt;len
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_ne
id|STATION_STATE_READY
)paren
(brace
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;card
op_logical_and
id|priv-&gt;present_callback
op_logical_and
op_logical_neg
(paren
op_star
id|priv-&gt;present_callback
)paren
(paren
id|priv-&gt;card
)paren
)paren
(brace
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* first ensure the timer func cannot run */
id|spin_lock_bh
c_func
(paren
op_amp
id|priv-&gt;timerlock
)paren
suffix:semicolon
multiline_comment|/* then stop the hardware ISR */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* nb doing the above in the opposite order will deadlock */
multiline_comment|/* The Wireless Header is 30 bytes. In the Ethernet packet we &quot;cut&quot; the&n;&t;   12 first bytes (containing DA/SA) and put them in the appropriate fields of&n;&t;   the Wireless Header. Thus the packet length is then the initial + 18 (+30-12) */
r_if
c_cond
(paren
op_logical_neg
(paren
id|buff
op_assign
id|find_tx_buff
c_func
(paren
id|priv
comma
id|len
op_plus
l_int|18
)paren
)paren
)paren
(brace
id|priv-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|priv-&gt;timerlock
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|frame_ctl
op_assign
id|IEEE802_11_FTYPE_DATA
suffix:semicolon
id|header.duration_id
op_assign
l_int|0
suffix:semicolon
id|header.seq_ctl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep.wep_is_on
)paren
id|frame_ctl
op_or_assign
id|IEEE802_11_FCTL_WEP
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_ADHOC
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|header.addr1
comma
id|skb-&gt;data
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|header.addr2
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|header.addr3
comma
id|priv-&gt;BSSID
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|frame_ctl
op_or_assign
id|IEEE802_11_FCTL_TODS
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|header.addr1
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|header.addr2
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|header.addr3
comma
id|skb-&gt;data
comma
l_int|6
)paren
suffix:semicolon
)brace
id|header.frame_ctl
op_assign
id|cpu_to_le16
c_func
(paren
id|frame_ctl
)paren
suffix:semicolon
multiline_comment|/* Copy the wireless header into the card */
id|atmel_copy_to_card
c_func
(paren
id|dev
comma
id|buff
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|header
comma
id|DATA_FRAME_WS_HEADER_SIZE
)paren
suffix:semicolon
multiline_comment|/* Copy the packet sans its 802.3 header addresses which have been replaced */
id|atmel_copy_to_card
c_func
(paren
id|dev
comma
id|buff
op_plus
id|DATA_FRAME_WS_HEADER_SIZE
comma
id|skb-&gt;data
op_plus
l_int|12
comma
id|len
op_minus
l_int|12
)paren
suffix:semicolon
id|priv-&gt;tx_buff_tail
op_add_assign
id|len
op_minus
l_int|12
op_plus
id|DATA_FRAME_WS_HEADER_SIZE
suffix:semicolon
id|tx_update_descriptor
c_func
(paren
id|priv
comma
id|len
op_plus
l_int|18
comma
id|buff
comma
id|TX_PACKET_TYPE_DATA
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|priv-&gt;stats.tx_bytes
op_add_assign
id|len
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|priv-&gt;timerlock
)paren
suffix:semicolon
id|done
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_transmit_management_frame
r_static
r_void
id|atmel_transmit_management_frame
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u8
op_star
id|body
comma
r_int
id|body_len
)paren
(brace
id|u16
id|buff
suffix:semicolon
r_int
id|len
op_assign
id|MGMT_FRAME_BODY_OFFSET
op_plus
id|body_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|buff
op_assign
id|find_tx_buff
c_func
(paren
id|priv
comma
id|len
)paren
)paren
)paren
r_return
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
id|buff
comma
(paren
id|u8
op_star
)paren
id|header
comma
id|MGMT_FRAME_BODY_OFFSET
)paren
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
id|buff
op_plus
id|MGMT_FRAME_BODY_OFFSET
comma
id|body
comma
id|body_len
)paren
suffix:semicolon
id|priv-&gt;tx_buff_tail
op_add_assign
id|len
suffix:semicolon
id|tx_update_descriptor
c_func
(paren
id|priv
comma
id|len
comma
id|buff
comma
id|TX_PACKET_TYPE_MGMT
)paren
suffix:semicolon
)brace
DECL|function|fast_rx_path
r_static
r_void
id|fast_rx_path
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u16
id|msdu_size
comma
id|u16
id|rx_packet_loc
comma
id|u32
id|crc
)paren
(brace
multiline_comment|/* fast path: unfragmented packet copy directly into skbuf */
id|u8
id|mac4
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|skbp
suffix:semicolon
multiline_comment|/* get the final, mac 4 header field, this tells us encapsulation */
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
id|mac4
comma
id|rx_packet_loc
op_plus
l_int|24
comma
l_int|6
)paren
suffix:semicolon
id|msdu_size
op_sub_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
id|mac4
comma
l_int|6
)paren
suffix:semicolon
id|msdu_size
op_sub_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|msdu_size
op_plus
l_int|14
)paren
)paren
)paren
(brace
id|priv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skbp
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|msdu_size
op_plus
l_int|12
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
id|skbp
op_plus
l_int|12
comma
id|rx_packet_loc
op_plus
l_int|30
comma
id|msdu_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
id|u32
id|netcrc
suffix:semicolon
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
id|skbp
op_plus
l_int|12
comma
id|msdu_size
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_void
op_star
)paren
op_amp
id|netcrc
comma
id|rx_packet_loc
op_plus
l_int|30
op_plus
id|msdu_size
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|crc
op_xor
l_int|0xffffffff
)paren
op_ne
id|netcrc
)paren
(brace
id|priv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
id|skbp
comma
id|header-&gt;addr1
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* destination address */
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|header-&gt;frame_ctl
)paren
op_amp
id|IEEE802_11_FCTL_FROMDS
)paren
id|memcpy
c_func
(paren
op_amp
id|skbp
(braket
l_int|6
)braket
comma
id|header-&gt;addr3
comma
l_int|6
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|skbp
(braket
l_int|6
)braket
comma
id|header-&gt;addr2
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* source address */
id|priv-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|priv-&gt;stats.rx_bytes
op_add_assign
l_int|12
op_plus
id|msdu_size
suffix:semicolon
id|priv-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Test to see if the packet in card memory at packet_loc has a valid CRC&n;   It doesn&squot;t matter that this is slow: it is only used to proble the first few packets. */
DECL|function|probe_crc
r_static
r_int
id|probe_crc
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|packet_loc
comma
id|u16
id|msdu_size
)paren
(brace
r_int
id|i
op_assign
id|msdu_size
op_minus
l_int|4
suffix:semicolon
id|u32
id|netcrc
comma
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|msdu_size
OL
l_int|4
)paren
r_return
l_int|0
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_void
op_star
)paren
op_amp
id|netcrc
comma
id|packet_loc
op_plus
id|i
comma
l_int|4
)paren
suffix:semicolon
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|packet_loc
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
)paren
(brace
id|u8
id|octet
op_assign
id|atmel_read8
c_func
(paren
id|priv-&gt;dev
comma
id|DR
)paren
suffix:semicolon
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
op_amp
id|octet
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
(paren
id|crc
op_xor
l_int|0xffffffff
)paren
op_eq
id|netcrc
suffix:semicolon
)brace
DECL|function|frag_rx_path
r_static
r_void
id|frag_rx_path
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u16
id|msdu_size
comma
id|u16
id|rx_packet_loc
comma
id|u32
id|crc
comma
id|u16
id|seq_no
comma
id|u8
id|frag_no
comma
r_int
id|more_frags
)paren
(brace
id|u8
id|mac4
(braket
l_int|6
)braket
suffix:semicolon
id|u8
id|source
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|header-&gt;frame_ctl
)paren
op_amp
id|IEEE802_11_FCTL_FROMDS
)paren
id|memcpy
c_func
(paren
id|source
comma
id|header-&gt;addr3
comma
l_int|6
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
id|source
comma
id|header-&gt;addr2
comma
l_int|6
)paren
suffix:semicolon
id|rx_packet_loc
op_add_assign
l_int|24
suffix:semicolon
multiline_comment|/* skip header */
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
id|msdu_size
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|frag_no
op_eq
l_int|0
)paren
(brace
multiline_comment|/* first fragment */
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
id|mac4
comma
id|rx_packet_loc
comma
l_int|6
)paren
suffix:semicolon
id|msdu_size
op_sub_assign
l_int|6
suffix:semicolon
id|rx_packet_loc
op_add_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
id|mac4
comma
l_int|6
)paren
suffix:semicolon
id|priv-&gt;frag_seq
op_assign
id|seq_no
suffix:semicolon
id|priv-&gt;frag_no
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;frag_len
op_assign
id|msdu_size
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;frag_source
comma
id|source
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|priv-&gt;rx_buf
(braket
l_int|6
)braket
comma
id|source
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;rx_buf
comma
id|header-&gt;addr1
comma
l_int|6
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
op_amp
id|priv-&gt;rx_buf
(braket
l_int|12
)braket
comma
id|rx_packet_loc
comma
id|msdu_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
id|u32
id|netcrc
suffix:semicolon
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
op_amp
id|priv-&gt;rx_buf
(braket
l_int|12
)braket
comma
id|msdu_size
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_void
op_star
)paren
op_amp
id|netcrc
comma
id|rx_packet_loc
op_plus
id|msdu_size
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|crc
op_xor
l_int|0xffffffff
)paren
op_ne
id|netcrc
)paren
(brace
id|priv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;frag_source
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|priv-&gt;frag_no
op_eq
id|frag_no
op_logical_and
id|priv-&gt;frag_seq
op_eq
id|seq_no
op_logical_and
id|memcmp
c_func
(paren
id|priv-&gt;frag_source
comma
id|source
comma
l_int|6
)paren
op_eq
l_int|0
)paren
(brace
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
op_amp
id|priv-&gt;rx_buf
(braket
l_int|12
op_plus
id|priv-&gt;frag_len
)braket
comma
id|rx_packet_loc
comma
id|msdu_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
id|u32
id|netcrc
suffix:semicolon
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
op_amp
id|priv-&gt;rx_buf
(braket
l_int|12
op_plus
id|priv-&gt;frag_len
)braket
comma
id|msdu_size
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_void
op_star
)paren
op_amp
id|netcrc
comma
id|rx_packet_loc
op_plus
id|msdu_size
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|crc
op_xor
l_int|0xffffffff
)paren
op_ne
id|netcrc
)paren
(brace
id|priv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;frag_source
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
id|more_frags
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* don&squot;t send broken assembly */
)brace
)brace
id|priv-&gt;frag_len
op_add_assign
id|msdu_size
suffix:semicolon
id|priv-&gt;frag_no
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|more_frags
)paren
(brace
multiline_comment|/* last one */
id|memset
c_func
(paren
id|priv-&gt;frag_source
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|priv-&gt;frag_len
op_plus
l_int|14
)paren
)paren
)paren
(brace
id|priv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|priv-&gt;frag_len
op_plus
l_int|12
)paren
comma
id|priv-&gt;rx_buf
comma
id|priv-&gt;frag_len
op_plus
l_int|12
)paren
suffix:semicolon
id|priv-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;dev
op_assign
id|priv-&gt;dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|priv-&gt;dev
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|priv-&gt;stats.rx_bytes
op_add_assign
id|priv-&gt;frag_len
op_plus
l_int|12
suffix:semicolon
id|priv-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
)brace
)brace
r_else
id|priv-&gt;wstats.discard.fragment
op_increment
suffix:semicolon
)brace
DECL|function|rx_done_irq
r_static
r_void
id|rx_done_irq
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|ieee802_11_hdr
id|header
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_FLAGS_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
)paren
op_eq
id|RX_DESC_FLAG_VALID
op_logical_and
id|i
OL
id|priv-&gt;host_info.rx_desc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u16
id|msdu_size
comma
id|rx_packet_loc
comma
id|frame_ctl
comma
id|seq_control
suffix:semicolon
id|u8
id|status
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_STATUS_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
)paren
suffix:semicolon
id|u32
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|RX_STATUS_SUCCESS
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
l_int|0xc1
)paren
multiline_comment|/* determined by experiment */
id|priv-&gt;wstats.discard.nwid
op_increment
suffix:semicolon
r_else
id|priv-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|msdu_size
op_assign
id|atmel_rmem16
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_MSDU_SIZE_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
)paren
suffix:semicolon
id|rx_packet_loc
op_assign
id|atmel_rmem16
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_MSDU_POS_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msdu_size
OL
l_int|30
)paren
(brace
id|priv-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
multiline_comment|/* Get header as far as end of seq_ctl */
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_char
op_star
)paren
op_amp
id|header
comma
id|rx_packet_loc
comma
l_int|24
)paren
suffix:semicolon
id|frame_ctl
op_assign
id|le16_to_cpu
c_func
(paren
id|header.frame_ctl
)paren
suffix:semicolon
id|seq_control
op_assign
id|le16_to_cpu
c_func
(paren
id|header.seq_ctl
)paren
suffix:semicolon
multiline_comment|/* probe for CRC use here if needed  once five packets have arrived with&n;&t;&t;   the same crc status, we assume we know what&squot;s happening and stop probing */
r_if
c_cond
(paren
id|priv-&gt;probe_crc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
op_logical_or
op_logical_neg
(paren
id|frame_ctl
op_amp
id|IEEE802_11_FCTL_WEP
)paren
)paren
(brace
id|priv-&gt;do_rx_crc
op_assign
id|probe_crc
c_func
(paren
id|priv
comma
id|rx_packet_loc
comma
id|msdu_size
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;do_rx_crc
op_assign
id|probe_crc
c_func
(paren
id|priv
comma
id|rx_packet_loc
op_plus
l_int|24
comma
id|msdu_size
op_minus
l_int|24
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;crc_ok_cnt
op_increment
OG
l_int|5
)paren
id|priv-&gt;probe_crc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|priv-&gt;crc_ko_cnt
op_increment
OG
l_int|5
)paren
id|priv-&gt;probe_crc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* don&squot;t CRC header when WEP in use */
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
op_logical_and
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
op_logical_or
op_logical_neg
(paren
id|frame_ctl
op_amp
id|IEEE802_11_FCTL_WEP
)paren
)paren
)paren
(brace
id|crc
op_assign
id|crc32_le
c_func
(paren
l_int|0xffffffff
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|header
comma
l_int|24
)paren
suffix:semicolon
)brace
id|msdu_size
op_sub_assign
l_int|24
suffix:semicolon
multiline_comment|/* header */
r_if
c_cond
(paren
(paren
id|frame_ctl
op_amp
id|IEEE802_11_FCTL_FTYPE
)paren
op_eq
id|IEEE802_11_FTYPE_DATA
)paren
(brace
r_int
id|more_fragments
op_assign
id|frame_ctl
op_amp
id|IEEE802_11_FCTL_MOREFRAGS
suffix:semicolon
id|u8
id|packet_fragment_no
op_assign
id|seq_control
op_amp
id|IEEE802_11_SCTL_FRAG
suffix:semicolon
id|u16
id|packet_sequence_no
op_assign
(paren
id|seq_control
op_amp
id|IEEE802_11_SCTL_SEQ
)paren
op_rshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|more_fragments
op_logical_and
id|packet_fragment_no
op_eq
l_int|0
)paren
(brace
id|fast_rx_path
c_func
(paren
id|priv
comma
op_amp
id|header
comma
id|msdu_size
comma
id|rx_packet_loc
comma
id|crc
)paren
suffix:semicolon
)brace
r_else
(brace
id|frag_rx_path
c_func
(paren
id|priv
comma
op_amp
id|header
comma
id|msdu_size
comma
id|rx_packet_loc
comma
id|crc
comma
id|packet_sequence_no
comma
id|packet_fragment_no
comma
id|more_fragments
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|frame_ctl
op_amp
id|IEEE802_11_FCTL_FTYPE
)paren
op_eq
id|IEEE802_11_FTYPE_MGMT
)paren
(brace
multiline_comment|/* copy rest of packet into buffer */
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|priv-&gt;rx_buf
comma
id|rx_packet_loc
op_plus
l_int|24
comma
id|msdu_size
)paren
suffix:semicolon
multiline_comment|/* we use the same buffer for frag reassembly and control packets */
id|memset
c_func
(paren
id|priv-&gt;frag_source
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;do_rx_crc
)paren
(brace
multiline_comment|/* last 4 octets is crc */
id|msdu_size
op_sub_assign
l_int|4
suffix:semicolon
id|crc
op_assign
id|crc32_le
c_func
(paren
id|crc
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|priv-&gt;rx_buf
comma
id|msdu_size
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|crc
op_xor
l_int|0xffffffff
)paren
op_ne
(paren
op_star
(paren
(paren
id|u32
op_star
)paren
op_amp
id|priv-&gt;rx_buf
(braket
id|msdu_size
)braket
)paren
)paren
)paren
(brace
id|priv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
)brace
id|atmel_management_frame
c_func
(paren
id|priv
comma
op_amp
id|header
comma
id|msdu_size
comma
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_RSSI_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
)paren
)paren
suffix:semicolon
)brace
id|next
suffix:colon
multiline_comment|/* release descriptor */
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_rx
c_func
(paren
id|priv
comma
id|RX_DESC_FLAGS_OFFSET
comma
id|priv-&gt;rx_desc_head
)paren
comma
id|RX_DESC_FLAG_CONSUMED
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;rx_desc_head
OL
(paren
id|priv-&gt;host_info.rx_desc_count
op_minus
l_int|1
)paren
)paren
id|priv-&gt;rx_desc_head
op_increment
suffix:semicolon
r_else
id|priv-&gt;rx_desc_head
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|reset_irq_status
r_static
r_void
id|reset_irq_status
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|mask
)paren
(brace
id|u8
id|isr
suffix:semicolon
id|atmel_lock_mac
c_func
(paren
id|priv
)paren
suffix:semicolon
id|isr
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_INT_STATUS_OFFSET
)paren
)paren
suffix:semicolon
id|isr
op_xor_assign
id|mask
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_INT_STATUS_OFFSET
)paren
comma
id|isr
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_MAC_OFFSET
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|service_interrupt
r_static
id|irqreturn_t
id|service_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u8
id|isr
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;card
op_logical_and
id|priv-&gt;present_callback
op_logical_and
op_logical_neg
(paren
op_star
id|priv-&gt;present_callback
)paren
(paren
id|priv-&gt;card
)paren
)paren
r_return
id|IRQ_HANDLED
suffix:semicolon
id|atmel_clear_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|atmel_lock_mac
c_func
(paren
id|priv
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC gone away in ISR.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* bad things - don&squot;t re-enable interrupts */
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
id|isr
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_INT_STATUS_OFFSET
)paren
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_MAC_OFFSET
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr
)paren
id|atmel_set_gcr
c_func
(paren
id|dev
comma
id|GCR_ACKINT
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
r_else
r_break
suffix:semicolon
multiline_comment|/* no pending irqs */
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_OUT_OF_RANGE
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_OUT_OF_RANGE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
op_logical_and
id|priv-&gt;station_state
op_eq
id|STATION_STATE_READY
)paren
(brace
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_RxCOMPLETE
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_RxCOMPLETE
)paren
suffix:semicolon
id|rx_done_irq
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_TxCOMPLETE
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_TxCOMPLETE
)paren
suffix:semicolon
id|tx_done_irq
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_RxFRAMELOST
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_RxFRAMELOST
)paren
suffix:semicolon
id|priv-&gt;wstats.discard.misc
op_increment
suffix:semicolon
id|rx_done_irq
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_FATAL_ERROR
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_FATAL_ERROR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: *** FATAL error interrupt ***&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_COMMAND_COMPLETE
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_COMMAND_COMPLETE
)paren
suffix:semicolon
id|atmel_command_irq
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_IBSS_MERGE
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_IBSS_MERGE
)paren
suffix:semicolon
id|atmel_get_mib
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_CUR_BSSID_POS
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|isr
op_amp
id|ISR_GENERIC_IRQ
)paren
(brace
id|reset_irq_status
c_func
(paren
id|priv
comma
id|ISR_GENERIC_IRQ
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Generic_irq recieved.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|atmel_set_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|atmel_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|atmel_get_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
DECL|function|atmel_get_wireless_stats
r_static
r_struct
id|iw_statistics
op_star
id|atmel_get_wireless_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* update the link quality here in case we are seeing no beacons &n;&t;   at all to drive the process */
id|atmel_smooth_qual
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;wstats.status
op_assign
id|priv-&gt;station_state
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;station_state
op_ne
id|STATION_STATE_READY
)paren
(brace
id|priv-&gt;wstats.qual.qual
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.qual.level
op_assign
l_int|0
suffix:semicolon
)brace
id|priv-&gt;wstats.qual.noise
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.qual.updated
op_assign
l_int|7
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// Quality levels cannot be determined in ad-hoc mode,
singleline_comment|// because we can &squot;hear&squot; more that one remote station.
id|priv-&gt;wstats.qual.qual
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.qual.level
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.qual.noise
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.qual.updated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wstats.miss.beacon
op_assign
l_int|0
suffix:semicolon
)brace
r_return
(paren
op_amp
id|priv-&gt;wstats
)paren
suffix:semicolon
)brace
DECL|function|atmel_change_mtu
r_static
r_int
id|atmel_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
l_int|2312
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_mac_address
r_static
r_int
id|atmel_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
id|memcpy
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|reset_atmel_card
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_open
r_static
r_int
id|atmel_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|priv-&gt;station_state
op_assign
id|STATION_STATE_INITIALIZING
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|reset_atmel_card
c_func
(paren
id|dev
)paren
)paren
(brace
id|priv-&gt;station_state
op_assign
id|STATION_STATE_DOWN
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_close
r_static
r_int
id|atmel_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|priv-&gt;station_state
op_assign
id|STATION_STATE_DOWN
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_proc_output
r_static
r_int
id|atmel_proc_output
(paren
r_char
op_star
id|buf
comma
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_char
op_star
id|s
comma
op_star
id|r
comma
op_star
id|c
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Driver version:&bslash;t&bslash;t%d.%d&bslash;n&quot;
comma
id|DRIVER_MAJOR
comma
id|DRIVER_MINOR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_ne
id|STATION_STATE_DOWN
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Firmware version:&bslash;t%d.%d build %d &quot;
comma
id|priv-&gt;host_info.major_version
comma
id|priv-&gt;host_info.minor_version
comma
id|priv-&gt;host_info.build_version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;card_type
op_ne
id|CARD_TYPE_EEPROM
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;[built-in]&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|priv-&gt;firmware
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;[%s loaded by host]&bslash;n&quot;
comma
id|priv-&gt;firmware_id
)paren
suffix:semicolon
r_else
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;[%s loaded by hotplug]&bslash;n&quot;
comma
id|priv-&gt;firmware_id
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;card_type
)paren
(brace
r_case
id|CARD_TYPE_PARALLEL_FLASH
suffix:colon
id|c
op_assign
l_string|&quot;Parallel flash&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CARD_TYPE_SPI_FLASH
suffix:colon
id|c
op_assign
l_string|&quot;SPI flash&bslash;n&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CARD_TYPE_EEPROM
suffix:colon
id|c
op_assign
l_string|&quot;EEPROM&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|c
op_assign
l_string|&quot;&lt;unknown&gt;&quot;
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|priv-&gt;reg_domain
)paren
(brace
r_case
id|REG_DOMAIN_FCC
suffix:colon
id|r
op_assign
l_string|&quot;USA&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_DOC
suffix:colon
id|r
op_assign
l_string|&quot;Canada&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_ETSI
suffix:colon
id|r
op_assign
l_string|&quot;Europe&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_SPAIN
suffix:colon
id|r
op_assign
l_string|&quot;Spain&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_FRANCE
suffix:colon
id|r
op_assign
l_string|&quot;France&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_MKK
suffix:colon
id|r
op_assign
l_string|&quot;Japan (MKK)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_MKK1
suffix:colon
id|r
op_assign
l_string|&quot;Japan (MKK1)&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|REG_DOMAIN_ISRAEL
suffix:colon
id|r
op_assign
l_string|&quot;Israel&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|r
op_assign
l_string|&quot;&lt;unknown&gt;&quot;
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;MAC memory type:&bslash;t%s&bslash;n&quot;
comma
id|c
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Regulatory domain:&bslash;t%s&bslash;n&quot;
comma
id|r
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Host CRC checking:&bslash;t%s&bslash;n&quot;
comma
id|priv-&gt;do_rx_crc
ques
c_cond
l_string|&quot;On&quot;
suffix:colon
l_string|&quot;Off&quot;
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|priv-&gt;station_state
)paren
(brace
r_case
id|STATION_STATE_INITIALIZING
suffix:colon
id|s
op_assign
l_string|&quot;Initialising&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_SCANNING
suffix:colon
id|s
op_assign
l_string|&quot;Scanning&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_JOINNING
suffix:colon
id|s
op_assign
l_string|&quot;Joining&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_AUTHENTICATING
suffix:colon
id|s
op_assign
l_string|&quot;Authenticating&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_ASSOCIATING
suffix:colon
id|s
op_assign
l_string|&quot;Associating&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_READY
suffix:colon
id|s
op_assign
l_string|&quot;Ready&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_REASSOCIATING
suffix:colon
id|s
op_assign
l_string|&quot;Reassociating&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_FORCED_JOINNING
suffix:colon
id|s
op_assign
l_string|&quot;Forced joining&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_FORCED_JOIN_FAILURE
suffix:colon
id|s
op_assign
l_string|&quot;Forced join failure&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_NO_CARD
suffix:colon
id|s
op_assign
l_string|&quot;No card&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_MGMT_ERROR
suffix:colon
id|s
op_assign
l_string|&quot;Management error&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATION_STATE_DOWN
suffix:colon
id|s
op_assign
l_string|&quot;Down&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;&lt;unknown&gt;&quot;
suffix:semicolon
)brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Current state:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
r_return
id|p
op_minus
id|buf
suffix:semicolon
)brace
DECL|function|atmel_read_proc
r_static
r_int
id|atmel_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
op_assign
id|atmel_proc_output
(paren
id|page
comma
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
id|off
op_plus
id|count
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
id|len
op_sub_assign
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|count
)paren
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|init_atmel_card
r_struct
id|net_device
op_star
id|init_atmel_card
c_func
(paren
r_int
r_int
id|irq
comma
r_int
id|port
comma
r_char
op_star
id|firmware_id
comma
r_int
id|is3com
comma
r_struct
id|device
op_star
id|sys_dev
comma
r_int
(paren
op_star
id|card_present
)paren
(paren
r_void
op_star
)paren
comma
r_void
op_star
id|card
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
multiline_comment|/* Create the network device object. */
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|priv
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atmel:  Couldn&squot;t alloc_etherdev&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_alloc_name
c_func
(paren
id|dev
comma
id|dev-&gt;name
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atmel:  Couldn&squot;t get name!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free
suffix:semicolon
)brace
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|priv-&gt;dev
op_assign
id|dev
suffix:semicolon
id|priv-&gt;sys_dev
op_assign
id|sys_dev
suffix:semicolon
id|priv-&gt;present_callback
op_assign
id|card_present
suffix:semicolon
id|priv-&gt;card
op_assign
id|card
suffix:semicolon
id|priv-&gt;firmware
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|firmware
)paren
multiline_comment|/* module parameter */
id|strcpy
c_func
(paren
id|priv-&gt;firmware_id
comma
id|firmware
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|firmware_id
)paren
multiline_comment|/* from PCMCIA card-matching or PCI */
id|strcpy
c_func
(paren
id|priv-&gt;firmware_id
comma
id|firmware_id
)paren
suffix:semicolon
r_else
id|priv-&gt;firmware_id
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|priv-&gt;bus_type
op_assign
id|card_present
ques
c_cond
id|BUS_TYPE_PCCARD
suffix:colon
id|BUS_TYPE_PCI
suffix:semicolon
id|priv-&gt;station_state
op_assign
id|STATION_STATE_DOWN
suffix:semicolon
id|priv-&gt;is3com
op_assign
id|is3com
suffix:semicolon
id|priv-&gt;do_rx_crc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* For PCMCIA cards, some chips need CRC, some don&squot;t&n;&t;   so we have to probe. */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
(brace
id|priv-&gt;probe_crc
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;crc_ok_cnt
op_assign
id|priv-&gt;crc_ko_cnt
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|priv-&gt;probe_crc
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|priv-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;stats
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|priv-&gt;wstats
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;wstats
)paren
)paren
suffix:semicolon
id|priv-&gt;last_qual
op_assign
id|jiffies
suffix:semicolon
id|priv-&gt;last_beacon_timestamp
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;frag_source
comma
l_int|0xff
comma
r_sizeof
(paren
id|priv-&gt;frag_source
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;BSSID
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
id|priv-&gt;CurrentBSSID
(braket
l_int|0
)braket
op_assign
l_int|0xFF
suffix:semicolon
multiline_comment|/* Initialize to something invalid.... */
id|priv-&gt;station_was_associated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;last_survey
op_assign
id|jiffies
suffix:semicolon
id|priv-&gt;preamble
op_assign
id|LONG_PREAMBLE
suffix:semicolon
id|priv-&gt;operating_mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|priv-&gt;connect_to_any_BSS
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_rate
op_assign
l_int|3
suffix:semicolon
id|priv-&gt;auto_tx_rate
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;channel
op_assign
l_int|4
suffix:semicolon
id|priv-&gt;power_mode
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;SSID
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|priv-&gt;SSID_size
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;new_SSID_size
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;frag_threshold
op_assign
l_int|2346
suffix:semicolon
id|priv-&gt;rts_threshold
op_assign
l_int|2347
suffix:semicolon
id|priv-&gt;short_retry
op_assign
l_int|7
suffix:semicolon
id|priv-&gt;long_retry
op_assign
l_int|4
suffix:semicolon
id|priv-&gt;wep.wep_is_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wep.default_key
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wep.encryption_level
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;default_beacon_period
op_assign
id|priv-&gt;beacon_period
op_assign
l_int|100
suffix:semicolon
id|priv-&gt;listen_interval
op_assign
l_int|1
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;irqlock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;timerlock
)paren
suffix:semicolon
id|priv-&gt;management_timer.function
op_assign
id|atmel_management_timer
suffix:semicolon
id|priv-&gt;management_timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|dev-&gt;open
op_assign
id|atmel_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|atmel_close
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|atmel_change_mtu
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|atmel_set_mac_address
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|start_tx
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|atmel_get_stats
suffix:semicolon
id|dev-&gt;get_wireless_stats
op_assign
id|atmel_get_wireless_stats
suffix:semicolon
id|dev-&gt;wireless_handlers
op_assign
(paren
r_struct
id|iw_handler_def
op_star
)paren
op_amp
id|atmel_handler_def
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|atmel_ioctl
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|service_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: register interrupt %d failed, rc %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|irq
comma
id|rc
)paren
suffix:semicolon
r_goto
id|err_out_free
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCI
op_logical_and
op_logical_neg
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
comma
id|dev-&gt;name
)paren
)paren
(brace
r_goto
id|err_out_irq
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
r_goto
id|err_out_res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|probe_atmel_card
c_func
(paren
id|dev
)paren
)paren
r_goto
id|err_out_res
suffix:semicolon
id|create_proc_read_entry
(paren
l_string|&quot;driver/atmel&quot;
comma
l_int|0
comma
l_int|0
comma
id|atmel_read_proc
comma
id|priv
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Atmel at76c50x wireless. Version %d.%d simon@thekelleys.org.uk&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|DRIVER_MAJOR
comma
id|DRIVER_MINOR
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
id|err_out_res
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCI
)paren
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
)paren
suffix:semicolon
id|err_out_irq
suffix:colon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|init_atmel_card
id|EXPORT_SYMBOL
c_func
(paren
id|init_atmel_card
)paren
suffix:semicolon
DECL|function|stop_atmel_card
r_void
id|stop_atmel_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|freeres
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* put a brick on it... */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;driver/atmel&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|priv-&gt;management_timer
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;firmware
)paren
id|kfree
c_func
(paren
id|priv-&gt;firmware
)paren
suffix:semicolon
r_if
c_cond
(paren
id|freeres
)paren
(brace
multiline_comment|/* PCMCIA frees this stuff, so only for PCI */
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
)paren
suffix:semicolon
)brace
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|stop_atmel_card
id|EXPORT_SYMBOL
c_func
(paren
id|stop_atmel_card
)paren
suffix:semicolon
r_static
r_const
r_struct
(brace
DECL|member|reg_domain
r_int
id|reg_domain
suffix:semicolon
DECL|member|min
DECL|member|max
r_int
id|min
comma
id|max
suffix:semicolon
DECL|variable|channel_table
)brace
id|channel_table
(braket
)braket
op_assign
(brace
(brace
id|REG_DOMAIN_FCC
comma
l_int|1
comma
l_int|11
)brace
comma
(brace
id|REG_DOMAIN_DOC
comma
l_int|1
comma
l_int|11
)brace
comma
(brace
id|REG_DOMAIN_ETSI
comma
l_int|1
comma
l_int|13
)brace
comma
(brace
id|REG_DOMAIN_SPAIN
comma
l_int|10
comma
l_int|11
)brace
comma
(brace
id|REG_DOMAIN_FRANCE
comma
l_int|10
comma
l_int|13
)brace
comma
(brace
id|REG_DOMAIN_MKK
comma
l_int|14
comma
l_int|14
)brace
comma
(brace
id|REG_DOMAIN_MKK1
comma
l_int|1
comma
l_int|14
)brace
comma
(brace
id|REG_DOMAIN_ISRAEL
comma
l_int|9
)brace
)brace
suffix:semicolon
DECL|function|atmel_validate_channel
r_static
r_int
id|atmel_validate_channel
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|channel
)paren
(brace
multiline_comment|/* check that channel is OK, if so return zero,&n;&t;   else return suitable default channel */
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|channel_table
)paren
op_div
r_sizeof
(paren
id|channel_table
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|priv-&gt;reg_domain
op_eq
id|channel_table
(braket
id|i
)braket
dot
id|reg_domain
)paren
(brace
r_if
c_cond
(paren
id|channel
op_ge
id|channel_table
(braket
id|i
)braket
dot
id|min
op_logical_and
id|channel
op_le
id|channel_table
(braket
id|i
)braket
dot
id|max
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_return
id|channel_table
(braket
id|i
)braket
dot
id|min
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|atmel_set_essid
r_static
r_int
id|atmel_set_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Check if we asked for `any&squot; */
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_eq
l_int|0
)paren
(brace
id|priv-&gt;connect_to_any_BSS
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
id|priv-&gt;connect_to_any_BSS
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check the size of the string */
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
id|MAX_SSID_LENGTH
op_plus
l_int|1
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;new_SSID
comma
id|extra
comma
id|dwrq-&gt;length
op_minus
l_int|1
)paren
suffix:semicolon
id|priv-&gt;new_SSID_size
op_assign
id|dwrq-&gt;length
op_minus
l_int|1
suffix:semicolon
)brace
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
DECL|function|atmel_get_essid
r_static
r_int
id|atmel_get_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Get the current SSID */
r_if
c_cond
(paren
id|priv-&gt;SSID_size
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|extra
comma
id|priv-&gt;new_SSID
comma
id|priv-&gt;new_SSID_size
)paren
suffix:semicolon
id|extra
(braket
id|priv-&gt;new_SSID_size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dwrq-&gt;length
op_assign
id|priv-&gt;new_SSID_size
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|extra
comma
id|priv-&gt;SSID
comma
id|priv-&gt;SSID_size
)paren
suffix:semicolon
id|extra
(braket
id|priv-&gt;SSID_size
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dwrq-&gt;length
op_assign
id|priv-&gt;SSID_size
op_plus
l_int|1
suffix:semicolon
)brace
id|dwrq-&gt;flags
op_assign
op_logical_neg
id|priv-&gt;connect_to_any_BSS
suffix:semicolon
multiline_comment|/* active */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_get_wap
r_static
r_int
id|atmel_get_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|memcpy
c_func
(paren
id|awrq-&gt;sa_data
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|awrq-&gt;sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_encode
r_static
r_int
id|atmel_set_encode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Basic checking: do we have a key to set ?&n;&t; * Note : with the new API, it&squot;s impossible to get a NULL pointer.&n;&t; * Therefore, we need to check a key size == 0 instead.&n;&t; * New version of iwconfig properly set the IW_ENCODE_NOKEY flag&n;&t; * when no key is present (only change flags), but older versions&n;&t; * don&squot;t do it. - Jean II */
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|0
)paren
(brace
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|current_index
op_assign
id|priv-&gt;wep.default_key
suffix:semicolon
multiline_comment|/* Check the size of the key */
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|13
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Check the index (none -&gt; use current) */
r_if
c_cond
(paren
id|index
OL
l_int|0
op_logical_or
id|index
op_ge
l_int|4
)paren
id|index
op_assign
id|current_index
suffix:semicolon
r_else
id|priv-&gt;wep.default_key
op_assign
id|index
suffix:semicolon
multiline_comment|/* Set the length */
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|5
)paren
id|priv-&gt;wep_key_len
(braket
id|index
)braket
op_assign
l_int|13
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|0
)paren
id|priv-&gt;wep_key_len
(braket
id|index
)braket
op_assign
l_int|5
suffix:semicolon
r_else
multiline_comment|/* Disable the key */
id|priv-&gt;wep_key_len
(braket
id|index
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check if the key is not marked as invalid */
r_if
c_cond
(paren
op_logical_neg
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_NOKEY
)paren
)paren
(brace
multiline_comment|/* Cleanup */
id|memset
c_func
(paren
id|priv-&gt;wep.wep_keys
(braket
id|index
)braket
comma
l_int|0
comma
l_int|13
)paren
suffix:semicolon
multiline_comment|/* Copy the key in the driver */
id|memcpy
c_func
(paren
id|priv-&gt;wep.wep_keys
(braket
id|index
)braket
comma
id|extra
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
)brace
multiline_comment|/* WE specify that if a valid key is set, encryption&n;&t;&t; * should be enabled (user may turn it off later)&n;&t;&t; * This is also how &quot;iwconfig ethX key on&quot; works */
r_if
c_cond
(paren
id|index
op_eq
id|current_index
op_logical_and
id|priv-&gt;wep_key_len
(braket
id|index
)braket
OG
l_int|0
)paren
(brace
id|priv-&gt;wep.wep_is_on
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;wep.exclude_unencrypted
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep_key_len
(braket
id|index
)braket
OG
l_int|5
)paren
id|priv-&gt;wep.encryption_level
op_assign
l_int|2
suffix:semicolon
r_else
id|priv-&gt;wep.encryption_level
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Do we want to just set the transmit key index ? */
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
OL
l_int|4
)paren
(brace
id|priv-&gt;wep.default_key
op_assign
id|index
suffix:semicolon
)brace
r_else
multiline_comment|/* Don&squot;t complain if only change the mode */
r_if
c_cond
(paren
op_logical_neg
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_MODE
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/* Read the flags */
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_DISABLED
)paren
(brace
id|priv-&gt;wep.wep_is_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wep.encryption_level
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;wep.wep_is_on
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep_key_len
(braket
id|priv-&gt;wep.default_key
)braket
OG
l_int|5
)paren
id|priv-&gt;wep.encryption_level
op_assign
l_int|2
suffix:semicolon
r_else
id|priv-&gt;wep.encryption_level
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
(brace
id|priv-&gt;wep.exclude_unencrypted
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_OPEN
)paren
(brace
id|priv-&gt;wep.exclude_unencrypted
op_assign
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
multiline_comment|/* Call commit handler */
)brace
DECL|function|atmel_get_encode
r_static
r_int
id|atmel_get_encode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
)paren
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
r_else
r_if
c_cond
(paren
id|priv-&gt;wep.exclude_unencrypted
)paren
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_RESTRICTED
suffix:semicolon
r_else
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_OPEN
suffix:semicolon
multiline_comment|/* Which key do we want ? -1 -&gt; tx index */
r_if
c_cond
(paren
id|index
OL
l_int|0
op_logical_or
id|index
op_ge
l_int|4
)paren
id|index
op_assign
id|priv-&gt;wep.default_key
suffix:semicolon
id|dwrq-&gt;flags
op_or_assign
id|index
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Copy the key to the user buffer */
id|dwrq-&gt;length
op_assign
id|priv-&gt;wep_key_len
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|16
)paren
(brace
id|dwrq-&gt;length
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|extra
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|priv-&gt;wep.wep_keys
(braket
id|index
)braket
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_get_name
r_static
r_int
id|atmel_get_name
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_char
op_star
id|cwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|strcpy
c_func
(paren
id|cwrq
comma
l_string|&quot;IEEE 802.11-DS&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_rate
r_static
r_int
id|atmel_set_rate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;fixed
op_eq
l_int|0
)paren
(brace
id|priv-&gt;tx_rate
op_assign
l_int|3
suffix:semicolon
id|priv-&gt;auto_tx_rate
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;auto_tx_rate
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Which type of value ? */
r_if
c_cond
(paren
(paren
id|vwrq-&gt;value
OL
l_int|4
)paren
op_logical_and
(paren
id|vwrq-&gt;value
op_ge
l_int|0
)paren
)paren
(brace
multiline_comment|/* Setting by rate index */
id|priv-&gt;tx_rate
op_assign
id|vwrq-&gt;value
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Setting by frequency value */
r_switch
c_cond
(paren
id|vwrq-&gt;value
)paren
(brace
r_case
(paren
r_int
)paren
l_float|1e6
suffix:colon
id|priv-&gt;tx_rate
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
r_int
)paren
l_float|2e6
suffix:colon
id|priv-&gt;tx_rate
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
r_int
)paren
l_float|5.5e6
suffix:colon
id|priv-&gt;tx_rate
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
r_int
)paren
l_float|11e6
suffix:colon
id|priv-&gt;tx_rate
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
DECL|function|atmel_set_mode
r_static
r_int
id|atmel_set_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_star
id|uwrq
op_ne
id|IW_MODE_ADHOC
op_logical_and
op_star
id|uwrq
op_ne
id|IW_MODE_INFRA
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|priv-&gt;operating_mode
op_assign
op_star
id|uwrq
suffix:semicolon
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
DECL|function|atmel_get_mode
r_static
r_int
id|atmel_get_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
op_star
id|uwrq
op_assign
id|priv-&gt;operating_mode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_get_rate
r_static
r_int
id|atmel_get_rate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;auto_tx_rate
)paren
(brace
id|vwrq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
id|vwrq-&gt;value
op_assign
l_float|11e6
suffix:semicolon
)brace
r_else
(brace
id|vwrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;tx_rate
)paren
(brace
r_case
l_int|0
suffix:colon
id|vwrq-&gt;value
op_assign
l_float|1e6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|vwrq-&gt;value
op_assign
l_float|2e6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|vwrq-&gt;value
op_assign
l_float|5.5e6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|vwrq-&gt;value
op_assign
l_float|11e6
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_power
r_static
r_int
id|atmel_set_power
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|priv-&gt;power_mode
op_assign
id|vwrq-&gt;disabled
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
DECL|function|atmel_get_power
r_static
r_int
id|atmel_get_power
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
id|priv-&gt;power_mode
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|vwrq-&gt;flags
op_assign
id|IW_POWER_ON
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_retry
r_static
r_int
id|atmel_set_retry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vwrq-&gt;disabled
op_logical_and
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_LIMIT
)paren
)paren
(brace
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
(brace
id|priv-&gt;long_retry
op_assign
id|vwrq-&gt;value
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MIN
)paren
id|priv-&gt;short_retry
op_assign
id|vwrq-&gt;value
suffix:semicolon
r_else
(brace
multiline_comment|/* No modifier : set both */
id|priv-&gt;long_retry
op_assign
id|vwrq-&gt;value
suffix:semicolon
id|priv-&gt;short_retry
op_assign
id|vwrq-&gt;value
suffix:semicolon
)brace
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|atmel_get_retry
r_static
r_int
id|atmel_get_retry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Can&squot;t be disabled */
multiline_comment|/* Note : by default, display the min retry number */
r_if
c_cond
(paren
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
)paren
(brace
id|vwrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MAX
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|priv-&gt;long_retry
suffix:semicolon
)brace
r_else
(brace
id|vwrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|priv-&gt;short_retry
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;long_retry
op_ne
id|priv-&gt;short_retry
)paren
(brace
id|vwrq-&gt;flags
op_or_assign
id|IW_RETRY_MIN
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_rts
r_static
r_int
id|atmel_set_rts
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rthr
op_assign
id|vwrq-&gt;value
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;disabled
)paren
(brace
id|rthr
op_assign
l_int|2347
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rthr
OL
l_int|0
)paren
op_logical_or
(paren
id|rthr
OG
l_int|2347
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|priv-&gt;rts_threshold
op_assign
id|rthr
suffix:semicolon
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
multiline_comment|/* Call commit handler */
)brace
DECL|function|atmel_get_rts
r_static
r_int
id|atmel_get_rts
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|priv-&gt;rts_threshold
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
(paren
id|vwrq-&gt;value
op_ge
l_int|2347
)paren
suffix:semicolon
id|vwrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_frag
r_static
r_int
id|atmel_set_frag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|fthr
op_assign
id|vwrq-&gt;value
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;disabled
)paren
(brace
id|fthr
op_assign
l_int|2346
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fthr
OL
l_int|256
)paren
op_logical_or
(paren
id|fthr
OG
l_int|2346
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|fthr
op_and_assign
op_complement
l_int|0x1
suffix:semicolon
multiline_comment|/* Get an even value - is it really needed ??? */
id|priv-&gt;frag_threshold
op_assign
id|fthr
suffix:semicolon
r_return
op_minus
id|EINPROGRESS
suffix:semicolon
multiline_comment|/* Call commit handler */
)brace
DECL|function|atmel_get_frag
r_static
r_int
id|atmel_get_frag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|priv-&gt;frag_threshold
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
(paren
id|vwrq-&gt;value
op_ge
l_int|2346
)paren
suffix:semicolon
id|vwrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|frequency_list
r_static
r_const
r_int
id|frequency_list
(braket
)braket
op_assign
(brace
l_int|2412
comma
l_int|2417
comma
l_int|2422
comma
l_int|2427
comma
l_int|2432
comma
l_int|2437
comma
l_int|2442
comma
l_int|2447
comma
l_int|2452
comma
l_int|2457
comma
l_int|2462
comma
l_int|2467
comma
l_int|2472
comma
l_int|2484
)brace
suffix:semicolon
DECL|function|atmel_set_freq
r_static
r_int
id|atmel_set_freq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_freq
op_star
id|fwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
multiline_comment|/* Call commit handler */
multiline_comment|/* If setting by frequency, convert to a channel */
r_if
c_cond
(paren
(paren
id|fwrq-&gt;e
op_eq
l_int|1
)paren
op_logical_and
(paren
id|fwrq-&gt;m
op_ge
(paren
r_int
)paren
l_float|2.412e8
)paren
op_logical_and
(paren
id|fwrq-&gt;m
op_le
(paren
r_int
)paren
l_float|2.487e8
)paren
)paren
(brace
r_int
id|f
op_assign
id|fwrq-&gt;m
op_div
l_int|100000
suffix:semicolon
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
OL
l_int|14
)paren
op_logical_and
(paren
id|f
op_ne
id|frequency_list
(braket
id|c
)braket
)paren
)paren
(brace
id|c
op_increment
suffix:semicolon
)brace
multiline_comment|/* Hack to fall through... */
id|fwrq-&gt;e
op_assign
l_int|0
suffix:semicolon
id|fwrq-&gt;m
op_assign
id|c
op_plus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Setting by channel number */
r_if
c_cond
(paren
(paren
id|fwrq-&gt;m
OG
l_int|1000
)paren
op_logical_or
(paren
id|fwrq-&gt;e
OG
l_int|0
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_else
(brace
r_int
id|channel
op_assign
id|fwrq-&gt;m
suffix:semicolon
r_if
c_cond
(paren
id|atmel_validate_channel
c_func
(paren
id|priv
comma
id|channel
)paren
op_eq
l_int|0
)paren
(brace
id|priv-&gt;channel
op_assign
id|channel
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|atmel_get_freq
r_static
r_int
id|atmel_get_freq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_freq
op_star
id|fwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|fwrq-&gt;m
op_assign
id|priv-&gt;channel
suffix:semicolon
id|fwrq-&gt;e
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_scan
r_static
r_int
id|atmel_set_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Note : you may have realised that, as this is a SET operation,&n;&t; * this is privileged and therefore a normal user can&squot;t&n;&t; * perform scanning.&n;&t; * This is not an error, while the device perform scanning,&n;&t; * traffic doesn&squot;t flow, so it&squot;s a perfect DoS...&n;&t; * Jean II */
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_DOWN
op_logical_or
id|priv-&gt;station_state
op_eq
id|STATION_STATE_NO_CARD
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
multiline_comment|/* Timeout old surveys. */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|priv-&gt;last_survey
)paren
OG
(paren
l_int|20
op_star
id|HZ
)paren
)paren
id|priv-&gt;site_survey_state
op_assign
id|SITE_SURVEY_IDLE
suffix:semicolon
id|priv-&gt;last_survey
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Initiate a scan command */
r_if
c_cond
(paren
id|priv-&gt;site_survey_state
op_eq
id|SITE_SURVEY_IN_PROGRESS
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;site_survey_state
op_assign
id|SITE_SURVEY_IN_PROGRESS
suffix:semicolon
id|atmel_clear_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|del_timer_sync
c_func
(paren
op_amp
id|priv-&gt;management_timer
)paren
suffix:semicolon
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
id|atmel_set_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_get_scan
r_static
r_int
id|atmel_get_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|current_ev
op_assign
id|extra
suffix:semicolon
r_struct
id|iw_event
id|iwe
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;site_survey_state
op_ne
id|SITE_SURVEY_COMPLETED
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;BSS_list_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
id|iwe.cmd
op_assign
id|SIOCGIWAP
suffix:semicolon
id|iwe.u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|memcpy
c_func
(paren
id|iwe.u.ap_addr.sa_data
comma
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSSID
comma
l_int|6
)paren
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_ADDR_LEN
)paren
suffix:semicolon
id|iwe.u.data.length
op_assign
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|SSIDsize
suffix:semicolon
r_if
c_cond
(paren
id|iwe.u.data.length
OG
l_int|32
)paren
id|iwe.u.data.length
op_assign
l_int|32
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWESSID
suffix:semicolon
id|iwe.u.data.flags
op_assign
l_int|1
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|SSID
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWMODE
suffix:semicolon
id|iwe.u.mode
op_assign
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSStype
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_UINT_LEN
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWFREQ
suffix:semicolon
id|iwe.u.freq.m
op_assign
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|channel
suffix:semicolon
id|iwe.u.freq.e
op_assign
l_int|0
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_FREQ_LEN
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWENCODE
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|UsingWEP
)paren
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_ENABLED
op_or
id|IW_ENCODE_NOKEY
suffix:semicolon
r_else
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
id|iwe.u.data.length
op_assign
l_int|0
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Length of data */
id|dwrq-&gt;length
op_assign
(paren
id|current_ev
op_minus
id|extra
)paren
suffix:semicolon
id|dwrq-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* todo */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_get_range
r_static
r_int
id|atmel_get_range
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|iw_range
op_star
id|range
op_assign
(paren
r_struct
id|iw_range
op_star
)paren
id|extra
suffix:semicolon
r_int
id|k
comma
id|i
comma
id|j
suffix:semicolon
id|dwrq-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|iw_range
)paren
suffix:semicolon
id|memset
c_func
(paren
id|range
comma
l_int|0
comma
r_sizeof
(paren
id|range
)paren
)paren
suffix:semicolon
id|range-&gt;min_nwid
op_assign
l_int|0x0000
suffix:semicolon
id|range-&gt;max_nwid
op_assign
l_int|0x0000
suffix:semicolon
id|range-&gt;num_channels
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
r_sizeof
(paren
id|channel_table
)paren
op_div
r_sizeof
(paren
id|channel_table
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|priv-&gt;reg_domain
op_eq
id|channel_table
(braket
id|j
)braket
dot
id|reg_domain
)paren
(brace
id|range-&gt;num_channels
op_assign
id|channel_table
(braket
id|j
)braket
dot
id|max
op_minus
id|channel_table
(braket
id|j
)braket
dot
id|min
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|range-&gt;num_channels
op_ne
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|i
op_assign
id|channel_table
(braket
id|j
)braket
dot
id|min
suffix:semicolon
id|i
op_le
id|channel_table
(braket
id|j
)braket
dot
id|max
suffix:semicolon
id|i
op_increment
)paren
(brace
id|range-&gt;freq
(braket
id|k
)braket
dot
id|i
op_assign
id|i
suffix:semicolon
multiline_comment|/* List index */
id|range-&gt;freq
(braket
id|k
)braket
dot
id|m
op_assign
id|frequency_list
(braket
id|i
op_minus
l_int|1
)braket
op_star
l_int|100000
suffix:semicolon
id|range-&gt;freq
(braket
id|k
op_increment
)braket
dot
id|e
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Values in table in MHz -&gt; * 10^5 * 10 */
)brace
id|range-&gt;num_frequency
op_assign
id|k
suffix:semicolon
)brace
id|range-&gt;max_qual.qual
op_assign
l_int|100
suffix:semicolon
id|range-&gt;max_qual.level
op_assign
l_int|100
suffix:semicolon
id|range-&gt;max_qual.noise
op_assign
l_int|0
suffix:semicolon
id|range-&gt;sensitivity
op_assign
l_int|0
suffix:semicolon
id|range-&gt;bitrate
(braket
l_int|0
)braket
op_assign
l_float|1e6
suffix:semicolon
id|range-&gt;bitrate
(braket
l_int|1
)braket
op_assign
l_float|2e6
suffix:semicolon
id|range-&gt;bitrate
(braket
l_int|2
)braket
op_assign
l_float|5.5e6
suffix:semicolon
id|range-&gt;bitrate
(braket
l_int|3
)braket
op_assign
l_float|11e6
suffix:semicolon
id|range-&gt;num_bitrates
op_assign
l_int|4
suffix:semicolon
id|range-&gt;min_rts
op_assign
l_int|0
suffix:semicolon
id|range-&gt;max_rts
op_assign
l_int|2347
suffix:semicolon
id|range-&gt;min_frag
op_assign
l_int|256
suffix:semicolon
id|range-&gt;max_frag
op_assign
l_int|2346
suffix:semicolon
id|range-&gt;encoding_size
(braket
l_int|0
)braket
op_assign
l_int|5
suffix:semicolon
id|range-&gt;encoding_size
(braket
l_int|1
)braket
op_assign
l_int|13
suffix:semicolon
id|range-&gt;num_encoding_sizes
op_assign
l_int|2
suffix:semicolon
id|range-&gt;max_encoding_tokens
op_assign
l_int|4
suffix:semicolon
id|range-&gt;pmp_flags
op_assign
id|IW_POWER_ON
suffix:semicolon
id|range-&gt;pmt_flags
op_assign
id|IW_POWER_ON
suffix:semicolon
id|range-&gt;pm_capa
op_assign
l_int|0
suffix:semicolon
id|range-&gt;we_version_source
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range-&gt;we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range-&gt;retry_capa
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range-&gt;retry_flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range-&gt;r_time_flags
op_assign
l_int|0
suffix:semicolon
id|range-&gt;min_retry
op_assign
l_int|1
suffix:semicolon
id|range-&gt;max_retry
op_assign
l_int|65535
suffix:semicolon
id|range-&gt;avg_qual.qual
op_assign
l_int|50
suffix:semicolon
id|range-&gt;avg_qual.level
op_assign
l_int|50
suffix:semicolon
id|range-&gt;avg_qual.noise
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|atmel_set_wap
r_static
r_int
id|atmel_set_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_const
id|u8
id|bcast
(braket
)braket
op_assign
(brace
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
)brace
suffix:semicolon
r_if
c_cond
(paren
id|awrq-&gt;sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|bcast
comma
id|awrq-&gt;sa_data
comma
l_int|6
)paren
op_eq
l_int|0
)paren
(brace
id|atmel_clear_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|del_timer_sync
c_func
(paren
op_amp
id|priv-&gt;management_timer
)paren
suffix:semicolon
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
id|atmel_set_gcr
c_func
(paren
id|dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;BSS_list_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSSID
comma
id|awrq-&gt;sa_data
comma
l_int|6
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
op_logical_and
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|UsingWEP
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|priv-&gt;wep.wep_is_on
op_logical_and
op_logical_neg
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|UsingWEP
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
id|atmel_join_bss
c_func
(paren
id|priv
comma
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|atmel_config_commit
r_static
r_int
id|atmel_config_commit
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
multiline_comment|/* NULL */
r_void
op_star
id|zwrq
comma
multiline_comment|/* NULL */
r_char
op_star
id|extra
)paren
multiline_comment|/* NULL */
(brace
id|reset_atmel_card
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|atmel_handler
r_static
r_const
id|iw_handler
id|atmel_handler
(braket
)braket
op_assign
(brace
(paren
id|iw_handler
)paren
id|atmel_config_commit
comma
multiline_comment|/* SIOCSIWCOMMIT */
(paren
id|iw_handler
)paren
id|atmel_get_name
comma
multiline_comment|/* SIOCGIWNAME */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWNWID */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWNWID */
(paren
id|iw_handler
)paren
id|atmel_set_freq
comma
multiline_comment|/* SIOCSIWFREQ */
(paren
id|iw_handler
)paren
id|atmel_get_freq
comma
multiline_comment|/* SIOCGIWFREQ */
(paren
id|iw_handler
)paren
id|atmel_set_mode
comma
multiline_comment|/* SIOCSIWMODE */
(paren
id|iw_handler
)paren
id|atmel_get_mode
comma
multiline_comment|/* SIOCGIWMODE */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWSENS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWSENS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWRANGE */
(paren
id|iw_handler
)paren
id|atmel_get_range
comma
multiline_comment|/* SIOCGIWRANGE */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWPRIV */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWPRIV */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWSTATS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWSTATS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWSPY */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWSPY */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
id|atmel_set_wap
comma
multiline_comment|/* SIOCSIWAP */
(paren
id|iw_handler
)paren
id|atmel_get_wap
comma
multiline_comment|/* SIOCGIWAP */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWAPLIST */
(paren
id|iw_handler
)paren
id|atmel_set_scan
comma
multiline_comment|/* SIOCSIWSCAN */
(paren
id|iw_handler
)paren
id|atmel_get_scan
comma
multiline_comment|/* SIOCGIWSCAN */
(paren
id|iw_handler
)paren
id|atmel_set_essid
comma
multiline_comment|/* SIOCSIWESSID */
(paren
id|iw_handler
)paren
id|atmel_get_essid
comma
multiline_comment|/* SIOCGIWESSID */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWNICKN */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWNICKN */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
id|atmel_set_rate
comma
multiline_comment|/* SIOCSIWRATE */
(paren
id|iw_handler
)paren
id|atmel_get_rate
comma
multiline_comment|/* SIOCGIWRATE */
(paren
id|iw_handler
)paren
id|atmel_set_rts
comma
multiline_comment|/* SIOCSIWRTS */
(paren
id|iw_handler
)paren
id|atmel_get_rts
comma
multiline_comment|/* SIOCGIWRTS */
(paren
id|iw_handler
)paren
id|atmel_set_frag
comma
multiline_comment|/* SIOCSIWFRAG */
(paren
id|iw_handler
)paren
id|atmel_get_frag
comma
multiline_comment|/* SIOCGIWFRAG */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWTXPOW */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWTXPOW */
(paren
id|iw_handler
)paren
id|atmel_set_retry
comma
multiline_comment|/* SIOCSIWRETRY */
(paren
id|iw_handler
)paren
id|atmel_get_retry
comma
multiline_comment|/* SIOCGIWRETRY */
(paren
id|iw_handler
)paren
id|atmel_set_encode
comma
multiline_comment|/* SIOCSIWENCODE */
(paren
id|iw_handler
)paren
id|atmel_get_encode
comma
multiline_comment|/* SIOCGIWENCODE */
(paren
id|iw_handler
)paren
id|atmel_set_power
comma
multiline_comment|/* SIOCSIWPOWER */
(paren
id|iw_handler
)paren
id|atmel_get_power
comma
multiline_comment|/* SIOCGIWPOWER */
)brace
suffix:semicolon
DECL|variable|atmel_private_handler
r_static
r_const
id|iw_handler
id|atmel_private_handler
(braket
)braket
op_assign
(brace
l_int|NULL
comma
multiline_comment|/* SIOCIWFIRSTPRIV */
)brace
suffix:semicolon
DECL|struct|atmel_priv_ioctl
r_typedef
r_struct
id|atmel_priv_ioctl
(brace
DECL|member|id
r_char
id|id
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|data
r_int
r_char
op_star
id|data
suffix:semicolon
DECL|member|len
r_int
r_int
id|len
suffix:semicolon
DECL|typedef|atmel_priv_ioctl
)brace
id|atmel_priv_ioctl
suffix:semicolon
DECL|macro|ATMELFWL
mdefine_line|#define ATMELFWL SIOCIWFIRSTPRIV
DECL|macro|ATMELIDIFC
mdefine_line|#define ATMELIDIFC ATMELFWL + 1
DECL|macro|ATMELMAGIC
mdefine_line|#define ATMELMAGIC 0x51807 
DECL|variable|atmel_private_args
r_static
r_const
r_struct
id|iw_priv_args
id|atmel_private_args
(braket
)braket
op_assign
(brace
multiline_comment|/*{ cmd,         set_args,                            get_args, name } */
(brace
id|ATMELFWL
comma
id|IW_PRIV_TYPE_BYTE
op_or
id|IW_PRIV_SIZE_FIXED
op_or
r_sizeof
(paren
id|atmel_priv_ioctl
)paren
comma
id|IW_PRIV_TYPE_NONE
comma
l_string|&quot;atmelfwl&quot;
)brace
comma
(brace
id|ATMELIDIFC
comma
id|IW_PRIV_TYPE_NONE
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;atmelidifc&quot;
)brace
comma
)brace
suffix:semicolon
DECL|variable|atmel_handler_def
r_static
r_const
r_struct
id|iw_handler_def
id|atmel_handler_def
op_assign
(brace
dot
id|num_standard
op_assign
r_sizeof
(paren
id|atmel_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|num_private
op_assign
r_sizeof
(paren
id|atmel_private_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|num_private_args
op_assign
r_sizeof
(paren
id|atmel_private_args
)paren
op_div
r_sizeof
(paren
r_struct
id|iw_priv_args
)paren
comma
dot
id|standard
op_assign
(paren
id|iw_handler
op_star
)paren
id|atmel_handler
comma
dot
r_private
op_assign
(paren
id|iw_handler
op_star
)paren
id|atmel_private_handler
comma
dot
id|private_args
op_assign
(paren
r_struct
id|iw_priv_args
op_star
)paren
id|atmel_private_args
)brace
suffix:semicolon
DECL|function|atmel_ioctl
r_static
r_int
id|atmel_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|atmel_priv_ioctl
id|com
suffix:semicolon
r_struct
id|iwreq
op_star
id|wrq
op_assign
(paren
r_struct
id|iwreq
op_star
)paren
id|rq
suffix:semicolon
r_int
r_char
op_star
id|new_firmware
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIWPRIV
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
multiline_comment|/* Set the number of ioctl available */
id|wrq-&gt;u.data.length
op_assign
r_sizeof
(paren
id|atmel_private_args
)paren
op_div
r_sizeof
(paren
id|atmel_private_args
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* Copy structure to the user buffer */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
(paren
id|u_char
op_star
)paren
id|atmel_private_args
comma
r_sizeof
(paren
id|atmel_private_args
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATMELIDIFC
suffix:colon
id|wrq-&gt;u.param.value
op_assign
id|ATMELMAGIC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATMELFWL
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|com
comma
id|rq-&gt;ifr_data
comma
r_sizeof
(paren
id|com
)paren
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|new_firmware
op_assign
id|kmalloc
c_func
(paren
id|com.len
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|new_firmware
comma
id|com.data
comma
id|com.len
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;firmware
)paren
id|kfree
c_func
(paren
id|priv-&gt;firmware
)paren
suffix:semicolon
id|priv-&gt;firmware
op_assign
id|new_firmware
suffix:semicolon
id|priv-&gt;firmware_length
op_assign
id|com.len
suffix:semicolon
id|strncpy
c_func
(paren
id|priv-&gt;firmware_id
comma
id|com.id
comma
l_int|31
)paren
suffix:semicolon
id|priv-&gt;firmware_id
(braket
l_int|31
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|struct|auth_body
r_struct
id|auth_body
(brace
DECL|member|alg
id|u16
id|alg
suffix:semicolon
DECL|member|trans_seq
id|u16
id|trans_seq
suffix:semicolon
DECL|member|status
id|u16
id|status
suffix:semicolon
DECL|member|el_id
id|u8
id|el_id
suffix:semicolon
DECL|member|chall_text_len
id|u8
id|chall_text_len
suffix:semicolon
DECL|member|chall_text
id|u8
id|chall_text
(braket
l_int|253
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|atmel_enter_state
r_static
r_void
id|atmel_enter_state
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|new_state
)paren
(brace
r_int
id|old_state
op_assign
id|priv-&gt;station_state
suffix:semicolon
r_if
c_cond
(paren
id|new_state
op_eq
id|old_state
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|new_state
op_eq
id|STATION_STATE_READY
)paren
id|netif_start_queue
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_state
op_eq
id|STATION_STATE_READY
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|priv-&gt;dev
)paren
suffix:semicolon
id|priv-&gt;last_beacon_timestamp
op_assign
l_int|0
suffix:semicolon
)brace
id|priv-&gt;station_state
op_assign
id|new_state
suffix:semicolon
)brace
DECL|function|atmel_scan
r_static
r_void
id|atmel_scan
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|specific_ssid
)paren
(brace
r_struct
(brace
id|u8
id|BSSID
(braket
l_int|6
)braket
suffix:semicolon
id|u8
id|SSID
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
id|u8
id|scan_type
suffix:semicolon
id|u8
id|channel
suffix:semicolon
id|u16
id|BSS_type
suffix:semicolon
id|u16
id|min_channel_time
suffix:semicolon
id|u16
id|max_channel_time
suffix:semicolon
id|u8
id|options
suffix:semicolon
id|u8
id|SSID_size
suffix:semicolon
)brace
id|cmd
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_SCANNING
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cmd.BSSID
comma
l_int|0xff
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;fast_scan
)paren
(brace
id|cmd.SSID_size
op_assign
id|priv-&gt;SSID_size
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd.SSID
comma
id|priv-&gt;SSID
comma
id|priv-&gt;SSID_size
)paren
suffix:semicolon
id|cmd.min_channel_time
op_assign
id|cpu_to_le16
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cmd.max_channel_time
op_assign
id|cpu_to_le16
c_func
(paren
l_int|50
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;BSS_list_entries
op_assign
l_int|0
suffix:semicolon
id|cmd.SSID_size
op_assign
l_int|0
suffix:semicolon
id|cmd.min_channel_time
op_assign
id|cpu_to_le16
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cmd.max_channel_time
op_assign
id|cpu_to_le16
c_func
(paren
l_int|120
)paren
suffix:semicolon
)brace
id|cmd.options
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|specific_ssid
)paren
id|cmd.options
op_or_assign
id|SCAN_OPTIONS_SITE_SURVEY
suffix:semicolon
id|cmd.channel
op_assign
(paren
id|priv-&gt;channel
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|cmd.scan_type
op_assign
id|SCAN_TYPE_ACTIVE
suffix:semicolon
id|cmd.BSS_type
op_assign
id|cpu_to_le16
c_func
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_ADHOC
ques
c_cond
id|BSS_TYPE_AD_HOC
suffix:colon
id|BSS_TYPE_INFRASTRUCTURE
)paren
suffix:semicolon
id|atmel_send_command
c_func
(paren
id|priv
comma
id|CMD_Scan
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|join
r_static
r_void
id|join
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|type
)paren
(brace
r_struct
(brace
id|u8
id|BSSID
(braket
l_int|6
)braket
suffix:semicolon
id|u8
id|SSID
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
id|u8
id|BSS_type
suffix:semicolon
multiline_comment|/* this is a short in a scan command - wierd */
id|u8
id|channel
suffix:semicolon
id|u16
id|timeout
suffix:semicolon
id|u8
id|SSID_size
suffix:semicolon
id|u8
id|reserved
suffix:semicolon
)brace
id|cmd
suffix:semicolon
id|cmd.SSID_size
op_assign
id|priv-&gt;SSID_size
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd.SSID
comma
id|priv-&gt;SSID
comma
id|priv-&gt;SSID_size
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd.BSSID
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|cmd.channel
op_assign
(paren
id|priv-&gt;channel
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|cmd.BSS_type
op_assign
id|type
suffix:semicolon
id|cmd.timeout
op_assign
id|cpu_to_le16
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|atmel_send_command
c_func
(paren
id|priv
comma
id|CMD_Join
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|start
r_static
r_void
id|start
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|type
)paren
(brace
r_struct
(brace
id|u8
id|BSSID
(braket
l_int|6
)braket
suffix:semicolon
id|u8
id|SSID
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
id|u8
id|BSS_type
suffix:semicolon
id|u8
id|channel
suffix:semicolon
id|u8
id|SSID_size
suffix:semicolon
id|u8
id|reserved
(braket
l_int|3
)braket
suffix:semicolon
)brace
id|cmd
suffix:semicolon
id|cmd.SSID_size
op_assign
id|priv-&gt;SSID_size
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd.SSID
comma
id|priv-&gt;SSID
comma
id|priv-&gt;SSID_size
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd.BSSID
comma
id|priv-&gt;BSSID
comma
l_int|6
)paren
suffix:semicolon
id|cmd.BSS_type
op_assign
id|type
suffix:semicolon
id|cmd.channel
op_assign
(paren
id|priv-&gt;channel
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|atmel_send_command
c_func
(paren
id|priv
comma
id|CMD_Start
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
DECL|function|handle_beacon_probe
r_static
r_void
id|handle_beacon_probe
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|capability
comma
id|u8
id|channel
)paren
(brace
r_int
id|rejoin
op_assign
l_int|0
suffix:semicolon
r_int
r_new
op_assign
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_ShortPreamble
ques
c_cond
id|SHORT_PREAMBLE
suffix:colon
id|LONG_PREAMBLE
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;preamble
op_ne
r_new
)paren
(brace
id|priv-&gt;preamble
op_assign
r_new
suffix:semicolon
id|rejoin
op_assign
l_int|1
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Local_Mib_Type
comma
id|LOCAL_MIB_PREAMBLE_TYPE
comma
r_new
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;channel
op_ne
id|channel
)paren
(brace
id|priv-&gt;channel
op_assign
id|channel
suffix:semicolon
id|rejoin
op_assign
l_int|1
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Phy_Mib_Type
comma
id|PHY_MIB_CHANNEL_POS
comma
id|channel
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rejoin
)paren
(brace
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_JOINNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
)paren
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_INFRASTRUCTURE
)paren
suffix:semicolon
r_else
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_AD_HOC
)paren
suffix:semicolon
)brace
)brace
DECL|function|send_authentication_request
r_static
r_void
id|send_authentication_request
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
op_star
id|challenge
comma
r_int
id|challenge_len
)paren
(brace
r_struct
id|ieee802_11_hdr
id|header
suffix:semicolon
r_struct
id|auth_body
id|auth
suffix:semicolon
id|header.frame_ctl
op_assign
id|cpu_to_le16
c_func
(paren
id|IEEE802_11_FTYPE_MGMT
op_or
id|IEEE802_11_STYPE_AUTH
)paren
suffix:semicolon
id|header.duration_id
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0x8000
)paren
suffix:semicolon
id|header.seq_ctl
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr1
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr2
comma
id|priv-&gt;dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr3
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep.wep_is_on
)paren
(brace
id|auth.alg
op_assign
id|C80211_MGMT_AAN_SHAREDKEY
suffix:semicolon
multiline_comment|/* no WEP for authentication frames with TrSeqNo 1 */
r_if
c_cond
(paren
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_ne
l_int|1
)paren
id|header.frame_ctl
op_or_assign
id|cpu_to_le16
c_func
(paren
id|IEEE802_11_FCTL_WEP
)paren
suffix:semicolon
)brace
r_else
(brace
id|auth.alg
op_assign
id|C80211_MGMT_AAN_OPENSYSTEM
suffix:semicolon
)brace
id|auth.status
op_assign
l_int|0
suffix:semicolon
id|auth.trans_seq
op_assign
id|cpu_to_le16
c_func
(paren
id|priv-&gt;CurrentAuthentTransactionSeqNum
)paren
suffix:semicolon
id|priv-&gt;ExpectedAuthentTransactionSeqNum
op_assign
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_plus
l_int|1
suffix:semicolon
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|challenge_len
op_ne
l_int|0
)paren
(brace
id|auth.el_id
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* challenge_text */
id|auth.chall_text_len
op_assign
id|challenge_len
suffix:semicolon
id|memcpy
c_func
(paren
id|auth.chall_text
comma
id|challenge
comma
id|challenge_len
)paren
suffix:semicolon
id|atmel_transmit_management_frame
c_func
(paren
id|priv
comma
op_amp
id|header
comma
(paren
id|u8
op_star
)paren
op_amp
id|auth
comma
l_int|8
op_plus
id|challenge_len
)paren
suffix:semicolon
)brace
r_else
(brace
id|atmel_transmit_management_frame
c_func
(paren
id|priv
comma
op_amp
id|header
comma
(paren
id|u8
op_star
)paren
op_amp
id|auth
comma
l_int|6
)paren
suffix:semicolon
)brace
)brace
DECL|function|send_association_request
r_static
r_void
id|send_association_request
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|is_reassoc
)paren
(brace
id|u8
op_star
id|ssid_el_p
suffix:semicolon
r_int
id|bodysize
suffix:semicolon
r_struct
id|ieee802_11_hdr
id|header
suffix:semicolon
r_struct
id|ass_req_format
(brace
id|u16
id|capability
suffix:semicolon
id|u16
id|listen_interval
suffix:semicolon
id|u8
id|ap
(braket
l_int|6
)braket
suffix:semicolon
multiline_comment|/* nothing after here directly accessible */
id|u8
id|ssid_el_id
suffix:semicolon
id|u8
id|ssid_len
suffix:semicolon
id|u8
id|ssid
(braket
id|MAX_SSID_LENGTH
)braket
suffix:semicolon
id|u8
id|sup_rates_el_id
suffix:semicolon
id|u8
id|sup_rates_len
suffix:semicolon
id|u8
id|rates
(braket
l_int|4
)braket
suffix:semicolon
)brace
id|body
suffix:semicolon
id|header.frame_ctl
op_assign
id|cpu_to_le16
c_func
(paren
id|IEEE802_11_FTYPE_MGMT
op_or
(paren
id|is_reassoc
ques
c_cond
id|IEEE802_11_STYPE_REASSOC_REQ
suffix:colon
id|IEEE802_11_STYPE_ASSOC_REQ
)paren
)paren
suffix:semicolon
id|header.duration_id
op_assign
id|cpu_to_le16
c_func
(paren
l_int|0x8000
)paren
suffix:semicolon
id|header.seq_ctl
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr1
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr2
comma
id|priv-&gt;dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|header.addr3
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|body.capability
op_assign
id|cpu_to_le16
c_func
(paren
id|C80211_MGMT_CAPABILITY_ESS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep.wep_is_on
)paren
id|body.capability
op_or_assign
id|cpu_to_le16
c_func
(paren
id|C80211_MGMT_CAPABILITY_Privacy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;preamble
op_eq
id|SHORT_PREAMBLE
)paren
id|body.capability
op_or_assign
id|cpu_to_le16
c_func
(paren
id|C80211_MGMT_CAPABILITY_ShortPreamble
)paren
suffix:semicolon
id|body.listen_interval
op_assign
id|cpu_to_le16
c_func
(paren
id|priv-&gt;listen_interval
op_star
id|priv-&gt;beacon_period
)paren
suffix:semicolon
multiline_comment|/* current AP address - only in reassoc frame */
r_if
c_cond
(paren
id|is_reassoc
)paren
(brace
id|memcpy
c_func
(paren
id|body.ap
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|ssid_el_p
op_assign
(paren
id|u8
op_star
)paren
op_amp
id|body.ssid_el_id
suffix:semicolon
id|bodysize
op_assign
l_int|18
op_plus
id|priv-&gt;SSID_size
suffix:semicolon
)brace
r_else
(brace
id|ssid_el_p
op_assign
(paren
id|u8
op_star
)paren
op_amp
id|body.ap
(braket
l_int|0
)braket
suffix:semicolon
id|bodysize
op_assign
l_int|12
op_plus
id|priv-&gt;SSID_size
suffix:semicolon
)brace
id|ssid_el_p
(braket
l_int|0
)braket
op_assign
id|C80211_MGMT_ElementID_SSID
suffix:semicolon
id|ssid_el_p
(braket
l_int|1
)braket
op_assign
id|priv-&gt;SSID_size
suffix:semicolon
id|memcpy
c_func
(paren
id|ssid_el_p
op_plus
l_int|2
comma
id|priv-&gt;SSID
comma
id|priv-&gt;SSID_size
)paren
suffix:semicolon
id|ssid_el_p
(braket
l_int|2
op_plus
id|priv-&gt;SSID_size
)braket
op_assign
id|C80211_MGMT_ElementID_SupportedRates
suffix:semicolon
id|ssid_el_p
(braket
l_int|3
op_plus
id|priv-&gt;SSID_size
)braket
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* len of suported rates */
id|memcpy
c_func
(paren
id|ssid_el_p
op_plus
l_int|4
op_plus
id|priv-&gt;SSID_size
comma
id|atmel_basic_rates
comma
l_int|4
)paren
suffix:semicolon
id|atmel_transmit_management_frame
c_func
(paren
id|priv
comma
op_amp
id|header
comma
(paren
r_void
op_star
)paren
op_amp
id|body
comma
id|bodysize
)paren
suffix:semicolon
)brace
DECL|function|is_frame_from_current_bss
r_static
r_int
id|is_frame_from_current_bss
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
)paren
(brace
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|header-&gt;frame_ctl
)paren
op_amp
id|IEEE802_11_FCTL_FROMDS
)paren
r_return
id|memcmp
c_func
(paren
id|header-&gt;addr3
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
op_eq
l_int|0
suffix:semicolon
r_else
r_return
id|memcmp
c_func
(paren
id|header-&gt;addr2
comma
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
op_eq
l_int|0
suffix:semicolon
)brace
DECL|function|retrieve_bss
r_static
r_int
id|retrieve_bss
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|max_rssi
op_assign
op_minus
l_int|128
suffix:semicolon
r_int
id|max_index
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;BSS_list_entries
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;connect_to_any_BSS
)paren
(brace
multiline_comment|/* Select a BSS with the max-RSSI but of the same type and of the same WEP mode&n;&t;&t;   and that it is not marked as &squot;bad&squot; (i.e. we had previously failed to connect to&n;&t;&t;   this BSS with the settings that we currently use) */
id|priv-&gt;current_BSS
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;BSS_list_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSStype
op_logical_and
(paren
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
op_logical_and
op_logical_neg
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|UsingWEP
)paren
op_logical_or
(paren
id|priv-&gt;wep.wep_is_on
op_logical_and
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|UsingWEP
)paren
)paren
op_logical_and
op_logical_neg
(paren
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|channel
op_amp
l_int|0x80
)paren
)paren
(brace
id|max_rssi
op_assign
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|RSSI
suffix:semicolon
id|priv-&gt;current_BSS
op_assign
id|max_index
op_assign
id|i
suffix:semicolon
)brace
)brace
r_return
id|max_index
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;BSS_list_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;SSID_size
op_eq
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|SSIDsize
op_logical_and
id|memcmp
c_func
(paren
id|priv-&gt;SSID
comma
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|SSID
comma
id|priv-&gt;SSID_size
)paren
op_eq
l_int|0
op_logical_and
id|priv-&gt;operating_mode
op_eq
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSStype
op_logical_and
id|atmel_validate_channel
c_func
(paren
id|priv
comma
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|channel
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|RSSI
op_ge
id|max_rssi
)paren
(brace
id|max_rssi
op_assign
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|RSSI
suffix:semicolon
id|max_index
op_assign
id|i
suffix:semicolon
)brace
)brace
)brace
r_return
id|max_index
suffix:semicolon
)brace
DECL|function|store_bss_info
r_static
r_void
id|store_bss_info
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u16
id|capability
comma
id|u16
id|beacon_period
comma
id|u8
id|channel
comma
id|u8
id|rssi
comma
id|u8
id|ssid_len
comma
id|u8
op_star
id|ssid
comma
r_int
id|is_beacon
)paren
(brace
id|u8
op_star
id|bss
op_assign
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_ESS
ques
c_cond
id|header-&gt;addr2
suffix:colon
id|header-&gt;addr3
suffix:semicolon
r_int
id|i
comma
id|index
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
op_minus
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;BSS_list_entries
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|bss
comma
id|priv-&gt;BSSinfo
(braket
id|i
)braket
dot
id|BSSID
comma
l_int|6
)paren
op_eq
l_int|0
)paren
id|index
op_assign
id|i
suffix:semicolon
multiline_comment|/* If we process a probe and an entry from this BSS exists &n;&t;   we will update the BSS entry with the info from this BSS.&n;&t;   If we process a beacon we will only update RSSI */
r_if
c_cond
(paren
id|index
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;BSS_list_entries
op_eq
id|MAX_BSS_ENTRIES
)paren
r_return
suffix:semicolon
id|index
op_assign
id|priv-&gt;BSS_list_entries
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|BSSID
comma
id|bss
comma
l_int|6
)paren
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|RSSI
op_assign
id|rssi
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|rssi
OG
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|RSSI
)paren
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|RSSI
op_assign
id|rssi
suffix:semicolon
r_if
c_cond
(paren
id|is_beacon
)paren
r_return
suffix:semicolon
)brace
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|channel
op_assign
id|channel
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|beacon_period
op_assign
id|beacon_period
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|UsingWEP
op_assign
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_Privacy
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|SSID
comma
id|ssid
comma
id|ssid_len
)paren
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|SSIDsize
op_assign
id|ssid_len
suffix:semicolon
r_if
c_cond
(paren
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_IBSS
)paren
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|BSStype
op_assign
id|IW_MODE_ADHOC
suffix:semicolon
r_else
r_if
c_cond
(paren
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_ESS
)paren
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|BSStype
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
id|index
)braket
dot
id|preamble
op_assign
id|capability
op_amp
id|C80211_MGMT_CAPABILITY_ShortPreamble
ques
c_cond
id|SHORT_PREAMBLE
suffix:colon
id|LONG_PREAMBLE
suffix:semicolon
)brace
DECL|function|authenticate
r_static
r_void
id|authenticate
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|frame_len
)paren
(brace
r_struct
id|auth_body
op_star
id|auth
op_assign
(paren
r_struct
id|auth_body
op_star
)paren
id|priv-&gt;rx_buf
suffix:semicolon
id|u16
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|auth-&gt;status
)paren
suffix:semicolon
id|u16
id|trans_seq_no
op_assign
id|le16_to_cpu
c_func
(paren
id|auth-&gt;trans_seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|C80211_MGMT_SC_Success
op_logical_and
op_logical_neg
id|priv-&gt;wep.wep_is_on
)paren
(brace
multiline_comment|/* no WEP */
r_if
c_cond
(paren
id|priv-&gt;station_was_associated
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_REASSOCIATING
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_ASSOCIATING
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
op_eq
id|C80211_MGMT_SC_Success
op_logical_and
id|priv-&gt;wep.wep_is_on
)paren
(brace
multiline_comment|/* WEP */
r_if
c_cond
(paren
id|trans_seq_no
op_ne
id|priv-&gt;ExpectedAuthentTransactionSeqNum
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|trans_seq_no
op_eq
l_int|0x0002
op_logical_and
id|auth-&gt;el_id
op_eq
id|C80211_MGMT_ElementID_ChallengeText
)paren
(brace
id|send_authentication_request
c_func
(paren
id|priv
comma
id|auth-&gt;chall_text
comma
id|auth-&gt;chall_text_len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|trans_seq_no
op_eq
l_int|0x0004
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;station_was_associated
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_REASSOCIATING
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_ASSOCIATING
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|status
op_eq
id|C80211_MGMT_SC_AuthAlgNotSupported
op_logical_and
id|priv-&gt;connect_to_any_BSS
)paren
(brace
r_int
id|bss_index
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
(paren
r_int
)paren
(paren
id|priv-&gt;current_BSS
)paren
)braket
dot
id|channel
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bss_index
op_assign
id|retrieve_bss
c_func
(paren
id|priv
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|atmel_join_bss
c_func
(paren
id|priv
comma
id|bss_index
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|priv-&gt;AuthenticationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|associate
r_static
r_void
id|associate
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|frame_len
comma
id|u16
id|subtype
)paren
(brace
r_struct
id|ass_resp_format
(brace
id|u16
id|capability
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|u16
id|ass_id
suffix:semicolon
id|u8
id|el_id
suffix:semicolon
id|u8
id|length
suffix:semicolon
id|u8
id|rates
(braket
l_int|4
)braket
suffix:semicolon
)brace
op_star
id|ass_resp
op_assign
(paren
r_struct
id|ass_resp_format
op_star
)paren
id|priv-&gt;rx_buf
suffix:semicolon
id|u16
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|ass_resp-&gt;status
)paren
suffix:semicolon
id|u16
id|ass_id
op_assign
id|le16_to_cpu
c_func
(paren
id|ass_resp-&gt;ass_id
)paren
suffix:semicolon
id|u16
id|rates_len
op_assign
id|ass_resp-&gt;length
OG
l_int|4
ques
c_cond
l_int|4
suffix:colon
id|ass_resp-&gt;length
suffix:semicolon
r_if
c_cond
(paren
id|frame_len
OL
l_int|8
op_plus
id|rates_len
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|C80211_MGMT_SC_Success
)paren
(brace
r_if
c_cond
(paren
id|subtype
op_eq
id|C80211_SUBTYPE_MGMT_ASS_RESPONSE
)paren
id|priv-&gt;AssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
r_else
id|priv-&gt;ReAssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_STATION_ID_POS
comma
id|ass_id
op_amp
l_int|0x3fff
)paren
suffix:semicolon
id|atmel_set_mib
c_func
(paren
id|priv
comma
id|Phy_Mib_Type
comma
id|PHY_MIB_RATE_SET_POS
comma
id|ass_resp-&gt;rates
comma
id|rates_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;power_mode
op_eq
l_int|0
)paren
(brace
id|priv-&gt;listen_interval
op_assign
l_int|1
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_PS_MODE_POS
comma
id|ACTIVE_MODE
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_LISTEN_INTERVAL_POS
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;listen_interval
op_assign
l_int|2
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_PS_MODE_POS
comma
id|PS_MODE
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_LISTEN_INTERVAL_POS
comma
l_int|2
)paren
suffix:semicolon
)brace
id|priv-&gt;station_is_associated
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;station_was_associated
op_assign
l_int|1
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_READY
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|subtype
op_eq
id|C80211_SUBTYPE_MGMT_ASS_RESPONSE
op_logical_and
id|status
op_ne
id|C80211_MGMT_SC_AssDeniedBSSRate
op_logical_and
id|status
op_ne
id|C80211_MGMT_SC_SupportCapabilities
op_logical_and
id|priv-&gt;AssociationRequestRetryCnt
OL
id|MAX_ASSOCIATION_RETRIES
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|priv-&gt;AssociationRequestRetryCnt
op_increment
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|subtype
op_eq
id|C80211_SUBTYPE_MGMT_REASS_RESPONSE
op_logical_and
id|status
op_ne
id|C80211_MGMT_SC_AssDeniedBSSRate
op_logical_and
id|status
op_ne
id|C80211_MGMT_SC_SupportCapabilities
op_logical_and
id|priv-&gt;AssociationRequestRetryCnt
OL
id|MAX_ASSOCIATION_RETRIES
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|priv-&gt;ReAssociationRequestRetryCnt
op_increment
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;connect_to_any_BSS
)paren
(brace
r_int
id|bss_index
suffix:semicolon
id|priv-&gt;BSSinfo
(braket
(paren
r_int
)paren
(paren
id|priv-&gt;current_BSS
)paren
)braket
dot
id|channel
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bss_index
op_assign
id|retrieve_bss
c_func
(paren
id|priv
)paren
)paren
op_ne
op_minus
l_int|1
)paren
id|atmel_join_bss
c_func
(paren
id|priv
comma
id|bss_index
)paren
suffix:semicolon
)brace
)brace
DECL|function|atmel_join_bss
r_void
id|atmel_join_bss
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|bss_index
)paren
(brace
r_struct
id|bss_info
op_star
id|bss
op_assign
op_amp
id|priv-&gt;BSSinfo
(braket
id|bss_index
)braket
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;CurrentBSSID
comma
id|bss-&gt;BSSID
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;SSID
comma
id|bss-&gt;SSID
comma
id|priv-&gt;SSID_size
op_assign
id|bss-&gt;SSIDsize
)paren
suffix:semicolon
multiline_comment|/* When switching to AdHoc turn OFF Power Save if needed */
r_if
c_cond
(paren
id|bss-&gt;BSStype
op_eq
id|IW_MODE_ADHOC
op_logical_and
id|priv-&gt;operating_mode
op_ne
id|IW_MODE_ADHOC
op_logical_and
id|priv-&gt;power_mode
)paren
(brace
id|priv-&gt;power_mode
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;listen_interval
op_assign
l_int|1
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_PS_MODE_POS
comma
id|ACTIVE_MODE
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_LISTEN_INTERVAL_POS
comma
l_int|1
)paren
suffix:semicolon
)brace
id|priv-&gt;operating_mode
op_assign
id|bss-&gt;BSStype
suffix:semicolon
id|priv-&gt;channel
op_assign
id|bss-&gt;channel
op_amp
l_int|0x7f
suffix:semicolon
id|priv-&gt;beacon_period
op_assign
id|bss-&gt;beacon_period
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;preamble
op_ne
id|bss-&gt;preamble
)paren
(brace
id|priv-&gt;preamble
op_assign
id|bss-&gt;preamble
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Local_Mib_Type
comma
id|LOCAL_MIB_PREAMBLE_TYPE
comma
id|bss-&gt;preamble
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep.wep_is_on
op_logical_and
id|bss-&gt;UsingWEP
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;wep.wep_is_on
op_logical_and
op_logical_neg
id|bss-&gt;UsingWEP
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_JOINNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
)paren
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_INFRASTRUCTURE
)paren
suffix:semicolon
r_else
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_AD_HOC
)paren
suffix:semicolon
)brace
DECL|function|restart_search
r_static
r_void
id|restart_search
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
id|bss_index
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;connect_to_any_BSS
)paren
(brace
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;BSSinfo
(braket
(paren
r_int
)paren
(paren
id|priv-&gt;current_BSS
)paren
)braket
dot
id|channel
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bss_index
op_assign
id|retrieve_bss
c_func
(paren
id|priv
)paren
)paren
op_ne
op_minus
l_int|1
)paren
id|atmel_join_bss
c_func
(paren
id|priv
comma
id|bss_index
)paren
suffix:semicolon
r_else
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|smooth_rssi
r_static
r_void
id|smooth_rssi
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|rssi
)paren
(brace
id|u8
id|old
op_assign
id|priv-&gt;wstats.qual.level
suffix:semicolon
multiline_comment|/* 502-rmfd-revd gives max signal level as 42, by experiment.&n;&t;   This is going to break for other hardware variants. */
id|rssi
op_assign
id|rssi
op_star
l_int|100
op_div
l_int|42
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rssi
op_plus
id|old
)paren
op_mod
l_int|2
)paren
(brace
id|priv-&gt;wstats.qual.level
op_assign
(paren
(paren
id|rssi
op_plus
id|old
)paren
op_div
l_int|2
)paren
op_plus
l_int|1
suffix:semicolon
)brace
r_else
id|priv-&gt;wstats.qual.level
op_assign
(paren
(paren
id|rssi
op_plus
id|old
)paren
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|atmel_smooth_qual
r_static
r_void
id|atmel_smooth_qual
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
r_int
id|time_diff
op_assign
(paren
id|jiffies
op_minus
id|priv-&gt;last_qual
)paren
op_div
id|HZ
suffix:semicolon
r_while
c_loop
(paren
id|time_diff
op_decrement
)paren
(brace
id|priv-&gt;last_qual
op_add_assign
id|HZ
suffix:semicolon
id|priv-&gt;wstats.qual.qual
op_assign
id|priv-&gt;wstats.qual.qual
op_div
l_int|2
suffix:semicolon
id|priv-&gt;wstats.qual.qual
op_add_assign
id|priv-&gt;beacons_this_sec
op_star
id|priv-&gt;beacon_period
op_star
(paren
id|priv-&gt;wstats.qual.level
op_plus
l_int|100
)paren
op_div
l_int|4000
suffix:semicolon
id|priv-&gt;beacons_this_sec
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* deals with incoming managment frames. */
DECL|function|atmel_management_frame
r_static
r_void
id|atmel_management_frame
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_struct
id|ieee802_11_hdr
op_star
id|header
comma
id|u16
id|frame_len
comma
id|u8
id|rssi
)paren
(brace
id|u16
id|subtype
suffix:semicolon
r_switch
c_cond
(paren
id|subtype
op_assign
id|le16_to_cpu
c_func
(paren
id|header-&gt;frame_ctl
)paren
op_amp
id|IEEE802_11_FCTL_STYPE
)paren
(brace
r_case
id|C80211_SUBTYPE_MGMT_BEACON
suffix:colon
r_case
id|C80211_SUBTYPE_MGMT_ProbeResponse
suffix:colon
multiline_comment|/* beacon frame has multiple variable-length fields -&n;&t;&t;   never let an engineer loose with a data structure design. */
(brace
r_struct
id|beacon_format
(brace
id|u64
id|timestamp
suffix:semicolon
id|u16
id|interval
suffix:semicolon
id|u16
id|capability
suffix:semicolon
id|u8
id|ssid_el_id
suffix:semicolon
id|u8
id|ssid_length
suffix:semicolon
multiline_comment|/* ssid here */
id|u8
id|rates_el_id
suffix:semicolon
id|u8
id|rates_length
suffix:semicolon
multiline_comment|/* rates here */
id|u8
id|ds_el_id
suffix:semicolon
id|u8
id|ds_length
suffix:semicolon
multiline_comment|/* ds here */
)brace
op_star
id|beacon
op_assign
(paren
r_struct
id|beacon_format
op_star
)paren
id|priv-&gt;rx_buf
suffix:semicolon
id|u8
id|channel
comma
id|rates_length
comma
id|ssid_length
suffix:semicolon
id|u64
id|timestamp
op_assign
id|le64_to_cpu
c_func
(paren
id|beacon-&gt;timestamp
)paren
suffix:semicolon
id|u16
id|beacon_interval
op_assign
id|le16_to_cpu
c_func
(paren
id|beacon-&gt;interval
)paren
suffix:semicolon
id|u16
id|capability
op_assign
id|le16_to_cpu
c_func
(paren
id|beacon-&gt;capability
)paren
suffix:semicolon
id|u8
op_star
id|beaconp
op_assign
id|priv-&gt;rx_buf
suffix:semicolon
id|ssid_length
op_assign
id|beacon-&gt;ssid_length
suffix:semicolon
multiline_comment|/* this blows chunks. */
r_if
c_cond
(paren
id|frame_len
OL
l_int|14
op_logical_or
id|frame_len
OL
id|ssid_length
op_plus
l_int|15
)paren
r_return
suffix:semicolon
id|rates_length
op_assign
id|beaconp
(braket
id|beacon-&gt;ssid_length
op_plus
l_int|15
)braket
suffix:semicolon
r_if
c_cond
(paren
id|frame_len
OL
id|ssid_length
op_plus
id|rates_length
op_plus
l_int|18
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|ssid_length
OG
id|MAX_SSID_LENGTH
)paren
r_return
suffix:semicolon
id|channel
op_assign
id|beaconp
(braket
id|ssid_length
op_plus
id|rates_length
op_plus
l_int|18
)braket
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_READY
)paren
(brace
id|smooth_rssi
c_func
(paren
id|priv
comma
id|rssi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_frame_from_current_bss
c_func
(paren
id|priv
comma
id|header
)paren
)paren
(brace
id|priv-&gt;beacons_this_sec
op_increment
suffix:semicolon
id|atmel_smooth_qual
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;last_beacon_timestamp
)paren
(brace
multiline_comment|/* Note truncate this to 32 bits - kernel can&squot;t divide a long long */
id|u32
id|beacon_delay
op_assign
id|timestamp
op_minus
id|priv-&gt;last_beacon_timestamp
suffix:semicolon
r_int
id|beacons
op_assign
id|beacon_delay
op_div
(paren
id|beacon_interval
op_star
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|beacons
OG
l_int|1
)paren
id|priv-&gt;wstats.miss.beacon
op_add_assign
id|beacons
op_minus
l_int|1
suffix:semicolon
)brace
id|priv-&gt;last_beacon_timestamp
op_assign
id|timestamp
suffix:semicolon
id|handle_beacon_probe
c_func
(paren
id|priv
comma
id|capability
comma
id|channel
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_SCANNING
)paren
id|store_bss_info
c_func
(paren
id|priv
comma
id|header
comma
id|capability
comma
id|beacon_interval
comma
id|channel
comma
id|rssi
comma
id|ssid_length
comma
op_amp
id|beacon-&gt;rates_el_id
comma
id|subtype
op_eq
id|C80211_SUBTYPE_MGMT_BEACON
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C80211_SUBTYPE_MGMT_Authentication
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_AUTHENTICATING
)paren
id|authenticate
c_func
(paren
id|priv
comma
id|frame_len
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|C80211_SUBTYPE_MGMT_ASS_RESPONSE
suffix:colon
r_case
id|C80211_SUBTYPE_MGMT_REASS_RESPONSE
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_ASSOCIATING
op_logical_or
id|priv-&gt;station_state
op_eq
id|STATION_STATE_REASSOCIATING
)paren
id|associate
c_func
(paren
id|priv
comma
id|frame_len
comma
id|subtype
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|C80211_SUBTYPE_MGMT_DISASSOSIATION
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;station_is_associated
op_logical_and
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
op_logical_and
id|is_frame_from_current_bss
c_func
(paren
id|priv
comma
id|header
)paren
)paren
(brace
id|priv-&gt;station_was_associated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_JOINNING
)paren
suffix:semicolon
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_INFRASTRUCTURE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|C80211_SUBTYPE_MGMT_Deauthentication
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_INFRA
op_logical_and
id|is_frame_from_current_bss
c_func
(paren
id|priv
comma
id|header
)paren
)paren
(brace
id|priv-&gt;station_was_associated
op_assign
l_int|0
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_JOINNING
)paren
suffix:semicolon
id|join
c_func
(paren
id|priv
comma
id|BSS_TYPE_INFRASTRUCTURE
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* run when timer expires */
DECL|function|atmel_management_timer
r_static
r_void
id|atmel_management_timer
c_func
(paren
id|u_long
id|a
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|a
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
op_assign
(paren
r_struct
id|atmel_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Check if the card has been yanked. */
r_if
c_cond
(paren
id|priv-&gt;card
op_logical_and
id|priv-&gt;present_callback
op_logical_and
op_logical_neg
(paren
op_star
id|priv-&gt;present_callback
)paren
(paren
id|priv-&gt;card
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_NO_CARD
)paren
r_return
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;station_state
)paren
(brace
r_case
id|STATION_STATE_AUTHENTICATING
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;AuthenticationRequestRetryCnt
op_ge
id|MAX_AUTHENTICATION_RETRIES
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;AuthenticationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|restart_search
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;AuthenticationRequestRetryCnt
op_increment
suffix:semicolon
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_assign
l_int|0x0001
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|send_authentication_request
c_func
(paren
id|priv
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|STATION_STATE_ASSOCIATING
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;AssociationRequestRetryCnt
op_eq
id|MAX_ASSOCIATION_RETRIES
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;AssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|restart_search
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;AssociationRequestRetryCnt
op_increment
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|STATION_STATE_REASSOCIATING
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;ReAssociationRequestRetryCnt
op_eq
id|MAX_ASSOCIATION_RETRIES
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_MGMT_ERROR
)paren
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;ReAssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|restart_search
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;ReAssociationRequestRetryCnt
op_increment
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|send_association_request
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|atmel_command_irq
r_static
r_void
id|atmel_command_irq
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
id|u8
id|status
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_STATUS_OFFSET
)paren
)paren
suffix:semicolon
id|u8
id|command
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_COMMAND_OFFSET
)paren
)paren
suffix:semicolon
r_int
id|fast_scan
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|CMD_STATUS_IDLE
op_logical_or
id|status
op_eq
id|CMD_STATUS_IN_PROGRESS
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|command
)paren
(brace
r_case
id|CMD_Start
suffix:colon
r_if
c_cond
(paren
id|status
op_eq
id|CMD_STATUS_COMPLETE
)paren
(brace
id|priv-&gt;station_was_associated
op_assign
id|priv-&gt;station_is_associated
suffix:semicolon
id|atmel_get_mib
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_CUR_BSSID_POS
comma
(paren
id|u8
op_star
)paren
id|priv-&gt;CurrentBSSID
comma
l_int|6
)paren
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_READY
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_Scan
suffix:colon
id|fast_scan
op_assign
id|priv-&gt;fast_scan
suffix:semicolon
id|priv-&gt;fast_scan
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|CMD_STATUS_COMPLETE
)paren
(brace
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|bss_index
op_assign
id|retrieve_bss
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bss_index
op_ne
op_minus
l_int|1
)paren
(brace
id|atmel_join_bss
c_func
(paren
id|priv
comma
id|bss_index
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_ADHOC
op_logical_and
id|priv-&gt;SSID_size
op_ne
l_int|0
)paren
(brace
id|start
c_func
(paren
id|priv
comma
id|BSS_TYPE_AD_HOC
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;fast_scan
op_assign
op_logical_neg
id|fast_scan
suffix:semicolon
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|CMD_SiteSurvey
suffix:colon
id|priv-&gt;fast_scan
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|CMD_STATUS_COMPLETE
)paren
r_return
suffix:semicolon
id|priv-&gt;site_survey_state
op_assign
id|SITE_SURVEY_COMPLETED
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_is_associated
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_READY
)paren
suffix:semicolon
)brace
r_else
(brace
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_Join
suffix:colon
r_if
c_cond
(paren
id|status
op_eq
id|CMD_STATUS_COMPLETE
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;operating_mode
op_eq
id|IW_MODE_ADHOC
)paren
(brace
id|priv-&gt;station_was_associated
op_assign
id|priv-&gt;station_is_associated
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_READY
)paren
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;AuthenticationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_AUTHENTICATING
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|priv-&gt;management_timer
comma
id|jiffies
op_plus
id|MGMT_JIFFIES
)paren
suffix:semicolon
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_assign
l_int|0x0001
suffix:semicolon
id|send_authentication_request
c_func
(paren
id|priv
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_FORCED_JOINNING
)paren
(brace
id|atmel_enter_state
c_func
(paren
id|priv
comma
id|STATION_STATE_FORCED_JOIN_FAILURE
)paren
suffix:semicolon
)brace
r_else
(brace
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|atmel_wakeup_firmware
r_static
r_int
id|atmel_wakeup_firmware
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_struct
id|host_info_struct
op_star
id|iface
op_assign
op_amp
id|priv-&gt;host_info
suffix:semicolon
id|u16
id|mr1
comma
id|mr3
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;card_type
op_eq
id|CARD_TYPE_SPI_FLASH
)paren
id|atmel_set_gcr
c_func
(paren
id|priv-&gt;dev
comma
id|GCR_REMAP
)paren
suffix:semicolon
multiline_comment|/* wake up on-board processor */
id|atmel_clear_gcr
c_func
(paren
id|priv-&gt;dev
comma
l_int|0x0040
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|BSR
comma
id|BSS_SRAM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;card_type
op_eq
id|CARD_TYPE_SPI_FLASH
)paren
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* and wait for it */
r_for
c_loop
(paren
id|i
op_assign
id|LOOP_RETRY_LIMIT
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|mr1
op_assign
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR1
)paren
suffix:semicolon
id|mr3
op_assign
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr3
op_amp
id|MAC_BOOT_COMPLETE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mr1
op_amp
id|MAC_BOOT_COMPLETE
op_logical_and
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC failed to boot.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|priv-&gt;host_info_base
op_assign
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR2
)paren
)paren
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: card missing.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;station_state
op_assign
id|STATION_STATE_NO_CARD
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* now check for completion of MAC initialization through  &n;&t;   the FunCtrl field of the IFACE, poll MR1 to detect completion of&t;  &n;&t;   MAC initialization, check completion status, set interrupt mask,  &n;&t;   enables interrupts and calls Tx and Rx initialization functions */
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_FUNC_CTRL_OFFSET
)paren
comma
id|FUNC_CTRL_INIT_COMPLETE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|LOOP_RETRY_LIMIT
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|mr1
op_assign
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR1
)paren
suffix:semicolon
id|mr3
op_assign
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mr3
op_amp
id|MAC_INIT_COMPLETE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mr1
op_amp
id|MAC_INIT_COMPLETE
op_logical_and
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC failed to initialise.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check for MAC_INIT_OK only on the register that the MAC_INIT_OK was set */
r_if
c_cond
(paren
(paren
id|mr3
op_amp
id|MAC_INIT_COMPLETE
)paren
op_logical_and
op_logical_neg
(paren
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR3
)paren
op_amp
id|MAC_INIT_OK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC failed MR3 self-test.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mr1
op_amp
id|MAC_INIT_COMPLETE
)paren
op_logical_and
op_logical_neg
(paren
id|atmel_read16
c_func
(paren
id|priv-&gt;dev
comma
id|MR1
)paren
op_amp
id|MAC_INIT_OK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC failed MR1 self-test.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
(paren
r_int
r_char
op_star
)paren
id|iface
comma
id|priv-&gt;host_info_base
comma
r_sizeof
(paren
op_star
id|iface
)paren
)paren
suffix:semicolon
id|iface-&gt;tx_buff_pos
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;tx_buff_pos
)paren
suffix:semicolon
id|iface-&gt;tx_buff_size
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;tx_buff_size
)paren
suffix:semicolon
id|iface-&gt;tx_desc_pos
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;tx_desc_pos
)paren
suffix:semicolon
id|iface-&gt;tx_desc_count
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;tx_desc_count
)paren
suffix:semicolon
id|iface-&gt;rx_buff_pos
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;rx_buff_pos
)paren
suffix:semicolon
id|iface-&gt;rx_buff_size
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;rx_buff_size
)paren
suffix:semicolon
id|iface-&gt;rx_desc_pos
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;rx_desc_pos
)paren
suffix:semicolon
id|iface-&gt;rx_desc_count
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;rx_desc_count
)paren
suffix:semicolon
id|iface-&gt;build_version
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;build_version
)paren
suffix:semicolon
id|iface-&gt;command_pos
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;command_pos
)paren
suffix:semicolon
id|iface-&gt;major_version
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;major_version
)paren
suffix:semicolon
id|iface-&gt;minor_version
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;minor_version
)paren
suffix:semicolon
id|iface-&gt;func_ctrl
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;func_ctrl
)paren
suffix:semicolon
id|iface-&gt;mac_status
op_assign
id|le16_to_cpu
c_func
(paren
id|iface-&gt;mac_status
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* determine type of memory and MAC address */
DECL|function|probe_atmel_card
r_static
r_int
id|probe_atmel_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* reset pccard */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atmel_read16
c_func
(paren
id|dev
comma
id|MR2
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* No stored firmware so load a small stub which just &n;&t;&t;   tells us the MAC address */
r_int
id|i
suffix:semicolon
id|priv-&gt;card_type
op_assign
id|CARD_TYPE_EEPROM
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|BSR
comma
id|BSS_IRAM
)paren
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|dev
comma
l_int|0
comma
id|mac_reader
comma
r_sizeof
(paren
id|mac_reader
)paren
)paren
suffix:semicolon
id|atmel_set_gcr
c_func
(paren
id|dev
comma
id|GCR_REMAP
)paren
suffix:semicolon
id|atmel_clear_gcr
c_func
(paren
id|priv-&gt;dev
comma
l_int|0x0040
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|BSR
comma
id|BSS_SRAM
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|LOOP_RETRY_LIMIT
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|atmel_read16
c_func
(paren
id|dev
comma
id|MR3
)paren
op_amp
id|MAC_BOOT_COMPLETE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: MAC failed to boot MAC address reader.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|atmel_copy_to_host
c_func
(paren
id|dev
comma
id|dev-&gt;dev_addr
comma
id|atmel_read16
c_func
(paren
id|dev
comma
id|MR2
)paren
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* got address, now squash it again until the network&n;&t;&t;&t;   interface is opened */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|atmel_read16
c_func
(paren
id|dev
comma
id|MR4
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Mac address easy in this case. */
id|priv-&gt;card_type
op_assign
id|CARD_TYPE_PARALLEL_FLASH
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|BSR
comma
l_int|1
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|dev
comma
id|dev-&gt;dev_addr
comma
l_int|0xc000
comma
l_int|6
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|BSR
comma
l_int|0x200
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Standard firmware in flash, boot it up and ask&n;&t;&t;   for the Mac Address */
id|priv-&gt;card_type
op_assign
id|CARD_TYPE_SPI_FLASH
suffix:semicolon
r_if
c_cond
(paren
id|atmel_wakeup_firmware
c_func
(paren
id|priv
)paren
)paren
(brace
id|atmel_get_mib
c_func
(paren
id|priv
comma
id|Mac_Address_Mib_Type
comma
l_int|0
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* got address, now squash it again until the network&n;&t;&t;&t;   interface is opened */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rc
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0xFF
)paren
(brace
id|u8
id|default_mac
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x04
comma
l_int|0x25
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: *** Invalid MAC address. UPGRADE Firmware ****&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|default_mac
comma
l_int|6
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MAC address %x:%x:%x:%x:%x:%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|reset_atmel_card
r_int
id|reset_atmel_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
multiline_comment|/* do everything necessary to wake up the hardware, including&n;&t;   waiting for the lightning strike and throwing the knife switch....&n;&n;&t;   set all the Mib values which matter in the card to match &n;&t;   their settings in the atmel_private structure. Some of these&n;&t;   can be altered on the fly, but many (WEP, infrastucture or ad-hoc)&n;&t;   can only be changed by tearing down the world and coming back through&n;&t;   here.&n;&n;&t;   This routine is also responsible for initialising some &n;&t;   hardware-specific fields in the atmel_private structure, &n;&t;   including a copy of the firmware&squot;s hostinfo stucture&n;&t;   which is the route into the rest of the firmare datastructures. */
r_int
id|channel
suffix:semicolon
r_struct
id|atmel_private
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u8
id|configuration
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;station_state
op_eq
id|STATION_STATE_NO_CARD
op_logical_or
id|priv-&gt;station_state
op_eq
id|STATION_STATE_DOWN
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* reset pccard */
r_if
c_cond
(paren
id|priv-&gt;bus_type
op_eq
id|BUS_TYPE_PCCARD
)paren
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|GCR
comma
l_int|0x0060
)paren
suffix:semicolon
multiline_comment|/* stop card , disable interrupts */
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|GCR
comma
l_int|0x0040
)paren
suffix:semicolon
multiline_comment|/* any scheduled timer is no longer needed and might screw things up.. */
id|del_timer_sync
c_func
(paren
op_amp
id|priv-&gt;management_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;new_SSID_size
)paren
(brace
id|memcpy
c_func
(paren
id|priv-&gt;SSID
comma
id|priv-&gt;new_SSID
comma
id|priv-&gt;new_SSID_size
)paren
suffix:semicolon
id|priv-&gt;SSID_size
op_assign
id|priv-&gt;new_SSID_size
suffix:semicolon
id|priv-&gt;new_SSID_size
op_assign
l_int|0
suffix:semicolon
)brace
id|priv-&gt;BSS_list_entries
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;AuthenticationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;AssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;ReAssociationRequestRetryCnt
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;CurrentAuthentTransactionSeqNum
op_assign
l_int|0x0001
suffix:semicolon
id|priv-&gt;ExpectedAuthentTransactionSeqNum
op_assign
l_int|0x0002
suffix:semicolon
id|priv-&gt;station_state
op_assign
id|STATION_STATE_INITIALIZING
suffix:semicolon
id|priv-&gt;site_survey_state
op_assign
id|SITE_SURVEY_IDLE
suffix:semicolon
id|priv-&gt;station_is_associated
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;card_type
op_eq
id|CARD_TYPE_EEPROM
)paren
(brace
multiline_comment|/* copy in firmware if needed */
r_const
r_struct
id|firmware
op_star
id|fw_entry
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|fw
suffix:semicolon
r_int
id|len
op_assign
id|priv-&gt;firmware_length
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fw
op_assign
id|priv-&gt;firmware
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|priv-&gt;firmware_id
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: card type is unknown: assuming at76c502 firmware is OK.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: if not, use the firmware= module parameter.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|priv-&gt;firmware_id
comma
l_string|&quot;atmel_at76c502.bin&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_firmware
c_func
(paren
op_amp
id|fw_entry
comma
id|priv-&gt;firmware_id
comma
id|priv-&gt;sys_dev
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: firmware %s is missing, cannot start.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;firmware_id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|fw
op_assign
id|fw_entry-&gt;data
suffix:semicolon
id|len
op_assign
id|fw_entry-&gt;size
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_le
l_int|0x6000
)paren
(brace
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|BSR
comma
id|BSS_IRAM
)paren
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
l_int|0
comma
id|fw
comma
id|len
)paren
suffix:semicolon
id|atmel_set_gcr
c_func
(paren
id|priv-&gt;dev
comma
id|GCR_REMAP
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Remap */
id|atmel_set_gcr
c_func
(paren
id|priv-&gt;dev
comma
id|GCR_REMAP
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|BSR
comma
id|BSS_IRAM
)paren
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
l_int|0
comma
id|fw
comma
l_int|0x6000
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|BSR
comma
l_int|0x2ff
)paren
suffix:semicolon
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
l_int|0x8000
comma
op_amp
id|fw
(braket
l_int|0x6000
)braket
comma
id|len
op_minus
l_int|0x6000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fw_entry
)paren
id|release_firmware
c_func
(paren
id|fw_entry
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atmel_wakeup_firmware
c_func
(paren
id|priv
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* unmask all irq sources */
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_INT_MASK_OFFSET
)paren
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* int Tx system and enable Tx */
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_FLAGS_OFFSET
comma
l_int|0
)paren
comma
l_int|0
)paren
suffix:semicolon
id|atmel_wmem32
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_NEXT_OFFSET
comma
l_int|0
)paren
comma
l_int|0x80000000L
)paren
suffix:semicolon
id|atmel_wmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_POS_OFFSET
comma
l_int|0
)paren
comma
l_int|0
)paren
suffix:semicolon
id|atmel_wmem16
c_func
(paren
id|priv
comma
id|atmel_tx
c_func
(paren
id|priv
comma
id|TX_DESC_SIZE_OFFSET
comma
l_int|0
)paren
comma
l_int|0
)paren
suffix:semicolon
id|priv-&gt;tx_desc_free
op_assign
id|priv-&gt;host_info.tx_desc_count
suffix:semicolon
id|priv-&gt;tx_desc_head
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_desc_tail
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_desc_previous
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_free_mem
op_assign
id|priv-&gt;host_info.tx_buff_size
suffix:semicolon
id|priv-&gt;tx_buff_head
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_buff_tail
op_assign
l_int|0
suffix:semicolon
id|configuration
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_FUNC_CTRL_OFFSET
)paren
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_FUNC_CTRL_OFFSET
)paren
comma
id|configuration
op_or
id|FUNC_CTRL_TxENABLE
)paren
suffix:semicolon
multiline_comment|/* init Rx system and enable */
id|priv-&gt;rx_desc_head
op_assign
l_int|0
suffix:semicolon
id|configuration
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_FUNC_CTRL_OFFSET
)paren
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_FUNC_CTRL_OFFSET
)paren
comma
id|configuration
op_or
id|FUNC_CTRL_RxENABLE
)paren
suffix:semicolon
id|priv-&gt;reg_domain
op_assign
id|atmel_get_mib8
c_func
(paren
id|priv
comma
id|Phy_Mib_Type
comma
id|PHY_MIB_REG_DOMAIN_POS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_FCC
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_DOC
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_ETSI
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_SPAIN
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_FRANCE
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_MKK
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_MKK1
op_logical_and
id|priv-&gt;reg_domain
op_ne
id|REG_DOMAIN_ISRAEL
)paren
(brace
id|priv-&gt;reg_domain
op_assign
id|REG_DOMAIN_MKK1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: failed to get regulatory domain: assuming MKK1.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|channel
op_assign
id|atmel_validate_channel
c_func
(paren
id|priv
comma
id|priv-&gt;channel
)paren
)paren
)paren
id|priv-&gt;channel
op_assign
id|channel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;is3com
)paren
(brace
r_if
c_cond
(paren
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_EnableRadio
comma
l_int|NULL
comma
l_int|0
)paren
op_eq
id|CMD_STATUS_REJECTED_RADIO_OFF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: cannot turn the radio on. (Hey radio, you&squot;re beautiful!)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* set up enough MIB values to run. */
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Local_Mib_Type
comma
id|LOCAL_MIB_AUTO_TX_RATE_POS
comma
id|priv-&gt;auto_tx_rate
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Local_Mib_Type
comma
id|LOCAL_MIB_TX_PROMISCUOUS_POS
comma
id|PROM_MODE_OFF
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mib_Type
comma
id|MAC_MIB_RTS_THRESHOLD_POS
comma
id|priv-&gt;rts_threshold
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mib_Type
comma
id|MAC_MIB_FRAG_THRESHOLD_POS
comma
id|priv-&gt;frag_threshold
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mib_Type
comma
id|MAC_MIB_SHORT_RETRY_POS
comma
id|priv-&gt;short_retry
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mib_Type
comma
id|MAC_MIB_LONG_RETRY_POS
comma
id|priv-&gt;long_retry
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Local_Mib_Type
comma
id|LOCAL_MIB_PREAMBLE_TYPE
comma
id|priv-&gt;preamble
)paren
suffix:semicolon
id|atmel_set_mib
c_func
(paren
id|priv
comma
id|Mac_Address_Mib_Type
comma
id|MAC_ADDR_MIB_MAC_ADDR_POS
comma
id|priv-&gt;dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_PS_MODE_POS
comma
id|ACTIVE_MODE
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_LISTEN_INTERVAL_POS
comma
l_int|1
)paren
suffix:semicolon
id|atmel_set_mib16
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_BEACON_PER_POS
comma
id|priv-&gt;default_beacon_period
)paren
suffix:semicolon
id|atmel_set_mib
c_func
(paren
id|priv
comma
id|Phy_Mib_Type
comma
id|PHY_MIB_RATE_SET_POS
comma
id|atmel_basic_rates
comma
l_int|4
)paren
suffix:semicolon
id|atmel_set_mib8
c_func
(paren
id|priv
comma
id|Mac_Mgmt_Mib_Type
comma
id|MAC_MGMT_MIB_CUR_PRIVACY_POS
comma
id|priv-&gt;wep.wep_is_on
)paren
suffix:semicolon
id|atmel_set_mib
c_func
(paren
id|priv
comma
id|Mac_Wep_Mib_Type
comma
l_int|0
comma
(paren
id|u8
op_star
)paren
op_amp
id|priv-&gt;wep
comma
r_sizeof
(paren
id|priv-&gt;wep
)paren
)paren
suffix:semicolon
id|atmel_scan
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
id|atmel_set_gcr
c_func
(paren
id|priv-&gt;dev
comma
id|GCR_ENINT
)paren
suffix:semicolon
multiline_comment|/* enable interrupts */
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|reset_atmel_card
id|EXPORT_SYMBOL
c_func
(paren
id|reset_atmel_card
)paren
suffix:semicolon
DECL|function|atmel_send_command
r_static
r_void
id|atmel_send_command
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|command
comma
r_void
op_star
id|cmd
comma
r_int
id|cmd_size
)paren
(brace
r_if
c_cond
(paren
id|cmd
)paren
id|atmel_copy_to_card
c_func
(paren
id|priv-&gt;dev
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_PARAMETERS_OFFSET
)paren
comma
id|cmd
comma
id|cmd_size
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_COMMAND_OFFSET
)paren
comma
id|command
)paren
suffix:semicolon
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_STATUS_OFFSET
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|atmel_send_command_wait
r_static
r_int
id|atmel_send_command_wait
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
r_int
id|command
comma
r_void
op_star
id|cmd
comma
r_int
id|cmd_size
)paren
(brace
r_int
id|i
comma
id|status
suffix:semicolon
id|atmel_send_command
c_func
(paren
id|priv
comma
id|command
comma
id|cmd
comma
id|cmd_size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|LOOP_RETRY_LIMIT
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|status
op_assign
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_STATUS_OFFSET
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|CMD_STATUS_IDLE
op_logical_and
id|status
op_ne
id|CMD_STATUS_IN_PROGRESS
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ALERT
l_string|&quot;%s: command %d failed to complete.&bslash;n&quot;
comma
id|priv-&gt;dev-&gt;name
comma
id|command
)paren
suffix:semicolon
id|status
op_assign
id|CMD_STATUS_HOST_ERROR
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|command
op_ne
id|CMD_EnableRadio
)paren
id|status
op_assign
id|CMD_STATUS_COMPLETE
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
DECL|function|atmel_get_mib8
r_static
id|u8
id|atmel_get_mib8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
)paren
(brace
r_struct
id|get_set_mib
id|m
suffix:semicolon
id|m.type
op_assign
id|type
suffix:semicolon
id|m.size
op_assign
l_int|1
suffix:semicolon
id|m.index
op_assign
id|index
suffix:semicolon
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_Get_MIB_Vars
comma
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
r_return
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_PARAMETERS_OFFSET
op_plus
l_int|4
)paren
)paren
suffix:semicolon
)brace
DECL|function|atmel_set_mib8
r_static
r_void
id|atmel_set_mib8
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
id|data
)paren
(brace
r_struct
id|get_set_mib
id|m
suffix:semicolon
id|m.type
op_assign
id|type
suffix:semicolon
id|m.size
op_assign
l_int|1
suffix:semicolon
id|m.index
op_assign
id|index
suffix:semicolon
id|m.data
(braket
l_int|0
)braket
op_assign
id|data
suffix:semicolon
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_Set_MIB_Vars
comma
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
)brace
DECL|function|atmel_set_mib16
r_static
r_void
id|atmel_set_mib16
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u16
id|data
)paren
(brace
r_struct
id|get_set_mib
id|m
suffix:semicolon
id|m.type
op_assign
id|type
suffix:semicolon
id|m.size
op_assign
l_int|2
suffix:semicolon
id|m.index
op_assign
id|index
suffix:semicolon
id|m.data
(braket
l_int|0
)braket
op_assign
id|data
suffix:semicolon
id|m.data
(braket
l_int|1
)braket
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_Set_MIB_Vars
comma
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
)brace
DECL|function|atmel_set_mib
r_static
r_void
id|atmel_set_mib
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
op_star
id|data
comma
r_int
id|data_len
)paren
(brace
r_struct
id|get_set_mib
id|m
suffix:semicolon
id|m.type
op_assign
id|type
suffix:semicolon
id|m.size
op_assign
id|data_len
suffix:semicolon
id|m.index
op_assign
id|index
suffix:semicolon
id|memcpy
c_func
(paren
id|m.data
comma
id|data
comma
id|data_len
)paren
suffix:semicolon
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_Set_MIB_Vars
comma
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
)brace
DECL|function|atmel_get_mib
r_static
r_void
id|atmel_get_mib
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u8
id|type
comma
id|u8
id|index
comma
id|u8
op_star
id|data
comma
r_int
id|data_len
)paren
(brace
r_struct
id|get_set_mib
id|m
suffix:semicolon
id|m.type
op_assign
id|type
suffix:semicolon
id|m.size
op_assign
id|data_len
suffix:semicolon
id|m.index
op_assign
id|index
suffix:semicolon
id|atmel_send_command_wait
c_func
(paren
id|priv
comma
id|CMD_Get_MIB_Vars
comma
op_amp
id|m
comma
r_sizeof
(paren
id|m
)paren
)paren
suffix:semicolon
id|atmel_copy_to_host
c_func
(paren
id|priv-&gt;dev
comma
id|data
comma
id|atmel_co
c_func
(paren
id|priv
comma
id|CMD_BLOCK_PARAMETERS_OFFSET
op_plus
l_int|4
)paren
comma
id|data_len
)paren
suffix:semicolon
)brace
DECL|function|atmel_writeAR
r_static
r_void
id|atmel_writeAR
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
id|outw
c_func
(paren
id|data
comma
id|dev-&gt;base_addr
op_plus
id|AR
)paren
suffix:semicolon
multiline_comment|/* Address register appears to need some convincing..... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|data
op_ne
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|AR
)paren
op_logical_and
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
id|outw
c_func
(paren
id|data
comma
id|dev-&gt;base_addr
op_plus
id|AR
)paren
suffix:semicolon
)brace
DECL|function|atmel_copy_to_card
r_static
r_void
id|atmel_copy_to_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|dest
comma
r_int
r_char
op_star
id|src
comma
id|u16
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|atmel_writeAR
c_func
(paren
id|dev
comma
id|dest
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dest
op_mod
l_int|2
)paren
(brace
id|atmel_write8
c_func
(paren
id|dev
comma
id|DR
comma
op_star
id|src
)paren
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_sub_assign
l_int|2
)paren
(brace
id|u8
id|lb
op_assign
op_star
id|src
op_increment
suffix:semicolon
id|u8
id|hb
op_assign
op_star
id|src
op_increment
suffix:semicolon
id|atmel_write16
c_func
(paren
id|dev
comma
id|DR
comma
id|lb
op_or
(paren
id|hb
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
id|atmel_write8
c_func
(paren
id|dev
comma
id|DR
comma
op_star
id|src
)paren
suffix:semicolon
)brace
DECL|function|atmel_copy_to_host
r_static
r_void
id|atmel_copy_to_host
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_char
op_star
id|dest
comma
id|u16
id|src
comma
id|u16
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|atmel_writeAR
c_func
(paren
id|dev
comma
id|src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src
op_mod
l_int|2
)paren
(brace
op_star
id|dest
op_assign
id|atmel_read8
c_func
(paren
id|dev
comma
id|DR
)paren
suffix:semicolon
id|dest
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_sub_assign
l_int|2
)paren
(brace
id|u16
id|hw
op_assign
id|atmel_read16
c_func
(paren
id|dev
comma
id|DR
)paren
suffix:semicolon
op_star
id|dest
op_increment
op_assign
id|hw
suffix:semicolon
op_star
id|dest
op_increment
op_assign
id|hw
op_rshift
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
op_star
id|dest
op_assign
id|atmel_read8
c_func
(paren
id|dev
comma
id|DR
)paren
suffix:semicolon
)brace
DECL|function|atmel_set_gcr
r_static
r_void
id|atmel_set_gcr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|mask
)paren
(brace
id|outw
c_func
(paren
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|GCR
)paren
op_or
id|mask
comma
id|dev-&gt;base_addr
op_plus
id|GCR
)paren
suffix:semicolon
)brace
DECL|function|atmel_clear_gcr
r_static
r_void
id|atmel_clear_gcr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|mask
)paren
(brace
id|outw
c_func
(paren
id|inw
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|GCR
)paren
op_amp
op_complement
id|mask
comma
id|dev-&gt;base_addr
op_plus
id|GCR
)paren
suffix:semicolon
)brace
DECL|function|atmel_lock_mac
r_static
r_int
id|atmel_lock_mac
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
)paren
(brace
r_int
id|i
comma
id|j
op_assign
l_int|100
suffix:semicolon
id|retry
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
id|LOOP_RETRY_LIMIT
suffix:semicolon
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_HOST_OFFSET
)paren
)paren
op_logical_and
id|i
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* timed out */
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_MAC_OFFSET
)paren
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atmel_rmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_HOST_OFFSET
)paren
)paren
)paren
(brace
id|atmel_wmem8
c_func
(paren
id|priv
comma
id|atmel_hi
c_func
(paren
id|priv
comma
id|IFACE_LOCKOUT_MAC_OFFSET
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|j
op_decrement
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* timed out */
r_goto
id|retry
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|atmel_wmem32
r_static
r_void
id|atmel_wmem32
c_func
(paren
r_struct
id|atmel_private
op_star
id|priv
comma
id|u16
id|pos
comma
id|u32
id|data
)paren
(brace
id|atmel_writeAR
c_func
(paren
id|priv-&gt;dev
comma
id|pos
)paren
suffix:semicolon
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|DR
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* card is little-endian */
id|atmel_write16
c_func
(paren
id|priv-&gt;dev
comma
id|DR
comma
id|data
op_rshift
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/***************************************************************************/
multiline_comment|/* There follows the source form of the MAC address reading firmware       */
multiline_comment|/***************************************************************************/
macro_line|#if 0
multiline_comment|/* Copyright 2003 Matthew T. Russotto                                      */
multiline_comment|/* But derived from the Atmel 76C502 firmware written by Atmel and         */
multiline_comment|/* included in &quot;atmel wireless lan drivers&quot; package                        */
multiline_comment|/**&n;    This file is part of net.russotto.AtmelMACFW, hereto referred to&n;    as AtmelMACFW&n;&n;    AtmelMACFW is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License version 2&n;    as published by the Free Software Foundation.&n;&n;    AtmelMACFW is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with AtmelMACFW; if not, write to the Free Software&n;    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;&n;****************************************************************************/
multiline_comment|/* This firmware should work on the 76C502 RFMD, RFMD_D, and RFMD_E        */
multiline_comment|/* It will probably work on the 76C504 and 76C502 RFMD_3COM                */
multiline_comment|/* It only works on SPI EEPROM versions of the card.                       */
multiline_comment|/* This firmware initializes the SPI controller and clock, reads the MAC   */
multiline_comment|/* address from the EEPROM into SRAM, and puts the SRAM offset of the MAC  */
multiline_comment|/* address in MR2, and sets MR3 to 0x10 to indicate it is done             */
multiline_comment|/* It also puts a complete copy of the EEPROM in SRAM with the offset in   */
multiline_comment|/* MR4, for investigational purposes (maybe we can determine chip type     */
multiline_comment|/* from that?)                                                             */
dot
id|org
l_int|0
dot
id|set
id|MRBASE
comma
l_int|0x8000000
dot
id|set
id|CPSR_INITIAL
comma
l_int|0xD3
multiline_comment|/* IRQ/FIQ disabled, ARM mode, Supervisor state */
dot
id|set
id|CPSR_USER
comma
l_int|0xD1
multiline_comment|/* IRQ/FIQ disabled, ARM mode, USER state */
dot
id|set
id|SRAM_BASE
comma
l_int|0x02000000
dot
id|set
id|SP_BASE
comma
l_int|0x0F300000
dot
id|set
id|UNK_BASE
comma
l_int|0x0F000000
multiline_comment|/* Some internal device, but which one? */
dot
id|set
id|SPI_CGEN_BASE
comma
l_int|0x0E000000
multiline_comment|/* Some internal device, but which one? */
dot
id|set
id|UNK3_BASE
comma
l_int|0x02014000
multiline_comment|/* Some internal device, but which one? */
dot
id|set
id|STACK_BASE
comma
l_int|0x5600
dot
id|set
id|SP_SR
comma
l_int|0x10
dot
id|set
id|SP_TDRE
comma
l_int|2
multiline_comment|/* status register bit -- TDR empty */
dot
id|set
id|SP_RDRF
comma
l_int|1
multiline_comment|/* status register bit -- RDR full */
dot
id|set
id|SP_SWRST
comma
l_int|0x80
dot
id|set
id|SP_SPIEN
comma
l_int|0x1
dot
id|set
id|SP_CR
comma
l_int|0
multiline_comment|/* control register */
dot
id|set
id|SP_MR
comma
l_int|4
multiline_comment|/* mode register */
dot
id|set
id|SP_RDR
comma
l_int|0x08
multiline_comment|/* Read Data Register */
dot
id|set
id|SP_TDR
comma
l_int|0x0C
multiline_comment|/* Transmit Data Register */
dot
id|set
id|SP_CSR0
comma
l_int|0x30
multiline_comment|/* chip select registers */
dot
id|set
id|SP_CSR1
comma
l_int|0x34
dot
id|set
id|SP_CSR2
comma
l_int|0x38
dot
id|set
id|SP_CSR3
comma
l_int|0x3C
dot
id|set
id|NVRAM_CMD_RDSR
comma
l_int|5
multiline_comment|/* read status register */
dot
id|set
id|NVRAM_CMD_READ
comma
l_int|3
multiline_comment|/* read data */
dot
id|set
id|NVRAM_SR_RDY
comma
l_int|1
multiline_comment|/* RDY bit.  This bit is inverted */
dot
id|set
id|SPI_8CLOCKS
comma
l_int|0xFF
multiline_comment|/* Writing this to the TDR doesn&squot;t do anything to the&n;&t;&t;&t;&t;  serial output, since SO is normally high.  But it&n;&t;&t;&t;&t;  does cause 8 clock cycles and thus 8 bits to be&n;&t;&t;&t;&t;  clocked in to the chip.  See Atmel&squot;s SPI&n;&t;&t;&t;&t;  controller (e.g. AT91M55800) timing and 4K &n;&t;&t;&t;&t;  SPI EEPROM manuals */
dot
id|set
id|NVRAM_SCRATCH
comma
l_int|0x02000100
multiline_comment|/* arbitrary area for scratchpad memory */
dot
id|set
id|NVRAM_IMAGE
comma
l_int|0x02000200
dot
id|set
id|NVRAM_LENGTH
comma
l_int|0x0200
dot
id|set
id|MAC_ADDRESS_MIB
comma
id|SRAM_BASE
dot
id|set
id|MAC_ADDRESS_LENGTH
comma
l_int|6
dot
id|set
id|MAC_BOOT_FLAG
comma
l_int|0x10
dot
id|set
id|MR1
comma
l_int|0
dot
id|set
id|MR2
comma
l_int|4
dot
id|set
id|MR3
comma
l_int|8
dot
id|set
id|MR4
comma
l_int|0xC
id|RESET_VECTOR
suffix:colon
id|b
id|RESET_HANDLER
id|UNDEF_VECTOR
suffix:colon
id|b
id|HALT1
id|SWI_VECTOR
suffix:colon
id|b
id|HALT1
id|IABORT_VECTOR
suffix:colon
id|b
id|HALT1
id|DABORT_VECTOR
suffix:colon
id|RESERVED_VECTOR
suffix:colon
id|b
id|HALT1
id|IRQ_VECTOR
suffix:colon
id|b
id|HALT1
id|FIQ_VECTOR
suffix:colon
id|b
id|HALT1
id|HALT1
suffix:colon
id|b
id|HALT1
id|RESET_HANDLER
suffix:colon
id|mov
id|r0
comma
macro_line|#CPSR_INITIAL
id|msr
id|CPSR_c
comma
id|r0
multiline_comment|/* This is probably unnecessary */
multiline_comment|/* I&squot;m guessing this is initializing clock generator electronics for SPI */
id|ldr
id|r0
comma
op_assign
id|SPI_CGEN_BASE
id|mov
id|r1
comma
macro_line|#0
id|mov
id|r1
comma
id|r1
comma
id|lsl
macro_line|#3
id|orr
id|r1
comma
id|r1
comma
macro_line|#0
id|str
id|r1
comma
(braket
id|r0
)braket
id|ldr
id|r1
comma
(braket
id|r0
comma
macro_line|#28]
id|bic
id|r1
comma
id|r1
comma
macro_line|#16
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#28]
id|mov
id|r1
comma
macro_line|#1
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#8]
id|ldr
id|r0
comma
op_assign
id|MRBASE
id|mov
id|r1
comma
macro_line|#0
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR1]
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR2]
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR3]
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR4]
id|mov
id|sp
comma
macro_line|#STACK_BASE
id|bl
id|SP_INIT
id|mov
id|r0
comma
macro_line|#10
id|bl
id|DELAY9
id|bl
id|GET_MAC_ADDR
id|bl
id|GET_WHOLE_NVRAM
id|ldr
id|r0
comma
op_assign
id|MRBASE
id|ldr
id|r1
comma
op_assign
id|MAC_ADDRESS_MIB
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR2]
id|ldr
id|r1
comma
op_assign
id|NVRAM_IMAGE
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR4]
id|mov
id|r1
comma
macro_line|#MAC_BOOT_FLAG
id|strh
id|r1
comma
(braket
id|r0
comma
macro_line|#MR3]
id|HALT2
suffix:colon
id|b
id|HALT2
dot
id|func
id|Get_Whole_NVRAM
comma
id|GET_WHOLE_NVRAM
id|GET_WHOLE_NVRAM
suffix:colon
id|stmdb
id|sp
op_logical_neg
comma
(brace
id|lr
)brace
id|mov
id|r2
comma
macro_line|#0 /* 0th bytes of NVRAM */
id|mov
id|r3
comma
macro_line|#NVRAM_LENGTH
id|mov
id|r1
comma
macro_line|#0&t;&t;/* not used in routine */
id|ldr
id|r0
comma
op_assign
id|NVRAM_IMAGE
id|bl
id|NVRAM_XFER
id|ldmia
id|sp
op_logical_neg
comma
(brace
id|lr
)brace
id|bx
id|lr
dot
id|endfunc
dot
id|func
id|Get_MAC_Addr
comma
id|GET_MAC_ADDR
id|GET_MAC_ADDR
suffix:colon
id|stmdb
id|sp
op_logical_neg
comma
(brace
id|lr
)brace
id|mov
id|r2
comma
macro_line|#0x120&t;/* address of MAC Address within NVRAM */
id|mov
id|r3
comma
macro_line|#MAC_ADDRESS_LENGTH
id|mov
id|r1
comma
macro_line|#0&t;&t;/* not used in routine */
id|ldr
id|r0
comma
op_assign
id|MAC_ADDRESS_MIB
id|bl
id|NVRAM_XFER
id|ldmia
id|sp
op_logical_neg
comma
(brace
id|lr
)brace
id|bx
id|lr
dot
id|endfunc
dot
id|ltorg
dot
id|func
id|Delay9
comma
id|DELAY9
id|DELAY9
suffix:colon
id|adds
id|r0
comma
id|r0
comma
id|r0
comma
id|LSL
macro_line|#3   /* r0 = r0 * 9 */
id|DELAYLOOP
suffix:colon
id|beq
id|DELAY9_done
id|subs
id|r0
comma
id|r0
comma
macro_line|#1
id|b
id|DELAYLOOP
id|DELAY9_done
suffix:colon
id|bx
id|lr
dot
id|endfunc
dot
id|func
id|SP_Init
comma
id|SP_INIT
id|SP_INIT
suffix:colon
id|mov
id|r1
comma
macro_line|#SP_SWRST
id|ldr
id|r0
comma
op_assign
id|SP_BASE
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CR] /* reset the SPI */
id|mov
id|r1
comma
macro_line|#0
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CR] /* release SPI from reset state */
id|mov
id|r1
comma
macro_line|#SP_SPIEN
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_MR] /* set the SPI to MASTER mode*/
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CR] /* enable the SPI */
multiline_comment|/*  My guess would be this turns on the SPI clock */
id|ldr
id|r3
comma
op_assign
id|SPI_CGEN_BASE
id|ldr
id|r1
comma
(braket
id|r3
comma
macro_line|#28]
id|orr
id|r1
comma
id|r1
comma
macro_line|#0x2000
id|str
id|r1
comma
(braket
id|r3
comma
macro_line|#28]
id|ldr
id|r1
comma
op_assign
l_int|0x2000c01
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CSR0]
id|ldr
id|r1
comma
op_assign
l_int|0x2000201
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CSR1]
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CSR2]
id|str
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_CSR3]
id|ldr
id|r1
comma
(braket
id|r0
comma
macro_line|#SP_SR]
id|ldr
id|r0
comma
(braket
id|r0
comma
macro_line|#SP_RDR]
id|bx
id|lr
dot
id|endfunc
dot
id|func
id|NVRAM_Init
comma
id|NVRAM_INIT
id|NVRAM_INIT
suffix:colon
id|ldr
id|r1
comma
op_assign
id|SP_BASE
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_RDR]
id|mov
id|r0
comma
macro_line|#NVRAM_CMD_RDSR
id|str
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_TDR]
id|SP_loop1
suffix:colon
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_SR]
id|tst
id|r0
comma
macro_line|#SP_TDRE
id|beq
id|SP_loop1
id|mov
id|r0
comma
macro_line|#SPI_8CLOCKS
id|str
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_TDR] 
id|SP_loop2
suffix:colon
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_SR]
id|tst
id|r0
comma
macro_line|#SP_TDRE
id|beq
id|SP_loop2
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_RDR]
id|SP_loop3
suffix:colon
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_SR]
id|tst
id|r0
comma
macro_line|#SP_RDRF
id|beq
id|SP_loop3
id|ldr
id|r0
comma
(braket
id|r1
comma
macro_line|#SP_RDR]
op_logical_and
id|r0
comma
id|r0
comma
macro_line|#255
id|bx
id|lr
dot
id|endfunc
dot
id|func
id|NVRAM_Xfer
comma
id|NVRAM_XFER
multiline_comment|/* r0 = dest address */
multiline_comment|/* r1 = not used */
multiline_comment|/* r2 = src address within NVRAM */
multiline_comment|/* r3 = length */
id|NVRAM_XFER
suffix:colon
id|stmdb
id|sp
op_logical_neg
comma
(brace
id|r4
comma
id|r5
comma
id|lr
)brace
id|mov
id|r5
comma
id|r0
multiline_comment|/* save r0 (dest address) */
id|mov
id|r4
comma
id|r3
multiline_comment|/* save r3 (length) */
id|mov
id|r0
comma
id|r2
comma
id|LSR
macro_line|#5 /*  SPI memories put A8 in the command field */
op_logical_and
id|r0
comma
id|r0
comma
macro_line|#8
id|add
id|r0
comma
id|r0
comma
macro_line|#NVRAM_CMD_READ 
id|ldr
id|r1
comma
op_assign
id|NVRAM_SCRATCH
id|strb
id|r0
comma
(braket
id|r1
comma
macro_line|#0]&t;/* save command in NVRAM_SCRATCH[0] */
id|strb
id|r2
comma
(braket
id|r1
comma
macro_line|#1]    /* save low byte of source address in NVRAM_SCRATCH[1] */
id|_local1
suffix:colon
id|bl
id|NVRAM_INIT
id|tst
id|r0
comma
macro_line|#NVRAM_SR_RDY
id|bne
id|_local1
id|mov
id|r0
comma
macro_line|#20
id|bl
id|DELAY9
id|mov
id|r2
comma
id|r4
multiline_comment|/* length */
id|mov
id|r1
comma
id|r5
multiline_comment|/* dest address */
id|mov
id|r0
comma
macro_line|#2&t;&t;/* bytes to transfer in command */
id|bl
id|NVRAM_XFER2
id|ldmia
id|sp
op_logical_neg
comma
(brace
id|r4
comma
id|r5
comma
id|lr
)brace
id|bx
id|lr
dot
id|endfunc
dot
id|func
id|NVRAM_Xfer2
comma
id|NVRAM_XFER2
id|NVRAM_XFER2
suffix:colon
id|stmdb
id|sp
op_logical_neg
comma
(brace
id|r4
comma
id|r5
comma
id|r6
comma
id|lr
)brace
id|ldr
id|r4
comma
op_assign
id|SP_BASE
id|mov
id|r3
comma
macro_line|#0
id|cmp
id|r0
comma
macro_line|#0
id|bls
id|_local2
id|ldr
id|r5
comma
op_assign
id|NVRAM_SCRATCH
id|_local4
suffix:colon
id|ldrb
id|r6
comma
(braket
id|r5
comma
id|r3
)braket
id|str
id|r6
comma
(braket
id|r4
comma
macro_line|#SP_TDR]
id|_local3
suffix:colon
id|ldr
id|r6
comma
(braket
id|r4
comma
macro_line|#SP_SR]
id|tst
id|r6
comma
macro_line|#SP_TDRE
id|beq
id|_local3
id|add
id|r3
comma
id|r3
comma
macro_line|#1
id|cmp
id|r3
comma
id|r0
multiline_comment|/* r0 is # of bytes to send out (command+addr) */
id|blo
id|_local4
id|_local2
suffix:colon
id|mov
id|r3
comma
macro_line|#SPI_8CLOCKS
id|str
id|r3
comma
(braket
id|r4
comma
macro_line|#SP_TDR]
id|ldr
id|r0
comma
(braket
id|r4
comma
macro_line|#SP_RDR]
id|_local5
suffix:colon
id|ldr
id|r0
comma
(braket
id|r4
comma
macro_line|#SP_SR]
id|tst
id|r0
comma
macro_line|#SP_RDRF
id|beq
id|_local5
id|ldr
id|r0
comma
(braket
id|r4
comma
macro_line|#SP_RDR] /* what&squot;s this byte?  It&squot;s the byte read while writing the TDR -- nonsense, because the NVRAM doesn&squot;t read and write at the same time */
id|mov
id|r0
comma
macro_line|#0
id|cmp
id|r2
comma
macro_line|#0  /* r2 is # of bytes to copy in */
id|bls
id|_local6
id|_local7
suffix:colon
id|ldr
id|r5
comma
(braket
id|r4
comma
macro_line|#SP_SR]
id|tst
id|r5
comma
macro_line|#SP_TDRE
id|beq
id|_local7
id|str
id|r3
comma
(braket
id|r4
comma
macro_line|#SP_TDR]  /* r3 has SPI_8CLOCKS */
id|_local8
suffix:colon
id|ldr
id|r5
comma
(braket
id|r4
comma
macro_line|#SP_SR]
id|tst
id|r5
comma
macro_line|#SP_RDRF
id|beq
id|_local8
id|ldr
id|r5
comma
(braket
id|r4
comma
macro_line|#SP_RDR] /* but didn&squot;t we read this byte above? */
id|strb
id|r5
comma
(braket
id|r1
)braket
comma
macro_line|#1 /* postindexed */
id|add
id|r0
comma
id|r0
comma
macro_line|#1
id|cmp
id|r0
comma
id|r2
id|blo
id|_local7
multiline_comment|/* since we don&squot;t send another address, the NVRAM must be capable of sequential reads */
id|_local6
suffix:colon
id|mov
id|r0
comma
macro_line|#200
id|bl
id|DELAY9
id|ldmia
id|sp
op_logical_neg
comma
(brace
id|r4
comma
id|r5
comma
id|r6
comma
id|lr
)brace
id|bx
id|lr
macro_line|#endif
eof
