multiline_comment|/*======================================================================&n;&n;    Aironet driver for 4500 and 4800 series cards&n;&n;    This code is released under both the GPL version 2 and BSD licenses.&n;    Either license may be used.  The respective licenses are found at&n;    the end of this file.&n;&n;    This code was developed by Benjamin Reed &lt;breed@users.sourceforge.net&gt;&n;    including portions of which come from the Aironet PC4500&n;    Developer&squot;s Reference Manual and used with permission.  Copyright&n;    (C) 1999 Benjamin Reed.  All Rights Reserved.  Permission to use&n;    code in the Developer&squot;s manual was granted for this driver by&n;    Aironet.  Major code contributions were received from Javier Achirica&n;    and Jean Tourrilhes &lt;jt@hpl.hp.com&gt;.  Code was also integrated from&n;    the Cisco Aironet driver for Linux.&n;    &n;======================================================================*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#ifdef CONFIG_PCI
DECL|variable|card_ids
r_static
r_struct
id|pci_device_id
id|card_ids
(braket
)braket
op_assign
id|__devinitdata
(brace
(brace
l_int|0x14b9
comma
l_int|1
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0x14b9
comma
l_int|0x4500
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
)brace
comma
(brace
l_int|0x14b9
comma
l_int|0x4800
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0x14b9
comma
l_int|0x0340
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0x14b9
comma
l_int|0x0350
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|card_ids
)paren
suffix:semicolon
r_static
r_int
id|airo_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_struct
id|pci_device_id
op_star
)paren
suffix:semicolon
r_static
r_void
id|airo_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
)paren
suffix:semicolon
DECL|variable|airo_driver
r_static
r_struct
id|pci_driver
id|airo_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;airo&quot;
comma
id|id_table
suffix:colon
id|card_ids
comma
id|probe
suffix:colon
id|airo_pci_probe
comma
id|remove
suffix:colon
id|airo_pci_remove
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_PCI */
multiline_comment|/* Include Wireless Extension definition and check version - Jean II */
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#if WIRELESS_EXT &lt; 9
macro_line|#warning &quot;Wireless extension v9 or newer required - please upgrade your kernel&quot;
DECL|macro|WIRELESS_EXT
macro_line|#undef WIRELESS_EXT
macro_line|#endif
DECL|macro|WIRELESS_SPY
mdefine_line|#define WIRELESS_SPY&t;&t;
singleline_comment|// enable iwspy support
DECL|macro|CISCO_EXT
mdefine_line|#define CISCO_EXT&t;&t;
singleline_comment|// enable Cisco extensions
macro_line|#ifdef CISCO_EXT
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#endif
multiline_comment|/* As you can see this list is HUGH!&n;   I really don&squot;t know what a lot of these counts are about, but they&n;   are all here for completeness.  If the IGNLABEL macro is put in&n;   infront of the label, that statistic will not be included in the list&n;   of statistics in the /proc filesystem */
DECL|macro|IGNLABEL
mdefine_line|#define IGNLABEL 0&amp;(int)
DECL|variable|statsLabels
r_static
r_char
op_star
id|statsLabels
(braket
)braket
op_assign
(brace
l_string|&quot;RxOverrun&quot;
comma
id|IGNLABEL
l_string|&quot;RxPlcpCrcErr&quot;
comma
id|IGNLABEL
l_string|&quot;RxPlcpFormatErr&quot;
comma
id|IGNLABEL
l_string|&quot;RxPlcpLengthErr&quot;
comma
l_string|&quot;RxMacCrcErr&quot;
comma
l_string|&quot;RxMacCrcOk&quot;
comma
l_string|&quot;RxWepErr&quot;
comma
l_string|&quot;RxWepOk&quot;
comma
l_string|&quot;RetryLong&quot;
comma
l_string|&quot;RetryShort&quot;
comma
l_string|&quot;MaxRetries&quot;
comma
l_string|&quot;NoAck&quot;
comma
l_string|&quot;NoCts&quot;
comma
l_string|&quot;RxAck&quot;
comma
l_string|&quot;RxCts&quot;
comma
l_string|&quot;TxAck&quot;
comma
l_string|&quot;TxRts&quot;
comma
l_string|&quot;TxCts&quot;
comma
l_string|&quot;TxMc&quot;
comma
l_string|&quot;TxBc&quot;
comma
l_string|&quot;TxUcFrags&quot;
comma
l_string|&quot;TxUcPackets&quot;
comma
l_string|&quot;TxBeacon&quot;
comma
l_string|&quot;RxBeacon&quot;
comma
l_string|&quot;TxSinColl&quot;
comma
l_string|&quot;TxMulColl&quot;
comma
l_string|&quot;DefersNo&quot;
comma
l_string|&quot;DefersProt&quot;
comma
l_string|&quot;DefersEngy&quot;
comma
l_string|&quot;DupFram&quot;
comma
l_string|&quot;RxFragDisc&quot;
comma
l_string|&quot;TxAged&quot;
comma
l_string|&quot;RxAged&quot;
comma
l_string|&quot;LostSync-MaxRetry&quot;
comma
l_string|&quot;LostSync-MissedBeacons&quot;
comma
l_string|&quot;LostSync-ArlExceeded&quot;
comma
l_string|&quot;LostSync-Deauth&quot;
comma
l_string|&quot;LostSync-Disassoced&quot;
comma
l_string|&quot;LostSync-TsfTiming&quot;
comma
l_string|&quot;HostTxMc&quot;
comma
l_string|&quot;HostTxBc&quot;
comma
l_string|&quot;HostTxUc&quot;
comma
l_string|&quot;HostTxFail&quot;
comma
l_string|&quot;HostRxMc&quot;
comma
l_string|&quot;HostRxBc&quot;
comma
l_string|&quot;HostRxUc&quot;
comma
l_string|&quot;HostRxDiscard&quot;
comma
id|IGNLABEL
l_string|&quot;HmacTxMc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacTxBc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacTxUc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacTxFail&quot;
comma
id|IGNLABEL
l_string|&quot;HmacRxMc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacRxBc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacRxUc&quot;
comma
id|IGNLABEL
l_string|&quot;HmacRxDiscard&quot;
comma
id|IGNLABEL
l_string|&quot;HmacRxAccepted&quot;
comma
l_string|&quot;SsidMismatch&quot;
comma
l_string|&quot;ApMismatch&quot;
comma
l_string|&quot;RatesMismatch&quot;
comma
l_string|&quot;AuthReject&quot;
comma
l_string|&quot;AuthTimeout&quot;
comma
l_string|&quot;AssocReject&quot;
comma
l_string|&quot;AssocTimeout&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonOutsideTable&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus1&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus2&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus3&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus4&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus5&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus6&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus7&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus8&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus9&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus10&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus11&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus12&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus13&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus14&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus15&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus16&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus17&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus18&quot;
comma
id|IGNLABEL
l_string|&quot;ReasonStatus19&quot;
comma
l_string|&quot;RxMan&quot;
comma
l_string|&quot;TxMan&quot;
comma
l_string|&quot;RxRefresh&quot;
comma
l_string|&quot;TxRefresh&quot;
comma
l_string|&quot;RxPoll&quot;
comma
l_string|&quot;TxPoll&quot;
comma
l_string|&quot;HostRetries&quot;
comma
l_string|&quot;LostSync-HostReq&quot;
comma
l_string|&quot;HostTxBytes&quot;
comma
l_string|&quot;HostRxBytes&quot;
comma
l_string|&quot;ElapsedUsec&quot;
comma
l_string|&quot;ElapsedSec&quot;
comma
l_string|&quot;LostSyncBetterAP&quot;
comma
l_string|&quot;PrivacyMismatch&quot;
comma
l_string|&quot;Jammed&quot;
comma
l_string|&quot;DiscRxNotWepped&quot;
comma
l_string|&quot;PhyEleMismatch&quot;
comma
(paren
r_char
op_star
)paren
op_minus
l_int|1
)brace
suffix:semicolon
macro_line|#ifndef RUN_AT
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies+(x))
macro_line|#endif
multiline_comment|/* These variables are for insmod, since it seems that the rates&n;   can only be set in setup_card.  Rates should be a comma separated&n;   (no spaces) list of rates (up to 8). */
DECL|variable|rates
r_static
r_int
id|rates
(braket
l_int|8
)braket
suffix:semicolon
DECL|variable|basic_rate
r_static
r_int
id|basic_rate
suffix:semicolon
DECL|variable|ssids
r_static
r_char
op_star
id|ssids
(braket
l_int|3
)braket
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
(braket
l_int|4
)braket
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
l_int|4
)braket
suffix:semicolon
r_static
DECL|variable|maxencrypt
r_int
id|maxencrypt
multiline_comment|/* = 0 */
suffix:semicolon
multiline_comment|/* The highest rate that the card can encrypt at.&n;&t;&t;       0 means no limit.  For old cards this was 4 */
DECL|variable|auto_wep
r_static
r_int
id|auto_wep
multiline_comment|/* = 0 */
suffix:semicolon
multiline_comment|/* If set, it tries to figure out the wep mode */
DECL|variable|aux_bap
r_static
r_int
id|aux_bap
multiline_comment|/* = 0 */
suffix:semicolon
multiline_comment|/* Checks to see if the aux ports are needed to read&n;&t;&t;    the bap, needed on some older cards and buses. */
DECL|variable|adhoc
r_static
r_int
id|adhoc
suffix:semicolon
DECL|variable|proc_uid
r_static
r_int
id|proc_uid
multiline_comment|/* = 0 */
suffix:semicolon
DECL|variable|proc_gid
r_static
r_int
id|proc_gid
multiline_comment|/* = 0 */
suffix:semicolon
DECL|variable|airo_perm
r_static
r_int
id|airo_perm
op_assign
l_int|0555
suffix:semicolon
DECL|variable|proc_perm
r_static
r_int
id|proc_perm
op_assign
l_int|0644
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Benjamin Reed&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Support for Cisco/Aironet 802.11 wireless ethernet &bslash;&n;                   cards.  Direct support for ISA/PCI cards and support &bslash;&n;&t;&t;   for PCMCIA when used with airo_cs.&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;Aironet 4500, 4800 and Cisco 340&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|basic_rate
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rates
comma
l_string|&quot;1-8i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ssids
comma
l_string|&quot;1-3s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|auto_wep
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|auto_wep
comma
l_string|&quot;If non-zero, the driver will keep looping through &bslash;&n;the authentication options until an association is made.  The value of &bslash;&n;auto_wep is number of the wep keys to check.  A value of 2 will try using &bslash;&n;the key at index 0 and index 1.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|aux_bap
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|aux_bap
comma
l_string|&quot;If non-zero, the driver will switch into a mode &bslash;&n;than seems to work better for older cards with some older buses.  Before &bslash;&n;switching it checks that the switch is needed.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|maxencrypt
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|maxencrypt
comma
l_string|&quot;The maximum speed that the card can do &bslash;&n;encryption.  Units are in 512kbs.  Zero (default) means there is no limit. &bslash;&n;Older cards used to be limited to 2mbs (4).&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|adhoc
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|adhoc
comma
l_string|&quot;If non-zero, the card will start in adhoc mode.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|proc_uid
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|proc_uid
comma
l_string|&quot;The uid that the /proc files will belong to.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|proc_gid
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|proc_gid
comma
l_string|&quot;The gid that the /proc files will belong to.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|airo_perm
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|airo_perm
comma
l_string|&quot;The permission bits of /proc/[driver/]aironet.&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|proc_perm
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|proc_perm
comma
l_string|&quot;The permission bits of the files in /proc&quot;
)paren
suffix:semicolon
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|min
mdefine_line|#define min(x,y) ((x&lt;y)?x:y)
multiline_comment|/* This is a kind of sloppy hack to get this information to OUT4500 and&n;   IN4500.  I would be extremely interested in the situation where this&n;   doesnt work though!!! */
DECL|variable|do8bitIO
r_static
r_int
id|do8bitIO
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Return codes */
DECL|macro|SUCCESS
mdefine_line|#define SUCCESS 0
DECL|macro|ERROR
mdefine_line|#define ERROR -1
DECL|macro|NO_PACKET
mdefine_line|#define NO_PACKET -2
multiline_comment|/* Commands */
DECL|macro|NOP
mdefine_line|#define NOP 0x0010
DECL|macro|MAC_ENABLE
mdefine_line|#define MAC_ENABLE 0x0001
DECL|macro|MAC_DISABLE
mdefine_line|#define MAC_DISABLE 0x0002
DECL|macro|CMD_ACCESS
mdefine_line|#define CMD_ACCESS 0x0021
DECL|macro|CMD_ALLOCATETX
mdefine_line|#define CMD_ALLOCATETX 0x000a
DECL|macro|CMD_TRANSMIT
mdefine_line|#define CMD_TRANSMIT 0x000b
DECL|macro|HOSTSLEEP
mdefine_line|#define HOSTSLEEP 0x85
DECL|macro|CMD_SETMODE
mdefine_line|#define CMD_SETMODE 0x0009
DECL|macro|CMD_ENABLEAUX
mdefine_line|#define CMD_ENABLEAUX 0x0111
DECL|macro|CMD_SOFTRESET
mdefine_line|#define CMD_SOFTRESET 0x0004
multiline_comment|/* Registers */
DECL|macro|COMMAND
mdefine_line|#define COMMAND 0x00
DECL|macro|PARAM0
mdefine_line|#define PARAM0 0x02
DECL|macro|PARAM1
mdefine_line|#define PARAM1 0x04
DECL|macro|PARAM2
mdefine_line|#define PARAM2 0x06
DECL|macro|STATUS
mdefine_line|#define STATUS 0x08
DECL|macro|RESP0
mdefine_line|#define RESP0 0x0a
DECL|macro|RESP1
mdefine_line|#define RESP1 0x0c
DECL|macro|RESP2
mdefine_line|#define RESP2 0x0e
DECL|macro|LINKSTAT
mdefine_line|#define LINKSTAT 0x10
DECL|macro|SELECT0
mdefine_line|#define SELECT0 0x18
DECL|macro|OFFSET0
mdefine_line|#define OFFSET0 0x1c
DECL|macro|RXFID
mdefine_line|#define RXFID 0x20
DECL|macro|TXALLOCFID
mdefine_line|#define TXALLOCFID 0x22
DECL|macro|TXCOMPLFID
mdefine_line|#define TXCOMPLFID 0x24
DECL|macro|DATA0
mdefine_line|#define DATA0 0x36
DECL|macro|EVSTAT
mdefine_line|#define EVSTAT 0x30
DECL|macro|EVINTEN
mdefine_line|#define EVINTEN 0x32
DECL|macro|EVACK
mdefine_line|#define EVACK 0x34
DECL|macro|SWS0
mdefine_line|#define SWS0 0x28
DECL|macro|SWS1
mdefine_line|#define SWS1 0x2a
DECL|macro|SWS2
mdefine_line|#define SWS2 0x2c
DECL|macro|SWS3
mdefine_line|#define SWS3 0x2e
DECL|macro|AUXPAGE
mdefine_line|#define AUXPAGE 0x3A
DECL|macro|AUXOFF
mdefine_line|#define AUXOFF 0x3C
DECL|macro|AUXDATA
mdefine_line|#define AUXDATA 0x3E
multiline_comment|/* BAP selectors */
DECL|macro|BAP0
mdefine_line|#define BAP0 0 
singleline_comment|// Used for receiving packets
DECL|macro|BAP1
mdefine_line|#define BAP1 2 
singleline_comment|// Used for xmiting packets and working with RIDS
multiline_comment|/* Flags */
DECL|macro|COMMAND_BUSY
mdefine_line|#define COMMAND_BUSY 0x8000
DECL|macro|BAP_BUSY
mdefine_line|#define BAP_BUSY 0x8000
DECL|macro|BAP_ERR
mdefine_line|#define BAP_ERR 0x4000
DECL|macro|BAP_DONE
mdefine_line|#define BAP_DONE 0x2000
DECL|macro|PROMISC
mdefine_line|#define PROMISC 0xffff
DECL|macro|NOPROMISC
mdefine_line|#define NOPROMISC 0x0000
DECL|macro|EV_CMD
mdefine_line|#define EV_CMD 0x10
DECL|macro|EV_CLEARCOMMANDBUSY
mdefine_line|#define EV_CLEARCOMMANDBUSY 0x4000
DECL|macro|EV_RX
mdefine_line|#define EV_RX 0x01
DECL|macro|EV_TX
mdefine_line|#define EV_TX 0x02
DECL|macro|EV_TXEXC
mdefine_line|#define EV_TXEXC 0x04
DECL|macro|EV_ALLOC
mdefine_line|#define EV_ALLOC 0x08
DECL|macro|EV_LINK
mdefine_line|#define EV_LINK 0x80
DECL|macro|EV_AWAKE
mdefine_line|#define EV_AWAKE 0x100
DECL|macro|EV_UNKNOWN
mdefine_line|#define EV_UNKNOWN 0x800
DECL|macro|STATUS_INTS
mdefine_line|#define STATUS_INTS ( EV_AWAKE | EV_LINK | EV_TXEXC | EV_TX | EV_RX)
DECL|macro|IGNORE_INTS
mdefine_line|#define IGNORE_INTS ( EV_CMD | EV_UNKNOWN)
multiline_comment|/* The RIDs */
DECL|macro|RID_CAPABILITIES
mdefine_line|#define RID_CAPABILITIES 0xFF00
DECL|macro|RID_CONFIG
mdefine_line|#define RID_CONFIG     0xFF10
DECL|macro|RID_SSID
mdefine_line|#define RID_SSID       0xFF11
DECL|macro|RID_APLIST
mdefine_line|#define RID_APLIST     0xFF12
DECL|macro|RID_DRVNAME
mdefine_line|#define RID_DRVNAME    0xFF13
DECL|macro|RID_ETHERENCAP
mdefine_line|#define RID_ETHERENCAP 0xFF14
DECL|macro|RID_WEP_TEMP
mdefine_line|#define RID_WEP_TEMP   0xFF15
DECL|macro|RID_WEP_PERM
mdefine_line|#define RID_WEP_PERM   0xFF16
DECL|macro|RID_MODULATION
mdefine_line|#define RID_MODULATION 0xFF17
DECL|macro|RID_ACTUALCONFIG
mdefine_line|#define RID_ACTUALCONFIG 0xFF20 /*readonly*/
DECL|macro|RID_LEAPUSERNAME
mdefine_line|#define RID_LEAPUSERNAME 0xFF23
DECL|macro|RID_LEAPPASSWORD
mdefine_line|#define RID_LEAPPASSWORD 0xFF24
DECL|macro|RID_STATUS
mdefine_line|#define RID_STATUS     0xFF50
DECL|macro|RID_STATS
mdefine_line|#define RID_STATS      0xFF68
DECL|macro|RID_STATSDELTA
mdefine_line|#define RID_STATSDELTA 0xFF69
DECL|macro|RID_STATSDELTACLEAR
mdefine_line|#define RID_STATSDELTACLEAR 0xFF6A
multiline_comment|/*&n; * Rids and endian-ness:  The Rids will always be in cpu endian, since&n; * this all the patches from the big-endian guys end up doing that.&n; * so all rid access should use the read/writeXXXRid routines.&n; */
multiline_comment|/* This structure came from an email sent to me from an engineer at&n;   aironet for inclusion into this driver */
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|kindex
id|u16
id|kindex
suffix:semicolon
DECL|member|mac
id|u8
id|mac
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|klen
id|u16
id|klen
suffix:semicolon
DECL|member|key
id|u8
id|key
(braket
l_int|16
)braket
suffix:semicolon
DECL|typedef|WepKeyRid
)brace
id|WepKeyRid
suffix:semicolon
multiline_comment|/* These structures are from the Aironet&squot;s PC4500 Developers Manual */
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|ssid
id|u8
id|ssid
(braket
l_int|32
)braket
suffix:semicolon
DECL|typedef|Ssid
)brace
id|Ssid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|ssids
id|Ssid
id|ssids
(braket
l_int|3
)braket
suffix:semicolon
DECL|typedef|SsidRid
)brace
id|SsidRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|modulation
id|u16
id|modulation
suffix:semicolon
DECL|macro|MOD_DEFAULT
mdefine_line|#define MOD_DEFAULT 0
DECL|macro|MOD_CCK
mdefine_line|#define MOD_CCK 1
DECL|macro|MOD_MOK
mdefine_line|#define MOD_MOK 2
DECL|typedef|ModulationRid
)brace
id|ModulationRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|cmd
id|u16
id|cmd
suffix:semicolon
DECL|member|parm0
id|u16
id|parm0
suffix:semicolon
DECL|member|parm1
id|u16
id|parm1
suffix:semicolon
DECL|member|parm2
id|u16
id|parm2
suffix:semicolon
DECL|typedef|Cmd
)brace
id|Cmd
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|status
id|u16
id|status
suffix:semicolon
DECL|member|rsp0
id|u16
id|rsp0
suffix:semicolon
DECL|member|rsp1
id|u16
id|rsp1
suffix:semicolon
DECL|member|rsp2
id|u16
id|rsp2
suffix:semicolon
DECL|typedef|Resp
)brace
id|Resp
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
multiline_comment|/* sizeof(ConfigRid) */
DECL|member|opmode
id|u16
id|opmode
suffix:semicolon
multiline_comment|/* operating mode */
DECL|macro|MODE_STA_IBSS
mdefine_line|#define MODE_STA_IBSS 0
DECL|macro|MODE_STA_ESS
mdefine_line|#define MODE_STA_ESS 1
DECL|macro|MODE_AP
mdefine_line|#define MODE_AP 2
DECL|macro|MODE_AP_RPTR
mdefine_line|#define MODE_AP_RPTR 3
DECL|macro|MODE_ETHERNET_HOST
mdefine_line|#define MODE_ETHERNET_HOST (0&lt;&lt;8) /* rx payloads converted */
DECL|macro|MODE_LLC_HOST
mdefine_line|#define MODE_LLC_HOST (1&lt;&lt;8) /* rx payloads left as is */
DECL|macro|MODE_AIRONET_EXTEND
mdefine_line|#define MODE_AIRONET_EXTEND (1&lt;&lt;9) /* enable Aironet extenstions */
DECL|macro|MODE_AP_INTERFACE
mdefine_line|#define MODE_AP_INTERFACE (1&lt;&lt;10) /* enable ap interface extensions */
DECL|macro|MODE_ANTENNA_ALIGN
mdefine_line|#define MODE_ANTENNA_ALIGN (1&lt;&lt;11) /* enable antenna alignment */
DECL|macro|MODE_ETHER_LLC
mdefine_line|#define MODE_ETHER_LLC (1&lt;&lt;12) /* enable ethernet LLC */
DECL|macro|MODE_LEAF_NODE
mdefine_line|#define MODE_LEAF_NODE (1&lt;&lt;13) /* enable leaf node bridge */
DECL|macro|MODE_CF_POLLABLE
mdefine_line|#define MODE_CF_POLLABLE (1&lt;&lt;14) /* enable CF pollable */
DECL|member|rmode
id|u16
id|rmode
suffix:semicolon
multiline_comment|/* receive mode */
DECL|macro|RXMODE_BC_MC_ADDR
mdefine_line|#define RXMODE_BC_MC_ADDR 0
DECL|macro|RXMODE_BC_ADDR
mdefine_line|#define RXMODE_BC_ADDR 1 /* ignore multicasts */
DECL|macro|RXMODE_ADDR
mdefine_line|#define RXMODE_ADDR 2 /* ignore multicast and broadcast */
DECL|macro|RXMODE_RFMON
mdefine_line|#define RXMODE_RFMON 3 /* wireless monitor mode */
DECL|macro|RXMODE_RFMON_ANYBSS
mdefine_line|#define RXMODE_RFMON_ANYBSS 4
DECL|macro|RXMODE_LANMON
mdefine_line|#define RXMODE_LANMON 5 /* lan style monitor -- data packets only */
DECL|macro|RXMODE_DISABLE_802_3_HEADER
mdefine_line|#define RXMODE_DISABLE_802_3_HEADER (1&lt;&lt;8) /* disables 802.3 header on rx */
DECL|macro|RXMODE_NORMALIZED_RSSI
mdefine_line|#define RXMODE_NORMALIZED_RSSI (1&lt;&lt;9) /* return normalized RSSI */
DECL|member|fragThresh
id|u16
id|fragThresh
suffix:semicolon
DECL|member|rtsThres
id|u16
id|rtsThres
suffix:semicolon
DECL|member|macAddr
id|u8
id|macAddr
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|rates
id|u8
id|rates
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|shortRetryLimit
id|u16
id|shortRetryLimit
suffix:semicolon
DECL|member|longRetryLimit
id|u16
id|longRetryLimit
suffix:semicolon
DECL|member|txLifetime
id|u16
id|txLifetime
suffix:semicolon
multiline_comment|/* in kusec */
DECL|member|rxLifetime
id|u16
id|rxLifetime
suffix:semicolon
multiline_comment|/* in kusec */
DECL|member|stationary
id|u16
id|stationary
suffix:semicolon
DECL|member|ordering
id|u16
id|ordering
suffix:semicolon
DECL|member|u16deviceType
id|u16
id|u16deviceType
suffix:semicolon
multiline_comment|/* for overriding device type */
DECL|member|cfpRate
id|u16
id|cfpRate
suffix:semicolon
DECL|member|cfpDuration
id|u16
id|cfpDuration
suffix:semicolon
DECL|member|_reserved1
id|u16
id|_reserved1
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/*---------- Scanning/Associating ----------*/
DECL|member|scanMode
id|u16
id|scanMode
suffix:semicolon
DECL|macro|SCANMODE_ACTIVE
mdefine_line|#define SCANMODE_ACTIVE 0
DECL|macro|SCANMODE_PASSIVE
mdefine_line|#define SCANMODE_PASSIVE 1
DECL|macro|SCANMODE_AIROSCAN
mdefine_line|#define SCANMODE_AIROSCAN 2
DECL|member|probeDelay
id|u16
id|probeDelay
suffix:semicolon
multiline_comment|/* in kusec */
DECL|member|probeEnergyTimeout
id|u16
id|probeEnergyTimeout
suffix:semicolon
multiline_comment|/* in kusec */
DECL|member|probeResponseTimeout
id|u16
id|probeResponseTimeout
suffix:semicolon
DECL|member|beaconListenTimeout
id|u16
id|beaconListenTimeout
suffix:semicolon
DECL|member|joinNetTimeout
id|u16
id|joinNetTimeout
suffix:semicolon
DECL|member|authTimeout
id|u16
id|authTimeout
suffix:semicolon
DECL|member|authType
id|u16
id|authType
suffix:semicolon
DECL|macro|AUTH_OPEN
mdefine_line|#define AUTH_OPEN 0x1
DECL|macro|AUTH_ENCRYPT
mdefine_line|#define AUTH_ENCRYPT 0x101
DECL|macro|AUTH_SHAREDKEY
mdefine_line|#define AUTH_SHAREDKEY 0x102
DECL|macro|AUTH_ALLOW_UNENCRYPTED
mdefine_line|#define AUTH_ALLOW_UNENCRYPTED 0x200
DECL|member|associationTimeout
id|u16
id|associationTimeout
suffix:semicolon
DECL|member|specifiedApTimeout
id|u16
id|specifiedApTimeout
suffix:semicolon
DECL|member|offlineScanInterval
id|u16
id|offlineScanInterval
suffix:semicolon
DECL|member|offlineScanDuration
id|u16
id|offlineScanDuration
suffix:semicolon
DECL|member|linkLossDelay
id|u16
id|linkLossDelay
suffix:semicolon
DECL|member|maxBeaconLostTime
id|u16
id|maxBeaconLostTime
suffix:semicolon
DECL|member|refreshInterval
id|u16
id|refreshInterval
suffix:semicolon
DECL|macro|DISABLE_REFRESH
mdefine_line|#define DISABLE_REFRESH 0xFFFF
DECL|member|_reserved1a
id|u16
id|_reserved1a
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/*---------- Power save operation ----------*/
DECL|member|powerSaveMode
id|u16
id|powerSaveMode
suffix:semicolon
DECL|macro|POWERSAVE_CAM
mdefine_line|#define POWERSAVE_CAM 0
DECL|macro|POWERSAVE_PSP
mdefine_line|#define POWERSAVE_PSP 1
DECL|macro|POWERSAVE_PSPCAM
mdefine_line|#define POWERSAVE_PSPCAM 2
DECL|member|sleepForDtims
id|u16
id|sleepForDtims
suffix:semicolon
DECL|member|listenInterval
id|u16
id|listenInterval
suffix:semicolon
DECL|member|fastListenInterval
id|u16
id|fastListenInterval
suffix:semicolon
DECL|member|listenDecay
id|u16
id|listenDecay
suffix:semicolon
DECL|member|fastListenDelay
id|u16
id|fastListenDelay
suffix:semicolon
DECL|member|_reserved2
id|u16
id|_reserved2
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/*---------- Ap/Ibss config items ----------*/
DECL|member|beaconPeriod
id|u16
id|beaconPeriod
suffix:semicolon
DECL|member|atimDuration
id|u16
id|atimDuration
suffix:semicolon
DECL|member|hopPeriod
id|u16
id|hopPeriod
suffix:semicolon
DECL|member|channelSet
id|u16
id|channelSet
suffix:semicolon
DECL|member|channel
id|u16
id|channel
suffix:semicolon
DECL|member|dtimPeriod
id|u16
id|dtimPeriod
suffix:semicolon
DECL|member|bridgeDistance
id|u16
id|bridgeDistance
suffix:semicolon
DECL|member|radioID
id|u16
id|radioID
suffix:semicolon
multiline_comment|/*---------- Radio configuration ----------*/
DECL|member|radioType
id|u16
id|radioType
suffix:semicolon
DECL|macro|RADIOTYPE_DEFAULT
mdefine_line|#define RADIOTYPE_DEFAULT 0
DECL|macro|RADIOTYPE_802_11
mdefine_line|#define RADIOTYPE_802_11 1
DECL|macro|RADIOTYPE_LEGACY
mdefine_line|#define RADIOTYPE_LEGACY 2
DECL|member|rxDiversity
id|u8
id|rxDiversity
suffix:semicolon
DECL|member|txDiversity
id|u8
id|txDiversity
suffix:semicolon
DECL|member|txPower
id|u16
id|txPower
suffix:semicolon
DECL|macro|TXPOWER_DEFAULT
mdefine_line|#define TXPOWER_DEFAULT 0
DECL|member|rssiThreshold
id|u16
id|rssiThreshold
suffix:semicolon
DECL|macro|RSSI_DEFAULT
mdefine_line|#define RSSI_DEFAULT 0
DECL|member|modulation
id|u16
id|modulation
suffix:semicolon
DECL|member|shortPreamble
id|u16
id|shortPreamble
suffix:semicolon
DECL|member|homeProduct
id|u16
id|homeProduct
suffix:semicolon
DECL|member|radioSpecific
id|u16
id|radioSpecific
suffix:semicolon
multiline_comment|/*---------- Aironet Extensions ----------*/
DECL|member|nodeName
id|u8
id|nodeName
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|arlThreshold
id|u16
id|arlThreshold
suffix:semicolon
DECL|member|arlDecay
id|u16
id|arlDecay
suffix:semicolon
DECL|member|arlDelay
id|u16
id|arlDelay
suffix:semicolon
DECL|member|_reserved4
id|u16
id|_reserved4
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/*---------- Aironet Extensions ----------*/
DECL|member|magicAction
id|u16
id|magicAction
suffix:semicolon
DECL|macro|MAGIC_ACTION_STSCHG
mdefine_line|#define MAGIC_ACTION_STSCHG 1
DECL|macro|MACIC_ACTION_RESUME
mdefine_line|#define MACIC_ACTION_RESUME 2
DECL|macro|MAGIC_IGNORE_MCAST
mdefine_line|#define MAGIC_IGNORE_MCAST (1&lt;&lt;8)
DECL|macro|MAGIC_IGNORE_BCAST
mdefine_line|#define MAGIC_IGNORE_BCAST (1&lt;&lt;9)
DECL|macro|MAGIC_SWITCH_TO_PSP
mdefine_line|#define MAGIC_SWITCH_TO_PSP (0&lt;&lt;10)
DECL|macro|MAGIC_STAY_IN_CAM
mdefine_line|#define MAGIC_STAY_IN_CAM (1&lt;&lt;10)
DECL|member|magicControl
id|u16
id|magicControl
suffix:semicolon
DECL|member|autoWake
id|u16
id|autoWake
suffix:semicolon
DECL|typedef|ConfigRid
)brace
id|ConfigRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|mac
id|u8
id|mac
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|mode
id|u16
id|mode
suffix:semicolon
DECL|member|errorCode
id|u16
id|errorCode
suffix:semicolon
DECL|member|sigQuality
id|u16
id|sigQuality
suffix:semicolon
DECL|member|SSIDlen
id|u16
id|SSIDlen
suffix:semicolon
DECL|member|SSID
r_char
id|SSID
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|apName
r_char
id|apName
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|bssid
r_char
id|bssid
(braket
l_int|4
)braket
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|beaconPeriod
id|u16
id|beaconPeriod
suffix:semicolon
DECL|member|dimPeriod
id|u16
id|dimPeriod
suffix:semicolon
DECL|member|atimDuration
id|u16
id|atimDuration
suffix:semicolon
DECL|member|hopPeriod
id|u16
id|hopPeriod
suffix:semicolon
DECL|member|channelSet
id|u16
id|channelSet
suffix:semicolon
DECL|member|channel
id|u16
id|channel
suffix:semicolon
DECL|member|hopsToBackbone
id|u16
id|hopsToBackbone
suffix:semicolon
DECL|member|apTotalLoad
id|u16
id|apTotalLoad
suffix:semicolon
DECL|member|generatedLoad
id|u16
id|generatedLoad
suffix:semicolon
DECL|member|accumulatedArl
id|u16
id|accumulatedArl
suffix:semicolon
DECL|member|signalQuality
id|u16
id|signalQuality
suffix:semicolon
DECL|member|currentXmitRate
id|u16
id|currentXmitRate
suffix:semicolon
DECL|member|apDevExtensions
id|u16
id|apDevExtensions
suffix:semicolon
DECL|member|normalizedSignalStrength
id|u16
id|normalizedSignalStrength
suffix:semicolon
DECL|member|_reserved
id|u16
id|_reserved
(braket
l_int|10
)braket
suffix:semicolon
DECL|typedef|StatusRid
)brace
id|StatusRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|spacer
id|u16
id|spacer
suffix:semicolon
DECL|member|vals
id|u32
id|vals
(braket
l_int|100
)braket
suffix:semicolon
DECL|typedef|StatsRid
)brace
id|StatsRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|ap
id|u8
id|ap
(braket
l_int|4
)braket
(braket
l_int|6
)braket
suffix:semicolon
DECL|typedef|APListRid
)brace
id|APListRid
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|oui
r_char
id|oui
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|prodNum
id|u16
id|prodNum
suffix:semicolon
DECL|member|manName
r_char
id|manName
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|prodName
r_char
id|prodName
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|prodVer
r_char
id|prodVer
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|factoryAddr
r_char
id|factoryAddr
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|aironetAddr
r_char
id|aironetAddr
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|radioType
id|u16
id|radioType
suffix:semicolon
DECL|member|country
id|u16
id|country
suffix:semicolon
DECL|member|callid
r_char
id|callid
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|supportedRates
r_char
id|supportedRates
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|rxDiversity
r_char
id|rxDiversity
suffix:semicolon
DECL|member|txDiversity
r_char
id|txDiversity
suffix:semicolon
DECL|member|txPowerLevels
id|u16
id|txPowerLevels
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|hardVer
id|u16
id|hardVer
suffix:semicolon
DECL|member|hardCap
id|u16
id|hardCap
suffix:semicolon
DECL|member|tempRange
id|u16
id|tempRange
suffix:semicolon
DECL|member|softVer
id|u16
id|softVer
suffix:semicolon
DECL|member|softSubVer
id|u16
id|softSubVer
suffix:semicolon
DECL|member|interfaceVer
id|u16
id|interfaceVer
suffix:semicolon
DECL|member|softCap
id|u16
id|softCap
suffix:semicolon
DECL|member|bootBlockVer
id|u16
id|bootBlockVer
suffix:semicolon
DECL|member|requiredHard
id|u16
id|requiredHard
suffix:semicolon
DECL|typedef|CapabilityRid
)brace
id|CapabilityRid
suffix:semicolon
DECL|macro|TXCTL_TXOK
mdefine_line|#define TXCTL_TXOK (1&lt;&lt;1) /* report if tx is ok */
DECL|macro|TXCTL_TXEX
mdefine_line|#define TXCTL_TXEX (1&lt;&lt;2) /* report if tx fails */
DECL|macro|TXCTL_802_3
mdefine_line|#define TXCTL_802_3 (0&lt;&lt;3) /* 802.3 packet */
DECL|macro|TXCTL_802_11
mdefine_line|#define TXCTL_802_11 (1&lt;&lt;3) /* 802.11 mac packet */
DECL|macro|TXCTL_ETHERNET
mdefine_line|#define TXCTL_ETHERNET (0&lt;&lt;4) /* payload has ethertype */
DECL|macro|TXCTL_LLC
mdefine_line|#define TXCTL_LLC (1&lt;&lt;4) /* payload is llc */
DECL|macro|TXCTL_RELEASE
mdefine_line|#define TXCTL_RELEASE (0&lt;&lt;5) /* release after completion */
DECL|macro|TXCTL_NORELEASE
mdefine_line|#define TXCTL_NORELEASE (1&lt;&lt;5) /* on completion returns to host */
DECL|macro|BUSY_FID
mdefine_line|#define BUSY_FID 0x10000
macro_line|#ifdef CISCO_EXT
DECL|macro|AIROMAGIC
mdefine_line|#define AIROMAGIC&t;0xa55a
DECL|macro|AIROIOCTL
mdefine_line|#define AIROIOCTL&t;SIOCDEVPRIVATE
DECL|macro|AIROIDIFC
mdefine_line|#define AIROIDIFC &t;AIROIOCTL + 1
multiline_comment|/* Ioctl constants to be used in airo_ioctl.command */
DECL|macro|AIROGCAP
mdefine_line|#define&t;AIROGCAP  &t;&t;0&t;
singleline_comment|// Capability rid
DECL|macro|AIROGCFG
mdefine_line|#define AIROGCFG&t;&t;1       
singleline_comment|// USED A LOT 
DECL|macro|AIROGSLIST
mdefine_line|#define AIROGSLIST&t;&t;2&t;
singleline_comment|// System ID list 
DECL|macro|AIROGVLIST
mdefine_line|#define AIROGVLIST&t;&t;3       
singleline_comment|// List of specified AP&squot;s
DECL|macro|AIROGDRVNAM
mdefine_line|#define AIROGDRVNAM&t;&t;4&t;
singleline_comment|//  NOTUSED
DECL|macro|AIROGEHTENC
mdefine_line|#define AIROGEHTENC&t;&t;5&t;
singleline_comment|// NOTUSED
DECL|macro|AIROGWEPKTMP
mdefine_line|#define AIROGWEPKTMP&t;&t;6
DECL|macro|AIROGWEPKNV
mdefine_line|#define AIROGWEPKNV&t;&t;7
DECL|macro|AIROGSTAT
mdefine_line|#define AIROGSTAT&t;&t;8
DECL|macro|AIROGSTATSC32
mdefine_line|#define AIROGSTATSC32&t;&t;9
DECL|macro|AIROGSTATSD32
mdefine_line|#define AIROGSTATSD32&t;&t;10
multiline_comment|/* Leave gap of 40 commands after AIROGSTATSD32 for future */
DECL|macro|AIROPCAP
mdefine_line|#define AIROPCAP               &t;AIROGSTATSD32 + 40
DECL|macro|AIROPVLIST
mdefine_line|#define AIROPVLIST              AIROPCAP      + 1
DECL|macro|AIROPSLIST
mdefine_line|#define AIROPSLIST&t;&t;AIROPVLIST    + 1
DECL|macro|AIROPCFG
mdefine_line|#define AIROPCFG&t;&t;AIROPSLIST    + 1
DECL|macro|AIROPSIDS
mdefine_line|#define AIROPSIDS&t;&t;AIROPCFG      + 1
DECL|macro|AIROPAPLIST
mdefine_line|#define AIROPAPLIST&t;&t;AIROPSIDS     + 1
DECL|macro|AIROPMACON
mdefine_line|#define AIROPMACON&t;&t;AIROPAPLIST   + 1&t;/* Enable mac  */
DECL|macro|AIROPMACOFF
mdefine_line|#define AIROPMACOFF&t;&t;AIROPMACON    + 1 &t;/* Disable mac */
DECL|macro|AIROPSTCLR
mdefine_line|#define AIROPSTCLR&t;&t;AIROPMACOFF   + 1
DECL|macro|AIROPWEPKEY
mdefine_line|#define AIROPWEPKEY&t;&t;AIROPSTCLR    + 1
DECL|macro|AIROPWEPKEYNV
mdefine_line|#define AIROPWEPKEYNV&t;&t;AIROPWEPKEY   + 1
DECL|macro|AIROPLEAPPWD
mdefine_line|#define AIROPLEAPPWD            AIROPWEPKEYNV + 1
DECL|macro|AIROPLEAPUSR
mdefine_line|#define AIROPLEAPUSR            AIROPLEAPPWD  + 1
multiline_comment|/* Flash codes */
DECL|macro|AIROFLSHRST
mdefine_line|#define AIROFLSHRST&t;       AIROPWEPKEYNV  + 40
DECL|macro|AIROFLSHGCHR
mdefine_line|#define AIROFLSHGCHR           AIROFLSHRST    + 1
DECL|macro|AIROFLSHSTFL
mdefine_line|#define AIROFLSHSTFL           AIROFLSHGCHR   + 1
DECL|macro|AIROFLSHPCHR
mdefine_line|#define AIROFLSHPCHR           AIROFLSHSTFL   + 1
DECL|macro|AIROFLPUTBUF
mdefine_line|#define AIROFLPUTBUF           AIROFLSHPCHR   + 1
DECL|macro|AIRORESTART
mdefine_line|#define AIRORESTART            AIROFLPUTBUF   + 1
DECL|macro|FLASHSIZE
mdefine_line|#define FLASHSIZE&t;32768
DECL|struct|aironet_ioctl
r_typedef
r_struct
id|aironet_ioctl
(brace
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
singleline_comment|// What to do
DECL|member|len
r_int
r_int
id|len
suffix:semicolon
singleline_comment|// Len of data
DECL|member|data
r_int
r_char
op_star
id|data
suffix:semicolon
singleline_comment|// d-data
DECL|typedef|aironet_ioctl
)brace
id|aironet_ioctl
suffix:semicolon
macro_line|#endif /* CISCO_EXT */
macro_line|#ifdef WIRELESS_EXT
singleline_comment|// Frequency list (map channels to frequencies)
DECL|variable|frequency_list
r_const
r_int
id|frequency_list
(braket
)braket
op_assign
(brace
l_int|2412
comma
l_int|2417
comma
l_int|2422
comma
l_int|2427
comma
l_int|2432
comma
l_int|2437
comma
l_int|2442
comma
l_int|2447
comma
l_int|2452
comma
l_int|2457
comma
l_int|2462
comma
l_int|2467
comma
l_int|2472
comma
l_int|2484
)brace
suffix:semicolon
singleline_comment|// A few details needed for WEP (Wireless Equivalent Privacy)
DECL|macro|MAX_KEY_SIZE
mdefine_line|#define MAX_KEY_SIZE 13&t;&t;&t;
singleline_comment|// 128 (?) bits
DECL|macro|MIN_KEY_SIZE
mdefine_line|#define MIN_KEY_SIZE  5&t;&t;&t;
singleline_comment|// 40 bits RC4 - WEP
DECL|struct|wep_key_t
r_typedef
r_struct
id|wep_key_t
(brace
DECL|member|len
id|u16
id|len
suffix:semicolon
DECL|member|key
id|u8
id|key
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* 40-bit and 104-bit keys */
DECL|typedef|wep_key_t
)brace
id|wep_key_t
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT */
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;airo.c 0.2 (Ben Reed &amp; Javier Achirica)&quot;
suffix:semicolon
r_struct
id|airo_info
suffix:semicolon
r_static
r_int
id|get_dec_u16
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
op_star
id|start
comma
r_int
id|limit
)paren
suffix:semicolon
r_static
r_void
id|OUT4500
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
r_register
comma
id|u16
id|value
)paren
suffix:semicolon
r_static
r_int
r_int
id|IN4500
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
r_register
)paren
suffix:semicolon
r_static
id|u16
id|setup_card
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u8
op_star
id|mac
comma
id|ConfigRid
op_star
)paren
suffix:semicolon
r_static
r_void
id|enable_interrupts
c_func
(paren
r_struct
id|airo_info
op_star
)paren
suffix:semicolon
r_static
r_void
id|disable_interrupts
c_func
(paren
r_struct
id|airo_info
op_star
)paren
suffix:semicolon
r_static
id|u16
id|issuecommand
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|Cmd
op_star
id|pCmd
comma
id|Resp
op_star
id|pRsp
)paren
suffix:semicolon
r_static
r_int
id|bap_setup
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
id|u16
id|offset
comma
r_int
id|whichbap
)paren
suffix:semicolon
r_static
r_int
id|aux_bap_read
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
suffix:semicolon
r_static
r_int
id|fast_bap_read
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
suffix:semicolon
r_static
r_int
id|bap_write
c_func
(paren
r_struct
id|airo_info
op_star
comma
r_const
id|u16
op_star
id|pu16Src
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
suffix:semicolon
r_static
r_int
id|PC4500_accessrid
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
id|u16
id|accmd
)paren
suffix:semicolon
r_static
r_int
id|PC4500_readrid
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
r_void
op_star
id|pBuf
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|PC4500_writerid
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
r_const
r_void
op_star
id|pBuf
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_int
id|do_writerid
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
r_const
r_void
op_star
id|rid_data
comma
r_int
id|len
)paren
suffix:semicolon
r_static
id|u16
id|transmit_allocate
c_func
(paren
r_struct
id|airo_info
op_star
comma
r_int
id|lenPayload
)paren
suffix:semicolon
r_static
r_int
id|transmit_802_3_packet
c_func
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|TxFid
comma
r_char
op_star
id|pPacket
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_void
id|airo_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|airo_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
macro_line|#ifdef WIRELESS_EXT
r_struct
id|iw_statistics
op_star
id|airo_get_wireless_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT */
macro_line|#ifdef CISCO_EXT
r_static
r_int
id|readrids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
suffix:semicolon
r_static
r_int
id|writerids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
suffix:semicolon
r_int
id|flashcard
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
suffix:semicolon
macro_line|#endif /* CISCO_EXT */
DECL|struct|airo_info
r_struct
id|airo_info
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|open
r_int
id|open
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
multiline_comment|/* Note, we can have MAX_FIDS outstanding.  FIDs are 16-bits, so we&n;&t;   use the high bit to mark wether it is in use. */
DECL|macro|MAX_FIDS
mdefine_line|#define MAX_FIDS 6
DECL|member|fids
r_int
id|fids
(braket
id|MAX_FIDS
)braket
suffix:semicolon
DECL|member|registered
r_int
id|registered
suffix:semicolon
DECL|member|config
id|ConfigRid
id|config
suffix:semicolon
DECL|member|authtype
id|u16
id|authtype
suffix:semicolon
singleline_comment|// Used with auto_wep 
DECL|member|keyindex
r_char
id|keyindex
suffix:semicolon
singleline_comment|// Used with auto wep
DECL|member|defindex
r_char
id|defindex
suffix:semicolon
singleline_comment|// Used with auto wep
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|proc_entry
r_struct
id|proc_dir_entry
op_star
id|proc_entry
suffix:semicolon
DECL|member|next
r_struct
id|airo_info
op_star
id|next
suffix:semicolon
DECL|member|bap0_lock
id|spinlock_t
id|bap0_lock
suffix:semicolon
DECL|member|bap1_lock
id|spinlock_t
id|bap1_lock
suffix:semicolon
DECL|member|aux_lock
id|spinlock_t
id|aux_lock
suffix:semicolon
DECL|member|cmd_lock
id|spinlock_t
id|cmd_lock
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|macro|FLAG_PROMISC
mdefine_line|#define FLAG_PROMISC   IFF_PROMISC
DECL|macro|FLAG_RADIO_OFF
mdefine_line|#define FLAG_RADIO_OFF 0x02
DECL|member|bap_read
r_int
(paren
op_star
id|bap_read
)paren
(paren
r_struct
id|airo_info
op_star
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
suffix:semicolon
DECL|member|header_parse
r_int
(paren
op_star
id|header_parse
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_int
r_char
op_star
)paren
suffix:semicolon
DECL|member|flash
r_int
r_int
op_star
id|flash
suffix:semicolon
macro_line|#ifdef WIRELESS_EXT
DECL|member|need_commit
r_int
id|need_commit
suffix:semicolon
singleline_comment|// Need to set config
DECL|member|wstats
r_struct
id|iw_statistics
id|wstats
suffix:semicolon
singleline_comment|// wireless stats
macro_line|#ifdef WIRELESS_SPY
DECL|member|spy_number
r_int
id|spy_number
suffix:semicolon
DECL|member|spy_address
id|u_char
id|spy_address
(braket
id|IW_MAX_SPY
)braket
(braket
l_int|6
)braket
suffix:semicolon
DECL|member|spy_stat
r_struct
id|iw_quality
id|spy_stat
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
macro_line|#endif /* WIRELESS_SPY */
macro_line|#endif /* WIRELESS_EXT */
)brace
suffix:semicolon
DECL|function|bap_read
r_static
r_inline
r_int
id|bap_read
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
(brace
r_return
id|ai
op_member_access_from_pointer
id|bap_read
c_func
(paren
id|ai
comma
id|pu16Dst
comma
id|bytelen
comma
id|whichbap
)paren
suffix:semicolon
)brace
r_static
r_int
id|setup_proc_entry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|airo_info
op_star
id|apriv
)paren
suffix:semicolon
r_static
r_int
id|takedown_proc_entry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|airo_info
op_star
id|apriv
)paren
suffix:semicolon
DECL|function|readWepKeyRid
r_static
r_int
id|readWepKeyRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|WepKeyRid
op_star
id|wkr
comma
r_int
id|temp
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|temp
ques
c_cond
id|RID_WEP_TEMP
suffix:colon
id|RID_WEP_PERM
comma
id|wkr
comma
r_sizeof
(paren
op_star
id|wkr
)paren
)paren
suffix:semicolon
id|wkr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|wkr-&gt;len
)paren
suffix:semicolon
id|wkr-&gt;kindex
op_assign
id|le16_to_cpu
c_func
(paren
id|wkr-&gt;kindex
)paren
suffix:semicolon
id|wkr-&gt;klen
op_assign
id|le16_to_cpu
c_func
(paren
id|wkr-&gt;klen
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* In the writeXXXRid routines we copy the rids so that we don&squot;t screwup&n; * the originals when we endian them... */
DECL|function|writeWepKeyRid
r_static
r_int
id|writeWepKeyRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|WepKeyRid
op_star
id|pwkr
comma
r_int
id|perm
)paren
(brace
r_int
id|rc
suffix:semicolon
id|WepKeyRid
id|wkr
op_assign
op_star
id|pwkr
suffix:semicolon
id|wkr.len
op_assign
id|cpu_to_le16
c_func
(paren
id|wkr.len
)paren
suffix:semicolon
id|wkr.kindex
op_assign
id|cpu_to_le16
c_func
(paren
id|wkr.kindex
)paren
suffix:semicolon
id|wkr.klen
op_assign
id|cpu_to_le16
c_func
(paren
id|wkr.klen
)paren
suffix:semicolon
id|rc
op_assign
id|do_writerid
c_func
(paren
id|ai
comma
id|RID_WEP_TEMP
comma
op_amp
id|wkr
comma
r_sizeof
(paren
id|wkr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
id|SUCCESS
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo:  WEP_TEMP set %x&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|perm
)paren
(brace
id|rc
op_assign
id|do_writerid
c_func
(paren
id|ai
comma
id|RID_WEP_PERM
comma
op_amp
id|wkr
comma
r_sizeof
(paren
id|wkr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
id|SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo:  WEP_PERM set %x&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|readSsidRid
r_static
r_int
id|readSsidRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|SsidRid
op_star
id|ssidr
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|RID_SSID
comma
id|ssidr
comma
r_sizeof
(paren
op_star
id|ssidr
)paren
)paren
suffix:semicolon
id|ssidr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|ssidr-&gt;len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ssidr-&gt;ssids
(braket
id|i
)braket
dot
id|len
op_assign
id|le16_to_cpu
c_func
(paren
id|ssidr-&gt;ssids
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|writeSsidRid
r_static
r_int
id|writeSsidRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|SsidRid
op_star
id|pssidr
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|i
suffix:semicolon
id|SsidRid
id|ssidr
op_assign
op_star
id|pssidr
suffix:semicolon
id|ssidr.len
op_assign
id|cpu_to_le16
c_func
(paren
id|ssidr.len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ssidr.ssids
(braket
id|i
)braket
dot
id|len
op_assign
id|cpu_to_le16
c_func
(paren
id|ssidr.ssids
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
)brace
id|rc
op_assign
id|do_writerid
c_func
(paren
id|ai
comma
id|RID_SSID
comma
op_amp
id|ssidr
comma
r_sizeof
(paren
id|ssidr
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|readConfigRid
r_static
r_int
id|readConfigRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|ConfigRid
op_star
id|cfgr
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|RID_ACTUALCONFIG
comma
id|cfgr
comma
r_sizeof
(paren
op_star
id|cfgr
)paren
)paren
suffix:semicolon
id|u16
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr-&gt;len
suffix:semicolon
id|s
op_le
op_amp
id|cfgr-&gt;rtsThres
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr-&gt;shortRetryLimit
suffix:semicolon
id|s
op_le
op_amp
id|cfgr-&gt;radioType
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr-&gt;txPower
suffix:semicolon
id|s
op_le
op_amp
id|cfgr-&gt;radioSpecific
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr-&gt;arlThreshold
suffix:semicolon
id|s
op_le
op_amp
id|cfgr-&gt;autoWake
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|writeConfigRid
r_static
r_int
id|writeConfigRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|ConfigRid
op_star
id|pcfgr
)paren
(brace
id|u16
op_star
id|s
suffix:semicolon
id|ConfigRid
id|cfgr
op_assign
op_star
id|pcfgr
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr.len
suffix:semicolon
id|s
op_le
op_amp
id|cfgr.rtsThres
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|cpu_to_le16
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr.shortRetryLimit
suffix:semicolon
id|s
op_le
op_amp
id|cfgr.radioType
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|cpu_to_le16
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr.txPower
suffix:semicolon
id|s
op_le
op_amp
id|cfgr.radioSpecific
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|cpu_to_le16
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|cfgr.arlThreshold
suffix:semicolon
id|s
op_le
op_amp
id|cfgr.autoWake
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|cpu_to_le16
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_return
id|do_writerid
c_func
(paren
id|ai
comma
id|RID_CONFIG
comma
op_amp
id|cfgr
comma
r_sizeof
(paren
id|cfgr
)paren
)paren
suffix:semicolon
)brace
DECL|function|readStatusRid
r_static
r_int
id|readStatusRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|StatusRid
op_star
id|statr
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|RID_STATUS
comma
id|statr
comma
r_sizeof
(paren
op_star
id|statr
)paren
)paren
suffix:semicolon
id|u16
op_star
id|s
suffix:semicolon
id|statr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|statr-&gt;len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|statr-&gt;mode
suffix:semicolon
id|s
op_le
op_amp
id|statr-&gt;SSIDlen
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|statr-&gt;beaconPeriod
suffix:semicolon
id|s
op_le
op_amp
id|statr-&gt;_reserved
(braket
l_int|9
)braket
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|readAPListRid
r_static
r_int
id|readAPListRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|APListRid
op_star
id|aplr
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|RID_APLIST
comma
id|aplr
comma
r_sizeof
(paren
op_star
id|aplr
)paren
)paren
suffix:semicolon
id|aplr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|aplr-&gt;len
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|writeAPListRid
r_static
r_int
id|writeAPListRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|APListRid
op_star
id|aplr
)paren
(brace
r_int
id|rc
suffix:semicolon
id|aplr-&gt;len
op_assign
id|cpu_to_le16
c_func
(paren
id|aplr-&gt;len
)paren
suffix:semicolon
id|rc
op_assign
id|do_writerid
c_func
(paren
id|ai
comma
id|RID_APLIST
comma
id|aplr
comma
r_sizeof
(paren
op_star
id|aplr
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|readCapabilityRid
r_static
r_int
id|readCapabilityRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|CapabilityRid
op_star
id|capr
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|RID_CAPABILITIES
comma
id|capr
comma
r_sizeof
(paren
op_star
id|capr
)paren
)paren
suffix:semicolon
id|u16
op_star
id|s
suffix:semicolon
id|capr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|capr-&gt;len
)paren
suffix:semicolon
id|capr-&gt;prodNum
op_assign
id|le16_to_cpu
c_func
(paren
id|capr-&gt;prodNum
)paren
suffix:semicolon
id|capr-&gt;radioType
op_assign
id|le16_to_cpu
c_func
(paren
id|capr-&gt;radioType
)paren
suffix:semicolon
id|capr-&gt;country
op_assign
id|le16_to_cpu
c_func
(paren
id|capr-&gt;country
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
op_amp
id|capr-&gt;txPowerLevels
(braket
l_int|0
)braket
suffix:semicolon
id|s
op_le
op_amp
id|capr-&gt;requiredHard
suffix:semicolon
id|s
op_increment
)paren
(brace
op_star
id|s
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|s
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|readStatsRid
r_static
r_int
id|readStatsRid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|StatsRid
op_star
id|sr
comma
r_int
id|rid
)paren
(brace
r_int
id|rc
op_assign
id|PC4500_readrid
c_func
(paren
id|ai
comma
id|rid
comma
id|sr
comma
r_sizeof
(paren
op_star
id|sr
)paren
)paren
suffix:semicolon
id|u32
op_star
id|i
suffix:semicolon
id|sr-&gt;len
op_assign
id|le16_to_cpu
c_func
(paren
id|sr-&gt;len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
op_amp
id|sr-&gt;vals
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_le
op_amp
id|sr-&gt;vals
(braket
l_int|99
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|i
op_assign
id|le32_to_cpu
c_func
(paren
op_star
id|i
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|airo_open
r_static
r_int
id|airo_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|airo_info
op_star
id|info
op_assign
id|dev-&gt;priv
suffix:semicolon
id|enable_interrupts
c_func
(paren
id|info
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_start_xmit
r_static
r_int
id|airo_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|s16
id|len
suffix:semicolon
id|s16
id|retval
op_assign
l_int|0
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|u32
id|flags
suffix:semicolon
id|s8
op_star
id|buffer
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|airo_info
op_star
id|priv
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u32
op_star
id|fids
op_assign
id|priv-&gt;fids
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo:  skb == NULL!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Find a vacant FID */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|priv-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
comma
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
id|j
OL
id|MAX_FIDS
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fids
(braket
id|j
)braket
op_amp
l_int|0xffff0000
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|1
)paren
id|i
op_assign
id|j
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|j
op_eq
id|MAX_FIDS
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
op_minus
l_int|1
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|tx_done
suffix:semicolon
)brace
id|len
op_assign
id|ETH_ZLEN
OL
id|skb-&gt;len
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
multiline_comment|/* check min length*/
id|buffer
op_assign
id|skb-&gt;data
suffix:semicolon
id|status
op_assign
id|transmit_802_3_packet
c_func
(paren
id|priv
comma
id|fids
(braket
id|i
)braket
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|SUCCESS
)paren
(brace
multiline_comment|/* Mark fid as used &amp; save length for later */
id|fids
(braket
id|i
)braket
op_or_assign
(paren
id|len
op_lshift
l_int|16
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
id|tx_done
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|priv-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|airo_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
)paren
suffix:semicolon
)brace
r_static
r_int
id|enable_MAC
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|Resp
op_star
id|rsp
)paren
suffix:semicolon
r_static
r_void
id|disable_MAC
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
suffix:semicolon
DECL|function|airo_set_multicast_list
r_static
r_void
id|airo_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|Cmd
id|cmd
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
multiline_comment|/* For some reason this command takes a lot of time (~20 ms) and it&squot;s&n;&t; * run in an interrupt handler, so we&squot;d better be sure we needed it&n;&t; * before executing it.&n;&t; */
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_xor
id|ai-&gt;flags
)paren
op_amp
id|IFF_PROMISC
)paren
(brace
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|CMD_SETMODE
suffix:semicolon
id|cmd.parm0
op_assign
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
ques
c_cond
id|PROMISC
suffix:colon
id|NOPROMISC
suffix:semicolon
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
suffix:semicolon
id|ai-&gt;flags
op_xor_assign
id|IFF_PROMISC
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
id|dev-&gt;mc_count
OG
l_int|0
)paren
(brace
multiline_comment|/* Turn on multicast.  (Should be already setup...) */
)brace
)brace
DECL|function|airo_set_mac_address
r_static
r_int
id|airo_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
id|ConfigRid
id|cfg
suffix:semicolon
id|readConfigRid
(paren
id|ai
comma
op_amp
id|cfg
)paren
suffix:semicolon
id|memcpy
(paren
id|cfg.macAddr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|writeConfigRid
(paren
id|ai
comma
op_amp
id|cfg
)paren
suffix:semicolon
id|memcpy
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_change_mtu
r_static
r_int
id|airo_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
l_int|2400
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_close
r_static
r_int
id|airo_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|disable_interrupts
c_func
(paren
id|ai
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|del_airo_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|stop_airo_card
r_void
id|stop_airo_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|freeres
)paren
(brace
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|ai-&gt;flash
)paren
id|kfree
c_func
(paren
id|ai-&gt;flash
)paren
suffix:semicolon
id|takedown_proc_entry
c_func
(paren
id|dev
comma
id|ai
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ai-&gt;registered
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ai-&gt;registered
op_assign
l_int|0
suffix:semicolon
)brace
id|disable_interrupts
c_func
(paren
id|ai
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|auto_wep
)paren
id|del_timer_sync
c_func
(paren
op_amp
id|ai-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|freeres
)paren
(brace
multiline_comment|/* PCMCIA frees this stuff, so only for PCI and ISA */
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
)paren
suffix:semicolon
)brace
id|del_airo_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
id|add_airo_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|init_airo_card
r_struct
id|net_device
op_star
id|init_airo_card
c_func
(paren
r_int
r_int
id|irq
comma
r_int
id|port
comma
r_int
id|is_pcmcia
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
multiline_comment|/* Create the network device object. */
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|ai
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo:  Couldn&squot;t alloc_etherdev&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ai
op_assign
id|dev-&gt;priv
suffix:semicolon
id|ai-&gt;registered
op_assign
l_int|1
suffix:semicolon
id|ai-&gt;dev
op_assign
id|dev
suffix:semicolon
id|ai-&gt;bap0_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ai-&gt;bap1_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ai-&gt;aux_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ai-&gt;cmd_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|ai-&gt;header_parse
op_assign
id|dev-&gt;hard_header_parse
suffix:semicolon
id|rc
op_assign
id|add_airo_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_free
suffix:semicolon
multiline_comment|/* The Airo-specific entries in the device structure. */
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|airo_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|airo_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|airo_set_multicast_list
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
op_amp
id|airo_set_mac_address
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|airo_ioctl
suffix:semicolon
macro_line|#ifdef WIRELESS_EXT
id|dev-&gt;get_wireless_stats
op_assign
id|airo_get_wireless_stats
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT */
id|dev-&gt;change_mtu
op_assign
op_amp
id|airo_change_mtu
suffix:semicolon
id|dev-&gt;open
op_assign
op_amp
id|airo_open
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|airo_close
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|port
suffix:semicolon
id|rc
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_unlink
suffix:semicolon
id|rc
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|airo_interrupt
comma
id|SA_SHIRQ
op_or
id|SA_INTERRUPT
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: register interrupt %d failed, rc %d&bslash;n&quot;
comma
id|irq
comma
id|rc
)paren
suffix:semicolon
r_goto
id|err_out_unregister
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|is_pcmcia
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
comma
id|dev-&gt;name
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|err_out_irq
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|setup_card
c_func
(paren
id|ai
comma
id|dev-&gt;dev_addr
comma
op_amp
id|ai-&gt;config
)paren
op_ne
id|SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: MAC could not be enabled&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo: MAC enabled %s %x:%x:%x:%x:%x:%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
multiline_comment|/* Allocate the transmit buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_FIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ai-&gt;fids
(braket
id|i
)braket
op_assign
id|transmit_allocate
c_func
(paren
id|ai
comma
l_int|2312
)paren
suffix:semicolon
)brace
id|setup_proc_entry
c_func
(paren
id|dev
comma
id|dev-&gt;priv
)paren
suffix:semicolon
multiline_comment|/* XXX check for failure */
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
id|err_out_res
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|is_pcmcia
)paren
id|release_region
c_func
(paren
id|dev-&gt;base_addr
comma
l_int|64
)paren
suffix:semicolon
id|err_out_irq
suffix:colon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|err_out_unregister
suffix:colon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out_unlink
suffix:colon
id|del_airo_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|waitbusy
r_int
id|waitbusy
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
r_int
id|delay
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|IN4500
(paren
id|ai
comma
id|COMMAND
)paren
op_amp
id|COMMAND_BUSY
)paren
op_amp
(paren
id|delay
OL
l_int|10000
)paren
)paren
(brace
id|udelay
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|delay
op_mod
l_int|20
)paren
id|OUT4500
c_func
(paren
id|ai
comma
id|EVACK
comma
id|EV_CLEARCOMMANDBUSY
)paren
suffix:semicolon
)brace
r_return
id|delay
OL
l_int|10000
suffix:semicolon
)brace
DECL|function|reset_airo_card
r_int
id|reset_airo_card
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|disable_MAC
c_func
(paren
id|ai
)paren
suffix:semicolon
id|waitbusy
(paren
id|ai
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|COMMAND
comma
id|CMD_SOFTRESET
)paren
suffix:semicolon
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
op_div
l_int|5
)paren
suffix:semicolon
id|waitbusy
(paren
id|ai
)paren
suffix:semicolon
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
op_div
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setup_card
c_func
(paren
id|ai
comma
id|dev-&gt;dev_addr
comma
op_amp
(paren
id|ai
)paren
op_member_access_from_pointer
id|config
)paren
op_ne
id|SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: MAC could not be enabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo: MAC enabled %s %x:%x:%x:%x:%x:%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
multiline_comment|/* Allocate the transmit buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_FIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ai-&gt;fids
(braket
id|i
)braket
op_assign
id|transmit_allocate
c_func
(paren
id|ai
comma
l_int|2312
)paren
suffix:semicolon
)brace
)brace
id|enable_interrupts
c_func
(paren
id|ai
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wll_header_parse
r_int
id|wll_header_parse
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
r_char
op_star
id|haddr
)paren
(brace
id|memcpy
c_func
(paren
id|haddr
comma
id|skb-&gt;mac.raw
op_plus
l_int|10
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
id|ETH_ALEN
suffix:semicolon
)brace
DECL|function|airo_interrupt
r_static
r_void
id|airo_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|u16
id|fid
suffix:semicolon
r_struct
id|airo_info
op_star
id|apriv
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|savedInterrupts
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
r_return
suffix:semicolon
id|status
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|EVSTAT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
op_logical_or
id|status
op_eq
l_int|0xffff
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|EV_AWAKE
)paren
(brace
id|OUT4500
c_func
(paren
id|apriv
comma
id|EVACK
comma
id|EV_AWAKE
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|apriv
comma
id|EVACK
comma
id|EV_AWAKE
)paren
suffix:semicolon
)brace
id|savedInterrupts
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|EVINTEN
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|apriv
comma
id|EVINTEN
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|EV_LINK
)paren
(brace
multiline_comment|/* The link status has changed, if you want to put a&n;&t;&t;   monitor hook in, do it here.  (Remember that&n;&t;&t;   interrupts are still disabled!)&n;&t;&t;*/
id|u16
id|newStatus
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|LINKSTAT
)paren
suffix:semicolon
multiline_comment|/* Here is what newStatus means: */
DECL|macro|NOBEACON
mdefine_line|#define NOBEACON 0x8000 /* Loss of sync - missed beacons */
DECL|macro|MAXRETRIES
mdefine_line|#define MAXRETRIES 0x8001 /* Loss of sync - max retries */
DECL|macro|MAXARL
mdefine_line|#define MAXARL 0x8002 /* Loss of sync - average retry level exceeded*/
DECL|macro|FORCELOSS
mdefine_line|#define FORCELOSS 0x8003 /* Loss of sync - host request */
DECL|macro|TSFSYNC
mdefine_line|#define TSFSYNC 0x8004 /* Loss of sync - TSF synchronization */
DECL|macro|DEAUTH
mdefine_line|#define DEAUTH 0x8100 /* Deauthentication (low byte is reason code) */
DECL|macro|DISASS
mdefine_line|#define DISASS 0x8200 /* Disassociation (low byte is reason code) */
DECL|macro|ASSFAIL
mdefine_line|#define ASSFAIL 0x8400 /* Association failure (low byte is reason&n;&t;&t;&t;  code) */
DECL|macro|AUTHFAIL
mdefine_line|#define AUTHFAIL 0x0300 /* Authentication failure (low byte is reason&n;&t;&t;&t;   code) */
DECL|macro|ASSOCIATED
mdefine_line|#define ASSOCIATED 0x0400 /* Assocatied */
DECL|macro|RC_RESERVED
mdefine_line|#define RC_RESERVED 0 /* Reserved return code */
DECL|macro|RC_NOREASON
mdefine_line|#define RC_NOREASON 1 /* Unspecified reason */
DECL|macro|RC_AUTHINV
mdefine_line|#define RC_AUTHINV 2 /* Previous authentication invalid */
DECL|macro|RC_DEAUTH
mdefine_line|#define RC_DEAUTH 3 /* Deauthenticated because sending station is&n;&t;&t;       leaving */
DECL|macro|RC_NOACT
mdefine_line|#define RC_NOACT 4 /* Disassociated due to inactivity */
DECL|macro|RC_MAXLOAD
mdefine_line|#define RC_MAXLOAD 5 /* Disassociated because AP is unable to handle&n;&t;&t;&t;all currently associated stations */
DECL|macro|RC_BADCLASS2
mdefine_line|#define RC_BADCLASS2 6 /* Class 2 frame received from&n;&t;&t;&t;  non-Authenticated station */
DECL|macro|RC_BADCLASS3
mdefine_line|#define RC_BADCLASS3 7 /* Class 3 frame received from&n;&t;&t;&t;  non-Associated station */
DECL|macro|RC_STATLEAVE
mdefine_line|#define RC_STATLEAVE 8 /* Disassociated because sending station is&n;&t;&t;&t;  leaving BSS */
DECL|macro|RC_NOAUTH
mdefine_line|#define RC_NOAUTH 9 /* Station requesting (Re)Association is not&n;&t;&t;       Authenticated with the responding station */
r_if
c_cond
(paren
id|newStatus
op_ne
id|ASSOCIATED
)paren
(brace
r_if
c_cond
(paren
id|auto_wep
op_logical_and
op_logical_neg
id|timer_pending
c_func
(paren
op_amp
id|apriv-&gt;timer
)paren
)paren
(brace
id|apriv-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|apriv-&gt;timer
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Check to see if there is something to receive */
r_if
c_cond
(paren
id|status
op_amp
id|EV_RX
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|u16
id|fc
comma
id|len
comma
id|hdrlen
op_assign
l_int|0
suffix:semicolon
r_struct
(brace
id|u16
id|status
comma
id|len
suffix:semicolon
id|u8
id|rssi
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|hdr
suffix:semicolon
id|fid
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|RXFID
)paren
suffix:semicolon
multiline_comment|/* Get the packet length */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|apriv-&gt;bap0_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
(brace
id|bap_setup
(paren
id|apriv
comma
id|fid
comma
l_int|4
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
(paren
id|u16
op_star
)paren
op_amp
id|hdr
comma
r_sizeof
(paren
id|hdr
)paren
comma
id|BAP0
)paren
suffix:semicolon
multiline_comment|/* Bad CRC. Ignore packet */
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|hdr.status
)paren
op_eq
l_int|2
)paren
(brace
id|apriv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|apriv-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|hdr.len
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|bap_setup
(paren
id|apriv
comma
id|fid
comma
l_int|6
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
(paren
id|u16
op_star
)paren
op_amp
id|hdr.len
comma
l_int|4
comma
id|BAP0
)paren
suffix:semicolon
)brace
id|len
op_assign
id|le16_to_cpu
c_func
(paren
id|hdr.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|2312
)paren
(brace
id|apriv-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
id|apriv-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: Bad size %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
(brace
id|bap_setup
(paren
id|apriv
comma
id|fid
comma
l_int|0x14
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
(paren
id|u16
op_star
)paren
op_amp
id|fc
comma
r_sizeof
(paren
id|fc
)paren
comma
id|BAP0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|le16_to_cpu
c_func
(paren
id|fc
)paren
op_amp
l_int|0x300
)paren
op_eq
l_int|0x300
)paren
id|hdrlen
op_assign
l_int|30
suffix:semicolon
r_else
id|hdrlen
op_assign
l_int|24
suffix:semicolon
)brace
r_else
id|hdrlen
op_assign
l_int|12
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
id|hdrlen
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|apriv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|len
)paren
(brace
id|u16
op_star
id|buffer
suffix:semicolon
id|buffer
op_assign
(paren
id|u16
op_star
)paren
id|skb_put
(paren
id|skb
comma
id|len
op_plus
id|hdrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
(brace
id|u16
id|gap
comma
id|tmpbuf
(braket
l_int|4
)braket
suffix:semicolon
id|buffer
(braket
l_int|0
)braket
op_assign
id|fc
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
id|buffer
op_plus
l_int|1
comma
id|hdrlen
op_minus
l_int|2
comma
id|BAP0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdrlen
op_eq
l_int|24
)paren
id|bap_read
(paren
id|apriv
comma
id|tmpbuf
comma
l_int|6
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
op_amp
id|gap
comma
r_sizeof
(paren
id|gap
)paren
comma
id|BAP0
)paren
suffix:semicolon
id|gap
op_assign
id|le16_to_cpu
c_func
(paren
id|gap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gap
op_logical_and
id|gap
op_le
l_int|8
)paren
id|bap_read
(paren
id|apriv
comma
id|tmpbuf
comma
id|gap
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
id|buffer
op_plus
id|hdrlen
op_div
l_int|2
comma
id|len
comma
id|BAP0
)paren
suffix:semicolon
)brace
r_else
(brace
id|bap_setup
(paren
id|apriv
comma
id|fid
comma
l_int|0x38
comma
id|BAP0
)paren
suffix:semicolon
id|bap_read
(paren
id|apriv
comma
id|buffer
comma
id|len
op_plus
id|hdrlen
comma
id|BAP0
)paren
suffix:semicolon
)brace
macro_line|#ifdef WIRELESS_SPY
r_if
c_cond
(paren
id|apriv-&gt;spy_number
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|sa
suffix:semicolon
id|sa
op_assign
(paren
r_char
op_star
)paren
id|buffer
op_plus
(paren
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
ques
c_cond
l_int|10
suffix:colon
l_int|6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|apriv-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|sa
comma
id|apriv-&gt;spy_address
(braket
id|i
)braket
comma
l_int|6
)paren
)paren
(brace
id|apriv-&gt;spy_stat
(braket
id|i
)braket
dot
id|qual
op_assign
id|hdr.rssi
(braket
l_int|0
)braket
suffix:semicolon
id|apriv-&gt;spy_stat
(braket
id|i
)braket
dot
id|level
op_assign
id|hdr.rssi
(braket
l_int|1
)braket
suffix:semicolon
id|apriv-&gt;spy_stat
(braket
id|i
)braket
dot
id|noise
op_assign
l_int|0
suffix:semicolon
id|apriv-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif /* WIRELESS_SPY  */
id|apriv-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|apriv-&gt;stats.rx_bytes
op_add_assign
id|len
op_plus
id|hdrlen
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
(brace
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_pull
(paren
id|skb
comma
id|hdrlen
)paren
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_OTHERHOST
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
r_else
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|apriv-&gt;bap0_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Check to see if a packet has been transmitted */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|EV_TX
op_or
id|EV_TXEXC
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|full
op_assign
l_int|1
suffix:semicolon
r_int
id|index
op_assign
op_minus
l_int|1
suffix:semicolon
id|fid
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|TXCOMPLFID
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_FIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|apriv-&gt;fids
(braket
id|i
)braket
op_amp
l_int|0xffff0000
)paren
)paren
id|full
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|apriv-&gt;fids
(braket
id|i
)braket
op_amp
l_int|0xffff
)paren
op_eq
id|fid
)paren
(brace
id|len
op_assign
id|apriv-&gt;fids
(braket
id|i
)braket
op_rshift
l_int|16
suffix:semicolon
id|index
op_assign
id|i
suffix:semicolon
multiline_comment|/* Set up to be used again */
id|apriv-&gt;fids
(braket
id|i
)braket
op_and_assign
l_int|0xffff
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|full
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: Unallocated FID was used to xmit&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|EV_TX
)paren
(brace
id|apriv-&gt;stats.tx_packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ne
op_minus
l_int|1
)paren
(brace
id|apriv-&gt;stats.tx_bytes
op_add_assign
id|len
suffix:semicolon
)brace
)brace
r_else
(brace
id|apriv-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
op_complement
id|STATUS_INTS
op_amp
op_complement
id|IGNORE_INTS
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;airo: Got weird status %x&bslash;n&quot;
comma
id|status
op_amp
op_complement
id|STATUS_INTS
op_amp
op_complement
id|IGNORE_INTS
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|apriv
comma
id|EVACK
comma
id|status
op_amp
id|STATUS_INTS
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|apriv
comma
id|EVINTEN
comma
id|savedInterrupts
)paren
suffix:semicolon
multiline_comment|/* done.. */
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Routines to talk to the card&n; */
multiline_comment|/*&n; *  This was originally written for the 4500, hence the name&n; *  NOTE:  If use with 8bit mode and SMP bad things will happen!&n; *         Why would some one do 8 bit IO in an SMP machine?!?&n; */
DECL|function|OUT4500
r_static
r_void
id|OUT4500
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|reg
comma
id|u16
id|val
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|do8bitIO
)paren
id|outw
c_func
(paren
id|val
comma
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
r_else
(brace
id|outb
c_func
(paren
id|val
op_amp
l_int|0xff
comma
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
op_rshift
l_int|8
comma
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|IN4500
r_static
id|u16
id|IN4500
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|reg
)paren
(brace
r_int
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|do8bitIO
)paren
id|rc
op_assign
id|inw
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
r_else
(brace
id|rc
op_assign
id|inb
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
)paren
suffix:semicolon
id|rc
op_add_assign
(paren
(paren
r_int
)paren
id|inb
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|reg
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|enable_MAC
r_static
r_int
id|enable_MAC
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|Resp
op_star
id|rsp
)paren
(brace
id|Cmd
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|ai-&gt;flags
op_amp
id|FLAG_RADIO_OFF
)paren
r_return
id|SUCCESS
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|MAC_ENABLE
suffix:semicolon
r_return
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
id|rsp
)paren
suffix:semicolon
)brace
DECL|function|disable_MAC
r_static
r_void
id|disable_MAC
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
id|Cmd
id|cmd
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|MAC_DISABLE
suffix:semicolon
singleline_comment|// disable in case already enabled
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
suffix:semicolon
)brace
DECL|function|enable_interrupts
r_static
r_void
id|enable_interrupts
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
multiline_comment|/* Reset the status register */
id|u16
id|status
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|EVSTAT
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|EVACK
comma
id|status
)paren
suffix:semicolon
multiline_comment|/* Enable the interrupts */
id|OUT4500
c_func
(paren
id|ai
comma
id|EVINTEN
comma
id|STATUS_INTS
)paren
suffix:semicolon
multiline_comment|/* Note there is a race condition between the last two lines that&n;&t;   I dont know how to get rid of right now... */
)brace
DECL|function|disable_interrupts
r_static
r_void
id|disable_interrupts
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|EVINTEN
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|setup_card
r_static
id|u16
id|setup_card
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u8
op_star
id|mac
comma
id|ConfigRid
op_star
id|config
)paren
(brace
id|Cmd
id|cmd
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
id|ConfigRid
id|cfg
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|i
suffix:semicolon
id|SsidRid
id|mySsid
suffix:semicolon
id|u16
id|lastindex
suffix:semicolon
id|WepKeyRid
id|wkr
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mySsid
comma
l_int|0
comma
r_sizeof
(paren
id|mySsid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ai-&gt;flash
)paren
(brace
id|kfree
(paren
id|ai-&gt;flash
)paren
suffix:semicolon
id|ai-&gt;flash
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* The NOP is the first step in getting the card going */
id|cmd.cmd
op_assign
id|NOP
suffix:semicolon
id|cmd.parm0
op_assign
id|cmd.parm1
op_assign
id|cmd.parm2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
op_ne
id|SUCCESS
)paren
(brace
r_return
id|ERROR
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|MAC_DISABLE
suffix:semicolon
singleline_comment|// disable in case already enabled
r_if
c_cond
(paren
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
op_ne
id|SUCCESS
)paren
(brace
r_return
id|ERROR
suffix:semicolon
)brace
singleline_comment|// Let&squot;s figure out if we need to use the AUX port
id|cmd.cmd
op_assign
id|CMD_ENABLEAUX
suffix:semicolon
r_if
c_cond
(paren
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
op_ne
id|SUCCESS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: Error checking for AUX port&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ERROR
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|aux_bap
op_logical_or
id|rsp.status
op_amp
l_int|0xff00
)paren
(brace
id|ai-&gt;bap_read
op_assign
id|fast_bap_read
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;airo: Doing fast bap_reads&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|ai-&gt;bap_read
op_assign
id|aux_bap_read
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;airo: Doing AUX bap_reads&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|config-&gt;len
)paren
(brace
id|cfg
op_assign
op_star
id|config
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// general configuration (read/modify/write)
id|status
op_assign
id|readConfigRid
c_func
(paren
id|ai
comma
op_amp
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|SUCCESS
)paren
r_return
id|ERROR
suffix:semicolon
id|cfg.opmode
op_assign
id|adhoc
ques
c_cond
id|MODE_STA_IBSS
suffix:colon
id|MODE_STA_ESS
suffix:semicolon
multiline_comment|/* Save off the MAC */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mac
(braket
id|i
)braket
op_assign
id|cfg.macAddr
(braket
id|i
)braket
suffix:semicolon
)brace
multiline_comment|/* Check to see if there are any insmod configured &n;&t;&t;   rates to add */
r_if
c_cond
(paren
id|rates
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rates
(braket
l_int|0
)braket
)paren
id|memset
c_func
(paren
id|cfg.rates
comma
l_int|0
comma
r_sizeof
(paren
id|cfg.rates
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
op_logical_and
id|rates
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cfg.rates
(braket
id|i
)braket
op_assign
id|rates
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|basic_rate
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cfg.rates
(braket
id|i
)braket
op_eq
id|basic_rate
op_logical_or
op_logical_neg
id|cfg.rates
)paren
(brace
id|cfg.rates
(braket
id|i
)braket
op_assign
id|basic_rate
op_or
l_int|0x80
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|cfg.authType
op_assign
id|ai-&gt;authtype
suffix:semicolon
op_star
id|config
op_assign
id|cfg
suffix:semicolon
)brace
multiline_comment|/* Setup the SSIDs if present */
r_if
c_cond
(paren
id|ssids
(braket
l_int|0
)braket
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
op_logical_and
id|ssids
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
op_assign
id|strlen
c_func
(paren
id|ssids
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
OG
l_int|32
)paren
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
op_assign
l_int|32
suffix:semicolon
id|memcpy
c_func
(paren
id|mySsid.ssids
(braket
id|i
)braket
dot
id|ssid
comma
id|ssids
(braket
id|i
)braket
comma
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
op_assign
id|mySsid.ssids
(braket
id|i
)braket
dot
id|len
suffix:semicolon
)brace
)brace
id|status
op_assign
id|writeConfigRid
c_func
(paren
id|ai
comma
op_amp
id|cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|SUCCESS
)paren
r_return
id|ERROR
suffix:semicolon
multiline_comment|/* Set up the SSID list */
id|status
op_assign
id|writeSsidRid
c_func
(paren
id|ai
comma
op_amp
id|mySsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|SUCCESS
)paren
r_return
id|ERROR
suffix:semicolon
multiline_comment|/* Grab the initial wep key, we gotta save it for auto_wep */
id|rc
op_assign
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
id|SUCCESS
)paren
r_do
(brace
id|lastindex
op_assign
id|wkr.kindex
suffix:semicolon
r_if
c_cond
(paren
id|wkr.kindex
op_eq
l_int|0xffff
)paren
(brace
id|ai-&gt;defindex
op_assign
id|wkr.mac
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|rc
op_assign
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|lastindex
op_ne
id|wkr.kindex
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|auto_wep
op_logical_and
op_logical_neg
id|timer_pending
c_func
(paren
op_amp
id|ai-&gt;timer
)paren
)paren
(brace
id|ai-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|ai-&gt;timer
)paren
suffix:semicolon
)brace
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|issuecommand
r_static
id|u16
id|issuecommand
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|Cmd
op_star
id|pCmd
comma
id|Resp
op_star
id|pRsp
)paren
(brace
singleline_comment|// Im really paranoid about letting it run forever!
r_int
id|max_tries
op_assign
l_int|600000
suffix:semicolon
r_int
id|rc
op_assign
id|SUCCESS
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ai-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|PARAM0
comma
id|pCmd-&gt;parm0
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|PARAM1
comma
id|pCmd-&gt;parm1
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|PARAM2
comma
id|pCmd-&gt;parm2
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|COMMAND
comma
id|pCmd-&gt;cmd
)paren
suffix:semicolon
r_while
c_loop
(paren
id|max_tries
op_decrement
op_logical_and
(paren
id|IN4500
c_func
(paren
id|ai
comma
id|EVSTAT
)paren
op_amp
id|EV_CMD
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|IN4500
c_func
(paren
id|ai
comma
id|COMMAND
)paren
op_eq
id|pCmd-&gt;cmd
)paren
(brace
singleline_comment|// PC4500 didn&squot;t notice command, try again
id|OUT4500
c_func
(paren
id|ai
comma
id|COMMAND
comma
id|pCmd-&gt;cmd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|max_tries
op_amp
l_int|255
)paren
op_logical_and
op_logical_neg
id|in_interrupt
c_func
(paren
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|max_tries
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: Max tries exceeded when issueing command&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|ERROR
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
singleline_comment|// command completed
id|pRsp-&gt;status
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|STATUS
)paren
suffix:semicolon
id|pRsp-&gt;rsp0
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|RESP0
)paren
suffix:semicolon
id|pRsp-&gt;rsp1
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|RESP1
)paren
suffix:semicolon
id|pRsp-&gt;rsp2
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|RESP2
)paren
suffix:semicolon
singleline_comment|// clear stuck command busy if necessary
r_if
c_cond
(paren
id|IN4500
c_func
(paren
id|ai
comma
id|COMMAND
)paren
op_amp
id|COMMAND_BUSY
)paren
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|EVACK
comma
id|EV_CLEARCOMMANDBUSY
)paren
suffix:semicolon
)brace
singleline_comment|// acknowledge processing the status/response
id|OUT4500
c_func
(paren
id|ai
comma
id|EVACK
comma
id|EV_CMD
)paren
suffix:semicolon
id|done
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Sets up the bap to start exchange data.  whichbap should&n; * be one of the BAP0 or BAP1 defines.  Locks should be held before&n; * calling! */
DECL|function|bap_setup
r_static
r_int
id|bap_setup
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|rid
comma
id|u16
id|offset
comma
r_int
id|whichbap
)paren
(brace
r_int
id|timeout
op_assign
l_int|50
suffix:semicolon
r_int
id|max_tries
op_assign
l_int|3
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|SELECT0
op_plus
id|whichbap
comma
id|rid
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|OFFSET0
op_plus
id|whichbap
comma
id|offset
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_int
id|status
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|OFFSET0
op_plus
id|whichbap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|BAP_BUSY
)paren
(brace
multiline_comment|/* This isn&squot;t really a timeout, but its kinda&n;&t;&t;&t;   close */
r_if
c_cond
(paren
id|timeout
op_decrement
)paren
(brace
r_continue
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|BAP_ERR
)paren
(brace
multiline_comment|/* invalid rid or offset */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: BAP error %x %d&bslash;n&quot;
comma
id|status
comma
id|whichbap
)paren
suffix:semicolon
r_return
id|ERROR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|BAP_DONE
)paren
(brace
singleline_comment|// success
r_return
id|SUCCESS
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|max_tries
op_decrement
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: BAP setup error too many retries&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ERROR
suffix:semicolon
)brace
singleline_comment|// -- PC4500 missed it, try again
id|OUT4500
c_func
(paren
id|ai
comma
id|SELECT0
op_plus
id|whichbap
comma
id|rid
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|OFFSET0
op_plus
id|whichbap
comma
id|offset
)paren
suffix:semicolon
id|timeout
op_assign
l_int|50
suffix:semicolon
)brace
)brace
multiline_comment|/* should only be called by aux_bap_read.  This aux function and the&n;   following use concepts not documented in the developers guide.  I&n;   got them from a patch given to my by Aironet */
DECL|function|aux_setup
r_static
id|u16
id|aux_setup
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|page
comma
id|u16
id|offset
comma
id|u16
op_star
id|len
)paren
(brace
id|u16
id|next
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXPAGE
comma
id|page
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXOFF
comma
l_int|0
)paren
suffix:semicolon
id|next
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|AUXDATA
)paren
suffix:semicolon
op_star
id|len
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|AUXDATA
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_ne
l_int|4
)paren
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXOFF
comma
id|offset
)paren
suffix:semicolon
r_return
id|next
suffix:semicolon
)brace
multiline_comment|/* requires call to bap_setup() first */
DECL|function|aux_bap_read
r_static
r_int
id|aux_bap_read
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
(brace
id|u16
id|len
suffix:semicolon
id|u16
id|page
suffix:semicolon
id|u16
id|offset
suffix:semicolon
id|u16
id|next
suffix:semicolon
r_int
id|words
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ai-&gt;aux_lock
comma
id|flags
)paren
suffix:semicolon
id|page
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|SWS0
op_plus
id|whichbap
)paren
suffix:semicolon
id|offset
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|SWS2
op_plus
id|whichbap
)paren
suffix:semicolon
id|next
op_assign
id|aux_setup
c_func
(paren
id|ai
comma
id|page
comma
id|offset
comma
op_amp
id|len
)paren
suffix:semicolon
id|words
op_assign
(paren
id|bytelen
op_plus
l_int|1
)paren
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|words
suffix:semicolon
)paren
(brace
r_int
id|count
suffix:semicolon
id|count
op_assign
(paren
id|len
op_rshift
l_int|1
)paren
OL
(paren
id|words
op_minus
id|i
)paren
ques
c_cond
(paren
id|len
op_rshift
l_int|1
)paren
suffix:colon
(paren
id|words
op_minus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|do8bitIO
)paren
id|insw
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Dst
op_plus
id|i
comma
id|count
)paren
suffix:semicolon
r_else
id|insb
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Dst
op_plus
id|i
comma
id|count
op_lshift
l_int|1
)paren
suffix:semicolon
id|i
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|words
)paren
(brace
id|next
op_assign
id|aux_setup
c_func
(paren
id|ai
comma
id|next
comma
l_int|4
comma
op_amp
id|len
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;aux_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
multiline_comment|/* requires call to bap_setup() first */
DECL|function|fast_bap_read
r_static
r_int
id|fast_bap_read
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
op_star
id|pu16Dst
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
(brace
id|bytelen
op_assign
(paren
id|bytelen
op_plus
l_int|1
)paren
op_amp
(paren
op_complement
l_int|1
)paren
suffix:semicolon
singleline_comment|// round up to even value
r_if
c_cond
(paren
op_logical_neg
id|do8bitIO
)paren
id|insw
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Dst
comma
id|bytelen
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|insb
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Dst
comma
id|bytelen
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
multiline_comment|/* requires call to bap_setup() first */
DECL|function|bap_write
r_static
r_int
id|bap_write
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
r_const
id|u16
op_star
id|pu16Src
comma
r_int
id|bytelen
comma
r_int
id|whichbap
)paren
(brace
id|bytelen
op_assign
(paren
id|bytelen
op_plus
l_int|1
)paren
op_amp
(paren
op_complement
l_int|1
)paren
suffix:semicolon
singleline_comment|// round up to even value
r_if
c_cond
(paren
op_logical_neg
id|do8bitIO
)paren
id|outsw
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Src
comma
id|bytelen
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|outsb
c_func
(paren
id|ai-&gt;dev-&gt;base_addr
op_plus
id|DATA0
op_plus
id|whichbap
comma
id|pu16Src
comma
id|bytelen
)paren
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
DECL|function|PC4500_accessrid
r_static
r_int
id|PC4500_accessrid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|rid
comma
id|u16
id|accmd
)paren
(brace
id|Cmd
id|cmd
suffix:semicolon
multiline_comment|/* for issuing commands */
id|Resp
id|rsp
suffix:semicolon
multiline_comment|/* response from commands */
id|u16
id|status
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|accmd
suffix:semicolon
id|cmd.parm0
op_assign
id|rid
suffix:semicolon
id|status
op_assign
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rsp.status
op_amp
l_int|0x7F00
)paren
op_ne
l_int|0
)paren
(brace
r_return
(paren
id|accmd
op_lshift
l_int|8
)paren
op_plus
(paren
id|rsp.rsp0
op_amp
l_int|0xFF
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*  Note, that we are using BAP1 which is also used by transmit, so&n; *  we must get a lock. */
DECL|function|PC4500_readrid
r_static
r_int
id|PC4500_readrid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|rid
comma
r_void
op_star
id|pBuf
comma
r_int
id|len
)paren
(brace
id|u16
id|status
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
id|SUCCESS
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|PC4500_accessrid
c_func
(paren
id|ai
comma
id|rid
comma
id|CMD_ACCESS
)paren
)paren
op_ne
id|SUCCESS
)paren
(brace
id|rc
op_assign
id|status
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bap_setup
c_func
(paren
id|ai
comma
id|rid
comma
l_int|0
comma
id|BAP1
)paren
op_ne
id|SUCCESS
)paren
(brace
id|rc
op_assign
id|ERROR
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
singleline_comment|// read the rid length field
id|bap_read
c_func
(paren
id|ai
comma
id|pBuf
comma
l_int|2
comma
id|BAP1
)paren
suffix:semicolon
singleline_comment|// length for remaining part of rid
id|len
op_assign
id|min
c_func
(paren
id|len
comma
id|le16_to_cpu
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
id|pBuf
)paren
)paren
op_minus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo: Rid %x has a length of %d which is too short&bslash;n&quot;
comma
(paren
r_int
)paren
id|rid
comma
(paren
r_int
)paren
id|len
)paren
suffix:semicolon
id|rc
op_assign
id|ERROR
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
singleline_comment|// read remainder of the rid
r_if
c_cond
(paren
id|bap_setup
c_func
(paren
id|ai
comma
id|rid
comma
l_int|2
comma
id|BAP1
)paren
op_ne
id|SUCCESS
)paren
(brace
id|rc
op_assign
id|ERROR
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|rc
op_assign
id|bap_read
c_func
(paren
id|ai
comma
(paren
(paren
id|u16
op_star
)paren
id|pBuf
)paren
op_plus
l_int|1
comma
id|len
comma
id|BAP1
)paren
suffix:semicolon
id|done
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*  Note, that we are using BAP1 which is also used by transmit, so&n; *  make sure this isnt called when a transmit is happening */
DECL|function|PC4500_writerid
r_static
r_int
id|PC4500_writerid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|rid
comma
r_const
r_void
op_star
id|pBuf
comma
r_int
id|len
)paren
(brace
id|u16
id|status
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
id|SUCCESS
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
singleline_comment|// --- first access so that we can write the rid data
r_if
c_cond
(paren
(paren
id|status
op_assign
id|PC4500_accessrid
c_func
(paren
id|ai
comma
id|rid
comma
id|CMD_ACCESS
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|rc
op_assign
id|status
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
singleline_comment|// --- now write the rid data
r_if
c_cond
(paren
id|bap_setup
c_func
(paren
id|ai
comma
id|rid
comma
l_int|0
comma
id|BAP1
)paren
op_ne
id|SUCCESS
)paren
(brace
id|rc
op_assign
id|ERROR
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|bap_write
c_func
(paren
id|ai
comma
id|pBuf
comma
id|len
comma
id|BAP1
)paren
suffix:semicolon
singleline_comment|// ---now commit the rid data
id|rc
op_assign
id|PC4500_accessrid
c_func
(paren
id|ai
comma
id|rid
comma
l_int|0x100
op_or
id|CMD_ACCESS
)paren
suffix:semicolon
id|done
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Allocates a FID to be used for transmitting packets.  We only use&n;   one for now. */
DECL|function|transmit_allocate
r_static
id|u16
id|transmit_allocate
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
r_int
id|lenPayload
)paren
(brace
id|Cmd
id|cmd
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
id|u16
id|txFid
suffix:semicolon
id|u16
id|txControl
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|cmd.cmd
op_assign
id|CMD_ALLOCATETX
suffix:semicolon
id|cmd.parm0
op_assign
id|lenPayload
suffix:semicolon
r_if
c_cond
(paren
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
op_ne
id|SUCCESS
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rsp.status
op_amp
l_int|0xFF00
)paren
op_ne
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* wait for the allocate event/indication&n;&t; * It makes me kind of nervous that this can just sit here and spin,&n;&t; * but in practice it only loops like four times. */
r_while
c_loop
(paren
(paren
id|IN4500
c_func
(paren
id|ai
comma
id|EVSTAT
)paren
op_amp
id|EV_ALLOC
)paren
op_eq
l_int|0
)paren
suffix:semicolon
singleline_comment|// get the allocated fid and acknowledge
id|txFid
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|TXALLOCFID
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|EVACK
comma
id|EV_ALLOC
)paren
suffix:semicolon
multiline_comment|/*  The CARD is pretty cool since it converts the ethernet packet&n;&t; *  into 802.11.  Also note that we don&squot;t release the FID since we&n;&t; *  will be using the same one over and over again. */
multiline_comment|/*  We only have to setup the control once since we are not&n;&t; *  releasing the fid. */
id|txControl
op_assign
id|cpu_to_le16
c_func
(paren
id|TXCTL_TXOK
op_or
id|TXCTL_TXEX
op_or
id|TXCTL_802_3
op_or
id|TXCTL_ETHERNET
op_or
id|TXCTL_NORELEASE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bap_setup
c_func
(paren
id|ai
comma
id|txFid
comma
l_int|0x0008
comma
id|BAP1
)paren
op_ne
id|SUCCESS
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ERROR
suffix:semicolon
)brace
id|bap_write
c_func
(paren
id|ai
comma
op_amp
id|txControl
comma
r_sizeof
(paren
id|txControl
)paren
comma
id|BAP1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ai-&gt;bap1_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|txFid
suffix:semicolon
)brace
multiline_comment|/* In general BAP1 is dedicated to transmiting packets.  However,&n;   since we need a BAP when accessing RIDs, we also use BAP1 for that.&n;   Make sure the BAP1 spinlock is held when this is called. */
DECL|function|transmit_802_3_packet
r_static
r_int
id|transmit_802_3_packet
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|txFid
comma
r_char
op_star
id|pPacket
comma
r_int
id|len
)paren
(brace
id|u16
id|payloadLen
suffix:semicolon
id|Cmd
id|cmd
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|12
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Short packet %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_return
id|ERROR
suffix:semicolon
)brace
singleline_comment|// packet is destination[6], source[6], payload[len-12]
singleline_comment|// write the payload length and dst/src/payload
r_if
c_cond
(paren
id|bap_setup
c_func
(paren
id|ai
comma
id|txFid
comma
l_int|0x0036
comma
id|BAP1
)paren
op_ne
id|SUCCESS
)paren
r_return
id|ERROR
suffix:semicolon
multiline_comment|/* The hardware addresses aren&squot;t counted as part of the payload, so&n;&t; * we have to subtract the 12 bytes for the addresses off */
id|payloadLen
op_assign
id|cpu_to_le16
c_func
(paren
id|len
op_minus
l_int|12
)paren
suffix:semicolon
id|bap_write
c_func
(paren
id|ai
comma
op_amp
id|payloadLen
comma
r_sizeof
(paren
id|payloadLen
)paren
comma
id|BAP1
)paren
suffix:semicolon
id|bap_write
c_func
(paren
id|ai
comma
(paren
r_const
id|u16
op_star
)paren
id|pPacket
comma
id|len
comma
id|BAP1
)paren
suffix:semicolon
singleline_comment|// issue the transmit command
id|memset
c_func
(paren
op_amp
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
id|cmd
)paren
)paren
suffix:semicolon
id|cmd.cmd
op_assign
id|CMD_TRANSMIT
suffix:semicolon
id|cmd.parm0
op_assign
id|txFid
suffix:semicolon
r_if
c_cond
(paren
id|issuecommand
c_func
(paren
id|ai
comma
op_amp
id|cmd
comma
op_amp
id|rsp
)paren
op_ne
id|SUCCESS
)paren
r_return
id|ERROR
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rsp.status
op_amp
l_int|0xFF00
)paren
op_ne
l_int|0
)paren
r_return
id|ERROR
suffix:semicolon
r_return
id|SUCCESS
suffix:semicolon
)brace
multiline_comment|/*&n; *  This is the proc_fs routines.  It is a bit messier than I would&n; *  like!  Feel free to clean it up!&n; */
multiline_comment|/*&n; *  Unfortunately sometime between 2.0 and 2.2 the proc interface changed...&n; *  Unfortunately I dont know when it was...&n; *  Im guessing it is sometime around 0x20155...  Anybody know?&n; */
r_static
id|ssize_t
id|proc_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
id|ssize_t
id|proc_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
r_int
id|proc_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_stats_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_statsdelta_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_status_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_SSID_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_APList_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_config_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|proc_wepkey_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
DECL|variable|proc_statsdelta_ops
r_static
r_struct
id|file_operations
id|proc_statsdelta_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|open
suffix:colon
id|proc_statsdelta_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_stats_ops
r_static
r_struct
id|file_operations
id|proc_stats_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|open
suffix:colon
id|proc_stats_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_status_ops
r_static
r_struct
id|file_operations
id|proc_status_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|open
suffix:colon
id|proc_status_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_SSID_ops
r_static
r_struct
id|file_operations
id|proc_SSID_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|write
suffix:colon
id|proc_write
comma
id|open
suffix:colon
id|proc_SSID_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_APList_ops
r_static
r_struct
id|file_operations
id|proc_APList_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|write
suffix:colon
id|proc_write
comma
id|open
suffix:colon
id|proc_APList_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_config_ops
r_static
r_struct
id|file_operations
id|proc_config_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|write
suffix:colon
id|proc_write
comma
id|open
suffix:colon
id|proc_config_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|proc_wepkey_ops
r_static
r_struct
id|file_operations
id|proc_wepkey_ops
op_assign
(brace
id|read
suffix:colon
id|proc_read
comma
id|write
suffix:colon
id|proc_write
comma
id|open
suffix:colon
id|proc_wepkey_open
comma
id|release
suffix:colon
id|proc_close
)brace
suffix:semicolon
DECL|variable|airo_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|airo_entry
op_assign
l_int|0
suffix:semicolon
DECL|struct|proc_data
r_struct
id|proc_data
(brace
DECL|member|release_buffer
r_int
id|release_buffer
suffix:semicolon
DECL|member|readlen
r_int
id|readlen
suffix:semicolon
DECL|member|rbuffer
r_char
op_star
id|rbuffer
suffix:semicolon
DECL|member|writelen
r_int
id|writelen
suffix:semicolon
DECL|member|maxwritelen
r_int
id|maxwritelen
suffix:semicolon
DECL|member|wbuffer
r_char
op_star
id|wbuffer
suffix:semicolon
DECL|member|on_close
r_void
(paren
op_star
id|on_close
)paren
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|function|setup_proc_entry
r_static
r_int
id|setup_proc_entry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|airo_info
op_star
id|apriv
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
multiline_comment|/* First setup the device directory */
id|apriv-&gt;proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|dev-&gt;name
comma
id|S_IFDIR
op_or
id|airo_perm
comma
id|airo_entry
)paren
suffix:semicolon
id|apriv-&gt;proc_entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|apriv-&gt;proc_entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
multiline_comment|/* Setup the StatsDelta */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;StatsDelta&quot;
comma
id|S_IFREG
op_or
(paren
id|S_IRUGO
op_amp
id|proc_perm
)paren
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&t;This is what was needed right up to the last few versions&n;        of 2.3:&n;&t;entry-&gt;ops = &amp;proc_inode_statsdelta_ops;&n;*/
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_statsdelta_ops
suffix:semicolon
multiline_comment|/* Setup the Stats */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;Stats&quot;
comma
id|S_IFREG
op_or
(paren
id|S_IRUGO
op_amp
id|proc_perm
)paren
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_stats_ops
suffix:semicolon
multiline_comment|/* Setup the Status */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;Status&quot;
comma
id|S_IFREG
op_or
(paren
id|S_IRUGO
op_amp
id|proc_perm
)paren
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_status_ops
suffix:semicolon
multiline_comment|/* Setup the Config */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;Config&quot;
comma
id|S_IFREG
op_or
id|proc_perm
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_config_ops
suffix:semicolon
multiline_comment|/* Setup the SSID */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;SSID&quot;
comma
id|S_IFREG
op_or
id|proc_perm
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_SSID_ops
suffix:semicolon
multiline_comment|/* Setup the APList */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;APList&quot;
comma
id|S_IFREG
op_or
id|proc_perm
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_APList_ops
suffix:semicolon
multiline_comment|/* Setup the WepKey */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;WepKey&quot;
comma
id|S_IFREG
op_or
id|proc_perm
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
id|entry-&gt;data
op_assign
id|dev
suffix:semicolon
id|entry-&gt;proc_fops
op_assign
op_amp
id|proc_wepkey_ops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|takedown_proc_entry
r_static
r_int
id|takedown_proc_entry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|airo_info
op_star
id|apriv
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|apriv-&gt;proc_entry-&gt;namelen
)paren
r_return
l_int|0
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;Stats&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;StatsDelta&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;Status&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;Config&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;SSID&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;APList&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;WepKey&quot;
comma
id|apriv-&gt;proc_entry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|dev-&gt;name
comma
id|airo_entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  What we want from the proc_fs is to be able to efficiently read&n; *  and write the configuration.  To do this, we want to read the&n; *  configuration when the file is opened and write it when the file is&n; *  closed.  So basically we allocate a read buffer at open and fill it&n; *  with data, and allocate a write buffer and read it at close.&n; */
multiline_comment|/*&n; *  The read routine is generic, it relies on the preallocated rbuffer&n; *  to supply the data.&n; */
DECL|function|proc_read
r_static
id|ssize_t
id|proc_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buffer
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|pos
suffix:semicolon
r_struct
id|proc_data
op_star
id|priv
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;rbuffer
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pos
op_assign
op_star
id|offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_plus
id|pos
OL
id|priv-&gt;readlen
op_logical_and
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|priv-&gt;rbuffer
(braket
id|i
op_plus
id|pos
)braket
comma
id|buffer
op_plus
id|i
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
op_star
id|offset
op_add_assign
id|i
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/*&n; *  The write routine is generic, it fills in a preallocated rbuffer&n; *  to supply the data.&n; */
DECL|function|proc_write
r_static
id|ssize_t
id|proc_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
id|len
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|pos
suffix:semicolon
r_struct
id|proc_data
op_star
id|priv
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wbuffer
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pos
op_assign
op_star
id|offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_plus
id|pos
OL
id|priv-&gt;maxwritelen
op_logical_and
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|priv-&gt;wbuffer
(braket
id|i
op_plus
id|pos
)braket
comma
id|buffer
op_plus
id|i
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_plus
id|pos
OG
id|priv-&gt;writelen
)paren
id|priv-&gt;writelen
op_assign
id|i
op_plus
id|file-&gt;f_pos
suffix:semicolon
op_star
id|offset
op_add_assign
id|i
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
DECL|function|proc_status_open
r_static
r_int
id|proc_status_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|apriv
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|CapabilityRid
id|cap_rid
suffix:semicolon
id|StatusRid
id|status_rid
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|2048
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|readStatusRid
c_func
(paren
id|apriv
comma
op_amp
id|status_rid
)paren
suffix:semicolon
id|readCapabilityRid
c_func
(paren
id|apriv
comma
op_amp
id|cap_rid
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|data-&gt;rbuffer
comma
l_string|&quot;Mode: %x&bslash;n&quot;
l_string|&quot;Signal Strength: %d&bslash;n&quot;
l_string|&quot;Signal Quality: %d&bslash;n&quot;
l_string|&quot;SSID: %-.*s&bslash;n&quot;
l_string|&quot;AP: %-.16s&bslash;n&quot;
l_string|&quot;Freq: %d&bslash;n&quot;
l_string|&quot;BitRate: %dmbs&bslash;n&quot;
l_string|&quot;Driver Version: %s&bslash;n&quot;
l_string|&quot;Device: %s&bslash;nManufacturer: %s&bslash;nFirmware Version: %s&bslash;n&quot;
l_string|&quot;Radio type: %x&bslash;nCountry: %x&bslash;nHardware Version: %x&bslash;n&quot;
l_string|&quot;Software Version: %x&bslash;nSoftware Subversion: %x&bslash;n&quot;
l_string|&quot;Boot block version: %x&bslash;n&quot;
comma
(paren
r_int
)paren
id|status_rid.mode
comma
(paren
r_int
)paren
id|status_rid.normalizedSignalStrength
comma
(paren
r_int
)paren
id|status_rid.signalQuality
comma
(paren
r_int
)paren
id|status_rid.SSIDlen
comma
id|status_rid.SSID
comma
id|status_rid.apName
comma
(paren
r_int
)paren
id|status_rid.channel
comma
(paren
r_int
)paren
id|status_rid.currentXmitRate
op_div
l_int|2
comma
id|version
comma
id|cap_rid.prodName
comma
id|cap_rid.manName
comma
id|cap_rid.prodVer
comma
id|cap_rid.radioType
comma
id|cap_rid.country
comma
id|cap_rid.hardVer
comma
(paren
r_int
)paren
id|cap_rid.softVer
comma
(paren
r_int
)paren
id|cap_rid.softSubVer
comma
(paren
r_int
)paren
id|cap_rid.bootBlockVer
)paren
suffix:semicolon
id|data-&gt;readlen
op_assign
id|strlen
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|proc_stats_rid_open
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
id|u16
)paren
suffix:semicolon
DECL|function|proc_statsdelta_open
r_static
r_int
id|proc_statsdelta_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_return
id|proc_stats_rid_open
c_func
(paren
id|inode
comma
id|file
comma
id|RID_STATSDELTACLEAR
)paren
suffix:semicolon
)brace
r_return
id|proc_stats_rid_open
c_func
(paren
id|inode
comma
id|file
comma
id|RID_STATSDELTA
)paren
suffix:semicolon
)brace
DECL|function|proc_stats_open
r_static
r_int
id|proc_stats_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|proc_stats_rid_open
c_func
(paren
id|inode
comma
id|file
comma
id|RID_STATS
)paren
suffix:semicolon
)brace
DECL|function|proc_stats_rid_open
r_static
r_int
id|proc_stats_rid_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
id|u16
id|rid
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|apriv
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|StatsRid
id|stats
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_int
op_star
id|vals
op_assign
id|stats.vals
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|4096
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|readStatsRid
c_func
(paren
id|apriv
comma
op_amp
id|stats
comma
id|rid
)paren
suffix:semicolon
id|j
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
r_int
)paren
id|statsLabels
(braket
id|i
)braket
op_ne
op_minus
l_int|1
op_logical_and
id|i
op_star
l_int|4
OL
id|stats.len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|statsLabels
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|j
op_plus
id|strlen
c_func
(paren
id|statsLabels
(braket
id|i
)braket
)paren
op_plus
l_int|16
OG
l_int|4096
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;airo: Potentially disasterous buffer overflow averted!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|data-&gt;rbuffer
op_plus
id|j
comma
l_string|&quot;%s: %d&bslash;n&quot;
comma
id|statsLabels
(braket
id|i
)braket
comma
id|vals
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_star
l_int|4
op_ge
id|stats.len
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;airo: Got a short rid&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|data-&gt;readlen
op_assign
id|j
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_dec_u16
r_static
r_int
id|get_dec_u16
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
op_star
id|start
comma
r_int
id|limit
)paren
(brace
id|u16
id|value
suffix:semicolon
r_int
id|valid
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|value
op_assign
l_int|0
suffix:semicolon
id|buffer
(braket
op_star
id|start
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
id|buffer
(braket
op_star
id|start
)braket
op_le
l_char|&squot;9&squot;
op_logical_and
op_star
id|start
OL
id|limit
suffix:semicolon
(paren
op_star
id|start
)paren
op_increment
)paren
(brace
id|valid
op_assign
l_int|1
suffix:semicolon
id|value
op_mul_assign
l_int|10
suffix:semicolon
id|value
op_add_assign
id|buffer
(braket
op_star
id|start
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|valid
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|checkThrottle
r_static
r_void
id|checkThrottle
c_func
(paren
id|ConfigRid
op_star
id|config
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Old hardware had a limit on encryption speed */
r_if
c_cond
(paren
id|config-&gt;authType
op_ne
id|AUTH_OPEN
op_logical_and
id|maxencrypt
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|config-&gt;rates
(braket
id|i
)braket
OG
id|maxencrypt
)paren
(brace
id|config-&gt;rates
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|proc_config_on_close
r_static
r_void
id|proc_config_on_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ConfigRid
id|config
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
r_char
op_star
id|line
suffix:semicolon
r_int
id|need_reset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;writelen
)paren
r_return
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
id|disable_MAC
c_func
(paren
id|ai
)paren
suffix:semicolon
id|readConfigRid
c_func
(paren
id|ai
comma
op_amp
id|config
)paren
suffix:semicolon
id|line
op_assign
id|data-&gt;wbuffer
suffix:semicolon
r_while
c_loop
(paren
id|line
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/*** Mode processing */
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;Mode: &quot;
comma
l_int|6
)paren
)paren
(brace
id|line
op_add_assign
l_int|6
suffix:semicolon
id|config.rmode
op_and_assign
l_int|0xfe00
suffix:semicolon
r_if
c_cond
(paren
id|line
(braket
l_int|0
)braket
op_eq
l_char|&squot;a&squot;
)paren
(brace
id|config.opmode
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|config.opmode
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|line
(braket
l_int|0
)braket
op_eq
l_char|&squot;r&squot;
)paren
id|config.rmode
op_or_assign
id|RXMODE_RFMON
op_or
id|RXMODE_DISABLE_802_3_HEADER
suffix:semicolon
r_else
r_if
c_cond
(paren
id|line
(braket
l_int|0
)braket
op_eq
l_char|&squot;y&squot;
)paren
id|config.rmode
op_or_assign
id|RXMODE_RFMON_ANYBSS
op_or
id|RXMODE_DISABLE_802_3_HEADER
suffix:semicolon
)brace
r_if
c_cond
(paren
id|config.rmode
op_amp
id|RXMODE_DISABLE_802_3_HEADER
)paren
(brace
id|dev-&gt;type
op_assign
id|ARPHRD_IEEE80211
suffix:semicolon
id|dev-&gt;hard_header_parse
op_assign
id|wll_header_parse
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE80211
)paren
(brace
id|dev-&gt;type
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|dev-&gt;hard_header_parse
op_assign
id|ai-&gt;header_parse
suffix:semicolon
id|need_reset
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/*** Radio status */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;Radio: &quot;
comma
l_int|7
)paren
)paren
(brace
id|line
op_add_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;off&quot;
comma
l_int|3
)paren
)paren
(brace
id|ai-&gt;flags
op_or_assign
id|FLAG_RADIO_OFF
suffix:semicolon
)brace
r_else
(brace
id|ai-&gt;flags
op_and_assign
op_complement
id|FLAG_RADIO_OFF
suffix:semicolon
)brace
)brace
multiline_comment|/*** NodeName processing */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;NodeName: &quot;
comma
l_int|10
)paren
)paren
(brace
r_int
id|j
suffix:semicolon
id|line
op_add_assign
l_int|10
suffix:semicolon
id|memset
c_func
(paren
id|config.nodeName
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Do the name, assume a space between the mode and node name */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
op_logical_and
id|line
(braket
id|j
)braket
op_ne
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|j
op_increment
)paren
(brace
id|config.nodeName
(braket
id|j
)braket
op_assign
id|line
(braket
id|j
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/*** PowerMode processing */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;PowerMode: &quot;
comma
l_int|11
)paren
)paren
(brace
id|line
op_add_assign
l_int|11
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;PSPCAM&quot;
comma
l_int|6
)paren
)paren
(brace
id|config.powerSaveMode
op_assign
id|POWERSAVE_PSPCAM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;PSP&quot;
comma
l_int|3
)paren
)paren
(brace
id|config.powerSaveMode
op_assign
id|POWERSAVE_PSP
suffix:semicolon
)brace
r_else
(brace
id|config.powerSaveMode
op_assign
id|POWERSAVE_CAM
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;DataRates: &quot;
comma
l_int|11
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
comma
id|k
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* i is index into line, &n;&t;&t;&t;&t;&t;&t;k is index to rates */
id|line
op_add_assign
l_int|11
suffix:semicolon
r_while
c_loop
(paren
(paren
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|3
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|config.rates
(braket
id|k
op_increment
)braket
op_assign
(paren
id|u8
)paren
id|v
suffix:semicolon
id|line
op_add_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;Channel: &quot;
comma
l_int|9
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|9
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
id|i
op_plus
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_ne
op_minus
l_int|1
)paren
id|config.channelSet
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;XmitPower: &quot;
comma
l_int|11
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|11
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
id|i
op_plus
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_ne
op_minus
l_int|1
)paren
id|config.txPower
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;WEP: &quot;
comma
l_int|5
)paren
)paren
(brace
id|line
op_add_assign
l_int|5
suffix:semicolon
r_switch
c_cond
(paren
id|line
(braket
l_int|0
)braket
)paren
(brace
r_case
l_char|&squot;s&squot;
suffix:colon
id|config.authType
op_assign
(paren
id|u16
)paren
id|AUTH_SHAREDKEY
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;e&squot;
suffix:colon
id|config.authType
op_assign
(paren
id|u16
)paren
id|AUTH_ENCRYPT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|config.authType
op_assign
(paren
id|u16
)paren
id|AUTH_OPEN
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;LongRetryLimit: &quot;
comma
l_int|16
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|16
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|3
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
(paren
id|v
OG
l_int|255
)paren
ques
c_cond
l_int|255
suffix:colon
id|v
)paren
suffix:semicolon
id|config.longRetryLimit
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;ShortRetryLimit: &quot;
comma
l_int|17
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|17
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|3
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
(paren
id|v
OG
l_int|255
)paren
ques
c_cond
l_int|255
suffix:colon
id|v
)paren
suffix:semicolon
id|config.shortRetryLimit
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;RTSThreshold: &quot;
comma
l_int|14
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|14
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
(paren
id|v
OG
l_int|2312
)paren
ques
c_cond
l_int|2312
suffix:colon
id|v
)paren
suffix:semicolon
id|config.rtsThres
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;TXMSDULifetime: &quot;
comma
l_int|16
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|16
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|5
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
id|v
suffix:semicolon
id|config.txLifetime
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;RXMSDULifetime: &quot;
comma
l_int|16
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|16
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|5
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
id|v
suffix:semicolon
id|config.rxLifetime
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;TXDiversity: &quot;
comma
l_int|13
)paren
)paren
(brace
id|config.txDiversity
op_assign
(paren
id|line
(braket
l_int|13
)braket
op_eq
l_char|&squot;l&squot;
)paren
ques
c_cond
l_int|1
suffix:colon
(paren
(paren
id|line
(braket
l_int|13
)braket
op_eq
l_char|&squot;r&squot;
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|3
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;RXDiversity: &quot;
comma
l_int|13
)paren
)paren
(brace
id|config.rxDiversity
op_assign
(paren
id|line
(braket
l_int|13
)braket
op_eq
l_char|&squot;l&squot;
)paren
ques
c_cond
l_int|1
suffix:colon
(paren
(paren
id|line
(braket
l_int|13
)braket
op_eq
l_char|&squot;r&squot;
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|3
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;FragThreshold: &quot;
comma
l_int|15
)paren
)paren
(brace
r_int
id|v
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|line
op_add_assign
l_int|15
suffix:semicolon
id|v
op_assign
id|get_dec_u16
c_func
(paren
id|line
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
id|v
op_assign
(paren
id|v
OL
l_int|256
)paren
ques
c_cond
l_int|256
suffix:colon
(paren
(paren
id|v
OG
l_int|2312
)paren
ques
c_cond
l_int|2312
suffix:colon
id|v
)paren
suffix:semicolon
id|v
op_assign
id|v
op_amp
l_int|0xfffe
suffix:semicolon
multiline_comment|/* Make sure its even */
id|config.fragThresh
op_assign
(paren
id|u16
)paren
id|v
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;Modulation: &quot;
comma
l_int|12
)paren
)paren
(brace
id|line
op_add_assign
l_int|12
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|line
)paren
(brace
r_case
l_char|&squot;d&squot;
suffix:colon
id|config.modulation
op_assign
id|MOD_DEFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;c&squot;
suffix:colon
id|config.modulation
op_assign
id|MOD_CCK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
id|config.modulation
op_assign
id|MOD_MOK
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;airo: Unknown modulation&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Couldn&squot;t figure out %s&bslash;n&quot;
comma
id|line
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|line
(braket
l_int|0
)braket
op_logical_and
id|line
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|line
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line
(braket
l_int|0
)braket
)paren
id|line
op_increment
suffix:semicolon
)brace
id|checkThrottle
c_func
(paren
op_amp
id|config
)paren
suffix:semicolon
id|ai-&gt;config
op_assign
id|config
suffix:semicolon
r_if
c_cond
(paren
id|need_reset
)paren
(brace
id|APListRid
id|APList_rid
suffix:semicolon
id|SsidRid
id|SSID_rid
suffix:semicolon
id|readAPListRid
c_func
(paren
id|ai
comma
op_amp
id|APList_rid
)paren
suffix:semicolon
id|readSsidRid
c_func
(paren
id|ai
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
id|reset_airo_card
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writeSsidRid
c_func
(paren
id|ai
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
id|writeAPListRid
c_func
(paren
id|ai
comma
op_amp
id|APList_rid
)paren
suffix:semicolon
)brace
id|writeConfigRid
c_func
(paren
id|ai
comma
op_amp
id|config
)paren
suffix:semicolon
id|enable_MAC
c_func
(paren
id|ai
comma
op_amp
id|rsp
)paren
suffix:semicolon
)brace
DECL|function|proc_config_open
r_static
r_int
id|proc_config_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|ConfigRid
id|config
suffix:semicolon
r_int
id|i
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|2048
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|data-&gt;wbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|2048
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;wbuffer
comma
l_int|0
comma
l_int|2048
)paren
suffix:semicolon
id|data-&gt;maxwritelen
op_assign
l_int|2048
suffix:semicolon
id|data-&gt;on_close
op_assign
id|proc_config_on_close
suffix:semicolon
id|readConfigRid
c_func
(paren
id|ai
comma
op_amp
id|config
)paren
suffix:semicolon
id|i
op_assign
id|sprintf
c_func
(paren
id|data-&gt;rbuffer
comma
l_string|&quot;Mode: %s&bslash;n&quot;
l_string|&quot;Radio: %s&bslash;n&quot;
l_string|&quot;NodeName: %-16s&bslash;n&quot;
l_string|&quot;PowerMode: %s&bslash;n&quot;
l_string|&quot;DataRates: %d %d %d %d %d %d %d %d&bslash;n&quot;
l_string|&quot;Channel: %d&bslash;n&quot;
l_string|&quot;XmitPower: %d&bslash;n&quot;
comma
id|config.opmode
op_eq
l_int|0
ques
c_cond
l_string|&quot;adhoc&quot;
suffix:colon
id|config.opmode
op_eq
l_int|1
ques
c_cond
l_string|&quot;ESS&quot;
suffix:colon
id|config.opmode
op_eq
l_int|2
ques
c_cond
l_string|&quot;AP&quot;
suffix:colon
id|config.opmode
op_eq
l_int|3
ques
c_cond
l_string|&quot;AP RPTR&quot;
suffix:colon
l_string|&quot;Error&quot;
comma
id|ai-&gt;flags
op_amp
id|FLAG_RADIO_OFF
ques
c_cond
l_string|&quot;off&quot;
suffix:colon
l_string|&quot;on&quot;
comma
id|config.nodeName
comma
id|config.powerSaveMode
op_eq
l_int|0
ques
c_cond
l_string|&quot;CAM&quot;
suffix:colon
id|config.powerSaveMode
op_eq
l_int|1
ques
c_cond
l_string|&quot;PSP&quot;
suffix:colon
id|config.powerSaveMode
op_eq
l_int|2
ques
c_cond
l_string|&quot;PSPCAM&quot;
suffix:colon
l_string|&quot;Error&quot;
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|2
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|3
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|4
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|5
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|6
)braket
comma
(paren
r_int
)paren
id|config.rates
(braket
l_int|7
)braket
comma
(paren
r_int
)paren
id|config.channelSet
comma
(paren
r_int
)paren
id|config.txPower
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|data-&gt;rbuffer
op_plus
id|i
comma
l_string|&quot;LongRetryLimit: %d&bslash;n&quot;
l_string|&quot;ShortRetryLimit: %d&bslash;n&quot;
l_string|&quot;RTSThreshold: %d&bslash;n&quot;
l_string|&quot;TXMSDULifetime: %d&bslash;n&quot;
l_string|&quot;RXMSDULifetime: %d&bslash;n&quot;
l_string|&quot;TXDiversity: %s&bslash;n&quot;
l_string|&quot;RXDiversity: %s&bslash;n&quot;
l_string|&quot;FragThreshold: %d&bslash;n&quot;
l_string|&quot;WEP: %s&bslash;n&quot;
l_string|&quot;Modulation: %s&bslash;n&quot;
comma
(paren
r_int
)paren
id|config.longRetryLimit
comma
(paren
r_int
)paren
id|config.shortRetryLimit
comma
(paren
r_int
)paren
id|config.rtsThres
comma
(paren
r_int
)paren
id|config.txLifetime
comma
(paren
r_int
)paren
id|config.rxLifetime
comma
id|config.txDiversity
op_eq
l_int|1
ques
c_cond
l_string|&quot;left&quot;
suffix:colon
id|config.txDiversity
op_eq
l_int|2
ques
c_cond
l_string|&quot;right&quot;
suffix:colon
l_string|&quot;both&quot;
comma
id|config.rxDiversity
op_eq
l_int|1
ques
c_cond
l_string|&quot;left&quot;
suffix:colon
id|config.rxDiversity
op_eq
l_int|2
ques
c_cond
l_string|&quot;right&quot;
suffix:colon
l_string|&quot;both&quot;
comma
(paren
r_int
)paren
id|config.fragThresh
comma
id|config.authType
op_eq
id|AUTH_ENCRYPT
ques
c_cond
l_string|&quot;encrypt&quot;
suffix:colon
id|config.authType
op_eq
id|AUTH_SHAREDKEY
ques
c_cond
l_string|&quot;shared&quot;
suffix:colon
l_string|&quot;open&quot;
comma
id|config.modulation
op_eq
l_int|0
ques
c_cond
l_string|&quot;default&quot;
suffix:colon
id|config.modulation
op_eq
id|MOD_CCK
ques
c_cond
l_string|&quot;cck&quot;
suffix:colon
id|config.modulation
op_eq
id|MOD_MOK
ques
c_cond
l_string|&quot;mok&quot;
suffix:colon
l_string|&quot;error&quot;
)paren
suffix:semicolon
id|data-&gt;readlen
op_assign
id|strlen
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_SSID_on_close
r_static
r_void
id|proc_SSID_on_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|SsidRid
id|SSID_rid
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;writelen
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|SSID_rid
comma
l_int|0
comma
r_sizeof
(paren
id|SSID_rid
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
op_plus
id|offset
OL
id|data-&gt;writelen
op_logical_and
id|j
OL
l_int|32
op_logical_and
id|data-&gt;wbuffer
(braket
id|offset
op_plus
id|j
)braket
op_ne
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|j
op_increment
)paren
(brace
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|ssid
(braket
id|j
)braket
op_assign
id|data-&gt;wbuffer
(braket
id|offset
op_plus
id|j
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|j
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|len
op_assign
id|j
suffix:semicolon
id|offset
op_add_assign
id|j
suffix:semicolon
r_while
c_loop
(paren
id|data-&gt;wbuffer
(braket
id|offset
)braket
op_ne
l_char|&squot;&bslash;n&squot;
op_logical_and
id|offset
OL
id|data-&gt;writelen
)paren
(brace
id|offset
op_increment
suffix:semicolon
)brace
id|offset
op_increment
suffix:semicolon
)brace
id|writeSsidRid
c_func
(paren
id|ai
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
)brace
DECL|function|hexVal
r_inline
r_static
id|u8
id|hexVal
c_func
(paren
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;0&squot;
op_logical_and
id|c
op_le
l_char|&squot;9&squot;
)paren
r_return
id|c
op_sub_assign
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;a&squot;
op_logical_and
id|c
op_le
l_char|&squot;f&squot;
)paren
r_return
id|c
op_sub_assign
l_char|&squot;a&squot;
op_minus
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ge
l_char|&squot;A&squot;
op_logical_and
id|c
op_le
l_char|&squot;F&squot;
)paren
r_return
id|c
op_sub_assign
l_char|&squot;A&squot;
op_minus
l_int|10
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_APList_on_close
r_static
r_void
id|proc_APList_on_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|APListRid
id|APList_rid
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;writelen
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|APList_rid
comma
l_int|0
comma
r_sizeof
(paren
id|APList_rid
)paren
)paren
suffix:semicolon
id|APList_rid.len
op_assign
r_sizeof
(paren
id|APList_rid
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
op_logical_and
id|data-&gt;writelen
op_ge
(paren
id|i
op_plus
l_int|1
)paren
op_star
l_int|6
op_star
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|6
op_star
l_int|3
op_logical_and
id|data-&gt;wbuffer
(braket
id|j
op_plus
id|i
op_star
l_int|6
op_star
l_int|3
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|j
op_mod
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|APList_rid.ap
(braket
id|i
)braket
(braket
id|j
op_div
l_int|3
)braket
op_assign
id|hexVal
c_func
(paren
id|data-&gt;wbuffer
(braket
id|j
op_plus
id|i
op_star
l_int|6
op_star
l_int|3
)braket
)paren
op_lshift
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|APList_rid.ap
(braket
id|i
)braket
(braket
id|j
op_div
l_int|3
)braket
op_or_assign
id|hexVal
c_func
(paren
id|data-&gt;wbuffer
(braket
id|j
op_plus
id|i
op_star
l_int|6
op_star
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|writeAPListRid
c_func
(paren
id|ai
comma
op_amp
id|APList_rid
)paren
suffix:semicolon
)brace
multiline_comment|/* This function wraps PC4500_writerid with a MAC disable */
DECL|function|do_writerid
r_static
r_int
id|do_writerid
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|rid
comma
r_const
r_void
op_star
id|rid_data
comma
r_int
id|len
)paren
(brace
r_int
id|rc
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
id|disable_MAC
c_func
(paren
id|ai
)paren
suffix:semicolon
id|rc
op_assign
id|PC4500_writerid
c_func
(paren
id|ai
comma
id|rid
comma
id|rid_data
comma
id|len
)paren
suffix:semicolon
id|enable_MAC
c_func
(paren
id|ai
comma
op_amp
id|rsp
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Returns the length of the key at the index.  If index == 0xffff&n; * the index of the transmit key is returned.  If the key doesn&squot;t exist,&n; * -1 will be returned.&n; */
DECL|function|get_wep_key
r_static
r_int
id|get_wep_key
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|index
)paren
(brace
id|WepKeyRid
id|wkr
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u16
id|lastindex
suffix:semicolon
id|rc
op_assign
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
id|SUCCESS
)paren
r_do
(brace
id|lastindex
op_assign
id|wkr.kindex
suffix:semicolon
r_if
c_cond
(paren
id|wkr.kindex
op_eq
id|index
)paren
(brace
r_if
c_cond
(paren
id|index
op_eq
l_int|0xffff
)paren
(brace
r_return
id|wkr.mac
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_return
id|wkr.klen
suffix:semicolon
)brace
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|lastindex
op_ne
id|wkr.kindex
)paren
(brace
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|set_wep_key
r_static
r_int
id|set_wep_key
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
id|u16
id|index
comma
r_const
r_char
op_star
id|key
comma
id|u16
id|keylen
comma
r_int
id|perm
)paren
(brace
r_static
r_const
r_int
r_char
id|macaddr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|WepKeyRid
id|wkr
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|wkr
comma
l_int|0
comma
r_sizeof
(paren
id|wkr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|keylen
op_eq
l_int|0
)paren
(brace
singleline_comment|// We are selecting which key to use
id|wkr.len
op_assign
r_sizeof
(paren
id|wkr
)paren
suffix:semicolon
id|wkr.kindex
op_assign
l_int|0xffff
suffix:semicolon
id|wkr.mac
(braket
l_int|0
)braket
op_assign
(paren
r_char
)paren
id|index
suffix:semicolon
r_if
c_cond
(paren
id|perm
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Setting transmit key to %d&bslash;n&quot;
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|perm
)paren
id|ai-&gt;defindex
op_assign
(paren
r_char
)paren
id|index
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// We are actually setting the key
id|wkr.len
op_assign
r_sizeof
(paren
id|wkr
)paren
suffix:semicolon
id|wkr.kindex
op_assign
id|index
suffix:semicolon
id|wkr.klen
op_assign
id|keylen
suffix:semicolon
id|memcpy
c_func
(paren
id|wkr.key
comma
id|key
comma
id|keylen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|wkr.mac
comma
id|macaddr
comma
l_int|6
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Setting key %d&bslash;n&quot;
comma
id|index
)paren
suffix:semicolon
)brace
id|writeWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
id|perm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_wepkey_on_close
r_static
r_void
id|proc_wepkey_on_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|key
(braket
l_int|16
)braket
suffix:semicolon
id|u16
id|index
op_assign
l_int|0
suffix:semicolon
r_int
id|j
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|key
comma
l_int|0
comma
r_sizeof
(paren
id|key
)paren
)paren
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;writelen
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;wbuffer
(braket
l_int|0
)braket
op_ge
l_char|&squot;0&squot;
op_logical_and
id|data-&gt;wbuffer
(braket
l_int|0
)braket
op_le
l_char|&squot;3&squot;
op_logical_and
(paren
id|data-&gt;wbuffer
(braket
l_int|1
)braket
op_eq
l_char|&squot; &squot;
op_logical_or
id|data-&gt;wbuffer
(braket
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
)paren
(brace
id|index
op_assign
id|data-&gt;wbuffer
(braket
l_int|0
)braket
op_minus
l_char|&squot;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;wbuffer
(braket
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|set_wep_key
c_func
(paren
id|ai
comma
id|index
comma
l_int|0
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|j
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;airo:  WepKey passed invalid key index&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
op_star
l_int|3
op_logical_and
id|data-&gt;wbuffer
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|i
op_mod
l_int|3
)paren
(brace
r_case
l_int|0
suffix:colon
id|key
(braket
id|i
op_div
l_int|3
)braket
op_assign
id|hexVal
c_func
(paren
id|data-&gt;wbuffer
(braket
id|i
op_plus
id|j
)braket
)paren
op_lshift
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|key
(braket
id|i
op_div
l_int|3
)braket
op_or_assign
id|hexVal
c_func
(paren
id|data-&gt;wbuffer
(braket
id|i
op_plus
id|j
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|set_wep_key
c_func
(paren
id|ai
comma
id|index
comma
id|key
comma
id|i
op_div
l_int|3
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|proc_wepkey_open
r_static
r_int
id|proc_wepkey_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_char
op_star
id|ptr
suffix:semicolon
id|WepKeyRid
id|wkr
suffix:semicolon
id|u16
id|lastindex
suffix:semicolon
r_int
id|j
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|wkr
comma
l_int|0
comma
r_sizeof
(paren
id|wkr
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|180
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;rbuffer
comma
l_int|0
comma
l_int|180
)paren
suffix:semicolon
id|data-&gt;writelen
op_assign
l_int|0
suffix:semicolon
id|data-&gt;maxwritelen
op_assign
l_int|80
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;wbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|80
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;wbuffer
comma
l_int|0
comma
l_int|80
)paren
suffix:semicolon
id|data-&gt;on_close
op_assign
id|proc_wepkey_on_close
suffix:semicolon
id|ptr
op_assign
id|data-&gt;rbuffer
suffix:semicolon
id|strcpy
c_func
(paren
id|ptr
comma
l_string|&quot;No wep keys&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
id|SUCCESS
)paren
r_do
(brace
id|lastindex
op_assign
id|wkr.kindex
suffix:semicolon
r_if
c_cond
(paren
id|wkr.kindex
op_eq
l_int|0xffff
)paren
(brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|ptr
op_plus
id|j
comma
l_string|&quot;Tx key = %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|wkr.mac
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|j
op_add_assign
id|sprintf
c_func
(paren
id|ptr
op_plus
id|j
comma
l_string|&quot;Key %d set with length = %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|wkr.kindex
comma
(paren
r_int
)paren
id|wkr.klen
)paren
suffix:semicolon
)brace
id|readWepKeyRid
c_func
(paren
id|ai
comma
op_amp
id|wkr
comma
l_int|0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|lastindex
op_ne
id|wkr.kindex
)paren
op_logical_and
(paren
id|j
OL
l_int|180
op_minus
l_int|30
)paren
)paren
(brace
suffix:semicolon
)brace
id|data-&gt;readlen
op_assign
id|strlen
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_SSID_open
r_static
r_int
id|proc_SSID_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|ptr
suffix:semicolon
id|SsidRid
id|SSID_rid
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|104
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|data-&gt;writelen
op_assign
l_int|0
suffix:semicolon
id|data-&gt;maxwritelen
op_assign
l_int|33
op_star
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;wbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|33
op_star
l_int|3
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;wbuffer
comma
l_int|0
comma
l_int|33
op_star
l_int|3
)paren
suffix:semicolon
id|data-&gt;on_close
op_assign
id|proc_SSID_on_close
suffix:semicolon
id|readSsidRid
c_func
(paren
id|ai
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
id|ptr
op_assign
id|data-&gt;rbuffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|len
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|32
op_logical_and
id|j
OL
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|len
op_logical_and
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|ssid
(braket
id|j
)braket
suffix:semicolon
id|j
op_increment
)paren
(brace
op_star
id|ptr
op_increment
op_assign
id|SSID_rid.ssids
(braket
id|i
)braket
dot
id|ssid
(braket
id|j
)braket
suffix:semicolon
)brace
op_star
id|ptr
op_increment
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
)brace
op_star
id|ptr
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|data-&gt;readlen
op_assign
id|strlen
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_APList_open
r_static
r_int
id|proc_APList_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|dp
op_assign
id|inode-&gt;u.generic_ip
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|dp-&gt;data
suffix:semicolon
r_struct
id|airo_info
op_star
id|ai
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|ptr
suffix:semicolon
id|APListRid
id|APList_rid
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|dp
op_assign
(paren
r_struct
id|proc_dir_entry
op_star
)paren
id|inode-&gt;u.generic_ip
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|proc_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|proc_data
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;rbuffer
op_assign
id|kmalloc
c_func
(paren
l_int|104
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|data-&gt;writelen
op_assign
l_int|0
suffix:semicolon
id|data-&gt;maxwritelen
op_assign
l_int|4
op_star
l_int|6
op_star
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;wbuffer
op_assign
id|kmalloc
c_func
(paren
id|data-&gt;maxwritelen
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|kfree
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
id|kfree
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;wbuffer
comma
l_int|0
comma
id|data-&gt;maxwritelen
)paren
suffix:semicolon
id|data-&gt;on_close
op_assign
id|proc_APList_on_close
suffix:semicolon
id|readAPListRid
c_func
(paren
id|ai
comma
op_amp
id|APList_rid
)paren
suffix:semicolon
id|ptr
op_assign
id|data-&gt;rbuffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
singleline_comment|// We end when we find a zero MAC
r_if
c_cond
(paren
op_logical_neg
op_star
(paren
r_int
op_star
)paren
id|APList_rid.ap
(braket
id|i
)braket
op_logical_and
op_logical_neg
op_star
(paren
r_int
op_star
)paren
op_amp
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|2
)braket
)paren
r_break
suffix:semicolon
id|ptr
op_add_assign
id|sprintf
c_func
(paren
id|ptr
comma
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|2
)braket
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|3
)braket
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|4
)braket
comma
(paren
r_int
)paren
id|APList_rid.ap
(braket
id|i
)braket
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|ptr
op_add_assign
id|sprintf
c_func
(paren
id|ptr
comma
l_string|&quot;Not using specific APs&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|ptr
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|data-&gt;readlen
op_assign
id|strlen
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|proc_close
r_static
r_int
id|proc_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|proc_data
op_star
id|data
op_assign
(paren
r_struct
id|proc_data
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;on_close
op_ne
l_int|NULL
)paren
id|data
op_member_access_from_pointer
id|on_close
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;rbuffer
)paren
id|kfree
c_func
(paren
id|data-&gt;rbuffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;wbuffer
)paren
id|kfree
c_func
(paren
id|data-&gt;wbuffer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|net_device_list
r_static
r_struct
id|net_device_list
(brace
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|next
r_struct
id|net_device_list
op_star
id|next
suffix:semicolon
DECL|variable|airo_devices
)brace
op_star
id|airo_devices
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Since the card doesnt automatically switch to the right WEP mode,&n;   we will make it do it.  If the card isn&squot;t associated, every secs we&n;   will switch WEP modes to see if that will help.  If the card is&n;   associated we will check every minute to see if anything has&n;   changed. */
DECL|function|timer_func
r_static
r_void
id|timer_func
c_func
(paren
id|u_long
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|airo_info
op_star
id|apriv
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|linkstat
op_assign
id|IN4500
c_func
(paren
id|apriv
comma
id|LINKSTAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|linkstat
op_ne
l_int|0x400
)paren
(brace
multiline_comment|/* We don&squot;t have a link so try changing the authtype */
id|ConfigRid
id|config
op_assign
id|apriv-&gt;config
suffix:semicolon
r_switch
c_cond
(paren
id|apriv-&gt;authtype
)paren
(brace
r_case
id|AUTH_ENCRYPT
suffix:colon
multiline_comment|/* So drop to OPEN */
id|config.authType
op_assign
id|AUTH_OPEN
suffix:semicolon
id|apriv-&gt;authtype
op_assign
id|AUTH_OPEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTH_SHAREDKEY
suffix:colon
r_if
c_cond
(paren
id|apriv-&gt;keyindex
OL
id|auto_wep
)paren
(brace
id|set_wep_key
c_func
(paren
id|apriv
comma
id|apriv-&gt;keyindex
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|config.authType
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
id|apriv-&gt;authtype
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
id|apriv-&gt;keyindex
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Drop to ENCRYPT */
id|apriv-&gt;keyindex
op_assign
l_int|0
suffix:semicolon
id|set_wep_key
c_func
(paren
id|apriv
comma
id|apriv-&gt;defindex
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|config.authType
op_assign
id|AUTH_ENCRYPT
suffix:semicolon
id|apriv-&gt;authtype
op_assign
id|AUTH_ENCRYPT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* We&squot;ll escalate to SHAREDKEY */
id|config.authType
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
id|apriv-&gt;authtype
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
)brace
id|checkThrottle
c_func
(paren
op_amp
id|config
)paren
suffix:semicolon
id|writeConfigRid
c_func
(paren
id|apriv
comma
op_amp
id|config
)paren
suffix:semicolon
multiline_comment|/* Schedule check to see if the change worked */
id|apriv-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|HZ
op_star
l_int|3
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|apriv-&gt;timer
)paren
suffix:semicolon
)brace
)brace
DECL|function|add_airo_dev
r_static
r_int
id|add_airo_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device_list
op_star
id|node
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|node
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|auto_wep
)paren
(brace
r_struct
id|airo_info
op_star
id|apriv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|timer
op_assign
op_amp
id|apriv-&gt;timer
suffix:semicolon
id|timer-&gt;function
op_assign
id|timer_func
suffix:semicolon
id|timer-&gt;data
op_assign
(paren
id|u_long
)paren
id|dev
suffix:semicolon
id|init_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
id|apriv-&gt;authtype
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
)brace
id|node-&gt;dev
op_assign
id|dev
suffix:semicolon
id|node-&gt;next
op_assign
id|airo_devices
suffix:semicolon
id|airo_devices
op_assign
id|node
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|del_airo_dev
r_static
r_void
id|del_airo_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device_list
op_star
op_star
id|p
op_assign
op_amp
id|airo_devices
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
(paren
op_star
id|p
)paren
op_member_access_from_pointer
id|dev
op_ne
id|dev
)paren
)paren
(brace
id|p
op_assign
op_amp
(paren
op_star
id|p
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
)paren
op_member_access_from_pointer
id|dev
op_eq
id|dev
)paren
op_star
id|p
op_assign
(paren
op_star
id|p
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|airo_pci_probe
r_static
r_int
id|__devinit
id|airo_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pent
)paren
(brace
id|pdev-&gt;driver_data
op_assign
id|init_airo_card
c_func
(paren
id|pdev-&gt;irq
comma
id|pdev-&gt;resource
(braket
l_int|2
)braket
dot
id|start
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev-&gt;driver_data
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_pci_remove
r_static
r_void
id|__devexit
id|airo_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
id|stop_airo_card
c_func
(paren
id|pdev-&gt;driver_data
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|airo_init_module
r_static
r_int
id|__init
id|airo_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
l_int|0
comma
id|have_isa_dev
op_assign
l_int|0
suffix:semicolon
id|airo_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;aironet&quot;
comma
id|S_IFDIR
op_or
id|airo_perm
comma
id|proc_root_driver
)paren
suffix:semicolon
id|airo_entry-&gt;uid
op_assign
id|proc_uid
suffix:semicolon
id|airo_entry-&gt;gid
op_assign
id|proc_gid
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
op_logical_and
id|io
(braket
id|i
)braket
op_logical_and
id|irq
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo:  Trying to configure ISA adapter at irq=%d io=0x%x&bslash;n&quot;
comma
id|irq
(braket
id|i
)braket
comma
id|io
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_airo_card
c_func
(paren
id|irq
(braket
id|i
)braket
comma
id|io
(braket
id|i
)braket
comma
l_int|0
)paren
)paren
id|have_isa_dev
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo:  Probing for PCI adapters&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|airo_driver
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo:  Finished probing for PCI adapters&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Always exit with success, as we are a library module&n;&t; * as well as a driver module&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|airo_cleanup_module
r_static
r_void
id|__exit
id|airo_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|airo_devices
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;airo: Unregistering %s&bslash;n&quot;
comma
id|airo_devices-&gt;dev-&gt;name
)paren
suffix:semicolon
id|stop_airo_card
c_func
(paren
id|airo_devices-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
)brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;aironet&quot;
comma
id|proc_root_driver
)paren
suffix:semicolon
)brace
macro_line|#ifdef WIRELESS_EXT
multiline_comment|/*&n; * Initial Wireless Extension code for Aironet driver by :&n; *&t;Jean Tourrilhes &lt;jt@hpl.hp.com&gt; - HPL - 17 November 00&n; */
macro_line|#ifndef IW_ENCODE_NOKEY
DECL|macro|IW_ENCODE_NOKEY
mdefine_line|#define IW_ENCODE_NOKEY         0x0800  /* Key is write only, so not present */
DECL|macro|IW_ENCODE_MODE
mdefine_line|#define IW_ENCODE_MODE  (IW_ENCODE_DISABLED | IW_ENCODE_RESTRICTED | IW_ENCODE_OPEN)
macro_line|#endif /* IW_ENCODE_NOKEY */
macro_line|#endif /* WIRELESS_EXT */
multiline_comment|/*&n; * This defines the configuration part of the Wireless Extensions&n; * Note : irq and spinlock protection will occur in the subroutines&n; *&n; * TODO :&n; *&t;o Check input value more carefully and fill correct values in range&n; *&t;o Implement : POWER, SPY, APLIST&n; *&t;o Optimise when adapter is closed (aggregate changes, commit later)&n; *&t;o Test and shakeout the bugs (if any)&n; *&n; * Jean II&n; *&n; * Javier Achirica did a great job of merging code from the unnamed CISCO&n; * developer that added support for flashing the card.&n; */
DECL|function|airo_ioctl
r_static
r_int
id|airo_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef WIRELESS_EXT
r_struct
id|airo_info
op_star
id|local
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|iwreq
op_star
id|wrq
op_assign
(paren
r_struct
id|iwreq
op_star
)paren
id|rq
suffix:semicolon
id|ConfigRid
id|config
suffix:semicolon
multiline_comment|/* Configuration info */
id|CapabilityRid
id|cap_rid
suffix:semicolon
multiline_comment|/* Card capability info */
id|StatusRid
id|status_rid
suffix:semicolon
multiline_comment|/* Card status info */
r_int
id|i
suffix:semicolon
macro_line|#ifdef CISCO_EXT
r_if
c_cond
(paren
id|cmd
op_ne
id|SIOCGIWPRIV
op_logical_and
id|cmd
op_ne
id|AIROIOCTL
op_logical_and
id|cmd
op_ne
id|AIROIDIFC
)paren
macro_line|#endif /* CISCO_EXT */
(brace
multiline_comment|/* If the command read some stuff, we better get it out of&n;&t;&t; * the card first... */
r_if
c_cond
(paren
id|IW_IS_GET
c_func
(paren
id|cmd
)paren
)paren
(brace
id|readStatusRid
c_func
(paren
id|local
comma
op_amp
id|status_rid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IW_IS_GET
c_func
(paren
id|cmd
)paren
op_logical_or
(paren
id|cmd
op_eq
id|SIOCSIWRATE
)paren
op_logical_or
(paren
id|cmd
op_eq
id|SIOCSIWENCODE
)paren
)paren
(brace
id|readCapabilityRid
c_func
(paren
id|local
comma
op_amp
id|cap_rid
)paren
suffix:semicolon
)brace
multiline_comment|/* Get config in all cases, because SET will just modify it */
id|readConfigRid
c_func
(paren
id|local
comma
op_amp
id|config
)paren
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_EXT */
r_switch
c_cond
(paren
id|cmd
)paren
(brace
macro_line|#ifdef WIRELESS_EXT
singleline_comment|// Get name
r_case
id|SIOCGIWNAME
suffix:colon
id|strcpy
c_func
(paren
id|wrq-&gt;u.name
comma
l_string|&quot;IEEE 802.11-DS&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// Set frequency/channel
r_case
id|SIOCSIWFREQ
suffix:colon
multiline_comment|/* If setting by frequency, convert to a channel */
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.freq.e
op_eq
l_int|1
)paren
op_logical_and
(paren
id|wrq-&gt;u.freq.m
op_ge
(paren
r_int
)paren
l_float|2.412e8
)paren
op_logical_and
(paren
id|wrq-&gt;u.freq.m
op_le
(paren
r_int
)paren
l_float|2.487e8
)paren
)paren
(brace
r_int
id|f
op_assign
id|wrq-&gt;u.freq.m
op_div
l_int|100000
suffix:semicolon
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
OL
l_int|14
)paren
op_logical_and
(paren
id|f
op_ne
id|frequency_list
(braket
id|c
)braket
)paren
)paren
(brace
id|c
op_increment
suffix:semicolon
)brace
multiline_comment|/* Hack to fall through... */
id|wrq-&gt;u.freq.e
op_assign
l_int|0
suffix:semicolon
id|wrq-&gt;u.freq.m
op_assign
id|c
op_plus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Setting by channel number */
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.freq.m
OG
l_int|1000
)paren
op_logical_or
(paren
id|wrq-&gt;u.freq.e
OG
l_int|0
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_else
(brace
r_int
id|channel
op_assign
id|wrq-&gt;u.freq.m
suffix:semicolon
multiline_comment|/* We should do a better check than that,&n;&t;&t;&t; * based on the card capability !!! */
r_if
c_cond
(paren
(paren
id|channel
OL
l_int|1
)paren
op_logical_or
(paren
id|channel
OG
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: New channel value of %d is invalid!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|wrq-&gt;u.freq.m
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Yes ! We can set it !!! */
id|config.channelSet
op_assign
(paren
id|u16
)paren
(paren
id|channel
op_minus
l_int|1
)paren
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
singleline_comment|// Get frequency/channel
r_case
id|SIOCGIWFREQ
suffix:colon
macro_line|#ifdef WEXT_USECHANNELS
id|wrq-&gt;u.freq.m
op_assign
(paren
(paren
r_int
)paren
id|status_rid.channel
)paren
op_plus
l_int|1
suffix:semicolon
id|wrq-&gt;u.freq.e
op_assign
l_int|0
suffix:semicolon
macro_line|#else
(brace
r_int
id|f
op_assign
(paren
r_int
)paren
id|status_rid.channel
suffix:semicolon
id|wrq-&gt;u.freq.m
op_assign
id|frequency_list
(braket
id|f
)braket
op_star
l_int|100000
suffix:semicolon
id|wrq-&gt;u.freq.e
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
singleline_comment|// Set desired network name (ESSID)
r_case
id|SIOCSIWESSID
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_char
id|essid
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
id|SsidRid
id|SSID_rid
suffix:semicolon
multiline_comment|/* SSIDs */
multiline_comment|/* Reload the list of current SSID */
id|readSsidRid
c_func
(paren
id|local
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
multiline_comment|/* Check if we asked for `any&squot; */
r_if
c_cond
(paren
id|wrq-&gt;u.data.flags
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Just send an empty SSID list */
id|memset
c_func
(paren
op_amp
id|SSID_rid
comma
l_int|0
comma
r_sizeof
(paren
id|SSID_rid
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|index
op_assign
(paren
id|wrq-&gt;u.data.flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Check the size of the string */
r_if
c_cond
(paren
id|wrq-&gt;u.data.length
OG
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
(brace
id|rc
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Check if index is valid */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
l_int|4
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Set the SSID */
id|memset
c_func
(paren
id|essid
comma
l_int|0
comma
r_sizeof
(paren
id|essid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|essid
comma
id|wrq-&gt;u.data.pointer
comma
id|wrq-&gt;u.data.length
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|SSID_rid.ssids
(braket
id|index
)braket
dot
id|ssid
comma
id|essid
comma
r_sizeof
(paren
id|essid
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|SSID_rid.ssids
(braket
id|index
)braket
dot
id|len
op_assign
id|wrq-&gt;u.data.length
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Write it to the card */
id|writeSsidRid
c_func
(paren
id|local
comma
op_amp
id|SSID_rid
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get current network name (ESSID)
r_case
id|SIOCGIWESSID
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_char
id|essid
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Note : if wrq-&gt;u.data.flags != 0, we should&n;&t;&t;&t; * get the relevant SSID from the SSID list... */
multiline_comment|/* Get the current SSID */
id|memcpy
c_func
(paren
id|essid
comma
id|status_rid.SSID
comma
id|status_rid.SSIDlen
)paren
suffix:semicolon
id|essid
(braket
id|status_rid.SSIDlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* If none, we may want to get the one that was set */
multiline_comment|/* Push it out ! */
id|wrq-&gt;u.data.length
op_assign
id|strlen
c_func
(paren
id|essid
)paren
op_plus
l_int|1
suffix:semicolon
id|wrq-&gt;u.data.flags
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* active */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
id|essid
comma
r_sizeof
(paren
id|essid
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIWAP
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.ap_addr.sa_family
op_ne
id|ARPHRD_ETHER
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
id|APListRid
id|APList_rid
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|APList_rid
comma
l_int|0
comma
r_sizeof
(paren
id|APList_rid
)paren
)paren
suffix:semicolon
id|APList_rid.len
op_assign
r_sizeof
(paren
id|APList_rid
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|APList_rid.ap
(braket
l_int|0
)braket
comma
id|wrq-&gt;u.ap_addr.sa_data
comma
l_int|6
)paren
suffix:semicolon
id|writeAPListRid
c_func
(paren
id|local
comma
op_amp
id|APList_rid
)paren
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get current Access Point (BSSID)
r_case
id|SIOCGIWAP
suffix:colon
multiline_comment|/* Tentative. This seems to work, wow, I&squot;m lucky !!! */
id|memcpy
c_func
(paren
id|wrq-&gt;u.ap_addr.sa_data
comma
id|status_rid.bssid
(braket
l_int|0
)braket
comma
l_int|6
)paren
suffix:semicolon
id|wrq-&gt;u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// Set desired station name
r_case
id|SIOCSIWNICKN
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_char
id|name
(braket
l_int|16
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Check the size of the string */
r_if
c_cond
(paren
id|wrq-&gt;u.data.length
OG
l_int|16
op_plus
l_int|1
)paren
(brace
id|rc
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memset
c_func
(paren
id|name
comma
l_int|0
comma
r_sizeof
(paren
id|name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|name
comma
id|wrq-&gt;u.data.pointer
comma
id|wrq-&gt;u.data.length
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|config.nodeName
comma
id|name
comma
l_int|16
)paren
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get current station name
r_case
id|SIOCGIWNICKN
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_char
id|name
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
id|strncpy
c_func
(paren
id|name
comma
id|config.nodeName
comma
l_int|16
)paren
suffix:semicolon
id|name
(braket
l_int|16
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|wrq-&gt;u.data.length
op_assign
id|strlen
c_func
(paren
id|name
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
id|name
comma
r_sizeof
(paren
id|name
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Set the desired bit-rate
r_case
id|SIOCSIWRATE
suffix:colon
(brace
multiline_comment|/* First : get a valid bit rate value */
id|u8
id|brate
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Which type of value ? */
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.bitrate.value
OL
l_int|8
)paren
op_logical_and
(paren
id|wrq-&gt;u.bitrate.value
op_ge
l_int|0
)paren
)paren
(brace
multiline_comment|/* Setting by rate index */
multiline_comment|/* Find value in the magic rate table */
id|brate
op_assign
id|cap_rid.supportedRates
(braket
id|wrq-&gt;u.bitrate.value
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Setting by frequency value */
id|u8
id|normvalue
op_assign
(paren
id|u8
)paren
(paren
id|wrq-&gt;u.bitrate.value
op_div
l_int|500000
)paren
suffix:semicolon
multiline_comment|/* Check if rate is valid */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|normvalue
op_eq
id|cap_rid.supportedRates
(braket
id|i
)braket
)paren
(brace
id|brate
op_assign
id|normvalue
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* -1 designed the max rate (mostly auto mode) */
r_if
c_cond
(paren
id|wrq-&gt;u.bitrate.value
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* Get the highest available rate */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cap_rid.supportedRates
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_ne
l_int|0
)paren
(brace
id|brate
op_assign
id|cap_rid.supportedRates
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Check that it is valid */
r_if
c_cond
(paren
id|brate
op_eq
l_int|0
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Now, check if we want a fixed or auto value */
r_if
c_cond
(paren
id|wrq-&gt;u.bitrate.fixed
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Fill all the rates up to this max rate */
id|memset
c_func
(paren
id|config.rates
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|config.rates
(braket
id|i
)braket
op_assign
id|cap_rid.supportedRates
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|config.rates
(braket
id|i
)braket
op_eq
id|brate
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Fixed mode */
multiline_comment|/* One rate, fixed */
id|memset
c_func
(paren
id|config.rates
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
id|config.rates
(braket
l_int|0
)braket
op_assign
id|brate
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
singleline_comment|// Get the current bit-rate
r_case
id|SIOCGIWRATE
suffix:colon
(brace
r_int
id|brate
op_assign
id|status_rid.currentXmitRate
suffix:semicolon
id|wrq-&gt;u.bitrate.value
op_assign
id|brate
op_star
l_int|500000
suffix:semicolon
multiline_comment|/* If more than one rate, set auto */
id|wrq-&gt;u.rts.fixed
op_assign
(paren
id|config.rates
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Set the desired RTS threshold
r_case
id|SIOCSIWRTS
suffix:colon
(brace
r_int
id|rthr
op_assign
id|wrq-&gt;u.rts.value
suffix:semicolon
r_if
c_cond
(paren
id|wrq-&gt;u.rts.disabled
)paren
(brace
id|rthr
op_assign
l_int|2312
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rthr
OL
l_int|0
)paren
op_logical_or
(paren
id|rthr
OG
l_int|2312
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|config.rtsThres
op_assign
id|rthr
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
singleline_comment|// Get the current RTS threshold
r_case
id|SIOCGIWRTS
suffix:colon
id|wrq-&gt;u.rts.value
op_assign
id|config.rtsThres
suffix:semicolon
id|wrq-&gt;u.rts.disabled
op_assign
(paren
id|wrq-&gt;u.rts.value
op_ge
l_int|2312
)paren
suffix:semicolon
id|wrq-&gt;u.rts.fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// Set the desired fragmentation threshold
r_case
id|SIOCSIWFRAG
suffix:colon
(brace
r_int
id|fthr
op_assign
id|wrq-&gt;u.frag.value
suffix:semicolon
r_if
c_cond
(paren
id|wrq-&gt;u.frag.disabled
)paren
(brace
id|fthr
op_assign
l_int|2312
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|fthr
OL
l_int|256
)paren
op_logical_or
(paren
id|fthr
OG
l_int|2312
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|fthr
op_and_assign
op_complement
l_int|0x1
suffix:semicolon
multiline_comment|/* Get an even value */
id|config.fragThresh
op_assign
(paren
id|u16
)paren
id|fthr
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
singleline_comment|// Get the current fragmentation threshold
r_case
id|SIOCGIWFRAG
suffix:colon
id|wrq-&gt;u.frag.value
op_assign
id|config.fragThresh
suffix:semicolon
id|wrq-&gt;u.frag.disabled
op_assign
(paren
id|wrq-&gt;u.frag.value
op_ge
l_int|2312
)paren
suffix:semicolon
id|wrq-&gt;u.frag.fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// Set mode of operation
r_case
id|SIOCSIWMODE
suffix:colon
r_switch
c_cond
(paren
id|wrq-&gt;u.mode
)paren
(brace
r_case
id|IW_MODE_ADHOC
suffix:colon
id|config.opmode
op_assign
id|MODE_STA_IBSS
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_INFRA
suffix:colon
id|config.opmode
op_assign
id|MODE_STA_ESS
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_MASTER
suffix:colon
id|config.opmode
op_assign
id|MODE_AP
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_REPEAT
suffix:colon
id|config.opmode
op_assign
id|MODE_AP_RPTR
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get mode of operation
r_case
id|SIOCGIWMODE
suffix:colon
multiline_comment|/* If not managed, assume it&squot;s ad-hoc */
r_switch
c_cond
(paren
id|config.opmode
op_amp
l_int|0xFF
)paren
(brace
r_case
id|MODE_STA_ESS
suffix:colon
id|wrq-&gt;u.mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_AP
suffix:colon
id|wrq-&gt;u.mode
op_assign
id|IW_MODE_MASTER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_AP_RPTR
suffix:colon
id|wrq-&gt;u.mode
op_assign
id|IW_MODE_REPEAT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|wrq-&gt;u.mode
op_assign
id|IW_MODE_ADHOC
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Set WEP keys and mode
r_case
id|SIOCSIWENCODE
suffix:colon
multiline_comment|/* Is WEP supported ? */
multiline_comment|/* Older firmware doesn&squot;t support this...&n;&t;&t;if(!(cap_rid.softCap &amp; 2)) {&n;&t;&t;&t;rc = -EOPNOTSUPP;&n;&t;&t;&t;break;&n;&t;&t;} */
multiline_comment|/* Basic checking: do we have a key to set ? */
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.pointer
op_ne
(paren
id|caddr_t
)paren
l_int|0
)paren
(brace
id|wep_key_t
id|key
suffix:semicolon
r_int
id|index
op_assign
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|current_index
op_assign
id|get_wep_key
c_func
(paren
id|local
comma
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* Check the size of the key */
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.length
OG
id|MAX_KEY_SIZE
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Check the index (none -&gt; use current) */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
(paren
id|cap_rid.softCap
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|1
)paren
)paren
id|index
op_assign
id|current_index
suffix:semicolon
multiline_comment|/* Set the length */
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.length
OG
id|MIN_KEY_SIZE
)paren
id|key.len
op_assign
id|MAX_KEY_SIZE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.length
OG
l_int|0
)paren
id|key.len
op_assign
id|MIN_KEY_SIZE
suffix:semicolon
r_else
multiline_comment|/* Disable the key */
id|key.len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check if the key is not marked as invalid */
r_if
c_cond
(paren
op_logical_neg
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_NOKEY
)paren
)paren
(brace
multiline_comment|/* Cleanup */
id|memset
c_func
(paren
id|key.key
comma
l_int|0
comma
id|MAX_KEY_SIZE
)paren
suffix:semicolon
multiline_comment|/* Copy the key in the driver */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|key.key
comma
id|wrq-&gt;u.encoding.pointer
comma
id|wrq-&gt;u.encoding.length
)paren
)paren
(brace
id|key.len
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Send the key to the card */
id|set_wep_key
c_func
(paren
id|local
comma
id|index
comma
id|key.key
comma
id|key.len
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* WE specify that if a valid key is set, encryption&n;&t;&t;&t; * should be enabled (user may turn it off later)&n;&t;&t;&t; * This is also how &quot;iwconfig ethX key on&quot; works */
r_if
c_cond
(paren
(paren
id|index
op_eq
id|current_index
)paren
op_logical_and
(paren
id|key.len
OG
l_int|0
)paren
op_logical_and
(paren
id|config.authType
op_eq
id|AUTH_OPEN
)paren
)paren
(brace
id|config.authType
op_assign
id|AUTH_ENCRYPT
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Do we want to just set the transmit key index ? */
r_int
id|index
op_assign
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
op_ge
l_int|0
)paren
op_logical_and
(paren
id|index
OL
(paren
id|cap_rid.softCap
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|1
)paren
)paren
(brace
id|set_wep_key
c_func
(paren
id|local
comma
id|index
comma
l_int|0
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Don&squot;t complain if only change the mode */
r_if
c_cond
(paren
op_logical_neg
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_MODE
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Read the flags */
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_DISABLED
)paren
(brace
id|config.authType
op_assign
id|AUTH_OPEN
suffix:semicolon
)brace
singleline_comment|// disable encryption
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
(brace
id|config.authType
op_assign
id|AUTH_SHAREDKEY
suffix:semicolon
)brace
singleline_comment|// Only Both
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_OPEN
)paren
(brace
id|config.authType
op_assign
id|AUTH_ENCRYPT
suffix:semicolon
)brace
singleline_comment|// Only Wep
multiline_comment|/* Commit the changes if needed */
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_MODE
)paren
(brace
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get the WEP keys and mode
r_case
id|SIOCGIWENCODE
suffix:colon
multiline_comment|/* Is it supported ? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cap_rid.softCap
op_amp
l_int|2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// Only super-user can see WEP key
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// Basic checking...
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.pointer
op_ne
(paren
id|caddr_t
)paren
l_int|0
)paren
(brace
r_char
id|zeros
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|index
op_assign
(paren
id|wrq-&gt;u.encoding.flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
id|zeros
comma
l_int|0
comma
r_sizeof
(paren
id|zeros
)paren
)paren
suffix:semicolon
multiline_comment|/* Check encryption mode */
id|wrq-&gt;u.encoding.flags
op_assign
id|IW_ENCODE_NOKEY
suffix:semicolon
multiline_comment|/* Is WEP enabled ??? */
r_switch
c_cond
(paren
id|config.authType
)paren
(brace
r_case
id|AUTH_ENCRYPT
suffix:colon
id|wrq-&gt;u.encoding.flags
op_or_assign
id|IW_ENCODE_OPEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUTH_SHAREDKEY
suffix:colon
id|wrq-&gt;u.encoding.flags
op_or_assign
id|IW_ENCODE_RESTRICTED
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
id|AUTH_OPEN
suffix:colon
id|wrq-&gt;u.encoding.flags
op_or_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Which key do we want ? -1 -&gt; tx index */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
(paren
id|cap_rid.softCap
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|1
)paren
)paren
(brace
id|index
op_assign
id|get_wep_key
c_func
(paren
id|local
comma
l_int|0xffff
)paren
suffix:semicolon
)brace
id|wrq-&gt;u.encoding.flags
op_or_assign
id|index
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Copy the key to the user buffer */
id|wrq-&gt;u.encoding.length
op_assign
id|get_wep_key
c_func
(paren
id|local
comma
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wrq-&gt;u.encoding.length
OG
l_int|16
)paren
(brace
id|wrq-&gt;u.encoding.length
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.encoding.pointer
comma
id|zeros
comma
id|wrq-&gt;u.encoding.length
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
macro_line|#if WIRELESS_EXT &gt; 9
singleline_comment|// Get the current Tx-Power
r_case
id|SIOCGIWTXPOW
suffix:colon
id|wrq-&gt;u.txpower.value
op_assign
id|config.txPower
suffix:semicolon
id|wrq-&gt;u.txpower.fixed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* No power control */
id|wrq-&gt;u.txpower.disabled
op_assign
(paren
id|local-&gt;flags
op_amp
id|FLAG_RADIO_OFF
)paren
suffix:semicolon
id|wrq-&gt;u.txpower.flags
op_assign
id|IW_TXPOW_MWATT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWTXPOW
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.txpower.disabled
)paren
(brace
id|local-&gt;flags
op_or_assign
id|FLAG_RADIO_OFF
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wrq-&gt;u.txpower.flags
op_ne
id|IW_TXPOW_MWATT
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|local-&gt;flags
op_and_assign
op_complement
id|FLAG_RADIO_OFF
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|cap_rid.txPowerLevels
(braket
id|i
)braket
op_logical_and
(paren
id|i
OL
l_int|8
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.txpower.value
op_eq
id|cap_rid.txPowerLevels
(braket
id|i
)braket
)paren
)paren
(brace
id|config.txPower
op_assign
id|wrq-&gt;u.txpower.value
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 9 */
macro_line|#if WIRELESS_EXT &gt; 10
r_case
id|SIOCGIWRETRY
suffix:colon
id|wrq-&gt;u.retry.disabled
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.retry.flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIFETIME
)paren
id|wrq-&gt;u.retry.value
op_assign
(paren
r_int
)paren
id|config.txLifetime
op_star
l_int|1024
suffix:semicolon
r_else
(brace
id|wrq-&gt;u.retry.value
op_assign
(paren
r_int
)paren
id|config.shortRetryLimit
suffix:semicolon
id|wrq-&gt;u.retry.flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIWRETRY
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.retry.disabled
)paren
(brace
id|config.shortRetryLimit
op_assign
l_int|0
suffix:semicolon
id|config.longRetryLimit
op_assign
l_int|0
suffix:semicolon
id|config.txLifetime
op_assign
l_int|0
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.retry.flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIFETIME
)paren
(brace
id|config.txLifetime
op_assign
(paren
id|wrq-&gt;u.retry.value
op_plus
l_int|500
)paren
op_div
l_int|1024
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.retry.flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIMIT
)paren
(brace
id|config.shortRetryLimit
op_assign
id|config.longRetryLimit
op_assign
id|wrq-&gt;u.retry.value
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
singleline_comment|// Get range of parameters
r_case
id|SIOCGIWRANGE
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_struct
id|iw_range
id|range
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|k
suffix:semicolon
id|wrq-&gt;u.data.length
op_assign
r_sizeof
(paren
id|range
)paren
suffix:semicolon
multiline_comment|/* Should adapt depending on max rate */
id|range.throughput
op_assign
l_float|1.6
op_star
l_int|1024
op_star
l_int|1024
suffix:semicolon
id|range.min_nwid
op_assign
l_int|0x0000
suffix:semicolon
id|range.max_nwid
op_assign
l_int|0x0000
suffix:semicolon
id|range.num_channels
op_assign
l_int|14
suffix:semicolon
multiline_comment|/* Should be based on cap_rid.country to give only&n;&t;&t;&t; * what the current card support */
id|k
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|14
suffix:semicolon
id|i
op_increment
)paren
(brace
id|range.freq
(braket
id|k
)braket
dot
id|i
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* List index */
id|range.freq
(braket
id|k
)braket
dot
id|m
op_assign
id|frequency_list
(braket
id|i
)braket
op_star
l_int|100000
suffix:semicolon
id|range.freq
(braket
id|k
op_increment
)braket
dot
id|e
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Values in table in MHz -&gt; * 10^5 * 10 */
)brace
id|range.num_frequency
op_assign
id|k
suffix:semicolon
multiline_comment|/* Hum... Should put the right values there */
id|range.max_qual.qual
op_assign
l_int|10
suffix:semicolon
id|range.max_qual.level
op_assign
l_int|100
suffix:semicolon
id|range.max_qual.noise
op_assign
l_int|0
suffix:semicolon
id|range.sensitivity
op_assign
l_int|65535
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|range.bitrate
(braket
id|i
)braket
op_assign
id|cap_rid.supportedRates
(braket
id|i
)braket
op_star
l_int|500000
suffix:semicolon
r_if
c_cond
(paren
id|range.bitrate
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|range.num_bitrates
op_assign
id|i
suffix:semicolon
id|range.min_rts
op_assign
l_int|0
suffix:semicolon
id|range.max_rts
op_assign
l_int|2312
suffix:semicolon
id|range.min_frag
op_assign
l_int|256
suffix:semicolon
id|range.max_frag
op_assign
l_int|2312
suffix:semicolon
r_if
c_cond
(paren
id|cap_rid.softCap
op_amp
l_int|2
)paren
(brace
singleline_comment|// WEP: RC4 40 bits
id|range.encoding_size
(braket
l_int|0
)braket
op_assign
l_int|5
suffix:semicolon
singleline_comment|// RC4 ~128 bits
r_if
c_cond
(paren
id|cap_rid.softCap
op_amp
l_int|0x100
)paren
(brace
id|range.encoding_size
(braket
l_int|1
)braket
op_assign
l_int|13
suffix:semicolon
id|range.num_encoding_sizes
op_assign
l_int|2
suffix:semicolon
)brace
r_else
id|range.num_encoding_sizes
op_assign
l_int|1
suffix:semicolon
id|range.max_encoding_tokens
op_assign
(paren
id|cap_rid.softCap
op_amp
l_int|0x80
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|range.num_encoding_sizes
op_assign
l_int|0
suffix:semicolon
id|range.max_encoding_tokens
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if WIRELESS_EXT &gt; 9
id|range.min_pmp
op_assign
l_int|0
suffix:semicolon
id|range.max_pmp
op_assign
l_int|5000000
suffix:semicolon
multiline_comment|/* 5 secs */
id|range.min_pmt
op_assign
l_int|0
suffix:semicolon
id|range.max_pmt
op_assign
l_int|65535
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* ??? */
id|range.pmp_flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
id|range.pmt_flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
id|range.pm_capa
op_assign
id|IW_POWER_PERIOD
op_or
id|IW_POWER_TIMEOUT
op_or
id|IW_POWER_ALL_R
suffix:semicolon
multiline_comment|/* Transmit Power - values are in mW */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|range.txpower
(braket
id|i
)braket
op_assign
id|cap_rid.txPowerLevels
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|range.txpower
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|range.num_txpower
op_assign
id|i
suffix:semicolon
id|range.txpower_capa
op_assign
id|IW_TXPOW_MWATT
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 9 */
macro_line|#if WIRELESS_EXT &gt; 10
id|range.we_version_source
op_assign
l_int|11
suffix:semicolon
id|range.we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range.retry_capa
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.retry_flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range.r_time_flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.min_retry
op_assign
l_int|1
suffix:semicolon
id|range.max_retry
op_assign
l_int|65535
suffix:semicolon
id|range.min_r_time
op_assign
l_int|1024
suffix:semicolon
id|range.max_r_time
op_assign
l_int|65535
op_star
l_int|1024
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
op_amp
id|range
comma
r_sizeof
(paren
r_struct
id|iw_range
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCGIWPOWER
suffix:colon
(brace
r_int
id|mode
op_assign
id|config.powerSaveMode
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.power.disabled
op_assign
(paren
id|mode
op_eq
id|POWERSAVE_CAM
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.power.flags
op_amp
id|IW_POWER_TYPE
)paren
op_eq
id|IW_POWER_TIMEOUT
)paren
(brace
id|wrq-&gt;u.power.value
op_assign
(paren
r_int
)paren
id|config.fastListenDelay
op_star
l_int|1024
suffix:semicolon
id|wrq-&gt;u.power.flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
)brace
r_else
(brace
id|wrq-&gt;u.power.value
op_assign
(paren
r_int
)paren
id|config.fastListenInterval
op_star
l_int|1024
suffix:semicolon
id|wrq-&gt;u.power.flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|config.rmode
op_amp
l_int|0xFF
)paren
op_eq
id|RXMODE_ADDR
)paren
id|wrq-&gt;u.power.flags
op_or_assign
id|IW_POWER_UNICAST_R
suffix:semicolon
r_else
id|wrq-&gt;u.power.flags
op_or_assign
id|IW_POWER_ALL_R
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIWPOWER
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.power.disabled
)paren
(brace
r_if
c_cond
(paren
(paren
id|config.rmode
op_amp
l_int|0xFF
)paren
op_ge
id|RXMODE_RFMON
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|config.powerSaveMode
op_assign
id|POWERSAVE_CAM
suffix:semicolon
id|config.rmode
op_and_assign
l_int|0xFF00
suffix:semicolon
id|config.rmode
op_or_assign
id|RXMODE_BC_MC_ADDR
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.power.flags
op_amp
id|IW_POWER_TYPE
)paren
op_eq
id|IW_POWER_TIMEOUT
)paren
(brace
id|config.fastListenDelay
op_assign
(paren
id|wrq-&gt;u.power.value
op_plus
l_int|500
)paren
op_div
l_int|1024
suffix:semicolon
id|config.powerSaveMode
op_assign
id|POWERSAVE_PSPCAM
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|wrq-&gt;u.power.flags
op_amp
id|IW_POWER_TYPE
)paren
op_eq
id|IW_POWER_PERIOD
)paren
(brace
id|config.fastListenInterval
op_assign
id|config.listenInterval
op_assign
(paren
id|wrq-&gt;u.power.value
op_plus
l_int|500
)paren
op_div
l_int|1024
suffix:semicolon
id|config.powerSaveMode
op_assign
id|POWERSAVE_PSPCAM
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|wrq-&gt;u.power.flags
op_amp
id|IW_POWER_MODE
)paren
(brace
r_case
id|IW_POWER_UNICAST_R
suffix:colon
r_if
c_cond
(paren
(paren
id|config.rmode
op_amp
l_int|0xFF
)paren
op_ge
id|RXMODE_RFMON
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|config.rmode
op_and_assign
l_int|0xFF00
suffix:semicolon
id|config.rmode
op_or_assign
id|RXMODE_ADDR
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_POWER_ALL_R
suffix:colon
r_if
c_cond
(paren
(paren
id|config.rmode
op_amp
l_int|0xFF
)paren
op_ge
id|RXMODE_RFMON
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|config.rmode
op_and_assign
l_int|0xFF00
suffix:semicolon
id|config.rmode
op_or_assign
id|RXMODE_BC_MC_ADDR
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_case
id|IW_POWER_ON
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCGIWSENS
suffix:colon
id|wrq-&gt;u.sens.value
op_assign
id|config.rssiThreshold
suffix:semicolon
id|wrq-&gt;u.sens.disabled
op_assign
(paren
id|wrq-&gt;u.sens.value
op_eq
l_int|0
)paren
suffix:semicolon
id|wrq-&gt;u.sens.fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWSENS
suffix:colon
id|config.rssiThreshold
op_assign
id|wrq-&gt;u.sens.disabled
ques
c_cond
id|RSSI_DEFAULT
suffix:colon
id|wrq-&gt;u.sens.value
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWAPLIST
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|sockaddr
id|s
(braket
l_int|4
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|s
(braket
id|i
)braket
dot
id|sa_data
comma
id|status_rid.bssid
(braket
id|i
)braket
comma
l_int|6
)paren
suffix:semicolon
id|s
(braket
id|i
)braket
dot
id|sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
)brace
id|wrq-&gt;u.data.length
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
op_amp
id|s
comma
r_sizeof
(paren
id|s
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#ifdef WIRELESS_SPY
singleline_comment|// Set the spy list
r_case
id|SIOCSIWSPY
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.length
OG
id|IW_MAX_SPY
)paren
(brace
id|rc
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_break
suffix:semicolon
)brace
id|local-&gt;spy_number
op_assign
id|wrq-&gt;u.data.length
suffix:semicolon
r_if
c_cond
(paren
id|local-&gt;spy_number
OG
l_int|0
)paren
(brace
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|address
comma
id|wrq-&gt;u.data.pointer
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|local-&gt;spy_number
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|local-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
id|memcpy
c_func
(paren
id|local-&gt;spy_address
(braket
id|i
)braket
comma
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
l_int|6
)paren
suffix:semicolon
id|memset
c_func
(paren
id|local-&gt;spy_stat
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// Get the spy list
r_case
id|SIOCGIWSPY
suffix:colon
id|wrq-&gt;u.data.length
op_assign
id|local-&gt;spy_number
suffix:semicolon
r_if
c_cond
(paren
(paren
id|local-&gt;spy_number
OG
l_int|0
)paren
op_logical_and
(paren
id|wrq-&gt;u.data.pointer
)paren
)paren
(brace
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rc
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|wrq-&gt;u.data.pointer
comma
(paren
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_plus
r_sizeof
(paren
r_struct
id|sockaddr
)paren
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_break
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|local-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
id|local-&gt;spy_address
(braket
id|i
)braket
comma
l_int|6
)paren
suffix:semicolon
id|address
(braket
id|i
)braket
dot
id|sa_family
op_assign
id|AF_UNIX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
id|address
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|local-&gt;spy_number
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
op_plus
(paren
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|local-&gt;spy_number
)paren
comma
id|local-&gt;spy_stat
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|local-&gt;spy_number
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|local-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
id|local-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif /* WIRELESS_SPY */
macro_line|#ifdef CISCO_EXT
r_case
id|SIOCGIWPRIV
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_struct
id|iw_priv_args
id|priv
(braket
)braket
op_assign
(brace
multiline_comment|/* cmd, set_args, get_args, name */
(brace
id|AIROIOCTL
comma
id|IW_PRIV_TYPE_BYTE
op_or
id|IW_PRIV_SIZE_FIXED
op_or
r_sizeof
(paren
id|aironet_ioctl
)paren
comma
id|IW_PRIV_TYPE_BYTE
op_or
l_int|2047
comma
l_string|&quot;airoioctl&quot;
)brace
comma
(brace
id|AIROIDIFC
comma
id|IW_PRIV_TYPE_BYTE
op_or
id|IW_PRIV_SIZE_FIXED
op_or
r_sizeof
(paren
id|aironet_ioctl
)paren
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;airoidifc&quot;
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* Set the number of ioctl available */
id|wrq-&gt;u.data.length
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Copy structure to the user buffer */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
(paren
id|u_char
op_star
)paren
id|priv
comma
r_sizeof
(paren
id|priv
)paren
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
macro_line|#endif /* CISCO_EXT */
macro_line|#endif /* WIRELESS_EXT */
macro_line|#ifdef CISCO_EXT
r_case
id|AIROIDIFC
suffix:colon
(brace
r_int
id|val
op_assign
id|AIROMAGIC
suffix:semicolon
id|aironet_ioctl
id|com
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|com
comma
id|rq-&gt;ifr_data
comma
r_sizeof
(paren
id|com
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|com.data
comma
(paren
r_char
op_star
)paren
op_amp
id|val
comma
r_sizeof
(paren
id|val
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AIROIOCTL
suffix:colon
multiline_comment|/* Get the command struct and hand it off for evaluation by &n;&t;&t; * the proper subfunction&n;&t;&t; */
(brace
id|aironet_ioctl
id|com
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|com
comma
id|rq-&gt;ifr_data
comma
r_sizeof
(paren
id|com
)paren
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Seperate R/W functions bracket legality here&n;&t;&t; */
r_if
c_cond
(paren
id|com.command
op_le
id|AIROGSTATSD32
)paren
id|rc
op_assign
id|readrids
c_func
(paren
id|dev
comma
op_amp
id|com
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|com.command
op_ge
id|AIROPCAP
op_logical_and
id|com.command
op_le
id|AIROPLEAPUSR
)paren
id|rc
op_assign
id|writerids
c_func
(paren
id|dev
comma
op_amp
id|com
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|com.command
op_ge
id|AIROFLSHRST
op_logical_and
id|com.command
op_le
id|AIRORESTART
)paren
id|rc
op_assign
id|flashcard
c_func
(paren
id|dev
comma
op_amp
id|com
)paren
suffix:semicolon
r_else
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Bad command in ioctl */
)brace
r_break
suffix:semicolon
macro_line|#endif /* CISCO_EXT */
singleline_comment|// All other calls are currently unsupported
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
macro_line|#ifdef WIRELESS_EXT
multiline_comment|/* Some of the &quot;SET&quot; function may have modified some of the&n;&t; * parameters. It&squot;s now time to commit them in the card */
r_if
c_cond
(paren
id|local-&gt;need_commit
)paren
(brace
multiline_comment|/* A classical optimisation here is to not commit any change&n;&t;&t; * if the card is not &quot;opened&quot;. This is what we do in&n;&t;&t; * wvlan_cs (see for details).&n;&t;&t; * For that, we would need to have the config RID saved in&n;&t;&t; * the airo_info struct and make sure to not re-read it if&n;&t;&t; * local-&gt;need_commit != 0. Then, you need to patch &quot;open&quot;&n;&t;&t; * to do the final commit of all parameters...&n;&t;&t; * Jean II */
id|Resp
id|rsp
suffix:semicolon
id|disable_MAC
c_func
(paren
id|local
)paren
suffix:semicolon
id|local-&gt;config
op_assign
id|config
suffix:semicolon
multiline_comment|/* ???? config is local !!! */
id|checkThrottle
c_func
(paren
op_amp
id|config
)paren
suffix:semicolon
id|writeConfigRid
c_func
(paren
id|local
comma
op_amp
id|config
)paren
suffix:semicolon
id|enable_MAC
c_func
(paren
id|local
comma
op_amp
id|rsp
)paren
suffix:semicolon
id|local-&gt;need_commit
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_EXT */
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef WIRELESS_EXT
multiline_comment|/*&n; * Get the Wireless stats out of the driver&n; * Note : irq and spinlock protection will occur in the subroutines&n; *&n; * TODO :&n; *&t;o Check if work in Ad-Hoc mode (otherwise, use SPY, as in wvlan_cs)&n; *&t;o Find the noise level&n; *&t;o Convert values to dBm&n; *&t;o Fill out discard.misc with something interesting&n; *&n; * Jean&n; */
DECL|function|airo_get_wireless_stats
r_struct
id|iw_statistics
op_star
id|airo_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|airo_info
op_star
id|local
op_assign
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|StatusRid
id|status_rid
suffix:semicolon
id|StatsRid
id|stats_rid
suffix:semicolon
r_int
op_star
id|vals
op_assign
id|stats_rid.vals
suffix:semicolon
multiline_comment|/* Get stats out of the card */
id|readStatusRid
c_func
(paren
id|local
comma
op_amp
id|status_rid
)paren
suffix:semicolon
id|readStatsRid
c_func
(paren
id|local
comma
op_amp
id|stats_rid
comma
id|RID_STATS
)paren
suffix:semicolon
multiline_comment|/* The status */
id|local-&gt;wstats.status
op_assign
id|status_rid.mode
suffix:semicolon
multiline_comment|/* Signal quality and co. But where is the noise level ??? */
id|local-&gt;wstats.qual.qual
op_assign
id|status_rid.signalQuality
suffix:semicolon
id|local-&gt;wstats.qual.level
op_assign
id|status_rid.normalizedSignalStrength
suffix:semicolon
id|local-&gt;wstats.qual.noise
op_assign
l_int|0
suffix:semicolon
id|local-&gt;wstats.qual.updated
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Packets discarded in the wireless adapter due to wireless&n;&t; * specific problems */
id|local-&gt;wstats.discard.nwid
op_assign
id|vals
(braket
l_int|56
)braket
op_plus
id|vals
(braket
l_int|57
)braket
op_plus
id|vals
(braket
l_int|58
)braket
suffix:semicolon
multiline_comment|/* SSID Mismatch */
id|local-&gt;wstats.discard.code
op_assign
id|vals
(braket
l_int|6
)braket
suffix:semicolon
multiline_comment|/* RxWepErr */
id|local-&gt;wstats.discard.misc
op_assign
id|vals
(braket
l_int|1
)braket
op_plus
id|vals
(braket
l_int|2
)braket
op_plus
id|vals
(braket
l_int|3
)braket
op_plus
id|vals
(braket
l_int|4
)braket
op_plus
id|vals
(braket
l_int|30
)braket
op_plus
id|vals
(braket
l_int|32
)braket
suffix:semicolon
r_return
(paren
op_amp
id|local-&gt;wstats
)paren
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_EXT */
macro_line|#ifdef CISCO_EXT
multiline_comment|/*&n; * This just translates from driver IOCTL codes to the command codes to &n; * feed to the radio&squot;s host interface. Things can be added/deleted &n; * as needed.  This represents the READ side of control I/O to &n; * the card&n; */
DECL|function|readrids
r_static
r_int
id|readrids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
(brace
r_int
r_int
id|ridcode
suffix:semicolon
r_int
r_char
id|iobuf
(braket
l_int|2048
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|comp-&gt;command
)paren
(brace
r_case
id|AIROGCAP
suffix:colon
id|ridcode
op_assign
id|RID_CAPABILITIES
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGCFG
suffix:colon
id|ridcode
op_assign
id|RID_CONFIG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGSLIST
suffix:colon
id|ridcode
op_assign
id|RID_SSID
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGVLIST
suffix:colon
id|ridcode
op_assign
id|RID_APLIST
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGDRVNAM
suffix:colon
id|ridcode
op_assign
id|RID_DRVNAME
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGEHTENC
suffix:colon
id|ridcode
op_assign
id|RID_ETHERENCAP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGWEPKTMP
suffix:colon
id|ridcode
op_assign
id|RID_WEP_TEMP
suffix:semicolon
multiline_comment|/* Only super-user can read WEP keys */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGWEPKNV
suffix:colon
id|ridcode
op_assign
id|RID_WEP_PERM
suffix:semicolon
multiline_comment|/* Only super-user can read WEP keys */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGSTAT
suffix:colon
id|ridcode
op_assign
id|RID_STATUS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGSTATSD32
suffix:colon
id|ridcode
op_assign
id|RID_STATSDELTA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROGSTATSC32
suffix:colon
id|ridcode
op_assign
id|RID_STATS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|PC4500_readrid
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
comma
id|ridcode
comma
id|iobuf
comma
r_sizeof
(paren
id|iobuf
)paren
)paren
suffix:semicolon
multiline_comment|/* get the count of bytes in the rid  docs say 1st 2 bytes is it.&n;&t; * then return it to the user &n;&t; * 9/22/2000 Honor user given length&n;&t; */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|comp-&gt;data
comma
id|iobuf
comma
id|min
(paren
id|comp-&gt;len
comma
r_sizeof
(paren
id|iobuf
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Danger Will Robinson write the rids here&n; */
DECL|function|writerids
r_static
r_int
id|writerids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
(brace
r_int
id|ridcode
suffix:semicolon
id|Resp
id|rsp
suffix:semicolon
r_static
r_int
(paren
op_star
id|writer
)paren
(paren
r_struct
id|airo_info
op_star
comma
id|u16
id|rid
comma
r_const
r_void
op_star
comma
r_int
)paren
suffix:semicolon
r_int
r_char
id|iobuf
(braket
l_int|2048
)braket
suffix:semicolon
multiline_comment|/* Only super-user can write RIDs */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|ridcode
op_assign
l_int|0
suffix:semicolon
id|writer
op_assign
id|do_writerid
suffix:semicolon
r_switch
c_cond
(paren
id|comp-&gt;command
)paren
(brace
r_case
id|AIROPSIDS
suffix:colon
id|ridcode
op_assign
id|RID_SSID
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPCAP
suffix:colon
id|ridcode
op_assign
id|RID_CAPABILITIES
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPAPLIST
suffix:colon
id|ridcode
op_assign
id|RID_APLIST
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPCFG
suffix:colon
id|ridcode
op_assign
id|RID_CONFIG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPWEPKEYNV
suffix:colon
id|ridcode
op_assign
id|RID_WEP_PERM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPLEAPUSR
suffix:colon
id|ridcode
op_assign
id|RID_LEAPUSERNAME
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPLEAPPWD
suffix:colon
id|ridcode
op_assign
id|RID_LEAPPASSWORD
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AIROPWEPKEY
suffix:colon
id|ridcode
op_assign
id|RID_WEP_TEMP
suffix:semicolon
id|writer
op_assign
id|PC4500_writerid
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* this is not really a rid but a command given to the card &n;&t;&t; * same with MAC off&n;&t;&t; */
r_case
id|AIROPMACON
suffix:colon
r_if
c_cond
(paren
id|enable_MAC
c_func
(paren
id|dev-&gt;priv
comma
op_amp
id|rsp
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t;&t; * Evidently this code in the airo driver does not get a symbol&n;&t;&t; * as disable_MAC. it&squot;s probably so short the compiler does not gen one.&n;&t;&t; */
r_case
id|AIROPMACOFF
suffix:colon
id|disable_MAC
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* This command merely clears the counts does not actually store any data&n;&t;&t; * only reads rid. But as it changes the cards state, I put it in the&n;&t;&t; * writerid routines.&n;&t;&t; */
r_case
id|AIROPSTCLR
suffix:colon
id|ridcode
op_assign
id|RID_STATSDELTACLEAR
suffix:semicolon
id|PC4500_readrid
c_func
(paren
id|dev-&gt;priv
comma
id|ridcode
comma
id|iobuf
comma
r_sizeof
(paren
id|iobuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|comp-&gt;data
comma
id|iobuf
comma
id|min
c_func
(paren
id|comp-&gt;len
comma
r_sizeof
(paren
id|iobuf
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
multiline_comment|/* Blarg! */
)brace
r_if
c_cond
(paren
id|comp-&gt;len
OG
r_sizeof
(paren
id|iobuf
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|iobuf
comma
id|comp-&gt;data
comma
id|comp-&gt;len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|writer
)paren
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
comma
id|ridcode
comma
id|iobuf
comma
id|comp-&gt;len
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; * Ancillary flash / mod functions much black magic lurkes here              *&n; *****************************************************************************&n; */
multiline_comment|/* &n; * Flash command switch table&n; */
DECL|function|flashcard
r_int
id|flashcard
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|aironet_ioctl
op_star
id|comp
)paren
(brace
r_int
id|z
suffix:semicolon
r_int
id|cmdreset
c_func
(paren
r_struct
id|airo_info
op_star
)paren
suffix:semicolon
r_int
id|setflashmode
c_func
(paren
r_struct
id|airo_info
op_star
)paren
suffix:semicolon
r_int
id|flashgchar
c_func
(paren
r_struct
id|airo_info
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_int
id|flashpchar
c_func
(paren
r_struct
id|airo_info
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_int
id|flashputbuf
c_func
(paren
r_struct
id|airo_info
op_star
)paren
suffix:semicolon
r_int
id|flashrestart
c_func
(paren
r_struct
id|airo_info
op_star
comma
r_struct
id|net_device
op_star
)paren
suffix:semicolon
multiline_comment|/* Only super-user can modify flash */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_switch
c_cond
(paren
id|comp-&gt;command
)paren
(brace
r_case
id|AIROFLSHRST
suffix:colon
r_return
id|cmdreset
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_case
id|AIROFLSHSTFL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|flash
op_logical_and
(paren
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|flash
op_assign
id|kmalloc
(paren
id|FLASHSIZE
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
id|setflashmode
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_case
id|AIROFLSHGCHR
suffix:colon
multiline_comment|/* Get char from aux */
r_if
c_cond
(paren
id|comp-&gt;len
op_ne
r_sizeof
(paren
r_int
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|z
comma
id|comp-&gt;data
comma
id|comp-&gt;len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|flashgchar
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
comma
id|z
comma
l_int|8000
)paren
suffix:semicolon
r_case
id|AIROFLSHPCHR
suffix:colon
multiline_comment|/* Send char to card. */
r_if
c_cond
(paren
id|comp-&gt;len
op_ne
r_sizeof
(paren
r_int
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|z
comma
id|comp-&gt;data
comma
id|comp-&gt;len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|flashpchar
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
comma
id|z
comma
l_int|8000
)paren
suffix:semicolon
r_case
id|AIROFLPUTBUF
suffix:colon
multiline_comment|/* Send 32k to card */
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|flash
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|comp-&gt;len
OG
id|FLASHSIZE
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|flash
comma
id|comp-&gt;data
comma
id|comp-&gt;len
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|flashputbuf
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AIRORESTART
suffix:colon
r_if
c_cond
(paren
id|flashrestart
c_func
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|macro|FLASH_COMMAND
mdefine_line|#define FLASH_COMMAND  0x7e7e
multiline_comment|/* &n; * STEP 1)&n; * Disable MAC and do soft reset on &n; * card. &n; */
DECL|function|cmdreset
r_int
id|cmdreset
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
id|disable_MAC
c_func
(paren
id|ai
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|waitbusy
(paren
id|ai
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Waitbusy hang before RESET&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|OUT4500
c_func
(paren
id|ai
comma
id|COMMAND
comma
id|CMD_SOFTRESET
)paren
suffix:semicolon
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
)paren
suffix:semicolon
multiline_comment|/* WAS 600 12/7/00 */
r_if
c_cond
(paren
op_logical_neg
id|waitbusy
(paren
id|ai
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Waitbusy hang AFTER RESET&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* STEP 2)&n; * Put the card in legendary flash &n; * mode&n; */
DECL|function|setflashmode
r_int
id|setflashmode
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS0
comma
id|FLASH_COMMAND
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS1
comma
id|FLASH_COMMAND
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS0
comma
id|FLASH_COMMAND
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|COMMAND
comma
l_int|0x10
)paren
suffix:semicolon
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 500ms delay */
r_if
c_cond
(paren
op_logical_neg
id|waitbusy
c_func
(paren
id|ai
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Waitbusy hang after setflash mode&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Put character to SWS0 wait for dwelltime &n; * x 50us for  echo . &n; */
DECL|function|flashpchar
r_int
id|flashpchar
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
r_int
id|byte
comma
r_int
id|dwelltime
)paren
(brace
r_int
id|echo
suffix:semicolon
r_int
id|waittime
suffix:semicolon
id|byte
op_or_assign
l_int|0x8000
suffix:semicolon
r_if
c_cond
(paren
id|dwelltime
op_eq
l_int|0
)paren
(brace
id|dwelltime
op_assign
l_int|200
suffix:semicolon
)brace
id|waittime
op_assign
id|dwelltime
suffix:semicolon
multiline_comment|/* Wait for busy bit d15 to go false indicating buffer empty */
r_while
c_loop
(paren
(paren
id|IN4500
(paren
id|ai
comma
id|SWS0
)paren
op_amp
l_int|0x8000
)paren
op_logical_and
id|waittime
OG
l_int|0
)paren
(brace
id|udelay
(paren
l_int|50
)paren
suffix:semicolon
id|waittime
op_sub_assign
l_int|50
suffix:semicolon
)brace
multiline_comment|/* timeout for busy clear wait */
r_if
c_cond
(paren
id|waittime
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;flash putchar busywait timeout! &bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* Port is clear now write byte and wait for it to echo back */
r_do
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS0
comma
id|byte
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|dwelltime
op_sub_assign
l_int|50
suffix:semicolon
id|echo
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|SWS1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dwelltime
op_ge
l_int|0
op_logical_and
id|echo
op_ne
id|byte
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS1
comma
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|echo
op_eq
id|byte
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n; * Get a character from the card matching matchbyte&n; * Step 3)&n; */
DECL|function|flashgchar
r_int
(def_block
id|flashgchar
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
r_int
id|matchbyte
comma
r_int
id|dwelltime
)paren
(brace
r_int
id|rchar
suffix:semicolon
r_int
r_char
id|rbyte
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|rchar
op_assign
id|IN4500
c_func
(paren
id|ai
comma
id|SWS1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dwelltime
op_logical_and
op_logical_neg
(paren
l_int|0x8000
op_amp
id|rchar
)paren
)paren
(brace
id|dwelltime
op_sub_assign
l_int|10
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rbyte
op_assign
l_int|0xff
op_amp
id|rchar
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rbyte
op_eq
id|matchbyte
)paren
op_logical_and
(paren
l_int|0x8000
op_amp
id|rchar
)paren
)paren
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS1
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rbyte
op_eq
l_int|0x81
op_logical_or
id|rbyte
op_eq
l_int|0x82
op_logical_or
id|rbyte
op_eq
l_int|0x83
op_logical_or
id|rbyte
op_eq
l_int|0x1a
op_logical_or
l_int|0xffff
op_eq
id|rchar
)paren
(brace
r_break
suffix:semicolon
)brace
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dwelltime
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)def_block
multiline_comment|/* &n; * Transfer 32k of firmware data from user buffer to our buffer and &n; * send to the card &n; */
DECL|function|flashputbuf
r_int
(def_block
id|flashputbuf
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
)paren
(brace
r_int
id|nwords
suffix:semicolon
multiline_comment|/* Write stuff */
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXPAGE
comma
l_int|0x100
)paren
suffix:semicolon
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXOFF
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|nwords
op_assign
l_int|0
suffix:semicolon
id|nwords
op_ne
id|FLASHSIZE
op_div
l_int|2
suffix:semicolon
id|nwords
op_increment
)paren
(brace
id|OUT4500
c_func
(paren
id|ai
comma
id|AUXDATA
comma
id|ai-&gt;flash
(braket
id|nwords
)braket
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
id|OUT4500
c_func
(paren
id|ai
comma
id|SWS0
comma
l_int|0x8000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)def_block
multiline_comment|/*&n; *&n; */
DECL|function|flashrestart
r_int
(def_block
id|flashrestart
c_func
(paren
r_struct
id|airo_info
op_star
id|ai
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|status
suffix:semicolon
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
)paren
suffix:semicolon
multiline_comment|/* Added 12/7/00 */
id|status
op_assign
id|setup_card
c_func
(paren
id|ai
comma
id|dev-&gt;dev_addr
comma
op_amp
(paren
(paren
r_struct
id|airo_info
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|config
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_FIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ai-&gt;fids
(braket
id|i
)braket
op_assign
id|transmit_allocate
c_func
(paren
id|ai
comma
l_int|2312
)paren
suffix:semicolon
)brace
id|set_current_state
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
(paren
id|HZ
)paren
suffix:semicolon
multiline_comment|/* Added 12/7/00 */
r_return
id|status
suffix:semicolon
)brace
)def_block
macro_line|#endif /* CISCO_EXT */
multiline_comment|/*&n;    This program is free software; you can redistribute it and/or&n;    modify it under the terms of the GNU General Public License&n;    as published by the Free Software Foundation; either version 2&n;    of the License, or (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    In addition:&n;&n;    Redistribution and use in source and binary forms, with or without&n;    modification, are permitted provided that the following conditions&n;    are met:&n;&n;    1. Redistributions of source code must retain the above copyright&n;       notice, this list of conditions and the following disclaimer.&n;    2. Redistributions in binary form must reproduce the above copyright&n;       notice, this list of conditions and the following disclaimer in the&n;       documentation and/or other materials provided with the distribution.&n;    3. The name of the author may not be used to endorse or promote&n;       products derived from this software without specific prior written&n;       permission.&n;&n;    THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&squot;&squot; AND ANY EXPRESS OR&n;    IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED&n;    WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE&n;    ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,&n;    INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES&n;    (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR&n;    SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n;    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n;    STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n;    IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n;    POSSIBILITY OF SUCH DAMAGE.    &n;*/
DECL|variable|airo_init_module
id|module_init
c_func
(paren
id|airo_init_module
)paren
suffix:semicolon
DECL|variable|airo_cleanup_module
id|module_exit
c_func
(paren
id|airo_cleanup_module
)paren
suffix:semicolon
eof
