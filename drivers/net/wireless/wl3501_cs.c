multiline_comment|/*&n; * WL3501 Wireless LAN PCMCIA Card Driver for Linux&n; * Written originally for Linux 2.0.30 by Fox Chen, mhchen@golf.ccl.itri.org.tw&n; * Ported to 2.2, 2.4 &amp; 2.5 by Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; * Wireless extensions in 2.4 by Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;&n; *&n; * References used by Fox Chen while writing the original driver for 2.0.30:&n; *&n; *   1. WL24xx packet drivers (tooasm.asm)&n; *   2. Access Point Firmware Interface Specification for IEEE 802.11 SUTRO&n; *   3. IEEE 802.11&n; *   4. Linux network driver (/usr/src/linux/drivers/net)&n; *   5. ISA card driver - wl24.c&n; *   6. Linux PCMCIA skeleton driver - skeleton.c&n; *   7. Linux PCMCIA 3c589 network driver - 3c589_cs.c&n; *&n; * Tested with WL2400 firmware 1.2, Linux 2.0.30, and pcmcia-cs-2.9.12&n; *   1. Performance: about 165 Kbytes/sec in TCP/IP with Ad-Hoc mode.&n; *      rsh 192.168.1.3 &quot;dd if=/dev/zero bs=1k count=1000&quot; &gt; /dev/null&n; *      (Specification 2M bits/sec. is about 250 Kbytes/sec., but we must deduct&n; *       ETHER/IP/UDP/TCP header, and acknowledgement overhead)&n; *&n; * Tested with Planet AP in 2.4.17, 184 Kbytes/s in UDP in Infrastructure mode,&n; * 173 Kbytes/s in TCP.&n; *&n; * Tested with Planet AP in 2.5.73-bk, 216 Kbytes/s in Infrastructure mode&n; * with a SMP machine (dual pentium 100), using pktgen, 432 pps (pkt_size = 60)&n; */
DECL|macro|REALLY_SLOW_IO
macro_line|#undef REALLY_SLOW_IO&t;/* most systems can safely undef this */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;net/iw_handler.h&gt;
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/cisreg.h&gt;
macro_line|#include &lt;pcmcia/ds.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;wl3501.h&quot;
macro_line|#ifndef __i386__
DECL|macro|slow_down_io
mdefine_line|#define slow_down_io()
macro_line|#endif
multiline_comment|/* For rough constant delay */
DECL|macro|WL3501_NOPLOOP
mdefine_line|#define WL3501_NOPLOOP(n) { int x = 0; while (x++ &lt; n) slow_down_io(); }
multiline_comment|/*&n; * All the PCMCIA modules use PCMCIA_DEBUG to control debugging.  If you do not&n; * define PCMCIA_DEBUG at all, all the debug code will be left out.  If you&n; * compile with PCMCIA_DEBUG=0, the debug code will be present but disabled --&n; * but it can then be enabled for specific modules at load time with a&n; * &squot;pc_debug=#&squot; option to insmod.&n; */
DECL|macro|PCMCIA_DEBUG
mdefine_line|#define PCMCIA_DEBUG 0
macro_line|#ifdef PCMCIA_DEBUG
DECL|variable|pc_debug
r_static
r_int
id|pc_debug
op_assign
id|PCMCIA_DEBUG
suffix:semicolon
id|module_param
c_func
(paren
id|pc_debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(n, format, args...) &bslash;&n;&t;{ if (pc_debug &gt; (n)) &bslash;&n;&t;&t;printk(KERN_INFO &quot;%s: &quot; format &quot;&bslash;n&quot;, __FUNCTION__ , ##args); }
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(n, format, args...)
macro_line|#endif
DECL|macro|wl3501_outb
mdefine_line|#define wl3501_outb(a, b) { outb(a, b); slow_down_io(); }
DECL|macro|wl3501_outb_p
mdefine_line|#define wl3501_outb_p(a, b) { outb_p(a, b); slow_down_io(); }
DECL|macro|wl3501_outsb
mdefine_line|#define wl3501_outsb(a, b, c) { outsb(a, b, c); slow_down_io(); }
DECL|macro|WL3501_RELEASE_TIMEOUT
mdefine_line|#define WL3501_RELEASE_TIMEOUT (25 * HZ)
DECL|macro|WL3501_MAX_ADHOC_TRIES
mdefine_line|#define WL3501_MAX_ADHOC_TRIES 16
DECL|macro|WL3501_RESUME
mdefine_line|#define WL3501_RESUME&t;0
DECL|macro|WL3501_SUSPEND
mdefine_line|#define WL3501_SUSPEND&t;1
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
multiline_comment|/* Bit map of interrupts to choose from */
multiline_comment|/* This means pick from 15, 14, 12, 11, 10, 9, 7, 5, 4, and 3 */
DECL|variable|wl3501_irq_mask
r_static
r_int
r_int
id|wl3501_irq_mask
op_assign
l_int|0xdeb8
suffix:semicolon
DECL|variable|wl3501_irq_list
r_static
r_int
id|wl3501_irq_list
(braket
l_int|4
)braket
op_assign
(brace
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/*&n; * The event() function is this driver&squot;s Card Services event handler.  It will&n; * be called by Card Services when an appropriate card status event is&n; * received. The config() and release() entry points are used to configure or&n; * release a socket, in response to card insertion and ejection events.  They&n; * are invoked from the wl24 event handler.&n; */
r_static
r_void
id|wl3501_config
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
suffix:semicolon
r_static
r_void
id|wl3501_release
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
suffix:semicolon
r_static
r_int
id|wl3501_event
c_func
(paren
id|event_t
id|event
comma
r_int
id|pri
comma
id|event_callback_args_t
op_star
id|args
)paren
suffix:semicolon
multiline_comment|/*&n; * The dev_info variable is the &quot;key&quot; that is used to match up this&n; * device driver with appropriate cards, through the card configuration&n; * database.&n; */
DECL|variable|wl3501_dev_info
r_static
id|dev_info_t
id|wl3501_dev_info
op_assign
l_string|&quot;wl3501_cs&quot;
suffix:semicolon
DECL|variable|wl3501_chan2freq
r_static
r_int
id|wl3501_chan2freq
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
l_int|2412
comma
(braket
l_int|1
)braket
op_assign
l_int|2417
comma
(braket
l_int|2
)braket
op_assign
l_int|2422
comma
(braket
l_int|3
)braket
op_assign
l_int|2427
comma
(braket
l_int|4
)braket
op_assign
l_int|2432
comma
(braket
l_int|5
)braket
op_assign
l_int|2437
comma
(braket
l_int|6
)braket
op_assign
l_int|2442
comma
(braket
l_int|7
)braket
op_assign
l_int|2447
comma
(braket
l_int|8
)braket
op_assign
l_int|2452
comma
(braket
l_int|9
)braket
op_assign
l_int|2457
comma
(braket
l_int|10
)braket
op_assign
l_int|2462
comma
(braket
l_int|11
)braket
op_assign
l_int|2467
comma
(braket
l_int|12
)braket
op_assign
l_int|2472
comma
(braket
l_int|13
)braket
op_assign
l_int|2477
comma
)brace
suffix:semicolon
r_static
r_const
r_struct
(brace
DECL|member|reg_domain
r_int
id|reg_domain
suffix:semicolon
DECL|member|min
DECL|member|max
DECL|member|deflt
r_int
id|min
comma
id|max
comma
id|deflt
suffix:semicolon
DECL|variable|iw_channel_table
)brace
id|iw_channel_table
(braket
)braket
op_assign
(brace
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_FCC
comma
dot
id|min
op_assign
l_int|1
comma
dot
id|max
op_assign
l_int|11
comma
dot
id|deflt
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_DOC
comma
dot
id|min
op_assign
l_int|1
comma
dot
id|max
op_assign
l_int|11
comma
dot
id|deflt
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_ETSI
comma
dot
id|min
op_assign
l_int|1
comma
dot
id|max
op_assign
l_int|13
comma
dot
id|deflt
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_SPAIN
comma
dot
id|min
op_assign
l_int|10
comma
dot
id|max
op_assign
l_int|11
comma
dot
id|deflt
op_assign
l_int|10
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_FRANCE
comma
dot
id|min
op_assign
l_int|10
comma
dot
id|max
op_assign
l_int|13
comma
dot
id|deflt
op_assign
l_int|10
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_MKK
comma
dot
id|min
op_assign
l_int|14
comma
dot
id|max
op_assign
l_int|14
comma
dot
id|deflt
op_assign
l_int|14
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_MKK1
comma
dot
id|min
op_assign
l_int|1
comma
dot
id|max
op_assign
l_int|14
comma
dot
id|deflt
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|reg_domain
op_assign
id|IW_REG_DOMAIN_ISRAEL
comma
dot
id|min
op_assign
l_int|3
comma
dot
id|max
op_assign
l_int|9
comma
dot
id|deflt
op_assign
l_int|9
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * iw_valid_channel - validate channel in regulatory domain&n; * @reg_comain - regulatory domain&n; * @channel - channel to validate&n; *&n; * Returns 0 if invalid in the specified regulatory domain, non-zero if valid.&n; */
DECL|function|iw_valid_channel
r_static
r_int
id|iw_valid_channel
c_func
(paren
r_int
id|reg_domain
comma
r_int
id|channel
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|iw_channel_table
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|reg_domain
op_eq
id|iw_channel_table
(braket
id|i
)braket
dot
id|reg_domain
)paren
(brace
id|rc
op_assign
id|channel
op_ge
id|iw_channel_table
(braket
id|i
)braket
dot
id|min
op_logical_and
id|channel
op_le
id|iw_channel_table
(braket
id|i
)braket
dot
id|max
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * iw_default_channel - get default channel for a regulatory domain&n; * @reg_comain - regulatory domain&n; *&n; * Returns the default channel for a regulatory domain&n; */
DECL|function|iw_default_channel
r_static
r_int
id|iw_default_channel
c_func
(paren
r_int
id|reg_domain
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|iw_channel_table
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|reg_domain
op_eq
id|iw_channel_table
(braket
id|i
)braket
dot
id|reg_domain
)paren
(brace
id|rc
op_assign
id|iw_channel_table
(braket
id|i
)braket
dot
id|deflt
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|iw_set_mgmt_info_element
r_static
r_void
id|iw_set_mgmt_info_element
c_func
(paren
r_enum
id|iw_mgmt_info_element_ids
id|id
comma
r_struct
id|iw_mgmt_info_element
op_star
id|el
comma
r_void
op_star
id|value
comma
r_int
id|len
)paren
(brace
id|el-&gt;id
op_assign
id|id
suffix:semicolon
id|el-&gt;len
op_assign
id|len
suffix:semicolon
id|memcpy
c_func
(paren
id|el-&gt;data
comma
id|value
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|iw_copy_mgmt_info_element
r_static
r_void
id|iw_copy_mgmt_info_element
c_func
(paren
r_struct
id|iw_mgmt_info_element
op_star
id|to
comma
r_struct
id|iw_mgmt_info_element
op_star
id|from
)paren
(brace
id|iw_set_mgmt_info_element
c_func
(paren
id|from-&gt;id
comma
id|to
comma
id|from-&gt;data
comma
id|from-&gt;len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * A linked list of &quot;instances&quot; of the wl24 device.  Each actual PCMCIA card&n; * corresponds to one device instance, and is described by one dev_link_t&n; * structure (defined in ds.h).&n; *&n; * You may not want to use a linked list for this -- for example, the memory&n; * card driver uses an array of dev_link_t pointers, where minor device numbers&n; * are used to derive the corresponding array index.&n; */
DECL|variable|wl3501_dev_list
r_static
id|dev_link_t
op_star
id|wl3501_dev_list
suffix:semicolon
DECL|function|wl3501_switch_page
r_static
r_inline
r_void
id|wl3501_switch_page
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
id|page
)paren
(brace
id|wl3501_outb
c_func
(paren
id|page
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get Ethernet MAC addresss.&n; *&n; * WARNING: We switch to FPAGE0 and switc back again.&n; *          Making sure there is no other WL function beening called by ISR.&n; */
DECL|function|wl3501_get_flash_mac_addr
r_static
r_int
id|wl3501_get_flash_mac_addr
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_int
id|base_addr
op_assign
id|this-&gt;base_addr
suffix:semicolon
multiline_comment|/* get MAC addr */
id|wl3501_outb
c_func
(paren
id|WL3501_BSS_FPAGE3
comma
id|base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
multiline_comment|/* BSS */
id|wl3501_outb
c_func
(paren
l_int|0x00
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
multiline_comment|/* LMAL */
id|wl3501_outb
c_func
(paren
l_int|0x40
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* LMAH */
multiline_comment|/* wait for reading EEPROM */
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|0
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|2
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|3
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|4
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr
(braket
l_int|5
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;reg_domain
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|WL3501_BSS_FPAGE0
comma
id|base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
l_int|0x04
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
l_int|0x40
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;version
(braket
l_int|0
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;version
(braket
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
multiline_comment|/* switch to SRAM Page 0 (for safety) */
id|wl3501_switch_page
c_func
(paren
id|this
comma
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* The MAC addr should be 00:60:... */
r_return
id|this-&gt;mac_addr
(braket
l_int|0
)braket
op_eq
l_int|0x00
op_logical_and
id|this-&gt;mac_addr
(braket
l_int|1
)braket
op_eq
l_int|0x60
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_set_to_wla - Move &squot;size&squot; bytes from PC to card&n; * @dest: Card addressing space&n; * @src: PC addressing space&n; * @size: Bytes to move&n; *&n; * Move &squot;size&squot; bytes from PC to card. (Shouldn&squot;t be interrupted)&n; */
DECL|function|wl3501_set_to_wla
r_void
id|wl3501_set_to_wla
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|dest
comma
r_void
op_star
id|src
comma
r_int
id|size
)paren
(brace
multiline_comment|/* switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
(paren
id|dest
op_amp
l_int|0x8000
)paren
ques
c_cond
id|WL3501_BSS_SPAGE1
suffix:colon
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|dest
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
(paren
(paren
id|dest
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* rep out to Port A */
id|wl3501_outsb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
comma
id|src
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_get_from_wla - Move &squot;size&squot; bytes from card to PC&n; * @src: Card addressing space&n; * @dest: PC addressing space&n; * @size: Bytes to move&n; *&n; * Move &squot;size&squot; bytes from card to PC. (Shouldn&squot;t be interrupted)&n; */
DECL|function|wl3501_get_from_wla
r_void
id|wl3501_get_from_wla
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|src
comma
r_void
op_star
id|dest
comma
r_int
id|size
)paren
(brace
multiline_comment|/* switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
(paren
id|src
op_amp
l_int|0x8000
)paren
ques
c_cond
id|WL3501_BSS_SPAGE1
suffix:colon
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|src
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
(paren
id|src
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* rep get from Port A */
id|insb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
comma
id|dest
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get/Allocate a free Tx Data Buffer&n; *&n; *  *--------------*-----------------*----------------------------------*&n; *  |    PLCP      |    MAC Header   |  DST  SRC         Data ...       |&n; *  |  (24 bytes)  |    (30 bytes)   |  (6)  (6)  (Ethernet Row Data)   |&n; *  *--------------*-----------------*----------------------------------*&n; *  &bslash;               &bslash;- IEEE 802.11 -/ &bslash;-------------- len --------------/&n; *   &bslash;-struct wl3501_80211_tx_hdr--/   &bslash;-------- Ethernet Frame -------/&n; *&n; * Return = Postion in Card&n; */
DECL|function|wl3501_get_tx_buffer
r_static
id|u16
id|wl3501_get_tx_buffer
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|len
)paren
(brace
id|u16
id|next
comma
id|blk_cnt
op_assign
l_int|0
comma
id|zero
op_assign
l_int|0
suffix:semicolon
id|u16
id|full_len
op_assign
r_sizeof
(paren
r_struct
id|wl3501_80211_tx_hdr
)paren
op_plus
id|len
suffix:semicolon
id|u16
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|full_len
OG
id|this-&gt;tx_buffer_cnt
op_star
l_int|254
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
id|this-&gt;tx_buffer_head
suffix:semicolon
r_while
c_loop
(paren
id|full_len
)paren
(brace
r_if
c_cond
(paren
id|full_len
OL
l_int|254
)paren
id|full_len
op_assign
l_int|0
suffix:semicolon
r_else
id|full_len
op_sub_assign
l_int|254
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_head
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|full_len
)paren
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_head
comma
op_amp
id|zero
comma
r_sizeof
(paren
id|zero
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_head
op_assign
id|next
suffix:semicolon
id|blk_cnt
op_increment
suffix:semicolon
multiline_comment|/* if buffer is not enough */
r_if
c_cond
(paren
op_logical_neg
id|next
op_logical_and
id|full_len
)paren
(brace
id|this-&gt;tx_buffer_head
op_assign
id|ret
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|this-&gt;tx_buffer_cnt
op_sub_assign
id|blk_cnt
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Free an allocated Tx Buffer. ptr must be correct position.&n; */
DECL|function|wl3501_free_tx_buffer
r_static
r_void
id|wl3501_free_tx_buffer
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|ptr
)paren
(brace
multiline_comment|/* check if all space is not free */
r_if
c_cond
(paren
op_logical_neg
id|this-&gt;tx_buffer_head
)paren
id|this-&gt;tx_buffer_head
op_assign
id|ptr
suffix:semicolon
r_else
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_tail
comma
op_amp
id|ptr
comma
r_sizeof
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ptr
)paren
(brace
id|u16
id|next
suffix:semicolon
id|this-&gt;tx_buffer_cnt
op_increment
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_tail
op_assign
id|ptr
suffix:semicolon
id|ptr
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|wl3501_esbq_req_test
r_static
r_int
id|wl3501_esbq_req_test
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
op_amp
l_int|0x80
suffix:semicolon
)brace
DECL|function|wl3501_esbq_req
r_static
r_void
id|wl3501_esbq_req
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
op_star
id|ptr
)paren
(brace
id|u16
id|tmp
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
comma
id|ptr
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
op_plus
l_int|2
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|this-&gt;esbq_req_head
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_head
op_ge
id|this-&gt;esbq_req_end
)paren
id|this-&gt;esbq_req_head
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
)brace
DECL|function|wl3501_esbq_exec
r_static
r_int
id|wl3501_esbq_exec
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
r_void
op_star
id|sig
comma
r_int
id|sig_size
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
id|sig_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
id|sig
comma
id|sig_size
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_mib_value
r_static
r_int
id|wl3501_get_mib_value
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
id|index
comma
r_void
op_star
id|bf
comma
r_int
id|size
)paren
(brace
r_struct
id|wl3501_get_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_GET_REQ
comma
dot
id|mib_attrib
op_assign
id|index
comma
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|this-&gt;sig_get_confirm.mib_status
op_assign
l_int|255
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wait_event_interruptible
c_func
(paren
id|this-&gt;wait
comma
id|this-&gt;sig_get_confirm.mib_status
op_ne
l_int|255
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|memcpy
c_func
(paren
id|bf
comma
id|this-&gt;sig_get_confirm.mib_value
comma
id|size
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_pwr_mgmt
r_static
r_int
id|wl3501_pwr_mgmt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
r_int
id|suspend
)paren
(brace
r_struct
id|wl3501_pwr_mgmt_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_PWR_MGMT_REQ
comma
dot
id|pwr_save
op_assign
id|suspend
comma
dot
id|wake_up
op_assign
op_logical_neg
id|suspend
comma
dot
id|receive_dtims
op_assign
l_int|10
comma
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|this-&gt;sig_pwr_mgmt_confirm.status
op_assign
l_int|255
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wait_event_interruptible
c_func
(paren
id|this-&gt;wait
comma
id|this-&gt;sig_pwr_mgmt_confirm.status
op_ne
l_int|255
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s status=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|suspend
ques
c_cond
l_string|&quot;suspend&quot;
suffix:colon
l_string|&quot;resume&quot;
comma
id|this-&gt;sig_pwr_mgmt_confirm.status
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_send_pkt - Send a packet.&n; * @this - card&n; *&n; * Send a packet.&n; *&n; * data = Ethernet raw frame.  (e.g. data[0] - data[5] is Dest MAC Addr,&n; *                                   data[6] - data[11] is Src MAC Addr)&n; * Ref: IEEE 802.11&n; */
DECL|function|wl3501_send_pkt
r_static
r_int
id|wl3501_send_pkt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
op_star
id|data
comma
id|u16
id|len
)paren
(brace
id|u16
id|bf
comma
id|sig_bf
comma
id|next
comma
id|tmplen
comma
id|pktlen
suffix:semicolon
r_struct
id|wl3501_md_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_MD_REQ
comma
)brace
suffix:semicolon
id|u8
op_star
id|pdata
op_assign
(paren
r_char
op_star
)paren
id|data
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|sig_bf
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sig_bf
)paren
multiline_comment|/* No free buffer available */
r_goto
id|out
suffix:semicolon
id|bf
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
id|len
op_plus
l_int|26
op_plus
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bf
)paren
(brace
multiline_comment|/* No free buffer available */
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|sig_bf
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sig.daddr
(braket
l_int|0
)braket
comma
id|pdata
comma
l_int|12
)paren
suffix:semicolon
id|pktlen
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|pdata
op_add_assign
l_int|12
suffix:semicolon
id|sig.data
op_assign
id|bf
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
op_star
id|pdata
)paren
op_star
l_int|256
op_plus
(paren
op_star
(paren
id|pdata
op_plus
l_int|1
)paren
)paren
)paren
OG
l_int|1500
)paren
(brace
id|u8
id|addr4
(braket
id|ETH_ALEN
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
l_int|0xAA
comma
(braket
l_int|1
)braket
op_assign
l_int|0xAA
comma
(braket
l_int|2
)braket
op_assign
l_int|0x03
comma
(braket
l_int|4
)braket
op_assign
l_int|0x00
comma
)brace
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
m_offsetof
(paren
r_struct
id|wl3501_tx_hdr
comma
id|addr4
)paren
comma
id|addr4
comma
r_sizeof
(paren
id|addr4
)paren
)paren
suffix:semicolon
id|sig.size
op_assign
id|pktlen
op_plus
l_int|24
op_plus
l_int|4
op_plus
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|pktlen
OG
(paren
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
)paren
)paren
(brace
id|tmplen
op_assign
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
suffix:semicolon
id|pktlen
op_sub_assign
id|tmplen
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
r_else
(brace
id|sig.size
op_assign
id|pktlen
op_plus
l_int|24
op_plus
l_int|4
op_minus
l_int|2
suffix:semicolon
id|pdata
op_add_assign
l_int|2
suffix:semicolon
id|pktlen
op_sub_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|pktlen
OG
(paren
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
)paren
)paren
(brace
id|tmplen
op_assign
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
suffix:semicolon
id|pktlen
op_sub_assign
id|tmplen
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
m_offsetof
(paren
r_struct
id|wl3501_tx_hdr
comma
id|addr4
)paren
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pktlen
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|pktlen
OG
l_int|254
)paren
(brace
id|tmplen
op_assign
l_int|254
suffix:semicolon
id|pktlen
op_sub_assign
l_int|254
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|sig_bf
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|sig_bf
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_resync
r_static
r_int
id|wl3501_mgmt_resync
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_resync_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_RESYNC_REQ
comma
)brace
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_fw_bss_type
r_static
r_inline
r_int
id|wl3501_fw_bss_type
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_return
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
ques
c_cond
id|WL3501_NET_TYPE_INFRA
suffix:colon
id|WL3501_NET_TYPE_ADHOC
suffix:semicolon
)brace
DECL|function|wl3501_fw_cap_info
r_static
r_inline
r_int
id|wl3501_fw_cap_info
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_return
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
ques
c_cond
id|WL3501_MGMT_CAPABILITY_ESS
suffix:colon
id|WL3501_MGMT_CAPABILITY_IBSS
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_scan
r_static
r_int
id|wl3501_mgmt_scan
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|chan_time
)paren
(brace
r_struct
id|wl3501_scan_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_SCAN_REQ
comma
dot
id|scan_type
op_assign
id|WL3501_SCAN_TYPE_ACTIVE
comma
dot
id|probe_delay
op_assign
l_int|0x10
comma
dot
id|min_chan_time
op_assign
id|chan_time
comma
dot
id|max_chan_time
op_assign
id|chan_time
comma
dot
id|bss_type
op_assign
id|wl3501_fw_bss_type
c_func
(paren
id|this
)paren
comma
)brace
suffix:semicolon
id|this-&gt;bss_cnt
op_assign
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_join
r_static
r_int
id|wl3501_mgmt_join
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|stas
)paren
(brace
r_struct
id|wl3501_join_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_JOIN_REQ
comma
dot
id|timeout
op_assign
l_int|10
comma
dot
id|ds_pset
op_assign
(brace
dot
id|el
op_assign
(brace
dot
id|id
op_assign
id|IW_MGMT_INFO_ELEMENT_DS_PARAMETER_SET
comma
dot
id|len
op_assign
l_int|1
comma
)brace
comma
dot
id|chan
op_assign
id|this-&gt;chan
comma
)brace
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sig.beacon_period
comma
op_amp
id|this-&gt;bss_set
(braket
id|stas
)braket
dot
id|beacon_period
comma
l_int|72
)paren
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_start
r_static
r_int
id|wl3501_mgmt_start
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_start_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_START_REQ
comma
dot
id|beacon_period
op_assign
l_int|400
comma
dot
id|dtim_period
op_assign
l_int|1
comma
dot
id|ds_pset
op_assign
(brace
dot
id|el
op_assign
(brace
dot
id|id
op_assign
id|IW_MGMT_INFO_ELEMENT_DS_PARAMETER_SET
comma
dot
id|len
op_assign
l_int|1
comma
)brace
comma
dot
id|chan
op_assign
id|this-&gt;chan
comma
)brace
comma
dot
id|bss_basic_rset
op_assign
(brace
dot
id|el
op_assign
(brace
dot
id|id
op_assign
id|IW_MGMT_INFO_ELEMENT_SUPPORTED_RATES
comma
dot
id|len
op_assign
l_int|2
comma
)brace
comma
dot
id|data_rate_labels
op_assign
(brace
(braket
l_int|0
)braket
op_assign
id|IW_MGMT_RATE_LABEL_MANDATORY
op_or
id|IW_MGMT_RATE_LABEL_1MBIT
comma
(braket
l_int|1
)braket
op_assign
id|IW_MGMT_RATE_LABEL_MANDATORY
op_or
id|IW_MGMT_RATE_LABEL_2MBIT
comma
)brace
comma
)brace
comma
dot
id|operational_rset
op_assign
(brace
dot
id|el
op_assign
(brace
dot
id|id
op_assign
id|IW_MGMT_INFO_ELEMENT_SUPPORTED_RATES
comma
dot
id|len
op_assign
l_int|2
comma
)brace
comma
dot
id|data_rate_labels
op_assign
(brace
(braket
l_int|0
)braket
op_assign
id|IW_MGMT_RATE_LABEL_MANDATORY
op_or
id|IW_MGMT_RATE_LABEL_1MBIT
comma
(braket
l_int|1
)braket
op_assign
id|IW_MGMT_RATE_LABEL_MANDATORY
op_or
id|IW_MGMT_RATE_LABEL_2MBIT
comma
)brace
comma
)brace
comma
dot
id|ibss_pset
op_assign
(brace
dot
id|el
op_assign
(brace
dot
id|id
op_assign
id|IW_MGMT_INFO_ELEMENT_IBSS_PARAMETER_SET
comma
dot
id|len
op_assign
l_int|2
comma
)brace
comma
dot
id|atim_window
op_assign
l_int|10
comma
)brace
comma
dot
id|bss_type
op_assign
id|wl3501_fw_bss_type
c_func
(paren
id|this
)paren
comma
dot
id|cap_info
op_assign
id|wl3501_fw_cap_info
c_func
(paren
id|this
)paren
comma
)brace
suffix:semicolon
id|iw_copy_mgmt_info_element
c_func
(paren
op_amp
id|sig.ssid.el
comma
op_amp
id|this-&gt;essid.el
)paren
suffix:semicolon
id|iw_copy_mgmt_info_element
c_func
(paren
op_amp
id|this-&gt;keep_essid.el
comma
op_amp
id|this-&gt;essid.el
)paren
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_scan_confirm
r_static
r_void
id|wl3501_mgmt_scan_confirm
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
id|u16
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_struct
id|wl3501_scan_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;success&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
op_logical_and
(paren
id|sig.cap_info
op_amp
id|WL3501_MGMT_CAPABILITY_ESS
)paren
)paren
op_logical_or
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_ADHOC
op_logical_and
(paren
id|sig.cap_info
op_amp
id|WL3501_MGMT_CAPABILITY_IBSS
)paren
)paren
op_logical_or
id|this-&gt;net_type
op_eq
id|IW_MODE_AUTO
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|this-&gt;essid.el.len
)paren
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|this-&gt;essid.el.len
op_eq
l_int|3
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
id|this-&gt;essid.essid
comma
l_string|&quot;ANY&quot;
comma
l_int|3
)paren
)paren
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|this-&gt;essid.el.len
op_ne
id|sig.ssid.el.len
)paren
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|this-&gt;essid.essid
comma
id|sig.ssid.essid
comma
id|this-&gt;essid.el.len
)paren
)paren
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_else
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|matchflag
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
id|sig.bssid
comma
id|ETH_ALEN
)paren
)paren
(brace
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|matchflag
op_logical_and
(paren
id|i
OL
l_int|20
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|beacon_period
comma
op_amp
id|sig.beacon_period
comma
l_int|73
)paren
suffix:semicolon
id|this-&gt;bss_cnt
op_increment
suffix:semicolon
id|this-&gt;rssi
op_assign
id|sig.rssi
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_TIMEOUT
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;timeout&quot;
)paren
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|wl3501_mgmt_join
c_func
(paren
id|this
comma
id|i
)paren
)paren
r_break
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
op_eq
id|this-&gt;bss_cnt
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
r_else
(brace
id|this-&gt;adhoc_times
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;adhoc_times
OG
id|WL3501_MAX_ADHOC_TRIES
)paren
id|wl3501_mgmt_start
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/**&n; * wl3501_block_interrupt - Mask interrupt from SUTRO&n; * @this - card&n; *&n; * Mask interrupt from SUTRO. (i.e. SUTRO cannot interrupt the HOST)&n; * Return: 1 if interrupt is originally enabled&n; */
DECL|function|wl3501_block_interrupt
r_static
r_int
id|wl3501_block_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
id|old
op_amp
(paren
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
op_or
id|WL3501_GCR_ENECINT
)paren
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
id|old
op_amp
id|WL3501_GCR_ENECINT
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_unblock_interrupt - Enable interrupt from SUTRO&n; * @this - card&n; *&n; * Enable interrupt from SUTRO. (i.e. SUTRO can interrupt the HOST)&n; * Return: 1 if interrupt is originally enabled&n; */
DECL|function|wl3501_unblock_interrupt
r_static
r_int
id|wl3501_unblock_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
(paren
id|old
op_amp
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
)paren
)paren
op_or
id|WL3501_GCR_ENECINT
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
id|old
op_amp
id|WL3501_GCR_ENECINT
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_receive - Receive data from Receive Queue.&n; *&n; * Receive data from Receive Queue.&n; *&n; * @this: card&n; * @bf: address of host&n; * @size: size of buffer.&n; */
DECL|function|wl3501_receive
r_static
id|u16
id|wl3501_receive
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
op_star
id|bf
comma
id|u16
id|size
)paren
(brace
id|u16
id|next_addr
comma
id|next_addr1
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|bf
op_plus
l_int|12
suffix:semicolon
id|size
op_sub_assign
l_int|12
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
l_int|2
comma
op_amp
id|next_addr
comma
r_sizeof
(paren
id|next_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
suffix:semicolon
id|size
op_sub_assign
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
suffix:semicolon
id|data
op_add_assign
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|5
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
suffix:semicolon
id|size
op_sub_assign
id|WL3501_BLKSZ
op_minus
l_int|5
suffix:semicolon
id|data
op_add_assign
id|WL3501_BLKSZ
op_minus
l_int|5
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|2
comma
op_amp
id|next_addr1
comma
r_sizeof
(paren
id|next_addr1
)paren
)paren
suffix:semicolon
id|next_addr
op_assign
id|next_addr1
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|5
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_esbq_req_free
r_static
r_void
id|wl3501_esbq_req_free
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|u16
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_head
op_eq
id|this-&gt;esbq_req_tail
)paren
r_goto
id|out
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_tail
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|0x80
)paren
)paren
r_goto
id|out
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_tail
comma
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
id|this-&gt;esbq_req_tail
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_tail
op_ge
id|this-&gt;esbq_req_end
)paren
id|this-&gt;esbq_req_tail
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|wl3501_esbq_confirm
r_static
r_int
id|wl3501_esbq_confirm
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
op_amp
l_int|0x80
suffix:semicolon
)brace
DECL|function|wl3501_online
r_static
r_void
id|wl3501_online
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Wireless LAN online. BSSID: &quot;
l_string|&quot;%02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|this-&gt;bssid
(braket
l_int|0
)braket
comma
id|this-&gt;bssid
(braket
l_int|1
)braket
comma
id|this-&gt;bssid
(braket
l_int|2
)braket
comma
id|this-&gt;bssid
(braket
l_int|3
)braket
comma
id|this-&gt;bssid
(braket
l_int|4
)braket
comma
id|this-&gt;bssid
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_esbq_confirm_done
r_static
r_void
id|wl3501_esbq_confirm_done
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|this-&gt;esbq_confirm
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_confirm
op_ge
id|this-&gt;esbq_confirm_end
)paren
id|this-&gt;esbq_confirm
op_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_auth
r_static
r_int
id|wl3501_mgmt_auth
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_auth_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_AUTH_REQ
comma
dot
id|type
op_assign
id|WL3501_SYS_TYPE_OPEN
comma
dot
id|timeout
op_assign
l_int|1000
comma
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|sig.mac_addr
comma
id|this-&gt;bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_association
r_static
r_int
id|wl3501_mgmt_association
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_assoc_req
id|sig
op_assign
(brace
dot
id|sig_id
op_assign
id|WL3501_SIG_ASSOC_REQ
comma
dot
id|timeout
op_assign
l_int|1000
comma
dot
id|listen_interval
op_assign
l_int|5
comma
dot
id|cap_info
op_assign
id|this-&gt;cap_info
comma
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|sig.mac_addr
comma
id|this-&gt;bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
id|wl3501_esbq_exec
c_func
(paren
id|this
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_join_confirm
r_static
r_void
id|wl3501_mgmt_join_confirm
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|wl3501_join_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
OL
id|this-&gt;bss_cnt
)paren
(brace
r_const
r_int
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|memcpy
c_func
(paren
id|this-&gt;bssid
comma
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|this-&gt;chan
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ds_pset.chan
suffix:semicolon
id|iw_copy_mgmt_info_element
c_func
(paren
op_amp
id|this-&gt;keep_essid.el
comma
op_amp
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid.el
)paren
suffix:semicolon
id|wl3501_mgmt_auth
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_const
r_int
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|this-&gt;bssid
comma
op_amp
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|this-&gt;chan
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ds_pset.chan
suffix:semicolon
id|iw_copy_mgmt_info_element
c_func
(paren
op_amp
id|this-&gt;keep_essid.el
comma
op_amp
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid.el
)paren
suffix:semicolon
id|wl3501_online
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
id|this-&gt;join_sta_bss
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|wl3501_mgmt_join
c_func
(paren
id|this
comma
id|i
)paren
)paren
r_break
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
op_eq
id|this-&gt;bss_cnt
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
r_else
(brace
id|this-&gt;adhoc_times
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;adhoc_times
OG
id|WL3501_MAX_ADHOC_TRIES
)paren
id|wl3501_mgmt_start
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|wl3501_alarm_interrupt
r_static
r_inline
r_void
id|wl3501_alarm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Wireless LAN offline&bslash;n&quot;
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
)brace
DECL|function|wl3501_md_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_md_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_md_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|sig.data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_md_ind_interrupt
r_static
r_inline
r_void
id|wl3501_md_ind_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_md_ind
id|sig
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u8
id|rssi
comma
id|addr4
(braket
id|ETH_ALEN
)braket
suffix:semicolon
id|u16
id|pkt_len
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|this-&gt;start_seg
op_assign
id|sig.data
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|sig.data
op_plus
m_offsetof
(paren
r_struct
id|wl3501_rx_hdr
comma
id|rssi
)paren
comma
op_amp
id|rssi
comma
r_sizeof
(paren
id|rssi
)paren
)paren
suffix:semicolon
id|this-&gt;rssi
op_assign
id|rssi
op_le
l_int|63
ques
c_cond
(paren
id|rssi
op_star
l_int|100
)paren
op_div
l_int|64
suffix:colon
l_int|255
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|sig.data
op_plus
m_offsetof
(paren
r_struct
id|wl3501_rx_hdr
comma
id|addr4
)paren
comma
op_amp
id|addr4
comma
r_sizeof
(paren
id|addr4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|addr4
(braket
l_int|0
)braket
op_eq
l_int|0xAA
op_logical_and
id|addr4
(braket
l_int|1
)braket
op_eq
l_int|0xAA
op_logical_and
id|addr4
(braket
l_int|2
)braket
op_eq
l_int|0x03
op_logical_and
id|addr4
(braket
l_int|4
)braket
op_eq
l_int|0x00
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Insupported packet type!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pkt_len
op_assign
id|sig.size
op_plus
l_int|12
op_minus
l_int|24
op_minus
l_int|4
op_minus
l_int|6
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t alloc a sk_buff of size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
)paren
suffix:semicolon
id|this-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* IP headers on 16 bytes boundaries */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|sig.daddr
comma
l_int|12
comma
l_int|0
)paren
suffix:semicolon
id|wl3501_receive
c_func
(paren
id|this
comma
id|skb-&gt;data
comma
id|pkt_len
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|this-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|this-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|wl3501_get_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_get_confirm_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
comma
r_void
op_star
id|sig
comma
r_int
id|size
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|this-&gt;sig_get_confirm
comma
r_sizeof
(paren
id|this-&gt;sig_get_confirm
)paren
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|this-&gt;wait
)paren
suffix:semicolon
)brace
DECL|function|wl3501_start_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_start_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_start_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_assoc_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_assoc_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|wl3501_assoc_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|wl3501_online
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_auth_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_auth_confirm_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_auth_confirm
id|sig
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|wl3501_mgmt_association
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
DECL|function|wl3501_rx_interrupt
r_static
r_inline
r_void
id|wl3501_rx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|morepkts
suffix:semicolon
id|u16
id|addr
suffix:semicolon
id|u8
id|sig_id
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;entry&quot;
)paren
suffix:semicolon
id|loop
suffix:colon
id|morepkts
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_esbq_confirm
c_func
(paren
id|this
)paren
)paren
r_goto
id|free
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
comma
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
op_plus
l_int|2
comma
op_amp
id|sig_id
comma
r_sizeof
(paren
id|sig_id
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sig_id
)paren
(brace
r_case
id|WL3501_SIG_DEAUTH_IND
suffix:colon
r_case
id|WL3501_SIG_DISASSOC_IND
suffix:colon
r_case
id|WL3501_SIG_ALARM
suffix:colon
id|wl3501_alarm_interrupt
c_func
(paren
id|dev
comma
id|this
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_MD_CONFIRM
suffix:colon
id|wl3501_md_confirm_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_MD_IND
suffix:colon
id|wl3501_md_ind_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_GET_CONFIRM
suffix:colon
id|wl3501_get_confirm_interrupt
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|this-&gt;sig_get_confirm
comma
r_sizeof
(paren
id|this-&gt;sig_get_confirm
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_PWR_MGMT_CONFIRM
suffix:colon
id|wl3501_get_confirm_interrupt
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|this-&gt;sig_pwr_mgmt_confirm
comma
r_sizeof
(paren
id|this-&gt;sig_pwr_mgmt_confirm
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_START_CONFIRM
suffix:colon
id|wl3501_start_confirm_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_SCAN_CONFIRM
suffix:colon
id|wl3501_mgmt_scan_confirm
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_JOIN_CONFIRM
suffix:colon
id|wl3501_mgmt_join_confirm
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_ASSOC_CONFIRM
suffix:colon
id|wl3501_assoc_confirm_interrupt
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_AUTH_CONFIRM
suffix:colon
id|wl3501_auth_confirm_interrupt
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_RESYNC_CONFIRM
suffix:colon
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* FIXME: should be resync_confirm */
r_break
suffix:semicolon
)brace
id|wl3501_esbq_confirm_done
c_func
(paren
id|this
)paren
suffix:semicolon
id|morepkts
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* free request if necessary */
id|free
suffix:colon
id|wl3501_esbq_req_free
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|morepkts
)paren
r_goto
id|loop
suffix:semicolon
)brace
DECL|function|wl3501_ack_interrupt
r_static
r_inline
r_void
id|wl3501_ack_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|wl3501_outb
c_func
(paren
id|WL3501_GCR_ECINT
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_interrupt - Hardware interrupt from card.&n; * @irq - Interrupt number&n; * @dev_id - net_device&n; * @regs - registers&n; *&n; * We must acknowledge the interrupt as soon as possible, and block the&n; * interrupt from the same card immediately to prevent re-entry.&n; *&n; * Before accessing the Control_Status_Block, we must lock SUTRO first.&n; * On the other hand, to prevent SUTRO from malfunctioning, we must&n; * unlock the SUTRO as soon as possible.&n; */
DECL|function|wl3501_interrupt
r_static
id|irqreturn_t
id|wl3501_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
suffix:semicolon
r_int
id|handled
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|unknown
suffix:semicolon
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_rx_interrupt
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
id|unknown
suffix:colon
id|handled
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: irq %d for unknown device.&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|wl3501_reset_board
r_static
r_int
id|wl3501_reset_board
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Coreset */
id|wl3501_outb_p
c_func
(paren
id|WL3501_GCR_CORESET
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|wl3501_outb_p
c_func
(paren
l_int|0
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|wl3501_outb_p
c_func
(paren
id|WL3501_GCR_CORESET
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
multiline_comment|/* Reset SRAM 0x480 to zero */
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
multiline_comment|/* Start up */
id|wl3501_outb_p
c_func
(paren
l_int|0
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|1024
op_star
l_int|50
)paren
suffix:semicolon
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* acme: was commented */
multiline_comment|/* Polling Self_Test_Status */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_char|&squot;W&squot;
)paren
(brace
multiline_comment|/* firmware complete all test successfully */
id|tmp
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|WL3501_NOPLOOP
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to reset the board!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_init_firmware
r_static
r_int
id|wl3501_init_firmware
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u16
id|ptr
comma
id|next
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_reset_board
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|fail
suffix:semicolon
id|this-&gt;card_name
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x1a00
comma
id|this-&gt;card_name
comma
r_sizeof
(paren
id|this-&gt;card_name
)paren
)paren
suffix:semicolon
id|this-&gt;card_name
(braket
r_sizeof
(paren
id|this-&gt;card_name
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|this-&gt;firmware_date
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x1a40
comma
id|this-&gt;firmware_date
comma
r_sizeof
(paren
id|this-&gt;firmware_date
)paren
)paren
suffix:semicolon
id|this-&gt;firmware_date
(braket
r_sizeof
(paren
id|this-&gt;firmware_date
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* Switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* Read parameter from card */
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x482
comma
op_amp
id|this-&gt;esbq_req_start
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x486
comma
op_amp
id|this-&gt;esbq_req_end
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x488
comma
op_amp
id|this-&gt;esbq_confirm_start
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x48c
comma
op_amp
id|this-&gt;esbq_confirm_end
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x48e
comma
op_amp
id|this-&gt;tx_buffer_head
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x492
comma
op_amp
id|this-&gt;tx_buffer_size
comma
l_int|2
)paren
suffix:semicolon
id|this-&gt;esbq_req_tail
op_assign
id|this-&gt;esbq_req_head
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|this-&gt;esbq_req_end
op_add_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|this-&gt;esbq_confirm
op_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
id|this-&gt;esbq_confirm_end
op_add_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
multiline_comment|/* Initial Tx Buffer */
id|this-&gt;tx_buffer_cnt
op_assign
l_int|1
suffix:semicolon
id|ptr
op_assign
id|this-&gt;tx_buffer_head
suffix:semicolon
id|next
op_assign
id|ptr
op_plus
id|WL3501_BLKSZ
suffix:semicolon
r_while
c_loop
(paren
(paren
id|next
op_minus
id|this-&gt;tx_buffer_head
)paren
OL
id|this-&gt;tx_buffer_size
)paren
(brace
id|this-&gt;tx_buffer_cnt
op_increment
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|next
suffix:semicolon
id|next
op_assign
id|ptr
op_plus
id|WL3501_BLKSZ
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|next
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_tail
op_assign
id|ptr
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|fail
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|wl3501_close
r_static
r_int
id|wl3501_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Check if the device is in wl3501_dev_list */
r_for
c_loop
(paren
id|link
op_assign
id|wl3501_dev_list
suffix:semicolon
id|link
suffix:semicolon
id|link
op_assign
id|link-&gt;next
)paren
r_if
c_cond
(paren
id|link-&gt;priv
op_eq
id|dev
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|link
)paren
r_goto
id|out
suffix:semicolon
id|link-&gt;open
op_decrement
suffix:semicolon
multiline_comment|/* Stop wl3501_hard_start_xmit() from now on */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Mask interrupts from the SUTRO */
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: WL3501 closed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_reset - Reset the SUTRO.&n; * @dev - network device&n; *&n; * It is almost the same as wl3501_open(). In fact, we may just wl3501_close()&n; * and wl3501_open() again, but I wouldn&squot;t like to free_irq() when the driver&n; * is running. It seems to be dangerous.&n; */
DECL|function|wl3501_reset
r_static
r_int
id|wl3501_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_init_firmware
c_func
(paren
id|this
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t initialize Firmware!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Free IRQ, and mark IRQ as unused */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Queue has to be started only when the Card is Started&n;&t; */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: device reset&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_tx_timeout
r_static
r_void
id|wl3501_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|this-&gt;stats
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d resetting card on Tx timeout!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_else
(brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Return : 0 - OK&n; *&t;    1 - Could not transmit (dev_queue_xmit will queue it)&n; *&t;&t;and try to sent it later&n; */
DECL|function|wl3501_hard_start_xmit
r_static
r_int
id|wl3501_hard_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|enabled
comma
id|rc
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|enabled
op_assign
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|rc
op_assign
id|wl3501_send_pkt
c_func
(paren
id|this
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enabled
)paren
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
op_increment
id|this-&gt;stats.tx_dropped
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|this-&gt;stats.tx_packets
suffix:semicolon
id|this-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;tx_buffer_cnt
OL
l_int|2
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_open
r_static
r_int
id|wl3501_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Check if the device is in wl3501_dev_list */
r_for
c_loop
(paren
id|link
op_assign
id|wl3501_dev_list
suffix:semicolon
id|link
suffix:semicolon
id|link
op_assign
id|link-&gt;next
)paren
r_if
c_cond
(paren
id|link-&gt;priv
op_eq
id|dev
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DEV_OK
c_func
(paren
id|link
)paren
)paren
r_goto
id|out
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;open
op_increment
suffix:semicolon
multiline_comment|/* Initial WL3501 firmware */
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: Initialize WL3501 firmware...&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_init_firmware
c_func
(paren
id|this
)paren
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/* Initial device variables */
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Acknowledge Interrupt, for cleaning last state */
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Enable interrupt from card after all */
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: WL3501 opened&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Card Name: %s&bslash;n&quot;
l_string|&quot;%s: Firmware Date: %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|this-&gt;card_name
comma
id|dev-&gt;name
comma
id|this-&gt;firmware_date
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
id|fail
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t initialize firmware!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|wl3501_get_stats
r_struct
id|net_device_stats
op_star
id|wl3501_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|this-&gt;stats
suffix:semicolon
)brace
DECL|function|wl3501_get_wireless_stats
r_struct
id|iw_statistics
op_star
id|wl3501_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|this-&gt;wstats
suffix:semicolon
id|u32
id|value
suffix:semicolon
multiline_comment|/* size checked: it is u32 */
id|memset
c_func
(paren
id|wstats
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|wstats
)paren
)paren
suffix:semicolon
id|wstats-&gt;status
op_assign
id|netif_running
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_WEP_ICV_ERROR_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.code
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_WEP_UNDECRYPTABLE_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.code
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_WEP_EXCLUDED_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.code
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_RETRY_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.retries
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_FAILED_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.misc
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_RTS_FAILURE_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.misc
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_ACK_FAILURE_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.misc
op_add_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_FRAME_DUPLICATE_COUNT
comma
op_amp
id|value
comma
r_sizeof
(paren
id|value
)paren
)paren
)paren
id|wstats-&gt;discard.misc
op_add_assign
id|value
suffix:semicolon
r_return
id|wstats
suffix:semicolon
)brace
DECL|function|wl3501_get_drvinfo
r_static
r_void
id|wl3501_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
id|strlcpy
c_func
(paren
id|info-&gt;driver
comma
id|wl3501_dev_info
comma
r_sizeof
(paren
id|info-&gt;driver
)paren
)paren
suffix:semicolon
)brace
DECL|variable|ops
r_static
r_struct
id|ethtool_ops
id|ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|wl3501_get_drvinfo
)brace
suffix:semicolon
multiline_comment|/**&n; * wl3501_detach - deletes a driver &quot;instance&quot;&n; * @link - FILL_IN&n; *&n; * This deletes a driver &quot;instance&quot;. The device is de-registered with Card&n; * Services. If it has been released, all local data structures are freed.&n; * Otherwise, the structures will be freed when the device is released.&n; */
DECL|function|wl3501_detach
r_static
r_void
id|wl3501_detach
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|dev_link_t
op_star
op_star
id|linkp
suffix:semicolon
multiline_comment|/* Locate device structure */
r_for
c_loop
(paren
id|linkp
op_assign
op_amp
id|wl3501_dev_list
suffix:semicolon
op_star
id|linkp
suffix:semicolon
id|linkp
op_assign
op_amp
(paren
op_star
id|linkp
)paren
op_member_access_from_pointer
id|next
)paren
r_if
c_cond
(paren
op_star
id|linkp
op_eq
id|link
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|linkp
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* If the device is currently configured and active, we won&squot;t actually&n;&t; * delete it yet.  Instead, it is marked so that when the release()&n;&t; * function is called, that will trigger a proper detach(). */
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
macro_line|#ifdef PCMCIA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;wl3501_cs: detach postponed, &squot;%s&squot; &quot;
l_string|&quot;still locked&bslash;n&quot;
comma
id|link-&gt;dev-&gt;dev_name
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Break the link with Card Services */
r_if
c_cond
(paren
id|link-&gt;handle
)paren
id|pcmcia_deregister_client
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
multiline_comment|/* Unlink device structure, free pieces */
op_star
id|linkp
op_assign
id|link-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;priv
)paren
id|free_netdev
c_func
(paren
id|link-&gt;priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|link
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|wl3501_get_name
r_static
r_int
id|wl3501_get_name
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|strlcpy
c_func
(paren
id|wrqu-&gt;name
comma
l_string|&quot;IEEE 802.11-DS&quot;
comma
r_sizeof
(paren
id|wrqu-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_freq
r_static
r_int
id|wl3501_set_freq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|channel
op_assign
id|wrqu-&gt;freq.m
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|iw_valid_channel
c_func
(paren
id|this-&gt;reg_domain
comma
id|channel
)paren
)paren
(brace
id|this-&gt;chan
op_assign
id|channel
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_freq
r_static
r_int
id|wl3501_get_freq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;freq.m
op_assign
id|wl3501_chan2freq
(braket
id|this-&gt;chan
op_minus
l_int|1
)braket
op_star
l_int|100000
suffix:semicolon
id|wrqu-&gt;freq.e
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_mode
r_static
r_int
id|wl3501_set_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;mode
op_eq
id|IW_MODE_INFRA
op_logical_or
id|wrqu-&gt;mode
op_eq
id|IW_MODE_ADHOC
op_logical_or
id|wrqu-&gt;mode
op_eq
id|IW_MODE_AUTO
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|this-&gt;net_type
op_assign
id|wrqu-&gt;mode
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_mode
r_static
r_int
id|wl3501_get_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;mode
op_assign
id|this-&gt;net_type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_sens
r_static
r_int
id|wl3501_get_sens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;sens.value
op_assign
id|this-&gt;rssi
suffix:semicolon
id|wrqu-&gt;sens.disabled
op_assign
op_logical_neg
id|wrqu-&gt;sens.value
suffix:semicolon
id|wrqu-&gt;sens.fixed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_range
r_static
r_int
id|wl3501_get_range
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|iw_range
op_star
id|range
op_assign
(paren
r_struct
id|iw_range
op_star
)paren
id|extra
suffix:semicolon
multiline_comment|/* Set the length (very important for backward compatibility) */
id|wrqu-&gt;data.length
op_assign
r_sizeof
(paren
op_star
id|range
)paren
suffix:semicolon
multiline_comment|/* Set all the info we don&squot;t care or don&squot;t know about to zero */
id|memset
c_func
(paren
id|range
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|range
)paren
)paren
suffix:semicolon
multiline_comment|/* Set the Wireless Extension versions */
id|range-&gt;we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range-&gt;we_version_source
op_assign
l_int|1
suffix:semicolon
id|range-&gt;throughput
op_assign
l_int|2
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ~2 Mb/s */
multiline_comment|/* FIXME: study the code to fill in more fields... */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_wap
r_static
r_int
id|wl3501_set_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_static
r_const
id|u8
id|bcast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
)brace
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: we support other ARPHRDs...*/
r_if
c_cond
(paren
id|wrqu-&gt;ap_addr.sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|bcast
comma
id|wrqu-&gt;ap_addr.sa_data
comma
id|ETH_ALEN
)paren
)paren
(brace
multiline_comment|/* FIXME: rescan? */
)brace
r_else
id|memcpy
c_func
(paren
id|this-&gt;bssid
comma
id|wrqu-&gt;ap_addr.sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* FIXME: rescan? deassoc &amp; scan? */
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_wap
r_static
r_int
id|wl3501_get_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|memcpy
c_func
(paren
id|wrqu-&gt;ap_addr.sa_data
comma
id|this-&gt;bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_scan
r_static
r_int
id|wl3501_set_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
multiline_comment|/*&n;&t; * FIXME: trigger scanning with a reset, yes, I&squot;m lazy&n;&t; */
r_return
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_get_scan
r_static
r_int
id|wl3501_get_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|current_ev
op_assign
id|extra
suffix:semicolon
r_struct
id|iw_event
id|iwe
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
op_increment
id|i
)paren
(brace
id|iwe.cmd
op_assign
id|SIOCGIWAP
suffix:semicolon
id|iwe.u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|memcpy
c_func
(paren
id|iwe.u.ap_addr.sa_data
comma
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_ADDR_LEN
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWESSID
suffix:semicolon
id|iwe.u.data.flags
op_assign
l_int|1
suffix:semicolon
id|iwe.u.data.length
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid.el.len
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid.essid
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWMODE
suffix:semicolon
id|iwe.u.mode
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bss_type
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_UINT_LEN
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWFREQ
suffix:semicolon
id|iwe.u.freq.m
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ds_pset.chan
suffix:semicolon
id|iwe.u.freq.e
op_assign
l_int|0
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
id|IW_EV_FREQ_LEN
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWENCODE
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|cap_info
op_amp
id|WL3501_MGMT_CAPABILITY_PRIVACY
)paren
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_ENABLED
op_or
id|IW_ENCODE_NOKEY
suffix:semicolon
r_else
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
id|iwe.u.data.length
op_assign
l_int|0
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
id|iwe
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Length of data */
id|wrqu-&gt;data.length
op_assign
(paren
id|current_ev
op_minus
id|extra
)paren
suffix:semicolon
id|wrqu-&gt;data.flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: set properly these flags */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_essid
r_static
r_int
id|wl3501_set_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;data.flags
)paren
(brace
id|iw_set_mgmt_info_element
c_func
(paren
id|IW_MGMT_INFO_ELEMENT_SSID
comma
op_amp
id|this-&gt;essid.el
comma
id|extra
comma
id|wrqu-&gt;data.length
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* We accept any ESSID */
id|iw_set_mgmt_info_element
c_func
(paren
id|IW_MGMT_INFO_ELEMENT_SSID
comma
op_amp
id|this-&gt;essid.el
comma
l_string|&quot;ANY&quot;
comma
l_int|3
)paren
suffix:semicolon
)brace
r_return
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_get_essid
r_static
r_int
id|wl3501_get_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrqu-&gt;essid.flags
op_assign
l_int|1
suffix:semicolon
id|wrqu-&gt;essid.length
op_assign
id|this-&gt;essid.el.len
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|this-&gt;essid.essid
comma
id|this-&gt;essid.el.len
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_nick
r_static
r_int
id|wl3501_set_nick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;data.length
OG
r_sizeof
(paren
id|this-&gt;nick
)paren
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|strlcpy
c_func
(paren
id|this-&gt;nick
comma
id|extra
comma
id|wrqu-&gt;data.length
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_nick
r_static
r_int
id|wl3501_get_nick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|strlcpy
c_func
(paren
id|extra
comma
id|this-&gt;nick
comma
l_int|32
)paren
suffix:semicolon
id|wrqu-&gt;data.length
op_assign
id|strlen
c_func
(paren
id|extra
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_rate
r_static
r_int
id|wl3501_get_rate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
multiline_comment|/*&n;&t; * FIXME: have to see from where to get this info, perhaps this card&n;&t; * works at 1 Mbit/s too... for now leave at 2 Mbit/s that is the most&n;&t; * common with the Planet Access Points. -acme&n;&t; */
id|wrqu-&gt;bitrate.value
op_assign
l_int|2000000
suffix:semicolon
id|wrqu-&gt;bitrate.fixed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_rts_threshold
r_static
r_int
id|wl3501_get_rts_threshold
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u16
id|threshold
suffix:semicolon
multiline_comment|/* size checked: it is u16 */
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_RTS_THRESHOLD
comma
op_amp
id|threshold
comma
r_sizeof
(paren
id|threshold
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|wrqu-&gt;rts.value
op_assign
id|threshold
suffix:semicolon
id|wrqu-&gt;rts.disabled
op_assign
id|threshold
op_ge
l_int|2347
suffix:semicolon
id|wrqu-&gt;rts.fixed
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_frag_threshold
r_static
r_int
id|wl3501_get_frag_threshold
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u16
id|threshold
suffix:semicolon
multiline_comment|/* size checked: it is u16 */
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_FRAG_THRESHOLD
comma
op_amp
id|threshold
comma
r_sizeof
(paren
id|threshold
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|wrqu-&gt;frag.value
op_assign
id|threshold
suffix:semicolon
id|wrqu-&gt;frag.disabled
op_assign
id|threshold
op_ge
l_int|2346
suffix:semicolon
id|wrqu-&gt;frag.fixed
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_txpow
r_static
r_int
id|wl3501_get_txpow
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u16
id|txpow
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_CURRENT_TX_PWR_LEVEL
comma
op_amp
id|txpow
comma
r_sizeof
(paren
id|txpow
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|wrqu-&gt;txpower.value
op_assign
id|txpow
suffix:semicolon
id|wrqu-&gt;txpower.disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * From the MIB values I think this can be configurable,&n;&t;&t; * as it lists several tx power levels -acme&n;&t;&t; */
id|wrqu-&gt;txpower.fixed
op_assign
l_int|0
suffix:semicolon
id|wrqu-&gt;txpower.flags
op_assign
id|IW_TXPOW_MWATT
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_retry
r_static
r_int
id|wl3501_get_retry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u8
id|retry
suffix:semicolon
multiline_comment|/* size checked: it is u8 */
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_LONG_RETRY_LIMIT
comma
op_amp
id|retry
comma
r_sizeof
(paren
id|retry
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;retry.flags
op_amp
id|IW_RETRY_MAX
)paren
(brace
id|wrqu-&gt;retry.flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MAX
suffix:semicolon
r_goto
id|set_value
suffix:semicolon
)brace
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_SHORT_RETRY_LIMIT
comma
op_amp
id|retry
comma
r_sizeof
(paren
id|retry
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|wrqu-&gt;retry.flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MIN
suffix:semicolon
id|set_value
suffix:colon
id|wrqu-&gt;retry.value
op_assign
id|retry
suffix:semicolon
id|wrqu-&gt;retry.disabled
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_encode
r_static
r_int
id|wl3501_get_encode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u8
id|implemented
comma
id|restricted
comma
id|keys
(braket
l_int|100
)braket
comma
id|len_keys
comma
id|tocopy
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_PRIV_OPT_IMPLEMENTED
comma
op_amp
id|implemented
comma
r_sizeof
(paren
id|implemented
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|implemented
)paren
(brace
id|wrqu-&gt;encoding.flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_EXCLUDE_UNENCRYPTED
comma
op_amp
id|restricted
comma
r_sizeof
(paren
id|restricted
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|wrqu-&gt;encoding.flags
op_assign
id|restricted
ques
c_cond
id|IW_ENCODE_RESTRICTED
suffix:colon
id|IW_ENCODE_OPEN
suffix:semicolon
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_WEP_KEY_MAPPINGS_LEN
comma
op_amp
id|len_keys
comma
r_sizeof
(paren
id|len_keys
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_WEP_KEY_MAPPINGS
comma
id|keys
comma
id|len_keys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|tocopy
op_assign
id|min_t
c_func
(paren
id|u8
comma
id|len_keys
comma
id|wrqu-&gt;encoding.length
)paren
suffix:semicolon
id|tocopy
op_assign
id|min_t
c_func
(paren
id|u8
comma
id|tocopy
comma
l_int|100
)paren
suffix:semicolon
id|wrqu-&gt;encoding.length
op_assign
id|tocopy
suffix:semicolon
id|memset
c_func
(paren
id|extra
comma
l_int|0
comma
id|tocopy
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|keys
comma
id|tocopy
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_power
r_static
r_int
id|wl3501_get_power
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|u8
id|pwr_state
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_get_mib_value
c_func
(paren
id|this
comma
id|WL3501_MIB_ATTR_CURRENT_PWR_STATE
comma
op_amp
id|pwr_state
comma
r_sizeof
(paren
id|pwr_state
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|wrqu-&gt;power.disabled
op_assign
op_logical_neg
id|pwr_state
suffix:semicolon
id|wrqu-&gt;power.flags
op_assign
id|IW_POWER_ON
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|wl3501_handler
r_static
r_const
id|iw_handler
id|wl3501_handler
(braket
)braket
op_assign
(brace
(braket
id|SIOCGIWNAME
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_name
comma
(braket
id|SIOCSIWFREQ
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_freq
comma
(braket
id|SIOCGIWFREQ
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_freq
comma
(braket
id|SIOCSIWMODE
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_mode
comma
(braket
id|SIOCGIWMODE
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_mode
comma
(braket
id|SIOCGIWSENS
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_sens
comma
(braket
id|SIOCGIWRANGE
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_range
comma
(braket
id|SIOCSIWSPY
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|iw_handler_set_spy
comma
(braket
id|SIOCGIWSPY
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|iw_handler_get_spy
comma
(braket
id|SIOCSIWTHRSPY
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|iw_handler_set_thrspy
comma
(braket
id|SIOCGIWTHRSPY
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|iw_handler_get_thrspy
comma
(braket
id|SIOCSIWAP
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_wap
comma
(braket
id|SIOCGIWAP
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_wap
comma
(braket
id|SIOCSIWSCAN
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_scan
comma
(braket
id|SIOCGIWSCAN
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_scan
comma
(braket
id|SIOCSIWESSID
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_essid
comma
(braket
id|SIOCGIWESSID
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_essid
comma
(braket
id|SIOCSIWNICKN
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_set_nick
comma
(braket
id|SIOCGIWNICKN
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_nick
comma
(braket
id|SIOCGIWRATE
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_rate
comma
(braket
id|SIOCGIWRTS
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_rts_threshold
comma
(braket
id|SIOCGIWFRAG
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_frag_threshold
comma
(braket
id|SIOCGIWTXPOW
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_txpow
comma
(braket
id|SIOCGIWRETRY
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_retry
comma
(braket
id|SIOCGIWENCODE
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_encode
comma
(braket
id|SIOCGIWPOWER
op_minus
id|SIOCIWFIRST
)braket
op_assign
id|wl3501_get_power
comma
)brace
suffix:semicolon
DECL|variable|wl3501_handler_def
r_static
r_const
r_struct
id|iw_handler_def
id|wl3501_handler_def
op_assign
(brace
dot
id|num_standard
op_assign
r_sizeof
(paren
id|wl3501_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|standard
op_assign
(paren
id|iw_handler
op_star
)paren
id|wl3501_handler
comma
dot
id|spy_offset
op_assign
m_offsetof
(paren
r_struct
id|wl3501_card
comma
id|spy_data
)paren
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * wl3501_attach - creates an &quot;instance&quot; of the driver&n; *&n; * Creates an &quot;instance&quot; of the driver, allocating local data structures for&n; * one device.  The device is registered with Card Services.&n; *&n; * The dev_link structure is initialized, but we don&squot;t actually configure the&n; * card at this point -- we wait until we receive a card insertion event.&n; */
DECL|function|wl3501_attach
r_static
id|dev_link_t
op_star
id|wl3501_attach
c_func
(paren
r_void
)paren
(brace
id|client_reg_t
id|client_reg
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|ret
comma
id|i
suffix:semicolon
multiline_comment|/* Initialize the dev_link_t structure */
id|link
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|link
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|link
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|link
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dev_link_t
)paren
)paren
suffix:semicolon
multiline_comment|/* The io structure describes IO port mapping */
id|link-&gt;io.NumPorts1
op_assign
l_int|16
suffix:semicolon
id|link-&gt;io.Attributes1
op_assign
id|IO_DATA_PATH_WIDTH_8
suffix:semicolon
id|link-&gt;io.IOAddrLines
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* Interrupt setup */
id|link-&gt;irq.Attributes
op_assign
id|IRQ_TYPE_EXCLUSIVE
op_or
id|IRQ_HANDLE_PRESENT
suffix:semicolon
id|link-&gt;irq.IRQInfo1
op_assign
id|IRQ_INFO2_VALID
op_or
id|IRQ_LEVEL_ID
suffix:semicolon
id|link-&gt;irq.IRQInfo2
op_assign
id|wl3501_irq_mask
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_irq_list
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|link-&gt;irq.IRQInfo2
op_or_assign
l_int|1
op_lshift
id|wl3501_irq_list
(braket
id|i
)braket
suffix:semicolon
id|link-&gt;irq.Handler
op_assign
id|wl3501_interrupt
suffix:semicolon
multiline_comment|/* General socket configuration */
id|link-&gt;conf.Attributes
op_assign
id|CONF_ENABLE_IRQ
suffix:semicolon
id|link-&gt;conf.Vcc
op_assign
l_int|50
suffix:semicolon
id|link-&gt;conf.IntType
op_assign
id|INT_MEMORY_AND_IO
suffix:semicolon
id|link-&gt;conf.ConfigIndex
op_assign
l_int|1
suffix:semicolon
id|link-&gt;conf.Present
op_assign
id|PRESENT_OPTION
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|wl3501_card
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out_link
suffix:semicolon
id|dev-&gt;open
op_assign
id|wl3501_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|wl3501_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|wl3501_hard_start_xmit
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|wl3501_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|wl3501_get_stats
suffix:semicolon
id|dev-&gt;get_wireless_stats
op_assign
id|wl3501_get_wireless_stats
suffix:semicolon
id|dev-&gt;wireless_handlers
op_assign
(paren
r_struct
id|iw_handler_def
op_star
)paren
op_amp
id|wl3501_handler_def
suffix:semicolon
id|SET_ETHTOOL_OPS
c_func
(paren
id|dev
comma
op_amp
id|ops
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;priv
op_assign
id|link-&gt;irq.Instance
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Register with Card Services */
id|link-&gt;next
op_assign
id|wl3501_dev_list
suffix:semicolon
id|wl3501_dev_list
op_assign
id|link
suffix:semicolon
id|client_reg.dev_info
op_assign
op_amp
id|wl3501_dev_info
suffix:semicolon
id|client_reg.Attributes
op_assign
id|INFO_IO_CLIENT
op_or
id|INFO_CARD_SHARE
suffix:semicolon
id|client_reg.EventMask
op_assign
id|CS_EVENT_CARD_INSERTION
op_or
id|CS_EVENT_RESET_PHYSICAL
op_or
id|CS_EVENT_CARD_RESET
op_or
id|CS_EVENT_CARD_REMOVAL
op_or
id|CS_EVENT_PM_SUSPEND
op_or
id|CS_EVENT_PM_RESUME
suffix:semicolon
id|client_reg.event_handler
op_assign
id|wl3501_event
suffix:semicolon
id|client_reg.Version
op_assign
l_int|0x0210
suffix:semicolon
id|client_reg.event_callback_args.client_data
op_assign
id|link
suffix:semicolon
id|ret
op_assign
id|pcmcia_register_client
c_func
(paren
op_amp
id|link-&gt;handle
comma
op_amp
id|client_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|RegisterClient
comma
id|ret
)paren
suffix:semicolon
id|wl3501_detach
c_func
(paren
id|link
)paren
suffix:semicolon
id|link
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|link
suffix:semicolon
id|out_link
suffix:colon
id|kfree
c_func
(paren
id|link
)paren
suffix:semicolon
id|link
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|macro|CS_CHECK
mdefine_line|#define CS_CHECK(fn, ret) &bslash;&n;do { last_fn = (fn); if ((last_ret = (ret)) != 0) goto cs_failed; } while (0)
multiline_comment|/**&n; * wl3501_config - configure the PCMCIA socket and make eth device available&n; * @link - FILL_IN&n; *&n; * wl3501_config() is scheduled to run after a CARD_INSERTION event is&n; * received, to configure the PCMCIA socket, and to make the ethernet device&n; * available to the system.&n; */
DECL|function|wl3501_config
r_static
r_void
id|wl3501_config
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|tuple_t
id|tuple
suffix:semicolon
id|cisparse_t
id|parse
suffix:semicolon
id|client_handle_t
id|handle
op_assign
id|link-&gt;handle
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|j
comma
id|last_fn
comma
id|last_ret
suffix:semicolon
r_int
r_char
id|bf
(braket
l_int|64
)braket
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
suffix:semicolon
multiline_comment|/* This reads the card&squot;s CONFIG tuple to find its config registers. */
id|tuple.Attributes
op_assign
l_int|0
suffix:semicolon
id|tuple.DesiredTuple
op_assign
id|CISTPL_CONFIG
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetFirstTuple
comma
id|pcmcia_get_first_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
id|tuple.TupleData
op_assign
id|bf
suffix:semicolon
id|tuple.TupleDataMax
op_assign
r_sizeof
(paren
id|bf
)paren
suffix:semicolon
id|tuple.TupleOffset
op_assign
l_int|0
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetTupleData
comma
id|pcmcia_get_tuple_data
c_func
(paren
id|handle
comma
op_amp
id|tuple
)paren
)paren
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|ParseTuple
comma
id|pcmcia_parse_tuple
c_func
(paren
id|handle
comma
op_amp
id|tuple
comma
op_amp
id|parse
)paren
)paren
suffix:semicolon
id|link-&gt;conf.ConfigBase
op_assign
id|parse.config.base
suffix:semicolon
id|link-&gt;conf.Present
op_assign
id|parse.config.rmask
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Configure card */
id|link-&gt;state
op_or_assign
id|DEV_CONFIG
suffix:semicolon
multiline_comment|/* Try allocating IO ports.  This tries a few fixed addresses.  If you&n;&t; * want, you can also read the card&squot;s config table to pick addresses --&n;&t; * see the serial driver for an example. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0x280
suffix:semicolon
id|j
OL
l_int|0x400
suffix:semicolon
id|j
op_add_assign
l_int|0x20
)paren
(brace
multiline_comment|/* The &squot;^0x300&squot; is so that we probe 0x300-0x3ff first, then&n;&t;&t; * 0x200-0x2ff, and so on, because this seems safer */
id|link-&gt;io.BasePort1
op_assign
id|j
suffix:semicolon
id|link-&gt;io.BasePort2
op_assign
id|link-&gt;io.BasePort1
op_plus
l_int|0x10
suffix:semicolon
id|i
op_assign
id|pcmcia_request_io
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CS_SUCCESS
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|CS_SUCCESS
)paren
(brace
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|RequestIO
comma
id|i
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* Now allocate an interrupt line. Note that this does not actually&n;&t; * assign a handler to the interrupt. */
id|CS_CHECK
c_func
(paren
id|RequestIRQ
comma
id|pcmcia_request_irq
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;irq
)paren
)paren
suffix:semicolon
multiline_comment|/* This actually configures the PCMCIA socket -- setting up the I/O&n;&t; * windows and the interrupt mapping.  */
id|CS_CHECK
c_func
(paren
id|RequestConfiguration
comma
id|pcmcia_request_configuration
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;conf
)paren
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|link-&gt;irq.AssignedIRQ
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|link-&gt;io.BasePort1
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;wl3501_cs: register_netdev() failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*&n;&t; * At this point, the dev_node_t structure(s) should be initialized and&n;&t; * arranged in a linked list at link-&gt;dev.&n;&t; */
id|link-&gt;dev
op_assign
op_amp
id|this-&gt;node
suffix:semicolon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG_PENDING
suffix:semicolon
id|this-&gt;base_addr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_flash_mac_addr
c_func
(paren
id|this
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Cant read MAC addr in flash ROM?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|this-&gt;node.dev_name
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* print probe information */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: wl3501 @ 0x%3.3x, IRQ %d, MAC addr in flash ROM:&quot;
comma
id|dev-&gt;name
comma
id|this-&gt;base_addr
comma
(paren
r_int
)paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
(paren
(paren
r_char
op_star
)paren
op_amp
id|this-&gt;mac_addr
)paren
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%c%02x&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialize card parameters - added by jss&n;&t; */
id|this-&gt;net_type
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|this-&gt;bss_cnt
op_assign
l_int|0
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
id|iw_set_mgmt_info_element
c_func
(paren
id|IW_MGMT_INFO_ELEMENT_SSID
comma
op_amp
id|this-&gt;essid.el
comma
l_string|&quot;ANY&quot;
comma
l_int|3
)paren
suffix:semicolon
id|this-&gt;card_name
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|this-&gt;firmware_date
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|this-&gt;rssi
op_assign
l_int|255
suffix:semicolon
id|this-&gt;chan
op_assign
id|iw_default_channel
c_func
(paren
id|this-&gt;reg_domain
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|this-&gt;nick
comma
l_string|&quot;Planet WL3501&quot;
comma
r_sizeof
(paren
id|this-&gt;nick
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|this-&gt;wait
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|cs_failed
suffix:colon
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|last_fn
comma
id|last_ret
)paren
suffix:semicolon
id|failed
suffix:colon
id|wl3501_release
c_func
(paren
id|link
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_release - unregister the net, release PCMCIA configuration&n; * @arg - link&n; *&n; * After a card is removed, wl3501_release() will unregister the net device,&n; * and release the PCMCIA configuration.  If the device is still open, this&n; * will be postponed until it is closed.&n; */
DECL|function|wl3501_release
r_static
r_void
id|wl3501_release
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
multiline_comment|/* Unlink the device chain */
r_if
c_cond
(paren
id|link-&gt;dev
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Don&squot;t bother checking to see if these succeed or not */
id|pcmcia_release_configuration
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
id|pcmcia_release_io
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
id|pcmcia_release_irq
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;irq
)paren
suffix:semicolon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_event - The card status event handler&n; * @event - event&n; * @pri - priority&n; * @args - arguments for this event&n; *&n; * The card status event handler. Mostly, this schedules other stuff to run&n; * after an event is received. A CARD_REMOVAL event also sets some flags to&n; * discourage the net drivers from trying to talk to the card any more.&n; *&n; * When a CARD_REMOVAL event is received, we immediately set a flag to block&n; * future accesses to this device. All the functions that actually access the&n; * device should check this flag to make sure the card is still present.&n; */
DECL|function|wl3501_event
r_static
r_int
id|wl3501_event
c_func
(paren
id|event_t
id|event
comma
r_int
id|pri
comma
id|event_callback_args_t
op_star
id|args
)paren
(brace
id|dev_link_t
op_star
id|link
op_assign
id|args-&gt;client_data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|CS_EVENT_CARD_REMOVAL
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_PRESENT
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
r_while
c_loop
(paren
id|link-&gt;open
OG
l_int|0
)paren
id|wl3501_close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_release
c_func
(paren
id|link
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CS_EVENT_CARD_INSERTION
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_PRESENT
op_or
id|DEV_CONFIG_PENDING
suffix:semicolon
id|wl3501_config
c_func
(paren
id|link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_SUSPEND
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_SUSPEND
suffix:semicolon
id|wl3501_pwr_mgmt
c_func
(paren
id|dev-&gt;priv
comma
id|WL3501_SUSPEND
)paren
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_RESET_PHYSICAL
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
r_if
c_cond
(paren
id|link-&gt;open
)paren
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pcmcia_release_configuration
c_func
(paren
id|link-&gt;handle
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_RESUME
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_SUSPEND
suffix:semicolon
id|wl3501_pwr_mgmt
c_func
(paren
id|dev-&gt;priv
comma
id|WL3501_RESUME
)paren
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_CARD_RESET
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
id|pcmcia_request_configuration
c_func
(paren
id|link-&gt;handle
comma
op_amp
id|link-&gt;conf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;open
)paren
(brace
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|wl3501_driver
r_static
r_struct
id|pcmcia_driver
id|wl3501_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|drv
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;wl3501_cs&quot;
comma
)brace
comma
dot
id|attach
op_assign
id|wl3501_attach
comma
dot
id|detach
op_assign
id|wl3501_detach
comma
)brace
suffix:semicolon
DECL|function|wl3501_init_module
r_static
r_int
id|__init
id|wl3501_init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|pcmcia_register_driver
c_func
(paren
op_amp
id|wl3501_driver
)paren
suffix:semicolon
)brace
DECL|function|wl3501_exit_module
r_static
r_void
id|__exit
id|wl3501_exit_module
c_func
(paren
r_void
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;: unloading&quot;
)paren
suffix:semicolon
id|pcmcia_unregister_driver
c_func
(paren
op_amp
id|wl3501_driver
)paren
suffix:semicolon
r_while
c_loop
(paren
id|wl3501_dev_list
)paren
(brace
multiline_comment|/* Mark the device as non-existing to minimize calls to card */
id|wl3501_dev_list-&gt;state
op_and_assign
op_complement
id|DEV_PRESENT
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_dev_list-&gt;state
op_amp
id|DEV_CONFIG
)paren
id|wl3501_release
c_func
(paren
id|wl3501_dev_list
)paren
suffix:semicolon
id|wl3501_detach
c_func
(paren
id|wl3501_dev_list
)paren
suffix:semicolon
)brace
)brace
DECL|variable|wl3501_init_module
id|module_init
c_func
(paren
id|wl3501_init_module
)paren
suffix:semicolon
DECL|variable|wl3501_exit_module
id|module_exit
c_func
(paren
id|wl3501_exit_module
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|wl3501_irq_mask
comma
id|uint
comma
l_int|0
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|wl3501_irq_list
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Fox Chen &lt;mhchen@golf.ccl.itri.org.tw&gt;, &quot;
l_string|&quot;Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;,&quot;
l_string|&quot;Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Planet wl3501 wireless driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
