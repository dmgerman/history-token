multiline_comment|/*&n; * WL3501 Wireless LAN PCMCIA Card Driver for Linux&n; * Written originally for Linux 2.0.30 by Fox Chen, mhchen@golf.ccl.itri.org.tw&n; * Ported to 2.2, 2.4 &amp; 2.5 by Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; * Wireless extensions in 2.4 by Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;&n; *&n; * References used by Fox Chen while writing the original driver for 2.0.30:&n; *&n; *   1. WL24xx packet drivers (tooasm.asm)&n; *   2. Access Point Firmware Interface Specification for IEEE 802.11 SUTRO&n; *   3. IEEE 802.11&n; *   4. Linux network driver (/usr/src/linux/drivers/net)&n; *   5. ISA card driver - wl24.c&n; *   6. Linux PCMCIA skeleton driver - skeleton.c&n; *   7. Linux PCMCIA 3c589 network driver - 3c589_cs.c&n; *&n; * Tested with WL2400 firmware 1.2, Linux 2.0.30, and pcmcia-cs-2.9.12&n; *   1. Performance: about 165 Kbytes/sec in TCP/IP with Ad-Hoc mode.&n; *      rsh 192.168.1.3 &quot;dd if=/dev/zero bs=1k count=1000&quot; &gt; /dev/null&n; *      (Specification 2M bits/sec. is about 250 Kbytes/sec., but we must deduct&n; *       ETHER/IP/UDP/TCP header, and acknowledgement overhead)&n; *&n; * Tested with Planet AP in 2.4.17, 184 Kbytes/s in UDP in Infrastructure mode,&n; * 173 Kbytes/s in TCP.&n; *&n; * Tested with Planet AP in 2.5.73-bk, 216 Kbytes/s in Infrastructure mode&n; * with a SMP machine (dual pentium 100), using pktgen, 432 pps (pkt_size = 60)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;net/iw_handler.h&gt;
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/cisreg.h&gt;
macro_line|#include &lt;pcmcia/ds.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;wl3501.h&quot;
multiline_comment|/*&n; * All the PCMCIA modules use PCMCIA_DEBUG to control debugging.  If you do not&n; * define PCMCIA_DEBUG at all, all the debug code will be left out.  If you&n; * compile with PCMCIA_DEBUG=0, the debug code will be present but disabled --&n; * but it can then be enabled for specific modules at load time with a&n; * &squot;pc_debug=#&squot; option to insmod.&n; */
DECL|macro|PCMCIA_DEBUG
mdefine_line|#define PCMCIA_DEBUG 0
macro_line|#ifdef PCMCIA_DEBUG
DECL|variable|pc_debug
r_static
r_int
id|pc_debug
op_assign
id|PCMCIA_DEBUG
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|pc_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(n, format, args...) &bslash;&n;&t;{ if (pc_debug &gt; (n)) &bslash;&n;&t;&t;printk(KERN_INFO &quot;%s: &quot; format &quot;&bslash;n&quot;, __FUNCTION__, ##args); }
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(n, format, args...)
macro_line|#endif
DECL|variable|wl3501_fpage
r_static
id|u8
id|wl3501_fpage
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
id|WL3501_BSS_FPAGE0
comma
(braket
l_int|1
)braket
op_assign
id|WL3501_BSS_FPAGE1
comma
(braket
l_int|2
)braket
op_assign
id|WL3501_BSS_FPAGE2
comma
(braket
l_int|3
)braket
op_assign
id|WL3501_BSS_FPAGE3
comma
)brace
suffix:semicolon
DECL|macro|wl3501_outb
mdefine_line|#define wl3501_outb(a, b) { outb(a, b); WL3501_SLOW_DOWN_IO; }
DECL|macro|wl3501_outb_p
mdefine_line|#define wl3501_outb_p(a, b) { outb_p(a, b); WL3501_SLOW_DOWN_IO; }
DECL|macro|wl3501_outsb
mdefine_line|#define wl3501_outsb(a, b, c) { outsb(a, b, c); WL3501_SLOW_DOWN_IO; }
DECL|macro|WL3501_RELEASE_TIMEOUT
mdefine_line|#define WL3501_RELEASE_TIMEOUT (25 * HZ)
DECL|macro|WL3501_MAX_ADHOC_TRIES
mdefine_line|#define WL3501_MAX_ADHOC_TRIES 16
multiline_comment|/* Parameters that can be set with &squot;insmod&squot; */
multiline_comment|/* Bit map of interrupts to choose from */
multiline_comment|/* This means pick from 15, 14, 12, 11, 10, 9, 7, 5, 4, and 3 */
DECL|variable|wl3501_irq_mask
r_static
r_int
r_int
id|wl3501_irq_mask
op_assign
l_int|0xdeb8
suffix:semicolon
DECL|variable|wl3501_irq_list
r_static
r_int
id|wl3501_irq_list
(braket
l_int|4
)braket
op_assign
(brace
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/*&n; * The event() function is this driver&squot;s Card Services event handler.  It will&n; * be called by Card Services when an appropriate card status event is&n; * received. The config() and release() entry points are used to configure or&n; * release a socket, in response to card insertion and ejection events.  They&n; * are invoked from the wl24 event handler.&n; */
r_static
r_void
id|wl3501_config
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
suffix:semicolon
r_static
r_void
id|wl3501_release
c_func
(paren
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_int
id|wl3501_event
c_func
(paren
id|event_t
id|event
comma
r_int
id|pri
comma
id|event_callback_args_t
op_star
id|args
)paren
suffix:semicolon
multiline_comment|/*&n; * The dev_info variable is the &quot;key&quot; that is used to match up this&n; * device driver with appropriate cards, through the card configuration&n; * database.&n; */
DECL|variable|wl3501_dev_info
r_static
id|dev_info_t
id|wl3501_dev_info
op_assign
l_string|&quot;wl3501_cs&quot;
suffix:semicolon
multiline_comment|/*&n; * A linked list of &quot;instances&quot; of the wl24 device.  Each actual PCMCIA card&n; * corresponds to one device instance, and is described by one dev_link_t&n; * structure (defined in ds.h).&n; *&n; * You may not want to use a linked list for this -- for example, the memory&n; * card driver uses an array of dev_link_t pointers, where minor device numbers&n; * are used to derive the corresponding array index.&n; */
DECL|variable|wl3501_dev_list
r_static
id|dev_link_t
op_star
id|wl3501_dev_list
suffix:semicolon
DECL|function|wl3501_switch_page
r_static
id|__inline__
r_void
id|wl3501_switch_page
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
id|page
)paren
(brace
id|wl3501_outb
c_func
(paren
id|page
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Hold SUTRO. (i.e. make SUTRO stop)&n; * Return: 1 if SUTRO is originally running&n; */
DECL|function|wl3501_hold_sutro
r_static
r_int
id|wl3501_hold_sutro
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
(paren
id|old
op_amp
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
)paren
)paren
op_or
id|WL3501_GCR_ECWAIT
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
op_logical_neg
(paren
id|old
op_amp
id|WL3501_GCR_ECWAIT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * UnHold SUTRO. (i.e. make SUTRO running)&n; * Return: 1 if SUTRO is originally running&n; */
DECL|function|wl3501_unhold_sutro
r_static
r_int
id|wl3501_unhold_sutro
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
id|old
op_amp
(paren
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
op_or
id|WL3501_GCR_ECWAIT
)paren
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
op_logical_neg
(paren
id|old
op_amp
id|WL3501_GCR_ECWAIT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get Ethernet MAC addresss.&n; *&n; * WARNING: We switch to FPAGE0 and switc back again.&n; *          Making sure there is no other WL function beening called by ISR.&n; */
DECL|function|wl3501_get_flash_mac_addr
r_static
r_int
id|wl3501_get_flash_mac_addr
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_int
id|base_addr
op_assign
id|this-&gt;base_addr
suffix:semicolon
multiline_comment|/* get MAC addr */
id|wl3501_outb
c_func
(paren
id|WL3501_BSS_FPAGE3
comma
id|base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
multiline_comment|/* BSS */
id|wl3501_outb
c_func
(paren
l_int|0x00
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
multiline_comment|/* LMAL */
id|wl3501_outb
c_func
(paren
l_int|0x40
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* LMAH */
multiline_comment|/* wait for reading EEPROM */
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b0
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b1
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b2
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b3
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b4
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;mac_addr.b5
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;freq_domain
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|WL3501_BSS_FPAGE0
comma
id|base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
l_int|0x04
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
l_int|0x40
comma
id|base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;version
(braket
l_int|0
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|this-&gt;version
(braket
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
multiline_comment|/* switch to SRAM Page 0 (for safety) */
id|wl3501_switch_page
c_func
(paren
id|this
comma
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* The MAC addr should be 00:60:... */
r_return
id|this-&gt;mac_addr.b0
op_eq
l_int|0x00
op_logical_and
id|this-&gt;mac_addr.b1
op_eq
l_int|0x60
suffix:semicolon
)brace
DECL|function|wl3501_flash_outb
r_static
r_void
id|wl3501_flash_outb
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|page
comma
id|u16
id|addr
comma
id|u8
id|data
)paren
(brace
multiline_comment|/* switch to Flash RAM Page page */
id|wl3501_outb
c_func
(paren
id|wl3501_fpage
(braket
id|page
)braket
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|addr
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|addr
op_rshift
l_int|8
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* out data to Port A */
id|wl3501_outb
c_func
(paren
id|data
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
)brace
DECL|function|wl3501_flash_inb
r_static
id|u8
id|wl3501_flash_inb
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|page
comma
id|u16
id|addr
)paren
(brace
multiline_comment|/* switch to Flash RAM Page page */
id|wl3501_outb
c_func
(paren
id|wl3501_fpage
(braket
id|page
)braket
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_BSS
)paren
suffix:semicolon
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|addr
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|addr
op_rshift
l_int|8
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* out data to Port A */
r_return
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * When calling this function, must hold SUTRO first.&n; */
DECL|function|wl3501_get_flash_id
r_static
id|u16
id|wl3501_get_flash_id
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|byte0
comma
id|byte1
suffix:semicolon
id|u16
id|id
suffix:semicolon
multiline_comment|/* Autoselect command */
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xaa
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x2aaa
comma
l_int|0x55
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0x90
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|10000
)paren
suffix:semicolon
id|byte0
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
id|byte1
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x1
)paren
suffix:semicolon
id|id
op_assign
(paren
id|byte0
op_lshift
l_int|8
)paren
op_or
id|byte1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Flash ROM ID = 0x%x&bslash;n&quot;
comma
id|id
)paren
suffix:semicolon
r_return
id|id
suffix:semicolon
)brace
multiline_comment|/*&n; * Polling if Erase/Programming command is completed&n; * Note: IF a == b THEN XOR(a,b) = 0&n; *&n; * When calling this function, must hold SUTRO first.&n; */
DECL|function|wl3501_flash_write_ok
r_static
r_int
id|wl3501_flash_write_ok
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|byte0
comma
id|byte1
suffix:semicolon
multiline_comment|/* Check &squot;Toggle Bit&squot; (DQ6) to see if completed */
r_do
(brace
id|byte0
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
id|byte1
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* Test if exceeded Time Limits (DQ5) */
r_if
c_cond
(paren
id|byte1
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* Must test DQ6 again before return 0 */
id|byte0
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
id|byte1
op_assign
id|wl3501_flash_inb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x0
)paren
suffix:semicolon
r_return
op_logical_neg
(paren
(paren
id|byte0
op_xor
id|byte1
)paren
op_amp
l_int|0x40
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|byte0
op_xor
id|byte1
)paren
op_amp
l_int|0x40
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * When calling this function, must hold SUTRO first.&n; */
DECL|function|wl3501_flash_erase_sector
r_static
r_int
id|wl3501_flash_erase_sector
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|sector
)paren
(brace
id|u16
id|page
op_assign
id|sector
op_div
l_int|2
suffix:semicolon
id|u16
id|addr
op_assign
(paren
id|sector
op_amp
l_int|1
)paren
ques
c_cond
l_int|0x4000
suffix:colon
l_int|0x0
suffix:semicolon
multiline_comment|/* Sector Erase command (6 commands must within 100 uS) */
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xaa
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x2aaa
comma
l_int|0x55
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0x80
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xaa
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x2aaa
comma
l_int|0x55
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
id|page
comma
id|addr
comma
l_int|0x30
)paren
suffix:semicolon
r_return
id|wl3501_flash_write_ok
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * When calling this function, must hold SUTRO first.&n; */
DECL|function|wl3501_flash_writeb
r_int
id|wl3501_flash_writeb
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|page
comma
id|u16
id|addr
comma
id|u8
id|data
)paren
(brace
multiline_comment|/* Autoselect command */
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xaa
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x2aaa
comma
l_int|0x55
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xa0
)paren
suffix:semicolon
id|wl3501_flash_outb
c_func
(paren
id|this
comma
id|page
comma
id|addr
comma
id|data
)paren
suffix:semicolon
r_return
id|wl3501_flash_write_ok
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_write_flash -  Write mibExtra into flash ROM&n; * @this - card&n; * @bf - buffer to write&n; * @len = buffer length&n; *&n; * In fact, only first 29 bytes are used. (not all of extra MIB)&n; * To prevent alter other data will be used by future versions, we preserve&n; * 256 bytes.&n; */
DECL|function|wl3501_write_flash
r_static
r_int
id|wl3501_write_flash
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
r_int
r_char
op_star
id|bf
comma
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|u32
id|bf_addr
op_assign
op_star
(paren
id|u32
op_star
)paren
id|bf
suffix:semicolon
r_int
id|running
op_assign
id|wl3501_hold_sutro
c_func
(paren
id|this
)paren
suffix:semicolon
id|u16
id|flash_id
op_assign
id|wl3501_get_flash_id
c_func
(paren
id|this
)paren
suffix:semicolon
id|bf
op_add_assign
l_int|4
suffix:semicolon
id|len
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|flash_id
op_eq
l_int|0x0120
)paren
(brace
multiline_comment|/* It&squot;s AMD AM29F010, must be erase before programming */
multiline_comment|/* Erase 1st 16 Kbytes within Page 0 */
r_if
c_cond
(paren
op_logical_neg
(paren
id|bf_addr
op_amp
l_int|0x3fff
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|wl3501_flash_erase_sector
c_func
(paren
id|this
comma
id|bf_addr
op_rshift
l_int|14
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;wl3501_flash_erase_sector(0) failed&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|running
)paren
id|wl3501_unhold_sutro
c_func
(paren
id|this
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|flash_id
op_ne
l_int|0xf51d
)paren
(brace
multiline_comment|/* It&squot;s not AT29C010A */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Flash ROM type (0x%x) is unknown!&bslash;n&quot;
comma
id|flash_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|running
)paren
id|wl3501_unhold_sutro
c_func
(paren
id|this
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Programming flash ROM byte by byte */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|wl3501_flash_writeb
c_func
(paren
id|this
comma
id|bf_addr
op_rshift
l_int|15
comma
id|i
comma
op_star
id|bf
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;wl3501_flash_writeb(buf[%d]) failed!&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|running
)paren
id|wl3501_unhold_sutro
c_func
(paren
id|this
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|bf
op_increment
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Reset command */
id|wl3501_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xaa
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x2aaa
comma
l_int|0x55
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
id|this
comma
l_int|0
comma
l_int|0x5555
comma
l_int|0xf0
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|10000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|running
)paren
id|wl3501_unhold_sutro
c_func
(paren
id|this
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_set_to_wla - Move &squot;size&squot; bytes from PC to card&n; * @dest: Card addressing space&n; * @src: PC addressing space&n; * @size: Bytes to move&n; *&n; * Move &squot;size&squot; bytes from PC to card. (Shouldn&squot;t be interrupted)&n; */
DECL|function|wl3501_set_to_wla
r_void
id|wl3501_set_to_wla
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|dest
comma
r_void
op_star
id|src
comma
r_int
id|size
)paren
(brace
multiline_comment|/* switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
(paren
id|dest
op_amp
l_int|0x8000
)paren
ques
c_cond
id|WL3501_BSS_SPAGE1
suffix:colon
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* wl3501_outb(((dest&gt;&gt; 11) &amp; 0x18), this-&gt;base_addr +&n;&t;  &t;&t;&t;&t;     WL3501_NIC_BSS); */
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|dest
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
(paren
(paren
id|dest
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
)paren
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* rep out to Port A */
id|wl3501_outsb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
comma
id|src
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_get_from_wla - Move &squot;size&squot; bytes from card to PC&n; * @src: Card addressing space&n; * @dest: PC addressing space&n; * @size: Bytes to move&n; *&n; * Move &squot;size&squot; bytes from card to PC. (Shouldn&squot;t be interrupted)&n; */
DECL|function|wl3501_get_from_wla
r_void
id|wl3501_get_from_wla
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|src
comma
r_void
op_star
id|dest
comma
r_int
id|size
)paren
(brace
multiline_comment|/* switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
(paren
id|src
op_amp
l_int|0x8000
)paren
ques
c_cond
id|WL3501_BSS_SPAGE1
suffix:colon
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* wl3501_outb(((src&gt;&gt; 11) &amp; 0x18), this-&gt;base_addr +&n;&t;  &t;&t;&t;&t;    WL3501_NIC_BSS); */
multiline_comment|/* set LMAL and LMAH */
id|wl3501_outb
c_func
(paren
id|src
op_amp
l_int|0xff
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAL
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
(paren
id|src
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_LMAH
)paren
suffix:semicolon
multiline_comment|/* rep get from Port A */
id|insb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_IODPA
comma
id|dest
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get/Allocate a free Tx Data Buffer&n; *&n; *  *--------------*-----------------*----------------------------------*&n; *  |    PLCP      |    MAC Header   |  DST  SRC         Data ...       |&n; *  |  (24 bytes)  |    (30 bytes)   |  (6)  (6)  (Ethernet Row Data)   |&n; *  *--------------*-----------------*----------------------------------*&n; *  &bslash;               &bslash;- IEEE 802.11 -/ &bslash;------------ uDataLen -----------/&n; *   &bslash;-struct wl3501_80211_tx_hdr--/   &bslash;-------- Ethernet Frame -------/&n; *&n; * Return = Postion in Card&n; */
DECL|function|wl3501_get_tx_buffer
r_static
id|u16
id|wl3501_get_tx_buffer
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|len
)paren
(brace
id|u16
id|next
comma
id|blk_cnt
op_assign
l_int|0
comma
id|zero
op_assign
l_int|0
suffix:semicolon
id|u16
id|full_len
op_assign
r_sizeof
(paren
r_struct
id|wl3501_80211_tx_hdr
)paren
op_plus
id|len
suffix:semicolon
id|u16
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|full_len
OG
id|this-&gt;tx_buffer_cnt
op_star
l_int|254
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
id|this-&gt;tx_buffer_head
suffix:semicolon
r_while
c_loop
(paren
id|full_len
)paren
(brace
r_if
c_cond
(paren
id|full_len
OL
l_int|254
)paren
id|full_len
op_assign
l_int|0
suffix:semicolon
r_else
id|full_len
op_sub_assign
l_int|254
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_head
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|full_len
)paren
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_head
comma
op_amp
id|zero
comma
r_sizeof
(paren
id|zero
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_head
op_assign
id|next
suffix:semicolon
id|blk_cnt
op_increment
suffix:semicolon
multiline_comment|/* if buffer is not enough */
r_if
c_cond
(paren
op_logical_neg
id|next
op_logical_and
id|full_len
)paren
(brace
id|this-&gt;tx_buffer_head
op_assign
id|ret
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|this-&gt;tx_buffer_cnt
op_sub_assign
id|blk_cnt
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Free an allocated Tx Buffer. ptr must be correct position.&n; */
DECL|function|wl3501_free_tx_buffer
r_static
r_void
id|wl3501_free_tx_buffer
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|ptr
)paren
(brace
multiline_comment|/* check if all space is not free */
r_if
c_cond
(paren
op_logical_neg
id|this-&gt;tx_buffer_head
)paren
id|this-&gt;tx_buffer_head
op_assign
id|ptr
suffix:semicolon
r_else
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;tx_buffer_tail
comma
op_amp
id|ptr
comma
r_sizeof
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ptr
)paren
(brace
id|u16
id|next
suffix:semicolon
id|this-&gt;tx_buffer_cnt
op_increment
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_tail
op_assign
id|ptr
suffix:semicolon
id|ptr
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|wl3501_esbq_req_test
r_static
r_int
id|wl3501_esbq_req_test
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
op_amp
l_int|0x80
suffix:semicolon
)brace
DECL|function|wl3501_esbq_req
r_static
r_void
id|wl3501_esbq_req
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
op_star
id|ptr
)paren
(brace
id|u16
id|tmp
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
comma
id|ptr
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_head
op_plus
l_int|2
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|this-&gt;esbq_req_head
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_head
op_ge
id|this-&gt;esbq_req_end
)paren
id|this-&gt;esbq_req_head
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_send_pkt - Send a packet.&n; * @this - card&n; *&n; * Send a packet.&n; *&n; * data = Ethernet raw frame.  (e.g. data[0] - data[5] is Dest MAC Addr,&n; *                                    data[6] - data[11] is Src MAC Addr)&n; * Ref: IEEE 802.11&n; */
DECL|function|wl3501_send_pkt
r_static
r_int
id|wl3501_send_pkt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
op_star
id|data
comma
id|u16
id|len
)paren
(brace
id|u16
id|bf
comma
id|sig_bf
comma
id|next
comma
id|tmplen
comma
id|pktlen
comma
id|tmp
suffix:semicolon
r_struct
id|wl3501_md_req
id|sig
suffix:semicolon
id|u8
op_star
id|pdata
op_assign
(paren
r_char
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|sig_bf
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sig_bf
)paren
multiline_comment|/* No free buffer available */
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|bf
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
id|len
op_plus
l_int|26
op_plus
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bf
)paren
(brace
multiline_comment|/* No free buffer available */
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|sig_bf
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|sig.daddr
(braket
l_int|0
)braket
)paren
comma
id|pdata
comma
l_int|12
)paren
suffix:semicolon
id|pktlen
op_assign
id|len
op_minus
l_int|12
suffix:semicolon
id|pdata
op_add_assign
l_int|12
suffix:semicolon
id|sig.next_blk
op_assign
l_int|0
suffix:semicolon
id|sig.sig_id
op_assign
id|WL3501_SIG_MD_REQ
suffix:semicolon
id|sig.data
op_assign
id|bf
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;llc_type
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
op_star
id|pdata
)paren
op_star
l_int|256
op_plus
(paren
op_star
(paren
id|pdata
op_plus
l_int|1
)paren
)paren
)paren
OG
l_int|1500
)paren
(brace
id|sig.size
op_assign
id|pktlen
op_plus
l_int|24
op_plus
l_int|4
op_plus
l_int|6
suffix:semicolon
id|tmp
op_assign
l_int|0xaaaa
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_minus
l_int|6
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|tmp
op_assign
l_int|0x03
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_minus
l_int|4
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|tmp
op_assign
l_int|0x0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_minus
l_int|2
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pktlen
OG
(paren
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
)paren
)paren
(brace
id|tmplen
op_assign
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
suffix:semicolon
id|pktlen
op_sub_assign
id|tmplen
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
r_else
(brace
id|sig.size
op_assign
id|pktlen
op_plus
l_int|24
op_plus
l_int|4
op_minus
l_int|2
suffix:semicolon
id|pdata
op_add_assign
l_int|2
suffix:semicolon
id|pktlen
op_sub_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|pktlen
OG
(paren
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
)paren
)paren
(brace
id|tmplen
op_assign
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
suffix:semicolon
id|pktlen
op_sub_assign
id|tmplen
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_minus
l_int|6
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
)brace
r_else
(brace
id|pktlen
op_add_assign
l_int|12
suffix:semicolon
id|sig.size
op_assign
id|pktlen
op_plus
l_int|24
op_plus
l_int|4
suffix:semicolon
id|pdata
op_sub_assign
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|pktlen
OG
(paren
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
)paren
)paren
(brace
id|tmplen
op_assign
l_int|254
op_minus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_plus
l_int|6
suffix:semicolon
id|pktlen
op_sub_assign
id|tmplen
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|wl3501_tx_hdr
)paren
op_minus
l_int|6
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|pktlen
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|pktlen
OG
l_int|254
)paren
(brace
id|tmplen
op_assign
l_int|254
suffix:semicolon
id|pktlen
op_sub_assign
l_int|254
suffix:semicolon
)brace
r_else
(brace
id|tmplen
op_assign
id|pktlen
suffix:semicolon
id|pktlen
op_assign
l_int|0
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|bf
op_plus
l_int|2
comma
id|pdata
comma
id|tmplen
)paren
suffix:semicolon
id|pdata
op_add_assign
id|tmplen
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|bf
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|bf
op_assign
id|next
suffix:semicolon
)brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|sig_bf
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|sig_bf
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_resync
r_static
r_int
id|wl3501_mgmt_resync
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_resync_req
id|signal
suffix:semicolon
r_int
id|rc
op_assign
l_int|1
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_RESYNC_REQ
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_scan
r_static
r_int
id|wl3501_mgmt_scan
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|chan_time
)paren
(brace
r_struct
id|wl3501_scan_req
id|signal
suffix:semicolon
r_int
id|rc
op_assign
l_int|1
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_SCAN_REQ
suffix:semicolon
id|signal.ssid
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|signal.ssid
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|signal.scan_type
op_assign
id|WL3501_SCAN_TYPE_ACTIVE
suffix:semicolon
id|signal.probe_delay
op_assign
l_int|0x10
suffix:semicolon
id|signal.min_chan_time
op_assign
id|chan_time
suffix:semicolon
id|signal.max_chan_time
op_assign
id|chan_time
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
id|signal.bss_type
op_assign
id|WL3501_NET_TYPE_INFRA
suffix:semicolon
r_else
id|signal.bss_type
op_assign
id|WL3501_NET_TYPE_ADHOC
suffix:semicolon
id|this-&gt;bss_cnt
op_assign
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_join
r_static
r_int
id|wl3501_mgmt_join
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|stas
)paren
(brace
r_struct
id|wl3501_join_req
id|signal
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_JOIN_REQ
suffix:semicolon
id|signal.timeout
op_assign
l_int|10
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.beacon_period
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bss_set
(braket
id|stas
)braket
dot
id|beacon_period
)paren
comma
l_int|72
)paren
suffix:semicolon
multiline_comment|/* FIXME: next two stmts should be reverted or deleted, study */
id|this-&gt;cap_info
op_assign
id|signal.cap_info
suffix:semicolon
id|this-&gt;chan
op_assign
id|signal.phy_pset
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_start
r_static
r_int
id|wl3501_mgmt_start
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_start_req
id|signal
suffix:semicolon
r_int
id|rc
op_assign
l_int|1
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_START_REQ
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|signal.ssid
comma
(paren
r_char
op_star
)paren
id|this-&gt;essid
comma
l_int|34
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|this-&gt;keep_essid
comma
(paren
r_char
op_star
)paren
id|this-&gt;essid
comma
l_int|34
)paren
suffix:semicolon
id|signal.bss_type
op_assign
id|this-&gt;net_type
op_assign
id|IW_MODE_INFRA
ques
c_cond
id|WL3501_NET_TYPE_INFRA
suffix:colon
id|WL3501_NET_TYPE_INFRA
suffix:semicolon
id|signal.beacon_period
op_assign
l_int|400
suffix:semicolon
id|signal.dtim_period
op_assign
l_int|1
suffix:semicolon
id|signal.phy_pset
(braket
l_int|0
)braket
op_assign
l_int|3
suffix:semicolon
id|signal.phy_pset
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|signal.phy_pset
(braket
l_int|2
)braket
op_assign
id|this-&gt;chan
suffix:semicolon
id|signal.cap_info
op_assign
l_int|0x02
suffix:semicolon
id|signal.bss_basic_rate_set
(braket
l_int|0
)braket
op_assign
l_int|0x01
suffix:semicolon
id|signal.bss_basic_rate_set
(braket
l_int|1
)braket
op_assign
l_int|0x02
suffix:semicolon
id|signal.bss_basic_rate_set
(braket
l_int|2
)braket
op_assign
l_int|0x82
suffix:semicolon
id|signal.bss_basic_rate_set
(braket
l_int|3
)braket
op_assign
l_int|0x84
suffix:semicolon
id|signal.operational_rate_set
(braket
l_int|0
)braket
op_assign
l_int|0x01
suffix:semicolon
id|signal.operational_rate_set
(braket
l_int|1
)braket
op_assign
l_int|0x02
suffix:semicolon
id|signal.operational_rate_set
(braket
l_int|2
)braket
op_assign
l_int|0x82
suffix:semicolon
id|signal.operational_rate_set
(braket
l_int|3
)braket
op_assign
l_int|0x84
suffix:semicolon
id|signal.ibss_pset
(braket
l_int|0
)braket
op_assign
l_int|6
suffix:semicolon
id|signal.ibss_pset
(braket
l_int|1
)braket
op_assign
l_int|2
suffix:semicolon
id|signal.ibss_pset
(braket
l_int|2
)braket
op_assign
l_int|10
suffix:semicolon
id|signal.ibss_pset
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|u16
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_scan_confirm
r_static
r_void
id|wl3501_mgmt_scan_confirm
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
id|u16
id|i
comma
id|j
suffix:semicolon
r_int
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_struct
id|wl3501_scan_confirm
id|signal
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;driver_state
op_eq
id|WL3501_SIG_SCAN_REQ
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
(paren
r_char
op_star
)paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
(paren
r_char
op_star
)paren
id|signal.bssid
comma
id|ETH_ALEN
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_eq
id|this-&gt;bss_cnt
)paren
op_logical_and
id|i
OL
l_int|20
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|beacon_period
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.beacon_period
)paren
comma
l_int|73
)paren
suffix:semicolon
id|this-&gt;bss_cnt
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
op_logical_and
(paren
id|signal.cap_info
op_amp
l_int|0x01
)paren
)paren
op_logical_or
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_ADHOC
op_logical_and
(paren
id|signal.cap_info
op_amp
l_int|0x02
)paren
)paren
op_logical_or
id|this-&gt;net_type
op_eq
id|IW_MODE_AUTO
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|this-&gt;essid
(braket
l_int|1
)braket
)paren
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|this-&gt;essid
(braket
l_int|1
)braket
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|this-&gt;essid
(braket
l_int|2
)braket
comma
l_string|&quot;ANY&quot;
comma
l_int|3
)paren
)paren
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|this-&gt;essid
(braket
l_int|1
)braket
op_ne
id|signal.ssid
(braket
l_int|1
)braket
)paren
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;essid
(braket
l_int|2
)braket
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.ssid
(braket
l_int|2
)braket
)paren
comma
id|this-&gt;essid
(braket
l_int|1
)braket
)paren
)paren
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_else
id|matchflag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|matchflag
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
(paren
(paren
r_char
op_star
)paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
comma
(paren
r_char
op_star
)paren
id|signal.bssid
comma
id|ETH_ALEN
)paren
)paren
(brace
id|matchflag
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|matchflag
op_logical_and
(paren
id|i
OL
l_int|20
)paren
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|beacon_period
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.beacon_period
)paren
comma
l_int|73
)paren
suffix:semicolon
id|this-&gt;bss_cnt
op_increment
suffix:semicolon
id|this-&gt;rssi
op_assign
id|signal.rssi
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|signal.status
op_eq
id|WL3501_STATUS_TIMEOUT
op_logical_and
id|this-&gt;driver_state
op_ne
id|WL3501_SIG_SCAN_REQ
)paren
(brace
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|j
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|wl3501_mgmt_join
c_func
(paren
id|this
comma
id|j
)paren
)paren
r_break
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
id|j
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
op_eq
id|this-&gt;bss_cnt
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
r_else
(brace
id|this-&gt;adhoc_times
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;adhoc_times
OG
id|WL3501_MAX_ADHOC_TRIES
)paren
id|wl3501_mgmt_start
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/**&n; * wl3501_block_interrupt - Mask interrupt from SUTRO&n; * @this - card&n; *&n; * Mask interrupt from SUTRO. (i.e. SUTRO cannot interrupt the HOST)&n; * Return: 1 if interrupt is originally enabled&n; */
DECL|function|wl3501_block_interrupt
r_static
r_int
id|wl3501_block_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
id|old
op_amp
(paren
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
op_or
id|WL3501_GCR_ENECINT
)paren
)paren
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
id|old
op_amp
id|WL3501_GCR_ENECINT
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_unblock_interrupt - Enable interrupt from SUTRO&n; * @this - card&n; *&n; * Enable interrupt from SUTRO. (i.e. SUTRO can interrupt the HOST)&n; * Return: 1 if interrupt is originally enabled&n; */
DECL|function|wl3501_unblock_interrupt
r_static
r_int
id|wl3501_unblock_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|old
op_assign
id|inb
c_func
(paren
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|u8
r_new
op_assign
(paren
id|old
op_amp
op_complement
(paren
id|WL3501_GCR_ECINT
op_or
id|WL3501_GCR_INT2EC
)paren
)paren
op_or
id|WL3501_GCR_ENECINT
suffix:semicolon
id|wl3501_outb
c_func
(paren
r_new
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
r_return
id|old
op_amp
id|WL3501_GCR_ENECINT
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_receive - Receive data from Receive Queue.&n; *&n; * Receive data from Receive Queue.&n; *&n; * @this: card&n; * @bf: address of host&n; * @size: size of buffer.&n; */
DECL|function|wl3501_receive
r_static
id|u16
id|wl3501_receive
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u8
op_star
id|bf
comma
id|u16
id|size
)paren
(brace
id|u16
id|next_addr
comma
id|next_addr1
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|bf
op_plus
l_int|12
suffix:semicolon
id|size
op_sub_assign
l_int|12
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
l_int|2
comma
op_amp
id|next_addr
comma
r_sizeof
(paren
id|next_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;llc_type
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;ether_type
op_eq
id|ARPHRD_ETHER
)paren
(brace
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
suffix:semicolon
id|size
op_sub_assign
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
suffix:semicolon
id|data
op_add_assign
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|size
op_sub_assign
l_int|2
suffix:semicolon
op_star
id|data
op_assign
(paren
id|size
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
op_star
(paren
id|data
op_plus
l_int|1
)paren
op_assign
id|size
op_amp
l_int|0xff
suffix:semicolon
id|data
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_plus
l_int|6
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_plus
l_int|6
)paren
suffix:semicolon
id|size
op_assign
id|size
op_minus
(paren
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
op_plus
l_int|6
suffix:semicolon
id|data
op_add_assign
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_plus
l_int|6
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_plus
l_int|6
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
)paren
suffix:semicolon
id|size
op_assign
id|size
op_minus
(paren
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
)paren
op_minus
l_int|6
suffix:semicolon
id|data
op_add_assign
(paren
id|WL3501_BLKSZ
op_minus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;start_seg
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_plus
l_int|6
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|size
OG
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|5
comma
id|data
comma
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
suffix:semicolon
id|size
op_sub_assign
(paren
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
suffix:semicolon
id|data
op_add_assign
(paren
id|WL3501_BLKSZ
op_minus
l_int|5
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|2
comma
op_amp
id|next_addr1
comma
r_sizeof
(paren
id|next_addr1
)paren
)paren
suffix:semicolon
id|next_addr
op_assign
id|next_addr1
suffix:semicolon
)brace
r_else
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|next_addr
op_plus
l_int|5
comma
id|data
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_esbq_req_free
r_static
r_void
id|wl3501_esbq_req_free
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|u16
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_head
op_eq
id|this-&gt;esbq_req_tail
)paren
r_goto
id|out
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_tail
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|0x80
)paren
)paren
r_goto
id|out
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_req_tail
comma
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
id|this-&gt;esbq_req_tail
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_req_tail
op_ge
id|this-&gt;esbq_req_end
)paren
id|this-&gt;esbq_req_tail
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|wl3501_esbq_confirm
r_static
r_int
id|wl3501_esbq_confirm
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_return
id|tmp
op_amp
l_int|0x80
suffix:semicolon
)brace
DECL|function|wl3501_online
r_static
r_void
id|wl3501_online
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Wireless LAN online. BSSID: &quot;
l_string|&quot;%02X %02X %02X %02X %02X %02X&bslash;n&quot;
comma
id|this-&gt;bssid.b0
comma
id|this-&gt;bssid.b1
comma
id|this-&gt;bssid.b2
comma
id|this-&gt;bssid.b3
comma
id|this-&gt;bssid.b4
comma
id|this-&gt;bssid.b5
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_esbq_confirm_done
r_static
r_void
id|wl3501_esbq_confirm_done
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
op_plus
l_int|3
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
id|this-&gt;esbq_confirm
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;esbq_confirm
op_ge
id|this-&gt;esbq_confirm_end
)paren
id|this-&gt;esbq_confirm
op_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_auth
r_static
r_int
id|wl3501_mgmt_auth
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_auth_req
id|signal
suffix:semicolon
id|u16
id|ptr
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_AUTH_REQ
suffix:semicolon
id|signal.type
op_assign
id|WL3501_SYS_TYPE_OPEN
suffix:semicolon
id|signal.timeout
op_assign
l_int|1000
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.mac_addr
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bssid
)paren
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_association
r_static
r_int
id|wl3501_mgmt_association
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_struct
id|wl3501_assoc_req
id|signal
suffix:semicolon
id|u16
id|ptr
suffix:semicolon
id|signal.next_blk
op_assign
l_int|0
suffix:semicolon
id|signal.sig_id
op_assign
id|WL3501_SIG_ASSOC_REQ
suffix:semicolon
id|signal.timeout
op_assign
l_int|1000
suffix:semicolon
id|signal.listen_interval
op_assign
l_int|5
suffix:semicolon
id|signal.cap_info
op_assign
id|this-&gt;cap_info
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|signal.mac_addr
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bssid
)paren
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_esbq_req_test
c_func
(paren
id|this
)paren
)paren
(brace
id|ptr
op_assign
id|wl3501_get_tx_buffer
c_func
(paren
id|this
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|signal
comma
r_sizeof
(paren
id|signal
)paren
)paren
suffix:semicolon
id|wl3501_esbq_req
c_func
(paren
id|this
comma
op_amp
id|ptr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|wl3501_mgmt_join_confirm
r_static
r_void
id|wl3501_mgmt_join_confirm
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|addr
)paren
(brace
id|u16
id|i
comma
id|j
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|wl3501_join_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
OL
id|this-&gt;bss_cnt
)paren
(brace
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bssid
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
)paren
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|this-&gt;chan
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|phy_pset
(braket
l_int|2
)braket
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|this-&gt;keep_essid
comma
(paren
r_char
op_star
)paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid
comma
l_int|34
)paren
suffix:semicolon
id|wl3501_mgmt_auth
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|i
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bssid
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|bssid
)paren
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|this-&gt;chan
op_assign
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|phy_pset
(braket
l_int|2
)braket
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|this-&gt;keep_essid
comma
(paren
r_char
op_star
)paren
id|this-&gt;bss_set
(braket
id|i
)braket
dot
id|ssid
comma
l_int|34
)paren
suffix:semicolon
id|wl3501_online
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|this-&gt;join_sta_bss
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|this-&gt;join_sta_bss
suffix:semicolon
id|j
OL
id|this-&gt;bss_cnt
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|wl3501_mgmt_join
c_func
(paren
id|this
comma
id|j
)paren
)paren
r_break
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
id|j
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;join_sta_bss
op_eq
id|this-&gt;bss_cnt
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
r_else
(brace
id|this-&gt;adhoc_times
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;adhoc_times
OG
id|WL3501_MAX_ADHOC_TRIES
)paren
id|wl3501_mgmt_start
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|wl3501_alarm_interrupt
r_static
r_inline
r_void
id|wl3501_alarm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
r_if
c_cond
(paren
id|this-&gt;net_type
op_eq
id|IW_MODE_INFRA
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Wireless LAN offline&bslash;n&quot;
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
)brace
DECL|function|wl3501_md_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_md_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_md_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|wl3501_free_tx_buffer
c_func
(paren
id|this
comma
id|sig.data
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_md_ind_interrupt
r_static
r_inline
r_void
id|wl3501_md_ind_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_md_ind
id|sig
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u16
id|pkt_len
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
id|this-&gt;start_seg
op_assign
id|sig.data
suffix:semicolon
r_if
c_cond
(paren
id|this-&gt;llc_type
op_eq
l_int|1
)paren
(brace
id|u16
id|tmp
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|sig.data
op_plus
r_sizeof
(paren
r_struct
id|wl3501_rx_hdr
)paren
op_minus
l_int|6
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xaaaa
)paren
(brace
id|pkt_len
op_assign
id|sig.size
op_plus
l_int|12
op_minus
l_int|24
op_minus
l_int|4
op_minus
l_int|6
suffix:semicolon
id|this-&gt;ether_type
op_assign
id|ARPHRD_ETHER
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xe0e0
)paren
(brace
id|pkt_len
op_assign
id|sig.size
op_plus
l_int|12
op_minus
l_int|24
op_minus
l_int|4
op_plus
l_int|2
suffix:semicolon
id|this-&gt;ether_type
op_assign
id|ARPHRD_IEEE80211
suffix:semicolon
multiline_comment|/* FIXME */
)brace
r_else
(brace
id|pkt_len
op_assign
id|sig.size
op_plus
l_int|12
op_minus
l_int|24
op_minus
l_int|4
op_plus
l_int|2
suffix:semicolon
id|this-&gt;ether_type
op_assign
id|ARPHRD_IEEE80211
suffix:semicolon
multiline_comment|/* FIXME */
)brace
)brace
r_else
id|pkt_len
op_assign
id|sig.size
op_minus
l_int|24
op_minus
l_int|4
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t alloc a sk_buff of size %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
)paren
suffix:semicolon
id|this-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* IP headers on 16 bytes&n;&t;&t;&t;&t;&t;   boundaries */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
op_amp
id|sig.daddr
comma
l_int|12
comma
l_int|0
)paren
suffix:semicolon
id|wl3501_receive
c_func
(paren
id|this
comma
id|skb-&gt;data
comma
id|pkt_len
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|this-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|this-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|wl3501_get_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_get_confirm_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_get_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
id|sig.mib_status
)paren
(brace
r_switch
c_cond
(paren
id|sig.mib_attrib
)paren
(brace
r_case
id|wl3501_mib_mac_addr
suffix:colon
r_break
suffix:semicolon
r_case
id|wl3501_mib_current_reg_domain
suffix:colon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
DECL|function|wl3501_start_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_start_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_start_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_assoc_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_assoc_confirm_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|wl3501_assoc_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|wl3501_online
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|wl3501_auth_confirm_interrupt
r_static
r_inline
r_void
id|wl3501_auth_confirm_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
comma
id|u16
id|addr
)paren
(brace
r_struct
id|wl3501_auth_confirm
id|sig
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sig.status
op_eq
id|WL3501_STATUS_SUCCESS
)paren
id|wl3501_mgmt_association
c_func
(paren
id|this
)paren
suffix:semicolon
r_else
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
DECL|function|wl3501_rx_interrupt
r_static
r_inline
r_void
id|wl3501_rx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|morepkts
suffix:semicolon
id|u16
id|addr
suffix:semicolon
id|u8
id|sig_id
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|loop
suffix:colon
id|morepkts
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_esbq_confirm
c_func
(paren
id|this
)paren
)paren
r_goto
id|free
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|this-&gt;esbq_confirm
comma
op_amp
id|addr
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
id|addr
op_plus
l_int|2
comma
op_amp
id|sig_id
comma
r_sizeof
(paren
id|sig_id
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sig_id
)paren
(brace
r_case
id|WL3501_SIG_DEAUTH_IND
suffix:colon
r_case
id|WL3501_SIG_DISASSOC_IND
suffix:colon
r_case
id|WL3501_SIG_ALARM
suffix:colon
id|wl3501_alarm_interrupt
c_func
(paren
id|dev
comma
id|this
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_MD_CONFIRM
suffix:colon
id|wl3501_md_confirm_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_MD_IND
suffix:colon
id|wl3501_md_ind_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_GET_CONFIRM
suffix:colon
id|wl3501_get_confirm_interrupt
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_START_CONFIRM
suffix:colon
id|wl3501_start_confirm_interrupt
c_func
(paren
id|dev
comma
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_SCAN_CONFIRM
suffix:colon
id|wl3501_mgmt_scan_confirm
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_JOIN_CONFIRM
suffix:colon
id|wl3501_mgmt_join_confirm
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_ASSOC_CONFIRM
suffix:colon
id|wl3501_assoc_confirm_interrupt
c_func
(paren
id|dev
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_AUTH_CONFIRM
suffix:colon
id|wl3501_auth_confirm_interrupt
c_func
(paren
id|this
comma
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_SIG_RESYNC_CONFIRM
suffix:colon
id|wl3501_mgmt_resync
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* FIXME: should be resync_confirm */
r_break
suffix:semicolon
)brace
id|wl3501_esbq_confirm_done
c_func
(paren
id|this
)paren
suffix:semicolon
id|morepkts
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* free request if necessary */
id|free
suffix:colon
id|wl3501_esbq_req_free
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|morepkts
)paren
r_goto
id|loop
suffix:semicolon
)brace
DECL|function|wl3501_ack_interrupt
r_static
r_inline
r_void
id|wl3501_ack_interrupt
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|wl3501_outb
c_func
(paren
id|WL3501_GCR_ECINT
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_interrupt - Hardware interrupt from card.&n; * @irq - Interrupt number&n; * @dev_id - net_device&n; * @regs - registers&n; *&n; * We must acknowledge the interrupt as soon as possible, and block the&n; * interrupt from the same card immediately to prevent re-entry.&n; *&n; * Before accessing the Control_Status_Block, we must lock SUTRO first.&n; * On the other hand, to prevent SUTRO from malfunctioning, we must&n; * unlock the SUTRO as soon as possible.&n; */
DECL|function|wl3501_interrupt
r_static
id|irqreturn_t
id|wl3501_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
suffix:semicolon
r_int
id|handled
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|unknown
suffix:semicolon
id|this
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_rx_interrupt
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
id|unknown
suffix:colon
id|handled
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: irq %d for unknown device.&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|wl3501_reset_board
r_static
r_int
id|wl3501_reset_board
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u8
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Coreset */
id|wl3501_outb_p
c_func
(paren
id|WL3501_GCR_CORESET
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|wl3501_outb_p
c_func
(paren
l_int|0
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|wl3501_outb_p
c_func
(paren
id|WL3501_GCR_CORESET
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
multiline_comment|/* Reset SRAM 0x480 to zero */
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
multiline_comment|/* Start up */
id|wl3501_outb_p
c_func
(paren
l_int|0
comma
id|this-&gt;base_addr
op_plus
id|WL3501_NIC_GCR
)paren
suffix:semicolon
id|WL3501_NOPLOOP
c_func
(paren
l_int|1024
op_star
l_int|50
)paren
suffix:semicolon
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* acme: was commented */
multiline_comment|/* Polling Self_Test_Status */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_char|&squot;W&squot;
)paren
(brace
multiline_comment|/* firmware complete all test successfully */
id|tmp
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
l_int|0x480
comma
op_amp
id|tmp
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|WL3501_NOPLOOP
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to reset the board!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_init_firmware
r_static
r_int
id|wl3501_init_firmware
c_func
(paren
r_struct
id|wl3501_card
op_star
id|this
)paren
(brace
id|u16
id|ptr
comma
id|next
suffix:semicolon
r_int
id|rc
op_assign
id|wl3501_reset_board
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/* Switch to SRAM Page 0 */
id|wl3501_switch_page
c_func
(paren
id|this
comma
id|WL3501_BSS_SPAGE0
)paren
suffix:semicolon
multiline_comment|/* Read parameter from card */
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x482
comma
op_amp
id|this-&gt;esbq_req_start
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x486
comma
op_amp
id|this-&gt;esbq_req_end
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x488
comma
op_amp
id|this-&gt;esbq_confirm_start
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x48c
comma
op_amp
id|this-&gt;esbq_confirm_end
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x48e
comma
op_amp
id|this-&gt;tx_buffer_head
comma
l_int|2
)paren
suffix:semicolon
id|wl3501_get_from_wla
c_func
(paren
id|this
comma
l_int|0x492
comma
op_amp
id|this-&gt;tx_buffer_size
comma
l_int|2
)paren
suffix:semicolon
id|this-&gt;esbq_req_tail
op_assign
id|this-&gt;esbq_req_head
op_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|this-&gt;esbq_req_end
op_add_assign
id|this-&gt;esbq_req_start
suffix:semicolon
id|this-&gt;esbq_confirm
op_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
id|this-&gt;esbq_confirm_end
op_add_assign
id|this-&gt;esbq_confirm_start
suffix:semicolon
multiline_comment|/* Initial Tx Buffer */
id|this-&gt;tx_buffer_cnt
op_assign
l_int|1
suffix:semicolon
id|ptr
op_assign
id|this-&gt;tx_buffer_head
suffix:semicolon
id|next
op_assign
id|ptr
op_plus
id|WL3501_BLKSZ
suffix:semicolon
r_while
c_loop
(paren
(paren
id|next
op_minus
id|this-&gt;tx_buffer_head
)paren
OL
id|this-&gt;tx_buffer_size
)paren
(brace
id|this-&gt;tx_buffer_cnt
op_increment
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|next
suffix:semicolon
id|next
op_assign
id|ptr
op_plus
id|WL3501_BLKSZ
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|next
op_assign
l_int|0
suffix:semicolon
id|wl3501_set_to_wla
c_func
(paren
id|this
comma
id|ptr
comma
op_amp
id|next
comma
r_sizeof
(paren
id|next
)paren
)paren
suffix:semicolon
id|this-&gt;tx_buffer_tail
op_assign
id|ptr
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|fail
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|wl3501_close
r_static
r_int
id|wl3501_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Check if the device is in wl3501_dev_list */
r_for
c_loop
(paren
id|link
op_assign
id|wl3501_dev_list
suffix:semicolon
id|link
suffix:semicolon
id|link
op_assign
id|link-&gt;next
)paren
r_if
c_cond
(paren
id|link-&gt;priv
op_eq
id|dev
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|link
)paren
r_goto
id|out
suffix:semicolon
id|link-&gt;open
op_decrement
suffix:semicolon
multiline_comment|/* Stop wl3501_hard_start_xmit() from now on */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Mask interrupts from the SUTRO */
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_STALE_CONFIG
)paren
(brace
id|link-&gt;release.expires
op_assign
id|jiffies
op_plus
id|WL3501_RELEASE_TIMEOUT
suffix:semicolon
id|link-&gt;state
op_or_assign
id|DEV_RELEASE_PENDING
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|link-&gt;release
)paren
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: WL3501 closed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_reset - Reset the SUTRO.&n; * @dev - network device&n; *&n; * It is almost the same as wl3501_open(). In fact, we may just wl3501_close()&n; * and wl3501_open() again, but I wouldn&squot;t like to free_irq() when the driver&n; * is running. It seems to be dangerous.&n; */
DECL|function|wl3501_reset
r_static
r_int
id|wl3501_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Stop processing interrupt from the card */
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Initial WL3501 firmware */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Initialize WL3501 firmware...&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_init_firmware
c_func
(paren
id|this
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t initialize Firmware!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Free IRQ, and mark IRQ as unused */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* queue has to be started only when the Card is Started */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Enable interrupt from card */
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: device reset&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_tx_timeout
r_static
r_void
id|wl3501_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|this-&gt;stats
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d resetting card on Tx timeout!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_else
(brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Return : 0 - OK&n; *&t;    1 - Could not transmit (dev_queue_xmit will queue it)&n; *&t;&t;and try to sent it later&n; */
DECL|function|wl3501_hard_start_xmit
r_static
r_int
id|wl3501_hard_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|enabled
comma
id|rc
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|enabled
op_assign
id|wl3501_block_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|rc
op_assign
id|wl3501_send_pkt
c_func
(paren
id|this
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enabled
)paren
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
op_increment
id|this-&gt;stats.tx_dropped
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
op_increment
id|this-&gt;stats.tx_packets
suffix:semicolon
id|this-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_open
r_static
r_int
id|wl3501_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Check if the device is in wl3501_dev_list */
r_for
c_loop
(paren
id|link
op_assign
id|wl3501_dev_list
suffix:semicolon
id|link
suffix:semicolon
id|link
op_assign
id|link-&gt;next
)paren
r_if
c_cond
(paren
id|link-&gt;priv
op_eq
id|dev
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|DEV_OK
c_func
(paren
id|link
)paren
)paren
r_goto
id|out
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;open
op_increment
suffix:semicolon
multiline_comment|/* Initial WL3501 firmware */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Initialize WL3501 firmware...&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_init_firmware
c_func
(paren
id|this
)paren
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/* Initial device variables */
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Acknowledge Interrupt, for cleaning last state */
id|wl3501_ack_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
multiline_comment|/* Enable interrupt from card after all */
id|wl3501_unblock_interrupt
c_func
(paren
id|this
)paren
suffix:semicolon
id|wl3501_mgmt_scan
c_func
(paren
id|this
comma
l_int|100
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: WL3501 opened&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
id|fail
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t initialize firmware!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_init - &quot;initialize&quot; board&n; * @dev - network device&n; *&n; * We never need to do anything when a wl3501 device is &quot;initialized&quot; by the net&n; * software, because we only register already-found cards.&n; */
DECL|function|wl3501_init
r_static
r_int
id|wl3501_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_stats
r_struct
id|net_device_stats
op_star
id|wl3501_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|this-&gt;stats
suffix:semicolon
)brace
DECL|function|wl3501_get_wireless_stats
r_struct
id|iw_statistics
op_star
id|wl3501_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|this-&gt;wstats
suffix:semicolon
id|wstats-&gt;status
op_assign
id|netif_running
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wstats-&gt;qual.qual
op_assign
l_int|0
suffix:semicolon
id|wstats-&gt;qual.level
op_assign
l_int|0
suffix:semicolon
id|wstats-&gt;qual.noise
op_assign
l_int|0
suffix:semicolon
id|wstats-&gt;discard.nwid
op_assign
l_int|0
suffix:semicolon
id|wstats-&gt;discard.code
op_assign
l_int|0
suffix:semicolon
id|wstats-&gt;discard.misc
op_assign
l_int|0
suffix:semicolon
r_return
id|wstats
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_set_multicast_list - Set or clear the multicast filter&n; * @dev - network device&n; *&n; * Set or clear the multicast filter for this card.&n; *&n; * CAUTION: To prevent interrupted by WL_Interrupt() and timer-based&n; * wl3501_hard_start_xmit() from other interrupts, this should be run&n; * single-threaded.&n; */
DECL|function|wl3501_set_multicast_list
r_static
r_void
id|wl3501_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#if 0
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|filter
op_assign
id|RMR_UNICAST
op_or
id|RMR_BROADCAST
suffix:semicolon
multiline_comment|/* Normal mode */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
multiline_comment|/* Promiscuous mode */
id|filter
op_or_assign
id|RMR_PROMISCUOUS
op_or
id|RMR_ALL_MULTICAST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
multiline_comment|/* Allow multicast */
id|filter
op_or_assign
id|RMR_ALL_MULTICAST
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Must not be interrupted */
id|wl3501_set_mib_value
c_func
(paren
id|this
comma
id|TYPE_EXTRA_MIB
comma
id|IDX_RECEIVEMODE
comma
op_amp
id|filter
comma
r_sizeof
(paren
id|filter
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|wl3501_ethtool_ioctl
r_static
r_inline
r_int
id|wl3501_ethtool_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|uaddr
)paren
(brace
id|u32
id|ethcmd
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ethcmd
comma
id|uaddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
dot
id|cmd
op_assign
id|ETHTOOL_GDRVINFO
comma
)brace
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.driver
comma
id|wl3501_dev_info
comma
r_sizeof
(paren
id|info.driver
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|copy_to_user
c_func
(paren
id|uaddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|1
suffix:semicolon
)brace
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_ioctl - Perform IOCTL call functions&n; * @dev - network device&n; * @ifreq - request&n; * @cmd - command&n; *&n; * Perform IOCTL call functions here. Some are privileged operations and the&n; * effective uid is checked in those cases.&n; *&n; * This part is optional. Needed only if you want to run wlu (unix version).&n; *&n; * CAUTION: To prevent interrupted by wl3501_interrupt() and timer-based&n; * wl3501_hard_start_xmit() from other interrupts, this should be run&n; * single-threaded.&n; */
DECL|function|wl3501_ioctl
r_static
r_int
id|wl3501_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
id|rc
op_assign
id|wl3501_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
multiline_comment|/* FIXME: has to go to the private stuff in iw_handler_def */
multiline_comment|/*&n;&t; * Private IOCTLs&n;&t; */
r_case
id|WL3501_IOCTL_CMD_SET_RESET
suffix:colon
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_break
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_IOCTL_CMD_WRITE_FLASH
suffix:colon
(brace
r_int
r_char
id|bf
(braket
l_int|1028
)braket
suffix:semicolon
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EFBIG
suffix:semicolon
r_if
c_cond
(paren
id|blk-&gt;len
OG
r_sizeof
(paren
id|bf
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|bf
comma
id|blk-&gt;data
comma
id|blk-&gt;len
)paren
)paren
r_break
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|wl3501_write_flash
c_func
(paren
id|this
comma
id|bf
comma
id|blk-&gt;len
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|WL3501_IOCTL_CMD_GET_PARAMETER
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|parm.def_chan
op_assign
id|this-&gt;def_chan
suffix:semicolon
id|parm.chan
op_assign
id|this-&gt;chan
suffix:semicolon
id|parm.net_type
op_assign
id|this-&gt;net_type
suffix:semicolon
id|parm.version
(braket
l_int|0
)braket
op_assign
id|this-&gt;version
(braket
l_int|0
)braket
suffix:semicolon
id|parm.version
(braket
l_int|1
)braket
op_assign
id|this-&gt;version
(braket
l_int|1
)braket
suffix:semicolon
id|parm.freq_domain
op_assign
id|this-&gt;freq_domain
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|parm.keep_essid
(braket
l_int|0
)braket
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;keep_essid
(braket
l_int|0
)braket
)paren
comma
l_int|34
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|parm.essid
(braket
l_int|0
)braket
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;essid
(braket
l_int|0
)braket
)paren
comma
l_int|34
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|blk-&gt;len
op_assign
r_sizeof
(paren
id|parm
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|blk-&gt;data
comma
op_amp
id|parm
comma
id|blk-&gt;len
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WL3501_IOCTL_CMD_SET_PARAMETER
suffix:colon
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|parm
comma
id|blk-&gt;data
comma
r_sizeof
(paren
id|parm
)paren
)paren
)paren
r_break
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|this-&gt;def_chan
op_assign
id|parm.def_chan
suffix:semicolon
id|this-&gt;net_type
op_assign
id|parm.net_type
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
(paren
id|this-&gt;essid
(braket
l_int|0
)braket
)paren
comma
(paren
r_char
op_star
)paren
op_amp
(paren
id|parm.essid
(braket
l_int|0
)braket
)paren
comma
l_int|34
)paren
suffix:semicolon
id|rc
op_assign
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_detach - deletes a driver &quot;instance&quot;&n; * @link - FILL_IN&n; *&n; * This deletes a driver &quot;instance&quot;. The device is de-registered with Card&n; * Services. If it has been released, all local data structures are freed.&n; * Otherwise, the structures will be freed when the device is released.&n; */
DECL|function|wl3501_detach
r_static
r_void
id|wl3501_detach
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|dev_link_t
op_star
op_star
id|linkp
suffix:semicolon
multiline_comment|/* Locate device structure */
r_for
c_loop
(paren
id|linkp
op_assign
op_amp
id|wl3501_dev_list
suffix:semicolon
op_star
id|linkp
suffix:semicolon
id|linkp
op_assign
op_amp
(paren
op_star
id|linkp
)paren
op_member_access_from_pointer
id|next
)paren
r_if
c_cond
(paren
op_star
id|linkp
op_eq
id|link
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|linkp
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* If the device is currently configured and active, we won&squot;t actually&n;&t; * delete it yet.  Instead, it is marked so that when the release()&n;&t; * function is called, that will trigger a proper detach(). */
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
macro_line|#ifdef PCMCIA_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;wl3501_cs: detach postponed, &squot;%s&squot; &quot;
l_string|&quot;still locked&bslash;n&quot;
comma
id|link-&gt;dev-&gt;dev_name
)paren
suffix:semicolon
macro_line|#endif
id|link-&gt;state
op_or_assign
id|DEV_STALE_LINK
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Break the link with Card Services */
r_if
c_cond
(paren
id|link-&gt;handle
)paren
id|CardServices
c_func
(paren
id|DeregisterClient
comma
id|link-&gt;handle
)paren
suffix:semicolon
multiline_comment|/* Unlink device structure, free pieces */
op_star
id|linkp
op_assign
id|link-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;priv
)paren
id|kfree
c_func
(paren
id|link-&gt;priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|link
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_flush_stale_links - Remove zombie instances&n; *&n; * Remove zombie instances (card removed, detach pending)&n; */
DECL|function|wl3501_flush_stale_links
r_static
r_void
id|wl3501_flush_stale_links
c_func
(paren
r_void
)paren
(brace
id|dev_link_t
op_star
id|link
comma
op_star
id|next
suffix:semicolon
r_for
c_loop
(paren
id|link
op_assign
id|wl3501_dev_list
suffix:semicolon
id|link
suffix:semicolon
id|link
op_assign
id|next
)paren
(brace
id|next
op_assign
id|link-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_STALE_LINK
)paren
id|wl3501_detach
c_func
(paren
id|link
)paren
suffix:semicolon
)brace
)brace
DECL|function|wl3501_get_name
r_static
r_int
id|wl3501_get_name
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
id|strlcpy
c_func
(paren
id|wrqu-&gt;name
comma
l_string|&quot;IEEE 802.11-FH&quot;
comma
r_sizeof
(paren
id|wrqu-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_freq
r_static
r_int
id|wl3501_get_freq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|f
op_assign
id|this-&gt;chan
suffix:semicolon
id|wrqu-&gt;freq.m
op_assign
id|f
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: bss_basic_rate_set=%-10.10s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|this-&gt;bss_set
(braket
id|f
)braket
dot
id|bss_basic_rate_set
)paren
suffix:semicolon
id|wrqu-&gt;freq.e
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_mode
r_static
r_int
id|wl3501_set_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;mode
op_eq
id|IW_MODE_INFRA
op_logical_or
id|wrqu-&gt;mode
op_eq
id|IW_MODE_ADHOC
op_logical_or
id|wrqu-&gt;mode
op_eq
id|IW_MODE_AUTO
)paren
(brace
id|this-&gt;net_type
op_assign
id|wrqu-&gt;mode
suffix:semicolon
id|rc
op_assign
id|wl3501_mgmt_start
c_func
(paren
id|this
)paren
suffix:semicolon
)brace
r_else
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_mode
r_static
r_int
id|wl3501_get_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;mode
op_assign
id|this-&gt;net_type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_sens
r_static
r_int
id|wl3501_get_sens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;sens.value
op_assign
id|this-&gt;rssi
suffix:semicolon
id|wrqu-&gt;sens.disabled
op_assign
op_logical_neg
id|wrqu-&gt;sens.value
suffix:semicolon
id|wrqu-&gt;sens.fixed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_range
r_static
r_int
id|wl3501_get_range
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|iw_range
op_star
id|range
op_assign
(paren
r_struct
id|iw_range
op_star
)paren
id|extra
suffix:semicolon
multiline_comment|/* Set the length (very important for backward compatibility) */
id|wrqu-&gt;data.length
op_assign
r_sizeof
(paren
op_star
id|range
)paren
suffix:semicolon
multiline_comment|/* Set all the info we don&squot;t care or don&squot;t know about to zero */
id|memset
c_func
(paren
id|range
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|range
)paren
)paren
suffix:semicolon
multiline_comment|/* Set the Wireless Extension versions */
id|range-&gt;we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range-&gt;we_version_source
op_assign
l_int|1
suffix:semicolon
id|range-&gt;throughput
op_assign
l_int|2
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ~2 Mb/s */
multiline_comment|/* FIXME: study the code to fill in more fields... */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_wap
r_static
r_int
id|wl3501_set_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_static
r_const
r_int
r_char
id|bcast
(braket
id|ETH_ALEN
)braket
op_assign
(brace
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
comma
l_int|255
)brace
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: we support other ARPHRDs...*/
r_if
c_cond
(paren
id|wrqu-&gt;ap_addr.sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|bcast
comma
id|wrqu-&gt;ap_addr.sa_data
comma
id|ETH_ALEN
)paren
)paren
(brace
multiline_comment|/* FIXME: rescan? */
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|this-&gt;bssid
comma
id|wrqu-&gt;ap_addr.sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* FIXME: rescan? deassoc &amp; scan? */
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|wl3501_get_wap
r_static
r_int
id|wl3501_get_wap
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|wrqu-&gt;ap_addr.sa_family
op_assign
id|this-&gt;ether_type
suffix:semicolon
id|memcpy
c_func
(paren
id|wrqu-&gt;ap_addr.sa_data
comma
op_amp
id|this-&gt;bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_essid
r_static
r_int
id|wl3501_set_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;data.flags
)paren
id|strlcpy
c_func
(paren
id|this-&gt;essid
comma
id|extra
comma
id|min_t
c_func
(paren
id|u16
comma
id|wrqu-&gt;data.length
comma
id|IW_ESSID_MAX_SIZE
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_essid
r_static
r_int
id|wl3501_get_essid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrqu-&gt;essid.flags
op_assign
l_int|1
suffix:semicolon
id|wrqu-&gt;essid.length
op_assign
id|IW_ESSID_MAX_SIZE
suffix:semicolon
id|strlcpy
c_func
(paren
id|extra
comma
id|this-&gt;essid
comma
id|IW_ESSID_MAX_SIZE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|this-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_set_nick
r_static
r_int
id|wl3501_set_nick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|wrqu-&gt;data.length
OG
r_sizeof
(paren
id|this-&gt;nick
)paren
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|strlcpy
c_func
(paren
id|this-&gt;nick
comma
id|extra
comma
id|wrqu-&gt;data.length
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_get_nick
r_static
r_int
id|wl3501_get_nick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|wrqu
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|wl3501_card
op_star
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|strlcpy
c_func
(paren
id|extra
comma
id|this-&gt;nick
comma
l_int|32
)paren
suffix:semicolon
id|wrqu-&gt;data.length
op_assign
id|strlen
c_func
(paren
id|extra
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|wl3501_handler
r_static
r_const
id|iw_handler
id|wl3501_handler
(braket
)braket
op_assign
(brace
(braket
id|SIOCGIWNAME
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_name
comma
singleline_comment|//[SIOCSIWFREQ&t;- SIOCSIWCOMMIT] = wl3501_set_freq,
(braket
id|SIOCGIWFREQ
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_freq
comma
(braket
id|SIOCSIWMODE
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_set_mode
comma
(braket
id|SIOCGIWMODE
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_mode
comma
(braket
id|SIOCGIWSENS
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_sens
comma
(braket
id|SIOCGIWRANGE
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_range
comma
(braket
id|SIOCSIWSPY
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|iw_handler_set_spy
comma
(braket
id|SIOCGIWSPY
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|iw_handler_get_spy
comma
(braket
id|SIOCSIWTHRSPY
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|iw_handler_set_thrspy
comma
(braket
id|SIOCGIWTHRSPY
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|iw_handler_get_thrspy
comma
(braket
id|SIOCSIWAP
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_set_wap
comma
(braket
id|SIOCGIWAP
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_wap
comma
(braket
id|SIOCSIWESSID
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_set_essid
comma
(braket
id|SIOCGIWESSID
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_essid
comma
(braket
id|SIOCSIWNICKN
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_set_nick
comma
(braket
id|SIOCGIWNICKN
op_minus
id|SIOCSIWCOMMIT
)braket
op_assign
id|wl3501_get_nick
comma
)brace
suffix:semicolon
DECL|variable|wl3501_handler_def
r_static
r_const
r_struct
id|iw_handler_def
id|wl3501_handler_def
op_assign
(brace
dot
id|num_standard
op_assign
r_sizeof
(paren
id|wl3501_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|standard
op_assign
(paren
id|iw_handler
op_star
)paren
id|wl3501_handler
comma
dot
id|spy_offset
op_assign
m_offsetof
(paren
r_struct
id|wl3501_card
comma
id|spy_data
)paren
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * wl3501_attach - creates an &quot;instance&quot; of the driver&n; *&n; * Creates an &quot;instance&quot; of the driver, allocating local data structures for&n; * one device.  The device is registered with Card Services.&n; *&n; * The dev_link structure is initialized, but we don&squot;t actually configure the&n; * card at this point -- we wait until we receive a card insertion event.&n; */
DECL|function|wl3501_attach
r_static
id|dev_link_t
op_star
id|wl3501_attach
c_func
(paren
r_void
)paren
(brace
id|client_reg_t
id|client_reg
suffix:semicolon
id|dev_link_t
op_star
id|link
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|ret
comma
id|i
suffix:semicolon
id|wl3501_flush_stale_links
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialize the dev_link_t structure */
id|link
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|link
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|link
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|link
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dev_link_t
)paren
)paren
suffix:semicolon
id|link-&gt;release.function
op_assign
id|wl3501_release
suffix:semicolon
id|link-&gt;release.data
op_assign
(paren
r_int
r_int
)paren
id|link
suffix:semicolon
multiline_comment|/* The io structure describes IO port mapping */
id|link-&gt;io.NumPorts1
op_assign
l_int|16
suffix:semicolon
id|link-&gt;io.Attributes1
op_assign
id|IO_DATA_PATH_WIDTH_8
suffix:semicolon
id|link-&gt;io.IOAddrLines
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* Interrupt setup */
id|link-&gt;irq.Attributes
op_assign
id|IRQ_TYPE_EXCLUSIVE
op_or
id|IRQ_HANDLE_PRESENT
suffix:semicolon
id|link-&gt;irq.IRQInfo1
op_assign
id|IRQ_INFO2_VALID
op_or
id|IRQ_LEVEL_ID
suffix:semicolon
id|link-&gt;irq.IRQInfo2
op_assign
id|wl3501_irq_mask
suffix:semicolon
r_if
c_cond
(paren
id|wl3501_irq_list
(braket
l_int|0
)braket
op_eq
op_minus
l_int|1
)paren
id|link-&gt;irq.IRQInfo2
op_assign
id|wl3501_irq_mask
suffix:semicolon
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|link-&gt;irq.IRQInfo2
op_or_assign
l_int|1
op_lshift
id|wl3501_irq_list
(braket
id|i
)braket
suffix:semicolon
id|link-&gt;irq.Handler
op_assign
id|wl3501_interrupt
suffix:semicolon
multiline_comment|/* General socket configuration */
id|link-&gt;conf.Attributes
op_assign
id|CONF_ENABLE_IRQ
suffix:semicolon
id|link-&gt;conf.Vcc
op_assign
l_int|50
suffix:semicolon
id|link-&gt;conf.IntType
op_assign
id|INT_MEMORY_AND_IO
suffix:semicolon
id|link-&gt;conf.ConfigIndex
op_assign
l_int|1
suffix:semicolon
id|link-&gt;conf.Present
op_assign
id|PRESENT_OPTION
suffix:semicolon
multiline_comment|/* Allocate space for private device-specific data */
id|dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|dev
)paren
op_plus
r_sizeof
(paren
r_struct
id|wl3501_card
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out_link
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|dev
)paren
op_plus
r_sizeof
(paren
r_struct
id|wl3501_card
)paren
)paren
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|dev
op_plus
l_int|1
suffix:semicolon
id|dev-&gt;init
op_assign
id|wl3501_init
suffix:semicolon
id|dev-&gt;open
op_assign
id|wl3501_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|wl3501_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|wl3501_hard_start_xmit
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|wl3501_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|wl3501_get_stats
suffix:semicolon
id|dev-&gt;get_wireless_stats
op_assign
id|wl3501_get_wireless_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|wl3501_set_multicast_list
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|wl3501_ioctl
suffix:semicolon
id|dev-&gt;wireless_handlers
op_assign
(paren
r_struct
id|iw_handler_def
op_star
)paren
op_amp
id|wl3501_handler_def
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;priv
op_assign
id|link-&gt;irq.Instance
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Register with Card Services */
id|link-&gt;next
op_assign
id|wl3501_dev_list
suffix:semicolon
id|wl3501_dev_list
op_assign
id|link
suffix:semicolon
id|client_reg.dev_info
op_assign
op_amp
id|wl3501_dev_info
suffix:semicolon
id|client_reg.Attributes
op_assign
id|INFO_IO_CLIENT
op_or
id|INFO_CARD_SHARE
suffix:semicolon
id|client_reg.EventMask
op_assign
id|CS_EVENT_CARD_INSERTION
op_or
id|CS_EVENT_RESET_PHYSICAL
op_or
id|CS_EVENT_CARD_RESET
op_or
id|CS_EVENT_CARD_REMOVAL
op_or
id|CS_EVENT_PM_SUSPEND
op_or
id|CS_EVENT_PM_RESUME
suffix:semicolon
id|client_reg.event_handler
op_assign
id|wl3501_event
suffix:semicolon
id|client_reg.Version
op_assign
l_int|0x0210
suffix:semicolon
id|client_reg.event_callback_args.client_data
op_assign
id|link
suffix:semicolon
id|ret
op_assign
id|CardServices
c_func
(paren
id|RegisterClient
comma
op_amp
id|link-&gt;handle
comma
op_amp
id|client_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|RegisterClient
comma
id|ret
)paren
suffix:semicolon
id|wl3501_detach
c_func
(paren
id|link
)paren
suffix:semicolon
id|link
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|link
suffix:semicolon
id|out_link
suffix:colon
id|kfree
c_func
(paren
id|link
)paren
suffix:semicolon
id|link
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|macro|CS_CHECK
mdefine_line|#define CS_CHECK(fn, args...) &bslash;&n;while ((last_ret = CardServices(last_fn = (fn), args)) != 0) goto cs_failed
multiline_comment|/**&n; * wl3501_config - configure the PCMCIA socket and make eth device available&n; * @link - FILL_IN&n; *&n; * wl3501_config() is scheduled to run after a CARD_INSERTION event is&n; * received, to configure the PCMCIA socket, and to make the ethernet device&n; * available to the system.&n; */
DECL|function|wl3501_config
r_static
r_void
id|wl3501_config
c_func
(paren
id|dev_link_t
op_star
id|link
)paren
(brace
id|tuple_t
id|tuple
suffix:semicolon
id|cisparse_t
id|parse
suffix:semicolon
id|client_handle_t
id|handle
op_assign
id|link-&gt;handle
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|j
comma
id|last_fn
comma
id|last_ret
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|64
)braket
suffix:semicolon
r_struct
id|wl3501_card
op_star
id|this
suffix:semicolon
multiline_comment|/* This reads the card&squot;s CONFIG tuple to find its config registers. */
id|tuple.Attributes
op_assign
l_int|0
suffix:semicolon
id|tuple.DesiredTuple
op_assign
id|CISTPL_CONFIG
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetFirstTuple
comma
id|handle
comma
op_amp
id|tuple
)paren
suffix:semicolon
id|tuple.TupleData
op_assign
id|buf
suffix:semicolon
id|tuple.TupleDataMax
op_assign
l_int|64
suffix:semicolon
id|tuple.TupleOffset
op_assign
l_int|0
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|GetTupleData
comma
id|handle
comma
op_amp
id|tuple
)paren
suffix:semicolon
id|CS_CHECK
c_func
(paren
id|ParseTuple
comma
id|handle
comma
op_amp
id|tuple
comma
op_amp
id|parse
)paren
suffix:semicolon
id|link-&gt;conf.ConfigBase
op_assign
id|parse.config.base
suffix:semicolon
id|link-&gt;conf.Present
op_assign
id|parse.config.rmask
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Configure card */
id|link-&gt;state
op_or_assign
id|DEV_CONFIG
suffix:semicolon
multiline_comment|/* Try allocating IO ports.  This tries a few fixed addresses.  If you&n;&t; * want, you can also read the card&squot;s config table to pick addresses --&n;&t; * see the serial driver for an example. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0x280
suffix:semicolon
id|j
OL
l_int|0x400
suffix:semicolon
id|j
op_add_assign
l_int|0x20
)paren
(brace
multiline_comment|/* The &squot;^0x300&squot; is so that we probe 0x300-0x3ff first, then&n;&t;&t; * 0x200-0x2ff, and so on, because this seems safer */
id|link-&gt;io.BasePort1
op_assign
id|j
suffix:semicolon
id|link-&gt;io.BasePort2
op_assign
id|link-&gt;io.BasePort1
op_plus
l_int|0x10
suffix:semicolon
id|i
op_assign
id|CardServices
c_func
(paren
id|RequestIO
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|CS_SUCCESS
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
id|CS_SUCCESS
)paren
(brace
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|RequestIO
comma
id|i
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* Now allocate an interrupt line. Note that this does not actually&n;&t; * assign a handler to the interrupt. */
id|CS_CHECK
c_func
(paren
id|RequestIRQ
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* This actually configures the PCMCIA socket -- setting up the I/O&n;&t; * windows and the interrupt mapping.  */
id|CS_CHECK
c_func
(paren
id|RequestConfiguration
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;conf
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|link-&gt;irq.AssignedIRQ
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|link-&gt;io.BasePort1
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;wl3501_cs: register_netdev() failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* At this point, the dev_node_t structure(s) should be initialized and&n;&t; * arranged in a linked list at link-&gt;dev. */
id|link-&gt;dev
op_assign
op_amp
(paren
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|node
suffix:semicolon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG_PENDING
suffix:semicolon
id|this
op_assign
(paren
r_struct
id|wl3501_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|this-&gt;base_addr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wl3501_get_flash_mac_addr
c_func
(paren
id|this
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Cant read MAC addr in flash ROM?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|this-&gt;node.dev_name
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* print probe information */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: wl3501 @ 0x%3.3x, IRQ %d, MAC addr in flash ROM:&quot;
comma
id|dev-&gt;name
comma
id|this-&gt;base_addr
comma
(paren
r_int
)paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
(paren
(paren
r_char
op_star
)paren
op_amp
id|this-&gt;mac_addr
)paren
(braket
id|i
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%c%02x&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* initialize card parameter - added by jss */
id|this-&gt;net_type
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|this-&gt;llc_type
op_assign
l_int|1
suffix:semicolon
id|this-&gt;def_chan
op_assign
l_int|1
suffix:semicolon
id|this-&gt;bss_cnt
op_assign
l_int|0
suffix:semicolon
id|this-&gt;join_sta_bss
op_assign
l_int|0
suffix:semicolon
id|this-&gt;adhoc_times
op_assign
l_int|0
suffix:semicolon
id|this-&gt;driver_state
op_assign
l_int|0
suffix:semicolon
id|this-&gt;essid
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|this-&gt;essid
(braket
l_int|1
)braket
op_assign
l_int|3
suffix:semicolon
id|this-&gt;essid
(braket
l_int|2
)braket
op_assign
l_char|&squot;A&squot;
suffix:semicolon
id|this-&gt;essid
(braket
l_int|3
)braket
op_assign
l_char|&squot;N&squot;
suffix:semicolon
id|this-&gt;essid
(braket
l_int|4
)braket
op_assign
l_char|&squot;Y&squot;
suffix:semicolon
id|strlcpy
c_func
(paren
id|this-&gt;nick
comma
l_string|&quot;Planet WL3501&quot;
comma
r_sizeof
(paren
id|this-&gt;nick
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|this-&gt;lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|this-&gt;freq_domain
)paren
(brace
r_case
l_int|0x31
suffix:colon
r_case
l_int|0x32
suffix:colon
id|this-&gt;def_chan
op_assign
l_int|10
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x40
suffix:colon
id|this-&gt;def_chan
op_assign
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x10
suffix:colon
r_case
l_int|0x20
suffix:colon
r_case
l_int|0x30
suffix:colon
r_default
suffix:colon
id|this-&gt;def_chan
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|cs_failed
suffix:colon
id|cs_error
c_func
(paren
id|link-&gt;handle
comma
id|last_fn
comma
id|last_ret
)paren
suffix:semicolon
id|failed
suffix:colon
id|wl3501_release
c_func
(paren
(paren
r_int
r_int
)paren
id|link
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_release - unregister the net, release PCMCIA configuration&n; * @arg - FILL_IN&n; *&n; * After a card is removed, wl3501_release() will unregister the net device,&n; * and release the PCMCIA configuration.  If the device is still open, this&n; * will be postponed until it is closed.&n; */
DECL|function|wl3501_release
r_static
r_void
id|wl3501_release
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
id|dev_link_t
op_star
id|link
op_assign
(paren
id|dev_link_t
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
multiline_comment|/* If the device is currently in use, we won&squot;t release until it is&n;&t; * actually closed. */
r_if
c_cond
(paren
id|link-&gt;open
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;release postponed, &squot;%s&squot; still open&quot;
comma
id|link-&gt;dev-&gt;dev_name
)paren
suffix:semicolon
id|link-&gt;state
op_or_assign
id|DEV_STALE_CONFIG
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Unlink the device chain */
r_if
c_cond
(paren
id|link-&gt;dev
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Don&squot;t bother checking to see if these succeed or not */
id|CardServices
c_func
(paren
id|ReleaseConfiguration
comma
id|link-&gt;handle
)paren
suffix:semicolon
id|CardServices
c_func
(paren
id|ReleaseIO
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;io
)paren
suffix:semicolon
id|CardServices
c_func
(paren
id|ReleaseIRQ
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;irq
)paren
suffix:semicolon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_CONFIG
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_STALE_LINK
)paren
id|wl3501_detach
c_func
(paren
id|link
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * wl3501_event - The card status event handler&n; * @event - event&n; * @pri - priority&n; * @args - arguments for this event&n; *&n; * The card status event handler. Mostly, this schedules other stuff to run&n; * after an event is received. A CARD_REMOVAL event also sets some flags to&n; * discourage the net drivers from trying to talk to the card any more.&n; *&n; * When a CARD_REMOVAL event is received, we immediately set a flag to block&n; * future accesses to this device. All the functions that actually access the&n; * device should check this flag to make sure the card is still present.&n; */
DECL|function|wl3501_event
r_static
r_int
id|wl3501_event
c_func
(paren
id|event_t
id|event
comma
r_int
id|pri
comma
id|event_callback_args_t
op_star
id|args
)paren
(brace
id|dev_link_t
op_star
id|link
op_assign
id|args-&gt;client_data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|link-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|CS_EVENT_CARD_REMOVAL
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_PRESENT
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|link-&gt;release.expires
op_assign
id|jiffies
op_plus
id|WL3501_RELEASE_TIMEOUT
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|link-&gt;release
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CS_EVENT_CARD_INSERTION
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_PRESENT
op_or
id|DEV_CONFIG_PENDING
suffix:semicolon
id|wl3501_config
c_func
(paren
id|link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_SUSPEND
suffix:colon
id|link-&gt;state
op_or_assign
id|DEV_SUSPEND
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_RESET_PHYSICAL
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
r_if
c_cond
(paren
id|link-&gt;open
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|CardServices
c_func
(paren
id|ReleaseConfiguration
comma
id|link-&gt;handle
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CS_EVENT_PM_RESUME
suffix:colon
id|link-&gt;state
op_and_assign
op_complement
id|DEV_SUSPEND
suffix:semicolon
multiline_comment|/* Fall through... */
r_case
id|CS_EVENT_CARD_RESET
suffix:colon
r_if
c_cond
(paren
id|link-&gt;state
op_amp
id|DEV_CONFIG
)paren
(brace
id|CardServices
c_func
(paren
id|RequestConfiguration
comma
id|link-&gt;handle
comma
op_amp
id|link-&gt;conf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;open
)paren
id|wl3501_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|wl3501_driver
r_static
r_struct
id|pcmcia_driver
id|wl3501_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|drv
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;wl3501_cs&quot;
comma
)brace
comma
dot
id|attach
op_assign
id|wl3501_attach
comma
dot
id|detach
op_assign
id|wl3501_detach
comma
)brace
suffix:semicolon
DECL|function|wl3501_init_module
r_static
r_int
id|__init
id|wl3501_init_module
c_func
(paren
r_void
)paren
(brace
id|servinfo_t
id|serv
suffix:semicolon
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;: loading&quot;
)paren
suffix:semicolon
id|CardServices
c_func
(paren
id|GetCardServicesInfo
comma
op_amp
id|serv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|serv.Revision
op_ne
id|CS_RELEASE_CODE
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;wl3501_cs: Card Services release does not match!&bslash;n&quot;
l_string|&quot;Compiled with 0x%x, but current is 0x%lx&bslash;n&quot;
comma
id|CS_RELEASE_CODE
comma
(paren
r_int
r_int
)paren
id|serv.Revision
)paren
suffix:semicolon
multiline_comment|/* return -1; */
)brace
id|pcmcia_register_driver
c_func
(paren
op_amp
id|wl3501_driver
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wl3501_exit_module
r_static
r_void
id|__exit
id|wl3501_exit_module
c_func
(paren
r_void
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;: unloading&quot;
)paren
suffix:semicolon
id|pcmcia_unregister_driver
c_func
(paren
op_amp
id|wl3501_driver
)paren
suffix:semicolon
r_while
c_loop
(paren
id|wl3501_dev_list
)paren
(brace
r_if
c_cond
(paren
id|wl3501_dev_list-&gt;state
op_amp
id|DEV_CONFIG
)paren
id|wl3501_release
c_func
(paren
(paren
r_int
r_int
)paren
id|wl3501_dev_list
)paren
suffix:semicolon
id|wl3501_detach
c_func
(paren
id|wl3501_dev_list
)paren
suffix:semicolon
)brace
)brace
DECL|variable|wl3501_init_module
id|module_init
c_func
(paren
id|wl3501_init_module
)paren
suffix:semicolon
DECL|variable|wl3501_exit_module
id|module_exit
c_func
(paren
id|wl3501_exit_module
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|wl3501_irq_mask
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|wl3501_irq_list
comma
l_string|&quot;1-4i&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Fox Chen &lt;mhchen@golf.ccl.itri.org.tw&gt;, &quot;
l_string|&quot;Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;,&quot;
l_string|&quot;Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Planet wl3501 wireless driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
