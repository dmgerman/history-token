multiline_comment|/*  $Header: /var/lib/cvs/prism54-ng/ksrc/islpci_hotplug.c,v 1.56 2004/02/26 23:33:02 mcgrof Exp $&n; *  &n; *  Copyright (C) 2002 Intersil Americas Inc.&n; *  Copyright (C) 2003 Herbert Valerio Riedel &lt;hvr@gnu.org&gt;&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt; /* For __init, __exit */
macro_line|#include &quot;islpci_dev.h&quot;
macro_line|#include &quot;islpci_mgt.h&quot;&t;&t;/* for pc_debug */
macro_line|#include &quot;isl_oid.h&quot;
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;prism54&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.1&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;[Intersil] R.Bastings and W.Termorshuizen, The prism54.org Development Team &lt;prism54-devel@prism54.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;The Prism54 802.11 Wireless LAN adapter&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* In this order: vendor, device, subvendor, subdevice, class, class_mask,&n; * driver_data &n; * Note: for driver_data we put the device&squot;s name &n; * If you have an update for this please contact prism54-devel@prism54.org &n; * The latest list can be found at http://prism54.org/supported_cards.php */
DECL|variable|prism54_id_tbl
r_static
r_const
r_struct
id|pci_device_id
id|prism54_id_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCIVENDOR_3COM
comma
id|PCIDEVICE_3COM6001
comma
id|PCIVENDOR_3COM
comma
id|PCIDEVICE_3COM6001
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;3COM 3CRWE154G72 Wireless LAN adapter&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_DLINK
comma
l_int|0x3202UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;D-Link Air Plus Xtreme G A1 - DWL-g650 A1&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_IODATA
comma
l_int|0xd019UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;I-O Data WN-G54/CB - WN-G54/CB&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_NETGEAR
comma
l_int|0x4800UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;Netgear WG511&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_I4
comma
l_int|0x0020UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;PLANEX GW-DS54G&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_SMC
comma
l_int|0x2802UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;EZ Connect g 2.4GHz 54 Mbps Wireless PCI Card - SMC2802W&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_SMC
comma
l_int|0x2835UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;EZ Connect g 2.4GHz 54 Mbps Wireless Cardbus Adapter - SMC2835W&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_INTERSIL
comma
l_int|0x0000UL
comma
multiline_comment|/* This was probably a bogus reading... */
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;SparkLAN WL-850F&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_I4
comma
l_int|0x0014UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;I4 Z-Com XG-600&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_I4
comma
l_int|0x0020UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;I4 Z-Com XG-900/PLANEX GW-DS54G&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_ACCTON
comma
l_int|0xee03UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;SMC 2802Wv2&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCIVENDOR_SMC
comma
l_int|0xa835UL
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;SMC 2835Wv2&quot;
)brace
comma
(brace
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3877
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;Intersil PRISM Indigo Wireless LAN adapter&quot;
)brace
comma
(brace
multiline_comment|/* Default */
id|PCIVENDOR_INTERSIL
comma
id|PCIDEVICE_ISL3890
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
(paren
r_int
r_int
)paren
l_string|&quot;Intersil PRISM Duette/Prism GT Wireless LAN adapter&quot;
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* register the device with the Hotplug facilities of the kernel */
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|prism54_id_tbl
)paren
suffix:semicolon
r_static
r_int
id|prism54_probe
c_func
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_struct
id|pci_device_id
op_star
)paren
suffix:semicolon
r_static
r_void
id|prism54_remove
c_func
(paren
r_struct
id|pci_dev
op_star
)paren
suffix:semicolon
r_static
r_int
id|prism54_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
comma
id|u32
id|state
)paren
suffix:semicolon
r_static
r_int
id|prism54_resume
c_func
(paren
r_struct
id|pci_dev
op_star
)paren
suffix:semicolon
DECL|variable|prism54_driver
r_static
r_struct
id|pci_driver
id|prism54_driver
op_assign
(brace
dot
id|name
op_assign
id|DRV_NAME
comma
dot
id|id_table
op_assign
id|prism54_id_tbl
comma
dot
id|probe
op_assign
id|prism54_probe
comma
dot
id|remove
op_assign
id|prism54_remove
comma
dot
id|suspend
op_assign
id|prism54_suspend
comma
dot
id|resume
op_assign
id|prism54_resume
comma
multiline_comment|/* .enable_wake ; we don&squot;t support this yet */
)brace
suffix:semicolon
r_static
r_void
DECL|function|prism54_get_card_model
id|prism54_get_card_model
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|islpci_private
op_star
id|priv
suffix:semicolon
r_char
op_star
id|modelp
suffix:semicolon
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;pdev-&gt;subsystem_device
)paren
(brace
r_case
id|PCIDEVICE_ISL3877
suffix:colon
id|modelp
op_assign
l_string|&quot;PRISM Indigo&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCIDEVICE_3COM6001
suffix:colon
id|modelp
op_assign
l_string|&quot;3COM 3CRWE154G72&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3202UL
suffix:colon
id|modelp
op_assign
l_string|&quot;D-Link DWL-g650 A1&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd019UL
suffix:colon
id|modelp
op_assign
l_string|&quot;WN-G54/CB&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x4800UL
suffix:colon
id|modelp
op_assign
l_string|&quot;Netgear WG511&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2802UL
suffix:colon
id|modelp
op_assign
l_string|&quot;SMC2802W&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xee03UL
suffix:colon
id|modelp
op_assign
l_string|&quot;SMC2802W V2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2835UL
suffix:colon
id|modelp
op_assign
l_string|&quot;SMC2835W&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xa835UL
suffix:colon
id|modelp
op_assign
l_string|&quot;SMC2835W V2&quot;
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Let&squot;s leave this one out for now since it seems bogus/wrong &n;&t; * Even if the manufacturer did use 0x0000UL it may not be correct&n;&t; * by their part, therefore deserving no name ;) */
multiline_comment|/*      case 0x0000UL: &n;&t; *              modelp = &quot;SparkLAN WL-850F&quot;;&n;&t; *              break;*/
multiline_comment|/* We have two reported for the one below :( */
r_case
l_int|0x0014UL
suffix:colon
id|modelp
op_assign
l_string|&quot;XG-600&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0020UL
suffix:colon
id|modelp
op_assign
l_string|&quot;XG-900/GW-DS54G&quot;
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Default it */
multiline_comment|/*&n;&t;case PCIDEVICE_ISL3890:&n;&t;&t;modelp = &quot;PRISM Duette/GT&quot;;&n;&t;&t;break;&n;*/
r_default
suffix:colon
id|modelp
op_assign
l_string|&quot;PRISM Duette/GT&quot;
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s driver detected card model: %s&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|DRV_NAME
comma
id|modelp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n;    Module initialization functions&n;******************************************************************************/
r_int
DECL|function|prism54_probe
id|prism54_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
suffix:semicolon
id|u8
id|latency_tmr
suffix:semicolon
id|u32
id|mem_addr
suffix:semicolon
id|islpci_private
op_star
id|priv
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
multiline_comment|/* TRACE(DRV_NAME); */
multiline_comment|/* Enable the pci device */
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: pci_enable_device() failed.&bslash;n&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* check whether the latency timer is set correctly */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|latency_tmr
)paren
suffix:semicolon
macro_line|#if VERBOSE &gt; SHOW_ERROR_MESSAGES
id|DEBUG
c_func
(paren
id|SHOW_TRACING
comma
l_string|&quot;latency timer: %x&bslash;n&quot;
comma
id|latency_tmr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|latency_tmr
OL
id|PCIDEVICE_LATENCY_TIMER_MIN
)paren
(brace
multiline_comment|/* set the latency timer */
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
id|PCI_LATENCY_TIMER
comma
id|PCIDEVICE_LATENCY_TIMER_VAL
)paren
suffix:semicolon
)brace
multiline_comment|/* enable PCI DMA */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
l_int|0xffffffff
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: 32-bit PCI DMA not supported&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
r_goto
id|do_pci_disable_device
suffix:semicolon
)brace
multiline_comment|/* 0x40 is the programmable timer to configure the response timeout (TRDY_TIMEOUT)&n;&t; * 0x41 is the programmable timer to configure the retry timeout (RETRY_TIMEOUT)&n;&t; * &t;The RETRY_TIMEOUT is used to set the number of retries that the core, as a&n;&t; * &t;Master, will perform before abandoning a cycle. The default value for&n;&t; * &t;RETRY_TIMEOUT is 0x80, which far exceeds the PCI 2.1 requirement for new&n;&t; * &t;devices. A write of zero to the RETRY_TIMEOUT register disables this&n;&t; * &t;function to allow use with any non-compliant legacy devices that may&n;&t; * &t;execute more retries.&n;&t; *&n;&t; * &t;Writing zero to both these two registers will disable both timeouts and&n;&t; * &t;*can* solve problems caused by devices that are slow to respond.&n;&t; */
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
l_int|0x40
comma
l_int|0
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
l_int|0x41
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* request the pci device I/O regions */
id|rvalue
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rvalue
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: pci_request_regions failure (rc=%d)&bslash;n&quot;
comma
id|DRV_NAME
comma
id|rvalue
)paren
suffix:semicolon
r_goto
id|do_pci_disable_device
suffix:semicolon
)brace
multiline_comment|/* check if the memory window is indeed set */
id|rvalue
op_assign
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|PCI_BASE_ADDRESS_0
comma
op_amp
id|mem_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rvalue
op_logical_or
op_logical_neg
id|mem_addr
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: PCI device memory region not configured; fix your BIOS or CardBus bridge/drivers&bslash;n&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
r_goto
id|do_pci_disable_device
suffix:semicolon
)brace
multiline_comment|/* enable PCI bus-mastering */
id|DEBUG
c_func
(paren
id|SHOW_TRACING
comma
l_string|&quot;%s: pci_set_master(pdev)&bslash;n&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* setup the network device interface and its structure */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ndev
op_assign
id|islpci_setup
c_func
(paren
id|pdev
)paren
)paren
)paren
(brace
multiline_comment|/* error configuring the driver as a network device */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: could not configure network device&bslash;n&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
r_goto
id|do_pci_release_regions
suffix:semicolon
)brace
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|islpci_set_state
c_func
(paren
id|priv
comma
id|PRV_STATE_PREBOOT
)paren
suffix:semicolon
multiline_comment|/* we are attempting to boot */
multiline_comment|/* card is in unknown state yet, might have some interrupts pending */
id|isl38xx_disable_interrupts
c_func
(paren
id|priv-&gt;device_base
)paren
suffix:semicolon
multiline_comment|/* request for the interrupt before uploading the firmware */
id|rvalue
op_assign
id|request_irq
c_func
(paren
id|pdev-&gt;irq
comma
op_amp
id|islpci_interrupt
comma
id|SA_SHIRQ
comma
id|ndev-&gt;name
comma
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rvalue
)paren
(brace
multiline_comment|/* error, could not hook the handler to the irq */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: could not install IRQ handler&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|do_unregister_netdev
suffix:semicolon
)brace
multiline_comment|/* firmware upload is triggered in islpci_open */
multiline_comment|/* Pretty card model discovery output */
id|prism54_get_card_model
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|do_unregister_netdev
suffix:colon
id|unregister_netdev
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|islpci_free_memory
c_func
(paren
id|priv
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|priv
op_assign
l_int|0
suffix:semicolon
id|do_pci_release_regions
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|do_pci_disable_device
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* set by cleanup_module */
DECL|variable|__in_cleanup_module
r_static
r_volatile
r_int
id|__in_cleanup_module
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* this one removes one(!!) instance only */
r_void
DECL|function|prism54_remove
id|prism54_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|islpci_private
op_star
id|priv
op_assign
id|ndev
ques
c_cond
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:colon
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|__in_cleanup_module
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: hot unplug detected&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|islpci_set_state
c_func
(paren
id|priv
comma
id|PRV_STATE_OFF
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: removing device&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|ndev
)paren
suffix:semicolon
multiline_comment|/* free the interrupt request */
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
op_ne
id|PRV_STATE_OFF
)paren
(brace
id|isl38xx_disable_interrupts
c_func
(paren
id|priv-&gt;device_base
)paren
suffix:semicolon
id|islpci_set_state
c_func
(paren
id|priv
comma
id|PRV_STATE_OFF
)paren
suffix:semicolon
multiline_comment|/* This bellow causes a lockup at rmmod time. It might be&n;&t;&t; * because some interrupts still linger after rmmod time, &n;&t;&t; * see bug #17 */
multiline_comment|/* pci_set_power_state(pdev, 3);*/
multiline_comment|/* try to power-off */
)brace
id|free_irq
c_func
(paren
id|pdev-&gt;irq
comma
id|priv
)paren
suffix:semicolon
multiline_comment|/* free the PCI memory and unmap the remapped page */
id|islpci_free_memory
c_func
(paren
id|priv
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|priv
op_assign
l_int|0
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_int
DECL|function|prism54_suspend
id|prism54_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|islpci_private
op_star
id|priv
op_assign
id|ndev
ques
c_cond
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:colon
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|priv
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: got suspend request (state %d)&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|state
)paren
suffix:semicolon
id|pci_save_state
c_func
(paren
id|pdev
comma
id|priv-&gt;pci_state
)paren
suffix:semicolon
multiline_comment|/* tell the device not to trigger interrupts for now... */
id|isl38xx_disable_interrupts
c_func
(paren
id|priv-&gt;device_base
)paren
suffix:semicolon
multiline_comment|/* from now on assume the hardware was already powered down&n;&t;   and don&squot;t touch it anymore */
id|islpci_set_state
c_func
(paren
id|priv
comma
id|PRV_STATE_OFF
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_resume
id|prism54_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|islpci_private
op_star
id|priv
op_assign
id|ndev
ques
c_cond
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:colon
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|priv
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: got resume request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|pci_restore_state
c_func
(paren
id|pdev
comma
id|priv-&gt;pci_state
)paren
suffix:semicolon
multiline_comment|/* alright let&squot;s go into the PREBOOT state */
id|islpci_reset
c_func
(paren
id|priv
comma
l_int|1
)paren
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|prism54_module_init
id|prism54_module_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Loaded %s driver, version %s&bslash;n&quot;
comma
id|DRV_NAME
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|__bug_on_wrong_struct_sizes
(paren
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|prism54_driver
)paren
suffix:semicolon
)brace
multiline_comment|/* by the time prism54_module_exit() terminates, as a postcondition&n; * all instances will have been destroyed by calls to&n; * prism54_remove() */
r_static
r_void
id|__exit
DECL|function|prism54_module_exit
id|prism54_module_exit
c_func
(paren
r_void
)paren
(brace
id|__in_cleanup_module
op_assign
l_int|1
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|prism54_driver
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Unloaded %s driver&bslash;n&quot;
comma
id|DRV_NAME
)paren
suffix:semicolon
id|__in_cleanup_module
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* register entry points */
DECL|variable|prism54_module_init
id|module_init
c_func
(paren
id|prism54_module_init
)paren
suffix:semicolon
DECL|variable|prism54_module_exit
id|module_exit
c_func
(paren
id|prism54_module_exit
)paren
suffix:semicolon
multiline_comment|/* EOF */
eof
