multiline_comment|/*&n; *  &n; *  Copyright (C) 2002 Intersil Americas Inc.&n; *            (C) 2003,2004 Aurelien Alleaume &lt;slts@free.fr&gt;&n; *            (C) 2003 Herbert Valerio Riedel &lt;hvr@gnu.org&gt;&n; *            (C) 2003 Luis R. Rodriguez &lt;mcgrof@ruslug.rutgers.edu&gt;&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;prismcompat.h&quot;
macro_line|#include &quot;isl_ioctl.h&quot;
macro_line|#include &quot;islpci_mgt.h&quot;
macro_line|#include &quot;isl_oid.h&quot;&t;&t;/* additional types and defs for isl38xx fw */
macro_line|#include &quot;oid_mgt.h&quot;
macro_line|#include &lt;net/iw_handler.h&gt;&t;/* New driver API */
multiline_comment|/**&n; * prism54_mib_mode_helper - MIB change mode helper function&n; * @mib: the &amp;struct islpci_mib object to modify&n; * @iw_mode: new mode (%IW_MODE_*)&n; * &n; *  This is a helper function, hence it does not lock. Make sure&n; *  caller deals with locking *if* necessary. This function sets the &n; *  mode-dependent mib values and does the mapping of the Linux &n; *  Wireless API modes to Device firmware modes. It also checks for &n; *  correct valid Linux wireless modes. &n; */
r_int
DECL|function|prism54_mib_mode_helper
id|prism54_mib_mode_helper
c_func
(paren
id|islpci_private
op_star
id|priv
comma
id|u32
id|iw_mode
)paren
(brace
id|u32
id|config
op_assign
id|INL_CONFIG_MANUALRUN
suffix:semicolon
id|u32
id|mode
comma
id|bsstype
suffix:semicolon
multiline_comment|/* For now, just catch early the Repeater and Secondary modes here */
r_if
c_cond
(paren
id|iw_mode
op_eq
id|IW_MODE_REPEAT
op_logical_or
id|iw_mode
op_eq
id|IW_MODE_SECOND
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(): Sorry, Repeater mode and Secondary mode &quot;
l_string|&quot;are not yet supported by this driver.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|priv-&gt;iw_mode
op_assign
id|iw_mode
suffix:semicolon
r_switch
c_cond
(paren
id|iw_mode
)paren
(brace
r_case
id|IW_MODE_AUTO
suffix:colon
id|mode
op_assign
id|INL_MODE_CLIENT
suffix:semicolon
id|bsstype
op_assign
id|DOT11_BSSTYPE_ANY
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_ADHOC
suffix:colon
id|mode
op_assign
id|INL_MODE_CLIENT
suffix:semicolon
id|bsstype
op_assign
id|DOT11_BSSTYPE_IBSS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_INFRA
suffix:colon
id|mode
op_assign
id|INL_MODE_CLIENT
suffix:semicolon
id|bsstype
op_assign
id|DOT11_BSSTYPE_INFRA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_MASTER
suffix:colon
id|mode
op_assign
id|INL_MODE_AP
suffix:semicolon
id|bsstype
op_assign
id|DOT11_BSSTYPE_INFRA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_MONITOR
suffix:colon
id|mode
op_assign
id|INL_MODE_PROMISCUOUS
suffix:semicolon
id|bsstype
op_assign
id|DOT11_BSSTYPE_ANY
suffix:semicolon
id|config
op_or_assign
id|INL_CONFIG_RXANNEX
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|init_wds
)paren
id|config
op_or_assign
id|INL_CONFIG_WDS
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSTYPE
comma
op_amp
id|bsstype
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|OID_INL_CONFIG
comma
op_amp
id|config
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|OID_INL_MODE
comma
op_amp
id|mode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * prism54_mib_init - fill MIB cache with defaults&n; *&n; *  this function initializes the struct given as @mib with defaults,&n; *  of which many are retrieved from the global module parameter&n; *  variables.  &n; */
r_void
DECL|function|prism54_mib_init
id|prism54_mib_init
c_func
(paren
id|islpci_private
op_star
id|priv
)paren
(brace
id|u32
id|channel
comma
id|authen
comma
id|wep
comma
id|filter
comma
id|dot1x
comma
id|mlme
comma
id|conformance
comma
id|power
comma
id|mode
suffix:semicolon
r_struct
id|obj_buffer
id|psm_buffer
op_assign
(brace
dot
id|size
op_assign
id|PSM_BUFFER_SIZE
comma
dot
id|addr
op_assign
id|priv-&gt;device_psm_buffer
)brace
suffix:semicolon
id|channel
op_assign
id|CARD_DEFAULT_CHANNEL
suffix:semicolon
id|authen
op_assign
id|CARD_DEFAULT_AUTHEN
suffix:semicolon
id|wep
op_assign
id|CARD_DEFAULT_WEP
suffix:semicolon
id|filter
op_assign
id|CARD_DEFAULT_FILTER
suffix:semicolon
multiline_comment|/* (0) Do not filter un-encrypted data */
id|dot1x
op_assign
id|CARD_DEFAULT_DOT1X
suffix:semicolon
id|mlme
op_assign
id|CARD_DEFAULT_MLME_MODE
suffix:semicolon
id|conformance
op_assign
id|CARD_DEFAULT_CONFORMANCE
suffix:semicolon
id|power
op_assign
l_int|127
suffix:semicolon
id|mode
op_assign
id|CARD_DEFAULT_IW_MODE
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_CHANNEL
comma
op_amp
id|channel
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_AUTHENABLE
comma
op_amp
id|authen
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVACYINVOKED
comma
op_amp
id|wep
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_PSMBUFFER
comma
op_amp
id|psm_buffer
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
op_amp
id|filter
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_DOT1XENABLE
comma
op_amp
id|dot1x
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_MLMEAUTOLEVEL
comma
op_amp
id|mlme
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|OID_INL_DOT11D_CONFORMANCE
comma
op_amp
id|conformance
)paren
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|OID_INL_OUTPUTPOWER
comma
op_amp
id|power
)paren
suffix:semicolon
multiline_comment|/* This sets all of the mode-dependent values */
id|prism54_mib_mode_helper
c_func
(paren
id|priv
comma
id|mode
)paren
suffix:semicolon
)brace
multiline_comment|/* this will be executed outside of atomic context thanks to&n; * schedule_work(), thus we can as well use sleeping semaphore&n; * locking */
r_void
DECL|function|prism54_update_stats
id|prism54_update_stats
c_func
(paren
id|islpci_private
op_star
id|priv
)paren
(brace
r_char
op_star
id|data
suffix:semicolon
r_int
id|j
suffix:semicolon
r_struct
id|obj_bss
id|bss
comma
op_star
id|bss2
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|priv-&gt;stats_sem
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Noise floor.&n; * I&squot;m not sure if the unit is dBm.&n; * Note : If we are not connected, this value seems to be irrelevant. */
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_NOISEFLOOR
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|priv-&gt;local_iwstatistics.qual.noise
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Get the rssi of the link. To do this we need to retrieve a bss. */
multiline_comment|/* First get the MAC address of the AP we are associated with. */
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|data
op_assign
id|r.ptr
suffix:semicolon
multiline_comment|/* copy this MAC to the bss */
id|memcpy
c_func
(paren
id|bss.address
comma
id|data
comma
l_int|6
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
multiline_comment|/* now ask for the corresponding bss */
id|j
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSFIND
comma
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|bss
comma
op_amp
id|r
)paren
suffix:semicolon
id|bss2
op_assign
id|r.ptr
suffix:semicolon
multiline_comment|/* report the rssi and use it to calculate&n;&t; *  link quality through a signal-noise&n;&t; *  ratio */
id|priv-&gt;local_iwstatistics.qual.level
op_assign
id|bss2-&gt;rssi
suffix:semicolon
id|priv-&gt;local_iwstatistics.qual.qual
op_assign
id|bss2-&gt;rssi
op_minus
id|priv-&gt;iwstatistics.qual.noise
suffix:semicolon
id|kfree
c_func
(paren
id|bss2
)paren
suffix:semicolon
multiline_comment|/* report that the stats are new */
id|priv-&gt;local_iwstatistics.qual.updated
op_assign
l_int|0x7
suffix:semicolon
multiline_comment|/* Rx : unable to decrypt the MPDU */
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVRXFAILED
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|priv-&gt;local_iwstatistics.discard.code
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Tx : Max MAC retries num reached */
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_MPDUTXFAILED
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|priv-&gt;local_iwstatistics.discard.retries
op_assign
id|r.u
suffix:semicolon
id|up
c_func
(paren
op_amp
id|priv-&gt;stats_sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_struct
id|iw_statistics
op_star
DECL|function|prism54_get_wireless_stats
id|prism54_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
multiline_comment|/* If the stats are being updated return old data */
r_if
c_cond
(paren
id|down_trylock
c_func
(paren
op_amp
id|priv-&gt;stats_sem
)paren
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|priv-&gt;iwstatistics
comma
op_amp
id|priv-&gt;local_iwstatistics
comma
r_sizeof
(paren
r_struct
id|iw_statistics
)paren
)paren
suffix:semicolon
multiline_comment|/* They won&squot;t be marked updated for the next time */
id|priv-&gt;local_iwstatistics.qual.updated
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|priv-&gt;stats_sem
)paren
suffix:semicolon
)brace
r_else
id|priv-&gt;iwstatistics.qual.updated
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Update our wireless stats, but do not schedule to often &n;&t; * (max 1 HZ) */
r_if
c_cond
(paren
(paren
id|priv-&gt;stats_timestamp
op_eq
l_int|0
)paren
op_logical_or
id|time_after
c_func
(paren
id|jiffies
comma
id|priv-&gt;stats_timestamp
op_plus
l_int|1
op_star
id|HZ
)paren
)paren
(brace
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;stats_work
)paren
suffix:semicolon
id|priv-&gt;stats_timestamp
op_assign
id|jiffies
suffix:semicolon
)brace
r_return
op_amp
id|priv-&gt;iwstatistics
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_commit
id|prism54_commit
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_char
op_star
id|cwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
multiline_comment|/* simply re-set the last set SSID, this should commit most stuff */
multiline_comment|/* Commit in Monitor mode is not necessary, also setting essid&n;&t; * in Monitor mode does not make sense and isn&squot;t allowed for this&n;&t; * device&squot;s firmware */
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_MONITOR
)paren
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SSID
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_name
id|prism54_get_name
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_char
op_star
id|cwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_char
op_star
id|capabilities
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
OL
id|PRV_STATE_INIT
)paren
(brace
id|strncpy
c_func
(paren
id|cwrq
comma
l_string|&quot;NOT READY!&quot;
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|OID_INL_PHYCAPABILITIES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|r.u
)paren
(brace
r_case
id|INL_PHYCAP_5000MHZ
suffix:colon
id|capabilities
op_assign
l_string|&quot;IEEE 802.11a/b/g&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INL_PHYCAP_FAA
suffix:colon
id|capabilities
op_assign
l_string|&quot;IEEE 802.11b/g - FAA Support&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INL_PHYCAP_2400MHZ
suffix:colon
r_default
suffix:colon
id|capabilities
op_assign
l_string|&quot;IEEE 802.11b/g&quot;
suffix:semicolon
multiline_comment|/* Default */
r_break
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|cwrq
comma
id|capabilities
comma
id|IFNAMSIZ
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_freq
id|prism54_set_freq
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_freq
op_star
id|fwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|u32
id|c
suffix:semicolon
r_if
c_cond
(paren
id|fwrq-&gt;m
OL
l_int|1000
)paren
multiline_comment|/* we have a channel number */
id|c
op_assign
id|fwrq-&gt;m
suffix:semicolon
r_else
id|c
op_assign
(paren
id|fwrq-&gt;e
op_eq
l_int|1
)paren
ques
c_cond
id|channel_of_freq
c_func
(paren
id|fwrq-&gt;m
op_div
l_int|100000
)paren
suffix:colon
l_int|0
suffix:semicolon
id|rvalue
op_assign
id|c
ques
c_cond
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_CHANNEL
comma
l_int|0
comma
op_amp
id|c
)paren
suffix:colon
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Call commit handler */
r_return
(paren
id|rvalue
ques
c_cond
id|rvalue
suffix:colon
op_minus
id|EINPROGRESS
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_freq
id|prism54_get_freq
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_freq
op_star
id|fwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_CHANNEL
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|fwrq-&gt;i
op_assign
id|r.u
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_FREQUENCY
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|fwrq-&gt;m
op_assign
id|r.u
suffix:semicolon
id|fwrq-&gt;e
op_assign
l_int|3
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_mode
id|prism54_set_mode
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|mlmeautolevel
op_assign
id|CARD_DEFAULT_MLME_MODE
suffix:semicolon
multiline_comment|/* Let&squot;s see if the user passed a valid Linux Wireless mode */
r_if
c_cond
(paren
op_star
id|uwrq
OG
id|IW_MODE_MONITOR
op_logical_or
op_star
id|uwrq
OL
id|IW_MODE_AUTO
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s() You passed a non-valid init_mode.&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prism54_mib_mode_helper
c_func
(paren
id|priv
comma
op_star
id|uwrq
)paren
)paren
(brace
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* the ACL code needs an intermediate mlmeautolevel. The wpa stuff an&n;&t; * extended one.&n;&t; */
r_if
c_cond
(paren
(paren
op_star
id|uwrq
op_eq
id|IW_MODE_MASTER
)paren
op_logical_and
(paren
id|priv-&gt;acl.policy
op_ne
id|MAC_POLICY_OPEN
)paren
)paren
id|mlmeautolevel
op_assign
id|DOT11_MLME_INTERMEDIATE
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wpa
)paren
id|mlmeautolevel
op_assign
id|DOT11_MLME_EXTENDED
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_MLMEAUTOLEVEL
comma
op_amp
id|mlmeautolevel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mgt_commit
c_func
(paren
id|priv
)paren
)paren
(brace
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|priv-&gt;ndev-&gt;type
op_assign
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_MONITOR
)paren
ques
c_cond
id|priv-&gt;monitor_type
suffix:colon
id|ARPHRD_ETHER
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Use mib cache */
r_static
r_int
DECL|function|prism54_get_mode
id|prism54_get_mode
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|priv-&gt;iw_mode
OL
id|IW_MODE_AUTO
)paren
op_logical_or
(paren
id|priv-&gt;iw_mode
OG
id|IW_MODE_MONITOR
)paren
)paren
suffix:semicolon
op_star
id|uwrq
op_assign
id|priv-&gt;iw_mode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* we use DOT11_OID_EDTHRESHOLD. From what I guess the card will not try to&n; * emit data if (sensitivity &gt; rssi - noise) (in dBm).&n; * prism54_set_sens does not seem to work.&n; */
r_static
r_int
DECL|function|prism54_set_sens
id|prism54_set_sens
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|sens
suffix:semicolon
multiline_comment|/* by default  the card sets this to 20. */
id|sens
op_assign
id|vwrq-&gt;disabled
ques
c_cond
l_int|20
suffix:colon
id|vwrq-&gt;value
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EDTHRESHOLD
comma
l_int|0
comma
op_amp
id|sens
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_sens
id|prism54_get_sens
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EDTHRESHOLD
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
(paren
id|vwrq-&gt;value
op_eq
l_int|0
)paren
suffix:semicolon
id|vwrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_range
id|prism54_get_range
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|iw_range
op_star
id|range
op_assign
(paren
r_struct
id|iw_range
op_star
)paren
id|extra
suffix:semicolon
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u8
op_star
id|data
suffix:semicolon
r_int
id|i
comma
id|m
comma
id|rvalue
suffix:semicolon
r_struct
id|obj_frequencies
op_star
id|freq
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
id|memset
c_func
(paren
id|range
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iw_range
)paren
)paren
suffix:semicolon
id|dwrq-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|iw_range
)paren
suffix:semicolon
multiline_comment|/* set the wireless extension version number */
id|range-&gt;we_version_source
op_assign
id|SUPPORTED_WIRELESS_EXT
suffix:semicolon
id|range-&gt;we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
multiline_comment|/* Now the encoding capabilities */
id|range-&gt;num_encoding_sizes
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* 64(40) bits WEP */
id|range-&gt;encoding_size
(braket
l_int|0
)braket
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* 128(104) bits WEP */
id|range-&gt;encoding_size
(braket
l_int|1
)braket
op_assign
l_int|13
suffix:semicolon
multiline_comment|/* 256 bits for WPA-PSK */
id|range-&gt;encoding_size
(braket
l_int|2
)braket
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* 4 keys are allowed */
id|range-&gt;max_encoding_tokens
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* we don&squot;t know the quality range... */
id|range-&gt;max_qual.level
op_assign
l_int|0
suffix:semicolon
id|range-&gt;max_qual.noise
op_assign
l_int|0
suffix:semicolon
id|range-&gt;max_qual.qual
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* these value describe an average quality. Needs more tweaking... */
id|range-&gt;avg_qual.level
op_assign
op_minus
l_int|80
suffix:semicolon
multiline_comment|/* -80 dBm */
id|range-&gt;avg_qual.noise
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* don&squot;t know what to put here */
id|range-&gt;avg_qual.qual
op_assign
l_int|0
suffix:semicolon
id|range-&gt;sensitivity
op_assign
l_int|200
suffix:semicolon
multiline_comment|/* retry limit capabilities */
id|range-&gt;retry_capa
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range-&gt;retry_flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range-&gt;r_time_flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
multiline_comment|/* I don&squot;t know the range. Put stupid things here */
id|range-&gt;min_retry
op_assign
l_int|1
suffix:semicolon
id|range-&gt;max_retry
op_assign
l_int|65535
suffix:semicolon
id|range-&gt;min_r_time
op_assign
l_int|1024
suffix:semicolon
id|range-&gt;max_r_time
op_assign
l_int|65535
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* txpower is supported in dBm&squot;s */
id|range-&gt;txpower_capa
op_assign
id|IW_TXPOW_DBM
suffix:semicolon
macro_line|#if WIRELESS_EXT &gt; 16
multiline_comment|/* Event capability (kernel + driver) */
id|range-&gt;event_capa
(braket
l_int|0
)braket
op_assign
(paren
id|IW_EVENT_CAPA_K_0
op_or
id|IW_EVENT_CAPA_MASK
c_func
(paren
id|SIOCGIWTHRSPY
)paren
op_or
id|IW_EVENT_CAPA_MASK
c_func
(paren
id|SIOCGIWAP
)paren
)paren
suffix:semicolon
id|range-&gt;event_capa
(braket
l_int|1
)braket
op_assign
id|IW_EVENT_CAPA_K_1
suffix:semicolon
id|range-&gt;event_capa
(braket
l_int|4
)braket
op_assign
id|IW_EVENT_CAPA_MASK
c_func
(paren
id|IWEVCUSTOM
)paren
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 16 */
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
OL
id|PRV_STATE_INIT
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Request the device for the supported frequencies&n;&t; * not really relevant since some devices will report the 5 GHz band&n;&t; * frequencies even if they don&squot;t support them.&n;&t; */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SUPPORTEDFREQUENCIES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|freq
op_assign
id|r.ptr
suffix:semicolon
id|range-&gt;num_channels
op_assign
id|freq-&gt;nr
suffix:semicolon
id|range-&gt;num_frequency
op_assign
id|freq-&gt;nr
suffix:semicolon
id|m
op_assign
id|min
c_func
(paren
id|IW_MAX_FREQUENCIES
comma
(paren
r_int
)paren
id|freq-&gt;nr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|m
suffix:semicolon
id|i
op_increment
)paren
(brace
id|range-&gt;freq
(braket
id|i
)braket
dot
id|m
op_assign
id|freq-&gt;mhz
(braket
id|i
)braket
suffix:semicolon
id|range-&gt;freq
(braket
id|i
)braket
dot
id|e
op_assign
l_int|6
suffix:semicolon
id|range-&gt;freq
(braket
id|i
)braket
dot
id|i
op_assign
id|channel_of_freq
c_func
(paren
id|freq-&gt;mhz
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|freq
)paren
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SUPPORTEDRATES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|data
op_assign
id|r.ptr
suffix:semicolon
multiline_comment|/* We got an array of char. It is NULL terminated. */
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|i
OL
id|IW_MAX_BITRATES
)paren
op_logical_and
(paren
op_star
id|data
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/*       the result must be in bps. The card gives us 500Kbps */
id|range-&gt;bitrate
(braket
id|i
)braket
op_assign
op_star
id|data
op_star
l_int|500000
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|data
op_increment
suffix:semicolon
)brace
id|range-&gt;num_bitrates
op_assign
id|i
suffix:semicolon
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
multiline_comment|/* Set AP address*/
r_static
r_int
DECL|function|prism54_set_wap
id|prism54_set_wap
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_char
id|bssid
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_if
c_cond
(paren
id|awrq-&gt;sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* prepare the structure for the set object */
id|memcpy
c_func
(paren
op_amp
id|bssid
(braket
l_int|0
)braket
comma
id|awrq-&gt;sa_data
comma
l_int|6
)paren
suffix:semicolon
multiline_comment|/* set the bssid -- does this make sense when in AP mode? */
id|rvalue
op_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSID
comma
l_int|0
comma
op_amp
id|bssid
)paren
suffix:semicolon
r_return
(paren
id|rvalue
ques
c_cond
id|rvalue
suffix:colon
op_minus
id|EINPROGRESS
)paren
suffix:semicolon
multiline_comment|/* Call commit handler */
)brace
multiline_comment|/* get AP address*/
r_static
r_int
DECL|function|prism54_get_wap
id|prism54_get_wap
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|awrq-&gt;sa_data
comma
id|r.ptr
comma
l_int|6
)paren
suffix:semicolon
id|awrq-&gt;sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_scan
id|prism54_set_scan
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
multiline_comment|/* hehe the device does this automagicaly */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* a little helper that will translate our data into a card independent&n; * format that the Wireless Tools will understand. This was inspired by&n; * the &quot;Aironet driver for 4500 and 4800 series cards&quot; (GPL)&n; */
r_static
r_char
op_star
DECL|function|prism54_translate_bss
id|prism54_translate_bss
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_char
op_star
id|current_ev
comma
r_char
op_star
id|end_buf
comma
r_struct
id|obj_bss
op_star
id|bss
comma
r_char
id|noise
)paren
(brace
r_struct
id|iw_event
id|iwe
suffix:semicolon
multiline_comment|/* Temporary buffer */
r_int
id|cap
suffix:semicolon
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
multiline_comment|/* The first entry must be the MAC address */
id|memcpy
c_func
(paren
id|iwe.u.ap_addr.sa_data
comma
id|bss-&gt;address
comma
l_int|6
)paren
suffix:semicolon
id|iwe.u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWAP
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|IW_EV_ADDR_LEN
)paren
suffix:semicolon
multiline_comment|/* The following entries will be displayed in the same order we give them */
multiline_comment|/* The ESSID. */
id|iwe.u.data.length
op_assign
id|bss-&gt;ssid.length
suffix:semicolon
id|iwe.u.data.flags
op_assign
l_int|1
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWESSID
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|bss-&gt;ssid.octets
)paren
suffix:semicolon
multiline_comment|/* Capabilities */
DECL|macro|CAP_ESS
mdefine_line|#define CAP_ESS 0x01
DECL|macro|CAP_IBSS
mdefine_line|#define CAP_IBSS 0x02
DECL|macro|CAP_CRYPT
mdefine_line|#define CAP_CRYPT 0x10
multiline_comment|/* Mode */
id|cap
op_assign
id|bss-&gt;capinfo
suffix:semicolon
id|iwe.u.mode
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cap
op_amp
id|CAP_ESS
)paren
id|iwe.u.mode
op_assign
id|IW_MODE_MASTER
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cap
op_amp
id|CAP_IBSS
)paren
id|iwe.u.mode
op_assign
id|IW_MODE_ADHOC
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWMODE
suffix:semicolon
r_if
c_cond
(paren
id|iwe.u.mode
)paren
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|IW_EV_UINT_LEN
)paren
suffix:semicolon
multiline_comment|/* Encryption capability */
r_if
c_cond
(paren
id|cap
op_amp
id|CAP_CRYPT
)paren
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_ENABLED
op_or
id|IW_ENCODE_NOKEY
suffix:semicolon
r_else
id|iwe.u.data.flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
id|iwe.u.data.length
op_assign
l_int|0
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWENCODE
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Add frequency. (short) bss-&gt;channel is the frequency in MHz */
id|iwe.u.freq.m
op_assign
id|bss-&gt;channel
suffix:semicolon
id|iwe.u.freq.e
op_assign
l_int|6
suffix:semicolon
id|iwe.cmd
op_assign
id|SIOCGIWFREQ
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|IW_EV_FREQ_LEN
)paren
suffix:semicolon
multiline_comment|/* Add quality statistics */
id|iwe.u.qual.level
op_assign
id|bss-&gt;rssi
suffix:semicolon
id|iwe.u.qual.noise
op_assign
id|noise
suffix:semicolon
multiline_comment|/* do a simple SNR for quality */
id|iwe.u.qual.qual
op_assign
id|bss-&gt;rssi
op_minus
id|noise
suffix:semicolon
id|iwe.cmd
op_assign
id|IWEVQUAL
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_event
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|IW_EV_QUAL_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wpa
)paren
(brace
id|u8
id|wpa_ie
(braket
id|MAX_WPA_IE_LEN
)braket
suffix:semicolon
r_char
op_star
id|buf
comma
op_star
id|p
suffix:semicolon
r_int
id|wpa_ie_len
suffix:semicolon
r_int
id|i
suffix:semicolon
id|wpa_ie_len
op_assign
id|prism54_wpa_ie_get
c_func
(paren
id|priv
comma
id|bss-&gt;address
comma
id|wpa_ie
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wpa_ie_len
OG
l_int|0
op_logical_and
(paren
id|buf
op_assign
id|kmalloc
c_func
(paren
id|wpa_ie_len
op_star
l_int|2
op_plus
l_int|10
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|p
op_assign
id|buf
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;wpa_ie=&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|wpa_ie_len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;%02x&quot;
comma
id|wpa_ie
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|iwe
comma
l_int|0
comma
r_sizeof
(paren
id|iwe
)paren
)paren
suffix:semicolon
id|iwe.cmd
op_assign
id|IWEVCUSTOM
suffix:semicolon
id|iwe.u.data.length
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
id|current_ev
op_assign
id|iwe_stream_add_point
c_func
(paren
id|current_ev
comma
id|end_buf
comma
op_amp
id|iwe
comma
id|buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
)brace
r_return
id|current_ev
suffix:semicolon
)brace
r_int
DECL|function|prism54_get_scan
id|prism54_get_scan
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|i
comma
id|rvalue
suffix:semicolon
r_struct
id|obj_bsslist
op_star
id|bsslist
suffix:semicolon
id|u32
id|noise
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|current_ev
op_assign
id|extra
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
OL
id|PRV_STATE_INIT
)paren
(brace
multiline_comment|/* device is not ready, fail gently */
id|dwrq-&gt;length
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* first get the noise value. We will use it to report the link quality */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_NOISEFLOOR
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|noise
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Ask the device for a list of known bss.&n;&t;* The old API, using SIOCGIWAPLIST, had a hard limit of IW_MAX_AP=64.&n;&t;* The new API, using SIOCGIWSCAN, is only limited by the buffer size.&n;&t;* WE-14-&gt;WE-16, the buffer is limited to IW_SCAN_MAX_DATA bytes.&n;&t;* Starting with WE-17, the buffer can be as big as needed.&n;&t;* But the device won&squot;t repport anything if you change the value&n;&t;* of IWMAX_BSS=24. */
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSLIST
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|bsslist
op_assign
id|r.ptr
suffix:semicolon
multiline_comment|/* ok now, scan the list and translate its info */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|bsslist-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
id|current_ev
op_assign
id|prism54_translate_bss
c_func
(paren
id|ndev
comma
id|current_ev
comma
id|extra
op_plus
id|dwrq-&gt;length
comma
op_amp
(paren
id|bsslist-&gt;bsslist
(braket
id|i
)braket
)paren
comma
id|noise
)paren
suffix:semicolon
macro_line|#if WIRELESS_EXT &gt; 16
multiline_comment|/* Check if there is space for one more entry */
r_if
c_cond
(paren
(paren
id|extra
op_plus
id|dwrq-&gt;length
op_minus
id|current_ev
)paren
op_le
id|IW_EV_ADDR_LEN
)paren
(brace
multiline_comment|/* Ask user space to try again with a bigger buffer */
id|rvalue
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_EXT &gt; 16 */
)brace
id|kfree
c_func
(paren
id|bsslist
)paren
suffix:semicolon
id|dwrq-&gt;length
op_assign
(paren
id|current_ev
op_minus
id|extra
)paren
suffix:semicolon
id|dwrq-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* todo */
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_essid
id|prism54_set_essid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|obj_ssid
id|essid
suffix:semicolon
id|memset
c_func
(paren
id|essid.octets
comma
l_int|0
comma
l_int|33
)paren
suffix:semicolon
multiline_comment|/* Check if we were asked for `any&squot; */
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_logical_and
id|dwrq-&gt;length
)paren
(brace
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
id|min
c_func
(paren
l_int|33
comma
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|essid.length
op_assign
id|dwrq-&gt;length
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|essid.octets
comma
id|extra
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
)brace
r_else
id|essid.length
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_MONITOR
)paren
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SSID
comma
l_int|0
comma
op_amp
id|essid
)paren
suffix:semicolon
multiline_comment|/* If in monitor mode, just save to mib */
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_SSID
comma
op_amp
id|essid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_essid
id|prism54_get_essid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|obj_ssid
op_star
id|essid
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SSID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|essid
op_assign
id|r.ptr
suffix:semicolon
r_if
c_cond
(paren
id|essid-&gt;length
)paren
(brace
id|dwrq-&gt;flags
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* set ESSID to ON for Wireless Extensions */
multiline_comment|/* if it is to big, trunk it */
id|dwrq-&gt;length
op_assign
id|min
c_func
(paren
id|IW_ESSID_MAX_SIZE
comma
id|essid-&gt;length
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|dwrq-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|dwrq-&gt;length
op_assign
l_int|0
suffix:semicolon
)brace
id|essid-&gt;octets
(braket
id|essid-&gt;length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|essid-&gt;octets
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|essid
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
multiline_comment|/* Provides no functionality, just completes the ioctl. In essence this is a &n; * just a cosmetic ioctl.&n; */
r_static
r_int
DECL|function|prism54_set_nick
id|prism54_set_nick
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
id|IW_ESSID_MAX_SIZE
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;nickname
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;nickname
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;nickname
comma
id|extra
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_nick
id|prism54_get_nick
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|dwrq-&gt;length
op_assign
l_int|0
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|dwrq-&gt;length
op_assign
id|strlen
c_func
(paren
id|priv-&gt;nickname
)paren
op_plus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|priv-&gt;nickname
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set the allowed Bitrates */
r_static
r_int
DECL|function|prism54_set_rate
id|prism54_set_rate
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|rate
comma
id|profile
suffix:semicolon
r_char
op_star
id|data
suffix:semicolon
r_int
id|ret
comma
id|i
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;value
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* auto mode. No limit. */
id|profile
op_assign
l_int|1
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PROFILES
comma
l_int|0
comma
op_amp
id|profile
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SUPPORTEDRATES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|rate
op_assign
(paren
id|u32
)paren
(paren
id|vwrq-&gt;value
op_div
l_int|500000
)paren
suffix:semicolon
id|data
op_assign
id|r.ptr
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|data
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
id|rate
op_logical_and
(paren
id|data
(braket
id|i
)braket
op_eq
id|rate
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vwrq-&gt;value
op_eq
id|i
)paren
(brace
r_break
suffix:semicolon
)brace
id|data
(braket
id|i
)braket
op_or_assign
l_int|0x80
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|data
(braket
id|i
)braket
)paren
(brace
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|data
(braket
id|i
)braket
op_or_assign
l_int|0x80
suffix:semicolon
id|data
(braket
id|i
op_plus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now, check if we want a fixed or auto value */
r_if
c_cond
(paren
id|vwrq-&gt;fixed
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
id|data
(braket
id|i
)braket
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t;i = 0;&n;&t;printk(&quot;prism54 rate: &quot;);&n;&t;while(data[i]) {&n;&t;&t;printk(&quot;%u &quot;, data[i]);&n;&t;&t;i++;&n;&t;}&n;&t;printk(&quot;0&bslash;n&quot;);&n;*/
id|profile
op_assign
op_minus
l_int|1
suffix:semicolon
id|ret
op_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PROFILES
comma
l_int|0
comma
op_amp
id|profile
)paren
suffix:semicolon
id|ret
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EXTENDEDRATES
comma
l_int|0
comma
id|data
)paren
suffix:semicolon
id|ret
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_RATES
comma
l_int|0
comma
id|data
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Get the current bit rate */
r_static
r_int
DECL|function|prism54_get_rate
id|prism54_get_rate
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_char
op_star
id|data
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
multiline_comment|/* Get the current bit rate */
r_if
c_cond
(paren
(paren
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|GEN_OID_LINKSTATE
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
)paren
)paren
r_return
id|rvalue
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
op_star
l_int|500000
suffix:semicolon
multiline_comment|/* request the device for the enabled rates */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_RATES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rvalue
)paren
(brace
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
id|data
op_assign
id|r.ptr
suffix:semicolon
id|vwrq-&gt;fixed
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
op_logical_and
(paren
id|data
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_rts
id|prism54_set_rts
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_RTSTHRESH
comma
l_int|0
comma
op_amp
id|vwrq-&gt;value
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_rts
id|prism54_get_rts
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
multiline_comment|/* get the rts threshold */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_RTSTHRESH
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_frag
id|prism54_set_frag
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_FRAGTHRESH
comma
l_int|0
comma
op_amp
id|vwrq-&gt;value
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_frag
id|prism54_get_frag
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_FRAGTHRESH
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
multiline_comment|/* Here we have (min,max) = max retries for (small frames, big frames). Where&n; * big frame &lt;=&gt;  bigger than the rts threshold&n; * small frame &lt;=&gt;  smaller than the rts threshold&n; * This is not really the behavior expected by the wireless tool but it seems&n; * to be a common behavior in other drivers.&n; */
r_static
r_int
DECL|function|prism54_set_retry
id|prism54_set_retry
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|slimit
op_assign
l_int|0
comma
id|llimit
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* short and long limit */
id|u32
id|lifetime
op_assign
l_int|0
suffix:semicolon
r_int
id|rvalue
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;disabled
)paren
multiline_comment|/* we cannot disable this feature */
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_LIMIT
)paren
(brace
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MIN
)paren
id|slimit
op_assign
id|vwrq-&gt;value
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
id|llimit
op_assign
id|vwrq-&gt;value
suffix:semicolon
r_else
(brace
multiline_comment|/* we are asked to set both */
id|slimit
op_assign
id|vwrq-&gt;value
suffix:semicolon
id|llimit
op_assign
id|vwrq-&gt;value
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_LIFETIME
)paren
multiline_comment|/* Wireless tools use us unit while the device uses 1024 us unit */
id|lifetime
op_assign
id|vwrq-&gt;value
op_div
l_int|1024
suffix:semicolon
multiline_comment|/* now set what is requested */
r_if
c_cond
(paren
id|slimit
)paren
id|rvalue
op_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SHORTRETRIES
comma
l_int|0
comma
op_amp
id|slimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llimit
)paren
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_LONGRETRIES
comma
l_int|0
comma
op_amp
id|llimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifetime
)paren
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_MAXTXLIFETIME
comma
l_int|0
comma
op_amp
id|lifetime
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_retry
id|prism54_get_retry
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
op_assign
l_int|0
suffix:semicolon
id|vwrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* It cannot be disabled */
r_if
c_cond
(paren
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIFETIME
)paren
(brace
multiline_comment|/* we are asked for the life time */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_MAXTXLIFETIME
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
op_star
l_int|1024
suffix:semicolon
id|vwrq-&gt;flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|vwrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
)paren
(brace
multiline_comment|/* we are asked for the long retry limit */
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_LONGRETRIES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
suffix:semicolon
id|vwrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MAX
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* default. get the  short retry limit */
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_SHORTRETRIES
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|vwrq-&gt;value
op_assign
id|r.u
suffix:semicolon
id|vwrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MIN
suffix:semicolon
)brace
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_encode
id|prism54_set_encode
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|rvalue
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
suffix:semicolon
r_int
id|authen
op_assign
id|DOT11_AUTH_OS
comma
id|invoke
op_assign
l_int|0
comma
id|exunencrypt
op_assign
l_int|0
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
multiline_comment|/* with the new API, it&squot;s impossible to get a NULL pointer.&n;&t; * New version of iwconfig set the IW_ENCODE_NOKEY flag&n;&t; * when no key is given, but older versions don&squot;t. */
r_if
c_cond
(paren
id|dwrq-&gt;length
OG
l_int|0
)paren
(brace
multiline_comment|/* we have a key to set */
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|current_index
suffix:semicolon
r_struct
id|obj_key
id|key
op_assign
(brace
id|DOT11_PRIV_WEP
comma
l_int|0
comma
l_string|&quot;&quot;
)brace
suffix:semicolon
multiline_comment|/* get the current key index */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|current_index
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Verify that the key is not marked as invalid */
r_if
c_cond
(paren
op_logical_neg
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_NOKEY
)paren
)paren
(brace
id|key.length
op_assign
id|dwrq-&gt;length
OG
r_sizeof
(paren
id|key.key
)paren
ques
c_cond
r_sizeof
(paren
id|key.key
)paren
suffix:colon
id|dwrq-&gt;length
suffix:semicolon
id|memcpy
c_func
(paren
id|key.key
comma
id|extra
comma
id|key.length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|key.length
op_eq
l_int|32
)paren
multiline_comment|/* we want WPA-PSK */
id|key.type
op_assign
id|DOT11_PRIV_TKIP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
OG
l_int|3
)paren
)paren
multiline_comment|/* no index provided use the current one */
id|index
op_assign
id|current_index
suffix:semicolon
multiline_comment|/* now send the key to the card  */
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYX
comma
id|index
comma
op_amp
id|key
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * If a valid key is set, encryption should be enabled &n;&t;&t; * (user may turn it off later).&n;&t;&t; * This is also how &quot;iwconfig ethX key on&quot; works&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|index
op_eq
id|current_index
)paren
op_logical_and
(paren
id|key.length
OG
l_int|0
)paren
)paren
id|force
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
op_ge
l_int|0
)paren
op_logical_and
(paren
id|index
op_le
l_int|3
)paren
)paren
(brace
multiline_comment|/* we want to set the key index */
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYID
comma
l_int|0
comma
op_amp
id|index
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_MODE
)paren
(brace
multiline_comment|/* we cannot do anything. Complain. */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* now read the flags */
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_DISABLED
)paren
(brace
multiline_comment|/* Encoding disabled, &n;&t;&t; * authen = DOT11_AUTH_OS;&n;&t;&t; * invoke = 0;&n;&t;&t; * exunencrypt = 0; */
)brace
r_if
c_cond
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_OPEN
)paren
multiline_comment|/* Encode but accept non-encoded packets. No auth */
id|invoke
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
op_logical_or
id|force
)paren
(brace
multiline_comment|/* Refuse non-encoded packets. Auth */
id|authen
op_assign
id|DOT11_AUTH_BOTH
suffix:semicolon
id|invoke
op_assign
l_int|1
suffix:semicolon
id|exunencrypt
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* do the change if requested  */
r_if
c_cond
(paren
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_MODE
)paren
op_logical_or
id|force
)paren
(brace
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_AUTHENABLE
comma
l_int|0
comma
op_amp
id|authen
)paren
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVACYINVOKED
comma
l_int|0
comma
op_amp
id|invoke
)paren
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
l_int|0
comma
op_amp
id|exunencrypt
)paren
suffix:semicolon
)brace
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_encode
id|prism54_get_encode
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|obj_key
op_star
id|key
suffix:semicolon
id|u32
id|devindex
comma
id|index
op_assign
(paren
id|dwrq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
id|u32
id|authen
op_assign
l_int|0
comma
id|invoke
op_assign
l_int|0
comma
id|exunencrypt
op_assign
l_int|0
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
multiline_comment|/* first get the flags */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_AUTHENABLE
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|authen
op_assign
id|r.u
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVACYINVOKED
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|invoke
op_assign
id|r.u
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|exunencrypt
op_assign
id|r.u
suffix:semicolon
r_if
c_cond
(paren
id|invoke
op_logical_and
(paren
id|authen
op_eq
id|DOT11_AUTH_BOTH
)paren
op_logical_and
id|exunencrypt
)paren
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_RESTRICTED
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|authen
op_eq
id|DOT11_AUTH_OS
)paren
op_logical_and
op_logical_neg
id|exunencrypt
)paren
(brace
r_if
c_cond
(paren
id|invoke
)paren
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_OPEN
suffix:semicolon
r_else
id|dwrq-&gt;flags
op_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
)brace
r_else
multiline_comment|/* The card should not work in this state */
id|dwrq-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* get the current device key index */
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|devindex
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Now get the key, return it */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
OG
l_int|3
)paren
)paren
multiline_comment|/* no index provided, use the current one */
id|index
op_assign
id|devindex
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYX
comma
id|index
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|key
op_assign
id|r.ptr
suffix:semicolon
id|dwrq-&gt;length
op_assign
id|key-&gt;length
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|key-&gt;key
comma
id|dwrq-&gt;length
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
multiline_comment|/* return the used key index */
id|dwrq-&gt;flags
op_or_assign
id|devindex
op_plus
l_int|1
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_txpower
id|prism54_get_txpower
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|OID_INL_OUTPUTPOWER
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
multiline_comment|/* intersil firmware operates in 0.25 dBm (1/4 dBm) */
id|vwrq-&gt;value
op_assign
(paren
id|s32
)paren
id|r.u
op_div
l_int|4
suffix:semicolon
id|vwrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* radio is not turned of&n;&t; * btw: how is possible to turn off only the radio &n;&t; */
id|vwrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_txpower
id|prism54_set_txpower
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_param
op_star
id|vwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|s32
id|u
op_assign
id|vwrq-&gt;value
suffix:semicolon
multiline_comment|/* intersil firmware operates in 0.25 dBm (1/4) */
id|u
op_mul_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|vwrq-&gt;disabled
)paren
(brace
multiline_comment|/* don&squot;t know how to disable radio */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s() disabling radio is not yet supported.&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vwrq-&gt;fixed
)paren
multiline_comment|/* currently only fixed value is supported */
r_return
id|mgt_set_request
c_func
(paren
id|priv
comma
id|OID_INL_OUTPUTPOWER
comma
l_int|0
comma
op_amp
id|u
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s() auto power will be implemented later.&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|prism54_reset
id|prism54_reset
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_reset
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_oid
id|prism54_get_oid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_union
id|oid_res_t
id|r
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_enum
id|oid_num_t
id|n
op_assign
id|dwrq-&gt;flags
suffix:semicolon
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
(paren
id|islpci_private
op_star
)paren
id|ndev-&gt;priv
comma
id|n
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|dwrq-&gt;length
op_assign
id|mgt_response_to_str
c_func
(paren
id|n
comma
op_amp
id|r
comma
id|extra
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|isl_oid
(braket
id|n
)braket
dot
id|flags
op_amp
id|OID_FLAG_TYPE
)paren
op_ne
id|OID_TYPE_U32
)paren
id|kfree
c_func
(paren
id|r.ptr
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_u32
id|prism54_set_u32
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|u32
id|oid
op_assign
id|uwrq
(braket
l_int|0
)braket
comma
id|u
op_assign
id|uwrq
(braket
l_int|1
)braket
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
(paren
id|islpci_private
op_star
)paren
id|ndev-&gt;priv
comma
id|oid
comma
l_int|0
comma
op_amp
id|u
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_raw
id|prism54_set_raw
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|u32
id|oid
op_assign
id|dwrq-&gt;flags
suffix:semicolon
r_return
id|mgt_set_request
c_func
(paren
(paren
id|islpci_private
op_star
)paren
id|ndev-&gt;priv
comma
id|oid
comma
l_int|0
comma
id|extra
)paren
suffix:semicolon
)brace
r_void
DECL|function|prism54_acl_init
id|prism54_acl_init
c_func
(paren
r_struct
id|islpci_acl
op_star
id|acl
)paren
(brace
id|sema_init
c_func
(paren
op_amp
id|acl-&gt;sem
comma
l_int|1
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|acl-&gt;mac_list
)paren
suffix:semicolon
id|acl-&gt;size
op_assign
l_int|0
suffix:semicolon
id|acl-&gt;policy
op_assign
id|MAC_POLICY_OPEN
suffix:semicolon
)brace
r_static
r_void
DECL|function|prism54_clear_mac
id|prism54_clear_mac
c_func
(paren
r_struct
id|islpci_acl
op_star
id|acl
)paren
(brace
r_struct
id|list_head
op_star
id|ptr
comma
op_star
id|next
suffix:semicolon
r_struct
id|mac_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|acl-&gt;size
op_eq
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ptr
op_assign
id|acl-&gt;mac_list.next
comma
id|next
op_assign
id|ptr-&gt;next
suffix:semicolon
id|ptr
op_ne
op_amp
id|acl-&gt;mac_list
suffix:semicolon
id|ptr
op_assign
id|next
comma
id|next
op_assign
id|ptr-&gt;next
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|mac_entry
comma
id|_list
)paren
suffix:semicolon
id|list_del
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
id|acl-&gt;size
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
)brace
r_void
DECL|function|prism54_acl_clean
id|prism54_acl_clean
c_func
(paren
r_struct
id|islpci_acl
op_star
id|acl
)paren
(brace
id|prism54_clear_mac
c_func
(paren
id|acl
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_add_mac
id|prism54_add_mac
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_acl
op_star
id|acl
op_assign
op_amp
id|priv-&gt;acl
suffix:semicolon
r_struct
id|mac_entry
op_star
id|entry
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|extra
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|entry
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mac_entry
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|entry-&gt;addr
comma
id|addr-&gt;sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
)paren
(brace
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|entry-&gt;_list
comma
op_amp
id|acl-&gt;mac_list
)paren
suffix:semicolon
id|acl-&gt;size
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_del_mac
id|prism54_del_mac
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_acl
op_star
id|acl
op_assign
op_amp
id|priv-&gt;acl
suffix:semicolon
r_struct
id|mac_entry
op_star
id|entry
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|extra
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|acl-&gt;mac_list.next
suffix:semicolon
id|ptr
op_ne
op_amp
id|acl-&gt;mac_list
suffix:semicolon
id|ptr
op_assign
id|ptr-&gt;next
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|mac_entry
comma
id|_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|entry-&gt;addr
comma
id|addr-&gt;sa_data
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|list_del
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|acl-&gt;size
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|entry
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_mac
id|prism54_get_mac
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_acl
op_star
id|acl
op_assign
op_amp
id|priv-&gt;acl
suffix:semicolon
r_struct
id|mac_entry
op_star
id|entry
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
r_struct
id|sockaddr
op_star
id|dst
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|extra
suffix:semicolon
id|dwrq-&gt;length
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|acl-&gt;mac_list.next
suffix:semicolon
id|ptr
op_ne
op_amp
id|acl-&gt;mac_list
suffix:semicolon
id|ptr
op_assign
id|ptr-&gt;next
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|mac_entry
comma
id|_list
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dst-&gt;sa_data
comma
id|entry-&gt;addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|dst-&gt;sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|dwrq-&gt;length
op_increment
suffix:semicolon
id|dst
op_increment
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Setting policy also clears the MAC acl, even if we don&squot;t change the defaut&n; * policy&n; */
r_static
r_int
DECL|function|prism54_set_policy
id|prism54_set_policy
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_acl
op_star
id|acl
op_assign
op_amp
id|priv-&gt;acl
suffix:semicolon
id|u32
id|mlmeautolevel
suffix:semicolon
id|prism54_clear_mac
c_func
(paren
id|acl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|uwrq
OL
id|MAC_POLICY_OPEN
)paren
op_logical_or
(paren
op_star
id|uwrq
OG
id|MAC_POLICY_REJECT
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|acl-&gt;policy
op_assign
op_star
id|uwrq
suffix:semicolon
multiline_comment|/* the ACL code needs an intermediate mlmeautolevel */
r_if
c_cond
(paren
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_MASTER
)paren
op_logical_and
(paren
id|acl-&gt;policy
op_ne
id|MAC_POLICY_OPEN
)paren
)paren
id|mlmeautolevel
op_assign
id|DOT11_MLME_INTERMEDIATE
suffix:semicolon
r_else
id|mlmeautolevel
op_assign
id|CARD_DEFAULT_MLME_MODE
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wpa
)paren
id|mlmeautolevel
op_assign
id|DOT11_MLME_EXTENDED
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_MLMEAUTOLEVEL
comma
op_amp
id|mlmeautolevel
)paren
suffix:semicolon
multiline_comment|/* restart the card with our new policy */
r_if
c_cond
(paren
id|mgt_commit
c_func
(paren
id|priv
)paren
)paren
(brace
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_get_policy
id|prism54_get_policy
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_acl
op_star
id|acl
op_assign
op_amp
id|priv-&gt;acl
suffix:semicolon
op_star
id|uwrq
op_assign
id|acl-&gt;policy
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Return 1 only if client should be accepted. */
r_static
r_int
DECL|function|prism54_mac_accept
id|prism54_mac_accept
c_func
(paren
r_struct
id|islpci_acl
op_star
id|acl
comma
r_char
op_star
id|mac
)paren
(brace
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
r_struct
id|mac_entry
op_star
id|entry
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|acl-&gt;policy
op_eq
id|MAC_POLICY_OPEN
)paren
(brace
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ptr
op_assign
id|acl-&gt;mac_list.next
suffix:semicolon
id|ptr
op_ne
op_amp
id|acl-&gt;mac_list
suffix:semicolon
id|ptr
op_assign
id|ptr-&gt;next
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|mac_entry
comma
id|_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|entry-&gt;addr
comma
id|mac
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|res
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|res
op_assign
(paren
id|acl-&gt;policy
op_eq
id|MAC_POLICY_ACCEPT
)paren
ques
c_cond
op_logical_neg
id|res
suffix:colon
id|res
suffix:semicolon
id|up
c_func
(paren
op_amp
id|acl-&gt;sem
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_kick_all
id|prism54_kick_all
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|dwrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|obj_mlme
op_star
id|mlme
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
id|mlme
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|obj_mlme
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mlme
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Tell the card to kick every client */
id|mlme-&gt;id
op_assign
l_int|0
suffix:semicolon
id|rvalue
op_assign
id|mgt_set_request
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
id|DOT11_OID_DISASSOCIATE
comma
l_int|0
comma
id|mlme
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mlme
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_kick_mac
id|prism54_kick_mac
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|sockaddr
op_star
id|awrq
comma
r_char
op_star
id|extra
)paren
(brace
r_struct
id|obj_mlme
op_star
id|mlme
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
id|extra
suffix:semicolon
r_int
id|rvalue
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_ne
id|ARPHRD_ETHER
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|mlme
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|obj_mlme
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mlme
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Tell the card to only kick the corresponding bastard */
id|memcpy
c_func
(paren
id|mlme-&gt;address
comma
id|addr-&gt;sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|mlme-&gt;id
op_assign
op_minus
l_int|1
suffix:semicolon
id|rvalue
op_assign
id|mgt_set_request
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
id|DOT11_OID_DISASSOCIATE
comma
l_int|0
comma
id|mlme
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mlme
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
multiline_comment|/* Translate a TRAP oid into a wireless event. Called in islpci_mgt_receive. */
r_static
r_void
DECL|function|format_event
id|format_event
c_func
(paren
id|islpci_private
op_star
id|priv
comma
r_char
op_star
id|dest
comma
r_const
r_char
op_star
id|str
comma
r_const
r_struct
id|obj_mlme
op_star
id|mlme
comma
id|u16
op_star
id|length
comma
r_int
id|error
)paren
(brace
r_const
id|u8
op_star
id|a
op_assign
id|mlme-&gt;address
suffix:semicolon
r_int
id|n
op_assign
id|snprintf
c_func
(paren
id|dest
comma
id|IW_CUSTOM_MAX
comma
l_string|&quot;%s %s %2.2X:%2.2X:%2.2X:%2.2X:%2.2X:%2.2X %s (%2.2X)&quot;
comma
id|str
comma
(paren
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_MASTER
)paren
ques
c_cond
l_string|&quot;from&quot;
suffix:colon
l_string|&quot;to&quot;
)paren
comma
id|a
(braket
l_int|0
)braket
comma
id|a
(braket
l_int|1
)braket
comma
id|a
(braket
l_int|2
)braket
comma
id|a
(braket
l_int|3
)braket
comma
id|a
(braket
l_int|4
)braket
comma
id|a
(braket
l_int|5
)braket
comma
(paren
id|error
ques
c_cond
(paren
id|mlme-&gt;code
ques
c_cond
l_string|&quot; : REJECTED &quot;
suffix:colon
l_string|&quot; : ACCEPTED &quot;
)paren
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|mlme-&gt;code
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|n
OG
id|IW_CUSTOM_MAX
)paren
suffix:semicolon
op_star
id|length
op_assign
id|n
suffix:semicolon
)brace
r_static
r_void
DECL|function|send_formatted_event
id|send_formatted_event
c_func
(paren
id|islpci_private
op_star
id|priv
comma
r_const
r_char
op_star
id|str
comma
r_const
r_struct
id|obj_mlme
op_star
id|mlme
comma
r_int
id|error
)paren
(brace
r_union
id|iwreq_data
id|wrqu
suffix:semicolon
r_char
op_star
id|memptr
suffix:semicolon
id|memptr
op_assign
id|kmalloc
c_func
(paren
id|IW_CUSTOM_MAX
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memptr
)paren
r_return
suffix:semicolon
id|wrqu.data.pointer
op_assign
id|memptr
suffix:semicolon
id|wrqu.data.length
op_assign
l_int|0
suffix:semicolon
id|format_event
c_func
(paren
id|priv
comma
id|memptr
comma
id|str
comma
id|mlme
comma
op_amp
id|wrqu.data.length
comma
id|error
)paren
suffix:semicolon
id|wireless_send_event
c_func
(paren
id|priv-&gt;ndev
comma
id|IWEVCUSTOM
comma
op_amp
id|wrqu
comma
id|memptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|memptr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|send_simple_event
id|send_simple_event
c_func
(paren
id|islpci_private
op_star
id|priv
comma
r_const
r_char
op_star
id|str
)paren
(brace
r_union
id|iwreq_data
id|wrqu
suffix:semicolon
r_char
op_star
id|memptr
suffix:semicolon
r_int
id|n
op_assign
id|strlen
c_func
(paren
id|str
)paren
suffix:semicolon
id|memptr
op_assign
id|kmalloc
c_func
(paren
id|IW_CUSTOM_MAX
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memptr
)paren
r_return
suffix:semicolon
id|BUG_ON
c_func
(paren
id|n
OG
id|IW_CUSTOM_MAX
)paren
suffix:semicolon
id|wrqu.data.pointer
op_assign
id|memptr
suffix:semicolon
id|wrqu.data.length
op_assign
id|n
suffix:semicolon
id|strcpy
c_func
(paren
id|memptr
comma
id|str
)paren
suffix:semicolon
id|wireless_send_event
c_func
(paren
id|priv-&gt;ndev
comma
id|IWEVCUSTOM
comma
op_amp
id|wrqu
comma
id|memptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|memptr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|link_changed
id|link_changed
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
id|u32
id|bitrate
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bitrate
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_INFRA
)paren
(brace
r_union
id|iwreq_data
id|uwrq
suffix:semicolon
id|prism54_get_wap
c_func
(paren
id|ndev
comma
l_int|NULL
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|uwrq
comma
l_int|NULL
)paren
suffix:semicolon
id|wireless_send_event
c_func
(paren
id|ndev
comma
id|SIOCGIWAP
comma
op_amp
id|uwrq
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|send_simple_event
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
l_string|&quot;Link established&quot;
)paren
suffix:semicolon
)brace
r_else
id|send_simple_event
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
l_string|&quot;Link lost&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Beacon/ProbeResp payload header */
DECL|struct|ieee80211_beacon_phdr
r_struct
id|ieee80211_beacon_phdr
(brace
DECL|member|timestamp
id|u8
id|timestamp
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|beacon_int
id|u16
id|beacon_int
suffix:semicolon
DECL|member|capab_info
id|u16
id|capab_info
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|macro|WLAN_EID_GENERIC
mdefine_line|#define WLAN_EID_GENERIC 0xdd
DECL|variable|wpa_oid
r_static
id|u8
id|wpa_oid
(braket
l_int|4
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x50
comma
l_int|0xf2
comma
l_int|1
)brace
suffix:semicolon
DECL|macro|MAC2STR
mdefine_line|#define MAC2STR(a) (a)[0], (a)[1], (a)[2], (a)[3], (a)[4], (a)[5]
DECL|macro|MACSTR
mdefine_line|#define MACSTR &quot;%02x:%02x:%02x:%02x:%02x:%02x&quot;
r_void
DECL|function|prism54_wpa_ie_add
id|prism54_wpa_ie_add
c_func
(paren
id|islpci_private
op_star
id|priv
comma
id|u8
op_star
id|bssid
comma
id|u8
op_star
id|wpa_ie
comma
r_int
id|wpa_ie_len
)paren
(brace
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
r_struct
id|islpci_bss_wpa_ie
op_star
id|bss
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|wpa_ie_len
OG
id|MAX_WPA_IE_LEN
)paren
id|wpa_ie_len
op_assign
id|MAX_WPA_IE_LEN
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|priv-&gt;wpa_sem
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* try to use existing entry */
id|list_for_each
c_func
(paren
id|ptr
comma
op_amp
id|priv-&gt;bss_wpa_list
)paren
(brace
id|bss
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|islpci_bss_wpa_ie
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|bss-&gt;bssid
comma
id|bssid
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
(brace
id|list_move
c_func
(paren
op_amp
id|bss-&gt;list
comma
op_amp
id|priv-&gt;bss_wpa_list
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|bss
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bss
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* add a new BSS entry; if max number of entries is already&n;&t;&t; * reached, replace the least recently updated */
r_if
c_cond
(paren
id|priv-&gt;num_bss_wpa
op_ge
id|MAX_BSS_WPA_IE_COUNT
)paren
(brace
id|bss
op_assign
id|list_entry
c_func
(paren
id|priv-&gt;bss_wpa_list.prev
comma
r_struct
id|islpci_bss_wpa_ie
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|bss-&gt;list
)paren
suffix:semicolon
)brace
r_else
(brace
id|bss
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|bss
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bss
op_ne
l_int|NULL
)paren
(brace
id|priv-&gt;num_bss_wpa
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|bss
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|bss
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bss
op_ne
l_int|NULL
)paren
(brace
id|memcpy
c_func
(paren
id|bss-&gt;bssid
comma
id|bssid
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|bss-&gt;list
comma
op_amp
id|priv-&gt;bss_wpa_list
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bss
op_ne
l_int|NULL
)paren
(brace
id|memcpy
c_func
(paren
id|bss-&gt;wpa_ie
comma
id|wpa_ie
comma
id|wpa_ie_len
)paren
suffix:semicolon
id|bss-&gt;wpa_ie_len
op_assign
id|wpa_ie_len
suffix:semicolon
id|bss-&gt;last_update
op_assign
id|jiffies
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Failed to add BSS WPA entry for &quot;
id|MACSTR
l_string|&quot;&bslash;n&quot;
comma
id|MAC2STR
c_func
(paren
id|bssid
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* expire old entries from WPA list */
r_while
c_loop
(paren
id|priv-&gt;num_bss_wpa
OG
l_int|0
)paren
(brace
id|bss
op_assign
id|list_entry
c_func
(paren
id|priv-&gt;bss_wpa_list.prev
comma
r_struct
id|islpci_bss_wpa_ie
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|time_after
c_func
(paren
id|jiffies
comma
id|bss-&gt;last_update
op_plus
l_int|60
op_star
id|HZ
)paren
)paren
r_break
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|bss-&gt;list
)paren
suffix:semicolon
id|priv-&gt;num_bss_wpa
op_decrement
suffix:semicolon
id|kfree
c_func
(paren
id|bss
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|priv-&gt;wpa_sem
)paren
suffix:semicolon
)brace
r_int
DECL|function|prism54_wpa_ie_get
id|prism54_wpa_ie_get
c_func
(paren
id|islpci_private
op_star
id|priv
comma
id|u8
op_star
id|bssid
comma
id|u8
op_star
id|wpa_ie
)paren
(brace
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
r_struct
id|islpci_bss_wpa_ie
op_star
id|bss
op_assign
l_int|NULL
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|priv-&gt;wpa_sem
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|list_for_each
c_func
(paren
id|ptr
comma
op_amp
id|priv-&gt;bss_wpa_list
)paren
(brace
id|bss
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|islpci_bss_wpa_ie
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|bss-&gt;bssid
comma
id|bssid
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|bss
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bss
)paren
(brace
id|len
op_assign
id|bss-&gt;wpa_ie_len
suffix:semicolon
id|memcpy
c_func
(paren
id|wpa_ie
comma
id|bss-&gt;wpa_ie
comma
id|len
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|priv-&gt;wpa_sem
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_void
DECL|function|prism54_wpa_ie_init
id|prism54_wpa_ie_init
c_func
(paren
id|islpci_private
op_star
id|priv
)paren
(brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|priv-&gt;bss_wpa_list
)paren
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|priv-&gt;wpa_sem
comma
l_int|1
)paren
suffix:semicolon
)brace
r_void
DECL|function|prism54_wpa_ie_clean
id|prism54_wpa_ie_clean
c_func
(paren
id|islpci_private
op_star
id|priv
)paren
(brace
r_struct
id|list_head
op_star
id|ptr
comma
op_star
id|n
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|ptr
comma
id|n
comma
op_amp
id|priv-&gt;bss_wpa_list
)paren
(brace
r_struct
id|islpci_bss_wpa_ie
op_star
id|bss
suffix:semicolon
id|bss
op_assign
id|list_entry
c_func
(paren
id|ptr
comma
r_struct
id|islpci_bss_wpa_ie
comma
id|list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bss
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|prism54_process_bss_data
id|prism54_process_bss_data
c_func
(paren
id|islpci_private
op_star
id|priv
comma
id|u32
id|oid
comma
id|u8
op_star
id|addr
comma
id|u8
op_star
id|payload
comma
r_int
id|len
)paren
(brace
r_struct
id|ieee80211_beacon_phdr
op_star
id|hdr
suffix:semicolon
id|u8
op_star
id|pos
comma
op_star
id|end
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wpa
)paren
r_return
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|ieee80211_beacon_phdr
op_star
)paren
id|payload
suffix:semicolon
id|pos
op_assign
(paren
id|u8
op_star
)paren
(paren
id|hdr
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|payload
op_plus
id|len
suffix:semicolon
r_while
c_loop
(paren
id|pos
OL
id|end
)paren
(brace
r_if
c_cond
(paren
id|pos
op_plus
l_int|2
op_plus
id|pos
(braket
l_int|1
)braket
OG
id|end
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Parsing Beacon/ProbeResp failed &quot;
l_string|&quot;for &quot;
id|MACSTR
l_string|&quot;&bslash;n&quot;
comma
id|MAC2STR
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
(braket
l_int|0
)braket
op_eq
id|WLAN_EID_GENERIC
op_logical_and
id|pos
(braket
l_int|1
)braket
op_ge
l_int|4
op_logical_and
id|memcmp
c_func
(paren
id|pos
op_plus
l_int|2
comma
id|wpa_oid
comma
l_int|4
)paren
op_eq
l_int|0
)paren
(brace
id|prism54_wpa_ie_add
c_func
(paren
id|priv
comma
id|addr
comma
id|pos
comma
id|pos
(braket
l_int|1
)braket
op_plus
l_int|2
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pos
op_add_assign
l_int|2
op_plus
id|pos
(braket
l_int|1
)braket
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|handle_request
id|handle_request
c_func
(paren
id|islpci_private
op_star
id|priv
comma
r_struct
id|obj_mlme
op_star
id|mlme
comma
r_enum
id|oid_num_t
id|oid
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|mlme-&gt;state
op_eq
id|DOT11_STATE_AUTHING
)paren
op_logical_or
(paren
id|mlme-&gt;state
op_eq
id|DOT11_STATE_ASSOCING
)paren
)paren
op_logical_and
id|mgt_mlme_answer
c_func
(paren
id|priv
)paren
)paren
(brace
multiline_comment|/* Someone is requesting auth and we must respond. Just send back&n;&t;&t; * the trap with error code set accordingly.&n;&t;&t; */
id|mlme-&gt;code
op_assign
id|prism54_mac_accept
c_func
(paren
op_amp
id|priv-&gt;acl
comma
id|mlme-&gt;address
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|oid
comma
l_int|0
comma
id|mlme
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|prism54_process_trap_helper
id|prism54_process_trap_helper
c_func
(paren
id|islpci_private
op_star
id|priv
comma
r_enum
id|oid_num_t
id|oid
comma
r_char
op_star
id|data
)paren
(brace
r_struct
id|obj_mlme
op_star
id|mlme
op_assign
(paren
r_struct
id|obj_mlme
op_star
)paren
id|data
suffix:semicolon
r_struct
id|obj_mlmeex
op_star
id|mlmeex
op_assign
(paren
r_struct
id|obj_mlmeex
op_star
)paren
id|data
suffix:semicolon
r_struct
id|obj_mlmeex
op_star
id|confirm
suffix:semicolon
id|u8
id|wpa_ie
(braket
id|MAX_WPA_IE_LEN
)braket
suffix:semicolon
r_int
id|wpa_ie_len
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* u16, better? */
id|u8
op_star
id|payload
op_assign
l_int|0
comma
op_star
id|pos
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* I think all trapable objects are listed here.&n;&t; * Some oids have a EX version. The difference is that they are emitted&n;&t; * in DOT11_MLME_EXTENDED mode (set with DOT11_OID_MLMEAUTOLEVEL)&n;&t; * with more info.&n;&t; * The few events already defined by the wireless tools are not really&n;&t; * suited. We use the more flexible custom event facility.&n;&t; */
r_if
c_cond
(paren
id|oid
op_ge
id|DOT11_OID_BEACON
)paren
(brace
id|len
op_assign
id|mlmeex-&gt;size
suffix:semicolon
id|payload
op_assign
id|pos
op_assign
id|mlmeex-&gt;data
suffix:semicolon
)brace
multiline_comment|/* I fear prism54_process_bss_data won&squot;t work with big endian data */
r_if
c_cond
(paren
(paren
id|oid
op_eq
id|DOT11_OID_BEACON
)paren
op_logical_or
(paren
id|oid
op_eq
id|DOT11_OID_PROBE
)paren
)paren
id|prism54_process_bss_data
c_func
(paren
id|priv
comma
id|oid
comma
id|mlmeex-&gt;address
comma
id|payload
comma
id|len
)paren
suffix:semicolon
id|mgt_le_to_cpu
c_func
(paren
id|isl_oid
(braket
id|oid
)braket
dot
id|flags
op_amp
id|OID_FLAG_TYPE
comma
(paren
r_void
op_star
)paren
id|mlme
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|oid
)paren
(brace
r_case
id|GEN_OID_LINKSTATE
suffix:colon
id|link_changed
c_func
(paren
id|priv-&gt;ndev
comma
(paren
id|u32
)paren
op_star
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_MICFAILURE
suffix:colon
id|send_simple_event
c_func
(paren
id|priv
comma
l_string|&quot;Mic failure&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_DEAUTHENTICATE
suffix:colon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;DeAuthenticate request&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_AUTHENTICATE
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Authenticate request&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_DISASSOCIATE
suffix:colon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Disassociate request&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_ASSOCIATE
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Associate request&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_REASSOCIATE
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;ReAssociate request&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_BEACON
suffix:colon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Received a beacon from an unkown AP&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_PROBE
suffix:colon
multiline_comment|/* we received a probe from a client. */
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Received a probe from client&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Note : &quot;mlme&quot; is actually a &quot;struct obj_mlmeex *&quot; here, but this&n;&t;&t; * is backward compatible layout-wise with &quot;struct obj_mlme&quot;.&n;&t;&t; */
r_case
id|DOT11_OID_DEAUTHENTICATEEX
suffix:colon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;DeAuthenticate request&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_AUTHENTICATEEX
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Authenticate request (ex)&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_MASTER
op_logical_and
id|mlmeex-&gt;state
op_ne
id|DOT11_STATE_AUTHING
)paren
r_break
suffix:semicolon
id|confirm
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|obj_mlmeex
)paren
op_plus
l_int|6
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|confirm
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|confirm-&gt;address
comma
id|mlmeex-&gt;address
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Authenticate from: address:&bslash;t%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|mlmeex-&gt;address
(braket
l_int|0
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|1
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|2
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|3
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|4
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|confirm-&gt;id
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* or mlmeex-&gt;id ? */
id|confirm-&gt;state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
id|confirm-&gt;code
op_assign
l_int|0
suffix:semicolon
id|confirm-&gt;size
op_assign
l_int|6
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|2
)braket
op_assign
l_int|0x02
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|4
)braket
op_assign
l_int|0x00
suffix:semicolon
id|confirm-&gt;data
(braket
l_int|5
)braket
op_assign
l_int|0x00
suffix:semicolon
id|ret
op_assign
id|mgt_set_varlen
c_func
(paren
id|priv
comma
id|DOT11_OID_ASSOCIATEEX
comma
id|confirm
comma
l_int|6
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|confirm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_DISASSOCIATEEX
suffix:colon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Disassociate request (ex)&quot;
comma
id|mlme
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_ASSOCIATEEX
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Associate request (ex)&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_MASTER
op_logical_and
id|mlmeex-&gt;state
op_ne
id|DOT11_STATE_AUTHING
)paren
r_break
suffix:semicolon
id|confirm
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|obj_mlmeex
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|confirm
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|confirm-&gt;address
comma
id|mlmeex-&gt;address
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|confirm-&gt;id
op_assign
(paren
(paren
r_struct
id|obj_mlmeex
op_star
)paren
id|mlme
)paren
op_member_access_from_pointer
id|id
suffix:semicolon
id|confirm-&gt;state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
id|confirm-&gt;code
op_assign
l_int|0
suffix:semicolon
id|wpa_ie_len
op_assign
id|prism54_wpa_ie_get
c_func
(paren
id|priv
comma
id|mlmeex-&gt;address
comma
id|wpa_ie
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wpa_ie_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;No WPA IE found from &quot;
l_string|&quot;address:&bslash;t%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|mlmeex-&gt;address
(braket
l_int|0
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|1
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|2
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|3
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|4
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|confirm-&gt;size
op_assign
id|wpa_ie_len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|confirm-&gt;data
comma
id|wpa_ie
comma
id|wpa_ie_len
)paren
suffix:semicolon
id|mgt_set_varlen
c_func
(paren
id|priv
comma
id|oid
comma
id|confirm
comma
id|wpa_ie_len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DOT11_OID_REASSOCIATEEX
suffix:colon
id|handle_request
c_func
(paren
id|priv
comma
id|mlme
comma
id|oid
)paren
suffix:semicolon
id|send_formatted_event
c_func
(paren
id|priv
comma
l_string|&quot;Reassociate request (ex)&quot;
comma
id|mlme
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_MASTER
op_logical_and
id|mlmeex-&gt;state
op_ne
id|DOT11_STATE_ASSOCING
)paren
r_break
suffix:semicolon
id|confirm
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|obj_mlmeex
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|confirm
)paren
r_break
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|confirm-&gt;address
comma
id|mlmeex-&gt;address
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|confirm-&gt;id
op_assign
id|mlmeex-&gt;id
suffix:semicolon
id|confirm-&gt;state
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not used */
id|confirm-&gt;code
op_assign
l_int|0
suffix:semicolon
id|wpa_ie_len
op_assign
id|prism54_wpa_ie_get
c_func
(paren
id|priv
comma
id|mlmeex-&gt;address
comma
id|wpa_ie
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wpa_ie_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;No WPA IE found from &quot;
l_string|&quot;address:&bslash;t%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|mlmeex-&gt;address
(braket
l_int|0
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|1
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|2
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|3
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|4
)braket
comma
id|mlmeex-&gt;address
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|confirm-&gt;size
op_assign
id|wpa_ie_len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|confirm-&gt;data
comma
id|wpa_ie
comma
id|wpa_ie_len
)paren
suffix:semicolon
id|mgt_set_varlen
c_func
(paren
id|priv
comma
id|oid
comma
id|confirm
comma
id|wpa_ie_len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Process a device trap.  This is called via schedule_work(), outside of&n; * interrupt context, no locks held.&n; */
r_void
DECL|function|prism54_process_trap
id|prism54_process_trap
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|islpci_mgmtframe
op_star
id|frame
op_assign
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|ndev
op_assign
id|frame-&gt;ndev
suffix:semicolon
r_enum
id|oid_num_t
id|n
op_assign
id|mgt_oidtonum
c_func
(paren
id|frame-&gt;header-&gt;oid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_ne
id|OID_NUM_LAST
)paren
id|prism54_process_trap_helper
c_func
(paren
id|netdev_priv
c_func
(paren
id|ndev
)paren
comma
id|n
comma
id|frame-&gt;data
)paren
suffix:semicolon
id|islpci_mgt_release
c_func
(paren
id|frame
)paren
suffix:semicolon
)brace
r_int
DECL|function|prism54_set_mac_address
id|prism54_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_void
op_star
id|addr
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|ndev-&gt;addr_len
op_ne
l_int|6
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|GEN_OID_MACADDRESS
comma
l_int|0
comma
op_amp
(paren
(paren
r_struct
id|sockaddr
op_star
)paren
id|addr
)paren
op_member_access_from_pointer
id|sa_data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|memcpy
c_func
(paren
id|priv-&gt;ndev-&gt;dev_addr
comma
op_amp
(paren
(paren
r_struct
id|sockaddr
op_star
)paren
id|addr
)paren
op_member_access_from_pointer
id|sa_data
comma
l_int|6
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Note: currently, use hostapd ioctl from the Host AP driver for WPA&n; * support. This is to be replaced with Linux wireless extensions once they&n; * get WPA support. */
multiline_comment|/* Note II: please leave all this together as it will be easier to remove later,&n; * once wireless extensions add WPA support -mcgrof */
multiline_comment|/* PRISM54_HOSTAPD ioctl() cmd: */
r_enum
(brace
DECL|enumerator|PRISM2_SET_ENCRYPTION
id|PRISM2_SET_ENCRYPTION
op_assign
l_int|6
comma
DECL|enumerator|PRISM2_HOSTAPD_SET_GENERIC_ELEMENT
id|PRISM2_HOSTAPD_SET_GENERIC_ELEMENT
op_assign
l_int|12
comma
DECL|enumerator|PRISM2_HOSTAPD_MLME
id|PRISM2_HOSTAPD_MLME
op_assign
l_int|13
comma
DECL|enumerator|PRISM2_HOSTAPD_SCAN_REQ
id|PRISM2_HOSTAPD_SCAN_REQ
op_assign
l_int|14
comma
)brace
suffix:semicolon
DECL|macro|PRISM54_SET_WPA
mdefine_line|#define PRISM54_SET_WPA&t;&t;&t;SIOCIWFIRSTPRIV+12
DECL|macro|PRISM54_HOSTAPD
mdefine_line|#define PRISM54_HOSTAPD&t;&t;&t;SIOCIWFIRSTPRIV+25
DECL|macro|PRISM54_DROP_UNENCRYPTED
mdefine_line|#define PRISM54_DROP_UNENCRYPTED&t;SIOCIWFIRSTPRIV+26
DECL|macro|PRISM2_HOSTAPD_MAX_BUF_SIZE
mdefine_line|#define PRISM2_HOSTAPD_MAX_BUF_SIZE 1024
DECL|macro|PRISM2_HOSTAPD_GENERIC_ELEMENT_HDR_LEN
mdefine_line|#define PRISM2_HOSTAPD_GENERIC_ELEMENT_HDR_LEN &bslash;&n;((int) (&amp;((struct prism2_hostapd_param *) 0)-&gt;u.generic_elem.data))
multiline_comment|/* Maximum length for algorithm names (-1 for nul termination) &n; * used in ioctl() */
DECL|macro|HOSTAP_CRYPT_ALG_NAME_LEN
mdefine_line|#define HOSTAP_CRYPT_ALG_NAME_LEN 16
DECL|struct|prism2_hostapd_param
r_struct
id|prism2_hostapd_param
(brace
DECL|member|cmd
id|u32
id|cmd
suffix:semicolon
DECL|member|sta_addr
id|u8
id|sta_addr
(braket
id|ETH_ALEN
)braket
suffix:semicolon
r_union
(brace
r_struct
(brace
DECL|member|alg
id|u8
id|alg
(braket
id|HOSTAP_CRYPT_ALG_NAME_LEN
)braket
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|err
id|u32
id|err
suffix:semicolon
DECL|member|idx
id|u8
id|idx
suffix:semicolon
DECL|member|seq
id|u8
id|seq
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* sequence counter (set: RX, get: TX) */
DECL|member|key_len
id|u16
id|key_len
suffix:semicolon
DECL|member|key
id|u8
id|key
(braket
l_int|0
)braket
suffix:semicolon
DECL|member|crypt
)brace
id|crypt
suffix:semicolon
r_struct
(brace
DECL|member|len
id|u8
id|len
suffix:semicolon
DECL|member|data
id|u8
id|data
(braket
l_int|0
)braket
suffix:semicolon
DECL|member|generic_elem
)brace
id|generic_elem
suffix:semicolon
r_struct
(brace
DECL|macro|MLME_STA_DEAUTH
mdefine_line|#define MLME_STA_DEAUTH 0
DECL|macro|MLME_STA_DISASSOC
mdefine_line|#define MLME_STA_DISASSOC 1
DECL|member|cmd
id|u16
id|cmd
suffix:semicolon
DECL|member|reason_code
id|u16
id|reason_code
suffix:semicolon
DECL|member|mlme
)brace
id|mlme
suffix:semicolon
r_struct
(brace
DECL|member|ssid_len
id|u8
id|ssid_len
suffix:semicolon
DECL|member|ssid
id|u8
id|ssid
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|scan_req
)brace
id|scan_req
suffix:semicolon
DECL|member|u
)brace
id|u
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
DECL|function|prism2_ioctl_set_encryption
id|prism2_ioctl_set_encryption
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|prism2_hostapd_param
op_star
id|param
comma
r_int
id|param_len
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|rvalue
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
suffix:semicolon
r_int
id|authen
op_assign
id|DOT11_AUTH_OS
comma
id|invoke
op_assign
l_int|0
comma
id|exunencrypt
op_assign
l_int|0
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
multiline_comment|/* with the new API, it&squot;s impossible to get a NULL pointer.&n;&t; * New version of iwconfig set the IW_ENCODE_NOKEY flag&n;&t; * when no key is given, but older versions don&squot;t. */
r_if
c_cond
(paren
id|param-&gt;u.crypt.key_len
OG
l_int|0
)paren
(brace
multiline_comment|/* we have a key to set */
r_int
id|index
op_assign
id|param-&gt;u.crypt.idx
suffix:semicolon
r_int
id|current_index
suffix:semicolon
r_struct
id|obj_key
id|key
op_assign
(brace
id|DOT11_PRIV_TKIP
comma
l_int|0
comma
l_string|&quot;&quot;
)brace
suffix:semicolon
multiline_comment|/* get the current key index */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYID
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|current_index
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Verify that the key is not marked as invalid */
r_if
c_cond
(paren
op_logical_neg
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_NOKEY
)paren
)paren
(brace
id|key.length
op_assign
id|param-&gt;u.crypt.key_len
OG
r_sizeof
(paren
id|param-&gt;u.crypt.key
)paren
ques
c_cond
r_sizeof
(paren
id|param-&gt;u.crypt.key
)paren
suffix:colon
id|param-&gt;u.crypt.key_len
suffix:semicolon
id|memcpy
c_func
(paren
id|key.key
comma
id|param-&gt;u.crypt.key
comma
id|key.length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|key.length
op_eq
l_int|32
)paren
multiline_comment|/* we want WPA-PSK */
id|key.type
op_assign
id|DOT11_PRIV_TKIP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
OG
l_int|3
)paren
)paren
multiline_comment|/* no index provided use the current one */
id|index
op_assign
id|current_index
suffix:semicolon
multiline_comment|/* now send the key to the card  */
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYX
comma
id|index
comma
op_amp
id|key
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * If a valid key is set, encryption should be enabled &n;&t;&t; * (user may turn it off later).&n;&t;&t; * This is also how &quot;iwconfig ethX key on&quot; works&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|index
op_eq
id|current_index
)paren
op_logical_and
(paren
id|key.length
OG
l_int|0
)paren
)paren
id|force
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
id|index
op_assign
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
op_ge
l_int|0
)paren
op_logical_and
(paren
id|index
op_le
l_int|3
)paren
)paren
(brace
multiline_comment|/* we want to set the key index */
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DEFKEYID
comma
l_int|0
comma
op_amp
id|index
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_MODE
)paren
(brace
multiline_comment|/* we cannot do anything. Complain. */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* now read the flags */
r_if
c_cond
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_DISABLED
)paren
(brace
multiline_comment|/* Encoding disabled, &n;&t;&t; * authen = DOT11_AUTH_OS;&n;&t;&t; * invoke = 0;&n;&t;&t; * exunencrypt = 0; */
)brace
r_if
c_cond
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_OPEN
)paren
multiline_comment|/* Encode but accept non-encoded packets. No auth */
id|invoke
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
op_logical_or
id|force
)paren
(brace
multiline_comment|/* Refuse non-encoded packets. Auth */
id|authen
op_assign
id|DOT11_AUTH_BOTH
suffix:semicolon
id|invoke
op_assign
l_int|1
suffix:semicolon
id|exunencrypt
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* do the change if requested  */
r_if
c_cond
(paren
(paren
id|param-&gt;u.crypt.flags
op_amp
id|IW_ENCODE_MODE
)paren
op_logical_or
id|force
)paren
(brace
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_AUTHENABLE
comma
l_int|0
comma
op_amp
id|authen
)paren
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVACYINVOKED
comma
l_int|0
comma
op_amp
id|invoke
)paren
suffix:semicolon
id|rvalue
op_or_assign
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
l_int|0
comma
op_amp
id|exunencrypt
)paren
suffix:semicolon
)brace
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism2_ioctl_set_generic_element
id|prism2_ioctl_set_generic_element
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|prism2_hostapd_param
op_star
id|param
comma
r_int
id|param_len
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|max_len
comma
id|len
comma
id|alen
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|obj_attachment
op_star
id|attach
suffix:semicolon
id|len
op_assign
id|param-&gt;u.generic_elem.len
suffix:semicolon
id|max_len
op_assign
id|param_len
op_minus
id|PRISM2_HOSTAPD_GENERIC_ELEMENT_HDR_LEN
suffix:semicolon
r_if
c_cond
(paren
id|max_len
OL
l_int|0
op_logical_or
id|max_len
OL
id|len
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|alen
op_assign
r_sizeof
(paren
op_star
id|attach
)paren
op_plus
id|len
suffix:semicolon
id|attach
op_assign
id|kmalloc
c_func
(paren
id|alen
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attach
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|attach
comma
l_int|0
comma
id|alen
)paren
suffix:semicolon
DECL|macro|WLAN_FC_TYPE_MGMT
mdefine_line|#define WLAN_FC_TYPE_MGMT 0
DECL|macro|WLAN_FC_STYPE_ASSOC_REQ
mdefine_line|#define WLAN_FC_STYPE_ASSOC_REQ 0
DECL|macro|WLAN_FC_STYPE_REASSOC_REQ
mdefine_line|#define WLAN_FC_STYPE_REASSOC_REQ 2
multiline_comment|/* Note: endianness is covered by mgt_set_varlen */
id|attach-&gt;type
op_assign
(paren
id|WLAN_FC_TYPE_MGMT
op_lshift
l_int|2
)paren
op_or
(paren
id|WLAN_FC_STYPE_ASSOC_REQ
op_lshift
l_int|4
)paren
suffix:semicolon
id|attach-&gt;id
op_assign
op_minus
l_int|1
suffix:semicolon
id|attach-&gt;size
op_assign
id|len
suffix:semicolon
id|memcpy
c_func
(paren
id|attach-&gt;data
comma
id|param-&gt;u.generic_elem.data
comma
id|len
)paren
suffix:semicolon
id|ret
op_assign
id|mgt_set_varlen
c_func
(paren
id|priv
comma
id|DOT11_OID_ATTACHMENT
comma
id|attach
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
id|attach-&gt;type
op_assign
(paren
id|WLAN_FC_TYPE_MGMT
op_lshift
l_int|2
)paren
op_or
(paren
id|WLAN_FC_STYPE_REASSOC_REQ
op_lshift
l_int|4
)paren
suffix:semicolon
id|ret
op_assign
id|mgt_set_varlen
c_func
(paren
id|priv
comma
id|DOT11_OID_ATTACHMENT
comma
id|attach
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: WPA IE Attachment was set&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|attach
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism2_ioctl_mlme
id|prism2_ioctl_mlme
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|prism2_hostapd_param
op_star
id|param
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism2_ioctl_scan_req
id|prism2_ioctl_scan_req
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|prism2_hostapd_param
op_star
id|param
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_int
id|i
comma
id|rvalue
suffix:semicolon
r_struct
id|obj_bsslist
op_star
id|bsslist
suffix:semicolon
id|u32
id|noise
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|extra
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_char
op_star
id|current_ev
op_assign
l_string|&quot;foo&quot;
suffix:semicolon
r_union
id|oid_res_t
id|r
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
OL
id|PRV_STATE_INIT
)paren
(brace
multiline_comment|/* device is not ready, fail gently */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* first get the noise value. We will use it to report the link quality */
id|rvalue
op_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_NOISEFLOOR
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|noise
op_assign
id|r.u
suffix:semicolon
multiline_comment|/* Ask the device for a list of known bss. We can report at most&n;&t; * IW_MAX_AP=64 to the range struct. But the device won&squot;t repport anything&n;&t; * if you change the value of IWMAX_BSS=24.&n;&t; */
id|rvalue
op_or_assign
id|mgt_get_request
c_func
(paren
id|priv
comma
id|DOT11_OID_BSSLIST
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|r
)paren
suffix:semicolon
id|bsslist
op_assign
id|r.ptr
suffix:semicolon
multiline_comment|/* ok now, scan the list and translate its info */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|min
c_func
(paren
id|IW_MAX_AP
comma
(paren
r_int
)paren
id|bsslist-&gt;nr
)paren
suffix:semicolon
id|i
op_increment
)paren
id|current_ev
op_assign
id|prism54_translate_bss
c_func
(paren
id|ndev
comma
id|current_ev
comma
id|extra
op_plus
id|IW_SCAN_MAX_DATA
comma
op_amp
(paren
id|bsslist-&gt;bsslist
(braket
id|i
)braket
)paren
comma
id|noise
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bsslist
)paren
suffix:semicolon
r_return
id|rvalue
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_hostapd
id|prism54_hostapd
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_point
op_star
id|p
)paren
(brace
r_struct
id|prism2_hostapd_param
op_star
id|param
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|u32
id|uwrq
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;prism54_hostapd - len=%d&bslash;n&quot;
comma
id|p-&gt;length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;length
template_param
id|PRISM2_HOSTAPD_MAX_BUF_SIZE
op_logical_or
op_logical_neg
id|p-&gt;pointer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|param
op_assign
(paren
r_struct
id|prism2_hostapd_param
op_star
)paren
id|kmalloc
c_func
(paren
id|p-&gt;length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|param
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|param
comma
id|p-&gt;pointer
comma
id|p-&gt;length
)paren
)paren
(brace
id|kfree
c_func
(paren
id|param
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|param-&gt;cmd
)paren
(brace
r_case
id|PRISM2_SET_ENCRYPTION
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA supplicant set encryption request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
id|prism2_ioctl_set_encryption
c_func
(paren
id|ndev
comma
id|param
comma
id|p-&gt;length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PRISM2_HOSTAPD_SET_GENERIC_ELEMENT
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA supplicant set WPA IE request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
id|prism2_ioctl_set_generic_element
c_func
(paren
id|ndev
comma
id|param
comma
id|p-&gt;length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PRISM2_HOSTAPD_MLME
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA supplicant MLME request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
id|prism2_ioctl_mlme
c_func
(paren
id|ndev
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PRISM2_HOSTAPD_SCAN_REQ
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA supplicant scan request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
id|prism2_ioctl_scan_req
c_func
(paren
id|ndev
comma
id|param
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PRISM54_SET_WPA
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA supplicant wpa init request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|uwrq
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
id|prism54_set_wpa
c_func
(paren
id|ndev
comma
l_int|NULL
comma
op_amp
id|uwrq
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PRISM54_DROP_UNENCRYPTED
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught WPA drop unencrypted request&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
macro_line|#if 0
id|uwrq
op_assign
l_int|0x01
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
op_amp
id|uwrq
)paren
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|mgt_commit
c_func
(paren
id|priv
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Not necessary, as set_wpa does it, should we just do it here though? */
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Caught a WPA supplicant request that is not supported&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
op_logical_and
id|copy_to_user
c_func
(paren
id|p-&gt;pointer
comma
id|param
comma
id|p-&gt;length
)paren
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|kfree
c_func
(paren
id|param
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|prism54_set_wpa
id|prism54_set_wpa
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|mlme
comma
id|authen
comma
id|dot1x
comma
id|filter
comma
id|wep
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
OL
id|PRV_STATE_INIT
)paren
r_return
l_int|0
suffix:semicolon
id|wep
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* For privacy invoked */
id|filter
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Filter out all unencrypted frames */
id|dot1x
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* To enable eap filter */
id|mlme
op_assign
id|DOT11_MLME_EXTENDED
suffix:semicolon
id|authen
op_assign
id|DOT11_AUTH_OS
suffix:semicolon
multiline_comment|/* Only WEP uses _SK and _BOTH */
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|priv-&gt;wpa
op_assign
op_star
id|uwrq
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;wpa
)paren
(brace
r_default
suffix:colon
r_case
l_int|0
suffix:colon
multiline_comment|/* Clears/disables WPA and friends */
id|wep
op_assign
l_int|0
suffix:semicolon
id|filter
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Do not filter un-encrypted data */
id|dot1x
op_assign
l_int|0
suffix:semicolon
id|mlme
op_assign
id|DOT11_MLME_AUTO
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Disabling WPA&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|1
suffix:colon
multiline_comment|/* WPA */
id|printk
c_func
(paren
l_string|&quot;%s: Enabling WPA&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_AUTHENABLE
comma
l_int|0
comma
op_amp
id|authen
)paren
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_PRIVACYINVOKED
comma
l_int|0
comma
op_amp
id|wep
)paren
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_EXUNENCRYPTED
comma
l_int|0
comma
op_amp
id|filter
)paren
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_DOT1XENABLE
comma
l_int|0
comma
op_amp
id|dot1x
)paren
suffix:semicolon
id|mgt_set_request
c_func
(paren
id|priv
comma
id|DOT11_OID_MLMEAUTOLEVEL
comma
l_int|0
comma
op_amp
id|mlme
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_get_wpa
id|prism54_get_wpa
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
op_star
id|uwrq
op_assign
id|priv-&gt;wpa
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_set_prismhdr
id|prism54_set_prismhdr
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|priv-&gt;monitor_type
op_assign
(paren
op_star
id|uwrq
ques
c_cond
id|ARPHRD_IEEE80211_PRISM
suffix:colon
id|ARPHRD_IEEE80211
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_MONITOR
)paren
id|priv-&gt;ndev-&gt;type
op_assign
id|priv-&gt;monitor_type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_get_prismhdr
id|prism54_get_prismhdr
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
op_star
id|uwrq
op_assign
(paren
id|priv-&gt;monitor_type
op_eq
id|ARPHRD_IEEE80211_PRISM
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_debug_oid
id|prism54_debug_oid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
id|__u32
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|priv-&gt;priv_oid
op_assign
op_star
id|uwrq
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: oid 0x%08X&bslash;n&quot;
comma
id|ndev-&gt;name
comma
op_star
id|uwrq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|prism54_debug_get_oid
id|prism54_debug_get_oid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|data
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_mgmtframe
op_star
id|response
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: get_oid 0x%08X&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|priv-&gt;priv_oid
)paren
suffix:semicolon
id|data-&gt;length
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
op_ge
id|PRV_STATE_INIT
)paren
(brace
id|ret
op_assign
id|islpci_mgt_transaction
c_func
(paren
id|priv-&gt;ndev
comma
id|PIMFOR_OP_GET
comma
id|priv-&gt;priv_oid
comma
id|extra
comma
l_int|256
comma
op_amp
id|response
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ret: %i&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|ret
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_logical_or
op_logical_neg
id|response
op_logical_or
id|response-&gt;header-&gt;operation
op_eq
id|PIMFOR_OP_ERROR
)paren
(brace
r_if
c_cond
(paren
id|response
)paren
(brace
id|islpci_mgt_release
c_func
(paren
id|response
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: EIO&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|data-&gt;length
op_assign
id|response-&gt;header-&gt;length
suffix:semicolon
id|memcpy
c_func
(paren
id|extra
comma
id|response-&gt;data
comma
id|data-&gt;length
)paren
suffix:semicolon
id|islpci_mgt_release
c_func
(paren
id|response
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: len: %i&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|data-&gt;length
)paren
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|prism54_debug_set_oid
id|prism54_debug_set_oid
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_struct
id|iw_point
op_star
id|data
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_struct
id|islpci_mgmtframe
op_star
id|response
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
comma
id|response_op
op_assign
id|PIMFOR_OP_ERROR
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: set_oid 0x%08X&bslash;tlen: %d&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|priv-&gt;priv_oid
comma
id|data-&gt;length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|islpci_get_state
c_func
(paren
id|priv
)paren
op_ge
id|PRV_STATE_INIT
)paren
(brace
id|ret
op_assign
id|islpci_mgt_transaction
c_func
(paren
id|priv-&gt;ndev
comma
id|PIMFOR_OP_SET
comma
id|priv-&gt;priv_oid
comma
id|extra
comma
id|data-&gt;length
comma
op_amp
id|response
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ret: %i&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|ret
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_logical_or
op_logical_neg
id|response
op_logical_or
id|response-&gt;header-&gt;operation
op_eq
id|PIMFOR_OP_ERROR
)paren
(brace
r_if
c_cond
(paren
id|response
)paren
(brace
id|islpci_mgt_release
c_func
(paren
id|response
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: EIO&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|response_op
op_assign
id|response-&gt;header-&gt;operation
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: response_op: %i&bslash;n&quot;
comma
id|ndev-&gt;name
comma
id|response_op
)paren
suffix:semicolon
id|islpci_mgt_release
c_func
(paren
id|response
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
id|ret
ques
c_cond
id|ret
suffix:colon
op_minus
id|EINPROGRESS
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|prism54_set_spy
id|prism54_set_spy
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|iw_request_info
op_star
id|info
comma
r_union
id|iwreq_data
op_star
id|uwrq
comma
r_char
op_star
id|extra
)paren
(brace
id|islpci_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|u32
id|u
comma
id|oid
op_assign
id|OID_INL_CONFIG
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
id|mgt_get
c_func
(paren
id|priv
comma
id|OID_INL_CONFIG
comma
op_amp
id|u
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|uwrq-&gt;data.length
op_eq
l_int|0
)paren
op_logical_and
(paren
id|priv-&gt;spy_data.spy_number
OG
l_int|0
)paren
)paren
multiline_comment|/* disable spy */
id|u
op_and_assign
op_complement
id|INL_CONFIG_RXANNEX
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|uwrq-&gt;data.length
OG
l_int|0
)paren
op_logical_and
(paren
id|priv-&gt;spy_data.spy_number
op_eq
l_int|0
)paren
)paren
multiline_comment|/* enable spy */
id|u
op_or_assign
id|INL_CONFIG_RXANNEX
suffix:semicolon
id|mgt_set
c_func
(paren
id|priv
comma
id|OID_INL_CONFIG
comma
op_amp
id|u
)paren
suffix:semicolon
id|mgt_commit_list
c_func
(paren
id|priv
comma
op_amp
id|oid
comma
l_int|1
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|priv-&gt;mib_sem
)paren
suffix:semicolon
r_return
id|iw_handler_set_spy
c_func
(paren
id|ndev
comma
id|info
comma
id|uwrq
comma
id|extra
)paren
suffix:semicolon
)brace
DECL|variable|prism54_handler
r_static
r_const
id|iw_handler
id|prism54_handler
(braket
)braket
op_assign
(brace
(paren
id|iw_handler
)paren
id|prism54_commit
comma
multiline_comment|/* SIOCSIWCOMMIT */
(paren
id|iw_handler
)paren
id|prism54_get_name
comma
multiline_comment|/* SIOCGIWNAME */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWNWID */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWNWID */
(paren
id|iw_handler
)paren
id|prism54_set_freq
comma
multiline_comment|/* SIOCSIWFREQ */
(paren
id|iw_handler
)paren
id|prism54_get_freq
comma
multiline_comment|/* SIOCGIWFREQ */
(paren
id|iw_handler
)paren
id|prism54_set_mode
comma
multiline_comment|/* SIOCSIWMODE */
(paren
id|iw_handler
)paren
id|prism54_get_mode
comma
multiline_comment|/* SIOCGIWMODE */
(paren
id|iw_handler
)paren
id|prism54_set_sens
comma
multiline_comment|/* SIOCSIWSENS */
(paren
id|iw_handler
)paren
id|prism54_get_sens
comma
multiline_comment|/* SIOCGIWSENS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWRANGE */
(paren
id|iw_handler
)paren
id|prism54_get_range
comma
multiline_comment|/* SIOCGIWRANGE */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWPRIV */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWPRIV */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWSTATS */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWSTATS */
id|prism54_set_spy
comma
multiline_comment|/* SIOCSIWSPY */
id|iw_handler_get_spy
comma
multiline_comment|/* SIOCGIWSPY */
id|iw_handler_set_thrspy
comma
multiline_comment|/* SIOCSIWTHRSPY */
id|iw_handler_get_thrspy
comma
multiline_comment|/* SIOCGIWTHRSPY */
(paren
id|iw_handler
)paren
id|prism54_set_wap
comma
multiline_comment|/* SIOCSIWAP */
(paren
id|iw_handler
)paren
id|prism54_get_wap
comma
multiline_comment|/* SIOCGIWAP */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWAPLIST depreciated */
(paren
id|iw_handler
)paren
id|prism54_set_scan
comma
multiline_comment|/* SIOCSIWSCAN */
(paren
id|iw_handler
)paren
id|prism54_get_scan
comma
multiline_comment|/* SIOCGIWSCAN */
(paren
id|iw_handler
)paren
id|prism54_set_essid
comma
multiline_comment|/* SIOCSIWESSID */
(paren
id|iw_handler
)paren
id|prism54_get_essid
comma
multiline_comment|/* SIOCGIWESSID */
(paren
id|iw_handler
)paren
id|prism54_set_nick
comma
multiline_comment|/* SIOCSIWNICKN */
(paren
id|iw_handler
)paren
id|prism54_get_nick
comma
multiline_comment|/* SIOCGIWNICKN */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* -- hole -- */
(paren
id|iw_handler
)paren
id|prism54_set_rate
comma
multiline_comment|/* SIOCSIWRATE */
(paren
id|iw_handler
)paren
id|prism54_get_rate
comma
multiline_comment|/* SIOCGIWRATE */
(paren
id|iw_handler
)paren
id|prism54_set_rts
comma
multiline_comment|/* SIOCSIWRTS */
(paren
id|iw_handler
)paren
id|prism54_get_rts
comma
multiline_comment|/* SIOCGIWRTS */
(paren
id|iw_handler
)paren
id|prism54_set_frag
comma
multiline_comment|/* SIOCSIWFRAG */
(paren
id|iw_handler
)paren
id|prism54_get_frag
comma
multiline_comment|/* SIOCGIWFRAG */
(paren
id|iw_handler
)paren
id|prism54_set_txpower
comma
multiline_comment|/* SIOCSIWTXPOW */
(paren
id|iw_handler
)paren
id|prism54_get_txpower
comma
multiline_comment|/* SIOCGIWTXPOW */
(paren
id|iw_handler
)paren
id|prism54_set_retry
comma
multiline_comment|/* SIOCSIWRETRY */
(paren
id|iw_handler
)paren
id|prism54_get_retry
comma
multiline_comment|/* SIOCGIWRETRY */
(paren
id|iw_handler
)paren
id|prism54_set_encode
comma
multiline_comment|/* SIOCSIWENCODE */
(paren
id|iw_handler
)paren
id|prism54_get_encode
comma
multiline_comment|/* SIOCGIWENCODE */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCSIWPOWER */
(paren
id|iw_handler
)paren
l_int|NULL
comma
multiline_comment|/* SIOCGIWPOWER */
)brace
suffix:semicolon
multiline_comment|/* The low order bit identify a SET (0) or a GET (1) ioctl.  */
DECL|macro|PRISM54_RESET
mdefine_line|#define PRISM54_RESET&t;&t;SIOCIWFIRSTPRIV
DECL|macro|PRISM54_GET_POLICY
mdefine_line|#define PRISM54_GET_POLICY&t;SIOCIWFIRSTPRIV+1
DECL|macro|PRISM54_SET_POLICY
mdefine_line|#define PRISM54_SET_POLICY&t;SIOCIWFIRSTPRIV+2
DECL|macro|PRISM54_GET_MAC
mdefine_line|#define PRISM54_GET_MAC&t;&t;SIOCIWFIRSTPRIV+3
DECL|macro|PRISM54_ADD_MAC
mdefine_line|#define PRISM54_ADD_MAC&t;&t;SIOCIWFIRSTPRIV+4
DECL|macro|PRISM54_DEL_MAC
mdefine_line|#define PRISM54_DEL_MAC&t;&t;SIOCIWFIRSTPRIV+6
DECL|macro|PRISM54_KICK_MAC
mdefine_line|#define PRISM54_KICK_MAC&t;SIOCIWFIRSTPRIV+8
DECL|macro|PRISM54_KICK_ALL
mdefine_line|#define PRISM54_KICK_ALL&t;SIOCIWFIRSTPRIV+10
DECL|macro|PRISM54_GET_WPA
mdefine_line|#define PRISM54_GET_WPA&t;&t;SIOCIWFIRSTPRIV+11
DECL|macro|PRISM54_SET_WPA
mdefine_line|#define PRISM54_SET_WPA&t;&t;SIOCIWFIRSTPRIV+12
DECL|macro|PRISM54_DBG_OID
mdefine_line|#define PRISM54_DBG_OID&t;&t;SIOCIWFIRSTPRIV+14
DECL|macro|PRISM54_DBG_GET_OID
mdefine_line|#define PRISM54_DBG_GET_OID&t;SIOCIWFIRSTPRIV+15
DECL|macro|PRISM54_DBG_SET_OID
mdefine_line|#define PRISM54_DBG_SET_OID&t;SIOCIWFIRSTPRIV+16
DECL|macro|PRISM54_GET_OID
mdefine_line|#define PRISM54_GET_OID&t;&t;SIOCIWFIRSTPRIV+17
DECL|macro|PRISM54_SET_OID_U32
mdefine_line|#define PRISM54_SET_OID_U32&t;SIOCIWFIRSTPRIV+18
DECL|macro|PRISM54_SET_OID_STR
mdefine_line|#define&t;PRISM54_SET_OID_STR&t;SIOCIWFIRSTPRIV+20
DECL|macro|PRISM54_SET_OID_ADDR
mdefine_line|#define&t;PRISM54_SET_OID_ADDR&t;SIOCIWFIRSTPRIV+22
DECL|macro|PRISM54_GET_PRISMHDR
mdefine_line|#define PRISM54_GET_PRISMHDR&t;SIOCIWFIRSTPRIV+23
DECL|macro|PRISM54_SET_PRISMHDR
mdefine_line|#define PRISM54_SET_PRISMHDR&t;SIOCIWFIRSTPRIV+24
DECL|macro|IWPRIV_SET_U32
mdefine_line|#define IWPRIV_SET_U32(n,x)&t;{ n, IW_PRIV_TYPE_INT | IW_PRIV_SIZE_FIXED | 1, 0, &quot;s_&quot;x }
DECL|macro|IWPRIV_SET_SSID
mdefine_line|#define IWPRIV_SET_SSID(n,x)&t;{ n, IW_PRIV_TYPE_CHAR | IW_PRIV_SIZE_FIXED | 1, 0, &quot;s_&quot;x }
DECL|macro|IWPRIV_SET_ADDR
mdefine_line|#define IWPRIV_SET_ADDR(n,x)&t;{ n, IW_PRIV_TYPE_ADDR | IW_PRIV_SIZE_FIXED | 1, 0, &quot;s_&quot;x }
DECL|macro|IWPRIV_GET
mdefine_line|#define IWPRIV_GET(n,x)&t;{ n, 0, IW_PRIV_TYPE_CHAR | IW_PRIV_SIZE_FIXED | PRIV_STR_SIZE, &quot;g_&quot;x }
DECL|macro|IWPRIV_U32
mdefine_line|#define IWPRIV_U32(n,x)&t;&t;IWPRIV_SET_U32(n,x), IWPRIV_GET(n,x)
DECL|macro|IWPRIV_SSID
mdefine_line|#define IWPRIV_SSID(n,x)&t;IWPRIV_SET_SSID(n,x), IWPRIV_GET(n,x)
DECL|macro|IWPRIV_ADDR
mdefine_line|#define IWPRIV_ADDR(n,x)&t;IWPRIV_SET_ADDR(n,x), IWPRIV_GET(n,x)
multiline_comment|/* Note : limited to 128 private ioctls (wireless tools 26) */
DECL|variable|prism54_private_args
r_static
r_const
r_struct
id|iw_priv_args
id|prism54_private_args
(braket
)braket
op_assign
(brace
multiline_comment|/*{ cmd, set_args, get_args, name } */
(brace
id|PRISM54_RESET
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;reset&quot;
)brace
comma
(brace
id|PRISM54_GET_PRISMHDR
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_prismhdr&quot;
)brace
comma
(brace
id|PRISM54_SET_PRISMHDR
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_prismhdr&quot;
)brace
comma
(brace
id|PRISM54_GET_POLICY
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;getPolicy&quot;
)brace
comma
(brace
id|PRISM54_SET_POLICY
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;setPolicy&quot;
)brace
comma
(brace
id|PRISM54_GET_MAC
comma
l_int|0
comma
id|IW_PRIV_TYPE_ADDR
op_or
l_int|64
comma
l_string|&quot;getMac&quot;
)brace
comma
(brace
id|PRISM54_ADD_MAC
comma
id|IW_PRIV_TYPE_ADDR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;addMac&quot;
)brace
comma
(brace
id|PRISM54_DEL_MAC
comma
id|IW_PRIV_TYPE_ADDR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;delMac&quot;
)brace
comma
(brace
id|PRISM54_KICK_MAC
comma
id|IW_PRIV_TYPE_ADDR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;kickMac&quot;
)brace
comma
(brace
id|PRISM54_KICK_ALL
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;kickAll&quot;
)brace
comma
(brace
id|PRISM54_GET_WPA
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_wpa&quot;
)brace
comma
(brace
id|PRISM54_SET_WPA
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_wpa&quot;
)brace
comma
(brace
id|PRISM54_DBG_OID
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;dbg_oid&quot;
)brace
comma
(brace
id|PRISM54_DBG_GET_OID
comma
l_int|0
comma
id|IW_PRIV_TYPE_BYTE
op_or
l_int|256
comma
l_string|&quot;dbg_get_oid&quot;
)brace
comma
(brace
id|PRISM54_DBG_SET_OID
comma
id|IW_PRIV_TYPE_BYTE
op_or
l_int|256
comma
l_int|0
comma
l_string|&quot;dbg_set_oid&quot;
)brace
comma
multiline_comment|/* --- sub-ioctls handlers --- */
(brace
id|PRISM54_GET_OID
comma
l_int|0
comma
id|IW_PRIV_TYPE_CHAR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
id|PRIV_STR_SIZE
comma
l_string|&quot;&quot;
)brace
comma
(brace
id|PRISM54_SET_OID_U32
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;&quot;
)brace
comma
(brace
id|PRISM54_SET_OID_STR
comma
id|IW_PRIV_TYPE_CHAR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;&quot;
)brace
comma
(brace
id|PRISM54_SET_OID_ADDR
comma
id|IW_PRIV_TYPE_ADDR
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;&quot;
)brace
comma
multiline_comment|/* --- sub-ioctls definitions --- */
id|IWPRIV_ADDR
c_func
(paren
id|GEN_OID_MACADDRESS
comma
l_string|&quot;addr&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|GEN_OID_LINKSTATE
comma
l_string|&quot;linkstate&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_BSSTYPE
comma
l_string|&quot;bsstype&quot;
)paren
comma
id|IWPRIV_ADDR
c_func
(paren
id|DOT11_OID_BSSID
comma
l_string|&quot;bssid&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_STATE
comma
l_string|&quot;state&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_AID
comma
l_string|&quot;aid&quot;
)paren
comma
id|IWPRIV_SSID
c_func
(paren
id|DOT11_OID_SSIDOVERRIDE
comma
l_string|&quot;ssidoverride&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_MEDIUMLIMIT
comma
l_string|&quot;medlimit&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_BEACONPERIOD
comma
l_string|&quot;beacon&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_DTIMPERIOD
comma
l_string|&quot;dtimperiod&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_AUTHENABLE
comma
l_string|&quot;authenable&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_PRIVACYINVOKED
comma
l_string|&quot;privinvok&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_EXUNENCRYPTED
comma
l_string|&quot;exunencrypt&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_REKEYTHRESHOLD
comma
l_string|&quot;rekeythresh&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_MAXTXLIFETIME
comma
l_string|&quot;maxtxlife&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_MAXRXLIFETIME
comma
l_string|&quot;maxrxlife&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_ALOFT_FIXEDRATE
comma
l_string|&quot;fixedrate&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_MAXFRAMEBURST
comma
l_string|&quot;frameburst&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_PSM
comma
l_string|&quot;psm&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_BRIDGELOCAL
comma
l_string|&quot;bridge&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_CLIENTS
comma
l_string|&quot;clients&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_CLIENTSASSOCIATED
comma
l_string|&quot;clientassoc&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_DOT1XENABLE
comma
l_string|&quot;dot1xenable&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_ANTENNARX
comma
l_string|&quot;rxant&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_ANTENNATX
comma
l_string|&quot;txant&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_ANTENNADIVERSITY
comma
l_string|&quot;antdivers&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_EDTHRESHOLD
comma
l_string|&quot;edthresh&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_PREAMBLESETTINGS
comma
l_string|&quot;preamble&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_RATES
comma
l_string|&quot;rates&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_OUTPUTPOWER
comma
l_string|&quot;.11outpower&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_SUPPORTEDRATES
comma
l_string|&quot;supprates&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_SUPPORTEDFREQUENCIES
comma
l_string|&quot;suppfreq&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_NOISEFLOOR
comma
l_string|&quot;noisefloor&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_FREQUENCYACTIVITY
comma
l_string|&quot;freqactivity&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_NONERPPROTECTION
comma
l_string|&quot;nonerpprotec&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_PROFILES
comma
l_string|&quot;profile&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_EXTENDEDRATES
comma
l_string|&quot;extrates&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|DOT11_OID_MLMEAUTOLEVEL
comma
l_string|&quot;mlmelevel&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_BSSS
comma
l_string|&quot;bsss&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|DOT11_OID_BSSLIST
comma
l_string|&quot;bsslist&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|OID_INL_MODE
comma
l_string|&quot;mode&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|OID_INL_CONFIG
comma
l_string|&quot;config&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|OID_INL_DOT11D_CONFORMANCE
comma
l_string|&quot;.11dconform&quot;
)paren
comma
id|IWPRIV_GET
c_func
(paren
id|OID_INL_PHYCAPABILITIES
comma
l_string|&quot;phycapa&quot;
)paren
comma
id|IWPRIV_U32
c_func
(paren
id|OID_INL_OUTPUTPOWER
comma
l_string|&quot;outpower&quot;
)paren
comma
)brace
suffix:semicolon
DECL|variable|prism54_private_handler
r_static
r_const
id|iw_handler
id|prism54_private_handler
(braket
)braket
op_assign
(brace
(paren
id|iw_handler
)paren
id|prism54_reset
comma
(paren
id|iw_handler
)paren
id|prism54_get_policy
comma
(paren
id|iw_handler
)paren
id|prism54_set_policy
comma
(paren
id|iw_handler
)paren
id|prism54_get_mac
comma
(paren
id|iw_handler
)paren
id|prism54_add_mac
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_del_mac
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_kick_mac
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_kick_all
comma
(paren
id|iw_handler
)paren
id|prism54_get_wpa
comma
(paren
id|iw_handler
)paren
id|prism54_set_wpa
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_debug_oid
comma
(paren
id|iw_handler
)paren
id|prism54_debug_get_oid
comma
(paren
id|iw_handler
)paren
id|prism54_debug_set_oid
comma
(paren
id|iw_handler
)paren
id|prism54_get_oid
comma
(paren
id|iw_handler
)paren
id|prism54_set_u32
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_set_raw
comma
(paren
id|iw_handler
)paren
l_int|NULL
comma
(paren
id|iw_handler
)paren
id|prism54_set_raw
comma
(paren
id|iw_handler
)paren
id|prism54_get_prismhdr
comma
(paren
id|iw_handler
)paren
id|prism54_set_prismhdr
comma
)brace
suffix:semicolon
DECL|variable|prism54_handler_def
r_const
r_struct
id|iw_handler_def
id|prism54_handler_def
op_assign
(brace
dot
id|num_standard
op_assign
r_sizeof
(paren
id|prism54_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|num_private
op_assign
r_sizeof
(paren
id|prism54_private_handler
)paren
op_div
r_sizeof
(paren
id|iw_handler
)paren
comma
dot
id|num_private_args
op_assign
r_sizeof
(paren
id|prism54_private_args
)paren
op_div
r_sizeof
(paren
r_struct
id|iw_priv_args
)paren
comma
dot
id|standard
op_assign
(paren
id|iw_handler
op_star
)paren
id|prism54_handler
comma
dot
r_private
op_assign
(paren
id|iw_handler
op_star
)paren
id|prism54_private_handler
comma
dot
id|private_args
op_assign
(paren
r_struct
id|iw_priv_args
op_star
)paren
id|prism54_private_args
comma
macro_line|#if WIRELESS_EXT == 16
dot
id|spy_offset
op_assign
m_offsetof
(paren
id|islpci_private
comma
id|spy_data
)paren
comma
macro_line|#endif /* WIRELESS_EXT == 16 */
)brace
suffix:semicolon
multiline_comment|/* For wpa_supplicant */
r_int
DECL|function|prism54_ioctl
id|prism54_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|ndev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|iwreq
op_star
id|wrq
op_assign
(paren
r_struct
id|iwreq
op_star
)paren
id|rq
suffix:semicolon
r_int
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|PRISM54_HOSTAPD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|ret
op_assign
id|prism54_hostapd
c_func
(paren
id|ndev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
eof
