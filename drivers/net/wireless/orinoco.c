multiline_comment|/* orinoco.c - (formerly known as dldwd_cs.c and orinoco_cs.c)&n; *&n; * A driver for Hermes or Prism 2 chipset based PCMCIA wireless&n; * adaptors, with Lucent/Agere, Intersil or Symbol firmware.&n; *&n; * Current maintainers (as of 29 September 2003) are:&n; * &t;Pavel Roskin &lt;proski AT gnu.org&gt;&n; * and&t;David Gibson &lt;hermes AT gibson.dropbear.id.au&gt;&n; *&n; * (C) Copyright David Gibson, IBM Corporation 2001-2003.&n; * Copyright (C) 2000 David Gibson, Linuxcare Australia.&n; *&t;With some help from :&n; * Copyright (C) 2001 Jean Tourrilhes, HP Labs&n; * Copyright (C) 2001 Benjamin Herrenschmidt&n; *&n; * Based on dummy_cs.c 1.27 2000/06/12 21:27:25&n; *&n; * Portions based on wvlan_cs.c 1.0.6, Copyright Andreas Neuhaus &lt;andy&n; * AT fasta.fh-dortmund.de&gt;&n; *      http://www.stud.fh-dortmund.de/~andy/wvlan/&n; *&n; * The contents of this file are subject to the Mozilla Public License&n; * Version 1.1 (the &quot;License&quot;); you may not use this file except in&n; * compliance with the License. You may obtain a copy of the License&n; * at http://www.mozilla.org/MPL/&n; *&n; * Software distributed under the License is distributed on an &quot;AS IS&quot;&n; * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See&n; * the License for the specific language governing rights and&n; * limitations under the License.&n; *&n; * The initial developer of the original code is David A. Hinds&n; * &lt;dahinds AT users.sourceforge.net&gt;.  Portions created by David&n; * A. Hinds are Copyright (C) 1999 David A. Hinds.  All Rights&n; * Reserved.&n; *&n; * Alternatively, the contents of this file may be used under the&n; * terms of the GNU General Public License version 2 (the &quot;GPL&quot;), in&n; * which case the provisions of the GPL are applicable instead of the&n; * above.  If you wish to allow the use of your version of this file&n; * only under the terms of the GPL and not to allow others to use your&n; * version of this file under the MPL, indicate your decision by&n; * deleting the provisions above and replace them with the notice and&n; * other provisions required by the GPL.  If you do not delete the&n; * provisions above, a recipient may use your version of this file&n; * under either the MPL or the GPL.  */
multiline_comment|/*&n; * v0.01 -&gt; v0.02 - 21/3/2001 - Jean II&n; *&t;o Allow to use regular ethX device name instead of dldwdX&n; *&t;o Warning on IBSS with ESSID=any for firmware 6.06&n; *&t;o Put proper range.throughput values (optimistic)&n; *&t;o IWSPY support (IOCTL and stat gather in Rx path)&n; *&t;o Allow setting frequency in Ad-Hoc mode&n; *&t;o Disable WEP setting if !has_wep to work on old firmware&n; *&t;o Fix txpower range&n; *&t;o Start adding support for Samsung/Compaq firmware&n; *&n; * v0.02 -&gt; v0.03 - 23/3/2001 - Jean II&n; *&t;o Start adding Symbol support - need to check all that&n; *&t;o Fix Prism2/Symbol WEP to accept 128 bits keys&n; *&t;o Add Symbol WEP (add authentication type)&n; *&t;o Add Prism2/Symbol rate&n; *&t;o Add PM timeout (holdover duration)&n; *&t;o Enable &quot;iwconfig eth0 key off&quot; and friends (toggle flags)&n; *&t;o Enable &quot;iwconfig eth0 power unicast/all&quot; (toggle flags)&n; *&t;o Try with an Intel card. It report firmware 1.01, behave like&n; *&t;  an antiquated firmware, however on windows it says 2.00. Yuck !&n; *&t;o Workaround firmware bug in allocate buffer (Intel 1.01)&n; *&t;o Finish external renaming to orinoco...&n; *&t;o Testing with various Wavelan firmwares&n; *&n; * v0.03 -&gt; v0.04 - 30/3/2001 - Jean II&n; *&t;o Update to Wireless 11 -&gt; add retry limit/lifetime support&n; *&t;o Tested with a D-Link DWL 650 card, fill in firmware support&n; *&t;o Warning on Vcc mismatch (D-Link 3.3v card in Lucent 5v only slot)&n; *&t;o Fixed the Prism2 WEP bugs that I introduced in v0.03 :-(&n; *&t;  It works on D-Link *only* after a tcpdump. Weird...&n; *&t;  And still doesn&squot;t work on Intel card. Grrrr...&n; *&t;o Update the mode after a setport3&n; *&t;o Add preamble setting for Symbol cards (not yet enabled)&n; *&t;o Don&squot;t complain as much about Symbol cards...&n; *&n; * v0.04 -&gt; v0.04b - 22/4/2001 - David Gibson&n; *      o Removed the &squot;eth&squot; parameter - always use ethXX as the&n; *        interface name instead of dldwdXX.  The other was racy&n; *        anyway.&n; *&t;o Clean up RID definitions in hermes.h, other cleanups&n; *&n; * v0.04b -&gt; v0.04c - 24/4/2001 - Jean II&n; *&t;o Tim Hurley &lt;timster AT seiki.bliztech.com&gt; reported a D-Link card&n; *&t;  with vendor 02 and firmware 0.08. Added in the capabilities...&n; *&t;o Tested Lucent firmware 7.28, everything works...&n; *&n; * v0.04c -&gt; v0.05 - 3/5/2001 - Benjamin Herrenschmidt&n; *&t;o Spin-off Pcmcia code. This file is renamed orinoco.c,&n; *&t;  and orinoco_cs.c now contains only the Pcmcia specific stuff&n; *&t;o Add Airport driver support on top of orinoco.c (see airport.c)&n; *&n; * v0.05 -&gt; v0.05a - 4/5/2001 - Jean II&n; *&t;o Revert to old Pcmcia code to fix breakage of Ben&squot;s changes...&n; *&n; * v0.05a -&gt; v0.05b - 4/5/2001 - Jean II&n; *&t;o add module parameter &squot;ignore_cis_vcc&squot; for D-Link @ 5V&n; *&t;o D-Link firmware doesn&squot;t support multicast. We just print a few&n; *&t;  error messages, but otherwise everything works...&n; *&t;o For David : set/getport3 works fine, just upgrade iwpriv...&n; *&n; * v0.05b -&gt; v0.05c - 5/5/2001 - Benjamin Herrenschmidt&n; *&t;o Adapt airport.c to latest changes in orinoco.c&n; *&t;o Remove deferred power enabling code&n; *&n; * v0.05c -&gt; v0.05d - 5/5/2001 - Jean II&n; *&t;o Workaround to SNAP decapsulate frame from Linksys AP&n; *&t;  original patch from : Dong Liu &lt;dliu AT research.bell-labs.com&gt;&n; *&t;  (note : the memcmp bug was mine - fixed)&n; *&t;o Remove set_retry stuff, no firmware support it (bloat--).&n; *&n; * v0.05d -&gt; v0.06 - 25/5/2001 - Jean II&n; *&t;&t;Original patch from &quot;Hong Lin&quot; &lt;alin AT redhat.com&gt;,&n; *&t;&t;&quot;Ian Kinner&quot; &lt;ikinner AT redhat.com&gt;&n; *&t;&t;and &quot;David Smith&quot; &lt;dsmith AT redhat.com&gt;&n; *&t;o Init of priv-&gt;tx_rate_ctrl in firmware specific section.&n; *&t;o Prism2/Symbol rate, upto should be 0xF and not 0x15. Doh !&n; *&t;o Spectrum card always need cor_reset (for every reset)&n; *&t;o Fix cor_reset to not lose bit 7 in the register&n; *&t;o flush_stale_links to remove zombie Pcmcia instances&n; *&t;o Ack previous hermes event before reset&n; *&t;&t;Me (with my little hands)&n; *&t;o Allow orinoco.c to call cor_reset via priv-&gt;card_reset_handler&n; *&t;o Add priv-&gt;need_card_reset to toggle this feature&n; *&t;o Fix various buglets when setting WEP in Symbol firmware&n; *&t;  Now, encryption is fully functional on Symbol cards. Youpi !&n; *&n; * v0.06 -&gt; v0.06b - 25/5/2001 - Jean II&n; *&t;o IBSS on Symbol use port_mode = 4. Please don&squot;t ask...&n; *&n; * v0.06b -&gt; v0.06c - 29/5/2001 - Jean II&n; *&t;o Show first spy address in /proc/net/wireless for IBSS mode as well&n; *&n; * v0.06c -&gt; v0.06d - 6/7/2001 - David Gibson&n; *      o Change a bunch of KERN_INFO messages to KERN_DEBUG, as per Linus&squot;&n; *        wishes to reduce the number of unnecessary messages.&n; *&t;o Removed bogus message on CRC error.&n; *&t;o Merged fixes for v0.08 Prism 2 firmware from William Waghorn&n; *&t;  &lt;willwaghorn AT yahoo.co.uk&gt;&n; *&t;o Slight cleanup/re-arrangement of firmware detection code.&n; *&n; * v0.06d -&gt; v0.06e - 1/8/2001 - David Gibson&n; *&t;o Removed some redundant global initializers (orinoco_cs.c).&n; *&t;o Added some module metadata&n; *&n; * v0.06e -&gt; v0.06f - 14/8/2001 - David Gibson&n; *&t;o Wording fix to license&n; *&t;o Added a &squot;use_alternate_encaps&squot; module parameter for APs which need an&n; *&t;  oui of 00:00:00.  We really need a better way of handling this, but&n; *&t;  the module flag is better than nothing for now.&n; *&n; * v0.06f -&gt; v0.07 - 20/8/2001 - David Gibson&n; *&t;o Removed BAP error retries from hermes_bap_seek().  For Tx we now&n; *&t;  let the upper layers handle the retry, we retry explicitly in the&n; *&t;  Rx path, but don&squot;t make as much noise about it.&n; *&t;o Firmware detection cleanups.&n; *&n; * v0.07 -&gt; v0.07a - 1/10/3001 - Jean II&n; *&t;o Add code to read Symbol firmware revision, inspired by latest code&n; *&t;  in Spectrum24 by Lee John Keyser-Allen - Thanks Lee !&n; *&t;o Thanks to Jared Valentine &lt;hidden AT xmission.com&gt; for &quot;providing&quot; me&n; *&t;  a 3Com card with a recent firmware, fill out Symbol firmware&n; *&t;  capabilities of latest rev (2.20), as well as older Symbol cards.&n; *&t;o Disable Power Management in newer Symbol firmware, the API &n; *&t;  has changed (documentation needed).&n; *&n; * v0.07a -&gt; v0.08 - 3/10/2001 - David Gibson&n; *&t;o Fixed a possible buffer overrun found by the Stanford checker (in&n; *&t;  dldwd_ioctl_setiwencode()).  Can only be called by root anyway, so not&n; *&t;  a big problem.&n; *&t;o Turned has_big_wep on for Intersil cards.  That&squot;s not true for all of&n; *&t;  them but we should at least let the capable ones try.&n; *&t;o Wait for BUSY to clear at the beginning of hermes_bap_seek().  I&n; *&t;  realized that my assumption that the driver&squot;s serialization&n; *&t;  would prevent the BAP being busy on entry was possibly false, because&n; *&t;  things other than seeks may make the BAP busy.&n; *&t;o Use &quot;alternate&quot; (oui 00:00:00) encapsulation by default.&n; *&t;  Setting use_old_encaps will mimic the old behaviour, but I think we&n; *&t;  will be able to eliminate this.&n; *&t;o Don&squot;t try to make __initdata const (the version string).  This can&squot;t&n; *&t;  work because of the way the __initdata sectioning works.&n; *&t;o Added MODULE_LICENSE tags.&n; *&t;o Support for PLX (transparent PCMCIA-&gt;PCI bridge) cards.&n; *&t;o Changed to using the new type-fascist min/max.&n; *&n; * v0.08 -&gt; v0.08a - 9/10/2001 - David Gibson&n; *&t;o Inserted some missing acknowledgements/info into the Changelog.&n; *&t;o Fixed some bugs in the normalization of signal level reporting.&n; *&t;o Fixed bad bug in WEP key handling on Intersil and Symbol firmware,&n; *&t;  which led to an instant crash on big-endian machines.&n; *&n; * v0.08a -&gt; v0.08b - 20/11/2001 - David Gibson&n; *&t;o Lots of cleanup and bugfixes in orinoco_plx.c&n; *&t;o Cleanup to handling of Tx rate setting.&n; *&t;o Removed support for old encapsulation method.&n; *&t;o Removed old &quot;dldwd&quot; names.&n; *&t;o Split RID constants into a new file hermes_rid.h&n; *&t;o Renamed RID constants to match linux-wlan-ng and prism2.o&n; *&t;o Bugfixes in hermes.c&n; *&t;o Poke the PLX&squot;s INTCSR register, so it actually starts&n; *&t;  generating interrupts.  These cards might actually work now.&n; *&t;o Update to wireless extensions v12 (Jean II)&n; *&t;o Support for tallies and inquire command (Jean II)&n; *&t;o Airport updates for newer PPC kernels (BenH)&n; *&n; * v0.08b -&gt; v0.09 - 21/12/2001 - David Gibson&n; *&t;o Some new PCI IDs for PLX cards.&n; *&t;o Removed broken attempt to do ALLMULTI reception.  Just use&n; *&t;  promiscuous mode instead&n; *&t;o Preliminary work for list-AP (Jean II)&n; *&t;o Airport updates from (BenH)&n; *&t;o Eliminated racy hw_ready stuff&n; *&t;o Fixed generation of fake events in irq handler.  This should&n; *&t;  finally kill the EIO problems (Jean II &amp; dgibson)&n; *&t;o Fixed breakage of bitrate set/get on Agere firmware (Jean II)&n; *&n; * v0.09 -&gt; v0.09a - 2/1/2002 - David Gibson&n; *&t;o Fixed stupid mistake in multicast list handling, triggering&n; *&t;  a BUG()&n; *&n; * v0.09a -&gt; v0.09b - 16/1/2002 - David Gibson&n; *&t;o Fixed even stupider mistake in new interrupt handling, which&n; *&t;  seriously broke things on big-endian machines.&n; *&t;o Removed a bunch of redundant includes and exports.&n; *&t;o Removed a redundant MOD_{INC,DEC}_USE_COUNT pair in airport.c&n; *&t;o Don&squot;t attempt to do hardware level multicast reception on&n; *&t;  Intersil firmware, just go promisc instead.&n; *&t;o Typo fixed in hermes_issue_cmd()&n; *&t;o Eliminated WIRELESS_SPY #ifdefs&n; *&t;o Status code reported on Tx exceptions&n; *&t;o Moved netif_wake_queue() from ALLOC interrupts to TX and TXEXC&n; *&t;  interrupts, which should fix the timeouts we&squot;re seeing.&n; *&n; * v0.09b -&gt; v0.10 - 25 Feb 2002 - David Gibson&n; *&t;o Removed nested structures used for header parsing, so the&n; *&t;  driver should now work without hackery on ARM&n; *&t;o Fix for WEP handling on Intersil (Hawk Newton)&n; *&t;o Eliminated the /proc/hermes/ethXX/regs debugging file.  It&n; *&t;  was never very useful.&n; *&t;o Make Rx errors less noisy.&n; *&n; * v0.10 -&gt; v0.11 - 5 Apr 2002 - David Gibson&n; *&t;o Laid the groundwork in hermes.[ch] for devices which map&n; *&t;  into PCI memory space rather than IO space.&n; *&t;o Fixed bug in multicast handling (cleared multicast list when&n; *&t;  leaving promiscuous mode).&n; *&t;o Relegated Tx error messages to debug.&n; *&t;o Cleaned up / corrected handling of allocation lengths.&n; *&t;o Set OWNSSID in IBSS mode for WinXP interoperability (jimc).&n; *&t;o Change to using alloc_etherdev() for structure allocations. &n; *&t;o Check for and drop undersized packets.&n; *&t;o Fixed a race in stopping/waking the queue.  This should fix&n; *&t;  the timeout problems (Pavel Roskin)&n; *&t;o Reverted to netif_wake_queue() on the ALLOC event.&n; *&t;o Fixes for recent Symbol firmwares which lack AP density&n; *&t;  (Pavel Roskin).&n; *&n; * v0.11 -&gt; v0.11a - 29 Apr 2002 - David Gibson&n; *&t;o Handle different register spacing, necessary for Prism 2.5&n; *&t;  PCI adaptors (Steve Hill).&n; *&t;o Cleaned up initialization of card structures in orinoco_cs&n; *&t;  and airport.  Removed card-&gt;priv field.&n; *&t;o Make response structure optional for hermes_docmd_wait()&n; *&t;  Pavel Roskin)&n; *&t;o Added PCI id for Nortel emobility to orinoco_plx.c.&n; *&t;o Cleanup to handling of Symbol&squot;s allocation bug. (Pavel Roskin)&n; *&t;o Cleanups to firmware capability detection.&n; *&t;o Arrange for orinoco_pci.c to override firmware detection.&n; *&t;  We should be able to support the PCI Intersil cards now.&n; *&t;o Cleanup handling of reset_cor and hard_reset (Pavel Roskin).&n; *&t;o Remove erroneous use of USER_BAP in the TxExc handler (Jouni&n; *&t;  Malinen).&n; *&t;o Makefile changes for better integration into David Hinds&n; *&t;  pcmcia-cs package.&n; *&n; * v0.11a -&gt; v0.11b - 1 May 2002 - David Gibson&n; *&t;o Better error reporting in orinoco_plx_init_one()&n; *&t;o Fixed multiple bad kfree() bugs introduced by the&n; *&t;  alloc_orinocodev() changes.&n; *&n; * v0.11b -&gt; v0.12 - 19 Jun 2002 - David Gibson&n; *&t;o Support changing the MAC address.&n; *&t;o Correct display of Intersil firmware revision numbers.&n; *&t;o Entirely revised locking scheme.  Should be both simpler and&n; *&t;   better.&n; *&t;o Merged some common code in orinoco_plx, orinoco_pci and&n; *&t;  airport by creating orinoco_default_{open,stop,reset}()&n; *&t;  which are used as the dev-&gt;open, dev-&gt;stop, priv-&gt;reset&n; *&t;  callbacks if none are specified when alloc_orinocodev() is&n; *&t;  called.&n; *&t;o Removed orinoco_plx_interrupt() and orinoco_pci_interrupt().&n; *&t;  They didn&squot;t do anything.&n; *&n; * v0.12 -&gt; v0.12a - 4 Jul 2002 - David Gibson&n; *&t;o Some rearrangement of code.&n; *&t;o Numerous fixups to locking and rest handling, particularly&n; *&t;  for PCMCIA.&n; *&t;o This allows open and stop net_device methods to be in&n; *&t;  orinoco.c now, rather than in the init modules.&n; *&t;o In orinoco_cs.c link-&gt;priv now points to the struct&n; *&t;  net_device not to the struct orinoco_private.&n; *&t;o Added a check for undersized SNAP frames, which could cause&n; *&t;  crashes.&n; *&n; * v0.12a -&gt; v0.12b - 11 Jul 2002 - David Gibson&n; *&t;o Fix hw-&gt;num_init testing code, so num_init is actually&n; *&t;  incremented.&n; *&t;o Fix very stupid bug in orinoco_cs which broke compile with&n; *&t;  CONFIG_SMP.&n; *&t;o Squashed a warning.&n; *&n; * v0.12b -&gt; v0.12c - 26 Jul 2002 - David Gibson&n; *&t;o Change to C9X style designated initializers.&n; *&t;o Add support for 3Com AirConnect PCI.&n; *&t;o No longer ignore the hard_reset argument to&n; *&t;  alloc_orinocodev().  Oops.&n; *&n; * v0.12c -&gt; v0.13beta1 - 13 Sep 2002 - David Gibson&n; *&t;o Revert the broken 0.12* locking scheme and go to a new yet&n; *&t;  simpler scheme.&n; *&t;o Do firmware resets only in orinoco_init() and when waking&n; *&t;  the card from hard sleep.&n; *&n; * v0.13beta1 -&gt; v0.13 - 27 Sep 2002 - David Gibson&n; *&t;o Re-introduced full resets (via schedule_task()) on Tx&n; *&t;  timeout.&n; *&n; * v0.13 -&gt; v0.13a - 30 Sep 2002 - David Gibson&n; *&t;o Minor cleanups to info frame handling.  Add basic support&n; *&t;  for linkstatus info frames.&n; *&t;o Include required kernel headers in orinoco.h, to avoid&n; *&t;  compile problems.&n; *&n; * v0.13a -&gt; v0.13b - 10 Feb 2003 - David Gibson&n; *&t;o Implemented hard reset for Airport cards&n; *&t;o Experimental suspend/resume implementation for orinoco_pci&n; *&t;o Abolished /proc debugging support, replaced with a debugging&n; *&t;  iwpriv.  Now it&squot;s ugly and simple instead of ugly and complex.&n; *&t;o Bugfix in hermes.c if the firmware returned a record length&n; *&t;  of 0, we could go clobbering memory.&n; *&t;o Bugfix in orinoco_stop() - it used to fail if hw_unavailable&n; *&t;  was set, which was usually true on PCMCIA hot removes.&n; * &t;o Track LINKSTATUS messages, silently drop Tx packets before&n; * &t;  we are connected (avoids confusing the firmware), and only&n; * &t;  give LINKSTATUS printk()s if the status has changed.&n; *&n; * v0.13b -&gt; v0.13c - 11 Mar 2003 - David Gibson&n; *&t;o Cleanup: use dev instead of priv in various places.&n; *&t;o Bug fix: Don&squot;t ReleaseConfiguration on RESET_PHYSICAL event&n; *&t;  if we&squot;re in the middle of a (driver initiated) hard reset.&n; *&t;o Bug fix: ETH_ZLEN is supposed to include the header&n; *&t;  (Dionysus Blazakis &amp; Manish Karir)&n; *&t;o Convert to using workqueues instead of taskqueues (and&n; *&t;  backwards compatibility macros for pre 2.5.41 kernels).&n; *&t;o Drop redundant (I think...) MOD_{INC,DEC}_USE_COUNT in&n; *&t;  airport.c&n; *&t;o New orinoco_tmd.c init module from Joerg Dorchain for&n; *&t;  TMD7160 based PCI to PCMCIA bridges (similar to&n; *&t;  orinoco_plx.c).&n; *&n; * v0.13c -&gt; v0.13d - 22 Apr 2003 - David Gibson&n; *&t;o Make hw_unavailable a counter, rather than just a flag, this&n; *&t;  is necessary to avoid some races (such as a card being&n; *&t;  removed in the middle of orinoco_reset().&n; *&t;o Restore Release/RequestConfiguration in the PCMCIA event handler&n; *&t;  when dealing with a driver initiated hard reset.  This is&n; *&t;  necessary to prevent hangs due to a spurious interrupt while&n; *&t;  the reset is in progress.&n; *&t;o Clear the 802.11 header when transmitting, even though we&n; *&t;  don&squot;t use it.  This fixes a long standing bug on some&n; *&t;  firmwares, which seem to get confused if that isn&squot;t done.&n; *&t;o Be less eager to de-encapsulate SNAP frames, only do so if&n; *&t;  the OUI is 00:00:00 or 00:00:f8, leave others alone.  The old&n; *&t;  behaviour broke CDP (Cisco Discovery Protocol).&n; *&t;o Use dev instead of priv for free_irq() as well as&n; *&t;  request_irq() (oops).&n; *&t;o Attempt to reset rather than giving up if we get too many&n; *&t;  IRQs.&n; *&t;o Changed semantics of __orinoco_down() so it can be called&n; *&t;  safely with hw_unavailable set.  It also now clears the&n; *&t;  linkstatus (since we&squot;re going to have to reassociate).&n; *&n; * v0.13d -&gt; v0.13e - 12 May 2003 - David Gibson&n; *&t;o Support for post-2.5.68 return values from irq handler.&n; *&t;o Fixed bug where underlength packets would be double counted&n; *&t;  in the rx_dropped statistics.&n; *&t;o Provided a module parameter to suppress linkstatus messages.&n; *&n; * TODO&n; *&t;o New wireless extensions API (patch from Moustafa&n; *&t;  Youssef, updated by Jim Carter and Pavel Roskin).&n; *&t;o Handle de-encapsulation within network layer, provide 802.11&n; *&t;  headers (patch from Thomas &squot;Dent&squot; Mirlacher)&n; *&t;o RF monitor mode support&n; *&t;o Fix possible races in SPY handling.&n; *&t;o Disconnect wireless extensions from fundamental configuration.&n; *&t;o (maybe) Software WEP support (patch from Stano Meduna).&n; *&t;o (maybe) Use multiple Tx buffers - driver handling queue&n; *&t;  rather than firmware.&n; */
multiline_comment|/* Locking and synchronization:&n; *&n; * The basic principle is that everything is serialized through a&n; * single spinlock, priv-&gt;lock.  The lock is used in user, bh and irq&n; * context, so when taken outside hardirq context it should always be&n; * taken with interrupts disabled.  The lock protects both the&n; * hardware and the struct orinoco_private.&n; *&n; * Another flag, priv-&gt;hw_unavailable indicates that the hardware is&n; * unavailable for an extended period of time (e.g. suspended, or in&n; * the middle of a hard reset).  This flag is protected by the&n; * spinlock.  All code which touches the hardware should check the&n; * flag after taking the lock, and if it is set, give up on whatever&n; * they are doing and drop the lock again.  The orinoco_lock()&n; * function handles this (it unlocks and returns -EBUSY if&n; * hw_unavailable is non-zero).&n; */
DECL|macro|DRIVER_NAME
mdefine_line|#define DRIVER_NAME &quot;orinoco&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;hermes.h&quot;
macro_line|#include &quot;hermes_rid.h&quot;
macro_line|#include &quot;orinoco.h&quot;
macro_line|#include &quot;ieee802_11.h&quot;
multiline_comment|/********************************************************************/
multiline_comment|/* Module information                                               */
multiline_comment|/********************************************************************/
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Pavel Roskin &lt;proski@gnu.org&gt; &amp; David Gibson &lt;hermes@gibson.dropbear.id.au&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver for Lucent Orinoco, Prism II based and similar wireless cards&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual MPL/GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* Level of debugging. Used in the macros in orinoco.h */
macro_line|#ifdef ORINOCO_DEBUG
DECL|variable|orinoco_debug
r_int
id|orinoco_debug
op_assign
id|ORINOCO_DEBUG
suffix:semicolon
id|module_param
c_func
(paren
id|orinoco_debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|orinoco_debug
id|EXPORT_SYMBOL
c_func
(paren
id|orinoco_debug
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|suppress_linkstatus
r_static
r_int
id|suppress_linkstatus
suffix:semicolon
multiline_comment|/* = 0 */
id|module_param
c_func
(paren
id|suppress_linkstatus
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/********************************************************************/
multiline_comment|/* Compile time configuration and compatibility stuff               */
multiline_comment|/********************************************************************/
multiline_comment|/* We do this this way to avoid ifdefs in the actual code */
macro_line|#ifdef WIRELESS_SPY
DECL|macro|SPY_NUMBER
mdefine_line|#define SPY_NUMBER(priv)&t;(priv-&gt;spy_number)
macro_line|#else
DECL|macro|SPY_NUMBER
mdefine_line|#define SPY_NUMBER(priv)&t;0
macro_line|#endif /* WIRELESS_SPY */
multiline_comment|/********************************************************************/
multiline_comment|/* Internal constants                                               */
multiline_comment|/********************************************************************/
DECL|macro|ORINOCO_MIN_MTU
mdefine_line|#define ORINOCO_MIN_MTU&t;&t;256
DECL|macro|ORINOCO_MAX_MTU
mdefine_line|#define ORINOCO_MAX_MTU&t;&t;(IEEE802_11_DATA_LEN - ENCAPS_OVERHEAD)
DECL|macro|SYMBOL_MAX_VER_LEN
mdefine_line|#define SYMBOL_MAX_VER_LEN&t;(14)
DECL|macro|USER_BAP
mdefine_line|#define USER_BAP&t;&t;0
DECL|macro|IRQ_BAP
mdefine_line|#define IRQ_BAP&t;&t;&t;1
DECL|macro|MAX_IRQLOOPS_PER_IRQ
mdefine_line|#define MAX_IRQLOOPS_PER_IRQ&t;10
DECL|macro|MAX_IRQLOOPS_PER_JIFFY
mdefine_line|#define MAX_IRQLOOPS_PER_JIFFY&t;(20000/HZ) /* Based on a guestimate of&n;&t;&t;&t;&t;&t;    * how many events the&n;&t;&t;&t;&t;&t;    * device could&n;&t;&t;&t;&t;&t;    * legitimately generate */
DECL|macro|SMALL_KEY_SIZE
mdefine_line|#define SMALL_KEY_SIZE&t;&t;5
DECL|macro|LARGE_KEY_SIZE
mdefine_line|#define LARGE_KEY_SIZE&t;&t;13
DECL|macro|TX_NICBUF_SIZE_BUG
mdefine_line|#define TX_NICBUF_SIZE_BUG&t;1585&t;&t;/* Bug in Symbol firmware */
DECL|macro|DUMMY_FID
mdefine_line|#define DUMMY_FID&t;&t;0xFFFF
multiline_comment|/*#define MAX_MULTICAST(priv)&t;(priv-&gt;firmware_type == FIRMWARE_TYPE_AGERE ? &bslash;&n;  HERMES_MAX_MULTICAST : 0)*/
DECL|macro|MAX_MULTICAST
mdefine_line|#define MAX_MULTICAST(priv)&t;(HERMES_MAX_MULTICAST)
DECL|macro|ORINOCO_INTEN
mdefine_line|#define ORINOCO_INTEN&t; &t;(HERMES_EV_RX | HERMES_EV_ALLOC &bslash;&n;&t;&t;&t;&t; | HERMES_EV_TX | HERMES_EV_TXEXC &bslash;&n;&t;&t;&t;&t; | HERMES_EV_WTERR | HERMES_EV_INFO &bslash;&n;&t;&t;&t;&t; | HERMES_EV_INFDROP )
multiline_comment|/********************************************************************/
multiline_comment|/* Data tables                                                      */
multiline_comment|/********************************************************************/
multiline_comment|/* The frequency of each channel in MHz */
DECL|variable|channel_frequency
r_static
r_const
r_int
id|channel_frequency
(braket
)braket
op_assign
(brace
l_int|2412
comma
l_int|2417
comma
l_int|2422
comma
l_int|2427
comma
l_int|2432
comma
l_int|2437
comma
l_int|2442
comma
l_int|2447
comma
l_int|2452
comma
l_int|2457
comma
l_int|2462
comma
l_int|2467
comma
l_int|2472
comma
l_int|2484
)brace
suffix:semicolon
DECL|macro|NUM_CHANNELS
mdefine_line|#define NUM_CHANNELS ARRAY_SIZE(channel_frequency)
multiline_comment|/* This tables gives the actual meanings of the bitrate IDs returned&n; * by the firmware. */
r_static
r_struct
(brace
DECL|member|bitrate
r_int
id|bitrate
suffix:semicolon
multiline_comment|/* in 100s of kilobits */
DECL|member|automatic
r_int
id|automatic
suffix:semicolon
DECL|member|agere_txratectrl
id|u16
id|agere_txratectrl
suffix:semicolon
DECL|member|intersil_txratectrl
id|u16
id|intersil_txratectrl
suffix:semicolon
DECL|variable|bitrate_table
)brace
id|bitrate_table
(braket
)braket
op_assign
(brace
(brace
l_int|110
comma
l_int|1
comma
l_int|3
comma
l_int|15
)brace
comma
multiline_comment|/* Entry 0 is the default */
(brace
l_int|10
comma
l_int|0
comma
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|10
comma
l_int|1
comma
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|20
comma
l_int|0
comma
l_int|2
comma
l_int|2
)brace
comma
(brace
l_int|20
comma
l_int|1
comma
l_int|6
comma
l_int|3
)brace
comma
(brace
l_int|55
comma
l_int|0
comma
l_int|4
comma
l_int|4
)brace
comma
(brace
l_int|55
comma
l_int|1
comma
l_int|7
comma
l_int|7
)brace
comma
(brace
l_int|110
comma
l_int|0
comma
l_int|5
comma
l_int|8
)brace
comma
)brace
suffix:semicolon
DECL|macro|BITRATE_TABLE_SIZE
mdefine_line|#define BITRATE_TABLE_SIZE ARRAY_SIZE(bitrate_table)
multiline_comment|/********************************************************************/
multiline_comment|/* Data types                                                       */
multiline_comment|/********************************************************************/
DECL|struct|header_struct
r_struct
id|header_struct
(brace
multiline_comment|/* 802.3 */
DECL|member|dest
id|u8
id|dest
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|src
id|u8
id|src
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|len
id|u16
id|len
suffix:semicolon
multiline_comment|/* 802.2 */
DECL|member|dsap
id|u8
id|dsap
suffix:semicolon
DECL|member|ssap
id|u8
id|ssap
suffix:semicolon
DECL|member|ctrl
id|u8
id|ctrl
suffix:semicolon
multiline_comment|/* SNAP */
DECL|member|oui
id|u8
id|oui
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|ethertype
id|u16
id|ethertype
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
multiline_comment|/* 802.2 LLC/SNAP header used for Ethernet encapsulation over 802.11 */
DECL|variable|encaps_hdr
id|u8
id|encaps_hdr
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|macro|ENCAPS_OVERHEAD
mdefine_line|#define ENCAPS_OVERHEAD&t;&t;(sizeof(encaps_hdr) + 2)
DECL|struct|hermes_rx_descriptor
r_struct
id|hermes_rx_descriptor
(brace
DECL|member|status
id|u16
id|status
suffix:semicolon
DECL|member|time
id|u32
id|time
suffix:semicolon
DECL|member|silence
id|u8
id|silence
suffix:semicolon
DECL|member|signal
id|u8
id|signal
suffix:semicolon
DECL|member|rate
id|u8
id|rate
suffix:semicolon
DECL|member|rxflow
id|u8
id|rxflow
suffix:semicolon
DECL|member|reserved
id|u32
id|reserved
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
multiline_comment|/********************************************************************/
multiline_comment|/* Function prototypes                                              */
multiline_comment|/********************************************************************/
r_static
r_int
id|orinoco_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|__orinoco_program_rids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|__orinoco_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|orinoco_debug_dump_recs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/********************************************************************/
multiline_comment|/* Internal helper functions                                        */
multiline_comment|/********************************************************************/
DECL|function|set_port_type
r_static
r_inline
r_void
id|set_port_type
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
)paren
(brace
r_switch
c_cond
(paren
id|priv-&gt;iw_mode
)paren
(brace
r_case
id|IW_MODE_INFRA
suffix:colon
id|priv-&gt;port_type
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;createibss
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_ADHOC
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;prefer_port3
)paren
(brace
id|priv-&gt;port_type
op_assign
l_int|3
suffix:semicolon
id|priv-&gt;createibss
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;port_type
op_assign
id|priv-&gt;ibss_port
suffix:semicolon
id|priv-&gt;createibss
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Invalid priv-&gt;iw_mode in set_port_type()&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Device methods                                                   */
multiline_comment|/********************************************************************/
DECL|function|orinoco_open
r_static
r_int
id|orinoco_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|__orinoco_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|priv-&gt;open
op_assign
l_int|1
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_stop
r_int
id|orinoco_stop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We mustn&squot;t use orinoco_lock() here, because we need to be&n;&t;   able to close the interface even if hw_unavailable is set&n;&t;   (e.g. as we&squot;re released after a PC Card removal) */
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|priv-&gt;open
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|__orinoco_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|orinoco_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
DECL|function|orinoco_get_wireless_stats
r_static
r_struct
id|iw_statistics
op_star
id|orinoco_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|priv-&gt;wstats
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: get_wireless_stats() called while device not present&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* FIXME: Can we do better than this? */
)brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* FIXME: Erg, we&squot;ve been signalled, how&n;&t;&t;&t;       * do we propagate this back up? */
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_eq
id|IW_MODE_ADHOC
)paren
(brace
id|memset
c_func
(paren
op_amp
id|wstats-&gt;qual
comma
l_int|0
comma
r_sizeof
(paren
id|wstats-&gt;qual
)paren
)paren
suffix:semicolon
multiline_comment|/* If a spy address is defined, we report stats of the&n;&t;&t; * first spy address - Jean II */
r_if
c_cond
(paren
id|SPY_NUMBER
c_func
(paren
id|priv
)paren
)paren
(brace
id|wstats-&gt;qual.qual
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|qual
suffix:semicolon
id|wstats-&gt;qual.level
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|level
suffix:semicolon
id|wstats-&gt;qual.noise
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|noise
suffix:semicolon
id|wstats-&gt;qual.updated
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|updated
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
(brace
id|u16
id|qual
comma
id|signal
comma
id|noise
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|cq
suffix:semicolon
id|err
op_assign
id|HERMES_READ_RECORD
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_COMMSQUALITY
comma
op_amp
id|cq
)paren
suffix:semicolon
id|wstats-&gt;qual.qual
op_assign
(paren
r_int
)paren
id|le16_to_cpu
c_func
(paren
id|cq.qual
)paren
suffix:semicolon
id|wstats-&gt;qual.level
op_assign
(paren
r_int
)paren
id|le16_to_cpu
c_func
(paren
id|cq.signal
)paren
op_minus
l_int|0x95
suffix:semicolon
id|wstats-&gt;qual.noise
op_assign
(paren
r_int
)paren
id|le16_to_cpu
c_func
(paren
id|cq.noise
)paren
op_minus
l_int|0x95
suffix:semicolon
id|wstats-&gt;qual.updated
op_assign
l_int|7
suffix:semicolon
)brace
multiline_comment|/* We can&squot;t really wait for the tallies inquiry command to&n;&t; * complete, so we just use the previous results and trigger&n;&t; * a new tallies inquiry command for next time - Jean II */
multiline_comment|/* FIXME: We&squot;re in user context (I think?), so we should just&n;           wait for the tallies to come through */
id|err
op_assign
id|hermes_inquire
c_func
(paren
id|hw
comma
id|HERMES_INQ_TALLIES
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|wstats
suffix:semicolon
)brace
DECL|function|orinoco_set_multicast_list
r_static
r_void
id|orinoco_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: orinoco_set_multicast_list() &quot;
l_string|&quot;called when hw_unavailable&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|__orinoco_set_multicast_list
c_func
(paren
id|dev
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
)brace
DECL|function|orinoco_change_mtu
r_static
r_int
id|orinoco_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
OL
id|ORINOCO_MIN_MTU
)paren
op_logical_or
(paren
id|new_mtu
OG
id|ORINOCO_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
op_plus
id|ENCAPS_OVERHEAD
op_plus
id|IEEE802_11_HLEN
)paren
OG
(paren
id|priv-&gt;nicbuf_size
op_minus
id|ETH_HLEN
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Tx path                                                          */
multiline_comment|/********************************************************************/
DECL|function|orinoco_xmit
r_static
r_int
id|orinoco_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u16
id|txfid
op_assign
id|priv-&gt;txfid
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eh
suffix:semicolon
r_int
id|len
comma
id|data_len
comma
id|data_off
suffix:semicolon
r_struct
id|hermes_tx_descriptor
id|desc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Tx on stopped device!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Tx while transmitter busy!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: orinoco_xmit() called while hw_unavailable&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;connected
)paren
(brace
multiline_comment|/* Oops, the firmware hasn&squot;t established a connection,&n;                   silently drop the packet (this seems to be the&n;                   safest approach). */
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Length of the packet body */
multiline_comment|/* FIXME: what if the skb is smaller than this? */
id|len
op_assign
id|max_t
c_func
(paren
r_int
comma
id|skb-&gt;len
op_minus
id|ETH_HLEN
comma
id|ETH_ZLEN
op_minus
id|ETH_HLEN
)paren
suffix:semicolon
id|eh
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|desc
comma
l_int|0
comma
r_sizeof
(paren
id|desc
)paren
)paren
suffix:semicolon
id|desc.tx_control
op_assign
id|cpu_to_le16
c_func
(paren
id|HERMES_TXCTRL_TX_OK
op_or
id|HERMES_TXCTRL_TX_EX
)paren
suffix:semicolon
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|desc
comma
r_sizeof
(paren
id|desc
)paren
comma
id|txfid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing Tx descriptor to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* Clear the 802.11 header and data length fields - some&n;&t; * firmwares (e.g. Lucent/Agere 8.xx) appear to get confused&n;&t; * if this isn&squot;t done. */
id|hermes_clear_words
c_func
(paren
id|hw
comma
id|HERMES_DATA0
comma
id|HERMES_802_3_OFFSET
op_minus
id|HERMES_802_11_OFFSET
)paren
suffix:semicolon
multiline_comment|/* Encapsulate Ethernet-II frames */
r_if
c_cond
(paren
id|ntohs
c_func
(paren
id|eh-&gt;h_proto
)paren
OG
id|ETH_DATA_LEN
)paren
(brace
multiline_comment|/* Ethernet-II frame */
r_struct
id|header_struct
id|hdr
suffix:semicolon
id|data_len
op_assign
id|len
suffix:semicolon
id|data_off
op_assign
id|HERMES_802_3_OFFSET
op_plus
r_sizeof
(paren
id|hdr
)paren
suffix:semicolon
id|p
op_assign
id|skb-&gt;data
op_plus
id|ETH_HLEN
suffix:semicolon
multiline_comment|/* 802.3 header */
id|memcpy
c_func
(paren
id|hdr.dest
comma
id|eh-&gt;h_dest
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr.src
comma
id|eh-&gt;h_source
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|hdr.len
op_assign
id|htons
c_func
(paren
id|data_len
op_plus
id|ENCAPS_OVERHEAD
)paren
suffix:semicolon
multiline_comment|/* 802.2 header */
id|memcpy
c_func
(paren
op_amp
id|hdr.dsap
comma
op_amp
id|encaps_hdr
comma
r_sizeof
(paren
id|encaps_hdr
)paren
)paren
suffix:semicolon
id|hdr.ethertype
op_assign
id|eh-&gt;h_proto
suffix:semicolon
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|hdr
comma
r_sizeof
(paren
id|hdr
)paren
comma
id|txfid
comma
id|HERMES_802_3_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing packet header to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* IEEE 802.3 frame */
id|data_len
op_assign
id|len
op_plus
id|ETH_HLEN
suffix:semicolon
id|data_off
op_assign
id|HERMES_802_3_OFFSET
suffix:semicolon
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
)brace
multiline_comment|/* Round up for odd length packets */
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|p
comma
id|ALIGN
c_func
(paren
id|data_len
comma
l_int|2
)paren
comma
id|txfid
comma
id|data_off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing packet to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* Finally, we actually initiate the send */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|hermes_docmd_wait
c_func
(paren
id|hw
comma
id|HERMES_CMD_TX
op_or
id|HERMES_CMD_RECL
comma
id|txfid
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d transmitting packet&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|stats-&gt;tx_bytes
op_add_assign
id|data_off
op_plus
id|data_len
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|__orinoco_ev_alloc
r_static
r_void
id|__orinoco_ev_alloc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u16
id|fid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|ALLOCFID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fid
op_ne
id|priv-&gt;txfid
)paren
(brace
r_if
c_cond
(paren
id|fid
op_ne
id|DUMMY_FID
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Allocate event on unexpected fid (%04X)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|ALLOCFID
comma
id|DUMMY_FID
)paren
suffix:semicolon
)brace
DECL|function|__orinoco_ev_tx
r_static
r_void
id|__orinoco_ev_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|TXCOMPLFID
comma
id|DUMMY_FID
)paren
suffix:semicolon
)brace
DECL|function|__orinoco_ev_txexc
r_static
r_void
id|__orinoco_ev_txexc
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|u16
id|fid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|TXCOMPLFID
)paren
suffix:semicolon
r_struct
id|hermes_tx_descriptor
id|desc
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fid
op_eq
id|DUMMY_FID
)paren
r_return
suffix:semicolon
multiline_comment|/* Nothing&squot;s really happened */
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
op_amp
id|desc
comma
r_sizeof
(paren
id|desc
)paren
comma
id|fid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to read descriptor on Tx error &quot;
l_string|&quot;(FID=%04X error %d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|fid
comma
id|err
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: Tx error, status %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|le16_to_cpu
c_func
(paren
id|desc.status
)paren
)paren
suffix:semicolon
)brace
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|TXCOMPLFID
comma
id|DUMMY_FID
)paren
suffix:semicolon
)brace
DECL|function|orinoco_tx_timeout
r_static
r_void
id|orinoco_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tx timeout! &quot;
l_string|&quot;ALLOCFID=%04x, TXCOMPLFID=%04x, EVSTAT=%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|ALLOCFID
)paren
comma
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|TXCOMPLFID
)paren
comma
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|EVSTAT
)paren
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;reset_work
)paren
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Rx path (data frames)                                            */
multiline_comment|/********************************************************************/
multiline_comment|/* Does the frame have a SNAP header indicating it should be&n; * de-encapsulated to Ethernet-II? */
DECL|function|is_ethersnap
r_static
r_inline
r_int
id|is_ethersnap
c_func
(paren
r_struct
id|header_struct
op_star
id|hdr
)paren
(brace
multiline_comment|/* We de-encapsulate all packets which, a) have SNAP headers&n;&t; * (i.e. SSAP=DSAP=0xaa and CTRL=0x3 in the 802.2 LLC header&n;&t; * and where b) the OUI of the SNAP header is 00:00:00 or&n;&t; * 00:00:f8 - we need both because different APs appear to use&n;&t; * different OUIs for some reason */
r_return
(paren
id|memcmp
c_func
(paren
op_amp
id|hdr-&gt;dsap
comma
op_amp
id|encaps_hdr
comma
l_int|5
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|hdr-&gt;oui
(braket
l_int|2
)braket
op_eq
l_int|0x00
)paren
op_logical_or
(paren
id|hdr-&gt;oui
(braket
l_int|2
)braket
op_eq
l_int|0xf8
)paren
)paren
suffix:semicolon
)brace
DECL|function|orinoco_spy_gather
r_static
r_inline
r_void
id|orinoco_spy_gather
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u_char
op_star
id|mac
comma
r_int
id|level
comma
r_int
id|noise
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Gather wireless spy statistics: for each packet, compare the&n;&t; * source address with out list, and if match, get the stats... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|mac
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|ETH_ALEN
)paren
)paren
(brace
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|level
op_assign
id|level
op_minus
l_int|0x95
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|noise
op_assign
id|noise
op_minus
l_int|0x95
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|qual
op_assign
(paren
id|level
OG
id|noise
)paren
ques
c_cond
(paren
id|level
op_minus
id|noise
)paren
suffix:colon
l_int|0
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|7
suffix:semicolon
)brace
)brace
DECL|function|orinoco_stat_gather
r_static
r_void
id|orinoco_stat_gather
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|hermes_rx_descriptor
op_star
id|desc
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Using spy support with lots of Rx packets, like in an&n;&t; * infrastructure (AP), will really slow down everything, because&n;&t; * the MAC address must be compared to each entry of the spy list.&n;&t; * If the user really asks for it (set some address in the&n;&t; * spy list), we do it, but he will pay the price.&n;&t; * Note that to get here, you need both WIRELESS_SPY&n;&t; * compiled in AND some addresses in the list !!!&n;&t; */
multiline_comment|/* Note : gcc will optimise the whole section away if&n;&t; * WIRELESS_SPY is not defined... - Jean II */
r_if
c_cond
(paren
id|SPY_NUMBER
c_func
(paren
id|priv
)paren
)paren
(brace
id|orinoco_spy_gather
c_func
(paren
id|dev
comma
id|skb-&gt;mac.raw
op_plus
id|ETH_ALEN
comma
id|desc-&gt;signal
comma
id|desc-&gt;silence
)paren
suffix:semicolon
)brace
)brace
DECL|function|__orinoco_ev_rx
r_static
r_void
id|__orinoco_ev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|priv-&gt;wstats
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|rxfid
comma
id|status
suffix:semicolon
r_int
id|length
comma
id|data_len
comma
id|data_off
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|hermes_rx_descriptor
id|desc
suffix:semicolon
r_struct
id|header_struct
id|hdr
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eh
suffix:semicolon
r_int
id|err
suffix:semicolon
id|rxfid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|RXFID
)paren
suffix:semicolon
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
op_amp
id|desc
comma
r_sizeof
(paren
id|desc
)paren
comma
id|rxfid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error %d reading Rx descriptor. &quot;
l_string|&quot;Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|desc.status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|HERMES_RXSTAT_ERR
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|HERMES_RXSTAT_UNDECRYPTABLE
)paren
(brace
id|wstats-&gt;discard.code
op_increment
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: Undecryptable frame on Rx. Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|stats-&gt;rx_crc_errors
op_increment
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: Bad CRC on Rx. Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* For now we ignore the 802.11 header completely, assuming&n;           that the card&squot;s firmware has handled anything vital */
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
op_amp
id|hdr
comma
r_sizeof
(paren
id|hdr
)paren
comma
id|rxfid
comma
id|HERMES_802_3_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error %d reading frame header. &quot;
l_string|&quot;Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|length
op_assign
id|ntohs
c_func
(paren
id|hdr.len
)paren
suffix:semicolon
multiline_comment|/* Sanity checks */
r_if
c_cond
(paren
id|length
OL
l_int|3
)paren
(brace
multiline_comment|/* No for even an 802.2 LLC header */
multiline_comment|/* At least on Symbol firmware with PCF we get quite a&n;                   lot of these legitimately - Poll frames with no&n;                   data. */
id|stats-&gt;rx_dropped
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
r_if
c_cond
(paren
id|length
OG
id|IEEE802_11_DATA_LEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized frame received (%d bytes)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|length
)paren
suffix:semicolon
id|stats-&gt;rx_length_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* We need space for the packet data itself, plus an ethernet&n;&t;   header, plus 2 bytes so we can align the IP header on a&n;&t;   32bit boundary, plus 1 byte so we can read in odd length&n;&t;   packets from the card, which has an IO granularity of 16&n;&t;   bits */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|length
op_plus
id|ETH_HLEN
op_plus
l_int|2
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t allocate skb for Rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* This way the IP header is aligned */
multiline_comment|/* Handle decapsulation&n;&t; * In most cases, the firmware tell us about SNAP frames.&n;&t; * For some reason, the SNAP frames sent by LinkSys APs&n;&t; * are not properly recognised by most firmwares.&n;&t; * So, check ourselves */
r_if
c_cond
(paren
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_MSGTYPE
)paren
op_eq
id|HERMES_RXSTAT_1042
)paren
op_logical_or
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_MSGTYPE
)paren
op_eq
id|HERMES_RXSTAT_TUNNEL
)paren
op_logical_or
id|is_ethersnap
c_func
(paren
op_amp
id|hdr
)paren
)paren
(brace
multiline_comment|/* These indicate a SNAP within 802.2 LLC within&n;&t;&t;   802.11 frame which we&squot;ll need to de-encapsulate to&n;&t;&t;   the original EthernetII frame. */
r_if
c_cond
(paren
id|length
OL
id|ENCAPS_OVERHEAD
)paren
(brace
multiline_comment|/* No room for full LLC+SNAP */
id|stats-&gt;rx_length_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* Remove SNAP header, reconstruct EthernetII frame */
id|data_len
op_assign
id|length
op_minus
id|ENCAPS_OVERHEAD
suffix:semicolon
id|data_off
op_assign
id|HERMES_802_3_OFFSET
op_plus
r_sizeof
(paren
id|hdr
)paren
suffix:semicolon
id|eh
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eh
comma
op_amp
id|hdr
comma
l_int|2
op_star
id|ETH_ALEN
)paren
suffix:semicolon
id|eh-&gt;h_proto
op_assign
id|hdr.ethertype
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* All other cases indicate a genuine 802.3 frame.  No&n;&t;&t;   decapsulation needed.  We just throw the whole&n;&t;&t;   thing in, and hope the protocol layer can deal with&n;&t;&t;   it as 802.3 */
id|data_len
op_assign
id|length
suffix:semicolon
id|data_off
op_assign
id|HERMES_802_3_OFFSET
suffix:semicolon
multiline_comment|/* FIXME: we re-read from the card data we already read here */
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|data_len
)paren
suffix:semicolon
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
id|p
comma
id|ALIGN
c_func
(paren
id|data_len
comma
l_int|2
)paren
comma
id|rxfid
comma
id|data_off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error %d reading frame. &quot;
l_string|&quot;Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
multiline_comment|/* Process the wireless stats if needed */
id|orinoco_stat_gather
c_func
(paren
id|dev
comma
id|skb
comma
op_amp
id|desc
)paren
suffix:semicolon
multiline_comment|/* Pass the packet to the networking stack */
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|stats-&gt;rx_packets
op_increment
suffix:semicolon
id|stats-&gt;rx_bytes
op_add_assign
id|length
suffix:semicolon
r_return
suffix:semicolon
id|drop
suffix:colon
id|stats-&gt;rx_dropped
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Rx path (info frames)                                            */
multiline_comment|/********************************************************************/
DECL|function|print_linkstatus
r_static
r_void
id|print_linkstatus
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|status
)paren
(brace
r_char
op_star
id|s
suffix:semicolon
r_if
c_cond
(paren
id|suppress_linkstatus
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|status
)paren
(brace
r_case
id|HERMES_LINKSTATUS_NOT_CONNECTED
suffix:colon
id|s
op_assign
l_string|&quot;Not Connected&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_CONNECTED
suffix:colon
id|s
op_assign
l_string|&quot;Connected&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_DISCONNECTED
suffix:colon
id|s
op_assign
l_string|&quot;Disconnected&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_AP_CHANGE
suffix:colon
id|s
op_assign
l_string|&quot;AP Changed&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_AP_OUT_OF_RANGE
suffix:colon
id|s
op_assign
l_string|&quot;AP Out of Range&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_AP_IN_RANGE
suffix:colon
id|s
op_assign
l_string|&quot;AP In Range&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HERMES_LINKSTATUS_ASSOC_FAILED
suffix:colon
id|s
op_assign
l_string|&quot;Association Failed&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: New link status: %s (%04x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|s
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|__orinoco_ev_info
r_static
r_void
id|__orinoco_ev_info
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u16
id|infofid
suffix:semicolon
r_struct
(brace
id|u16
id|len
suffix:semicolon
id|u16
id|type
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
id|info
suffix:semicolon
r_int
id|len
comma
id|type
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* This is an answer to an INQUIRE command that we did earlier,&n;&t; * or an information &quot;event&quot; generated by the card&n;&t; * The controller return to us a pseudo frame containing&n;&t; * the information in question - Jean II */
id|infofid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|INFOFID
)paren
suffix:semicolon
multiline_comment|/* Read the info frame header - don&squot;t try too hard */
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
comma
id|infofid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error %d reading info frame. &quot;
l_string|&quot;Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|len
op_assign
id|HERMES_RECLEN_TO_BYTES
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|info.len
)paren
)paren
suffix:semicolon
id|type
op_assign
id|le16_to_cpu
c_func
(paren
id|info.type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|HERMES_INQ_TALLIES
suffix:colon
(brace
r_struct
id|hermes_tallies_frame
id|tallies
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|priv-&gt;wstats
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
r_sizeof
(paren
id|tallies
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tallies frame too long (%d bytes)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
id|len
op_assign
r_sizeof
(paren
id|tallies
)paren
suffix:semicolon
)brace
multiline_comment|/* Read directly the data (no seek) */
id|hermes_read_words
c_func
(paren
id|hw
comma
id|HERMES_DATA1
comma
(paren
r_void
op_star
)paren
op_amp
id|tallies
comma
id|len
op_div
l_int|2
)paren
suffix:semicolon
multiline_comment|/* FIXME: blech! */
multiline_comment|/* Increment our various counters */
multiline_comment|/* wstats-&gt;discard.nwid - no wrong BSSID stuff */
id|wstats-&gt;discard.code
op_add_assign
id|le16_to_cpu
c_func
(paren
id|tallies.RxWEPUndecryptable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
r_sizeof
(paren
id|tallies
)paren
)paren
id|wstats-&gt;discard.code
op_add_assign
id|le16_to_cpu
c_func
(paren
id|tallies.RxDiscards_WEPICVError
)paren
op_plus
id|le16_to_cpu
c_func
(paren
id|tallies.RxDiscards_WEPExcluded
)paren
suffix:semicolon
id|wstats-&gt;discard.misc
op_add_assign
id|le16_to_cpu
c_func
(paren
id|tallies.TxDiscardsWrongSA
)paren
suffix:semicolon
id|wstats-&gt;discard.fragment
op_add_assign
id|le16_to_cpu
c_func
(paren
id|tallies.RxMsgInBadMsgFragments
)paren
suffix:semicolon
id|wstats-&gt;discard.retries
op_add_assign
id|le16_to_cpu
c_func
(paren
id|tallies.TxRetryLimitExceeded
)paren
suffix:semicolon
multiline_comment|/* wstats-&gt;miss.beacon - no match */
)brace
r_break
suffix:semicolon
r_case
id|HERMES_INQ_LINKSTATUS
suffix:colon
(brace
r_struct
id|hermes_linkstatus
id|linkstatus
suffix:semicolon
id|u16
id|newstatus
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
id|linkstatus
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unexpected size for linkstatus frame (%d bytes)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hermes_read_words
c_func
(paren
id|hw
comma
id|HERMES_DATA1
comma
(paren
r_void
op_star
)paren
op_amp
id|linkstatus
comma
id|len
op_div
l_int|2
)paren
suffix:semicolon
id|newstatus
op_assign
id|le16_to_cpu
c_func
(paren
id|linkstatus.linkstatus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_CONNECTED
)paren
op_logical_or
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_AP_CHANGE
)paren
op_logical_or
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_AP_IN_RANGE
)paren
)paren
id|priv-&gt;connected
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_NOT_CONNECTED
)paren
op_logical_or
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_DISCONNECTED
)paren
op_logical_or
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_AP_OUT_OF_RANGE
)paren
op_logical_or
(paren
id|newstatus
op_eq
id|HERMES_LINKSTATUS_ASSOC_FAILED
)paren
)paren
id|priv-&gt;connected
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|newstatus
op_ne
id|priv-&gt;last_linkstatus
)paren
id|print_linkstatus
c_func
(paren
id|dev
comma
id|newstatus
)paren
suffix:semicolon
id|priv-&gt;last_linkstatus
op_assign
id|newstatus
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Unknown information frame received &quot;
l_string|&quot;(type %04x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|type
)paren
suffix:semicolon
multiline_comment|/* We don&squot;t actually do anything about it */
r_break
suffix:semicolon
)brace
)brace
DECL|function|__orinoco_ev_infdrop
r_static
r_void
id|__orinoco_ev_infdrop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Information frame lost.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Internal hardware control routines                               */
multiline_comment|/********************************************************************/
DECL|function|__orinoco_up
r_int
id|__orinoco_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|__orinoco_program_rids
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d configuring card&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Fire things up again */
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
id|ORINOCO_INTEN
)paren
suffix:semicolon
id|err
op_assign
id|hermes_enable_port
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d enabling MAC port&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__orinoco_down
r_int
id|__orinoco_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;hw_unavailable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;broken_disableport
)paren
(brace
id|err
op_assign
id|hermes_disable_port
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
multiline_comment|/* Some firmwares (e.g. Intersil 1.3.x) seem&n;&t;&t;&t;&t; * to have problems disabling the port, oh&n;&t;&t;&t;&t; * well, too bad. */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error %d disabling MAC port&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|priv-&gt;broken_disableport
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|EVACK
comma
l_int|0xffff
)paren
suffix:semicolon
)brace
multiline_comment|/* firmware will have to reassociate */
id|priv-&gt;last_linkstatus
op_assign
l_int|0xffff
suffix:semicolon
id|priv-&gt;connected
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_reinit_firmware
r_int
id|orinoco_reinit_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|hermes_init
c_func
(paren
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|hermes_allocate
c_func
(paren
id|hw
comma
id|priv-&gt;nicbuf_size
comma
op_amp
id|priv-&gt;txfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EIO
)paren
(brace
multiline_comment|/* Try workaround for old Symbol firmware bug */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: firmware ALLOC bug detected &quot;
l_string|&quot;(old Symbol firmware?). Trying to work around... &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;nicbuf_size
op_assign
id|TX_NICBUF_SIZE_BUG
suffix:semicolon
id|err
op_assign
id|hermes_allocate
c_func
(paren
id|hw
comma
id|priv-&gt;nicbuf_size
comma
op_amp
id|priv-&gt;txfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
l_string|&quot;failed!&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;ok.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|__orinoco_hw_set_bitrate
r_static
r_int
id|__orinoco_hw_set_bitrate
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;bitratemode
op_ge
id|BITRATE_TABLE_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: BUG: Invalid bitrate mode %d&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|priv-&gt;bitratemode
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_AGERE
suffix:colon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFTXRATECONTROL
comma
id|bitrate_table
(braket
id|priv-&gt;bitratemode
)braket
dot
id|agere_txratectrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_INTERSIL
suffix:colon
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFTXRATECONTROL
comma
id|bitrate_table
(braket
id|priv-&gt;bitratemode
)braket
dot
id|intersil_txratectrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|__orinoco_hw_setup_wep
r_static
r_int
id|__orinoco_hw_setup_wep
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|master_wep_flag
suffix:semicolon
r_int
id|auth_flag
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_AGERE
suffix:colon
multiline_comment|/* Agere style WEP */
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFTXKEY_AGERE
comma
id|priv-&gt;tx_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|HERMES_WRITE_RECORD
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFWEPKEYS_AGERE
comma
op_amp
id|priv-&gt;keys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFWEPENABLED_AGERE
comma
id|priv-&gt;wep_on
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_INTERSIL
suffix:colon
multiline_comment|/* Intersil style WEP */
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol style WEP */
id|master_wep_flag
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Off */
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
r_int
id|keylen
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Fudge around firmware weirdness */
id|keylen
op_assign
id|le16_to_cpu
c_func
(paren
id|priv-&gt;keys
(braket
id|priv-&gt;tx_key
)braket
dot
id|len
)paren
suffix:semicolon
multiline_comment|/* Write all 4 keys */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ORINOCO_MAX_KEYS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/*  &t;&t;&t;&t;int keylen = le16_to_cpu(priv-&gt;keys[i].len); */
r_if
c_cond
(paren
id|keylen
OG
id|LARGE_KEY_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: BUG: Key %d has oversize length %d.&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|i
comma
id|keylen
)paren
suffix:semicolon
r_return
op_minus
id|E2BIG
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFDEFAULTKEY0
op_plus
id|i
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|keylen
)paren
comma
id|priv-&gt;keys
(braket
id|i
)braket
dot
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Write the index of the key used in transmission */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFWEPDEFAULTKEYID
comma
id|priv-&gt;tx_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;wep_restrict
)paren
(brace
id|auth_flag
op_assign
l_int|2
suffix:semicolon
id|master_wep_flag
op_assign
l_int|3
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Authentication is where Intersil and Symbol&n;&t;&t;&t;&t; * firmware differ... */
id|auth_flag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;firmware_type
op_eq
id|FIRMWARE_TYPE_SYMBOL
)paren
id|master_wep_flag
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Symbol */
r_else
id|master_wep_flag
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Intersil */
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFAUTHENTICATION
comma
id|auth_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Master WEP setting : on/off */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFWEPFLAGS_INTERSIL
comma
id|master_wep_flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: WEP enabled, although not supported!&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__orinoco_program_rids
r_static
r_int
id|__orinoco_program_rids
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|hermes_idstring
id|idbuf
suffix:semicolon
multiline_comment|/* Set the MAC address */
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNMACADDR
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|ETH_ALEN
)paren
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting MAC address&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set up the link mode */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPORTTYPE
comma
id|priv-&gt;port_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting port type&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set the channel/frequency */
r_if
c_cond
(paren
id|priv-&gt;channel
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Channel is 0 in __orinoco_program_rids()&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;createibss
)paren
id|priv-&gt;channel
op_assign
l_int|10
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNCHANNEL
comma
id|priv-&gt;channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting channel&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;has_ibss
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFCREATEIBSS
comma
id|priv-&gt;createibss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting CREATEIBSS&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|priv-&gt;createibss
)paren
op_logical_and
(paren
op_logical_neg
id|priv-&gt;has_ibss_any
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: This firmware requires an &quot;
l_string|&quot;ESSID in IBSS-Ad-Hoc mode.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* With wvlan_cs, in this case, we would crash.&n;&t;&t;&t; * hopefully, this driver will behave better...&n;&t;&t;&t; * Jean II */
)brace
)brace
multiline_comment|/* Set the desired ESSID */
id|idbuf.len
op_assign
id|cpu_to_le16
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|idbuf.val
comma
id|priv-&gt;desired_essid
comma
r_sizeof
(paren
id|idbuf.val
)paren
)paren
suffix:semicolon
multiline_comment|/* WinXP wants partner to configure OWNSSID even in IBSS mode. (jimc) */
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNSSID
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
op_plus
l_int|2
)paren
comma
op_amp
id|idbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting OWNSSID&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFDESIREDSSID
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
op_plus
l_int|2
)paren
comma
op_amp
id|idbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting DESIREDSSID&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set the station name */
id|idbuf.len
op_assign
id|cpu_to_le16
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;nick
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|idbuf.val
comma
id|priv-&gt;nick
comma
r_sizeof
(paren
id|idbuf.val
)paren
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNNAME
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;nick
)paren
op_plus
l_int|2
)paren
comma
op_amp
id|idbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting nickname&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set AP density */
r_if
c_cond
(paren
id|priv-&gt;has_sensitivity
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFSYSTEMSCALE
comma
id|priv-&gt;ap_density
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error %d setting SYSTEMSCALE.  &quot;
l_string|&quot;Disabling sensitivity control&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|priv-&gt;has_sensitivity
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Set RTS threshold */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFRTSTHRESHOLD
comma
id|priv-&gt;rts_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting RTS threshold&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set fragmentation threshold or MWO robustness */
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMWOROBUST_AGERE
comma
id|priv-&gt;mwo_robust
)paren
suffix:semicolon
r_else
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFFRAGMENTATIONTHRESHOLD
comma
id|priv-&gt;frag_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting fragmentation&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set bitrate */
id|err
op_assign
id|__orinoco_hw_set_bitrate
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting bitrate&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Set power management */
r_if
c_cond
(paren
id|priv-&gt;has_pm
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPMENABLED
comma
id|priv-&gt;pm_on
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting up PM&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMULTICASTRECEIVE
comma
id|priv-&gt;pm_mcast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting up PM&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMAXSLEEPDURATION
comma
id|priv-&gt;pm_period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting up PM&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPMHOLDOVERDURATION
comma
id|priv-&gt;pm_timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting up PM&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* Set preamble - only for Symbol so far... */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPREAMBLE_SYMBOL
comma
id|priv-&gt;preamble
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting preamble&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* Set up encryption */
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
id|__orinoco_hw_setup_wep
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d activating WEP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* Set promiscuity / multicast*/
id|priv-&gt;promiscuous
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;mc_count
op_assign
l_int|0
suffix:semicolon
id|__orinoco_set_multicast_list
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* FIXME: what about the xmit_lock */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FIXME: return int? */
r_static
r_void
DECL|function|__orinoco_set_multicast_list
id|__orinoco_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|promisc
comma
id|mc_count
suffix:semicolon
multiline_comment|/* The Hermes doesn&squot;t seem to have an allmulti mode, so we go&n;&t; * into promiscuous mode and let the upper levels deal. */
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
(paren
id|dev-&gt;mc_count
OG
id|MAX_MULTICAST
c_func
(paren
id|priv
)paren
)paren
)paren
(brace
id|promisc
op_assign
l_int|1
suffix:semicolon
id|mc_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|promisc
op_assign
l_int|0
suffix:semicolon
id|mc_count
op_assign
id|dev-&gt;mc_count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|promisc
op_ne
id|priv-&gt;promiscuous
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPROMISCUOUSMODE
comma
id|promisc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting PROMISCUOUSMODE to 1.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
)brace
r_else
id|priv-&gt;promiscuous
op_assign
id|promisc
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|promisc
op_logical_and
(paren
id|mc_count
op_logical_or
id|priv-&gt;mc_count
)paren
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|p
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_struct
id|hermes_multicast
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* paranoia: is list shorter than mc_count? */
id|BUG_ON
c_func
(paren
op_logical_neg
id|p
)paren
suffix:semicolon
multiline_comment|/* paranoia: bad address size in list? */
id|BUG_ON
c_func
(paren
id|p-&gt;dmi_addrlen
op_ne
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|mclist.addr
(braket
id|i
)braket
comma
id|p-&gt;dmi_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Multicast list is longer than mc_count&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFGROUPADDRESSES
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|priv-&gt;mc_count
op_star
id|ETH_ALEN
)paren
comma
op_amp
id|mclist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting multicast list.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_else
id|priv-&gt;mc_count
op_assign
id|mc_count
suffix:semicolon
)brace
multiline_comment|/* Since we can set the promiscuous flag when it wasn&squot;t asked&n;&t;   for, make sure the net_device knows about it. */
r_if
c_cond
(paren
id|priv-&gt;promiscuous
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_PROMISC
suffix:semicolon
r_else
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_PROMISC
suffix:semicolon
)brace
DECL|function|orinoco_reconfigure
r_static
r_int
id|orinoco_reconfigure
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;broken_disableport
)paren
(brace
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;reset_work
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_disable_port
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to disable port while reconfiguring card&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;broken_disableport
op_assign
l_int|1
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|__orinoco_program_rids
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to reconfigure card&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|hermes_enable_port
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unable to enable port while reconfiguring card&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Resetting instead...&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;reset_work
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* This must be called from user context, without locks held - use&n; * schedule_work() */
DECL|function|orinoco_reset
r_static
r_void
id|orinoco_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|hermes
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
multiline_comment|/* When the hardware becomes available again, whatever&n;&t;&t; * detects that is responsible for re-initializing&n;&t;&t; * it. So no need for anything further */
r_return
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Shut off interrupts.  Depending on what state the hardware&n;&t; * is in, this might not work, but we&squot;ll try anyway */
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|EVACK
comma
l_int|0xffff
)paren
suffix:semicolon
id|priv-&gt;hw_unavailable
op_increment
suffix:semicolon
id|priv-&gt;last_linkstatus
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* firmware will have to reassociate */
id|priv-&gt;connected
op_assign
l_int|0
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;hard_reset
)paren
id|err
op_assign
(paren
op_star
id|priv-&gt;hard_reset
)paren
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: orinoco_reset: Error %d &quot;
l_string|&quot;performing  hard reset&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
multiline_comment|/* FIXME: shutdown of some sort */
r_return
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_reinit_firmware
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: orinoco_reset: Error %d re-initializing firmware&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* This has to be called from user context */
id|priv-&gt;hw_unavailable
op_decrement
suffix:semicolon
multiline_comment|/* priv-&gt;open or priv-&gt;hw_unavailable might have changed while&n;&t; * we dropped the lock */
r_if
c_cond
(paren
id|priv-&gt;open
op_logical_and
(paren
op_logical_neg
id|priv-&gt;hw_unavailable
)paren
)paren
(brace
id|err
op_assign
id|__orinoco_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: orinoco_reset: Error %d reenabling card&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
)brace
r_else
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Interrupt handler                                                */
multiline_comment|/********************************************************************/
DECL|function|__orinoco_ev_tick
r_static
r_void
id|__orinoco_ev_tick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: TICK&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|__orinoco_ev_wterr
r_static
r_void
id|__orinoco_ev_wterr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|hermes_t
op_star
id|hw
)paren
(brace
multiline_comment|/* This seems to happen a fair bit under load, but ignoring it&n;&t;   seems to work fine...*/
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MAC controller error (WTERR). Ignoring.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|orinoco_interrupt
id|irqreturn_t
id|orinoco_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|count
op_assign
id|MAX_IRQLOOPS_PER_IRQ
suffix:semicolon
id|u16
id|evstat
comma
id|events
suffix:semicolon
multiline_comment|/* These are used to detect a runaway interrupt situation */
multiline_comment|/* If we get more than MAX_IRQLOOPS_PER_JIFFY iterations in a jiffy,&n;&t; * we panic and shut down the hardware */
r_static
r_int
id|last_irq_jiffy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* jiffies value the last time&n;&t;&t;&t;&t;&t;* we were called */
r_static
r_int
id|loops_this_jiffy
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* If hw is unavailable - we don&squot;t know if the irq was&n;&t;&t; * for us or not */
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
id|evstat
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|EVSTAT
)paren
suffix:semicolon
id|events
op_assign
id|evstat
op_amp
id|hw-&gt;inten
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|events
)paren
(brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|jiffies
op_ne
id|last_irq_jiffy
)paren
id|loops_this_jiffy
op_assign
l_int|0
suffix:semicolon
id|last_irq_jiffy
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|events
op_logical_and
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_increment
id|loops_this_jiffy
OG
id|MAX_IRQLOOPS_PER_JIFFY
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: IRQ handler is looping too &quot;
l_string|&quot;much! Resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts for now */
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;reset_work
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Check the card hasn&squot;t been removed */
r_if
c_cond
(paren
op_logical_neg
id|hermes_present
c_func
(paren
id|hw
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;orinoco_interrupt(): card removed&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TICK
)paren
id|__orinoco_ev_tick
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_WTERR
)paren
id|__orinoco_ev_wterr
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_INFDROP
)paren
id|__orinoco_ev_infdrop
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_INFO
)paren
id|__orinoco_ev_info
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_RX
)paren
id|__orinoco_ev_rx
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TXEXC
)paren
id|__orinoco_ev_txexc
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TX
)paren
id|__orinoco_ev_tx
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_ALLOC
)paren
id|__orinoco_ev_alloc
c_func
(paren
id|dev
comma
id|hw
)paren
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|EVACK
comma
id|events
)paren
suffix:semicolon
id|evstat
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|EVSTAT
)paren
suffix:semicolon
id|events
op_assign
id|evstat
op_amp
id|hw-&gt;inten
suffix:semicolon
)brace
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Initialization                                                   */
multiline_comment|/********************************************************************/
DECL|struct|sta_id
r_struct
id|sta_id
(brace
DECL|member|id
DECL|member|variant
DECL|member|major
DECL|member|minor
id|u16
id|id
comma
id|variant
comma
id|major
comma
id|minor
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|function|determine_firmware_type
r_static
r_int
id|determine_firmware_type
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sta_id
op_star
id|sta_id
)paren
(brace
multiline_comment|/* FIXME: this is fundamentally broken */
r_int
r_int
id|firmver
op_assign
(paren
(paren
id|u32
)paren
id|sta_id-&gt;major
op_lshift
l_int|16
)paren
op_or
id|sta_id-&gt;minor
suffix:semicolon
r_if
c_cond
(paren
id|sta_id-&gt;variant
op_eq
l_int|1
)paren
r_return
id|FIRMWARE_TYPE_AGERE
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|sta_id-&gt;variant
op_eq
l_int|2
)paren
op_logical_and
(paren
(paren
id|firmver
op_eq
l_int|0x10001
)paren
op_logical_or
(paren
id|firmver
op_eq
l_int|0x20001
)paren
)paren
)paren
r_return
id|FIRMWARE_TYPE_SYMBOL
suffix:semicolon
r_else
r_return
id|FIRMWARE_TYPE_INTERSIL
suffix:semicolon
)brace
DECL|function|determine_firmware
r_static
r_void
id|determine_firmware
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|sta_id
id|sta_id
suffix:semicolon
r_int
r_int
id|firmver
suffix:semicolon
r_char
id|tmp
(braket
id|SYMBOL_MAX_VER_LEN
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Get the firmware version */
id|err
op_assign
id|HERMES_READ_RECORD
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_STAID
comma
op_amp
id|sta_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error %d reading firmware info. Wildly guessing capabilities...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sta_id
comma
l_int|0
comma
r_sizeof
(paren
id|sta_id
)paren
)paren
suffix:semicolon
)brace
id|le16_to_cpus
c_func
(paren
op_amp
id|sta_id.id
)paren
suffix:semicolon
id|le16_to_cpus
c_func
(paren
op_amp
id|sta_id.variant
)paren
suffix:semicolon
id|le16_to_cpus
c_func
(paren
op_amp
id|sta_id.major
)paren
suffix:semicolon
id|le16_to_cpus
c_func
(paren
op_amp
id|sta_id.minor
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Station identity %04x:%04x:%04x:%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sta_id.id
comma
id|sta_id.variant
comma
id|sta_id.major
comma
id|sta_id.minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;firmware_type
)paren
id|priv-&gt;firmware_type
op_assign
id|determine_firmware_type
c_func
(paren
id|dev
comma
op_amp
id|sta_id
)paren
suffix:semicolon
multiline_comment|/* Default capabilities */
id|priv-&gt;has_sensitivity
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss_any
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_wep
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_big_wep
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Determine capabilities from the firmware version */
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_AGERE
suffix:colon
multiline_comment|/* Lucent Wavelan IEEE, Lucent Orinoco, Cabletron RoamAbout,&n;&t;&t;   ELSA, Melco, HP, IBM, Dell 1150, Compaq 110/210 */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Looks like a Lucent/Agere firmware &quot;
l_string|&quot;version %d.%02d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sta_id.major
comma
id|sta_id.minor
)paren
suffix:semicolon
id|firmver
op_assign
(paren
(paren
r_int
r_int
)paren
id|sta_id.major
op_lshift
l_int|16
)paren
op_or
id|sta_id.minor
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x60006
)paren
suffix:semicolon
id|priv-&gt;has_ibss_any
op_assign
(paren
id|firmver
op_ge
l_int|0x60010
)paren
suffix:semicolon
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x40020
)paren
suffix:semicolon
id|priv-&gt;has_big_wep
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME: this is wrong - how do we tell&n;&t;&t;&t;&t;&t;  Gold cards from the others? */
id|priv-&gt;has_mwo
op_assign
(paren
id|firmver
op_ge
l_int|0x60000
)paren
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x40020
)paren
suffix:semicolon
multiline_comment|/* Don&squot;t work in 7.52 ? */
id|priv-&gt;ibss_port
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Tested with Agere firmware :&n;&t;&t; *&t;1.16 ; 4.08 ; 4.52 ; 6.04 ; 6.16 ; 7.28 =&gt; Jean II&n;&t;&t; * Tested CableTron firmware : 4.32 =&gt; Anton */
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol , 3Com AirConnect, Intel, Ericsson WLAN */
multiline_comment|/* Intel MAC : 00:02:B3:* */
multiline_comment|/* 3Com MAC : 00:50:DA:* */
id|memset
c_func
(paren
id|tmp
comma
l_int|0
comma
r_sizeof
(paren
id|tmp
)paren
)paren
suffix:semicolon
multiline_comment|/* Get the Symbol firmware version */
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_SECONDARYVERSION_SYMBOL
comma
id|SYMBOL_MAX_VER_LEN
comma
l_int|NULL
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error %d reading Symbol firmware info. Wildly guessing capabilities...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|firmver
op_assign
l_int|0
suffix:semicolon
id|tmp
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* The firmware revision is a string, the format is&n;&t;&t;&t; * something like : &quot;V2.20-01&quot;.&n;&t;&t;&t; * Quick and dirty parsing... - Jean II&n;&t;&t;&t; */
id|firmver
op_assign
(paren
(paren
id|tmp
(braket
l_int|1
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|tmp
(braket
l_int|3
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
l_int|12
)paren
op_or
(paren
(paren
id|tmp
(braket
l_int|4
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|tmp
(braket
l_int|6
)braket
op_minus
l_char|&squot;0&squot;
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|tmp
(braket
l_int|7
)braket
op_minus
l_char|&squot;0&squot;
)paren
suffix:semicolon
id|tmp
(braket
id|SYMBOL_MAX_VER_LEN
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Looks like a Symbol firmware &quot;
l_string|&quot;version [%s] (parsing to %X)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tmp
comma
id|firmver
)paren
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
suffix:semicolon
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x15012
)paren
suffix:semicolon
id|priv-&gt;has_big_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
op_logical_and
(paren
id|firmver
OL
l_int|0x22000
)paren
suffix:semicolon
id|priv-&gt;has_preamble
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
suffix:semicolon
id|priv-&gt;ibss_port
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* Tested with Intel firmware : 0x20015 =&gt; Jean II */
multiline_comment|/* Tested with 3Com firmware : 0x15012 &amp; 0x22001 =&gt; Jean II */
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_INTERSIL
suffix:colon
multiline_comment|/* D-Link, Linksys, Adtron, ZoomAir, and many others...&n;&t;&t; * Samsung, Compaq 100/200 and Proxim are slightly&n;&t;&t; * different and less well tested */
multiline_comment|/* D-Link MAC : 00:40:05:* */
multiline_comment|/* Addtron MAC : 00:90:D1:* */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Looks like an Intersil firmware &quot;
l_string|&quot;version %d.%d.%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|sta_id.major
comma
id|sta_id.minor
comma
id|sta_id.variant
)paren
suffix:semicolon
id|firmver
op_assign
(paren
(paren
r_int
r_int
)paren
id|sta_id.major
op_lshift
l_int|16
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|sta_id.minor
op_lshift
l_int|8
)paren
op_or
id|sta_id.variant
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x000700
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_big_wep
op_assign
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x000800
)paren
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x000700
)paren
suffix:semicolon
r_if
c_cond
(paren
id|firmver
op_ge
l_int|0x000800
)paren
id|priv-&gt;ibss_port
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Intersil firmware earlier &quot;
l_string|&quot;than v0.8.x - several features not supported&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;ibss_port
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|function|orinoco_init
r_static
r_int
id|orinoco_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_struct
id|hermes_idstring
id|nickbuf
suffix:semicolon
id|u16
id|reclen
suffix:semicolon
r_int
id|len
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* No need to lock, the hw_unavailable flag is already set in&n;&t; * alloc_orinocodev() */
id|priv-&gt;nicbuf_size
op_assign
id|IEEE802_11_FRAME_LEN
op_plus
id|ETH_HLEN
suffix:semicolon
multiline_comment|/* Initialize the firmware */
id|err
op_assign
id|hermes_init
c_func
(paren
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to initialize firmware (err = %d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|determine_firmware
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_port3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Ad-hoc demo mode supported&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_ibss
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: IEEE standard IBSS ad-hoc mode supported&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: WEP supported, &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_big_wep
)paren
id|printk
c_func
(paren
l_string|&quot;104-bit key&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;40-bit key&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Get the MAC address */
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNMACADDR
comma
id|ETH_ALEN
comma
l_int|NULL
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to read MAC address!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MAC address %02X:%02X:%02X:%02X:%02X:%02X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
multiline_comment|/* Get the station name */
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFOWNNAME
comma
r_sizeof
(paren
id|nickbuf
)paren
comma
op_amp
id|reclen
comma
op_amp
id|nickbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read station name&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nickbuf.len
)paren
id|len
op_assign
id|min
c_func
(paren
id|IW_ESSID_MAX_SIZE
comma
(paren
r_int
)paren
id|le16_to_cpu
c_func
(paren
id|nickbuf.len
)paren
)paren
suffix:semicolon
r_else
id|len
op_assign
id|min
c_func
(paren
id|IW_ESSID_MAX_SIZE
comma
l_int|2
op_star
id|reclen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;nick
comma
op_amp
id|nickbuf.val
comma
id|len
)paren
suffix:semicolon
id|priv-&gt;nick
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Station name &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;nick
)paren
suffix:semicolon
multiline_comment|/* Get allowed channels */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CHANNELLIST
comma
op_amp
id|priv-&gt;channel_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read channel list!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get initial AP density */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFSYSTEMSCALE
comma
op_amp
id|priv-&gt;ap_density
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_or
id|priv-&gt;ap_density
template_param
l_int|3
)paren
(brace
id|priv-&gt;has_sensitivity
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Get initial RTS threshold */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFRTSTHRESHOLD
comma
op_amp
id|priv-&gt;rts_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read RTS threshold!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get initial fragmentation settings */
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMWOROBUST_AGERE
comma
op_amp
id|priv-&gt;mwo_robust
)paren
suffix:semicolon
r_else
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFFRAGMENTATIONTHRESHOLD
comma
op_amp
id|priv-&gt;frag_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read fragmentation settings!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Power management setup */
r_if
c_cond
(paren
id|priv-&gt;has_pm
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;pm_mcast
op_assign
l_int|1
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMAXSLEEPDURATION
comma
op_amp
id|priv-&gt;pm_period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read power management period!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPMHOLDOVERDURATION
comma
op_amp
id|priv-&gt;pm_timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read power management timeout!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* Preamble setup */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPREAMBLE_SYMBOL
comma
op_amp
id|priv-&gt;preamble
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set up the default configuration */
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
multiline_comment|/* By default use IEEE/IBSS ad-hoc mode if we have it */
id|priv-&gt;prefer_port3
op_assign
id|priv-&gt;has_port3
op_logical_and
(paren
op_logical_neg
id|priv-&gt;has_ibss
)paren
suffix:semicolon
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;channel
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* default channel, more-or-less arbitrary */
id|priv-&gt;promiscuous
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wep_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_key
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|hermes_allocate
c_func
(paren
id|hw
comma
id|priv-&gt;nicbuf_size
comma
op_amp
id|priv-&gt;txfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EIO
)paren
(brace
multiline_comment|/* Try workaround for old Symbol firmware bug */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: firmware ALLOC bug detected &quot;
l_string|&quot;(old Symbol firmware?). Trying to work around... &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;nicbuf_size
op_assign
id|TX_NICBUF_SIZE_BUG
suffix:semicolon
id|err
op_assign
id|hermes_allocate
c_func
(paren
id|hw
comma
id|priv-&gt;nicbuf_size
comma
op_amp
id|priv-&gt;txfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
l_string|&quot;failed!&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;ok.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error %d allocating Tx buffer&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Make the hardware available, as long as it hasn&squot;t been&n;&t; * removed elsewhere (e.g. by PCMCIA hot unplug) */
id|spin_lock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|priv-&gt;hw_unavailable
op_decrement
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ready&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|alloc_orinocodev
r_struct
id|net_device
op_star
id|alloc_orinocodev
c_func
(paren
r_int
id|sizeof_card
comma
r_int
(paren
op_star
id|hard_reset
)paren
(paren
r_struct
id|orinoco_private
op_star
)paren
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|orinoco_private
op_star
id|priv
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|orinoco_private
)paren
op_plus
id|sizeof_card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|priv-&gt;ndev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|sizeof_card
)paren
id|priv-&gt;card
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|netdev_priv
c_func
(paren
id|dev
)paren
op_plus
r_sizeof
(paren
r_struct
id|orinoco_private
)paren
)paren
suffix:semicolon
r_else
id|priv-&gt;card
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Setup / override net_device fields */
id|dev-&gt;init
op_assign
id|orinoco_init
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|orinoco_xmit
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|orinoco_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|HZ
suffix:semicolon
multiline_comment|/* 1 second timeout */
id|dev-&gt;get_stats
op_assign
id|orinoco_get_stats
suffix:semicolon
id|dev-&gt;get_wireless_stats
op_assign
id|orinoco_get_wireless_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|orinoco_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|orinoco_change_mtu
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|orinoco_set_multicast_list
suffix:semicolon
multiline_comment|/* we use the default eth_mac_addr for setting the MAC addr */
multiline_comment|/* Set up default callbacks */
id|dev-&gt;open
op_assign
id|orinoco_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|orinoco_stop
suffix:semicolon
id|priv-&gt;hard_reset
op_assign
id|hard_reset
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
id|priv-&gt;open
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;hw_unavailable
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* orinoco_init() must clear this&n;&t;&t;&t;&t;   * before anything else touches the&n;&t;&t;&t;&t;   * hardware */
id|INIT_WORK
c_func
(paren
op_amp
id|priv-&gt;reset_work
comma
(paren
r_void
(paren
op_star
)paren
(paren
r_void
op_star
)paren
)paren
id|orinoco_reset
comma
id|dev
)paren
suffix:semicolon
id|priv-&gt;last_linkstatus
op_assign
l_int|0xffff
suffix:semicolon
id|priv-&gt;connected
op_assign
l_int|0
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Wireless extensions                                              */
multiline_comment|/********************************************************************/
DECL|function|orinoco_hw_get_bssid
r_static
r_int
id|orinoco_hw_get_bssid
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
comma
r_char
id|buf
(braket
id|ETH_ALEN
)braket
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENTBSSID
comma
id|ETH_ALEN
comma
l_int|NULL
comma
id|buf
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_hw_get_essid
r_static
r_int
id|orinoco_hw_get_essid
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
comma
r_int
op_star
id|active
comma
r_char
id|buf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_struct
id|hermes_idstring
id|essidbuf
suffix:semicolon
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
op_amp
id|essidbuf.val
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
OG
l_int|0
)paren
(brace
multiline_comment|/* We read the desired SSID from the hardware rather&n;&t;&t;   than from priv-&gt;desired_essid, just in case the&n;&t;&t;   firmware is allowed to change it on us. I&squot;m not&n;&t;&t;   sure about this */
multiline_comment|/* My guess is that the OWNSSID should always be whatever&n;&t;&t; * we set to the card, whereas CURRENT_SSID is the one that&n;&t;&t; * may change... - Jean II */
id|u16
id|rid
suffix:semicolon
op_star
id|active
op_assign
l_int|1
suffix:semicolon
id|rid
op_assign
(paren
id|priv-&gt;port_type
op_eq
l_int|3
)paren
ques
c_cond
id|HERMES_RID_CNFOWNSSID
suffix:colon
id|HERMES_RID_CNFDESIREDSSID
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|rid
comma
r_sizeof
(paren
id|essidbuf
)paren
comma
l_int|NULL
comma
op_amp
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail_unlock
suffix:semicolon
)brace
r_else
(brace
op_star
id|active
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENTSSID
comma
r_sizeof
(paren
id|essidbuf
)paren
comma
l_int|NULL
comma
op_amp
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail_unlock
suffix:semicolon
)brace
id|len
op_assign
id|le16_to_cpu
c_func
(paren
id|essidbuf.len
)paren
suffix:semicolon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
suffix:semicolon
id|buf
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|fail_unlock
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_hw_get_freq
r_static
r_int
id|orinoco_hw_get_freq
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u16
id|channel
suffix:semicolon
r_int
id|freq
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENTCHANNEL
comma
op_amp
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Intersil firmware 1.3.5 returns 0 when the interface is down */
r_if
c_cond
(paren
id|channel
op_eq
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|channel
OL
l_int|1
)paren
op_logical_or
(paren
id|channel
OG
id|NUM_CHANNELS
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Channel out of range (%d)!&bslash;n&quot;
comma
id|priv-&gt;ndev-&gt;name
comma
id|channel
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|freq
op_assign
id|channel_frequency
(braket
id|channel
op_minus
l_int|1
)braket
op_star
l_int|100000
suffix:semicolon
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_return
id|err
ques
c_cond
id|err
suffix:colon
id|freq
suffix:semicolon
)brace
DECL|function|orinoco_hw_get_bitratelist
r_static
r_int
id|orinoco_hw_get_bitratelist
c_func
(paren
r_struct
id|orinoco_private
op_star
id|priv
comma
r_int
op_star
id|numrates
comma
id|s32
op_star
id|rates
comma
r_int
id|max
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_struct
id|hermes_idstring
id|list
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|list.val
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|num
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_SUPPORTEDDATARATES
comma
r_sizeof
(paren
id|list
)paren
comma
l_int|NULL
comma
op_amp
id|list
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|num
op_assign
id|le16_to_cpu
c_func
(paren
id|list.len
)paren
suffix:semicolon
op_star
id|numrates
op_assign
id|num
suffix:semicolon
id|num
op_assign
id|min
c_func
(paren
id|num
comma
id|max
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rates
(braket
id|i
)braket
op_assign
(paren
id|p
(braket
id|i
)braket
op_amp
l_int|0x7f
)paren
op_star
l_int|500000
suffix:semicolon
multiline_comment|/* convert to bps */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getiwrange
r_static
r_int
id|orinoco_ioctl_getiwrange
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|rrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|mode
suffix:semicolon
r_struct
id|iw_range
id|range
suffix:semicolon
r_int
id|numrates
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|rrq-&gt;pointer
comma
r_sizeof
(paren
id|range
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|rrq-&gt;length
op_assign
r_sizeof
(paren
id|range
)paren
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|mode
op_assign
id|priv-&gt;iw_mode
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|range
comma
l_int|0
comma
r_sizeof
(paren
id|range
)paren
)paren
suffix:semicolon
multiline_comment|/* Much of this shamelessly taken from wvlan_cs.c. No idea&n;&t; * what it all means -dgibson */
id|range.we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range.we_version_source
op_assign
l_int|11
suffix:semicolon
id|range.min_nwid
op_assign
id|range.max_nwid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We don&squot;t use nwids */
multiline_comment|/* Set available channels/frequencies */
id|range.num_channels
op_assign
id|NUM_CHANNELS
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;channel_mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|range.freq
(braket
id|k
)braket
dot
id|i
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|range.freq
(braket
id|k
)braket
dot
id|m
op_assign
id|channel_frequency
(braket
id|i
)braket
op_star
l_int|100000
suffix:semicolon
id|range.freq
(braket
id|k
)braket
dot
id|e
op_assign
l_int|1
suffix:semicolon
id|k
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_ge
id|IW_MAX_FREQUENCIES
)paren
r_break
suffix:semicolon
)brace
id|range.num_frequency
op_assign
id|k
suffix:semicolon
id|range.sensitivity
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mode
op_eq
id|IW_MODE_ADHOC
)paren
op_logical_and
(paren
id|priv-&gt;spy_number
op_eq
l_int|0
)paren
)paren
(brace
multiline_comment|/* Quality stats meaningless in ad-hoc mode */
id|range.max_qual.qual
op_assign
l_int|0
suffix:semicolon
id|range.max_qual.level
op_assign
l_int|0
suffix:semicolon
id|range.max_qual.noise
op_assign
l_int|0
suffix:semicolon
id|range.avg_qual.qual
op_assign
l_int|0
suffix:semicolon
id|range.avg_qual.level
op_assign
l_int|0
suffix:semicolon
id|range.avg_qual.noise
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|range.max_qual.qual
op_assign
l_int|0x8b
op_minus
l_int|0x2f
suffix:semicolon
id|range.max_qual.level
op_assign
l_int|0x2f
op_minus
l_int|0x95
op_minus
l_int|1
suffix:semicolon
id|range.max_qual.noise
op_assign
l_int|0x2f
op_minus
l_int|0x95
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Need to get better values */
id|range.avg_qual.qual
op_assign
l_int|0x24
suffix:semicolon
id|range.avg_qual.level
op_assign
l_int|0xC2
suffix:semicolon
id|range.avg_qual.noise
op_assign
l_int|0x9E
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_hw_get_bitratelist
c_func
(paren
id|priv
comma
op_amp
id|numrates
comma
id|range.bitrate
comma
id|IW_MAX_BITRATES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|range.num_bitrates
op_assign
id|numrates
suffix:semicolon
multiline_comment|/* Set an indication of the max TCP throughput in bit/s that we can&n;&t; * expect using this interface. May be use for QoS stuff...&n;&t; * Jean II */
r_if
c_cond
(paren
id|numrates
OG
l_int|2
)paren
(brace
id|range.throughput
op_assign
l_int|5
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
)brace
multiline_comment|/* ~5 Mb/s */
r_else
id|range.throughput
op_assign
l_float|1.5
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ~1.5 Mb/s */
id|range.min_rts
op_assign
l_int|0
suffix:semicolon
id|range.max_rts
op_assign
l_int|2347
suffix:semicolon
id|range.min_frag
op_assign
l_int|256
suffix:semicolon
id|range.max_frag
op_assign
l_int|2346
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|range.max_encoding_tokens
op_assign
id|ORINOCO_MAX_KEYS
suffix:semicolon
id|range.encoding_size
(braket
l_int|0
)braket
op_assign
id|SMALL_KEY_SIZE
suffix:semicolon
id|range.num_encoding_sizes
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_big_wep
)paren
(brace
id|range.encoding_size
(braket
l_int|1
)braket
op_assign
id|LARGE_KEY_SIZE
suffix:semicolon
id|range.num_encoding_sizes
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|range.num_encoding_sizes
op_assign
l_int|0
suffix:semicolon
id|range.max_encoding_tokens
op_assign
l_int|0
suffix:semicolon
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|range.min_pmp
op_assign
l_int|0
suffix:semicolon
id|range.max_pmp
op_assign
l_int|65535000
suffix:semicolon
id|range.min_pmt
op_assign
l_int|0
suffix:semicolon
id|range.max_pmt
op_assign
l_int|65535
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
id|range.pmp_flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
id|range.pmt_flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
id|range.pm_capa
op_assign
id|IW_POWER_PERIOD
op_or
id|IW_POWER_TIMEOUT
op_or
id|IW_POWER_UNICAST_R
suffix:semicolon
id|range.num_txpower
op_assign
l_int|1
suffix:semicolon
id|range.txpower
(braket
l_int|0
)braket
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* 15dBm */
id|range.txpower_capa
op_assign
id|IW_TXPOW_DBM
suffix:semicolon
id|range.retry_capa
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.retry_flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range.r_time_flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.min_retry
op_assign
l_int|0
suffix:semicolon
id|range.max_retry
op_assign
l_int|65535
suffix:semicolon
multiline_comment|/* ??? */
id|range.min_r_time
op_assign
l_int|0
suffix:semicolon
id|range.max_r_time
op_assign
l_int|65535
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|rrq-&gt;pointer
comma
op_amp
id|range
comma
r_sizeof
(paren
id|range
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setiwencode
r_static
r_int
id|orinoco_ioctl_setiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|index
op_assign
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|setindex
op_assign
id|priv-&gt;tx_key
suffix:semicolon
r_int
id|enable
op_assign
id|priv-&gt;wep_on
suffix:semicolon
r_int
id|restricted
op_assign
id|priv-&gt;wep_restrict
suffix:semicolon
id|u16
id|xlen
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_char
id|keybuf
(braket
id|ORINOCO_MAX_KEY_SIZE
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
multiline_comment|/* We actually have a key to set */
r_if
c_cond
(paren
(paren
id|erq-&gt;length
OL
id|SMALL_KEY_SIZE
)paren
op_logical_or
(paren
id|erq-&gt;length
OG
id|ORINOCO_MAX_KEY_SIZE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|keybuf
comma
id|erq-&gt;pointer
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|ORINOCO_MAX_KEY_SIZE
)paren
(brace
id|err
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|erq-&gt;length
OG
id|LARGE_KEY_SIZE
)paren
op_logical_or
(paren
op_logical_neg
id|priv-&gt;has_big_wep
op_logical_and
(paren
id|erq-&gt;length
OG
id|SMALL_KEY_SIZE
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|ORINOCO_MAX_KEYS
)paren
)paren
id|index
op_assign
id|priv-&gt;tx_key
suffix:semicolon
multiline_comment|/* Adjust key length to a supported value */
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|SMALL_KEY_SIZE
)paren
(brace
id|xlen
op_assign
id|LARGE_KEY_SIZE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|erq-&gt;length
OG
l_int|0
)paren
(brace
id|xlen
op_assign
id|SMALL_KEY_SIZE
suffix:semicolon
)brace
r_else
id|xlen
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Switch on WEP if off */
r_if
c_cond
(paren
(paren
op_logical_neg
id|enable
)paren
op_logical_and
(paren
id|xlen
OG
l_int|0
)paren
)paren
(brace
id|setindex
op_assign
id|index
suffix:semicolon
id|enable
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Important note : if the user do &quot;iwconfig eth0 enc off&quot;,&n;&t;&t; * we will arrive there with an index of -1. This is valid&n;&t;&t; * but need to be taken care off... Jean II */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|ORINOCO_MAX_KEYS
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|index
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|erq-&gt;flags
op_eq
l_int|0
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Set the index : Check that the key is valid */
r_if
c_cond
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
op_eq
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|setindex
op_assign
id|index
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_DISABLED
)paren
id|enable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Only for Prism2 &amp; Symbol cards (so far) - Jean II */
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_OPEN
)paren
id|restricted
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
id|restricted
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
op_assign
id|cpu_to_le16
c_func
(paren
id|xlen
)paren
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
id|keybuf
comma
id|erq-&gt;length
)paren
suffix:semicolon
)brace
id|priv-&gt;tx_key
op_assign
id|setindex
suffix:semicolon
id|priv-&gt;wep_on
op_assign
id|enable
suffix:semicolon
id|priv-&gt;wep_restrict
op_assign
id|restricted
suffix:semicolon
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getiwencode
r_static
r_int
id|orinoco_ioctl_getiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|index
op_assign
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
id|u16
id|xlen
op_assign
l_int|0
suffix:semicolon
r_char
id|keybuf
(braket
id|ORINOCO_MAX_KEY_SIZE
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|ORINOCO_MAX_KEYS
)paren
)paren
id|index
op_assign
id|priv-&gt;tx_key
suffix:semicolon
id|erq-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep_on
)paren
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
id|erq-&gt;flags
op_or_assign
id|index
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Only for symbol cards - Jean II */
r_if
c_cond
(paren
id|priv-&gt;firmware_type
op_ne
id|FIRMWARE_TYPE_AGERE
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;wep_restrict
)paren
(brace
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_RESTRICTED
suffix:semicolon
)brace
r_else
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_OPEN
suffix:semicolon
)brace
id|xlen
op_assign
id|le16_to_cpu
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
)paren
suffix:semicolon
id|erq-&gt;length
op_assign
id|xlen
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
id|memcpy
c_func
(paren
id|keybuf
comma
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
id|ORINOCO_MAX_KEY_SIZE
)paren
suffix:semicolon
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|erq-&gt;pointer
comma
id|keybuf
comma
id|xlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setessid
r_static
r_int
id|orinoco_ioctl_setessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
id|essidbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Note : ESSID is ignored in Ad-Hoc demo mode, but we can set it&n;&t; * anyway... - Jean II */
id|memset
c_func
(paren
op_amp
id|essidbuf
comma
l_int|0
comma
r_sizeof
(paren
id|essidbuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;flags
)paren
(brace
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|IW_ESSID_MAX_SIZE
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|essidbuf
comma
id|erq-&gt;pointer
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|essidbuf
(braket
id|erq-&gt;length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;desired_essid
comma
id|essidbuf
comma
r_sizeof
(paren
id|priv-&gt;desired_essid
)paren
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getessid
r_static
r_int
id|orinoco_ioctl_getessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
id|essidbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|active
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
id|orinoco_hw_get_essid
c_func
(paren
id|priv
comma
op_amp
id|active
comma
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|essidbuf
comma
id|priv-&gt;desired_essid
comma
r_sizeof
(paren
id|essidbuf
)paren
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
)brace
id|erq-&gt;flags
op_assign
l_int|1
suffix:semicolon
id|erq-&gt;length
op_assign
id|strlen
c_func
(paren
id|essidbuf
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|erq-&gt;pointer
comma
id|essidbuf
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setnick
r_static
r_int
id|orinoco_ioctl_setnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
id|nickbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|nrq-&gt;length
OG
id|IW_ESSID_MAX_SIZE
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|memset
c_func
(paren
id|nickbuf
comma
l_int|0
comma
r_sizeof
(paren
id|nickbuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|nickbuf
comma
id|nrq-&gt;pointer
comma
id|nrq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|nickbuf
(braket
id|nrq-&gt;length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;nick
comma
id|nickbuf
comma
r_sizeof
(paren
id|priv-&gt;nick
)paren
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getnick
r_static
r_int
id|orinoco_ioctl_getnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_char
id|nickbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|nickbuf
comma
id|priv-&gt;nick
comma
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|nrq-&gt;length
op_assign
id|strlen
c_func
(paren
id|nickbuf
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|nrq-&gt;pointer
comma
id|nickbuf
comma
r_sizeof
(paren
id|nickbuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setfreq
r_static
r_int
id|orinoco_ioctl_setfreq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_freq
op_star
id|frq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|chan
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* We can only use this in Ad-Hoc demo mode to set the operating&n;&t; * frequency, or in IBSS mode to set the frequency where the IBSS&n;&t; * will be created - Jean II */
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_ADHOC
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frq-&gt;e
op_eq
l_int|0
)paren
op_logical_and
(paren
id|frq-&gt;m
op_le
l_int|1000
)paren
)paren
(brace
multiline_comment|/* Setting by channel number */
id|chan
op_assign
id|frq-&gt;m
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Setting by frequency - search the table */
r_int
id|mult
op_assign
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|6
op_minus
id|frq-&gt;e
)paren
suffix:semicolon
id|i
op_increment
)paren
id|mult
op_mul_assign
l_int|10
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|frq-&gt;m
op_eq
(paren
id|channel_frequency
(braket
id|i
)braket
op_star
id|mult
)paren
)paren
id|chan
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan
OL
l_int|1
)paren
op_logical_or
(paren
id|chan
OG
id|NUM_CHANNELS
)paren
op_logical_or
op_logical_neg
(paren
id|priv-&gt;channel_mask
op_amp
(paren
l_int|1
op_lshift
(paren
id|chan
op_minus
l_int|1
)paren
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;channel
op_assign
id|chan
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getsens
r_static
r_int
id|orinoco_ioctl_getsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|u16
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_sensitivity
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFSYSTEMSCALE
comma
op_amp
id|val
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|srq-&gt;value
op_assign
id|val
suffix:semicolon
id|srq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* auto */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setsens
r_static
r_int
id|orinoco_ioctl_setsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|val
op_assign
id|srq-&gt;value
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_sensitivity
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
OL
l_int|1
)paren
op_logical_or
(paren
id|val
OG
l_int|3
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;ap_density
op_assign
id|val
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setrts
r_static
r_int
id|orinoco_ioctl_setrts
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|val
op_assign
id|rrq-&gt;value
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|rrq-&gt;disabled
)paren
id|val
op_assign
l_int|2347
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
OL
l_int|0
)paren
op_logical_or
(paren
id|val
OG
l_int|2347
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;rts_thresh
op_assign
id|val
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setfrag
r_static
r_int
id|orinoco_ioctl_setfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
(brace
r_if
c_cond
(paren
id|frq-&gt;disabled
)paren
id|priv-&gt;mwo_robust
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|frq-&gt;fixed
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Fixed fragmentation not &bslash;&n;supported on this firmware. Using MWO robust instead.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;mwo_robust
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|frq-&gt;disabled
)paren
id|priv-&gt;frag_thresh
op_assign
l_int|2346
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
(paren
id|frq-&gt;value
OL
l_int|256
)paren
op_logical_or
(paren
id|frq-&gt;value
OG
l_int|2346
)paren
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|priv-&gt;frag_thresh
op_assign
id|frq-&gt;value
op_amp
op_complement
l_int|0x1
suffix:semicolon
multiline_comment|/* must be even */
)brace
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getfrag
r_static
r_int
id|orinoco_ioctl_getfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u16
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMWOROBUST_AGERE
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|val
op_assign
l_int|0
suffix:semicolon
id|frq-&gt;value
op_assign
id|val
ques
c_cond
l_int|2347
suffix:colon
l_int|0
suffix:semicolon
id|frq-&gt;disabled
op_assign
op_logical_neg
id|val
suffix:semicolon
id|frq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFFRAGMENTATIONTHRESHOLD
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|val
op_assign
l_int|0
suffix:semicolon
id|frq-&gt;value
op_assign
id|val
suffix:semicolon
id|frq-&gt;disabled
op_assign
(paren
id|val
op_ge
l_int|2346
)paren
suffix:semicolon
id|frq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setrate
r_static
r_int
id|orinoco_ioctl_setrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|ratemode
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|bitrate
suffix:semicolon
multiline_comment|/* 100s of kilobits */
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* As the user space doesn&squot;t know our highest rate, it uses -1&n;&t; * to ask us to set the highest rate.  Test it using &quot;iwconfig&n;&t; * ethX rate auto&quot; - Jean II */
r_if
c_cond
(paren
id|rrq-&gt;value
op_eq
op_minus
l_int|1
)paren
id|bitrate
op_assign
l_int|110
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|rrq-&gt;value
op_mod
l_int|100000
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|bitrate
op_assign
id|rrq-&gt;value
op_div
l_int|100000
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bitrate
op_ne
l_int|10
)paren
op_logical_and
(paren
id|bitrate
op_ne
l_int|20
)paren
op_logical_and
(paren
id|bitrate
op_ne
l_int|55
)paren
op_logical_and
(paren
id|bitrate
op_ne
l_int|110
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BITRATE_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|bitrate_table
(braket
id|i
)braket
dot
id|bitrate
op_eq
id|bitrate
)paren
op_logical_and
(paren
id|bitrate_table
(braket
id|i
)braket
dot
id|automatic
op_eq
op_logical_neg
id|rrq-&gt;fixed
)paren
)paren
(brace
id|ratemode
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ratemode
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;bitratemode
op_assign
id|ratemode
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getrate
r_static
r_int
id|orinoco_ioctl_getrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|ratemode
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|ratemode
op_assign
id|priv-&gt;bitratemode
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|ratemode
OL
l_int|0
)paren
op_logical_or
(paren
id|ratemode
op_ge
id|BITRATE_TABLE_SIZE
)paren
)paren
suffix:semicolon
id|rrq-&gt;value
op_assign
id|bitrate_table
(braket
id|ratemode
)braket
dot
id|bitrate
op_star
l_int|100000
suffix:semicolon
id|rrq-&gt;fixed
op_assign
op_logical_neg
id|bitrate_table
(braket
id|ratemode
)braket
dot
id|automatic
suffix:semicolon
id|rrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If the interface is running we try to find more about the&n;&t;   current mode */
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENTTXRATE
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_AGERE
suffix:colon
multiline_comment|/* Lucent style rate */
multiline_comment|/* Note : in Lucent firmware, the return value of&n;&t;&t;&t; * HERMES_RID_CURRENTTXRATE is the bitrate in Mb/s,&n;&t;&t;&t; * and therefore is totally different from the&n;&t;&t;&t; * encoding of HERMES_RID_CNFTXRATECONTROL.&n;&t;&t;&t; * Don&squot;t forget that 6Mb/s is really 5.5Mb/s */
r_if
c_cond
(paren
id|val
op_eq
l_int|6
)paren
id|rrq-&gt;value
op_assign
l_int|5500000
suffix:semicolon
r_else
id|rrq-&gt;value
op_assign
id|val
op_star
l_int|1000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_INTERSIL
suffix:colon
multiline_comment|/* Intersil style rate */
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol style rate */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BITRATE_TABLE_SIZE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|bitrate_table
(braket
id|i
)braket
dot
id|intersil_txratectrl
op_eq
id|val
)paren
(brace
id|ratemode
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
id|BITRATE_TABLE_SIZE
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unable to determine current bitrate (0x%04hx)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|val
)paren
suffix:semicolon
id|rrq-&gt;value
op_assign
id|bitrate_table
(braket
id|ratemode
)braket
dot
id|bitrate
op_star
l_int|100000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setpower
r_static
r_int
id|orinoco_ioctl_setpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|prq-&gt;disabled
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_MODE
)paren
(brace
r_case
id|IW_POWER_UNICAST_R
suffix:colon
id|priv-&gt;pm_mcast
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_POWER_ALL_R
suffix:colon
id|priv-&gt;pm_mcast
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_POWER_ON
suffix:colon
multiline_comment|/* No flags : but we may have a value - Jean II */
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_TIMEOUT
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_timeout
op_assign
id|prq-&gt;value
op_div
l_int|1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_PERIOD
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_period
op_assign
id|prq-&gt;value
op_div
l_int|1000
suffix:semicolon
)brace
multiline_comment|/* It&squot;s valid to not have a value if we are just toggling&n;&t;&t; * the flags... Jean II */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;pm_on
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getpower
r_static
r_int
id|orinoco_ioctl_getpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u16
id|enable
comma
id|period
comma
id|timeout
comma
id|mcast
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPMENABLED
comma
op_amp
id|enable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMAXSLEEPDURATION
comma
op_amp
id|period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFPMHOLDOVERDURATION
comma
op_amp
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNFMULTICASTRECEIVE
comma
op_amp
id|mcast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|prq-&gt;disabled
op_assign
op_logical_neg
id|enable
suffix:semicolon
multiline_comment|/* Note : by default, display the period */
r_if
c_cond
(paren
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_TYPE
)paren
op_eq
id|IW_POWER_TIMEOUT
)paren
(brace
id|prq-&gt;flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
id|prq-&gt;value
op_assign
id|timeout
op_star
l_int|1000
suffix:semicolon
)brace
r_else
(brace
id|prq-&gt;flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
id|prq-&gt;value
op_assign
id|period
op_star
l_int|1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcast
)paren
id|prq-&gt;flags
op_or_assign
id|IW_POWER_ALL_R
suffix:semicolon
r_else
id|prq-&gt;flags
op_or_assign
id|IW_POWER_UNICAST_R
suffix:semicolon
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getretry
r_static
r_int
id|orinoco_ioctl_getretry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|u16
id|short_limit
comma
id|long_limit
comma
id|lifetime
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_SHORTRETRYLIMIT
comma
op_amp
id|short_limit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_LONGRETRYLIMIT
comma
op_amp
id|long_limit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_MAXTRANSMITLIFETIME
comma
op_amp
id|lifetime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|rrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Can&squot;t be disabled */
multiline_comment|/* Note : by default, display the retry number */
r_if
c_cond
(paren
(paren
id|rrq-&gt;flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIFETIME
)paren
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
id|rrq-&gt;value
op_assign
id|lifetime
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
)brace
r_else
(brace
multiline_comment|/* By default, display the min number */
r_if
c_cond
(paren
(paren
id|rrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
)paren
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MAX
suffix:semicolon
id|rrq-&gt;value
op_assign
id|long_limit
suffix:semicolon
)brace
r_else
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|rrq-&gt;value
op_assign
id|short_limit
suffix:semicolon
r_if
c_cond
(paren
id|short_limit
op_ne
id|long_limit
)paren
(brace
id|rrq-&gt;flags
op_or_assign
id|IW_RETRY_MIN
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setibssport
r_static
r_int
id|orinoco_ioctl_setibssport
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|priv-&gt;ibss_port
op_assign
id|val
suffix:semicolon
multiline_comment|/* Actually update the mode we are using */
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getibssport
r_static
r_int
id|orinoco_ioctl_getibssport
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
op_star
id|val
op_assign
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
op_star
id|val
op_assign
id|priv-&gt;ibss_port
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_setport3
r_static
r_int
id|orinoco_ioctl_setport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Try to do IEEE ad-hoc mode */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_ibss
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|priv-&gt;prefer_port3
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Try to do Lucent proprietary ad-hoc mode */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_port3
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|priv-&gt;prefer_port3
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
multiline_comment|/* Actually update the mode we are using */
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getport3
r_static
r_int
id|orinoco_ioctl_getport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
op_star
id|val
op_assign
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
op_star
id|val
op_assign
id|priv-&gt;prefer_port3
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Spy is used for link quality/strength measurements in Ad-Hoc mode&n; * Jean II */
DECL|function|orinoco_ioctl_setspy
r_static
r_int
id|orinoco_ioctl_setspy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|srq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|number
op_assign
id|srq-&gt;length
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Check the number of addresses */
r_if
c_cond
(paren
id|number
OG
id|IW_MAX_SPY
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
multiline_comment|/* Get the data in the driver */
r_if
c_cond
(paren
id|srq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|address
comma
id|srq-&gt;pointer
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Make sure nobody mess with the structure while we do */
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* orinoco_lock() doesn&squot;t disable interrupts, so make sure the&n;&t; * interrupt rx path don&squot;t get confused while we copy */
id|priv-&gt;spy_number
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|number
OG
l_int|0
)paren
(brace
multiline_comment|/* Extract the addresses */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
id|memcpy
c_func
(paren
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* Reset stats */
id|memset
c_func
(paren
id|priv-&gt;spy_stat
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
multiline_comment|/* Set number of addresses */
id|priv-&gt;spy_number
op_assign
id|number
suffix:semicolon
)brace
multiline_comment|/* Now, let the others play */
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|orinoco_ioctl_getspy
r_static
r_int
id|orinoco_ioctl_getspy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|srq
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_struct
id|iw_quality
id|spy_stat
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|number
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|number
op_assign
id|priv-&gt;spy_number
suffix:semicolon
r_if
c_cond
(paren
(paren
id|number
OG
l_int|0
)paren
op_logical_and
(paren
id|srq-&gt;pointer
)paren
)paren
(brace
multiline_comment|/* Create address struct */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|address
(braket
id|i
)braket
dot
id|sa_family
op_assign
id|AF_UNIX
suffix:semicolon
)brace
multiline_comment|/* Copy stats */
multiline_comment|/* In theory, we should disable irqs while copying the stats&n;&t;&t; * because the rx path migh update it in the middle...&n;&t;&t; * Bah, who care ? - Jean II */
id|memcpy
c_func
(paren
op_amp
id|spy_stat
comma
id|priv-&gt;spy_stat
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|0
suffix:semicolon
)brace
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
multiline_comment|/* Push stuff to user space */
id|srq-&gt;length
op_assign
id|number
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|srq-&gt;pointer
comma
id|address
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|srq-&gt;pointer
op_plus
(paren
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
comma
op_amp
id|spy_stat
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|number
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|orinoco_ioctl
id|orinoco_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|iwreq
op_star
id|wrq
op_assign
(paren
r_struct
id|iwreq
op_star
)paren
id|rq
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|changed
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* In theory, we could allow most of the the SET stuff to be&n;&t; * done. In practice, the lapse of time at startup when the&n;&t; * card is not ready is very short, so why bother...  Note&n;&t; * that netif_device_present is different from up/down&n;&t; * (ifconfig), when the device is not yet up, it is usually&n;&t; * already ready...  Jean II */
r_if
c_cond
(paren
op_logical_neg
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIWNAME
suffix:colon
id|strcpy
c_func
(paren
id|wrq-&gt;u.name
comma
l_string|&quot;IEEE 802.11-DS&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWAP
suffix:colon
id|wrq-&gt;u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|err
op_assign
id|orinoco_hw_get_bssid
c_func
(paren
id|priv
comma
id|wrq-&gt;u.ap_addr.sa_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRANGE
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getiwrange
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWMODE
suffix:colon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|wrq-&gt;u.mode
)paren
(brace
r_case
id|IW_MODE_ADHOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|priv-&gt;has_ibss
op_logical_or
id|priv-&gt;has_port3
)paren
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_ADHOC
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|IW_MODE_INFRA
suffix:colon
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWMODE
suffix:colon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|wrq-&gt;u.mode
op_assign
id|priv-&gt;iw_mode
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWENCODE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_ioctl_setiwencode
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.encoding
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWENCODE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_ioctl_getiwencode
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.encoding
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWESSID
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setessid
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.essid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWESSID
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getessid
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.essid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWNICKN
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setnick
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWNICKN
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getnick
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWFREQ
suffix:colon
id|tmp
op_assign
id|orinoco_hw_get_freq
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
l_int|0
)paren
(brace
id|err
op_assign
id|tmp
suffix:semicolon
)brace
r_else
(brace
id|wrq-&gt;u.freq.m
op_assign
id|tmp
suffix:semicolon
id|wrq-&gt;u.freq.e
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCSIWFREQ
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setfreq
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.freq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWSENS
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getsens
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.sens
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWSENS
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setsens
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.sens
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRTS
suffix:colon
id|wrq-&gt;u.rts.value
op_assign
id|priv-&gt;rts_thresh
suffix:semicolon
id|wrq-&gt;u.rts.disabled
op_assign
(paren
id|wrq-&gt;u.rts.value
op_eq
l_int|2347
)paren
suffix:semicolon
id|wrq-&gt;u.rts.fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWRTS
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setrts
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.rts
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWFRAG
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setfrag
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.frag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWFRAG
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getfrag
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.frag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWRATE
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setrate
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.bitrate
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRATE
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getrate
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.bitrate
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWPOWER
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setpower
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.power
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWPOWER
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getpower
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.power
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWTXPOW
suffix:colon
multiline_comment|/* The card only supports one tx power, so this is easy */
id|wrq-&gt;u.txpower.value
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* dBm */
id|wrq-&gt;u.txpower.fixed
op_assign
l_int|1
suffix:semicolon
id|wrq-&gt;u.txpower.disabled
op_assign
l_int|0
suffix:semicolon
id|wrq-&gt;u.txpower.flags
op_assign
id|IW_TXPOW_DBM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWRETRY
suffix:colon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRETRY
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getretry
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.retry
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWSPY
suffix:colon
id|err
op_assign
id|orinoco_ioctl_setspy
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWSPY
suffix:colon
id|err
op_assign
id|orinoco_ioctl_getspy
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWPRIV
suffix:colon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_struct
id|iw_priv_args
id|privtab
(braket
)braket
op_assign
(brace
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x0
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;force_reset&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x1
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;card_reset&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x2
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_port3&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x3
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_port3&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x4
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_preamble&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x5
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_preamble&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x6
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_ibssport&quot;
)brace
comma
(brace
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x7
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_ibssport&quot;
)brace
comma
(brace
id|SIOCIWLASTPRIV
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;dump_recs&quot;
)brace
comma
)brace
suffix:semicolon
id|wrq-&gt;u.data.length
op_assign
r_sizeof
(paren
id|privtab
)paren
op_div
r_sizeof
(paren
id|privtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
id|privtab
comma
r_sizeof
(paren
id|privtab
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x0
suffix:colon
multiline_comment|/* force_reset */
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x1
suffix:colon
multiline_comment|/* card_reset */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Force scheduling reset!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|schedule_work
c_func
(paren
op_amp
id|priv-&gt;reset_work
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x2
suffix:colon
multiline_comment|/* set_port3 */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_ioctl_setport3
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x3
suffix:colon
multiline_comment|/* get_port3 */
id|err
op_assign
id|orinoco_ioctl_getport3
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x4
suffix:colon
multiline_comment|/* set_preamble */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* 802.11b has recently defined some short preamble.&n;&t;&t; * Basically, the Phy header has been reduced in size.&n;&t;&t; * This increase performance, especially at high rates&n;&t;&t; * (the preamble is transmitted at 1Mb/s), unfortunately&n;&t;&t; * this give compatibility troubles... - Jean II */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
r_int
id|val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|priv-&gt;preamble
op_assign
l_int|1
suffix:semicolon
r_else
id|priv-&gt;preamble
op_assign
l_int|0
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x5
suffix:colon
multiline_comment|/* get_preamble */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
r_int
op_star
id|val
op_assign
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
suffix:semicolon
r_if
c_cond
(paren
id|orinoco_lock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
op_star
id|val
op_assign
id|priv-&gt;preamble
suffix:semicolon
id|orinoco_unlock
c_func
(paren
id|priv
comma
op_amp
id|flags
)paren
suffix:semicolon
)brace
r_else
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x6
suffix:colon
multiline_comment|/* set_ibssport */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|orinoco_ioctl_setibssport
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWFIRSTPRIV
op_plus
l_int|0x7
suffix:colon
multiline_comment|/* get_ibssport */
id|err
op_assign
id|orinoco_ioctl_getibssport
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCIWLASTPRIV
suffix:colon
id|err
op_assign
id|orinoco_debug_dump_recs
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Unable to dump records (%d)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|changed
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
id|orinoco_reconfigure
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_struct
(brace
DECL|member|rid
id|u16
id|rid
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|displaytype
r_int
id|displaytype
suffix:semicolon
DECL|macro|DISPLAY_WORDS
mdefine_line|#define DISPLAY_WORDS&t;0
DECL|macro|DISPLAY_BYTES
mdefine_line|#define DISPLAY_BYTES&t;1
DECL|macro|DISPLAY_STRING
mdefine_line|#define DISPLAY_STRING&t;2
DECL|macro|DISPLAY_XSTRING
mdefine_line|#define DISPLAY_XSTRING&t;3
DECL|variable|record_table
)brace
id|record_table
(braket
)braket
op_assign
(brace
DECL|macro|DEBUG_REC
mdefine_line|#define DEBUG_REC(name,type) { HERMES_RID_##name, #name, DISPLAY_##type }
id|DEBUG_REC
c_func
(paren
id|CNFPORTTYPE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNMACADDR
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFDESIREDSSID
comma
id|STRING
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNCHANNEL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNSSID
comma
id|STRING
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNATIMWINDOW
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFSYSTEMSCALE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMAXDATALEN
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPMENABLED
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPMEPS
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMULTICASTRECEIVE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMAXSLEEPDURATION
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPMHOLDOVERDURATION
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNNAME
comma
id|STRING
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFOWNDTIMPERIOD
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMULTICASTPMBUFFERING
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFWEPENABLED_AGERE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMANDATORYBSSID_SYMBOL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFWEPDEFAULTKEYID
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFDEFAULTKEY0
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFDEFAULTKEY1
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMWOROBUST_AGERE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFDEFAULTKEY2
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFDEFAULTKEY3
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFWEPFLAGS_INTERSIL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFWEPKEYMAPPINGTABLE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFAUTHENTICATION
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMAXASSOCSTA
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFKEYLENGTH_SYMBOL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTXCONTROL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFROAMINGMODE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFHOSTAUTHENTICATION
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFRCVCRCERROR
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFMMLIFE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFALTRETRYCOUNT
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFBEACONINT
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFAPPCFINFO
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFSTAPCFINFO
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPRIORITYQUSAGE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTIMCTRL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTHIRTY2TALLY
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFENHSECURITY
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFGROUPADDRESSES
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFCREATEIBSS
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFFRAGMENTATIONTHRESHOLD
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFRTSTHRESHOLD
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTXRATECONTROL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPROMISCUOUSMODE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFBASICRATES_SYMBOL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFPREAMBLE_SYMBOL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFSHORTPREAMBLE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFWEPKEYS_AGERE
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFEXCLUDELONGPREAMBLE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTXKEY_AGERE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFAUTHENTICATIONRSPTO
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFBASICRATES
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFSUPPORTEDRATES
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFTICKTIME
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFSCANREQUEST
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFJOINREQUEST
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFAUTHENTICATESTATION
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CNFCHANNELINFOREQUEST
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|MAXLOADTIME
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|DOWNLOADBUFFER
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|PRIID
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|PRISUPRANGE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CFIACTRANGES
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|NICSERNUM
comma
id|XSTRING
)paren
comma
id|DEBUG_REC
c_func
(paren
id|NICID
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|MFISUPRANGE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CFISUPRANGE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CHANNELLIST
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|REGULATORYDOMAINS
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|TEMPTYPE
comma
id|WORDS
)paren
comma
multiline_comment|/*  &t;DEBUG_REC(CIS,BYTES), */
id|DEBUG_REC
c_func
(paren
id|STAID
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTSSID
comma
id|STRING
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTBSSID
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|COMMSQUALITY
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTTXRATE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTBEACONINTERVAL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTSCALETHRESHOLDS
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|PROTOCOLRSPTIME
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|SHORTRETRYLIMIT
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|LONGRETRYLIMIT
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|MAXTRANSMITLIFETIME
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|MAXRECEIVELIFETIME
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CFPOLLABLE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|AUTHENTICATIONALGORITHMS
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|PRIVACYOPTIONIMPLEMENTED
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|OWNMACADDR
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|SCANRESULTSTABLE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|PHYTYPE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTCHANNEL
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CURRENTPOWERSTATE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|CCAMODE
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|SUPPORTEDDATARATES
comma
id|WORDS
)paren
comma
id|DEBUG_REC
c_func
(paren
id|BUILDSEQ
comma
id|BYTES
)paren
comma
id|DEBUG_REC
c_func
(paren
id|FWID
comma
id|XSTRING
)paren
DECL|macro|DEBUG_REC
macro_line|#undef DEBUG_REC
)brace
suffix:semicolon
DECL|macro|DEBUG_LTV_SIZE
mdefine_line|#define DEBUG_LTV_SIZE&t;&t;128
DECL|function|orinoco_debug_dump_recs
r_static
r_int
id|orinoco_debug_dump_recs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|orinoco_private
op_star
id|priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|u8
op_star
id|val8
suffix:semicolon
id|u16
op_star
id|val16
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|u16
id|length
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* I&squot;m not sure: we might have a lock here, so we&squot;d better go&n;           atomic, just in case. */
id|val8
op_assign
id|kmalloc
c_func
(paren
id|DEBUG_LTV_SIZE
op_plus
l_int|2
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val8
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|val16
op_assign
(paren
id|u16
op_star
)paren
id|val8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|record_table
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u16
id|rid
op_assign
id|record_table
(braket
id|i
)braket
dot
id|rid
suffix:semicolon
r_int
id|len
suffix:semicolon
id|memset
c_func
(paren
id|val8
comma
l_int|0
comma
id|DEBUG_LTV_SIZE
op_plus
l_int|2
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|rid
comma
id|DEBUG_LTV_SIZE
comma
op_amp
id|length
comma
id|val8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;Error %d reading RID 0x%04x&bslash;n&quot;
comma
id|err
comma
id|rid
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|val16
op_assign
(paren
id|u16
op_star
)paren
id|val8
suffix:semicolon
r_if
c_cond
(paren
id|length
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%-15s (0x%04x): length=%d (%d bytes)&bslash;tvalue=&quot;
comma
id|record_table
(braket
id|i
)braket
dot
id|name
comma
id|rid
comma
id|length
comma
(paren
id|length
op_minus
l_int|1
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|len
op_assign
id|min
c_func
(paren
(paren
(paren
r_int
)paren
id|length
op_minus
l_int|1
)paren
op_star
l_int|2
comma
id|DEBUG_LTV_SIZE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|record_table
(braket
id|i
)braket
dot
id|displaytype
)paren
(brace
r_case
id|DISPLAY_WORDS
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
op_div
l_int|2
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%04X-&quot;
comma
id|le16_to_cpu
c_func
(paren
id|val16
(braket
id|j
)braket
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPLAY_BYTES
suffix:colon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%02X:&quot;
comma
id|val8
(braket
id|j
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPLAY_STRING
suffix:colon
id|len
op_assign
id|min
c_func
(paren
id|len
comma
id|le16_to_cpu
c_func
(paren
id|val16
(braket
l_int|0
)braket
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|val8
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;&quot;%s&bslash;&quot;&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|val16
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPLAY_XSTRING
suffix:colon
id|printk
c_func
(paren
l_string|&quot;&squot;%s&squot;&quot;
comma
(paren
r_char
op_star
)paren
id|val8
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|val8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/********************************************************************/
multiline_comment|/* Debugging                                                        */
multiline_comment|/********************************************************************/
macro_line|#if 0
r_static
r_void
id|show_rx_frame
c_func
(paren
r_struct
id|orinoco_rxframe_hdr
op_star
id|frame
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RX descriptor:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  status      = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.status
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  time        = 0x%08x&bslash;n&quot;
comma
id|frame-&gt;desc.time
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  silence     = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;desc.silence
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  signal      = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;desc.signal
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  rate        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;desc.rate
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  rxflow      = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;desc.rxflow
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  reserved    = 0x%08x&bslash;n&quot;
comma
id|frame-&gt;desc.reserved
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.11 header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  frame_ctl   = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.frame_ctl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  duration_id = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.duration_id
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr1       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr1
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr2       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr2
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr3       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr3
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  seq_ctl     = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.seq_ctl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr4       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr4
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  data_len    = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.data_len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.3 header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  dest        = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|0
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|1
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|2
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|3
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|4
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  src         = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_source
(braket
l_int|0
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|1
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|2
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|3
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|4
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  len         = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_proto
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.2 LLC/SNAP header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  DSAP        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.dsap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  SSAP        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.ssap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  ctrl        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.ctrl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  OUI         = %02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.oui
(braket
l_int|0
)braket
comma
id|frame-&gt;p8022.oui
(braket
l_int|1
)braket
comma
id|frame-&gt;p8022.oui
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  ethertype  = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;ethertype
)paren
suffix:semicolon
)brace
macro_line|#endif /* 0 */
multiline_comment|/********************************************************************/
multiline_comment|/* Module initialization                                            */
multiline_comment|/********************************************************************/
DECL|variable|alloc_orinocodev
id|EXPORT_SYMBOL
c_func
(paren
id|alloc_orinocodev
)paren
suffix:semicolon
DECL|variable|__orinoco_up
id|EXPORT_SYMBOL
c_func
(paren
id|__orinoco_up
)paren
suffix:semicolon
DECL|variable|__orinoco_down
id|EXPORT_SYMBOL
c_func
(paren
id|__orinoco_down
)paren
suffix:semicolon
DECL|variable|orinoco_stop
id|EXPORT_SYMBOL
c_func
(paren
id|orinoco_stop
)paren
suffix:semicolon
DECL|variable|orinoco_reinit_firmware
id|EXPORT_SYMBOL
c_func
(paren
id|orinoco_reinit_firmware
)paren
suffix:semicolon
DECL|variable|orinoco_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|orinoco_interrupt
)paren
suffix:semicolon
multiline_comment|/* Can&squot;t be declared &quot;const&quot; or the whole __initdata section will&n; * become const */
DECL|variable|__initdata
r_static
r_char
id|version
(braket
)braket
id|__initdata
op_assign
id|DRIVER_NAME
l_string|&quot; &quot;
id|DRIVER_VERSION
l_string|&quot; (David Gibson &lt;hermes@gibson.dropbear.id.au&gt;, &quot;
l_string|&quot;Pavel Roskin &lt;proski@gnu.org&gt;, et al)&quot;
suffix:semicolon
DECL|function|init_orinoco
r_static
r_int
id|__init
id|init_orinoco
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|exit_orinoco
r_static
r_void
id|__exit
id|exit_orinoco
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|init_orinoco
id|module_init
c_func
(paren
id|init_orinoco
)paren
suffix:semicolon
DECL|variable|exit_orinoco
id|module_exit
c_func
(paren
id|exit_orinoco
)paren
suffix:semicolon
eof
