multiline_comment|/* orinoco.c 0.05&t;- (formerly known as dldwd_cs.c and orinoco_cs.c)&n; *&n; * A driver for &quot;Hermes&quot; chipset based PCMCIA wireless adaptors, such&n; * as the Lucent WavelanIEEE/Orinoco cards and their OEM (Cabletron/&n; * EnteraSys RoamAbout 802.11, ELSA Airlancer, Melco Buffalo and others).&n; * It should also be usable on various Prism II based cards such as the&n; * Linksys, D-Link and Farallon Skyline. It should also work on Symbol&n; * cards such as the 3Com AirConnect and Ericsson WLAN.&n; *&n; * Copyright (C) 2000 David Gibson, Linuxcare Australia &lt;hermes@gibson.dropbear.id.au&gt;&n; *&t;With some help from :&n; * Copyright (C) 2001 Jean Tourrilhes, HP Labs &lt;jt@hpl.hp.com&gt;&n; * Copyright (C) 2001 Benjamin Herrenschmidt &lt;benh@kernel.crashing.org&gt;&n; *&n; * Based on dummy_cs.c 1.27 2000/06/12 21:27:25&n; *&n; * Portions based on wvlan_cs.c 1.0.6, Copyright Andreas Neuhaus &lt;andy@fasta.fh-dortmund.de&gt;&n; *      http://www.fasta.fh-dortmund.de/users/andy/wvlan/&n; *&n; * The contents of this file are subject to the Mozilla Public License&n; * Version 1.1 (the &quot;License&quot;); you may not use this file except in&n; * compliance with the License. You may obtain a copy of the License&n; * at http://www.mozilla.org/MPL/&n; *&n; * Software distributed under the License is distributed on an &quot;AS IS&quot;&n; * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See&n; * the License for the specific language governing rights and&n; * limitations under the License.&n; *&n; * The initial developer of the original code is David A. Hinds&n; * &lt;dahinds@users.sourceforge.net&gt;.  Portions created by David&n; * A. Hinds are Copyright (C) 1999 David A. Hinds.  All Rights&n; * Reserved.&n; *&n; * Alternatively, the contents of this file may be used under the&n; * terms of the GNU Public License version 2 (the &quot;GPL&quot;), in which&n; * case the provisions of the GPL are applicable instead of the above.&n; * If you wish to allow the use of your version of this file only&n; * under the terms of the GPL and not to allow others to use your&n; * version of this file under the MPL, indicate your decision by&n; * deleting the provisions above and replace them with the notice and&n; * other provisions required by the GPL.  If you do not delete the&n; * provisions above, a recipient may use your version of this file&n; * under either the MPL or the GPL.&n; */
multiline_comment|/* Notes on locking:&n; *&n; * The basic principle of operation is that everything except the&n; * interrupt handler is serialized through a single spinlock in the&n; * dldwd_priv_t structure, using dldwd_lock() and&n; * dldwd_unlock() (which in turn use spin_lock_bh() and spin_unlock_bh()).&n; *&n; * The kernel&squot;s IRQ handling stuff ensures that the interrupt handler&n; * does not re-enter itself. The interrupt handler is written such&n; * that everything it does is safe without a lock: chiefly this means&n; * that the Rx path uses one of the Hermes chipset&squot;s BAPs while&n; * everything else uses the other.&n; *&n; * For the moment access to the device statistics from the interrupt&n; * handler is unsafe - we just put up with any resulting errors in the&n; * statisics. FIXME: This should probably be changed to store the&n; * stats in atomic types.&n; *&n; * EXCEPT that we don&squot;t want the irq handler running when we actually&n; * reset or shut down the card, because strange things might happen&n; * (probably the worst would be one packet of garbage, but you can&squot;t&n; * be too careful). For this we use __dldwd_stop_irqs() which will set&n; * a flag to disable the interrupt handler, and wait for any&n; * outstanding instances of the handler to complete. THIS WILL LOSE&n; * INTERRUPTS! so it shouldn&squot;t be used except for resets, when we&n; * don&squot;t care about that.*/
multiline_comment|/*&n; * Tentative changelog...&n; *&n; * v0.01 -&gt; v0.02 - 21/3/2001 - Jean II&n; *&t;o Allow to use regular ethX device name instead of dldwdX&n; *&t;o Warning on IBSS with ESSID=any for firmware 6.06&n; *&t;o Put proper range.throughput values (optimistic)&n; *&t;o IWSPY support (IOCTL and stat gather in Rx path)&n; *&t;o Allow setting frequency in Ad-Hoc mode&n; *&t;o Disable WEP setting if !has_wep to work on old firmware&n; *&t;o Fix txpower range&n; *&t;o Start adding support for Samsung/Compaq firmware&n; *&n; * v0.02 -&gt; v0.03 - 23/3/2001 - Jean II&n; *&t;o Start adding Symbol support - need to check all that&n; *&t;o Fix Prism2/Symbol WEP to accept 128 bits keys&n; *&t;o Add Symbol WEP (add authentication type)&n; *&t;o Add Prism2/Symbol rate&n; *&t;o Add PM timeout (holdover duration)&n; *&t;o Enable &quot;iwconfig eth0 key off&quot; and friends (toggle flags)&n; *&t;o Enable &quot;iwconfig eth0 power unicast/all&quot; (toggle flags)&n; *&t;o Try with an intel card. It report firmware 1.01, behave like&n; *&t;  an antiquated firmware, however on windows it says 2.00. Yuck !&n; *&t;o Workaround firmware bug in allocate buffer (Intel 1.01)&n; *&t;o Finish external renaming to orinoco...&n; *&t;o Testing with various Wavelan firmwares&n; *&n; * v0.03 -&gt; v0.04 - 30/3/2001 - Jean II&n; *&t;o Update to Wireless 11 -&gt; add retry limit/lifetime support&n; *&t;o Tested with a D-Link DWL 650 card, fill in firmware support&n; *&t;o Warning on Vcc mismatch (D-Link 3.3v card in Lucent 5v only slot)&n; *&t;o Fixed the Prims2 WEP bugs that I introduced in v0.03 :-(&n; *&t;  It work on D-Link *only* after a tcpdump. Weird...&n; *&t;  And still doesn&squot;t work on Intel card. Grrrr...&n; *&t;o Update the mode after a setport3&n; *&t;o Add preamble setting for Symbol cards (not yet enabled)&n; *&t;o Don&squot;t complain as much about Symbol cards...&n; *&n; * v0.04 -&gt; v0.04b - 22/4/2001 - David Gibson&n; *      o Removed the &squot;eth&squot; parameter - always use ethXX as the&n; *        interface name instead of dldwdXX.  The other was racy&n; *        anyway.&n; *&t;o Clean up RID definitions in hermes.h, other cleanups&n; *&n; * v0.04b -&gt; v0.04c - 24/4/2001 - Jean II&n; *&t;o Tim Hurley &lt;timster@seiki.bliztech.com&gt; reported a D-Link card&n; *&t;  with vendor 02 and firmware 0.08. Added in the capabilities...&n; *&t;o Tested Lucent firmware 7.28, everything works...&n; *&n; * v0.04c -&gt; v0.05 - 3/5/2001 - Benjamin Herrenschmidt&n; *&t;o Spin-off Pcmcia code. This file is renamed orinoco.c,&n; *&t;  and orinoco_cs.c now contains only the Pcmcia specific stuff&n; *&t;o Add Airport driver support on top of orinoco.c (see airport.c)&n; *&n; * v0.05 -&gt; v0.05a - 4/5/2001 - Jean II&n; *&t;o Revert to old Pcmcia code to fix breakage of Ben&squot;s changes...&n; *&n; * v0.05a -&gt; v0.05b - 4/5/2001 - Jean II&n; *&t;o add module parameter &squot;ignore_cis_vcc&squot; for D-Link @ 5V&n; *&t;o D-Link firmware doesn&squot;t support multicast. We just print a few&n; *&t;  error messages, but otherwise everything works...&n; *&t;o For David : set/getport3 works fine, just upgrade iwpriv...&n; *&n; * v0.05b -&gt; v0.05c - 5/5/2001 - Benjamin Herrenschmidt&n; *&t;o Adapt airport.c to latest changes in orinoco.c&n; *&t;o Remove deferred power enabling code&n; *&n; * v0.05c -&gt; v0.05d - 5/5/2001 - Jean II&n; *&t;o Workaround to SNAP decapsulate frame from LinkSys AP&n; *&t;  original patch from : Dong Liu &lt;dliu@research.bell-labs.com&gt;&n; *&t;  (note : the memcmp bug was mine - fixed)&n; *&t;o Remove set_retry stuff, no firmware support it (bloat--).&n; *&n; * TODO - Jean II&n; *&t;o inline functions (lot&squot;s of candidate, need to reorder code)&n; *&t;o Test PrismII/Symbol cards &amp; firmware versions&n; *&t;o Mini-PCI support&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/wireless.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;pcmcia/version.h&gt;
macro_line|#include &lt;pcmcia/cs_types.h&gt;
macro_line|#include &lt;pcmcia/cs.h&gt;
macro_line|#include &lt;pcmcia/cistpl.h&gt;
macro_line|#include &lt;pcmcia/cisreg.h&gt;
macro_line|#include &lt;pcmcia/ds.h&gt;
macro_line|#include &lt;pcmcia/bus_ops.h&gt;
macro_line|#include &quot;hermes.h&quot;
macro_line|#include &quot;orinoco.h&quot;
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;orinoco.c 0.05d (David Gibson &lt;hermes@gibson.dropbear.id.au&gt; and others)&quot;
suffix:semicolon
multiline_comment|/* Level of debugging. Used in the macros in orinoco.h */
macro_line|#ifdef ORINOCO_DEBUG
DECL|variable|dldwd_debug
r_int
id|dldwd_debug
op_assign
id|ORINOCO_DEBUG
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dldwd_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|channel_frequency
r_const
r_int
id|channel_frequency
(braket
)braket
op_assign
(brace
l_int|2412
comma
l_int|2417
comma
l_int|2422
comma
l_int|2427
comma
l_int|2432
comma
l_int|2437
comma
l_int|2442
comma
l_int|2447
comma
l_int|2452
comma
l_int|2457
comma
l_int|2462
comma
l_int|2467
comma
l_int|2472
comma
l_int|2484
)brace
suffix:semicolon
DECL|macro|NUM_CHANNELS
mdefine_line|#define NUM_CHANNELS ( sizeof(channel_frequency) / sizeof(channel_frequency[0]) )
multiline_comment|/* This tables gives the actual meanings of the bitrate IDs returned by the firmware.&n;   It gives the rate in halfMb/s, negative indicates auto mode */
DECL|variable|rate_list
r_const
r_int
id|rate_list
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|2
comma
l_int|4
comma
op_minus
l_int|22
comma
l_int|11
comma
l_int|22
comma
op_minus
l_int|4
comma
op_minus
l_int|11
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|macro|NUM_RATES
mdefine_line|#define NUM_RATES (sizeof(rate_list) / sizeof(rate_list[0]))
DECL|struct|p80211_hdr
r_struct
id|p80211_hdr
(brace
DECL|member|frame_ctl
r_uint16
id|frame_ctl
suffix:semicolon
DECL|member|duration_id
r_uint16
id|duration_id
suffix:semicolon
DECL|member|addr1
r_uint8
id|addr1
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|addr2
r_uint8
id|addr2
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|addr3
r_uint8
id|addr3
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|seq_ctl
r_uint16
id|seq_ctl
suffix:semicolon
DECL|member|addr4
r_uint8
id|addr4
(braket
id|ETH_ALEN
)braket
suffix:semicolon
DECL|member|data_len
r_uint16
id|data_len
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
multiline_comment|/* Frame control field constants */
DECL|macro|DLDWD_FCTL_VERS
mdefine_line|#define DLDWD_FCTL_VERS&t;&t;&t;0x0002
DECL|macro|DLDWD_FCTL_FTYPE
mdefine_line|#define DLDWD_FCTL_FTYPE&t;&t;0x000c
DECL|macro|DLDWD_FCTL_STYPE
mdefine_line|#define DLDWD_FCTL_STYPE&t;&t;0x00f0
DECL|macro|DLDWD_FCTL_TODS
mdefine_line|#define DLDWD_FCTL_TODS&t;&t;&t;0x0100
DECL|macro|DLDWD_FCTL_FROMDS
mdefine_line|#define DLDWD_FCTL_FROMDS&t;&t;0x0200
DECL|macro|DLDWD_FCTL_MOREFRAGS
mdefine_line|#define DLDWD_FCTL_MOREFRAGS&t;&t;0x0400
DECL|macro|DLDWD_FCTL_RETRY
mdefine_line|#define DLDWD_FCTL_RETRY&t;&t;0x0800
DECL|macro|DLDWD_FCTL_PM
mdefine_line|#define DLDWD_FCTL_PM&t;&t;&t;0x1000
DECL|macro|DLDWD_FCTL_MOREDATA
mdefine_line|#define DLDWD_FCTL_MOREDATA&t;&t;0x2000
DECL|macro|DLDWD_FCTL_WEP
mdefine_line|#define DLDWD_FCTL_WEP&t;&t;&t;0x4000
DECL|macro|DLDWD_FCTL_ORDER
mdefine_line|#define DLDWD_FCTL_ORDER&t;&t;0x8000
DECL|macro|DLDWD_FTYPE_MGMT
mdefine_line|#define DLDWD_FTYPE_MGMT&t;&t;0x0000
DECL|macro|DLDWD_FTYPE_CTL
mdefine_line|#define DLDWD_FTYPE_CTL&t;&t;&t;0x0004
DECL|macro|DLDWD_FTYPE_DATA
mdefine_line|#define DLDWD_FTYPE_DATA&t;&t;0x0008
DECL|struct|p8022_hdr
r_struct
id|p8022_hdr
(brace
DECL|member|dsap
r_uint8
id|dsap
suffix:semicolon
DECL|member|ssap
r_uint8
id|ssap
suffix:semicolon
DECL|member|ctrl
r_uint8
id|ctrl
suffix:semicolon
DECL|member|oui
r_uint8
id|oui
(braket
l_int|3
)braket
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|dldwd_frame_hdr
r_struct
id|dldwd_frame_hdr
(brace
DECL|member|desc
id|hermes_frame_desc_t
id|desc
suffix:semicolon
DECL|member|p80211
r_struct
id|p80211_hdr
id|p80211
suffix:semicolon
DECL|member|p8023
r_struct
id|ethhdr
id|p8023
suffix:semicolon
DECL|member|p8022
r_struct
id|p8022_hdr
id|p8022
suffix:semicolon
DECL|member|ethertype
r_uint16
id|ethertype
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|macro|P8023_OFFSET
mdefine_line|#define P8023_OFFSET&t;&t;(sizeof(hermes_frame_desc_t) + &bslash;&n;&t;&t;&t;&t;sizeof(struct p80211_hdr))
DECL|macro|ENCAPS_OVERHEAD
mdefine_line|#define ENCAPS_OVERHEAD&t;&t;(sizeof(struct p8022_hdr) + 2)
multiline_comment|/* 802.2 LLL header SNAP used for SNAP encapsulation over 802.11 */
DECL|variable|encaps_hdr
r_struct
id|p8022_hdr
id|encaps_hdr
op_assign
(brace
l_int|0xaa
comma
l_int|0xaa
comma
l_int|0x03
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0xf8
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Function prototypes&n; */
r_static
r_void
id|dldwd_stat_gather
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|dldwd_frame_hdr
op_star
id|hdr
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|dldwd_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|iw_statistics
op_star
id|dldwd_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* Hardware control routines */
r_static
r_int
id|__dldwd_hw_reset
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
suffix:semicolon
r_static
r_int
id|__dldwd_hw_setup_wep
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
suffix:semicolon
r_static
r_int
id|dldwd_hw_get_bssid
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_char
id|buf
(braket
id|ETH_ALEN
)braket
)paren
suffix:semicolon
r_static
r_int
id|dldwd_hw_get_essid
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_int
op_star
id|active
comma
r_char
id|buf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
)paren
suffix:semicolon
r_static
r_int
id|dldwd_hw_get_freq
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
suffix:semicolon
r_static
r_int
id|dldwd_hw_get_bitratelist
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_int
op_star
id|numrates
comma
r_int32
op_star
id|rates
comma
r_int
id|max
)paren
suffix:semicolon
multiline_comment|/* Interrupt handling routines */
r_static
r_void
id|__dldwd_ev_tick
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_wterr
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_infdrop
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_info
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_rx
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_txexc
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_tx
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_ev_alloc
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getiwrange
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|rrq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setfreq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_freq
op_star
id|frq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setrts
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_setport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
suffix:semicolon
r_static
r_int
id|dldwd_ioctl_getport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
suffix:semicolon
r_static
r_void
id|__dldwd_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* /proc debugging stuff */
r_static
r_int
id|dldwd_proc_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|dldwd_proc_cleanup
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * Inline functions&n; */
r_static
r_inline
r_void
DECL|function|dldwd_lock
id|dldwd_lock
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|dldwd_unlock
id|dldwd_unlock
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|dldwd_irqs_allowed
id|dldwd_irqs_allowed
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
r_return
id|test_bit
c_func
(paren
id|DLDWD_STATE_DOIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__dldwd_stop_irqs
id|__dldwd_stop_irqs
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|DLDWD_STATE_DOIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
r_while
c_loop
(paren
id|test_bit
c_func
(paren
id|DLDWD_STATE_INIRQ
comma
op_amp
id|priv-&gt;state
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__dldwd_start_irqs
id|__dldwd_start_irqs
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_uint16
id|irqmask
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
id|__cli
c_func
(paren
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|DLDWD_STATE_DOIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
id|irqmask
)paren
suffix:semicolon
id|__sti
c_func
(paren
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|set_port_type
id|set_port_type
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
r_switch
c_cond
(paren
id|priv-&gt;iw_mode
)paren
(brace
r_case
id|IW_MODE_INFRA
suffix:colon
id|priv-&gt;port_type
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;allow_ibss
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_MODE_ADHOC
suffix:colon
r_if
c_cond
(paren
id|priv-&gt;prefer_port3
)paren
(brace
id|priv-&gt;port_type
op_assign
l_int|3
suffix:semicolon
id|priv-&gt;allow_ibss
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|priv-&gt;port_type
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;allow_ibss
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Invalid priv-&gt;iw_mode in set_port_type()&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
)brace
r_extern
r_void
DECL|function|dldwd_set_multicast_list
id|dldwd_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|__dldwd_set_multicast_list
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Hardware control routines&n; */
r_static
r_int
DECL|function|__dldwd_hw_reset
id|__dldwd_hw_reset
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;broken_reset
)paren
r_return
id|hermes_reset
c_func
(paren
id|hw
)paren
suffix:semicolon
r_else
(brace
id|hw-&gt;inten
op_assign
l_int|0
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|INTEN
comma
l_int|0
)paren
suffix:semicolon
id|err
op_assign
id|hermes_disable_port
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|EVACK
comma
l_int|0xffff
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_void
DECL|function|dldwd_shutdown
id|dldwd_shutdown
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
multiline_comment|/* &t;hermes_t *hw = &amp;priv-&gt;hw; */
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|__dldwd_stop_irqs
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|__dldwd_hw_reset
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_and
id|err
op_ne
op_minus
id|ENODEV
)paren
multiline_comment|/* If the card is gone, we don&squot;t care about shutting it down */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d shutting down Hermes chipset&bslash;n&quot;
comma
id|priv-&gt;ndev.name
comma
id|err
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
r_int
DECL|function|dldwd_reset
id|dldwd_reset
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|hermes_id_t
id|idbuf
suffix:semicolon
r_int
id|frame_size
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|__dldwd_stop_irqs
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|__dldwd_hw_reset
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|frame_size
op_assign
id|TX_NICBUF_SIZE
suffix:semicolon
multiline_comment|/* This stupid bug is present in Intel firmware 1.10, and&n;&t; * may be fixed in later firmwares - Jean II */
r_if
c_cond
(paren
id|priv-&gt;broken_allocate
)paren
(brace
id|frame_size
op_assign
id|TX_NICBUF_SIZE_BUG
suffix:semicolon
)brace
id|err
op_assign
id|hermes_allocate
c_func
(paren
id|hw
comma
id|frame_size
comma
op_amp
id|priv-&gt;txfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Now set up all the parameters on the card */
multiline_comment|/* Set up the link mode */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PORTTYPE
comma
id|priv-&gt;port_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_ibss
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_CREATEIBSS
comma
id|priv-&gt;allow_ibss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|priv-&gt;allow_ibss
)paren
op_logical_and
(paren
op_logical_neg
id|priv-&gt;has_ibss_any
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: This firmware requires an &bslash;&n;ESSID in IBSS-Ad-Hoc mode.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* With wvlan_cs, in this case, we would crash.&n;&t;&t;&t; * hopefully, this driver will behave better...&n;&t;&t;&t; * Jean II */
)brace
)brace
multiline_comment|/* Set up encryption */
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
id|__dldwd_hw_setup_wep
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set the desired ESSID */
id|idbuf.len
op_assign
id|cpu_to_le16
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|idbuf.val
comma
id|priv-&gt;desired_essid
comma
r_sizeof
(paren
id|idbuf.val
)paren
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
(paren
id|priv-&gt;port_type
op_eq
l_int|3
)paren
ques
c_cond
id|HERMES_RID_CNF_OWN_SSID
suffix:colon
id|HERMES_RID_CNF_DESIRED_SSID
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
op_plus
l_int|2
)paren
comma
op_amp
id|idbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set the station name */
id|idbuf.len
op_assign
id|cpu_to_le16
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;nick
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|idbuf.val
comma
id|priv-&gt;nick
comma
r_sizeof
(paren
id|idbuf.val
)paren
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_NICKNAME
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|strlen
c_func
(paren
id|priv-&gt;nick
)paren
op_plus
l_int|2
)paren
comma
op_amp
id|idbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set the channel/frequency */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_CHANNEL
comma
id|priv-&gt;channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set AP density */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYSTEM_SCALE
comma
id|priv-&gt;ap_density
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set RTS threshold */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_RTS_THRESH
comma
id|priv-&gt;rts_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set fragmentation threshold or MWO robustness */
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MWO_ROBUST
comma
id|priv-&gt;mwo_robust
)paren
suffix:semicolon
r_else
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_FRAG_THRESH
comma
id|priv-&gt;frag_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set bitrate */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_TX_RATE_CTRL
comma
id|priv-&gt;tx_rate_ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Set power management */
r_if
c_cond
(paren
id|priv-&gt;has_pm
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_ENABLE
comma
id|priv-&gt;pm_on
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_MCAST_RX
comma
id|priv-&gt;pm_mcast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_PERIOD
comma
id|priv-&gt;pm_period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_HOLDOVER
comma
id|priv-&gt;pm_timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set preamble - only for Symbol so far... */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYMBOL_PREAMBLE
comma
id|priv-&gt;preamble
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t set preamble!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* Set promiscuity / multicast*/
id|priv-&gt;promiscuous
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;allmulti
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;mc_count
op_assign
l_int|0
suffix:semicolon
id|__dldwd_set_multicast_list
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
id|hermes_enable_port
c_func
(paren
id|hw
comma
id|DLDWD_MACPORT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|__dldwd_start_irqs
c_func
(paren
id|priv
comma
id|HERMES_EV_RX
op_or
id|HERMES_EV_ALLOC
op_or
id|HERMES_EV_TX
op_or
id|HERMES_EV_TXEXC
op_or
id|HERMES_EV_WTERR
op_or
id|HERMES_EV_INFO
op_or
id|HERMES_EV_INFDROP
)paren
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|__dldwd_hw_setup_wep
r_static
r_int
id|__dldwd_hw_setup_wep
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|extra_wep_flag
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_LUCENT
suffix:colon
multiline_comment|/* Lucent style WEP */
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_TX_KEY
comma
id|priv-&gt;tx_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|HERMES_WRITE_RECORD
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_KEYS
comma
op_amp
id|priv-&gt;keys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_WEP_ON
comma
id|priv-&gt;wep_on
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_PRISM2
suffix:colon
multiline_comment|/* Prism II style WEP */
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol style WEP */
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
r_char
id|keybuf
(braket
id|LARGE_KEY_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|keylen
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Write all 4 keys */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_KEYS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|keylen
op_assign
id|priv-&gt;keys
(braket
id|i
)braket
dot
id|len
suffix:semicolon
id|keybuf
(braket
id|keylen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|memcpy
c_func
(paren
id|keybuf
comma
id|priv-&gt;keys
(braket
id|i
)braket
dot
id|data
comma
id|keylen
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PRISM2_KEY0
op_plus
id|i
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|keylen
op_plus
l_int|1
)paren
comma
op_amp
id|keybuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PRISM2_TX_KEY
comma
id|priv-&gt;tx_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Authentication is where Prism2 and Symbol&n;&t;&t;&t; * firmware differ... */
r_if
c_cond
(paren
id|priv-&gt;firmware_type
op_eq
id|FIRMWARE_TYPE_SYMBOL
)paren
(brace
multiline_comment|/* Symbol cards : set the authentication :&n;&t;&t;&t;&t; * 0 -&gt; no encryption, 1 -&gt; open,&n;&t;&t;&t;&t; * 2 -&gt; shared key, 3 -&gt; shared key 128bit */
r_if
c_cond
(paren
id|priv-&gt;wep_restrict
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;keys
(braket
id|priv-&gt;tx_key
)braket
dot
id|len
OG
id|SMALL_KEY_SIZE
)paren
(brace
id|extra_wep_flag
op_assign
l_int|3
suffix:semicolon
)brace
r_else
id|extra_wep_flag
op_assign
l_int|2
suffix:semicolon
)brace
r_else
id|extra_wep_flag
op_assign
l_int|1
suffix:semicolon
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYMBOL_AUTH_TYPE
comma
id|priv-&gt;wep_restrict
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Prism2 card : we need to modify master&n;&t;&t;&t;&t; * WEP setting */
r_if
c_cond
(paren
id|priv-&gt;wep_restrict
)paren
(brace
id|extra_wep_flag
op_assign
l_int|2
suffix:semicolon
)brace
r_else
id|extra_wep_flag
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Master WEP setting : on/off */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PRISM2_WEP_ON
comma
(paren
id|priv-&gt;wep_on
op_or
id|extra_wep_flag
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|priv-&gt;wep_on
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: WEP enabled, although not supported!&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_hw_get_bssid
r_static
r_int
id|dldwd_hw_get_bssid
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_char
id|buf
(braket
id|ETH_ALEN
)braket
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENT_BSSID
comma
id|ETH_ALEN
comma
l_int|NULL
comma
id|buf
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_hw_get_essid
r_static
r_int
id|dldwd_hw_get_essid
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_int
op_star
id|active
comma
r_char
id|buf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|hermes_id_t
id|essidbuf
suffix:semicolon
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
op_amp
id|essidbuf.val
)paren
suffix:semicolon
r_int
id|len
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|priv-&gt;desired_essid
)paren
OG
l_int|0
)paren
(brace
multiline_comment|/* We read the desired SSID from the hardware rather&n;&t;&t;   than from priv-&gt;desired_essid, just in case the&n;&t;&t;   firmware is allowed to change it on us. I&squot;m not&n;&t;&t;   sure about this */
multiline_comment|/* My guess is that the OWN_SSID should always be whatever&n;&t;&t; * we set to the card, whereas CURRENT_SSID is the one that&n;&t;&t; * may change... - Jean II */
r_uint16
id|rid
suffix:semicolon
op_star
id|active
op_assign
l_int|1
suffix:semicolon
id|rid
op_assign
(paren
id|priv-&gt;port_type
op_eq
l_int|3
)paren
ques
c_cond
id|HERMES_RID_CNF_OWN_SSID
suffix:colon
id|HERMES_RID_CNF_DESIRED_SSID
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|rid
comma
r_sizeof
(paren
id|essidbuf
)paren
comma
l_int|NULL
comma
op_amp
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail_unlock
suffix:semicolon
)brace
r_else
(brace
op_star
id|active
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENT_SSID
comma
r_sizeof
(paren
id|essidbuf
)paren
comma
l_int|NULL
comma
op_amp
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|fail_unlock
suffix:semicolon
)brace
id|len
op_assign
id|le16_to_cpu
c_func
(paren
id|essidbuf.len
)paren
suffix:semicolon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|p
comma
id|len
)paren
suffix:semicolon
id|buf
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|fail_unlock
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|priv-&gt;ndev.name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_hw_get_freq
r_static
r_int
id|dldwd_hw_get_freq
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|channel
suffix:semicolon
r_int
id|freq
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENT_CHANNEL
comma
op_amp
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|channel
OL
l_int|1
)paren
op_logical_or
(paren
id|channel
OG
id|NUM_CHANNELS
)paren
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Channel out of range (%d)!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|channel
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|freq
op_assign
id|channel_frequency
(braket
id|channel
op_minus
l_int|1
)braket
op_star
l_int|100000
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_return
id|err
ques
c_cond
id|err
suffix:colon
id|freq
suffix:semicolon
)brace
DECL|function|dldwd_hw_get_bitratelist
r_static
r_int
id|dldwd_hw_get_bitratelist
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
r_int
op_star
id|numrates
comma
r_int32
op_star
id|rates
comma
r_int
id|max
)paren
(brace
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
id|hermes_id_t
id|list
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|list.val
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|num
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_DATARATES
comma
r_sizeof
(paren
id|list
)paren
comma
l_int|NULL
comma
op_amp
id|list
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|num
op_assign
id|le16_to_cpu
c_func
(paren
id|list.len
)paren
suffix:semicolon
op_star
id|numrates
op_assign
id|num
suffix:semicolon
id|num
op_assign
id|MIN
c_func
(paren
id|num
comma
id|max
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rates
(braket
id|i
)braket
op_assign
(paren
id|p
(braket
id|i
)braket
op_amp
l_int|0x7f
)paren
op_star
l_int|500000
suffix:semicolon
multiline_comment|/* convert to bps */
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef PCMCIA_DEBUG
DECL|function|show_rx_frame
r_static
r_inline
r_void
id|show_rx_frame
c_func
(paren
r_struct
id|dldwd_frame_hdr
op_star
id|frame
)paren
(brace
)brace
macro_line|#else
DECL|function|show_rx_frame
r_static
r_void
id|show_rx_frame
c_func
(paren
r_struct
id|dldwd_frame_hdr
op_star
id|frame
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;RX descriptor:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  status      = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.status
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  res1        = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.res1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  res2        = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.res2
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  q_info      = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.q_info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  res3        = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.res3
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  res4        = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.res4
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  tx_ctl      = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;desc.tx_ctl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.11 header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  frame_ctl   = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.frame_ctl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  duration_id = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.duration_id
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr1       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr1
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr1
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr2       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr2
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr2
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr3       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr3
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr3
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  seq_ctl     = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.seq_ctl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  addr4       = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p80211.addr4
(braket
l_int|0
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|1
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|2
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|3
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|4
)braket
comma
id|frame-&gt;p80211.addr4
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  data_len    = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p80211.data_len
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.3 header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  dest        = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|0
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|1
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|2
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|3
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|4
)braket
comma
id|frame-&gt;p8023.h_dest
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  src         = %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_source
(braket
l_int|0
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|1
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|2
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|3
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|4
)braket
comma
id|frame-&gt;p8023.h_source
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  len         = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;p8023.h_proto
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;IEEE 802.2 LLC/SNAP header:&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  DSAP        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.dsap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  SSAP        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.ssap
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  ctrl        = 0x%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.ctrl
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  OUI         = %02x:%02x:%02x&bslash;n&quot;
comma
id|frame-&gt;p8022.oui
(braket
l_int|0
)braket
comma
id|frame-&gt;p8022.oui
(braket
l_int|1
)braket
comma
id|frame-&gt;p8022.oui
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  ethertype  = 0x%04x&bslash;n&quot;
comma
id|frame-&gt;ethertype
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Interrupt handler&n; */
DECL|function|dldwd_interrupt
r_void
id|dldwd_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev_id
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
r_int
id|count
op_assign
id|IRQ_LOOP_MAX
suffix:semicolon
r_uint16
id|evstat
comma
id|events
suffix:semicolon
r_static
r_int
id|old_time
op_assign
l_int|0
comma
id|timecount
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Eugh, revolting hack for now */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|DLDWD_STATE_INIRQ
comma
op_amp
id|priv-&gt;state
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dldwd_irqs_allowed
c_func
(paren
id|priv
)paren
)paren
(brace
id|clear_bit
c_func
(paren
id|DLDWD_STATE_INIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: dldwd_interrupt()&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|jiffies
op_ne
id|old_time
)paren
id|timecount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|timecount
OG
l_int|50
)paren
op_logical_or
(paren
op_logical_neg
id|count
op_decrement
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;%s: IRQ handler is looping too &bslash;&n;much! Shutting down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Perform an emergency shutdown */
id|clear_bit
c_func
(paren
id|DLDWD_STATE_DOIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
id|hermes_set_irqmask
c_func
(paren
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|evstat
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|EVSTAT
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;__dldwd_interrupt(): count=%d EVSTAT=0x%04x inten=0x%04x&bslash;n&quot;
comma
id|count
comma
id|evstat
comma
id|hw-&gt;inten
)paren
suffix:semicolon
id|events
op_assign
id|evstat
op_amp
id|hw-&gt;inten
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|events
)paren
(brace
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* There seems to be a firmware bug which&n;&t;&t;&t;&t;   sometimes causes the card to give an&n;&t;&t;&t;&t;   interrupt with no event set, when there&n;&t;&t;&t;&t;   sould be a Tx completed event. */
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Interrupt with no event (ALLOCFID=0x%04x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|ALLOCFID
)paren
)paren
suffix:semicolon
id|events
op_assign
id|HERMES_EV_TX
op_or
id|HERMES_EV_ALLOC
suffix:semicolon
)brace
r_else
multiline_comment|/* Nothing&squot;s happening, we&squot;re done */
r_break
suffix:semicolon
)brace
multiline_comment|/* Check the card hasn&squot;t been removed */
r_if
c_cond
(paren
op_logical_neg
id|hermes_present
c_func
(paren
id|hw
)paren
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;dldwd_interrupt(): card removed&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TICK
)paren
id|__dldwd_ev_tick
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_WTERR
)paren
id|__dldwd_ev_wterr
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_INFDROP
)paren
id|__dldwd_ev_infdrop
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_INFO
)paren
id|__dldwd_ev_info
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_RX
)paren
id|__dldwd_ev_rx
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TXEXC
)paren
id|__dldwd_ev_txexc
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_TX
)paren
id|__dldwd_ev_tx
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
id|HERMES_EV_ALLOC
)paren
id|__dldwd_ev_alloc
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
id|hermes_write_regn
c_func
(paren
id|hw
comma
id|EVACK
comma
id|events
)paren
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|DLDWD_STATE_INIRQ
comma
op_amp
id|priv-&gt;state
)paren
suffix:semicolon
)brace
DECL|function|__dldwd_ev_tick
r_static
r_void
id|__dldwd_ev_tick
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: TICK&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
DECL|function|__dldwd_ev_wterr
r_static
r_void
id|__dldwd_ev_wterr
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
multiline_comment|/* This seems to happen a fair bit under load, but ignoring it&n;&t;   seems to work fine...*/
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: MAC controller error (WTERR). Ignoring.&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
DECL|function|__dldwd_ev_infdrop
r_static
r_void
id|__dldwd_ev_infdrop
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Information frame lost.&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
)brace
DECL|function|__dldwd_ev_info
r_static
r_void
id|__dldwd_ev_info
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Information frame received.&bslash;n&quot;
comma
id|priv-&gt;ndev.name
)paren
suffix:semicolon
multiline_comment|/* We don&squot;t actually do anything about it - we assume the MAC&n;&t;   controller can deal with it */
)brace
DECL|function|__dldwd_ev_rx
r_static
r_void
id|__dldwd_ev_rx
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|priv-&gt;wstats
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_uint16
id|rxfid
comma
id|status
suffix:semicolon
r_int
id|length
comma
id|data_len
comma
id|data_off
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|dldwd_frame_hdr
id|hdr
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eh
suffix:semicolon
r_int
id|err
suffix:semicolon
id|rxfid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|RXFID
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;__dldwd_ev_rx(): RXFID=0x%04x&bslash;n&quot;
comma
id|rxfid
)paren
suffix:semicolon
multiline_comment|/* We read in the entire frame header here. This isn&squot;t really&n;&t;   necessary, since we ignore most of it, but it&squot;s&n;&t;   conceptually simpler. We can tune this later if&n;&t;   necessary. */
id|err
op_assign
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
op_amp
id|hdr
comma
r_sizeof
(paren
id|hdr
)paren
comma
id|rxfid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error %d reading frame header. &quot;
l_string|&quot;Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|status
op_assign
id|le16_to_cpu
c_func
(paren
id|hdr.desc.status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|HERMES_RXSTAT_ERR
)paren
(brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_ERR
)paren
op_eq
id|HERMES_RXSTAT_BADCRC
)paren
(brace
id|stats-&gt;rx_crc_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Bad CRC on Rx. Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|show_rx_frame
c_func
(paren
op_amp
id|hdr
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_ERR
)paren
op_eq
id|HERMES_RXSTAT_UNDECRYPTABLE
)paren
(brace
id|wstats-&gt;discard.code
op_increment
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Undecryptable frame on Rx. Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|wstats-&gt;discard.misc
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Unknown Rx error (0x%x). Frame dropped.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
id|HERMES_RXSTAT_ERR
)paren
suffix:semicolon
)brace
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|length
op_assign
id|le16_to_cpu
c_func
(paren
id|hdr.p80211.data_len
)paren
suffix:semicolon
multiline_comment|/* Yes, you heard right, that&squot;s le16. 802.2 and 802.3 are&n;&t;   big-endian, but 802.11 is little-endian believe it or&n;&t;   not. */
multiline_comment|/* Correct. 802.3 is big-endian byte order and little endian bit&n;&t; * order, whereas 802.11 is little endian for both byte and bit&n;&t; * order. That&squot;s specified in the 802.11 spec. - Jean II */
multiline_comment|/* Sanity check */
r_if
c_cond
(paren
id|length
OG
id|MAX_FRAME_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized frame received (%d bytes)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|length
)paren
suffix:semicolon
id|stats-&gt;rx_length_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* We need space for the packet data itself, plus an ethernet&n;&t;   header, plus 2 bytes so we can align the IP header on a&n;&t;   32bit boundary, plus 1 byte so we can read in odd length&n;&t;   packets from the card, which has an IO granularity of 16&n;&t;   bits */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|length
op_plus
id|ETH_HLEN
op_plus
l_int|2
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Can&squot;t allocate skb for Rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;rx_dropped
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* This way the IP header is aligned */
multiline_comment|/* Handle decapsulation&n;&t; * In most cases, the firmware tell us about SNAP frames.&n;&t; * For some reason, the SNAP frames sent by LinkSys APs&n;&t; * are not properly recognised by most firmwares.&n;&t; * So, check ourselves (note : only 3 bytes out of 6).&n;&t; */
r_if
c_cond
(paren
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_MSGTYPE
)paren
op_eq
id|HERMES_RXSTAT_1042
)paren
op_logical_or
(paren
(paren
id|status
op_amp
id|HERMES_RXSTAT_MSGTYPE
)paren
op_eq
id|HERMES_RXSTAT_TUNNEL
)paren
op_logical_or
(paren
op_logical_neg
id|memcmp
c_func
(paren
op_amp
id|hdr.p8022
comma
op_amp
id|encaps_hdr
comma
l_int|3
)paren
)paren
)paren
(brace
multiline_comment|/* These indicate a SNAP within 802.2 LLC within&n;&t;&t;   802.11 frame which we&squot;ll need to de-encapsulate to&n;&t;&t;   the original EthernetII frame.&n;&t;&t;   IEEE and ISO OSI have a lot to answer for.  */
multiline_comment|/* Remove SNAP header, reconstruct EthernetII frame */
id|data_len
op_assign
id|length
op_minus
id|ENCAPS_OVERHEAD
suffix:semicolon
id|data_off
op_assign
r_sizeof
(paren
id|hdr
)paren
suffix:semicolon
id|eh
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eh
comma
op_amp
id|hdr.p8023
comma
r_sizeof
(paren
id|hdr.p8023
)paren
)paren
suffix:semicolon
id|eh-&gt;h_proto
op_assign
id|hdr.ethertype
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* All other cases indicate a genuine 802.3 frame.&n;&t;&t; * No decapsulation needed */
multiline_comment|/* Otherwise, we just throw the whole thing in,&n;&t;&t; * and hope the protocol layer can deal with it&n;&t;&t; * as 802.3 */
id|data_len
op_assign
id|length
suffix:semicolon
id|data_off
op_assign
id|P8023_OFFSET
suffix:semicolon
)brace
id|p
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|data_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hermes_bap_pread
c_func
(paren
id|hw
comma
id|IRQ_BAP
comma
id|p
comma
id|RUP_EVEN
c_func
(paren
id|data_len
)paren
comma
id|rxfid
comma
id|data_off
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error reading packet data&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
multiline_comment|/* Process the wireless stats if needed */
id|dldwd_stat_gather
c_func
(paren
id|dev
comma
id|skb
comma
op_amp
id|hdr
)paren
suffix:semicolon
multiline_comment|/* Pass the packet to the networking stack */
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|stats-&gt;rx_packets
op_increment
suffix:semicolon
id|stats-&gt;rx_bytes
op_add_assign
id|length
suffix:semicolon
r_return
suffix:semicolon
id|drop
suffix:colon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|__dldwd_ev_txexc
r_static
r_void
id|__dldwd_ev_txexc
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tx error!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
)brace
DECL|function|__dldwd_ev_tx
r_static
r_void
id|__dldwd_ev_tx
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Transmit completed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|__dldwd_ev_alloc
r_static
r_void
id|__dldwd_ev_alloc
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
comma
id|hermes_t
op_star
id|hw
)paren
(brace
r_uint16
id|allocfid
suffix:semicolon
id|allocfid
op_assign
id|hermes_read_regn
c_func
(paren
id|hw
comma
id|ALLOCFID
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Allocation complete FID=0x%04x&bslash;n&quot;
comma
id|priv-&gt;ndev.name
comma
id|allocfid
)paren
suffix:semicolon
multiline_comment|/* For some reason we don&squot;t seem to get transmit completed events properly */
r_if
c_cond
(paren
id|allocfid
op_eq
id|priv-&gt;txfid
)paren
id|__dldwd_ev_tx
c_func
(paren
id|priv
comma
id|hw
)paren
suffix:semicolon
multiline_comment|/* &t;hermes_write_regn(hw, ALLOCFID, 0); */
)brace
multiline_comment|/*&n; * struct net_device methods&n; */
r_int
DECL|function|dldwd_init
id|dldwd_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|hermes_id_t
id|nickbuf
suffix:semicolon
r_uint16
id|reclen
suffix:semicolon
r_int
id|len
suffix:semicolon
r_char
op_star
id|vendor_str
suffix:semicolon
r_uint32
id|firmver
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_reset
c_func
(paren
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to reset hardware&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get the firmware version */
id|err
op_assign
id|hermes_read_staidentity
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|priv-&gt;firmware_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Error %d reading firmware info. Wildly guessing capabilities...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|priv-&gt;firmware_info
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;firmware_info
)paren
)paren
suffix:semicolon
)brace
id|firmver
op_assign
(paren
(paren
r_uint32
)paren
id|priv-&gt;firmware_info.major
op_lshift
l_int|16
)paren
op_or
id|priv-&gt;firmware_info.minor
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: firmver = 0x%X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|firmver
)paren
suffix:semicolon
multiline_comment|/* Determine capabilities from the firmware version */
r_switch
c_cond
(paren
id|priv-&gt;firmware_info.vendor
)paren
(brace
r_case
l_int|0x1
suffix:colon
multiline_comment|/* Lucent Wavelan IEEE, Lucent Orinoco, Cabletron RoamAbout,&n;&t;&t; * ELSA, Melco, HP, IBM, Dell 1150 cards */
id|vendor_str
op_assign
l_string|&quot;Lucent&quot;
suffix:semicolon
multiline_comment|/* Lucent MAC : 00:60:1D:* &amp; 00:02:2D:* */
id|priv-&gt;firmware_type
op_assign
id|FIRMWARE_TYPE_LUCENT
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Still works in 7.28 */
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x60006
)paren
suffix:semicolon
id|priv-&gt;has_ibss_any
op_assign
(paren
id|firmver
op_ge
l_int|0x60010
)paren
suffix:semicolon
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x40020
)paren
suffix:semicolon
id|priv-&gt;has_big_wep
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME: this is wrong - how do we tell&n;&t;&t;&t;&t;&t;  Gold cards from the others? */
id|priv-&gt;has_mwo
op_assign
(paren
id|firmver
op_ge
l_int|0x60000
)paren
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x40020
)paren
suffix:semicolon
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Tested with Lucent firmware :&n;&t;&t; *&t;1.16 ; 4.08 ; 4.52 ; 6.04 ; 6.16 ; 7.28 =&gt; Jean II&n;&t;&t; * Tested CableTron firmware : 4.32 =&gt; Anton */
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|vendor_str
op_assign
l_string|&quot;Generic Prism II&quot;
suffix:semicolon
multiline_comment|/* Some D-Link cards report vendor 0x02... */
id|priv-&gt;firmware_type
op_assign
id|FIRMWARE_TYPE_PRISM2
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_big_wep
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Tim Hurley -&gt; D-Link card, vendor 02, firmware 0.08 */
multiline_comment|/* Special case for Symbol cards */
r_if
c_cond
(paren
id|firmver
op_eq
l_int|0x10001
)paren
(brace
multiline_comment|/* Symbol , 3Com AirConnect, Intel, Ericsson WLAN */
id|vendor_str
op_assign
l_string|&quot;Symbol&quot;
suffix:semicolon
multiline_comment|/* Intel MAC : 00:02:B3:* */
multiline_comment|/* 3Com MAC : 00:50:DA:* */
multiline_comment|/* FIXME : probably need to use SYMBOL_***ARY_VER&n;&t;&t;&t; * to get proper firmware version */
id|priv-&gt;firmware_type
op_assign
id|FIRMWARE_TYPE_SYMBOL
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_wep
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_big_wep
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* RID_SYMBOL_KEY_LENGTH */
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_pm
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME */
multiline_comment|/* Tested with Intel firmware : v15 =&gt; Jean II */
)brace
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|vendor_str
op_assign
l_string|&quot;Samsung&quot;
suffix:semicolon
multiline_comment|/* To check - Should cover Samsung &amp; Compaq */
id|priv-&gt;firmware_type
op_assign
id|FIRMWARE_TYPE_PRISM2
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: available in later firmwares */
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_big_wep
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x20000
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x6
suffix:colon
multiline_comment|/* D-Link DWL 650, ... */
id|vendor_str
op_assign
l_string|&quot;LinkSys/D-Link&quot;
suffix:semicolon
multiline_comment|/* D-Link MAC : 00:40:05:* */
id|priv-&gt;firmware_type
op_assign
id|FIRMWARE_TYPE_PRISM2
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_wep
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_big_wep
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_pm
op_assign
(paren
id|firmver
op_ge
l_int|0x00007
)paren
suffix:semicolon
multiline_comment|/* FIXME */
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Tested with D-Link firmware 0.07 =&gt; Jean II */
multiline_comment|/* Note : with 0.07, IBSS to a Lucent card seem flaky */
r_break
suffix:semicolon
r_default
suffix:colon
id|vendor_str
op_assign
l_string|&quot;UNKNOWN&quot;
suffix:semicolon
id|priv-&gt;firmware_type
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_reset
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;broken_allocate
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_port3
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_ibss
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_wep
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_big_wep
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_mwo
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_pm
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;has_preamble
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Firmware ID %02X vendor 0x%x (%s) version %d.%02d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;firmware_info.id
comma
id|priv-&gt;firmware_info.vendor
comma
id|vendor_str
comma
id|priv-&gt;firmware_info.major
comma
id|priv-&gt;firmware_info.minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_port3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Ad-hoc demo mode supported.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_ibss
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: IEEE standard IBSS ad-hoc mode supported.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: WEP supported, &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_big_wep
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;&quot;128&bslash;&quot;-bit key.&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;40-bit key.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Get the MAC address */
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MACADDR
comma
id|ETH_ALEN
comma
l_int|NULL
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: failed to read MAC address!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MAC address %02X:%02X:%02X:%02X:%02X:%02X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
multiline_comment|/* Get the station name */
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_NICKNAME
comma
r_sizeof
(paren
id|nickbuf
)paren
comma
op_amp
id|reclen
comma
op_amp
id|nickbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read station name!n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nickbuf.len
)paren
id|len
op_assign
id|MIN
c_func
(paren
id|IW_ESSID_MAX_SIZE
comma
id|le16_to_cpu
c_func
(paren
id|nickbuf.len
)paren
)paren
suffix:semicolon
r_else
id|len
op_assign
id|MIN
c_func
(paren
id|IW_ESSID_MAX_SIZE
comma
l_int|2
op_star
id|reclen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;nick
comma
op_amp
id|nickbuf.val
comma
id|len
)paren
suffix:semicolon
id|priv-&gt;nick
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Station name &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|priv-&gt;nick
)paren
suffix:semicolon
multiline_comment|/* Get allowed channels */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CHANNEL_LIST
comma
op_amp
id|priv-&gt;channel_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read channel list!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get initial AP density */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYSTEM_SCALE
comma
op_amp
id|priv-&gt;ap_density
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read AP density!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get initial RTS threshold */
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_RTS_THRESH
comma
op_amp
id|priv-&gt;rts_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read RTS threshold!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Get initial fragmentation settings */
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MWO_ROBUST
comma
op_amp
id|priv-&gt;mwo_robust
)paren
suffix:semicolon
r_else
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_FRAG_THRESH
comma
op_amp
id|priv-&gt;frag_thresh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read fragmentation settings!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set initial bitrate control*/
id|priv-&gt;tx_rate_ctrl
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Power management setup */
r_if
c_cond
(paren
id|priv-&gt;has_pm
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;pm_mcast
op_assign
l_int|1
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_PERIOD
comma
op_amp
id|priv-&gt;pm_period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read power management period!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_HOLDOVER
comma
op_amp
id|priv-&gt;pm_timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: failed to read power management timeout!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* Preamble setup */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYMBOL_PREAMBLE
comma
op_amp
id|priv-&gt;preamble
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Set up the default configuration */
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
multiline_comment|/* By default use IEEE/IBSS ad-hoc mode if we have it */
id|priv-&gt;prefer_port3
op_assign
id|priv-&gt;has_port3
op_logical_and
(paren
op_logical_neg
id|priv-&gt;has_ibss
)paren
suffix:semicolon
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;promiscuous
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;allmulti
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;wep_on
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;tx_key
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: ready&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_struct
id|net_device_stats
op_star
DECL|function|dldwd_get_stats
id|dldwd_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|priv-&gt;stats
suffix:semicolon
)brace
r_struct
id|iw_statistics
op_star
DECL|function|dldwd_get_wireless_stats
id|dldwd_get_wireless_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_struct
id|iw_statistics
op_star
id|wstats
op_assign
op_amp
id|priv-&gt;wstats
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|hermes_commsqual_t
id|cq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;hw_ready
)paren
r_return
l_int|NULL
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;port_type
op_eq
l_int|3
)paren
(brace
id|memset
c_func
(paren
op_amp
id|wstats-&gt;qual
comma
l_int|0
comma
r_sizeof
(paren
id|wstats-&gt;qual
)paren
)paren
suffix:semicolon
macro_line|#ifdef WIRELESS_SPY
multiline_comment|/* If a spy address is defined, we report stats of the&n;&t;&t; * first spy address - Jean II */
r_if
c_cond
(paren
id|priv-&gt;spy_number
OG
l_int|0
)paren
(brace
id|wstats-&gt;qual.qual
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|qual
suffix:semicolon
id|wstats-&gt;qual.level
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|level
suffix:semicolon
id|wstats-&gt;qual.noise
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|noise
suffix:semicolon
id|wstats-&gt;qual.updated
op_assign
id|priv-&gt;spy_stat
(braket
l_int|0
)braket
dot
id|updated
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_SPY */
)brace
r_else
(brace
id|err
op_assign
id|hermes_read_commsqual
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|cq
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Global stats = %X-%X-%X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cq.qual
comma
id|cq.signal
comma
id|cq.noise
)paren
suffix:semicolon
multiline_comment|/* Why are we using MIN/MAX ? We don&squot;t really care&n;&t;&t; * if the value goes above max, because we export the&n;&t;&t; * raw dBm values anyway. The normalisation should be done&n;&t;&t; * in user space - Jean II */
id|wstats-&gt;qual.qual
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq.qual
comma
l_int|0x8b
op_minus
l_int|0x2f
)paren
comma
l_int|0
)paren
suffix:semicolon
id|wstats-&gt;qual.level
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq.signal
comma
l_int|0x8a
)paren
comma
l_int|0x2f
)paren
op_minus
l_int|0x95
suffix:semicolon
id|wstats-&gt;qual.noise
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq.noise
comma
l_int|0x8a
)paren
comma
l_int|0x2f
)paren
op_minus
l_int|0x95
suffix:semicolon
id|wstats-&gt;qual.updated
op_assign
l_int|7
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|wstats
suffix:semicolon
)brace
macro_line|#ifdef WIRELESS_SPY
DECL|function|dldwd_spy_gather
r_static
r_inline
r_void
id|dldwd_spy_gather
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u_char
op_star
id|mac
comma
id|hermes_commsqual_t
op_star
id|cq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Gather wireless spy statistics: for each packet, compare the&n;&t; * source address with out list, and if match, get the stats... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|priv-&gt;spy_number
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|mac
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|ETH_ALEN
)paren
)paren
(brace
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|qual
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq-&gt;qual
comma
l_int|0x8b
op_minus
l_int|0x2f
)paren
comma
l_int|0
)paren
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|level
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq-&gt;signal
comma
l_int|0x8a
)paren
comma
l_int|0x2f
)paren
op_minus
l_int|0x95
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|noise
op_assign
id|MAX
c_func
(paren
id|MIN
c_func
(paren
id|cq-&gt;noise
comma
l_int|0x8a
)paren
comma
l_int|0x2f
)paren
op_minus
l_int|0x95
suffix:semicolon
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|7
suffix:semicolon
)brace
)brace
macro_line|#endif /* WIRELESS_SPY */
r_void
DECL|function|dldwd_stat_gather
id|dldwd_stat_gather
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|dldwd_frame_hdr
op_star
id|hdr
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|hermes_commsqual_t
id|cq
suffix:semicolon
multiline_comment|/* Using spy support with lots of Rx packets, like in an&n;&t; * infrastructure (AP), will really slow down everything, because&n;&t; * the MAC address must be compared to each entry of the spy list.&n;&t; * If the user really asks for it (set some address in the&n;&t; * spy list), we do it, but he will pay the price.&n;&t; * Note that to get here, you need both WIRELESS_SPY&n;&t; * compiled in AND some addresses in the list !!!&n;&t; */
macro_line|#ifdef WIRELESS_EXT
multiline_comment|/* Note : gcc will optimise the whole section away if&n;&t; * WIRELESS_SPY is not defined... - Jean II */
r_if
c_cond
(paren
macro_line|#ifdef WIRELESS_SPY
(paren
id|priv-&gt;spy_number
OG
l_int|0
)paren
op_logical_or
macro_line|#endif
l_int|0
)paren
(brace
id|u_char
op_star
id|stats
op_assign
(paren
id|u_char
op_star
)paren
op_amp
(paren
id|hdr-&gt;desc.q_info
)paren
suffix:semicolon
multiline_comment|/* This code may look strange. Everywhere we are using 16 bit&n;&t;&t; * ints except here. I&squot;ve verified that these are are the&n;&t;&t; * correct values. Please check on PPC - Jean II */
id|cq.signal
op_assign
id|stats
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* High order byte */
id|cq.noise
op_assign
id|stats
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Low order byte */
id|cq.qual
op_assign
id|stats
(braket
l_int|0
)braket
op_minus
id|stats
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Better than nothing */
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;%s: Packet stats = %X-%X-%X&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cq.qual
comma
id|cq.signal
comma
id|cq.noise
)paren
suffix:semicolon
macro_line|#ifdef WIRELESS_SPY
id|dldwd_spy_gather
c_func
(paren
id|dev
comma
id|skb-&gt;mac.raw
op_plus
id|ETH_ALEN
comma
op_amp
id|cq
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif /* WIRELESS_EXT */
)brace
r_int
DECL|function|dldwd_xmit
id|dldwd_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|txfid
op_assign
id|priv-&gt;txfid
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eh
suffix:semicolon
r_int
id|len
comma
id|data_len
comma
id|data_off
suffix:semicolon
r_struct
id|dldwd_frame_hdr
id|hdr
suffix:semicolon
id|hermes_response_t
id|resp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Tx on stopped device!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Tx while transmitter busy!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
multiline_comment|/* Length of the packet body */
id|len
op_assign
id|MAX
c_func
(paren
id|skb-&gt;len
op_minus
id|ETH_HLEN
comma
id|ETH_ZLEN
)paren
suffix:semicolon
id|eh
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build the IEEE 802.11 header */
id|memset
c_func
(paren
op_amp
id|hdr
comma
l_int|0
comma
r_sizeof
(paren
id|hdr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr.p80211.addr1
comma
id|eh-&gt;h_dest
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr.p80211.addr2
comma
id|eh-&gt;h_source
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|hdr.p80211.frame_ctl
op_assign
id|DLDWD_FTYPE_DATA
suffix:semicolon
multiline_comment|/* Encapsulate Ethernet-II frames */
r_if
c_cond
(paren
id|ntohs
c_func
(paren
id|eh-&gt;h_proto
)paren
OG
l_int|1500
)paren
(brace
multiline_comment|/* Ethernet-II frame */
id|data_len
op_assign
id|len
suffix:semicolon
id|data_off
op_assign
r_sizeof
(paren
id|hdr
)paren
suffix:semicolon
id|p
op_assign
id|skb-&gt;data
op_plus
id|ETH_HLEN
suffix:semicolon
multiline_comment|/* 802.11 header */
id|hdr.p80211.data_len
op_assign
id|cpu_to_le16
c_func
(paren
id|data_len
op_plus
id|ENCAPS_OVERHEAD
)paren
suffix:semicolon
multiline_comment|/* 802.3 header */
id|memcpy
c_func
(paren
id|hdr.p8023.h_dest
comma
id|eh-&gt;h_dest
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr.p8023.h_source
comma
id|eh-&gt;h_source
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|hdr.p8023.h_proto
op_assign
id|htons
c_func
(paren
id|data_len
op_plus
id|ENCAPS_OVERHEAD
)paren
suffix:semicolon
multiline_comment|/* 802.2 header */
id|memcpy
c_func
(paren
op_amp
id|hdr.p8022
comma
op_amp
id|encaps_hdr
comma
r_sizeof
(paren
id|encaps_hdr
)paren
)paren
suffix:semicolon
id|hdr.ethertype
op_assign
id|eh-&gt;h_proto
suffix:semicolon
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|hdr
comma
r_sizeof
(paren
id|hdr
)paren
comma
id|txfid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing packet header to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* IEEE 802.3 frame */
id|data_len
op_assign
id|len
op_plus
id|ETH_HLEN
suffix:semicolon
id|data_off
op_assign
id|P8023_OFFSET
suffix:semicolon
id|p
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* 802.11 header */
id|hdr.p80211.data_len
op_assign
id|cpu_to_le16
c_func
(paren
id|len
)paren
suffix:semicolon
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
op_amp
id|hdr
comma
id|P8023_OFFSET
comma
id|txfid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing packet header to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
)brace
multiline_comment|/* Round up for odd length packets */
id|err
op_assign
id|hermes_bap_pwrite
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|p
comma
id|RUP_EVEN
c_func
(paren
id|data_len
)paren
comma
id|txfid
comma
id|data_off
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d writing packet data to BAP&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* Finally, we actually initiate the send */
id|err
op_assign
id|hermes_docmd_wait
c_func
(paren
id|hw
comma
id|HERMES_CMD_TX
op_or
id|HERMES_CMD_RECL
comma
id|txfid
comma
op_amp
id|resp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d transmitting packet&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|stats-&gt;tx_bytes
op_add_assign
id|data_off
op_plus
id|data_len
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_void
DECL|function|dldwd_tx_timeout
id|dldwd_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|priv-&gt;stats
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tx timeout! Resetting card.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|err
op_assign
id|dldwd_reset
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d resetting card on Tx timeout!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_else
(brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|dldwd_ioctl_getiwrange
r_static
r_int
id|dldwd_ioctl_getiwrange
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|rrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|ptype
suffix:semicolon
r_struct
id|iw_range
id|range
suffix:semicolon
r_int
id|numrates
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|rrq-&gt;pointer
comma
r_sizeof
(paren
id|range
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|rrq-&gt;length
op_assign
r_sizeof
(paren
id|range
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|ptype
op_assign
id|priv-&gt;port_type
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|range
comma
l_int|0
comma
r_sizeof
(paren
id|range
)paren
)paren
suffix:semicolon
multiline_comment|/* Much of this shamelessly taken from wvlan_cs.c. No idea&n;&t; * what it all means -dgibson */
macro_line|#if WIRELESS_EXT &gt; 10
id|range.we_version_compiled
op_assign
id|WIRELESS_EXT
suffix:semicolon
id|range.we_version_source
op_assign
l_int|11
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
id|range.min_nwid
op_assign
id|range.max_nwid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We don&squot;t use nwids */
multiline_comment|/* Set available channels/frequencies */
id|range.num_channels
op_assign
id|NUM_CHANNELS
suffix:semicolon
id|k
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;channel_mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|range.freq
(braket
id|k
)braket
dot
id|i
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
id|range.freq
(braket
id|k
)braket
dot
id|m
op_assign
id|channel_frequency
(braket
id|i
)braket
op_star
l_int|100000
suffix:semicolon
id|range.freq
(braket
id|k
)braket
dot
id|e
op_assign
l_int|1
suffix:semicolon
id|k
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|k
op_ge
id|IW_MAX_FREQUENCIES
)paren
r_break
suffix:semicolon
)brace
id|range.num_frequency
op_assign
id|k
suffix:semicolon
id|range.sensitivity
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptype
op_eq
l_int|3
)paren
op_logical_and
(paren
id|priv-&gt;spy_number
op_eq
l_int|0
)paren
)paren
(brace
multiline_comment|/* Quality stats meaningless in ad-hoc mode */
id|range.max_qual.qual
op_assign
l_int|0
suffix:semicolon
id|range.max_qual.level
op_assign
l_int|0
suffix:semicolon
id|range.max_qual.noise
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|range.max_qual.qual
op_assign
l_int|0x8b
op_minus
l_int|0x2f
suffix:semicolon
id|range.max_qual.level
op_assign
l_int|0x2f
op_minus
l_int|0x95
op_minus
l_int|1
suffix:semicolon
id|range.max_qual.noise
op_assign
l_int|0x2f
op_minus
l_int|0x95
op_minus
l_int|1
suffix:semicolon
)brace
id|err
op_assign
id|dldwd_hw_get_bitratelist
c_func
(paren
id|priv
comma
op_amp
id|numrates
comma
id|range.bitrate
comma
id|IW_MAX_BITRATES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|range.num_bitrates
op_assign
id|numrates
suffix:semicolon
multiline_comment|/* Set an indication of the max TCP throughput in bit/s that we can&n;&t; * expect using this interface. May be use for QoS stuff...&n;&t; * Jean II */
r_if
c_cond
(paren
id|numrates
OG
l_int|2
)paren
(brace
id|range.throughput
op_assign
l_int|5
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
)brace
multiline_comment|/* ~5 Mb/s */
r_else
id|range.throughput
op_assign
l_float|1.5
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ~1.5 Mb/s */
id|range.min_rts
op_assign
l_int|0
suffix:semicolon
id|range.max_rts
op_assign
l_int|2347
suffix:semicolon
id|range.min_frag
op_assign
l_int|256
suffix:semicolon
id|range.max_frag
op_assign
l_int|2346
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_wep
)paren
(brace
id|range.max_encoding_tokens
op_assign
id|MAX_KEYS
suffix:semicolon
id|range.encoding_size
(braket
l_int|0
)braket
op_assign
id|SMALL_KEY_SIZE
suffix:semicolon
id|range.num_encoding_sizes
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_big_wep
)paren
(brace
id|range.encoding_size
(braket
l_int|1
)braket
op_assign
id|LARGE_KEY_SIZE
suffix:semicolon
id|range.num_encoding_sizes
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
(brace
id|range.num_encoding_sizes
op_assign
l_int|0
suffix:semicolon
id|range.max_encoding_tokens
op_assign
l_int|0
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|range.min_pmp
op_assign
l_int|0
suffix:semicolon
id|range.max_pmp
op_assign
l_int|65535000
suffix:semicolon
id|range.min_pmt
op_assign
l_int|0
suffix:semicolon
id|range.max_pmt
op_assign
l_int|65535
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
id|range.pmp_flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
id|range.pmt_flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
id|range.pm_capa
op_assign
id|IW_POWER_PERIOD
op_or
id|IW_POWER_TIMEOUT
op_or
id|IW_POWER_UNICAST_R
suffix:semicolon
id|range.num_txpower
op_assign
l_int|1
suffix:semicolon
id|range.txpower
(braket
l_int|0
)braket
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* 15dBm */
id|range.txpower_capa
op_assign
id|IW_TXPOW_DBM
suffix:semicolon
macro_line|#if WIRELESS_EXT &gt; 10
id|range.retry_capa
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.retry_flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|range.r_time_flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
id|range.min_retry
op_assign
l_int|0
suffix:semicolon
id|range.max_retry
op_assign
l_int|65535
suffix:semicolon
multiline_comment|/* ??? */
id|range.min_r_time
op_assign
l_int|0
suffix:semicolon
id|range.max_r_time
op_assign
l_int|65535
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|rrq-&gt;pointer
comma
op_amp
id|range
comma
r_sizeof
(paren
id|range
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setiwencode
r_static
r_int
id|dldwd_ioctl_setiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|index
op_assign
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|setindex
op_assign
id|priv-&gt;tx_key
suffix:semicolon
r_int
id|enable
op_assign
id|priv-&gt;wep_on
suffix:semicolon
r_int
id|restricted
op_assign
id|priv-&gt;wep_restrict
suffix:semicolon
r_uint16
id|xlen
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_char
id|keybuf
(braket
id|MAX_KEY_SIZE
)braket
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
multiline_comment|/* We actually have a key to set */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|keybuf
comma
id|erq-&gt;pointer
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|MAX_KEY_SIZE
)paren
(brace
id|err
op_assign
op_minus
id|E2BIG
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|erq-&gt;length
OG
id|LARGE_KEY_SIZE
)paren
op_logical_or
(paren
op_logical_neg
id|priv-&gt;has_big_wep
op_logical_and
(paren
id|erq-&gt;length
OG
id|SMALL_KEY_SIZE
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|MAX_KEYS
)paren
)paren
id|index
op_assign
id|priv-&gt;tx_key
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|SMALL_KEY_SIZE
)paren
(brace
id|xlen
op_assign
id|LARGE_KEY_SIZE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|erq-&gt;length
OG
l_int|0
)paren
(brace
id|xlen
op_assign
id|SMALL_KEY_SIZE
suffix:semicolon
)brace
r_else
id|xlen
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Switch on WEP if off */
r_if
c_cond
(paren
(paren
op_logical_neg
id|enable
)paren
op_logical_and
(paren
id|xlen
OG
l_int|0
)paren
)paren
(brace
id|setindex
op_assign
id|index
suffix:semicolon
id|enable
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Important note : if the user do &quot;iwconfig eth0 enc off&quot;,&n;&t;&t; * we will arrive there with an index of -1. This is valid&n;&t;&t; * but need to be taken care off... Jean II */
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|MAX_KEYS
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|index
op_ne
op_minus
l_int|1
)paren
op_logical_or
(paren
id|erq-&gt;flags
op_eq
l_int|0
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Set the index : Check that the key is valid */
r_if
c_cond
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
op_eq
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|setindex
op_assign
id|index
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_DISABLED
)paren
id|enable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Only for Prism2 &amp; Symbol cards (so far) - Jean II */
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_OPEN
)paren
id|restricted
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_RESTRICTED
)paren
id|restricted
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
op_assign
id|cpu_to_le16
c_func
(paren
id|xlen
)paren
suffix:semicolon
id|memset
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
l_int|0
comma
r_sizeof
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
id|keybuf
comma
id|erq-&gt;length
)paren
suffix:semicolon
)brace
id|priv-&gt;tx_key
op_assign
id|setindex
suffix:semicolon
id|priv-&gt;wep_on
op_assign
id|enable
suffix:semicolon
id|priv-&gt;wep_restrict
op_assign
id|restricted
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getiwencode
r_static
r_int
id|dldwd_ioctl_getiwencode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|index
op_assign
(paren
id|erq-&gt;flags
op_amp
id|IW_ENCODE_INDEX
)paren
op_minus
l_int|1
suffix:semicolon
r_uint16
id|xlen
op_assign
l_int|0
suffix:semicolon
r_char
id|keybuf
(braket
id|MAX_KEY_SIZE
)braket
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|index
OL
l_int|0
)paren
op_logical_or
(paren
id|index
op_ge
id|MAX_KEYS
)paren
)paren
id|index
op_assign
id|priv-&gt;tx_key
suffix:semicolon
id|erq-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;wep_on
)paren
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_DISABLED
suffix:semicolon
id|erq-&gt;flags
op_or_assign
id|index
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* Only for symbol cards - Jean II */
r_if
c_cond
(paren
id|priv-&gt;firmware_type
op_ne
id|FIRMWARE_TYPE_LUCENT
)paren
(brace
r_if
c_cond
(paren
id|priv-&gt;wep_restrict
)paren
(brace
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_RESTRICTED
suffix:semicolon
)brace
r_else
id|erq-&gt;flags
op_or_assign
id|IW_ENCODE_OPEN
suffix:semicolon
)brace
id|xlen
op_assign
id|le16_to_cpu
c_func
(paren
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|len
)paren
suffix:semicolon
id|erq-&gt;length
op_assign
id|xlen
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
id|memcpy
c_func
(paren
id|keybuf
comma
id|priv-&gt;keys
(braket
id|index
)braket
dot
id|data
comma
id|MAX_KEY_SIZE
)paren
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|erq-&gt;pointer
comma
id|keybuf
comma
id|xlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setessid
r_static
r_int
id|dldwd_ioctl_setessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|essidbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Note : ESSID is ignored in Ad-Hoc demo mode, but we can set it&n;&t; * anyway... - Jean II */
id|memset
c_func
(paren
op_amp
id|essidbuf
comma
l_int|0
comma
r_sizeof
(paren
id|essidbuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;flags
)paren
(brace
r_if
c_cond
(paren
id|erq-&gt;length
OG
id|IW_ESSID_MAX_SIZE
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|essidbuf
comma
id|erq-&gt;pointer
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|essidbuf
(braket
id|erq-&gt;length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;desired_essid
comma
id|essidbuf
comma
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getessid
r_static
r_int
id|dldwd_ioctl_getessid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|erq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|essidbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_int
id|active
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_hw_get_essid
c_func
(paren
id|priv
comma
op_amp
id|active
comma
id|essidbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|erq-&gt;flags
op_assign
l_int|1
suffix:semicolon
id|erq-&gt;length
op_assign
id|strlen
c_func
(paren
id|essidbuf
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|erq-&gt;pointer
)paren
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|erq-&gt;pointer
comma
id|essidbuf
comma
id|erq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setnick
r_static
r_int
id|dldwd_ioctl_setnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|nickbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|nrq-&gt;length
OG
id|IW_ESSID_MAX_SIZE
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
id|memset
c_func
(paren
id|nickbuf
comma
l_int|0
comma
r_sizeof
(paren
id|nickbuf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|nickbuf
comma
id|nrq-&gt;pointer
comma
id|nrq-&gt;length
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|nickbuf
(braket
id|nrq-&gt;length
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|priv-&gt;nick
comma
id|nickbuf
comma
r_sizeof
(paren
id|priv-&gt;nick
)paren
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getnick
r_static
r_int
id|dldwd_ioctl_getnick
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|nrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|nickbuf
(braket
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)braket
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|nickbuf
comma
id|priv-&gt;nick
comma
id|IW_ESSID_MAX_SIZE
op_plus
l_int|1
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|nrq-&gt;length
op_assign
id|strlen
c_func
(paren
id|nickbuf
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|nrq-&gt;pointer
comma
id|nickbuf
comma
r_sizeof
(paren
id|nickbuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setfreq
r_static
r_int
id|dldwd_ioctl_setfreq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_freq
op_star
id|frq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|chan
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* We can only use this in Ad-Hoc demo mode to set the operating&n;&t; * frequency, or in IBSS mode to set the frequency where the IBSS&n;&t; * will be created - Jean II */
r_if
c_cond
(paren
id|priv-&gt;iw_mode
op_ne
id|IW_MODE_ADHOC
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frq-&gt;e
op_eq
l_int|0
)paren
op_logical_and
(paren
id|frq-&gt;m
op_le
l_int|1000
)paren
)paren
(brace
multiline_comment|/* Setting by channel number */
id|chan
op_assign
id|frq-&gt;m
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Setting by frequency - search the table */
r_int
id|mult
op_assign
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|6
op_minus
id|frq-&gt;e
)paren
suffix:semicolon
id|i
op_increment
)paren
id|mult
op_mul_assign
l_int|10
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|frq-&gt;m
op_eq
(paren
id|channel_frequency
(braket
id|i
)braket
op_star
id|mult
)paren
)paren
id|chan
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chan
OL
l_int|1
)paren
op_logical_or
(paren
id|chan
OG
id|NUM_CHANNELS
)paren
op_logical_or
op_logical_neg
(paren
id|priv-&gt;channel_mask
op_amp
(paren
l_int|1
op_lshift
(paren
id|chan
op_minus
l_int|1
)paren
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;channel
op_assign
id|chan
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getsens
r_static
r_int
id|dldwd_ioctl_getsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_uint16
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_SYSTEM_SCALE
comma
op_amp
id|val
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|srq-&gt;value
op_assign
id|val
suffix:semicolon
id|srq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* auto */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setsens
r_static
r_int
id|dldwd_ioctl_setsens
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|srq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|val
op_assign
id|srq-&gt;value
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
OL
l_int|1
)paren
op_logical_or
(paren
id|val
OG
l_int|3
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;ap_density
op_assign
id|val
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setrts
r_static
r_int
id|dldwd_ioctl_setrts
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|val
op_assign
id|rrq-&gt;value
suffix:semicolon
r_if
c_cond
(paren
id|rrq-&gt;disabled
)paren
id|val
op_assign
l_int|2347
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
OL
l_int|0
)paren
op_logical_or
(paren
id|val
OG
l_int|2347
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;rts_thresh
op_assign
id|val
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setfrag
r_static
r_int
id|dldwd_ioctl_setfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
(brace
r_if
c_cond
(paren
id|frq-&gt;disabled
)paren
id|priv-&gt;mwo_robust
op_assign
l_int|0
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|frq-&gt;fixed
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Fixed fragmentation not &bslash;&n;supported on this firmware. Using MWO robust instead.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;mwo_robust
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|frq-&gt;disabled
)paren
id|priv-&gt;frag_thresh
op_assign
l_int|2346
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
(paren
id|frq-&gt;value
OL
l_int|256
)paren
op_logical_or
(paren
id|frq-&gt;value
OG
l_int|2346
)paren
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|priv-&gt;frag_thresh
op_assign
id|frq-&gt;value
op_amp
op_complement
l_int|0x1
suffix:semicolon
multiline_comment|/* must be even */
)brace
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getfrag
r_static
r_int
id|dldwd_ioctl_getfrag
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|frq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|val
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_mwo
)paren
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MWO_ROBUST
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|val
op_assign
l_int|0
suffix:semicolon
id|frq-&gt;value
op_assign
id|val
ques
c_cond
l_int|2347
suffix:colon
l_int|0
suffix:semicolon
id|frq-&gt;disabled
op_assign
op_logical_neg
id|val
suffix:semicolon
id|frq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_FRAG_THRESH
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|val
op_assign
l_int|0
suffix:semicolon
id|frq-&gt;value
op_assign
id|val
suffix:semicolon
id|frq-&gt;disabled
op_assign
(paren
id|val
op_ge
l_int|2346
)paren
suffix:semicolon
id|frq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setrate
r_static
r_int
id|dldwd_ioctl_setrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|rate_ctrl
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|fixed
comma
id|upto
suffix:semicolon
r_int
id|brate
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
multiline_comment|/* Normalise value */
id|brate
op_assign
id|rrq-&gt;value
op_div
l_int|500000
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_LUCENT
suffix:colon
multiline_comment|/* Lucent style rate */
r_if
c_cond
(paren
op_logical_neg
id|rrq-&gt;fixed
)paren
(brace
r_if
c_cond
(paren
id|brate
OG
l_int|0
)paren
id|brate
op_assign
op_minus
id|brate
suffix:semicolon
r_else
id|brate
op_assign
op_minus
l_int|22
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RATES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|rate_list
(braket
id|i
)braket
op_eq
id|brate
)paren
(brace
id|rate_ctrl
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rate_ctrl
OL
l_int|1
)paren
op_logical_or
(paren
id|rate_ctrl
op_ge
id|NUM_RATES
)paren
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|priv-&gt;tx_rate_ctrl
op_assign
id|rate_ctrl
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_PRISM2
suffix:colon
multiline_comment|/* Prism II style rate */
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol style rate */
r_switch
c_cond
(paren
id|brate
)paren
(brace
r_case
l_int|0
suffix:colon
id|fixed
op_assign
l_int|0x0
suffix:semicolon
id|upto
op_assign
l_int|0x15
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|fixed
op_assign
l_int|0x1
suffix:semicolon
id|upto
op_assign
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|fixed
op_assign
l_int|0x2
suffix:semicolon
id|upto
op_assign
l_int|0x3
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|fixed
op_assign
l_int|0x4
suffix:semicolon
id|upto
op_assign
l_int|0x7
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|22
suffix:colon
id|fixed
op_assign
l_int|0x8
suffix:semicolon
id|upto
op_assign
l_int|0x15
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|fixed
op_assign
l_int|0x0
suffix:semicolon
id|upto
op_assign
l_int|0x0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rrq-&gt;fixed
)paren
id|rate_ctrl
op_assign
id|fixed
suffix:semicolon
r_else
id|rate_ctrl
op_assign
id|upto
suffix:semicolon
r_if
c_cond
(paren
id|rate_ctrl
op_eq
l_int|0
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|priv-&gt;tx_rate_ctrl
op_assign
id|rate_ctrl
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getrate
r_static
r_int
id|dldwd_ioctl_getrate
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|val
suffix:semicolon
r_int
id|brate
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_TX_RATE_CTRL
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|priv-&gt;firmware_type
)paren
(brace
r_case
id|FIRMWARE_TYPE_LUCENT
suffix:colon
multiline_comment|/* Lucent style rate */
id|brate
op_assign
id|rate_list
(braket
id|val
)braket
suffix:semicolon
r_if
c_cond
(paren
id|brate
OL
l_int|0
)paren
(brace
id|rrq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENT_TX_RATE
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|6
)paren
id|brate
op_assign
l_int|11
suffix:semicolon
r_else
id|brate
op_assign
l_int|2
op_star
id|val
suffix:semicolon
)brace
r_else
id|rrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIRMWARE_TYPE_PRISM2
suffix:colon
multiline_comment|/* Prism II style rate */
r_case
id|FIRMWARE_TYPE_SYMBOL
suffix:colon
multiline_comment|/* Symbol style rate */
multiline_comment|/* Check if auto or fixed (crude approximation) */
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x1
)paren
op_logical_and
(paren
id|val
OG
l_int|1
)paren
)paren
(brace
id|rrq-&gt;fixed
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CURRENT_TX_RATE
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
id|rrq-&gt;fixed
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|8
)paren
(brace
id|brate
op_assign
l_int|22
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_ge
l_int|4
)paren
(brace
id|brate
op_assign
l_int|11
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
(brace
id|brate
op_assign
l_int|4
suffix:semicolon
)brace
r_else
id|brate
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rrq-&gt;value
op_assign
id|brate
op_star
l_int|500000
suffix:semicolon
id|rrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_setpower
r_static
r_int
id|dldwd_ioctl_setpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prq-&gt;disabled
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_MODE
)paren
(brace
r_case
id|IW_POWER_UNICAST_R
suffix:colon
id|priv-&gt;pm_mcast
op_assign
l_int|0
suffix:semicolon
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_POWER_ALL_R
suffix:colon
id|priv-&gt;pm_mcast
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IW_POWER_ON
suffix:colon
multiline_comment|/* No flags : but we may have a value - Jean II */
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_TIMEOUT
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_timeout
op_assign
id|prq-&gt;value
op_div
l_int|1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_PERIOD
)paren
(brace
id|priv-&gt;pm_on
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;pm_period
op_assign
id|prq-&gt;value
op_div
l_int|1000
suffix:semicolon
)brace
multiline_comment|/* It&squot;s valid to not have a value if we are just toggling&n;&t;&t; * the flags... Jean II */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;pm_on
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getpower
r_static
r_int
id|dldwd_ioctl_getpower
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|prq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|enable
comma
id|period
comma
id|timeout
comma
id|mcast
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_ENABLE
comma
op_amp
id|enable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_PERIOD
comma
op_amp
id|period
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_HOLDOVER
comma
op_amp
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PM_MCAST_RX
comma
op_amp
id|mcast
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|prq-&gt;disabled
op_assign
op_logical_neg
id|enable
suffix:semicolon
multiline_comment|/* Note : by default, display the period */
r_if
c_cond
(paren
(paren
id|prq-&gt;flags
op_amp
id|IW_POWER_TYPE
)paren
op_eq
id|IW_POWER_TIMEOUT
)paren
(brace
id|prq-&gt;flags
op_assign
id|IW_POWER_TIMEOUT
suffix:semicolon
id|prq-&gt;value
op_assign
id|timeout
op_star
l_int|1000
suffix:semicolon
)brace
r_else
(brace
id|prq-&gt;flags
op_assign
id|IW_POWER_PERIOD
suffix:semicolon
id|prq-&gt;value
op_assign
id|period
op_star
l_int|1000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcast
)paren
id|prq-&gt;flags
op_or_assign
id|IW_POWER_ALL_R
suffix:semicolon
r_else
id|prq-&gt;flags
op_or_assign
id|IW_POWER_UNICAST_R
suffix:semicolon
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if WIRELESS_EXT &gt; 10
DECL|function|dldwd_ioctl_getretry
r_static
r_int
id|dldwd_ioctl_getretry
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_param
op_star
id|rrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_uint16
id|short_limit
comma
id|long_limit
comma
id|lifetime
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_SHORT_RETRY_LIMIT
comma
op_amp
id|short_limit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_LONG_RETRY_LIMIT
comma
op_amp
id|long_limit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
id|hermes_read_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_MAX_TX_LIFETIME
comma
op_amp
id|lifetime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|rrq-&gt;disabled
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Can&squot;t be disabled */
multiline_comment|/* Note : by default, display the retry number */
r_if
c_cond
(paren
(paren
id|rrq-&gt;flags
op_amp
id|IW_RETRY_TYPE
)paren
op_eq
id|IW_RETRY_LIFETIME
)paren
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIFETIME
suffix:semicolon
id|rrq-&gt;value
op_assign
id|lifetime
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* ??? */
)brace
r_else
(brace
multiline_comment|/* By default, display the min number */
r_if
c_cond
(paren
(paren
id|rrq-&gt;flags
op_amp
id|IW_RETRY_MAX
)paren
)paren
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
op_or
id|IW_RETRY_MAX
suffix:semicolon
id|rrq-&gt;value
op_assign
id|long_limit
suffix:semicolon
)brace
r_else
(brace
id|rrq-&gt;flags
op_assign
id|IW_RETRY_LIMIT
suffix:semicolon
id|rrq-&gt;value
op_assign
id|short_limit
suffix:semicolon
r_if
c_cond
(paren
id|short_limit
op_ne
id|long_limit
)paren
(brace
id|rrq-&gt;flags
op_or_assign
id|IW_RETRY_MIN
suffix:semicolon
)brace
)brace
)brace
id|out
suffix:colon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
DECL|function|dldwd_ioctl_setport3
r_static
r_int
id|dldwd_ioctl_setport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
)paren
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Try to do IEEE ad-hoc mode */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_ibss
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: Prefer IBSS Ad-Hoc mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;prefer_port3
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Try to do Lucent proprietary ad-hoc mode */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_port3
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s: Prefer Ad-Hoc demo mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;prefer_port3
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
multiline_comment|/* Actually update the mode we are using */
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getport3
r_static
r_int
id|dldwd_ioctl_getport3
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iwreq
op_star
id|wrq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
op_star
id|val
op_assign
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
op_star
id|val
op_assign
id|priv-&gt;prefer_port3
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Spy is used for link quality/strength measurements in Ad-Hoc mode&n; * Jean II */
DECL|function|dldwd_ioctl_setspy
r_static
r_int
id|dldwd_ioctl_setspy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|srq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|number
op_assign
id|srq-&gt;length
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check the number of addresses */
r_if
c_cond
(paren
id|number
OG
id|IW_MAX_SPY
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
multiline_comment|/* Get the data in the driver */
r_if
c_cond
(paren
id|srq-&gt;pointer
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|address
comma
id|srq-&gt;pointer
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Make sure nobody mess with the structure while we do */
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
multiline_comment|/* dldwd_lock() doesn&squot;t disable interrupts, so make sure the&n;&t; * interrupt rx path don&squot;t get confused while we copy */
id|priv-&gt;spy_number
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|number
OG
l_int|0
)paren
(brace
multiline_comment|/* Extract the addresses */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
id|memcpy
c_func
(paren
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* Reset stats */
id|memset
c_func
(paren
id|priv-&gt;spy_stat
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
multiline_comment|/* Set number of addresses */
id|priv-&gt;spy_number
op_assign
id|number
suffix:semicolon
)brace
multiline_comment|/* Time to show what we have done... */
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s: New spy list:&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s: %d - %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
op_plus
l_int|1
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|2
)braket
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|3
)braket
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|4
)braket
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Now, let the others play */
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|dldwd_ioctl_getspy
r_static
r_int
id|dldwd_ioctl_getspy
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|iw_point
op_star
id|srq
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
id|address
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_struct
id|iw_quality
id|spy_stat
(braket
id|IW_MAX_SPY
)braket
suffix:semicolon
r_int
id|number
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|number
op_assign
id|priv-&gt;spy_number
suffix:semicolon
r_if
c_cond
(paren
(paren
id|number
OG
l_int|0
)paren
op_logical_and
(paren
id|srq-&gt;pointer
)paren
)paren
(brace
multiline_comment|/* Create address struct */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|address
(braket
id|i
)braket
dot
id|sa_data
comma
id|priv-&gt;spy_address
(braket
id|i
)braket
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|address
(braket
id|i
)braket
dot
id|sa_family
op_assign
id|AF_UNIX
suffix:semicolon
)brace
multiline_comment|/* Copy stats */
multiline_comment|/* In theory, we should disable irqs while copying the stats&n;&t;&t; * because the rx path migh update it in the middle...&n;&t;&t; * Bah, who care ? - Jean II */
id|memcpy
c_func
(paren
op_amp
id|spy_stat
comma
id|priv-&gt;spy_stat
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|IW_MAX_SPY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number
suffix:semicolon
id|i
op_increment
)paren
id|priv-&gt;spy_stat
(braket
id|i
)braket
dot
id|updated
op_assign
l_int|0
suffix:semicolon
)brace
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
multiline_comment|/* Push stuff to user space */
id|srq-&gt;length
op_assign
id|number
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|srq-&gt;pointer
comma
id|address
comma
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|srq-&gt;pointer
op_plus
(paren
r_sizeof
(paren
r_struct
id|sockaddr
)paren
op_star
id|number
)paren
comma
op_amp
id|spy_stat
comma
r_sizeof
(paren
r_struct
id|iw_quality
)paren
op_star
id|number
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|dldwd_ioctl
id|dldwd_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|iwreq
op_star
id|wrq
op_assign
(paren
r_struct
id|iwreq
op_star
)paren
id|rq
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|changed
op_assign
l_int|0
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* In theory, we could allow most of the the SET stuff to be done&n;&t; * In practice, the laps of time at startup when the card is not&n;&t; * ready is very short, so why bother...&n;&t; * Note that hw_ready is different from up/down (ifconfig), when&n;&t; * the device is not yet up, it is usually already ready...&n;&t; * Jean II */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;hw_ready
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGIWNAME
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWNAME&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|wrq-&gt;u.name
comma
l_string|&quot;IEEE 802.11-DS&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWAP
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWAP&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|wrq-&gt;u.ap_addr.sa_family
op_assign
id|ARPHRD_ETHER
suffix:semicolon
id|err
op_assign
id|dldwd_hw_get_bssid
c_func
(paren
id|priv
comma
id|wrq-&gt;u.ap_addr.sa_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRANGE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWRANGE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getiwrange
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWMODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWMODE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|wrq-&gt;u.mode
)paren
(brace
r_case
id|IW_MODE_ADHOC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|priv-&gt;has_ibss
op_logical_or
id|priv-&gt;has_port3
)paren
)paren
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
(brace
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_ADHOC
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|IW_MODE_INFRA
suffix:colon
id|priv-&gt;iw_mode
op_assign
id|IW_MODE_INFRA
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|set_port_type
c_func
(paren
id|priv
)paren
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWMODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWMODE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|wrq-&gt;u.mode
op_assign
id|priv-&gt;iw_mode
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWENCODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWENCODE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|dldwd_ioctl_setiwencode
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.encoding
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWENCODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWENCODE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;has_wep
)paren
(brace
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|dldwd_ioctl_getiwencode
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.encoding
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWESSID
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWESSID&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setessid
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.essid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWESSID
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWESSID&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getessid
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.essid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWNICKN
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWNICKN&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setnick
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWNICKN
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWNICKN&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getnick
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWFREQ
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWFREQ&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|wrq-&gt;u.freq.m
op_assign
id|dldwd_hw_get_freq
c_func
(paren
id|priv
)paren
suffix:semicolon
id|wrq-&gt;u.freq.e
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWFREQ
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWFREQ&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setfreq
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.freq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWSENS
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWSENS&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getsens
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.sens
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWSENS
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWSENS&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setsens
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.sens
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRTS
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWRTS&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|wrq-&gt;u.rts.value
op_assign
id|priv-&gt;rts_thresh
suffix:semicolon
id|wrq-&gt;u.rts.disabled
op_assign
(paren
id|wrq-&gt;u.rts.value
op_eq
l_int|2347
)paren
suffix:semicolon
id|wrq-&gt;u.rts.fixed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWRTS
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWRTS&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setrts
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.rts
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWFRAG
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWFRAG&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setfrag
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.frag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWFRAG
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWFRAG&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getfrag
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.frag
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWRATE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWRATE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setrate
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.bitrate
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRATE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWRATE&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getrate
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.bitrate
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSIWPOWER
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWPOWER&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setpower
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.power
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWPOWER
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWPOWER&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getpower
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.power
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWTXPOW
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWTXPOW&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* The card only supports one tx power, so this is easy */
id|wrq-&gt;u.txpower.value
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* dBm */
id|wrq-&gt;u.txpower.fixed
op_assign
l_int|1
suffix:semicolon
id|wrq-&gt;u.txpower.disabled
op_assign
l_int|0
suffix:semicolon
id|wrq-&gt;u.txpower.flags
op_assign
id|IW_TXPOW_DBM
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if WIRELESS_EXT &gt; 10
r_case
id|SIOCSIWRETRY
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWRETRY&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWRETRY
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWRETRY&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getretry
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.retry
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* WIRELESS_EXT &gt; 10 */
r_case
id|SIOCSIWSPY
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCSIWSPY&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_setspy
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWSPY
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWSPY&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getspy
c_func
(paren
id|dev
comma
op_amp
id|wrq-&gt;u.data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGIWPRIV
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCGIWPRIV&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wrq-&gt;u.data.pointer
)paren
(brace
r_struct
id|iw_priv_args
id|privtab
(braket
)braket
op_assign
(brace
(brace
id|SIOCDEVPRIVATE
op_plus
l_int|0x0
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;force_reset&quot;
)brace
comma
(brace
id|SIOCDEVPRIVATE
op_plus
l_int|0x2
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_port3&quot;
)brace
comma
(brace
id|SIOCDEVPRIVATE
op_plus
l_int|0x3
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_port3&quot;
)brace
comma
(brace
id|SIOCDEVPRIVATE
op_plus
l_int|0x4
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_int|0
comma
l_string|&quot;set_preamble&quot;
)brace
comma
(brace
id|SIOCDEVPRIVATE
op_plus
l_int|0x5
comma
l_int|0
comma
id|IW_PRIV_TYPE_INT
op_or
id|IW_PRIV_SIZE_FIXED
op_or
l_int|1
comma
l_string|&quot;get_preamble&quot;
)brace
)brace
suffix:semicolon
id|err
op_assign
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|wrq-&gt;u.data.pointer
comma
r_sizeof
(paren
id|privtab
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|wrq-&gt;u.data.length
op_assign
r_sizeof
(paren
id|privtab
)paren
op_div
r_sizeof
(paren
id|privtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|wrq-&gt;u.data.pointer
comma
id|privtab
comma
r_sizeof
(paren
id|privtab
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|0x0
suffix:colon
multiline_comment|/* force_reset */
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCDEVPRIVATE + 0x0 (force_reset)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Forcing reset!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dldwd_reset
c_func
(paren
id|priv
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|0x2
suffix:colon
multiline_comment|/* set_port3 */
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCDEVPRIVATE + 0x2 (set_port3)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|dldwd_ioctl_setport3
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|changed
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|0x3
suffix:colon
multiline_comment|/* get_port3 */
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCDEVPRIVATE + 0x3 (get_port3)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
id|dldwd_ioctl_getport3
c_func
(paren
id|dev
comma
id|wrq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|0x4
suffix:colon
multiline_comment|/* set_preamble */
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCDEVPRIVATE + 0x4 (set_preamble)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* 802.11b has recently defined some short preamble.&n;&t;&t; * Basically, the Phy header has been reduced in size.&n;&t;&t; * This increase performance, especially at high rates&n;&t;&t; * (the preamble is transmitted at 1Mb/s), unfortunately&n;&t;&t; * this give compatibility troubles... - Jean II */
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
r_int
id|val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
)paren
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
id|priv-&gt;preamble
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|priv-&gt;preamble
op_assign
l_int|0
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|0x5
suffix:colon
multiline_comment|/* get_preamble */
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;%s: SIOCDEVPRIVATE + 0x5 (get_preamble)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;has_preamble
)paren
(brace
r_int
op_star
id|val
op_assign
(paren
r_int
op_star
)paren
id|wrq-&gt;u.name
suffix:semicolon
id|dldwd_lock
c_func
(paren
id|priv
)paren
suffix:semicolon
op_star
id|val
op_assign
id|priv-&gt;preamble
suffix:semicolon
id|dldwd_unlock
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
r_else
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|changed
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|err
op_assign
id|dldwd_reset
c_func
(paren
id|priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
multiline_comment|/* Ouch ! What are we supposed to do ? */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;orinoco_cs: Failed to set parameters on %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dldwd_shutdown
c_func
(paren
id|priv
)paren
suffix:semicolon
id|priv-&gt;hw_ready
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_int
DECL|function|dldwd_change_mtu
id|dldwd_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
OL
id|DLDWD_MIN_MTU
)paren
op_logical_or
(paren
id|new_mtu
OG
id|DLDWD_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|__dldwd_set_multicast_list
id|__dldwd_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dldwd_priv_t
op_star
id|priv
op_assign
id|dev-&gt;priv
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|priv-&gt;hw
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|promisc
comma
id|allmulti
comma
id|mc_count
suffix:semicolon
multiline_comment|/* We&squot;ll wait until it&squot;s ready. Anyway, the network doesn&squot;t call us&n;&t; * here until we are open - Jean II */
r_if
c_cond
(paren
op_logical_neg
id|priv-&gt;hw_ready
)paren
r_return
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;dev-&gt;flags=0x%x, priv-&gt;promiscuous=%d, dev-&gt;mc_count=%d priv-&gt;mc_count=%d&bslash;n&quot;
comma
id|dev-&gt;flags
comma
id|priv-&gt;promiscuous
comma
id|dev-&gt;mc_count
comma
id|priv-&gt;mc_count
)paren
suffix:semicolon
multiline_comment|/* The Hermes doesn&squot;t seem to have an allmulti mode, so we go&n;&t; * into promiscuous mode and let the upper levels deal. */
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
)paren
(brace
id|promisc
op_assign
l_int|1
suffix:semicolon
id|allmulti
op_assign
l_int|0
suffix:semicolon
id|mc_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
(paren
id|dev-&gt;mc_count
OG
id|HERMES_MAX_MULTICAST
)paren
)paren
(brace
id|promisc
op_assign
l_int|0
suffix:semicolon
id|allmulti
op_assign
l_int|1
suffix:semicolon
id|mc_count
op_assign
id|HERMES_MAX_MULTICAST
suffix:semicolon
)brace
r_else
(brace
id|promisc
op_assign
l_int|0
suffix:semicolon
id|allmulti
op_assign
l_int|0
suffix:semicolon
id|mc_count
op_assign
id|dev-&gt;mc_count
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;promisc=%d mc_count=%d&bslash;n&quot;
comma
id|promisc
comma
id|mc_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|promisc
op_ne
id|priv-&gt;promiscuous
)paren
(brace
multiline_comment|/* Don&squot;t touch the hardware if we don&squot;t have to */
id|err
op_assign
id|hermes_write_wordrec
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_PROMISCUOUS
comma
id|promisc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting promiscuity to %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
comma
id|promisc
)paren
suffix:semicolon
)brace
r_else
id|priv-&gt;promiscuous
op_assign
id|promisc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|allmulti
)paren
(brace
multiline_comment|/* FIXME: This method of doing allmulticast reception&n;&t;&t;   comes from the NetBSD driver. Haven&squot;t actually&n;&t;&t;   tested whether it works or not. */
id|hermes_multicast_t
id|mclist
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mclist
comma
l_int|0
comma
r_sizeof
(paren
id|mclist
)paren
)paren
suffix:semicolon
id|err
op_assign
id|HERMES_WRITE_RECORD
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MULTICAST_LIST
comma
op_amp
id|mclist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting multicast list.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_else
id|priv-&gt;allmulti
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mc_count
op_logical_or
(paren
op_logical_neg
id|mc_count
op_logical_and
id|priv-&gt;mc_count
)paren
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|p
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|hermes_multicast_t
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|mc_count
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* First some paranoid checks */
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Multicast list shorter than mc_count.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;dmi_addrlen
op_ne
id|ETH_ALEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Bad address size (%d) in multicast list.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|p-&gt;dmi_addrlen
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|mclist.addr
(braket
id|i
)braket
comma
id|p-&gt;dmi_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
multiline_comment|/* More paranoia */
r_if
c_cond
(paren
id|p
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Multicast list longer than mc_count.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|priv-&gt;mc_count
op_assign
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|3
comma
l_string|&quot;priv-&gt;mc_count = %d&bslash;n&quot;
comma
id|priv-&gt;mc_count
)paren
suffix:semicolon
id|err
op_assign
id|hermes_write_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|HERMES_RID_CNF_MULTICAST_LIST
comma
id|HERMES_BYTES_TO_RECLEN
c_func
(paren
id|priv-&gt;mc_count
op_star
id|ETH_ALEN
)paren
comma
op_amp
id|mclist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Error %d setting multicast list.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
r_else
id|priv-&gt;allmulti
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Since we can set the promiscuous flag when it wasn&squot;t asked&n;&t;   for, make sure the net_device knows about it. */
r_if
c_cond
(paren
id|priv-&gt;promiscuous
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_PROMISC
suffix:semicolon
r_else
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_PROMISC
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;allmulti
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_ALLMULTI
suffix:semicolon
r_else
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_ALLMULTI
suffix:semicolon
id|TRACE_EXIT
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * procfs stuff&n; */
DECL|variable|dir_base
r_static
r_struct
id|proc_dir_entry
op_star
id|dir_base
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n; * This function updates the total amount of data printed so far. It then&n; * determines if the amount of data printed into a buffer  has reached the&n; * offset requested. If it hasn&squot;t, then the buffer is shifted over so that&n; * the next bit of data can be printed over the old bit. If the total&n; * amount printed so far exceeds the total amount requested, then this&n; * function returns 1, otherwise 0.&n; */
r_static
r_int
DECL|function|shift_buffer
id|shift_buffer
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|requested_offset
comma
r_int
id|requested_len
comma
r_int
op_star
id|total
comma
r_int
op_star
id|slop
comma
r_char
op_star
op_star
id|buf
)paren
(brace
r_int
id|printed
suffix:semicolon
id|printed
op_assign
op_star
id|buf
op_minus
id|buffer
suffix:semicolon
r_if
c_cond
(paren
op_star
id|total
op_plus
id|printed
op_le
id|requested_offset
)paren
(brace
op_star
id|total
op_add_assign
id|printed
suffix:semicolon
op_star
id|buf
op_assign
id|buffer
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_star
id|total
OL
id|requested_offset
)paren
(brace
op_star
id|slop
op_assign
id|requested_offset
op_minus
op_star
id|total
suffix:semicolon
)brace
op_star
id|total
op_assign
id|requested_offset
op_plus
id|printed
op_minus
op_star
id|slop
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|total
OG
id|requested_offset
op_plus
id|requested_len
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * This function calculates the actual start of the requested data&n; * in the buffer. It also calculates actual length of data returned,&n; * which could be less that the amount of data requested.&n; */
DECL|macro|PROC_BUFFER_SIZE
mdefine_line|#define PROC_BUFFER_SIZE 4096
DECL|macro|PROC_SAFE_SIZE
mdefine_line|#define PROC_SAFE_SIZE 3072
r_static
r_int
DECL|function|calc_start_len
id|calc_start_len
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
r_int
id|requested_offset
comma
r_int
id|requested_len
comma
r_int
id|total
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|return_len
comma
id|buffer_len
suffix:semicolon
id|buffer_len
op_assign
id|buf
op_minus
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|buffer_len
op_ge
id|PROC_BUFFER_SIZE
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;calc_start_len: exceeded /proc buffer size&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * There may be bytes before and after the&n;&t; * chunk that was actually requested.&n;&t; */
id|return_len
op_assign
id|total
op_minus
id|requested_offset
suffix:semicolon
r_if
c_cond
(paren
id|return_len
OL
l_int|0
)paren
(brace
id|return_len
op_assign
l_int|0
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buf
op_minus
id|return_len
suffix:semicolon
r_if
c_cond
(paren
id|return_len
OG
id|requested_len
)paren
(brace
id|return_len
op_assign
id|requested_len
suffix:semicolon
)brace
r_return
id|return_len
suffix:semicolon
)brace
r_static
r_int
DECL|function|dldwd_proc_get_hermes_regs
id|dldwd_proc_get_hermes_regs
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|requested_offset
comma
r_int
id|requested_len
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|dldwd_priv_t
op_star
id|dev
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|data
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|dev-&gt;hw
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|total
op_assign
l_int|0
comma
id|slop
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Hum, in this case hardware register are probably not readable... */
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;hw_ready
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|buf
op_assign
id|page
suffix:semicolon
DECL|macro|DHERMESREG
mdefine_line|#define DHERMESREG(name) buf += sprintf(buf, &quot;%-16s: %04x&bslash;n&quot;, #name, hermes_read_regn(hw, name))
id|DHERMESREG
c_func
(paren
id|CMD
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|PARAM0
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|PARAM1
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|PARAM2
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|STATUS
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|RESP0
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|RESP1
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|RESP2
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|INFOFID
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|RXFID
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|ALLOCFID
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|TXCOMPLFID
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|SELECT0
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|OFFSET0
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|SELECT1
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|OFFSET1
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|EVSTAT
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|INTEN
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|EVACK
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|CONTROL
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|SWSUPPORT0
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|SWSUPPORT1
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|SWSUPPORT2
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|AUXPAGE
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|AUXOFFSET
)paren
suffix:semicolon
id|DHERMESREG
c_func
(paren
id|AUXDATA
)paren
suffix:semicolon
DECL|macro|DHERMESREG
macro_line|#undef DHERMESREG
id|shift_buffer
c_func
(paren
id|page
comma
id|requested_offset
comma
id|requested_len
comma
op_amp
id|total
comma
op_amp
id|slop
comma
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|calc_start_len
c_func
(paren
id|page
comma
id|start
comma
id|requested_offset
comma
id|requested_len
comma
id|total
comma
id|buf
)paren
suffix:semicolon
)brace
r_struct
(brace
DECL|member|rid
r_uint16
id|rid
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|minlen
DECL|member|maxlen
r_int
id|minlen
comma
id|maxlen
suffix:semicolon
DECL|member|displaytype
r_int
id|displaytype
suffix:semicolon
DECL|macro|DISPLAY_WORDS
mdefine_line|#define DISPLAY_WORDS&t;0
DECL|macro|DISPLAY_BYTES
mdefine_line|#define DISPLAY_BYTES&t;1
DECL|macro|DISPLAY_STRING
mdefine_line|#define DISPLAY_STRING&t;2
DECL|variable|record_table
)brace
id|record_table
(braket
)braket
op_assign
(brace
DECL|macro|RTCNFENTRY
mdefine_line|#define RTCNFENTRY(name, type) { HERMES_RID_CNF_##name, #name, 0, LTV_BUF_SIZE, type }
id|RTCNFENTRY
c_func
(paren
id|PORTTYPE
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|MACADDR
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|DESIRED_SSID
comma
id|DISPLAY_STRING
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|CHANNEL
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|OWN_SSID
comma
id|DISPLAY_STRING
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|SYSTEM_SCALE
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|MAX_DATA_LEN
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PM_ENABLE
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PM_MCAST_RX
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PM_PERIOD
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|NICKNAME
comma
id|DISPLAY_STRING
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|WEP_ON
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|MWO_ROBUST
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|MULTICAST_LIST
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|CREATEIBSS
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|FRAG_THRESH
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|RTS_THRESH
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|TX_RATE_CTRL
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PROMISCUOUS
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|KEYS
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|TX_KEY
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|TICKTIME
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_TX_KEY
comma
id|DISPLAY_WORDS
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_KEY0
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_KEY1
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_KEY2
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_KEY3
comma
id|DISPLAY_BYTES
)paren
comma
id|RTCNFENTRY
c_func
(paren
id|PRISM2_WEP_ON
comma
id|DISPLAY_WORDS
)paren
comma
DECL|macro|RTCNFENTRY
macro_line|#undef RTCNFENTRY
DECL|macro|RTINFENTRY
mdefine_line|#define RTINFENTRY(name,type) { HERMES_RID_##name, #name, 0, LTV_BUF_SIZE, type }
id|RTINFENTRY
c_func
(paren
id|CHANNEL_LIST
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|STAIDENTITY
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|CURRENT_SSID
comma
id|DISPLAY_STRING
)paren
comma
id|RTINFENTRY
c_func
(paren
id|CURRENT_BSSID
comma
id|DISPLAY_BYTES
)paren
comma
id|RTINFENTRY
c_func
(paren
id|COMMSQUALITY
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|CURRENT_TX_RATE
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|WEP_AVAIL
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|CURRENT_CHANNEL
comma
id|DISPLAY_WORDS
)paren
comma
id|RTINFENTRY
c_func
(paren
id|DATARATES
comma
id|DISPLAY_BYTES
)paren
comma
DECL|macro|RTINFENTRY
macro_line|#undef RTINFENTRY
)brace
suffix:semicolon
DECL|macro|NUM_RIDS
mdefine_line|#define NUM_RIDS ( sizeof(record_table) / sizeof(record_table[0]) )
r_static
r_int
DECL|function|dldwd_proc_get_hermes_recs
id|dldwd_proc_get_hermes_recs
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|requested_offset
comma
r_int
id|requested_len
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|dldwd_priv_t
op_star
id|dev
op_assign
(paren
id|dldwd_priv_t
op_star
)paren
id|data
suffix:semicolon
id|hermes_t
op_star
id|hw
op_assign
op_amp
id|dev-&gt;hw
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|total
op_assign
l_int|0
comma
id|slop
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_uint16
id|length
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Hum, in this case hardware register are probably not readable... */
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;hw_ready
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|buf
op_assign
id|page
suffix:semicolon
multiline_comment|/* print out all the config RIDs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_uint16
id|rid
op_assign
id|record_table
(braket
id|i
)braket
dot
id|rid
suffix:semicolon
r_int
id|minlen
op_assign
id|record_table
(braket
id|i
)braket
dot
id|minlen
suffix:semicolon
r_int
id|maxlen
op_assign
id|record_table
(braket
id|i
)braket
dot
id|maxlen
suffix:semicolon
r_int
id|len
suffix:semicolon
r_uint8
op_star
id|val8
suffix:semicolon
r_uint16
op_star
id|val16
suffix:semicolon
r_int
id|j
suffix:semicolon
id|val8
op_assign
id|kmalloc
c_func
(paren
id|maxlen
op_plus
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val8
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|hermes_read_ltv
c_func
(paren
id|hw
comma
id|USER_BAP
comma
id|rid
comma
id|maxlen
comma
op_amp
id|length
comma
id|val8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;Error %d reading RID 0x%04x&bslash;n&quot;
comma
id|err
comma
id|rid
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|val16
op_assign
(paren
r_uint16
op_star
)paren
id|val8
suffix:semicolon
id|buf
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%-15s (0x%04x): length=%d (%d bytes)&bslash;tvalue=&quot;
comma
id|record_table
(braket
id|i
)braket
dot
id|name
comma
id|rid
comma
id|length
comma
(paren
id|length
op_minus
l_int|1
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|len
op_assign
id|MIN
c_func
(paren
id|MAX
c_func
(paren
id|minlen
comma
(paren
id|length
op_minus
l_int|1
)paren
op_star
l_int|2
)paren
comma
id|maxlen
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|record_table
(braket
id|i
)braket
dot
id|displaytype
)paren
(brace
r_case
id|DISPLAY_WORDS
suffix:colon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
op_div
l_int|2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|buf
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%04X-&quot;
comma
id|le16_to_cpu
c_func
(paren
id|val16
(braket
id|j
)braket
)paren
)paren
suffix:semicolon
)brace
id|buf
op_decrement
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPLAY_BYTES
suffix:colon
r_default
suffix:colon
(brace
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
suffix:semicolon
id|j
op_increment
)paren
(brace
id|buf
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%02X:&quot;
comma
id|val8
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|buf
op_decrement
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DISPLAY_STRING
suffix:colon
id|len
op_assign
id|MIN
c_func
(paren
id|len
comma
id|le16_to_cpu
c_func
(paren
id|val16
(braket
l_int|0
)braket
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|val8
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|buf
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;&quot;%s&bslash;&quot;&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|val16
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|buf
op_add_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|val8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shift_buffer
c_func
(paren
id|page
comma
id|requested_offset
comma
id|requested_len
comma
op_amp
id|total
comma
op_amp
id|slop
comma
op_amp
id|buf
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf
op_minus
id|page
)paren
OG
id|PROC_SAFE_SIZE
)paren
r_break
suffix:semicolon
)brace
r_return
id|calc_start_len
c_func
(paren
id|page
comma
id|start
comma
id|requested_offset
comma
id|requested_len
comma
id|total
comma
id|buf
)paren
suffix:semicolon
)brace
multiline_comment|/* initialise the /proc subsystem for the hermes driver, creating the&n; * separate entries */
r_static
r_int
DECL|function|dldwd_proc_init
id|dldwd_proc_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|TRACE_ENTER
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
multiline_comment|/* create the directory for it to sit in */
id|dir_base
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;hermes&quot;
comma
id|S_IFDIR
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir_base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to initialise /proc/hermes.&bslash;n&quot;
)paren
suffix:semicolon
id|dldwd_proc_cleanup
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|TRACE_EXIT
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_int
DECL|function|dldwd_proc_dev_init
id|dldwd_proc_dev_init
c_func
(paren
id|dldwd_priv_t
op_star
id|dev
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
op_amp
id|dev-&gt;ndev
suffix:semicolon
id|dev-&gt;dir_dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* create the directory for it to sit in */
id|dev-&gt;dir_dev
op_assign
id|create_proc_entry
c_func
(paren
id|ndev-&gt;name
comma
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
comma
id|dir_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;dir_dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to initialise /proc/hermes/%s.&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|dev-&gt;dir_regs
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;dir_regs
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;regs&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|dev-&gt;dir_dev
comma
id|dldwd_proc_get_hermes_regs
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;dir_regs
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to initialise /proc/hermes/%s/regs.&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|dev-&gt;dir_recs
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;dir_recs
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;recs&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
id|dev-&gt;dir_dev
comma
id|dldwd_proc_get_hermes_recs
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;dir_recs
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unable to initialise /proc/hermes/%s/recs.&bslash;n&quot;
comma
id|ndev-&gt;name
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|dldwd_proc_dev_cleanup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_void
DECL|function|dldwd_proc_dev_cleanup
id|dldwd_proc_dev_cleanup
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
r_if
c_cond
(paren
id|priv-&gt;dir_regs
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;regs&quot;
comma
id|priv-&gt;dir_dev
)paren
suffix:semicolon
id|priv-&gt;dir_regs
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;dir_recs
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;recs&quot;
comma
id|priv-&gt;dir_dev
)paren
suffix:semicolon
id|priv-&gt;dir_recs
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|priv-&gt;dir_dev
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|ndev-&gt;name
comma
id|dir_base
)paren
suffix:semicolon
id|priv-&gt;dir_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|dldwd_proc_cleanup
id|dldwd_proc_cleanup
c_func
(paren
r_void
)paren
(brace
id|TRACE_ENTER
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir_base
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;hermes&quot;
comma
op_amp
id|proc_root
)paren
suffix:semicolon
id|dir_base
op_assign
l_int|NULL
suffix:semicolon
)brace
id|TRACE_EXIT
c_func
(paren
l_string|&quot;dldwd&quot;
)paren
suffix:semicolon
)brace
r_int
DECL|function|dldwd_setup
id|dldwd_setup
c_func
(paren
id|dldwd_priv_t
op_star
id|priv
)paren
(brace
r_struct
id|net_device
op_star
id|ndev
op_assign
op_amp
id|priv-&gt;ndev
suffix:semicolon
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|priv-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Set up the net_device */
id|ether_setup
c_func
(paren
id|ndev
)paren
suffix:semicolon
id|ndev-&gt;priv
op_assign
id|priv
suffix:semicolon
multiline_comment|/* Setup up default routines */
id|ndev-&gt;init
op_assign
id|dldwd_init
suffix:semicolon
id|ndev-&gt;open
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Caller *must* override */
id|ndev-&gt;stop
op_assign
l_int|NULL
suffix:semicolon
id|ndev-&gt;hard_start_xmit
op_assign
id|dldwd_xmit
suffix:semicolon
id|ndev-&gt;tx_timeout
op_assign
id|dldwd_tx_timeout
suffix:semicolon
id|ndev-&gt;watchdog_timeo
op_assign
l_int|4
op_star
id|HZ
suffix:semicolon
multiline_comment|/* 4 second timeout */
id|ndev-&gt;get_stats
op_assign
id|dldwd_get_stats
suffix:semicolon
id|ndev-&gt;get_wireless_stats
op_assign
id|dldwd_get_wireless_stats
suffix:semicolon
id|ndev-&gt;do_ioctl
op_assign
id|dldwd_ioctl
suffix:semicolon
id|ndev-&gt;change_mtu
op_assign
id|dldwd_change_mtu
suffix:semicolon
id|ndev-&gt;set_multicast_list
op_assign
id|dldwd_set_multicast_list
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|ndev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef ORINOCO_DEBUG
DECL|variable|dldwd_debug
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_debug
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|dldwd_init
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_init
)paren
suffix:semicolon
DECL|variable|dldwd_xmit
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_xmit
)paren
suffix:semicolon
DECL|variable|dldwd_tx_timeout
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_tx_timeout
)paren
suffix:semicolon
DECL|variable|dldwd_ioctl
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_ioctl
)paren
suffix:semicolon
DECL|variable|dldwd_change_mtu
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_change_mtu
)paren
suffix:semicolon
DECL|variable|dldwd_set_multicast_list
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_set_multicast_list
)paren
suffix:semicolon
DECL|variable|dldwd_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_shutdown
)paren
suffix:semicolon
DECL|variable|dldwd_reset
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_reset
)paren
suffix:semicolon
DECL|variable|dldwd_setup
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_setup
)paren
suffix:semicolon
DECL|variable|dldwd_proc_dev_init
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_proc_dev_init
)paren
suffix:semicolon
DECL|variable|dldwd_proc_dev_cleanup
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_proc_dev_cleanup
)paren
suffix:semicolon
DECL|variable|dldwd_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|dldwd_interrupt
)paren
suffix:semicolon
DECL|function|init_dldwd
r_static
r_int
id|__init
id|init_dldwd
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|dldwd_proc_init
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|exit_dldwd
r_static
r_void
id|__exit
id|exit_dldwd
c_func
(paren
r_void
)paren
(brace
id|dldwd_proc_cleanup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|init_dldwd
id|module_init
c_func
(paren
id|init_dldwd
)paren
suffix:semicolon
DECL|variable|exit_dldwd
id|module_exit
c_func
(paren
id|exit_dldwd
)paren
suffix:semicolon
eof
