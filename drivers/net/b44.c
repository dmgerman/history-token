multiline_comment|/* b44.c: Broadcom 4400 device driver.&n; *&n; * Copyright (C) 2002 David S. Miller (davem@redhat.com)&n; * Fixed by Pekka Pietikainen (pp@ee.oulu.fi)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &quot;b44.h&quot;
DECL|macro|DRV_MODULE_NAME
mdefine_line|#define DRV_MODULE_NAME&t;&t;&quot;b44&quot;
DECL|macro|PFX
mdefine_line|#define PFX DRV_MODULE_NAME&t;&quot;: &quot;
DECL|macro|DRV_MODULE_VERSION
mdefine_line|#define DRV_MODULE_VERSION&t;&quot;0.9&quot;
DECL|macro|DRV_MODULE_RELDATE
mdefine_line|#define DRV_MODULE_RELDATE&t;&quot;Jul 14, 2003&quot;
DECL|macro|B44_DEF_MSG_ENABLE
mdefine_line|#define B44_DEF_MSG_ENABLE&t;  &bslash;&n;&t;(NETIF_MSG_DRV&t;&t;| &bslash;&n;&t; NETIF_MSG_PROBE&t;| &bslash;&n;&t; NETIF_MSG_LINK&t;&t;| &bslash;&n;&t; NETIF_MSG_TIMER&t;| &bslash;&n;&t; NETIF_MSG_IFDOWN&t;| &bslash;&n;&t; NETIF_MSG_IFUP&t;&t;| &bslash;&n;&t; NETIF_MSG_RX_ERR&t;| &bslash;&n;&t; NETIF_MSG_TX_ERR)
multiline_comment|/* length of time before we decide the hardware is borked,&n; * and dev-&gt;tx_timeout() should be called to fix the problem&n; */
DECL|macro|B44_TX_TIMEOUT
mdefine_line|#define B44_TX_TIMEOUT&t;&t;&t;(5 * HZ)
multiline_comment|/* hardware minimum and maximum for a single frame&squot;s data payload */
DECL|macro|B44_MIN_MTU
mdefine_line|#define B44_MIN_MTU&t;&t;&t;60
DECL|macro|B44_MAX_MTU
mdefine_line|#define B44_MAX_MTU&t;&t;&t;1500
DECL|macro|B44_RX_RING_SIZE
mdefine_line|#define B44_RX_RING_SIZE&t;&t;512
DECL|macro|B44_DEF_RX_RING_PENDING
mdefine_line|#define B44_DEF_RX_RING_PENDING&t;&t;200
DECL|macro|B44_RX_RING_BYTES
mdefine_line|#define B44_RX_RING_BYTES&t;(sizeof(struct dma_desc) * &bslash;&n;&t;&t;&t;&t; B44_RX_RING_SIZE)
DECL|macro|B44_TX_RING_SIZE
mdefine_line|#define B44_TX_RING_SIZE&t;&t;512
DECL|macro|B44_DEF_TX_RING_PENDING
mdefine_line|#define B44_DEF_TX_RING_PENDING&t;&t;(B44_TX_RING_SIZE - 1)
DECL|macro|B44_TX_RING_BYTES
mdefine_line|#define B44_TX_RING_BYTES&t;(sizeof(struct dma_desc) * &bslash;&n;&t;&t;&t;&t; B44_TX_RING_SIZE)
DECL|macro|TX_RING_GAP
mdefine_line|#define TX_RING_GAP(BP)&t;&bslash;&n;&t;(B44_TX_RING_SIZE - (BP)-&gt;tx_pending)
DECL|macro|TX_BUFFS_AVAIL
mdefine_line|#define TX_BUFFS_AVAIL(BP)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;(((BP)-&gt;tx_cons &lt;= (BP)-&gt;tx_prod) ?&t;&t;&t;&t;&bslash;&n;&t;  (BP)-&gt;tx_cons + (BP)-&gt;tx_pending - (BP)-&gt;tx_prod :&t;&t;&bslash;&n;&t;  (BP)-&gt;tx_cons - (BP)-&gt;tx_prod - TX_RING_GAP(BP))
DECL|macro|NEXT_TX
mdefine_line|#define NEXT_TX(N)&t;&t;(((N) + 1) &amp; (B44_TX_RING_SIZE - 1))
DECL|macro|RX_PKT_BUF_SZ
mdefine_line|#define RX_PKT_BUF_SZ&t;&t;(1536 + bp-&gt;rx_offset + 64)
multiline_comment|/* minimum number of free TX descriptors required to wake up TX process */
DECL|macro|B44_TX_WAKEUP_THRESH
mdefine_line|#define B44_TX_WAKEUP_THRESH&t;&t;(B44_TX_RING_SIZE / 4)
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|DRV_MODULE_NAME
l_string|&quot;.c:v&quot;
id|DRV_MODULE_VERSION
l_string|&quot; (&quot;
id|DRV_MODULE_RELDATE
l_string|&quot;)&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller (davem@redhat.com)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Broadcom 4400 10/100 PCI ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|b44_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|b44_debug
comma
l_string|&quot;B44 bitmapped debugging message enable value&quot;
)paren
suffix:semicolon
DECL|variable|b44_debug
r_static
r_int
id|b44_debug
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* -1 == use B44_DEF_MSG_ENABLE as value */
macro_line|#ifndef PCI_DEVICE_ID_BCM4401
DECL|macro|PCI_DEVICE_ID_BCM4401
mdefine_line|#define PCI_DEVICE_ID_BCM4401      0x4401
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,0)
DECL|macro|IRQ_RETVAL
mdefine_line|#define IRQ_RETVAL(x) 
DECL|macro|irqreturn_t
mdefine_line|#define irqreturn_t void
macro_line|#endif
DECL|variable|b44_pci_tbl
r_static
r_struct
id|pci_device_id
id|b44_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_BCM4401
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
)brace
multiline_comment|/* terminate list with empty entry */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|b44_pci_tbl
)paren
suffix:semicolon
r_static
r_void
id|b44_halt
c_func
(paren
r_struct
id|b44
op_star
)paren
suffix:semicolon
r_static
r_void
id|b44_init_rings
c_func
(paren
r_struct
id|b44
op_star
)paren
suffix:semicolon
r_static
r_int
id|b44_init_hw
c_func
(paren
r_struct
id|b44
op_star
)paren
suffix:semicolon
DECL|function|b44_wait_bit
r_static
r_int
id|b44_wait_bit
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
r_int
id|reg
comma
id|u32
id|bit
comma
r_int
r_int
id|timeout
comma
r_const
r_int
id|clear
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|timeout
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
op_assign
id|br32
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clear
op_logical_and
op_logical_neg
(paren
id|val
op_amp
id|bit
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clear
op_logical_and
(paren
id|val
op_amp
id|bit
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|timeout
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: BUG!  Timeout waiting for bit %08x of register &quot;
l_string|&quot;%lx to %s.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
comma
id|bit
comma
id|reg
comma
(paren
id|clear
ques
c_cond
l_string|&quot;clear&quot;
suffix:colon
l_string|&quot;set&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Sonics SiliconBackplane support routines.  ROFL, you should see all the&n; * buzz words used on this company&squot;s website :-)&n; *&n; * All of these routines must be invoked with bp-&gt;lock held and&n; * interrupts disabled.&n; */
DECL|macro|SBID_SDRAM
mdefine_line|#define SBID_SDRAM&t;&t;0
DECL|macro|SBID_PCI_MEM
mdefine_line|#define SBID_PCI_MEM&t;&t;1
DECL|macro|SBID_PCI_CFG
mdefine_line|#define SBID_PCI_CFG&t;&t;2
DECL|macro|SBID_PCI_DMA
mdefine_line|#define SBID_PCI_DMA&t;&t;3
DECL|macro|SBID_SDRAM_SWAPPED
mdefine_line|#define&t;SBID_SDRAM_SWAPPED&t;4
DECL|macro|SBID_ENUM
mdefine_line|#define SBID_ENUM&t;&t;5
DECL|macro|SBID_REG_SDRAM
mdefine_line|#define SBID_REG_SDRAM&t;&t;6
DECL|macro|SBID_REG_ILINE20
mdefine_line|#define SBID_REG_ILINE20&t;7
DECL|macro|SBID_REG_EMAC
mdefine_line|#define SBID_REG_EMAC&t;&t;8
DECL|macro|SBID_REG_CODEC
mdefine_line|#define SBID_REG_CODEC&t;&t;9
DECL|macro|SBID_REG_USB
mdefine_line|#define SBID_REG_USB&t;&t;10
DECL|macro|SBID_REG_PCI
mdefine_line|#define SBID_REG_PCI&t;&t;11
DECL|macro|SBID_REG_MIPS
mdefine_line|#define SBID_REG_MIPS&t;&t;12
DECL|macro|SBID_REG_EXTIF
mdefine_line|#define SBID_REG_EXTIF&t;&t;13
DECL|macro|SBID_EXTIF
mdefine_line|#define&t;SBID_EXTIF&t;&t;14
DECL|macro|SBID_EJTAG
mdefine_line|#define&t;SBID_EJTAG&t;&t;15
DECL|macro|SBID_MAX
mdefine_line|#define&t;SBID_MAX&t;&t;16
DECL|function|ssb_get_addr
r_static
id|u32
id|ssb_get_addr
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
id|u32
id|id
comma
id|u32
id|instance
)paren
(brace
r_switch
c_cond
(paren
id|id
)paren
(brace
r_case
id|SBID_PCI_DMA
suffix:colon
r_return
l_int|0x40000000
suffix:semicolon
r_case
id|SBID_ENUM
suffix:colon
r_return
l_int|0x18000000
suffix:semicolon
r_case
id|SBID_REG_EMAC
suffix:colon
r_return
l_int|0x18000000
suffix:semicolon
r_case
id|SBID_REG_CODEC
suffix:colon
r_return
l_int|0x18001000
suffix:semicolon
r_case
id|SBID_REG_PCI
suffix:colon
r_return
l_int|0x18002000
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
)brace
DECL|function|ssb_get_core_rev
r_static
id|u32
id|ssb_get_core_rev
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_return
(paren
id|br32
c_func
(paren
id|B44_SBIDHIGH
)paren
op_amp
id|SBIDHIGH_RC_MASK
)paren
suffix:semicolon
)brace
DECL|function|ssb_pci_setup
r_static
id|u32
id|ssb_pci_setup
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
id|u32
id|cores
)paren
(brace
id|u32
id|bar_orig
comma
id|pci_rev
comma
id|val
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|bp-&gt;pdev
comma
id|SSB_BAR0_WIN
comma
op_amp
id|bar_orig
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|bp-&gt;pdev
comma
id|SSB_BAR0_WIN
comma
id|ssb_get_addr
c_func
(paren
id|bp
comma
id|SBID_REG_PCI
comma
l_int|0
)paren
)paren
suffix:semicolon
id|pci_rev
op_assign
id|ssb_get_core_rev
c_func
(paren
id|bp
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_SBINTVEC
)paren
suffix:semicolon
id|val
op_or_assign
id|cores
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBINTVEC
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|SSB_PCI_TRANS_2
)paren
suffix:semicolon
id|val
op_or_assign
id|SSB_PCI_PREF
op_or
id|SSB_PCI_BURST
suffix:semicolon
id|bw32
c_func
(paren
id|SSB_PCI_TRANS_2
comma
id|val
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|bp-&gt;pdev
comma
id|SSB_BAR0_WIN
comma
id|bar_orig
)paren
suffix:semicolon
r_return
id|pci_rev
suffix:semicolon
)brace
DECL|function|ssb_core_disable
r_static
r_void
id|ssb_core_disable
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_if
c_cond
(paren
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
op_amp
id|SBTMSLOW_RESET
)paren
r_return
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_REJECT
op_or
id|SBTMSLOW_CLOCK
)paren
)paren
suffix:semicolon
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_SBTMSLOW
comma
id|SBTMSLOW_REJECT
comma
l_int|100000
comma
l_int|0
)paren
suffix:semicolon
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_SBTMSHIGH
comma
id|SBTMSHIGH_BUSY
comma
l_int|100000
comma
l_int|1
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_FGC
op_or
id|SBTMSLOW_CLOCK
op_or
id|SBTMSLOW_REJECT
op_or
id|SBTMSLOW_RESET
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_REJECT
op_or
id|SBTMSLOW_RESET
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ssb_core_reset
r_static
r_void
id|ssb_core_reset
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|val
suffix:semicolon
id|ssb_core_disable
c_func
(paren
id|bp
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_RESET
op_or
id|SBTMSLOW_CLOCK
op_or
id|SBTMSLOW_FGC
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Clear SERR if set, this is a hw bug workaround.  */
r_if
c_cond
(paren
id|br32
c_func
(paren
id|B44_SBTMSHIGH
)paren
op_amp
id|SBTMSHIGH_SERR
)paren
id|bw32
c_func
(paren
id|B44_SBTMSHIGH
comma
l_int|0
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_SBIMSTATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
(paren
id|SBIMSTATE_IBE
op_or
id|SBIMSTATE_TO
)paren
)paren
id|bw32
c_func
(paren
id|B44_SBIMSTATE
comma
id|val
op_amp
op_complement
(paren
id|SBIMSTATE_IBE
op_or
id|SBIMSTATE_TO
)paren
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_CLOCK
op_or
id|SBTMSLOW_FGC
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_SBTMSLOW
comma
(paren
id|SBTMSLOW_CLOCK
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ssb_core_unit
r_static
r_int
id|ssb_core_unit
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
macro_line|#if 0
id|u32
id|val
op_assign
id|br32
c_func
(paren
id|B44_SBADMATCH0
)paren
suffix:semicolon
id|u32
id|base
suffix:semicolon
id|type
op_assign
id|val
op_amp
id|SBADMATCH0_TYPE_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|0
suffix:colon
id|base
op_assign
id|val
op_amp
id|SBADMATCH0_BS0_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|base
op_assign
id|val
op_amp
id|SBADMATCH0_BS1_MASK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_default
suffix:colon
id|base
op_assign
id|val
op_amp
id|SBADMATCH0_BS2_MASK
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ssb_is_core_up
r_static
r_int
id|ssb_is_core_up
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_return
(paren
(paren
id|br32
c_func
(paren
id|B44_SBTMSLOW
)paren
op_amp
(paren
id|SBTMSLOW_RESET
op_or
id|SBTMSLOW_REJECT
op_or
id|SBTMSLOW_CLOCK
)paren
)paren
op_eq
id|SBTMSLOW_CLOCK
)paren
suffix:semicolon
)brace
DECL|function|__b44_cam_write
r_static
r_void
id|__b44_cam_write
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
r_char
op_star
id|data
comma
r_int
id|index
)paren
(brace
id|u32
id|val
suffix:semicolon
id|val
op_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|2
)braket
)paren
op_lshift
l_int|24
suffix:semicolon
id|val
op_or_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|3
)braket
)paren
op_lshift
l_int|16
suffix:semicolon
id|val
op_or_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|4
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|val
op_or_assign
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|5
)braket
)paren
op_lshift
l_int|0
suffix:semicolon
id|bw32
c_func
(paren
id|B44_CAM_DATA_LO
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
(paren
id|CAM_DATA_HI_VALID
op_or
(paren
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|0
)braket
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
(paren
id|u32
)paren
id|data
(braket
l_int|1
)braket
)paren
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_CAM_DATA_HI
comma
id|val
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_CAM_CTRL
comma
(paren
id|CAM_CTRL_WRITE
op_or
(paren
id|index
op_lshift
id|CAM_CTRL_INDEX_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_CAM_CTRL
comma
id|CAM_CTRL_BUSY
comma
l_int|100
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|__b44_disable_ints
r_static
r_inline
r_void
id|__b44_disable_ints
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|bw32
c_func
(paren
id|B44_IMASK
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|b44_disable_ints
r_static
r_void
id|b44_disable_ints
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|__b44_disable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Flush posted writes. */
id|br32
c_func
(paren
id|B44_IMASK
)paren
suffix:semicolon
)brace
DECL|function|b44_enable_ints
r_static
r_void
id|b44_enable_ints
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|bw32
c_func
(paren
id|B44_IMASK
comma
id|bp-&gt;imask
)paren
suffix:semicolon
)brace
DECL|function|b44_readphy
r_static
r_int
id|b44_readphy
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
id|reg
comma
id|u32
op_star
id|val
)paren
(brace
r_int
id|err
suffix:semicolon
id|bw32
c_func
(paren
id|B44_EMAC_ISTAT
comma
id|EMAC_INT_MII
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MDIO_DATA
comma
(paren
id|MDIO_DATA_SB_START
op_or
(paren
id|MDIO_OP_READ
op_lshift
id|MDIO_DATA_OP_SHIFT
)paren
op_or
(paren
id|bp-&gt;phy_addr
op_lshift
id|MDIO_DATA_PMD_SHIFT
)paren
op_or
(paren
id|reg
op_lshift
id|MDIO_DATA_RA_SHIFT
)paren
op_or
(paren
id|MDIO_TA_VALID
op_lshift
id|MDIO_DATA_TA_SHIFT
)paren
)paren
)paren
suffix:semicolon
id|err
op_assign
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_EMAC_ISTAT
comma
id|EMAC_INT_MII
comma
l_int|100
comma
l_int|0
)paren
suffix:semicolon
op_star
id|val
op_assign
id|br32
c_func
(paren
id|B44_MDIO_DATA
)paren
op_amp
id|MDIO_DATA_DATA
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|b44_writephy
r_static
r_int
id|b44_writephy
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
id|reg
comma
id|u32
id|val
)paren
(brace
id|bw32
c_func
(paren
id|B44_EMAC_ISTAT
comma
id|EMAC_INT_MII
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MDIO_DATA
comma
(paren
id|MDIO_DATA_SB_START
op_or
(paren
id|MDIO_OP_WRITE
op_lshift
id|MDIO_DATA_OP_SHIFT
)paren
op_or
(paren
id|bp-&gt;phy_addr
op_lshift
id|MDIO_DATA_PMD_SHIFT
)paren
op_or
(paren
id|reg
op_lshift
id|MDIO_DATA_RA_SHIFT
)paren
op_or
(paren
id|MDIO_TA_VALID
op_lshift
id|MDIO_DATA_TA_SHIFT
)paren
op_or
(paren
id|val
op_amp
id|MDIO_DATA_DATA
)paren
)paren
)paren
suffix:semicolon
r_return
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_EMAC_ISTAT
comma
id|EMAC_INT_MII
comma
l_int|100
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|b44_phy_reset
r_static
r_int
id|b44_phy_reset
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
id|BMCR_RESET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|err
op_assign
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|BMCR_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: PHY Reset would not complete.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__b44_set_flow_ctrl
r_static
r_void
id|__b44_set_flow_ctrl
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
id|u32
id|pause_flags
)paren
(brace
id|u32
id|val
suffix:semicolon
id|bp-&gt;flags
op_and_assign
op_complement
(paren
id|B44_FLAG_TX_PAUSE
op_or
id|B44_FLAG_RX_PAUSE
)paren
suffix:semicolon
id|bp-&gt;flags
op_or_assign
id|pause_flags
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_RXCONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pause_flags
op_amp
id|B44_FLAG_RX_PAUSE
)paren
id|val
op_or_assign
id|RXCONFIG_FLOW
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
id|RXCONFIG_FLOW
suffix:semicolon
id|bw32
c_func
(paren
id|B44_RXCONFIG
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_MAC_FLOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pause_flags
op_amp
id|B44_FLAG_TX_PAUSE
)paren
id|val
op_or_assign
(paren
id|MAC_FLOW_PAUSE_ENAB
op_or
(paren
l_int|0xc0
op_amp
id|MAC_FLOW_RX_HI_WATER
)paren
)paren
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
id|MAC_FLOW_PAUSE_ENAB
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MAC_FLOW
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|b44_set_flow_ctrl
r_static
r_void
id|b44_set_flow_ctrl
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
id|u32
id|local
comma
id|u32
id|remote
)paren
(brace
id|u32
id|pause_enab
op_assign
id|bp-&gt;flags
op_amp
(paren
id|B44_FLAG_TX_PAUSE
op_or
id|B44_FLAG_RX_PAUSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|local
op_amp
id|ADVERTISE_PAUSE_CAP
)paren
(brace
r_if
c_cond
(paren
id|local
op_amp
id|ADVERTISE_PAUSE_ASYM
)paren
(brace
r_if
c_cond
(paren
id|remote
op_amp
id|LPA_PAUSE_CAP
)paren
id|pause_enab
op_or_assign
(paren
id|B44_FLAG_TX_PAUSE
op_or
id|B44_FLAG_RX_PAUSE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|remote
op_amp
id|LPA_PAUSE_ASYM
)paren
id|pause_enab
op_or_assign
id|B44_FLAG_RX_PAUSE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|remote
op_amp
id|LPA_PAUSE_CAP
)paren
id|pause_enab
op_or_assign
(paren
id|B44_FLAG_TX_PAUSE
op_or
id|B44_FLAG_RX_PAUSE
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|local
op_amp
id|ADVERTISE_PAUSE_ASYM
)paren
(brace
r_if
c_cond
(paren
(paren
id|remote
op_amp
id|LPA_PAUSE_CAP
)paren
op_logical_and
(paren
id|remote
op_amp
id|LPA_PAUSE_ASYM
)paren
)paren
id|pause_enab
op_or_assign
id|B44_FLAG_TX_PAUSE
suffix:semicolon
)brace
id|__b44_set_flow_ctrl
c_func
(paren
id|bp
comma
id|pause_enab
)paren
suffix:semicolon
)brace
DECL|function|b44_setup_phy
r_static
r_int
id|b44_setup_phy
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_readphy
c_func
(paren
id|bp
comma
id|B44_MII_ALEDCTRL
comma
op_amp
id|val
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|B44_MII_ALEDCTRL
comma
id|val
op_amp
id|MII_ALEDCTRL_ALLMSK
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_readphy
c_func
(paren
id|bp
comma
id|B44_MII_TLEDCTRL
comma
op_amp
id|val
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|B44_MII_TLEDCTRL
comma
id|val
op_or
id|MII_TLEDCTRL_ENABLE
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FORCE_LINK
)paren
)paren
(brace
id|u32
id|adv
op_assign
id|ADVERTISE_CSMA
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_10HALF
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_10FULL
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_100HALF
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_100FULL
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_PAUSE_AUTO
)paren
id|adv
op_or_assign
id|ADVERTISE_PAUSE_CAP
op_or
id|ADVERTISE_PAUSE_ASYM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|MII_ADVERTISE
comma
id|adv
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
id|u32
id|bmcr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|bmcr
op_and_assign
op_complement
(paren
id|BMCR_FULLDPLX
op_or
id|BMCR_ANENABLE
op_or
id|BMCR_SPEED100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_100_BASE_T
)paren
id|bmcr
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FULL_DUPLEX
)paren
id|bmcr
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
id|bmcr
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Since we will not be negotiating there is no safe way&n;&t;&t; * to determine if the link partner supports flow control&n;&t;&t; * or not.  So just disable it completely in this case.&n;&t;&t; */
id|b44_set_flow_ctrl
c_func
(paren
id|bp
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|b44_stats_update
r_static
r_void
id|b44_stats_update
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
id|u32
op_star
id|val
suffix:semicolon
id|val
op_assign
op_amp
id|bp-&gt;hw_stats.tx_good_octets
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
id|B44_TX_GOOD_O
suffix:semicolon
id|reg
op_le
id|B44_TX_PAUSE
suffix:semicolon
id|reg
op_add_assign
l_int|4UL
)paren
(brace
op_star
id|val
op_increment
op_add_assign
id|br32
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
id|val
op_assign
op_amp
id|bp-&gt;hw_stats.rx_good_octets
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
id|B44_RX_GOOD_O
suffix:semicolon
id|reg
op_le
id|B44_RX_NPAUSE
suffix:semicolon
id|reg
op_add_assign
l_int|4UL
)paren
(brace
op_star
id|val
op_increment
op_add_assign
id|br32
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
)brace
DECL|function|b44_link_report
r_static
r_void
id|b44_link_report
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|bp-&gt;dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;%s: Link is down.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;%s: Link is up at %d Mbps, %s duplex.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
comma
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_100_BASE_T
)paren
ques
c_cond
l_int|100
suffix:colon
l_int|10
comma
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FULL_DUPLEX
)paren
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;%s: Flow control is %s for TX and &quot;
l_string|&quot;%s for RX.&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
comma
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_TX_PAUSE
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_RX_PAUSE
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|b44_check_phy
r_static
r_void
id|b44_check_phy
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|bmsr
comma
id|aux
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
op_logical_and
op_logical_neg
id|b44_readphy
c_func
(paren
id|bp
comma
id|B44_MII_AUXCTRL
comma
op_amp
id|aux
)paren
op_logical_and
(paren
id|bmsr
op_ne
l_int|0xffff
)paren
)paren
(brace
r_if
c_cond
(paren
id|aux
op_amp
id|MII_AUXCTRL_SPEED
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_100_BASE_T
suffix:semicolon
r_else
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_100_BASE_T
suffix:semicolon
r_if
c_cond
(paren
id|aux
op_amp
id|MII_AUXCTRL_DUPLEX
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_FULL_DUPLEX
suffix:semicolon
r_else
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_FULL_DUPLEX
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|bp-&gt;dev
)paren
op_logical_and
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
)paren
(brace
id|u32
id|val
op_assign
id|br32
c_func
(paren
id|B44_TX_CTRL
)paren
suffix:semicolon
id|u32
id|local_adv
comma
id|remote_adv
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FULL_DUPLEX
)paren
id|val
op_or_assign
id|TX_CTRL_DUPLEX
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
id|TX_CTRL_DUPLEX
suffix:semicolon
id|bw32
c_func
(paren
id|B44_TX_CTRL
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FORCE_LINK
)paren
op_logical_and
op_logical_neg
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_ADVERTISE
comma
op_amp
id|local_adv
)paren
op_logical_and
op_logical_neg
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_LPA
comma
op_amp
id|remote_adv
)paren
)paren
id|b44_set_flow_ctrl
c_func
(paren
id|bp
comma
id|local_adv
comma
id|remote_adv
)paren
suffix:semicolon
multiline_comment|/* Link now up */
id|netif_carrier_on
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|b44_link_report
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|bp-&gt;dev
)paren
op_logical_and
op_logical_neg
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
)paren
(brace
multiline_comment|/* Link now down */
id|netif_carrier_off
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|b44_link_report
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmsr
op_amp
id|BMSR_RFAULT
)paren
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;%s: Remote fault detected in PHY&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmsr
op_amp
id|BMSR_JCD
)paren
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;%s: Jabber detected in PHY&bslash;n&quot;
comma
id|bp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|b44_timer
r_static
r_void
id|b44_timer
c_func
(paren
r_int
r_int
id|__opaque
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
(paren
r_struct
id|b44
op_star
)paren
id|__opaque
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_check_phy
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_stats_update
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|bp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|bp-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|b44_tx
r_static
r_void
id|b44_tx
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|cur
comma
id|cons
suffix:semicolon
id|cur
op_assign
id|br32
c_func
(paren
id|B44_DMATX_STAT
)paren
op_amp
id|DMATX_STAT_CDMASK
suffix:semicolon
id|cur
op_div_assign
r_sizeof
(paren
r_struct
id|dma_desc
)paren
suffix:semicolon
multiline_comment|/* XXX needs updating when NETIF_F_SG is supported */
r_for
c_loop
(paren
id|cons
op_assign
id|bp-&gt;tx_cons
suffix:semicolon
id|cons
op_ne
id|cur
suffix:semicolon
id|cons
op_assign
id|NEXT_TX
c_func
(paren
id|cons
)paren
)paren
(brace
r_struct
id|ring_info
op_star
id|rp
op_assign
op_amp
id|bp-&gt;tx_buffers
(braket
id|cons
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|rp-&gt;skb
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb
op_eq
l_int|NULL
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|bp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rp
comma
id|mapping
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|rp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|bp-&gt;tx_cons
op_assign
id|cons
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|bp-&gt;dev
)paren
op_logical_and
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
OG
id|B44_TX_WAKEUP_THRESH
)paren
id|netif_wake_queue
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_GPTIMER
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Works like this.  This chip writes a &squot;struct rx_header&quot; 30 bytes&n; * before the DMA address you give it.  So we allocate 30 more bytes&n; * for the RX buffer, DMA map all of it, skb_reserve the 30 bytes, then&n; * point the chip at 30 bytes past where the rx_header will go.&n; */
DECL|function|b44_alloc_rx_skb
r_static
r_int
id|b44_alloc_rx_skb
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
id|src_idx
comma
id|u32
id|dest_idx_unmasked
)paren
(brace
r_struct
id|dma_desc
op_star
id|dp
suffix:semicolon
r_struct
id|ring_info
op_star
id|src_map
comma
op_star
id|map
suffix:semicolon
r_struct
id|rx_header
op_star
id|rh
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_int
id|dest_idx
suffix:semicolon
id|u32
id|ctrl
suffix:semicolon
id|src_map
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|src_idx
op_ge
l_int|0
)paren
id|src_map
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|src_idx
)braket
suffix:semicolon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_amp
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|map
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_PKT_BUF_SZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|skb-&gt;dev
op_assign
id|bp-&gt;dev
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|bp-&gt;pdev
comma
id|skb-&gt;data
comma
id|RX_PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|bp-&gt;rx_offset
)paren
suffix:semicolon
id|rh
op_assign
(paren
r_struct
id|rx_header
op_star
)paren
(paren
id|skb-&gt;data
op_minus
id|bp-&gt;rx_offset
)paren
suffix:semicolon
id|rh-&gt;len
op_assign
l_int|0
suffix:semicolon
id|rh-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|map-&gt;skb
op_assign
id|skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
id|map
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src_map
op_ne
l_int|NULL
)paren
id|src_map-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|ctrl
op_assign
(paren
id|DESC_CTRL_LEN
op_amp
(paren
id|RX_PKT_BUF_SZ
op_minus
id|bp-&gt;rx_offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dest_idx
op_eq
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|ctrl
op_or_assign
id|DESC_CTRL_EOT
suffix:semicolon
id|dp
op_assign
op_amp
id|bp-&gt;rx_ring
(braket
id|dest_idx
)braket
suffix:semicolon
id|dp-&gt;ctrl
op_assign
id|cpu_to_le32
c_func
(paren
id|ctrl
)paren
suffix:semicolon
id|dp-&gt;addr
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|mapping
op_plus
id|bp-&gt;rx_offset
op_plus
id|bp-&gt;dma_offset
)paren
suffix:semicolon
r_return
id|RX_PKT_BUF_SZ
suffix:semicolon
)brace
DECL|function|b44_recycle_rx
r_static
r_void
id|b44_recycle_rx
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
id|src_idx
comma
id|u32
id|dest_idx_unmasked
)paren
(brace
r_struct
id|dma_desc
op_star
id|src_desc
comma
op_star
id|dest_desc
suffix:semicolon
r_struct
id|ring_info
op_star
id|src_map
comma
op_star
id|dest_map
suffix:semicolon
r_struct
id|rx_header
op_star
id|rh
suffix:semicolon
r_int
id|dest_idx
suffix:semicolon
id|u32
id|ctrl
suffix:semicolon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_amp
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|dest_desc
op_assign
op_amp
id|bp-&gt;rx_ring
(braket
id|dest_idx
)braket
suffix:semicolon
id|dest_map
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
id|src_desc
op_assign
op_amp
id|bp-&gt;rx_ring
(braket
id|src_idx
)braket
suffix:semicolon
id|src_map
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|src_idx
)braket
suffix:semicolon
id|dest_map-&gt;skb
op_assign
id|src_map-&gt;skb
suffix:semicolon
id|rh
op_assign
(paren
r_struct
id|rx_header
op_star
)paren
id|src_map-&gt;skb-&gt;data
suffix:semicolon
id|rh-&gt;len
op_assign
l_int|0
suffix:semicolon
id|rh-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
id|dest_map
comma
id|mapping
comma
id|pci_unmap_addr
c_func
(paren
id|src_map
comma
id|mapping
)paren
)paren
suffix:semicolon
id|ctrl
op_assign
id|src_desc-&gt;ctrl
suffix:semicolon
r_if
c_cond
(paren
id|dest_idx
op_eq
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|ctrl
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DESC_CTRL_EOT
)paren
suffix:semicolon
r_else
id|ctrl
op_and_assign
id|cpu_to_le32
c_func
(paren
op_complement
id|DESC_CTRL_EOT
)paren
suffix:semicolon
id|dest_desc-&gt;ctrl
op_assign
id|ctrl
suffix:semicolon
id|dest_desc-&gt;addr
op_assign
id|src_desc-&gt;addr
suffix:semicolon
id|src_map-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|b44_rx
r_static
r_int
id|b44_rx
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_int
id|budget
)paren
(brace
r_int
id|received
suffix:semicolon
id|u32
id|cons
comma
id|prod
suffix:semicolon
id|received
op_assign
l_int|0
suffix:semicolon
id|prod
op_assign
id|br32
c_func
(paren
id|B44_DMARX_STAT
)paren
op_amp
id|DMARX_STAT_CDMASK
suffix:semicolon
id|prod
op_div_assign
r_sizeof
(paren
r_struct
id|dma_desc
)paren
suffix:semicolon
id|cons
op_assign
id|bp-&gt;rx_cons
suffix:semicolon
r_while
c_loop
(paren
id|cons
op_ne
id|prod
op_logical_and
id|budget
OG
l_int|0
)paren
(brace
r_struct
id|ring_info
op_star
id|rp
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|cons
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|rp-&gt;skb
suffix:semicolon
id|dma_addr_t
id|map
op_assign
id|pci_unmap_addr
c_func
(paren
id|rp
comma
id|mapping
)paren
suffix:semicolon
r_struct
id|rx_header
op_star
id|rh
suffix:semicolon
id|u16
id|len
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|bp-&gt;pdev
comma
id|map
comma
id|RX_PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|rh
op_assign
(paren
r_struct
id|rx_header
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|len
op_assign
id|cpu_to_le16
c_func
(paren
id|rh-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
OG
(paren
id|RX_PKT_BUF_SZ
op_minus
id|bp-&gt;rx_offset
)paren
)paren
op_logical_or
(paren
id|rh-&gt;flags
op_amp
id|cpu_to_le16
c_func
(paren
id|RX_FLAG_ERRORS
)paren
)paren
)paren
(brace
id|drop_it
suffix:colon
id|b44_recycle_rx
c_func
(paren
id|bp
comma
id|cons
comma
id|bp-&gt;rx_prod
)paren
suffix:semicolon
id|drop_it_no_recycle
suffix:colon
id|bp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|udelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|len
op_assign
id|cpu_to_le16
c_func
(paren
id|rh-&gt;len
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
op_eq
l_int|0
op_logical_and
id|i
op_increment
OL
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
)brace
multiline_comment|/* Omit CRC. */
id|len
op_sub_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|RX_COPY_THRESHOLD
)paren
(brace
r_int
id|skb_size
suffix:semicolon
id|skb_size
op_assign
id|b44_alloc_rx_skb
c_func
(paren
id|bp
comma
id|cons
comma
id|bp-&gt;rx_prod
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_size
OL
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|bp-&gt;pdev
comma
id|map
comma
id|skb_size
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* Leave out rx_header */
id|skb_put
c_func
(paren
id|skb
comma
id|len
op_plus
id|bp-&gt;rx_offset
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|bp-&gt;rx_offset
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|copy_skb
suffix:semicolon
id|b44_recycle_rx
c_func
(paren
id|bp
comma
id|cons
comma
id|bp-&gt;rx_prod
)paren
suffix:semicolon
id|copy_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_skb
op_eq
l_int|NULL
)paren
r_goto
id|drop_it_no_recycle
suffix:semicolon
id|copy_skb-&gt;dev
op_assign
id|bp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|copy_skb
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|copy_skb
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* DMA sync done above, copy just the actual packet */
id|memcpy
c_func
(paren
id|copy_skb-&gt;data
comma
id|skb-&gt;data
op_plus
id|bp-&gt;rx_offset
comma
id|len
)paren
suffix:semicolon
id|skb
op_assign
id|copy_skb
suffix:semicolon
)brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|bp-&gt;dev
)paren
suffix:semicolon
id|netif_receive_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|bp-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|received
op_increment
suffix:semicolon
id|budget
op_decrement
suffix:semicolon
id|next_pkt
suffix:colon
id|bp-&gt;rx_prod
op_assign
(paren
id|bp-&gt;rx_prod
op_plus
l_int|1
)paren
op_amp
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|cons
op_assign
(paren
id|cons
op_plus
l_int|1
)paren
op_amp
(paren
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|bp-&gt;rx_cons
op_assign
id|cons
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMARX_PTR
comma
id|cons
op_star
r_sizeof
(paren
r_struct
id|dma_desc
)paren
)paren
suffix:semicolon
r_return
id|received
suffix:semicolon
)brace
DECL|function|b44_poll
r_static
r_int
id|b44_poll
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
comma
r_int
op_star
id|budget
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|netdev-&gt;priv
suffix:semicolon
r_int
id|done
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;istat
op_amp
(paren
id|ISTAT_TX
op_or
id|ISTAT_TO
)paren
)paren
(brace
multiline_comment|/* spin_lock(&amp;bp-&gt;tx_lock); */
id|b44_tx
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* spin_unlock(&amp;bp-&gt;tx_lock); */
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;istat
op_amp
id|ISTAT_RX
)paren
(brace
r_int
id|orig_budget
op_assign
op_star
id|budget
suffix:semicolon
r_int
id|work_done
suffix:semicolon
r_if
c_cond
(paren
id|orig_budget
OG
id|netdev-&gt;quota
)paren
id|orig_budget
op_assign
id|netdev-&gt;quota
suffix:semicolon
id|work_done
op_assign
id|b44_rx
c_func
(paren
id|bp
comma
id|orig_budget
)paren
suffix:semicolon
op_star
id|budget
op_sub_assign
id|work_done
suffix:semicolon
id|netdev-&gt;quota
op_sub_assign
id|work_done
suffix:semicolon
r_if
c_cond
(paren
id|work_done
op_ge
id|orig_budget
)paren
id|done
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;istat
op_amp
id|ISTAT_ERRORS
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|done
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|done
)paren
(brace
id|netif_rx_complete
c_func
(paren
id|netdev
)paren
suffix:semicolon
id|b44_enable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_return
(paren
id|done
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|b44_interrupt
r_static
id|irqreturn_t
id|b44_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|istat
comma
id|imask
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|bp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|istat
op_assign
id|br32
c_func
(paren
id|B44_ISTAT
)paren
suffix:semicolon
id|imask
op_assign
id|br32
c_func
(paren
id|B44_IMASK
)paren
suffix:semicolon
multiline_comment|/* ??? What the fuck is the purpose of the interrupt mask&n;&t; * ??? register if we have to mask it out by hand anyways?&n;&t; */
id|istat
op_and_assign
id|imask
suffix:semicolon
r_if
c_cond
(paren
id|istat
)paren
(brace
id|handled
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|netif_rx_schedule_prep
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* NOTE: These writes are posted by the readback of&n;&t;&t;&t; *       the ISTAT register below.&n;&t;&t;&t; */
id|bp-&gt;istat
op_assign
id|istat
suffix:semicolon
id|__b44_disable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
id|__netif_rx_schedule
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Error, poll already scheduled&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|bw32
c_func
(paren
id|B44_ISTAT
comma
id|istat
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_ISTAT
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|bp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
DECL|function|b44_tx_timeout
r_static
r_void
id|b44_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: transmit timed out, resetting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|b44_start_xmit
r_static
r_int
id|b44_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
id|u32
id|len
comma
id|entry
comma
id|ctrl
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* This is a hard error, log it. */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
OL
l_int|1
)paren
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: BUG! Tx Ring full when queue awake!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|entry
op_assign
id|bp-&gt;tx_prod
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|bp-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|bp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|bp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
id|ctrl
op_assign
(paren
id|len
op_amp
id|DESC_CTRL_LEN
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|DESC_CTRL_IOC
op_or
id|DESC_CTRL_SOF
op_or
id|DESC_CTRL_EOF
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
(paren
id|B44_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|ctrl
op_or_assign
id|DESC_CTRL_EOT
suffix:semicolon
id|bp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|ctrl
op_assign
id|cpu_to_le32
c_func
(paren
id|ctrl
)paren
suffix:semicolon
id|bp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|addr
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|mapping
op_plus
id|bp-&gt;dma_offset
)paren
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
id|bp-&gt;tx_prod
op_assign
id|entry
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMATX_PTR
comma
id|entry
op_star
r_sizeof
(paren
r_struct
id|dma_desc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_BUGGY_TXPTR
)paren
id|bw32
c_func
(paren
id|B44_DMATX_PTR
comma
id|entry
op_star
r_sizeof
(paren
r_struct
id|dma_desc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_REORDER_BUG
)paren
id|br32
c_func
(paren
id|B44_DMATX_PTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|bp
)paren
OL
l_int|1
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b44_change_mtu
r_static
r_int
id|b44_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
template_param
id|B44_MAX_MTU
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* We&squot;ll just catch it later when the&n;&t;&t; * device is up&squot;d.&n;&t;&t; */
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Free up pending packets in all rx/tx rings.&n; *&n; * The chip has been shut down and the driver detached from&n; * the networking, so no interrupts or new tx packets will&n; * end up in the driver.  bp-&gt;lock is not held and we are not&n; * in an interrupt context and thus may sleep.&n; */
DECL|function|b44_free_rings
r_static
r_void
id|b44_free_rings
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_struct
id|ring_info
op_star
id|rp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|B44_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rp
op_assign
op_amp
id|bp-&gt;rx_buffers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rp-&gt;skb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|bp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rp
comma
id|mapping
)paren
comma
id|RX_PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|rp-&gt;skb
)paren
suffix:semicolon
id|rp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* XXX needs changes once NETIF_F_SG is set... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|B44_TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rp
op_assign
op_amp
id|bp-&gt;tx_buffers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rp-&gt;skb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|bp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rp
comma
id|mapping
)paren
comma
id|rp-&gt;skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|rp-&gt;skb
)paren
suffix:semicolon
id|rp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize tx/rx rings for packet processing.&n; *&n; * The chip has been shut down and the driver detached from&n; * the networking, so no interrupts or new tx packets will&n; * end up in the driver.  bp-&gt;lock is not held and we are not&n; * in an interrupt context and thus may sleep.&n; */
DECL|function|b44_init_rings
r_static
r_void
id|b44_init_rings
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_int
id|i
suffix:semicolon
id|b44_free_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|memset
c_func
(paren
id|bp-&gt;rx_ring
comma
l_int|0
comma
id|B44_RX_RING_BYTES
)paren
suffix:semicolon
id|memset
c_func
(paren
id|bp-&gt;tx_ring
comma
l_int|0
comma
id|B44_TX_RING_BYTES
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bp-&gt;rx_pending
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|b44_alloc_rx_skb
c_func
(paren
id|bp
comma
op_minus
l_int|1
comma
id|i
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Must not be invoked with interrupt sources disabled and&n; * the hardware shutdown down.&n; */
DECL|function|b44_free_consistent
r_static
r_void
id|b44_free_consistent
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_if
c_cond
(paren
id|bp-&gt;rx_buffers
)paren
(brace
id|kfree
c_func
(paren
id|bp-&gt;rx_buffers
)paren
suffix:semicolon
id|bp-&gt;rx_buffers
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;tx_buffers
)paren
(brace
id|kfree
c_func
(paren
id|bp-&gt;tx_buffers
)paren
suffix:semicolon
id|bp-&gt;tx_buffers
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;rx_ring
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|bp-&gt;pdev
comma
id|DMA_TABLE_BYTES
comma
id|bp-&gt;rx_ring
comma
id|bp-&gt;rx_ring_dma
)paren
suffix:semicolon
id|bp-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bp-&gt;tx_ring
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|bp-&gt;pdev
comma
id|DMA_TABLE_BYTES
comma
id|bp-&gt;tx_ring
comma
id|bp-&gt;tx_ring_dma
)paren
suffix:semicolon
id|bp-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Must not be invoked with interrupt sources disabled and&n; * the hardware shutdown down.  Can sleep.&n; */
DECL|function|b44_alloc_consistent
r_static
r_int
id|b44_alloc_consistent
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_int
id|size
suffix:semicolon
id|size
op_assign
id|B44_RX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ring_info
)paren
suffix:semicolon
id|bp-&gt;rx_buffers
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;rx_buffers
)paren
r_goto
id|out_err
suffix:semicolon
id|memset
c_func
(paren
id|bp-&gt;rx_buffers
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
id|B44_TX_RING_SIZE
op_star
r_sizeof
(paren
r_struct
id|ring_info
)paren
suffix:semicolon
id|bp-&gt;tx_buffers
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;tx_buffers
)paren
r_goto
id|out_err
suffix:semicolon
id|memset
c_func
(paren
id|bp-&gt;tx_buffers
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
id|DMA_TABLE_BYTES
suffix:semicolon
id|bp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|bp-&gt;pdev
comma
id|size
comma
op_amp
id|bp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;rx_ring
)paren
r_goto
id|out_err
suffix:semicolon
id|bp-&gt;tx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|bp-&gt;pdev
comma
id|size
comma
op_amp
id|bp-&gt;tx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp-&gt;tx_ring
)paren
r_goto
id|out_err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_err
suffix:colon
id|b44_free_consistent
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* bp-&gt;lock is held. */
DECL|function|b44_clear_stats
r_static
r_void
id|b44_clear_stats
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MIB_CTRL
comma
id|MIB_CTRL_CLR_ON_READ
)paren
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
id|B44_TX_GOOD_O
suffix:semicolon
id|reg
op_le
id|B44_TX_PAUSE
suffix:semicolon
id|reg
op_add_assign
l_int|4UL
)paren
id|br32
c_func
(paren
id|reg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
id|B44_RX_GOOD_O
suffix:semicolon
id|reg
op_le
id|B44_RX_NPAUSE
suffix:semicolon
id|reg
op_add_assign
l_int|4UL
)paren
id|br32
c_func
(paren
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/* bp-&gt;lock is held. */
DECL|function|b44_chip_reset
r_static
r_void
id|b44_chip_reset
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
r_if
c_cond
(paren
id|ssb_is_core_up
c_func
(paren
id|bp
)paren
)paren
(brace
id|bw32
c_func
(paren
id|B44_RCV_LAZY
comma
l_int|0
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_ENET_CTRL
comma
id|ENET_CTRL_DISABLE
)paren
suffix:semicolon
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_ENET_CTRL
comma
id|ENET_CTRL_DISABLE
comma
l_int|100
comma
l_int|1
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMATX_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|bp-&gt;tx_prod
op_assign
id|bp-&gt;tx_cons
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|br32
c_func
(paren
id|B44_DMARX_STAT
)paren
op_amp
id|DMARX_STAT_EMASK
)paren
(brace
id|b44_wait_bit
c_func
(paren
id|bp
comma
id|B44_DMARX_STAT
comma
id|DMARX_STAT_SIDLE
comma
l_int|100
comma
l_int|0
)paren
suffix:semicolon
)brace
id|bw32
c_func
(paren
id|B44_DMARX_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|bp-&gt;rx_prod
op_assign
id|bp-&gt;rx_cons
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ssb_pci_setup
c_func
(paren
id|bp
comma
(paren
id|bp-&gt;core_unit
op_eq
l_int|0
ques
c_cond
id|SBINTVEC_ENET0
suffix:colon
id|SBINTVEC_ENET1
)paren
)paren
suffix:semicolon
)brace
id|ssb_core_reset
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_clear_stats
c_func
(paren
id|bp
)paren
suffix:semicolon
multiline_comment|/* Make PHY accessible. */
id|bw32
c_func
(paren
id|B44_MDIO_CTRL
comma
(paren
id|MDIO_CTRL_PREAMBLE
op_or
(paren
l_int|0x0d
op_amp
id|MDIO_CTRL_MAXF_MASK
)paren
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_MDIO_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|br32
c_func
(paren
id|B44_DEVCTRL
)paren
op_amp
id|DEVCTRL_IPP
)paren
)paren
(brace
id|bw32
c_func
(paren
id|B44_ENET_CTRL
comma
id|ENET_CTRL_EPSEL
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_ENET_CTRL
)paren
suffix:semicolon
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_INTERNAL_PHY
suffix:semicolon
)brace
r_else
(brace
id|u32
id|val
op_assign
id|br32
c_func
(paren
id|B44_DEVCTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|DEVCTRL_EPR
)paren
(brace
id|bw32
c_func
(paren
id|B44_DEVCTRL
comma
(paren
id|val
op_amp
op_complement
id|DEVCTRL_EPR
)paren
)paren
suffix:semicolon
id|br32
c_func
(paren
id|B44_DEVCTRL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_INTERNAL_PHY
suffix:semicolon
)brace
)brace
multiline_comment|/* bp-&gt;lock is held. */
DECL|function|b44_halt
r_static
r_void
id|b44_halt
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|b44_disable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_chip_reset
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
multiline_comment|/* bp-&gt;lock is held. */
DECL|function|__b44_set_mac_addr
r_static
r_void
id|__b44_set_mac_addr
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|bw32
c_func
(paren
id|B44_CAM_CTRL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
)paren
(brace
id|u32
id|val
suffix:semicolon
id|__b44_cam_write
c_func
(paren
id|bp
comma
id|bp-&gt;dev-&gt;dev_addr
comma
l_int|0
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_CAM_CTRL
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_CAM_CTRL
comma
id|val
op_or
id|CAM_CTRL_ENABLE
)paren
suffix:semicolon
)brace
)brace
DECL|function|b44_set_mac_addr
r_static
r_int
id|b44_set_mac_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|__b44_set_mac_addr
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called at device open time to get the chip ready for&n; * packet processing.  Invoked with bp-&gt;lock held.&n; */
r_static
r_void
id|__b44_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
DECL|function|b44_init_hw
r_static
r_int
id|b44_init_hw
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|val
suffix:semicolon
id|b44_disable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_chip_reset
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_phy_reset
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_setup_phy
c_func
(paren
id|bp
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_MAC_CTRL
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MAC_CTRL
comma
id|val
op_or
id|MAC_CTRL_CRC32_ENAB
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_RCV_LAZY
comma
(paren
l_int|1
op_lshift
id|RCV_LAZY_FC_SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* This sets the MAC address too.  */
id|__b44_set_rx_mode
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* MTU + eth header + possible VLAN tag + struct rx_header */
id|bw32
c_func
(paren
id|B44_RXMAXLEN
comma
id|bp-&gt;dev-&gt;mtu
op_plus
id|ETH_HLEN
op_plus
l_int|8
op_plus
id|RX_HEADER_LEN
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_TXMAXLEN
comma
id|bp-&gt;dev-&gt;mtu
op_plus
id|ETH_HLEN
op_plus
l_int|8
op_plus
id|RX_HEADER_LEN
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_TX_WMARK
comma
l_int|56
)paren
suffix:semicolon
multiline_comment|/* XXX magic */
id|bw32
c_func
(paren
id|B44_DMATX_CTRL
comma
id|DMATX_CTRL_ENABLE
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMATX_ADDR
comma
id|bp-&gt;tx_ring_dma
op_plus
id|bp-&gt;dma_offset
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMARX_CTRL
comma
(paren
id|DMARX_CTRL_ENABLE
op_or
(paren
id|bp-&gt;rx_offset
op_lshift
id|DMARX_CTRL_ROSHIFT
)paren
)paren
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMARX_ADDR
comma
id|bp-&gt;rx_ring_dma
op_plus
id|bp-&gt;dma_offset
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_DMARX_PTR
comma
id|bp-&gt;rx_pending
)paren
suffix:semicolon
id|bp-&gt;rx_prod
op_assign
id|bp-&gt;rx_pending
suffix:semicolon
id|bw32
c_func
(paren
id|B44_MIB_CTRL
comma
id|MIB_CTRL_CLR_ON_READ
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_ENET_CTRL
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_ENET_CTRL
comma
(paren
id|val
op_or
id|ENET_CTRL_ENABLE
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b44_open
r_static
r_int
id|b44_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|b44_alloc_consistent
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|b44_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_free
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|err
op_assign
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_noinit
suffix:semicolon
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_INIT_COMPLETE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|bp-&gt;timer
)paren
suffix:semicolon
id|bp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|bp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|bp
suffix:semicolon
id|bp-&gt;timer.function
op_assign
id|b44_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|bp-&gt;timer
)paren
suffix:semicolon
id|b44_enable_ints
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_noinit
suffix:colon
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_free_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|b44_free_consistent
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/*static*/
r_void
id|b44_dump_state
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u32
id|val32
comma
id|val32_2
comma
id|val32_3
comma
id|val32_4
comma
id|val32_5
suffix:semicolon
id|u16
id|val16
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|bp-&gt;pdev
comma
id|PCI_STATUS
comma
op_amp
id|val16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: PCI status [%04x] &bslash;n&quot;
comma
id|val16
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|b44_close
r_static
r_int
id|b44_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|bp-&gt;timer
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
macro_line|#if 0
id|b44_dump_state
c_func
(paren
id|bp
)paren
suffix:semicolon
macro_line|#endif
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_free_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_INIT_COMPLETE
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|b44_free_consistent
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b44_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|b44_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|nstat
op_assign
op_amp
id|bp-&gt;stats
suffix:semicolon
r_struct
id|b44_hw_stats
op_star
id|hwstat
op_assign
op_amp
id|bp-&gt;hw_stats
suffix:semicolon
multiline_comment|/* Convert HW stats into netdevice stats. */
id|nstat-&gt;rx_packets
op_assign
id|hwstat-&gt;rx_pkts
suffix:semicolon
id|nstat-&gt;tx_packets
op_assign
id|hwstat-&gt;tx_pkts
suffix:semicolon
id|nstat-&gt;rx_bytes
op_assign
id|hwstat-&gt;rx_octets
suffix:semicolon
id|nstat-&gt;tx_bytes
op_assign
id|hwstat-&gt;tx_octets
suffix:semicolon
id|nstat-&gt;tx_errors
op_assign
(paren
id|hwstat-&gt;tx_jabber_pkts
op_plus
id|hwstat-&gt;tx_oversize_pkts
op_plus
id|hwstat-&gt;tx_underruns
op_plus
id|hwstat-&gt;tx_excessive_cols
op_plus
id|hwstat-&gt;tx_late_cols
)paren
suffix:semicolon
id|nstat-&gt;multicast
op_assign
id|hwstat-&gt;tx_multicast_pkts
suffix:semicolon
id|nstat-&gt;collisions
op_assign
id|hwstat-&gt;tx_total_cols
suffix:semicolon
id|nstat-&gt;rx_length_errors
op_assign
(paren
id|hwstat-&gt;rx_oversize_pkts
op_plus
id|hwstat-&gt;rx_undersize
)paren
suffix:semicolon
id|nstat-&gt;rx_over_errors
op_assign
id|hwstat-&gt;rx_missed_pkts
suffix:semicolon
id|nstat-&gt;rx_frame_errors
op_assign
id|hwstat-&gt;rx_align_errs
suffix:semicolon
id|nstat-&gt;rx_crc_errors
op_assign
id|hwstat-&gt;rx_crc_errs
suffix:semicolon
id|nstat-&gt;rx_errors
op_assign
(paren
id|hwstat-&gt;rx_jabber_pkts
op_plus
id|hwstat-&gt;rx_oversize_pkts
op_plus
id|hwstat-&gt;rx_missed_pkts
op_plus
id|hwstat-&gt;rx_crc_align_errs
op_plus
id|hwstat-&gt;rx_undersize
op_plus
id|hwstat-&gt;rx_crc_errs
op_plus
id|hwstat-&gt;rx_align_errs
op_plus
id|hwstat-&gt;rx_symbol_errs
)paren
suffix:semicolon
id|nstat-&gt;tx_aborted_errors
op_assign
id|hwstat-&gt;tx_underruns
suffix:semicolon
id|nstat-&gt;tx_carrier_errors
op_assign
id|hwstat-&gt;tx_carrier_lost
suffix:semicolon
r_return
id|nstat
suffix:semicolon
)brace
DECL|function|__b44_load_mcast
r_static
r_void
id|__b44_load_mcast
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
comma
id|num_ents
suffix:semicolon
id|num_ents
op_assign
id|min_t
c_func
(paren
r_int
comma
id|dev-&gt;mc_count
comma
id|B44_MCAST_TABLE_SIZE
)paren
suffix:semicolon
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|num_ents
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|__b44_cam_write
c_func
(paren
id|bp
comma
id|mclist-&gt;dmi_addr
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|__b44_set_rx_mode
r_static
r_void
id|__b44_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_RXCONFIG
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
id|RXCONFIG_PROMISC
op_or
id|RXCONFIG_ALLMULTI
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|val
op_or_assign
id|RXCONFIG_PROMISC
suffix:semicolon
id|bw32
c_func
(paren
id|B44_RXCONFIG
comma
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
id|__b44_set_mac_addr
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
id|val
op_or_assign
id|RXCONFIG_ALLMULTI
suffix:semicolon
r_else
id|__b44_load_mcast
c_func
(paren
id|bp
comma
id|dev
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_RXCONFIG
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|br32
c_func
(paren
id|B44_CAM_CTRL
)paren
suffix:semicolon
id|bw32
c_func
(paren
id|B44_CAM_CTRL
comma
id|val
op_or
id|CAM_CTRL_ENABLE
)paren
suffix:semicolon
)brace
)brace
DECL|function|b44_set_rx_mode
r_static
r_void
id|b44_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|__b44_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|b44_ethtool_ioctl
r_static
r_int
id|b44_ethtool_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|useraddr
)paren
(brace
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
id|bp-&gt;pdev
suffix:semicolon
id|u32
id|ethcmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|ethcmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
(paren
id|info.driver
comma
id|DRV_MODULE_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info.version
comma
id|DRV_MODULE_VERSION
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info.fw_version
comma
l_int|0
comma
r_sizeof
(paren
id|info.fw_version
)paren
)paren
suffix:semicolon
id|strcpy
(paren
id|info.bus_info
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
id|info.eedump_len
op_assign
l_int|0
suffix:semicolon
id|info.regdump_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
op_assign
(brace
id|ETHTOOL_GSET
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_INIT_COMPLETE
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|cmd.supported
op_assign
(paren
id|SUPPORTED_Autoneg
)paren
suffix:semicolon
id|cmd.supported
op_or_assign
(paren
id|SUPPORTED_100baseT_Half
op_or
id|SUPPORTED_100baseT_Full
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_MII
)paren
suffix:semicolon
id|cmd.advertising
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_10HALF
)paren
id|cmd.advertising
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_10FULL
)paren
id|cmd.advertising
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_100HALF
)paren
id|cmd.advertising
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_ADV_100FULL
)paren
id|cmd.advertising
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|cmd.advertising
op_or_assign
id|ADVERTISE_PAUSE_CAP
op_or
id|ADVERTISE_PAUSE_ASYM
suffix:semicolon
id|cmd.speed
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_100_BASE_T
)paren
ques
c_cond
id|SPEED_100
suffix:colon
id|SPEED_10
suffix:semicolon
id|cmd.duplex
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FULL_DUPLEX
)paren
ques
c_cond
id|DUPLEX_FULL
suffix:colon
id|DUPLEX_HALF
suffix:semicolon
id|cmd.port
op_assign
l_int|0
suffix:semicolon
id|cmd.phy_address
op_assign
id|bp-&gt;phy_addr
suffix:semicolon
id|cmd.transceiver
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_INTERNAL_PHY
)paren
ques
c_cond
id|XCVR_INTERNAL
suffix:colon
id|XCVR_EXTERNAL
suffix:semicolon
id|cmd.autoneg
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_FORCE_LINK
)paren
ques
c_cond
id|AUTONEG_DISABLE
suffix:colon
id|AUTONEG_ENABLE
suffix:semicolon
id|cmd.maxtxpkt
op_assign
l_int|0
suffix:semicolon
id|cmd.maxrxpkt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_INIT_COMPLETE
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmd
comma
id|useraddr
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* We do not support gigabit. */
r_if
c_cond
(paren
id|cmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|cmd.advertising
op_amp
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|cmd.speed
op_ne
id|SPEED_100
op_logical_and
id|cmd.speed
op_ne
id|SPEED_10
)paren
op_logical_or
(paren
id|cmd.duplex
op_ne
id|DUPLEX_HALF
op_logical_and
id|cmd.duplex
op_ne
id|DUPLEX_FULL
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_FORCE_LINK
suffix:semicolon
id|bp-&gt;flags
op_and_assign
op_complement
(paren
id|B44_FLAG_ADV_10HALF
op_or
id|B44_FLAG_ADV_10FULL
op_or
id|B44_FLAG_ADV_100HALF
op_or
id|B44_FLAG_ADV_100FULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd.advertising
op_amp
id|ADVERTISE_10HALF
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_ADV_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|cmd.advertising
op_amp
id|ADVERTISE_10FULL
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_ADV_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|cmd.advertising
op_amp
id|ADVERTISE_100HALF
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_ADV_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|cmd.advertising
op_amp
id|ADVERTISE_100FULL
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_ADV_100FULL
suffix:semicolon
)brace
r_else
(brace
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_FORCE_LINK
suffix:semicolon
r_if
c_cond
(paren
id|cmd.speed
op_eq
id|SPEED_100
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_100_BASE_T
suffix:semicolon
r_if
c_cond
(paren
id|cmd.duplex
op_eq
id|DUPLEX_FULL
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_FULL_DUPLEX
suffix:semicolon
)brace
id|b44_setup_phy
c_func
(paren
id|bp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GMSGLVL
)brace
suffix:semicolon
id|edata.data
op_assign
id|bp-&gt;msg_enable
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bp-&gt;msg_enable
op_assign
id|edata.data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_NWAY_RST
suffix:colon
(brace
id|u32
id|bmcr
suffix:semicolon
r_int
id|r
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
id|b44_readphy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
id|r
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|bmcr
op_amp
id|BMCR_ANENABLE
)paren
(brace
id|b44_writephy
c_func
(paren
id|bp
comma
id|MII_BMCR
comma
id|bmcr
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|r
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|edata.data
op_assign
id|netif_carrier_ok
c_func
(paren
id|bp-&gt;dev
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GRINGPARAM
suffix:colon
(brace
r_struct
id|ethtool_ringparam
id|ering
op_assign
(brace
id|ETHTOOL_GRINGPARAM
)brace
suffix:semicolon
id|ering.rx_max_pending
op_assign
id|B44_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
id|ering.rx_pending
op_assign
id|bp-&gt;rx_pending
suffix:semicolon
multiline_comment|/* XXX ethtool lacks a tx_max_pending, oops... */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ering
comma
r_sizeof
(paren
id|ering
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SRINGPARAM
suffix:colon
(brace
r_struct
id|ethtool_ringparam
id|ering
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ering
comma
id|useraddr
comma
r_sizeof
(paren
id|ering
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ering.rx_pending
OG
id|B44_RX_RING_SIZE
op_minus
l_int|1
)paren
op_logical_or
(paren
id|ering.rx_mini_pending
op_ne
l_int|0
)paren
op_logical_or
(paren
id|ering.rx_jumbo_pending
op_ne
l_int|0
)paren
op_logical_or
(paren
id|ering.tx_pending
OG
id|B44_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|bp-&gt;rx_pending
op_assign
id|ering.rx_pending
suffix:semicolon
id|bp-&gt;tx_pending
op_assign
id|ering.tx_pending
suffix:semicolon
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|bp-&gt;dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GPAUSEPARAM
suffix:colon
(brace
r_struct
id|ethtool_pauseparam
id|epause
op_assign
(brace
id|ETHTOOL_GPAUSEPARAM
)brace
suffix:semicolon
id|epause.autoneg
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_PAUSE_AUTO
)paren
op_ne
l_int|0
suffix:semicolon
id|epause.rx_pause
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_RX_PAUSE
)paren
op_ne
l_int|0
suffix:semicolon
id|epause.tx_pause
op_assign
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_TX_PAUSE
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|epause
comma
r_sizeof
(paren
id|epause
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SPAUSEPARAM
suffix:colon
(brace
r_struct
id|ethtool_pauseparam
id|epause
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|epause
comma
id|useraddr
comma
r_sizeof
(paren
id|epause
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epause.autoneg
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_PAUSE_AUTO
suffix:semicolon
r_else
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_PAUSE_AUTO
suffix:semicolon
r_if
c_cond
(paren
id|epause.rx_pause
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_RX_PAUSE
suffix:semicolon
r_else
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_RX_PAUSE
suffix:semicolon
r_if
c_cond
(paren
id|epause.tx_pause
)paren
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_TX_PAUSE
suffix:semicolon
r_else
id|bp-&gt;flags
op_and_assign
op_complement
id|B44_FLAG_TX_PAUSE
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;flags
op_amp
id|B44_FLAG_PAUSE_AUTO
)paren
(brace
id|b44_halt
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_rings
c_func
(paren
id|bp
)paren
suffix:semicolon
id|b44_init_hw
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_else
(brace
id|__b44_set_flow_ctrl
c_func
(paren
id|bp
comma
id|bp-&gt;flags
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|b44_ioctl
r_static
r_int
id|b44_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|ifr-&gt;ifr_data
suffix:semicolon
r_struct
id|b44
op_star
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|b44_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|ifr-&gt;ifr_data
)paren
suffix:semicolon
r_case
id|SIOCGMIIPHY
suffix:colon
id|data-&gt;phy_id
op_assign
id|bp-&gt;phy_addr
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|SIOCGMIIREG
suffix:colon
(brace
id|u32
id|mii_regval
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|b44_readphy
c_func
(paren
id|bp
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
op_amp
id|mii_regval
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|data-&gt;val_out
op_assign
id|mii_regval
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_case
id|SIOCSMIIREG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|b44_writephy
c_func
(paren
id|bp
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
id|data-&gt;val_in
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* Read 128-bytes of EEPROM. */
DECL|function|b44_read_eeprom
r_static
r_int
id|b44_read_eeprom
c_func
(paren
r_struct
id|b44
op_star
id|bp
comma
id|u8
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
id|u16
op_star
id|ptr
op_assign
(paren
id|u16
op_star
)paren
id|data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|ptr
(braket
id|i
op_div
l_int|2
)braket
op_assign
id|readw
c_func
(paren
id|bp-&gt;regs
op_plus
l_int|4096
op_plus
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|b44_get_invariants
r_static
r_int
id|__devinit
id|b44_get_invariants
c_func
(paren
r_struct
id|b44
op_star
id|bp
)paren
(brace
id|u8
id|eeprom
(braket
l_int|128
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|b44_read_eeprom
c_func
(paren
id|bp
comma
op_amp
id|eeprom
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
id|eeprom
(braket
l_int|79
)braket
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
id|eeprom
(braket
l_int|78
)braket
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
id|eeprom
(braket
l_int|81
)braket
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
id|eeprom
(braket
l_int|80
)braket
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
id|eeprom
(braket
l_int|83
)braket
suffix:semicolon
id|bp-&gt;dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
id|eeprom
(braket
l_int|82
)braket
suffix:semicolon
id|bp-&gt;phy_addr
op_assign
id|eeprom
(braket
l_int|90
)braket
op_amp
l_int|0x1f
suffix:semicolon
id|bp-&gt;mdc_port
op_assign
(paren
id|eeprom
(braket
l_int|90
)braket
op_rshift
l_int|14
)paren
op_amp
l_int|0x1
suffix:semicolon
multiline_comment|/* With this, plus the rx_header prepended to the data by the&n;&t; * hardware, we&squot;ll land the ethernet header on a 2-byte boundary.&n;&t; */
id|bp-&gt;rx_offset
op_assign
l_int|30
suffix:semicolon
id|bp-&gt;imask
op_assign
id|IMASK_DEF
suffix:semicolon
id|bp-&gt;core_unit
op_assign
id|ssb_core_unit
c_func
(paren
id|bp
)paren
suffix:semicolon
id|bp-&gt;dma_offset
op_assign
id|ssb_get_addr
c_func
(paren
id|bp
comma
id|SBID_PCI_DMA
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* XXX - really required? &n;&t;   bp-&gt;flags |= B44_FLAG_BUGGY_TXPTR;&n;         */
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|b44_init_one
r_static
r_int
id|__devinit
id|b44_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|b44_version_printed
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|b44reg_base
comma
id|b44reg_len
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|b44
op_star
id|bp
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|b44_version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot enable PCI device, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot find proper PCI device &quot;
l_string|&quot;base address, aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_disable_pdev
suffix:semicolon
)brace
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_MODULE_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot obtain PCI resources, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_disable_pdev
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
(paren
id|u64
)paren
l_int|0xffffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;No usable DMA configuration, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|b44reg_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|b44reg_len
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|bp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Etherdev alloc failed, aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* No interesting netdevice features in this card... */
id|dev-&gt;features
op_or_assign
l_int|0
suffix:semicolon
id|bp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|bp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|bp-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|b44_debug
op_ge
l_int|0
)paren
id|bp-&gt;msg_enable
op_assign
(paren
l_int|1
op_lshift
id|b44_debug
)paren
op_minus
l_int|1
suffix:semicolon
r_else
id|bp-&gt;msg_enable
op_assign
id|B44_DEF_MSG_ENABLE
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|bp-&gt;lock
)paren
suffix:semicolon
id|bp-&gt;regs
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|b44reg_base
comma
id|b44reg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp-&gt;regs
op_eq
l_int|0UL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot map device registers, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_dev
suffix:semicolon
)brace
id|bp-&gt;rx_pending
op_assign
id|B44_DEF_RX_RING_PENDING
suffix:semicolon
id|bp-&gt;tx_pending
op_assign
id|B44_DEF_TX_RING_PENDING
suffix:semicolon
id|dev-&gt;open
op_assign
id|b44_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|b44_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|b44_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|b44_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|b44_set_rx_mode
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|b44_set_mac_addr
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|b44_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|b44_tx_timeout
suffix:semicolon
id|dev-&gt;poll
op_assign
id|b44_poll
suffix:semicolon
id|dev-&gt;weight
op_assign
l_int|64
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|B44_TX_TIMEOUT
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|b44_change_mtu
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|err
op_assign
id|b44_get_invariants
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Problem fetching invariants of chip, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
multiline_comment|/* By default, advertise all speed/duplex settings. */
id|bp-&gt;flags
op_or_assign
(paren
id|B44_FLAG_ADV_10HALF
op_or
id|B44_FLAG_ADV_10FULL
op_or
id|B44_FLAG_ADV_100HALF
op_or
id|B44_FLAG_ADV_100FULL
)paren
suffix:semicolon
multiline_comment|/* By default, auto-negotiate PAUSE. */
id|bp-&gt;flags
op_or_assign
id|B44_FLAG_PAUSE_AUTO
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot register net device, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|pci_save_state
c_func
(paren
id|bp-&gt;pdev
comma
id|bp-&gt;pci_cfg_state
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Broadcom 4400 10/100BaseT Ethernet &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x%c&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot;&bslash;n&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_iounmap
suffix:colon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|bp-&gt;regs
)paren
suffix:semicolon
id|err_out_free_dev
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out_free_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable_pdev
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|b44_remove_one
r_static
r_void
id|__devexit
id|b44_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
r_struct
id|b44
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|regs
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
DECL|variable|b44_driver
r_static
r_struct
id|pci_driver
id|b44_driver
op_assign
(brace
dot
id|name
op_assign
id|DRV_MODULE_NAME
comma
dot
id|id_table
op_assign
id|b44_pci_tbl
comma
dot
id|probe
op_assign
id|b44_init_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|b44_remove_one
)paren
comma
)brace
suffix:semicolon
DECL|function|b44_init
r_static
r_int
id|__init
id|b44_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|b44_driver
)paren
suffix:semicolon
)brace
DECL|function|b44_cleanup
r_static
r_void
id|__exit
id|b44_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|b44_driver
)paren
suffix:semicolon
)brace
DECL|variable|b44_init
id|module_init
c_func
(paren
id|b44_init
)paren
suffix:semicolon
DECL|variable|b44_cleanup
id|module_exit
c_func
(paren
id|b44_cleanup
)paren
suffix:semicolon
eof
