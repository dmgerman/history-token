multiline_comment|/* $Id: tg3.c,v 1.43.2.80 2002/03/14 00:10:04 davem Exp $&n; * tg3.c: Broadcom Tigon3 ethernet driver.&n; *&n; * Copyright (C) 2001, 2002 David S. Miller (davem@redhat.com)&n; * Copyright (C) 2001, 2002 Jeff Garzik (jgarzik@mandrakesoft.com)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/if_vlan.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifndef PCI_DMA_BUS_IS_PHYS
DECL|macro|PCI_DMA_BUS_IS_PHYS
mdefine_line|#define PCI_DMA_BUS_IS_PHYS 1
macro_line|#endif
multiline_comment|/* Either I can&squot;t figure out how they secretly implemented it (ie. RXD flags&n; * for mini ring, where it should go in NIC sram, and how many entries the NIC&n; * firmware expects) or it isn&squot;t really fully implemented.  Perhaps Broadcom&n; * wants people to pay for a &quot;performance enhanced&quot; version of their firmware +&n; * binary-only driver that has the mini ring actually implemented.&n; * These kids today... -DaveM&n; */
DECL|macro|TG3_MINI_RING_WORKS
mdefine_line|#define TG3_MINI_RING_WORKS 0
macro_line|#if defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE)
DECL|macro|TG3_VLAN_TAG_USED
mdefine_line|#define TG3_VLAN_TAG_USED 1
macro_line|#else
DECL|macro|TG3_VLAN_TAG_USED
mdefine_line|#define TG3_VLAN_TAG_USED 0
macro_line|#endif
macro_line|#include &quot;tg3.h&quot;
DECL|macro|DRV_MODULE_NAME
mdefine_line|#define DRV_MODULE_NAME&t;&t;&quot;tg3&quot;
DECL|macro|PFX
mdefine_line|#define PFX DRV_MODULE_NAME&t;&quot;: &quot;
DECL|macro|DRV_MODULE_VERSION
mdefine_line|#define DRV_MODULE_VERSION&t;&quot;0.99&quot;
DECL|macro|DRV_MODULE_RELDATE
mdefine_line|#define DRV_MODULE_RELDATE&t;&quot;Jun 11, 2002&quot;
DECL|macro|TG3_DEF_MAC_MODE
mdefine_line|#define TG3_DEF_MAC_MODE&t;0
DECL|macro|TG3_DEF_RX_MODE
mdefine_line|#define TG3_DEF_RX_MODE&t;&t;0
DECL|macro|TG3_DEF_TX_MODE
mdefine_line|#define TG3_DEF_TX_MODE&t;&t;0
DECL|macro|TG3_DEF_MSG_ENABLE
mdefine_line|#define TG3_DEF_MSG_ENABLE&t;  &bslash;&n;&t;(NETIF_MSG_DRV&t;&t;| &bslash;&n;&t; NETIF_MSG_PROBE&t;| &bslash;&n;&t; NETIF_MSG_LINK&t;&t;| &bslash;&n;&t; NETIF_MSG_TIMER&t;| &bslash;&n;&t; NETIF_MSG_IFDOWN&t;| &bslash;&n;&t; NETIF_MSG_IFUP&t;&t;| &bslash;&n;&t; NETIF_MSG_RX_ERR&t;| &bslash;&n;&t; NETIF_MSG_TX_ERR)
multiline_comment|/* length of time before we decide the hardware is borked,&n; * and dev-&gt;tx_timeout() should be called to fix the problem&n; */
DECL|macro|TG3_TX_TIMEOUT
mdefine_line|#define TG3_TX_TIMEOUT&t;&t;&t;(5 * HZ)
multiline_comment|/* hardware minimum and maximum for a single frame&squot;s data payload */
DECL|macro|TG3_MIN_MTU
mdefine_line|#define TG3_MIN_MTU&t;&t;&t;60
DECL|macro|TG3_MAX_MTU
mdefine_line|#define TG3_MAX_MTU&t;&t;&t;9000
multiline_comment|/* These numbers seem to be hard coded in the NIC firmware somehow.&n; * You can&squot;t change the ring sizes, but you can change where you place&n; * them in the NIC onboard memory.&n; */
DECL|macro|TG3_RX_RING_SIZE
mdefine_line|#define TG3_RX_RING_SIZE&t;&t;512
DECL|macro|TG3_DEF_RX_RING_PENDING
mdefine_line|#define TG3_DEF_RX_RING_PENDING&t;&t;200
macro_line|#if TG3_MINI_RING_WORKS
DECL|macro|TG3_RX_MINI_RING_SIZE
mdefine_line|#define TG3_RX_MINI_RING_SIZE&t;&t;256 /* ??? */
DECL|macro|TG3_DEF_RX_MINI_RING_PENDING
mdefine_line|#define TG3_DEF_RX_MINI_RING_PENDING&t;100
macro_line|#endif
DECL|macro|TG3_RX_JUMBO_RING_SIZE
mdefine_line|#define TG3_RX_JUMBO_RING_SIZE&t;&t;256
DECL|macro|TG3_DEF_RX_JUMBO_RING_PENDING
mdefine_line|#define TG3_DEF_RX_JUMBO_RING_PENDING&t;100
DECL|macro|TG3_RX_RCB_RING_SIZE
mdefine_line|#define TG3_RX_RCB_RING_SIZE&t;&t;1024
DECL|macro|TG3_TX_RING_SIZE
mdefine_line|#define TG3_TX_RING_SIZE&t;&t;512
DECL|macro|TG3_DEF_TX_RING_PENDING
mdefine_line|#define TG3_DEF_TX_RING_PENDING&t;&t;(TG3_TX_RING_SIZE - 1)
DECL|macro|TG3_RX_RING_BYTES
mdefine_line|#define TG3_RX_RING_BYTES&t;(sizeof(struct tg3_rx_buffer_desc) * &bslash;&n;&t;&t;&t;&t; TG3_RX_RING_SIZE)
macro_line|#if TG3_MINI_RING_WORKS
DECL|macro|TG3_RX_MINI_RING_BYTES
mdefine_line|#define TG3_RX_MINI_RING_BYTES&t;(sizeof(struct tg3_rx_buffer_desc) * &bslash;&n;&t;&t;&t;&t; TG3_RX_MINI_RING_SIZE)
macro_line|#endif
DECL|macro|TG3_RX_JUMBO_RING_BYTES
mdefine_line|#define TG3_RX_JUMBO_RING_BYTES&t;(sizeof(struct tg3_rx_buffer_desc) * &bslash;&n;&t;&t;&t;         TG3_RX_JUMBO_RING_SIZE)
DECL|macro|TG3_RX_RCB_RING_BYTES
mdefine_line|#define TG3_RX_RCB_RING_BYTES&t;(sizeof(struct tg3_rx_buffer_desc) * &bslash;&n;&t;&t;&t;         TG3_RX_RCB_RING_SIZE)
DECL|macro|TG3_TX_RING_BYTES
mdefine_line|#define TG3_TX_RING_BYTES&t;(sizeof(struct tg3_tx_buffer_desc) * &bslash;&n;&t;&t;&t;&t; TG3_TX_RING_SIZE)
DECL|macro|TX_RING_GAP
mdefine_line|#define TX_RING_GAP(TP)&t;&bslash;&n;&t;(TG3_TX_RING_SIZE - (TP)-&gt;tx_pending)
DECL|macro|TX_BUFFS_AVAIL
mdefine_line|#define TX_BUFFS_AVAIL(TP)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;(((TP)-&gt;tx_cons &lt;= (TP)-&gt;tx_prod) ?&t;&t;&t;&t;&bslash;&n;&t;  (TP)-&gt;tx_cons + (TP)-&gt;tx_pending - (TP)-&gt;tx_prod :&t;&t;&bslash;&n;&t;  (TP)-&gt;tx_cons - (TP)-&gt;tx_prod - TX_RING_GAP(TP))
DECL|macro|NEXT_TX
mdefine_line|#define NEXT_TX(N)&t;&t;(((N) + 1) &amp; (TG3_TX_RING_SIZE - 1))
DECL|macro|RX_PKT_BUF_SZ
mdefine_line|#define RX_PKT_BUF_SZ&t;&t;(1536 + tp-&gt;rx_offset + 64)
macro_line|#if TG3_MINI_RING_WORKS
DECL|macro|RX_MINI_PKT_BUF_SZ
mdefine_line|#define RX_MINI_PKT_BUF_SZ&t;(256 + tp-&gt;rx_offset + 64)
macro_line|#endif
DECL|macro|RX_JUMBO_PKT_BUF_SZ
mdefine_line|#define RX_JUMBO_PKT_BUF_SZ&t;(9046 + tp-&gt;rx_offset + 64)
multiline_comment|/* minimum number of free TX descriptors required to wake up TX process */
DECL|macro|TG3_TX_WAKEUP_THRESH
mdefine_line|#define TG3_TX_WAKEUP_THRESH&t;&t;(TG3_TX_RING_SIZE / 4)
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|DRV_MODULE_NAME
l_string|&quot;.c:v&quot;
id|DRV_MODULE_VERSION
l_string|&quot; (&quot;
id|DRV_MODULE_RELDATE
l_string|&quot;)&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;David S. Miller (davem@redhat.com) and Jeff Garzik (jgarzik@mandrakesoft.com)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Broadcom Tigon3 ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tg3_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tg3_debug
comma
l_string|&quot;Tigon3 bitmapped debugging message enable value&quot;
)paren
suffix:semicolon
DECL|variable|tg3_debug
r_static
r_int
id|tg3_debug
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* -1 == use TG3_DEF_MSG_ENABLE as value */
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|tg3_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5700
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5701
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5702
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5703
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5702FE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5702X
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_BROADCOM
comma
id|PCI_DEVICE_ID_TIGON3_5703X
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_SYSKONNECT
comma
l_int|0x4400
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_ALTIMA
comma
id|PCI_DEVICE_ID_ALTIMA_AC1000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
id|PCI_VENDOR_ID_ALTIMA
comma
id|PCI_DEVICE_ID_ALTIMA_AC9100
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0UL
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|tg3_pci_tbl
)paren
suffix:semicolon
DECL|function|tg3_write_indirect_reg32
r_static
r_void
id|tg3_write_indirect_reg32
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|off
comma
id|u32
id|val
)paren
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_TARGET_HWBUG
)paren
op_ne
l_int|0
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_REG_BASE_ADDR
comma
id|off
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_REG_DATA
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|writel
c_func
(paren
id|val
comma
id|tp-&gt;regs
op_plus
id|off
)paren
suffix:semicolon
)brace
)brace
DECL|macro|tw32
mdefine_line|#define tw32(reg,val)&t;&t;tg3_write_indirect_reg32(tp,(reg),(val))
DECL|macro|tw32_mailbox
mdefine_line|#define tw32_mailbox(reg, val)&t;writel(((val) &amp; 0xffffffff), tp-&gt;regs + (reg))
DECL|macro|tw16
mdefine_line|#define tw16(reg,val)&t;&t;writew(((val) &amp; 0xffff), tp-&gt;regs + (reg))
DECL|macro|tw8
mdefine_line|#define tw8(reg,val)&t;&t;writeb(((val) &amp; 0xff), tp-&gt;regs + (reg))
DECL|macro|tr32
mdefine_line|#define tr32(reg)&t;&t;readl(tp-&gt;regs + (reg))
DECL|macro|tr16
mdefine_line|#define tr16(reg)&t;&t;readw(tp-&gt;regs + (reg))
DECL|macro|tr8
mdefine_line|#define tr8(reg)&t;&t;readb(tp-&gt;regs + (reg))
DECL|function|tg3_write_mem
r_static
r_void
id|tg3_write_mem
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|off
comma
id|u32
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
id|off
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_DATA
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* Always leave this as zero. */
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|tg3_read_mem
r_static
r_void
id|tg3_read_mem
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|off
comma
id|u32
op_star
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
id|off
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_DATA
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* Always leave this as zero. */
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|tg3_disable_ints
r_static
r_void
id|tg3_disable_ints
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tw32
c_func
(paren
id|TG3PCI_MISC_HOST_CTRL
comma
(paren
id|tp-&gt;misc_host_ctrl
op_or
id|MISC_HOST_CTRL_MASK_PCI_INT
)paren
)paren
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0x00000001
)paren
suffix:semicolon
)brace
DECL|function|tg3_enable_ints
r_static
r_void
id|tg3_enable_ints
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tw32
c_func
(paren
id|TG3PCI_MISC_HOST_CTRL
comma
(paren
id|tp-&gt;misc_host_ctrl
op_amp
op_complement
id|MISC_HOST_CTRL_MASK_PCI_INT
)paren
)paren
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0x00000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;hw_status-&gt;status
op_amp
id|SD_STATUS_UPDATED
)paren
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
id|tp-&gt;grc_local_ctrl
op_or
id|GRC_LCLCTRL_SETINT
)paren
suffix:semicolon
)brace
DECL|macro|PHY_BUSY_LOOPS
mdefine_line|#define PHY_BUSY_LOOPS&t;5000
DECL|function|tg3_readphy
r_static
r_int
id|tg3_readphy
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|reg
comma
id|u32
op_star
id|val
)paren
(brace
id|u32
id|frame_val
suffix:semicolon
r_int
id|loops
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;mi_mode
op_amp
id|MAC_MI_MODE_AUTO_POLL
)paren
op_ne
l_int|0
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
(paren
id|tp-&gt;mi_mode
op_amp
op_complement
id|MAC_MI_MODE_AUTO_POLL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
op_star
id|val
op_assign
l_int|0xffffffff
suffix:semicolon
id|frame_val
op_assign
(paren
(paren
id|PHY_ADDR
op_lshift
id|MI_COM_PHY_ADDR_SHIFT
)paren
op_amp
id|MI_COM_PHY_ADDR_MASK
)paren
suffix:semicolon
id|frame_val
op_or_assign
(paren
(paren
id|reg
op_lshift
id|MI_COM_REG_ADDR_SHIFT
)paren
op_amp
id|MI_COM_REG_ADDR_MASK
)paren
suffix:semicolon
id|frame_val
op_or_assign
(paren
id|MI_COM_CMD_READ
op_or
id|MI_COM_START
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_COM
comma
id|frame_val
)paren
suffix:semicolon
id|loops
op_assign
id|PHY_BUSY_LOOPS
suffix:semicolon
r_while
c_loop
(paren
id|loops
op_decrement
OG
l_int|0
)paren
(brace
id|frame_val
op_assign
id|tr32
c_func
(paren
id|MAC_MI_COM
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frame_val
op_amp
id|MI_COM_BUSY
)paren
op_eq
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|frame_val
op_assign
id|tr32
c_func
(paren
id|MAC_MI_COM
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|loops
OG
l_int|0
)paren
(brace
op_star
id|val
op_assign
id|frame_val
op_amp
id|MI_COM_DATA_MASK
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;mi_mode
op_amp
id|MAC_MI_MODE_AUTO_POLL
)paren
op_ne
l_int|0
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|tg3_writephy
r_static
r_int
id|tg3_writephy
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|reg
comma
id|u32
id|val
)paren
(brace
id|u32
id|frame_val
suffix:semicolon
r_int
id|loops
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;mi_mode
op_amp
id|MAC_MI_MODE_AUTO_POLL
)paren
op_ne
l_int|0
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
(paren
id|tp-&gt;mi_mode
op_amp
op_complement
id|MAC_MI_MODE_AUTO_POLL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
id|frame_val
op_assign
(paren
(paren
id|PHY_ADDR
op_lshift
id|MI_COM_PHY_ADDR_SHIFT
)paren
op_amp
id|MI_COM_PHY_ADDR_MASK
)paren
suffix:semicolon
id|frame_val
op_or_assign
(paren
(paren
id|reg
op_lshift
id|MI_COM_REG_ADDR_SHIFT
)paren
op_amp
id|MI_COM_REG_ADDR_MASK
)paren
suffix:semicolon
id|frame_val
op_or_assign
(paren
id|val
op_amp
id|MI_COM_DATA_MASK
)paren
suffix:semicolon
id|frame_val
op_or_assign
(paren
id|MI_COM_CMD_WRITE
op_or
id|MI_COM_START
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_COM
comma
id|frame_val
)paren
suffix:semicolon
id|loops
op_assign
id|PHY_BUSY_LOOPS
suffix:semicolon
r_while
c_loop
(paren
id|loops
op_decrement
OG
l_int|0
)paren
(brace
id|frame_val
op_assign
id|tr32
c_func
(paren
id|MAC_MI_COM
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frame_val
op_amp
id|MI_COM_BUSY
)paren
op_eq
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|frame_val
op_assign
id|tr32
c_func
(paren
id|MAC_MI_COM
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|loops
OG
l_int|0
)paren
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;mi_mode
op_amp
id|MAC_MI_MODE_AUTO_POLL
)paren
op_ne
l_int|0
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* This will reset the tigon3 PHY if there is no valid&n; * link unless the FORCE argument is non-zero.&n; */
DECL|function|tg3_phy_reset
r_static
r_int
id|tg3_phy_reset
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|force
)paren
(brace
id|u32
id|phy_status
comma
id|phy_control
suffix:semicolon
r_int
id|err
comma
id|limit
suffix:semicolon
id|err
op_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|phy_status
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|phy_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* If we have link, and not forcing a reset, then nothing&n;&t; * to do.&n;&t; */
r_if
c_cond
(paren
(paren
id|phy_status
op_amp
id|BMSR_LSTATUS
)paren
op_ne
l_int|0
op_logical_and
(paren
id|force
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* OK, reset it, and poll the BMCR_RESET bit until it&n;&t; * clears or we time out.&n;&t; */
id|phy_control
op_assign
id|BMCR_RESET
suffix:semicolon
id|err
op_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|phy_control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|limit
op_assign
l_int|5000
suffix:semicolon
r_while
c_loop
(paren
id|limit
op_decrement
)paren
(brace
id|err
op_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|phy_control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|phy_control
op_amp
id|BMCR_RESET
)paren
op_eq
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_static
r_int
id|tg3_setup_phy
c_func
(paren
r_struct
id|tg3
op_star
)paren
suffix:semicolon
r_static
r_int
id|tg3_halt
c_func
(paren
r_struct
id|tg3
op_star
)paren
suffix:semicolon
DECL|function|tg3_set_power_state
r_static
r_int
id|tg3_set_power_state
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|state
)paren
(brace
id|u32
id|misc_host_ctrl
suffix:semicolon
id|u16
id|power_control
comma
id|power_caps
suffix:semicolon
r_int
id|pm
op_assign
id|tp-&gt;pm_cap
suffix:semicolon
multiline_comment|/* Make sure register accesses (indirect or otherwise)&n;&t; * will function correctly.&n;&t; */
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MISC_HOST_CTRL
comma
id|tp-&gt;misc_host_ctrl
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|pm
op_plus
id|PCI_PM_CTRL
comma
op_amp
id|power_control
)paren
suffix:semicolon
id|power_control
op_or_assign
id|PCI_PM_CTRL_PME_STATUS
suffix:semicolon
id|power_control
op_and_assign
op_complement
(paren
id|PCI_PM_CTRL_STATE_MASK
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
l_int|0
suffix:colon
id|power_control
op_or_assign
l_int|0
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|pm
op_plus
id|PCI_PM_CTRL
comma
id|power_control
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
id|tp-&gt;grc_local_ctrl
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_CTRL
comma
l_int|0x02
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|1
suffix:colon
id|power_control
op_or_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|power_control
op_or_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|power_control
op_or_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid power state (%d) requested.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
id|state
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
id|power_control
op_or_assign
id|PCI_PM_CTRL_PME_ENABLE
suffix:semicolon
id|misc_host_ctrl
op_assign
id|tr32
c_func
(paren
id|TG3PCI_MISC_HOST_CTRL
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_MISC_HOST_CTRL
comma
id|misc_host_ctrl
op_or
id|MISC_HOST_CTRL_MASK_PCI_INT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.phy_is_low_power
op_eq
l_int|0
)paren
(brace
id|tp-&gt;link_config.phy_is_low_power
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;link_config.orig_speed
op_assign
id|tp-&gt;link_config.speed
suffix:semicolon
id|tp-&gt;link_config.orig_duplex
op_assign
id|tp-&gt;link_config.duplex
suffix:semicolon
id|tp-&gt;link_config.orig_autoneg
op_assign
id|tp-&gt;link_config.autoneg
suffix:semicolon
)brace
id|tp-&gt;link_config.speed
op_assign
id|SPEED_10
suffix:semicolon
id|tp-&gt;link_config.autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|pm
op_plus
id|PCI_PM_PMC
comma
op_amp
id|power_caps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_ENABLE
)paren
(brace
id|u32
id|mac_mode
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_CTRL
comma
l_int|0x5a
)paren
suffix:semicolon
id|mac_mode
op_assign
id|MAC_MODE_PORT_MODE_MII
op_or
id|MAC_MODE_LINK_POLARITY
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|power_caps
op_amp
id|PCI_PM_CAP_PME_D3cold
)paren
op_logical_and
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_ENABLE
)paren
)paren
)paren
id|mac_mode
op_or_assign
id|MAC_MODE_MAGIC_PKT_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|mac_mode
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RX_MODE
comma
id|RX_MODE_ENABLE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_SPEED_100MB
)paren
(brace
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
(paren
id|CLOCK_CTRL_RXCLK_DISABLE
op_or
id|CLOCK_CTRL_TXCLK_DISABLE
op_or
id|CLOCK_CTRL_ALTCLK
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
(paren
id|CLOCK_CTRL_RXCLK_DISABLE
op_or
id|CLOCK_CTRL_TXCLK_DISABLE
op_or
id|CLOCK_CTRL_44MHZ_CORE
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
(paren
id|CLOCK_CTRL_RXCLK_DISABLE
op_or
id|CLOCK_CTRL_TXCLK_DISABLE
op_or
id|CLOCK_CTRL_ALTCLK
op_or
id|CLOCK_CTRL_44MHZ_CORE
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
(paren
id|CLOCK_CTRL_RXCLK_DISABLE
op_or
id|CLOCK_CTRL_TXCLK_DISABLE
op_or
id|CLOCK_CTRL_ALTCLK
op_or
id|CLOCK_CTRL_PWRDOWN_PLL133
)paren
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|power_caps
op_amp
id|PCI_PM_CAP_PME_D3cold
)paren
op_logical_and
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_ENABLE
)paren
)paren
(brace
multiline_comment|/* Move to auxilliary power. */
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
(paren
id|GRC_LCLCTRL_GPIO_OE0
op_or
id|GRC_LCLCTRL_GPIO_OE1
op_or
id|GRC_LCLCTRL_GPIO_OE2
op_or
id|GRC_LCLCTRL_GPIO_OUTPUT0
op_or
id|GRC_LCLCTRL_GPIO_OUTPUT1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Finally, set the new power state. */
id|pci_write_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|pm
op_plus
id|PCI_PM_CTRL
comma
id|power_control
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_link_report
r_static
r_void
id|tg3_link_report
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Link is down.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Link is up at %d Mbps, %s duplex.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
(paren
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_1000
ques
c_cond
l_int|1000
suffix:colon
(paren
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_100
ques
c_cond
l_int|100
suffix:colon
l_int|10
)paren
)paren
comma
(paren
id|tp-&gt;link_config.active_duplex
op_eq
id|DUPLEX_FULL
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Flow control is %s for TX and %s for RX.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TX_PAUSE
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_RX_PAUSE
)paren
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|tg3_setup_flow_control
r_static
r_void
id|tg3_setup_flow_control
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|local_adv
comma
id|u32
id|remote_adv
)paren
(brace
id|u32
id|new_tg3_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|local_adv
op_amp
id|ADVERTISE_PAUSE_CAP
)paren
(brace
r_if
c_cond
(paren
id|local_adv
op_amp
id|ADVERTISE_PAUSE_ASYM
)paren
(brace
r_if
c_cond
(paren
id|remote_adv
op_amp
id|LPA_PAUSE_CAP
)paren
id|new_tg3_flags
op_or_assign
(paren
id|TG3_FLAG_RX_PAUSE
op_or
id|TG3_FLAG_TX_PAUSE
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|remote_adv
op_amp
id|LPA_PAUSE_ASYM
)paren
id|new_tg3_flags
op_or_assign
(paren
id|TG3_FLAG_RX_PAUSE
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|remote_adv
op_amp
id|LPA_PAUSE_CAP
)paren
id|new_tg3_flags
op_or_assign
(paren
id|TG3_FLAG_RX_PAUSE
op_or
id|TG3_FLAG_TX_PAUSE
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|local_adv
op_amp
id|ADVERTISE_PAUSE_ASYM
)paren
(brace
r_if
c_cond
(paren
(paren
id|remote_adv
op_amp
id|LPA_PAUSE_CAP
)paren
op_logical_and
(paren
id|remote_adv
op_amp
id|LPA_PAUSE_ASYM
)paren
)paren
id|new_tg3_flags
op_or_assign
id|TG3_FLAG_TX_PAUSE
suffix:semicolon
)brace
id|tp-&gt;tg3_flags
op_and_assign
op_complement
(paren
id|TG3_FLAG_RX_PAUSE
op_or
id|TG3_FLAG_TX_PAUSE
)paren
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|new_tg3_flags
suffix:semicolon
r_if
c_cond
(paren
id|new_tg3_flags
op_amp
id|TG3_FLAG_RX_PAUSE
)paren
id|tp-&gt;rx_mode
op_or_assign
id|RX_MODE_FLOW_CTRL_ENABLE
suffix:semicolon
r_else
id|tp-&gt;rx_mode
op_and_assign
op_complement
id|RX_MODE_FLOW_CTRL_ENABLE
suffix:semicolon
r_if
c_cond
(paren
id|new_tg3_flags
op_amp
id|TG3_FLAG_TX_PAUSE
)paren
id|tp-&gt;tx_mode
op_or_assign
id|TX_MODE_FLOW_CTRL_ENABLE
suffix:semicolon
r_else
id|tp-&gt;tx_mode
op_and_assign
op_complement
id|TX_MODE_FLOW_CTRL_ENABLE
suffix:semicolon
)brace
DECL|function|tg3_aux_stat_to_speed_duplex
r_static
r_void
id|tg3_aux_stat_to_speed_duplex
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|val
comma
id|u16
op_star
id|speed
comma
id|u8
op_star
id|duplex
)paren
(brace
r_switch
c_cond
(paren
id|val
op_amp
id|MII_TG3_AUX_STAT_SPDMASK
)paren
(brace
r_case
id|MII_TG3_AUX_STAT_10HALF
suffix:colon
op_star
id|speed
op_assign
id|SPEED_10
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_TG3_AUX_STAT_10FULL
suffix:colon
op_star
id|speed
op_assign
id|SPEED_10
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_TG3_AUX_STAT_100HALF
suffix:colon
op_star
id|speed
op_assign
id|SPEED_100
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_TG3_AUX_STAT_100FULL
suffix:colon
op_star
id|speed
op_assign
id|SPEED_100
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_TG3_AUX_STAT_1000HALF
suffix:colon
op_star
id|speed
op_assign
id|SPEED_1000
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_TG3_AUX_STAT_1000FULL
suffix:colon
op_star
id|speed
op_assign
id|SPEED_1000
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
op_star
id|speed
op_assign
id|SPEED_INVALID
suffix:semicolon
op_star
id|duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
)brace
DECL|function|tg3_phy_copper_begin
r_static
r_int
id|tg3_phy_copper_begin
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|wait_for_link
)paren
(brace
id|u32
id|new_adv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.phy_is_low_power
)paren
(brace
multiline_comment|/* Entering low power mode.  Disable gigabit and&n;&t;&t; * 100baseT advertisements.&n;&t;&t; */
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|new_adv
op_assign
(paren
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_CSMA
op_or
id|ADVERTISE_PAUSE_CAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_SPEED_100MB
)paren
id|new_adv
op_or_assign
(paren
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
id|new_adv
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;link_config.speed
op_eq
id|SPEED_INVALID
)paren
(brace
id|tp-&gt;link_config.advertising
op_assign
(paren
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_100baseT_Half
op_or
id|ADVERTISED_100baseT_Full
op_or
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
op_or
id|ADVERTISED_Autoneg
op_or
id|ADVERTISED_MII
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
id|tp-&gt;link_config.advertising
op_and_assign
op_complement
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
)paren
suffix:semicolon
id|new_adv
op_assign
(paren
id|ADVERTISE_CSMA
op_or
id|ADVERTISE_PAUSE_CAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|new_adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|new_adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|new_adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|new_adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
id|new_adv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
)paren
)paren
(brace
id|new_adv
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_1000baseT_Half
)paren
id|new_adv
op_or_assign
id|MII_TG3_CTRL_ADV_1000_HALF
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.advertising
op_amp
id|ADVERTISED_1000baseT_Full
)paren
id|new_adv
op_or_assign
id|MII_TG3_CTRL_ADV_1000_FULL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B0
)paren
id|new_adv
op_or_assign
(paren
id|MII_TG3_CTRL_AS_MASTER
op_or
id|MII_TG3_CTRL_ENABLE_AS_MASTER
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
id|new_adv
)paren
suffix:semicolon
)brace
r_else
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Asking for a specific link mode. */
r_if
c_cond
(paren
id|tp-&gt;link_config.speed
op_eq
id|SPEED_1000
)paren
(brace
id|new_adv
op_assign
id|ADVERTISE_CSMA
op_or
id|ADVERTISE_PAUSE_CAP
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
id|new_adv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
id|new_adv
op_assign
id|MII_TG3_CTRL_ADV_1000_FULL
suffix:semicolon
r_else
id|new_adv
op_assign
id|MII_TG3_CTRL_ADV_1000_HALF
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B0
)paren
id|new_adv
op_or_assign
(paren
id|MII_TG3_CTRL_AS_MASTER
op_or
id|MII_TG3_CTRL_ENABLE_AS_MASTER
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
id|new_adv
)paren
suffix:semicolon
)brace
r_else
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|new_adv
op_assign
id|ADVERTISE_CSMA
op_or
id|ADVERTISE_PAUSE_CAP
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.speed
op_eq
id|SPEED_100
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
id|new_adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
r_else
id|new_adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
id|new_adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_else
id|new_adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
)brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
id|new_adv
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tp-&gt;link_config.autoneg
op_eq
id|AUTONEG_DISABLE
op_logical_and
id|tp-&gt;link_config.speed
op_ne
id|SPEED_INVALID
)paren
(brace
id|u32
id|bmcr
comma
id|orig_bmcr
suffix:semicolon
id|tp-&gt;link_config.active_speed
op_assign
id|tp-&gt;link_config.speed
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|tp-&gt;link_config.duplex
suffix:semicolon
id|bmcr
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|tp-&gt;link_config.speed
)paren
(brace
r_default
suffix:colon
r_case
id|SPEED_10
suffix:colon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
id|bmcr
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_1000
suffix:colon
id|bmcr
op_or_assign
id|TG3_BMCR_SPEED1000
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.duplex
op_eq
id|DUPLEX_FULL
)paren
id|bmcr
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|orig_bmcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmcr
op_ne
id|orig_bmcr
)paren
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|BMCR_LOOPBACK
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|15000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|BMSR_LSTATUS
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|bmcr
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wait_for_link
)paren
(brace
id|tp-&gt;link_config.active_speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|300000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|BMSR_LSTATUS
)paren
)paren
r_continue
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_STAT
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tg3_aux_stat_to_speed_duplex
c_func
(paren
id|tp
comma
id|tmp
comma
op_amp
id|tp-&gt;link_config.active_speed
comma
op_amp
id|tp-&gt;link_config.active_duplex
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_INVALID
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_init_5401phy_dsp
r_static
r_int
id|tg3_init_5401phy_dsp
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* Turn off tap power management. */
id|err
op_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_CTRL
comma
l_int|0x0c20
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x0012
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x1804
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x0013
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x1204
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x8006
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x0132
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x8006
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x0232
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x201f
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x0a20
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_setup_copper_phy
r_static
r_int
id|tg3_setup_copper_phy
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|current_link_up
suffix:semicolon
id|u32
id|bmsr
comma
id|dummy
suffix:semicolon
id|u16
id|current_speed
suffix:semicolon
id|u8
id|current_duplex
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_STATUS
comma
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
suffix:semicolon
id|tp-&gt;mi_mode
op_assign
id|MAC_MI_MODE_BASE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;phy_id
op_amp
id|PHY_ID_MASK
)paren
op_eq
id|PHY_ID_BCM5401
)paren
(brace
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
)paren
id|bmsr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
)paren
(brace
id|err
op_assign
id|tg3_init_5401phy_dsp
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
(brace
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;phy_id
op_amp
id|PHY_ID_REV_MASK
)paren
op_eq
id|PHY_REV_BCM5401_B0
op_logical_and
op_logical_neg
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
op_logical_and
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_1000
)paren
(brace
id|err
op_assign
id|tg3_phy_reset
c_func
(paren
id|tp
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|err
op_assign
id|tg3_init_5401phy_dsp
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B0
)paren
(brace
multiline_comment|/* 5701 {A0,B0} CRC bug workaround */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x15
comma
l_int|0x0a75
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x1c
comma
l_int|0x8c68
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x1c
comma
l_int|0x8d68
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x1c
comma
l_int|0x8c68
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear pending interrupts... */
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_ISTAT
comma
op_amp
id|dummy
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_ISTAT
comma
op_amp
id|dummy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_USE_MI_INTERRUPT
)paren
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_IMASK
comma
op_complement
id|MII_TG3_INT_LINKCHG
)paren
suffix:semicolon
r_else
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_IMASK
comma
op_complement
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;led_mode
op_eq
id|led_mode_three_link
)paren
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_EXT_CTRL
comma
id|MII_TG3_EXT_CTRL_LNK3_LED_MODE
)paren
suffix:semicolon
r_else
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_EXT_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|current_link_up
op_assign
l_int|0
suffix:semicolon
id|current_speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|current_duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|bmsr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmsr
op_amp
id|BMSR_LSTATUS
)paren
(brace
id|u32
id|aux_stat
comma
id|bmcr
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_STAT
comma
op_amp
id|aux_stat
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_STAT
comma
op_amp
id|aux_stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aux_stat
)paren
r_break
suffix:semicolon
)brace
id|tg3_aux_stat_to_speed_duplex
c_func
(paren
id|tp
comma
id|aux_stat
comma
op_amp
id|current_speed
comma
op_amp
id|current_duplex
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|bmcr
op_amp
id|BMCR_ANENABLE
)paren
(brace
id|u32
id|gig_ctrl
suffix:semicolon
id|current_link_up
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Force autoneg restart if we are exiting&n;&t;&t;&t;&t; * low power mode.&n;&t;&t;&t;&t; */
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
op_amp
id|gig_ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|gig_ctrl
op_amp
(paren
id|MII_TG3_CTRL_ADV_1000_HALF
op_or
id|MII_TG3_CTRL_ADV_1000_FULL
)paren
)paren
)paren
(brace
id|current_link_up
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|current_link_up
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bmcr
op_amp
id|BMCR_ANENABLE
)paren
op_logical_and
id|tp-&gt;link_config.speed
op_eq
id|current_speed
op_logical_and
id|tp-&gt;link_config.duplex
op_eq
id|current_duplex
)paren
(brace
id|current_link_up
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|current_link_up
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|tp-&gt;link_config.active_speed
op_assign
id|current_speed
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|current_duplex
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|1
op_logical_and
(paren
id|tp-&gt;link_config.active_duplex
op_eq
id|DUPLEX_FULL
)paren
op_logical_and
(paren
id|tp-&gt;link_config.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
)paren
(brace
id|u32
id|local_adv
comma
id|remote_adv
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
op_amp
id|local_adv
)paren
suffix:semicolon
id|local_adv
op_and_assign
(paren
id|ADVERTISE_PAUSE_CAP
op_or
id|ADVERTISE_PAUSE_ASYM
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_LPA
comma
op_amp
id|remote_adv
)paren
suffix:semicolon
id|remote_adv
op_and_assign
(paren
id|LPA_PAUSE_CAP
op_or
id|LPA_PAUSE_ASYM
)paren
suffix:semicolon
multiline_comment|/* If we are not advertising full pause capability,&n;&t;&t; * something is wrong.  Bring the link down and reconfigure.&n;&t;&t; */
r_if
c_cond
(paren
id|local_adv
op_ne
id|ADVERTISE_PAUSE_CAP
)paren
(brace
id|current_link_up
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|tg3_setup_flow_control
c_func
(paren
id|tp
comma
id|local_adv
comma
id|remote_adv
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|0
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tg3_phy_copper_begin
c_func
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMSR
comma
op_amp
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|BMSR_LSTATUS
)paren
id|current_link_up
op_assign
l_int|1
suffix:semicolon
)brace
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_PORT_MODE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_100
op_logical_or
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_10
)paren
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_PORT_MODE_MII
suffix:semicolon
r_else
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_PORT_MODE_GMII
suffix:semicolon
)brace
r_else
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_PORT_MODE_GMII
suffix:semicolon
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_HALF_DUPLEX
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.active_duplex
op_eq
id|DUPLEX_HALF
)paren
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_HALF_DUPLEX
suffix:semicolon
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_LINK_POLARITY
suffix:semicolon
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5701
op_logical_or
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5703
)paren
(brace
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|1
)paren
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_LINK_POLARITY
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_LED_CTRL
comma
id|LED_CTRL_PHY_MODE_1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;led_mode
op_eq
id|led_mode_link10
)paren
op_logical_or
(paren
id|current_link_up
op_eq
l_int|1
op_logical_and
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_10
)paren
)paren
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_LINK_POLARITY
suffix:semicolon
)brace
multiline_comment|/* ??? Without this setting Netgear GA302T PHY does not&n;&t; * ??? send/receive packets...&n;&t; */
r_if
c_cond
(paren
(paren
id|tp-&gt;phy_id
op_amp
id|PHY_ID_MASK
)paren
op_eq
id|PHY_ID_BCM5411
op_logical_and
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5700_ALTIMA
)paren
(brace
id|tp-&gt;mi_mode
op_or_assign
id|MAC_MI_MODE_AUTO_POLL
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
(paren
id|TG3_FLAG_USE_LINKCHG_REG
op_or
id|TG3_FLAG_POLL_SERDES
)paren
)paren
(brace
multiline_comment|/* Polled via timer. */
id|tw32
c_func
(paren
id|MAC_EVENT
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|MAC_EVENT
comma
id|MAC_EVENT_LNKSTATE_CHANGED
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
op_logical_and
id|current_link_up
op_eq
l_int|1
op_logical_and
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_1000
op_logical_and
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
op_logical_or
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCI_HIGH_SPEED
)paren
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|120
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_STATUS
comma
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_FIRMWARE_MBOX
comma
id|NIC_SRAM_FIRMWARE_MBOX_MAGIC2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_link_up
op_ne
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|current_link_up
)paren
id|netif_carrier_on
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
r_else
id|netif_carrier_off
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
id|tg3_link_report
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|tg3_fiber_aneginfo
r_struct
id|tg3_fiber_aneginfo
(brace
DECL|member|state
r_int
id|state
suffix:semicolon
DECL|macro|ANEG_STATE_UNKNOWN
mdefine_line|#define ANEG_STATE_UNKNOWN&t;&t;0
DECL|macro|ANEG_STATE_AN_ENABLE
mdefine_line|#define ANEG_STATE_AN_ENABLE&t;&t;1
DECL|macro|ANEG_STATE_RESTART_INIT
mdefine_line|#define ANEG_STATE_RESTART_INIT&t;&t;2
DECL|macro|ANEG_STATE_RESTART
mdefine_line|#define ANEG_STATE_RESTART&t;&t;3
DECL|macro|ANEG_STATE_DISABLE_LINK_OK
mdefine_line|#define ANEG_STATE_DISABLE_LINK_OK&t;4
DECL|macro|ANEG_STATE_ABILITY_DETECT_INIT
mdefine_line|#define ANEG_STATE_ABILITY_DETECT_INIT&t;5
DECL|macro|ANEG_STATE_ABILITY_DETECT
mdefine_line|#define ANEG_STATE_ABILITY_DETECT&t;6
DECL|macro|ANEG_STATE_ACK_DETECT_INIT
mdefine_line|#define ANEG_STATE_ACK_DETECT_INIT&t;7
DECL|macro|ANEG_STATE_ACK_DETECT
mdefine_line|#define ANEG_STATE_ACK_DETECT&t;&t;8
DECL|macro|ANEG_STATE_COMPLETE_ACK_INIT
mdefine_line|#define ANEG_STATE_COMPLETE_ACK_INIT&t;9
DECL|macro|ANEG_STATE_COMPLETE_ACK
mdefine_line|#define ANEG_STATE_COMPLETE_ACK&t;&t;10
DECL|macro|ANEG_STATE_IDLE_DETECT_INIT
mdefine_line|#define ANEG_STATE_IDLE_DETECT_INIT&t;11
DECL|macro|ANEG_STATE_IDLE_DETECT
mdefine_line|#define ANEG_STATE_IDLE_DETECT&t;&t;12
DECL|macro|ANEG_STATE_LINK_OK
mdefine_line|#define ANEG_STATE_LINK_OK&t;&t;13
DECL|macro|ANEG_STATE_NEXT_PAGE_WAIT_INIT
mdefine_line|#define ANEG_STATE_NEXT_PAGE_WAIT_INIT&t;14
DECL|macro|ANEG_STATE_NEXT_PAGE_WAIT
mdefine_line|#define ANEG_STATE_NEXT_PAGE_WAIT&t;15
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|MR_AN_ENABLE
mdefine_line|#define MR_AN_ENABLE&t;&t;0x00000001
DECL|macro|MR_RESTART_AN
mdefine_line|#define MR_RESTART_AN&t;&t;0x00000002
DECL|macro|MR_AN_COMPLETE
mdefine_line|#define MR_AN_COMPLETE&t;&t;0x00000004
DECL|macro|MR_PAGE_RX
mdefine_line|#define MR_PAGE_RX&t;&t;0x00000008
DECL|macro|MR_NP_LOADED
mdefine_line|#define MR_NP_LOADED&t;&t;0x00000010
DECL|macro|MR_TOGGLE_TX
mdefine_line|#define MR_TOGGLE_TX&t;&t;0x00000020
DECL|macro|MR_LP_ADV_FULL_DUPLEX
mdefine_line|#define MR_LP_ADV_FULL_DUPLEX&t;0x00000040
DECL|macro|MR_LP_ADV_HALF_DUPLEX
mdefine_line|#define MR_LP_ADV_HALF_DUPLEX&t;0x00000080
DECL|macro|MR_LP_ADV_SYM_PAUSE
mdefine_line|#define MR_LP_ADV_SYM_PAUSE&t;0x00000100
DECL|macro|MR_LP_ADV_ASYM_PAUSE
mdefine_line|#define MR_LP_ADV_ASYM_PAUSE&t;0x00000200
DECL|macro|MR_LP_ADV_REMOTE_FAULT1
mdefine_line|#define MR_LP_ADV_REMOTE_FAULT1&t;0x00000400
DECL|macro|MR_LP_ADV_REMOTE_FAULT2
mdefine_line|#define MR_LP_ADV_REMOTE_FAULT2&t;0x00000800
DECL|macro|MR_LP_ADV_NEXT_PAGE
mdefine_line|#define MR_LP_ADV_NEXT_PAGE&t;0x00001000
DECL|macro|MR_TOGGLE_RX
mdefine_line|#define MR_TOGGLE_RX&t;&t;0x00002000
DECL|macro|MR_NP_RX
mdefine_line|#define MR_NP_RX&t;&t;0x00004000
DECL|macro|MR_LINK_OK
mdefine_line|#define MR_LINK_OK&t;&t;0x80000000
DECL|member|link_time
DECL|member|cur_time
r_int
r_int
id|link_time
comma
id|cur_time
suffix:semicolon
DECL|member|ability_match_cfg
id|u32
id|ability_match_cfg
suffix:semicolon
DECL|member|ability_match_count
r_int
id|ability_match_count
suffix:semicolon
DECL|member|ability_match
DECL|member|idle_match
DECL|member|ack_match
r_char
id|ability_match
comma
id|idle_match
comma
id|ack_match
suffix:semicolon
DECL|member|txconfig
DECL|member|rxconfig
id|u32
id|txconfig
comma
id|rxconfig
suffix:semicolon
DECL|macro|ANEG_CFG_NP
mdefine_line|#define ANEG_CFG_NP&t;&t;0x00000080
DECL|macro|ANEG_CFG_ACK
mdefine_line|#define ANEG_CFG_ACK&t;&t;0x00000040
DECL|macro|ANEG_CFG_RF2
mdefine_line|#define ANEG_CFG_RF2&t;&t;0x00000020
DECL|macro|ANEG_CFG_RF1
mdefine_line|#define ANEG_CFG_RF1&t;&t;0x00000010
DECL|macro|ANEG_CFG_PS2
mdefine_line|#define ANEG_CFG_PS2&t;&t;0x00000001
DECL|macro|ANEG_CFG_PS1
mdefine_line|#define ANEG_CFG_PS1&t;&t;0x00008000
DECL|macro|ANEG_CFG_HD
mdefine_line|#define ANEG_CFG_HD&t;&t;0x00004000
DECL|macro|ANEG_CFG_FD
mdefine_line|#define ANEG_CFG_FD&t;&t;0x00002000
DECL|macro|ANEG_CFG_INVAL
mdefine_line|#define ANEG_CFG_INVAL&t;&t;0x00001f06
)brace
suffix:semicolon
DECL|macro|ANEG_OK
mdefine_line|#define ANEG_OK&t;&t;0
DECL|macro|ANEG_DONE
mdefine_line|#define ANEG_DONE&t;1
DECL|macro|ANEG_TIMER_ENAB
mdefine_line|#define ANEG_TIMER_ENAB&t;2
DECL|macro|ANEG_FAILED
mdefine_line|#define ANEG_FAILED&t;-1
DECL|macro|ANEG_STATE_SETTLE_TIME
mdefine_line|#define ANEG_STATE_SETTLE_TIME&t;10000
DECL|function|tg3_fiber_aneg_smachine
r_static
r_int
id|tg3_fiber_aneg_smachine
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_struct
id|tg3_fiber_aneginfo
op_star
id|ap
)paren
(brace
r_int
r_int
id|delta
suffix:semicolon
id|u32
id|rx_cfg_reg
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;state
op_eq
id|ANEG_STATE_UNKNOWN
)paren
(brace
id|ap-&gt;rxconfig
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;link_time
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;cur_time
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_cfg
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_count
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;idle_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ack_match
op_assign
l_int|0
suffix:semicolon
)brace
id|ap-&gt;cur_time
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_RCVD_CFG
)paren
(brace
id|rx_cfg_reg
op_assign
id|tr32
c_func
(paren
id|MAC_RX_AUTO_NEG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_cfg_reg
op_ne
id|ap-&gt;ability_match_cfg
)paren
(brace
id|ap-&gt;ability_match_cfg
op_assign
id|rx_cfg_reg
suffix:semicolon
id|ap-&gt;ability_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_increment
id|ap-&gt;ability_match_count
OG
l_int|1
)paren
(brace
id|ap-&gt;ability_match
op_assign
l_int|1
suffix:semicolon
id|ap-&gt;ability_match_cfg
op_assign
id|rx_cfg_reg
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rx_cfg_reg
op_amp
id|ANEG_CFG_ACK
)paren
id|ap-&gt;ack_match
op_assign
l_int|1
suffix:semicolon
r_else
id|ap-&gt;ack_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;idle_match
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|ap-&gt;idle_match
op_assign
l_int|1
suffix:semicolon
id|ap-&gt;ability_match_cfg
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_count
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ack_match
op_assign
l_int|0
suffix:semicolon
id|rx_cfg_reg
op_assign
l_int|0
suffix:semicolon
)brace
id|ap-&gt;rxconfig
op_assign
id|rx_cfg_reg
suffix:semicolon
id|ret
op_assign
id|ANEG_OK
suffix:semicolon
r_switch
c_cond
(paren
id|ap-&gt;state
)paren
(brace
r_case
id|ANEG_STATE_UNKNOWN
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;flags
op_amp
(paren
id|MR_AN_ENABLE
op_or
id|MR_RESTART_AN
)paren
)paren
id|ap-&gt;state
op_assign
id|ANEG_STATE_AN_ENABLE
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|ANEG_STATE_AN_ENABLE
suffix:colon
id|ap-&gt;flags
op_and_assign
op_complement
(paren
id|MR_AN_COMPLETE
op_or
id|MR_PAGE_RX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;flags
op_amp
id|MR_AN_ENABLE
)paren
(brace
id|ap-&gt;link_time
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;cur_time
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_cfg
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match_count
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ability_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;idle_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;ack_match
op_assign
l_int|0
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_RESTART_INIT
suffix:semicolon
)brace
r_else
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_DISABLE_LINK_OK
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_RESTART_INIT
suffix:colon
id|ap-&gt;link_time
op_assign
id|ap-&gt;cur_time
suffix:semicolon
id|ap-&gt;flags
op_and_assign
op_complement
(paren
id|MR_NP_LOADED
)paren
suffix:semicolon
id|ap-&gt;txconfig
op_assign
l_int|0
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_AUTO_NEG
comma
l_int|0
)paren
suffix:semicolon
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_SEND_CONFIGS
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|ret
op_assign
id|ANEG_TIMER_ENAB
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_RESTART
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|ANEG_STATE_RESTART
suffix:colon
id|delta
op_assign
id|ap-&gt;cur_time
op_minus
id|ap-&gt;link_time
suffix:semicolon
r_if
c_cond
(paren
id|delta
OG
id|ANEG_STATE_SETTLE_TIME
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_ABILITY_DETECT_INIT
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|ANEG_TIMER_ENAB
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_DISABLE_LINK_OK
suffix:colon
id|ret
op_assign
id|ANEG_DONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ANEG_STATE_ABILITY_DETECT_INIT
suffix:colon
id|ap-&gt;flags
op_and_assign
op_complement
(paren
id|MR_TOGGLE_TX
)paren
suffix:semicolon
id|ap-&gt;txconfig
op_assign
(paren
id|ANEG_CFG_FD
op_or
id|ANEG_CFG_PS1
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_AUTO_NEG
comma
id|ap-&gt;txconfig
)paren
suffix:semicolon
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_SEND_CONFIGS
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_ABILITY_DETECT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ANEG_STATE_ABILITY_DETECT
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;ability_match
op_ne
l_int|0
op_logical_and
id|ap-&gt;rxconfig
op_ne
l_int|0
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_ACK_DETECT_INIT
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_ACK_DETECT_INIT
suffix:colon
id|ap-&gt;txconfig
op_or_assign
id|ANEG_CFG_ACK
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_AUTO_NEG
comma
id|ap-&gt;txconfig
)paren
suffix:semicolon
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_SEND_CONFIGS
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_ACK_DETECT
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|ANEG_STATE_ACK_DETECT
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;ack_match
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|ap-&gt;rxconfig
op_amp
op_complement
id|ANEG_CFG_ACK
)paren
op_eq
(paren
id|ap-&gt;ability_match_cfg
op_amp
op_complement
id|ANEG_CFG_ACK
)paren
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_COMPLETE_ACK_INIT
suffix:semicolon
)brace
r_else
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_AN_ENABLE
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ap-&gt;ability_match
op_ne
l_int|0
op_logical_and
id|ap-&gt;rxconfig
op_eq
l_int|0
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_AN_ENABLE
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_COMPLETE_ACK_INIT
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_INVAL
)paren
(brace
id|ret
op_assign
id|ANEG_FAILED
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ap-&gt;flags
op_and_assign
op_complement
(paren
id|MR_LP_ADV_FULL_DUPLEX
op_or
id|MR_LP_ADV_HALF_DUPLEX
op_or
id|MR_LP_ADV_SYM_PAUSE
op_or
id|MR_LP_ADV_ASYM_PAUSE
op_or
id|MR_LP_ADV_REMOTE_FAULT1
op_or
id|MR_LP_ADV_REMOTE_FAULT2
op_or
id|MR_LP_ADV_NEXT_PAGE
op_or
id|MR_TOGGLE_RX
op_or
id|MR_NP_RX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_FD
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_FULL_DUPLEX
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_HD
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_HALF_DUPLEX
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_PS1
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_SYM_PAUSE
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_PS2
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_ASYM_PAUSE
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_RF1
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_REMOTE_FAULT1
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_RF2
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_REMOTE_FAULT2
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_NP
)paren
id|ap-&gt;flags
op_or_assign
id|MR_LP_ADV_NEXT_PAGE
suffix:semicolon
id|ap-&gt;link_time
op_assign
id|ap-&gt;cur_time
suffix:semicolon
id|ap-&gt;flags
op_xor_assign
(paren
id|MR_TOGGLE_TX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
l_int|0x0008
)paren
id|ap-&gt;flags
op_or_assign
id|MR_TOGGLE_RX
suffix:semicolon
r_if
c_cond
(paren
id|ap-&gt;rxconfig
op_amp
id|ANEG_CFG_NP
)paren
id|ap-&gt;flags
op_or_assign
id|MR_NP_RX
suffix:semicolon
id|ap-&gt;flags
op_or_assign
id|MR_PAGE_RX
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_COMPLETE_ACK
suffix:semicolon
id|ret
op_assign
id|ANEG_TIMER_ENAB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ANEG_STATE_COMPLETE_ACK
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;ability_match
op_ne
l_int|0
op_logical_and
id|ap-&gt;rxconfig
op_eq
l_int|0
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_AN_ENABLE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|delta
op_assign
id|ap-&gt;cur_time
op_minus
id|ap-&gt;link_time
suffix:semicolon
r_if
c_cond
(paren
id|delta
OG
id|ANEG_STATE_SETTLE_TIME
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ap-&gt;flags
op_amp
(paren
id|MR_LP_ADV_NEXT_PAGE
)paren
)paren
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_IDLE_DETECT_INIT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|ap-&gt;txconfig
op_amp
id|ANEG_CFG_NP
)paren
op_eq
l_int|0
op_logical_and
op_logical_neg
(paren
id|ap-&gt;flags
op_amp
id|MR_NP_RX
)paren
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_IDLE_DETECT_INIT
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|ANEG_FAILED
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_IDLE_DETECT_INIT
suffix:colon
id|ap-&gt;link_time
op_assign
id|ap-&gt;cur_time
suffix:semicolon
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_SEND_CONFIGS
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|ap-&gt;state
op_assign
id|ANEG_STATE_IDLE_DETECT
suffix:semicolon
id|ret
op_assign
id|ANEG_TIMER_ENAB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ANEG_STATE_IDLE_DETECT
suffix:colon
r_if
c_cond
(paren
id|ap-&gt;ability_match
op_ne
l_int|0
op_logical_and
id|ap-&gt;rxconfig
op_eq
l_int|0
)paren
(brace
id|ap-&gt;state
op_assign
id|ANEG_STATE_AN_ENABLE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|delta
op_assign
id|ap-&gt;cur_time
op_minus
id|ap-&gt;link_time
suffix:semicolon
r_if
c_cond
(paren
id|delta
OG
id|ANEG_STATE_SETTLE_TIME
)paren
(brace
multiline_comment|/* XXX another gem from the Broadcom driver :( */
id|ap-&gt;state
op_assign
id|ANEG_STATE_LINK_OK
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ANEG_STATE_LINK_OK
suffix:colon
id|ap-&gt;flags
op_or_assign
(paren
id|MR_AN_COMPLETE
op_or
id|MR_LINK_OK
)paren
suffix:semicolon
id|ret
op_assign
id|ANEG_DONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ANEG_STATE_NEXT_PAGE_WAIT_INIT
suffix:colon
multiline_comment|/* ??? unimplemented */
r_break
suffix:semicolon
r_case
id|ANEG_STATE_NEXT_PAGE_WAIT
suffix:colon
multiline_comment|/* ??? unimplemented */
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
id|ANEG_FAILED
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|tg3_setup_fiber_phy
r_static
r_int
id|tg3_setup_fiber_phy
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|orig_pause_cfg
suffix:semicolon
id|u16
id|orig_active_speed
suffix:semicolon
id|u8
id|orig_active_duplex
suffix:semicolon
r_int
id|current_link_up
suffix:semicolon
r_int
id|i
suffix:semicolon
id|orig_pause_cfg
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
(paren
id|TG3_FLAG_RX_PAUSE
op_or
id|TG3_FLAG_TX_PAUSE
)paren
)paren
suffix:semicolon
id|orig_active_speed
op_assign
id|tp-&gt;link_config.active_speed
suffix:semicolon
id|orig_active_duplex
op_assign
id|tp-&gt;link_config.active_duplex
suffix:semicolon
id|tp-&gt;mac_mode
op_and_assign
op_complement
(paren
id|MAC_MODE_PORT_MODE_MASK
op_or
id|MAC_MODE_HALF_DUPLEX
)paren
suffix:semicolon
id|tp-&gt;mac_mode
op_or_assign
id|MAC_MODE_PORT_MODE_TBI
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
multiline_comment|/* Reset when initting first time or we have a link. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
op_logical_or
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
)paren
(brace
multiline_comment|/* Set PLL lock range. */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x16
comma
l_int|0x8007
)paren
suffix:semicolon
multiline_comment|/* SW reset */
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|BMCR_RESET
)paren
suffix:semicolon
multiline_comment|/* Wait for reset to complete. */
multiline_comment|/* XXX schedule_timeout() ... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|500
suffix:semicolon
id|i
op_increment
)paren
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Config mode; select PMA/Ch 1 regs. */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x10
comma
l_int|0x8411
)paren
suffix:semicolon
multiline_comment|/* Enable auto-lock and comdet, select txclk for tx. */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x11
comma
l_int|0x0a10
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x18
comma
l_int|0x00a0
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x16
comma
l_int|0x41ff
)paren
suffix:semicolon
multiline_comment|/* Assert and deassert POR. */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x13
comma
l_int|0x0400
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x13
comma
l_int|0x0000
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x11
comma
l_int|0x0a50
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x11
comma
l_int|0x0a10
)paren
suffix:semicolon
multiline_comment|/* Wait for signal to stabilize */
multiline_comment|/* XXX schedule_timeout() ... */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|15000
suffix:semicolon
id|i
op_increment
)paren
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Deselect the channel register so we can read the PHYID&n;&t;&t; * later.&n;&t;&t; */
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x10
comma
l_int|0x8011
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable link change interrupt unless serdes polling.  */
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_POLL_SERDES
)paren
)paren
id|tw32
c_func
(paren
id|MAC_EVENT
comma
id|MAC_EVENT_LNKSTATE_CHANGED
)paren
suffix:semicolon
r_else
id|tw32
c_func
(paren
id|MAC_EVENT
comma
l_int|0
)paren
suffix:semicolon
id|current_link_up
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;link_config.autoneg
op_eq
id|AUTONEG_ENABLE
op_logical_and
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_GOT_SERDES_FLOWCTL
)paren
)paren
(brace
r_struct
id|tg3_fiber_aneginfo
id|aninfo
suffix:semicolon
r_int
id|status
op_assign
id|ANEG_FAILED
suffix:semicolon
r_int
r_int
id|tick
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|aninfo
comma
l_int|0
comma
r_sizeof
(paren
id|aninfo
)paren
)paren
suffix:semicolon
id|aninfo.flags
op_or_assign
(paren
id|MR_AN_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_AUTO_NEG
comma
l_int|0
)paren
suffix:semicolon
id|tmp
op_assign
id|tp-&gt;mac_mode
op_amp
op_complement
id|MAC_MODE_PORT_MODE_MASK
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tmp
op_or
id|MAC_MODE_PORT_MODE_GMII
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
op_or
id|MAC_MODE_SEND_CONFIGS
)paren
suffix:semicolon
id|aninfo.state
op_assign
id|ANEG_STATE_UNKNOWN
suffix:semicolon
id|aninfo.cur_time
op_assign
l_int|0
suffix:semicolon
id|tick
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|tick
OL
l_int|195000
)paren
(brace
id|status
op_assign
id|tg3_fiber_aneg_smachine
c_func
(paren
id|tp
comma
op_amp
id|aninfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|ANEG_DONE
op_logical_or
id|status
op_eq
id|ANEG_FAILED
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_SEND_CONFIGS
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|ANEG_DONE
op_logical_and
(paren
id|aninfo.flags
op_amp
(paren
id|MR_AN_COMPLETE
op_or
id|MR_LINK_OK
op_or
id|MR_LP_ADV_FULL_DUPLEX
)paren
)paren
)paren
(brace
id|u32
id|local_adv
comma
id|remote_adv
suffix:semicolon
id|local_adv
op_assign
id|ADVERTISE_PAUSE_CAP
suffix:semicolon
id|remote_adv
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|aninfo.flags
op_amp
id|MR_LP_ADV_SYM_PAUSE
)paren
id|remote_adv
op_or_assign
id|LPA_PAUSE_CAP
suffix:semicolon
r_if
c_cond
(paren
id|aninfo.flags
op_amp
id|MR_LP_ADV_ASYM_PAUSE
)paren
id|remote_adv
op_or_assign
id|LPA_PAUSE_ASYM
suffix:semicolon
id|tg3_setup_flow_control
c_func
(paren
id|tp
comma
id|local_adv
comma
id|remote_adv
)paren
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_GOT_SERDES_FLOWCTL
suffix:semicolon
id|current_link_up
op_assign
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|60
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_STATUS
comma
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|0
op_logical_and
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
)paren
(brace
id|current_link_up
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Forcing 1000FD link up. */
id|current_link_up
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_LINK_POLARITY
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|tp-&gt;hw_status-&gt;status
op_assign
(paren
id|SD_STATUS_UPDATED
op_or
(paren
id|tp-&gt;hw_status-&gt;status
op_amp
op_complement
id|SD_STATUS_LINK_CHG
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_STATUS
comma
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
(paren
id|MAC_STATUS_SYNC_CHANGED
op_or
id|MAC_STATUS_CFG_CHANGED
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
op_eq
l_int|0
)paren
id|current_link_up
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|current_link_up
op_eq
l_int|1
)paren
(brace
id|tp-&gt;link_config.active_speed
op_assign
id|SPEED_1000
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;link_config.active_speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current_link_up
op_ne
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|current_link_up
)paren
id|netif_carrier_on
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
r_else
id|netif_carrier_off
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
id|tg3_link_report
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_else
(brace
id|u32
id|now_pause_cfg
op_assign
id|tp-&gt;tg3_flags
op_amp
(paren
id|TG3_FLAG_RX_PAUSE
op_or
id|TG3_FLAG_TX_PAUSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|orig_pause_cfg
op_ne
id|now_pause_cfg
op_logical_or
id|orig_active_speed
op_ne
id|tp-&gt;link_config.active_speed
op_logical_or
id|orig_active_duplex
op_ne
id|tp-&gt;link_config.active_duplex
)paren
id|tg3_link_report
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
op_eq
l_int|0
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
op_or
id|MAC_MODE_LINK_POLARITY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_setup_phy
r_static
r_int
id|tg3_setup_phy
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
)paren
(brace
id|err
op_assign
id|tg3_setup_fiber_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|tg3_setup_copper_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;link_config.active_speed
op_eq
id|SPEED_1000
op_logical_and
id|tp-&gt;link_config.active_duplex
op_eq
id|DUPLEX_HALF
)paren
id|tw32
c_func
(paren
id|MAC_TX_LENGTHS
comma
(paren
(paren
l_int|2
op_lshift
id|TX_LENGTHS_IPG_CRS_SHIFT
)paren
op_or
(paren
l_int|6
op_lshift
id|TX_LENGTHS_IPG_SHIFT
)paren
op_or
(paren
l_int|0xff
op_lshift
id|TX_LENGTHS_SLOT_TIME_SHIFT
)paren
)paren
)paren
suffix:semicolon
r_else
id|tw32
c_func
(paren
id|MAC_TX_LENGTHS
comma
(paren
(paren
l_int|2
op_lshift
id|TX_LENGTHS_IPG_CRS_SHIFT
)paren
op_or
(paren
l_int|6
op_lshift
id|TX_LENGTHS_IPG_SHIFT
)paren
op_or
(paren
l_int|32
op_lshift
id|TX_LENGTHS_SLOT_TIME_SHIFT
)paren
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Tigon3 never reports partial packet sends.  So we do not&n; * need special logic to handle SKBs that have not had all&n; * of their frags sent yet, like SunGEM does.&n; */
DECL|function|tg3_tx
r_static
r_void
id|tg3_tx
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|hw_idx
op_assign
id|tp-&gt;hw_status-&gt;idx
(braket
l_int|0
)braket
dot
id|tx_consumer
suffix:semicolon
id|u32
id|sw_idx
op_assign
id|tp-&gt;tx_cons
suffix:semicolon
r_while
c_loop
(paren
id|sw_idx
op_ne
id|hw_idx
)paren
(brace
r_struct
id|ring_info
op_star
id|ri
op_assign
op_amp
id|tp-&gt;tx_buffers
(braket
id|sw_idx
)braket
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|ri-&gt;skb
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb
op_eq
l_int|NULL
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|ri
comma
id|mapping
)paren
comma
(paren
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|ri-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|sw_idx
op_assign
id|NEXT_TX
c_func
(paren
id|sw_idx
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|sw_idx
op_eq
id|hw_idx
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|ri
op_assign
op_amp
id|tp-&gt;tx_buffers
(braket
id|sw_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ri-&gt;skb
op_ne
l_int|NULL
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|ri
comma
id|mapping
)paren
comma
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|sw_idx
op_assign
id|NEXT_TX
c_func
(paren
id|sw_idx
)paren
suffix:semicolon
)brace
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_cons
op_assign
id|sw_idx
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|tp-&gt;dev
)paren
op_logical_and
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|tp
)paren
OG
id|TG3_TX_WAKEUP_THRESH
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Returns size of skb allocated or &lt; 0 on error.&n; *&n; * We only need to fill in the address because the other members&n; * of the RX descriptor are invariant, see tg3_init_rings.&n; *&n; * Note the purposeful assymetry of cpu vs. chip accesses.  For&n; * posting buffers we only dirty the first cache line of the RX&n; * descriptor (containing the address).  Whereas for the RX status&n; * buffers the cpu only reads the last cacheline of the RX descriptor&n; * (to fetch the error flags, vlan tag, checksum, and opaque cookie).&n; */
DECL|function|tg3_alloc_rx_skb
r_static
r_int
id|tg3_alloc_rx_skb
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|opaque_key
comma
r_int
id|src_idx
comma
id|u32
id|dest_idx_unmasked
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|desc
suffix:semicolon
r_struct
id|ring_info
op_star
id|map
comma
op_star
id|src_map
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_int
id|skb_size
comma
id|dest_idx
suffix:semicolon
id|src_map
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|opaque_key
)paren
(brace
r_case
id|RXD_OPAQUE_RING_STD
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_RING_SIZE
suffix:semicolon
id|desc
op_assign
op_amp
id|tp-&gt;rx_std
(braket
id|dest_idx
)braket
suffix:semicolon
id|map
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|src_idx
op_ge
l_int|0
)paren
id|src_map
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|src_idx
)braket
suffix:semicolon
id|skb_size
op_assign
id|RX_PKT_BUF_SZ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RXD_OPAQUE_RING_JUMBO
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_JUMBO_RING_SIZE
suffix:semicolon
id|desc
op_assign
op_amp
id|tp-&gt;rx_jumbo
(braket
id|dest_idx
)braket
suffix:semicolon
id|map
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|src_idx
op_ge
l_int|0
)paren
id|src_map
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|src_idx
)braket
suffix:semicolon
id|skb_size
op_assign
id|RX_JUMBO_PKT_BUF_SZ
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
r_case
id|RXD_OPAQUE_RING_MINI
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_MINI_RING_SIZE
suffix:semicolon
id|desc
op_assign
op_amp
id|tp-&gt;rx_mini
(braket
id|dest_idx
)braket
suffix:semicolon
id|map
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|src_idx
op_ge
l_int|0
)paren
id|src_map
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|src_idx
)braket
suffix:semicolon
id|skb_size
op_assign
id|RX_MINI_PKT_BUF_SZ
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Do not overwrite any of the map or rp information&n;&t; * until we are sure we can commit to a new buffer.&n;&t; *&n;&t; * Callers depend upon this behavior and assume that&n;&t; * we leave everything unchanged if we fail.&n;&t; */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|skb_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|skb-&gt;dev
op_assign
id|tp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|tp-&gt;rx_offset
)paren
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb_size
op_minus
id|tp-&gt;rx_offset
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|map-&gt;skb
op_assign
id|skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
id|map
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src_map
op_ne
l_int|NULL
)paren
id|src_map-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|desc-&gt;addr_hi
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
suffix:semicolon
id|desc-&gt;addr_lo
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
r_return
id|skb_size
suffix:semicolon
)brace
multiline_comment|/* We only need to move over in the address because the other&n; * members of the RX descriptor are invariant.  See notes above&n; * tg3_alloc_rx_skb for full details.&n; */
DECL|function|tg3_recycle_rx
r_static
r_void
id|tg3_recycle_rx
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|opaque_key
comma
r_int
id|src_idx
comma
id|u32
id|dest_idx_unmasked
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|src_desc
comma
op_star
id|dest_desc
suffix:semicolon
r_struct
id|ring_info
op_star
id|src_map
comma
op_star
id|dest_map
suffix:semicolon
r_int
id|dest_idx
suffix:semicolon
r_switch
c_cond
(paren
id|opaque_key
)paren
(brace
r_case
id|RXD_OPAQUE_RING_STD
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_RING_SIZE
suffix:semicolon
id|dest_desc
op_assign
op_amp
id|tp-&gt;rx_std
(braket
id|dest_idx
)braket
suffix:semicolon
id|dest_map
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
id|src_desc
op_assign
op_amp
id|tp-&gt;rx_std
(braket
id|src_idx
)braket
suffix:semicolon
id|src_map
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|src_idx
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RXD_OPAQUE_RING_JUMBO
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_JUMBO_RING_SIZE
suffix:semicolon
id|dest_desc
op_assign
op_amp
id|tp-&gt;rx_jumbo
(braket
id|dest_idx
)braket
suffix:semicolon
id|dest_map
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
id|src_desc
op_assign
op_amp
id|tp-&gt;rx_jumbo
(braket
id|src_idx
)braket
suffix:semicolon
id|src_map
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|src_idx
)braket
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
r_case
id|RXD_OPAQUE_RING_MINI
suffix:colon
id|dest_idx
op_assign
id|dest_idx_unmasked
op_mod
id|TG3_RX_MINI_RING_SIZE
suffix:semicolon
id|dest_desc
op_assign
op_amp
id|tp-&gt;rx_mini
(braket
id|dest_idx
)braket
suffix:semicolon
id|dest_map
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|dest_idx
)braket
suffix:semicolon
id|src_desc
op_assign
op_amp
id|tp-&gt;rx_mini
(braket
id|src_idx
)braket
suffix:semicolon
id|src_map
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|src_idx
)braket
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
suffix:semicolon
)brace
suffix:semicolon
id|dest_map-&gt;skb
op_assign
id|src_map-&gt;skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
id|dest_map
comma
id|mapping
comma
id|pci_unmap_addr
c_func
(paren
id|src_map
comma
id|mapping
)paren
)paren
suffix:semicolon
id|dest_desc-&gt;addr_hi
op_assign
id|src_desc-&gt;addr_hi
suffix:semicolon
id|dest_desc-&gt;addr_lo
op_assign
id|src_desc-&gt;addr_lo
suffix:semicolon
id|src_map-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if TG3_VLAN_TAG_USED
DECL|function|tg3_vlan_rx
r_static
r_int
id|tg3_vlan_rx
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u16
id|vlan_tag
)paren
(brace
r_return
id|vlan_hwaccel_rx
c_func
(paren
id|skb
comma
id|tp-&gt;vlgrp
comma
id|vlan_tag
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* The RX ring scheme is composed of multiple rings which post fresh&n; * buffers to the chip, and one special ring the chip uses to report&n; * status back to the host.&n; *&n; * The special ring reports the status of received packets to the&n; * host.  The chip does not write into the original descriptor the&n; * RX buffer was obtained from.  The chip simply takes the original&n; * descriptor as provided by the host, updates the status and length&n; * field, then writes this into the next status ring entry.&n; *&n; * Each ring the host uses to post buffers to the chip is described&n; * by a TG3_BDINFO entry in the chips SRAM area.  When a packet arrives,&n; * it is first placed into the on-chip ram.  When the packet&squot;s length&n; * is known, it walks down the TG3_BDINFO entries to select the ring.&n; * Each TG3_BDINFO specifies a MAXLEN field and the first TG3_BDINFO&n; * which is within the range of the new packet&squot;s length is chosen.&n; *&n; * The &quot;seperate ring for rx status&quot; scheme may sound queer, but it makes&n; * sense from a cache coherency perspective.  If only the host writes&n; * to the buffer post rings, and only the chip writes to the rx status&n; * rings, then cache lines never move beyond shared-modified state.&n; * If both the host and chip were to write into the same ring, cache line&n; * eviction could occur since both entities want it in an exclusive state.&n; */
DECL|function|tg3_rx
r_static
r_void
id|tg3_rx
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|work_mask
suffix:semicolon
id|u32
id|rx_rcb_ptr
op_assign
id|tp-&gt;rx_rcb_ptr
suffix:semicolon
id|u16
id|hw_idx
comma
id|sw_idx
suffix:semicolon
id|hw_idx
op_assign
id|tp-&gt;hw_status-&gt;idx
(braket
l_int|0
)braket
dot
id|rx_producer
suffix:semicolon
id|sw_idx
op_assign
id|rx_rcb_ptr
op_mod
id|TG3_RX_RCB_RING_SIZE
suffix:semicolon
id|work_mask
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sw_idx
op_ne
id|hw_idx
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|desc
op_assign
op_amp
id|tp-&gt;rx_rcb
(braket
id|sw_idx
)braket
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|dma_addr
suffix:semicolon
id|u32
id|opaque_key
comma
id|desc_idx
comma
op_star
id|post_ptr
suffix:semicolon
id|desc_idx
op_assign
id|desc-&gt;opaque
op_amp
id|RXD_OPAQUE_INDEX_MASK
suffix:semicolon
id|opaque_key
op_assign
id|desc-&gt;opaque
op_amp
id|RXD_OPAQUE_RING_MASK
suffix:semicolon
r_if
c_cond
(paren
id|opaque_key
op_eq
id|RXD_OPAQUE_RING_STD
)paren
(brace
id|dma_addr
op_assign
id|pci_unmap_addr
c_func
(paren
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|desc_idx
)braket
comma
id|mapping
)paren
suffix:semicolon
id|skb
op_assign
id|tp-&gt;rx_std_buffers
(braket
id|desc_idx
)braket
dot
id|skb
suffix:semicolon
id|post_ptr
op_assign
op_amp
id|tp-&gt;rx_std_ptr
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opaque_key
op_eq
id|RXD_OPAQUE_RING_JUMBO
)paren
(brace
id|dma_addr
op_assign
id|pci_unmap_addr
c_func
(paren
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|desc_idx
)braket
comma
id|mapping
)paren
suffix:semicolon
id|skb
op_assign
id|tp-&gt;rx_jumbo_buffers
(braket
id|desc_idx
)braket
dot
id|skb
suffix:semicolon
id|post_ptr
op_assign
op_amp
id|tp-&gt;rx_jumbo_ptr
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_else
r_if
c_cond
(paren
id|opaque_key
op_eq
id|RXD_OPAQUE_RING_MINI
)paren
(brace
id|dma_addr
op_assign
id|pci_unmap_addr
c_func
(paren
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|desc_idx
)braket
comma
id|mapping
)paren
suffix:semicolon
id|skb
op_assign
id|tp-&gt;rx_mini_buffers
(braket
id|desc_idx
)braket
dot
id|skb
suffix:semicolon
id|post_ptr
op_assign
op_amp
id|tp-&gt;rx_mini_ptr
suffix:semicolon
)brace
macro_line|#endif
r_else
(brace
r_goto
id|next_pkt_nopost
suffix:semicolon
)brace
id|work_mask
op_or_assign
id|opaque_key
suffix:semicolon
r_if
c_cond
(paren
(paren
id|desc-&gt;err_vlan
op_amp
id|RXD_ERR_MASK
)paren
op_ne
l_int|0
op_logical_and
(paren
id|desc-&gt;err_vlan
op_ne
id|RXD_ERR_ODD_NIBBLE_RCVD_MII
)paren
)paren
(brace
id|drop_it
suffix:colon
id|tg3_recycle_rx
c_func
(paren
id|tp
comma
id|opaque_key
comma
id|desc_idx
comma
op_star
id|post_ptr
)paren
suffix:semicolon
id|drop_it_no_recycle
suffix:colon
multiline_comment|/* Other statistics kept track of by card. */
id|tp-&gt;net_stats.rx_dropped
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
id|len
op_assign
(paren
(paren
id|desc-&gt;idx_len
op_amp
id|RXD_LEN_MASK
)paren
op_rshift
id|RXD_LEN_SHIFT
)paren
op_minus
l_int|4
suffix:semicolon
multiline_comment|/* omit crc */
multiline_comment|/* Kill the copy case if we ever get the mini ring working. */
r_if
c_cond
(paren
id|len
OG
id|RX_COPY_THRESHOLD
)paren
(brace
r_int
id|skb_size
suffix:semicolon
id|skb_size
op_assign
id|tg3_alloc_rx_skb
c_func
(paren
id|tp
comma
id|opaque_key
comma
id|desc_idx
comma
op_star
id|post_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_size
OL
l_int|0
)paren
r_goto
id|drop_it
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|dma_addr
comma
id|skb_size
op_minus
id|tp-&gt;rx_offset
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|copy_skb
suffix:semicolon
id|tg3_recycle_rx
c_func
(paren
id|tp
comma
id|opaque_key
comma
id|desc_idx
comma
op_star
id|post_ptr
)paren
suffix:semicolon
id|copy_skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_skb
op_eq
l_int|NULL
)paren
r_goto
id|drop_it_no_recycle
suffix:semicolon
id|copy_skb-&gt;dev
op_assign
id|tp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|copy_skb
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|copy_skb
comma
id|len
)paren
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|tp-&gt;pdev
comma
id|dma_addr
comma
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|copy_skb-&gt;data
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* We&squot;ll reuse the original ring buffer. */
id|skb
op_assign
id|copy_skb
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_RX_CHECKSUMS
)paren
op_logical_and
(paren
id|desc-&gt;type_flags
op_amp
id|RXD_FLAG_TCPUDP_CSUM
)paren
)paren
(brace
id|skb-&gt;csum
op_assign
id|htons
c_func
(paren
(paren
id|desc-&gt;ip_tcp_csum
op_amp
id|RXD_TCPCSUM_MASK
)paren
op_rshift
id|RXD_TCPCSUM_SHIFT
)paren
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_HW
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|tp-&gt;dev
)paren
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
r_if
c_cond
(paren
id|tp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
id|desc-&gt;type_flags
op_amp
id|RXD_FLAG_VLAN
)paren
(brace
id|tg3_vlan_rx
c_func
(paren
id|tp
comma
id|skb
comma
id|desc-&gt;err_vlan
op_amp
id|RXD_VLAN_MASK
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|next_pkt
suffix:colon
(paren
op_star
id|post_ptr
)paren
op_increment
suffix:semicolon
id|next_pkt_nopost
suffix:colon
id|rx_rcb_ptr
op_increment
suffix:semicolon
id|sw_idx
op_assign
id|rx_rcb_ptr
op_mod
id|TG3_RX_RCB_RING_SIZE
suffix:semicolon
)brace
multiline_comment|/* ACK the status ring. */
id|tp-&gt;rx_rcb_ptr
op_assign
id|rx_rcb_ptr
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCVRET_CON_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
id|rx_rcb_ptr
op_mod
id|TG3_RX_RCB_RING_SIZE
)paren
)paren
suffix:semicolon
multiline_comment|/* Refill RX ring(s). */
r_if
c_cond
(paren
id|work_mask
op_amp
id|RXD_OPAQUE_RING_STD
)paren
(brace
id|sw_idx
op_assign
id|tp-&gt;rx_std_ptr
op_mod
id|TG3_RX_RING_SIZE
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_STD_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|sw_idx
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|work_mask
op_amp
id|RXD_OPAQUE_RING_JUMBO
)paren
(brace
id|sw_idx
op_assign
id|tp-&gt;rx_jumbo_ptr
op_mod
id|TG3_RX_JUMBO_RING_SIZE
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_JUMBO_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|sw_idx
)paren
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_if
c_cond
(paren
id|work_mask
op_amp
id|RXD_OPAQUE_RING_MINI
)paren
(brace
id|sw_idx
op_assign
id|tp-&gt;rx_mini_ptr
op_mod
id|TG3_RX_MINI_RING_SIZE
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_MINI_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|sw_idx
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|macro|PKT_RATE_LOW
mdefine_line|#define PKT_RATE_LOW&t;&t;22000
DECL|macro|PKT_RATE_HIGH
mdefine_line|#define PKT_RATE_HIGH&t;&t;61000
DECL|function|tg3_rate_sample
r_static
r_void
id|tg3_rate_sample
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
r_int
id|ticks
)paren
(brace
id|u32
id|delta
comma
id|rx_now
comma
id|tx_now
suffix:semicolon
r_int
id|new_vals
comma
id|do_tx
comma
id|do_rx
suffix:semicolon
id|rx_now
op_assign
id|tp-&gt;hw_stats-&gt;rx_ucast_packets.low
suffix:semicolon
id|tx_now
op_assign
id|tp-&gt;hw_stats-&gt;COS_out_packets
(braket
l_int|0
)braket
dot
id|low
suffix:semicolon
id|delta
op_assign
(paren
id|rx_now
op_minus
id|tp-&gt;last_rx_count
)paren
suffix:semicolon
id|delta
op_add_assign
(paren
id|tx_now
op_minus
id|tp-&gt;last_tx_count
)paren
suffix:semicolon
id|delta
op_div_assign
(paren
id|ticks
op_div
id|tp-&gt;coalesce_config.rate_sample_jiffies
)paren
suffix:semicolon
id|tp-&gt;last_rx_count
op_assign
id|rx_now
suffix:semicolon
id|tp-&gt;last_tx_count
op_assign
id|tx_now
suffix:semicolon
id|new_vals
op_assign
l_int|0
suffix:semicolon
id|do_tx
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_ADAPTIVE_TX
)paren
op_ne
l_int|0
suffix:semicolon
id|do_rx
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_ADAPTIVE_RX
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
id|tp-&gt;coalesce_config.pkt_rate_low
)paren
(brace
r_if
c_cond
(paren
id|do_rx
op_logical_and
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_low
)paren
(brace
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|LOW_RXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks
op_assign
id|LOW_RXCOL_TICKS
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_tx
op_logical_and
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_low
)paren
(brace
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_low
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_low
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|delta
OL
id|tp-&gt;coalesce_config.pkt_rate_high
)paren
(brace
r_if
c_cond
(paren
id|do_rx
op_logical_and
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
)paren
(brace
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_tx
op_logical_and
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
)paren
(brace
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|do_rx
op_logical_and
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_high
)paren
(brace
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_high
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_high
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_tx
op_logical_and
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_ne
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_high
)paren
(brace
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_high
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_high
suffix:semicolon
id|new_vals
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|new_vals
)paren
(brace
r_if
c_cond
(paren
id|do_rx
)paren
(brace
id|tw32
c_func
(paren
id|HOSTCC_RXCOL_TICKS
comma
id|tp-&gt;coalesce_config.rx_coalesce_ticks
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_tx
)paren
(brace
id|tw32
c_func
(paren
id|HOSTCC_TXCOL_TICKS
comma
id|tp-&gt;coalesce_config.tx_coalesce_ticks
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
)paren
suffix:semicolon
)brace
)brace
id|tp-&gt;last_rate_sample
op_assign
id|jiffies
suffix:semicolon
)brace
DECL|function|tg3_interrupt_main_work
r_static
r_void
id|tg3_interrupt_main_work
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_struct
id|tg3_hw_status
op_star
id|sblk
op_assign
id|tp-&gt;hw_status
suffix:semicolon
r_int
id|did_pkts
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
(paren
id|TG3_FLAG_USE_LINKCHG_REG
op_or
id|TG3_FLAG_POLL_SERDES
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sblk-&gt;status
op_amp
id|SD_STATUS_LINK_CHG
)paren
(brace
id|sblk-&gt;status
op_assign
id|SD_STATUS_UPDATED
op_or
(paren
id|sblk-&gt;status
op_amp
op_complement
id|SD_STATUS_LINK_CHG
)paren
suffix:semicolon
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
)brace
id|did_pkts
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sblk-&gt;idx
(braket
l_int|0
)braket
dot
id|rx_producer
op_ne
id|tp-&gt;rx_rcb_ptr
)paren
(brace
id|tg3_rx
c_func
(paren
id|tp
)paren
suffix:semicolon
id|did_pkts
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sblk-&gt;idx
(braket
l_int|0
)braket
dot
id|tx_consumer
op_ne
id|tp-&gt;tx_cons
)paren
(brace
id|tg3_tx
c_func
(paren
id|tp
)paren
suffix:semicolon
id|did_pkts
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|did_pkts
op_logical_and
(paren
id|tp-&gt;tg3_flags
op_amp
(paren
id|TG3_FLAG_ADAPTIVE_RX
op_or
id|TG3_FLAG_ADAPTIVE_TX
)paren
)paren
)paren
(brace
r_int
r_int
id|ticks
op_assign
id|jiffies
op_minus
id|tp-&gt;last_rate_sample
suffix:semicolon
r_if
c_cond
(paren
id|ticks
op_ge
id|tp-&gt;coalesce_config.rate_sample_jiffies
)paren
id|tg3_rate_sample
c_func
(paren
id|tp
comma
id|ticks
)paren
suffix:semicolon
)brace
)brace
DECL|function|tg3_interrupt
r_static
r_void
id|tg3_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tg3_hw_status
op_star
id|sblk
op_assign
id|tp-&gt;hw_status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|sblk-&gt;status
op_amp
id|SD_STATUS_UPDATED
)paren
(brace
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0x00000001
)paren
suffix:semicolon
id|sblk-&gt;status
op_and_assign
op_complement
id|SD_STATUS_UPDATED
suffix:semicolon
id|tg3_interrupt_main_work
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0x00000000
)paren
suffix:semicolon
id|tr32
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|tg3_interrupt_tagged
r_static
r_void
id|tg3_interrupt_tagged
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tg3_hw_status
op_star
id|sblk
op_assign
id|tp-&gt;hw_status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sblk-&gt;status
op_amp
id|SD_STATUS_UPDATED
)paren
(brace
id|u32
id|oldtag
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0x00000001
)paren
suffix:semicolon
id|oldtag
op_assign
id|sblk-&gt;status_tag
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|u32
id|newtag
suffix:semicolon
id|sblk-&gt;status
op_and_assign
op_complement
id|SD_STATUS_UPDATED
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|tg3_interrupt_main_work
c_func
(paren
id|tp
)paren
suffix:semicolon
id|newtag
op_assign
id|sblk-&gt;status_tag
suffix:semicolon
r_if
c_cond
(paren
id|newtag
op_eq
id|oldtag
)paren
(brace
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
id|newtag
op_lshift
l_int|24
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|oldtag
op_assign
id|newtag
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_void
id|tg3_init_rings
c_func
(paren
r_struct
id|tg3
op_star
)paren
suffix:semicolon
r_static
r_int
id|tg3_init_hw
c_func
(paren
r_struct
id|tg3
op_star
)paren
suffix:semicolon
DECL|function|tg3_tx_timeout
r_static
r_void
id|tg3_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: transmit timed out, resetting&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#if !PCI_DMA_BUS_IS_PHYS
DECL|function|tg3_set_txd_addr
r_static
r_void
id|tg3_set_txd_addr
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|entry
comma
id|dma_addr_t
id|mapping
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
r_struct
id|tg3_tx_buffer_desc
op_star
id|txd
op_assign
op_amp
id|tp-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|txd-&gt;addr_hi
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
suffix:semicolon
id|txd-&gt;addr_lo
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|txd
suffix:semicolon
id|txd
op_assign
(paren
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_TX_BUFFER_DESC
)paren
suffix:semicolon
id|txd
op_add_assign
(paren
id|entry
op_star
id|TXD_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
id|dma_addr_t
)paren
op_ne
r_sizeof
(paren
id|u32
)paren
)paren
id|writel
c_func
(paren
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
comma
id|txd
op_plus
id|TXD_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
comma
id|txd
op_plus
id|TXD_ADDR
op_plus
id|TG3_64BIT_REG_LOW
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_static
r_void
id|tg3_set_txd
c_func
(paren
r_struct
id|tg3
op_star
comma
r_int
comma
id|dma_addr_t
comma
r_int
comma
id|u32
comma
r_int
)paren
suffix:semicolon
DECL|function|tigon3_4gb_hwbug_workaround
r_static
r_int
id|tigon3_4gb_hwbug_workaround
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|guilty_entry
comma
r_int
id|guilty_len
comma
id|u32
id|last_plus_one
comma
id|u32
op_star
id|start
)paren
(brace
id|dma_addr_t
id|new_addr
suffix:semicolon
id|u32
id|entry
op_assign
op_star
id|start
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#if !PCI_DMA_BUS_IS_PHYS
multiline_comment|/* IOMMU, just map the guilty area again which is guarenteed to&n;&t; * use different addresses.&n;&t; */
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
id|guilty_entry
)paren
(brace
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|new_addr
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|guilty_len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
)brace
r_else
(brace
id|skb_frag_t
op_star
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|new_addr
op_assign
id|pci_map_page
c_func
(paren
id|tp-&gt;pdev
comma
id|frag-&gt;page
comma
id|frag-&gt;page_offset
comma
id|guilty_len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|guilty_entry
)braket
comma
id|mapping
)paren
comma
id|guilty_len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tg3_set_txd_addr
c_func
(paren
id|tp
comma
id|guilty_entry
comma
id|new_addr
)paren
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|guilty_entry
)braket
comma
id|mapping
comma
id|new_addr
)paren
suffix:semicolon
op_star
id|start
op_assign
id|last_plus_one
suffix:semicolon
macro_line|#else
multiline_comment|/* Oh well, no IOMMU, have to allocate a whole new SKB. */
r_struct
id|sk_buff
op_star
id|new_skb
op_assign
id|skb_copy
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* NOTE: Broadcom&squot;s driver botches this case up really bad.&n;&t; *       This is especially true if any of the frag pages&n;&t; *       are in highmem.  It will instantly oops in that case.&n;&t; */
multiline_comment|/* New SKB is guarenteed to be linear. */
id|entry
op_assign
op_star
id|start
suffix:semicolon
id|new_addr
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|new_skb-&gt;data
comma
id|new_skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tg3_set_txd
c_func
(paren
id|tp
comma
id|entry
comma
id|new_addr
comma
id|new_skb-&gt;len
comma
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
ques
c_cond
id|TXD_FLAG_TCPUDP_CSUM
suffix:colon
l_int|0
comma
l_int|1
)paren
suffix:semicolon
op_star
id|start
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* Now clean up the sw ring entries. */
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
id|last_plus_one
)paren
(brace
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|len
op_assign
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
suffix:semicolon
r_else
id|len
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|size
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
)paren
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|new_skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|new_addr
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
)brace
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_set_txd
r_static
r_void
id|tg3_set_txd
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
id|entry
comma
id|dma_addr_t
id|mapping
comma
r_int
id|len
comma
id|u32
id|flags
comma
r_int
id|is_end
)paren
(brace
macro_line|#if TG3_VLAN_TAG_USED
id|u16
id|vlan_tag
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|is_end
)paren
id|flags
op_or_assign
id|TXD_FLAG_END
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
r_if
c_cond
(paren
id|flags
op_amp
id|TXD_FLAG_VLAN
)paren
(brace
id|vlan_tag
op_assign
id|flags
op_rshift
l_int|16
suffix:semicolon
id|flags
op_and_assign
l_int|0xffff
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
r_struct
id|tg3_tx_buffer_desc
op_star
id|txd
op_assign
op_amp
id|tp-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|txd-&gt;addr_hi
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
suffix:semicolon
id|txd-&gt;addr_lo
op_assign
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|txd-&gt;len_flags
op_assign
(paren
id|len
op_lshift
id|TXD_LEN_SHIFT
)paren
op_or
id|flags
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
id|txd-&gt;vlan_tag
op_assign
id|vlan_tag
op_lshift
id|TXD_VLAN_TAG_SHIFT
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_int
r_int
id|txd
suffix:semicolon
id|txd
op_assign
(paren
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_TX_BUFFER_DESC
)paren
suffix:semicolon
id|txd
op_add_assign
(paren
id|entry
op_star
id|TXD_SIZE
)paren
suffix:semicolon
multiline_comment|/* Save some PIOs */
r_if
c_cond
(paren
r_sizeof
(paren
id|dma_addr_t
)paren
op_ne
r_sizeof
(paren
id|u32
)paren
)paren
id|writel
c_func
(paren
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
comma
id|txd
op_plus
id|TXD_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
comma
id|txd
op_plus
id|TXD_ADDR
op_plus
id|TG3_64BIT_REG_LOW
)paren
suffix:semicolon
id|writel
c_func
(paren
id|len
op_lshift
id|TXD_LEN_SHIFT
op_or
id|flags
comma
id|txd
op_plus
id|TXD_LEN_FLAGS
)paren
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
id|writel
c_func
(paren
id|vlan_tag
op_lshift
id|TXD_VLAN_TAG_SHIFT
comma
id|txd
op_plus
id|TXD_VLAN_TAG
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
DECL|function|tg3_4g_overflow_test
r_static
r_inline
r_int
id|tg3_4g_overflow_test
c_func
(paren
id|dma_addr_t
id|mapping
comma
r_int
id|len
)paren
(brace
id|u32
id|base
op_assign
(paren
id|u32
)paren
id|mapping
op_amp
l_int|0xffffffff
suffix:semicolon
r_return
(paren
(paren
id|base
OG
l_int|0xffffdcc0
)paren
op_logical_and
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
op_eq
l_int|0
op_logical_and
(paren
id|base
op_plus
id|len
op_plus
l_int|8
OL
id|base
)paren
)paren
suffix:semicolon
)brace
DECL|function|tg3_start_xmit_4gbug
r_static
r_int
id|tg3_start_xmit_4gbug
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u32
id|len
comma
id|entry
comma
id|base_flags
suffix:semicolon
r_int
id|would_hit_hwbug
suffix:semicolon
id|len
op_assign
(paren
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* This is a hard error, log it. */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|tp
)paren
op_le
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: BUG! Tx Ring full when queue awake!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|entry
op_assign
id|tp-&gt;tx_prod
suffix:semicolon
id|base_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
id|base_flags
op_or_assign
id|TXD_FLAG_TCPUDP_CSUM
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
r_if
c_cond
(paren
id|tp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
id|base_flags
op_or_assign
(paren
id|TXD_FLAG_VLAN
op_or
(paren
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Queue skb data, a.k.a. the main skb fragment. */
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
id|would_hit_hwbug
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tg3_4g_overflow_test
c_func
(paren
id|mapping
comma
id|len
)paren
)paren
id|would_hit_hwbug
op_assign
id|entry
op_plus
l_int|1
suffix:semicolon
id|tg3_set_txd
c_func
(paren
id|tp
comma
id|entry
comma
id|mapping
comma
id|len
comma
id|base_flags
comma
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_eq
l_int|0
)paren
)paren
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* Now loop through additional data fragments, and queue them. */
r_if
c_cond
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
OG
l_int|0
)paren
(brace
r_int
r_int
id|i
comma
id|last
suffix:semicolon
id|last
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|last
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb_frag_t
op_star
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
suffix:semicolon
id|len
op_assign
id|frag-&gt;size
suffix:semicolon
id|mapping
op_assign
id|pci_map_page
c_func
(paren
id|tp-&gt;pdev
comma
id|frag-&gt;page
comma
id|frag-&gt;page_offset
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tg3_4g_overflow_test
c_func
(paren
id|mapping
comma
id|len
)paren
)paren
(brace
multiline_comment|/* Only one should match. */
r_if
c_cond
(paren
id|would_hit_hwbug
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|would_hit_hwbug
op_assign
id|entry
op_plus
l_int|1
suffix:semicolon
)brace
id|tg3_set_txd
c_func
(paren
id|tp
comma
id|entry
comma
id|mapping
comma
id|len
comma
id|base_flags
comma
(paren
id|i
op_eq
id|last
)paren
)paren
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|would_hit_hwbug
)paren
(brace
id|u32
id|last_plus_one
op_assign
id|entry
suffix:semicolon
id|u32
id|start
suffix:semicolon
r_int
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|would_hit_hwbug
op_sub_assign
l_int|1
suffix:semicolon
id|entry
op_assign
id|entry
op_minus
l_int|1
op_minus
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|entry
op_and_assign
(paren
id|TG3_TX_RING_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|start
op_assign
id|entry
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
id|last_plus_one
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|len
op_assign
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
suffix:semicolon
r_else
id|len
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
op_minus
l_int|1
)braket
dot
id|size
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
id|would_hit_hwbug
)paren
r_break
suffix:semicolon
id|i
op_increment
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
multiline_comment|/* If the workaround fails due to memory/mapping&n;&t;&t; * failure, silently drop this packet.&n;&t;&t; */
r_if
c_cond
(paren
id|tigon3_4gb_hwbug_workaround
c_func
(paren
id|tp
comma
id|skb
comma
id|entry
comma
id|len
comma
id|last_plus_one
comma
op_amp
id|start
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
id|entry
op_assign
id|start
suffix:semicolon
)brace
multiline_comment|/* Packets are ready, update Tx producer idx local and on card. */
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TXD_MBOX_HWBUG
)paren
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TXD_MBOX_HWBUG
)paren
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_prod
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|tp
)paren
op_le
(paren
id|MAX_SKB_FRAGS
op_plus
l_int|1
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_start_xmit
r_static
r_int
id|tg3_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
id|u32
id|len
comma
id|entry
comma
id|base_flags
suffix:semicolon
id|len
op_assign
(paren
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* This is a hard error, log it. */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|tp
)paren
op_le
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: BUG! Tx Ring full when queue awake!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|entry
op_assign
id|tp-&gt;tx_prod
suffix:semicolon
id|base_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
id|base_flags
op_or_assign
id|TXD_FLAG_TCPUDP_CSUM
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
r_if
c_cond
(paren
id|tp-&gt;vlgrp
op_ne
l_int|NULL
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
id|base_flags
op_or_assign
(paren
id|TXD_FLAG_VLAN
op_or
(paren
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Queue skb data, a.k.a. the main skb fragment. */
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
id|tg3_set_txd
c_func
(paren
id|tp
comma
id|entry
comma
id|mapping
comma
id|len
comma
id|base_flags
comma
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_eq
l_int|0
)paren
)paren
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
multiline_comment|/* Now loop through additional data fragments, and queue them. */
r_if
c_cond
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
OG
l_int|0
)paren
(brace
r_int
r_int
id|i
comma
id|last
suffix:semicolon
id|last
op_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|last
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb_frag_t
op_star
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
suffix:semicolon
id|len
op_assign
id|frag-&gt;size
suffix:semicolon
id|mapping
op_assign
id|pci_map_page
c_func
(paren
id|tp-&gt;pdev
comma
id|frag-&gt;page
comma
id|frag-&gt;page_offset
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|pci_unmap_addr_set
c_func
(paren
op_amp
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
comma
id|mapping
comma
id|mapping
)paren
suffix:semicolon
id|tg3_set_txd
c_func
(paren
id|tp
comma
id|entry
comma
id|mapping
comma
id|len
comma
id|base_flags
comma
(paren
id|i
op_eq
id|last
)paren
)paren
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Packets are ready, update Tx producer idx local and on card.&n;&t; * We know this is not a 5700 (by virtue of not being a chip&n;&t; * requiring the 4GB overflow workaround) so we can safely omit&n;&t; * the double-write bug tests.&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32_mailbox
c_func
(paren
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
id|entry
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_prod
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|tp
)paren
op_le
(paren
id|MAX_SKB_FRAGS
op_plus
l_int|1
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_change_mtu
r_static
r_int
id|tg3_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
template_param
id|TG3_MAX_MTU
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* We&squot;ll just catch it later when the&n;&t;&t; * device is up&squot;d.&n;&t;&t; */
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OG
id|ETH_DATA_LEN
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_JUMBO_ENABLE
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_JUMBO_ENABLE
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Free up pending packets in all rx/tx rings.&n; *&n; * The chip has been shut down and the driver detached from&n; * the networking, so no interrupts or new tx packets will&n; * end up in the driver.  tp-&gt;lock is not held and we are not&n; * in an interrupt context and thus may sleep.&n; */
DECL|function|tg3_free_rings
r_static
r_void
id|tg3_free_rings
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_struct
id|ring_info
op_star
id|rxp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rxp
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rxp-&gt;skb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rxp
comma
id|mapping
)paren
comma
id|RX_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|rxp-&gt;skb
)paren
suffix:semicolon
id|rxp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_MINI_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rxp
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rxp-&gt;skb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rxp
comma
id|mapping
)paren
comma
id|RX_MINI_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|rxp-&gt;skb
)paren
suffix:semicolon
id|rxp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_JUMBO_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rxp
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rxp-&gt;skb
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|rxp
comma
id|mapping
)paren
comma
id|RX_JUMBO_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|rxp-&gt;skb
)paren
suffix:semicolon
id|rxp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_TX_RING_SIZE
suffix:semicolon
)paren
(brace
r_struct
id|ring_info
op_star
id|txp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|j
suffix:semicolon
id|txp
op_assign
op_amp
id|tp-&gt;tx_buffers
(braket
id|i
)braket
suffix:semicolon
id|skb
op_assign
id|txp-&gt;skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|i
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|txp
comma
id|mapping
)paren
comma
(paren
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|txp-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|i
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|j
op_increment
)paren
(brace
id|txp
op_assign
op_amp
id|tp-&gt;tx_buffers
(braket
id|i
op_amp
(paren
id|TG3_TX_RING_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|pci_unmap_page
c_func
(paren
id|tp-&gt;pdev
comma
id|pci_unmap_addr
c_func
(paren
id|txp
comma
id|mapping
)paren
comma
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|j
)braket
dot
id|size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize tx/rx rings for packet processing.&n; *&n; * The chip has been shut down and the driver detached from&n; * the networking, so no interrupts or new tx packets will&n; * end up in the driver.  tp-&gt;lock is not held and we are not&n; * in an interrupt context and thus may sleep.&n; */
DECL|function|tg3_init_rings
r_static
r_void
id|tg3_init_rings
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
r_int
id|start
comma
id|end
suffix:semicolon
id|u32
id|i
suffix:semicolon
multiline_comment|/* Free up all the SKBs. */
id|tg3_free_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
multiline_comment|/* Zero out all descriptors. */
id|memset
c_func
(paren
id|tp-&gt;rx_std
comma
l_int|0
comma
id|TG3_RX_RING_BYTES
)paren
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|memset
c_func
(paren
id|tp-&gt;rx_mini
comma
l_int|0
comma
id|TG3_RX_MINI_RING_BYTES
)paren
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|tp-&gt;rx_jumbo
comma
l_int|0
comma
id|TG3_RX_JUMBO_RING_BYTES
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;rx_rcb
comma
l_int|0
comma
id|TG3_RX_RCB_RING_BYTES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
id|memset
c_func
(paren
id|tp-&gt;tx_ring
comma
l_int|0
comma
id|TG3_TX_RING_BYTES
)paren
suffix:semicolon
)brace
r_else
(brace
id|start
op_assign
(paren
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_TX_BUFFER_DESC
)paren
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|TG3_TX_RING_BYTES
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|start
)paren
suffix:semicolon
id|start
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize invariants of the rings, we only set this&n;&t; * stuff once.  This works because the card does not&n;&t; * write into the rx buffer posting rings.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|rxd
suffix:semicolon
id|rxd
op_assign
op_amp
id|tp-&gt;rx_std
(braket
id|i
)braket
suffix:semicolon
id|rxd-&gt;idx_len
op_assign
(paren
id|RX_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
op_minus
l_int|64
)paren
op_lshift
id|RXD_LEN_SHIFT
suffix:semicolon
id|rxd-&gt;type_flags
op_assign
(paren
id|RXD_FLAG_END
op_lshift
id|RXD_FLAGS_SHIFT
)paren
suffix:semicolon
id|rxd-&gt;opaque
op_assign
(paren
id|RXD_OPAQUE_RING_STD
op_or
(paren
id|i
op_lshift
id|RXD_OPAQUE_INDEX_SHIFT
)paren
)paren
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_MINI_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|rxd
suffix:semicolon
id|rxd
op_assign
op_amp
id|tp-&gt;rx_mini
(braket
id|i
)braket
suffix:semicolon
id|rxd-&gt;idx_len
op_assign
(paren
id|RX_MINI_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
op_minus
l_int|64
)paren
op_lshift
id|RXD_LEN_SHIFT
suffix:semicolon
id|rxd-&gt;type_flags
op_assign
(paren
id|RXD_FLAG_END
op_lshift
id|RXD_FLAGS_SHIFT
)paren
op_or
id|RXD_FLAG_MINI
suffix:semicolon
id|rxd-&gt;opaque
op_assign
(paren
id|RXD_OPAQUE_RING_MINI
op_or
(paren
id|i
op_lshift
id|RXD_OPAQUE_INDEX_SHIFT
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_JUMBO_ENABLE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TG3_RX_JUMBO_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|tg3_rx_buffer_desc
op_star
id|rxd
suffix:semicolon
id|rxd
op_assign
op_amp
id|tp-&gt;rx_jumbo
(braket
id|i
)braket
suffix:semicolon
id|rxd-&gt;idx_len
op_assign
(paren
id|RX_JUMBO_PKT_BUF_SZ
op_minus
id|tp-&gt;rx_offset
op_minus
l_int|64
)paren
op_lshift
id|RXD_LEN_SHIFT
suffix:semicolon
id|rxd-&gt;type_flags
op_assign
(paren
id|RXD_FLAG_END
op_lshift
id|RXD_FLAGS_SHIFT
)paren
op_or
id|RXD_FLAG_JUMBO
suffix:semicolon
id|rxd-&gt;opaque
op_assign
(paren
id|RXD_OPAQUE_RING_JUMBO
op_or
(paren
id|i
op_lshift
id|RXD_OPAQUE_INDEX_SHIFT
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Now allocate fresh SKBs for each rx ring. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;rx_pending
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tg3_alloc_rx_skb
c_func
(paren
id|tp
comma
id|RXD_OPAQUE_RING_STD
comma
op_minus
l_int|1
comma
id|i
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;rx_mini_pending
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tg3_alloc_rx_skb
c_func
(paren
id|tp
comma
id|RXD_OPAQUE_RING_MINI
comma
op_minus
l_int|1
comma
id|i
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_JUMBO_ENABLE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;rx_jumbo_pending
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tg3_alloc_rx_skb
c_func
(paren
id|tp
comma
id|RXD_OPAQUE_RING_JUMBO
comma
op_minus
l_int|1
comma
id|i
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Must not be invoked with interrupt sources disabled and&n; * the hardware shutdown down.&n; */
DECL|function|tg3_free_consistent
r_static
r_void
id|tg3_free_consistent
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;rx_std_buffers
)paren
(brace
id|kfree
c_func
(paren
id|tp-&gt;rx_std_buffers
)paren
suffix:semicolon
id|tp-&gt;rx_std_buffers
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;rx_std
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_RING_BYTES
comma
id|tp-&gt;rx_std
comma
id|tp-&gt;rx_std_mapping
)paren
suffix:semicolon
id|tp-&gt;rx_std
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_if
c_cond
(paren
id|tp-&gt;rx_mini
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_MINI_RING_BYTES
comma
id|tp-&gt;rx_mini
comma
id|tp-&gt;rx_mini_mapping
)paren
suffix:semicolon
id|tp-&gt;rx_mini
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;rx_jumbo
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_JUMBO_RING_BYTES
comma
id|tp-&gt;rx_jumbo
comma
id|tp-&gt;rx_jumbo_mapping
)paren
suffix:semicolon
id|tp-&gt;rx_jumbo
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;rx_rcb
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_RCB_RING_BYTES
comma
id|tp-&gt;rx_rcb
comma
id|tp-&gt;rx_rcb_mapping
)paren
suffix:semicolon
id|tp-&gt;rx_rcb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;tx_ring
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_TX_RING_BYTES
comma
id|tp-&gt;tx_ring
comma
id|tp-&gt;tx_desc_mapping
)paren
suffix:semicolon
id|tp-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;hw_status
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_HW_STATUS_SIZE
comma
id|tp-&gt;hw_status
comma
id|tp-&gt;status_mapping
)paren
suffix:semicolon
id|tp-&gt;hw_status
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;hw_stats
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
r_sizeof
(paren
r_struct
id|tg3_hw_stats
)paren
comma
id|tp-&gt;hw_stats
comma
id|tp-&gt;stats_mapping
)paren
suffix:semicolon
id|tp-&gt;hw_stats
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Must not be invoked with interrupt sources disabled and&n; * the hardware shutdown down.  Can sleep.&n; */
DECL|function|tg3_alloc_consistent
r_static
r_int
id|tg3_alloc_consistent
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tp-&gt;rx_std_buffers
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
(paren
id|TG3_RX_RING_SIZE
op_plus
macro_line|#if TG3_MINI_RING_WORKS
id|TG3_RX_MINI_RING_SIZE
op_plus
macro_line|#endif
id|TG3_RX_JUMBO_RING_SIZE
op_plus
id|TG3_TX_RING_SIZE
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_std_buffers
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|memset
c_func
(paren
id|tp-&gt;rx_std_buffers
comma
l_int|0
comma
(paren
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
(paren
id|TG3_RX_RING_SIZE
op_plus
id|TG3_RX_MINI_RING_SIZE
op_plus
id|TG3_RX_JUMBO_RING_SIZE
op_plus
id|TG3_TX_RING_SIZE
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
id|tp-&gt;rx_std_buffers
comma
l_int|0
comma
(paren
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
(paren
id|TG3_RX_RING_SIZE
op_plus
id|TG3_RX_JUMBO_RING_SIZE
op_plus
id|TG3_TX_RING_SIZE
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if TG3_MINI_RING_WORKS
id|tp-&gt;rx_mini_buffers
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|TG3_RX_RING_SIZE
)braket
suffix:semicolon
id|tp-&gt;rx_jumbo_buffers
op_assign
op_amp
id|tp-&gt;rx_mini_buffers
(braket
id|TG3_RX_MINI_RING_SIZE
)braket
suffix:semicolon
macro_line|#else
id|tp-&gt;rx_jumbo_buffers
op_assign
op_amp
id|tp-&gt;rx_std_buffers
(braket
id|TG3_RX_RING_SIZE
)braket
suffix:semicolon
macro_line|#endif
id|tp-&gt;tx_buffers
op_assign
op_amp
id|tp-&gt;rx_jumbo_buffers
(braket
id|TG3_RX_JUMBO_RING_SIZE
)braket
suffix:semicolon
id|tp-&gt;rx_std
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_RING_BYTES
comma
op_amp
id|tp-&gt;rx_std_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_std
)paren
r_goto
id|err_out
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tp-&gt;rx_mini
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_MINI_RING_BYTES
comma
op_amp
id|tp-&gt;rx_mini_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_mini
)paren
r_goto
id|err_out
suffix:semicolon
macro_line|#endif
id|tp-&gt;rx_jumbo
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_JUMBO_RING_BYTES
comma
op_amp
id|tp-&gt;rx_jumbo_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_jumbo
)paren
r_goto
id|err_out
suffix:semicolon
id|tp-&gt;rx_rcb
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_RX_RCB_RING_BYTES
comma
op_amp
id|tp-&gt;rx_rcb_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_rcb
)paren
r_goto
id|err_out
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
id|tp-&gt;tx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_TX_RING_BYTES
comma
op_amp
id|tp-&gt;tx_desc_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;tx_ring
)paren
r_goto
id|err_out
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_desc_mapping
op_assign
l_int|0
suffix:semicolon
)brace
id|tp-&gt;hw_status
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3_HW_STATUS_SIZE
comma
op_amp
id|tp-&gt;status_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;hw_status
)paren
r_goto
id|err_out
suffix:semicolon
id|tp-&gt;hw_stats
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
r_sizeof
(paren
r_struct
id|tg3_hw_stats
)paren
comma
op_amp
id|tp-&gt;stats_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;hw_stats
)paren
r_goto
id|err_out
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;hw_status
comma
l_int|0
comma
id|TG3_HW_STATUS_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;hw_stats
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tg3_hw_stats
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|tg3_free_consistent
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|macro|MAX_WAIT_CNT
mdefine_line|#define MAX_WAIT_CNT 1000
multiline_comment|/* To stop a block, clear the enable bit and poll till it&n; * clears.  tp-&gt;lock is held.&n; */
DECL|function|tg3_stop_block
r_static
r_int
id|tg3_stop_block
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
r_int
id|ofs
comma
id|u32
id|enable_bit
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|tr32
c_func
(paren
id|ofs
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|enable_bit
suffix:semicolon
id|tw32
c_func
(paren
id|ofs
comma
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_WAIT_CNT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|tr32
c_func
(paren
id|ofs
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|enable_bit
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|MAX_WAIT_CNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_stop_block timed out, &quot;
l_string|&quot;ofs=%lx enable_bit=%x&bslash;n&quot;
comma
id|ofs
comma
id|enable_bit
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_abort_hw
r_static
r_int
id|tg3_abort_hw
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
id|tg3_disable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tp-&gt;rx_mode
op_and_assign
op_complement
id|RX_MODE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RX_MODE
comma
id|tp-&gt;rx_mode
)paren
suffix:semicolon
id|err
op_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVBDI_MODE
comma
id|RCVBDI_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVLPC_MODE
comma
id|RCVLPC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVLSC_MODE
comma
id|RCVLSC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVDBDI_MODE
comma
id|RCVDBDI_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVDCC_MODE
comma
id|RCVDCC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RCVCC_MODE
comma
id|RCVCC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|SNDBDS_MODE
comma
id|SNDBDS_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|SNDBDI_MODE
comma
id|SNDBDI_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|SNDDATAI_MODE
comma
id|SNDDATAI_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|RDMAC_MODE
comma
id|RDMAC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|SNDDATAC_MODE
comma
id|SNDDATAC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|SNDBDC_MODE
comma
id|SNDBDC_MODE_ENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|tp-&gt;mac_mode
op_and_assign
op_complement
id|MAC_MODE_TDE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|tp-&gt;tx_mode
op_and_assign
op_complement
id|TX_MODE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_MODE
comma
id|tp-&gt;tx_mode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_WAIT_CNT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tr32
c_func
(paren
id|MAC_TX_MODE
)paren
op_amp
id|TX_MODE_ENABLE
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
id|MAX_WAIT_CNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_abort_hw timed out for %s, &quot;
l_string|&quot;TX_MODE_ENABLE will not clear MAC_TX_MODE=%08x&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
id|tr32
c_func
(paren
id|MAC_TX_MODE
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|err
op_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|HOSTCC_MODE
comma
id|HOSTCC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|WDMAC_MODE
comma
id|WDMAC_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|MBFREE_MODE
comma
id|MBFREE_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RESET
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RESET
comma
l_int|0x00000000
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|BUFMGR_MODE
comma
id|BUFMGR_MODE_ENABLE
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_stop_block
c_func
(paren
id|tp
comma
id|MEMARB_MODE
comma
id|MEMARB_MODE_ENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;hw_status
comma
l_int|0
comma
id|TG3_HW_STATUS_SIZE
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_chip_reset
r_static
r_void
id|tg3_chip_reset
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|val
suffix:semicolon
multiline_comment|/* Force NVRAM to settle.&n;&t; * This deals with a chip bug which can result in EEPROM&n;&t; * corruption.&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_NVRAM
)paren
(brace
r_int
id|i
suffix:semicolon
id|tw32
c_func
(paren
id|NVRAM_SWARB
comma
id|SWARB_REQ_SET1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|NVRAM_SWARB
)paren
op_amp
id|SWARB_GNT1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
id|tw32
c_func
(paren
id|GRC_MISC_CFG
comma
id|GRC_MISC_CFG_CORECLK_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
multiline_comment|/* Re-enable indirect register accesses. */
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MISC_HOST_CTRL
comma
id|tp-&gt;misc_host_ctrl
)paren
suffix:semicolon
multiline_comment|/* Set MAX PCI retry to zero. */
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PCISTATE
comma
(paren
id|PCISTATE_ROM_ENABLE
op_or
id|PCISTATE_ROM_RETRY_ENABLE
)paren
)paren
suffix:semicolon
id|pci_restore_state
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;pci_cfg_state
)paren
suffix:semicolon
multiline_comment|/* Make sure PCI-X relaxed ordering bit is clear. */
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_X_CAPS
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|PCIX_CAPS_RELAXED_ORDERING
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_X_CAPS
comma
id|val
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MEMARB_MODE
comma
id|MEMARB_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_MISC_HOST_CTRL
comma
id|tp-&gt;misc_host_ctrl
)paren
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_halt
r_static
r_int
id|tg3_halt
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tg3_abort_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_chip_reset
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_FIRMWARE_MBOX
comma
id|NIC_SRAM_FIRMWARE_MBOX_MAGIC1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_FIRMWARE_MBOX
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
op_complement
id|NIC_SRAM_FIRMWARE_MBOX_MAGIC1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|100000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_halt timed out for %s, &quot;
l_string|&quot;firmware will not restart magic=%08x&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|TG3_FW_RELEASE_MAJOR
mdefine_line|#define TG3_FW_RELEASE_MAJOR&t;0x0
DECL|macro|TG3_FW_RELASE_MINOR
mdefine_line|#define TG3_FW_RELASE_MINOR&t;0x0
DECL|macro|TG3_FW_RELEASE_FIX
mdefine_line|#define TG3_FW_RELEASE_FIX&t;0x0
DECL|macro|TG3_FW_START_ADDR
mdefine_line|#define TG3_FW_START_ADDR&t;0x08000000
DECL|macro|TG3_FW_TEXT_ADDR
mdefine_line|#define TG3_FW_TEXT_ADDR&t;0x08000000
DECL|macro|TG3_FW_TEXT_LEN
mdefine_line|#define TG3_FW_TEXT_LEN&t;&t;0x9c0
DECL|macro|TG3_FW_RODATA_ADDR
mdefine_line|#define TG3_FW_RODATA_ADDR&t;0x080009c0
DECL|macro|TG3_FW_RODATA_LEN
mdefine_line|#define TG3_FW_RODATA_LEN&t;0x60
DECL|macro|TG3_FW_DATA_ADDR
mdefine_line|#define TG3_FW_DATA_ADDR&t;0x08000a40
DECL|macro|TG3_FW_DATA_LEN
mdefine_line|#define TG3_FW_DATA_LEN&t;&t;0x20
DECL|macro|TG3_FW_SBSS_ADDR
mdefine_line|#define TG3_FW_SBSS_ADDR&t;0x08000a60
DECL|macro|TG3_FW_SBSS_LEN
mdefine_line|#define TG3_FW_SBSS_LEN&t;&t;0xc
DECL|macro|TG3_FW_BSS_ADDR
mdefine_line|#define TG3_FW_BSS_ADDR&t;&t;0x08000a70
DECL|macro|TG3_FW_BSS_LEN
mdefine_line|#define TG3_FW_BSS_LEN&t;&t;0x10
DECL|variable|t3FwText
r_static
id|u32
id|t3FwText
(braket
(paren
id|TG3_FW_TEXT_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
op_plus
l_int|1
)braket
op_assign
(brace
l_int|0x00000000
comma
l_int|0x10000003
comma
l_int|0x00000000
comma
l_int|0x0000000d
comma
l_int|0x0000000d
comma
l_int|0x3c1d0800
comma
l_int|0x37bd3ffc
comma
l_int|0x03a0f021
comma
l_int|0x3c100800
comma
l_int|0x26100000
comma
l_int|0x0e000018
comma
l_int|0x00000000
comma
l_int|0x0000000d
comma
l_int|0x3c1d0800
comma
l_int|0x37bd3ffc
comma
l_int|0x03a0f021
comma
l_int|0x3c100800
comma
l_int|0x26100034
comma
l_int|0x0e00021c
comma
l_int|0x00000000
comma
l_int|0x0000000d
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x27bdffe0
comma
l_int|0x3c1cc000
comma
l_int|0xafbf0018
comma
l_int|0xaf80680c
comma
l_int|0x0e00004c
comma
l_int|0x241b2105
comma
l_int|0x97850000
comma
l_int|0x97870002
comma
l_int|0x9782002c
comma
l_int|0x9783002e
comma
l_int|0x3c040800
comma
l_int|0x248409c0
comma
l_int|0xafa00014
comma
l_int|0x00021400
comma
l_int|0x00621825
comma
l_int|0x00052c00
comma
l_int|0xafa30010
comma
l_int|0x8f860010
comma
l_int|0x00e52825
comma
l_int|0x0e000060
comma
l_int|0x24070102
comma
l_int|0x3c02ac00
comma
l_int|0x34420100
comma
l_int|0x3c03ac01
comma
l_int|0x34630100
comma
l_int|0xaf820490
comma
l_int|0x3c02ffff
comma
l_int|0xaf820494
comma
l_int|0xaf830498
comma
l_int|0xaf82049c
comma
l_int|0x24020001
comma
l_int|0xaf825ce0
comma
l_int|0x0e00003f
comma
l_int|0xaf825d00
comma
l_int|0x0e000140
comma
l_int|0x00000000
comma
l_int|0x8fbf0018
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x2402ffff
comma
l_int|0xaf825404
comma
l_int|0x8f835400
comma
l_int|0x34630400
comma
l_int|0xaf835400
comma
l_int|0xaf825404
comma
l_int|0x3c020800
comma
l_int|0x24420034
comma
l_int|0xaf82541c
comma
l_int|0x03e00008
comma
l_int|0xaf805400
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x3c020800
comma
l_int|0x34423000
comma
l_int|0x3c030800
comma
l_int|0x34633000
comma
l_int|0x3c040800
comma
l_int|0x348437ff
comma
l_int|0x3c010800
comma
l_int|0xac220a64
comma
l_int|0x24020040
comma
l_int|0x3c010800
comma
l_int|0xac220a68
comma
l_int|0x3c010800
comma
l_int|0xac200a60
comma
l_int|0xac600000
comma
l_int|0x24630004
comma
l_int|0x0083102b
comma
l_int|0x5040fffd
comma
l_int|0xac600000
comma
l_int|0x03e00008
comma
l_int|0x00000000
comma
l_int|0x00804821
comma
l_int|0x8faa0010
comma
l_int|0x3c020800
comma
l_int|0x8c420a60
comma
l_int|0x3c040800
comma
l_int|0x8c840a68
comma
l_int|0x8fab0014
comma
l_int|0x24430001
comma
l_int|0x0044102b
comma
l_int|0x3c010800
comma
l_int|0xac230a60
comma
l_int|0x14400003
comma
l_int|0x00004021
comma
l_int|0x3c010800
comma
l_int|0xac200a60
comma
l_int|0x3c020800
comma
l_int|0x8c420a60
comma
l_int|0x3c030800
comma
l_int|0x8c630a64
comma
l_int|0x91240000
comma
l_int|0x00021140
comma
l_int|0x00431021
comma
l_int|0x00481021
comma
l_int|0x25080001
comma
l_int|0xa0440000
comma
l_int|0x29020008
comma
l_int|0x1440fff4
comma
l_int|0x25290001
comma
l_int|0x3c020800
comma
l_int|0x8c420a60
comma
l_int|0x3c030800
comma
l_int|0x8c630a64
comma
l_int|0x8f84680c
comma
l_int|0x00021140
comma
l_int|0x00431021
comma
l_int|0xac440008
comma
l_int|0xac45000c
comma
l_int|0xac460010
comma
l_int|0xac470014
comma
l_int|0xac4a0018
comma
l_int|0x03e00008
comma
l_int|0xac4b001c
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x02000008
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0001
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0002
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0007
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0008
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0009
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a000b
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a000c
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a000d
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a000e
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x00000000
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0013
comma
l_int|0x0a0001e3
comma
l_int|0x3c0a0014
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0x27bdffe0
comma
l_int|0x00001821
comma
l_int|0x00001021
comma
l_int|0xafbf0018
comma
l_int|0xafb10014
comma
l_int|0xafb00010
comma
l_int|0x3c010800
comma
l_int|0x00220821
comma
l_int|0xac200a70
comma
l_int|0x3c010800
comma
l_int|0x00220821
comma
l_int|0xac200a74
comma
l_int|0x3c010800
comma
l_int|0x00220821
comma
l_int|0xac200a78
comma
l_int|0x24630001
comma
l_int|0x1860fff5
comma
l_int|0x2442000c
comma
l_int|0x24110001
comma
l_int|0x8f906810
comma
l_int|0x32020004
comma
l_int|0x14400005
comma
l_int|0x24040001
comma
l_int|0x3c020800
comma
l_int|0x8c420a78
comma
l_int|0x18400003
comma
l_int|0x00002021
comma
l_int|0x0e000182
comma
l_int|0x00000000
comma
l_int|0x32020001
comma
l_int|0x10400003
comma
l_int|0x00000000
comma
l_int|0x0e000169
comma
l_int|0x00000000
comma
l_int|0x0a000153
comma
l_int|0xaf915028
comma
l_int|0x8fbf0018
comma
l_int|0x8fb10014
comma
l_int|0x8fb00010
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x3c050800
comma
l_int|0x8ca50a70
comma
l_int|0x3c060800
comma
l_int|0x8cc60a80
comma
l_int|0x3c070800
comma
l_int|0x8ce70a78
comma
l_int|0x27bdffe0
comma
l_int|0x3c040800
comma
l_int|0x248409d0
comma
l_int|0xafbf0018
comma
l_int|0xafa00010
comma
l_int|0x0e000060
comma
l_int|0xafa00014
comma
l_int|0x0e00017b
comma
l_int|0x00002021
comma
l_int|0x8fbf0018
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x24020001
comma
l_int|0x8f836810
comma
l_int|0x00821004
comma
l_int|0x00021027
comma
l_int|0x00621824
comma
l_int|0x03e00008
comma
l_int|0xaf836810
comma
l_int|0x27bdffd8
comma
l_int|0xafbf0024
comma
l_int|0x1080002e
comma
l_int|0xafb00020
comma
l_int|0x8f825cec
comma
l_int|0xafa20018
comma
l_int|0x8f825cec
comma
l_int|0x3c100800
comma
l_int|0x26100a78
comma
l_int|0xafa2001c
comma
l_int|0x34028000
comma
l_int|0xaf825cec
comma
l_int|0x8e020000
comma
l_int|0x18400016
comma
l_int|0x00000000
comma
l_int|0x3c020800
comma
l_int|0x94420a74
comma
l_int|0x8fa3001c
comma
l_int|0x000221c0
comma
l_int|0xac830004
comma
l_int|0x8fa2001c
comma
l_int|0x3c010800
comma
l_int|0x0e000201
comma
l_int|0xac220a74
comma
l_int|0x10400005
comma
l_int|0x00000000
comma
l_int|0x8e020000
comma
l_int|0x24420001
comma
l_int|0x0a0001df
comma
l_int|0xae020000
comma
l_int|0x3c020800
comma
l_int|0x8c420a70
comma
l_int|0x00021c02
comma
l_int|0x000321c0
comma
l_int|0x0a0001c5
comma
l_int|0xafa2001c
comma
l_int|0x0e000201
comma
l_int|0x00000000
comma
l_int|0x1040001f
comma
l_int|0x00000000
comma
l_int|0x8e020000
comma
l_int|0x8fa3001c
comma
l_int|0x24420001
comma
l_int|0x3c010800
comma
l_int|0xac230a70
comma
l_int|0x3c010800
comma
l_int|0xac230a74
comma
l_int|0x0a0001df
comma
l_int|0xae020000
comma
l_int|0x3c100800
comma
l_int|0x26100a78
comma
l_int|0x8e020000
comma
l_int|0x18400028
comma
l_int|0x00000000
comma
l_int|0x0e000201
comma
l_int|0x00000000
comma
l_int|0x14400024
comma
l_int|0x00000000
comma
l_int|0x8e020000
comma
l_int|0x3c030800
comma
l_int|0x8c630a70
comma
l_int|0x2442ffff
comma
l_int|0xafa3001c
comma
l_int|0x18400006
comma
l_int|0xae020000
comma
l_int|0x00031402
comma
l_int|0x000221c0
comma
l_int|0x8c820004
comma
l_int|0x3c010800
comma
l_int|0xac220a70
comma
l_int|0x97a2001e
comma
l_int|0x2442ff00
comma
l_int|0x2c420300
comma
l_int|0x1440000b
comma
l_int|0x24024000
comma
l_int|0x3c040800
comma
l_int|0x248409dc
comma
l_int|0xafa00010
comma
l_int|0xafa00014
comma
l_int|0x8fa6001c
comma
l_int|0x24050008
comma
l_int|0x0e000060
comma
l_int|0x00003821
comma
l_int|0x0a0001df
comma
l_int|0x00000000
comma
l_int|0xaf825cf8
comma
l_int|0x3c020800
comma
l_int|0x8c420a40
comma
l_int|0x8fa3001c
comma
l_int|0x24420001
comma
l_int|0xaf835cf8
comma
l_int|0x3c010800
comma
l_int|0xac220a40
comma
l_int|0x8fbf0024
comma
l_int|0x8fb00020
comma
l_int|0x03e00008
comma
l_int|0x27bd0028
comma
l_int|0x27bdffe0
comma
l_int|0x3c040800
comma
l_int|0x248409e8
comma
l_int|0x00002821
comma
l_int|0x00003021
comma
l_int|0x00003821
comma
l_int|0xafbf0018
comma
l_int|0xafa00010
comma
l_int|0x0e000060
comma
l_int|0xafa00014
comma
l_int|0x8fbf0018
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x8f82680c
comma
l_int|0x8f85680c
comma
l_int|0x00021827
comma
l_int|0x0003182b
comma
l_int|0x00031823
comma
l_int|0x00431024
comma
l_int|0x00441021
comma
l_int|0x00a2282b
comma
l_int|0x10a00006
comma
l_int|0x00000000
comma
l_int|0x00401821
comma
l_int|0x8f82680c
comma
l_int|0x0043102b
comma
l_int|0x1440fffd
comma
l_int|0x00000000
comma
l_int|0x03e00008
comma
l_int|0x00000000
comma
l_int|0x3c040800
comma
l_int|0x8c840000
comma
l_int|0x3c030800
comma
l_int|0x8c630a40
comma
l_int|0x0064102b
comma
l_int|0x54400002
comma
l_int|0x00831023
comma
l_int|0x00641023
comma
l_int|0x2c420008
comma
l_int|0x03e00008
comma
l_int|0x38420001
comma
l_int|0x27bdffe0
comma
l_int|0x00802821
comma
l_int|0x3c040800
comma
l_int|0x24840a00
comma
l_int|0x00003021
comma
l_int|0x00003821
comma
l_int|0xafbf0018
comma
l_int|0xafa00010
comma
l_int|0x0e000060
comma
l_int|0xafa00014
comma
l_int|0x0a000216
comma
l_int|0x00000000
comma
l_int|0x8fbf0018
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x00000000
comma
l_int|0x27bdffe0
comma
l_int|0x3c1cc000
comma
l_int|0xafbf0018
comma
l_int|0x0e00004c
comma
l_int|0xaf80680c
comma
l_int|0x3c040800
comma
l_int|0x24840a10
comma
l_int|0x03802821
comma
l_int|0x00003021
comma
l_int|0x00003821
comma
l_int|0xafa00010
comma
l_int|0x0e000060
comma
l_int|0xafa00014
comma
l_int|0x2402ffff
comma
l_int|0xaf825404
comma
l_int|0x3c0200aa
comma
l_int|0x0e000234
comma
l_int|0xaf825434
comma
l_int|0x8fbf0018
comma
l_int|0x03e00008
comma
l_int|0x27bd0020
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x27bdffe8
comma
l_int|0xafb00010
comma
l_int|0x24100001
comma
l_int|0xafbf0014
comma
l_int|0x3c01c003
comma
l_int|0xac200000
comma
l_int|0x8f826810
comma
l_int|0x30422000
comma
l_int|0x10400003
comma
l_int|0x00000000
comma
l_int|0x0e000246
comma
l_int|0x00000000
comma
l_int|0x0a00023a
comma
l_int|0xaf905428
comma
l_int|0x8fbf0014
comma
l_int|0x8fb00010
comma
l_int|0x03e00008
comma
l_int|0x27bd0018
comma
l_int|0x27bdfff8
comma
l_int|0x8f845d0c
comma
l_int|0x3c0200ff
comma
l_int|0x3c030800
comma
l_int|0x8c630a50
comma
l_int|0x3442fff8
comma
l_int|0x00821024
comma
l_int|0x1043001e
comma
l_int|0x3c0500ff
comma
l_int|0x34a5fff8
comma
l_int|0x3c06c003
comma
l_int|0x3c074000
comma
l_int|0x00851824
comma
l_int|0x8c620010
comma
l_int|0x3c010800
comma
l_int|0xac230a50
comma
l_int|0x30420008
comma
l_int|0x10400005
comma
l_int|0x00871025
comma
l_int|0x8cc20000
comma
l_int|0x24420001
comma
l_int|0xacc20000
comma
l_int|0x00871025
comma
l_int|0xaf825d0c
comma
l_int|0x8fa20000
comma
l_int|0x24420001
comma
l_int|0xafa20000
comma
l_int|0x8fa20000
comma
l_int|0x8fa20000
comma
l_int|0x24420001
comma
l_int|0xafa20000
comma
l_int|0x8fa20000
comma
l_int|0x8f845d0c
comma
l_int|0x3c030800
comma
l_int|0x8c630a50
comma
l_int|0x00851024
comma
l_int|0x1443ffe8
comma
l_int|0x00851824
comma
l_int|0x27bd0008
comma
l_int|0x03e00008
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
suffix:semicolon
DECL|variable|t3FwRodata
r_static
id|u32
id|t3FwRodata
(braket
(paren
id|TG3_FW_RODATA_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
op_plus
l_int|1
)braket
op_assign
(brace
l_int|0x35373031
comma
l_int|0x726c7341
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x53774576
comma
l_int|0x656e7430
comma
l_int|0x00000000
comma
l_int|0x726c7045
comma
l_int|0x76656e74
comma
l_int|0x31000000
comma
l_int|0x556e6b6e
comma
l_int|0x45766e74
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x66617461
comma
l_int|0x6c457272
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x4d61696e
comma
l_int|0x43707542
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
suffix:semicolon
macro_line|#if 0 /* All zeros, dont eat up space with it. */
id|u32
id|t3FwData
(braket
(paren
id|TG3_FW_DATA_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
op_plus
l_int|1
)braket
op_assign
(brace
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|RX_CPU_SCRATCH_BASE
mdefine_line|#define RX_CPU_SCRATCH_BASE&t;0x30000
DECL|macro|RX_CPU_SCRATCH_SIZE
mdefine_line|#define RX_CPU_SCRATCH_SIZE&t;0x04000
DECL|macro|TX_CPU_SCRATCH_BASE
mdefine_line|#define TX_CPU_SCRATCH_BASE&t;0x34000
DECL|macro|TX_CPU_SCRATCH_SIZE
mdefine_line|#define TX_CPU_SCRATCH_SIZE&t;0x04000
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_reset_cpu
r_static
r_int
id|tg3_reset_cpu
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|offset
)paren
(brace
r_int
id|i
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_MODE
comma
id|CPU_MODE_RESET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_eq
id|RX_CPU_BASE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|tr32
c_func
(paren
id|offset
op_plus
id|CPU_MODE
)paren
op_amp
id|CPU_MODE_RESET
)paren
)paren
r_break
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_MODE
comma
id|CPU_MODE_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tr32
c_func
(paren
id|offset
op_plus
id|CPU_MODE
)paren
op_amp
id|CPU_MODE_RESET
)paren
)paren
r_break
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|offset
op_plus
id|CPU_MODE
comma
id|CPU_MODE_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|10000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_reset_cpu timed out for %s, &quot;
l_string|&quot;and %s CPU&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
(paren
id|offset
op_eq
id|RX_CPU_BASE
ques
c_cond
l_string|&quot;RX&quot;
suffix:colon
l_string|&quot;TX&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_load_firmware_cpu
r_static
r_int
id|tg3_load_firmware_cpu
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|cpu_base
comma
id|u32
id|cpu_scratch_base
comma
r_int
id|cpu_scratch_size
)paren
(brace
r_int
id|err
comma
id|i
suffix:semicolon
id|err
op_assign
id|tg3_reset_cpu
c_func
(paren
id|tp
comma
id|cpu_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cpu_scratch_size
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
)paren
id|tg3_write_indirect_reg32
c_func
(paren
id|tp
comma
id|cpu_scratch_base
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|cpu_base
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|cpu_base
op_plus
id|CPU_MODE
comma
id|tr32
c_func
(paren
id|cpu_base
op_plus
id|CPU_MODE
)paren
op_or
id|CPU_MODE_HALT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|TG3_FW_TEXT_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
id|tg3_write_indirect_reg32
c_func
(paren
id|tp
comma
(paren
id|cpu_scratch_base
op_plus
(paren
id|TG3_FW_TEXT_ADDR
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
comma
id|t3FwText
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|TG3_FW_RODATA_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
id|tg3_write_indirect_reg32
c_func
(paren
id|tp
comma
(paren
id|cpu_scratch_base
op_plus
(paren
id|TG3_FW_RODATA_ADDR
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
comma
id|t3FwRodata
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|TG3_FW_DATA_LEN
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
id|tg3_write_indirect_reg32
c_func
(paren
id|tp
comma
(paren
id|cpu_scratch_base
op_plus
(paren
id|TG3_FW_DATA_ADDR
op_amp
l_int|0xffff
)paren
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_load_5701_a0_firmware_fix
r_static
r_int
id|tg3_load_5701_a0_firmware_fix
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|err
comma
id|i
suffix:semicolon
id|err
op_assign
id|tg3_load_firmware_cpu
c_func
(paren
id|tp
comma
id|RX_CPU_BASE
comma
id|RX_CPU_SCRATCH_BASE
comma
id|RX_CPU_SCRATCH_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|tg3_load_firmware_cpu
c_func
(paren
id|tp
comma
id|TX_CPU_BASE
comma
id|TX_CPU_SCRATCH_BASE
comma
id|TX_CPU_SCRATCH_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Now startup only the RX cpu. */
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
comma
id|TG3_FW_TEXT_ADDR
)paren
suffix:semicolon
multiline_comment|/* Flush posted writes. */
id|tr32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
)paren
op_eq
id|TG3_FW_TEXT_ADDR
)paren
r_break
suffix:semicolon
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_MODE
comma
id|CPU_MODE_HALT
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
comma
id|TG3_FW_TEXT_ADDR
)paren
suffix:semicolon
multiline_comment|/* Flush posted writes. */
id|tr32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_load_firmware fails for %s &quot;
l_string|&quot;to set RX CPU PC, is %08x should be %08x&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
id|tr32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_PC
)paren
comma
id|TG3_FW_TEXT_ADDR
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_STATE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_MODE
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* Flush posted writes. */
id|tr32
c_func
(paren
id|RX_CPU_BASE
op_plus
id|CPU_MODE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|__tg3_set_mac_addr
r_static
r_void
id|__tg3_set_mac_addr
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|addr_high
comma
id|addr_low
suffix:semicolon
r_int
id|i
suffix:semicolon
id|addr_high
op_assign
(paren
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|addr_low
op_assign
(paren
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|5
)braket
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tw32
c_func
(paren
id|MAC_ADDR_0_HIGH
op_plus
(paren
id|i
op_star
l_int|8
)paren
comma
id|addr_high
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_ADDR_0_LOW
op_plus
(paren
id|i
op_star
l_int|8
)paren
comma
id|addr_low
)paren
suffix:semicolon
)brace
id|addr_high
op_assign
(paren
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
op_plus
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|1
)braket
op_plus
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|2
)braket
op_plus
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|3
)braket
op_plus
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|4
)braket
op_plus
id|tp-&gt;dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
op_amp
id|TX_BACKOFF_SEED_MASK
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_BACKOFF_SEED
comma
id|addr_high
)paren
suffix:semicolon
)brace
DECL|function|tg3_set_mac_addr
r_static
r_int
id|tg3_set_mac_addr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|__tg3_set_mac_addr
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_set_bdinfo
r_static
r_void
id|tg3_set_bdinfo
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|bdinfo_addr
comma
id|dma_addr_t
id|mapping
comma
id|u32
id|maxlen_flags
comma
id|u32
id|nic_addr
)paren
(brace
id|tg3_write_mem
c_func
(paren
id|tp
comma
(paren
id|bdinfo_addr
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
)paren
comma
(paren
(paren
id|u64
)paren
id|mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
(paren
id|bdinfo_addr
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
)paren
comma
(paren
(paren
id|u64
)paren
id|mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
(paren
id|bdinfo_addr
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
)paren
comma
id|maxlen_flags
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
(paren
id|bdinfo_addr
op_plus
id|TG3_BDINFO_NIC_ADDR
)paren
comma
id|nic_addr
)paren
suffix:semicolon
)brace
r_static
r_void
id|__tg3_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
multiline_comment|/* tp-&gt;lock is held. */
DECL|function|tg3_reset_hw
r_static
r_int
id|tg3_reset_hw
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|tg3_disable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
(brace
id|err
op_assign
id|tg3_abort_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|tg3_chip_reset
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_MODE
comma
id|tp-&gt;grc_mode
)paren
suffix:semicolon
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_FIRMWARE_MBOX
comma
id|NIC_SRAM_FIRMWARE_MBOX_MAGIC1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
)paren
(brace
id|tp-&gt;mac_mode
op_assign
id|MAC_MODE_PORT_MODE_TBI
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
)brace
r_else
id|tw32
c_func
(paren
id|MAC_MODE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Wait for firmware initialization to complete. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_FIRMWARE_MBOX
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
op_complement
id|NIC_SRAM_FIRMWARE_MBOX_MAGIC1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|100000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_reset_hw timed out for %s, &quot;
l_string|&quot;firmware will not restart magic=%08x&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* This works around an issue with Athlon chipsets on&n;&t; * B3 tigon3 silicon.  This bit has no effect on any&n;&t; * other revision.&n;&t; */
id|val
op_assign
id|tr32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
)paren
suffix:semicolon
id|val
op_or_assign
id|CLOCK_CTRL_DELAY_PCI_GRANT
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* Clear statistics/status block in chip, and status block in ram. */
r_for
c_loop
(paren
id|i
op_assign
id|NIC_SRAM_STATS_BLK
suffix:semicolon
id|i
OL
id|NIC_SRAM_STATUS_BLK
op_plus
id|TG3_HW_STATUS_SIZE
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
)paren
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;hw_status
comma
l_int|0
comma
id|TG3_HW_STATUS_SIZE
)paren
suffix:semicolon
multiline_comment|/* This value is determined during the probe time DMA&n;&t; * engine test, tg3_test_dma.&n;&t; */
id|tw32
c_func
(paren
id|TG3PCI_DMA_RW_CTRL
comma
id|tp-&gt;dma_rwctrl
)paren
suffix:semicolon
id|tp-&gt;grc_mode
op_and_assign
op_complement
(paren
id|GRC_MODE_HOST_SENDBDS
op_or
id|GRC_MODE_4X_NIC_SEND_RINGS
op_or
id|GRC_MODE_NO_TX_PHDR_CSUM
op_or
id|GRC_MODE_NO_RX_PHDR_CSUM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
id|tp-&gt;grc_mode
op_or_assign
id|GRC_MODE_HOST_SENDBDS
suffix:semicolon
r_else
id|tp-&gt;grc_mode
op_or_assign
id|GRC_MODE_4X_NIC_SEND_RINGS
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_NO_TX_PSEUDO_CSUM
)paren
id|tp-&gt;grc_mode
op_or_assign
id|GRC_MODE_NO_TX_PHDR_CSUM
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_NO_RX_PSEUDO_CSUM
)paren
id|tp-&gt;grc_mode
op_or_assign
id|GRC_MODE_NO_RX_PHDR_CSUM
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_MODE
comma
id|tp-&gt;grc_mode
op_or
(paren
id|GRC_MODE_IRQ_ON_MAC_ATTN
op_or
id|GRC_MODE_HOST_STACKUP
)paren
)paren
suffix:semicolon
multiline_comment|/* Setup the timer prescalar register.  Clock is always 66Mhz. */
id|tw32
c_func
(paren
id|GRC_MISC_CFG
comma
(paren
l_int|65
op_lshift
id|GRC_MISC_CFG_PRESCALAR_SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize MBUF/DESC pool. */
id|tw32
c_func
(paren
id|BUFMGR_MB_POOL_ADDR
comma
id|NIC_SRAM_MBUF_POOL_BASE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MB_POOL_SIZE
comma
id|NIC_SRAM_MBUF_POOL_SIZE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_DMA_DESC_POOL_ADDR
comma
id|NIC_SRAM_DMA_DESC_POOL_BASE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_DMA_DESC_POOL_SIZE
comma
id|NIC_SRAM_DMA_DESC_POOL_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_JUMBO_ENABLE
)paren
)paren
(brace
id|tw32
c_func
(paren
id|BUFMGR_MB_RDMA_LOW_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_read_dma_low_water
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MB_MACRX_LOW_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_mac_rx_low_water
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MB_HIGH_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_high_water
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|BUFMGR_MB_RDMA_LOW_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_read_dma_low_water_jumbo
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MB_MACRX_LOW_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_mac_rx_low_water_jumbo
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MB_HIGH_WATER
comma
id|tp-&gt;bufmgr_config.mbuf_high_water_jumbo
)paren
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|BUFMGR_DMA_LOW_WATER
comma
id|tp-&gt;bufmgr_config.dma_low_water
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_DMA_HIGH_WATER
comma
id|tp-&gt;bufmgr_config.dma_high_water
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MODE
comma
id|BUFMGR_MODE_ENABLE
op_or
id|BUFMGR_MODE_ATTN_ENABLE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|BUFMGR_MODE
)paren
op_amp
id|BUFMGR_MODE_ENABLE
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|2000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_reset_hw cannot enable BUFMGR for %s.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|FTQ_RESET
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RESET
comma
l_int|0x00000000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|FTQ_RESET
)paren
op_eq
l_int|0x00000000
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|2000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;tg3_reset_hw cannot reset FTQ for %s.&bslash;n&quot;
comma
id|tp-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Initialize TG3_BDINFO&squot;s at:&n;&t; *  RCVDBDI_STD_BD:&t;standard eth size rx ring&n;&t; *  RCVDBDI_JUMBO_BD:&t;jumbo frame rx ring&n;&t; *  RCVDBDI_MINI_BD:&t;small frame rx ring (??? does not work)&n;&t; *&n;&t; * like so:&n;&t; *  TG3_BDINFO_HOST_ADDR:&t;high/low parts of DMA address of ring&n;&t; *  TG3_BDINFO_MAXLEN_FLAGS:&t;(rx max buffer size &lt;&lt; 16) |&n;&t; *                              ring attribute flags&n;&t; *  TG3_BDINFO_NIC_ADDR:&t;location of descriptors in nic SRAM&n;&t; *&n;&t; * Standard receive ring @ NIC_SRAM_RX_BUFFER_DESC, 512 entries.&n;&t; * Jumbo receive ring @ NIC_SRAM_RX_JUMBO_BUFFER_DESC, 256 entries.&n;&t; *&n;&t; * ??? No space allocated for mini receive ring? :(&n;&t; *&n;&t; * The size of each ring is fixed in the firmware, but the location is&n;&t; * configurable.&n;&t; */
id|tw32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_std_mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_std_mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|RX_STD_MAX_SIZE
op_lshift
id|BDINFO_FLAGS_MAXLEN_SHIFT
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
id|TG3_BDINFO_NIC_ADDR
comma
id|NIC_SRAM_RX_BUFFER_DESC
)paren
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tw32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_mini_mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_mini_mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|RX_MINI_MAX_SIZE
op_lshift
id|BDINFO_FLAGS_MAXLEN_SHIFT
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
id|TG3_BDINFO_NIC_ADDR
comma
id|NIC_SRAM_RX_MINI_BUFFER_DESC
)paren
suffix:semicolon
macro_line|#else
id|tw32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|BDINFO_FLAGS_DISABLED
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_JUMBO_ENABLE
)paren
(brace
id|tw32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_jumbo_mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
id|TG3_BDINFO_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;rx_jumbo_mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|RX_JUMBO_MAX_SIZE
op_lshift
id|BDINFO_FLAGS_MAXLEN_SHIFT
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
id|TG3_BDINFO_NIC_ADDR
comma
id|NIC_SRAM_RX_JUMBO_BUFFER_DESC
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|BDINFO_FLAGS_DISABLED
)paren
suffix:semicolon
)brace
multiline_comment|/* Setup replenish thresholds. */
id|tw32
c_func
(paren
id|RCVBDI_STD_THRESH
comma
id|tp-&gt;rx_pending
op_div
l_int|8
)paren
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tw32
c_func
(paren
id|RCVBDI_MINI_THRESH
comma
id|tp-&gt;rx_mini_pending
op_div
l_int|8
)paren
suffix:semicolon
macro_line|#endif
id|tw32
c_func
(paren
id|RCVBDI_JUMBO_THRESH
comma
id|tp-&gt;rx_jumbo_pending
op_div
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Clear out send RCB ring in SRAM. */
r_for
c_loop
(paren
id|i
op_assign
id|NIC_SRAM_SEND_RCB
suffix:semicolon
id|i
OL
id|NIC_SRAM_RCV_RET_RCB
suffix:semicolon
id|i
op_add_assign
id|TG3_BDINFO_SIZE
)paren
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|i
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|BDINFO_FLAGS_DISABLED
)paren
suffix:semicolon
id|tp-&gt;tx_prod
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_cons
op_assign
l_int|0
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0
)paren
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_HOST_TXDS
)paren
(brace
id|tg3_set_bdinfo
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
comma
id|tp-&gt;tx_desc_mapping
comma
(paren
id|TG3_TX_RING_SIZE
op_lshift
id|BDINFO_FLAGS_MAXLEN_SHIFT
)paren
comma
id|NIC_SRAM_TX_BUFFER_DESC
)paren
suffix:semicolon
)brace
r_else
(brace
id|tg3_set_bdinfo
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
comma
l_int|0
comma
id|BDINFO_FLAGS_DISABLED
comma
id|NIC_SRAM_TX_BUFFER_DESC
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|NIC_SRAM_RCV_RET_RCB
suffix:semicolon
id|i
OL
id|NIC_SRAM_STATS_BLK
suffix:semicolon
id|i
op_add_assign
id|TG3_BDINFO_SIZE
)paren
(brace
id|tg3_write_mem
c_func
(paren
id|tp
comma
id|i
op_plus
id|TG3_BDINFO_MAXLEN_FLAGS
comma
id|BDINFO_FLAGS_DISABLED
)paren
suffix:semicolon
)brace
id|tp-&gt;rx_rcb_ptr
op_assign
l_int|0
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCVRET_CON_IDX_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0
)paren
suffix:semicolon
id|tg3_set_bdinfo
c_func
(paren
id|tp
comma
id|NIC_SRAM_RCV_RET_RCB
comma
id|tp-&gt;rx_rcb_mapping
comma
(paren
id|TG3_RX_RCB_RING_SIZE
op_lshift
id|BDINFO_FLAGS_MAXLEN_SHIFT
)paren
comma
l_int|0
)paren
suffix:semicolon
id|tp-&gt;rx_std_ptr
op_assign
id|tp-&gt;rx_pending
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_STD_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|tp-&gt;rx_std_ptr
)paren
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tp-&gt;rx_mini_ptr
op_assign
id|tp-&gt;rx_mini_pending
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_MINI_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|tp-&gt;rx_mini_ptr
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_JUMBO_ENABLE
)paren
id|tp-&gt;rx_jumbo_ptr
op_assign
id|tp-&gt;rx_jumbo_pending
suffix:semicolon
r_else
id|tp-&gt;rx_jumbo_ptr
op_assign
l_int|0
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_RCV_JUMBO_PROD_IDX
op_plus
id|TG3_64BIT_REG_LOW
comma
id|tp-&gt;rx_jumbo_ptr
)paren
suffix:semicolon
multiline_comment|/* Initialize MAC address and backoff seed. */
id|__tg3_set_mac_addr
c_func
(paren
id|tp
)paren
suffix:semicolon
multiline_comment|/* MTU + ethernet header + FCS + optional VLAN tag */
id|tw32
c_func
(paren
id|MAC_RX_MTU_SIZE
comma
id|tp-&gt;dev-&gt;mtu
op_plus
id|ETH_HLEN
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* The slot time is changed by tg3_setup_phy if we&n;&t; * run at gigabit with half duplex.&n;&t; */
id|tw32
c_func
(paren
id|MAC_TX_LENGTHS
comma
(paren
l_int|2
op_lshift
id|TX_LENGTHS_IPG_CRS_SHIFT
)paren
op_or
(paren
l_int|6
op_lshift
id|TX_LENGTHS_IPG_SHIFT
)paren
op_or
(paren
l_int|32
op_lshift
id|TX_LENGTHS_SLOT_TIME_SHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive rules. */
id|tw32
c_func
(paren
id|MAC_RCV_RULE_CFG
comma
id|RCV_RULE_CFG_DEFAULT_CLASS
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVLPC_CONFIG
comma
l_int|0x0181
)paren
suffix:semicolon
multiline_comment|/* Receive/send statistics. */
id|tw32
c_func
(paren
id|RCVLPC_STATS_ENABLE
comma
l_int|0xffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVLPC_STATSCTRL
comma
id|RCVLPC_STATSCTRL_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDDATAI_STATSENAB
comma
l_int|0xffffff
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDDATAI_STATSCTRL
comma
(paren
id|SNDDATAI_SCTRL_ENABLE
op_or
id|SNDDATAI_SCTRL_FASTUPD
)paren
)paren
suffix:semicolon
multiline_comment|/* Setup host coalescing engine. */
id|tw32
c_func
(paren
id|HOSTCC_MODE
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tr32
c_func
(paren
id|HOSTCC_MODE
)paren
op_amp
id|HOSTCC_MODE_ENABLE
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|HOSTCC_RXCOL_TICKS
comma
id|tp-&gt;coalesce_config.rx_coalesce_ticks
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXCOAL_TICK_INT
comma
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXCOAL_MAXF_INT
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOL_TICKS
comma
id|tp-&gt;coalesce_config.tx_coalesce_ticks
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOAL_TICK_INT
comma
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOAL_MAXF_INT
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STAT_COAL_TICKS
comma
id|tp-&gt;coalesce_config.stats_coalesce_ticks
)paren
suffix:semicolon
multiline_comment|/* Status/statistics block address. */
id|tw32
c_func
(paren
id|HOSTCC_STATS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;stats_mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STATS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;stats_mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STATUS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;status_mapping
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STATUS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;status_mapping
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STATS_BLK_NIC_ADDR
comma
id|NIC_SRAM_STATS_BLK
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STATUS_BLK_NIC_ADDR
comma
id|NIC_SRAM_STATUS_BLK
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_MODE
comma
id|HOSTCC_MODE_ENABLE
op_or
id|tp-&gt;coalesce_mode
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVCC_MODE
comma
id|RCVCC_MODE_ENABLE
op_or
id|RCVCC_MODE_ATTN_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVLPC_MODE
comma
id|RCVLPC_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVLSC_MODE
comma
id|RCVLSC_MODE_ENABLE
op_or
id|RCVLSC_MODE_ATTN_ENABLE
)paren
suffix:semicolon
id|tp-&gt;mac_mode
op_assign
id|MAC_MODE_TXSTAT_ENABLE
op_or
id|MAC_MODE_RXSTAT_ENABLE
op_or
id|MAC_MODE_TDE_ENABLE
op_or
id|MAC_MODE_RDE_ENABLE
op_or
id|MAC_MODE_FHDE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
op_or
id|MAC_MODE_RXSTAT_CLEAR
op_or
id|MAC_MODE_TXSTAT_CLEAR
)paren
suffix:semicolon
id|tp-&gt;grc_local_ctrl
op_assign
id|GRC_LCLCTRL_INT_ON_ATTN
op_or
id|GRC_LCLCTRL_GPIO_OE1
op_or
id|GRC_LCLCTRL_GPIO_OUTPUT1
op_or
id|GRC_LCLCTRL_AUTO_SEEPROM
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
id|tp-&gt;grc_local_ctrl
)paren
suffix:semicolon
id|tw32_mailbox
c_func
(paren
id|MAILBOX_INTERRUPT_0
op_plus
id|TG3_64BIT_REG_LOW
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|DMAC_MODE
comma
id|DMAC_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|WDMAC_MODE
comma
(paren
id|WDMAC_MODE_ENABLE
op_or
id|WDMAC_MODE_TGTABORT_ENAB
op_or
id|WDMAC_MODE_MSTABORT_ENAB
op_or
id|WDMAC_MODE_PARITYERR_ENAB
op_or
id|WDMAC_MODE_ADDROFLOW_ENAB
op_or
id|WDMAC_MODE_FIFOOFLOW_ENAB
op_or
id|WDMAC_MODE_FIFOURUN_ENAB
op_or
id|WDMAC_MODE_FIFOOREAD_ENAB
op_or
id|WDMAC_MODE_LNGREAD_ENAB
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RDMAC_MODE
comma
(paren
id|RDMAC_MODE_ENABLE
op_or
id|RDMAC_MODE_TGTABORT_ENAB
op_or
id|RDMAC_MODE_MSTABORT_ENAB
op_or
id|RDMAC_MODE_PARITYERR_ENAB
op_or
id|RDMAC_MODE_ADDROFLOW_ENAB
op_or
id|RDMAC_MODE_FIFOOFLOW_ENAB
op_or
id|RDMAC_MODE_FIFOURUN_ENAB
op_or
id|RDMAC_MODE_FIFOOREAD_ENAB
op_or
id|RDMAC_MODE_LNGREAD_ENAB
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDCC_MODE
comma
id|RCVDCC_MODE_ENABLE
op_or
id|RCVDCC_MODE_ATTN_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MBFREE_MODE
comma
id|MBFREE_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDDATAC_MODE
comma
id|SNDDATAC_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDBDC_MODE
comma
id|SNDBDC_MODE_ENABLE
op_or
id|SNDBDC_MODE_ATTN_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVBDI_MODE
comma
id|RCVBDI_MODE_ENABLE
op_or
id|RCVBDI_MODE_RCB_ATTN_ENAB
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RCVDBDI_MODE
comma
id|RCVDBDI_MODE_ENABLE
op_or
id|RCVDBDI_MODE_INV_RING_SZ
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDDATAI_MODE
comma
id|SNDDATAI_MODE_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDBDI_MODE
comma
id|SNDBDI_MODE_ENABLE
op_or
id|SNDBDI_MODE_ATTN_ENABLE
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|SNDBDS_MODE
comma
id|SNDBDS_MODE_ENABLE
op_or
id|SNDBDS_MODE_ATTN_ENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
)paren
(brace
id|err
op_assign
id|tg3_load_5701_a0_firmware_fix
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|tp-&gt;tx_mode
op_assign
id|TX_MODE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_TX_MODE
comma
id|tp-&gt;tx_mode
)paren
suffix:semicolon
id|tp-&gt;rx_mode
op_assign
id|RX_MODE_ENABLE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RX_MODE
comma
id|tp-&gt;rx_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;link_config.phy_is_low_power
)paren
(brace
id|tp-&gt;link_config.phy_is_low_power
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;link_config.speed
op_assign
id|tp-&gt;link_config.orig_speed
suffix:semicolon
id|tp-&gt;link_config.duplex
op_assign
id|tp-&gt;link_config.orig_duplex
suffix:semicolon
id|tp-&gt;link_config.autoneg
op_assign
id|tp-&gt;link_config.orig_autoneg
suffix:semicolon
)brace
id|tp-&gt;mi_mode
op_assign
id|MAC_MI_MODE_BASE
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_LED_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MI_STAT
comma
id|MAC_MI_STAT_LNKSTAT_ATTN_ENAB
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RX_MODE
comma
id|RX_MODE_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RX_MODE
comma
id|tp-&gt;rx_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5703_A1
)paren
id|tw32
c_func
(paren
id|MAC_SERDES_CFG
comma
l_int|0x616000
)paren
suffix:semicolon
id|err
op_assign
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_ne
id|PHY_ID_SERDES
)paren
(brace
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Clear CRC stats. */
id|tg3_readphy
c_func
(paren
id|tp
comma
l_int|0x1e
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x1e
comma
id|tmp
op_or
l_int|0x8000
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
l_int|0x14
comma
op_amp
id|tmp
)paren
suffix:semicolon
)brace
id|__tg3_set_rx_mode
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Initialize receive rules. */
id|tw32
c_func
(paren
id|MAC_RCV_RULE_0
comma
l_int|0xc2000000
op_amp
id|RCV_RULE_DISABLE_MASK
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_0
comma
l_int|0xffffffff
op_amp
id|RCV_RULE_DISABLE_MASK
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_1
comma
l_int|0x86000004
op_amp
id|RCV_RULE_DISABLE_MASK
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_1
comma
l_int|0xffffffff
op_amp
id|RCV_RULE_DISABLE_MASK
)paren
suffix:semicolon
macro_line|#if 0
id|tw32
c_func
(paren
id|MAC_RCV_RULE_2
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_2
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_3
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_3
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|tw32
c_func
(paren
id|MAC_RCV_RULE_4
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_4
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_5
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_5
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_6
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_6
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_7
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_7
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_8
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_8
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_9
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_9
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_10
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_10
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_11
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_11
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_12
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_12
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_13
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_13
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_14
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_14
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_RULE_15
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_RCV_VALUE_15
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
id|tg3_enable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called at device open time to get the chip ready for&n; * packet processing.  Invoked with tp-&gt;lock held.&n; */
DECL|function|tg3_init_hw
r_static
r_int
id|tg3_init_hw
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* Force the chip into D0. */
id|err
op_assign
id|tg3_set_power_state
c_func
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
l_int|0
)paren
suffix:semicolon
id|err
op_assign
id|tg3_reset_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_timer
r_static
r_void
id|tg3_timer
c_func
(paren
r_int
r_int
id|__opaque
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
(paren
r_struct
id|tg3
op_star
)paren
id|__opaque
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TAGGED_IRQ_STATUS
)paren
)paren
(brace
multiline_comment|/* All of this garbage is because on the 5700 the&n;&t;&t; * mailbox/status_block protocol the chip uses with&n;&t;&t; * the cpu is race prone.&n;&t;&t; */
r_if
c_cond
(paren
id|tp-&gt;hw_status-&gt;status
op_amp
id|SD_STATUS_UPDATED
)paren
(brace
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
id|tp-&gt;grc_local_ctrl
op_or
id|GRC_LCLCTRL_SETINT
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|HOSTCC_MODE
comma
(paren
id|HOSTCC_MODE_ENABLE
op_or
id|HOSTCC_MODE_NOW
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tr32
c_func
(paren
id|WDMAC_MODE
)paren
op_amp
id|WDMAC_MODE_ENABLE
)paren
)paren
(brace
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* This part only runs once per second. */
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|tp-&gt;timer_counter
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_USE_LINKCHG_REG
)paren
(brace
id|u32
id|mac_stat
suffix:semicolon
r_int
id|phy_event
suffix:semicolon
id|mac_stat
op_assign
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
suffix:semicolon
id|phy_event
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_USE_MI_INTERRUPT
)paren
(brace
r_if
c_cond
(paren
id|mac_stat
op_amp
id|MAC_STATUS_MI_INTERRUPT
)paren
id|phy_event
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mac_stat
op_amp
id|MAC_STATUS_LNKSTATE_CHANGED
)paren
id|phy_event
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|phy_event
)paren
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_POLL_SERDES
)paren
(brace
id|u32
id|mac_stat
op_assign
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
suffix:semicolon
r_int
id|need_setup
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
op_logical_and
(paren
id|mac_stat
op_amp
id|MAC_STATUS_LNKSTATE_CHANGED
)paren
)paren
(brace
id|need_setup
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
op_logical_and
(paren
id|mac_stat
op_amp
id|MAC_STATUS_PCS_SYNCED
)paren
)paren
(brace
id|need_setup
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|need_setup
)paren
(brace
id|tw32
c_func
(paren
id|MAC_MODE
comma
(paren
id|tp-&gt;mac_mode
op_amp
op_complement
id|MAC_MODE_PORT_MODE_MASK
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|MAC_MODE
comma
id|tp-&gt;mac_mode
)paren
suffix:semicolon
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
)brace
id|tp-&gt;timer_counter
op_assign
id|tp-&gt;timer_multiplier
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|tp-&gt;timer_offset
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|tg3_open
r_static
r_int
id|tg3_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_disable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_INIT_COMPLETE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* If you move this call, make sure TG3_FLAG_HOST_TXDS in&n;&t; * tp-&gt;tg3_flags is accurate at that new place.&n;&t; */
id|err
op_assign
id|tg3_alloc_consistent
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TAGGED_IRQ_STATUS
)paren
id|err
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|tg3_interrupt_tagged
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_else
id|err
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|tg3_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|tg3_free_consistent
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|err
op_assign
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_free_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_TAGGED_IRQ_STATUS
)paren
(brace
id|tp-&gt;timer_offset
op_assign
id|HZ
suffix:semicolon
id|tp-&gt;timer_counter
op_assign
id|tp-&gt;timer_multiplier
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;timer_offset
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
id|tp-&gt;timer_counter
op_assign
id|tp-&gt;timer_multiplier
op_assign
l_int|10
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|tp-&gt;timer_offset
suffix:semicolon
id|tp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|tp
suffix:semicolon
id|tp-&gt;timer.function
op_assign
id|tg3_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;last_rate_sample
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;last_rx_count
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;last_tx_count
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_INIT_COMPLETE
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|tg3_free_consistent
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_enable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/*static*/
r_void
id|tg3_dump_state
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|val32
comma
id|val32_2
comma
id|val32_3
comma
id|val32_4
comma
id|val32_5
suffix:semicolon
id|u16
id|val16
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_STATUS
comma
op_amp
id|val16
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PCISTATE
comma
op_amp
id|val32
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: PCI status [%04x] TG3PCI state[%08x]&bslash;n&quot;
comma
id|val16
comma
id|val32
)paren
suffix:semicolon
multiline_comment|/* MAC block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: MAC_MODE[%08x] MAC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MAC_MODE
)paren
comma
id|tr32
c_func
(paren
id|MAC_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;       MAC_EVENT[%08x] MAC_LED_CTRL[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MAC_EVENT
)paren
comma
id|tr32
c_func
(paren
id|MAC_LED_CTRL
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: MAC_TX_MODE[%08x] MAC_TX_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MAC_TX_MODE
)paren
comma
id|tr32
c_func
(paren
id|MAC_TX_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;       MAC_RX_MODE[%08x] MAC_RX_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MAC_RX_MODE
)paren
comma
id|tr32
c_func
(paren
id|MAC_RX_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Send data initiator control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDDATAI_MODE[%08x] SNDDATAI_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDDATAI_MODE
)paren
comma
id|tr32
c_func
(paren
id|SNDDATAI_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;       SNDDATAI_STATSCTRL[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDDATAI_STATSCTRL
)paren
)paren
suffix:semicolon
multiline_comment|/* Send data completion control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDDATAC_MODE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDDATAC_MODE
)paren
)paren
suffix:semicolon
multiline_comment|/* Send BD ring selector block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDBDS_MODE[%08x] SNDBDS_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDBDS_MODE
)paren
comma
id|tr32
c_func
(paren
id|SNDBDS_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Send BD initiator control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDBDI_MODE[%08x] SNDBDI_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDBDI_MODE
)paren
comma
id|tr32
c_func
(paren
id|SNDBDI_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Send BD completion control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDBDC_MODE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|SNDBDC_MODE
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive list placement control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVLPC_MODE[%08x] RCVLPC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVLPC_MODE
)paren
comma
id|tr32
c_func
(paren
id|RCVLPC_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;       RCVLPC_STATSCTRL[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVLPC_STATSCTRL
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive data and receive BD initiator control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVDBDI_MODE[%08x] RCVDBDI_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVDBDI_MODE
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive data completion control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVDCC_MODE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVDCC_MODE
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive BD initiator control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVBDI_MODE[%08x] RCVBDI_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVBDI_MODE
)paren
comma
id|tr32
c_func
(paren
id|RCVBDI_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive BD completion control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVCC_MODE[%08x] RCVCC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVCC_MODE
)paren
comma
id|tr32
c_func
(paren
id|RCVCC_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Receive list selector control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVLSC_MODE[%08x] RCVLSC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVLSC_MODE
)paren
comma
id|tr32
c_func
(paren
id|RCVLSC_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Mbuf cluster free block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: MBFREE_MODE[%08x] MBFREE_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MBFREE_MODE
)paren
comma
id|tr32
c_func
(paren
id|MBFREE_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Host coalescing control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: HOSTCC_MODE[%08x] HOSTCC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|HOSTCC_MODE
)paren
comma
id|tr32
c_func
(paren
id|HOSTCC_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: HOSTCC_STATS_BLK_HOST_ADDR[%08x%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|HOSTCC_STATS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
)paren
comma
id|tr32
c_func
(paren
id|HOSTCC_STATS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: HOSTCC_STATUS_BLK_HOST_ADDR[%08x%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|HOSTCC_STATUS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_HIGH
)paren
comma
id|tr32
c_func
(paren
id|HOSTCC_STATUS_BLK_HOST_ADDR
op_plus
id|TG3_64BIT_REG_LOW
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: HOSTCC_STATS_BLK_NIC_ADDR[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|HOSTCC_STATS_BLK_NIC_ADDR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: HOSTCC_STATUS_BLK_NIC_ADDR[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|HOSTCC_STATUS_BLK_NIC_ADDR
)paren
)paren
suffix:semicolon
multiline_comment|/* Memory arbiter control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: MEMARB_MODE[%08x] MEMARB_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MEMARB_MODE
)paren
comma
id|tr32
c_func
(paren
id|MEMARB_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Buffer manager control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: BUFMGR_MODE[%08x] BUFMGR_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|BUFMGR_MODE
)paren
comma
id|tr32
c_func
(paren
id|BUFMGR_STATUS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: BUFMGR_MB_POOL_ADDR[%08x] BUFMGR_MB_POOL_SIZE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|BUFMGR_MB_POOL_ADDR
)paren
comma
id|tr32
c_func
(paren
id|BUFMGR_MB_POOL_SIZE
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: BUFMGR_DMA_DESC_POOL_ADDR[%08x] &quot;
l_string|&quot;BUFMGR_DMA_DESC_POOL_SIZE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|BUFMGR_DMA_DESC_POOL_ADDR
)paren
comma
id|tr32
c_func
(paren
id|BUFMGR_DMA_DESC_POOL_SIZE
)paren
)paren
suffix:semicolon
multiline_comment|/* Read DMA control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RDMAC_MODE[%08x] RDMAC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RDMAC_MODE
)paren
comma
id|tr32
c_func
(paren
id|RDMAC_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* Write DMA control block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: WDMAC_MODE[%08x] WDMAC_STATUS[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|WDMAC_MODE
)paren
comma
id|tr32
c_func
(paren
id|WDMAC_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* DMA completion block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: DMAC_MODE[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|DMAC_MODE
)paren
)paren
suffix:semicolon
multiline_comment|/* GRC block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: GRC_MODE[%08x] GRC_MISC_CFG[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|GRC_MODE
)paren
comma
id|tr32
c_func
(paren
id|GRC_MISC_CFG
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: GRC_LOCAL_CTRL[%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|GRC_LOCAL_CTRL
)paren
)paren
suffix:semicolon
multiline_comment|/* TG3_BDINFOs */
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVDBDI_JUMBO_BD[%08x%08x:%08x:%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
l_int|0x0
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
l_int|0x4
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
l_int|0x8
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_JUMBO_BD
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVDBDI_STD_BD[%08x%08x:%08x:%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
l_int|0x0
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
l_int|0x4
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
l_int|0x8
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_STD_BD
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: RCVDBDI_MINI_BD[%08x%08x:%08x:%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
l_int|0x0
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
l_int|0x4
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
l_int|0x8
)paren
comma
id|tr32
c_func
(paren
id|RCVDBDI_MINI_BD
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
op_plus
l_int|0x0
comma
op_amp
id|val32
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
op_plus
l_int|0x4
comma
op_amp
id|val32_2
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
op_plus
l_int|0x8
comma
op_amp
id|val32_3
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_SEND_RCB
op_plus
l_int|0xc
comma
op_amp
id|val32_4
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: SRAM_SEND_RCB_0[%08x%08x:%08x:%08x]&bslash;n&quot;
comma
id|val32
comma
id|val32_2
comma
id|val32_3
comma
id|val32_4
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_RCV_RET_RCB
op_plus
l_int|0x0
comma
op_amp
id|val32
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_RCV_RET_RCB
op_plus
l_int|0x4
comma
op_amp
id|val32_2
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_RCV_RET_RCB
op_plus
l_int|0x8
comma
op_amp
id|val32_3
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_RCV_RET_RCB
op_plus
l_int|0xc
comma
op_amp
id|val32_4
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: SRAM_RCV_RET_RCB_0[%08x%08x:%08x:%08x]&bslash;n&quot;
comma
id|val32
comma
id|val32_2
comma
id|val32_3
comma
id|val32_4
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_STATUS_BLK
op_plus
l_int|0x0
comma
op_amp
id|val32
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_STATUS_BLK
op_plus
l_int|0x4
comma
op_amp
id|val32_2
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_STATUS_BLK
op_plus
l_int|0x8
comma
op_amp
id|val32_3
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_STATUS_BLK
op_plus
l_int|0xc
comma
op_amp
id|val32_4
)paren
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_STATUS_BLK
op_plus
l_int|0x10
comma
op_amp
id|val32_5
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: SRAM_STATUS_BLK[%08x:%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|val32
comma
id|val32_2
comma
id|val32_3
comma
id|val32_4
comma
id|val32_5
)paren
suffix:semicolon
multiline_comment|/* SW status block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: Host status block [%08x:%08x:(%04x:%04x:%04x):(%04x:%04x)]&bslash;n&quot;
comma
id|tp-&gt;hw_status-&gt;status
comma
id|tp-&gt;hw_status-&gt;status_tag
comma
id|tp-&gt;hw_status-&gt;rx_jumbo_consumer
comma
id|tp-&gt;hw_status-&gt;rx_consumer
comma
id|tp-&gt;hw_status-&gt;rx_mini_consumer
comma
id|tp-&gt;hw_status-&gt;idx
(braket
l_int|0
)braket
dot
id|rx_producer
comma
id|tp-&gt;hw_status-&gt;idx
(braket
l_int|0
)braket
dot
id|tx_consumer
)paren
suffix:semicolon
multiline_comment|/* SW statistics block */
id|printk
c_func
(paren
l_string|&quot;DEBUG: Host statistics block [%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
(paren
(paren
id|u32
op_star
)paren
id|tp-&gt;hw_stats
)paren
(braket
l_int|0
)braket
comma
(paren
(paren
id|u32
op_star
)paren
id|tp-&gt;hw_stats
)paren
(braket
l_int|1
)braket
comma
(paren
(paren
id|u32
op_star
)paren
id|tp-&gt;hw_stats
)paren
(braket
l_int|2
)braket
comma
(paren
(paren
id|u32
op_star
)paren
id|tp-&gt;hw_stats
)paren
(braket
l_int|3
)braket
)paren
suffix:semicolon
multiline_comment|/* Mailboxes */
id|printk
c_func
(paren
l_string|&quot;DEBUG: SNDHOST_PROD[%08x%08x] SNDNIC_PROD[%08x%08x]&bslash;n&quot;
comma
id|tr32
c_func
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
l_int|0x0
)paren
comma
id|tr32
c_func
(paren
id|MAILBOX_SNDHOST_PROD_IDX_0
op_plus
l_int|0x4
)paren
comma
id|tr32
c_func
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
l_int|0x0
)paren
comma
id|tr32
c_func
(paren
id|MAILBOX_SNDNIC_PROD_IDX_0
op_plus
l_int|0x4
)paren
)paren
suffix:semicolon
multiline_comment|/* NIC side send descriptors. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|txd
suffix:semicolon
id|txd
op_assign
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_TX_BUFFER_DESC
op_plus
(paren
id|i
op_star
r_sizeof
(paren
r_struct
id|tg3_tx_buffer_desc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC TXD(%d)[%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|txd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|txd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|txd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|txd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* NIC side RX descriptors. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|rxd
suffix:semicolon
id|rxd
op_assign
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_RX_BUFFER_DESC
op_plus
(paren
id|i
op_star
r_sizeof
(paren
r_struct
id|tg3_rx_buffer_desc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_STD(%d)[0][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|rxd
op_add_assign
(paren
l_int|4
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_STD(%d)[1][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
)brace
macro_line|#if TG3_MINI_RING_WORKS
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|rxd
suffix:semicolon
id|rxd
op_assign
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_RX_MINI_BUFFER_DESC
op_plus
(paren
id|i
op_star
r_sizeof
(paren
r_struct
id|tg3_rx_buffer_desc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_MINI(%d)[0][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|rxd
op_add_assign
(paren
l_int|4
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_MINI(%d)[1][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|rxd
suffix:semicolon
id|rxd
op_assign
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_RX_JUMBO_BUFFER_DESC
op_plus
(paren
id|i
op_star
r_sizeof
(paren
r_struct
id|tg3_rx_buffer_desc
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_JUMBO(%d)[0][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
id|rxd
op_add_assign
(paren
l_int|4
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DEBUG: NIC RXD_JUMBO(%d)[1][%08x:%08x:%08x:%08x]&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x0
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x4
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0x8
)paren
comma
id|readl
c_func
(paren
id|rxd
op_plus
l_int|0xc
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_static
r_struct
id|net_device_stats
op_star
id|tg3_get_stats
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
DECL|function|tg3_close
r_static
r_int
id|tg3_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
macro_line|#if 0
id|tg3_dump_state
c_func
(paren
id|tp
)paren
suffix:semicolon
macro_line|#endif
id|tg3_disable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_free_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tp-&gt;tg3_flags
op_and_assign
op_complement
(paren
id|TG3_FLAG_INIT_COMPLETE
op_or
id|TG3_FLAG_GOT_SERDES_FLOWCTL
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|tp-&gt;net_stats_prev
comma
id|tg3_get_stats
c_func
(paren
id|tp-&gt;dev
)paren
comma
r_sizeof
(paren
id|tp-&gt;net_stats_prev
)paren
)paren
suffix:semicolon
id|tg3_free_consistent
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_stat64
r_static
r_inline
r_int
r_int
id|get_stat64
c_func
(paren
id|tg3_stat64_t
op_star
id|val
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
macro_line|#if (BITS_PER_LONG == 32)
id|ret
op_assign
id|val-&gt;low
suffix:semicolon
macro_line|#else
id|ret
op_assign
(paren
(paren
id|u64
)paren
id|val-&gt;high
op_lshift
l_int|32
)paren
op_or
(paren
(paren
id|u64
)paren
id|val-&gt;low
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
DECL|function|calc_crc_errors
r_static
r_int
r_int
id|calc_crc_errors
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_struct
id|tg3_hw_stats
op_star
id|hw_stats
op_assign
id|tp-&gt;hw_stats
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_ne
id|PHY_ID_SERDES
op_logical_and
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
op_logical_or
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5701
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
l_int|0x1e
comma
op_amp
id|val
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
l_int|0x1e
comma
id|val
op_or
l_int|0x8000
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
l_int|0x14
comma
op_amp
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tp-&gt;phy_crc_errors
op_add_assign
id|val
suffix:semicolon
r_return
id|tp-&gt;phy_crc_errors
suffix:semicolon
)brace
r_return
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_fcs_errors
)paren
suffix:semicolon
)brace
DECL|function|tg3_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|tg3_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|tp-&gt;net_stats
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|old_stats
op_assign
op_amp
id|tp-&gt;net_stats_prev
suffix:semicolon
r_struct
id|tg3_hw_stats
op_star
id|hw_stats
op_assign
id|tp-&gt;hw_stats
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hw_stats
)paren
r_return
id|old_stats
suffix:semicolon
id|stats-&gt;rx_packets
op_assign
id|old_stats-&gt;rx_packets
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_ucast_packets
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_mcast_packets
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_bcast_packets
)paren
suffix:semicolon
id|stats-&gt;tx_packets
op_assign
id|old_stats-&gt;tx_packets
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;COS_out_packets
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|stats-&gt;rx_bytes
op_assign
id|old_stats-&gt;rx_bytes
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_octets
)paren
suffix:semicolon
id|stats-&gt;tx_bytes
op_assign
id|old_stats-&gt;tx_bytes
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_octets
)paren
suffix:semicolon
id|stats-&gt;rx_errors
op_assign
id|old_stats-&gt;rx_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_errors
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_assign
id|old_stats-&gt;tx_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_errors
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_mac_errors
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_carrier_sense_errors
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_discards
)paren
suffix:semicolon
id|stats-&gt;multicast
op_assign
id|old_stats-&gt;multicast
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_mcast_packets
)paren
suffix:semicolon
id|stats-&gt;collisions
op_assign
id|old_stats-&gt;collisions
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_collisions
)paren
suffix:semicolon
id|stats-&gt;rx_length_errors
op_assign
id|old_stats-&gt;rx_length_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_frame_too_long_errors
)paren
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_undersize_packets
)paren
suffix:semicolon
id|stats-&gt;rx_over_errors
op_assign
id|old_stats-&gt;rx_over_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rxbds_empty
)paren
suffix:semicolon
id|stats-&gt;rx_frame_errors
op_assign
id|old_stats-&gt;rx_frame_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;rx_align_errors
)paren
suffix:semicolon
id|stats-&gt;tx_aborted_errors
op_assign
id|old_stats-&gt;tx_aborted_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_discards
)paren
suffix:semicolon
id|stats-&gt;tx_carrier_errors
op_assign
id|old_stats-&gt;tx_carrier_errors
op_plus
id|get_stat64
c_func
(paren
op_amp
id|hw_stats-&gt;tx_carrier_sense_errors
)paren
suffix:semicolon
id|stats-&gt;rx_crc_errors
op_assign
id|old_stats-&gt;rx_crc_errors
op_plus
id|calc_crc_errors
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
id|stats
suffix:semicolon
)brace
DECL|function|calc_crc
r_static
r_inline
id|u32
id|calc_crc
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_int
id|len
)paren
(brace
id|u32
id|reg
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_int
id|j
comma
id|k
suffix:semicolon
id|reg
op_assign
l_int|0xffffffff
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|len
suffix:semicolon
id|j
op_increment
)paren
(brace
id|reg
op_xor_assign
id|buf
(braket
id|j
)braket
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|8
suffix:semicolon
id|k
op_increment
)paren
(brace
id|tmp
op_assign
id|reg
op_amp
l_int|0x01
suffix:semicolon
id|reg
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|reg
op_xor_assign
l_int|0xedb88320
suffix:semicolon
)brace
)brace
)brace
r_return
op_complement
id|reg
suffix:semicolon
)brace
DECL|function|tg3_set_multi
r_static
r_void
id|tg3_set_multi
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_int
r_int
id|accept_all
)paren
(brace
multiline_comment|/* accept or reject all multicast frames */
id|tw32
(paren
id|MAC_HASH_REG_0
comma
id|accept_all
ques
c_cond
l_int|0xffffffff
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_1
comma
id|accept_all
ques
c_cond
l_int|0xffffffff
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_2
comma
id|accept_all
ques
c_cond
l_int|0xffffffff
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_3
comma
id|accept_all
ques
c_cond
l_int|0xffffffff
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|__tg3_set_rx_mode
r_static
r_void
id|__tg3_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|rx_mode
suffix:semicolon
id|rx_mode
op_assign
id|tp-&gt;rx_mode
op_amp
op_complement
id|RX_MODE_PROMISC
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Promiscuous mode. */
id|rx_mode
op_or_assign
id|RX_MODE_PROMISC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
multiline_comment|/* Accept all multicast. */
id|tg3_set_multi
(paren
id|tp
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
OL
l_int|1
)paren
(brace
multiline_comment|/* Reject all multicast. */
id|tg3_set_multi
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Accept one or more multicast(s). */
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|4
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|u32
id|regidx
suffix:semicolon
id|u32
id|bit
suffix:semicolon
id|u32
id|crc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|crc
op_assign
id|calc_crc
(paren
id|mclist-&gt;dmi_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|bit
op_assign
op_complement
id|crc
op_amp
l_int|0x7f
suffix:semicolon
id|regidx
op_assign
(paren
id|bit
op_amp
l_int|0x60
)paren
op_rshift
l_int|5
suffix:semicolon
id|bit
op_and_assign
l_int|0x1f
suffix:semicolon
id|mc_filter
(braket
id|regidx
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
)brace
id|tw32
(paren
id|MAC_HASH_REG_0
comma
id|mc_filter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_1
comma
id|mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_2
comma
id|mc_filter
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|tw32
(paren
id|MAC_HASH_REG_3
comma
id|mc_filter
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_mode
op_ne
id|tp-&gt;rx_mode
)paren
(brace
id|tp-&gt;rx_mode
op_assign
id|rx_mode
suffix:semicolon
id|tw32
(paren
id|MAC_RX_MODE
comma
id|rx_mode
)paren
suffix:semicolon
)brace
)brace
DECL|function|tg3_set_rx_mode
r_static
r_void
id|tg3_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|__tg3_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|macro|TG3_REGDUMP_LEN
mdefine_line|#define TG3_REGDUMP_LEN&t;&t;(32 * 1024)
DECL|function|tg3_get_regs
r_static
id|u8
op_star
id|tg3_get_regs
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u8
op_star
id|orig_p
op_assign
id|kmalloc
c_func
(paren
id|TG3_REGDUMP_LEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|u8
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|orig_p
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|orig_p
comma
l_int|0
comma
id|TG3_REGDUMP_LEN
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
DECL|macro|__GET_REG32
mdefine_line|#define __GET_REG32(reg)&t;(*((u32 *)(p))++ = tr32(reg))
DECL|macro|GET_REG32_LOOP
mdefine_line|#define GET_REG32_LOOP(base,len)&t;&t;&bslash;&n;do {&t;p = orig_p + (base);&t;&t;&t;&bslash;&n;&t;for (i = 0; i &lt; len; i += 4)&t;&t;&bslash;&n;&t;&t;__GET_REG32((base) + i);&t;&bslash;&n;} while (0)
DECL|macro|GET_REG32_1
mdefine_line|#define GET_REG32_1(reg)&t;&bslash;&n;do {&t;p = orig_p + (reg);&t;&bslash;&n;&t;__GET_REG32((reg));&t;&bslash;&n;} while (0)
id|GET_REG32_LOOP
c_func
(paren
id|TG3PCI_VENDOR
comma
l_int|0xb0
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|MAILBOX_INTERRUPT_0
comma
l_int|0x200
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|MAC_MODE
comma
l_int|0x4f0
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|SNDDATAI_MODE
comma
l_int|0xe0
)paren
suffix:semicolon
id|GET_REG32_1
c_func
(paren
id|SNDDATAC_MODE
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|SNDBDS_MODE
comma
l_int|0x80
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|SNDBDI_MODE
comma
l_int|0x48
)paren
suffix:semicolon
id|GET_REG32_1
c_func
(paren
id|SNDBDC_MODE
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVLPC_MODE
comma
l_int|0x20
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVLPC_SELLST_BASE
comma
l_int|0x15c
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVDBDI_MODE
comma
l_int|0x0c
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVDBDI_JUMBO_BD
comma
l_int|0x3c
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVDBDI_BD_PROD_IDX_0
comma
l_int|0x44
)paren
suffix:semicolon
id|GET_REG32_1
c_func
(paren
id|RCVDCC_MODE
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVBDI_MODE
comma
l_int|0x20
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVCC_MODE
comma
l_int|0x14
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RCVLSC_MODE
comma
l_int|0x08
)paren
suffix:semicolon
id|GET_REG32_1
c_func
(paren
id|MBFREE_MODE
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|HOSTCC_MODE
comma
l_int|0x100
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|MEMARB_MODE
comma
l_int|0x10
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|BUFMGR_MODE
comma
l_int|0x58
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RDMAC_MODE
comma
l_int|0x08
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|WDMAC_MODE
comma
l_int|0x08
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|RX_CPU_BASE
comma
l_int|0x280
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|TX_CPU_BASE
comma
l_int|0x280
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|GRCMBOX_INTERRUPT_0
comma
l_int|0x110
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|FTQ_RESET
comma
l_int|0x120
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|MSGINT_MODE
comma
l_int|0x0c
)paren
suffix:semicolon
id|GET_REG32_1
c_func
(paren
id|DMAC_MODE
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|GRC_MODE
comma
l_int|0x4c
)paren
suffix:semicolon
id|GET_REG32_LOOP
c_func
(paren
id|NVRAM_CMD
comma
l_int|0x24
)paren
suffix:semicolon
DECL|macro|__GET_REG32
macro_line|#undef __GET_REG32
DECL|macro|GET_REG32_LOOP
macro_line|#undef GET_REG32_LOOP
DECL|macro|GET_REG32_1
macro_line|#undef GET_REG32_1
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
id|orig_p
suffix:semicolon
)brace
DECL|function|tg3_to_ethtool_coal
r_static
r_void
id|tg3_to_ethtool_coal
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_struct
id|ethtool_coalesce
op_star
id|ecoal
)paren
(brace
id|ecoal-&gt;rx_coalesce_usecs
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
suffix:semicolon
id|ecoal-&gt;rx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
suffix:semicolon
id|ecoal-&gt;rx_coalesce_usecs_irq
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int_def
suffix:semicolon
id|ecoal-&gt;rx_max_coalesced_frames_irq
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int_def
suffix:semicolon
id|ecoal-&gt;tx_coalesce_usecs
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
suffix:semicolon
id|ecoal-&gt;tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
suffix:semicolon
id|ecoal-&gt;tx_coalesce_usecs_irq
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int_def
suffix:semicolon
id|ecoal-&gt;tx_max_coalesced_frames_irq
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int_def
suffix:semicolon
id|ecoal-&gt;stats_block_coalesce_usecs
op_assign
id|tp-&gt;coalesce_config.stats_coalesce_ticks_def
suffix:semicolon
id|ecoal-&gt;use_adaptive_rx_coalesce
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_ADAPTIVE_RX
)paren
op_ne
l_int|0
suffix:semicolon
id|ecoal-&gt;use_adaptive_tx_coalesce
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_ADAPTIVE_TX
)paren
op_ne
l_int|0
suffix:semicolon
id|ecoal-&gt;pkt_rate_low
op_assign
id|tp-&gt;coalesce_config.pkt_rate_low
suffix:semicolon
id|ecoal-&gt;rx_coalesce_usecs_low
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_low
suffix:semicolon
id|ecoal-&gt;rx_max_coalesced_frames_low
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_low
suffix:semicolon
id|ecoal-&gt;tx_coalesce_usecs_low
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_low
suffix:semicolon
id|ecoal-&gt;tx_max_coalesced_frames_low
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_low
suffix:semicolon
id|ecoal-&gt;pkt_rate_high
op_assign
id|tp-&gt;coalesce_config.pkt_rate_high
suffix:semicolon
id|ecoal-&gt;rx_coalesce_usecs_high
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_high
suffix:semicolon
id|ecoal-&gt;rx_max_coalesced_frames_high
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_high
suffix:semicolon
id|ecoal-&gt;tx_coalesce_usecs_high
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_high
suffix:semicolon
id|ecoal-&gt;tx_max_coalesced_frames_high
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_high
suffix:semicolon
id|ecoal-&gt;rate_sample_interval
op_assign
id|tp-&gt;coalesce_config.rate_sample_jiffies
op_div
id|HZ
suffix:semicolon
)brace
DECL|function|tg3_from_ethtool_coal
r_static
r_int
id|tg3_from_ethtool_coal
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
r_struct
id|ethtool_coalesce
op_star
id|ecoal
)paren
(brace
multiline_comment|/* Make sure we are not getting garbage. */
r_if
c_cond
(paren
(paren
id|ecoal-&gt;rx_coalesce_usecs
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;rx_max_coalesced_frames
op_eq
l_int|0
)paren
op_logical_or
(paren
id|ecoal-&gt;tx_coalesce_usecs
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;tx_max_coalesced_frames
op_eq
l_int|0
)paren
op_logical_or
id|ecoal-&gt;stats_block_coalesce_usecs
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;use_adaptive_rx_coalesce
op_logical_or
id|ecoal-&gt;use_adaptive_tx_coalesce
)paren
(brace
r_if
c_cond
(paren
id|ecoal-&gt;pkt_rate_low
OG
id|ecoal-&gt;pkt_rate_high
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;rate_sample_interval
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;use_adaptive_rx_coalesce
op_logical_and
(paren
(paren
id|ecoal-&gt;rx_coalesce_usecs_low
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;rx_max_coalesced_frames_low
op_eq
l_int|0
)paren
op_logical_or
(paren
id|ecoal-&gt;rx_coalesce_usecs_high
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;rx_max_coalesced_frames_high
op_eq
l_int|0
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;use_adaptive_tx_coalesce
op_logical_and
(paren
(paren
id|ecoal-&gt;tx_coalesce_usecs_low
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;tx_max_coalesced_frames_low
op_eq
l_int|0
)paren
op_logical_or
(paren
id|ecoal-&gt;tx_coalesce_usecs_high
op_eq
l_int|0
op_logical_and
id|ecoal-&gt;tx_max_coalesced_frames_high
op_eq
l_int|0
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Looks good, let it rip. */
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
op_assign
id|ecoal-&gt;rx_coalesce_usecs
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
op_assign
id|ecoal-&gt;rx_max_coalesced_frames
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int_def
op_assign
id|ecoal-&gt;rx_coalesce_usecs_irq
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int_def
op_assign
id|ecoal-&gt;rx_max_coalesced_frames_irq
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
op_assign
id|ecoal-&gt;tx_coalesce_usecs
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
op_assign
id|ecoal-&gt;tx_max_coalesced_frames
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int_def
op_assign
id|ecoal-&gt;tx_coalesce_usecs_irq
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int_def
op_assign
id|ecoal-&gt;tx_max_coalesced_frames_irq
suffix:semicolon
id|tp-&gt;coalesce_config.stats_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.stats_coalesce_ticks_def
op_assign
id|ecoal-&gt;stats_block_coalesce_usecs
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;use_adaptive_rx_coalesce
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_ADAPTIVE_RX
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_ADAPTIVE_RX
suffix:semicolon
r_if
c_cond
(paren
id|ecoal-&gt;use_adaptive_tx_coalesce
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_ADAPTIVE_TX
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_ADAPTIVE_TX
suffix:semicolon
id|tp-&gt;coalesce_config.pkt_rate_low
op_assign
id|ecoal-&gt;pkt_rate_low
suffix:semicolon
id|tp-&gt;coalesce_config.pkt_rate_high
op_assign
id|ecoal-&gt;pkt_rate_high
suffix:semicolon
id|tp-&gt;coalesce_config.rate_sample_jiffies
op_assign
id|ecoal-&gt;rate_sample_interval
op_star
id|HZ
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_low
op_assign
id|ecoal-&gt;rx_coalesce_usecs_low
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_low
op_assign
id|ecoal-&gt;rx_max_coalesced_frames_low
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_low
op_assign
id|ecoal-&gt;tx_coalesce_usecs_low
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_low
op_assign
id|ecoal-&gt;tx_max_coalesced_frames_low
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_high
op_assign
id|ecoal-&gt;rx_coalesce_usecs_high
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_high
op_assign
id|ecoal-&gt;rx_max_coalesced_frames_high
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_high
op_assign
id|ecoal-&gt;tx_coalesce_usecs_high
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_high
op_assign
id|ecoal-&gt;tx_max_coalesced_frames_high
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXCOL_TICKS
comma
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXCOAL_TICK_INT
comma
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXCOAL_MAXF_INT
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOL_TICKS
comma
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOAL_TICK_INT
comma
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_TXCOAL_MAXF_INT
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int_def
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_STAT_COAL_TICKS
comma
id|tp-&gt;coalesce_config.stats_coalesce_ticks_def
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_ethtool_ioctl
r_static
r_int
id|tg3_ethtool_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|useraddr
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
id|tp-&gt;pdev
suffix:semicolon
id|u32
id|ethcmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|ethcmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
(paren
id|info.driver
comma
id|DRV_MODULE_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info.version
comma
id|DRV_MODULE_VERSION
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info.fw_version
comma
l_int|0
comma
r_sizeof
(paren
id|info.fw_version
)paren
)paren
suffix:semicolon
id|strcpy
(paren
id|info.bus_info
comma
id|pci_dev-&gt;slot_name
)paren
suffix:semicolon
id|info.eedump_len
op_assign
l_int|0
suffix:semicolon
id|info.regdump_len
op_assign
id|TG3_REGDUMP_LEN
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
op_assign
(brace
id|ETHTOOL_GSET
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
op_logical_or
id|tp-&gt;link_config.phy_is_low_power
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|cmd.supported
op_assign
(paren
id|SUPPORTED_Autoneg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
)paren
id|cmd.supported
op_or_assign
(paren
id|SUPPORTED_1000baseT_Half
op_or
id|SUPPORTED_1000baseT_Full
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_ne
id|PHY_ID_SERDES
)paren
id|cmd.supported
op_or_assign
(paren
id|SUPPORTED_100baseT_Half
op_or
id|SUPPORTED_100baseT_Full
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_MII
)paren
suffix:semicolon
r_else
id|cmd.supported
op_or_assign
id|SUPPORTED_FIBRE
suffix:semicolon
id|cmd.advertising
op_assign
id|tp-&gt;link_config.advertising
suffix:semicolon
id|cmd.speed
op_assign
id|tp-&gt;link_config.active_speed
suffix:semicolon
id|cmd.duplex
op_assign
id|tp-&gt;link_config.active_duplex
suffix:semicolon
id|cmd.port
op_assign
l_int|0
suffix:semicolon
id|cmd.phy_address
op_assign
id|PHY_ADDR
suffix:semicolon
id|cmd.transceiver
op_assign
l_int|0
suffix:semicolon
id|cmd.autoneg
op_assign
id|tp-&gt;link_config.autoneg
suffix:semicolon
id|cmd.maxtxpkt
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
suffix:semicolon
id|cmd.maxrxpkt
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_INIT_COMPLETE
)paren
op_logical_or
id|tp-&gt;link_config.phy_is_low_power
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmd
comma
id|useraddr
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* Fiber PHY only supports 1000 full/half */
r_if
c_cond
(paren
id|cmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
op_logical_and
(paren
id|cmd.advertising
op_amp
(paren
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_100baseT_Half
op_or
id|ADVERTISED_100baseT_Full
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
op_logical_and
(paren
id|cmd.advertising
op_amp
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
op_logical_and
(paren
id|cmd.speed
op_eq
id|SPEED_10
op_logical_or
id|cmd.speed
op_eq
id|SPEED_100
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
op_logical_and
(paren
id|cmd.speed
op_eq
id|SPEED_10
op_logical_or
id|cmd.speed
op_eq
id|SPEED_100
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tp-&gt;link_config.autoneg
op_assign
id|cmd.autoneg
suffix:semicolon
r_if
c_cond
(paren
id|cmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
id|tp-&gt;link_config.advertising
op_assign
id|cmd.advertising
suffix:semicolon
id|tp-&gt;link_config.speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;link_config.speed
op_assign
id|cmd.speed
suffix:semicolon
id|tp-&gt;link_config.duplex
op_assign
id|cmd.duplex
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd.maxtxpkt
op_logical_or
id|cmd.maxrxpkt
)paren
(brace
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|cmd.maxtxpkt
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|cmd.maxrxpkt
suffix:semicolon
multiline_comment|/* Coalescing config bits can be updated without&n;&t;&t;&t; * a full chip reset.&n;&t;&t;&t; */
id|tw32
c_func
(paren
id|HOSTCC_TXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|HOSTCC_RXMAX_FRAMES
comma
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
)paren
suffix:semicolon
)brace
id|tg3_setup_phy
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GREGS
suffix:colon
(brace
r_struct
id|ethtool_regs
id|regs
suffix:semicolon
id|u8
op_star
id|regbuf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|regs
comma
id|useraddr
comma
r_sizeof
(paren
id|regs
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|regs.len
OG
id|TG3_REGDUMP_LEN
)paren
id|regs.len
op_assign
id|TG3_REGDUMP_LEN
suffix:semicolon
id|regs.version
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|regbuf
op_assign
id|tg3_get_regs
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|regbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|useraddr
op_add_assign
m_offsetof
(paren
r_struct
id|ethtool_regs
comma
id|data
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
id|regbuf
comma
id|regs.len
)paren
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|kfree
c_func
(paren
id|regbuf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_case
id|ETHTOOL_GWOL
suffix:colon
(brace
r_struct
id|ethtool_wolinfo
id|wol
op_assign
(brace
id|ETHTOOL_GWOL
)brace
suffix:semicolon
id|wol.supported
op_assign
id|WAKE_MAGIC
suffix:semicolon
id|wol.wolopts
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_WOL_ENABLE
)paren
id|wol.wolopts
op_assign
id|WAKE_MAGIC
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|wol.sopass
comma
l_int|0
comma
r_sizeof
(paren
id|wol.sopass
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|wol
comma
r_sizeof
(paren
id|wol
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SWOL
suffix:colon
(brace
r_struct
id|ethtool_wolinfo
id|wol
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|wol
comma
id|useraddr
comma
r_sizeof
(paren
id|wol
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|wol.wolopts
op_amp
op_complement
id|WAKE_MAGIC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wol.wolopts
op_amp
id|WAKE_MAGIC
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_WOL_ENABLE
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_WOL_ENABLE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GMSGLVL
)brace
suffix:semicolon
id|edata.data
op_assign
id|tp-&gt;msg_enable
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|tp-&gt;msg_enable
op_assign
id|edata.data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_NWAY_RST
suffix:colon
(brace
id|u32
id|bmcr
suffix:semicolon
r_int
id|r
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
op_amp
id|bmcr
)paren
suffix:semicolon
id|r
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|bmcr
op_amp
id|BMCR_ANENABLE
)paren
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
id|bmcr
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|r
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|edata.data
op_assign
id|netif_carrier_ok
c_func
(paren
id|tp-&gt;dev
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GCOALESCE
suffix:colon
(brace
r_struct
id|ethtool_coalesce
id|ecoal
op_assign
(brace
id|ETHTOOL_GCOALESCE
)brace
suffix:semicolon
id|tg3_to_ethtool_coal
c_func
(paren
id|tp
comma
op_amp
id|ecoal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ecoal
comma
r_sizeof
(paren
id|ecoal
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SCOALESCE
suffix:colon
(brace
r_struct
id|ethtool_coalesce
id|ecoal
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ecoal
comma
id|useraddr
comma
r_sizeof
(paren
id|ecoal
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|tg3_from_ethtool_coal
c_func
(paren
id|tp
comma
op_amp
id|ecoal
)paren
suffix:semicolon
)brace
r_case
id|ETHTOOL_GRINGPARAM
suffix:colon
(brace
r_struct
id|ethtool_ringparam
id|ering
op_assign
(brace
id|ETHTOOL_GRINGPARAM
)brace
suffix:semicolon
id|ering.rx_max_pending
op_assign
id|TG3_RX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|ering.rx_mini_max_pending
op_assign
id|TG3_RX_MINI_RING_SIZE
op_minus
l_int|1
suffix:semicolon
macro_line|#else
id|ering.rx_mini_max_pending
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|ering.rx_jumbo_max_pending
op_assign
id|TG3_RX_JUMBO_RING_SIZE
op_minus
l_int|1
suffix:semicolon
id|ering.rx_pending
op_assign
id|tp-&gt;rx_pending
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|ering.rx_mini_pending
op_assign
id|tp-&gt;rx_mini_pending
suffix:semicolon
macro_line|#else
id|ering.rx_mini_pending
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|ering.rx_jumbo_pending
op_assign
id|tp-&gt;rx_jumbo_pending
suffix:semicolon
id|ering.tx_pending
op_assign
id|tp-&gt;tx_pending
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ering
comma
r_sizeof
(paren
id|ering
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SRINGPARAM
suffix:colon
(brace
r_struct
id|ethtool_ringparam
id|ering
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ering
comma
id|useraddr
comma
r_sizeof
(paren
id|ering
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ering.rx_pending
OG
id|TG3_RX_RING_SIZE
op_minus
l_int|1
)paren
op_logical_or
macro_line|#if TG3_MINI_RING_WORKS
(paren
id|ering.rx_mini_pending
OG
id|TG3_RX_MINI_RING_SIZE
op_minus
l_int|1
)paren
op_logical_or
macro_line|#endif
(paren
id|ering.rx_jumbo_pending
OG
id|TG3_RX_JUMBO_RING_SIZE
op_minus
l_int|1
)paren
op_logical_or
(paren
id|ering.tx_pending
OG
id|TG3_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tp-&gt;rx_pending
op_assign
id|ering.rx_pending
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tp-&gt;rx_mini_pending
op_assign
id|ering.rx_mini_pending
suffix:semicolon
macro_line|#endif
id|tp-&gt;rx_jumbo_pending
op_assign
id|ering.rx_jumbo_pending
suffix:semicolon
id|tp-&gt;tx_pending
op_assign
id|ering.tx_pending
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GPAUSEPARAM
suffix:colon
(brace
r_struct
id|ethtool_pauseparam
id|epause
op_assign
(brace
id|ETHTOOL_GPAUSEPARAM
)brace
suffix:semicolon
id|epause.autoneg
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PAUSE_AUTONEG
)paren
op_ne
l_int|0
suffix:semicolon
id|epause.rx_pause
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PAUSE_RX
)paren
op_ne
l_int|0
suffix:semicolon
id|epause.tx_pause
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PAUSE_TX
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|epause
comma
r_sizeof
(paren
id|epause
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SPAUSEPARAM
suffix:colon
(brace
r_struct
id|ethtool_pauseparam
id|epause
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|epause
comma
id|useraddr
comma
r_sizeof
(paren
id|epause
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epause.autoneg
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PAUSE_AUTONEG
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_PAUSE_AUTONEG
suffix:semicolon
r_if
c_cond
(paren
id|epause.rx_pause
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PAUSE_RX
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_PAUSE_RX
suffix:semicolon
r_if
c_cond
(paren
id|epause.tx_pause
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PAUSE_TX
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_PAUSE_TX
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GRXCSUM
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GRXCSUM
)brace
suffix:semicolon
id|edata.data
op_assign
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_RX_CHECKSUMS
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SRXCSUM
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_BROKEN_CHECKSUMS
)paren
(brace
r_if
c_cond
(paren
id|edata.data
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edata.data
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_RX_CHECKSUMS
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_RX_CHECKSUMS
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GTXCSUM
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GTXCSUM
)brace
suffix:semicolon
id|edata.data
op_assign
(paren
id|tp-&gt;dev-&gt;features
op_amp
id|NETIF_F_IP_CSUM
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_STXCSUM
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_BROKEN_CHECKSUMS
)paren
(brace
r_if
c_cond
(paren
id|edata.data
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|edata.data
)paren
id|tp-&gt;dev-&gt;features
op_or_assign
id|NETIF_F_IP_CSUM
suffix:semicolon
r_else
id|tp-&gt;dev-&gt;features
op_and_assign
op_complement
id|NETIF_F_IP_CSUM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GSG
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GSG
)brace
suffix:semicolon
id|edata.data
op_assign
(paren
id|tp-&gt;dev-&gt;features
op_amp
id|NETIF_F_SG
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SSG
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|edata.data
)paren
id|tp-&gt;dev-&gt;features
op_or_assign
id|NETIF_F_SG
suffix:semicolon
r_else
id|tp-&gt;dev-&gt;features
op_and_assign
op_complement
id|NETIF_F_SG
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|tg3_ioctl
r_static
r_int
id|tg3_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|ifr-&gt;ifr_data
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|tg3_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|ifr-&gt;ifr_data
)paren
suffix:semicolon
r_case
id|SIOCGMIIPHY
suffix:colon
id|data-&gt;phy_id
op_assign
id|PHY_ADDR
suffix:semicolon
multiline_comment|/* fallthru */
r_case
id|SIOCGMIIREG
suffix:colon
(brace
id|u32
id|mii_regval
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
op_amp
id|mii_regval
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|data-&gt;val_out
op_assign
id|mii_regval
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_case
id|SIOCSMIIREG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
id|data-&gt;val_in
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
macro_line|#if TG3_VLAN_TAG_USED
DECL|function|tg3_vlan_rx_register
r_static
r_void
id|tg3_vlan_rx_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|vlan_group
op_star
id|grp
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tp-&gt;vlgrp
op_assign
id|grp
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|tg3_vlan_rx_kill_vid
r_static
r_void
id|tg3_vlan_rx_kill_vid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;vlgrp
)paren
id|tp-&gt;vlgrp-&gt;vlan_devices
(braket
id|vid
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Chips other than 5700/5701 use the NVRAM for fetching info. */
DECL|function|tg3_nvram_init
r_static
r_void
id|__devinit
id|tg3_nvram_init
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
id|j
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_EEPROM_ADDR
comma
(paren
id|EEPROM_ADDR_FSM_RESET
op_or
(paren
id|EEPROM_DEFAULT_CLOCK_PERIOD
op_lshift
id|EEPROM_ADDR_CLKPERD_SHIFT
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* XXX schedule_timeout() ... */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|100
suffix:semicolon
id|j
op_increment
)paren
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Enable seeprom accesses. */
id|tw32
c_func
(paren
id|GRC_LOCAL_CTRL
comma
id|tr32
c_func
(paren
id|GRC_LOCAL_CTRL
)paren
op_or
id|GRC_LCLCTRL_AUTO_SEEPROM
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|ASIC_REV_5700
op_logical_and
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|ASIC_REV_5701
)paren
(brace
id|u32
id|nvcfg1
op_assign
id|tr32
c_func
(paren
id|NVRAM_CFG1
)paren
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_NVRAM
suffix:semicolon
r_if
c_cond
(paren
id|nvcfg1
op_amp
id|NVRAM_CFG1_FLASHIF_ENAB
)paren
(brace
r_if
c_cond
(paren
id|nvcfg1
op_amp
id|NVRAM_CFG1_BUFFERED_MODE
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_NVRAM_BUFFERED
suffix:semicolon
)brace
r_else
(brace
id|nvcfg1
op_and_assign
op_complement
id|NVRAM_CFG1_COMPAT_BYPASS
suffix:semicolon
id|tw32
c_func
(paren
id|NVRAM_CFG1
comma
id|nvcfg1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|tp-&gt;tg3_flags
op_and_assign
op_complement
(paren
id|TG3_FLAG_NVRAM
op_or
id|TG3_FLAG_NVRAM_BUFFERED
)paren
suffix:semicolon
)brace
)brace
DECL|function|tg3_nvram_read_using_eeprom
r_static
r_int
id|__devinit
id|tg3_nvram_read_using_eeprom
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|offset
comma
id|u32
op_star
id|val
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
id|EEPROM_ADDR_ADDR_MASK
op_logical_or
(paren
id|offset
op_mod
l_int|4
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|tmp
op_assign
id|tr32
c_func
(paren
id|GRC_EEPROM_ADDR
)paren
op_amp
op_complement
(paren
id|EEPROM_ADDR_ADDR_MASK
op_or
id|EEPROM_ADDR_DEVID_MASK
op_or
id|EEPROM_ADDR_READ
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|GRC_EEPROM_ADDR
comma
id|tmp
op_or
(paren
l_int|0
op_lshift
id|EEPROM_ADDR_DEVID_SHIFT
)paren
op_or
(paren
(paren
id|offset
op_lshift
id|EEPROM_ADDR_ADDR_SHIFT
)paren
op_amp
id|EEPROM_ADDR_ADDR_MASK
)paren
op_or
id|EEPROM_ADDR_READ
op_or
id|EEPROM_ADDR_START
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmp
op_assign
id|tr32
c_func
(paren
id|GRC_EEPROM_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_amp
id|EEPROM_ADDR_COMPLETE
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|EEPROM_ADDR_COMPLETE
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
op_star
id|val
op_assign
id|tr32
c_func
(paren
id|GRC_EEPROM_DATA
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_nvram_read
r_static
r_int
id|__devinit
id|tg3_nvram_read
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
id|offset
comma
id|u32
op_star
id|val
)paren
(brace
r_int
id|i
comma
id|saw_done_clear
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_NVRAM
)paren
)paren
r_return
id|tg3_nvram_read_using_eeprom
c_func
(paren
id|tp
comma
id|offset
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_NVRAM_BUFFERED
)paren
id|offset
op_assign
(paren
(paren
id|offset
op_div
id|NVRAM_BUFFERED_PAGE_SIZE
)paren
op_lshift
id|NVRAM_BUFFERED_PAGE_POS
)paren
op_plus
(paren
id|offset
op_mod
id|NVRAM_BUFFERED_PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
id|NVRAM_ADDR_MSK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|tw32
c_func
(paren
id|NVRAM_SWARB
comma
id|SWARB_REQ_SET1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tr32
c_func
(paren
id|NVRAM_SWARB
)paren
op_amp
id|SWARB_GNT1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|NVRAM_ADDR
comma
id|offset
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|NVRAM_CMD
comma
id|NVRAM_CMD_RD
op_or
id|NVRAM_CMD_GO
op_or
id|NVRAM_CMD_FIRST
op_or
id|NVRAM_CMD_LAST
op_or
id|NVRAM_CMD_DONE
)paren
suffix:semicolon
multiline_comment|/* Wait for done bit to clear then set again. */
id|saw_done_clear
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|saw_done_clear
op_logical_and
op_logical_neg
(paren
id|tr32
c_func
(paren
id|NVRAM_CMD
)paren
op_amp
id|NVRAM_CMD_DONE
)paren
)paren
id|saw_done_clear
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|saw_done_clear
op_logical_and
(paren
id|tr32
c_func
(paren
id|NVRAM_CMD
)paren
op_amp
id|NVRAM_CMD_DONE
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|1000
)paren
(brace
id|tw32
c_func
(paren
id|NVRAM_SWARB
comma
id|SWARB_REQ_CLR1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
op_star
id|val
op_assign
id|swab32
c_func
(paren
id|tr32
c_func
(paren
id|NVRAM_RDDATA
)paren
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|NVRAM_SWARB
comma
l_int|0x20
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|subsys_tbl_ent
r_struct
id|subsys_tbl_ent
(brace
DECL|member|subsys_vendor
DECL|member|subsys_devid
id|u16
id|subsys_vendor
comma
id|subsys_devid
suffix:semicolon
DECL|member|phy_id
id|u32
id|phy_id
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|subsys_id_to_phy_id
r_static
r_struct
id|subsys_tbl_ent
id|subsys_id_to_phy_id
(braket
)braket
op_assign
(brace
multiline_comment|/* Broadcom boards. */
(brace
l_int|0x14e4
comma
l_int|0x1644
comma
id|PHY_ID_BCM5401
)brace
comma
multiline_comment|/* BCM95700A6 */
(brace
l_int|0x14e4
comma
l_int|0x0001
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95701A5 */
(brace
l_int|0x14e4
comma
l_int|0x0002
comma
id|PHY_ID_BCM8002
)brace
comma
multiline_comment|/* BCM95700T6 */
(brace
l_int|0x14e4
comma
l_int|0x0003
comma
id|PHY_ID_SERDES
)brace
comma
multiline_comment|/* BCM95700A9 */
(brace
l_int|0x14e4
comma
l_int|0x0005
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95701T1 */
(brace
l_int|0x14e4
comma
l_int|0x0006
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95701T8 */
(brace
l_int|0x14e4
comma
l_int|0x0007
comma
id|PHY_ID_SERDES
)brace
comma
multiline_comment|/* BCM95701A7 */
(brace
l_int|0x14e4
comma
l_int|0x0008
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95701A10 */
(brace
l_int|0x14e4
comma
l_int|0x8008
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95701A12 */
(brace
l_int|0x14e4
comma
l_int|0x0009
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95703Ax1 */
(brace
l_int|0x14e4
comma
l_int|0x8009
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BCM95703Ax2 */
multiline_comment|/* 3com boards. */
(brace
id|PCI_VENDOR_ID_3COM
comma
l_int|0x1000
comma
id|PHY_ID_BCM5401
)brace
comma
multiline_comment|/* 3C996T */
(brace
id|PCI_VENDOR_ID_3COM
comma
l_int|0x1006
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* 3C996BT */
multiline_comment|/* { PCI_VENDOR_ID_3COM, 0x1002, PHY_ID_XXX },     3C996CT */
multiline_comment|/* { PCI_VENDOR_ID_3COM, 0x1003, PHY_ID_XXX },     3C997T */
(brace
id|PCI_VENDOR_ID_3COM
comma
l_int|0x1004
comma
id|PHY_ID_SERDES
)brace
comma
multiline_comment|/* 3C996SX */
multiline_comment|/* { PCI_VENDOR_ID_3COM, 0x1005, PHY_ID_XXX },     3C997SZ */
(brace
id|PCI_VENDOR_ID_3COM
comma
l_int|0x1007
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* 3C1000T */
(brace
id|PCI_VENDOR_ID_3COM
comma
l_int|0x1008
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* 3C940BR01 */
multiline_comment|/* DELL boards. */
(brace
id|PCI_VENDOR_ID_DELL
comma
l_int|0x00d1
comma
id|PHY_ID_BCM5401
)brace
comma
multiline_comment|/* VIPER */
(brace
id|PCI_VENDOR_ID_DELL
comma
l_int|0x0106
comma
id|PHY_ID_BCM5401
)brace
comma
multiline_comment|/* JAGUAR */
(brace
id|PCI_VENDOR_ID_DELL
comma
l_int|0x0109
comma
id|PHY_ID_BCM5411
)brace
comma
multiline_comment|/* MERLOT */
(brace
id|PCI_VENDOR_ID_DELL
comma
l_int|0x010a
comma
id|PHY_ID_BCM5411
)brace
comma
multiline_comment|/* SLIM_MERLOT */
multiline_comment|/* Compaq boards. */
(brace
id|PCI_VENDOR_ID_COMPAQ
comma
l_int|0x007c
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BANSHEE */
(brace
id|PCI_VENDOR_ID_COMPAQ
comma
l_int|0x009a
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* BANSHEE_2 */
(brace
id|PCI_VENDOR_ID_COMPAQ
comma
l_int|0x007d
comma
id|PHY_ID_SERDES
)brace
comma
multiline_comment|/* CHANGELING */
(brace
id|PCI_VENDOR_ID_COMPAQ
comma
l_int|0x0085
comma
id|PHY_ID_BCM5701
)brace
comma
multiline_comment|/* NC7780 */
(brace
id|PCI_VENDOR_ID_COMPAQ
comma
l_int|0x0099
comma
id|PHY_ID_BCM5701
)brace
multiline_comment|/* NC7780_2 */
)brace
suffix:semicolon
DECL|function|tg3_phy_probe
r_static
r_int
id|__devinit
id|tg3_phy_probe
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|eeprom_phy_id
comma
id|hw_phy_id_1
comma
id|hw_phy_id_2
suffix:semicolon
id|u32
id|hw_phy_id
comma
id|hw_phy_id_masked
suffix:semicolon
r_enum
id|phy_led_mode
id|eeprom_led_mode
suffix:semicolon
id|u32
id|val
suffix:semicolon
r_int
id|i
comma
id|eeprom_signature_found
comma
id|err
suffix:semicolon
id|tp-&gt;phy_id
op_assign
id|PHY_ID_INVALID
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|subsys_id_to_phy_id
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|subsys_id_to_phy_id
(braket
id|i
)braket
dot
id|subsys_vendor
op_eq
id|tp-&gt;pdev-&gt;subsystem_vendor
)paren
op_logical_and
(paren
id|subsys_id_to_phy_id
(braket
id|i
)braket
dot
id|subsys_devid
op_eq
id|tp-&gt;pdev-&gt;subsystem_device
)paren
)paren
(brace
id|tp-&gt;phy_id
op_assign
id|subsys_id_to_phy_id
(braket
id|i
)braket
dot
id|phy_id
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|eeprom_phy_id
op_assign
id|PHY_ID_INVALID
suffix:semicolon
id|eeprom_led_mode
op_assign
id|led_mode_auto
suffix:semicolon
id|eeprom_signature_found
op_assign
l_int|0
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_DATA_SIG
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|NIC_SRAM_DATA_SIG_MAGIC
)paren
(brace
id|u32
id|nic_cfg
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_DATA_CFG
comma
op_amp
id|nic_cfg
)paren
suffix:semicolon
id|eeprom_signature_found
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nic_cfg
op_amp
id|NIC_SRAM_DATA_CFG_PHY_TYPE_MASK
)paren
op_eq
id|NIC_SRAM_DATA_CFG_PHY_TYPE_FIBER
)paren
(brace
id|eeprom_phy_id
op_assign
id|PHY_ID_SERDES
suffix:semicolon
)brace
r_else
(brace
id|u32
id|nic_phy_id
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_DATA_PHY_ID
comma
op_amp
id|nic_phy_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nic_phy_id
op_ne
l_int|0
)paren
(brace
id|u32
id|id1
op_assign
id|nic_phy_id
op_amp
id|NIC_SRAM_DATA_PHY_ID1_MASK
suffix:semicolon
id|u32
id|id2
op_assign
id|nic_phy_id
op_amp
id|NIC_SRAM_DATA_PHY_ID2_MASK
suffix:semicolon
id|eeprom_phy_id
op_assign
(paren
id|id1
op_rshift
l_int|16
)paren
op_lshift
l_int|10
suffix:semicolon
id|eeprom_phy_id
op_or_assign
(paren
id|id2
op_amp
l_int|0xfc00
)paren
op_lshift
l_int|16
suffix:semicolon
id|eeprom_phy_id
op_or_assign
(paren
id|id2
op_amp
l_int|0x03ff
)paren
op_lshift
l_int|0
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|nic_cfg
op_amp
id|NIC_SRAM_DATA_CFG_LED_MODE_MASK
)paren
(brace
r_case
id|NIC_SRAM_DATA_CFG_LED_TRIPLE_SPD
suffix:colon
id|eeprom_led_mode
op_assign
id|led_mode_three_link
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NIC_SRAM_DATA_CFG_LED_LINK_SPD
suffix:colon
id|eeprom_led_mode
op_assign
id|led_mode_link10
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|eeprom_led_mode
op_assign
id|led_mode_auto
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
)brace
id|err
op_assign
id|tg3_phy_reset
c_func
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* Now read the physical PHY_ID from the chip and verify&n;&t; * that it is sane.  If it doesn&squot;t look good, we fall back&n;&t; * to either the hard-coded table based PHY_ID and failing&n;&t; * that the value found in the eeprom area.&n;&t; */
id|err
op_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_PHYSID1
comma
op_amp
id|hw_phy_id_1
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_readphy
c_func
(paren
id|tp
comma
id|MII_PHYSID2
comma
op_amp
id|hw_phy_id_2
)paren
suffix:semicolon
id|hw_phy_id
op_assign
(paren
id|hw_phy_id_1
op_amp
l_int|0xffff
)paren
op_lshift
l_int|10
suffix:semicolon
id|hw_phy_id
op_or_assign
(paren
id|hw_phy_id_2
op_amp
l_int|0xfc00
)paren
op_lshift
l_int|16
suffix:semicolon
id|hw_phy_id
op_or_assign
(paren
id|hw_phy_id_2
op_amp
l_int|0x03ff
)paren
op_lshift
l_int|0
suffix:semicolon
id|hw_phy_id_masked
op_assign
id|hw_phy_id
op_amp
id|PHY_ID_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
id|KNOWN_PHY_ID
c_func
(paren
id|hw_phy_id_masked
)paren
)paren
(brace
id|tp-&gt;phy_id
op_assign
id|hw_phy_id
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* phy_id currently holds the value found in the&n;&t;&t; * subsys_id_to_phy_id[] table or PHY_ID_INVALID&n;&t;&t; * if a match was not found there.&n;&t;&t; */
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_INVALID
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|eeprom_signature_found
op_logical_or
op_logical_neg
id|KNOWN_PHY_ID
c_func
(paren
id|eeprom_phy_id
op_amp
id|PHY_ID_MASK
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|tp-&gt;phy_id
op_assign
id|eeprom_phy_id
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5703
)paren
(brace
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_AUX_CTRL
comma
l_int|0x0c00
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_ADDRESS
comma
l_int|0x201f
)paren
suffix:semicolon
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_DSP_RW_PORT
comma
l_int|0x2aaa
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B0
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PHY_RESET_ON_INIT
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PHY_RESET_ON_INIT
)paren
(brace
id|u32
id|mii_tg3_ctrl
suffix:semicolon
id|err
op_assign
id|tg3_phy_reset
c_func
(paren
id|tp
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* These chips, when reset, only advertise 10Mb capabilities.&n;&t;&t; * Fix that.&n;&t;&t; */
id|err
op_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_ADVERTISE
comma
(paren
id|ADVERTISE_CSMA
op_or
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
)paren
)paren
suffix:semicolon
id|mii_tg3_ctrl
op_assign
(paren
id|MII_TG3_CTRL_ADV_1000_HALF
op_or
id|MII_TG3_CTRL_ADV_1000_FULL
op_or
id|MII_TG3_CTRL_AS_MASTER
op_or
id|MII_TG3_CTRL_ENABLE_AS_MASTER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
id|mii_tg3_ctrl
op_assign
l_int|0
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_TG3_CTRL
comma
id|mii_tg3_ctrl
)paren
suffix:semicolon
id|err
op_or_assign
id|tg3_writephy
c_func
(paren
id|tp
comma
id|MII_BMCR
comma
(paren
id|BMCR_ANRESTART
op_or
id|BMCR_ANENABLE
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|err
op_logical_and
(paren
(paren
id|tp-&gt;phy_id
op_amp
id|PHY_ID_MASK
)paren
op_eq
id|PHY_ID_BCM5401
)paren
)paren
(brace
id|err
op_assign
id|tg3_init_5401phy_dsp
c_func
(paren
id|tp
)paren
suffix:semicolon
)brace
multiline_comment|/* Determine the PHY led mode. */
r_if
c_cond
(paren
id|tp-&gt;pdev-&gt;subsystem_vendor
op_eq
id|PCI_VENDOR_ID_DELL
)paren
(brace
id|tp-&gt;led_mode
op_assign
id|led_mode_link10
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;led_mode
op_assign
id|led_mode_three_link
suffix:semicolon
r_if
c_cond
(paren
id|eeprom_signature_found
op_logical_and
id|eeprom_led_mode
op_ne
id|led_mode_auto
)paren
id|tp-&gt;led_mode
op_assign
id|eeprom_led_mode
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
)paren
id|tp-&gt;link_config.advertising
op_assign
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
op_or
id|ADVERTISED_Autoneg
op_or
id|ADVERTISED_FIBRE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
id|tp-&gt;link_config.advertising
op_and_assign
op_complement
(paren
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_read_partno
r_static
r_void
id|__devinit
id|tg3_read_partno
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_int
r_char
id|vpd_data
(braket
l_int|256
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|tg3_nvram_read
c_func
(paren
id|tp
comma
l_int|0x100
op_plus
id|i
comma
op_amp
id|tmp
)paren
)paren
r_goto
id|out_not_found
suffix:semicolon
id|vpd_data
(braket
id|i
op_plus
l_int|0
)braket
op_assign
(paren
(paren
id|tmp
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vpd_data
(braket
id|i
op_plus
l_int|1
)braket
op_assign
(paren
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vpd_data
(braket
id|i
op_plus
l_int|2
)braket
op_assign
(paren
(paren
id|tmp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|vpd_data
(braket
id|i
op_plus
l_int|3
)braket
op_assign
(paren
(paren
id|tmp
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
multiline_comment|/* Now parse and find the part number. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
)paren
(brace
r_int
r_char
id|val
op_assign
id|vpd_data
(braket
id|i
)braket
suffix:semicolon
r_int
id|block_end
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|0x82
op_logical_or
id|val
op_eq
l_int|0x91
)paren
(brace
id|i
op_assign
(paren
id|i
op_plus
l_int|3
op_plus
(paren
id|vpd_data
(braket
id|i
op_plus
l_int|1
)braket
op_plus
(paren
id|vpd_data
(braket
id|i
op_plus
l_int|2
)braket
op_lshift
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_ne
l_int|0x90
)paren
r_goto
id|out_not_found
suffix:semicolon
id|block_end
op_assign
(paren
id|i
op_plus
l_int|3
op_plus
(paren
id|vpd_data
(braket
id|i
op_plus
l_int|1
)braket
op_plus
(paren
id|vpd_data
(braket
id|i
op_plus
l_int|2
)braket
op_lshift
l_int|8
)paren
)paren
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|block_end
)paren
(brace
r_if
c_cond
(paren
id|vpd_data
(braket
id|i
op_plus
l_int|0
)braket
op_eq
l_char|&squot;P&squot;
op_logical_and
id|vpd_data
(braket
id|i
op_plus
l_int|1
)braket
op_eq
l_char|&squot;N&squot;
)paren
(brace
r_int
id|partno_len
op_assign
id|vpd_data
(braket
id|i
op_plus
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|partno_len
OG
l_int|24
)paren
r_goto
id|out_not_found
suffix:semicolon
id|memcpy
c_func
(paren
id|tp-&gt;board_part_number
comma
op_amp
id|vpd_data
(braket
id|i
op_plus
l_int|3
)braket
comma
id|partno_len
)paren
suffix:semicolon
multiline_comment|/* Success. */
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* Part number not found. */
r_goto
id|out_not_found
suffix:semicolon
)brace
id|out_not_found
suffix:colon
id|strcpy
c_func
(paren
id|tp-&gt;board_part_number
comma
l_string|&quot;none&quot;
)paren
suffix:semicolon
)brace
DECL|function|tg3_get_invariants
r_static
r_int
id|__devinit
id|tg3_get_invariants
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|u32
id|misc_ctrl_reg
suffix:semicolon
id|u32
id|cacheline_sz_reg
suffix:semicolon
id|u32
id|pci_state_reg
comma
id|grc_misc_cfg
suffix:semicolon
id|u16
id|pci_cmd
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Force memory write invalidate off.  If we leave it on,&n;&t; * then on 5700_BX chips we have to enable a workaround.&n;&t; * The workaround is to set the TG3PCI_DMA_RW_CTRL boundry&n;&t; * to match the cacheline size.  The Broadcom driver have this&n;&t; * workaround but turns MWI off all the times so never uses&n;&t; * it.  This seems to suggest that the workaround is insufficient.&n;&t; */
id|pci_read_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_cmd
)paren
suffix:semicolon
id|pci_cmd
op_and_assign
op_complement
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_COMMAND
comma
id|pci_cmd
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MISC_HOST_CTRL
comma
op_amp
id|misc_ctrl_reg
)paren
suffix:semicolon
id|tp-&gt;pci_chip_rev_id
op_assign
(paren
id|misc_ctrl_reg
op_rshift
id|MISC_HOST_CTRL_CHIPREV_SHIFT
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_CACHELINESZ
comma
op_amp
id|cacheline_sz_reg
)paren
suffix:semicolon
id|tp-&gt;pci_cacheline_sz
op_assign
(paren
id|cacheline_sz_reg
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tp-&gt;pci_lat_timer
op_assign
(paren
id|cacheline_sz_reg
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tp-&gt;pci_hdr_type
op_assign
(paren
id|cacheline_sz_reg
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tp-&gt;pci_bist
op_assign
(paren
id|cacheline_sz_reg
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5703
op_logical_and
id|tp-&gt;pci_lat_timer
OL
l_int|64
)paren
(brace
id|tp-&gt;pci_lat_timer
op_assign
l_int|64
suffix:semicolon
id|cacheline_sz_reg
op_assign
(paren
(paren
id|tp-&gt;pci_cacheline_sz
op_amp
l_int|0xff
)paren
op_lshift
l_int|0
)paren
suffix:semicolon
id|cacheline_sz_reg
op_or_assign
(paren
(paren
id|tp-&gt;pci_lat_timer
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|cacheline_sz_reg
op_or_assign
(paren
(paren
id|tp-&gt;pci_hdr_type
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|cacheline_sz_reg
op_or_assign
(paren
(paren
id|tp-&gt;pci_bist
op_amp
l_int|0xff
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_CACHELINESZ
comma
id|cacheline_sz_reg
)paren
suffix:semicolon
)brace
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PCISTATE
comma
op_amp
id|pci_state_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_state_reg
op_amp
id|PCISTATE_CONV_PCI_MODE
)paren
op_eq
l_int|0
)paren
(brace
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PCIX_MODE
suffix:semicolon
multiline_comment|/* If this is a 5700 BX chipset, and we are in PCI-X&n;&t;&t; * mode, enable register write workaround.&n;&t;&t; *&n;&t;&t; * The workaround is to use indirect register accesses&n;&t;&t; * for all chip writes not to mailbox registers.&n;&t;&t; */
r_if
c_cond
(paren
id|GET_CHIP_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|CHIPREV_5700_BX
)paren
(brace
id|u32
id|pm_reg
suffix:semicolon
id|u16
id|pci_cmd
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PCIX_TARGET_HWBUG
suffix:semicolon
multiline_comment|/* The chip can have it&squot;s power management PCI config&n;&t;&t;&t; * space registers clobbered due to this bug.&n;&t;&t;&t; * So explicitly force the chip into D0 here.&n;&t;&t;&t; */
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PM_CTRL_STAT
comma
op_amp
id|pm_reg
)paren
suffix:semicolon
id|pm_reg
op_and_assign
op_complement
id|PCI_PM_CTRL_STATE_MASK
suffix:semicolon
id|pm_reg
op_or_assign
id|PCI_PM_CTRL_PME_ENABLE
op_or
l_int|0
multiline_comment|/* D0 */
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PM_CTRL_STAT
comma
id|pm_reg
)paren
suffix:semicolon
multiline_comment|/* Also, force SERR#/PERR# in PCI command. */
id|pci_read_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_cmd
)paren
suffix:semicolon
id|pci_cmd
op_or_assign
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_COMMAND
comma
id|pci_cmd
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|pci_state_reg
op_amp
id|PCISTATE_BUS_SPEED_HIGH
)paren
op_ne
l_int|0
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PCI_HIGH_SPEED
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_state_reg
op_amp
id|PCISTATE_BUS_32BIT
)paren
op_ne
l_int|0
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PCI_32BIT
suffix:semicolon
multiline_comment|/* Force the chip into D0. */
id|err
op_assign
id|tg3_set_power_state
c_func
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* 5700 B0 chips do not support checksumming correctly due&n;&t; * to hardware bugs.&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5700_B0
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_BROKEN_CHECKSUMS
suffix:semicolon
multiline_comment|/* Regardless of whether checksums work or not, we configure&n;&t; * the StrongARM chips to not compute the pseudo header checksums&n;&t; * in either direction.  Because of the way Linux checksum support&n;&t; * works we do not need the chips to do this, and taking the load&n;&t; * off of the TX/RX onboard StrongARM cpus means that they will not be&n;&t; * the bottleneck.  Whoever wrote Broadcom&squot;s driver did not&n;&t; * understand the situation at all.  He could have bothered&n;&t; * to read Jes&squot;s Acenic driver because the logic (and this part of&n;&t; * the Tigon2 hardware/firmware) is pretty much identical.&n;&t; */
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_NO_TX_PSEUDO_CSUM
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_NO_RX_PSEUDO_CSUM
suffix:semicolon
multiline_comment|/* Derive initial jumbo mode from MTU assigned in&n;&t; * ether_setup() via the alloc_etherdev() call&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;dev-&gt;mtu
OG
id|ETH_DATA_LEN
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_JUMBO_ENABLE
suffix:semicolon
multiline_comment|/* Determine WakeOnLan speed to use. */
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B0
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5701_B2
)paren
(brace
id|tp-&gt;tg3_flags
op_and_assign
op_complement
(paren
id|TG3_FLAG_WOL_SPEED_100MB
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_WOL_SPEED_100MB
suffix:semicolon
)brace
multiline_comment|/* Only 5701 and later support tagged irq status mode. */
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|ASIC_REV_5700
)paren
(brace
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_TAGGED_IRQ_STATUS
suffix:semicolon
id|tp-&gt;misc_host_ctrl
op_or_assign
id|MISC_HOST_CTRL_TAGGED_STATUS
suffix:semicolon
multiline_comment|/* ??? Due to a glitch Broadcom&squot;s driver ALWAYS sets&n;&t;&t; * ??? these bits in coalesce_mode.  Because MM_GetConfig&n;&t;&t; * ??? always sets pDevice-&gt;UseTaggedStatus correctly&n;&t;&t; * ??? the following test at tigon3.c:LM_GetAdapterInfo()&n;&t;&t; * ???&n;&t;&t; * ???   pDevice-&gt;UseTaggedStatus &amp;&amp;&n;&t;&t; * ???   (pDevice-&gt;ChipRevId == T3_CHIP_ID_5700_C0 ||&n;&t;&t; * ???    T3_CHIP_REV(pDevice-&gt;ChipRevId) == T3_CHIP_REV_5700_AX ||&n;&t;&t; * ???    T3_CHIP_REV(pDevice-&gt;ChipRevId) == T3_CHIP_REV_5700_BX)&n;&t;&t; * ???&n;&t;&t; * ??? will never pass and thus pDevice-&gt;CoalesceMode will never&n;&t;&t; * ??? get set to zero.  For now I&squot;ll mirror what I believe is&n;&t;&t; * ??? the intention of their driver.&n;&t;&t; * ???&n;&t;&t; * ??? Update: This is fixed in Broadcom&squot;s 2.2.3 and later&n;&t;&t; * ???         drivers.  All the current 2.0.x drivers still&n;&t;&t; * ???         have the bug.&n;&t;&t; */
id|tp-&gt;coalesce_mode
op_assign
(paren
id|HOSTCC_MODE_CLRTICK_RXBD
op_or
id|HOSTCC_MODE_CLRTICK_TXBD
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;coalesce_mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* If not using tagged status, set the *_during_int&n;&t;&t; * coalesce default config values to zero.&n;&t;&t; */
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int_def
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int_def
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int_def
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int_def
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|GET_CHIP_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|CHIPREV_5700_AX
op_logical_and
id|GET_CHIP_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|CHIPREV_5700_BX
)paren
id|tp-&gt;coalesce_mode
op_or_assign
id|HOSTCC_MODE_32BYTE
suffix:semicolon
multiline_comment|/* Initialize misc host control in PCI block. */
id|tp-&gt;misc_host_ctrl
op_or_assign
(paren
id|misc_ctrl_reg
op_amp
id|MISC_HOST_CTRL_CHIPREV
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MISC_HOST_CTRL
comma
id|tp-&gt;misc_host_ctrl
)paren
suffix:semicolon
multiline_comment|/* Initialize MAC MI mode, polling disabled. */
id|tw32
c_func
(paren
id|MAC_MI_MODE
comma
id|tp-&gt;mi_mode
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|40
)paren
suffix:semicolon
multiline_comment|/* Initialize data/descriptor byte/word swapping. */
id|tw32
c_func
(paren
id|GRC_MODE
comma
id|tp-&gt;grc_mode
)paren
suffix:semicolon
multiline_comment|/* Clear these out for sanity. */
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
l_int|0
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_PCISTATE
comma
op_amp
id|pci_state_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_state_reg
op_amp
id|PCISTATE_CONV_PCI_MODE
)paren
op_eq
l_int|0
op_logical_and
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_TARGET_HWBUG
)paren
op_eq
l_int|0
)paren
(brace
id|u32
id|chiprevid
op_assign
id|GET_CHIP_REV_ID
c_func
(paren
id|tp-&gt;misc_host_ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chiprevid
op_eq
id|CHIPREV_ID_5701_A0
op_logical_or
id|chiprevid
op_eq
id|CHIPREV_ID_5701_B0
op_logical_or
id|chiprevid
op_eq
id|CHIPREV_ID_5701_B2
op_logical_or
id|chiprevid
op_eq
id|CHIPREV_ID_5701_B5
)paren
(brace
r_int
r_int
id|sram_base
suffix:semicolon
multiline_comment|/* Write some dummy words into the SRAM status block&n;&t;&t;&t; * area, see if it reads back correctly.  If the return&n;&t;&t;&t; * value is bad, force enable the PCIX workaround.&n;&t;&t;&t; */
id|sram_base
op_assign
id|tp-&gt;regs
op_plus
id|NIC_SRAM_WIN_BASE
op_plus
id|NIC_SRAM_STATS_BLK
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|sram_base
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000000
comma
id|sram_base
op_plus
l_int|4
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xffffffff
comma
id|sram_base
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|readl
c_func
(paren
id|sram_base
)paren
op_ne
l_int|0x00000000
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_PCIX_TARGET_HWBUG
suffix:semicolon
)brace
)brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|tg3_nvram_init
c_func
(paren
id|tp
)paren
suffix:semicolon
multiline_comment|/* Determine if TX descriptors will reside in&n;&t; * main memory or in the chip SRAM.&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_TARGET_HWBUG
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_HOST_TXDS
suffix:semicolon
multiline_comment|/* Quick sanity check.  Make sure we see an expected&n;&t; * value here.&n;&t; */
id|grc_misc_cfg
op_assign
id|tr32
c_func
(paren
id|GRC_MISC_CFG
)paren
suffix:semicolon
id|grc_misc_cfg
op_and_assign
id|GRC_MISC_CFG_BOARD_ID_MASK
suffix:semicolon
r_if
c_cond
(paren
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_5700
op_logical_and
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_5701
op_logical_and
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_5702FE
op_logical_and
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_5703
op_logical_and
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_5703S
op_logical_and
id|grc_misc_cfg
op_ne
id|GRC_MISC_CFG_BOARD_ID_AC91002A1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* ROFL, you should see Broadcom&squot;s driver code implementing&n;&t; * this, stuff like &quot;if (a || b)&quot; where a and b are always&n;&t; * mutually exclusive.  DaveM finds like 6 bugs today, hello!&n;&t; */
r_if
c_cond
(paren
id|grc_misc_cfg
op_eq
id|GRC_MISC_CFG_BOARD_ID_5702FE
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_10_100_ONLY
suffix:semicolon
id|err
op_assign
id|tg3_phy_probe
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_read_partno
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
)paren
(brace
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_USE_MI_INTERRUPT
suffix:semicolon
multiline_comment|/* And override led_mode in case Dell ever makes&n;&t;&t; * a fibre board.&n;&t;&t; */
id|tp-&gt;led_mode
op_assign
id|led_mode_three_link
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_USE_MI_INTERRUPT
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_USE_MI_INTERRUPT
suffix:semicolon
)brace
multiline_comment|/* 5700 {AX,BX} chips have a broken status block link&n;&t; * change bit implementation, so we must use the&n;&t; * status register in those cases.&n;&t; */
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_USE_LINKCHG_REG
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_USE_LINKCHG_REG
suffix:semicolon
multiline_comment|/* The led_mode is set during tg3_phy_probe, here we might&n;&t; * have to force the link status polling mechanism based&n;&t; * upon subsystem IDs.&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;pdev-&gt;subsystem_vendor
op_eq
id|PCI_VENDOR_ID_DELL
op_logical_and
id|tp-&gt;phy_id
op_ne
id|PHY_ID_SERDES
)paren
(brace
id|tp-&gt;tg3_flags
op_or_assign
(paren
id|TG3_FLAG_USE_MI_INTERRUPT
op_or
id|TG3_FLAG_USE_LINKCHG_REG
)paren
suffix:semicolon
)brace
multiline_comment|/* For all SERDES we poll the MAC status register. */
r_if
c_cond
(paren
id|tp-&gt;phy_id
op_eq
id|PHY_ID_SERDES
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_POLL_SERDES
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_POLL_SERDES
suffix:semicolon
multiline_comment|/* 5700 BX chips need to have their TX producer index mailboxes&n;&t; * written twice to workaround a bug.&n;&t; */
r_if
c_cond
(paren
id|GET_CHIP_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|CHIPREV_5700_BX
)paren
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_TXD_MBOX_HWBUG
suffix:semicolon
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_TXD_MBOX_HWBUG
suffix:semicolon
multiline_comment|/* 5700 chips can get confused if TX buffers straddle the&n;&t; * 4GB address boundary in some cases.&n;&t; */
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5700
)paren
(brace
multiline_comment|/* ROFL!  Latest Broadcom driver disables NETIF_F_HIGHDMA&n;&t;&t; * in this case instead of fixing their workaround code.&n;&t;&t; *&n;&t;&t; * Like, hey, there is this skb_copy() thing guys,&n;&t;&t; * use it.  Oh I can&squot;t stop laughing...&n;&t;&t; */
id|tp-&gt;dev-&gt;hard_start_xmit
op_assign
id|tg3_start_xmit_4gbug
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;dev-&gt;hard_start_xmit
op_assign
id|tg3_start_xmit
suffix:semicolon
)brace
id|tp-&gt;rx_offset
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_eq
id|ASIC_REV_5701
op_logical_and
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
op_ne
l_int|0
)paren
id|tp-&gt;rx_offset
op_assign
l_int|0
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_get_device_address
r_static
r_int
id|__devinit
id|tg3_get_device_address
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|tp-&gt;dev
suffix:semicolon
id|u32
id|hi
comma
id|lo
suffix:semicolon
multiline_comment|/* First try to get it from MAC address mailbox. */
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_MAC_ADDR_HIGH_MBOX
comma
op_amp
id|hi
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hi
op_rshift
l_int|16
)paren
op_eq
l_int|0x484b
)paren
(brace
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
id|hi
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
(paren
id|hi
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|tg3_read_mem
c_func
(paren
id|tp
comma
id|NIC_SRAM_MAC_ADDR_LOW_MBOX
comma
op_amp
id|lo
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
id|lo
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
id|lo
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
id|lo
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
(paren
id|lo
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/* Next, try NVRAM. */
r_else
r_if
c_cond
(paren
op_logical_neg
id|tg3_nvram_read
c_func
(paren
id|tp
comma
l_int|0x7c
comma
op_amp
id|hi
)paren
op_logical_and
op_logical_neg
id|tg3_nvram_read
c_func
(paren
id|tp
comma
l_int|0x80
comma
op_amp
id|lo
)paren
)paren
(brace
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|hi
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|hi
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|lo
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|lo
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
(paren
id|lo
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
(paren
(paren
id|lo
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
multiline_comment|/* Finally just fetch it out of the MAC control regs. */
r_else
(brace
id|hi
op_assign
id|tr32
c_func
(paren
id|MAC_ADDR_0_HIGH
)paren
suffix:semicolon
id|lo
op_assign
id|tr32
c_func
(paren
id|MAC_ADDR_0_LOW
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
id|lo
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
id|lo
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
id|lo
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
id|lo
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
id|hi
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
id|hi
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|is_valid_ether_addr
c_func
(paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tg3_do_test_dma
r_static
r_int
id|__devinit
id|tg3_do_test_dma
c_func
(paren
r_struct
id|tg3
op_star
id|tp
comma
id|u32
op_star
id|buf
comma
id|dma_addr_t
id|buf_dma
comma
r_int
id|size
comma
r_int
id|to_device
)paren
(brace
r_struct
id|tg3_internal_buffer_desc
id|test_desc
suffix:semicolon
id|u32
id|sram_dma_descs
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
id|sram_dma_descs
op_assign
id|NIC_SRAM_DMA_DESC_POOL_BASE
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RCVBD_COMP_FIFO_ENQDEQ
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RCVDATA_COMP_FIFO_ENQDEQ
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RDMAC_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|WDMAC_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|BUFMGR_MODE
comma
l_int|0
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|FTQ_RESET
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* pci_alloc_consistent gives only non-DAC addresses */
id|test_desc.addr_hi
op_assign
l_int|0
suffix:semicolon
id|test_desc.addr_lo
op_assign
id|buf_dma
op_amp
l_int|0xffffffff
suffix:semicolon
id|test_desc.nic_mbuf
op_assign
l_int|0x00002100
suffix:semicolon
id|test_desc.len
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
id|to_device
)paren
(brace
id|test_desc.cqid_sqid
op_assign
(paren
l_int|13
op_lshift
l_int|8
)paren
op_or
l_int|2
suffix:semicolon
id|tw32
c_func
(paren
id|RDMAC_MODE
comma
id|RDMAC_MODE_RESET
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|RDMAC_MODE
comma
id|RDMAC_MODE_ENABLE
)paren
suffix:semicolon
)brace
r_else
(brace
id|test_desc.cqid_sqid
op_assign
(paren
l_int|16
op_lshift
l_int|8
)paren
op_or
l_int|7
suffix:semicolon
id|tw32
c_func
(paren
id|WDMAC_MODE
comma
id|WDMAC_MODE_RESET
)paren
suffix:semicolon
id|tw32
c_func
(paren
id|WDMAC_MODE
comma
id|WDMAC_MODE_ENABLE
)paren
suffix:semicolon
)brace
id|test_desc.flags
op_assign
l_int|0x00000004
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
id|test_desc
)paren
op_div
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
suffix:semicolon
id|val
op_assign
op_star
(paren
(paren
(paren
id|u32
op_star
)paren
op_amp
id|test_desc
)paren
op_plus
id|i
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
id|sram_dma_descs
op_plus
(paren
id|i
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_DATA
comma
id|val
)paren
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|TG3PCI_MEM_WIN_BASE_ADDR
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|to_device
)paren
(brace
id|tw32
c_func
(paren
id|FTQ_DMA_HIGH_READ_FIFO_ENQDEQ
comma
id|sram_dma_descs
)paren
suffix:semicolon
)brace
r_else
(brace
id|tw32
c_func
(paren
id|FTQ_DMA_HIGH_WRITE_FIFO_ENQDEQ
comma
id|sram_dma_descs
)paren
suffix:semicolon
)brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|40
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|val
suffix:semicolon
r_if
c_cond
(paren
id|to_device
)paren
id|val
op_assign
id|tr32
c_func
(paren
id|FTQ_RCVBD_COMP_FIFO_ENQDEQ
)paren
suffix:semicolon
r_else
id|val
op_assign
id|tr32
c_func
(paren
id|FTQ_RCVDATA_COMP_FIFO_ENQDEQ
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0xffff
)paren
op_eq
id|sram_dma_descs
)paren
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|macro|TEST_BUFFER_SIZE
mdefine_line|#define TEST_BUFFER_SIZE&t;0x400
DECL|function|tg3_test_dma
r_static
r_int
id|__devinit
id|tg3_test_dma
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|dma_addr_t
id|buf_dma
suffix:semicolon
id|u32
op_star
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|buf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TEST_BUFFER_SIZE
comma
op_amp
id|buf_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_nofree
suffix:semicolon
)brace
id|tw32
c_func
(paren
id|TG3PCI_CLOCK_CTRL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
op_eq
l_int|0
)paren
(brace
id|tp-&gt;dma_rwctrl
op_assign
(paren
l_int|0x7
op_lshift
id|DMA_RWCTRL_PCI_WRITE_CMD_SHIFT
)paren
op_or
(paren
l_int|0x6
op_lshift
id|DMA_RWCTRL_PCI_READ_CMD_SHIFT
)paren
op_or
(paren
l_int|0x7
op_lshift
id|DMA_RWCTRL_WRITE_WATER_SHIFT
)paren
op_or
(paren
l_int|0x7
op_lshift
id|DMA_RWCTRL_READ_WATER_SHIFT
)paren
op_or
(paren
l_int|0x0f
op_lshift
id|DMA_RWCTRL_MIN_DMA_SHIFT
)paren
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;dma_rwctrl
op_assign
(paren
l_int|0x7
op_lshift
id|DMA_RWCTRL_PCI_WRITE_CMD_SHIFT
)paren
op_or
(paren
l_int|0x6
op_lshift
id|DMA_RWCTRL_PCI_READ_CMD_SHIFT
)paren
op_or
(paren
l_int|0x3
op_lshift
id|DMA_RWCTRL_WRITE_WATER_SHIFT
)paren
op_or
(paren
l_int|0x3
op_lshift
id|DMA_RWCTRL_READ_WATER_SHIFT
)paren
op_or
(paren
l_int|0x0f
op_lshift
id|DMA_RWCTRL_MIN_DMA_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Wheee, some more chip bugs... */
r_if
c_cond
(paren
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5703_A1
op_logical_or
id|tp-&gt;pci_chip_rev_id
op_eq
id|CHIPREV_ID_5703_A2
)paren
id|tp-&gt;dma_rwctrl
op_or_assign
id|DMA_RWCTRL_ONE_DMA
suffix:semicolon
)brace
multiline_comment|/* We don&squot;t do this on x86 because it seems to hurt performace.&n;&t; * It does help things on other platforms though.&n;&t; */
macro_line|#ifndef CONFIG_X86
(brace
id|u8
id|byte
suffix:semicolon
r_int
id|cacheline_size
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|byte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|byte
op_eq
l_int|0
)paren
id|cacheline_size
op_assign
l_int|1024
suffix:semicolon
r_else
id|cacheline_size
op_assign
(paren
r_int
)paren
id|byte
op_star
l_int|4
suffix:semicolon
id|tp-&gt;dma_rwctrl
op_and_assign
op_complement
(paren
id|DMA_RWCTRL_READ_BNDRY_MASK
op_or
id|DMA_RWCTRL_WRITE_BNDRY_MASK
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cacheline_size
)paren
(brace
r_case
l_int|16
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_16
op_or
id|DMA_RWCTRL_WRITE_BNDRY_16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_32
op_or
id|DMA_RWCTRL_WRITE_BNDRY_32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|64
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_64
op_or
id|DMA_RWCTRL_WRITE_BNDRY_64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|128
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_128
op_or
id|DMA_RWCTRL_WRITE_BNDRY_128
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|256
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_256
op_or
id|DMA_RWCTRL_WRITE_BNDRY_256
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|512
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_512
op_or
id|DMA_RWCTRL_WRITE_BNDRY_512
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1024
suffix:colon
id|tp-&gt;dma_rwctrl
op_or_assign
(paren
id|DMA_RWCTRL_READ_BNDRY_1024
op_or
id|DMA_RWCTRL_WRITE_BNDRY_1024
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Remove this if it causes problems for some boards. */
id|tp-&gt;dma_rwctrl
op_or_assign
id|DMA_RWCTRL_USE_MEM_READ_MULT
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_DMA_RW_CTRL
comma
id|tp-&gt;dma_rwctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|ASIC_REV_5700
op_logical_and
id|GET_ASIC_REV
c_func
(paren
id|tp-&gt;pci_chip_rev_id
)paren
op_ne
id|ASIC_REV_5701
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|u32
op_star
id|p
comma
id|i
suffix:semicolon
id|p
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TEST_BUFFER_SIZE
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|i
op_increment
)paren
id|p
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
multiline_comment|/* Send the buffer to the chip. */
id|ret
op_assign
id|tg3_do_test_dma
c_func
(paren
id|tp
comma
id|buf
comma
id|buf_dma
comma
id|TEST_BUFFER_SIZE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
id|p
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TEST_BUFFER_SIZE
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|i
op_increment
)paren
id|p
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now read it back. */
id|ret
op_assign
id|tg3_do_test_dma
c_func
(paren
id|tp
comma
id|buf
comma
id|buf_dma
comma
id|TEST_BUFFER_SIZE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_break
suffix:semicolon
multiline_comment|/* Verify it. */
id|p
op_assign
id|buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TEST_BUFFER_SIZE
op_div
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p
(braket
id|i
)braket
op_eq
id|i
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;dma_rwctrl
op_amp
id|DMA_RWCTRL_WRITE_BNDRY_MASK
)paren
op_eq
id|DMA_RWCTRL_WRITE_BNDRY_DISAB
)paren
(brace
id|tp-&gt;dma_rwctrl
op_or_assign
id|DMA_RWCTRL_WRITE_BNDRY_16
suffix:semicolon
id|tw32
c_func
(paren
id|TG3PCI_DMA_RW_CTRL
comma
id|tp-&gt;dma_rwctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
(paren
id|TEST_BUFFER_SIZE
op_div
r_sizeof
(paren
id|u32
)paren
)paren
)paren
(brace
multiline_comment|/* Success. */
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|pci_free_consistent
c_func
(paren
id|tp-&gt;pdev
comma
id|TEST_BUFFER_SIZE
comma
id|buf
comma
id|buf_dma
)paren
suffix:semicolon
id|out_nofree
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|tg3_init_link_config
r_static
r_void
id|__devinit
id|tg3_init_link_config
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tp-&gt;link_config.advertising
op_assign
(paren
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_100baseT_Half
op_or
id|ADVERTISED_100baseT_Full
op_or
id|ADVERTISED_1000baseT_Half
op_or
id|ADVERTISED_1000baseT_Full
op_or
id|ADVERTISED_Autoneg
op_or
id|ADVERTISED_MII
)paren
suffix:semicolon
id|tp-&gt;link_config.speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
id|tp-&gt;link_config.autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|tp-&gt;dev
)paren
suffix:semicolon
id|tp-&gt;link_config.active_speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.active_duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
id|tp-&gt;link_config.phy_is_low_power
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;link_config.orig_speed
op_assign
id|SPEED_INVALID
suffix:semicolon
id|tp-&gt;link_config.orig_duplex
op_assign
id|DUPLEX_INVALID
suffix:semicolon
id|tp-&gt;link_config.orig_autoneg
op_assign
id|AUTONEG_INVALID
suffix:semicolon
)brace
DECL|function|tg3_init_coalesce_config
r_static
r_void
id|__devinit
id|tg3_init_coalesce_config
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
op_assign
id|DEFAULT_RXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
op_assign
id|DEFAULT_RXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_during_int_def
op_assign
id|DEFAULT_RXCOAL_TICK_INT
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_during_int_def
op_assign
id|DEFAULT_RXCOAL_MAXF_INT
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
op_assign
id|DEFAULT_TXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
op_assign
id|DEFAULT_TXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_during_int_def
op_assign
id|DEFAULT_TXCOAL_TICK_INT
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_during_int_def
op_assign
id|DEFAULT_TXCOAL_MAXF_INT
suffix:semicolon
id|tp-&gt;coalesce_config.stats_coalesce_ticks_def
op_assign
id|DEFAULT_STAT_COAL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_low
op_assign
id|LOW_RXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_low
op_assign
id|LOW_RXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_low
op_assign
id|LOW_TXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_low
op_assign
id|LOW_TXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.rx_coalesce_ticks_high
op_assign
id|HIGH_RXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_high
op_assign
id|HIGH_RXMAX_FRAMES
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks_high
op_assign
id|HIGH_TXCOL_TICKS
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_high
op_assign
id|HIGH_TXMAX_FRAMES
suffix:semicolon
multiline_comment|/* Active == default */
id|tp-&gt;coalesce_config.rx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.rx_coalesce_ticks_def
suffix:semicolon
id|tp-&gt;coalesce_config.rx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.rx_max_coalesced_frames_def
suffix:semicolon
id|tp-&gt;coalesce_config.tx_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.tx_coalesce_ticks_def
suffix:semicolon
id|tp-&gt;coalesce_config.tx_max_coalesced_frames
op_assign
id|tp-&gt;coalesce_config.tx_max_coalesced_frames_def
suffix:semicolon
id|tp-&gt;coalesce_config.stats_coalesce_ticks
op_assign
id|tp-&gt;coalesce_config.stats_coalesce_ticks_def
suffix:semicolon
id|tp-&gt;coalesce_config.rate_sample_jiffies
op_assign
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|tp-&gt;coalesce_config.pkt_rate_low
op_assign
l_int|22000
suffix:semicolon
id|tp-&gt;coalesce_config.pkt_rate_high
op_assign
l_int|61000
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_ADAPTIVE_RX
suffix:semicolon
id|tp-&gt;tg3_flags
op_and_assign
op_complement
(paren
id|TG3_FLAG_ADAPTIVE_TX
)paren
suffix:semicolon
)brace
DECL|function|tg3_init_bufmgr_config
r_static
r_void
id|__devinit
id|tg3_init_bufmgr_config
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
id|tp-&gt;bufmgr_config.mbuf_read_dma_low_water
op_assign
id|DEFAULT_MB_RDMA_LOW_WATER
suffix:semicolon
id|tp-&gt;bufmgr_config.mbuf_mac_rx_low_water
op_assign
id|DEFAULT_MB_MACRX_LOW_WATER
suffix:semicolon
id|tp-&gt;bufmgr_config.mbuf_high_water
op_assign
id|DEFAULT_MB_HIGH_WATER
suffix:semicolon
id|tp-&gt;bufmgr_config.mbuf_read_dma_low_water_jumbo
op_assign
id|DEFAULT_MB_RDMA_LOW_WATER_JUMBO
suffix:semicolon
id|tp-&gt;bufmgr_config.mbuf_mac_rx_low_water_jumbo
op_assign
id|DEFAULT_MB_MACRX_LOW_WATER_JUMBO
suffix:semicolon
id|tp-&gt;bufmgr_config.mbuf_high_water_jumbo
op_assign
id|DEFAULT_MB_HIGH_WATER_JUMBO
suffix:semicolon
id|tp-&gt;bufmgr_config.dma_low_water
op_assign
id|DEFAULT_DMA_LOW_WATER
suffix:semicolon
id|tp-&gt;bufmgr_config.dma_high_water
op_assign
id|DEFAULT_DMA_HIGH_WATER
suffix:semicolon
)brace
DECL|function|tg3_phy_string
r_static
r_char
op_star
id|__devinit
id|tg3_phy_string
c_func
(paren
r_struct
id|tg3
op_star
id|tp
)paren
(brace
r_switch
c_cond
(paren
id|tp-&gt;phy_id
op_amp
id|PHY_ID_MASK
)paren
(brace
r_case
id|PHY_ID_BCM5400
suffix:colon
r_return
l_string|&quot;5400&quot;
suffix:semicolon
r_case
id|PHY_ID_BCM5401
suffix:colon
r_return
l_string|&quot;5401&quot;
suffix:semicolon
r_case
id|PHY_ID_BCM5411
suffix:colon
r_return
l_string|&quot;5411&quot;
suffix:semicolon
r_case
id|PHY_ID_BCM5701
suffix:colon
r_return
l_string|&quot;5701&quot;
suffix:semicolon
r_case
id|PHY_ID_BCM5703
suffix:colon
r_return
l_string|&quot;5703&quot;
suffix:semicolon
r_case
id|PHY_ID_BCM8002
suffix:colon
r_return
l_string|&quot;8002&quot;
suffix:semicolon
r_case
id|PHY_ID_SERDES
suffix:colon
r_return
l_string|&quot;serdes&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;unknown&quot;
suffix:semicolon
)brace
suffix:semicolon
)brace
DECL|function|tg3_init_one
r_static
r_int
id|__devinit
id|tg3_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|tg3_version_printed
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tg3reg_base
comma
id|tg3reg_len
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
suffix:semicolon
r_int
id|i
comma
id|err
comma
id|pci_using_dac
comma
id|pm_cap
suffix:semicolon
r_if
c_cond
(paren
id|tg3_version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot enable PCI device, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot find proper PCI device &quot;
l_string|&quot;base address, aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_disable_pdev
suffix:semicolon
)brace
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_MODULE_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot obtain PCI resources, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_disable_pdev
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* Find power-management capability. */
id|pm_cap
op_assign
id|pci_find_capability
c_func
(paren
id|pdev
comma
id|PCI_CAP_ID_PM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm_cap
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot find PowerManagement capability, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
multiline_comment|/* Configure DMA attributes. */
r_if
c_cond
(paren
op_logical_neg
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
(paren
id|u64
)paren
l_int|0xffffffffffffffff
)paren
)paren
(brace
id|pci_using_dac
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
(paren
id|u64
)paren
l_int|0xffffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;No usable DMA configuration, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|pci_using_dac
op_assign
l_int|0
suffix:semicolon
)brace
id|tg3reg_base
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|tg3reg_len
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Etherdev alloc failed, aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_using_dac
)paren
id|dev-&gt;features
op_or_assign
id|NETIF_F_HIGHDMA
suffix:semicolon
macro_line|#if TG3_VLAN_TAG_USED
id|dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
id|dev-&gt;vlan_rx_register
op_assign
id|tg3_vlan_rx_register
suffix:semicolon
id|dev-&gt;vlan_rx_kill_vid
op_assign
id|tg3_vlan_rx_kill_vid
suffix:semicolon
macro_line|#endif
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;dev
op_assign
id|dev
suffix:semicolon
id|tp-&gt;pm_cap
op_assign
id|pm_cap
suffix:semicolon
id|tp-&gt;mac_mode
op_assign
id|TG3_DEF_MAC_MODE
suffix:semicolon
id|tp-&gt;rx_mode
op_assign
id|TG3_DEF_RX_MODE
suffix:semicolon
id|tp-&gt;tx_mode
op_assign
id|TG3_DEF_TX_MODE
suffix:semicolon
id|tp-&gt;mi_mode
op_assign
id|MAC_MI_MODE_BASE
suffix:semicolon
r_if
c_cond
(paren
id|tg3_debug
OG
l_int|0
)paren
id|tp-&gt;msg_enable
op_assign
id|tg3_debug
suffix:semicolon
r_else
id|tp-&gt;msg_enable
op_assign
id|TG3_DEF_MSG_ENABLE
suffix:semicolon
multiline_comment|/* The word/byte swap controls here control register access byte&n;&t; * swapping.  DMA data byte swapping is controlled in the GRC_MODE&n;&t; * setting below.&n;&t; */
id|tp-&gt;misc_host_ctrl
op_assign
id|MISC_HOST_CTRL_MASK_PCI_INT
op_or
id|MISC_HOST_CTRL_WORD_SWAP
op_or
id|MISC_HOST_CTRL_INDIR_ACCESS
op_or
id|MISC_HOST_CTRL_PCISTATE_RW
suffix:semicolon
multiline_comment|/* The NONFRM (non-frame) byte/word swap controls take effect&n;&t; * on descriptor entries, anything which isn&squot;t packet data.&n;&t; *&n;&t; * The StrongARM chips on the board (one for tx, one for rx)&n;&t; * are running in big-endian mode.&n;&t; */
id|tp-&gt;grc_mode
op_assign
(paren
id|GRC_MODE_WSWAP_DATA
op_or
id|GRC_MODE_BSWAP_DATA
op_or
id|GRC_MODE_WSWAP_NONFRM_DATA
)paren
suffix:semicolon
macro_line|#ifdef __BIG_ENDIAN
id|tp-&gt;grc_mode
op_or_assign
id|GRC_MODE_BSWAP_NONFRM_DATA
suffix:semicolon
macro_line|#endif
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;indirect_lock
)paren
suffix:semicolon
id|tp-&gt;regs
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|tg3reg_base
comma
id|tg3reg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;regs
op_eq
l_int|0UL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot map device registers, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_dev
suffix:semicolon
)brace
id|tg3_init_link_config
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_coalesce_config
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_bufmgr_config
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tp-&gt;rx_pending
op_assign
id|TG3_DEF_RX_RING_PENDING
suffix:semicolon
macro_line|#if TG3_MINI_RING_WORKS
id|tp-&gt;rx_mini_pending
op_assign
id|TG3_DEF_RX_MINI_RING_PENDING
suffix:semicolon
macro_line|#endif
id|tp-&gt;rx_jumbo_pending
op_assign
id|TG3_DEF_RX_JUMBO_RING_PENDING
suffix:semicolon
id|tp-&gt;tx_pending
op_assign
id|TG3_DEF_TX_RING_PENDING
suffix:semicolon
id|dev-&gt;open
op_assign
id|tg3_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|tg3_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|tg3_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|tg3_set_rx_mode
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|tg3_set_mac_addr
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|tg3_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tg3_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TG3_TX_TIMEOUT
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|tg3_change_mtu
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|err
op_assign
id|tg3_get_invariants
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Problem fetching invariants of chip, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
id|err
op_assign
id|tg3_get_device_address
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Could not obtain valid ethernet address, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
id|err
op_assign
id|tg3_test_dma
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;DMA engine test failed, aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
multiline_comment|/* Tigon3 can do ipv4 only... and some chips have buggy&n;&t; * checksumming.&n;&t; */
r_if
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_BROKEN_CHECKSUMS
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;features
op_or_assign
id|NETIF_F_SG
op_or
id|NETIF_F_IP_CSUM
suffix:semicolon
id|tp-&gt;tg3_flags
op_or_assign
id|TG3_FLAG_RX_CHECKSUMS
suffix:semicolon
)brace
r_else
id|tp-&gt;tg3_flags
op_and_assign
op_complement
id|TG3_FLAG_RX_CHECKSUMS
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot register net device, &quot;
l_string|&quot;aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_iounmap
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Now that we have fully setup the chip, save away a snapshot&n;&t; * of the PCI config space.  We need to restore this after&n;&t; * GRC_MISC_CFG core clock resets and some resume events.&n;&t; */
id|pci_save_state
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;pci_cfg_state
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Tigon3 [partno(%s) rev %04x PHY(%s)] (PCI%s:%s:%s) %sBaseT Ethernet &quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;board_part_number
comma
id|tp-&gt;pci_chip_rev_id
comma
id|tg3_phy_string
c_func
(paren
id|tp
)paren
comma
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
ques
c_cond
l_string|&quot;X&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCI_HIGH_SPEED
)paren
ques
c_cond
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
ques
c_cond
l_string|&quot;133MHz&quot;
suffix:colon
l_string|&quot;66MHz&quot;
)paren
suffix:colon
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCIX_MODE
)paren
ques
c_cond
l_string|&quot;100MHz&quot;
suffix:colon
l_string|&quot;33MHz&quot;
)paren
)paren
comma
(paren
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_PCI_32BIT
)paren
ques
c_cond
l_string|&quot;32-bit&quot;
suffix:colon
l_string|&quot;64-bit&quot;
)paren
comma
(paren
id|tp-&gt;tg3_flags
op_amp
id|TG3_FLAG_10_100_ONLY
)paren
ques
c_cond
l_string|&quot;10/100&quot;
suffix:colon
l_string|&quot;10/100/1000&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x%c&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|i
op_eq
l_int|5
ques
c_cond
l_char|&squot;&bslash;n&squot;
suffix:colon
l_char|&squot;:&squot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_iounmap
suffix:colon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|tp-&gt;regs
)paren
suffix:semicolon
id|err_out_free_dev
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out_free_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable_pdev
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_remove_one
r_static
r_void
id|__devexit
id|tg3_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
(paren
r_struct
id|tg3
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|regs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
DECL|function|tg3_suspend
r_static
r_int
id|tg3_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_disable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_halt
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|tg3_set_power_state
c_func
(paren
id|tp
comma
id|state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|tg3_resume
r_static
r_int
id|tg3_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|tg3
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|err
op_assign
id|tg3_set_power_state
c_func
(paren
id|tp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|tg3_init_rings
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_init_hw
c_func
(paren
id|tp
)paren
suffix:semicolon
id|tg3_enable_ints
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|tg3_driver
r_static
r_struct
id|pci_driver
id|tg3_driver
op_assign
(brace
id|name
suffix:colon
id|DRV_MODULE_NAME
comma
id|id_table
suffix:colon
id|tg3_pci_tbl
comma
id|probe
suffix:colon
id|tg3_init_one
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|tg3_remove_one
)paren
comma
id|suspend
suffix:colon
id|tg3_suspend
comma
id|resume
suffix:colon
id|tg3_resume
)brace
suffix:semicolon
DECL|function|tg3_init
r_static
r_int
id|__init
id|tg3_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|tg3_driver
)paren
suffix:semicolon
)brace
DECL|function|tg3_cleanup
r_static
r_void
id|__exit
id|tg3_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|tg3_driver
)paren
suffix:semicolon
)brace
DECL|variable|tg3_init
id|module_init
c_func
(paren
id|tg3_init
)paren
suffix:semicolon
DECL|variable|tg3_cleanup
id|module_exit
c_func
(paren
id|tg3_cleanup
)paren
suffix:semicolon
eof
