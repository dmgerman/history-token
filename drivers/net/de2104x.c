multiline_comment|/* de2104x.c: A Linux PCI Ethernet driver for Intel/Digital 21040/1 chips. */
multiline_comment|/*&n;&t;Copyright 2001 Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n;&n;&t;Copyright 1994, 1995 Digital Equipment Corporation.&t;    [de4x5.c]&n;&t;Written/copyright 1994-2001 by Donald Becker.&t;&t;    [tulip.c]&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;See the file COPYING in this distribution for more information.&n;&n;&t;TODO, in rough priority order:&n;&t;* Support forcing media type with a module parameter,&n;&t;  like dl2k.c/sundance.c&n;&t;* Constants (module parms?) for Rx work limit&n;&t;* Complete reset on PciErr&n;&t;* Jumbo frames / dev-&gt;change_mtu&n;&t;* Adjust Rx FIFO threshold and Max Rx DMA burst on Rx FIFO error&n;&t;* Adjust Tx FIFO threshold and Max Tx DMA burst on Tx FIFO error&n;&t;* Implement Tx software interrupt mitigation via&n;&t;  Tx descriptor bit&n;&n; */
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&t;&quot;de2104x&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&t;&quot;0.5.4&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&t;&quot;Jan 1, 2002&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|__initdata
r_static
r_char
id|version
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
id|DRV_NAME
l_string|&quot; PCI Ethernet driver v&quot;
id|DRV_VERSION
l_string|&quot; (&quot;
id|DRV_RELDATE
l_string|&quot;)&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Intel/Digital 21040/1 series PCI Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|debug
comma
l_string|&quot;de2104x bitmapped message enable number&quot;
)paren
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-buffer Rx structure. */
macro_line|#if defined(__alpha__) || defined(__arm__) || defined(__hppa__) &bslash;&n;        || defined(__sparc_) || defined(__ia64__) &bslash;&n;        || defined(__sh__) || defined(__mips__)
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|1518
suffix:semicolon
macro_line|#else
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|100
suffix:semicolon
macro_line|#endif
id|MODULE_PARM
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|rx_copybreak
comma
l_string|&quot;de2104x Breakpoint at which Rx packets are copied&quot;
)paren
suffix:semicolon
DECL|macro|PFX
mdefine_line|#define PFX&t;&t;&t;DRV_NAME &quot;: &quot;
DECL|macro|DE_DEF_MSG_ENABLE
mdefine_line|#define DE_DEF_MSG_ENABLE&t;(NETIF_MSG_DRV&t;&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_PROBE &t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_LINK&t;&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_TIMER&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_IFDOWN&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_IFUP&t;&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_RX_ERR&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_TX_ERR)
DECL|macro|DE_RX_RING_SIZE
mdefine_line|#define DE_RX_RING_SIZE&t;&t;64
DECL|macro|DE_TX_RING_SIZE
mdefine_line|#define DE_TX_RING_SIZE&t;&t;64
DECL|macro|DE_RING_BYTES
mdefine_line|#define DE_RING_BYTES&t;&t;&bslash;&n;&t;&t;((sizeof(struct de_desc) * DE_RX_RING_SIZE) +&t;&bslash;&n;&t;&t;(sizeof(struct de_desc) * DE_TX_RING_SIZE))
DECL|macro|NEXT_TX
mdefine_line|#define NEXT_TX(N)&t;&t;(((N) + 1) &amp; (DE_TX_RING_SIZE - 1))
DECL|macro|NEXT_RX
mdefine_line|#define NEXT_RX(N)&t;&t;(((N) + 1) &amp; (DE_RX_RING_SIZE - 1))
DECL|macro|TX_BUFFS_AVAIL
mdefine_line|#define TX_BUFFS_AVAIL(CP)&t;&t;&t;&t;&t;&bslash;&n;&t;(((CP)-&gt;tx_tail &lt;= (CP)-&gt;tx_head) ?&t;&t;&t;&bslash;&n;&t;  (CP)-&gt;tx_tail + (DE_TX_RING_SIZE - 1) - (CP)-&gt;tx_head :&t;&bslash;&n;&t;  (CP)-&gt;tx_tail - (CP)-&gt;tx_head - 1)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;/* Size of each temporary Rx buffer.*/
DECL|macro|RX_OFFSET
mdefine_line|#define RX_OFFSET&t;&t;2
DECL|macro|DE_SETUP_SKB
mdefine_line|#define DE_SETUP_SKB&t;&t;((struct sk_buff *) 1)
DECL|macro|DE_DUMMY_SKB
mdefine_line|#define DE_DUMMY_SKB&t;&t;((struct sk_buff *) 2)
DECL|macro|DE_SETUP_FRAME_WORDS
mdefine_line|#define DE_SETUP_FRAME_WORDS&t;96
DECL|macro|DE_EEPROM_WORDS
mdefine_line|#define DE_EEPROM_WORDS&t;&t;256
DECL|macro|DE_EEPROM_SIZE
mdefine_line|#define DE_EEPROM_SIZE&t;&t;(DE_EEPROM_WORDS * sizeof(u16))
DECL|macro|DE_MAX_MEDIA
mdefine_line|#define DE_MAX_MEDIA&t;&t;5
DECL|macro|DE_MEDIA_TP_AUTO
mdefine_line|#define DE_MEDIA_TP_AUTO&t;0
DECL|macro|DE_MEDIA_BNC
mdefine_line|#define DE_MEDIA_BNC&t;&t;1
DECL|macro|DE_MEDIA_AUI
mdefine_line|#define DE_MEDIA_AUI&t;&t;2
DECL|macro|DE_MEDIA_TP
mdefine_line|#define DE_MEDIA_TP&t;&t;3
DECL|macro|DE_MEDIA_TP_FD
mdefine_line|#define DE_MEDIA_TP_FD&t;&t;4
DECL|macro|DE_MEDIA_INVALID
mdefine_line|#define DE_MEDIA_INVALID&t;DE_MAX_MEDIA
DECL|macro|DE_MEDIA_FIRST
mdefine_line|#define DE_MEDIA_FIRST&t;&t;0
DECL|macro|DE_MEDIA_LAST
mdefine_line|#define DE_MEDIA_LAST&t;&t;(DE_MAX_MEDIA - 1)
DECL|macro|DE_AUI_BNC
mdefine_line|#define DE_AUI_BNC&t;&t;(SUPPORTED_AUI | SUPPORTED_BNC)
DECL|macro|DE_TIMER_LINK
mdefine_line|#define DE_TIMER_LINK&t;&t;(60 * HZ)
DECL|macro|DE_TIMER_NO_LINK
mdefine_line|#define DE_TIMER_NO_LINK&t;(5 * HZ)
DECL|macro|DE_NUM_REGS
mdefine_line|#define DE_NUM_REGS&t;&t;16
DECL|macro|DE_REGS_SIZE
mdefine_line|#define DE_REGS_SIZE&t;&t;(DE_NUM_REGS * sizeof(u32))
DECL|macro|DE_REGS_VER
mdefine_line|#define DE_REGS_VER&t;&t;1
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT&t;&t;(6*HZ)
DECL|macro|DE_UNALIGNED_16
mdefine_line|#define DE_UNALIGNED_16(a)&t;(u16)(get_unaligned((u16 *)(a)))
multiline_comment|/* This is a mysterious value that can be written to CSR11 in the 21040 (only)&n;   to support a pre-NWay full-duplex signaling mechanism using short frames.&n;   No one knows what it should be, but if left at its default value some&n;   10base2(!) packets trigger a full-duplex-request interrupt. */
DECL|macro|FULL_DUPLEX_MAGIC
mdefine_line|#define FULL_DUPLEX_MAGIC&t;0x6969
r_enum
(brace
multiline_comment|/* NIC registers */
DECL|enumerator|BusMode
id|BusMode
op_assign
l_int|0x00
comma
DECL|enumerator|TxPoll
id|TxPoll
op_assign
l_int|0x08
comma
DECL|enumerator|RxPoll
id|RxPoll
op_assign
l_int|0x10
comma
DECL|enumerator|RxRingAddr
id|RxRingAddr
op_assign
l_int|0x18
comma
DECL|enumerator|TxRingAddr
id|TxRingAddr
op_assign
l_int|0x20
comma
DECL|enumerator|MacStatus
id|MacStatus
op_assign
l_int|0x28
comma
DECL|enumerator|MacMode
id|MacMode
op_assign
l_int|0x30
comma
DECL|enumerator|IntrMask
id|IntrMask
op_assign
l_int|0x38
comma
DECL|enumerator|RxMissed
id|RxMissed
op_assign
l_int|0x40
comma
DECL|enumerator|ROMCmd
id|ROMCmd
op_assign
l_int|0x48
comma
DECL|enumerator|CSR11
id|CSR11
op_assign
l_int|0x58
comma
DECL|enumerator|SIAStatus
id|SIAStatus
op_assign
l_int|0x60
comma
DECL|enumerator|CSR13
id|CSR13
op_assign
l_int|0x68
comma
DECL|enumerator|CSR14
id|CSR14
op_assign
l_int|0x70
comma
DECL|enumerator|CSR15
id|CSR15
op_assign
l_int|0x78
comma
DECL|enumerator|PCIPM
id|PCIPM
op_assign
l_int|0x40
comma
multiline_comment|/* BusMode bits */
DECL|enumerator|CmdReset
id|CmdReset
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
DECL|enumerator|CacheAlign16
id|CacheAlign16
op_assign
l_int|0x00008000
comma
DECL|enumerator|BurstLen4
id|BurstLen4
op_assign
l_int|0x00000400
comma
multiline_comment|/* Rx/TxPoll bits */
DECL|enumerator|NormalTxPoll
id|NormalTxPoll
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
DECL|enumerator|NormalRxPoll
id|NormalRxPoll
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* Tx/Rx descriptor status bits */
DECL|enumerator|DescOwn
id|DescOwn
op_assign
(paren
l_int|1
op_lshift
l_int|31
)paren
comma
DECL|enumerator|RxError
id|RxError
op_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
DECL|enumerator|RxErrLong
id|RxErrLong
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
DECL|enumerator|RxErrCRC
id|RxErrCRC
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
DECL|enumerator|RxErrFIFO
id|RxErrFIFO
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
DECL|enumerator|RxErrRunt
id|RxErrRunt
op_assign
(paren
l_int|1
op_lshift
l_int|11
)paren
comma
DECL|enumerator|RxErrFrame
id|RxErrFrame
op_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
comma
DECL|enumerator|RingEnd
id|RingEnd
op_assign
(paren
l_int|1
op_lshift
l_int|25
)paren
comma
DECL|enumerator|FirstFrag
id|FirstFrag
op_assign
(paren
l_int|1
op_lshift
l_int|29
)paren
comma
DECL|enumerator|LastFrag
id|LastFrag
op_assign
(paren
l_int|1
op_lshift
l_int|30
)paren
comma
DECL|enumerator|TxError
id|TxError
op_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
DECL|enumerator|TxFIFOUnder
id|TxFIFOUnder
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
DECL|enumerator|TxLinkFail
id|TxLinkFail
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|1
op_lshift
l_int|11
)paren
comma
DECL|enumerator|TxMaxCol
id|TxMaxCol
op_assign
(paren
l_int|1
op_lshift
l_int|8
)paren
comma
DECL|enumerator|TxOWC
id|TxOWC
op_assign
(paren
l_int|1
op_lshift
l_int|9
)paren
comma
DECL|enumerator|TxJabber
id|TxJabber
op_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
comma
DECL|enumerator|SetupFrame
id|SetupFrame
op_assign
(paren
l_int|1
op_lshift
l_int|27
)paren
comma
DECL|enumerator|TxSwInt
id|TxSwInt
op_assign
(paren
l_int|1
op_lshift
l_int|31
)paren
comma
multiline_comment|/* MacStatus bits */
DECL|enumerator|IntrOK
id|IntrOK
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
DECL|enumerator|IntrErr
id|IntrErr
op_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
DECL|enumerator|RxIntr
id|RxIntr
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
DECL|enumerator|RxEmpty
id|RxEmpty
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
DECL|enumerator|TxIntr
id|TxIntr
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
DECL|enumerator|TxEmpty
id|TxEmpty
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
DECL|enumerator|PciErr
id|PciErr
op_assign
(paren
l_int|1
op_lshift
l_int|13
)paren
comma
DECL|enumerator|TxState
id|TxState
op_assign
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|21
)paren
op_or
(paren
l_int|1
op_lshift
l_int|20
)paren
comma
DECL|enumerator|RxState
id|RxState
op_assign
(paren
l_int|1
op_lshift
l_int|19
)paren
op_or
(paren
l_int|1
op_lshift
l_int|18
)paren
op_or
(paren
l_int|1
op_lshift
l_int|17
)paren
comma
DECL|enumerator|LinkFail
id|LinkFail
op_assign
(paren
l_int|1
op_lshift
l_int|12
)paren
comma
DECL|enumerator|LinkPass
id|LinkPass
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
DECL|enumerator|RxStopped
id|RxStopped
op_assign
(paren
l_int|1
op_lshift
l_int|8
)paren
comma
DECL|enumerator|TxStopped
id|TxStopped
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* MacMode bits */
DECL|enumerator|TxEnable
id|TxEnable
op_assign
(paren
l_int|1
op_lshift
l_int|13
)paren
comma
DECL|enumerator|RxEnable
id|RxEnable
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
DECL|enumerator|RxTx
id|RxTx
op_assign
id|TxEnable
op_or
id|RxEnable
comma
DECL|enumerator|FullDuplex
id|FullDuplex
op_assign
(paren
l_int|1
op_lshift
l_int|9
)paren
comma
DECL|enumerator|AcceptAllMulticast
id|AcceptAllMulticast
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
DECL|enumerator|AcceptAllPhys
id|AcceptAllPhys
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
DECL|enumerator|BOCnt
id|BOCnt
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
DECL|enumerator|MacModeClear
id|MacModeClear
op_assign
(paren
l_int|1
op_lshift
l_int|12
)paren
op_or
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|3
)paren
op_or
id|RxTx
op_or
id|BOCnt
op_or
id|AcceptAllPhys
op_or
id|AcceptAllMulticast
comma
multiline_comment|/* ROMCmd bits */
DECL|enumerator|EE_SHIFT_CLK
id|EE_SHIFT_CLK
op_assign
l_int|0x02
comma
multiline_comment|/* EEPROM shift clock. */
DECL|enumerator|EE_CS
id|EE_CS
op_assign
l_int|0x01
comma
multiline_comment|/* EEPROM chip select. */
DECL|enumerator|EE_DATA_WRITE
id|EE_DATA_WRITE
op_assign
l_int|0x04
comma
multiline_comment|/* Data from the Tulip to EEPROM. */
DECL|enumerator|EE_WRITE_0
id|EE_WRITE_0
op_assign
l_int|0x01
comma
DECL|enumerator|EE_WRITE_1
id|EE_WRITE_1
op_assign
l_int|0x05
comma
DECL|enumerator|EE_DATA_READ
id|EE_DATA_READ
op_assign
l_int|0x08
comma
multiline_comment|/* Data from the EEPROM chip. */
DECL|enumerator|EE_ENB
id|EE_ENB
op_assign
(paren
l_int|0x4800
op_or
id|EE_CS
)paren
comma
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|enumerator|EE_READ_CMD
id|EE_READ_CMD
op_assign
l_int|6
comma
multiline_comment|/* RxMissed bits */
DECL|enumerator|RxMissedOver
id|RxMissedOver
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
DECL|enumerator|RxMissedMask
id|RxMissedMask
op_assign
l_int|0xffff
comma
multiline_comment|/* SROM-related bits */
DECL|enumerator|SROMC0InfoLeaf
id|SROMC0InfoLeaf
op_assign
l_int|27
comma
DECL|enumerator|MediaBlockMask
id|MediaBlockMask
op_assign
l_int|0x3f
comma
DECL|enumerator|MediaCustomCSRs
id|MediaCustomCSRs
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* PCIPM bits */
DECL|enumerator|PM_Sleep
id|PM_Sleep
op_assign
(paren
l_int|1
op_lshift
l_int|31
)paren
comma
DECL|enumerator|PM_Snooze
id|PM_Snooze
op_assign
(paren
l_int|1
op_lshift
l_int|30
)paren
comma
DECL|enumerator|PM_Mask
id|PM_Mask
op_assign
id|PM_Sleep
op_or
id|PM_Snooze
comma
multiline_comment|/* SIAStatus bits */
DECL|enumerator|NWayState
id|NWayState
op_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
comma
DECL|enumerator|NWayRestart
id|NWayRestart
op_assign
(paren
l_int|1
op_lshift
l_int|12
)paren
comma
DECL|enumerator|NonselPortActive
id|NonselPortActive
op_assign
(paren
l_int|1
op_lshift
l_int|9
)paren
comma
DECL|enumerator|LinkFailStatus
id|LinkFailStatus
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
DECL|enumerator|NetCxnErr
id|NetCxnErr
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|variable|de_intr_mask
r_static
r_const
id|u32
id|de_intr_mask
op_assign
id|IntrOK
op_or
id|IntrErr
op_or
id|RxIntr
op_or
id|RxEmpty
op_or
id|TxIntr
op_or
id|TxEmpty
op_or
id|LinkPass
op_or
id|LinkFail
op_or
id|PciErr
suffix:semicolon
multiline_comment|/*&n; * Set the programmable burst length to 4 longwords for all:&n; * DMA errors result without these values. Cache align 16 long.&n; */
DECL|variable|de_bus_mode
r_static
r_const
id|u32
id|de_bus_mode
op_assign
id|CacheAlign16
op_or
id|BurstLen4
suffix:semicolon
DECL|struct|de_srom_media_block
r_struct
id|de_srom_media_block
(brace
DECL|member|opts
id|u8
id|opts
suffix:semicolon
DECL|member|csr13
id|u16
id|csr13
suffix:semicolon
DECL|member|csr14
id|u16
id|csr14
suffix:semicolon
DECL|member|csr15
id|u16
id|csr15
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|de_srom_info_leaf
r_struct
id|de_srom_info_leaf
(brace
DECL|member|default_media
id|u16
id|default_media
suffix:semicolon
DECL|member|n_blocks
id|u8
id|n_blocks
suffix:semicolon
DECL|member|unused
id|u8
id|unused
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|de_desc
r_struct
id|de_desc
(brace
DECL|member|opts1
id|u32
id|opts1
suffix:semicolon
DECL|member|opts2
id|u32
id|opts2
suffix:semicolon
DECL|member|addr1
id|u32
id|addr1
suffix:semicolon
DECL|member|addr2
id|u32
id|addr2
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|media_info
r_struct
id|media_info
(brace
DECL|member|type
id|u16
id|type
suffix:semicolon
multiline_comment|/* DE_MEDIA_xxx */
DECL|member|csr13
id|u16
id|csr13
suffix:semicolon
DECL|member|csr14
id|u16
id|csr14
suffix:semicolon
DECL|member|csr15
id|u16
id|csr15
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ring_info
r_struct
id|ring_info
(brace
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|mapping
id|dma_addr_t
id|mapping
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|de_private
r_struct
id|de_private
(brace
DECL|member|tx_head
r_int
id|tx_head
suffix:semicolon
DECL|member|tx_tail
r_int
id|tx_tail
suffix:semicolon
DECL|member|rx_tail
r_int
id|rx_tail
suffix:semicolon
DECL|member|regs
r_void
op_star
id|regs
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|rx_ring
r_struct
id|de_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring
r_struct
id|de_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|tx_skb
r_struct
id|ring_info
id|tx_skb
(braket
id|DE_TX_RING_SIZE
)braket
suffix:semicolon
DECL|member|rx_skb
r_struct
id|ring_info
id|rx_skb
(braket
id|DE_RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|rx_buf_sz
r_int
id|rx_buf_sz
suffix:semicolon
DECL|member|ring_dma
id|dma_addr_t
id|ring_dma
suffix:semicolon
DECL|member|msg_enable
id|u32
id|msg_enable
suffix:semicolon
DECL|member|net_stats
r_struct
id|net_device_stats
id|net_stats
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|macmode
id|u32
id|macmode
suffix:semicolon
DECL|member|setup_frame
id|u16
id|setup_frame
(braket
id|DE_SETUP_FRAME_WORDS
)braket
suffix:semicolon
DECL|member|media_type
id|u32
id|media_type
suffix:semicolon
DECL|member|media_supported
id|u32
id|media_supported
suffix:semicolon
DECL|member|media_advertise
id|u32
id|media_advertise
suffix:semicolon
DECL|member|media
r_struct
id|media_info
id|media
(braket
id|DE_MAX_MEDIA
)braket
suffix:semicolon
DECL|member|media_timer
r_struct
id|timer_list
id|media_timer
suffix:semicolon
DECL|member|ee_data
id|u8
op_star
id|ee_data
suffix:semicolon
DECL|member|board_idx
r_int
id|board_idx
suffix:semicolon
DECL|member|de21040
r_int
id|de21040
suffix:colon
l_int|1
suffix:semicolon
DECL|member|media_lock
r_int
id|media_lock
suffix:colon
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|de_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|de_tx
(paren
r_struct
id|de_private
op_star
id|de
)paren
suffix:semicolon
r_static
r_void
id|de_clean_rings
(paren
r_struct
id|de_private
op_star
id|de
)paren
suffix:semicolon
r_static
r_void
id|de_media_interrupt
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
id|status
)paren
suffix:semicolon
r_static
r_void
id|de21040_media_timer
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|de21041_media_timer
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_int
r_int
id|de_ok_to_advertise
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
id|new_media
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|pci_device_id
id|de_pci_tbl
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_DEC
comma
id|PCI_DEVICE_ID_DEC_TULIP
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_DEC
comma
id|PCI_DEVICE_ID_DEC_TULIP_PLUS
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
comma
(brace
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|de_pci_tbl
)paren
suffix:semicolon
DECL|variable|media_name
r_static
r_const
r_char
op_star
r_const
id|media_name
(braket
id|DE_MAX_MEDIA
)braket
op_assign
(brace
l_string|&quot;10baseT auto&quot;
comma
l_string|&quot;BNC&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;10baseT-HD&quot;
comma
l_string|&quot;10baseT-FD&quot;
)brace
suffix:semicolon
multiline_comment|/* 21040 transceiver register settings:&n; * TP AUTO(unused), BNC(unused), AUI, TP, TP FD*/
DECL|variable|t21040_csr13
r_static
id|u16
id|t21040_csr13
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0x8F09
comma
l_int|0x8F01
comma
l_int|0x8F01
comma
)brace
suffix:semicolon
DECL|variable|t21040_csr14
r_static
id|u16
id|t21040_csr14
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0x0705
comma
l_int|0xFFFF
comma
l_int|0xFFFD
comma
)brace
suffix:semicolon
DECL|variable|t21040_csr15
r_static
id|u16
id|t21040_csr15
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0x0006
comma
l_int|0x0000
comma
l_int|0x0000
comma
)brace
suffix:semicolon
multiline_comment|/* 21041 transceiver register settings: TP AUTO, BNC, AUI, TP, TP FD*/
DECL|variable|t21041_csr13
r_static
id|u16
id|t21041_csr13
(braket
)braket
op_assign
(brace
l_int|0xEF01
comma
l_int|0xEF09
comma
l_int|0xEF09
comma
l_int|0xEF01
comma
l_int|0xEF09
comma
)brace
suffix:semicolon
DECL|variable|t21041_csr14
r_static
id|u16
id|t21041_csr14
(braket
)braket
op_assign
(brace
l_int|0xFFFF
comma
l_int|0xF7FD
comma
l_int|0xF7FD
comma
l_int|0x6F3F
comma
l_int|0x6F3D
comma
)brace
suffix:semicolon
DECL|variable|t21041_csr15
r_static
id|u16
id|t21041_csr15
(braket
)braket
op_assign
(brace
l_int|0x0008
comma
l_int|0x0006
comma
l_int|0x000E
comma
l_int|0x0008
comma
l_int|0x0008
comma
)brace
suffix:semicolon
r_static
r_inline
r_int
r_int
DECL|function|msec_to_jiffies
id|msec_to_jiffies
c_func
(paren
r_int
r_int
id|ms
)paren
(brace
r_return
(paren
(paren
(paren
id|ms
)paren
op_star
id|HZ
op_plus
l_int|999
)paren
op_div
l_int|1000
)paren
suffix:semicolon
)brace
DECL|macro|dr32
mdefine_line|#define dr32(reg)&t;&t;readl(de-&gt;regs + (reg))
DECL|macro|dw32
mdefine_line|#define dw32(reg,val)&t;&t;writel((val), de-&gt;regs + (reg))
DECL|function|de_rx_err_acct
r_static
r_void
id|de_rx_err_acct
(paren
r_struct
id|de_private
op_star
id|de
comma
r_int
id|rx_tail
comma
id|u32
id|status
comma
id|u32
id|len
)paren
(brace
r_if
c_cond
(paren
id|netif_msg_rx_err
(paren
id|de
)paren
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx err, slot %d status 0x%x len %d&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x38000300
)paren
op_ne
l_int|0x0300
)paren
(brace
multiline_comment|/* Ingore earlier buffers. */
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0xffff
)paren
op_ne
l_int|0x7fff
)paren
(brace
r_if
c_cond
(paren
id|netif_msg_rx_err
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized Ethernet frame &quot;
l_string|&quot;spanned multiple buffers, status %8.8x!&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|de-&gt;net_stats.rx_length_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|RxError
)paren
(brace
multiline_comment|/* There was a fatal error. */
id|de-&gt;net_stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* end of a packet.*/
r_if
c_cond
(paren
id|status
op_amp
l_int|0x0890
)paren
id|de-&gt;net_stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrCRC
)paren
id|de-&gt;net_stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrFIFO
)paren
id|de-&gt;net_stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
)brace
DECL|function|de_rx
r_static
r_void
id|de_rx
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|rx_tail
op_assign
id|de-&gt;rx_tail
suffix:semicolon
r_int
id|rx_work
op_assign
id|DE_RX_RING_SIZE
suffix:semicolon
r_int
id|drop
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_while
c_loop
(paren
id|rx_work
op_decrement
)paren
(brace
id|u32
id|status
comma
id|len
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|copy_skb
suffix:semicolon
r_int
id|copying_skb
comma
id|buflen
suffix:semicolon
id|skb
op_assign
id|de-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|de-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|opts1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DescOwn
)paren
r_break
suffix:semicolon
id|len
op_assign
(paren
(paren
id|status
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_minus
l_int|4
suffix:semicolon
id|mapping
op_assign
id|de-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|mapping
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|drop
)paren
)paren
(brace
id|de-&gt;net_stats.rx_dropped
op_increment
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
(paren
id|status
op_amp
l_int|0x38008300
)paren
op_ne
l_int|0x0300
)paren
)paren
(brace
id|de_rx_err_acct
c_func
(paren
id|de
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
id|copying_skb
op_assign
(paren
id|len
op_le
id|rx_copybreak
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|netif_msg_rx_status
c_func
(paren
id|de
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx slot %d status 0x%x len %d copying? %d&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|rx_tail
comma
id|status
comma
id|len
comma
id|copying_skb
)paren
suffix:semicolon
id|buflen
op_assign
id|copying_skb
ques
c_cond
(paren
id|len
op_plus
id|RX_OFFSET
)paren
suffix:colon
id|de-&gt;rx_buf_sz
suffix:semicolon
id|copy_skb
op_assign
id|dev_alloc_skb
(paren
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
id|copy_skb
)paren
)paren
(brace
id|de-&gt;net_stats.rx_dropped
op_increment
suffix:semicolon
id|drop
op_assign
l_int|1
suffix:semicolon
id|rx_work
op_assign
l_int|100
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
id|copy_skb-&gt;dev
op_assign
id|de-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|copying_skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|mapping
comma
id|buflen
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|mapping
op_assign
id|de-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|de-&gt;pdev
comma
id|copy_skb-&gt;tail
comma
id|buflen
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|de-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|skb
op_assign
id|copy_skb
suffix:semicolon
)brace
r_else
(brace
id|pci_dma_sync_single
c_func
(paren
id|de-&gt;pdev
comma
id|mapping
comma
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|copy_skb
comma
id|RX_OFFSET
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|copy_skb
comma
id|len
)paren
comma
id|skb-&gt;tail
comma
id|len
)paren
suffix:semicolon
multiline_comment|/* We&squot;ll reuse the original ring buffer. */
id|skb
op_assign
id|copy_skb
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
(paren
id|skb
comma
id|de-&gt;dev
)paren
suffix:semicolon
id|de-&gt;net_stats.rx_packets
op_increment
suffix:semicolon
id|de-&gt;net_stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|de-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|rc
op_assign
id|netif_rx
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
id|NET_RX_DROP
)paren
id|drop
op_assign
l_int|1
suffix:semicolon
id|rx_next
suffix:colon
id|de-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rx_tail
op_eq
(paren
id|DE_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|de-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
op_or
id|de-&gt;rx_buf_sz
)paren
suffix:semicolon
r_else
id|de-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|de-&gt;rx_buf_sz
)paren
suffix:semicolon
id|de-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|addr1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|rx_tail
op_assign
id|NEXT_RX
c_func
(paren
id|rx_tail
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rx_work
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: rx work limit reached&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
)paren
suffix:semicolon
id|de-&gt;rx_tail
op_assign
id|rx_tail
suffix:semicolon
)brace
DECL|function|de_interrupt
r_static
r_void
id|de_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_instance
suffix:semicolon
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|status
op_assign
id|dr32
c_func
(paren
id|MacStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|IntrOK
op_or
id|IntrErr
)paren
)paren
)paren
op_logical_or
(paren
id|status
op_eq
l_int|0xFFFF
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_intr
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: intr, status %08x mode %08x desc %u/%u/%u&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|dr32
c_func
(paren
id|MacMode
)paren
comma
id|de-&gt;rx_tail
comma
id|de-&gt;tx_head
comma
id|de-&gt;tx_tail
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|MacStatus
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxIntr
op_or
id|RxEmpty
)paren
)paren
(brace
id|de_rx
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxEmpty
)paren
id|dw32
c_func
(paren
id|RxPoll
comma
id|NormalRxPoll
)paren
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxIntr
op_or
id|TxEmpty
)paren
)paren
id|de_tx
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|LinkPass
op_or
id|LinkFail
)paren
)paren
id|de_media_interrupt
c_func
(paren
id|de
comma
id|status
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PciErr
)paren
(brace
id|u16
id|pci_status
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|de-&gt;pdev
comma
id|PCI_STATUS
comma
op_amp
id|pci_status
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|de-&gt;pdev
comma
id|PCI_STATUS
comma
id|pci_status
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: PCI bus error, status=%08x, PCI status=%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|pci_status
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_tx
r_static
r_void
id|de_tx
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|tx_head
op_assign
id|de-&gt;tx_head
suffix:semicolon
r_int
id|tx_tail
op_assign
id|de-&gt;tx_tail
suffix:semicolon
r_while
c_loop
(paren
id|tx_tail
op_ne
id|tx_head
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|de-&gt;tx_ring
(braket
id|tx_tail
)braket
dot
id|opts1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DescOwn
)paren
r_break
suffix:semicolon
id|skb
op_assign
id|de-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb
op_eq
id|DE_DUMMY_SKB
)paren
)paren
r_goto
id|next
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb
op_eq
id|DE_SETUP_SKB
)paren
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|de-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|mapping
comma
r_sizeof
(paren
id|de-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|de-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|LastFrag
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|TxError
)paren
(brace
r_if
c_cond
(paren
id|netif_msg_tx_err
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx err, status 0x%x&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|de-&gt;net_stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxOWC
)paren
id|de-&gt;net_stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxMaxCol
)paren
id|de-&gt;net_stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxLinkFail
)paren
id|de-&gt;net_stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxFIFOUnder
)paren
id|de-&gt;net_stats.tx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|de-&gt;net_stats.tx_packets
op_increment
suffix:semicolon
id|de-&gt;net_stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_tx_done
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx done, slot %d&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|tx_tail
)paren
suffix:semicolon
)brace
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|next
suffix:colon
id|de-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tx_tail
op_assign
id|NEXT_TX
c_func
(paren
id|tx_tail
)paren
suffix:semicolon
)brace
id|de-&gt;tx_tail
op_assign
id|tx_tail
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|de-&gt;dev
)paren
op_logical_and
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|de
)paren
OG
(paren
id|DE_TX_RING_SIZE
op_div
l_int|4
)paren
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|de-&gt;dev
)paren
suffix:semicolon
)brace
DECL|function|de_start_xmit
r_static
r_int
id|de_start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|entry
comma
id|tx_free
suffix:semicolon
id|u32
id|mapping
comma
id|len
comma
id|flags
op_assign
id|FirstFrag
op_or
id|LastFrag
suffix:semicolon
r_struct
id|de_desc
op_star
id|txd
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|tx_free
op_assign
id|TX_BUFFS_AVAIL
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_free
op_eq
l_int|0
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|tx_free
op_decrement
suffix:semicolon
id|entry
op_assign
id|de-&gt;tx_head
suffix:semicolon
id|txd
op_assign
op_amp
id|de-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|de-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
(paren
id|DE_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|flags
op_or_assign
id|RingEnd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tx_free
op_logical_or
(paren
id|tx_free
op_eq
(paren
id|DE_TX_RING_SIZE
op_div
l_int|2
)paren
)paren
)paren
id|flags
op_or_assign
id|TxSwInt
suffix:semicolon
id|flags
op_or_assign
id|len
suffix:semicolon
id|txd-&gt;opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|flags
)paren
suffix:semicolon
id|txd-&gt;addr1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|de-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|de-&gt;tx_skb
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|de-&gt;tx_head
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_tx_queued
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx queued, slot %d, skblen %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|entry
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_free
op_eq
l_int|0
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|dw32
c_func
(paren
id|TxPoll
comma
id|NormalTxPoll
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   Note that we only use exclusion around actually queueing the&n;   new frame, not around filling de-&gt;setup_frame.  This is non-deterministic&n;   when re-entered but still correct. */
multiline_comment|/* The little-endian AUTODIN32 ethernet CRC calculation.&n;   N.B. Do not use for bulk data, use a table-based routine instead.&n;   This is common code and should be moved to net/core/crc.c */
DECL|variable|ethernet_polynomial_le
r_static
r_int
r_const
id|ethernet_polynomial_le
op_assign
l_int|0xedb88320U
suffix:semicolon
DECL|function|ether_crc_le
r_static
r_inline
id|u32
id|ether_crc_le
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
id|u32
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Initial value. */
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|8
suffix:semicolon
op_decrement
id|bit
op_ge
l_int|0
suffix:semicolon
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|current_octet
)paren
op_amp
l_int|1
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|ethernet_polynomial_le
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|macro|set_bit_le
macro_line|#undef set_bit_le
DECL|macro|set_bit_le
mdefine_line|#define set_bit_le(i,p) do { ((char *)(p))[(i)/8] |= (1&lt;&lt;((i)%8)); } while(0)
DECL|function|build_setup_frame_hash
r_static
r_void
id|build_setup_frame_hash
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u16
id|hash_table
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
id|memset
c_func
(paren
id|hash_table
comma
l_int|0
comma
r_sizeof
(paren
id|hash_table
)paren
)paren
suffix:semicolon
id|set_bit_le
c_func
(paren
l_int|255
comma
id|hash_table
)paren
suffix:semicolon
multiline_comment|/* Broadcast entry */
multiline_comment|/* This should work on big-endian machines as well. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|index
op_assign
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_amp
l_int|0x1ff
suffix:semicolon
id|set_bit_le
c_func
(paren
id|index
comma
id|hash_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
)brace
id|setup_frm
op_assign
op_amp
id|de-&gt;setup_frame
(braket
l_int|13
op_star
l_int|6
)braket
suffix:semicolon
)brace
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|build_setup_frame_perfect
r_static
r_void
id|build_setup_frame_perfect
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
multiline_comment|/* We have &lt;= 14 addresses so we can use the wonderful&n;&t;   16 address perfect filtering of the Tulip. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|mclist-&gt;dmi_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
)brace
multiline_comment|/* Fill the unused entries with the broadcast address. */
id|memset
c_func
(paren
id|setup_frm
comma
l_int|0xff
comma
(paren
l_int|15
op_minus
id|i
)paren
op_star
l_int|12
)paren
suffix:semicolon
id|setup_frm
op_assign
op_amp
id|de-&gt;setup_frame
(braket
l_int|15
op_star
l_int|6
)braket
suffix:semicolon
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|__de_set_rx_mode
r_static
r_void
id|__de_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|macmode
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
id|u32
id|mapping
suffix:semicolon
r_struct
id|de_desc
op_star
id|txd
suffix:semicolon
r_struct
id|de_desc
op_star
id|dummy_txd
op_assign
l_int|NULL
suffix:semicolon
id|macmode
op_assign
id|de-&gt;macmode
op_amp
op_complement
(paren
id|AcceptAllMulticast
op_or
id|AcceptAllPhys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|macmode
op_or_assign
id|AcceptAllMulticast
op_or
id|AcceptAllPhys
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
l_int|1000
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter well -- accept all multicasts. */
id|macmode
op_or_assign
id|AcceptAllMulticast
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Note that only the low-address shortword of setup_frame is valid!&n;&t;   The values are doubled for big-endian architectures. */
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|14
)paren
multiline_comment|/* Must use a multicast hash table. */
id|build_setup_frame_hash
(paren
id|de-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
r_else
id|build_setup_frame_perfect
(paren
id|de-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Now add this frame to the Tx list.&n;&t; */
id|entry
op_assign
id|de-&gt;tx_head
suffix:semicolon
multiline_comment|/* Avoid a chip errata by prefixing a dummy entry. */
r_if
c_cond
(paren
id|entry
op_ne
l_int|0
)paren
(brace
id|de-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|DE_DUMMY_SKB
suffix:semicolon
id|dummy_txd
op_assign
op_amp
id|de-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|dummy_txd-&gt;opts2
op_assign
(paren
id|entry
op_eq
(paren
id|DE_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
ques
c_cond
id|cpu_to_le32
c_func
(paren
id|RingEnd
)paren
suffix:colon
l_int|0
suffix:semicolon
id|dummy_txd-&gt;addr1
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Must set DescOwned later to avoid race with chip */
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
id|de-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|DE_SETUP_SKB
suffix:semicolon
id|de-&gt;tx_skb
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
op_assign
id|pci_map_single
(paren
id|de-&gt;pdev
comma
id|de-&gt;setup_frame
comma
r_sizeof
(paren
id|de-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
id|txd
op_assign
op_amp
id|de-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_eq
(paren
id|DE_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|txd-&gt;opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|SetupFrame
op_or
id|RingEnd
op_or
r_sizeof
(paren
id|de-&gt;setup_frame
)paren
)paren
suffix:semicolon
r_else
id|txd-&gt;opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|SetupFrame
op_or
r_sizeof
(paren
id|de-&gt;setup_frame
)paren
)paren
suffix:semicolon
id|txd-&gt;addr1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy_txd
)paren
(brace
id|dummy_txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
)brace
id|de-&gt;tx_head
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|de
)paren
OL
l_int|0
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|de
)paren
op_eq
l_int|0
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|dw32
c_func
(paren
id|TxPoll
comma
id|NormalTxPoll
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|macmode
op_ne
id|de-&gt;macmode
)paren
(brace
id|dw32
(paren
id|MacMode
comma
id|macmode
)paren
suffix:semicolon
id|de-&gt;macmode
op_assign
id|macmode
suffix:semicolon
)brace
)brace
DECL|function|de_set_rx_mode
r_static
r_void
id|de_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|__de_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|de_rx_missed
r_static
r_inline
r_void
id|de_rx_missed
c_func
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
id|rx_missed
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|rx_missed
op_amp
id|RxMissedOver
)paren
)paren
id|de-&gt;net_stats.rx_missed_errors
op_add_assign
id|RxMissedMask
suffix:semicolon
r_else
id|de-&gt;net_stats.rx_missed_errors
op_add_assign
(paren
id|rx_missed
op_amp
id|RxMissedMask
)paren
suffix:semicolon
)brace
DECL|function|__de_get_stats
r_static
r_void
id|__de_get_stats
c_func
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|tmp
op_assign
id|dr32
c_func
(paren
id|RxMissed
)paren
suffix:semicolon
multiline_comment|/* self-clearing */
id|de_rx_missed
c_func
(paren
id|de
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|de_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|de_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* The chip only need report frame silently dropped. */
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
op_logical_and
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
id|__de_get_stats
c_func
(paren
id|de
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_return
op_amp
id|de-&gt;net_stats
suffix:semicolon
)brace
DECL|function|de_is_running
r_static
r_inline
r_int
id|de_is_running
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_return
(paren
id|dr32
c_func
(paren
id|MacStatus
)paren
op_amp
(paren
id|RxState
op_or
id|TxState
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|de_stop_rxtx
r_static
r_void
id|de_stop_rxtx
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|macmode
suffix:semicolon
r_int
r_int
id|work
op_assign
l_int|1000
suffix:semicolon
id|macmode
op_assign
id|dr32
c_func
(paren
id|MacMode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|macmode
op_amp
id|RxTx
)paren
(brace
id|dw32
c_func
(paren
id|MacMode
comma
id|macmode
op_amp
op_complement
id|RxTx
)paren
suffix:semicolon
id|dr32
c_func
(paren
id|MacMode
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|work
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|de_is_running
c_func
(paren
id|de
)paren
)paren
r_return
suffix:semicolon
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: timeout expired stopping DMA&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|de_start_rxtx
r_static
r_inline
r_void
id|de_start_rxtx
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|macmode
suffix:semicolon
id|macmode
op_assign
id|dr32
c_func
(paren
id|MacMode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|macmode
op_amp
id|RxTx
)paren
op_ne
id|RxTx
)paren
(brace
id|dw32
c_func
(paren
id|MacMode
comma
id|macmode
op_or
id|RxTx
)paren
suffix:semicolon
id|dr32
c_func
(paren
id|MacMode
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_stop_hw
r_static
r_void
id|de_stop_hw
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
id|de_stop_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|MacStatus
comma
id|dr32
c_func
(paren
id|MacStatus
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|de-&gt;rx_tail
op_assign
l_int|0
suffix:semicolon
id|de-&gt;tx_head
op_assign
id|de-&gt;tx_tail
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|de_link_up
r_static
r_void
id|de_link_up
c_func
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|de-&gt;dev
)paren
)paren
(brace
id|netif_carrier_on
c_func
(paren
id|de-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_link
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link up, media %s&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_link_down
r_static
r_void
id|de_link_down
c_func
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|de-&gt;dev
)paren
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|de-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_link
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link down&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_set_media
r_static
r_void
id|de_set_media
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|media
op_assign
id|de-&gt;media_type
suffix:semicolon
r_if
c_cond
(paren
id|de_is_running
c_func
(paren
id|de
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
)paren
id|dw32
c_func
(paren
id|CSR11
comma
id|FULL_DUPLEX_MAGIC
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|CSR13
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Reset phy */
id|dw32
c_func
(paren
id|CSR14
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr14
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|CSR15
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr15
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|CSR13
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr13
)paren
suffix:semicolon
multiline_comment|/* must delay 10ms before writing to other registers,&n;&t; * especially CSR6&n;&t; */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|media
op_eq
id|DE_MEDIA_TP_FD
)paren
id|de-&gt;macmode
op_or_assign
id|FullDuplex
suffix:semicolon
r_else
id|de-&gt;macmode
op_and_assign
op_complement
id|FullDuplex
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_link
c_func
(paren
id|de
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: set link %s&bslash;n&quot;
id|KERN_INFO
l_string|&quot;%s:    mode 0x%x, sia 0x%x,0x%x,0x%x,0x%x&bslash;n&quot;
id|KERN_INFO
l_string|&quot;%s:    set mode 0x%x, set sia 0x%x,0x%x,0x%x&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|media_name
(braket
id|media
)braket
comma
id|de-&gt;dev-&gt;name
comma
id|dr32
c_func
(paren
id|MacMode
)paren
comma
id|dr32
c_func
(paren
id|SIAStatus
)paren
comma
id|dr32
c_func
(paren
id|CSR13
)paren
comma
id|dr32
c_func
(paren
id|CSR14
)paren
comma
id|dr32
c_func
(paren
id|CSR15
)paren
comma
id|de-&gt;dev-&gt;name
comma
id|de-&gt;macmode
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr13
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr14
comma
id|de-&gt;media
(braket
id|media
)braket
dot
id|csr15
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_next_media
r_static
r_void
id|de_next_media
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
op_star
id|media
comma
r_int
r_int
id|n_media
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n_media
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|de_ok_to_advertise
c_func
(paren
id|de
comma
id|media
(braket
id|i
)braket
)paren
)paren
(brace
id|de-&gt;media_type
op_assign
id|media
(braket
id|i
)braket
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
DECL|function|de21040_media_timer
r_static
r_void
id|de21040_media_timer
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
(paren
r_struct
id|de_private
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|de-&gt;dev
suffix:semicolon
id|u32
id|status
op_assign
id|dr32
c_func
(paren
id|SIAStatus
)paren
suffix:semicolon
r_int
r_int
id|carrier
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|carrier
op_assign
(paren
id|status
op_amp
id|NetCxnErr
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|carrier
)paren
(brace
r_if
c_cond
(paren
id|de-&gt;media_type
op_ne
id|DE_MEDIA_AUI
op_logical_and
(paren
id|status
op_amp
id|LinkFailStatus
)paren
)paren
r_goto
id|no_link_yet
suffix:semicolon
id|de-&gt;media_timer.expires
op_assign
id|jiffies
op_plus
id|DE_TIMER_LINK
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
id|de_link_up
c_func
(paren
id|de
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|netif_msg_timer
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s link ok, status %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
comma
id|status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|de_link_down
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media_lock
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media_type
op_eq
id|DE_MEDIA_AUI
)paren
(brace
id|u32
id|next_state
op_assign
id|DE_MEDIA_TP
suffix:semicolon
id|de_next_media
c_func
(paren
id|de
comma
op_amp
id|next_state
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|u32
id|next_state
op_assign
id|DE_MEDIA_AUI
suffix:semicolon
id|de_next_media
c_func
(paren
id|de
comma
op_amp
id|next_state
comma
l_int|1
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_stop_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_set_media
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_start_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|no_link_yet
suffix:colon
id|de-&gt;media_timer.expires
op_assign
id|jiffies
op_plus
id|DE_TIMER_NO_LINK
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_timer
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: no link, trying media %s, status %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|de_ok_to_advertise
r_static
r_int
r_int
id|de_ok_to_advertise
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
id|new_media
)paren
(brace
r_switch
c_cond
(paren
id|new_media
)paren
(brace
r_case
id|DE_MEDIA_TP_AUTO
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
id|ADVERTISED_Autoneg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
(paren
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DE_MEDIA_BNC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
id|ADVERTISED_BNC
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DE_MEDIA_AUI
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
id|ADVERTISED_AUI
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DE_MEDIA_TP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
id|ADVERTISED_10baseT_Half
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DE_MEDIA_TP_FD
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|de-&gt;media_advertise
op_amp
id|ADVERTISED_10baseT_Full
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|de21041_media_timer
r_static
r_void
id|de21041_media_timer
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
(paren
r_struct
id|de_private
op_star
)paren
id|data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|de-&gt;dev
suffix:semicolon
id|u32
id|status
op_assign
id|dr32
c_func
(paren
id|SIAStatus
)paren
suffix:semicolon
r_int
r_int
id|carrier
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|carrier
op_assign
(paren
id|status
op_amp
id|NetCxnErr
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|carrier
)paren
(brace
r_if
c_cond
(paren
(paren
id|de-&gt;media_type
op_eq
id|DE_MEDIA_TP_AUTO
op_logical_or
id|de-&gt;media_type
op_eq
id|DE_MEDIA_TP
op_logical_or
id|de-&gt;media_type
op_eq
id|DE_MEDIA_TP_FD
)paren
op_logical_and
(paren
id|status
op_amp
id|LinkFailStatus
)paren
)paren
r_goto
id|no_link_yet
suffix:semicolon
id|de-&gt;media_timer.expires
op_assign
id|jiffies
op_plus
id|DE_TIMER_LINK
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
id|de_link_up
c_func
(paren
id|de
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|netif_msg_timer
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s link ok, mode %x status %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
comma
id|dr32
c_func
(paren
id|MacMode
)paren
comma
id|status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|de_link_down
c_func
(paren
id|de
)paren
suffix:semicolon
multiline_comment|/* if media type locked, don&squot;t switch media */
r_if
c_cond
(paren
id|de-&gt;media_lock
)paren
r_goto
id|set_media
suffix:semicolon
multiline_comment|/* if activity detected, use that as hint for new media type */
r_if
c_cond
(paren
id|status
op_amp
id|NonselPortActive
)paren
(brace
r_int
r_int
id|have_media
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* if AUI/BNC selected, then activity is on TP port */
r_if
c_cond
(paren
id|de-&gt;media_type
op_eq
id|DE_MEDIA_AUI
op_logical_or
id|de-&gt;media_type
op_eq
id|DE_MEDIA_BNC
)paren
(brace
r_if
c_cond
(paren
id|de_ok_to_advertise
c_func
(paren
id|de
comma
id|DE_MEDIA_TP_AUTO
)paren
)paren
id|de-&gt;media_type
op_assign
id|DE_MEDIA_TP_AUTO
suffix:semicolon
r_else
id|have_media
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* TP selected.  If there is only TP and BNC, then it&squot;s BNC */
r_else
r_if
c_cond
(paren
(paren
(paren
id|de-&gt;media_supported
op_amp
id|DE_AUI_BNC
)paren
op_eq
id|SUPPORTED_BNC
)paren
op_logical_and
id|de_ok_to_advertise
c_func
(paren
id|de
comma
id|DE_MEDIA_BNC
)paren
)paren
id|de-&gt;media_type
op_assign
id|DE_MEDIA_BNC
suffix:semicolon
multiline_comment|/* TP selected.  If there is only TP and AUI, then it&squot;s AUI */
r_else
r_if
c_cond
(paren
(paren
(paren
id|de-&gt;media_supported
op_amp
id|DE_AUI_BNC
)paren
op_eq
id|SUPPORTED_AUI
)paren
op_logical_and
id|de_ok_to_advertise
c_func
(paren
id|de
comma
id|DE_MEDIA_AUI
)paren
)paren
id|de-&gt;media_type
op_assign
id|DE_MEDIA_AUI
suffix:semicolon
multiline_comment|/* otherwise, ignore the hint */
r_else
id|have_media
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|have_media
)paren
r_goto
id|set_media
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Absent or ambiguous activity hint, move to next advertised&n;&t; * media state.  If de-&gt;media_type is left unchanged, this&n;&t; * simply resets the PHY and reloads the current media settings.&n;&t; */
r_if
c_cond
(paren
id|de-&gt;media_type
op_eq
id|DE_MEDIA_AUI
)paren
(brace
id|u32
id|next_states
(braket
)braket
op_assign
(brace
id|DE_MEDIA_BNC
comma
id|DE_MEDIA_TP_AUTO
)brace
suffix:semicolon
id|de_next_media
c_func
(paren
id|de
comma
id|next_states
comma
id|ARRAY_SIZE
c_func
(paren
id|next_states
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|de-&gt;media_type
op_eq
id|DE_MEDIA_BNC
)paren
(brace
id|u32
id|next_states
(braket
)braket
op_assign
(brace
id|DE_MEDIA_TP_AUTO
comma
id|DE_MEDIA_AUI
)brace
suffix:semicolon
id|de_next_media
c_func
(paren
id|de
comma
id|next_states
comma
id|ARRAY_SIZE
c_func
(paren
id|next_states
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|u32
id|next_states
(braket
)braket
op_assign
(brace
id|DE_MEDIA_AUI
comma
id|DE_MEDIA_BNC
comma
id|DE_MEDIA_TP_AUTO
)brace
suffix:semicolon
id|de_next_media
c_func
(paren
id|de
comma
id|next_states
comma
id|ARRAY_SIZE
c_func
(paren
id|next_states
)paren
)paren
suffix:semicolon
)brace
id|set_media
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_stop_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_set_media
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_start_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|no_link_yet
suffix:colon
id|de-&gt;media_timer.expires
op_assign
id|jiffies
op_plus
id|DE_TIMER_NO_LINK
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_timer
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: no link, trying media %s, status %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|de_media_interrupt
r_static
r_void
id|de_media_interrupt
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u32
id|status
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|LinkPass
)paren
(brace
id|de_link_up
c_func
(paren
id|de
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
comma
id|jiffies
op_plus
id|DE_TIMER_LINK
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|LinkFail
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|de-&gt;dev
)paren
)paren
(brace
id|de_link_down
c_func
(paren
id|de
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
comma
id|jiffies
op_plus
id|DE_TIMER_NO_LINK
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_reset_mac
r_static
r_int
id|de_reset_mac
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|status
comma
id|tmp
suffix:semicolon
multiline_comment|/*&n;&t; * Reset MAC.  Copied from de4x5.c.&n;&t; */
id|tmp
op_assign
id|dr32
(paren
id|BusMode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0xffffffff
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
id|dw32
(paren
id|BusMode
comma
id|tmp
op_or
id|CmdReset
)paren
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
id|dw32
(paren
id|BusMode
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|5
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|dr32
(paren
id|BusMode
)paren
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
id|status
op_assign
id|dr32
c_func
(paren
id|MacStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxState
op_or
id|TxState
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffffffff
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_adapter_wake
r_static
r_void
id|de_adapter_wake
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|pmctl
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
)paren
r_return
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|de-&gt;pdev
comma
id|PCIPM
comma
op_amp
id|pmctl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmctl
op_amp
id|PM_Mask
)paren
(brace
id|pmctl
op_and_assign
op_complement
id|PM_Mask
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|de-&gt;pdev
comma
id|PCIPM
comma
id|pmctl
)paren
suffix:semicolon
multiline_comment|/* de4x5.c delays, so we do too */
id|current-&gt;state
op_assign
id|TASK_UNINTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|msec_to_jiffies
c_func
(paren
l_int|10
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|de_adapter_sleep
r_static
r_void
id|de_adapter_sleep
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|u32
id|pmctl
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
)paren
r_return
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|de-&gt;pdev
comma
id|PCIPM
comma
op_amp
id|pmctl
)paren
suffix:semicolon
id|pmctl
op_or_assign
id|PM_Sleep
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|de-&gt;pdev
comma
id|PCIPM
comma
id|pmctl
)paren
suffix:semicolon
)brace
DECL|function|de_init_hw
r_static
r_int
id|de_init_hw
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|de-&gt;dev
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|de_adapter_wake
c_func
(paren
id|de
)paren
suffix:semicolon
id|de-&gt;macmode
op_assign
id|dr32
c_func
(paren
id|MacMode
)paren
op_amp
op_complement
id|MacModeClear
suffix:semicolon
id|rc
op_assign
id|de_reset_mac
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|de_set_media
c_func
(paren
id|de
)paren
suffix:semicolon
multiline_comment|/* reset phy */
id|dw32
c_func
(paren
id|RxRingAddr
comma
id|de-&gt;ring_dma
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|TxRingAddr
comma
id|de-&gt;ring_dma
op_plus
(paren
r_sizeof
(paren
r_struct
id|de_desc
)paren
op_star
id|DE_RX_RING_SIZE
)paren
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|MacMode
comma
id|RxTx
op_or
id|de-&gt;macmode
)paren
suffix:semicolon
id|dr32
c_func
(paren
id|RxMissed
)paren
suffix:semicolon
multiline_comment|/* self-clearing */
id|dw32
c_func
(paren
id|IntrMask
comma
id|de_intr_mask
)paren
suffix:semicolon
id|de_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_refill_rx
r_static
r_int
id|de_refill_rx
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|de-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|err_out
suffix:semicolon
id|skb-&gt;dev
op_assign
id|de-&gt;dev
suffix:semicolon
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|de-&gt;pdev
comma
id|skb-&gt;tail
comma
id|de-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|de-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
(paren
id|DE_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|de-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
op_or
id|de-&gt;rx_buf_sz
)paren
suffix:semicolon
r_else
id|de-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|de-&gt;rx_buf_sz
)paren
suffix:semicolon
id|de-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr1
op_assign
id|cpu_to_le32
c_func
(paren
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
)paren
suffix:semicolon
id|de-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr2
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|de_clean_rings
c_func
(paren
id|de
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|de_init_rings
r_static
r_int
id|de_init_rings
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|memset
c_func
(paren
id|de-&gt;tx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|de_desc
)paren
op_star
id|DE_TX_RING_SIZE
)paren
suffix:semicolon
id|de-&gt;tx_ring
(braket
id|DE_TX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
)paren
suffix:semicolon
id|de-&gt;rx_tail
op_assign
l_int|0
suffix:semicolon
id|de-&gt;tx_head
op_assign
id|de-&gt;tx_tail
op_assign
l_int|0
suffix:semicolon
r_return
id|de_refill_rx
(paren
id|de
)paren
suffix:semicolon
)brace
DECL|function|de_alloc_rings
r_static
r_int
id|de_alloc_rings
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|de-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|de-&gt;pdev
comma
id|DE_RING_BYTES
comma
op_amp
id|de-&gt;ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|de-&gt;rx_ring
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|de-&gt;tx_ring
op_assign
op_amp
id|de-&gt;rx_ring
(braket
id|DE_RX_RING_SIZE
)braket
suffix:semicolon
r_return
id|de_init_rings
c_func
(paren
id|de
)paren
suffix:semicolon
)brace
DECL|function|de_clean_rings
r_static
r_void
id|de_clean_rings
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|de-&gt;rx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|de_desc
)paren
op_star
id|DE_RX_RING_SIZE
)paren
suffix:semicolon
id|de-&gt;rx_ring
(braket
id|DE_RX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|de-&gt;tx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|de_desc
)paren
op_star
id|DE_TX_RING_SIZE
)paren
suffix:semicolon
id|de-&gt;tx_ring
(braket
id|DE_TX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|opts2
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
comma
id|de-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|de-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|de-&gt;tx_skb
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
)paren
op_logical_and
(paren
id|skb
op_ne
id|DE_DUMMY_SKB
)paren
)paren
(brace
r_if
c_cond
(paren
id|skb
op_ne
id|DE_SETUP_SKB
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|de-&gt;net_stats.tx_dropped
op_increment
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|de-&gt;tx_skb
(braket
id|i
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
)brace
r_else
(brace
id|pci_unmap_single
c_func
(paren
id|de-&gt;pdev
comma
id|de-&gt;tx_skb
(braket
id|i
)braket
dot
id|mapping
comma
r_sizeof
(paren
id|de-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
)brace
)brace
)brace
id|memset
c_func
(paren
op_amp
id|de-&gt;rx_skb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
id|DE_RX_RING_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|de-&gt;tx_skb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
id|DE_TX_RING_SIZE
)paren
suffix:semicolon
)brace
DECL|function|de_free_rings
r_static
r_void
id|de_free_rings
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
id|de_clean_rings
c_func
(paren
id|de
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|de-&gt;pdev
comma
id|DE_RING_BYTES
comma
id|de-&gt;rx_ring
comma
id|de-&gt;ring_dma
)paren
suffix:semicolon
id|de-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
id|de-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|de_open
r_static
r_int
id|de_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_ifup
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: enabling interface&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|de-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PKT_BUF_SZ
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
id|rc
op_assign
id|de_alloc_rings
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: ring allocation failure, err=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|de_init_hw
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: h/w init failure, err=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_goto
id|err_out_free
suffix:semicolon
)brace
id|rc
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|de_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: IRQ %d request failure, err=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
comma
id|rc
)paren
suffix:semicolon
r_goto
id|err_out_hw
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
comma
id|jiffies
op_plus
id|DE_TIMER_NO_LINK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_hw
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_stop_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|de_free_rings
c_func
(paren
id|de
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|de_close
r_static
r_int
id|de_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_ifdown
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: disabling interface&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|de_stop_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|de-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|de_free_rings
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_adapter_sleep
c_func
(paren
id|de
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|de-&gt;pdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_tx_timeout
r_static
r_void
id|de_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: NIC status %08x mode %08x sia %08x desc %u/%u/%u&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dr32
c_func
(paren
id|MacStatus
)paren
comma
id|dr32
c_func
(paren
id|MacMode
)paren
comma
id|dr32
c_func
(paren
id|SIAStatus
)paren
comma
id|de-&gt;rx_tail
comma
id|de-&gt;tx_head
comma
id|de-&gt;tx_tail
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|de_stop_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|__de_get_stats
c_func
(paren
id|de
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|de_clean_rings
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_init_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|de_get_regs
r_static
r_int
id|de_get_regs
c_func
(paren
r_struct
id|de_private
op_star
id|de
comma
id|u8
op_star
id|buf
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
op_star
id|rbuf
op_assign
(paren
id|u32
op_star
)paren
id|buf
suffix:semicolon
multiline_comment|/* read all CSRs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_NUM_REGS
suffix:semicolon
id|i
op_increment
)paren
id|rbuf
(braket
id|i
)braket
op_assign
id|dr32
c_func
(paren
id|i
op_star
l_int|8
)paren
suffix:semicolon
multiline_comment|/* handle self-clearing RxMissed counter, CSR8 */
id|de_rx_missed
c_func
(paren
id|de
comma
id|rbuf
(braket
l_int|8
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_ethtool_gset
r_static
r_int
id|de_ethtool_gset
c_func
(paren
r_struct
id|de_private
op_star
id|de
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
id|ecmd-&gt;supported
op_assign
id|de-&gt;media_supported
suffix:semicolon
id|ecmd-&gt;transceiver
op_assign
id|XCVR_INTERNAL
suffix:semicolon
id|ecmd-&gt;phy_address
op_assign
l_int|0
suffix:semicolon
id|ecmd-&gt;advertising
op_assign
id|de-&gt;media_advertise
suffix:semicolon
r_switch
c_cond
(paren
id|de-&gt;media_type
)paren
(brace
r_case
id|DE_MEDIA_AUI
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_AUI
suffix:semicolon
id|ecmd-&gt;speed
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DE_MEDIA_BNC
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_BNC
suffix:semicolon
id|ecmd-&gt;speed
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ecmd-&gt;port
op_assign
id|PORT_TP
suffix:semicolon
id|ecmd-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|de-&gt;macmode
op_amp
id|FullDuplex
)paren
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_else
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media_lock
)paren
id|ecmd-&gt;autoneg
op_assign
id|AUTONEG_DISABLE
suffix:semicolon
r_else
id|ecmd-&gt;autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
multiline_comment|/* ignore maxtxpkt, maxrxpkt for now */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_ethtool_sset
r_static
r_int
id|de_ethtool_sset
c_func
(paren
r_struct
id|de_private
op_star
id|de
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
id|u32
id|new_media
suffix:semicolon
r_int
r_int
id|media_lock
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_ne
id|SPEED_10
op_logical_and
id|ecmd-&gt;speed
op_ne
l_int|5
op_logical_and
id|ecmd-&gt;speed
op_ne
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
op_logical_and
id|ecmd-&gt;speed
op_eq
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_HALF
op_logical_and
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_FULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;port
op_ne
id|PORT_TP
op_logical_and
id|ecmd-&gt;port
op_ne
id|PORT_AUI
op_logical_and
id|ecmd-&gt;port
op_ne
id|PORT_BNC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
op_logical_and
id|ecmd-&gt;port
op_eq
id|PORT_BNC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;transceiver
op_ne
id|XCVR_INTERNAL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_ne
id|AUTONEG_DISABLE
op_logical_and
id|ecmd-&gt;autoneg
op_ne
id|AUTONEG_ENABLE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
op_complement
id|de-&gt;media_supported
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
op_logical_and
(paren
op_logical_neg
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_Autoneg
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|ecmd-&gt;port
)paren
(brace
r_case
id|PORT_AUI
suffix:colon
id|new_media
op_assign
id|DE_MEDIA_AUI
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_AUI
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PORT_BNC
suffix:colon
id|new_media
op_assign
id|DE_MEDIA_BNC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_BNC
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
)paren
id|new_media
op_assign
id|DE_MEDIA_TP_AUTO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_FULL
)paren
id|new_media
op_assign
id|DE_MEDIA_TP_FD
suffix:semicolon
r_else
id|new_media
op_assign
id|DE_MEDIA_TP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_TP
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ecmd-&gt;advertising
op_amp
(paren
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_10baseT_Half
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|media_lock
op_assign
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_media
op_eq
id|de-&gt;media_type
)paren
op_logical_and
(paren
id|media_lock
op_eq
id|de-&gt;media_lock
)paren
op_logical_and
(paren
id|ecmd-&gt;advertising
op_eq
id|de-&gt;media_advertise
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing to change */
id|de_link_down
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_stop_rxtx
c_func
(paren
id|de
)paren
suffix:semicolon
id|de-&gt;media_type
op_assign
id|new_media
suffix:semicolon
id|de-&gt;media_lock
op_assign
id|media_lock
suffix:semicolon
id|de-&gt;media_advertise
op_assign
id|ecmd-&gt;advertising
suffix:semicolon
id|de_set_media
c_func
(paren
id|de
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_ethtool_ioctl
r_static
r_int
id|de_ethtool_ioctl
(paren
r_struct
id|de_private
op_star
id|de
comma
r_void
op_star
id|useraddr
)paren
(brace
id|u32
id|ethcmd
suffix:semicolon
multiline_comment|/* dev_ioctl() in ../../net/core/dev.c has already checked&n;&t;   capable(CAP_NET_ADMIN), so don&squot;t bother with that here.  */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|ethcmd
comma
(paren
id|u32
op_star
)paren
id|useraddr
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
(paren
id|info.driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info.version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|strcpy
(paren
id|info.bus_info
comma
id|de-&gt;pdev-&gt;slot_name
)paren
suffix:semicolon
id|info.eedump_len
op_assign
id|DE_EEPROM_SIZE
suffix:semicolon
id|info.regdump_len
op_assign
id|DE_REGS_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get settings */
r_case
id|ETHTOOL_GSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|ecmd
op_assign
(brace
id|ETHTOOL_GSET
)brace
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|de_ethtool_gset
c_func
(paren
id|de
comma
op_amp
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ecmd
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set settings */
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|ecmd
suffix:semicolon
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ecmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|r
op_assign
id|de_ethtool_sset
c_func
(paren
id|de
comma
op_amp
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* restart autonegotiation */
r_case
id|ETHTOOL_NWAY_RST
suffix:colon
(brace
id|u32
id|status
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media_type
op_ne
id|DE_MEDIA_TP_AUTO
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|de-&gt;dev
)paren
)paren
id|de_link_down
c_func
(paren
id|de
)paren
suffix:semicolon
id|status
op_assign
id|dr32
c_func
(paren
id|SIAStatus
)paren
suffix:semicolon
id|dw32
c_func
(paren
id|SIAStatus
comma
(paren
id|status
op_amp
op_complement
id|NWayState
)paren
op_or
id|NWayRestart
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_link
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link nway restart, status %x,%x&bslash;n&quot;
comma
id|de-&gt;dev-&gt;name
comma
id|status
comma
id|dr32
c_func
(paren
id|SIAStatus
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get link status */
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|edata.data
op_assign
(paren
id|netif_carrier_ok
c_func
(paren
id|de-&gt;dev
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get message-level */
r_case
id|ETHTOOL_GMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GMSGLVL
)brace
suffix:semicolon
id|edata.data
op_assign
id|de-&gt;msg_enable
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set message-level */
r_case
id|ETHTOOL_SMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|de-&gt;msg_enable
op_assign
id|edata.data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get registers */
r_case
id|ETHTOOL_GREGS
suffix:colon
(brace
r_struct
id|ethtool_regs
id|regs
suffix:semicolon
id|u8
id|regbuf
(braket
id|DE_REGS_SIZE
)braket
suffix:semicolon
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|regs
comma
id|useraddr
comma
r_sizeof
(paren
id|regs
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|regs.len
OG
id|DE_REGS_SIZE
)paren
(brace
id|regs.len
op_assign
id|DE_REGS_SIZE
suffix:semicolon
)brace
id|regs.version
op_assign
(paren
id|DE_REGS_VER
op_lshift
l_int|2
)paren
op_or
id|de-&gt;de21040
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|useraddr
op_add_assign
m_offsetof
(paren
r_struct
id|ethtool_regs
comma
id|data
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|r
op_assign
id|de_get_regs
c_func
(paren
id|de
comma
id|regbuf
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
)paren
r_return
id|r
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
id|regbuf
comma
id|regs.len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get SROM dump */
r_case
id|ETHTOOL_GEEPROM
suffix:colon
(brace
r_struct
id|ethtool_eeprom
id|eeprom
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|de-&gt;ee_data
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|eeprom
comma
id|useraddr
comma
r_sizeof
(paren
id|eeprom
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|eeprom.offset
op_ne
l_int|0
)paren
op_logical_or
(paren
id|eeprom.magic
op_ne
l_int|0
)paren
op_logical_or
(paren
id|eeprom.len
op_ne
id|DE_EEPROM_SIZE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|useraddr
op_add_assign
m_offsetof
(paren
r_struct
id|ethtool_regs
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
id|de-&gt;ee_data
comma
id|DE_EEPROM_SIZE
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|de_ioctl
r_static
r_int
id|de_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|de_ethtool_ioctl
c_func
(paren
id|de
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|de21040_get_mac_address
r_static
r_void
id|__init
id|de21040_get_mac_address
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|i
suffix:semicolon
id|dw32
(paren
id|ROMCmd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Reset the pointer with a dummy write. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|value
comma
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
r_do
id|value
op_assign
id|dr32
c_func
(paren
id|ROMCmd
)paren
suffix:semicolon
r_while
c_loop
(paren
id|value
template_param
l_int|0
)paren
suffix:semicolon
id|de-&gt;dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|boguscnt
op_le
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;timeout reading 21040 MAC address byte %u&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
)brace
)brace
DECL|function|de21040_get_media_info
r_static
r_void
id|__init
id|de21040_get_media_info
c_func
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|de-&gt;media_type
op_assign
id|DE_MEDIA_TP
suffix:semicolon
id|de-&gt;media_supported
op_or_assign
id|SUPPORTED_TP
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_AUI
suffix:semicolon
id|de-&gt;media_advertise
op_assign
id|de-&gt;media_supported
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_MAX_MEDIA
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
id|DE_MEDIA_AUI
suffix:colon
r_case
id|DE_MEDIA_TP
suffix:colon
r_case
id|DE_MEDIA_TP_FD
suffix:colon
id|de-&gt;media
(braket
id|i
)braket
dot
id|type
op_assign
id|i
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr13
op_assign
id|t21040_csr13
(braket
id|i
)braket
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr14
op_assign
id|t21040_csr14
(braket
id|i
)braket
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr15
op_assign
id|t21040_csr15
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|de-&gt;media
(braket
id|i
)braket
dot
id|type
op_assign
id|DE_MEDIA_INVALID
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Note: this routine returns extra data bits for size detection. */
DECL|function|tulip_read_eeprom
r_static
r_int
id|__init
id|tulip_read_eeprom
c_func
(paren
r_void
op_star
id|regs
comma
r_int
id|location
comma
r_int
id|addr_len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_void
op_star
id|ee_addr
op_assign
id|regs
op_plus
id|ROMCmd
suffix:semicolon
r_int
id|read_cmd
op_assign
id|location
op_or
(paren
id|EE_READ_CMD
op_lshift
id|addr_len
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|4
op_plus
id|addr_len
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_DATA_WRITE
suffix:colon
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|EE_ENB
op_or
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|readl
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EE_ENB
op_or
id|dataval
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|readl
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|readl
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writel
c_func
(paren
id|EE_ENB
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|readl
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|readl
c_func
(paren
id|ee_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|writel
c_func
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|de21041_get_srom_info
r_static
r_void
id|__init
id|de21041_get_srom_info
(paren
r_struct
id|de_private
op_star
id|de
)paren
(brace
r_int
id|i
comma
id|sa_offset
op_assign
l_int|0
comma
id|ofs
suffix:semicolon
id|u8
id|ee_data
(braket
id|DE_EEPROM_SIZE
op_plus
l_int|6
)braket
op_assign
(brace
)brace
suffix:semicolon
r_int
id|ee_addr_size
op_assign
id|tulip_read_eeprom
c_func
(paren
id|de-&gt;regs
comma
l_int|0xff
comma
l_int|8
)paren
op_amp
l_int|0x40000
ques
c_cond
l_int|8
suffix:colon
l_int|6
suffix:semicolon
r_struct
id|de_srom_info_leaf
op_star
id|il
suffix:semicolon
r_void
op_star
id|bufp
suffix:semicolon
multiline_comment|/* download entire eeprom */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_EEPROM_WORDS
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|ee_data
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
c_func
(paren
id|tulip_read_eeprom
c_func
(paren
id|de-&gt;regs
comma
id|i
comma
id|ee_addr_size
)paren
)paren
suffix:semicolon
multiline_comment|/* DEC now has a specification but early board makers&n;&t;   just put the address in the first EEPROM locations. */
multiline_comment|/* This does  memcmp(eedata, eedata+16, 8) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ee_data
(braket
id|i
)braket
op_ne
id|ee_data
(braket
l_int|16
op_plus
id|i
)braket
)paren
id|sa_offset
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* store MAC address */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|de-&gt;dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|ee_data
(braket
id|i
op_plus
id|sa_offset
)braket
suffix:semicolon
multiline_comment|/* get offset of controller 0 info leaf.  ignore 2nd byte. */
id|ofs
op_assign
id|ee_data
(braket
id|SROMC0InfoLeaf
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ofs
op_ge
(paren
r_sizeof
(paren
id|ee_data
)paren
op_minus
r_sizeof
(paren
r_struct
id|de_srom_info_leaf
)paren
op_minus
r_sizeof
(paren
r_struct
id|de_srom_media_block
)paren
)paren
)paren
r_goto
id|bad_srom
suffix:semicolon
multiline_comment|/* get pointer to info leaf */
id|il
op_assign
(paren
r_struct
id|de_srom_info_leaf
op_star
)paren
op_amp
id|ee_data
(braket
id|ofs
)braket
suffix:semicolon
multiline_comment|/* paranoia checks */
r_if
c_cond
(paren
id|il-&gt;n_blocks
op_eq
l_int|0
)paren
r_goto
id|bad_srom
suffix:semicolon
r_if
c_cond
(paren
(paren
r_sizeof
(paren
id|ee_data
)paren
op_minus
id|ofs
)paren
OL
(paren
r_sizeof
(paren
r_struct
id|de_srom_info_leaf
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|de_srom_media_block
)paren
op_star
id|il-&gt;n_blocks
)paren
)paren
)paren
r_goto
id|bad_srom
suffix:semicolon
multiline_comment|/* get default media type */
r_switch
c_cond
(paren
id|DE_UNALIGNED_16
c_func
(paren
op_amp
id|il-&gt;default_media
)paren
)paren
(brace
r_case
l_int|0x0001
suffix:colon
id|de-&gt;media_type
op_assign
id|DE_MEDIA_BNC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0002
suffix:colon
id|de-&gt;media_type
op_assign
id|DE_MEDIA_AUI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0204
suffix:colon
id|de-&gt;media_type
op_assign
id|DE_MEDIA_TP_FD
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|de-&gt;media_type
op_assign
id|DE_MEDIA_TP_AUTO
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_msg_probe
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;de%d: SROM leaf offset %u, default media %s&bslash;n&quot;
comma
id|de-&gt;board_idx
comma
id|ofs
comma
id|media_name
(braket
id|de-&gt;media_type
)braket
)paren
suffix:semicolon
multiline_comment|/* init SIA register values to defaults */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_MAX_MEDIA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|de-&gt;media
(braket
id|i
)braket
dot
id|type
op_assign
id|DE_MEDIA_INVALID
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr13
op_assign
l_int|0xffff
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr14
op_assign
l_int|0xffff
suffix:semicolon
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr15
op_assign
l_int|0xffff
suffix:semicolon
)brace
multiline_comment|/* parse media blocks to see what medias are supported,&n;&t; * and if any custom CSR values are provided&n;&t; */
id|bufp
op_assign
(paren
(paren
r_void
op_star
)paren
id|il
)paren
op_plus
r_sizeof
(paren
op_star
id|il
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|il-&gt;n_blocks
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|de_srom_media_block
op_star
id|ib
op_assign
id|bufp
suffix:semicolon
r_int
id|idx
suffix:semicolon
multiline_comment|/* index based on media type in media block */
r_switch
c_cond
(paren
id|ib-&gt;opts
op_amp
id|MediaBlockMask
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* 10baseT */
id|de-&gt;media_supported
op_or_assign
id|SUPPORTED_TP
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_Autoneg
suffix:semicolon
id|idx
op_assign
id|DE_MEDIA_TP
suffix:semicolon
id|de-&gt;media
(braket
id|DE_MEDIA_TP_AUTO
)braket
dot
id|type
op_assign
id|DE_MEDIA_TP_AUTO
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* BNC */
id|de-&gt;media_supported
op_or_assign
id|SUPPORTED_BNC
suffix:semicolon
id|idx
op_assign
id|DE_MEDIA_BNC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* AUI */
id|de-&gt;media_supported
op_or_assign
id|SUPPORTED_AUI
suffix:semicolon
id|idx
op_assign
id|DE_MEDIA_AUI
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* 10baseT-FD */
id|de-&gt;media_supported
op_or_assign
id|SUPPORTED_TP
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_Autoneg
suffix:semicolon
id|idx
op_assign
id|DE_MEDIA_TP_FD
suffix:semicolon
id|de-&gt;media
(braket
id|DE_MEDIA_TP_AUTO
)braket
dot
id|type
op_assign
id|DE_MEDIA_TP_AUTO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|bad_srom
suffix:semicolon
)brace
id|de-&gt;media
(braket
id|idx
)braket
dot
id|type
op_assign
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_probe
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;de%d:   media block #%u: %s&quot;
comma
id|de-&gt;board_idx
comma
id|i
comma
id|media_name
(braket
id|de-&gt;media
(braket
id|idx
)braket
dot
id|type
)braket
)paren
suffix:semicolon
id|bufp
op_add_assign
r_sizeof
(paren
id|ib-&gt;opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ib-&gt;opts
op_amp
id|MediaCustomCSRs
)paren
(brace
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr13
op_assign
id|DE_UNALIGNED_16
c_func
(paren
op_amp
id|ib-&gt;csr13
)paren
suffix:semicolon
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr14
op_assign
id|DE_UNALIGNED_16
c_func
(paren
op_amp
id|ib-&gt;csr14
)paren
suffix:semicolon
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr15
op_assign
id|DE_UNALIGNED_16
c_func
(paren
op_amp
id|ib-&gt;csr15
)paren
suffix:semicolon
id|bufp
op_add_assign
r_sizeof
(paren
id|ib-&gt;csr13
)paren
op_plus
r_sizeof
(paren
id|ib-&gt;csr14
)paren
op_plus
r_sizeof
(paren
id|ib-&gt;csr15
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_probe
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; (%x,%x,%x)&bslash;n&quot;
comma
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr13
comma
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr14
comma
id|de-&gt;media
(braket
id|idx
)braket
dot
id|csr15
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|netif_msg_probe
c_func
(paren
id|de
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bufp
OG
(paren
(paren
r_void
op_star
)paren
op_amp
id|ee_data
(braket
id|DE_EEPROM_SIZE
op_minus
l_int|3
)braket
)paren
)paren
r_break
suffix:semicolon
)brace
id|de-&gt;media_advertise
op_assign
id|de-&gt;media_supported
suffix:semicolon
id|fill_defaults
suffix:colon
multiline_comment|/* fill in defaults, for cases where custom CSRs not used */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_MAX_MEDIA
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr13
op_eq
l_int|0xffff
)paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr13
op_assign
id|t21041_csr13
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr14
op_eq
l_int|0xffff
)paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr14
op_assign
id|t21041_csr14
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr15
op_eq
l_int|0xffff
)paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|csr15
op_assign
id|t21041_csr15
(braket
id|i
)braket
suffix:semicolon
)brace
id|de-&gt;ee_data
op_assign
id|kmalloc
c_func
(paren
id|DE_EEPROM_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;ee_data
)paren
id|memcpy
c_func
(paren
id|de-&gt;ee_data
comma
op_amp
id|ee_data
(braket
l_int|0
)braket
comma
id|DE_EEPROM_SIZE
)paren
suffix:semicolon
r_return
suffix:semicolon
id|bad_srom
suffix:colon
multiline_comment|/* for error cases, it&squot;s ok to assume we support all these */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DE_MAX_MEDIA
suffix:semicolon
id|i
op_increment
)paren
id|de-&gt;media
(braket
id|i
)braket
dot
id|type
op_assign
id|i
suffix:semicolon
id|de-&gt;media_supported
op_assign
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_Autoneg
op_or
id|SUPPORTED_TP
op_or
id|SUPPORTED_AUI
op_or
id|SUPPORTED_BNC
suffix:semicolon
r_goto
id|fill_defaults
suffix:semicolon
)brace
DECL|function|de_init_one
r_static
r_int
id|__init
id|de_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|de_private
op_star
id|de
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_void
op_star
id|regs
suffix:semicolon
r_int
id|pciaddr
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
id|board_idx
op_increment
suffix:semicolon
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|board_idx
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* allocate a new ethernet device structure, and fill in defaults */
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|de_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|de_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|de_close
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|de_set_rx_mode
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|de_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|de_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|de_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|de_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|de-&gt;de21040
op_assign
id|ent-&gt;driver_data
op_eq
l_int|0
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|de-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|de-&gt;dev
op_assign
id|dev
suffix:semicolon
id|de-&gt;msg_enable
op_assign
(paren
id|debug
OL
l_int|0
ques
c_cond
id|DE_DEF_MSG_ENABLE
suffix:colon
id|debug
)paren
suffix:semicolon
id|de-&gt;board_idx
op_assign
id|board_idx
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;de21040
)paren
id|de-&gt;media_timer.function
op_assign
id|de21040_media_timer
suffix:semicolon
r_else
id|de-&gt;media_timer.function
op_assign
id|de21041_media_timer
suffix:semicolon
id|de-&gt;media_timer.data
op_assign
(paren
r_int
r_int
)paren
id|de
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* wake up device, assign resources */
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_free
suffix:semicolon
multiline_comment|/* reserve PCI resources to ensure driver atomicity */
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_disable
suffix:semicolon
multiline_comment|/* check for invalid IRQ value */
r_if
c_cond
(paren
id|pdev-&gt;irq
OL
l_int|2
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;invalid irq (%d) for pci dev %s&bslash;n&quot;
comma
id|pdev-&gt;irq
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
multiline_comment|/* obtain and check validity of PCI I/O address */
id|pciaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pciaddr
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;no MMIO resource for pci dev %s&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
OL
id|DE_REGS_SIZE
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;MMIO resource (%lx) too small on pci dev %s&bslash;n&quot;
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
multiline_comment|/* remap CSR registers */
id|regs
op_assign
id|ioremap_nocache
c_func
(paren
id|pciaddr
comma
id|DE_REGS_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|regs
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot map PCI MMIO (%lx@%lx) on pci dev %s&bslash;n&quot;
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pciaddr
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|regs
suffix:semicolon
id|de-&gt;regs
op_assign
id|regs
suffix:semicolon
id|de_adapter_wake
c_func
(paren
id|de
)paren
suffix:semicolon
multiline_comment|/* make sure hardware is not running */
id|rc
op_assign
id|de_reset_mac
c_func
(paren
id|de
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot reset MAC, pci dev %s&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_iomap
suffix:semicolon
)brace
multiline_comment|/* get MAC address, initialize default media type and&n;&t; * get list of supported media&n;&t; */
r_if
c_cond
(paren
id|de-&gt;de21040
)paren
(brace
id|de21040_get_mac_address
c_func
(paren
id|de
)paren
suffix:semicolon
id|de21040_get_media_info
c_func
(paren
id|de
)paren
suffix:semicolon
)brace
r_else
(brace
id|de21041_get_srom_info
c_func
(paren
id|de
)paren
suffix:semicolon
)brace
multiline_comment|/* register new network interface with kernel */
id|rc
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_iomap
suffix:semicolon
multiline_comment|/* print info about board and interface just registered */
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x, &quot;
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|de-&gt;de21040
ques
c_cond
l_string|&quot;21040&quot;
suffix:colon
l_string|&quot;21041&quot;
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* enable busmastering */
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* put adapter to sleep */
id|de_adapter_sleep
c_func
(paren
id|de
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_iomap
suffix:colon
r_if
c_cond
(paren
id|de-&gt;ee_data
)paren
id|kfree
c_func
(paren
id|de-&gt;ee_data
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|regs
)paren
suffix:semicolon
id|err_out_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|de_remove_one
r_static
r_void
id|__exit
id|de_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|de-&gt;ee_data
)paren
id|kfree
c_func
(paren
id|de-&gt;ee_data
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|de-&gt;regs
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|de_suspend
r_static
r_int
id|de_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
(paren
id|dev
)paren
)paren
(brace
id|del_timer_sync
c_func
(paren
op_amp
id|de-&gt;media_timer
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|de_stop_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|de-&gt;lock
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|__de_get_stats
c_func
(paren
id|de
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|de_clean_rings
c_func
(paren
id|de
)paren
suffix:semicolon
id|de_adapter_sleep
c_func
(paren
id|de
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_else
(brace
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|de_resume
r_static
r_int
id|de_resume
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|de_private
op_star
id|de
op_assign
id|dev-&gt;priv
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|de_init_hw
c_func
(paren
id|de
)paren
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|variable|de_driver
r_static
r_struct
id|pci_driver
id|de_driver
op_assign
(brace
id|name
suffix:colon
id|DRV_NAME
comma
id|id_table
suffix:colon
id|de_pci_tbl
comma
id|probe
suffix:colon
id|de_init_one
comma
id|remove
suffix:colon
id|de_remove_one
comma
macro_line|#ifdef CONFIG_PM
id|suspend
suffix:colon
id|de_suspend
comma
id|resume
suffix:colon
id|de_resume
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|function|de_init
r_static
r_int
id|__init
id|de_init
(paren
r_void
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
(paren
op_amp
id|de_driver
)paren
suffix:semicolon
)brace
DECL|function|de_exit
r_static
r_void
id|__exit
id|de_exit
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|de_driver
)paren
suffix:semicolon
)brace
DECL|variable|de_init
id|module_init
c_func
(paren
id|de_init
)paren
suffix:semicolon
DECL|variable|de_exit
id|module_exit
c_func
(paren
id|de_exit
)paren
suffix:semicolon
eof
