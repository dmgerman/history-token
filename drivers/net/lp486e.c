multiline_comment|/* Intel Professional Workstation/panther ethernet driver */
multiline_comment|/* lp486e.c: A panther 82596 ethernet driver for linux. */
multiline_comment|/*&n;    History and copyrights:&n;&n;    Driver skeleton&n;        Written 1993 by Donald Becker.&n;        Copyright 1993 United States Government as represented by the Director,&n;        National Security Agency.  This software may only be used and&n;&t;distributed according to the terms of the GNU Public License&n;&t;as modified by SRC, incorporated herein by reference.&n;&n;        The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;    Apricot&n;        Written 1994 by Mark Evans.&n;        This driver is for the Apricot 82596 bus-master interface&n;&n;        Modularised 12/94 Mark Evans&n;&n;    Professional Workstation&n;&t;Derived from apricot.c by Ard van Breemen&n;&t;&lt;ard@murphy.nl&gt;|&lt;ard@cstmel.hobby.nl&gt;|&lt;ard@cstmel.nl.eu.org&gt;&n;&n;&t;Credits:&n;&t;Thanks to Murphy Software BV for letting me write this in their time.&n;&t;Well, actually, I get payed doing this...&n;&t;(Also: see http://www.murphy.nl for murphy, and my homepage ~ard for&n;&t;more information on the Professional Workstation)&n;&n;    Present version&n;&t;aeb@cwi.nl&n;*/
multiline_comment|/*&n;    There are currently two motherboards that I know of in the&n;    professional workstation. The only one that I know is the&n;    intel panther motherboard. -- ard&n;*/
multiline_comment|/*&n;The pws is equipped with an intel 82596. This is a very intelligent controller&n;which runs its own micro-code. Communication with the hostprocessor is done&n;through linked lists of commands and buffers in the hostprocessors memory.&n;A complete description of the 82596 is available from intel. Search for&n;a file called &quot;29021806.pdf&quot;. It is a complete description of the chip itself.&n;To use it for the pws some additions are needed regarding generation of&n;the PORT and CA signal, and the interrupt glue needed for a pc.&n;I/O map:&n;PORT  SIZE ACTION MEANING&n;0xCB0    2 WRITE  Lower 16 bits for PORT command&n;0xCB2    2 WRITE  Upper 16 bits for PORT command, and issue of PORT command&n;0xCB4    1 WRITE  Generation of CA signal&n;0xCB8    1 WRITE  Clear interrupt glue&n;All other communication is through memory!&n;*/
DECL|macro|SLOW_DOWN_IO
mdefine_line|#define SLOW_DOWN_IO udelay(5);
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
multiline_comment|/* debug print flags */
DECL|macro|LOG_SRCDST
mdefine_line|#define LOG_SRCDST    0x80000000
DECL|macro|LOG_STATINT
mdefine_line|#define LOG_STATINT   0x40000000
DECL|macro|LOG_STARTINT
mdefine_line|#define LOG_STARTINT  0x20000000
DECL|macro|i596_debug
mdefine_line|#define i596_debug debug
DECL|variable|i596_debug
r_static
r_int
id|i596_debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|medianame
r_static
r_const
r_char
op_star
r_const
id|medianame
(braket
)braket
op_assign
(brace
l_string|&quot;10baseT&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;10baseT-FD&quot;
comma
l_string|&quot;AUI-FD&quot;
comma
)brace
suffix:semicolon
DECL|macro|LP486E_TOTAL_SIZE
mdefine_line|#define LP486E_TOTAL_SIZE 16
DECL|macro|I596_NULL
mdefine_line|#define I596_NULL (0xffffffff)
DECL|macro|CMD_EOL
mdefine_line|#define CMD_EOL&t;&t;0x8000&t;/* The last command of the list, stop. */
DECL|macro|CMD_SUSP
mdefine_line|#define CMD_SUSP&t;0x4000&t;/* Suspend after doing cmd. */
DECL|macro|CMD_INTR
mdefine_line|#define CMD_INTR&t;0x2000&t;/* Interrupt after doing cmd. */
DECL|macro|CMD_FLEX
mdefine_line|#define CMD_FLEX&t;0x0008&t;/* Enable flexible memory model */
DECL|enum|commands
r_enum
id|commands
(brace
DECL|enumerator|CmdNOP
id|CmdNOP
op_assign
l_int|0
comma
DECL|enumerator|CmdIASetup
id|CmdIASetup
op_assign
l_int|1
comma
DECL|enumerator|CmdConfigure
id|CmdConfigure
op_assign
l_int|2
comma
DECL|enumerator|CmdMulticastList
id|CmdMulticastList
op_assign
l_int|3
comma
DECL|enumerator|CmdTx
id|CmdTx
op_assign
l_int|4
comma
DECL|enumerator|CmdTDR
id|CmdTDR
op_assign
l_int|5
comma
DECL|enumerator|CmdDump
id|CmdDump
op_assign
l_int|6
comma
DECL|enumerator|CmdDiagnose
id|CmdDiagnose
op_assign
l_int|7
)brace
suffix:semicolon
DECL|variable|CUcmdnames
r_char
op_star
id|CUcmdnames
(braket
l_int|8
)braket
op_assign
(brace
l_string|&quot;NOP&quot;
comma
l_string|&quot;IASetup&quot;
comma
l_string|&quot;Configure&quot;
comma
l_string|&quot;MulticastList&quot;
comma
l_string|&quot;Tx&quot;
comma
l_string|&quot;TDR&quot;
comma
l_string|&quot;Dump&quot;
comma
l_string|&quot;Diagnose&quot;
)brace
suffix:semicolon
multiline_comment|/* Status word bits */
DECL|macro|STAT_CX
mdefine_line|#define&t;STAT_CX&t;&t;0x8000&t;/* The CU finished executing a command&n;&t;&t;&t;&t;   with the Interrupt bit set */
DECL|macro|STAT_FR
mdefine_line|#define&t;STAT_FR&t;&t;0x4000&t;/* The RU finished receiving a frame */
DECL|macro|STAT_CNA
mdefine_line|#define&t;STAT_CNA&t;0x2000&t;/* The CU left the active state */
DECL|macro|STAT_RNR
mdefine_line|#define&t;STAT_RNR&t;0x1000&t;/* The RU left the active state */
DECL|macro|STAT_ACK
mdefine_line|#define STAT_ACK&t;(STAT_CX | STAT_FR | STAT_CNA | STAT_RNR)
DECL|macro|STAT_CUS
mdefine_line|#define&t;STAT_CUS&t;0x0700&t;/* Status of CU: 0: idle, 1: suspended,&n;&t;&t;&t;&t;   2: active, 3-7: unused */
DECL|macro|STAT_RUS
mdefine_line|#define STAT_RUS&t;0x00f0&t;/* Status of RU: 0: idle, 1: suspended,&n;&t;&t;&t;&t;   2: no resources, 4: ready,&n;&t;&t;&t;&t;   10: no resources due to no more RBDs,&n;&t;&t;&t;&t;   12: no more RBDs, other: unused */
DECL|macro|STAT_T
mdefine_line|#define&t;STAT_T&t;&t;0x0008&t;/* Bus throttle timers loaded */
DECL|macro|STAT_ZERO
mdefine_line|#define&t;STAT_ZERO&t;0x0807&t;/* Always zero */
macro_line|#if 0
r_static
r_char
op_star
id|CUstates
(braket
l_int|8
)braket
op_assign
(brace
l_string|&quot;idle&quot;
comma
l_string|&quot;suspended&quot;
comma
l_string|&quot;active&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_static
r_char
op_star
id|RUstates
(braket
l_int|16
)braket
op_assign
(brace
l_string|&quot;idle&quot;
comma
l_string|&quot;suspended&quot;
comma
l_string|&quot;no resources&quot;
comma
l_int|0
comma
l_string|&quot;ready&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;no RBDs&quot;
comma
l_int|0
comma
l_string|&quot;out of RBDs&quot;
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_static
r_void
id|i596_out_status
c_func
(paren
r_int
id|status
)paren
(brace
r_int
id|bad
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;status %4.4x:&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffff
)paren
id|printk
c_func
(paren
l_string|&quot; strange..&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|status
op_amp
id|STAT_CX
)paren
id|printk
c_func
(paren
l_string|&quot;  CU done&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_CNA
)paren
id|printk
c_func
(paren
l_string|&quot;  CU stopped&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_FR
)paren
id|printk
c_func
(paren
l_string|&quot;  got a frame&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_RNR
)paren
id|printk
c_func
(paren
l_string|&quot;  RU stopped&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_T
)paren
id|printk
c_func
(paren
l_string|&quot;  throttled&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_ZERO
)paren
id|bad
op_assign
l_int|1
suffix:semicolon
id|s
op_assign
id|CUstates
(braket
(paren
id|status
op_amp
id|STAT_CUS
)paren
op_rshift
l_int|8
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
id|bad
op_assign
l_int|1
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  CU(%s)&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
id|RUstates
(braket
(paren
id|status
op_amp
id|STAT_RUS
)paren
op_rshift
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
id|bad
op_assign
l_int|1
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;  RU(%s)&quot;
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bad
)paren
id|printk
c_func
(paren
l_string|&quot;  bad status&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Command word bits */
DECL|macro|ACK_CX
mdefine_line|#define ACK_CX&t;&t;0x8000
DECL|macro|ACK_FR
mdefine_line|#define ACK_FR&t;&t;0x4000
DECL|macro|ACK_CNA
mdefine_line|#define ACK_CNA&t;&t;0x2000
DECL|macro|ACK_RNR
mdefine_line|#define ACK_RNR&t;&t;0x1000
DECL|macro|CUC_START
mdefine_line|#define CUC_START&t;0x0100
DECL|macro|CUC_RESUME
mdefine_line|#define CUC_RESUME&t;0x0200
DECL|macro|CUC_SUSPEND
mdefine_line|#define CUC_SUSPEND&t;0x0300
DECL|macro|CUC_ABORT
mdefine_line|#define CUC_ABORT&t;0x0400
DECL|macro|RX_START
mdefine_line|#define RX_START&t;0x0010
DECL|macro|RX_RESUME
mdefine_line|#define RX_RESUME&t;0x0020
DECL|macro|RX_SUSPEND
mdefine_line|#define RX_SUSPEND&t;0x0030
DECL|macro|RX_ABORT
mdefine_line|#define RX_ABORT&t;0x0040
DECL|typedef|phys_addr
r_typedef
id|u32
id|phys_addr
suffix:semicolon
r_static
r_inline
id|phys_addr
DECL|function|va_to_pa
id|va_to_pa
c_func
(paren
r_volatile
r_void
op_star
id|x
)paren
(brace
r_return
id|x
ques
c_cond
id|virt_to_bus
c_func
(paren
id|x
)paren
suffix:colon
id|I596_NULL
suffix:semicolon
)brace
r_static
r_inline
r_void
op_star
DECL|function|pa_to_va
id|pa_to_va
c_func
(paren
id|phys_addr
id|x
)paren
(brace
r_return
(paren
id|x
op_eq
id|I596_NULL
)paren
ques
c_cond
l_int|NULL
suffix:colon
id|bus_to_virt
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
multiline_comment|/* status bits for cmd */
DECL|macro|CMD_STAT_C
mdefine_line|#define CMD_STAT_C&t;0x8000&t;/* CU command complete */
DECL|macro|CMD_STAT_B
mdefine_line|#define CMD_STAT_B&t;0x4000&t;/* CU command in progress */
DECL|macro|CMD_STAT_OK
mdefine_line|#define CMD_STAT_OK&t;0x2000&t;/* CU command completed without errors */
DECL|macro|CMD_STAT_A
mdefine_line|#define CMD_STAT_A&t;0x1000&t;/* CU command abnormally terminated */
DECL|struct|i596_cmd
r_struct
id|i596_cmd
(brace
multiline_comment|/* 8 bytes */
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
DECL|member|pa_next
id|phys_addr
id|pa_next
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_cmd *next) */
)brace
suffix:semicolon
DECL|macro|EOF
mdefine_line|#define EOF&t;&t;0x8000
DECL|macro|SIZE_MASK
mdefine_line|#define SIZE_MASK&t;0x3fff
DECL|struct|i596_tbd
r_struct
id|i596_tbd
(brace
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|pa_next
id|phys_addr
id|pa_next
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_tbd *next) */
DECL|member|pa_data
id|phys_addr
id|pa_data
suffix:semicolon
multiline_comment|/* va_to_pa(char *data) */
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|tx_cmd
r_struct
id|tx_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|pa_tbd
id|phys_addr
id|pa_tbd
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_tbd *tbd) */
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* status bits for rfd */
DECL|macro|RFD_STAT_C
mdefine_line|#define RFD_STAT_C&t;0x8000&t;/* Frame reception complete */
DECL|macro|RFD_STAT_B
mdefine_line|#define RFD_STAT_B&t;0x4000&t;/* Frame reception in progress */
DECL|macro|RFD_STAT_OK
mdefine_line|#define RFD_STAT_OK&t;0x2000&t;/* Frame received without errors */
DECL|macro|RFD_STATUS
mdefine_line|#define RFD_STATUS&t;0x1fff
DECL|macro|RFD_LENGTH_ERR
mdefine_line|#define RFD_LENGTH_ERR&t;0x1000
DECL|macro|RFD_CRC_ERR
mdefine_line|#define RFD_CRC_ERR&t;0x0800
DECL|macro|RFD_ALIGN_ERR
mdefine_line|#define RFD_ALIGN_ERR&t;0x0400
DECL|macro|RFD_NOBUFS_ERR
mdefine_line|#define RFD_NOBUFS_ERR&t;0x0200
DECL|macro|RFD_DMA_ERR
mdefine_line|#define RFD_DMA_ERR&t;0x0100&t;/* DMA overrun failure to acquire system bus */
DECL|macro|RFD_SHORT_FRAME_ERR
mdefine_line|#define RFD_SHORT_FRAME_ERR&t;0x0080
DECL|macro|RFD_NOEOP_ERR
mdefine_line|#define RFD_NOEOP_ERR&t;0x0040
DECL|macro|RFD_TRUNC_ERR
mdefine_line|#define RFD_TRUNC_ERR&t;0x0020
DECL|macro|RFD_MULTICAST
mdefine_line|#define RFD_MULTICAST  0x0002&t;/* 0: destination had our address&n;&t;&t;&t;&t;   1: destination was broadcast/multicast */
DECL|macro|RFD_COLLISION
mdefine_line|#define RFD_COLLISION  0x0001
multiline_comment|/* receive frame descriptor */
DECL|struct|i596_rfd
r_struct
id|i596_rfd
(brace
DECL|member|stat
r_int
r_int
id|stat
suffix:semicolon
DECL|member|cmd
r_int
r_int
id|cmd
suffix:semicolon
DECL|member|pa_next
id|phys_addr
id|pa_next
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_rfd *next) */
DECL|member|pa_rbd
id|phys_addr
id|pa_rbd
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_rbd *rbd) */
DECL|member|count
r_int
r_int
id|count
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|1532
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|RBD_EL
mdefine_line|#define RBD_EL&t;&t;0x8000
DECL|macro|RBD_P
mdefine_line|#define RBD_P&t;&t;0x4000
DECL|macro|RBD_SIZEMASK
mdefine_line|#define RBD_SIZEMASK&t;0x3fff
DECL|macro|RBD_EOF
mdefine_line|#define RBD_EOF&t;&t;0x8000
DECL|macro|RBD_F
mdefine_line|#define RBD_F&t;&t;0x4000
multiline_comment|/* receive buffer descriptor */
DECL|struct|i596_rbd
r_struct
id|i596_rbd
(brace
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|pa_next
id|phys_addr
id|pa_next
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_tbd *next) */
DECL|member|pa_data
id|phys_addr
id|pa_data
suffix:semicolon
multiline_comment|/* va_to_pa(char *data) */
DECL|member|pa_prev
id|phys_addr
id|pa_prev
suffix:semicolon
multiline_comment|/* va_to_pa(struct i596_tbd *prev) */
multiline_comment|/* Driver private part */
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE 64
DECL|macro|RX_SKBSIZE
mdefine_line|#define RX_SKBSIZE (ETH_FRAME_LEN+10)
DECL|macro|RX_RBD_SIZE
mdefine_line|#define RX_RBD_SIZE 32
multiline_comment|/* System Control Block - 40 bytes */
DECL|struct|i596_scb
r_struct
id|i596_scb
(brace
DECL|member|status
id|u16
id|status
suffix:semicolon
multiline_comment|/* 0 */
DECL|member|command
id|u16
id|command
suffix:semicolon
multiline_comment|/* 2 */
DECL|member|pa_cmd
id|phys_addr
id|pa_cmd
suffix:semicolon
multiline_comment|/* 4 - va_to_pa(struct i596_cmd *cmd) */
DECL|member|pa_rfd
id|phys_addr
id|pa_rfd
suffix:semicolon
multiline_comment|/* 8 - va_to_pa(struct i596_rfd *rfd) */
DECL|member|crc_err
id|u32
id|crc_err
suffix:semicolon
multiline_comment|/* 12 */
DECL|member|align_err
id|u32
id|align_err
suffix:semicolon
multiline_comment|/* 16 */
DECL|member|resource_err
id|u32
id|resource_err
suffix:semicolon
multiline_comment|/* 20 */
DECL|member|over_err
id|u32
id|over_err
suffix:semicolon
multiline_comment|/* 24 */
DECL|member|rcvdt_err
id|u32
id|rcvdt_err
suffix:semicolon
multiline_comment|/* 28 */
DECL|member|short_err
id|u32
id|short_err
suffix:semicolon
multiline_comment|/* 32 */
DECL|member|t_on
id|u16
id|t_on
suffix:semicolon
multiline_comment|/* 36 */
DECL|member|t_off
id|u16
id|t_off
suffix:semicolon
multiline_comment|/* 38 */
)brace
suffix:semicolon
multiline_comment|/* Intermediate System Configuration Pointer - 8 bytes */
DECL|struct|i596_iscp
r_struct
id|i596_iscp
(brace
DECL|member|busy
id|u32
id|busy
suffix:semicolon
multiline_comment|/* 0 */
DECL|member|pa_scb
id|phys_addr
id|pa_scb
suffix:semicolon
multiline_comment|/* 4 - va_to_pa(struct i596_scb *scb) */
)brace
suffix:semicolon
multiline_comment|/* System Configuration Pointer - 12 bytes */
DECL|struct|i596_scp
r_struct
id|i596_scp
(brace
DECL|member|sysbus
id|u32
id|sysbus
suffix:semicolon
multiline_comment|/* 0 */
DECL|member|pad
id|u32
id|pad
suffix:semicolon
multiline_comment|/* 4 */
DECL|member|pa_iscp
id|phys_addr
id|pa_iscp
suffix:semicolon
multiline_comment|/* 8 - va_to_pa(struct i596_iscp *iscp) */
)brace
suffix:semicolon
multiline_comment|/* Selftest and dump results - needs 16-byte alignment */
multiline_comment|/*&n; * The size of the dump area is 304 bytes. When the dump is executed&n; * by the Port command an extra word will be appended to the dump area.&n; * The extra word is a copy of the Dump status word (containing the&n; * C, B, OK bits). [I find 0xa006, with a0 for C+OK and 6 for dump]&n; */
DECL|struct|i596_dump
r_struct
id|i596_dump
(brace
DECL|member|dump
id|u16
id|dump
(braket
l_int|153
)braket
suffix:semicolon
multiline_comment|/* (304 = 130h) + 2 bytes */
)brace
suffix:semicolon
DECL|struct|i596_private
r_struct
id|i596_private
(brace
multiline_comment|/* aligned to a 16-byte boundary */
DECL|member|scp
r_struct
id|i596_scp
id|scp
suffix:semicolon
multiline_comment|/* 0 - needs 16-byte alignment */
DECL|member|iscp
r_struct
id|i596_iscp
id|iscp
suffix:semicolon
multiline_comment|/* 12 */
DECL|member|scb
r_struct
id|i596_scb
id|scb
suffix:semicolon
multiline_comment|/* 20 */
DECL|member|dummy
id|u32
id|dummy
suffix:semicolon
multiline_comment|/* 60 */
DECL|member|dump
r_struct
id|i596_dump
id|dump
suffix:semicolon
multiline_comment|/* 64 - needs 16-byte alignment */
DECL|member|set_add
r_struct
id|i596_cmd
id|set_add
suffix:semicolon
DECL|member|eth_addr
r_char
id|eth_addr
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* directly follows set_add */
DECL|member|set_conf
r_struct
id|i596_cmd
id|set_conf
suffix:semicolon
DECL|member|i596_config
r_char
id|i596_config
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* directly follows set_conf */
DECL|member|tdr
r_struct
id|i596_cmd
id|tdr
suffix:semicolon
DECL|member|tdr_stat
r_int
r_int
id|tdr_stat
suffix:semicolon
multiline_comment|/* directly follows tdr */
DECL|member|last_restart
r_int
id|last_restart
suffix:semicolon
DECL|member|rbd_list
r_volatile
r_struct
id|i596_rbd
op_star
id|rbd_list
suffix:semicolon
DECL|member|rbd_tail
r_volatile
r_struct
id|i596_rbd
op_star
id|rbd_tail
suffix:semicolon
DECL|member|rx_tail
r_volatile
r_struct
id|i596_rfd
op_star
id|rx_tail
suffix:semicolon
DECL|member|cmd_tail
r_volatile
r_struct
id|i596_cmd
op_star
id|cmd_tail
suffix:semicolon
DECL|member|cmd_head
r_volatile
r_struct
id|i596_cmd
op_star
id|cmd_head
suffix:semicolon
DECL|member|cmd_backlog
r_int
id|cmd_backlog
suffix:semicolon
DECL|member|last_cmd
r_int
r_int
id|last_cmd
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|init_setup
r_static
r_char
id|init_setup
(braket
l_int|14
)braket
op_assign
(brace
l_int|0x8E
comma
multiline_comment|/* length 14 bytes, prefetch on */
l_int|0xC8
comma
multiline_comment|/* default: fifo to 8, monitor off */
l_int|0x40
comma
multiline_comment|/* default: don&squot;t save bad frames (apricot.c had 0x80) */
l_int|0x2E
comma
multiline_comment|/* (default is 0x26)&n;&t;&t;   No source address insertion, 8 byte preamble */
l_int|0x00
comma
multiline_comment|/* default priority and backoff */
l_int|0x60
comma
multiline_comment|/* default interframe spacing */
l_int|0x00
comma
multiline_comment|/* default slot time LSB */
l_int|0xf2
comma
multiline_comment|/* default slot time and nr of retries */
l_int|0x00
comma
multiline_comment|/* default various bits&n;&t;&t;   (0: promiscuous mode, 1: broadcast disable,&n;&t;&t;    2: encoding mode, 3: transmit on no CRS,&n;&t;&t;    4: no CRC insertion, 5: CRC type,&n;&t;&t;    6: bit stuffing, 7: padding) */
l_int|0x00
comma
multiline_comment|/* default carrier sense and collision detect */
l_int|0x40
comma
multiline_comment|/* default minimum frame length */
l_int|0xff
comma
multiline_comment|/* (default is 0xff, and that is what apricot.c has;&n;&t;&t;   elp486.c has 0xfb: Enable crc append in memory.) */
l_int|0x00
comma
multiline_comment|/* default: not full duplex */
l_int|0x7f
multiline_comment|/* (default is 0x3f) multi IA */
)brace
suffix:semicolon
r_static
r_int
id|i596_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|i596_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|i596_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|print_eth
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
DECL|function|i596_timeout
id|i596_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|msg
comma
r_int
id|ct
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_int
id|boguscnt
op_assign
id|ct
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;scb.command
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s timed out - stat %4.4x, cmd %4.4x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|msg
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|init_rx_bufs
id|init_rx_bufs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|num
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_int
id|i
suffix:semicolon
singleline_comment|// struct i596_rbd *rbd;
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;scb.pa_rfd
op_assign
id|I596_NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rfd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfd
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|rfd-&gt;stat
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;pa_rbd
op_assign
id|I596_NULL
suffix:semicolon
id|rfd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;size
op_assign
l_int|1532
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
suffix:semicolon
id|lp-&gt;rx_tail
op_assign
id|rfd
suffix:semicolon
)brace
r_else
(brace
id|rfd-&gt;cmd
op_assign
l_int|0
suffix:semicolon
)brace
id|rfd-&gt;pa_next
op_assign
id|lp-&gt;scb.pa_rfd
suffix:semicolon
id|lp-&gt;scb.pa_rfd
op_assign
id|va_to_pa
c_func
(paren
id|rfd
)paren
suffix:semicolon
id|lp-&gt;rx_tail-&gt;pa_next
op_assign
id|lp-&gt;scb.pa_rfd
suffix:semicolon
)brace
macro_line|#if 0
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RBD_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rbd
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rbd
)paren
(brace
id|rbd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|rbd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|rbd-&gt;skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_SKB_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rbd-&gt;skb
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dev_alloc_skb failed&quot;
)paren
suffix:semicolon
)brace
id|rbd-&gt;next
op_assign
id|rfd-&gt;rbd
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|rfd-&gt;rbd-&gt;prev
op_assign
id|rbd
suffix:semicolon
id|rbd-&gt;size
op_assign
id|RX_SKB_SIZE
suffix:semicolon
)brace
r_else
(brace
id|rbd-&gt;size
op_assign
(paren
id|RX_SKB_SIZE
op_or
id|RBD_EL
)paren
suffix:semicolon
id|lp-&gt;rbd_tail
op_assign
id|rbd
suffix:semicolon
)brace
id|rfd-&gt;rbd
op_assign
id|rbd
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Could not kmalloc rbd&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|lp-&gt;rbd_tail-&gt;next
op_assign
id|rfd-&gt;rbd
suffix:semicolon
macro_line|#endif
r_return
(paren
id|i
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|remove_rx_bufs
id|remove_rx_bufs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;rx_tail-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
r_do
(brace
id|rfd
op_assign
id|pa_to_va
c_func
(paren
id|lp-&gt;scb.pa_rfd
)paren
suffix:semicolon
id|lp-&gt;scb.pa_rfd
op_assign
id|rfd-&gt;pa_next
suffix:semicolon
id|kfree
c_func
(paren
id|rfd
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rfd
op_ne
id|lp-&gt;rx_tail
)paren
suffix:semicolon
id|lp-&gt;rx_tail
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
r_for
c_loop
(paren
id|lp-&gt;rbd_list
)paren
(brace
)brace
macro_line|#endif
)brace
DECL|macro|PORT_RESET
mdefine_line|#define PORT_RESET              0x00    /* reset 82596 */
DECL|macro|PORT_SELFTEST
mdefine_line|#define PORT_SELFTEST           0x01    /* selftest */
DECL|macro|PORT_ALTSCP
mdefine_line|#define PORT_ALTSCP             0x02    /* alternate SCB address */
DECL|macro|PORT_DUMP
mdefine_line|#define PORT_DUMP               0x03    /* dump */
DECL|macro|IOADDR
mdefine_line|#define IOADDR&t;0xcb0&t;&t;/* real constant */
DECL|macro|IRQ
mdefine_line|#define IRQ&t;10&t;&t;/* default IRQ - can be changed by ECU */
multiline_comment|/* The 82596 requires two 16-bit write cycles for a port command */
r_static
r_inline
r_void
DECL|function|PORT
id|PORT
c_func
(paren
id|phys_addr
id|a
comma
r_int
r_int
id|cmd
)paren
(brace
r_if
c_cond
(paren
id|a
op_amp
l_int|0xf
)paren
id|printk
c_func
(paren
l_string|&quot;lp486e.c: PORT: address not aligned&bslash;n&quot;
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
id|a
op_amp
l_int|0xffff
)paren
op_or
id|cmd
)paren
comma
id|IOADDR
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
id|a
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
comma
id|IOADDR
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|CA
id|CA
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|IOADDR
op_plus
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|8
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|CLEAR_INT
id|CLEAR_INT
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|IOADDR
op_plus
l_int|8
)paren
suffix:semicolon
)brace
DECL|macro|SIZE
mdefine_line|#define SIZE(x)&t;(sizeof(x)/sizeof((x)[0]))
macro_line|#if 0
multiline_comment|/* selftest or dump */
r_static
r_void
id|i596_port_do
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|portcmd
comma
r_char
op_star
id|cmdname
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_volatile
id|u16
op_star
id|outp
suffix:semicolon
r_int
id|i
comma
id|m
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
(paren
id|lp-&gt;dump
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|i596_dump
)paren
)paren
suffix:semicolon
id|outp
op_assign
op_amp
(paren
id|lp-&gt;dump.dump
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|PORT
c_func
(paren
id|va_to_pa
c_func
(paren
id|outp
)paren
comma
id|portcmd
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* random, unmotivated */
id|printk
c_func
(paren
l_string|&quot;lp486e i82596 %s result:&bslash;n&quot;
comma
id|cmdname
)paren
suffix:semicolon
r_for
c_loop
(paren
id|m
op_assign
id|SIZE
c_func
(paren
id|lp-&gt;dump.dump
)paren
suffix:semicolon
id|m
op_logical_and
id|lp-&gt;dump.dump
(braket
id|m
op_minus
l_int|1
)braket
op_eq
l_int|0
suffix:semicolon
id|m
op_decrement
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|m
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %04x&quot;
comma
id|lp-&gt;dump.dump
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|7
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|i596_scp_setup
id|i596_scp_setup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
suffix:semicolon
multiline_comment|/* Setup SCP, ISCP, SCB */
multiline_comment|/*&n;&t; * sysbus bits:&n;&t; *  only a single byte is significant - here 0x44&n;&t; *  0x80: big endian mode (details depend on stepping)&n;&t; *  0x40: 1&n;&t; *  0x20: interrupt pin is active low&n;&t; *  0x10: lock function disabled&n;&t; *  0x08: external triggering of bus throttle timers&n;&t; *  0x06: 00: 82586 compat mode, 01: segmented mode, 10: linear mode&n;&t; *  0x01: unused&n;&t; */
id|lp-&gt;scp.sysbus
op_assign
l_int|0x00440000
suffix:semicolon
multiline_comment|/* linear mode */
id|lp-&gt;scp.pad
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* must be zero */
id|lp-&gt;scp.pa_iscp
op_assign
id|va_to_pa
c_func
(paren
op_amp
(paren
id|lp-&gt;iscp
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The CPU sets the ISCP to 1 before it gives the first CA()&n;&t; */
id|lp-&gt;iscp.busy
op_assign
l_int|0x0001
suffix:semicolon
id|lp-&gt;iscp.pa_scb
op_assign
id|va_to_pa
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;scb.status
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;scb.pa_cmd
op_assign
id|I596_NULL
suffix:semicolon
multiline_comment|/* lp-&gt;scb.pa_rfd has been initialised already */
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;cmd_backlog
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Reset the 82596.&n;&t; * We need to wait 10 systemclock cycles, and&n;&t; * 5 serial clock cycles.&n;&t; */
id|PORT
c_func
(paren
l_int|0
comma
id|PORT_RESET
)paren
suffix:semicolon
multiline_comment|/* address part ignored */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Before the CA signal is asserted, the default SCP address&n;&t; * (0x00fffff4) can be changed to a 16-byte aligned value&n;&t; */
id|PORT
c_func
(paren
id|va_to_pa
c_func
(paren
op_amp
id|lp-&gt;scp
)paren
comma
id|PORT_ALTSCP
)paren
suffix:semicolon
multiline_comment|/* change the scp address */
multiline_comment|/*&n;&t; * The initialization procedure begins when a&n;&t; * Channel Attention signal is asserted after a reset.&n;&t; */
id|CA
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The ISCP busy is cleared by the 82596 after the SCB address is read.&n;&t; */
id|boguscnt
op_assign
l_int|100
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;iscp.busy
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* No i82596 present? */
id|printk
c_func
(paren
l_string|&quot;%s: i82596 initialization timed out&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
multiline_comment|/* I find here boguscnt==100, so no delay was required. */
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_i596
id|init_i596
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_if
c_cond
(paren
id|i596_scp_setup
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
id|memcpy
(paren
(paren
r_void
op_star
)paren
id|lp-&gt;i596_config
comma
id|init_setup
comma
l_int|14
)paren
suffix:semicolon
id|lp-&gt;set_conf.command
op_assign
id|CmdConfigure
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
op_amp
id|lp-&gt;set_conf
)paren
suffix:semicolon
id|memcpy
(paren
(paren
r_void
op_star
)paren
id|lp-&gt;eth_addr
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|lp-&gt;set_add.command
op_assign
id|CmdIASetup
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
(paren
r_struct
id|i596_cmd
op_star
)paren
op_amp
id|lp-&gt;set_add
)paren
suffix:semicolon
id|lp-&gt;tdr.command
op_assign
id|CmdTDR
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
(paren
r_struct
id|i596_cmd
op_star
)paren
op_amp
id|lp-&gt;tdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i82596 init&quot;
comma
l_int|200
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|RX_START
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;Receive Unit start&quot;
comma
l_int|100
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Receive a single frame */
r_static
r_inline
r_int
DECL|function|i596_rx_one
id|i596_rx_one
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_volatile
r_struct
id|i596_private
op_star
id|lp
comma
r_struct
id|i596_rfd
op_star
id|rfd
comma
r_int
op_star
id|frames
)paren
(brace
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_STAT_OK
)paren
(brace
multiline_comment|/* a good frame */
r_int
id|pkt_len
op_assign
(paren
id|rfd-&gt;count
op_amp
l_int|0x3fff
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
)paren
suffix:semicolon
(paren
op_star
id|frames
)paren
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;cmd
op_amp
id|CMD_EOL
)paren
id|printk
c_func
(paren
l_string|&quot;Received on EOL&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;%s: i596_rx Memory squeeze, &quot;
l_string|&quot;dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|rfd-&gt;data
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
r_else
(brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;Frame reception error status %04x&bslash;n&quot;
comma
id|rfd-&gt;stat
)paren
suffix:semicolon
macro_line|#endif
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_COLLISION
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_SHORT_FRAME_ERR
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_DMA_ERR
)paren
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_NOBUFS_ERR
)paren
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_ALIGN_ERR
)paren
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_CRC_ERR
)paren
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rfd-&gt;stat
op_amp
id|RFD_LENGTH_ERR
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
id|rfd-&gt;stat
op_assign
id|rfd-&gt;count
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|i596_rx
id|i596_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_int
id|frames
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|rfd
op_assign
id|pa_to_va
c_func
(paren
id|lp-&gt;scb.pa_rfd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rfd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i596_rx: NULL rfd?&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 1
r_if
c_cond
(paren
id|rfd-&gt;stat
op_logical_and
op_logical_neg
(paren
id|rfd-&gt;stat
op_amp
(paren
id|RFD_STAT_C
op_or
id|RFD_STAT_B
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;SF:%p-%04x&bslash;n&quot;
comma
id|rfd
comma
id|rfd-&gt;stat
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
(paren
id|rfd-&gt;stat
op_amp
id|RFD_STAT_C
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* next one not ready */
r_if
c_cond
(paren
id|i596_rx_one
c_func
(paren
id|dev
comma
id|lp
comma
id|rfd
comma
op_amp
id|frames
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* out of memory */
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
suffix:semicolon
id|lp-&gt;rx_tail-&gt;cmd
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;rx_tail
op_assign
id|rfd
suffix:semicolon
id|lp-&gt;scb.pa_rfd
op_assign
id|rfd-&gt;pa_next
suffix:semicolon
)brace
r_return
id|frames
suffix:semicolon
)brace
r_static
r_void
DECL|function|i596_cleanup_cmd
id|i596_cleanup_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;cmd_head
)paren
(brace
id|cmd
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|lp-&gt;cmd_head
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|pa_to_va
c_func
(paren
id|lp-&gt;cmd_head-&gt;pa_next
)paren
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|cmd-&gt;command
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|cmd
suffix:semicolon
r_struct
id|i596_tbd
op_star
id|tx_cmd_tbd
suffix:semicolon
id|tx_cmd_tbd
op_assign
id|pa_to_va
c_func
(paren
id|tx_cmd-&gt;pa_tbd
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|tx_cmd_tbd-&gt;skb
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|tx_cmd
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CmdMulticastList
suffix:colon
(brace
singleline_comment|// unsigned short count = *((unsigned short *) (ptr + 1));
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596_cleanup_cmd&quot;
comma
l_int|100
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.pa_cmd
op_assign
id|va_to_pa
c_func
(paren
id|lp-&gt;cmd_head
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|i596_reset
id|i596_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_volatile
r_struct
id|i596_private
op_star
id|lp
comma
r_int
id|ioaddr
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596_reset&quot;
comma
l_int|100
)paren
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_ABORT
op_or
id|RX_ABORT
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for shutdown */
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596_reset(2)&quot;
comma
l_int|400
)paren
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/*dev_kfree_skb(skb, FREE_WRITE);*/
id|init_i596
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|i596_add_cmd
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|cmd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;command
op_or_assign
(paren
id|CMD_EOL
op_or
id|CMD_INTR
)paren
suffix:semicolon
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cmd_head
)paren
(brace
id|lp-&gt;cmd_tail-&gt;pa_next
op_assign
id|va_to_pa
c_func
(paren
id|cmd
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;cmd_head
op_assign
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596_add_cmd&quot;
comma
l_int|100
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.pa_cmd
op_assign
id|va_to_pa
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_START
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
)brace
id|lp-&gt;cmd_tail
op_assign
id|cmd
suffix:semicolon
id|lp-&gt;cmd_backlog
op_increment
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|pa_to_va
c_func
(paren
id|lp-&gt;scb.pa_cmd
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cmd_backlog
OG
l_int|16
)paren
(brace
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|lp-&gt;last_cmd
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|25
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: command unit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|i596_reset
c_func
(paren
id|dev
comma
id|lp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|i596_open
id|i596_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|i596_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: IRQ %d not free&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_assign
id|init_rx_bufs
c_func
(paren
id|dev
comma
id|RX_RING_SIZE
)paren
)paren
OL
id|RX_RING_SIZE
)paren
id|printk
c_func
(paren
l_string|&quot;%s: only able to allocate %d receive buffers&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|4
)paren
(brace
singleline_comment|// release buffers
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init_i596
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Always succeed */
)brace
r_static
r_int
DECL|function|i596_start_xmit
id|i596_start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tx_cmd
op_star
id|tx_cmd
suffix:semicolon
r_int
id|length
suffix:semicolon
multiline_comment|/* If some higher level thinks we&squot;ve missed a tx-done interrupt&n;&t;   we are passed NULL. n.b. dev_tint handles the cli()/sti()&n;&t;   itself. */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;What about dev_tint&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* dev_tint(dev); */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* shouldn&squot;t happen */
r_if
c_cond
(paren
id|skb-&gt;len
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|length
op_assign
(paren
id|ETH_ZLEN
OL
id|skb-&gt;len
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|kmalloc
(paren
(paren
r_sizeof
(paren
r_struct
id|tx_cmd
)paren
op_plus
r_sizeof
(paren
r_struct
id|i596_tbd
)paren
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_cmd
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;%s: i596_xmit Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|i596_tbd
op_star
id|tx_cmd_tbd
suffix:semicolon
id|tx_cmd_tbd
op_assign
(paren
r_struct
id|i596_tbd
op_star
)paren
(paren
id|tx_cmd
op_plus
l_int|1
)paren
suffix:semicolon
id|tx_cmd-&gt;pa_tbd
op_assign
id|va_to_pa
(paren
id|tx_cmd_tbd
)paren
suffix:semicolon
id|tx_cmd_tbd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|tx_cmd-&gt;cmd.command
op_assign
(paren
id|CMD_FLEX
op_or
id|CmdTx
)paren
suffix:semicolon
id|tx_cmd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tx_cmd-&gt;size
op_assign
l_int|0
suffix:semicolon
id|tx_cmd_tbd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tx_cmd_tbd-&gt;size
op_assign
(paren
id|EOF
op_or
id|length
)paren
suffix:semicolon
id|tx_cmd_tbd-&gt;pa_data
op_assign
id|va_to_pa
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|tx_cmd_tbd-&gt;skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
op_amp
id|LOG_SRCDST
)paren
id|print_eth
(paren
id|skb-&gt;data
)paren
suffix:semicolon
id|i596_add_cmd
(paren
id|dev
comma
(paren
r_struct
id|i596_cmd
op_star
)paren
id|tx_cmd
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|i596_tx_timeout
id|i596_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
id|printk
(paren
l_string|&quot;%s: transmit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Try to restart the adaptor */
r_if
c_cond
(paren
id|lp-&gt;last_restart
op_eq
id|lp-&gt;stats.tx_packets
)paren
(brace
id|printk
(paren
l_string|&quot;Resetting board.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Shutdown and restart */
id|i596_reset
(paren
id|dev
comma
id|lp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Issue a channel attention signal */
id|printk
(paren
l_string|&quot;Kicking board.&bslash;n&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
(paren
id|CUC_START
op_or
id|RX_START
)paren
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
id|lp-&gt;last_restart
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
)brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|print_eth
id|print_eth
c_func
(paren
r_char
op_star
id|add
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
(paren
l_string|&quot;Dest  &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Source&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
op_plus
l_int|6
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;type %2.2X%2.2X&bslash;n&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|12
)braket
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|13
)braket
)paren
suffix:semicolon
)brace
r_int
id|__init
DECL|function|lp486e_probe
id|lp486e_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_int
r_char
id|eth_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0
comma
l_int|0xaa
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_int
r_char
op_star
id|bios
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_static
r_int
id|probed
suffix:semicolon
r_if
c_cond
(paren
id|probed
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|probed
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|IOADDR
comma
id|LP486E_TOTAL_SIZE
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lp486e: IO address 0x%x in use&bslash;n&quot;
comma
id|IOADDR
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Allocate working memory, 16-byte aligned&n;&t; */
id|dev-&gt;mem_start
op_assign
(paren
r_int
r_int
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_private
)paren
op_plus
l_int|0x0f
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;mem_start
)paren
r_goto
id|err_out
suffix:semicolon
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
id|dev-&gt;mem_start
op_plus
l_int|0xf
)paren
op_amp
l_int|0xfffffff0
)paren
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|lp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Do we really have this thing?&n;&t; */
r_if
c_cond
(paren
id|i596_scp_setup
c_func
(paren
id|dev
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_kfree
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
id|IOADDR
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IRQ
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * How do we find the ethernet address? I don&squot;t know.&n;&t; * One possibility is to look at the EISA configuration area&n;&t; * [0xe8000-0xe9fff]. This contains the ethernet address&n;&t; * but not at a fixed address - things depend on setup options.&n;&t; *&n;&t; * If we find no address, or the wrong address, use&n;&t; *   ifconfig eth0 hw ether a1:a2:a3:a4:a5:a6&n;&t; * with the value found in the BIOS setup.&n;&t; */
id|bios
op_assign
id|bus_to_virt
c_func
(paren
l_int|0xe8000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|0x2000
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|bios
(braket
id|j
)braket
op_eq
l_int|0
op_logical_and
id|bios
(braket
id|j
op_plus
l_int|1
)braket
op_eq
l_int|0xaa
op_logical_and
id|bios
(braket
id|j
op_plus
l_int|2
)braket
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: maybe address at BIOS 0x%x:&quot;
comma
id|dev-&gt;name
comma
l_int|0xe8000
op_plus
id|j
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eth_addr
(braket
id|i
)braket
op_assign
id|bios
(braket
id|i
op_plus
id|j
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
id|eth_addr
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%s: lp486e 82596 at %#3lx, IRQ %d,&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|eth_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* The LP486E-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|i596_open
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|i596_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|i596_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|i596_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast_list
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|i596_tx_timeout
suffix:semicolon
macro_line|#if 0
multiline_comment|/* selftest reports 0x320925ae - don&squot;t know what that means */
id|i596_port_do
c_func
(paren
id|dev
comma
id|PORT_SELFTEST
comma
l_string|&quot;selftest&quot;
)paren
suffix:semicolon
id|i596_port_do
c_func
(paren
id|dev
comma
id|PORT_DUMP
comma
l_string|&quot;dump&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
id|err_out_kfree
suffix:colon
id|kfree
(paren
(paren
r_void
op_star
)paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
id|err_out
suffix:colon
id|release_region
c_func
(paren
id|IOADDR
comma
id|LP486E_TOTAL_SIZE
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_void
r_inline
DECL|function|i596_handle_CU_completion
id|i596_handle_CU_completion
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_volatile
r_struct
id|i596_private
op_star
id|lp
comma
r_int
r_int
id|status
comma
r_int
r_int
op_star
id|ack_cmdp
)paren
(brace
r_volatile
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
r_int
id|frames_out
op_assign
l_int|0
suffix:semicolon
r_int
id|commands_done
op_assign
l_int|0
suffix:semicolon
r_int
id|cmd_val
suffix:semicolon
id|cmd
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;cmd_head
op_logical_and
(paren
id|lp-&gt;cmd_head-&gt;status
op_amp
id|CMD_STAT_C
)paren
)paren
(brace
id|cmd
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|pa_to_va
c_func
(paren
id|lp-&gt;cmd_head-&gt;pa_next
)paren
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
id|commands_done
op_increment
suffix:semicolon
id|cmd_val
op_assign
id|cmd-&gt;command
op_amp
l_int|0x7
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;finished CU %s command (%d)&bslash;n&quot;
comma
id|CUcmdnames
(braket
id|cmd_val
)braket
comma
id|cmd_val
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd_val
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
suffix:semicolon
r_struct
id|i596_tbd
op_star
id|tx_cmd_tbd
suffix:semicolon
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|cmd
suffix:semicolon
id|tx_cmd_tbd
op_assign
id|pa_to_va
c_func
(paren
id|tx_cmd-&gt;pa_tbd
)paren
suffix:semicolon
id|frames_out
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
id|CMD_STAT_OK
)paren
(brace
r_if
c_cond
(paren
id|i596_debug
)paren
id|print_eth
c_func
(paren
id|pa_to_va
c_func
(paren
id|tx_cmd_tbd-&gt;pa_data
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
)paren
id|printk
c_func
(paren
l_string|&quot;transmission failure:%04x&bslash;n&quot;
comma
id|cmd-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
l_int|0x0020
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cmd-&gt;status
op_amp
l_int|0x0040
)paren
)paren
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
l_int|0x0400
)paren
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
l_int|0x0800
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;status
op_amp
l_int|0x1000
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
)brace
id|dev_kfree_skb_irq
c_func
(paren
id|tx_cmd_tbd-&gt;skb
)paren
suffix:semicolon
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|tx_cmd
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CmdMulticastList
suffix:colon
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CmdTDR
suffix:colon
(brace
r_int
r_int
id|status
op_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x8000
)paren
(brace
r_if
c_cond
(paren
id|i596_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: link ok.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x4000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Transceiver problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Termination problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Short circuit.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Time %ld.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x07ff
)paren
suffix:semicolon
)brace
)brace
r_default
suffix:colon
id|cmd-&gt;pa_next
op_assign
id|I596_NULL
suffix:semicolon
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
id|cmd
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_while
c_loop
(paren
id|cmd
op_logical_and
(paren
id|cmd
op_ne
id|lp-&gt;cmd_tail
)paren
)paren
(brace
id|cmd-&gt;command
op_and_assign
l_int|0x1fff
suffix:semicolon
id|cmd
op_assign
id|pa_to_va
c_func
(paren
id|cmd-&gt;pa_next
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;cmd_head
)paren
op_star
id|ack_cmdp
op_or_assign
id|CUC_START
suffix:semicolon
id|lp-&gt;scb.pa_cmd
op_assign
id|va_to_pa
c_func
(paren
id|lp-&gt;cmd_head
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|i596_interrupt
id|i596_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_volatile
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_int
r_int
id|status
comma
id|ack_cmd
op_assign
l_int|0
suffix:semicolon
r_int
id|frames_in
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;i596_interrupt(): irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lp
op_assign
(paren
r_struct
id|i596_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*&n;&t; * The 82596 examines the command, performs the required action,&n;&t; * and then clears the SCB command word.&n;&t; */
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;interrupt&quot;
comma
l_int|40
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The status word indicates the status of the 82596.&n;&t; * It is modified only by the 82596.&n;&t; *&n;&t; * [So, we must not clear it. I find often status 0xffff,&n;&t; *  which is not one of the values allowed by the docs.]&n;&t; */
id|status
op_assign
id|lp-&gt;scb.status
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|i596_debug
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt, &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|i596_out_status
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Impossible, but it happens - perhaps when we get&n;&t;   a receive interrupt but scb.pa_rfd is I596_NULL. */
r_if
c_cond
(paren
id|status
op_eq
l_int|0xffff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: i596_interrupt: got status 0xffff&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ack_cmd
op_assign
(paren
id|status
op_amp
id|STAT_ACK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|STAT_CX
op_or
id|STAT_CNA
)paren
)paren
id|i596_handle_CU_completion
c_func
(paren
id|dev
comma
id|lp
comma
id|status
comma
op_amp
id|ack_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|STAT_FR
op_or
id|STAT_RNR
)paren
)paren
(brace
multiline_comment|/* Restart the receive unit when it got inactive somehow */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|STAT_RNR
)paren
op_logical_and
id|netif_running
c_func
(paren
id|dev
)paren
)paren
id|ack_cmd
op_or_assign
id|RX_START
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|STAT_FR
)paren
(brace
id|frames_in
op_assign
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|frames_in
)paren
id|printk
c_func
(paren
l_string|&quot;receive frame reported, but no frames&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* acknowledge the interrupt */
multiline_comment|/*&n;&t;if ((lp-&gt;scb.pa_cmd != I596_NULL) &amp;&amp; netif_running(dev))&n;&t;&t;ack_cmd |= CUC_START;&n;&t;*/
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596 interrupt&quot;
comma
l_int|100
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|ack_cmd
suffix:semicolon
id|CLEAR_INT
c_func
(paren
)paren
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|i596_close
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Shutting down ethercard, status was %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
(paren
id|CUC_ABORT
op_or
id|RX_ABORT
)paren
suffix:semicolon
id|CA
c_func
(paren
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;scb.command
op_logical_and
id|i596_timeout
c_func
(paren
id|dev
comma
l_string|&quot;i596_close&quot;
comma
l_int|200
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|remove_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|i596_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n;*&t;Set or clear the multicast filter for this adaptor.&n;*/
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_volatile
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|printk
(paren
l_string|&quot;%s: set multicast list %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mc_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|0
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|dmi
suffix:semicolon
r_char
op_star
id|cp
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|i596_cmd
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
op_plus
l_int|2
op_plus
id|dev-&gt;mc_count
op_star
l_int|6
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;%s: set_multicast Memory squeeze.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cmd-&gt;command
op_assign
id|CmdMulticastList
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_assign
id|dev-&gt;mc_count
op_star
l_int|6
suffix:semicolon
id|cp
op_assign
(paren
(paren
r_char
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_plus
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|dmi
op_ne
l_int|NULL
suffix:semicolon
id|dmi
op_assign
id|dmi-&gt;next
)paren
(brace
id|memcpy
c_func
(paren
id|cp
comma
id|dmi
comma
l_int|6
)paren
suffix:semicolon
id|cp
op_add_assign
l_int|6
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i596_debug
op_amp
id|LOG_SRCDST
)paren
id|print_eth
(paren
(paren
(paren
r_char
op_star
)paren
(paren
id|cmd
op_plus
l_int|1
)paren
)paren
op_plus
l_int|2
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
id|cmd
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|lp-&gt;set_conf.pa_next
op_ne
id|I596_NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mc_count
op_eq
l_int|0
op_logical_and
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_PROMISC
op_or
id|IFF_ALLMULTI
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_PROMISC
suffix:semicolon
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;i596_config
(braket
l_int|8
)braket
op_or_assign
l_int|0x01
suffix:semicolon
)brace
id|i596_add_cmd
c_func
(paren
id|dev
comma
(paren
r_struct
id|i596_cmd
op_star
)paren
op_amp
id|lp-&gt;set_conf
)paren
suffix:semicolon
)brace
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ard van Breemen &lt;ard@cstmel.nl.eu.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Intel Panther onboard i82596 driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
singleline_comment|//MODULE_PARM(max_interrupt_work, &quot;i&quot;);
singleline_comment|//MODULE_PARM(reverse_probe, &quot;i&quot;);
singleline_comment|//MODULE_PARM(rx_copybreak, &quot;i&quot;);
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|variable|dev_lp486e
r_static
r_struct
id|net_device
id|dev_lp486e
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
suffix:semicolon
DECL|variable|options
r_static
r_int
id|options
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
op_assign
id|IOADDR
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
op_assign
id|IRQ
suffix:semicolon
DECL|function|lp486e_init_module
r_static
r_int
id|__init
id|lp486e_init_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|dev_lp486e
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|io
suffix:semicolon
id|dev-&gt;init
op_assign
id|lp486e_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|full_duplex
op_assign
l_int|0
suffix:semicolon
id|options
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lp486e_cleanup_module
r_static
r_void
id|__exit
id|lp486e_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_lp486e
)paren
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|dev_lp486e.mem_start
)paren
suffix:semicolon
id|dev_lp486e.priv
op_assign
l_int|NULL
suffix:semicolon
id|release_region
c_func
(paren
id|dev_lp486e.base_addr
comma
id|LP486E_TOTAL_SIZE
)paren
suffix:semicolon
)brace
DECL|variable|lp486e_init_module
id|module_init
c_func
(paren
id|lp486e_init_module
)paren
suffix:semicolon
DECL|variable|lp486e_cleanup_module
id|module_exit
c_func
(paren
id|lp486e_cleanup_module
)paren
suffix:semicolon
eof
