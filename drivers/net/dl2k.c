multiline_comment|/*  D-Link DL2000-based Gigabit Ethernet Adapter Linux driver */
multiline_comment|/*&n;    Copyright (c) 2001, 2002 by D-Link Corporation&n;    Written by Edward Peng.&lt;edward_peng@dlink.com.tw&gt;&n;    Created 03-May-2001, base on Linux&squot; sundance.c.&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;*/
multiline_comment|/*&n;    Rev&t;&t;Date&t;&t;Description&n;    ==========================================================================&n;    0.01&t;2001/05/03&t;Created DL2000-based linux driver&n;    0.02&t;2001/05/21&t;Added VLAN and hardware checksum support.&n;    1.00&t;2001/06/26&t;Added jumbo frame support.&n;    1.01&t;2001/08/21&t;Added two parameters, rx_coalesce and rx_timeout.&n;    1.02&t;2001/10/08&t;Supported fiber media.&n;    &t;&t;&t;&t;Added flow control parameters.&n;    1.03&t;2001/10/12&t;Changed the default media to 1000mbps_fd for &n;    &t;&t;&t;&t;the fiber devices.&n;    1.04&t;2001/11/08&t;Fixed Tx stopped when tx very busy.&n;    1.05&t;2001/11/22&t;Fixed Tx stopped when unidirectional tx busy.&n;    1.06&t;2001/12/13&t;Fixed disconnect bug at 10Mbps mode.&n;    &t;&t;&t;&t;Fixed tx_full flag incorrect.&n;&t;&t;&t;&t;Added tx_coalesce paramter.&n;    1.07&t;2002/01/03&t;Fixed miscount of RX frame error.&n;    1.08&t;2002/01/17&t;Fixed the multicast bug.&n;    1.09&t;2002/03/07&t;Move rx-poll-now to re-fill loop.&t;&n;    &t;&t;&t;&t;Added rio_timer() to watch rx buffers. &n;    1.10&t;2002/04/16&t;Fixed miscount of carrier error.&n;    1.11&t;2002/05/23&t;Added ISR schedule scheme&n;    &t;&t;&t;&t;Fixed miscount of rx frame error for DGE-550SX.&n;    &t;&t;&t;&t;Fixed VLAN bug.&n;    1.12&t;2002/06/13&t;Lock tx_coalesce=1 on 10/100Mbps mode.&n;    1.13&t;2002/08/13&t;1. Fix disconnection (many tx:carrier/rx:frame&n;    &t;&t;&t;&t;   errs) with some mainboards.&n;    &t;&t;&t;&t;2. Use definition &quot;DRV_NAME&quot; &quot;DRV_VERSION&quot; &n;&t;&t;&t;&t;   &quot;DRV_RELDATE&quot; for flexibility.&t;&n;    1.14&t;2002/08/14&t;Support ethtool.&t;&n;    1.15&t;2002/08/27&t;Changed the default media to Auto-Negotiation&n;&t;&t;&t;&t;for the fiber devices.    &n;    1.16&t;2002/09/04      More power down time for fiber devices auto-&n;    &t;&t;&t;&t;negotiation.&n;&t;&t;&t;&t;Fix disconnect bug after ifup and ifdown.&n;    1.17&t;2002/10/03&t;Fix RMON statistics overflow. &n;&t;&t;&t;     &t;Always use I/O mapping to access eeprom, &n;&t;&t;&t;&t;avoid system freezing with some chipsets.&n;&n;*/
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;D-Link DL2000-based linux driver&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;v1.17a&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&quot;2002/10/04&quot;
macro_line|#include &quot;dl2k.h&quot;
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|KERN_INFO
id|DRV_NAME
l_string|&quot; &quot;
id|DRV_VERSION
l_string|&quot; &quot;
id|DRV_RELDATE
l_string|&quot;&bslash;n&quot;
suffix:semicolon
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
DECL|variable|mtu
r_static
r_int
id|mtu
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|vlan
r_static
r_int
id|vlan
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|jumbo
r_static
r_int
id|jumbo
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|media
r_static
r_char
op_star
id|media
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|tx_flow
r_static
r_int
id|tx_flow
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|rx_flow
r_static
r_int
id|rx_flow
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|copy_thresh
r_static
r_int
id|copy_thresh
suffix:semicolon
DECL|variable|rx_coalesce
r_static
r_int
id|rx_coalesce
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* Rx frame count each interrupt */
DECL|variable|rx_timeout
r_static
r_int
id|rx_timeout
op_assign
l_int|200
suffix:semicolon
multiline_comment|/* Rx DMA wait time in 640ns increments */
DECL|variable|tx_coalesce
r_static
r_int
id|tx_coalesce
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* HW xmit count each TxDMAComplete */
id|MODULE_AUTHOR
(paren
l_string|&quot;Edward Peng&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;D-Link DL2000-based Gigabit Ethernet Adapter&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|mtu
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|media
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
(paren
id|MAX_UNITS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|vlan
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|jumbo
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|tx_flow
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|rx_flow
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|copy_thresh
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|rx_coalesce
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Rx frame count each interrupt */
id|MODULE_PARM
(paren
id|rx_timeout
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* Rx DMA wait time in 64ns increments */
id|MODULE_PARM
(paren
id|tx_coalesce
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/* HW xmit count each TxDMAComplete */
multiline_comment|/* Enable the default interrupts */
DECL|macro|DEFAULT_INTR
mdefine_line|#define DEFAULT_INTR (RxDMAComplete | HostError | IntRequested | TxDMAComplete| &bslash;&n;       UpdateStats | LinkEvent)
DECL|macro|EnableInt
mdefine_line|#define EnableInt() &bslash;&n;writew(DEFAULT_INTR, ioaddr + IntEnable)
DECL|variable|max_intrloop
r_static
r_int
id|max_intrloop
op_assign
l_int|50
suffix:semicolon
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|0x40
suffix:semicolon
r_static
r_int
id|rio_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rio_timer
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|rio_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|alloc_list
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|rio_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|rio_free_tx
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|tx_error
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|tx_status
)paren
suffix:semicolon
r_static
r_int
id|receive_packet
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rio_error
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|int_status
)paren
suffix:semicolon
r_static
r_int
id|change_mtu
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
suffix:semicolon
r_static
r_void
id|set_multicast
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|clear_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|rio_ethtool_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
id|__user
op_star
id|useraddr
)paren
suffix:semicolon
r_static
r_int
id|rio_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|rio_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|find_miiphy
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|parse_eeprom
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|read_eeprom
(paren
r_int
id|ioaddr
comma
r_int
id|eep_addr
)paren
suffix:semicolon
r_static
r_int
id|mii_wait_link
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|wait
)paren
suffix:semicolon
r_static
r_int
id|mii_set_media
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_get_media
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_set_media_pcs
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_get_media_pcs
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_read
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
r_int
id|reg_num
)paren
suffix:semicolon
r_static
r_int
id|mii_write
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
r_int
id|reg_num
comma
id|u16
id|data
)paren
suffix:semicolon
r_static
r_int
id|__devinit
DECL|function|rio_probe1
id|rio_probe1
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_static
r_int
id|card_idx
suffix:semicolon
r_int
id|chip_idx
op_assign
id|ent-&gt;driver_data
suffix:semicolon
r_int
id|err
comma
id|irq
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_static
r_int
id|version_printed
suffix:semicolon
r_void
op_star
id|ring_space
suffix:semicolon
id|dma_addr_t
id|ring_dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|version_printed
op_increment
)paren
id|printk
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|err
op_assign
id|pci_enable_device
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|err
op_assign
id|pci_request_regions
(paren
id|pdev
comma
l_string|&quot;dl2k&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_disable
suffix:semicolon
id|pci_set_master
(paren
id|pdev
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
(paren
r_sizeof
(paren
op_star
id|np
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|SET_MODULE_OWNER
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|ioaddr
op_assign
(paren
r_int
)paren
id|ioremap
(paren
id|ioaddr
comma
id|RIO_IO_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_dev
suffix:semicolon
)brace
macro_line|#else
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
id|np-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|np-&gt;tx_lock
)paren
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|np-&gt;rx_lock
)paren
suffix:semicolon
multiline_comment|/* Parse manual configuration */
id|np-&gt;an_enable
op_assign
l_int|1
suffix:semicolon
id|np-&gt;tx_coalesce
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|card_idx
OL
id|MAX_UNITS
)paren
(brace
r_if
c_cond
(paren
id|media
(braket
id|card_idx
)braket
op_ne
l_int|NULL
)paren
(brace
id|np-&gt;an_enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;auto&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;autosense&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;0&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;an_enable
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;100mbps_fd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;4&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;100mbps_hd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;3&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;10mbps_fd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;2&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;10mbps_hd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;1&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;1000mbps_fd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;6&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|1000
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;1000mbps_hd&quot;
)paren
op_eq
l_int|0
op_logical_or
id|strcmp
(paren
id|media
(braket
id|card_idx
)braket
comma
l_string|&quot;5&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|np-&gt;speed
op_assign
l_int|1000
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;an_enable
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|jumbo
(braket
id|card_idx
)braket
op_ne
l_int|0
)paren
(brace
id|np-&gt;jumbo
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|MAX_JUMBO
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;jumbo
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mtu
(braket
id|card_idx
)braket
OG
l_int|0
op_logical_and
id|mtu
(braket
id|card_idx
)braket
OL
id|PACKET_SIZE
)paren
id|dev-&gt;mtu
op_assign
id|mtu
(braket
id|card_idx
)braket
suffix:semicolon
)brace
id|np-&gt;vlan
op_assign
(paren
id|vlan
(braket
id|card_idx
)braket
OG
l_int|0
op_logical_and
id|vlan
(braket
id|card_idx
)braket
OL
l_int|4096
)paren
ques
c_cond
id|vlan
(braket
id|card_idx
)braket
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rx_coalesce
OG
l_int|0
op_logical_and
id|rx_timeout
OG
l_int|0
)paren
(brace
id|np-&gt;rx_coalesce
op_assign
id|rx_coalesce
suffix:semicolon
id|np-&gt;rx_timeout
op_assign
id|rx_timeout
suffix:semicolon
id|np-&gt;coalesce
op_assign
l_int|1
suffix:semicolon
)brace
id|np-&gt;tx_flow
op_assign
(paren
id|tx_flow
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|np-&gt;rx_flow
op_assign
(paren
id|rx_flow
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tx_coalesce
OL
l_int|1
)paren
id|tx_coalesce
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tx_coalesce
OG
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|tx_coalesce
op_assign
id|TX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
)brace
id|dev-&gt;open
op_assign
op_amp
id|rio_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|rio_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_multicast
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|rio_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
op_amp
id|rio_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
op_amp
id|change_mtu
suffix:semicolon
macro_line|#if 0
id|dev-&gt;features
op_assign
id|NETIF_F_IP_CSUM
suffix:semicolon
macro_line|#endif
id|pci_set_drvdata
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
r_goto
id|err_out_iounmap
suffix:semicolon
id|np-&gt;tx_ring
op_assign
(paren
r_struct
id|netdev_desc
op_star
)paren
id|ring_space
suffix:semicolon
id|np-&gt;tx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
r_goto
id|err_out_unmap_tx
suffix:semicolon
id|np-&gt;rx_ring
op_assign
(paren
r_struct
id|netdev_desc
op_star
)paren
id|ring_space
suffix:semicolon
id|np-&gt;rx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
multiline_comment|/* Parse eeprom data */
id|parse_eeprom
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Find PHY address */
id|err
op_assign
id|find_miiphy
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_unmap_rx
suffix:semicolon
multiline_comment|/* Fiber device? */
id|np-&gt;phy_media
op_assign
(paren
id|readw
c_func
(paren
id|ioaddr
op_plus
id|ASICCtrl
)paren
op_amp
id|PhyMedia
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|np-&gt;link_status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set media and reset PHY */
r_if
c_cond
(paren
id|np-&gt;phy_media
)paren
(brace
multiline_comment|/* default Auto-Negotiation for fiber deivices */
r_if
c_cond
(paren
id|np-&gt;an_enable
op_eq
l_int|2
)paren
(brace
id|np-&gt;an_enable
op_assign
l_int|1
suffix:semicolon
)brace
id|mii_set_media_pcs
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Auto-Negotiation is mandatory for 1000BASE-T,&n;&t;&t;   IEEE 802.3ab Annex 28D page 14 */
r_if
c_cond
(paren
id|np-&gt;speed
op_eq
l_int|1000
)paren
id|np-&gt;an_enable
op_assign
l_int|1
suffix:semicolon
id|mii_set_media
(paren
id|dev
)paren
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|np-&gt;pci_rev_id
)paren
suffix:semicolon
id|err
op_assign
id|register_netdev
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_unmap_rx
suffix:semicolon
id|card_idx
op_increment
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: %s, %02x:%02x:%02x:%02x:%02x:%02x, IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;name
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_coalesce
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tx_coalesce:&bslash;t%d packets&bslash;n&quot;
comma
id|tx_coalesce
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;coalesce
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;rx_coalesce:&bslash;t%d packets&bslash;n&quot;
id|KERN_INFO
l_string|&quot;rx_timeout: &bslash;t%d ns&bslash;n&quot;
comma
id|np-&gt;rx_coalesce
comma
id|np-&gt;rx_timeout
op_star
l_int|640
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;vlan
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;vlan(id):&bslash;t%d&bslash;n&quot;
comma
id|np-&gt;vlan
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_unmap_rx
suffix:colon
id|pci_free_consistent
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|err_out_unmap_tx
suffix:colon
id|pci_free_consistent
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
id|err_out_iounmap
suffix:colon
macro_line|#ifdef MEM_MAPPING
id|iounmap
(paren
(paren
r_void
op_star
)paren
id|ioaddr
)paren
suffix:semicolon
id|err_out_dev
suffix:colon
macro_line|#endif
id|free_netdev
(paren
id|dev
)paren
suffix:semicolon
id|err_out_res
suffix:colon
id|pci_release_regions
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable
suffix:colon
id|pci_disable_device
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_int
DECL|function|find_miiphy
id|find_miiphy
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|phy_found
op_assign
l_int|0
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|np-&gt;phy_addr
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|mii_status
op_assign
id|mii_read
(paren
id|dev
comma
id|i
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|np-&gt;phy_addr
op_assign
id|i
suffix:semicolon
id|phy_found
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|phy_found
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: No MII PHY found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|parse_eeprom
id|parse_eeprom
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u8
id|sromdata
(braket
l_int|256
)braket
suffix:semicolon
id|u8
op_star
id|psib
suffix:semicolon
id|u32
id|crc
suffix:semicolon
id|PSROM_t
id|psrom
op_assign
(paren
id|PSROM_t
)paren
id|sromdata
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|cid
comma
id|next
suffix:semicolon
macro_line|#ifdef&t;MEM_MAPPING
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|np-&gt;pdev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Read eeprom */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u16
op_star
)paren
id|sromdata
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
(paren
id|read_eeprom
(paren
id|ioaddr
comma
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;MEM_MAPPING
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
macro_line|#endif&t;
multiline_comment|/* Check CRC */
id|crc
op_assign
op_complement
id|ether_crc_le
(paren
l_int|256
op_minus
l_int|4
comma
id|sromdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psrom-&gt;crc
op_ne
id|crc
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: EEPROM data CRC error.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set MAC address */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|psrom-&gt;mac_addr
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* Parse Software Infomation Block */
id|i
op_assign
l_int|0x30
suffix:semicolon
id|psib
op_assign
(paren
id|u8
op_star
)paren
id|sromdata
suffix:semicolon
r_do
(brace
id|cid
op_assign
id|psib
(braket
id|i
op_increment
)braket
suffix:semicolon
id|next
op_assign
id|psib
(braket
id|i
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cid
op_eq
l_int|0
op_logical_and
id|next
op_eq
l_int|0
)paren
op_logical_or
(paren
id|cid
op_eq
l_int|0xff
op_logical_and
id|next
op_eq
l_int|0xff
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;Cell data error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cid
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Format version */
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* End of cell */
r_return
l_int|0
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Duplex Polarity */
id|np-&gt;duplex_polarity
op_assign
id|psib
(braket
id|i
)braket
suffix:semicolon
id|writeb
(paren
id|readb
(paren
id|ioaddr
op_plus
id|PhyCtrl
)paren
op_or
id|psib
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|PhyCtrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* Wake Polarity */
id|np-&gt;wake_polarity
op_assign
id|psib
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9
suffix:colon
multiline_comment|/* Adapter description */
id|j
op_assign
(paren
id|next
op_minus
id|i
OG
l_int|255
)paren
ques
c_cond
l_int|255
suffix:colon
id|next
op_minus
id|i
suffix:semicolon
id|memcpy
(paren
id|np-&gt;name
comma
op_amp
(paren
id|psib
(braket
id|i
)braket
)paren
comma
id|j
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|6
suffix:colon
r_case
l_int|7
suffix:colon
r_case
l_int|8
suffix:colon
multiline_comment|/* Reversed */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Unknown cell */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|i
op_assign
id|next
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|rio_open
id|rio_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
id|macctrl
suffix:semicolon
id|i
op_assign
id|request_irq
(paren
id|dev-&gt;irq
comma
op_amp
id|rio_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
multiline_comment|/* Reset all logic functions */
id|writew
(paren
id|GlobalReset
op_or
id|DMAReset
op_or
id|FIFOReset
op_or
id|NetworkReset
op_or
id|HostReset
comma
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* DebugCtrl bit 4, 5, 9 must set */
id|writel
(paren
id|readl
(paren
id|ioaddr
op_plus
id|DebugCtrl
)paren
op_or
l_int|0x0230
comma
id|ioaddr
op_plus
id|DebugCtrl
)paren
suffix:semicolon
multiline_comment|/* Jumbo frame */
r_if
c_cond
(paren
id|np-&gt;jumbo
op_ne
l_int|0
)paren
id|writew
(paren
id|MAX_JUMBO
op_plus
l_int|14
comma
id|ioaddr
op_plus
id|MaxFrameSize
)paren
suffix:semicolon
id|alloc_list
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Get station address */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|writeb
(paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|StationAddr0
op_plus
id|i
)paren
suffix:semicolon
id|set_multicast
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;coalesce
)paren
(brace
id|writel
(paren
id|np-&gt;rx_coalesce
op_or
id|np-&gt;rx_timeout
op_lshift
l_int|16
comma
id|ioaddr
op_plus
id|RxDMAIntCtrl
)paren
suffix:semicolon
)brace
multiline_comment|/* Set RIO to poll every N*320nsec. */
id|writeb
(paren
l_int|0x20
comma
id|ioaddr
op_plus
id|RxDMAPollPeriod
)paren
suffix:semicolon
id|writeb
(paren
l_int|0xff
comma
id|ioaddr
op_plus
id|TxDMAPollPeriod
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x30
comma
id|ioaddr
op_plus
id|RxDMABurstThresh
)paren
suffix:semicolon
id|writeb
(paren
l_int|0x30
comma
id|ioaddr
op_plus
id|RxDMAUrgentThresh
)paren
suffix:semicolon
id|writel
(paren
l_int|0x0007ffff
comma
id|ioaddr
op_plus
id|RmonStatMask
)paren
suffix:semicolon
multiline_comment|/* clear statistics */
id|clear_stats
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* VLAN supported */
r_if
c_cond
(paren
id|np-&gt;vlan
)paren
(brace
multiline_comment|/* priority field in RxDMAIntCtrl  */
id|writel
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|RxDMAIntCtrl
)paren
op_or
l_int|0x7
op_lshift
l_int|10
comma
id|ioaddr
op_plus
id|RxDMAIntCtrl
)paren
suffix:semicolon
multiline_comment|/* VLANId */
id|writew
(paren
id|np-&gt;vlan
comma
id|ioaddr
op_plus
id|VLANId
)paren
suffix:semicolon
multiline_comment|/* Length/Type should be 0x8100 */
id|writel
(paren
l_int|0x8100
op_lshift
l_int|16
op_or
id|np-&gt;vlan
comma
id|ioaddr
op_plus
id|VLANTag
)paren
suffix:semicolon
multiline_comment|/* Enable AutoVLANuntagging, but disable AutoVLANtagging.&n;&t;&t;   VLAN information tagged by TFC&squot; VID, CFI fields. */
id|writel
(paren
id|readl
(paren
id|ioaddr
op_plus
id|MACCtrl
)paren
op_or
id|AutoVLANuntagging
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
)brace
id|init_timer
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|1
op_star
id|HZ
suffix:semicolon
id|np-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;timer.function
op_assign
op_amp
id|rio_timer
suffix:semicolon
id|add_timer
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* Start Tx/Rx */
id|writel
(paren
id|readl
(paren
id|ioaddr
op_plus
id|MACCtrl
)paren
op_or
id|StatsEnable
op_or
id|RxEnable
op_or
id|TxEnable
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
id|macctrl
op_assign
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;vlan
)paren
ques
c_cond
id|AutoVLANuntagging
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;full_duplex
)paren
ques
c_cond
id|DuplexSelect
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;tx_flow
)paren
ques
c_cond
id|TxFlowControlEnable
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;rx_flow
)paren
ques
c_cond
id|RxFlowControlEnable
suffix:colon
l_int|0
suffix:semicolon
id|writew
c_func
(paren
id|macctrl
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Enable default interrupts */
id|EnableInt
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|rio_timer
id|rio_timer
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|1
op_star
id|HZ
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|np-&gt;rx_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Recover rx ring exhausted error */
r_if
c_cond
(paren
id|np-&gt;cur_rx
op_minus
id|np-&gt;old_rx
op_ge
id|RX_RING_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Try to recover rx ring exhausted...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Re-allocate skbuffs to fill the descriptor ring */
r_for
c_loop
(paren
suffix:semicolon
id|np-&gt;cur_rx
op_minus
id|np-&gt;old_rx
OG
l_int|0
suffix:semicolon
id|np-&gt;old_rx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|entry
op_assign
id|np-&gt;old_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
multiline_comment|/* Dropped packets don&squot;t need to re-allocate */
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Still unable to re-allocate Rx skbuff.#%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|entry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
id|skb_reserve
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_assign
id|cpu_to_le64
(paren
id|pci_map_single
(paren
id|np-&gt;pdev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
)paren
suffix:semicolon
)brace
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_or_assign
id|cpu_to_le64
(paren
id|np-&gt;rx_buf_sz
)paren
op_lshift
l_int|48
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* end for */
)brace
multiline_comment|/* end if */
id|spin_unlock_irqrestore
(paren
op_amp
id|np-&gt;rx_lock
comma
id|flags
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|next_tick
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rio_tx_timeout
id|rio_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Tx timed out (%4.4x), is buffer full?&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
)paren
suffix:semicolon
id|rio_free_tx
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
multiline_comment|/* allocate and initialize Tx and Rx descriptors */
r_static
r_void
DECL|function|alloc_list
id|alloc_list
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np-&gt;cur_rx
op_assign
id|np-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|np-&gt;old_rx
op_assign
id|np-&gt;old_tx
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PACKET_SIZE
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
multiline_comment|/* Initialize Tx descriptors, TFDListPtr leaves in start_xmit(). */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le64
(paren
id|TFDDone
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|next_desc
op_assign
id|cpu_to_le64
(paren
id|np-&gt;tx_ring_dma
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|TX_RING_SIZE
)paren
op_star
r_sizeof
(paren
r_struct
id|netdev_desc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize Rx descriptors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|next_desc
op_assign
id|cpu_to_le64
(paren
id|np-&gt;rx_ring_dma
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|RX_RING_SIZE
)paren
op_star
r_sizeof
(paren
r_struct
id|netdev_desc
)paren
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|fraginfo
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Allocate the rx buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Allocated fixed size of skbuff */
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: alloc_list: allocate Rx buffer error! &quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|skb_reserve
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header. */
multiline_comment|/* Rubicon now supports 40 bits of addressing space. */
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|fraginfo
op_assign
id|cpu_to_le64
(paren
id|pci_map_single
(paren
id|np-&gt;pdev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|fraginfo
op_or_assign
id|cpu_to_le64
(paren
id|np-&gt;rx_buf_sz
)paren
op_lshift
l_int|48
suffix:semicolon
)brace
multiline_comment|/* Set RFDListPtr */
id|writel
(paren
id|cpu_to_le32
(paren
id|np-&gt;rx_ring_dma
)paren
comma
id|dev-&gt;base_addr
op_plus
id|RFDListPtr0
)paren
suffix:semicolon
id|writel
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|RFDListPtr1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|start_xmit
id|start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|netdev_desc
op_star
id|txdesc
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|u32
id|ioaddr
suffix:semicolon
id|u64
id|tfc_vlan_tag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;link_status
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Link Down */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|entry
op_assign
id|np-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|txdesc
op_assign
op_amp
id|np-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|skb-&gt;ip_summed
op_eq
id|CHECKSUM_HW
)paren
(brace
id|txdesc-&gt;status
op_or_assign
id|cpu_to_le64
(paren
id|TCPChecksumEnable
op_or
id|UDPChecksumEnable
op_or
id|IPChecksumEnable
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|np-&gt;vlan
)paren
(brace
id|tfc_vlan_tag
op_assign
id|cpu_to_le64
(paren
id|VLANTagInsert
)paren
op_or
(paren
id|cpu_to_le64
(paren
id|np-&gt;vlan
)paren
op_lshift
l_int|32
)paren
op_or
(paren
id|cpu_to_le64
(paren
id|skb-&gt;priority
)paren
op_lshift
l_int|45
)paren
suffix:semicolon
)brace
id|txdesc-&gt;fraginfo
op_assign
id|cpu_to_le64
(paren
id|pci_map_single
(paren
id|np-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
)paren
suffix:semicolon
id|txdesc-&gt;fraginfo
op_or_assign
id|cpu_to_le64
(paren
id|skb-&gt;len
)paren
op_lshift
l_int|48
suffix:semicolon
multiline_comment|/* DL2K bug: DMA fails to get next descriptor ptr in 10Mbps mode&n;&t; * Work around: Always use 1 descriptor in 10Mbps mode */
r_if
c_cond
(paren
id|entry
op_mod
id|np-&gt;tx_coalesce
op_eq
l_int|0
op_logical_or
id|np-&gt;speed
op_eq
l_int|10
)paren
id|txdesc-&gt;status
op_assign
id|cpu_to_le64
(paren
id|entry
op_or
id|tfc_vlan_tag
op_or
id|WordAlignDisable
op_or
id|TxDMAIndicate
op_or
(paren
l_int|1
op_lshift
id|FragCountShift
)paren
)paren
suffix:semicolon
r_else
id|txdesc-&gt;status
op_assign
id|cpu_to_le64
(paren
id|entry
op_or
id|tfc_vlan_tag
op_or
id|WordAlignDisable
op_or
(paren
l_int|1
op_lshift
id|FragCountShift
)paren
)paren
suffix:semicolon
multiline_comment|/* TxDMAPollNow */
id|writel
(paren
id|readl
(paren
id|ioaddr
op_plus
id|DMACtrl
)paren
op_or
l_int|0x00001000
comma
id|ioaddr
op_plus
id|DMACtrl
)paren
suffix:semicolon
multiline_comment|/* Schedule ISR */
id|writel
c_func
(paren
l_int|10000
comma
id|ioaddr
op_plus
id|CountDown
)paren
suffix:semicolon
id|np-&gt;cur_tx
op_assign
(paren
id|np-&gt;cur_tx
op_plus
l_int|1
)paren
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|np-&gt;cur_tx
op_minus
id|np-&gt;old_tx
op_plus
id|TX_RING_SIZE
)paren
op_mod
id|TX_RING_SIZE
OL
id|TX_QUEUE_LEN
op_minus
l_int|1
op_logical_and
id|np-&gt;speed
op_ne
l_int|10
)paren
(brace
multiline_comment|/* do nothing */
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
(brace
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* The first TFDListPtr */
r_if
c_cond
(paren
id|readl
(paren
id|dev-&gt;base_addr
op_plus
id|TFDListPtr0
)paren
op_eq
l_int|0
)paren
(brace
id|writel
(paren
id|np-&gt;tx_ring_dma
op_plus
id|entry
op_star
r_sizeof
(paren
r_struct
id|netdev_desc
)paren
comma
id|dev-&gt;base_addr
op_plus
id|TFDListPtr0
)paren
suffix:semicolon
id|writel
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|TFDListPtr1
)paren
suffix:semicolon
)brace
multiline_comment|/* NETDEV WATCHDOG timer */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|irqreturn_t
DECL|function|rio_interrupt
id|rio_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|rgs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_instance
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|int_status
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|cnt
op_assign
id|max_intrloop
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|int_status
op_assign
id|readw
(paren
id|ioaddr
op_plus
id|IntStatus
)paren
suffix:semicolon
id|writew
(paren
id|int_status
comma
id|ioaddr
op_plus
id|IntStatus
)paren
suffix:semicolon
id|int_status
op_and_assign
id|DEFAULT_INTR
suffix:semicolon
r_if
c_cond
(paren
id|int_status
op_eq
l_int|0
op_logical_or
op_decrement
id|cnt
OL
l_int|0
)paren
r_break
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Processing received packets */
r_if
c_cond
(paren
id|int_status
op_amp
id|RxDMAComplete
)paren
id|receive_packet
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* TxDMAComplete interrupt */
r_if
c_cond
(paren
(paren
id|int_status
op_amp
(paren
id|TxDMAComplete
op_or
id|IntRequested
)paren
)paren
)paren
(brace
r_int
id|tx_status
suffix:semicolon
id|tx_status
op_assign
id|readl
(paren
id|ioaddr
op_plus
id|TxStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x01
)paren
id|tx_error
(paren
id|dev
comma
id|tx_status
)paren
suffix:semicolon
multiline_comment|/* Free used tx skbuffs */
id|rio_free_tx
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Handle uncommon events */
r_if
c_cond
(paren
id|int_status
op_amp
(paren
id|HostError
op_or
id|LinkEvent
op_or
id|UpdateStats
)paren
)paren
id|rio_error
(paren
id|dev
comma
id|int_status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;cur_tx
op_ne
id|np-&gt;old_tx
)paren
id|writel
(paren
l_int|100
comma
id|ioaddr
op_plus
id|CountDown
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|rio_free_tx
id|rio_free_tx
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|irq
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|entry
op_assign
id|np-&gt;old_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|tx_use
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|irq
)paren
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;tx_lock
)paren
suffix:semicolon
r_else
id|spin_lock_irqsave
c_func
(paren
op_amp
id|np-&gt;tx_lock
comma
id|flag
)paren
suffix:semicolon
multiline_comment|/* Free used tx skbuffs */
r_while
c_loop
(paren
id|entry
op_ne
id|np-&gt;cur_tx
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_amp
id|TFDDone
)paren
)paren
r_break
suffix:semicolon
id|skb
op_assign
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|pci_unmap_single
(paren
id|np-&gt;pdev
comma
id|np-&gt;tx_ring
(braket
id|entry
)braket
dot
id|fraginfo
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
)paren
id|dev_kfree_skb_irq
(paren
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
id|entry
op_assign
(paren
id|entry
op_plus
l_int|1
)paren
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|tx_use
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
)paren
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;tx_lock
)paren
suffix:semicolon
r_else
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|np-&gt;tx_lock
comma
id|flag
)paren
suffix:semicolon
id|np-&gt;old_tx
op_assign
id|entry
suffix:semicolon
multiline_comment|/* If the ring is no longer full, clear tx_full and &n;&t;   call netif_wake_queue() */
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
op_logical_and
(paren
(paren
id|np-&gt;cur_tx
op_minus
id|np-&gt;old_tx
op_plus
id|TX_RING_SIZE
)paren
op_mod
id|TX_RING_SIZE
OL
id|TX_QUEUE_LEN
op_minus
l_int|1
op_logical_or
id|np-&gt;speed
op_eq
l_int|10
)paren
)paren
(brace
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|tx_error
id|tx_error
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|tx_status
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|frame_id
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|frame_id
op_assign
(paren
id|tx_status
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: Transmit error, TxStatus %4.4x, FrameId %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tx_status
comma
id|frame_id
)paren
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Ttransmit Underrun */
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x10
)paren
(brace
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|writew
(paren
id|readw
(paren
id|ioaddr
op_plus
id|TxStartThresh
)paren
op_plus
l_int|0x10
comma
id|ioaddr
op_plus
id|TxStartThresh
)paren
suffix:semicolon
multiline_comment|/* Transmit Underrun need to set TxReset, DMARest, FIFOReset */
id|writew
(paren
id|TxReset
op_or
id|DMAReset
op_or
id|FIFOReset
op_or
id|NetworkReset
comma
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Wait for ResetBusy bit clear */
r_for
c_loop
(paren
id|i
op_assign
l_int|50
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|readw
(paren
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
op_amp
id|ResetBusy
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|rio_free_tx
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Reset TFDListPtr */
id|writel
(paren
id|np-&gt;tx_ring_dma
op_plus
id|np-&gt;old_tx
op_star
r_sizeof
(paren
r_struct
id|netdev_desc
)paren
comma
id|dev-&gt;base_addr
op_plus
id|TFDListPtr0
)paren
suffix:semicolon
id|writel
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|TFDListPtr1
)paren
suffix:semicolon
multiline_comment|/* Let TxStartThresh stay default value */
)brace
multiline_comment|/* Late Collision */
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x04
)paren
(brace
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
multiline_comment|/* TxReset and clear FIFO */
id|writew
(paren
id|TxReset
op_or
id|FIFOReset
comma
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Wait reset done */
r_for
c_loop
(paren
id|i
op_assign
l_int|50
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|readw
(paren
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
op_amp
id|ResetBusy
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Let TxStartThresh stay default value */
)brace
multiline_comment|/* Maximum Collisions */
macro_line|#ifdef ETHER_STATS&t;
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x08
)paren
id|np-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|tx_status
op_amp
l_int|0x08
)paren
id|np-&gt;stats.collisions
op_increment
suffix:semicolon
macro_line|#endif
multiline_comment|/* Restart the Tx */
id|writel
(paren
id|readw
(paren
id|dev-&gt;base_addr
op_plus
id|MACCtrl
)paren
op_or
id|TxEnable
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|receive_packet
id|receive_packet
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|entry
op_assign
id|np-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|cnt
op_assign
l_int|30
suffix:semicolon
multiline_comment|/* If RFDDone, FrameStart and FrameEnd set, there is a new packet in. */
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_struct
id|netdev_desc
op_star
id|desc
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|entry
)braket
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
id|u64
id|frame_status
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|desc-&gt;status
op_amp
id|RFDDone
)paren
op_logical_or
op_logical_neg
(paren
id|desc-&gt;status
op_amp
id|FrameStart
)paren
op_logical_or
op_logical_neg
(paren
id|desc-&gt;status
op_amp
id|FrameEnd
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* Chip omits the CRC. */
id|pkt_len
op_assign
id|le64_to_cpu
(paren
id|desc-&gt;status
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|frame_status
op_assign
id|le64_to_cpu
(paren
id|desc-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cnt
OL
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* Update rx error statistics, drop packet. */
r_if
c_cond
(paren
id|frame_status
op_amp
id|RFS_Errors
)paren
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|frame_status
op_amp
(paren
id|RxRuntFrame
op_or
id|RxLengthError
)paren
)paren
id|np-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|frame_status
op_amp
id|RxFCSError
)paren
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|frame_status
op_amp
id|RxAlignmentError
op_logical_and
id|np-&gt;speed
op_ne
l_int|1000
)paren
id|np-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|frame_status
op_amp
id|RxFIFOOverrun
)paren
id|np-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* Small skbuffs for short packets */
r_if
c_cond
(paren
id|pkt_len
OG
id|copy_thresh
)paren
(brace
id|pci_unmap_single
(paren
id|np-&gt;pdev
comma
id|desc-&gt;fraginfo
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
(paren
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
comma
id|pkt_len
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|pci_dma_sync_single_for_cpu
c_func
(paren
id|np-&gt;pdev
comma
id|desc-&gt;fraginfo
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
id|skb_reserve
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|eth_copy_and_sum
(paren
id|skb
comma
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|pci_dma_sync_single_for_device
c_func
(paren
id|np-&gt;pdev
comma
id|desc-&gt;fraginfo
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#if 0&t;&t;&t;
multiline_comment|/* Checksum done by hw, but csum value unavailable. */
r_if
c_cond
(paren
id|np-&gt;pci_rev_id
op_ge
l_int|0x0c
op_logical_and
op_logical_neg
(paren
id|frame_status
op_amp
(paren
id|TCPError
op_or
id|UDPError
op_or
id|IPError
)paren
)paren
)paren
(brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
)brace
macro_line|#endif
id|netif_rx
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
)brace
id|entry
op_assign
(paren
id|entry
op_plus
l_int|1
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;rx_lock
)paren
suffix:semicolon
id|np-&gt;cur_rx
op_assign
id|entry
suffix:semicolon
multiline_comment|/* Re-allocate skbuffs to fill the descriptor ring */
id|entry
op_assign
id|np-&gt;old_rx
suffix:semicolon
r_while
c_loop
(paren
id|entry
op_ne
id|np-&gt;cur_rx
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* Dropped packets don&squot;t need to re-allocate */
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: receive_packet: &quot;
l_string|&quot;Unable to re-allocate Rx skbuff.#%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|entry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|np-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
id|skb_reserve
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_assign
id|cpu_to_le64
(paren
id|pci_map_single
(paren
id|np-&gt;pdev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
)paren
suffix:semicolon
)brace
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|fraginfo
op_or_assign
id|cpu_to_le64
(paren
id|np-&gt;rx_buf_sz
)paren
op_lshift
l_int|48
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|entry
op_assign
(paren
id|entry
op_plus
l_int|1
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
id|np-&gt;old_rx
op_assign
id|entry
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;rx_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|rio_error
id|rio_error
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|int_status
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u16
id|macctrl
suffix:semicolon
multiline_comment|/* Link change event */
r_if
c_cond
(paren
id|int_status
op_amp
id|LinkEvent
)paren
(brace
r_if
c_cond
(paren
id|mii_wait_link
(paren
id|dev
comma
l_int|10
)paren
op_eq
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Link up&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;phy_media
)paren
id|mii_get_media_pcs
(paren
id|dev
)paren
suffix:semicolon
r_else
id|mii_get_media
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;speed
op_eq
l_int|1000
)paren
id|np-&gt;tx_coalesce
op_assign
id|tx_coalesce
suffix:semicolon
r_else
id|np-&gt;tx_coalesce
op_assign
l_int|1
suffix:semicolon
id|macctrl
op_assign
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;vlan
)paren
ques
c_cond
id|AutoVLANuntagging
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;full_duplex
)paren
ques
c_cond
id|DuplexSelect
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;tx_flow
)paren
ques
c_cond
id|TxFlowControlEnable
suffix:colon
l_int|0
suffix:semicolon
id|macctrl
op_or_assign
(paren
id|np-&gt;rx_flow
)paren
ques
c_cond
id|RxFlowControlEnable
suffix:colon
l_int|0
suffix:semicolon
id|writew
c_func
(paren
id|macctrl
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
id|np-&gt;link_status
op_assign
l_int|1
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Link off&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|np-&gt;link_status
op_assign
l_int|0
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* UpdateStats statistics registers */
r_if
c_cond
(paren
id|int_status
op_amp
id|UpdateStats
)paren
(brace
id|get_stats
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* PCI Error, a catastronphic error related to the bus interface &n;&t;   occurs, set GlobalReset and HostReset to reset. */
r_if
c_cond
(paren
id|int_status
op_amp
id|HostError
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;%s: HostError! IntStatus %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|int_status
)paren
suffix:semicolon
id|writew
(paren
id|GlobalReset
op_or
id|HostReset
comma
id|ioaddr
op_plus
id|ASICCtrl
op_plus
l_int|2
)paren
suffix:semicolon
id|mdelay
(paren
l_int|500
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
id|net_device_stats
op_star
DECL|function|get_stats
id|get_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
r_int
id|i
suffix:semicolon
macro_line|#endif
r_int
r_int
id|stat_reg
suffix:semicolon
multiline_comment|/* All statistics registers need to be acknowledged,&n;&t;   else statistic overflow could cause problems */
id|np-&gt;stats.rx_packets
op_add_assign
id|readl
(paren
id|ioaddr
op_plus
id|FramesRcvOk
)paren
suffix:semicolon
id|np-&gt;stats.tx_packets
op_add_assign
id|readl
(paren
id|ioaddr
op_plus
id|FramesXmtOk
)paren
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_add_assign
id|readl
(paren
id|ioaddr
op_plus
id|OctetRcvOk
)paren
suffix:semicolon
id|np-&gt;stats.tx_bytes
op_add_assign
id|readl
(paren
id|ioaddr
op_plus
id|OctetXmtOk
)paren
suffix:semicolon
id|np-&gt;stats.multicast
op_assign
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesRcvdOk
)paren
suffix:semicolon
id|np-&gt;stats.collisions
op_add_assign
id|readl
(paren
id|ioaddr
op_plus
id|SingleColFrames
)paren
op_plus
id|readl
(paren
id|ioaddr
op_plus
id|MultiColFrames
)paren
suffix:semicolon
multiline_comment|/* detailed tx errors */
id|stat_reg
op_assign
id|readw
(paren
id|ioaddr
op_plus
id|FramesAbortXSColls
)paren
suffix:semicolon
id|np-&gt;stats.tx_aborted_errors
op_add_assign
id|stat_reg
suffix:semicolon
id|np-&gt;stats.tx_errors
op_add_assign
id|stat_reg
suffix:semicolon
id|stat_reg
op_assign
id|readw
(paren
id|ioaddr
op_plus
id|CarrierSenseErrors
)paren
suffix:semicolon
id|np-&gt;stats.tx_carrier_errors
op_add_assign
id|stat_reg
suffix:semicolon
id|np-&gt;stats.tx_errors
op_add_assign
id|stat_reg
suffix:semicolon
multiline_comment|/* Clear all other statistic register. */
id|readl
(paren
id|ioaddr
op_plus
id|McstOctetXmtOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesXmtdOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesXmtdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesRcvdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|MacControlFramesRcvd
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FrameTooLongErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|InRangeLengthErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesCheckSeqErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesLostRxErrors
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstOctetXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|BcstOctetXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesXmtdOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|FramesWDeferredXmt
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|LateCollisions
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesXmtdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|MacControlFramesXmtd
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesWEXDeferal
)paren
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
r_for
c_loop
(paren
id|i
op_assign
l_int|0x100
suffix:semicolon
id|i
op_le
l_int|0x150
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|readl
(paren
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
macro_line|#endif
id|readw
(paren
id|ioaddr
op_plus
id|TxJumboFrames
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|RxJumboFrames
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|TCPCheckSumErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|UDPCheckSumErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|IPCheckSumErrors
)paren
suffix:semicolon
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
r_static
r_int
DECL|function|clear_stats
id|clear_stats
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
r_int
id|i
suffix:semicolon
macro_line|#endif 
multiline_comment|/* All statistics registers need to be acknowledged,&n;&t;   else statistic overflow could cause problems */
id|readl
(paren
id|ioaddr
op_plus
id|FramesRcvOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|FramesXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|OctetRcvOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|OctetXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesRcvdOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|SingleColFrames
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|MultiColFrames
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|LateCollisions
)paren
suffix:semicolon
multiline_comment|/* detailed rx errors */
id|readw
(paren
id|ioaddr
op_plus
id|FrameTooLongErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|InRangeLengthErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesCheckSeqErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesLostRxErrors
)paren
suffix:semicolon
multiline_comment|/* detailed tx errors */
id|readw
(paren
id|ioaddr
op_plus
id|FramesAbortXSColls
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|CarrierSenseErrors
)paren
suffix:semicolon
multiline_comment|/* Clear all other statistic register. */
id|readl
(paren
id|ioaddr
op_plus
id|McstOctetXmtOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesXmtdOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesXmtdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesRcvdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|MacControlFramesRcvd
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstOctetXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|BcstOctetXmtOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|McstFramesXmtdOk
)paren
suffix:semicolon
id|readl
(paren
id|ioaddr
op_plus
id|FramesWDeferredXmt
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|BcstFramesXmtdOk
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|MacControlFramesXmtd
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|FramesWEXDeferal
)paren
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
r_for
c_loop
(paren
id|i
op_assign
l_int|0x100
suffix:semicolon
id|i
op_le
l_int|0x150
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|readl
(paren
id|ioaddr
op_plus
id|i
)paren
suffix:semicolon
macro_line|#endif 
id|readw
(paren
id|ioaddr
op_plus
id|TxJumboFrames
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|RxJumboFrames
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|TCPCheckSumErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|UDPCheckSumErrors
)paren
suffix:semicolon
id|readw
(paren
id|ioaddr
op_plus
id|IPCheckSumErrors
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|change_mtu
id|change_mtu
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|max
op_assign
(paren
id|np-&gt;jumbo
)paren
ques
c_cond
id|MAX_JUMBO
suffix:colon
l_int|1536
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
id|max
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|set_multicast
id|set_multicast
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|hash_table
(braket
l_int|2
)braket
suffix:semicolon
id|u16
id|rx_mode
op_assign
l_int|0
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hash_table
(braket
l_int|0
)braket
op_assign
id|hash_table
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* RxFlowcontrol DA: 01-80-C2-00-00-01. Hash index=0x39 */
id|hash_table
(braket
l_int|1
)braket
op_or_assign
id|cpu_to_le32
c_func
(paren
l_int|0x02000000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Receive all frames promiscuously. */
id|rx_mode
op_assign
id|ReceiveAllFrames
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
)paren
(brace
multiline_comment|/* Receive broadcast and multicast frames */
id|rx_mode
op_assign
id|ReceiveBroadcast
op_or
id|ReceiveMulticast
op_or
id|ReceiveUnicast
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
multiline_comment|/* Receive broadcast frames and multicast frames filtering &n;&t;&t;   by Hashtable */
id|rx_mode
op_assign
id|ReceiveBroadcast
op_or
id|ReceiveMulticastHash
op_or
id|ReceiveUnicast
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|bit
comma
id|index
op_assign
l_int|0
suffix:semicolon
r_int
id|crc
op_assign
id|ether_crc_le
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
suffix:semicolon
multiline_comment|/* The inverted high significant 6 bits of CRC are&n;&t;&t;&t;   used as an index to hashtable */
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|6
suffix:semicolon
id|bit
op_increment
)paren
r_if
c_cond
(paren
id|crc
op_amp
(paren
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|bit
)paren
)paren
)paren
id|index
op_or_assign
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
id|hash_table
(braket
id|index
op_div
l_int|32
)braket
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|index
op_mod
l_int|32
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|rx_mode
op_assign
id|ReceiveBroadcast
op_or
id|ReceiveUnicast
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;vlan
)paren
(brace
multiline_comment|/* ReceiveVLANMatch field in ReceiveMode */
id|rx_mode
op_or_assign
id|ReceiveVLANMatch
suffix:semicolon
)brace
id|writel
(paren
id|hash_table
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
id|HashTable0
)paren
suffix:semicolon
id|writel
(paren
id|hash_table
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
id|HashTable1
)paren
suffix:semicolon
id|writew
(paren
id|rx_mode
comma
id|ioaddr
op_plus
id|ReceiveMode
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rio_ethtool_ioctl
id|rio_ethtool_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
id|__user
op_star
id|useraddr
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|ethcmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
(paren
op_amp
id|ethcmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
c_func
(paren
id|info.driver
comma
l_string|&quot;DL2K&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info.version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info.bus_info
comma
id|pci_name
c_func
(paren
id|np-&gt;pdev
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info.fw_version
comma
l_int|0
comma
r_sizeof
(paren
id|info.fw_version
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
op_assign
(brace
id|ETHTOOL_GSET
)brace
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;phy_media
)paren
(brace
multiline_comment|/* fiber device */
id|cmd.supported
op_assign
id|SUPPORTED_Autoneg
op_or
id|SUPPORTED_FIBRE
suffix:semicolon
id|cmd.advertising
op_assign
id|ADVERTISED_Autoneg
op_or
id|ADVERTISED_FIBRE
suffix:semicolon
id|cmd.port
op_assign
id|PORT_FIBRE
suffix:semicolon
id|cmd.transceiver
op_assign
id|XCVR_INTERNAL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* copper device */
id|cmd.supported
op_assign
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_100baseT_Half
op_or
id|SUPPORTED_100baseT_Full
op_or
id|SUPPORTED_1000baseT_Full
op_or
id|SUPPORTED_Autoneg
op_or
id|SUPPORTED_MII
suffix:semicolon
id|cmd.advertising
op_assign
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_100baseT_Half
op_or
id|ADVERTISED_100baseT_Full
op_or
id|ADVERTISED_1000baseT_Full
op_or
id|ADVERTISED_Autoneg
op_or
id|ADVERTISED_MII
suffix:semicolon
id|cmd.port
op_assign
id|PORT_MII
suffix:semicolon
id|cmd.transceiver
op_assign
id|XCVR_INTERNAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;link_status
)paren
(brace
id|cmd.speed
op_assign
id|np-&gt;speed
suffix:semicolon
id|cmd.duplex
op_assign
id|np-&gt;full_duplex
ques
c_cond
id|DUPLEX_FULL
suffix:colon
id|DUPLEX_HALF
suffix:semicolon
)brace
r_else
(brace
id|cmd.speed
op_assign
op_minus
l_int|1
suffix:semicolon
id|cmd.duplex
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
id|cmd.autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
r_else
id|cmd.autoneg
op_assign
id|AUTONEG_DISABLE
suffix:semicolon
id|cmd.phy_address
op_assign
id|np-&gt;phy_addr
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|cmd
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|cmd
comma
id|useraddr
comma
r_sizeof
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
r_return
l_int|0
suffix:semicolon
r_else
(brace
id|np-&gt;an_enable
op_assign
l_int|1
suffix:semicolon
id|mii_set_media
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;an_enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;speed
op_eq
l_int|1000
)paren
(brace
id|cmd.speed
op_assign
id|SPEED_100
suffix:semicolon
id|cmd.duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Warning!! Can&squot;t disable Auto negotiation in 1000Mbps, change to Manul 100Mbps, Full duplex.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd.speed
op_plus
id|cmd.duplex
)paren
(brace
r_case
id|SPEED_10
op_plus
id|DUPLEX_HALF
suffix:colon
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_10
op_plus
id|DUPLEX_FULL
suffix:colon
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_100
op_plus
id|DUPLEX_HALF
suffix:colon
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_100
op_plus
id|DUPLEX_FULL
suffix:colon
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_1000
op_plus
id|DUPLEX_HALF
suffix:colon
multiline_comment|/* not supported */
r_case
id|SPEED_1000
op_plus
id|DUPLEX_FULL
suffix:colon
multiline_comment|/* not supported */
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|mii_set_media
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef ETHTOOL_GLINK&t;&t;
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|link
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|link.data
op_assign
id|np-&gt;link_status
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|link
comma
r_sizeof
(paren
id|link
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|rio_ioctl
id|rio_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|mii_data
op_star
id|miidata
op_assign
(paren
r_struct
id|mii_data
op_star
)paren
op_amp
id|rq-&gt;ifr_ifru
suffix:semicolon
r_struct
id|netdev_desc
op_star
id|desc
suffix:semicolon
r_int
id|i
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|rio_ethtool_ioctl
c_func
(paren
id|dev
comma
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
suffix:colon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
id|miidata-&gt;out_value
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|miidata-&gt;reg_num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|miidata-&gt;reg_num
comma
id|miidata-&gt;in_value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|3
suffix:colon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|4
suffix:colon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|5
suffix:colon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|6
suffix:colon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|7
suffix:colon
id|printk
(paren
l_string|&quot;tx_full=%x cur_tx=%lx old_tx=%lx cur_rx=%lx old_rx=%lx&bslash;n&quot;
comma
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
comma
id|np-&gt;cur_tx
comma
id|np-&gt;old_tx
comma
id|np-&gt;cur_rx
comma
id|np-&gt;old_rx
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|8
suffix:colon
id|printk
c_func
(paren
l_string|&quot;TX ring:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|desc
op_assign
op_amp
id|np-&gt;tx_ring
(braket
id|i
)braket
suffix:semicolon
id|printk
(paren
l_string|&quot;%02x:cur:%08x next:%08x status:%08x frag1:%08x frag0:%08x&quot;
comma
id|i
comma
(paren
id|u32
)paren
(paren
id|np-&gt;tx_ring_dma
op_plus
id|i
op_star
r_sizeof
(paren
op_star
id|desc
)paren
)paren
comma
(paren
id|u32
)paren
id|desc-&gt;next_desc
comma
(paren
id|u32
)paren
id|desc-&gt;status
comma
(paren
id|u32
)paren
(paren
id|desc-&gt;fraginfo
op_rshift
l_int|32
)paren
comma
(paren
id|u32
)paren
id|desc-&gt;fraginfo
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|EEP_READ
mdefine_line|#define EEP_READ 0x0200
DECL|macro|EEP_BUSY
mdefine_line|#define EEP_BUSY 0x8000
multiline_comment|/* Read the EEPROM word */
multiline_comment|/* We use I/O instruction to read/write eeprom to avoid fail on some machines */
r_int
DECL|function|read_eeprom
id|read_eeprom
(paren
r_int
id|ioaddr
comma
r_int
id|eep_addr
)paren
(brace
r_int
id|i
op_assign
l_int|1000
suffix:semicolon
id|outw
(paren
id|EEP_READ
op_or
(paren
id|eep_addr
op_amp
l_int|0xff
)paren
comma
id|ioaddr
op_plus
id|EepromCtrl
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
(paren
id|ioaddr
op_plus
id|EepromCtrl
)paren
op_amp
id|EEP_BUSY
)paren
)paren
(brace
r_return
id|inw
(paren
id|ioaddr
op_plus
id|EepromData
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|enum|phy_ctrl_bits
r_enum
id|phy_ctrl_bits
(brace
DECL|enumerator|MII_READ
DECL|enumerator|MII_CLK
DECL|enumerator|MII_DATA1
DECL|enumerator|MII_WRITE
id|MII_READ
op_assign
l_int|0x00
comma
id|MII_CLK
op_assign
l_int|0x01
comma
id|MII_DATA1
op_assign
l_int|0x02
comma
id|MII_WRITE
op_assign
l_int|0x04
comma
DECL|enumerator|MII_DUPLEX
id|MII_DUPLEX
op_assign
l_int|0x08
comma
)brace
suffix:semicolon
DECL|macro|mii_delay
mdefine_line|#define mii_delay() readb(ioaddr)
r_static
r_void
DECL|function|mii_sendbit
id|mii_sendbit
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|data
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
op_plus
id|PhyCtrl
suffix:semicolon
id|data
op_assign
(paren
id|data
)paren
ques
c_cond
id|MII_DATA1
suffix:colon
l_int|0
suffix:semicolon
id|data
op_or_assign
id|MII_WRITE
suffix:semicolon
id|data
op_or_assign
(paren
id|readb
(paren
id|ioaddr
)paren
op_amp
l_int|0xf8
)paren
op_or
id|MII_WRITE
suffix:semicolon
id|writeb
(paren
id|data
comma
id|ioaddr
)paren
suffix:semicolon
id|mii_delay
(paren
)paren
suffix:semicolon
id|writeb
(paren
id|data
op_or
id|MII_CLK
comma
id|ioaddr
)paren
suffix:semicolon
id|mii_delay
(paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_getbit
id|mii_getbit
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
op_plus
id|PhyCtrl
suffix:semicolon
id|u8
id|data
suffix:semicolon
id|data
op_assign
(paren
id|readb
(paren
id|ioaddr
)paren
op_amp
l_int|0xf8
)paren
op_or
id|MII_READ
suffix:semicolon
id|writeb
(paren
id|data
comma
id|ioaddr
)paren
suffix:semicolon
id|mii_delay
(paren
)paren
suffix:semicolon
id|writeb
(paren
id|data
op_or
id|MII_CLK
comma
id|ioaddr
)paren
suffix:semicolon
id|mii_delay
(paren
)paren
suffix:semicolon
r_return
(paren
(paren
id|readb
(paren
id|ioaddr
)paren
op_rshift
l_int|1
)paren
op_amp
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|mii_send_bits
id|mii_send_bits
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|data
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|len
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|mii_sendbit
(paren
id|dev
comma
id|data
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|mii_read
id|mii_read
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
r_int
id|reg_num
)paren
(brace
id|u32
id|cmd
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u32
id|retval
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Preamble */
id|mii_send_bits
(paren
id|dev
comma
l_int|0xffffffff
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* ST(2), OP(2), ADDR(5), REG#(5), TA(2), Data(16) total 32 bits */
multiline_comment|/* ST,OP = 0110&squot;b for read operation */
id|cmd
op_assign
(paren
l_int|0x06
op_lshift
l_int|10
op_or
id|phy_addr
op_lshift
l_int|5
op_or
id|reg_num
)paren
suffix:semicolon
id|mii_send_bits
(paren
id|dev
comma
id|cmd
comma
l_int|14
)paren
suffix:semicolon
multiline_comment|/* Turnaround */
r_if
c_cond
(paren
id|mii_getbit
(paren
id|dev
)paren
)paren
r_goto
id|err_out
suffix:semicolon
multiline_comment|/* Read data */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|retval
op_or_assign
id|mii_getbit
(paren
id|dev
)paren
suffix:semicolon
id|retval
op_lshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* End cycle */
id|mii_getbit
(paren
id|dev
)paren
suffix:semicolon
r_return
(paren
id|retval
op_rshift
l_int|1
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|err_out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_write
id|mii_write
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
r_int
id|reg_num
comma
id|u16
id|data
)paren
(brace
id|u32
id|cmd
suffix:semicolon
multiline_comment|/* Preamble */
id|mii_send_bits
(paren
id|dev
comma
l_int|0xffffffff
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* ST(2), OP(2), ADDR(5), REG#(5), TA(2), Data(16) total 32 bits */
multiline_comment|/* ST,OP,AAAAA,RRRRR,TA = 0101xxxxxxxxxx10&squot;b = 0x5002 for write */
id|cmd
op_assign
(paren
l_int|0x5002
op_lshift
l_int|16
)paren
op_or
(paren
id|phy_addr
op_lshift
l_int|23
)paren
op_or
(paren
id|reg_num
op_lshift
l_int|18
)paren
op_or
id|data
suffix:semicolon
id|mii_send_bits
(paren
id|dev
comma
id|cmd
comma
l_int|32
)paren
suffix:semicolon
multiline_comment|/* End cycle */
id|mii_getbit
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_wait_link
id|mii_wait_link
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|wait
)paren
(brace
id|BMSR_t
id|bmsr
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
r_do
(brace
id|bmsr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmsr.bits.link_status
)paren
r_return
l_int|0
suffix:semicolon
id|mdelay
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|wait
OG
l_int|0
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_get_media
id|mii_get_media
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ANAR_t
id|negotiate
suffix:semicolon
id|BMSR_t
id|bmsr
suffix:semicolon
id|BMCR_t
id|bmcr
suffix:semicolon
id|MSCR_t
id|mscr
suffix:semicolon
id|MSSR_t
id|mssr
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
id|bmsr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bmsr.bits.an_complete
)paren
(brace
multiline_comment|/* Auto-Negotiation not completed */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|negotiate.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
)paren
op_amp
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANLPAR
)paren
suffix:semicolon
id|mscr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_MSCR
)paren
suffix:semicolon
id|mssr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_MSSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mscr.bits.media_1000BT_FD
op_amp
id|mssr.bits.lp_1000BT_FD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|1000
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 1000 Mbps, Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mscr.bits.media_1000BT_HD
op_amp
id|mssr.bits.lp_1000BT_HD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|1000
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 1000 Mbps, Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.media_100BX_FD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 100 Mbps, Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.media_100BX_HD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|100
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 100 Mbps, Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.media_10BT_FD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 10 Mbps, Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.media_10BT_HD
)paren
(brace
id|np-&gt;speed
op_assign
l_int|10
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 10 Mbps, Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|negotiate.bits.pause
)paren
(brace
id|np-&gt;tx_flow
op_and_assign
l_int|1
suffix:semicolon
id|np-&gt;rx_flow
op_and_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.asymmetric
)paren
(brace
id|np-&gt;tx_flow
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_flow
op_and_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* else tx_flow, rx_flow = user select  */
)brace
r_else
(brace
id|bmcr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmcr.bits.speed100
op_eq
l_int|1
op_logical_and
id|bmcr.bits.speed1000
op_eq
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Operating at 100 Mbps, &quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bmcr.bits.speed100
op_eq
l_int|0
op_logical_and
id|bmcr.bits.speed1000
op_eq
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Operating at 10 Mbps, &quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bmcr.bits.speed100
op_eq
l_int|0
op_logical_and
id|bmcr.bits.speed1000
op_eq
l_int|1
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Operating at 1000 Mbps, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmcr.bits.duplex_mode
)paren
(brace
id|printk
(paren
l_string|&quot;Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|np-&gt;tx_flow
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Enable Tx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Disable Tx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_flow
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Enable Rx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Disable Rx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_set_media
id|mii_set_media
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|PHY_SCR_t
id|pscr
suffix:semicolon
id|BMCR_t
id|bmcr
suffix:semicolon
id|BMSR_t
id|bmsr
suffix:semicolon
id|ANAR_t
id|anar
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
multiline_comment|/* Does user set speed? */
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
(brace
multiline_comment|/* Advertise capabilities */
id|bmsr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMSR
)paren
suffix:semicolon
id|anar.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
)paren
suffix:semicolon
id|anar.bits.media_100BX_FD
op_assign
id|bmsr.bits.media_100BX_FD
suffix:semicolon
id|anar.bits.media_100BX_HD
op_assign
id|bmsr.bits.media_100BX_HD
suffix:semicolon
id|anar.bits.media_100BT4
op_assign
id|bmsr.bits.media_100BT4
suffix:semicolon
id|anar.bits.media_10BT_FD
op_assign
id|bmsr.bits.media_10BT_FD
suffix:semicolon
id|anar.bits.media_10BT_HD
op_assign
id|bmsr.bits.media_10BT_HD
suffix:semicolon
id|anar.bits.pause
op_assign
l_int|1
suffix:semicolon
id|anar.bits.asymmetric
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
comma
id|anar.image
)paren
suffix:semicolon
multiline_comment|/* Enable Auto crossover */
id|pscr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_SCR
)paren
suffix:semicolon
id|pscr.bits.mdi_crossover_mode
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* 11&squot;b */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_SCR
comma
id|pscr.image
)paren
suffix:semicolon
multiline_comment|/* Soft reset PHY */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|MII_BMCR_RESET
)paren
suffix:semicolon
id|bmcr.image
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.an_enable
op_assign
l_int|1
suffix:semicolon
id|bmcr.bits.restart_an
op_assign
l_int|1
suffix:semicolon
id|bmcr.bits.reset
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Force speed setting */
multiline_comment|/* 1) Disable Auto crossover */
id|pscr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_SCR
)paren
suffix:semicolon
id|pscr.bits.mdi_crossover_mode
op_assign
l_int|0
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_SCR
comma
id|pscr.image
)paren
suffix:semicolon
multiline_comment|/* 2) PHY Reset */
id|bmcr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
)paren
suffix:semicolon
id|bmcr.bits.reset
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
multiline_comment|/* 3) Power Down */
id|bmcr.image
op_assign
l_int|0x1940
suffix:semicolon
multiline_comment|/* must be 0x1940 */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* wait a certain time */
multiline_comment|/* 4) Advertise nothing */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* 5) Set media and Power Up */
id|bmcr.image
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.power_down
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;speed
op_eq
l_int|100
)paren
(brace
id|bmcr.bits.speed100
op_assign
l_int|1
suffix:semicolon
id|bmcr.bits.speed1000
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Manual 100 Mbps, &quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|np-&gt;speed
op_eq
l_int|10
)paren
(brace
id|bmcr.bits.speed100
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.speed1000
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Manual 10 Mbps, &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
(brace
id|bmcr.bits.duplex_mode
op_assign
l_int|1
suffix:semicolon
id|printk
(paren
l_string|&quot;Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|bmcr.bits.duplex_mode
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
l_string|&quot;Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* Set 1000BaseT Master/Slave setting */
id|mscr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_MSCR
)paren
suffix:semicolon
id|mscr.bits.cfg_enable
op_assign
l_int|1
suffix:semicolon
id|mscr.bits.cfg_value
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_get_media_pcs
id|mii_get_media_pcs
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ANAR_PCS_t
id|negotiate
suffix:semicolon
id|BMSR_t
id|bmsr
suffix:semicolon
id|BMCR_t
id|bmcr
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
id|bmsr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|PCS_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bmsr.bits.an_complete
)paren
(brace
multiline_comment|/* Auto-Negotiation not completed */
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|negotiate.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|PCS_ANAR
)paren
op_amp
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|PCS_ANLPAR
)paren
suffix:semicolon
id|np-&gt;speed
op_assign
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
id|negotiate.bits.full_duplex
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 1000 Mbps, Full duplex&bslash;n&quot;
)paren
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;Auto 1000 Mbps, half duplex&bslash;n&quot;
)paren
suffix:semicolon
id|np-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|negotiate.bits.pause
)paren
(brace
id|np-&gt;tx_flow
op_and_assign
l_int|1
suffix:semicolon
id|np-&gt;rx_flow
op_and_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|negotiate.bits.asymmetric
)paren
(brace
id|np-&gt;tx_flow
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_flow
op_and_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* else tx_flow, rx_flow = user select  */
)brace
r_else
(brace
id|bmcr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|PCS_BMCR
)paren
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Operating at 1000 Mbps, &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmcr.bits.duplex_mode
)paren
(brace
id|printk
(paren
l_string|&quot;Full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;Half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|np-&gt;tx_flow
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Enable Tx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Disable Tx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_flow
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Enable Rx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Disable Rx Flow Control&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|mii_set_media_pcs
id|mii_set_media_pcs
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|BMCR_t
id|bmcr
suffix:semicolon
id|ESR_t
id|esr
suffix:semicolon
id|ANAR_PCS_t
id|anar
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|phy_addr
op_assign
id|np-&gt;phy_addr
suffix:semicolon
multiline_comment|/* Auto-Negotiation? */
r_if
c_cond
(paren
id|np-&gt;an_enable
)paren
(brace
multiline_comment|/* Advertise capabilities */
id|esr.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|PCS_ESR
)paren
suffix:semicolon
id|anar.image
op_assign
id|mii_read
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
)paren
suffix:semicolon
id|anar.bits.half_duplex
op_assign
id|esr.bits.media_1000BT_HD
op_or
id|esr.bits.media_1000BX_HD
suffix:semicolon
id|anar.bits.full_duplex
op_assign
id|esr.bits.media_1000BT_FD
op_or
id|esr.bits.media_1000BX_FD
suffix:semicolon
id|anar.bits.pause
op_assign
l_int|1
suffix:semicolon
id|anar.bits.asymmetric
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
comma
id|anar.image
)paren
suffix:semicolon
multiline_comment|/* Soft reset PHY */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|MII_BMCR_RESET
)paren
suffix:semicolon
id|bmcr.image
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.an_enable
op_assign
l_int|1
suffix:semicolon
id|bmcr.bits.restart_an
op_assign
l_int|1
suffix:semicolon
id|bmcr.bits.reset
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Force speed setting */
multiline_comment|/* PHY Reset */
id|bmcr.image
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.reset
op_assign
l_int|1
suffix:semicolon
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|bmcr.image
op_assign
l_int|0
suffix:semicolon
id|bmcr.bits.an_enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
(brace
id|bmcr.bits.duplex_mode
op_assign
l_int|1
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Manual full duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|bmcr.bits.duplex_mode
op_assign
l_int|0
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;Manual half duplex&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_BMCR
comma
id|bmcr.image
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*  Advertise nothing */
id|mii_write
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANAR
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|rio_close
id|rio_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts */
id|writew
(paren
l_int|0
comma
id|ioaddr
op_plus
id|IntEnable
)paren
suffix:semicolon
multiline_comment|/* Stop Tx and Rx logics */
id|writel
(paren
id|TxDisable
op_or
id|RxDisable
op_or
id|StatsDisable
comma
id|ioaddr
op_plus
id|MACCtrl
)paren
suffix:semicolon
id|synchronize_irq
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|free_irq
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|del_timer_sync
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|fraginfo
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
(paren
id|np-&gt;pdev
comma
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|fraginfo
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb
op_assign
id|np-&gt;tx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
(paren
id|np-&gt;pdev
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|fraginfo
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__devexit
DECL|function|rio_remove1
id|rio_remove1
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
id|pci_free_consistent
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|pci_free_consistent
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
macro_line|#ifdef MEM_MAPPING
id|iounmap
(paren
(paren
r_char
op_star
)paren
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
macro_line|#endif
id|free_netdev
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
(paren
id|pdev
)paren
suffix:semicolon
)brace
id|pci_set_drvdata
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|rio_driver
r_static
r_struct
id|pci_driver
id|rio_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dl2k&quot;
comma
dot
id|id_table
op_assign
id|rio_pci_tbl
comma
dot
id|probe
op_assign
id|rio_probe1
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|rio_remove1
)paren
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|rio_init
id|rio_init
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
(paren
op_amp
id|rio_driver
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|rio_exit
id|rio_exit
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|rio_driver
)paren
suffix:semicolon
)brace
DECL|variable|rio_init
id|module_init
(paren
id|rio_init
)paren
suffix:semicolon
DECL|variable|rio_exit
id|module_exit
(paren
id|rio_exit
)paren
suffix:semicolon
multiline_comment|/*&n; &n;Compile command: &n; &n;gcc -D__KERNEL__ -DMODULE -I/usr/src/linux/include -Wall -Wstrict-prototypes -O2 -c dl2k.c&n;&n;Read Documentation/networking/dl2k.txt for details.&n;&n;*/
eof
