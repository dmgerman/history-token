multiline_comment|/* net_init.c: Initialization for network devices. */
multiline_comment|/*&n;&t;Written 1993,1994,1995 by Donald Becker.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;This file contains the initialization for the &quot;pl14+&quot; style ethernet&n;&t;drivers.  It should eventually replace most of drivers/net/Space.c.&n;&t;It&squot;s primary advantage is that it&squot;s able to allocate low-memory buffers.&n;&t;A secondary advantage is that the dangerous NE*000 netcards can reserve&n;&t;their I/O port region before the SCSI probes start.&n;&n;&t;Modifications/additions by Bjorn Ekwall &lt;bj0rn@blox.se&gt;:&n;&t;&t;ethdev_index[MAX_ETH_CARDS]&n;&t;&t;register_netdev() / unregister_netdev()&n;&t;&t;&n;&t;Modifications by Wolfgang Walter&n;&t;&t;Use dev_close cleanly so we always shut things down tidily.&n;&t;&t;&n;&t;Changed 29/10/95, Alan Cox to pass sockaddr&squot;s around for mac addresses.&n;&t;&n;&t;14/06/96 - Paul Gortmaker:&t;Add generic eth_change_mtu() function. &n;&t;24/09/96 - Paul Norton: Add token-ring variants of the netdev functions. &n;&t;&n;&t;08/11/99 - Alan Cox: Got fed up of the mess in this file and cleaned it&n;&t;&t;&t;up. We now share common code and have regularised name&n;&t;&t;&t;allocation setups. Abolished the 16 card limits.&n;&t;03/19/2000 - jgarzik and Urban Widmark: init_etherdev 32-byte align&n;&t;03/21/2001 - jgarzik: alloc_etherdev and friends&n;&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/if_ether.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/fddidevice.h&gt;
macro_line|#include &lt;linux/hippidevice.h&gt;
macro_line|#include &lt;linux/trdevice.h&gt;
macro_line|#include &lt;linux/fcdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/if_ltalk.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;net/neighbour.h&gt;
multiline_comment|/* The network devices currently exist only in the socket namespace, so these&n;   entries are unused.  The only ones that make sense are&n;    open&t;start the ethercard&n;    close&t;stop  the ethercard&n;    ioctl&t;To get statistics, perhaps set the interface port (AUI, BNC, etc.)&n;   One can also imagine getting raw packets using&n;    read &amp; write&n;   but this is probably better handled by a raw packet socket.&n;&n;   Given that almost all of these functions are handled in the current&n;   socket-based scheme, putting ethercard devices in /dev/ seems pointless.&n;   &n;   [Removed all support for /dev network devices. When someone adds&n;    streams then by magic we get them, but otherwise they are un-needed&n;&t;and a space waste]&n;*/
DECL|function|alloc_netdev
r_struct
id|net_device
op_star
id|alloc_netdev
c_func
(paren
r_int
id|sizeof_priv
comma
r_const
r_char
op_star
id|mask
comma
r_void
(paren
op_star
id|setup
)paren
(paren
r_struct
id|net_device
op_star
)paren
)paren
(brace
r_void
op_star
id|p
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|alloc_size
suffix:semicolon
multiline_comment|/* ensure 32-byte alignment of both the device and private area */
id|alloc_size
op_assign
(paren
r_sizeof
(paren
r_struct
id|net_device
)paren
op_plus
id|NETDEV_ALIGN_CONST
)paren
op_amp
op_complement
id|NETDEV_ALIGN_CONST
suffix:semicolon
id|alloc_size
op_add_assign
id|sizeof_priv
op_plus
id|NETDEV_ALIGN_CONST
suffix:semicolon
id|p
op_assign
id|kmalloc
(paren
id|alloc_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;alloc_dev: Unable to allocate device.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
id|alloc_size
)paren
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
(paren
(paren
(paren
r_int
)paren
id|p
op_plus
id|NETDEV_ALIGN_CONST
)paren
op_amp
op_complement
id|NETDEV_ALIGN_CONST
)paren
suffix:semicolon
id|dev-&gt;padded
op_assign
(paren
r_char
op_star
)paren
id|dev
op_minus
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
id|sizeof_priv
)paren
id|dev-&gt;priv
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|setup
c_func
(paren
id|dev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;name
comma
id|mask
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
DECL|variable|alloc_netdev
id|EXPORT_SYMBOL
c_func
(paren
id|alloc_netdev
)paren
suffix:semicolon
DECL|function|register_netdev
r_int
id|register_netdev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;If the name is a format string the caller wants us to&n;&t; *&t;do a name allocation&n;&t; */
r_if
c_cond
(paren
id|strchr
c_func
(paren
id|dev-&gt;name
comma
l_char|&squot;%&squot;
)paren
)paren
(brace
id|err
op_assign
id|dev_alloc_name
c_func
(paren
id|dev
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Back compatibility hook. Kill this one in 2.5&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;name
(braket
l_int|0
)braket
op_eq
l_int|0
op_logical_or
id|dev-&gt;name
(braket
l_int|0
)braket
op_eq
l_char|&squot; &squot;
)paren
(brace
id|err
op_assign
id|dev_alloc_name
c_func
(paren
id|dev
comma
l_string|&quot;eth%d&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|register_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|unregister_netdev
r_void
id|unregister_netdev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|unregister_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|register_netdev
id|EXPORT_SYMBOL
c_func
(paren
id|register_netdev
)paren
suffix:semicolon
DECL|variable|unregister_netdev
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_netdev
)paren
suffix:semicolon
eof
