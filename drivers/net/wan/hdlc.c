multiline_comment|/*&n; * Generic HDLC support routines for Linux&n; *&n; * Copyright (C) 1999, 2000 Krzysztof Halasa &lt;khc@pm.waw.pl&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * Current status:&n; *    - this is work in progress&n; *    - not heavily tested on SMP&n; *    - currently supported:&n; *&t;* raw IP-in-HDLC&n; *&t;* Cisco HDLC&n; *&t;* Frame Relay with ANSI or CCITT LMI (both user and network side)&n; *&t;* PPP (using syncppp.c)&n; *&t;* X.25&n; *&n; * Use sethdlc utility to set line parameters, protocol and PVCs&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/pkt_sched.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/lapb.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/hdlc.h&gt;
multiline_comment|/* #define DEBUG_PKT */
multiline_comment|/* #define DEBUG_HARD_HEADER */
multiline_comment|/* #define DEBUG_FECN */
multiline_comment|/* #define DEBUG_BECN */
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;HDLC support module revision 1.02 for Linux 2.4&quot;
suffix:semicolon
DECL|macro|CISCO_MULTICAST
mdefine_line|#define CISCO_MULTICAST&t;&t;0x8F&t;/* Cisco multicast address */
DECL|macro|CISCO_UNICAST
mdefine_line|#define CISCO_UNICAST&t;&t;0x0F&t;/* Cisco unicast address */
DECL|macro|CISCO_KEEPALIVE
mdefine_line|#define CISCO_KEEPALIVE&t;&t;0x8035&t;/* Cisco keepalive protocol */
DECL|macro|CISCO_SYS_INFO
mdefine_line|#define CISCO_SYS_INFO&t;&t;0x2000&t;/* Cisco interface/system info */
DECL|macro|CISCO_ADDR_REQ
mdefine_line|#define CISCO_ADDR_REQ&t;&t;0&t;/* Cisco address request */
DECL|macro|CISCO_ADDR_REPLY
mdefine_line|#define CISCO_ADDR_REPLY&t;1&t;/* Cisco address reply */
DECL|macro|CISCO_KEEPALIVE_REQ
mdefine_line|#define CISCO_KEEPALIVE_REQ&t;2&t;/* Cisco keepalive request */
r_static
r_int
id|hdlc_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
suffix:semicolon
multiline_comment|/********************************************************&n; *&n; * Cisco HDLC support&n; *&n; *******************************************************/
DECL|function|cisco_hard_header
r_static
r_int
id|cisco_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
r_int
id|len
)paren
(brace
id|hdlc_header
op_star
id|data
suffix:semicolon
macro_line|#ifdef DEBUG_HARD_HEADER
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: cisco_hard_header called&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|skb_push
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|hdlc_header
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
id|hdlc_header
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|CISCO_KEEPALIVE
)paren
id|data-&gt;address
op_assign
id|CISCO_MULTICAST
suffix:semicolon
r_else
id|data-&gt;address
op_assign
id|CISCO_UNICAST
suffix:semicolon
id|data-&gt;control
op_assign
l_int|0
suffix:semicolon
id|data-&gt;protocol
op_assign
id|htons
c_func
(paren
id|type
)paren
suffix:semicolon
r_return
r_sizeof
(paren
id|hdlc_header
)paren
suffix:semicolon
)brace
DECL|function|cisco_keepalive_send
r_static
r_void
id|cisco_keepalive_send
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
id|u32
id|type
comma
id|u32
id|par1
comma
id|u32
id|par2
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|cisco_packet
op_star
id|data
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
r_sizeof
(paren
id|hdlc_header
)paren
op_plus
r_sizeof
(paren
id|cisco_packet
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze on cisco_keepalive_send()&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
id|cisco_hard_header
c_func
(paren
id|skb
comma
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
comma
id|CISCO_KEEPALIVE
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|data
op_assign
(paren
id|cisco_packet
op_star
)paren
id|skb-&gt;tail
suffix:semicolon
id|data-&gt;type
op_assign
id|htonl
c_func
(paren
id|type
)paren
suffix:semicolon
id|data-&gt;par1
op_assign
id|htonl
c_func
(paren
id|par1
)paren
suffix:semicolon
id|data-&gt;par2
op_assign
id|htonl
c_func
(paren
id|par2
)paren
suffix:semicolon
id|data-&gt;rel
op_assign
l_int|0xFFFF
suffix:semicolon
id|data-&gt;time
op_assign
id|htonl
c_func
(paren
id|jiffies
op_star
l_int|1000
op_div
id|HZ
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|cisco_packet
)paren
)paren
suffix:semicolon
id|skb-&gt;priority
op_assign
id|TC_PRIO_CONTROL
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|cisco_netif
r_static
r_void
id|cisco_netif
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|hdlc_header
op_star
id|data
op_assign
(paren
id|hdlc_header
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|cisco_packet
op_star
id|cisco_data
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
id|u32
id|addr
comma
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
id|hdlc_header
)paren
)paren
r_goto
id|rx_error
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;address
op_ne
id|CISCO_MULTICAST
op_logical_and
id|data-&gt;address
op_ne
id|CISCO_UNICAST
)paren
r_goto
id|rx_error
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
id|hdlc_header
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ntohs
c_func
(paren
id|data-&gt;protocol
)paren
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
r_case
id|ETH_P_IPX
suffix:colon
r_case
id|ETH_P_IPV6
suffix:colon
id|skb-&gt;protocol
op_assign
id|data-&gt;protocol
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|CISCO_SYS_INFO
suffix:colon
multiline_comment|/* Packet is not needed, drop it. */
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|CISCO_KEEPALIVE
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;len
op_ne
id|CISCO_PACKET_LEN
op_logical_and
id|skb-&gt;len
op_ne
id|CISCO_BIG_PACKET_LEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Invalid length of Cisco &quot;
l_string|&quot;control packet (%d bytes)&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_goto
id|rx_error
suffix:semicolon
)brace
id|cisco_data
op_assign
(paren
id|cisco_packet
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|ntohl
(paren
id|cisco_data-&gt;type
)paren
)paren
(brace
r_case
id|CISCO_ADDR_REQ
suffix:colon
multiline_comment|/* Stolen from syncppp.c :-) */
id|in_dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
op_member_access_from_pointer
id|ip_ptr
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
id|mask
op_assign
op_complement
l_int|0
suffix:semicolon
multiline_comment|/* is the mask correct? */
r_if
c_cond
(paren
id|in_dev
op_ne
l_int|NULL
)paren
(brace
r_struct
id|in_ifaddr
op_star
op_star
id|ifap
op_assign
op_amp
id|in_dev-&gt;ifa_list
suffix:semicolon
r_while
c_loop
(paren
op_star
id|ifap
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
(paren
op_star
id|ifap
)paren
op_member_access_from_pointer
id|ifa_label
)paren
op_eq
l_int|0
)paren
(brace
id|addr
op_assign
(paren
op_star
id|ifap
)paren
op_member_access_from_pointer
id|ifa_local
suffix:semicolon
id|mask
op_assign
(paren
op_star
id|ifap
)paren
op_member_access_from_pointer
id|ifa_mask
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ifap
op_assign
op_amp
(paren
op_star
id|ifap
)paren
op_member_access_from_pointer
id|ifa_next
suffix:semicolon
)brace
id|cisco_keepalive_send
c_func
(paren
id|hdlc
comma
id|CISCO_ADDR_REPLY
comma
id|addr
comma
id|mask
)paren
suffix:semicolon
)brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|CISCO_ADDR_REPLY
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unexpected Cisco IP address &quot;
l_string|&quot;reply&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_goto
id|rx_error
suffix:semicolon
r_case
id|CISCO_KEEPALIVE_REQ
suffix:colon
id|hdlc-&gt;lmi.rxseq
op_assign
id|ntohl
c_func
(paren
id|cisco_data-&gt;par1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ntohl
c_func
(paren
id|cisco_data-&gt;par2
)paren
op_eq
id|hdlc-&gt;lmi.txseq
)paren
(brace
id|hdlc-&gt;lmi.last_poll
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_RELIABLE
)paren
)paren
(brace
id|u32
id|sec
comma
id|min
comma
id|hrs
comma
id|days
suffix:semicolon
id|sec
op_assign
id|ntohl
c_func
(paren
id|cisco_data-&gt;time
)paren
op_div
l_int|1000
suffix:semicolon
id|min
op_assign
id|sec
op_div
l_int|60
suffix:semicolon
id|sec
op_sub_assign
id|min
op_star
l_int|60
suffix:semicolon
id|hrs
op_assign
id|min
op_div
l_int|60
suffix:semicolon
id|min
op_sub_assign
id|hrs
op_star
l_int|60
suffix:semicolon
id|days
op_assign
id|hrs
op_div
l_int|24
suffix:semicolon
id|hrs
op_sub_assign
id|days
op_star
l_int|24
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Link up (peer &quot;
l_string|&quot;uptime %ud%uh%um%us)&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|days
comma
id|hrs
comma
id|min
comma
id|sec
)paren
suffix:semicolon
)brace
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_RELIABLE
suffix:semicolon
)brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* switch(keepalive type) */
)brace
multiline_comment|/* switch(protocol) */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unsupported protocol %x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|data-&gt;protocol
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
id|rx_error
suffix:colon
id|hdlc-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* Mark error */
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|cisco_timer
r_static
r_void
id|cisco_timer
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
(paren
id|hdlc_device
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_RELIABLE
)paren
op_logical_and
(paren
id|jiffies
op_minus
id|hdlc-&gt;lmi.last_poll
op_ge
id|hdlc-&gt;lmi.T392
op_star
id|HZ
)paren
)paren
(brace
id|hdlc-&gt;lmi.state
op_and_assign
op_complement
id|LINK_STATE_RELIABLE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Link down&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
)brace
id|cisco_keepalive_send
c_func
(paren
id|hdlc
comma
id|CISCO_KEEPALIVE_REQ
comma
op_increment
id|hdlc-&gt;lmi.txseq
comma
id|hdlc-&gt;lmi.rxseq
)paren
suffix:semicolon
id|hdlc-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|hdlc-&gt;lmi.T391
op_star
id|HZ
suffix:semicolon
id|hdlc-&gt;timer.function
op_assign
id|cisco_timer
suffix:semicolon
id|hdlc-&gt;timer.data
op_assign
id|arg
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|hdlc-&gt;timer
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************&n; *&n; *     generic Frame Relay routines&n; *&n; *****************************************************************/
DECL|function|fr_hard_header
r_static
r_int
id|fr_hard_header
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
id|u16
id|type
comma
r_void
op_star
id|daddr
comma
r_void
op_star
id|saddr
comma
r_int
r_int
id|len
)paren
(brace
id|u16
id|head_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|daddr
)paren
id|daddr
op_assign
id|dev-&gt;broadcast
suffix:semicolon
macro_line|#ifdef DEBUG_HARD_HEADER
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: fr_hard_header called&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ETH_P_IP
suffix:colon
id|head_len
op_assign
l_int|4
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|head_len
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|3
)braket
op_assign
id|NLPID_IP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ETH_P_IPV6
suffix:colon
id|head_len
op_assign
l_int|4
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|head_len
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|3
)braket
op_assign
id|NLPID_IPV6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LMI_PROTO
suffix:colon
id|head_len
op_assign
l_int|4
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|head_len
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|3
)braket
op_assign
id|LMI_PROTO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|head_len
op_assign
l_int|10
suffix:semicolon
id|skb_push
c_func
(paren
id|skb
comma
id|head_len
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|3
)braket
op_assign
id|FR_PAD
suffix:semicolon
id|skb-&gt;data
(braket
l_int|4
)braket
op_assign
id|NLPID_SNAP
suffix:semicolon
id|skb-&gt;data
(braket
l_int|5
)braket
op_assign
id|FR_PAD
suffix:semicolon
id|skb-&gt;data
(braket
l_int|6
)braket
op_assign
id|FR_PAD
suffix:semicolon
id|skb-&gt;data
(braket
l_int|7
)braket
op_assign
id|FR_PAD
suffix:semicolon
id|skb-&gt;data
(braket
l_int|8
)braket
op_assign
id|type
op_rshift
l_int|8
suffix:semicolon
id|skb-&gt;data
(braket
l_int|9
)braket
op_assign
(paren
id|u8
)paren
id|type
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|daddr
comma
l_int|2
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|2
)braket
op_assign
id|FR_UI
suffix:semicolon
r_return
id|head_len
suffix:semicolon
)brace
DECL|function|fr_log_dlci_active
r_static
r_inline
r_void
id|fr_log_dlci_active
c_func
(paren
id|pvc_device
op_star
id|pvc
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %sactive%s&bslash;n&quot;
comma
id|pvc_to_name
c_func
(paren
id|pvc
)paren
comma
id|pvc-&gt;state
op_amp
id|PVC_STATE_ACTIVE
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;in&quot;
comma
id|pvc-&gt;state
op_amp
id|PVC_STATE_NEW
ques
c_cond
l_string|&quot; new&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
DECL|function|fr_lmi_nextseq
r_static
r_inline
id|u8
id|fr_lmi_nextseq
c_func
(paren
id|u8
id|x
)paren
(brace
id|x
op_increment
suffix:semicolon
r_return
id|x
ques
c_cond
id|x
suffix:colon
l_int|1
suffix:semicolon
)brace
DECL|function|fr_lmi_send
r_static
r_void
id|fr_lmi_send
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_int
id|fullrep
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|pvc_device
op_star
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_int
id|len
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_ANSI
)paren
ques
c_cond
id|LMI_ANSI_LENGTH
suffix:colon
id|LMI_LENGTH
suffix:semicolon
r_int
id|stat_len
op_assign
l_int|3
suffix:semicolon
id|u8
op_star
id|data
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
op_logical_and
id|fullrep
)paren
(brace
id|len
op_add_assign
id|hdlc-&gt;pvc_count
op_star
(paren
l_int|2
op_plus
id|stat_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|HDLC_MAX_MTU
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too many PVCs while sending &quot;
l_string|&quot;LMI full report&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze on fr_lmi_send()&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|skb-&gt;data
comma
l_int|0
comma
id|len
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
id|fr_hard_header
c_func
(paren
id|skb
comma
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
comma
id|LMI_PROTO
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|data
op_assign
id|skb-&gt;tail
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|LMI_CALLREF
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
ques
c_cond
id|LMI_STATUS
suffix:colon
id|LMI_STATUS_ENQUIRY
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_ANSI
)paren
)paren
id|data
(braket
id|i
op_increment
)braket
op_assign
id|LMI_ANSI_LOCKSHIFT
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_REPTYPE
suffix:colon
id|LMI_REPTYPE
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|LMI_REPT_LEN
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|fullrep
ques
c_cond
id|LMI_FULLREP
suffix:colon
id|LMI_INTEGRITY
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_ALIVE
suffix:colon
id|LMI_ALIVE
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|LMI_INTEG_LEN
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|hdlc-&gt;lmi.txseq
op_assign
id|fr_lmi_nextseq
c_func
(paren
id|hdlc-&gt;lmi.txseq
)paren
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|hdlc-&gt;lmi.rxseq
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
op_logical_and
id|fullrep
)paren
(brace
r_while
c_loop
(paren
id|pvc
)paren
(brace
id|data
(braket
id|i
op_increment
)braket
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_PVCSTAT
suffix:colon
id|LMI_PVCSTAT
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
id|stat_len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_RELIABLE
)paren
op_logical_and
(paren
id|pvc-&gt;netdev.flags
op_amp
id|IFF_UP
)paren
op_logical_and
op_logical_neg
(paren
id|pvc-&gt;state
op_amp
(paren
id|PVC_STATE_ACTIVE
op_or
id|PVC_STATE_NEW
)paren
)paren
)paren
(brace
id|pvc-&gt;state
op_or_assign
id|PVC_STATE_NEW
suffix:semicolon
id|fr_log_dlci_active
c_func
(paren
id|pvc
)paren
suffix:semicolon
)brace
id|dlci_to_status
c_func
(paren
id|hdlc
comma
id|netdev_dlci
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
comma
id|data
op_plus
id|i
comma
id|pvc-&gt;state
)paren
suffix:semicolon
id|i
op_add_assign
id|stat_len
suffix:semicolon
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|i
)paren
suffix:semicolon
id|skb-&gt;priority
op_assign
id|TC_PRIO_CONTROL
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|fr_timer
r_static
r_void
id|fr_timer
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
(paren
id|hdlc_device
op_star
)paren
id|arg
suffix:semicolon
r_int
id|i
comma
id|cnt
op_assign
l_int|0
comma
id|reliable
suffix:semicolon
id|u32
id|list
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
)paren
id|reliable
op_assign
(paren
id|jiffies
op_minus
id|hdlc-&gt;lmi.last_poll
OL
id|hdlc-&gt;lmi.T392
op_star
id|HZ
)paren
suffix:semicolon
r_else
(brace
id|hdlc-&gt;lmi.last_errors
op_lshift_assign
l_int|1
suffix:semicolon
multiline_comment|/* Shift the list */
r_if
c_cond
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_REQUEST
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No LMI status reply received&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
id|hdlc-&gt;lmi.last_errors
op_or_assign
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|list
op_assign
id|hdlc-&gt;lmi.last_errors
suffix:semicolon
id|i
OL
id|hdlc-&gt;lmi.N393
suffix:semicolon
id|i
op_increment
comma
id|list
op_rshift_assign
l_int|1
)paren
id|cnt
op_add_assign
(paren
id|list
op_amp
l_int|1
)paren
suffix:semicolon
multiline_comment|/* errors count */
id|reliable
op_assign
(paren
id|cnt
OL
id|hdlc-&gt;lmi.N392
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_RELIABLE
)paren
op_ne
(paren
id|reliable
ques
c_cond
id|LINK_STATE_RELIABLE
suffix:colon
l_int|0
)paren
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
multiline_comment|/* Deactivate all PVCs */
id|pvc-&gt;state
op_and_assign
op_complement
(paren
id|PVC_STATE_NEW
op_or
id|PVC_STATE_ACTIVE
)paren
suffix:semicolon
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
id|hdlc-&gt;lmi.state
op_xor_assign
id|LINK_STATE_RELIABLE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Link %sreliable&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|reliable
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;un&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reliable
)paren
(brace
id|hdlc-&gt;lmi.N391cnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Request full status */
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
)paren
id|hdlc-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|hdlc-&gt;lmi.T392
op_star
id|HZ
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|hdlc-&gt;lmi.N391cnt
)paren
id|hdlc-&gt;lmi.N391cnt
op_decrement
suffix:semicolon
id|fr_lmi_send
c_func
(paren
id|hdlc
comma
id|hdlc-&gt;lmi.N391cnt
op_eq
l_int|0
)paren
suffix:semicolon
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_REQUEST
suffix:semicolon
id|hdlc-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|hdlc-&gt;lmi.T391
op_star
id|HZ
suffix:semicolon
)brace
id|hdlc-&gt;timer.function
op_assign
id|fr_timer
suffix:semicolon
id|hdlc-&gt;timer.data
op_assign
id|arg
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|hdlc-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|fr_lmi_recv
r_static
r_int
id|fr_lmi_recv
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|stat_len
suffix:semicolon
id|pvc_device
op_star
id|pvc
suffix:semicolon
r_int
id|reptype
op_assign
op_minus
l_int|1
comma
id|error
suffix:semicolon
id|u8
id|rxseq
comma
id|txseq
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_ANSI
)paren
ques
c_cond
id|LMI_ANSI_LENGTH
suffix:colon
id|LMI_LENGTH
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Short LMI frame&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb-&gt;data
(braket
l_int|5
)braket
op_ne
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
ques
c_cond
id|LMI_STATUS
suffix:colon
id|LMI_STATUS_ENQUIRY
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: LMI msgtype=%x, Not LMI status %s&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;data
(braket
l_int|2
)braket
comma
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
ques
c_cond
l_string|&quot;enquiry&quot;
suffix:colon
l_string|&quot;reply&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|i
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_ANSI
)paren
ques
c_cond
l_int|7
suffix:colon
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
id|i
)braket
op_ne
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_REPTYPE
suffix:colon
id|LMI_REPTYPE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Not a report type=%x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
multiline_comment|/* Skip length field */
id|reptype
op_assign
id|skb-&gt;data
(braket
id|i
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
id|i
)braket
op_ne
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_ALIVE
suffix:colon
id|LMI_ALIVE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unsupported status element=%x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
multiline_comment|/* Skip length field */
id|hdlc-&gt;lmi.rxseq
op_assign
id|skb-&gt;data
(braket
id|i
op_increment
)braket
suffix:semicolon
multiline_comment|/* TX sequence from peer */
id|rxseq
op_assign
id|skb-&gt;data
(braket
id|i
op_increment
)braket
suffix:semicolon
multiline_comment|/* Should confirm our sequence */
id|txseq
op_assign
id|hdlc-&gt;lmi.txseq
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
)paren
(brace
r_if
c_cond
(paren
id|reptype
op_ne
id|LMI_FULLREP
op_logical_and
id|reptype
op_ne
id|LMI_INTEGRITY
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unsupported report type=%x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|reptype
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_RELIABLE
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rxseq
op_eq
l_int|0
op_logical_or
id|rxseq
op_ne
id|txseq
)paren
(brace
id|hdlc-&gt;lmi.N391cnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Ask for full report next time */
id|error
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_DCE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_FULLREP_SENT
)paren
op_logical_and
op_logical_neg
id|error
)paren
(brace
multiline_comment|/* Stop sending full report - the last one has been confirmed by DTE */
id|hdlc-&gt;lmi.state
op_and_assign
op_complement
id|LINK_STATE_FULLREP_SENT
suffix:semicolon
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
r_if
c_cond
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_NEW
)paren
(brace
id|pvc-&gt;state
op_and_assign
op_complement
id|PVC_STATE_NEW
suffix:semicolon
id|pvc-&gt;state
op_or_assign
id|PVC_STATE_ACTIVE
suffix:semicolon
id|fr_log_dlci_active
c_func
(paren
id|pvc
)paren
suffix:semicolon
multiline_comment|/* Tell DTE that new PVC is now active */
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
)brace
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|hdlc-&gt;lmi.state
op_amp
id|LINK_STATE_CHANGED
)paren
(brace
id|reptype
op_assign
id|LMI_FULLREP
suffix:semicolon
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_FULLREP_SENT
suffix:semicolon
id|hdlc-&gt;lmi.state
op_and_assign
op_complement
id|LINK_STATE_CHANGED
suffix:semicolon
)brace
id|fr_lmi_send
c_func
(paren
id|hdlc
comma
id|reptype
op_eq
id|LMI_FULLREP
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* DTE */
r_if
c_cond
(paren
id|reptype
op_ne
id|LMI_FULLREP
op_logical_or
id|error
)paren
r_return
l_int|0
suffix:semicolon
id|stat_len
op_assign
l_int|3
suffix:semicolon
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
id|pvc-&gt;newstate
op_assign
l_int|0
suffix:semicolon
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|skb-&gt;len
op_ge
id|i
op_plus
l_int|2
op_plus
id|stat_len
)paren
(brace
id|u16
id|dlci
suffix:semicolon
id|u8
id|state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
id|i
)braket
op_ne
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR_CCITT
)paren
ques
c_cond
id|LMI_CCITT_PVCSTAT
suffix:colon
id|LMI_PVCSTAT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid PVCSTAT ID: %x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;data
(braket
id|i
)braket
op_ne
id|stat_len
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid PVCSTAT length: %x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|skb-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
id|dlci
op_assign
id|status_to_dlci
c_func
(paren
id|hdlc
comma
id|skb-&gt;data
op_plus
id|i
comma
op_amp
id|state
)paren
suffix:semicolon
id|pvc
op_assign
id|find_pvc
c_func
(paren
id|hdlc
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvc
)paren
id|pvc-&gt;newstate
op_assign
id|state
suffix:semicolon
r_else
r_if
c_cond
(paren
id|state
op_eq
id|PVC_STATE_NEW
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: new PVC available, DLCI=%u&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|dlci
)paren
suffix:semicolon
id|i
op_add_assign
id|stat_len
suffix:semicolon
)brace
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
r_if
c_cond
(paren
id|pvc-&gt;newstate
op_eq
id|PVC_STATE_NEW
)paren
id|pvc-&gt;newstate
op_assign
id|PVC_STATE_ACTIVE
suffix:semicolon
id|pvc-&gt;newstate
op_or_assign
(paren
id|pvc-&gt;state
op_amp
op_complement
(paren
id|PVC_STATE_NEW
op_or
id|PVC_STATE_ACTIVE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvc-&gt;state
op_ne
id|pvc-&gt;newstate
)paren
(brace
id|pvc-&gt;state
op_assign
id|pvc-&gt;newstate
suffix:semicolon
id|fr_log_dlci_active
c_func
(paren
id|pvc
)paren
suffix:semicolon
)brace
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
multiline_comment|/* Next full report after N391 polls */
id|hdlc-&gt;lmi.N391cnt
op_assign
id|hdlc-&gt;lmi.N391
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fr_netif
r_static
r_void
id|fr_netif
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|fr_hdr
op_star
id|fh
op_assign
(paren
id|fr_hdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
id|u8
op_star
id|data
op_assign
id|skb-&gt;data
suffix:semicolon
id|u16
id|dlci
suffix:semicolon
id|pvc_device
op_star
id|pvc
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
l_int|4
op_logical_or
id|fh-&gt;ea1
op_logical_or
id|data
(braket
l_int|2
)braket
op_ne
id|FR_UI
)paren
r_goto
id|rx_error
suffix:semicolon
id|dlci
op_assign
id|q922_to_dlci
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dlci
op_eq
id|LMI_DLCI
)paren
(brace
r_if
c_cond
(paren
id|data
(braket
l_int|3
)braket
op_eq
id|LMI_PROTO
)paren
(brace
r_if
c_cond
(paren
id|fr_lmi_recv
c_func
(paren
id|hdlc
comma
id|skb
)paren
)paren
r_goto
id|rx_error
suffix:semicolon
r_else
(brace
multiline_comment|/* No request pending */
id|hdlc-&gt;lmi.state
op_and_assign
op_complement
id|LINK_STATE_REQUEST
suffix:semicolon
id|hdlc-&gt;lmi.last_poll
op_assign
id|jiffies
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Received non-LMI frame with LMI DLCI&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_goto
id|rx_error
suffix:semicolon
)brace
id|pvc
op_assign
id|find_pvc
c_func
(paren
id|hdlc
comma
id|dlci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvc
)paren
(brace
macro_line|#ifdef DEBUG_PKT
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No PVC for received frame&squot;s DLCI %d&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|dlci
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|rx_error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pvc-&gt;netdev.flags
op_amp
id|IFF_UP
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef DEBUG_PKT
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: PVC for received frame&squot;s DLCI %d is down&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|dlci
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|rx_error
suffix:semicolon
)brace
id|pvc-&gt;stats.rx_packets
op_increment
suffix:semicolon
multiline_comment|/* PVC traffic */
id|pvc-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_FECN
)paren
op_ne
(paren
id|fh-&gt;fecn
ques
c_cond
id|PVC_STATE_FECN
suffix:colon
l_int|0
)paren
)paren
(brace
macro_line|#ifdef DEBUG_FECN
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: FECN O%s&bslash;n&quot;
comma
id|pvc_to_name
c_func
(paren
id|pvc
)paren
comma
id|fh-&gt;fecn
ques
c_cond
l_string|&quot;N&quot;
suffix:colon
l_string|&quot;FF&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pvc-&gt;state
op_xor_assign
id|PVC_STATE_FECN
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_BECN
)paren
op_ne
(paren
id|fh-&gt;becn
ques
c_cond
id|PVC_STATE_BECN
suffix:colon
l_int|0
)paren
)paren
(brace
macro_line|#ifdef DEBUG_FECN
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: BECN O%s&bslash;n&quot;
comma
id|pvc_to_name
c_func
(paren
id|pvc
)paren
comma
id|fh-&gt;becn
ques
c_cond
l_string|&quot;N&quot;
suffix:colon
l_string|&quot;FF&quot;
)paren
suffix:semicolon
macro_line|#endif
id|pvc-&gt;state
op_xor_assign
id|PVC_STATE_BECN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_BECN
)paren
id|pvc-&gt;stats.rx_compressed
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|3
)braket
op_eq
id|NLPID_IP
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Remove 4-byte header (hdr, UI, NLPID) */
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
op_amp
id|pvc-&gt;netdev
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|3
)braket
op_eq
id|NLPID_IPV6
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Remove 4-byte header (hdr, UI, NLPID) */
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IPV6
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
op_amp
id|pvc-&gt;netdev
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data
(braket
l_int|3
)braket
op_eq
id|FR_PAD
op_logical_and
id|data
(braket
l_int|4
)braket
op_eq
id|NLPID_SNAP
op_logical_and
id|data
(braket
l_int|5
)braket
op_eq
id|FR_PAD
op_logical_and
id|data
(braket
l_int|6
)braket
op_eq
id|FR_PAD
op_logical_and
id|data
(braket
l_int|7
)braket
op_eq
id|FR_PAD
op_logical_and
(paren
(paren
id|data
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_or
id|data
(braket
l_int|9
)braket
)paren
op_eq
id|ETH_P_ARP
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
l_int|10
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_ARP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
op_amp
id|pvc-&gt;netdev
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unusupported protocol %x&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|data
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
id|rx_error
suffix:colon
id|hdlc-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* Mark error */
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|fr_cisco_open
r_static
r_void
id|fr_cisco_open
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
id|hdlc-&gt;lmi.state
op_assign
id|LINK_STATE_CHANGED
suffix:semicolon
id|hdlc-&gt;lmi.txseq
op_assign
id|hdlc-&gt;lmi.rxseq
op_assign
l_int|0
suffix:semicolon
id|hdlc-&gt;lmi.last_errors
op_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|hdlc-&gt;lmi.N391cnt
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|hdlc-&gt;timer
)paren
suffix:semicolon
id|hdlc-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
multiline_comment|/* First poll after 1 second */
id|hdlc-&gt;timer.function
op_assign
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR
)paren
ques
c_cond
id|fr_timer
suffix:colon
id|cisco_timer
suffix:semicolon
id|hdlc-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|hdlc
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|hdlc-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|fr_cisco_close
r_static
r_void
id|fr_cisco_close
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|hdlc-&gt;timer
)paren
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
multiline_comment|/* NULL in Cisco mode */
id|dev_close
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
suffix:semicolon
multiline_comment|/* Shutdown all PVCs for this FRAD */
id|pvc
op_assign
id|pvc-&gt;next
suffix:semicolon
)brace
)brace
multiline_comment|/******************************************************************&n; *&n; *     generic HDLC routines&n; *&n; *****************************************************************/
DECL|function|hdlc_change_mtu
r_static
r_int
id|hdlc_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
id|HDLC_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/********************************************************&n; *&n; * PVC device routines&n; *&n; *******************************************************/
DECL|function|pvc_open
r_static
r_int
id|pvc_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|dev_to_pvc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hdlc_to_dev
c_func
(paren
id|pvc-&gt;master
)paren
op_member_access_from_pointer
id|flags
op_amp
id|IFF_UP
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* Master must be UP in order to activate PVC */
id|memset
c_func
(paren
op_amp
(paren
id|pvc-&gt;stats
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
id|pvc-&gt;state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|pvc-&gt;master
comma
id|MODE_SOFT
)paren
op_logical_and
id|pvc-&gt;master-&gt;open_pvc
)paren
id|result
op_assign
id|pvc-&gt;master
op_member_access_from_pointer
id|open_pvc
c_func
(paren
id|pvc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_return
id|result
suffix:semicolon
id|pvc-&gt;master-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pvc_close
r_static
r_int
id|pvc_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|dev_to_pvc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pvc-&gt;state
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|pvc-&gt;master
comma
id|MODE_SOFT
)paren
op_logical_and
id|pvc-&gt;master-&gt;close_pvc
)paren
id|pvc-&gt;master
op_member_access_from_pointer
id|close_pvc
c_func
(paren
id|pvc
)paren
suffix:semicolon
id|pvc-&gt;master-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pvc_xmit
r_static
r_int
id|pvc_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|dev_to_pvc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_ACTIVE
)paren
(brace
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|pvc-&gt;master
)paren
suffix:semicolon
id|pvc-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|pvc-&gt;stats.tx_packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pvc-&gt;state
op_amp
id|PVC_STATE_FECN
)paren
id|pvc-&gt;stats.tx_compressed
op_increment
suffix:semicolon
multiline_comment|/* TX Congestion counter */
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|pvc-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pvc_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|pvc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|dev_to_pvc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_amp
id|pvc-&gt;stats
suffix:semicolon
)brace
DECL|function|pvc_change_mtu
r_static
r_int
id|pvc_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|68
)paren
op_logical_or
(paren
id|new_mtu
OG
id|HDLC_MAX_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|destroy_pvc_list
r_static
r_void
id|destroy_pvc_list
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
id|pvc_device
op_star
id|pvc
op_assign
id|hdlc-&gt;first_pvc
suffix:semicolon
r_while
c_loop
(paren
id|pvc
)paren
(brace
id|pvc_device
op_star
id|next
op_assign
id|pvc-&gt;next
suffix:semicolon
id|unregister_netdevice
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pvc
)paren
suffix:semicolon
id|pvc
op_assign
id|next
suffix:semicolon
)brace
id|hdlc-&gt;first_pvc
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* All PVCs destroyed */
id|hdlc-&gt;pvc_count
op_assign
l_int|0
suffix:semicolon
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
)brace
multiline_comment|/********************************************************&n; *&n; * X.25 protocol support routines&n; *&n; *******************************************************/
macro_line|#ifdef CONFIG_HDLC_X25
multiline_comment|/* These functions are callbacks called by LAPB layer */
DECL|function|x25_connect_disconnect
r_void
id|x25_connect_disconnect
c_func
(paren
r_void
op_star
id|token
comma
r_int
id|reason
comma
r_int
id|code
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|token
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|1
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ptr
op_assign
id|skb_put
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
op_star
id|ptr
op_assign
id|code
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_X25
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|x25_connected
r_void
id|x25_connected
c_func
(paren
r_void
op_star
id|token
comma
r_int
id|reason
)paren
(brace
id|x25_connect_disconnect
c_func
(paren
id|token
comma
id|reason
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|x25_disconnected
r_void
id|x25_disconnected
c_func
(paren
r_void
op_star
id|token
comma
r_int
id|reason
)paren
(brace
id|x25_connect_disconnect
c_func
(paren
id|token
comma
id|reason
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|x25_data_indication
r_int
id|x25_data_indication
c_func
(paren
r_void
op_star
id|token
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|token
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
id|ptr
op_assign
id|skb_push
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
op_star
id|ptr
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_X25
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
r_return
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|x25_data_transmit
r_void
id|x25_data_transmit
c_func
(paren
r_void
op_star
id|token
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|token
suffix:semicolon
id|hdlc
op_member_access_from_pointer
id|xmit
c_func
(paren
id|hdlc
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* Ignore return value :-( */
)brace
macro_line|#endif /* CONFIG_HDLC_X25 */
multiline_comment|/********************************************************&n; *&n; * HDLC device routines&n; *&n; *******************************************************/
DECL|function|hdlc_open
r_static
r_int
id|hdlc_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|hdlc-&gt;mode
op_eq
id|MODE_NONE
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|hdlc-&gt;stats
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR
op_or
id|MODE_SOFT
)paren
op_logical_or
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_CISCO
op_or
id|MODE_SOFT
)paren
)paren
id|fr_cisco_open
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_PPP
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_PPP
op_or
id|MODE_SOFT
)paren
)paren
(brace
id|sppp_attach
c_func
(paren
op_amp
id|hdlc-&gt;pppdev
)paren
suffix:semicolon
multiline_comment|/* sppp_attach nukes them. We don&squot;t need syncppp&squot;s ioctl */
id|dev-&gt;do_ioctl
op_assign
id|hdlc_ioctl
suffix:semicolon
id|hdlc-&gt;pppdev.sppp.pp_flags
op_and_assign
op_complement
id|PP_CISCO
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_PPP
suffix:semicolon
id|result
op_assign
id|sppp_open
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|sppp_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_X25
)paren
)paren
(brace
r_struct
id|lapb_register_struct
id|cb
suffix:semicolon
id|cb.connect_confirmation
op_assign
id|x25_connected
suffix:semicolon
id|cb.connect_indication
op_assign
id|x25_connected
suffix:semicolon
id|cb.disconnect_confirmation
op_assign
id|x25_disconnected
suffix:semicolon
id|cb.disconnect_indication
op_assign
id|x25_disconnected
suffix:semicolon
id|cb.data_indication
op_assign
id|x25_data_indication
suffix:semicolon
id|cb.data_transmit
op_assign
id|x25_data_transmit
suffix:semicolon
id|result
op_assign
id|lapb_register
c_func
(paren
id|hdlc
comma
op_amp
id|cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
id|LAPB_OK
)paren
r_return
id|result
suffix:semicolon
)brace
macro_line|#endif
id|result
op_assign
id|hdlc
op_member_access_from_pointer
id|open
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR
op_or
id|MODE_SOFT
)paren
op_logical_or
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_CISCO
op_or
id|MODE_SOFT
)paren
)paren
id|fr_cisco_close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_PPP
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_PPP
op_or
id|MODE_SOFT
)paren
)paren
(brace
id|sppp_close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sppp_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|hdlc_change_mtu
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|HDLC_MAX_MTU
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|16
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_X25
)paren
)paren
id|lapb_unregister
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|hdlc_close
r_static
r_int
id|hdlc_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|hdlc
op_member_access_from_pointer
id|close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR
op_or
id|MODE_SOFT
)paren
op_logical_or
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_CISCO
op_or
id|MODE_SOFT
)paren
)paren
id|fr_cisco_close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_PPP
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_PPP
op_or
id|MODE_SOFT
)paren
)paren
(brace
id|sppp_close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sppp_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|hdlc_change_mtu
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|HDLC_MAX_MTU
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|16
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_else
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_X25
)paren
)paren
id|lapb_unregister
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hdlc_xmit
r_static
r_int
id|hdlc_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_X25
r_if
c_cond
(paren
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_X25
op_or
id|MODE_SOFT
)paren
)paren
(brace
r_int
id|result
suffix:semicolon
multiline_comment|/* X.25 to LAPB */
r_switch
c_cond
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Data to be transmitted */
id|skb_pull
c_func
(paren
id|skb
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|lapb_data_request
c_func
(paren
id|hdlc
comma
id|skb
)paren
)paren
op_ne
id|LAPB_OK
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|lapb_connect_request
c_func
(paren
id|hdlc
)paren
)paren
op_ne
id|LAPB_OK
)paren
(brace
r_if
c_cond
(paren
id|result
op_eq
id|LAPB_CONNECTED
)paren
(brace
multiline_comment|/* Send connect confirm. msg to level 3 */
id|x25_connected
c_func
(paren
id|hdlc
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: LAPB connect &quot;
l_string|&quot;request failed, error code = &quot;
l_string|&quot;%i&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|result
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|lapb_disconnect_request
c_func
(paren
id|hdlc
)paren
)paren
op_ne
id|LAPB_OK
)paren
(brace
r_if
c_cond
(paren
id|result
op_eq
id|LAPB_NOTCONNECTED
)paren
(brace
multiline_comment|/* Send disconnect confirm. msg to level 3 */
id|x25_disconnected
c_func
(paren
id|hdlc
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: LAPB disconnect &quot;
l_string|&quot;request failed, error code = &quot;
l_string|&quot;%i&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
comma
id|result
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* to be defined */
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* MODE_X25 */
macro_line|#endif /* CONFIG_HDLC_X25 */
r_return
id|hdlc
op_member_access_from_pointer
id|xmit
c_func
(paren
id|hdlc
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|hdlc_netif_rx
r_void
id|hdlc_netif_rx
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
multiline_comment|/* skb contains raw HDLC frame, in both hard- and software modes */
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|hdlc-&gt;mode
op_amp
id|MODE_MASK
)paren
(brace
r_case
id|MODE_HDLC
suffix:colon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|MODE_FR
suffix:colon
id|fr_netif
c_func
(paren
id|hdlc
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|MODE_CISCO
suffix:colon
id|cisco_netif
c_func
(paren
id|hdlc
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_PPP
r_case
id|MODE_PPP
suffix:colon
macro_line|#if 0
id|sppp_input
c_func
(paren
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
comma
id|skb
)paren
suffix:semicolon
macro_line|#else
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_WAN_PPP
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_case
id|MODE_X25
suffix:colon
id|skb-&gt;dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lapb_data_received
c_func
(paren
id|hdlc
comma
id|skb
)paren
op_eq
id|LAPB_OK
)paren
r_return
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
id|hdlc-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|hdlc_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|hdlc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
DECL|function|hdlc_set_mode
r_static
r_int
id|hdlc_set_mode
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_int
id|mode
)paren
(brace
r_int
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Default to soft modes */
r_struct
id|net_device
op_star
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;hard_header
op_assign
l_int|NULL
suffix:semicolon
id|hdlc-&gt;mode
op_assign
id|MODE_NONE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mode
op_amp
id|MODE_SOFT
)paren
)paren
r_switch
c_cond
(paren
id|mode
op_amp
id|MODE_MASK
)paren
(brace
r_case
id|MODE_HDLC
suffix:colon
id|result
op_assign
id|hdlc-&gt;set_mode
ques
c_cond
id|hdlc
op_member_access_from_pointer
id|set_mode
c_func
(paren
id|hdlc
comma
id|MODE_HDLC
)paren
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_CISCO
suffix:colon
multiline_comment|/* By card */
macro_line|#ifdef CONFIG_HDLC_PPP
r_case
id|MODE_PPP
suffix:colon
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_case
id|MODE_X25
suffix:colon
macro_line|#endif
r_case
id|MODE_FR
suffix:colon
id|result
op_assign
id|hdlc-&gt;set_mode
ques
c_cond
id|hdlc
op_member_access_from_pointer
id|set_mode
c_func
(paren
id|hdlc
comma
id|mode
)paren
suffix:colon
op_minus
id|ENOSYS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
)paren
(brace
id|mode
op_or_assign
id|MODE_SOFT
suffix:semicolon
multiline_comment|/* Try &quot;host software&quot; protocol */
r_switch
c_cond
(paren
id|mode
op_amp
id|MODE_MASK
)paren
(brace
r_case
id|MODE_CISCO
suffix:colon
id|dev-&gt;hard_header
op_assign
id|cisco_hard_header
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_PPP
r_case
id|MODE_PPP
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_case
id|MODE_X25
suffix:colon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|MODE_FR
suffix:colon
id|dev-&gt;hard_header
op_assign
id|fr_hard_header
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|2
suffix:semicolon
op_star
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
op_assign
id|htons
c_func
(paren
id|LMI_DLCI
)paren
suffix:semicolon
id|dlci_to_q922
c_func
(paren
id|dev-&gt;broadcast
comma
id|LMI_DLCI
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|result
op_assign
id|hdlc-&gt;set_mode
ques
c_cond
id|hdlc
op_member_access_from_pointer
id|set_mode
c_func
(paren
id|hdlc
comma
id|MODE_HDLC
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
)paren
r_return
id|result
suffix:semicolon
id|hdlc-&gt;mode
op_assign
id|mode
suffix:semicolon
r_switch
c_cond
(paren
id|mode
op_amp
id|MODE_MASK
)paren
(brace
macro_line|#ifdef CONFIG_HDLC_PPP
r_case
id|MODE_PPP
suffix:colon
id|dev-&gt;type
op_assign
id|ARPHRD_PPP
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HDLC_X25
r_case
id|MODE_X25
suffix:colon
id|dev-&gt;type
op_assign
id|ARPHRD_X25
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|MODE_FR
suffix:colon
id|dev-&gt;type
op_assign
id|ARPHRD_FRAD
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MODE_CISCO
suffix:colon
id|dev-&gt;type
op_assign
id|ARPHRD_CISCO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev-&gt;type
op_assign
id|ARPHRD_RAWHDLC
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
(paren
id|hdlc-&gt;stats
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
id|destroy_pvc_list
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hdlc_fr_pvc
r_static
r_int
id|hdlc_fr_pvc
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_int
id|dlci
)paren
(brace
id|pvc_device
op_star
op_star
id|pvc_p
op_assign
op_amp
id|hdlc-&gt;first_pvc
suffix:semicolon
id|pvc_device
op_star
id|pvc
suffix:semicolon
r_int
id|result
comma
id|create
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Create or delete PVC */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dlci
OL
l_int|0
)paren
(brace
id|dlci
op_assign
op_minus
id|dlci
suffix:semicolon
id|create
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dlci
op_le
l_int|0
op_logical_or
id|dlci
op_ge
l_int|1024
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Only 10 bits for DLCI, DLCI=0 is reserved */
r_if
c_cond
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_FR
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Only meaningfull on FR */
r_while
c_loop
(paren
op_star
id|pvc_p
)paren
(brace
r_if
c_cond
(paren
id|netdev_dlci
c_func
(paren
op_amp
(paren
op_star
id|pvc_p
)paren
op_member_access_from_pointer
id|netdev
)paren
op_eq
id|dlci
)paren
r_break
suffix:semicolon
id|pvc_p
op_assign
op_amp
(paren
op_star
id|pvc_p
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|create
)paren
(brace
multiline_comment|/* Create PVC */
r_if
c_cond
(paren
op_star
id|pvc_p
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
id|pvc
op_assign
op_star
id|pvc_p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|pvc_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Memory squeeze on &quot;
l_string|&quot;hdlc_fr_pvc()&bslash;n&quot;
comma
id|hdlc_to_name
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pvc
comma
l_int|0
comma
r_sizeof
(paren
id|pvc_device
)paren
)paren
suffix:semicolon
id|pvc-&gt;netdev.hard_start_xmit
op_assign
id|pvc_xmit
suffix:semicolon
id|pvc-&gt;netdev.get_stats
op_assign
id|pvc_get_stats
suffix:semicolon
id|pvc-&gt;netdev.open
op_assign
id|pvc_open
suffix:semicolon
id|pvc-&gt;netdev.stop
op_assign
id|pvc_close
suffix:semicolon
id|pvc-&gt;netdev.change_mtu
op_assign
id|pvc_change_mtu
suffix:semicolon
id|pvc-&gt;netdev.mtu
op_assign
id|HDLC_MAX_MTU
suffix:semicolon
id|pvc-&gt;netdev.type
op_assign
id|ARPHRD_DLCI
suffix:semicolon
id|pvc-&gt;netdev.hard_header_len
op_assign
l_int|16
suffix:semicolon
id|pvc-&gt;netdev.hard_header
op_assign
id|fr_hard_header
suffix:semicolon
id|pvc-&gt;netdev.tx_queue_len
op_assign
l_int|0
suffix:semicolon
id|pvc-&gt;netdev.flags
op_assign
id|IFF_POINTOPOINT
suffix:semicolon
id|pvc-&gt;master
op_assign
id|hdlc
suffix:semicolon
op_star
(paren
id|u16
op_star
)paren
id|pvc-&gt;netdev.dev_addr
op_assign
id|htons
c_func
(paren
id|dlci
)paren
suffix:semicolon
id|dlci_to_q922
c_func
(paren
id|pvc-&gt;netdev.broadcast
comma
id|dlci
)paren
suffix:semicolon
id|pvc-&gt;netdev.addr_len
op_assign
l_int|2
suffix:semicolon
id|pvc-&gt;netdev.irq
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
op_member_access_from_pointer
id|irq
suffix:semicolon
id|result
op_assign
id|dev_alloc_name
c_func
(paren
op_amp
id|pvc-&gt;netdev
comma
l_string|&quot;pvc%d&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|pvc
)paren
suffix:semicolon
op_star
id|pvc_p
op_assign
l_int|NULL
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_if
c_cond
(paren
id|register_netdevice
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
op_ne
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|pvc
)paren
suffix:semicolon
op_star
id|pvc_p
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_SOFT
)paren
op_logical_and
id|hdlc-&gt;create_pvc
)paren
(brace
id|result
op_assign
id|hdlc
op_member_access_from_pointer
id|create_pvc
c_func
(paren
id|pvc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|unregister_netdevice
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pvc
)paren
suffix:semicolon
op_star
id|pvc_p
op_assign
l_int|NULL
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
)brace
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
id|hdlc-&gt;pvc_count
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|pvc_p
op_eq
l_int|NULL
)paren
multiline_comment|/* Delete PVC */
r_return
op_minus
id|ENOENT
suffix:semicolon
id|pvc
op_assign
op_star
id|pvc_p
suffix:semicolon
r_if
c_cond
(paren
id|pvc-&gt;netdev.flags
op_amp
id|IFF_UP
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* PVC in use */
r_if
c_cond
(paren
op_logical_neg
id|mode_is
c_func
(paren
id|hdlc
comma
id|MODE_SOFT
)paren
op_logical_and
id|hdlc-&gt;destroy_pvc
)paren
id|hdlc
op_member_access_from_pointer
id|destroy_pvc
c_func
(paren
id|pvc
)paren
suffix:semicolon
id|hdlc-&gt;lmi.state
op_or_assign
id|LINK_STATE_CHANGED
suffix:semicolon
id|hdlc-&gt;pvc_count
op_decrement
suffix:semicolon
op_star
id|pvc_p
op_assign
id|pvc-&gt;next
suffix:semicolon
id|unregister_netdevice
c_func
(paren
op_amp
id|pvc-&gt;netdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pvc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hdlc_ioctl
r_static
r_int
id|hdlc_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|HDLCGMODE
suffix:colon
id|ifr-&gt;ifr_ifru.ifru_ivalue
op_assign
id|hdlc-&gt;mode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|HDLCSMODE
suffix:colon
r_return
id|hdlc_set_mode
c_func
(paren
id|hdlc
comma
id|ifr-&gt;ifr_ifru.ifru_ivalue
)paren
suffix:semicolon
r_case
id|HDLCPVC
suffix:colon
r_return
id|hdlc_fr_pvc
c_func
(paren
id|hdlc
comma
id|ifr-&gt;ifr_ifru.ifru_ivalue
)paren
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|hdlc-&gt;ioctl
op_ne
l_int|NULL
)paren
r_return
id|hdlc
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|hdlc
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|hdlc_init
r_static
r_int
id|hdlc_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
(paren
id|hdlc-&gt;stats
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|hdlc_get_stats
suffix:semicolon
id|dev-&gt;open
op_assign
id|hdlc_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|hdlc_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|hdlc_xmit
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|hdlc_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|hdlc_change_mtu
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|HDLC_MAX_MTU
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_RAWHDLC
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
l_int|16
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|register_hdlc_device
r_int
id|register_hdlc_device
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
r_int
id|result
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|dev-&gt;init
op_assign
id|hdlc_init
suffix:semicolon
id|dev-&gt;priv
op_assign
op_amp
id|hdlc-&gt;syncppp_ptr
suffix:semicolon
id|hdlc-&gt;syncppp_ptr
op_assign
op_amp
id|hdlc-&gt;pppdev
suffix:semicolon
id|hdlc-&gt;pppdev.dev
op_assign
id|dev
suffix:semicolon
id|hdlc-&gt;mode
op_assign
id|MODE_NONE
suffix:semicolon
id|hdlc-&gt;lmi.T391
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* polling verification timer */
id|hdlc-&gt;lmi.T392
op_assign
l_int|15
suffix:semicolon
multiline_comment|/* link integrity verification polling timer */
id|hdlc-&gt;lmi.N391
op_assign
l_int|6
suffix:semicolon
multiline_comment|/* full status polling counter */
id|hdlc-&gt;lmi.N392
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* error threshold */
id|hdlc-&gt;lmi.N393
op_assign
l_int|4
suffix:semicolon
multiline_comment|/* monitored events count */
id|result
op_assign
id|dev_alloc_name
c_func
(paren
id|dev
comma
l_string|&quot;hdlc%d&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_return
id|result
suffix:semicolon
id|result
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unregister_hdlc_device
r_void
id|unregister_hdlc_device
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
id|destroy_pvc_list
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Krzysztof Halasa &lt;khc@pm.waw.pl&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;HDLC support module&quot;
)paren
suffix:semicolon
DECL|variable|hdlc_netif_rx
id|EXPORT_SYMBOL
c_func
(paren
id|hdlc_netif_rx
)paren
suffix:semicolon
DECL|variable|register_hdlc_device
id|EXPORT_SYMBOL
c_func
(paren
id|register_hdlc_device
)paren
suffix:semicolon
DECL|variable|unregister_hdlc_device
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_hdlc_device
)paren
suffix:semicolon
DECL|function|hdlc_module_init
r_static
r_int
id|__init
id|hdlc_module_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hdlc_module_init
id|module_init
c_func
(paren
id|hdlc_module_init
)paren
suffix:semicolon
eof
