DECL|macro|USE_PCI_CLOCK
mdefine_line|#define&t;USE_PCI_CLOCK
DECL|variable|rcsid
r_static
r_char
id|rcsid
(braket
)braket
op_assign
l_string|&quot;Revision: 3.4.5 Date: 2002/03/07 &quot;
suffix:semicolon
multiline_comment|/*&n; * pc300.c&t;Cyclades-PC300(tm) Driver.&n; *&n; * Author:&t;Ivan Passos &lt;ivan@cyclades.com&gt;&n; * Maintainer:&t;Daniela Squassoni &lt;daniela@cyclades.com&gt;&n; *&n; * Copyright:&t;(c) 1999-2002 Cyclades Corp.&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License&n; *&t;as published by the Free Software Foundation; either version&n; *&t;2 of the License, or (at your option) any later version.&n; *&t;&n; *&t;Using tabstop = 4.&n; * &n; * $Log: pc300_drv.c,v $&n; * Revision 3.23  2002/03/20 13:58:40  henrique&n; * Fixed ortographic mistakes&n; *&n; * Revision 3.22  2002/03/13 16:56:56  henrique&n; * Take out the debug messages&n; *&n; * Revision 3.21  2002/03/07 14:17:09  henrique&n; * License data fixed&n; *&n; * Revision 3.20  2002/01/17 17:58:52  ivan&n; * Support for PC300-TE/M (PMC).&n; *&n; * Revision 3.19  2002/01/03 17:08:47  daniela&n; * Enables DMA reception when the SCA-II disables it improperly.&n; *&n; * Revision 3.18  2001/12/03 18:47:50  daniela&n; * Esthetic changes.&n; *&n; * Revision 3.17  2001/10/19 16:50:13  henrique&n; * Patch to kernel 2.4.12 and new generic hdlc.&n; *&n; * Revision 3.16  2001/10/16 15:12:31  regina&n; * clear statistics&n; *&n; * Revision 3.11 to 3.15  2001/10/11 20:26:04  daniela&n; * More DMA fixes for noisy lines.&n; * Return the size of bad frames in dma_get_rx_frame_size, so that the Rx buffer&n; * descriptors can be cleaned by dma_buf_read (called in cpc_net_rx).&n; * Renamed dma_start routine to rx_dma_start. Improved Rx statistics.&n; * Fixed BOF interrupt treatment. Created dma_start routine.&n; * Changed min and max to cpc_min and cpc_max.&n; *&n; * Revision 3.10  2001/08/06 12:01:51  regina&n; * Fixed problem in DSR_DE bit.&n; *&n; * Revision 3.9  2001/07/18 19:27:26  daniela&n; * Added some history comments.&n; *&n; * Revision 3.8  2001/07/12 13:11:19  regina&n; * bug fix - DCD-OFF in pc300 tty driver&n; *&n; * Revision 3.3 to 3.7  2001/07/06 15:00:20  daniela&n; * Removing kernel 2.4.3 and previous support.&n; * DMA transmission bug fix.&n; * MTU check in cpc_net_rx fixed.&n; * Boot messages reviewed.&n; * New configuration parameters (line code, CRC calculation and clock).&n; *&n; * Revision 3.2 2001/06/22 13:13:02  regina&n; * MLPPP implementation. Changed the header of message trace to include&n; * the device name. New format : &quot;hdlcX[R/T]: &quot;.&n; * Default configuration changed.&n; *&n; * Revision 3.1 2001/06/15 regina&n; * in cpc_queue_xmit, netif_stop_queue is called if don&squot;t have free descriptor&n; * upping major version number&n; *&n; * Revision 1.1.1.1  2001/06/13 20:25:04  daniela&n; * PC300 initial CVS version (3.4.0-pre1)&n; *&n; * Revision 3.0.1.2 2001/06/08 daniela&n; * Did some changes in the DMA programming implementation to avoid the &n; * occurrence of a SCA-II bug when CDA is accessed during a DMA transfer.&n; *&n; * Revision 3.0.1.1 2001/05/02 daniela&n; * Added kernel 2.4.3 support.&n; * &n; * Revision 3.0.1.0 2001/03/13 daniela, henrique&n; * Added Frame Relay Support.&n; * Driver now uses HDLC generic driver to provide protocol support.&n; * &n; * Revision 3.0.0.8 2001/03/02 daniela&n; * Fixed ram size detection. &n; * Changed SIOCGPC300CONF ioctl, to give hw information to pc300util.&n; * &n; * Revision 3.0.0.7 2001/02/23 daniela&n; * netif_stop_queue called before the SCA-II transmition commands in &n; * cpc_queue_xmit, and with interrupts disabled to avoid race conditions with &n; * transmition interrupts.&n; * Fixed falc_check_status for Unframed E1.&n; * &n; * Revision 3.0.0.6 2000/12/13 daniela&n; * Implemented pc300util support: trace, statistics, status and loopback&n; * tests for the PC300 TE boards.&n; * &n; * Revision 3.0.0.5 2000/12/12 ivan&n; * Added support for Unframed E1.&n; * Implemented monitor mode.&n; * Fixed DCD sensitivity on the second channel.&n; * Driver now complies with new PCI kernel architecture.&n; *&n; * Revision 3.0.0.4 2000/09/28 ivan&n; * Implemented DCD sensitivity.&n; * Moved hardware-specific open to the end of cpc_open, to avoid race&n; * conditions with early reception interrupts.&n; * Included code for [request|release]_mem_region().&n; * Changed location of pc300.h .&n; * Minor code revision (contrib. of Jeff Garzik).&n; *&n; * Revision 3.0.0.3 2000/07/03 ivan&n; * Previous bugfix for the framing errors with external clock made X21&n; * boards stop working. This version fixes it.&n; *&n; * Revision 3.0.0.2 2000/06/23 ivan&n; * Revisited cpc_queue_xmit to prevent race conditions on Tx DMA buffer&n; * handling when Tx timeouts occur.&n; * Revisited Rx statistics.&n; * Fixed a bug in the SCA-II programming that would cause framing errors&n; * when external clock was configured.&n; *&n; * Revision 3.0.0.1 2000/05/26 ivan&n; * Added logic in the SCA interrupt handler so that no board can monopolize&n; * the driver.&n; * Request PLX I/O region, although driver doesn&squot;t use it, to avoid&n; * problems with other drivers accessing it.&n; *&n; * Revision 3.0.0.0 2000/05/15 ivan&n; * Did some changes in the DMA programming implementation to avoid the&n; * occurrence of a SCA-II bug in the second channel.&n; * Implemented workaround for PLX9050 bug that would cause a system lockup&n; * in certain systems, depending on the MMIO addresses allocated to the&n; * board.&n; * Fixed the FALC chip programming to avoid synchronization problems in the&n; * second channel (TE only).&n; * Implemented a cleaner and faster Tx DMA descriptor cleanup procedure in&n; * cpc_queue_xmit().&n; * Changed the built-in driver implementation so that the driver can use the&n; * general &squot;hdlcN&squot; naming convention instead of proprietary device names.&n; * Driver load messages are now device-centric, instead of board-centric.&n; * Dynamic allocation of net_device structures.&n; * Code is now compliant with the new module interface (module_[init|exit]).&n; * Make use of the PCI helper functions to access PCI resources.&n; *&n; * Revision 2.0.0.0 2000/04/15 ivan&n; * Added support for the PC300/TE boards (T1/FT1/E1/FE1).&n; *&n; * Revision 1.1.0.0 2000/02/28 ivan&n; * Major changes in the driver architecture.&n; * Softnet compliancy implemented.&n; * Driver now reports physical instead of virtual memory addresses.&n; * Added cpc_change_mtu function.&n; *&n; * Revision 1.0.0.0 1999/12/16 ivan&n; * First official release.&n; * Support for 1- and 2-channel boards (which use distinct PCI Device ID&squot;s).&n; * Support for monolythic installation (i.e., drv built into the kernel).&n; * X.25 additional checking when lapb_[dis]connect_request returns an error.&n; * SCA programming now covers X.21 as well.&n; *&n; * Revision 0.3.1.0 1999/11/18 ivan&n; * Made X.25 support configuration-dependent (as it depends on external &n; * modules to work).&n; * Changed X.25-specific function names to comply with adopted convention.&n; * Fixed typos in X.25 functions that would cause compile errors (Daniela).&n; * Fixed bug in ch_config that would disable interrupts on a previously &n; * enabled channel if the other channel on the same board was enabled later.&n; *&n; * Revision 0.3.0.0 1999/11/16 daniela&n; * X.25 support.&n; *&n; * Revision 0.2.3.0 1999/11/15 ivan&n; * Function cpc_ch_status now provides more detailed information.&n; * Added support for X.21 clock configuration.&n; * Changed TNR1 setting in order to prevent Tx FIFO overaccesses by the SCA.&n; * Now using PCI clock instead of internal oscillator clock for the SCA.&n; *&n; * Revision 0.2.2.0 1999/11/10 ivan&n; * Changed the *_dma_buf_check functions so that they would print only &n; * the useful info instead of the whole buffer descriptor bank.&n; * Fixed bug in cpc_queue_xmit that would eventually crash the system &n; * in case of a packet drop.&n; * Implemented TX underrun handling.&n; * Improved SCA fine tuning to boost up its performance.&n; *&n; * Revision 0.2.1.0 1999/11/03 ivan&n; * Added functions *dma_buf_pt_init to allow independent initialization &n; * of the next-descr. and DMA buffer pointers on the DMA descriptors.&n; * Kernel buffer release and tbusy clearing is now done in the interrupt &n; * handler.&n; * Fixed bug in cpc_open that would cause an interface reopen to fail.&n; * Added a protocol-specific code section in cpc_net_rx.&n; * Removed printk level defs (they might be added back after the beta phase).&n; *&n; * Revision 0.2.0.0 1999/10/28 ivan&n; * Revisited the code so that new protocols can be easily added / supported. &n; *&n; * Revision 0.1.0.1 1999/10/20 ivan&n; * Mostly &quot;esthetic&quot; changes.&n; *&n; * Revision 0.1.0.0 1999/10/11 ivan&n; * Initial version.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;net/syncppp.h&gt;
macro_line|#include &quot;pc300.h&quot;
DECL|macro|CPC_LOCK
mdefine_line|#define&t;CPC_LOCK(card,flags)&t;&t;&bslash;&n;&t;&t;do {&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_lock_irqsave(&amp;card-&gt;card_lock, flags);&t;&bslash;&n;&t;&t;} while (0)
DECL|macro|CPC_UNLOCK
mdefine_line|#define CPC_UNLOCK(card,flags)&t;&t;&t;&bslash;&n;&t;&t;do {&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;spin_unlock_irqrestore(&amp;card-&gt;card_lock, flags);&t;&bslash;&n;&t;&t;} while (0)
DECL|macro|PC300_DEBUG_PCI
macro_line|#undef&t;PC300_DEBUG_PCI
DECL|macro|PC300_DEBUG_INTR
macro_line|#undef&t;PC300_DEBUG_INTR
DECL|macro|PC300_DEBUG_TX
macro_line|#undef&t;PC300_DEBUG_TX
DECL|macro|PC300_DEBUG_RX
macro_line|#undef&t;PC300_DEBUG_RX
DECL|macro|PC300_DEBUG_OTHER
macro_line|#undef&t;PC300_DEBUG_OTHER
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|cpc_pci_dev_id
(braket
)braket
id|__devinitdata
op_assign
(brace
multiline_comment|/* PC300/RSV or PC300/X21, 2 chan */
(brace
l_int|0x120e
comma
l_int|0x300
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x300
)brace
comma
multiline_comment|/* PC300/RSV or PC300/X21, 1 chan */
(brace
l_int|0x120e
comma
l_int|0x301
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x301
)brace
comma
multiline_comment|/* PC300/TE, 2 chan */
(brace
l_int|0x120e
comma
l_int|0x310
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x310
)brace
comma
multiline_comment|/* PC300/TE, 1 chan */
(brace
l_int|0x120e
comma
l_int|0x311
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x311
)brace
comma
multiline_comment|/* PC300/TE-M, 2 chan */
(brace
l_int|0x120e
comma
l_int|0x320
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x320
)brace
comma
multiline_comment|/* PC300/TE-M, 1 chan */
(brace
l_int|0x120e
comma
l_int|0x321
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0x321
)brace
comma
multiline_comment|/* End of table */
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|cpc_pci_dev_id
)paren
suffix:semicolon
macro_line|#ifndef cpc_min
DECL|macro|cpc_min
mdefine_line|#define&t;cpc_min(a,b)&t;(((a)&lt;(b))?(a):(b))
macro_line|#endif
macro_line|#ifndef cpc_max
DECL|macro|cpc_max
mdefine_line|#define&t;cpc_max(a,b)&t;(((a)&gt;(b))?(a):(b))
macro_line|#endif
multiline_comment|/* prototypes */
r_static
r_void
id|tx_dma_buf_pt_init
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|tx_dma_buf_init
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|rx_dma_buf_pt_init
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|rx_dma_buf_init
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|tx_dma_buf_check
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|rx_dma_buf_check
c_func
(paren
id|pc300_t
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|cpc_intr
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|cpc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|clock_rate_calc
c_func
(paren
id|uclong
comma
id|uclong
comma
r_int
op_star
)paren
suffix:semicolon
r_static
id|uclong
id|detect_ram
c_func
(paren
id|pc300_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|plx_init
c_func
(paren
id|pc300_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|cpc_trace
c_func
(paren
r_struct
id|net_device
op_star
comma
r_struct
id|sk_buff
op_star
comma
r_char
)paren
suffix:semicolon
r_static
r_int
id|cpc_attach
c_func
(paren
id|hdlc_device
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PC300_MLPPP
r_void
id|cpc_tty_init
c_func
(paren
id|pc300dev_t
op_star
id|dev
)paren
suffix:semicolon
r_void
id|cpc_tty_unregister_service
c_func
(paren
id|pc300dev_t
op_star
id|pc300dev
)paren
suffix:semicolon
r_void
id|cpc_tty_receive
c_func
(paren
id|pc300dev_t
op_star
id|pc300dev
)paren
suffix:semicolon
r_void
id|cpc_tty_trigger_poll
c_func
(paren
id|pc300dev_t
op_star
id|pc300dev
)paren
suffix:semicolon
r_void
id|cpc_tty_reset_var
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/************************/
multiline_comment|/***   DMA Routines   ***/
multiline_comment|/************************/
DECL|function|tx_dma_buf_pt_init
r_static
r_void
id|tx_dma_buf_pt_init
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ch_factor
op_assign
id|ch
op_star
id|N_DMA_TX_BUF
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|DMA_TX_BD_BASE
op_plus
id|ch_factor
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|N_DMA_TX_BUF
suffix:semicolon
id|i
op_increment
comma
id|ptdescr
op_increment
)paren
(brace
id|cpc_writel
c_func
(paren
op_amp
id|ptdescr-&gt;next
comma
(paren
id|uclong
)paren
(paren
id|DMA_TX_BD_BASE
op_plus
(paren
id|ch_factor
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_TX_BUF
op_minus
l_int|1
)paren
)paren
)paren
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
comma
(paren
id|uclong
)paren
(paren
id|DMA_TX_BASE
op_plus
(paren
id|ch_factor
op_plus
id|i
)paren
op_star
id|BD_DEF_LEN
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|tx_dma_buf_init
r_static
r_void
id|tx_dma_buf_init
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ch_factor
op_assign
id|ch
op_star
id|N_DMA_TX_BUF
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|DMA_TX_BD_BASE
op_plus
id|ch_factor
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|N_DMA_TX_BUF
suffix:semicolon
id|i
op_increment
comma
id|ptdescr
op_increment
)paren
(brace
id|memset_io
c_func
(paren
id|ptdescr
comma
l_int|0
comma
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
op_amp
id|ptdescr-&gt;len
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
id|DST_OSB
)paren
suffix:semicolon
)brace
id|tx_dma_buf_pt_init
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
DECL|function|rx_dma_buf_pt_init
r_static
r_void
id|rx_dma_buf_pt_init
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ch_factor
op_assign
id|ch
op_star
id|N_DMA_RX_BUF
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|DMA_RX_BD_BASE
op_plus
id|ch_factor
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|N_DMA_RX_BUF
suffix:semicolon
id|i
op_increment
comma
id|ptdescr
op_increment
)paren
(brace
id|cpc_writel
c_func
(paren
op_amp
id|ptdescr-&gt;next
comma
(paren
id|uclong
)paren
(paren
id|DMA_RX_BD_BASE
op_plus
(paren
id|ch_factor
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_RX_BUF
op_minus
l_int|1
)paren
)paren
)paren
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
comma
(paren
id|uclong
)paren
(paren
id|DMA_RX_BASE
op_plus
(paren
id|ch_factor
op_plus
id|i
)paren
op_star
id|BD_DEF_LEN
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|rx_dma_buf_init
r_static
r_void
id|rx_dma_buf_init
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|ch_factor
op_assign
id|ch
op_star
id|N_DMA_RX_BUF
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|DMA_RX_BD_BASE
op_plus
id|ch_factor
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|N_DMA_RX_BUF
suffix:semicolon
id|i
op_increment
comma
id|ptdescr
op_increment
)paren
(brace
id|memset_io
c_func
(paren
id|ptdescr
comma
l_int|0
comma
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
op_amp
id|ptdescr-&gt;len
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
l_int|0
)paren
suffix:semicolon
)brace
id|rx_dma_buf_pt_init
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
DECL|function|tx_dma_buf_check
r_static
r_void
id|tx_dma_buf_check
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ucshort
id|first_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_first_bd
suffix:semicolon
id|ucshort
id|next_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_next_bd
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;#CH%d: f_bd = %d(0x%08x), n_bd = %d(0x%08x)&bslash;n&quot;
comma
id|ch
comma
id|first_bd
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|first_bd
)paren
comma
id|next_bd
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|next_bd
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|first_bd
comma
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|first_bd
)paren
)paren
suffix:semicolon
id|i
op_ne
(paren
(paren
id|next_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_TX_BUF
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|i
op_assign
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_TX_BUF
op_minus
l_int|1
)paren
comma
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|i
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n CH%d TX%d: next=0x%lx, ptbuf=0x%lx, ST=0x%x, len=%d&quot;
comma
id|ch
comma
id|i
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
)paren
comma
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
comma
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef&t;PC300_DEBUG_OTHER
multiline_comment|/* Show all TX buffer descriptors */
DECL|function|tx1_dma_buf_check
r_static
r_void
id|tx1_dma_buf_check
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ucshort
id|first_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_first_bd
suffix:semicolon
id|ucshort
id|next_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_next_bd
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|printk
(paren
l_string|&quot;&bslash;nnfree_tx_bd = %d &bslash;n&quot;
comma
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|nfree_tx_bd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;#CH%d: f_bd = %d(0x%08x), n_bd = %d(0x%08x)&bslash;n&quot;
comma
id|ch
comma
id|first_bd
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|first_bd
)paren
comma
id|next_bd
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|next_bd
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TX_CDA=0x%08lx, TX_EDA=0x%08lx&bslash;n&quot;
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|N_DMA_TX_BUF
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|i
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n CH%d TX%d: next=0x%lx, ptbuf=0x%lx, ST=0x%x, len=%d&quot;
comma
id|ch
comma
id|i
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
)paren
comma
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
comma
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|rx_dma_buf_check
r_static
r_void
id|rx_dma_buf_check
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ucshort
id|first_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|rx_first_bd
suffix:semicolon
id|ucshort
id|last_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|rx_last_bd
suffix:semicolon
r_int
id|ch_factor
suffix:semicolon
id|ch_factor
op_assign
id|ch
op_star
id|N_DMA_RX_BUF
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;#CH%d: f_bd = %d, l_bd = %d&bslash;n&quot;
comma
id|ch
comma
id|first_bd
comma
id|last_bd
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|DMA_RX_BD_BASE
op_plus
id|ch_factor
op_star
r_sizeof
(paren
id|pcsca_bd_t
)paren
)paren
suffix:semicolon
id|i
OL
id|N_DMA_RX_BUF
suffix:semicolon
id|i
op_increment
comma
id|ptdescr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
op_amp
id|DST_OSB
)paren
id|printk
(paren
l_string|&quot;&bslash;n CH%d RX%d: next=0x%lx, ptbuf=0x%lx, ST=0x%x, len=%d&quot;
comma
id|ch
comma
id|i
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
)paren
comma
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
comma
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|dma_get_rx_frame_size
r_int
id|dma_get_rx_frame_size
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
id|ucshort
id|first_bd
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|rx_first_bd
suffix:semicolon
r_int
id|rcvd
op_assign
l_int|0
suffix:semicolon
r_volatile
id|ucchar
id|status
suffix:semicolon
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|first_bd
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
)paren
op_amp
id|DST_OSB
)paren
(brace
id|rcvd
op_add_assign
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
suffix:semicolon
id|first_bd
op_assign
(paren
id|first_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_RX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|DST_EOM
)paren
op_logical_or
(paren
id|first_bd
op_eq
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|rx_last_bd
)paren
)paren
(brace
multiline_comment|/* Return the size of a good frame or incomplete bad frame &n;&t;&t;&t;* (dma_buf_read will clean the buffer descriptors in this case). */
r_return
(paren
id|rcvd
)paren
suffix:semicolon
)brace
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
)paren
suffix:semicolon
)brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * dma_buf_write: writes a frame to the Tx DMA buffers&n; * NOTE: this function writes one frame at a time.&n; */
DECL|function|dma_buf_write
r_int
id|dma_buf_write
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
id|ucchar
op_star
id|ptdata
comma
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|nchar
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_int
id|tosend
op_assign
id|len
suffix:semicolon
id|ucchar
id|nbuf
op_assign
(paren
(paren
id|len
op_minus
l_int|1
)paren
op_div
id|BD_DEF_LEN
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|nbuf
op_ge
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|nfree_tx_bd
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nbuf
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_next_bd
)paren
)paren
suffix:semicolon
id|nchar
op_assign
id|cpc_min
c_func
(paren
id|BD_DEF_LEN
comma
id|tosend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
op_amp
id|DST_OSB
)paren
(brace
id|memcpy_toio
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
)paren
)paren
comma
op_amp
id|ptdata
(braket
id|len
op_minus
id|tosend
)braket
comma
id|nchar
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
op_amp
id|ptdescr-&gt;len
comma
id|nchar
)paren
suffix:semicolon
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|nfree_tx_bd
op_decrement
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_eq
id|nbuf
)paren
(brace
multiline_comment|/* This must be the last BD to be used */
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
id|DST_EOM
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|tosend
op_sub_assign
id|nchar
suffix:semicolon
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_next_bd
op_assign
(paren
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|tx_next_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_TX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* If it gets to here, it means we have sent the whole frame */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * dma_buf_read: reads a frame from the Rx DMA buffers&n; * NOTE: this function reads one frame at a time.&n; */
DECL|function|dma_buf_read
r_int
id|dma_buf_read
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|nchar
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_int
id|rcvd
op_assign
l_int|0
suffix:semicolon
r_volatile
id|ucchar
id|status
suffix:semicolon
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_first_bd
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
)paren
op_amp
id|DST_OSB
)paren
(brace
id|nchar
op_assign
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|DST_OVR
op_or
id|DST_CRC
op_or
id|DST_RBIT
op_or
id|DST_SHRT
op_or
id|DST_ABT
)paren
)paren
op_logical_or
(paren
id|nchar
OG
id|BD_DEF_LEN
)paren
)paren
(brace
r_if
c_cond
(paren
id|nchar
OG
id|BD_DEF_LEN
)paren
id|status
op_or_assign
id|DST_RBIT
suffix:semicolon
id|rcvd
op_assign
op_minus
id|status
suffix:semicolon
multiline_comment|/* Discard remaining descriptors used by the bad frame */
r_while
c_loop
(paren
id|chan-&gt;rx_first_bd
op_ne
id|chan-&gt;rx_last_bd
)paren
(brace
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;rx_first_bd
op_assign
(paren
id|chan-&gt;rx_first_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_RX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DST_EOM
)paren
r_break
suffix:semicolon
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
)paren
suffix:semicolon
id|status
op_assign
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nchar
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|skb
)paren
(brace
id|memcpy_fromio
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|nchar
)paren
comma
(paren
r_void
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;ptbuf
)paren
)paren
comma
id|nchar
)paren
suffix:semicolon
)brace
id|rcvd
op_add_assign
id|nchar
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;len
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;rx_first_bd
op_assign
(paren
id|chan-&gt;rx_first_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_RX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DST_EOM
)paren
r_break
suffix:semicolon
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|cpc_readl
c_func
(paren
op_amp
id|ptdescr-&gt;next
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rcvd
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Update pointer */
id|chan-&gt;rx_last_bd
op_assign
(paren
id|chan-&gt;rx_first_bd
op_minus
l_int|1
)paren
op_amp
(paren
id|N_DMA_RX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Update EDA */
id|cpc_writel
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DRX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
comma
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_last_bd
)paren
)paren
suffix:semicolon
)brace
r_return
(paren
id|rcvd
)paren
suffix:semicolon
)brace
DECL|function|tx_dma_stop
r_void
id|tx_dma_stop
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|ucchar
id|drr_ena_bit
op_assign
l_int|1
op_lshift
(paren
l_int|5
op_plus
l_int|2
op_star
id|ch
)paren
suffix:semicolon
id|ucchar
id|drr_rst_bit
op_assign
l_int|1
op_lshift
(paren
l_int|1
op_plus
l_int|2
op_star
id|ch
)paren
suffix:semicolon
multiline_comment|/* Disable DMA */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DRR
comma
id|drr_ena_bit
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DRR
comma
id|drr_rst_bit
op_amp
op_complement
id|drr_ena_bit
)paren
suffix:semicolon
)brace
DECL|function|rx_dma_stop
r_void
id|rx_dma_stop
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|ucchar
id|drr_ena_bit
op_assign
l_int|1
op_lshift
(paren
l_int|4
op_plus
l_int|2
op_star
id|ch
)paren
suffix:semicolon
id|ucchar
id|drr_rst_bit
op_assign
l_int|1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
suffix:semicolon
multiline_comment|/* Disable DMA */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DRR
comma
id|drr_ena_bit
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DRR
comma
id|drr_rst_bit
op_amp
op_complement
id|drr_ena_bit
)paren
suffix:semicolon
)brace
DECL|function|rx_dma_start
r_void
id|rx_dma_start
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
multiline_comment|/* Start DMA */
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
comma
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_first_bd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
)paren
op_ne
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_first_bd
)paren
)paren
(brace
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
comma
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_first_bd
)paren
)paren
suffix:semicolon
)brace
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
comma
id|RX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;rx_last_bd
)paren
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|BFLL
comma
id|ch
)paren
comma
id|BD_DEF_LEN
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
comma
id|DSR_DE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
op_amp
id|DSR_DE
)paren
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
comma
id|DSR_DE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*************************/
multiline_comment|/***   FALC Routines   ***/
multiline_comment|/*************************/
DECL|function|falc_issue_cmd
r_void
id|falc_issue_cmd
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
id|ucchar
id|cmd
)paren
(brace
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|SIS
comma
id|ch
)paren
)paren
op_amp
id|SIS_CEC
)paren
(brace
r_if
c_cond
(paren
id|i
op_increment
op_ge
id|PC300_FALC_MAXLOOP
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: FALC command locked(cmd=0x%x).&bslash;n&quot;
comma
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|d.name
comma
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CMDR
comma
id|ch
)paren
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|falc_intr_enable
r_void
id|falc_intr_enable
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
multiline_comment|/* Interrupt pins are open-drain */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IPC_IC0
)paren
suffix:semicolon
multiline_comment|/* Conters updated each second */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_ECM
)paren
suffix:semicolon
multiline_comment|/* Enable SEC and ES interrupts  */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR3_SEC
op_or
id|IMR3_ES
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_eq
id|PC300_FR_UNFRAMED
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR4
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR4_LOS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR4
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR4_LFA
op_or
id|IMR4_AIS
op_or
id|IMR4_LOS
op_or
id|IMR4_SLIP
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IMR3_LLBSC
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
)paren
op_or
id|IPC_SCI
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_eq
id|PC300_FR_UNFRAMED
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR2_LOS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR2_FAR
op_or
id|IMR2_LFA
op_or
id|IMR2_AIS
op_or
id|IMR2_LOS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfalc-&gt;multiframe_mode
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|IMR2_T400MS
op_or
id|IMR2_MFAR
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR2
comma
id|ch
)paren
)paren
op_or
id|IMR2_T400MS
op_or
id|IMR2_MFAR
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|falc_open_timeslot
r_void
id|falc_open_timeslot
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
id|timeslot
)paren
(brace
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|tshf
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|falc.offset
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|ICB1
op_plus
(paren
id|timeslot
op_minus
id|tshf
)paren
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|ICB1
op_plus
(paren
id|timeslot
op_minus
id|tshf
)paren
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
l_int|0x80
op_rshift
(paren
(paren
id|timeslot
op_minus
id|tshf
)paren
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|TTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|TTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_or
(paren
l_int|0x80
op_rshift
(paren
id|timeslot
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|RTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|RTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_or
(paren
l_int|0x80
op_rshift
(paren
id|timeslot
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|falc_close_timeslot
r_void
id|falc_close_timeslot
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
id|timeslot
)paren
(brace
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|tshf
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|falc.offset
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|ICB1
op_plus
(paren
id|timeslot
op_minus
id|tshf
)paren
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|ICB1
op_plus
(paren
id|timeslot
op_minus
id|tshf
)paren
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_or
(paren
l_int|0x80
op_rshift
(paren
(paren
id|timeslot
op_minus
id|tshf
)paren
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|TTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|TTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
l_int|0x80
op_rshift
(paren
id|timeslot
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|RTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
(paren
id|RTR1
op_plus
id|timeslot
op_div
l_int|8
)paren
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
l_int|0x80
op_rshift
(paren
id|timeslot
op_amp
l_int|0x07
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|falc_close_all_timeslots
r_void
id|falc_close_all_timeslots
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR2
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR2
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB3
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR3
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR3
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_E1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB4
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR4
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR4
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|falc_open_all_timeslots
r_void
id|falc_open_all_timeslots
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_eq
id|PC300_FR_UNFRAMED
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Timeslot 0 is never enabled */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR1
comma
id|ch
)paren
comma
l_int|0x7f
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR1
comma
id|ch
)paren
comma
l_int|0x7f
)paren
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB2
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB3
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR3
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR3
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_E1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB4
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR4
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR4
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|ICB4
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TTR4
comma
id|ch
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RTR4
comma
id|ch
)paren
comma
l_int|0x80
)paren
suffix:semicolon
)brace
)brace
DECL|function|falc_init_timeslot
r_void
id|falc_init_timeslot
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
r_int
id|tslot
suffix:semicolon
r_for
c_loop
(paren
id|tslot
op_assign
l_int|0
suffix:semicolon
id|tslot
OL
id|pfalc-&gt;num_channels
suffix:semicolon
id|tslot
op_increment
)paren
(brace
r_if
c_cond
(paren
id|conf-&gt;tslot_bitmap
op_amp
(paren
l_int|1
op_lshift
id|tslot
)paren
)paren
(brace
singleline_comment|// Channel enabled
id|falc_open_timeslot
c_func
(paren
id|card
comma
id|ch
comma
id|tslot
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// Channel disabled
id|falc_close_timeslot
c_func
(paren
id|card
comma
id|ch
comma
id|tslot
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|falc_enable_comm
r_void
id|falc_enable_comm
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
r_if
c_cond
(paren
id|pfalc-&gt;full_bandwidth
)paren
(brace
id|falc_open_all_timeslots
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|falc_init_timeslot
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
singleline_comment|// CTS/DCD ON
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_amp
op_complement
(paren
(paren
id|CPLD_REG1_FALC_DCD
op_or
id|CPLD_REG1_FALC_CTS
)paren
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|falc_disable_comm
r_void
id|falc_disable_comm
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
r_if
c_cond
(paren
id|pfalc-&gt;loop_active
op_ne
l_int|2
)paren
(brace
id|falc_close_all_timeslots
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
singleline_comment|// CTS/DCD OFF
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_or
(paren
(paren
id|CPLD_REG1_FALC_DCD
op_or
id|CPLD_REG1_FALC_CTS
)paren
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|falc_init_t1
r_void
id|falc_init_t1
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|dja
op_assign
(paren
id|ch
ques
c_cond
(paren
id|LIM2_DJA2
op_or
id|LIM2_DJA1
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Switch to T1 mode (PCM 24) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|FMR1_PMOD
)paren
suffix:semicolon
multiline_comment|/* Wait 20 us for setup */
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
multiline_comment|/* Transmit Buffer Size (1 frame) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|SIC1
comma
id|ch
)paren
comma
id|SIC1_XBS0
)paren
suffix:semicolon
multiline_comment|/* Clock mode */
r_if
c_cond
(paren
id|conf-&gt;phys_settings.clock_type
op_eq
id|CLOCK_INT
)paren
(brace
multiline_comment|/* Master mode */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_or
id|LIM0_MAS
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Slave mode */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LIM0_MAS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LOOP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LOOP
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LOOP_RTM
)paren
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
comma
id|IPC_SCI
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR0_XC0
op_or
id|FMR0_XC1
op_or
id|FMR0_RC0
op_or
id|FMR0_RC1
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;lcode
)paren
(brace
r_case
id|PC300_LC_AMI
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
id|FMR0_XC1
op_or
id|FMR0_RC1
)paren
suffix:semicolon
multiline_comment|/* Clear Channel register to ON for all channels */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CCB1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CCB2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CCB3
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LC_B8ZS
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
id|FMR0_XC0
op_or
id|FMR0_XC1
op_or
id|FMR0_RC0
op_or
id|FMR0_RC1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LC_NRZ
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
l_int|0x00
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_or
id|LIM0_ELOS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|LIM0_SCL1
op_or
id|LIM0_SCL0
)paren
)paren
suffix:semicolon
multiline_comment|/* Set interface mode to 2 MBPS */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_IMOD
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;fr_mode
)paren
(brace
r_case
id|PC300_FR_ESF
suffix:colon
id|pfalc-&gt;multiframe_mode
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
)paren
op_or
id|FMR4_FM1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_CRC
op_or
id|FMR1_EDL
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XDL1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XDL2
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XDL3
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR0_SRAF
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_MCSP
op_or
id|FMR2_SSP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_FR_D4
suffix:colon
id|pfalc-&gt;multiframe_mode
op_assign
l_int|1
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR4_FM1
op_or
id|FMR4_FM0
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
id|FMR0_SRAF
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR2_SSP
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Enable Automatic Resynchronization */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
)paren
op_or
id|FMR4_AUTO
)paren
suffix:semicolon
multiline_comment|/* Transmit Automatic Remote Alarm */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_AXRA
)paren
suffix:semicolon
multiline_comment|/* Channel translation mode 1 : one to one */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_CTM
)paren
suffix:semicolon
multiline_comment|/* No signaling */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR1_SIGM
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR5_EIBR
op_or
id|FMR5_SRS
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CCR1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
)paren
op_or
id|LIM1_RIL0
op_or
id|LIM1_RIL1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;lbo
)paren
(brace
multiline_comment|/* Provides proper Line Build Out */
r_case
id|PC300_LBO_0_DB
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM2
comma
id|ch
)paren
comma
(paren
id|LIM2_LOS1
op_or
id|dja
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM0
comma
id|ch
)paren
comma
l_int|0x5a
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM1
comma
id|ch
)paren
comma
l_int|0x8f
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM2
comma
id|ch
)paren
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LBO_7_5_DB
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM2
comma
id|ch
)paren
comma
(paren
l_int|0x40
op_or
id|LIM2_LOS1
op_or
id|dja
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM0
comma
id|ch
)paren
comma
l_int|0x11
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM1
comma
id|ch
)paren
comma
l_int|0x02
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM2
comma
id|ch
)paren
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LBO_15_DB
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM2
comma
id|ch
)paren
comma
(paren
l_int|0x80
op_or
id|LIM2_LOS1
op_or
id|dja
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM0
comma
id|ch
)paren
comma
l_int|0x8e
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM1
comma
id|ch
)paren
comma
l_int|0x01
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM2
comma
id|ch
)paren
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LBO_22_5_DB
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM2
comma
id|ch
)paren
comma
(paren
l_int|0xc0
op_or
id|LIM2_LOS1
op_or
id|dja
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM0
comma
id|ch
)paren
comma
l_int|0x09
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM1
comma
id|ch
)paren
comma
l_int|0x01
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM2
comma
id|ch
)paren
comma
l_int|0x20
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Transmit Clock-Slot Offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC0
comma
id|ch
)paren
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Transmit Time-slot Offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC1
comma
id|ch
)paren
comma
l_int|0x3e
)paren
suffix:semicolon
multiline_comment|/* Receive  Clock-Slot offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC0
comma
id|ch
)paren
comma
l_int|0x05
)paren
suffix:semicolon
multiline_comment|/* Receive  Time-slot offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC1
comma
id|ch
)paren
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* LOS Detection after 176 consecutive 0s */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|PCDR
comma
id|ch
)paren
comma
l_int|0x0a
)paren
suffix:semicolon
multiline_comment|/* LOS Recovery after 22 ones in the time window of PCD */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|PCRR
comma
id|ch
)paren
comma
l_int|0x15
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IDLE
comma
id|ch
)paren
comma
l_int|0x7f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_eq
id|PC300_FR_ESF_JAPAN
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC1
comma
id|ch
)paren
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
)brace
id|falc_close_all_timeslots
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
DECL|function|falc_init_e1
r_void
id|falc_init_e1
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|dja
op_assign
(paren
id|ch
ques
c_cond
(paren
id|LIM2_DJA2
op_or
id|LIM2_DJA1
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Switch to E1 mode (PCM 30) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR1_PMOD
)paren
suffix:semicolon
multiline_comment|/* Clock mode */
r_if
c_cond
(paren
id|conf-&gt;phys_settings.clock_type
op_eq
id|CLOCK_INT
)paren
(brace
multiline_comment|/* Master mode */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_or
id|LIM0_MAS
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Slave mode */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LIM0_MAS
)paren
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LOOP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LOOP
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LOOP_SFM
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IPC
comma
id|ch
)paren
comma
id|IPC_SCI
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR0_XC0
op_or
id|FMR0_XC1
op_or
id|FMR0_RC0
op_or
id|FMR0_RC1
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;lcode
)paren
(brace
r_case
id|PC300_LC_AMI
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
id|FMR0_XC1
op_or
id|FMR0_RC1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LC_HDB3
suffix:colon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR0
comma
id|ch
)paren
)paren
op_or
id|FMR0_XC0
op_or
id|FMR0_XC1
op_or
id|FMR0_RC0
op_or
id|FMR0_RC1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_LC_NRZ
suffix:colon
r_break
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|LIM0_SCL1
op_or
id|LIM0_SCL0
)paren
)paren
suffix:semicolon
multiline_comment|/* Set interface mode to 2 MBPS */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_IMOD
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM0
comma
id|ch
)paren
comma
l_int|0x18
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM1
comma
id|ch
)paren
comma
l_int|0x03
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XPM2
comma
id|ch
)paren
comma
l_int|0x00
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;fr_mode
)paren
(brace
r_case
id|PC300_FR_MF_CRC4
suffix:colon
id|pfalc-&gt;multiframe_mode
op_assign
l_int|1
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_XFS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_RFS1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR2_RFS0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR3_EXTIW
)paren
suffix:semicolon
multiline_comment|/* MultiFrame Resynchronization */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_MFCS
)paren
suffix:semicolon
multiline_comment|/* Automatic Loss of Multiframe &gt; 914 CRC errors */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_ALMF
)paren
suffix:semicolon
multiline_comment|/* S1 and SI1/SI2 spare Bits set to 1 */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_amp
op_complement
id|XSP_AXS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_or
id|XSP_EBP
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_or
id|XSP_XS13
op_or
id|XSP_XS15
)paren
suffix:semicolon
multiline_comment|/* Automatic Force Resynchronization */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_AFR
)paren
suffix:semicolon
multiline_comment|/* Transmit Automatic Remote Alarm */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_AXRA
)paren
suffix:semicolon
multiline_comment|/* Transmit Spare Bits for National Use (Y, Sn, Sa) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_or
id|XSW_XY0
op_or
id|XSW_XY1
op_or
id|XSW_XY2
op_or
id|XSW_XY3
op_or
id|XSW_XY4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_FR_MF_NON_CRC4
suffix:colon
r_case
id|PC300_FR_D4
suffix:colon
id|pfalc-&gt;multiframe_mode
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR1_XFS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR2_RFS1
op_or
id|FMR2_RFS0
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_or
id|XSW_XSIS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_or
id|XSP_XSIF
)paren
suffix:semicolon
multiline_comment|/* Automatic Force Resynchronization */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_or
id|FMR1_AFR
)paren
suffix:semicolon
multiline_comment|/* Transmit Automatic Remote Alarm */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_AXRA
)paren
suffix:semicolon
multiline_comment|/* Transmit Spare Bits for National Use (Y, Sn, Sa) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_or
id|XSW_XY0
op_or
id|XSW_XY1
op_or
id|XSW_XY2
op_or
id|XSW_XY3
op_or
id|XSW_XY4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_FR_UNFRAMED
suffix:colon
id|pfalc-&gt;multiframe_mode
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR1_XFS
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|FMR2_RFS1
op_or
id|FMR2_RFS0
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_or
id|XSP_TT0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|XSW_XTM
op_or
id|XSW_XY0
op_or
id|XSW_XY1
op_or
id|XSW_XY2
op_or
id|XSW_XY3
op_or
id|XSW_XY4
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|TSWM
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
(paren
id|FMR2_RTM
op_or
id|FMR2_DAIS
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR2_AXRA
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR1_AFR
)paren
suffix:semicolon
id|pfalc-&gt;sync
op_assign
l_int|1
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_or
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* No signaling */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_amp
op_complement
id|XSP_CASEN
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CCR1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
)paren
op_or
id|LIM1_RIL0
op_or
id|LIM1_RIL1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM2
comma
id|ch
)paren
comma
(paren
id|LIM2_LOS1
op_or
id|dja
)paren
)paren
suffix:semicolon
multiline_comment|/* Transmit Clock-Slot Offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC0
comma
id|ch
)paren
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Transmit Time-slot Offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XC1
comma
id|ch
)paren
comma
l_int|0x3e
)paren
suffix:semicolon
multiline_comment|/* Receive  Clock-Slot offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC0
comma
id|ch
)paren
comma
l_int|0x05
)paren
suffix:semicolon
multiline_comment|/* Receive  Time-slot offset */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RC1
comma
id|ch
)paren
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* LOS Detection after 176 consecutive 0s */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|PCDR
comma
id|ch
)paren
comma
l_int|0x0a
)paren
suffix:semicolon
multiline_comment|/* LOS Recovery after 22 ones in the time window of PCD */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|PCRR
comma
id|ch
)paren
comma
l_int|0x15
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IDLE
comma
id|ch
)paren
comma
l_int|0x7f
)paren
suffix:semicolon
id|falc_close_all_timeslots
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
DECL|function|falc_init_hdlc
r_void
id|falc_init_hdlc
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
multiline_comment|/* Enable transparent data transfer */
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_eq
id|PC300_FR_UNFRAMED
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|MODE
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|MODE
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|MODE
comma
id|ch
)paren
)paren
op_or
(paren
id|MODE_HRAC
op_or
id|MODE_MDS2
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RAH2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RAH1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RAL2
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RAL1
comma
id|ch
)paren
comma
l_int|0xff
)paren
suffix:semicolon
)brace
multiline_comment|/* Tx/Rx reset  */
id|falc_issue_cmd
c_func
(paren
id|card
comma
id|ch
comma
id|CMDR_RRES
op_or
id|CMDR_XRES
op_or
id|CMDR_SRES
)paren
suffix:semicolon
multiline_comment|/* Enable interrupt sources */
id|falc_intr_enable
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
DECL|function|te_config
r_void
id|te_config
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|dummy
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|memset
c_func
(paren
id|pfalc
comma
l_int|0
comma
r_sizeof
(paren
id|falc_t
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|conf-&gt;media
)paren
(brace
r_case
id|IF_IFACE_T1
suffix:colon
id|pfalc-&gt;num_channels
op_assign
id|NUM_OF_T1_CHANNELS
suffix:semicolon
id|pfalc-&gt;offset
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_IFACE_E1
suffix:colon
id|pfalc-&gt;num_channels
op_assign
id|NUM_OF_E1_CHANNELS
suffix:semicolon
id|pfalc-&gt;offset
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|conf-&gt;tslot_bitmap
op_eq
l_int|0xffffffffUL
)paren
id|pfalc-&gt;full_bandwidth
op_assign
l_int|1
suffix:semicolon
r_else
id|pfalc-&gt;full_bandwidth
op_assign
l_int|0
suffix:semicolon
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Reset the FALC chip */
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_or
(paren
id|CPLD_REG1_FALC_RESET
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_amp
op_complement
(paren
id|CPLD_REG1_FALC_RESET
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|falc_init_t1
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|falc_init_e1
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
id|falc_init_hdlc
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;rx_sens
op_eq
id|PC300_RX_SENS_SH
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LIM0_EQON
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_or
id|LIM0_EQON
)paren
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_or
(paren
(paren
id|CPLD_REG2_FALC_TX_CLK
op_or
id|CPLD_REG2_FALC_RX_CLK
)paren
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupt registers */
id|dummy
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR0
comma
id|ch
)paren
)paren
op_plus
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR1
comma
id|ch
)paren
)paren
op_plus
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR2
comma
id|ch
)paren
)paren
op_plus
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR3
comma
id|ch
)paren
)paren
suffix:semicolon
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|falc_check_status
r_void
id|falc_check_status
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
r_char
id|frs0
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
multiline_comment|/* Verify LOS */
r_if
c_cond
(paren
id|frs0
op_amp
id|FRS0_LOS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;red_alarm
)paren
(brace
id|pfalc-&gt;red_alarm
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;los
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;blue_alarm
)paren
(brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise interfere &n;&t;&t;&t;&t;&t; * with other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pfalc-&gt;red_alarm
)paren
(brace
id|pfalc-&gt;red_alarm
op_assign
l_int|0
suffix:semicolon
id|pfalc-&gt;losr
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|conf-&gt;fr_mode
op_ne
id|PC300_FR_UNFRAMED
)paren
(brace
multiline_comment|/* Verify AIS alarm */
r_if
c_cond
(paren
id|frs0
op_amp
id|FRS0_AIS
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;blue_alarm
)paren
(brace
id|pfalc-&gt;blue_alarm
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;ais
op_increment
suffix:semicolon
singleline_comment|// EVENT_AIS
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise interfere with                       other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_AIS
)brace
)brace
r_else
(brace
id|pfalc-&gt;blue_alarm
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Verify LFA */
r_if
c_cond
(paren
id|frs0
op_amp
id|FRS0_LFA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;loss_fa
)paren
(brace
id|pfalc-&gt;loss_fa
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;lfa
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;blue_alarm
op_logical_and
op_logical_neg
id|pfalc-&gt;red_alarm
)paren
(brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise &n;&t;&t;&t;&t;&t;&t; * interfere with other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pfalc-&gt;loss_fa
)paren
(brace
id|pfalc-&gt;loss_fa
op_assign
l_int|0
suffix:semicolon
id|pfalc-&gt;farec
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* Verify LMFA */
r_if
c_cond
(paren
id|pfalc-&gt;multiframe_mode
op_logical_and
(paren
id|frs0
op_amp
id|FRS0_LMFA
)paren
)paren
(brace
multiline_comment|/* D4 or CRC4 frame mode */
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;loss_mfa
)paren
(brace
id|pfalc-&gt;loss_mfa
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;lmfa
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;blue_alarm
op_logical_and
op_logical_neg
id|pfalc-&gt;red_alarm
op_logical_and
op_logical_neg
id|pfalc-&gt;loss_fa
)paren
(brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise &n;&t;&t;&t;&t;&t;&t; * interfere with other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
)brace
)brace
)brace
r_else
(brace
id|pfalc-&gt;loss_mfa
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Verify Remote Alarm */
r_if
c_cond
(paren
id|frs0
op_amp
id|FRS0_RRA
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;yellow_alarm
)paren
(brace
id|pfalc-&gt;yellow_alarm
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;rai
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pfalc-&gt;sync
)paren
(brace
singleline_comment|// EVENT_RAI
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_RAI
)brace
)brace
)brace
r_else
(brace
id|pfalc-&gt;yellow_alarm
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* if !PC300_UNFRAMED */
r_if
c_cond
(paren
id|pfalc-&gt;red_alarm
op_logical_or
id|pfalc-&gt;loss_fa
op_logical_or
id|pfalc-&gt;loss_mfa
op_logical_or
id|pfalc-&gt;blue_alarm
)paren
(brace
r_if
c_cond
(paren
id|pfalc-&gt;sync
)paren
(brace
id|pfalc-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;d.line_off
op_increment
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;sync
)paren
(brace
id|pfalc-&gt;sync
op_assign
l_int|1
suffix:semicolon
id|chan-&gt;d.line_on
op_increment
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_or
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pfalc-&gt;sync
op_logical_and
op_logical_neg
id|pfalc-&gt;yellow_alarm
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;active
)paren
(brace
singleline_comment|// EVENT_FALC_NORMAL
r_if
c_cond
(paren
id|pfalc-&gt;loop_active
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_enable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_NORMAL
id|pfalc-&gt;active
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pfalc-&gt;active
)paren
(brace
id|pfalc-&gt;active
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
DECL|function|falc_update_stats
r_void
id|falc_update_stats
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucshort
id|counter
suffix:semicolon
id|counter
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FECL
comma
id|ch
)paren
)paren
suffix:semicolon
id|counter
op_or_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FECH
comma
id|ch
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|pfalc-&gt;fec
op_add_assign
id|counter
suffix:semicolon
id|counter
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CVCL
comma
id|ch
)paren
)paren
suffix:semicolon
id|counter
op_or_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CVCH
comma
id|ch
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|pfalc-&gt;cvc
op_add_assign
id|counter
suffix:semicolon
id|counter
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CECL
comma
id|ch
)paren
)paren
suffix:semicolon
id|counter
op_or_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|CECH
comma
id|ch
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|pfalc-&gt;cec
op_add_assign
id|counter
suffix:semicolon
id|counter
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|EBCL
comma
id|ch
)paren
)paren
suffix:semicolon
id|counter
op_or_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|EBCH
comma
id|ch
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|pfalc-&gt;ebc
op_add_assign
id|counter
suffix:semicolon
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
id|LCR1_EPRM
)paren
(brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|counter
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|BECL
comma
id|ch
)paren
)paren
suffix:semicolon
id|counter
op_or_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|BECH
comma
id|ch
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|pfalc-&gt;bec
op_add_assign
id|counter
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
op_logical_and
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS1
comma
id|ch
)paren
)paren
op_amp
id|FRS1_LLBAD
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS1
comma
id|ch
)paren
)paren
op_amp
id|FRS1_PDEN
)paren
)paren
)paren
op_logical_or
(paren
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_E1
)paren
op_logical_and
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RSP
comma
id|ch
)paren
)paren
op_amp
id|RSP_LLBAD
)paren
)paren
)paren
(brace
id|pfalc-&gt;prbs
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|pfalc-&gt;prbs
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_remote_loop&n; *----------------------------------------------------------------------------&n; * Description:&t;In the remote loopback mode the clock and data recovered&n; *&t;&t;from the line inputs RL1/2 or RDIP/RDIN are routed back&n; *&t;&t;to the line outputs XL1/2 or XDOP/XDON via the analog&n; *&t;&t;transmitter. As in normal mode they are processsed by&n; *&t;&t;the synchronizer and then sent to the system interface.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_remote_loop
r_void
id|falc_remote_loop
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
id|loop_on
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|loop_on
)paren
(brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise interfere with &n;&t;&t;&t; * other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
)paren
op_or
id|LIM1_RL
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LIM1_RL
)paren
suffix:semicolon
id|pfalc-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
id|pfalc-&gt;active
op_assign
l_int|0
suffix:semicolon
id|falc_issue_cmd
c_func
(paren
id|card
comma
id|ch
comma
id|CMDR_XRES
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_local_loop&n; *----------------------------------------------------------------------------&n; * Description: The local loopback mode disconnects the receive lines &n; *&t;&t;RL1/RL2 resp. RDIP/RDIN from the receiver. Instead of the&n; *&t;&t;signals coming from the line the data provided by system&n; *&t;&t;interface are routed through the analog receiver back to&n; *&t;&t;the system interface. The unipolar bit stream will be&n; *&t;&t;undisturbed transmitted on the line. Receiver and transmitter&n; *&t;&t;coding must be identical.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_local_loop
r_void
id|falc_local_loop
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
id|loop_on
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|loop_on
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_or
id|LIM0_LL
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LIM0
comma
id|ch
)paren
)paren
op_amp
op_complement
id|LIM0_LL
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_payload_loop&n; *----------------------------------------------------------------------------&n; * Description: This routine allows to enable/disable payload loopback.&n; *&t;&t;When the payload loop is activated, the received 192 bits&n; *&t;&t;of payload data will be looped back to the transmit&n; *&t;&t;direction. The framing bits, CRC6 and DL bits are not &n; *&t;&t;looped. They are originated by the FALC-LH transmitter.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_payload_loop
r_void
id|falc_payload_loop
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
id|loop_on
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|loop_on
)paren
(brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise interfere with &n;&t;&t;&t; * other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_or
id|FMR2_PLB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
)paren
op_or
id|FMR4_TM
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_or
id|XSP_TT0
)paren
suffix:semicolon
)brace
id|falc_open_all_timeslots
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR2
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR2_PLB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR4
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR4_TM
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_amp
op_complement
id|XSP_TT0
)paren
suffix:semicolon
)brace
id|pfalc-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
id|pfalc-&gt;active
op_assign
l_int|0
suffix:semicolon
id|falc_issue_cmd
c_func
(paren
id|card
comma
id|ch
comma
id|CMDR_XRES
)paren
suffix:semicolon
id|pfalc-&gt;loop_active
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * turn_off_xlu&n; *----------------------------------------------------------------------------&n; * Description:&t;Turns XLU bit off in the proper register&n; *----------------------------------------------------------------------------&n; */
DECL|function|turn_off_xlu
r_void
id|turn_off_xlu
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR5_XLU
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR3_XLU
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * turn_off_xld&n; *----------------------------------------------------------------------------&n; * Description: Turns XLD bit off in the proper register&n; *----------------------------------------------------------------------------&n; */
DECL|function|turn_off_xld
r_void
id|turn_off_xld
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR5_XLD
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
id|FMR3_XLD
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_generate_loop_up_code&n; *----------------------------------------------------------------------------&n; * Description:&t;This routine writes the proper FALC chip register in order&n; *&t;&t;to generate a LOOP activation code over a T1/E1 line.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_generate_loop_up_code
r_void
id|falc_generate_loop_up_code
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_or
id|FMR5_XLU
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
)paren
op_or
id|FMR3_XLU
)paren
suffix:semicolon
)brace
singleline_comment|// EVENT_FALC_ABNORMAL
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable this interrupt as it may otherwise interfere with &n;&t;&t; * other working boards. */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR0
comma
id|ch
)paren
)paren
op_or
id|IMR0_PDEN
)paren
suffix:semicolon
)brace
id|falc_disable_comm
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
singleline_comment|// EVENT_FALC_ABNORMAL
id|pfalc-&gt;loop_gen
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_generate_loop_down_code&n; *----------------------------------------------------------------------------&n; * Description:&t;This routine writes the proper FALC chip register in order&n; *&t;&t;to generate a LOOP deactivation code over a T1/E1 line.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_generate_loop_down_code
r_void
id|falc_generate_loop_down_code
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR5
comma
id|ch
)paren
)paren
op_or
id|FMR5_XLD
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FMR3
comma
id|ch
)paren
)paren
op_or
id|FMR3_XLD
)paren
suffix:semicolon
)brace
id|pfalc-&gt;sync
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED2
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
id|pfalc-&gt;active
op_assign
l_int|0
suffix:semicolon
singleline_comment|//?    falc_issue_cmd(card, ch, CMDR_XRES);
id|pfalc-&gt;loop_gen
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_pattern_test&n; *----------------------------------------------------------------------------&n; * Description:&t;This routine generates a pattern code and checks&n; *&t;&t;it on the reception side.&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_pattern_test
r_void
id|falc_pattern_test
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
r_int
r_int
id|activate
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
id|activate
)paren
(brace
id|pfalc-&gt;prbs
op_assign
l_int|1
suffix:semicolon
id|pfalc-&gt;bec
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Disable local loop activation/deactivation detect */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
)paren
op_or
id|IMR3_LLBSC
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable local loop activation/deactivation detect */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
)paren
op_or
id|IMR1_LLBSC
)paren
suffix:semicolon
)brace
multiline_comment|/* Activates generation and monitoring of PRBS &n;&t;&t; * (Pseudo Random Bit Sequence) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_or
id|LCR1_EPRM
op_or
id|LCR1_XPRBS
)paren
suffix:semicolon
)brace
r_else
(brace
id|pfalc-&gt;prbs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Deactivates generation and monitoring of PRBS &n;&t;&t; * (Pseudo Random Bit Sequence) */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|LCR1_EPRM
op_or
id|LCR1_XPRBS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
multiline_comment|/* Enable local loop activation/deactivation detect */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR3
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IMR3_LLBSC
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Enable local loop activation/deactivation detect */
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IMR1_LLBSC
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------------&n; * falc_pattern_test_error&n; *----------------------------------------------------------------------------&n; * Description:&t;This routine returns the bit error counter value&n; *----------------------------------------------------------------------------&n; */
DECL|function|falc_pattern_test_error
id|ucshort
id|falc_pattern_test_error
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
r_return
(paren
id|pfalc-&gt;bec
)paren
suffix:semicolon
)brace
multiline_comment|/**********************************/
multiline_comment|/***   Net Interface Routines   ***/
multiline_comment|/**********************************/
r_static
r_void
DECL|function|cpc_trace
id|cpc_trace
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
id|skb_main
comma
r_char
id|rx_tx
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|10
op_plus
id|skb_main-&gt;len
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: out of memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
l_int|10
op_plus
id|skb_main-&gt;len
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_CUST
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|10
op_plus
id|skb_main-&gt;len
suffix:semicolon
id|memcpy
c_func
(paren
id|skb-&gt;data
comma
id|dev-&gt;name
comma
l_int|5
)paren
suffix:semicolon
id|skb-&gt;data
(braket
l_int|5
)braket
op_assign
l_char|&squot;[&squot;
suffix:semicolon
id|skb-&gt;data
(braket
l_int|6
)braket
op_assign
id|rx_tx
suffix:semicolon
id|skb-&gt;data
(braket
l_int|7
)braket
op_assign
l_char|&squot;]&squot;
suffix:semicolon
id|skb-&gt;data
(braket
l_int|8
)braket
op_assign
l_char|&squot;:&squot;
suffix:semicolon
id|skb-&gt;data
(braket
l_int|9
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|skb-&gt;data
(braket
l_int|10
)braket
comma
id|skb_main-&gt;data
comma
id|skb_main-&gt;len
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|cpc_tx_timeout
r_void
id|cpc_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|d-&gt;hdlc-&gt;stats
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|uclong
id|flags
suffix:semicolon
id|ucchar
id|ilar
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_aborted_errors
op_increment
suffix:semicolon
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ilar
op_assign
id|cpc_readb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|ILAR
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: ILAR=0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ilar
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|ILAR
comma
id|ilar
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DMER
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|cpc_queue_xmit
r_int
id|cpc_queue_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|d-&gt;hdlc-&gt;stats
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|uclong
id|flags
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_TX
r_int
id|i
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chan-&gt;conf.monitor
)paren
(brace
multiline_comment|/* In monitor mode no Tx is done: ignore packet */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* DCD must be OFF: drop packet */
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_carrier_errors
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|ST3
comma
id|ch
)paren
)paren
op_amp
id|ST3_DCD
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: DCD is OFF. Going administrative down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_carrier_errors
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_TX_BUF_CLR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Write buffer to DMA buffers */
r_if
c_cond
(paren
id|dma_buf_write
c_func
(paren
id|card
comma
id|ch
comma
(paren
id|ucchar
op_star
)paren
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
op_ne
l_int|0
)paren
(brace
singleline_comment|//&t;&t;printk(&quot;%s: write error. Dropping TX packet.&bslash;n&quot;, dev-&gt;name);
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|stats-&gt;tx_errors
op_increment
suffix:semicolon
id|stats-&gt;tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef PC300_DEBUG_TX
id|printk
c_func
(paren
l_string|&quot;%s T:&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
(paren
id|skb-&gt;data
op_plus
id|i
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|d-&gt;trace_on
)paren
(brace
id|cpc_trace
c_func
(paren
id|dev
comma
id|skb
comma
l_char|&squot;T&squot;
)paren
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Start transmission */
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* verify if it has more than one free descriptor */
r_if
c_cond
(paren
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|nfree_tx_bd
op_le
l_int|1
)paren
(brace
multiline_comment|/* don&squot;t have so stop the queue */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|cpc_writel
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DTX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_next_bd
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_TX_ENA
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DSR_TX
c_func
(paren
id|ch
)paren
comma
id|DSR_DE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_or
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cpc_net_rx
r_void
id|cpc_net_rx
c_func
(paren
id|hdlc_device
op_star
id|hdlc
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|d-&gt;hdlc-&gt;stats
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_RX
r_int
id|i
suffix:semicolon
macro_line|#endif
r_int
id|rxb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|rxb
op_assign
id|dma_get_rx_frame_size
c_func
(paren
id|card
comma
id|ch
)paren
)paren
op_eq
op_minus
l_int|1
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* DCD must be OFF: drop packet */
id|printk
c_func
(paren
l_string|&quot;%s : DCD is OFF - drop %d rx bytes&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rxb
)paren
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|rxb
OG
(paren
id|dev-&gt;mtu
op_plus
l_int|40
)paren
)paren
(brace
multiline_comment|/* add headers */
id|printk
c_func
(paren
l_string|&quot;%s : MTU exceeded %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rxb
)paren
suffix:semicolon
id|skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|rxb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Memory squeeze!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|rxb
op_assign
id|dma_buf_read
c_func
(paren
id|card
comma
id|ch
comma
id|skb
)paren
)paren
op_le
l_int|0
)paren
op_logical_or
(paren
id|skb
op_eq
l_int|NULL
)paren
)paren
(brace
macro_line|#ifdef PC300_DEBUG_RX
id|printk
c_func
(paren
l_string|&quot;%s: rxb = %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rxb
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|skb
op_eq
l_int|NULL
)paren
op_logical_and
(paren
id|rxb
OG
l_int|0
)paren
)paren
(brace
multiline_comment|/* rxb &gt; dev-&gt;mtu */
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_length_errors
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rxb
OL
l_int|0
)paren
(brace
multiline_comment|/* Invalid frame */
id|rxb
op_assign
op_minus
id|rxb
suffix:semicolon
r_if
c_cond
(paren
id|rxb
op_amp
id|DST_OVR
)paren
(brace
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_fifo_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rxb
op_amp
id|DST_CRC
)paren
(brace
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_crc_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rxb
op_amp
(paren
id|DST_RBIT
op_or
id|DST_SHRT
op_or
id|DST_ABT
)paren
)paren
(brace
id|stats-&gt;rx_errors
op_increment
suffix:semicolon
id|stats-&gt;rx_frame_errors
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|skb
)paren
(brace
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
id|stats-&gt;rx_bytes
op_add_assign
id|rxb
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_RX
id|printk
c_func
(paren
l_string|&quot;%s R:&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
(paren
id|skb-&gt;data
op_plus
id|i
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|d-&gt;trace_on
)paren
(brace
id|cpc_trace
c_func
(paren
id|dev
comma
id|skb
comma
l_char|&squot;R&squot;
)paren
suffix:semicolon
)brace
id|stats-&gt;rx_packets
op_increment
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
id|ETH_P_HDLC
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/************************************/
multiline_comment|/***   PC300 Interrupt Routines   ***/
multiline_comment|/************************************/
DECL|function|sca_tx_intr
r_static
r_void
id|sca_tx_intr
c_func
(paren
id|pc300dev_t
op_star
id|dev
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|dev-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
r_volatile
id|pcsca_bd_t
op_star
id|ptdescr
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|stats
op_assign
op_amp
id|dev-&gt;hdlc-&gt;stats
suffix:semicolon
multiline_comment|/* Clean up descriptors from previous transmission */
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_first_bd
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cpc_readl
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DTX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
)paren
op_ne
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_first_bd
)paren
)paren
op_logical_and
(paren
id|cpc_readb
c_func
(paren
op_amp
id|ptdescr-&gt;status
)paren
op_amp
id|DST_OSB
)paren
)paren
(brace
id|stats-&gt;tx_packets
op_increment
suffix:semicolon
id|stats-&gt;tx_bytes
op_add_assign
id|cpc_readw
c_func
(paren
op_amp
id|ptdescr-&gt;len
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
op_amp
id|ptdescr-&gt;status
comma
id|DST_OSB
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
op_amp
id|ptdescr-&gt;len
comma
l_int|0
)paren
suffix:semicolon
id|chan-&gt;nfree_tx_bd
op_increment
suffix:semicolon
id|chan-&gt;tx_first_bd
op_assign
(paren
id|chan-&gt;tx_first_bd
op_plus
l_int|1
)paren
op_amp
(paren
id|N_DMA_TX_BUF
op_minus
l_int|1
)paren
suffix:semicolon
id|ptdescr
op_assign
(paren
id|pcsca_bd_t
op_star
)paren
(paren
id|card-&gt;hw.rambase
op_plus
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_first_bd
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
id|cpc_tty_trigger_poll
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
multiline_comment|/* Tell the upper layer we are ready to transmit more packets */
id|netif_wake_queue
c_func
(paren
(paren
r_struct
id|net_device
op_star
)paren
id|dev-&gt;hdlc
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PC300_MLPPP
)brace
macro_line|#endif
)brace
DECL|function|sca_intr
r_static
r_void
id|sca_intr
c_func
(paren
id|pc300_t
op_star
id|card
)paren
(brace
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
r_volatile
id|uclong
id|status
suffix:semicolon
r_int
id|ch
suffix:semicolon
r_int
id|intr_count
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|dsr_rx
suffix:semicolon
r_while
c_loop
(paren
(paren
id|status
op_assign
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|ISR0
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|card-&gt;hw.nchan
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
op_amp
id|chan-&gt;d
suffix:semicolon
id|hdlc_device
op_star
id|hdlc
op_assign
id|d-&gt;hdlc
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|card-&gt;card_lock
)paren
suffix:semicolon
multiline_comment|/**** Reception ****/
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DRX
c_func
(paren
(paren
id|IR0_DMIA
op_or
id|IR0_DMIB
)paren
comma
id|ch
)paren
)paren
(brace
id|ucchar
id|drx_stat
op_assign
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear RX interrupts */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
comma
id|drx_stat
op_or
id|DSR_DWE
)paren
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_INTR
id|printk
(paren
l_string|&quot;sca_intr: RX intr chan[%d] (st=0x%08lx, dsr=0x%02x)&bslash;n&quot;
comma
id|ch
comma
id|status
comma
id|drx_stat
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DRX
c_func
(paren
id|IR0_DMIA
comma
id|ch
)paren
)paren
(brace
r_if
c_cond
(paren
id|drx_stat
op_amp
id|DSR_BOF
)paren
(brace
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
multiline_comment|/* verify if driver is TTY */
r_if
c_cond
(paren
(paren
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
op_amp
id|DSR_DE
)paren
)paren
(brace
id|rx_dma_stop
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
id|cpc_tty_receive
c_func
(paren
id|d
)paren
suffix:semicolon
id|rx_dma_start
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
r_if
c_cond
(paren
(paren
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
op_amp
id|DSR_DE
)paren
)paren
(brace
id|rx_dma_stop
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
id|cpc_net_rx
c_func
(paren
id|hdlc
)paren
suffix:semicolon
multiline_comment|/* Discard invalid frames */
id|hdlc-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|hdlc-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
id|chan-&gt;rx_first_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;rx_last_bd
op_assign
id|N_DMA_RX_BUF
op_minus
l_int|1
suffix:semicolon
id|rx_dma_start
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DRX
c_func
(paren
id|IR0_DMIB
comma
id|ch
)paren
)paren
(brace
r_if
c_cond
(paren
id|drx_stat
op_amp
id|DSR_EOM
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_or
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
multiline_comment|/* verify if driver is TTY */
id|cpc_tty_receive
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_net_rx
c_func
(paren
id|hdlc
)paren
suffix:semicolon
)brace
macro_line|#else
id|cpc_net_rx
c_func
(paren
id|hdlc
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dsr_rx
op_assign
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
op_amp
id|DSR_DE
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: RX intr chan[%d] (st=0x%08lx, dsr=0x%02x, dsr2=0x%02x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ch
comma
id|status
comma
id|drx_stat
comma
id|dsr_rx
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
comma
(paren
id|dsr_rx
op_or
id|DSR_DE
)paren
op_amp
l_int|0xfe
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**** Transmission ****/
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DTX
c_func
(paren
(paren
id|IR0_EFT
op_or
id|IR0_DMIA
op_or
id|IR0_DMIB
)paren
comma
id|ch
)paren
)paren
(brace
id|ucchar
id|dtx_stat
op_assign
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_TX
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear TX interrupts */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_TX
c_func
(paren
id|ch
)paren
comma
id|dtx_stat
op_or
id|DSR_DWE
)paren
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_INTR
id|printk
(paren
l_string|&quot;sca_intr: TX intr chan[%d] (st=0x%08lx, dsr=0x%02x)&bslash;n&quot;
comma
id|ch
comma
id|status
comma
id|dtx_stat
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DTX
c_func
(paren
id|IR0_EFT
comma
id|ch
)paren
)paren
(brace
r_if
c_cond
(paren
id|dtx_stat
op_amp
id|DSR_UDRF
)paren
(brace
r_if
c_cond
(paren
id|cpc_readb
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TBN
comma
id|ch
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_TX_BUF_CLR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
id|hdlc-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|hdlc-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|sca_tx_intr
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DTX
c_func
(paren
id|IR0_DMIA
comma
id|ch
)paren
)paren
(brace
r_if
c_cond
(paren
id|dtx_stat
op_amp
id|DSR_BOF
)paren
(brace
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IR0_DTX
c_func
(paren
id|IR0_DMIB
comma
id|ch
)paren
)paren
(brace
r_if
c_cond
(paren
id|dtx_stat
op_amp
id|DSR_EOM
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
id|CPLD_REG2_FALC_LED1
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
id|sca_tx_intr
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/**** MSCI ****/
r_if
c_cond
(paren
id|status
op_amp
id|IR0_M
c_func
(paren
id|IR0_RXINTA
comma
id|ch
)paren
)paren
(brace
id|ucchar
id|st1
op_assign
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST1
comma
id|ch
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear MSCI interrupts */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST1
comma
id|ch
)paren
comma
id|st1
)paren
suffix:semicolon
macro_line|#ifdef PC300_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;sca_intr: MSCI intr chan[%d] (st=0x%08lx, st1=0x%02x)&bslash;n&quot;
comma
id|ch
comma
id|status
comma
id|st1
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|st1
op_amp
id|ST1_CDCD
)paren
(brace
multiline_comment|/* DCD changed */
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST3
comma
id|ch
)paren
)paren
op_amp
id|ST3_DCD
)paren
(brace
id|printk
(paren
l_string|&quot;%s: DCD is OFF. Going administrative down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_ne
id|PC300_PROTO_MLPPP
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#else
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|d.line_off
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* DCD = 1 */
id|printk
(paren
l_string|&quot;%s: DCD is ON. Going administrative up.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_ne
id|PC300_PROTO_MLPPP
)paren
multiline_comment|/* verify if driver is not TTY */
macro_line|#endif
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|d.line_on
op_increment
suffix:semicolon
)brace
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|card-&gt;card_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|intr_count
op_eq
l_int|10
)paren
multiline_comment|/* Too much work at this board. Force exit */
r_break
suffix:semicolon
)brace
)brace
DECL|function|falc_t1_loop_detection
r_static
r_void
id|falc_t1_loop_detection
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
id|ucchar
id|frs1
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
id|LCR1_XPRBS
)paren
op_eq
l_int|0
)paren
op_logical_and
op_logical_neg
id|pfalc-&gt;loop_gen
)paren
(brace
r_if
c_cond
(paren
id|frs1
op_amp
id|FRS1_LLBDD
)paren
(brace
singleline_comment|// A Line Loop Back Deactivation signal detected
r_if
c_cond
(paren
id|pfalc-&gt;loop_active
)paren
(brace
id|falc_remote_loop
c_func
(paren
id|card
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|frs1
op_amp
id|FRS1_LLBAD
)paren
op_logical_and
(paren
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
id|LCR1_EPRM
)paren
op_eq
l_int|0
)paren
)paren
(brace
singleline_comment|// A Line Loop Back Activation signal detected  
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;loop_active
)paren
(brace
id|falc_remote_loop
c_func
(paren
id|card
comma
id|ch
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|falc_e1_loop_detection
r_static
r_void
id|falc_e1_loop_detection
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
comma
id|ucchar
id|rsp
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
id|LCR1_XPRBS
)paren
op_eq
l_int|0
)paren
op_logical_and
op_logical_neg
id|pfalc-&gt;loop_gen
)paren
(brace
r_if
c_cond
(paren
id|rsp
op_amp
id|RSP_LLBDD
)paren
(brace
singleline_comment|// A Line Loop Back Deactivation signal detected
r_if
c_cond
(paren
id|pfalc-&gt;loop_active
)paren
(brace
id|falc_remote_loop
c_func
(paren
id|card
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|rsp
op_amp
id|RSP_LLBAD
)paren
op_logical_and
(paren
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|LCR1
comma
id|ch
)paren
)paren
op_amp
id|LCR1_EPRM
)paren
op_eq
l_int|0
)paren
)paren
(brace
singleline_comment|// A Line Loop Back Activation signal detected  
r_if
c_cond
(paren
op_logical_neg
id|pfalc-&gt;loop_active
)paren
(brace
id|falc_remote_loop
c_func
(paren
id|card
comma
id|ch
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|falc_t1_intr
r_static
r_void
id|falc_t1_intr
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|isr0
comma
id|isr3
comma
id|gis
suffix:semicolon
id|ucchar
id|dummy
suffix:semicolon
r_while
c_loop
(paren
(paren
id|gis
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|GIS
comma
id|ch
)paren
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR0
)paren
(brace
id|isr0
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR0
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr0
op_amp
id|FISR0_PDEN
)paren
(brace
multiline_comment|/* Read the bit to clear the situation */
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS1
comma
id|ch
)paren
)paren
op_amp
id|FRS1_PDEN
)paren
(brace
id|pfalc-&gt;pden
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR1
)paren
(brace
id|dummy
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR1
comma
id|ch
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR2
)paren
(brace
id|dummy
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR2
comma
id|ch
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR3
)paren
(brace
id|isr3
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR3
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr3
op_amp
id|FISR3_SEC
)paren
(brace
id|pfalc-&gt;sec
op_increment
suffix:semicolon
id|falc_update_stats
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|falc_check_status
c_func
(paren
id|card
comma
id|ch
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS0
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr3
op_amp
id|FISR3_ES
)paren
(brace
id|pfalc-&gt;es
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr3
op_amp
id|FISR3_LLBSC
)paren
(brace
id|falc_t1_loop_detection
c_func
(paren
id|card
comma
id|ch
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS1
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|falc_e1_intr
r_static
r_void
id|falc_e1_intr
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|falcbase
op_assign
id|card-&gt;hw.falcbase
suffix:semicolon
id|ucchar
id|isr1
comma
id|isr2
comma
id|isr3
comma
id|gis
comma
id|rsp
suffix:semicolon
id|ucchar
id|dummy
suffix:semicolon
r_while
c_loop
(paren
(paren
id|gis
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|GIS
comma
id|ch
)paren
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|rsp
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|RSP
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR0
)paren
(brace
id|dummy
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR0
comma
id|ch
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR1
)paren
(brace
id|isr1
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR1
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr1
op_amp
id|FISR1_XMB
)paren
(brace
r_if
c_cond
(paren
(paren
id|pfalc-&gt;xmb_cause
op_amp
l_int|2
)paren
op_logical_and
id|pfalc-&gt;multiframe_mode
)paren
(brace
r_if
c_cond
(paren
id|cpc_readb
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS0
comma
id|ch
)paren
)paren
op_amp
(paren
id|FRS0_LOS
op_or
id|FRS0_AIS
op_or
id|FRS0_LFA
)paren
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_amp
op_complement
id|XSP_AXS
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSP
comma
id|ch
)paren
)paren
op_or
id|XSP_AXS
)paren
suffix:semicolon
)brace
)brace
id|pfalc-&gt;xmb_cause
op_assign
l_int|0
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
)paren
op_or
id|IMR1_XMB
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr1
op_amp
id|FISR1_LLBSC
)paren
(brace
id|falc_e1_loop_detection
c_func
(paren
id|card
comma
id|ch
comma
id|rsp
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR2
)paren
(brace
id|isr2
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR2
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr2
op_amp
id|FISR2_T400MS
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_or
id|XSW_XRA
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr2
op_amp
id|FISR2_MFAR
)paren
(brace
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|XSW
comma
id|ch
)paren
)paren
op_amp
op_complement
id|XSW_XRA
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr2
op_amp
(paren
id|FISR2_FAR
op_or
id|FISR2_LFA
op_or
id|FISR2_AIS
op_or
id|FISR2_LOS
)paren
)paren
(brace
id|pfalc-&gt;xmb_cause
op_or_assign
l_int|2
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|IMR1
comma
id|ch
)paren
)paren
op_amp
op_complement
id|IMR1_XMB
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|gis
op_amp
id|GIS_ISR3
)paren
(brace
id|isr3
op_assign
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FISR3
comma
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isr3
op_amp
id|FISR3_SEC
)paren
(brace
id|pfalc-&gt;sec
op_increment
suffix:semicolon
id|falc_update_stats
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|falc_check_status
c_func
(paren
id|card
comma
id|ch
comma
id|cpc_readb
c_func
(paren
id|falcbase
op_plus
id|F_REG
c_func
(paren
id|FRS0
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isr3
op_amp
id|FISR3_ES
)paren
(brace
id|pfalc-&gt;es
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|falc_intr
r_static
r_void
id|falc_intr
c_func
(paren
id|pc300_t
op_star
id|card
)paren
(brace
r_int
id|ch
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|card-&gt;hw.nchan
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_T1
)paren
(brace
id|falc_t1_intr
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|falc_e1_intr
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|cpc_intr
r_static
r_void
id|cpc_intr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|pc300_t
op_star
id|card
suffix:semicolon
r_volatile
id|ucchar
id|plx_status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|dev_id
)paren
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef PC300_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;cpc_intr: spurious intr %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
multiline_comment|/* spurious intr */
)brace
r_if
c_cond
(paren
id|card-&gt;hw.rambase
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef PC300_DEBUG_INTR
id|printk
c_func
(paren
l_string|&quot;cpc_intr: spurious intr2 %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
multiline_comment|/* spurious intr */
)brace
r_switch
c_cond
(paren
id|card-&gt;hw.type
)paren
(brace
r_case
id|PC300_RSV
suffix:colon
r_case
id|PC300_X21
suffix:colon
id|sca_intr
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_TE
suffix:colon
r_while
c_loop
(paren
(paren
id|plx_status
op_assign
(paren
id|cpc_readb
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.intctl_reg
)paren
op_amp
(paren
id|PLX_9050_LINT1_STATUS
op_or
id|PLX_9050_LINT2_STATUS
)paren
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|plx_status
op_amp
id|PLX_9050_LINT1_STATUS
)paren
(brace
multiline_comment|/* SCA Interrupt */
id|sca_intr
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|plx_status
op_amp
id|PLX_9050_LINT2_STATUS
)paren
(brace
multiline_comment|/* FALC Interrupt */
id|falc_intr
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|cpc_sca_status
r_void
id|cpc_sca_status
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|ucchar
id|ilar
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|uclong
id|flags
suffix:semicolon
id|tx_dma_buf_check
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|rx_dma_buf_check
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|ilar
op_assign
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|ILAR
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;ILAR=0x%02x, WCRL=0x%02x, PCR=0x%02x, BTCR=0x%02x, BOLR=0x%02x&bslash;n&quot;
comma
id|ilar
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|WCRL
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|PCR
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|BTCR
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|BOLR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TX_CDA=0x%08lx, TX_EDA=0x%08lx&bslash;n&quot;
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RX_CDA=0x%08lx, RX_EDA=0x%08lx, BFL=0x%04x&bslash;n&quot;
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
)paren
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
)paren
comma
id|cpc_readw
c_func
(paren
id|scabase
op_plus
id|DRX_REG
c_func
(paren
id|BFLL
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DMER=0x%02x, DSR_TX=0x%02x, DSR_RX=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DMER
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_TX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DMR_TX=0x%02x, DMR_RX=0x%02x, DIR_TX=0x%02x, DIR_RX=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DMR_TX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DMR_RX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DIR_TX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DIR_RX
c_func
(paren
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DCR_TX=0x%02x, DCR_RX=0x%02x, FCT_TX=0x%02x, FCT_RX=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DCR_TX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|DCR_RX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|FCT_TX
c_func
(paren
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|FCT_RX
c_func
(paren
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MD0=0x%02x, MD1=0x%02x, MD2=0x%02x, MD3=0x%02x, IDL=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD3
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IDL
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CMD=0x%02x, SA0=0x%02x, SA1=0x%02x, TFN=0x%02x, CTL=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|SA0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|SA1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TFN
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ST0=0x%02x, ST1=0x%02x, ST2=0x%02x, ST3=0x%02x, ST4=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST2
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST3
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST4
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;CST0=0x%02x, CST1=0x%02x, CST2=0x%02x, CST3=0x%02x, FST=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CST0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CST1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CST2
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CST3
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|FST
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TRC0=0x%02x, TRC1=0x%02x, RRC=0x%02x, TBN=0x%02x, RBN=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TRC0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TRC1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RRC
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TBN
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RBN
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TFS=0x%02x, TNR0=0x%02x, TNR1=0x%02x, RNR=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TFS
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TNR0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TNR1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RNR
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TCR=0x%02x, RCR=0x%02x, TNR1=0x%02x, RNR=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TCR
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RCR
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TNR1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RNR
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TXS=0x%02x, RXS=0x%02x, EXS=0x%02x, TMCT=0x%02x, TMCR=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TXS
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RXS
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCT
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCR
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IE0=0x%02x, IE1=0x%02x, IE2=0x%02x, IE4=0x%02x, FIE=0x%02x&bslash;n&quot;
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE0
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE1
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE2
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE4
comma
id|ch
)paren
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|FIE
comma
id|ch
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IER0=0x%08lx&bslash;n&quot;
comma
(paren
id|uclong
)paren
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|IER0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ilar
op_ne
l_int|0
)paren
(brace
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|ILAR
comma
id|ilar
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DMER
comma
l_int|0x80
)paren
suffix:semicolon
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|cpc_falc_status
r_void
id|cpc_falc_status
c_func
(paren
id|pc300_t
op_star
id|card
comma
r_int
id|ch
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
op_amp
id|card-&gt;chan
(braket
id|ch
)braket
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
id|uclong
id|flags
suffix:semicolon
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CH%d:   %s %s  %d channels&bslash;n&quot;
comma
id|ch
comma
(paren
id|pfalc-&gt;sync
ques
c_cond
l_string|&quot;SYNC&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;active
ques
c_cond
l_string|&quot;ACTIVE&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|pfalc-&gt;num_channels
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;        pden=%d,  los=%d,  losr=%d,  lfa=%d,  farec=%d&bslash;n&quot;
comma
id|pfalc-&gt;pden
comma
id|pfalc-&gt;los
comma
id|pfalc-&gt;losr
comma
id|pfalc-&gt;lfa
comma
id|pfalc-&gt;farec
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;        lmfa=%d,  ais=%d,  sec=%d,  es=%d,  rai=%d&bslash;n&quot;
comma
id|pfalc-&gt;lmfa
comma
id|pfalc-&gt;ais
comma
id|pfalc-&gt;sec
comma
id|pfalc-&gt;es
comma
id|pfalc-&gt;rai
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;        bec=%d,  fec=%d,  cvc=%d,  cec=%d,  ebc=%d&bslash;n&quot;
comma
id|pfalc-&gt;bec
comma
id|pfalc-&gt;fec
comma
id|pfalc-&gt;cvc
comma
id|pfalc-&gt;cec
comma
id|pfalc-&gt;ebc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;        STATUS: %s  %s  %s  %s  %s  %s&bslash;n&quot;
comma
(paren
id|pfalc-&gt;red_alarm
ques
c_cond
l_string|&quot;RED&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;blue_alarm
ques
c_cond
l_string|&quot;BLU&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;yellow_alarm
ques
c_cond
l_string|&quot;YEL&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;loss_fa
ques
c_cond
l_string|&quot;LFA&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;loss_mfa
ques
c_cond
l_string|&quot;LMF&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
id|pfalc-&gt;prbs
ques
c_cond
l_string|&quot;PRB&quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|cpc_change_mtu
r_int
id|cpc_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|128
)paren
op_logical_or
(paren
id|new_mtu
OG
id|PC300_DEF_MTU
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cpc_ioctl
r_int
id|cpc_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|pc300conf_t
id|conf_aux
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
r_void
op_star
id|arg
op_assign
(paren
r_void
op_star
)paren
id|ifr-&gt;ifr_data
suffix:semicolon
r_union
id|line_settings
op_star
id|line
op_assign
op_amp
id|ifr-&gt;ifr_settings-&gt;ifs_line
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGPC300CONF
suffix:colon
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|conf-&gt;proto
op_ne
id|PC300_PROTO_MLPPP
)paren
(brace
id|conf-&gt;proto
op_assign
id|hdlc-&gt;proto
suffix:semicolon
)brace
macro_line|#else
id|conf-&gt;proto
op_assign
id|hdlc-&gt;proto
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
op_amp
id|conf_aux.conf
comma
id|conf
comma
r_sizeof
(paren
id|pc300chconf_t
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|conf_aux.hw
comma
op_amp
id|card-&gt;hw
comma
r_sizeof
(paren
id|pc300hw_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|conf_aux
comma
r_sizeof
(paren
id|pc300conf_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSPC300CONF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|conf_aux.conf
comma
id|arg
comma
r_sizeof
(paren
id|pc300chconf_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.cpld_id
OL
l_int|0x02
op_logical_and
id|conf_aux.conf.fr_mode
op_eq
id|PC300_FR_UNFRAMED
)paren
(brace
multiline_comment|/* CPLD_ID &lt; 0x02 doesn&squot;t support Unframed E1 */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|conf_aux.conf.proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
r_if
c_cond
(paren
id|conf-&gt;proto
op_ne
id|PC300_PROTO_MLPPP
)paren
(brace
id|memcpy
c_func
(paren
id|conf
comma
op_amp
id|conf_aux.conf
comma
r_sizeof
(paren
id|pc300chconf_t
)paren
)paren
suffix:semicolon
id|cpc_tty_init
c_func
(paren
id|d
)paren
suffix:semicolon
multiline_comment|/* init TTY driver */
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|conf_aux.conf.proto
op_eq
l_int|0xffff
)paren
(brace
r_if
c_cond
(paren
id|conf-&gt;proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
multiline_comment|/* ifdown interface */
id|cpc_close
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|conf
comma
op_amp
id|conf_aux.conf
comma
r_sizeof
(paren
id|pc300chconf_t
)paren
)paren
suffix:semicolon
id|hdlc-&gt;proto
op_assign
id|conf-&gt;proto
suffix:semicolon
)brace
)brace
macro_line|#else
id|memcpy
c_func
(paren
id|conf
comma
op_amp
id|conf_aux.conf
comma
r_sizeof
(paren
id|pc300chconf_t
)paren
)paren
suffix:semicolon
id|hdlc-&gt;proto
op_assign
id|conf-&gt;proto
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGPC300STATUS
suffix:colon
id|cpc_sca_status
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGPC300FALCSTATUS
suffix:colon
id|cpc_falc_status
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGPC300UTILSTATS
suffix:colon
(brace
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
(brace
multiline_comment|/* clear statistics */
id|memset
c_func
(paren
op_amp
id|hdlc-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|memset
c_func
(paren
op_amp
id|chan-&gt;falc
comma
l_int|0
comma
r_sizeof
(paren
id|falc_t
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|pc300stats_t
id|pc300stats
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pc300stats
comma
l_int|0
comma
r_sizeof
(paren
id|pc300stats_t
)paren
)paren
suffix:semicolon
id|pc300stats.hw_type
op_assign
id|card-&gt;hw.type
suffix:semicolon
id|pc300stats.line_on
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|d.line_on
suffix:semicolon
id|pc300stats.line_off
op_assign
id|card-&gt;chan
(braket
id|ch
)braket
dot
id|d.line_off
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|pc300stats.gen_stats
comma
op_amp
id|hdlc-&gt;stats
comma
r_sizeof
(paren
r_struct
id|net_device_stats
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
id|memcpy
c_func
(paren
op_amp
id|pc300stats.te_stats
comma
op_amp
id|chan-&gt;falc
comma
r_sizeof
(paren
id|falc_t
)paren
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|pc300stats
comma
r_sizeof
(paren
id|pc300stats_t
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCGPC300UTILSTATUS
suffix:colon
(brace
r_struct
id|pc300status
id|pc300status
suffix:semicolon
id|pc300status.hw_type
op_assign
id|card-&gt;hw.type
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|pc300status.te_status.sync
op_assign
id|chan-&gt;falc.sync
suffix:semicolon
id|pc300status.te_status.red_alarm
op_assign
id|chan-&gt;falc.red_alarm
suffix:semicolon
id|pc300status.te_status.blue_alarm
op_assign
id|chan-&gt;falc.blue_alarm
suffix:semicolon
id|pc300status.te_status.loss_fa
op_assign
id|chan-&gt;falc.loss_fa
suffix:semicolon
id|pc300status.te_status.yellow_alarm
op_assign
id|chan-&gt;falc.yellow_alarm
suffix:semicolon
id|pc300status.te_status.loss_mfa
op_assign
id|chan-&gt;falc.loss_mfa
suffix:semicolon
id|pc300status.te_status.prbs
op_assign
id|chan-&gt;falc.prbs
suffix:semicolon
)brace
r_else
(brace
id|pc300status.gen_status.dcd
op_assign
op_logical_neg
(paren
id|cpc_readb
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST3
comma
id|ch
)paren
)paren
op_amp
id|ST3_DCD
)paren
suffix:semicolon
id|pc300status.gen_status.cts
op_assign
op_logical_neg
(paren
id|cpc_readb
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|ST3
comma
id|ch
)paren
)paren
op_amp
id|ST3_CTS
)paren
suffix:semicolon
id|pc300status.gen_status.rts
op_assign
op_logical_neg
(paren
id|cpc_readb
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
)paren
op_amp
id|CTL_RTS
)paren
suffix:semicolon
id|pc300status.gen_status.dtr
op_assign
op_logical_neg
(paren
id|cpc_readb
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
)paren
op_amp
id|CTL_DTR
)paren
suffix:semicolon
multiline_comment|/* There is no DSR in HD64572 */
)brace
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|pc300status
comma
r_sizeof
(paren
id|pc300status_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCSPC300TRACE
suffix:colon
multiline_comment|/* Sets/resets a trace_flag for the respective device */
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|d-&gt;trace_on
comma
id|arg
comma
r_sizeof
(paren
r_int
r_char
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSPC300LOOPBACK
suffix:colon
(brace
r_struct
id|pc300loopback
id|pc300loop
suffix:semicolon
multiline_comment|/* TE boards only */
r_if
c_cond
(paren
id|card-&gt;hw.type
op_ne
id|PC300_TE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|pc300loop
comma
id|arg
comma
r_sizeof
(paren
id|pc300loopback_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|pc300loop.loop_type
)paren
(brace
r_case
id|PC300LOCLOOP
suffix:colon
multiline_comment|/* Turn the local loop on/off */
id|falc_local_loop
c_func
(paren
id|card
comma
id|ch
comma
id|pc300loop.loop_on
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|PC300REMLOOP
suffix:colon
multiline_comment|/* Turn the remote loop on/off */
id|falc_remote_loop
c_func
(paren
id|card
comma
id|ch
comma
id|pc300loop.loop_on
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|PC300PAYLOADLOOP
suffix:colon
multiline_comment|/* Turn the payload loop on/off */
id|falc_payload_loop
c_func
(paren
id|card
comma
id|ch
comma
id|pc300loop.loop_on
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|PC300GENLOOPUP
suffix:colon
multiline_comment|/* Generate loop UP */
r_if
c_cond
(paren
id|pc300loop.loop_on
)paren
(brace
id|falc_generate_loop_up_code
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|turn_off_xlu
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|PC300GENLOOPDOWN
suffix:colon
multiline_comment|/* Generate loop DOWN */
r_if
c_cond
(paren
id|pc300loop.loop_on
)paren
(brace
id|falc_generate_loop_down_code
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|turn_off_xld
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_case
id|SIOCSPC300PATTERNTEST
suffix:colon
multiline_comment|/* Turn the pattern test on/off and show the errors counter */
(brace
r_struct
id|pc300patterntst
id|pc300patrntst
suffix:semicolon
multiline_comment|/* TE boards only */
r_if
c_cond
(paren
id|card-&gt;hw.type
op_ne
id|PC300_TE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.cpld_id
OL
l_int|0x02
)paren
(brace
multiline_comment|/* CPLD_ID &lt; 0x02 doesn&squot;t support pattern test */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|pc300patrntst
comma
id|arg
comma
r_sizeof
(paren
id|pc300patterntst_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pc300patrntst.patrntst_on
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;falc.prbs
op_eq
l_int|0
)paren
(brace
id|falc_pattern_test
c_func
(paren
id|card
comma
id|ch
comma
l_int|1
)paren
suffix:semicolon
)brace
id|pc300patrntst.num_errors
op_assign
id|falc_pattern_test_error
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
op_logical_or
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|pc300patrntst
comma
r_sizeof
(paren
id|pc300patterntst_t
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|falc_pattern_test
c_func
(paren
id|card
comma
id|ch
comma
id|pc300patrntst.patrntst_on
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SIOCWANDEV
suffix:colon
r_switch
c_cond
(paren
id|ifr-&gt;ifr_settings-&gt;type
)paren
(brace
r_case
id|IF_GET_IFACE
suffix:colon
(brace
r_const
r_int
id|size
op_assign
r_sizeof
(paren
id|sync_serial_settings
)paren
suffix:semicolon
id|ifr-&gt;ifr_settings-&gt;type
op_assign
id|conf-&gt;media
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
op_amp
id|line-&gt;sync
comma
op_amp
id|conf-&gt;phys_settings
comma
id|size
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|IF_IFACE_V35
suffix:colon
r_case
id|IF_IFACE_V24
suffix:colon
r_case
id|IF_IFACE_X21
suffix:colon
(brace
r_const
r_int
id|size
op_assign
r_sizeof
(paren
id|sync_serial_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|conf-&gt;phys_settings
comma
op_amp
id|line-&gt;sync
comma
id|size
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|conf-&gt;phys_settings.loopback
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
)paren
op_or
id|MD2_LOOP_MIR
)paren
suffix:semicolon
)brace
id|conf-&gt;media
op_assign
id|ifr-&gt;ifr_settings-&gt;type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|IF_IFACE_T1
suffix:colon
r_case
id|IF_IFACE_E1
suffix:colon
(brace
r_const
r_int
id|size
op_assign
r_sizeof
(paren
id|sync_serial_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|conf-&gt;phys_settings
comma
op_amp
id|line-&gt;te1
comma
id|size
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Ignoring HDLC slot_map for a while */
r_if
c_cond
(paren
id|conf-&gt;phys_settings.loopback
)paren
(brace
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
)paren
op_or
id|MD2_LOOP_MIR
)paren
suffix:semicolon
)brace
id|conf-&gt;media
op_assign
id|ifr-&gt;ifr_settings-&gt;type
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
id|hdlc_ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_return
id|hdlc_ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
DECL|function|cpc_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|cpc_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|d
)paren
r_return
op_amp
id|d-&gt;hdlc-&gt;stats
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|clock_rate_calc
r_static
r_int
id|clock_rate_calc
c_func
(paren
id|uclong
id|rate
comma
id|uclong
id|clock
comma
r_int
op_star
id|br_io
)paren
(brace
r_int
id|br
comma
id|tc
suffix:semicolon
r_int
id|br_pwr
comma
id|error
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|0
)paren
r_return
(paren
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|br
op_assign
l_int|0
comma
id|br_pwr
op_assign
l_int|1
suffix:semicolon
id|br
op_le
l_int|9
suffix:semicolon
id|br
op_increment
comma
id|br_pwr
op_lshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|tc
op_assign
id|clock
op_div
id|br_pwr
op_div
id|rate
)paren
op_le
l_int|0xff
)paren
(brace
op_star
id|br_io
op_assign
id|br
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tc
op_le
l_int|0xff
)paren
(brace
id|error
op_assign
(paren
(paren
id|rate
op_minus
(paren
id|clock
op_div
id|br_pwr
op_div
id|rate
)paren
)paren
op_div
id|rate
)paren
op_star
l_int|1000
suffix:semicolon
multiline_comment|/* Errors bigger than +/- 1% won&squot;t be tolerated */
r_if
c_cond
(paren
id|error
template_param
l_int|10
)paren
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
r_else
r_return
(paren
id|tc
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|ch_config
r_int
id|ch_config
c_func
(paren
id|pc300dev_t
op_star
id|d
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|uclong
id|plxbase
op_assign
id|card-&gt;hw.plxbase
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|uclong
id|clkrate
op_assign
id|chan-&gt;conf.phys_settings.clock_rate
suffix:semicolon
id|uclong
id|clktype
op_assign
id|chan-&gt;conf.phys_settings.clock_type
suffix:semicolon
id|ucshort
id|encoding
op_assign
id|chan-&gt;conf.proto_settings.encoding
suffix:semicolon
id|ucshort
id|parity
op_assign
id|chan-&gt;conf.proto_settings.parity
suffix:semicolon
r_int
id|tmc
comma
id|br
suffix:semicolon
id|ucchar
id|md0
comma
id|md2
suffix:semicolon
multiline_comment|/* Reset the channel */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_CH_RST
)paren
suffix:semicolon
multiline_comment|/* Configure the SCA registers */
r_switch
c_cond
(paren
id|parity
)paren
(brace
r_case
id|PARITY_NONE
suffix:colon
id|md0
op_assign
id|MD0_BIT_SYNC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARITY_CRC16_PR0
suffix:colon
id|md0
op_assign
id|MD0_CRC16_0
op_or
id|MD0_CRCC0
op_or
id|MD0_BIT_SYNC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARITY_CRC16_PR1
suffix:colon
id|md0
op_assign
id|MD0_CRC16_1
op_or
id|MD0_CRCC0
op_or
id|MD0_BIT_SYNC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARITY_CRC32_PR1_CCITT
suffix:colon
id|md0
op_assign
id|MD0_CRC32
op_or
id|MD0_CRCC0
op_or
id|MD0_BIT_SYNC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PARITY_CRC16_PR1_CCITT
suffix:colon
r_default
suffix:colon
id|md0
op_assign
id|MD0_CRC_CCITT
op_or
id|MD0_CRCC0
op_or
id|MD0_BIT_SYNC
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|encoding
)paren
(brace
r_case
id|ENCODING_NRZI
suffix:colon
id|md2
op_assign
id|MD2_F_DUPLEX
op_or
id|MD2_ADPLL_X8
op_or
id|MD2_NRZI
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENCODING_FM_MARK
suffix:colon
multiline_comment|/* FM1 */
id|md2
op_assign
id|MD2_F_DUPLEX
op_or
id|MD2_ADPLL_X8
op_or
id|MD2_FM
op_or
id|MD2_FM1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENCODING_FM_SPACE
suffix:colon
multiline_comment|/* FM0 */
id|md2
op_assign
id|MD2_F_DUPLEX
op_or
id|MD2_ADPLL_X8
op_or
id|MD2_FM
op_or
id|MD2_FM0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENCODING_MANCHESTER
suffix:colon
multiline_comment|/* It&squot;s not working... */
id|md2
op_assign
id|MD2_F_DUPLEX
op_or
id|MD2_ADPLL_X8
op_or
id|MD2_FM
op_or
id|MD2_MANCH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ENCODING_NRZ
suffix:colon
r_default
suffix:colon
id|md2
op_assign
id|MD2_F_DUPLEX
op_or
id|MD2_ADPLL_X8
op_or
id|MD2_NRZ
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD0
comma
id|ch
)paren
comma
id|md0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD1
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|MD2
comma
id|ch
)paren
comma
id|md2
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IDL
comma
id|ch
)paren
comma
l_int|0x7e
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
comma
id|CTL_URSKP
op_or
id|CTL_IDLC
)paren
suffix:semicolon
multiline_comment|/* Configure HW media */
r_switch
c_cond
(paren
id|card-&gt;hw.type
)paren
(brace
r_case
id|PC300_RSV
suffix:colon
r_if
c_cond
(paren
id|conf-&gt;media
op_eq
id|IF_IFACE_V35
)paren
(brace
id|cpc_writel
c_func
(paren
(paren
id|plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
comma
id|cpc_readl
c_func
(paren
id|plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
op_or
id|PC300_CHMEDIA_MASK
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writel
c_func
(paren
(paren
id|plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
comma
id|cpc_readl
c_func
(paren
id|plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
op_amp
op_complement
id|PC300_CHMEDIA_MASK
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PC300_X21
suffix:colon
r_break
suffix:semicolon
r_case
id|PC300_TE
suffix:colon
id|te_config
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|card-&gt;hw.type
)paren
(brace
r_case
id|PC300_RSV
suffix:colon
r_case
id|PC300_X21
suffix:colon
r_if
c_cond
(paren
id|clktype
op_eq
id|CLOCK_INT
op_logical_or
id|clktype
op_eq
id|CLOCK_TXINT
)paren
(brace
multiline_comment|/* Calculate the clkrate parameters */
id|tmc
op_assign
id|clock_rate_calc
c_func
(paren
id|clkrate
comma
id|card-&gt;hw.clock
comma
op_amp
id|br
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCT
comma
id|ch
)paren
comma
id|tmc
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TXS
comma
id|ch
)paren
comma
(paren
id|TXS_DTRXC
op_or
id|TXS_IBRG
op_or
id|br
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clktype
op_eq
id|CLOCK_INT
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCR
comma
id|ch
)paren
comma
id|tmc
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RXS
comma
id|ch
)paren
comma
(paren
id|RXS_IBRG
op_or
id|br
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCR
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RXS
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_X21
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|GPO
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
comma
id|EXS_TES1
op_or
id|EXS_RES1
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
comma
id|EXS_TES1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCT
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clktype
op_eq
id|CLOCK_EXT
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TXS
comma
id|ch
)paren
comma
id|TXS_DTRXC
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TXS
comma
id|ch
)paren
comma
id|TXS_DTRXC
op_or
id|TXS_RCLK
)paren
suffix:semicolon
)brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCR
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RXS
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_X21
)paren
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|GPO
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
comma
id|EXS_TES1
op_or
id|EXS_RES1
)paren
suffix:semicolon
)brace
r_else
(brace
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
comma
id|EXS_TES1
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|PC300_TE
suffix:colon
multiline_comment|/* SCA always receives clock from the FALC chip */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCT
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TXS
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TMCR
comma
id|ch
)paren
comma
l_int|1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RXS
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|EXS
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Enable Interrupts */
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|IER0
comma
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|IER0
)paren
op_or
id|IR0_M
c_func
(paren
id|IR0_RXINTA
comma
id|ch
)paren
op_or
id|IR0_DRX
c_func
(paren
id|IR0_EFT
op_or
id|IR0_DMIA
op_or
id|IR0_DMIB
comma
id|ch
)paren
op_or
id|IR0_DTX
c_func
(paren
id|IR0_EFT
op_or
id|IR0_DMIA
op_or
id|IR0_DMIB
comma
id|ch
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE0
comma
id|ch
)paren
comma
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE0
comma
id|ch
)paren
)paren
op_or
id|IE0_RXINTA
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE1
comma
id|ch
)paren
comma
id|cpc_readl
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|IE1
comma
id|ch
)paren
)paren
op_or
id|IE1_CDCD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rx_config
r_int
id|rx_config
c_func
(paren
id|pc300dev_t
op_star
id|d
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_RX
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* General RX settings */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RRC
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|RNR
comma
id|ch
)paren
comma
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Enable reception */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_RX_CRC_INIT
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_RX_ENA
)paren
suffix:semicolon
multiline_comment|/* Initialize DMA stuff */
id|chan-&gt;rx_first_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;rx_last_bd
op_assign
id|N_DMA_RX_BUF
op_minus
l_int|1
suffix:semicolon
id|rx_dma_buf_init
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DCR_RX
c_func
(paren
id|ch
)paren
comma
id|DCR_FCT_CLR
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DMR_RX
c_func
(paren
id|ch
)paren
comma
(paren
id|DMR_TMOD
op_or
id|DMR_NF
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DIR_RX
c_func
(paren
id|ch
)paren
comma
(paren
id|DIR_EOM
op_or
id|DIR_BOF
)paren
)paren
suffix:semicolon
multiline_comment|/* Start DMA */
id|rx_dma_start
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tx_config
r_int
id|tx_config
c_func
(paren
id|pc300dev_t
op_star
id|d
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DSR_TX
c_func
(paren
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* General TX settings */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TRC0
comma
id|ch
)paren
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TFS
comma
id|ch
)paren
comma
l_int|32
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TNR0
comma
id|ch
)paren
comma
l_int|20
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TNR1
comma
id|ch
)paren
comma
l_int|48
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|TCR
comma
id|ch
)paren
comma
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Enable transmission */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_TX_CRC_INIT
)paren
suffix:semicolon
multiline_comment|/* Initialize DMA stuff */
id|chan-&gt;tx_first_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;tx_next_bd
op_assign
l_int|0
suffix:semicolon
id|tx_dma_buf_init
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DCR_TX
c_func
(paren
id|ch
)paren
comma
id|DCR_FCT_CLR
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DMR_TX
c_func
(paren
id|ch
)paren
comma
(paren
id|DMR_TMOD
op_or
id|DMR_NF
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|DIR_TX
c_func
(paren
id|ch
)paren
comma
(paren
id|DIR_EOM
op_or
id|DIR_BOF
op_or
id|DIR_UDRF
)paren
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|CDAL
comma
id|ch
)paren
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_first_bd
)paren
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
id|scabase
op_plus
id|DTX_REG
c_func
(paren
id|EDAL
comma
id|ch
)paren
comma
id|TX_BD_ADDR
c_func
(paren
id|ch
comma
id|chan-&gt;tx_next_bd
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cpc_attach
r_static
r_int
id|cpc_attach
c_func
(paren
id|hdlc_device
op_star
id|hdlc
comma
r_int
r_int
id|encoding
comma
r_int
r_int
id|parity
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|pc300chconf_t
op_star
id|conf
op_assign
(paren
id|pc300chconf_t
op_star
)paren
op_amp
id|chan-&gt;conf
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
r_if
c_cond
(paren
id|encoding
op_ne
id|ENCODING_NRZ
op_logical_and
id|encoding
op_ne
id|ENCODING_NRZI
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|encoding
op_ne
id|ENCODING_NRZ
op_logical_and
id|encoding
op_ne
id|ENCODING_NRZI
op_logical_and
id|encoding
op_ne
id|ENCODING_FM_MARK
op_logical_and
id|encoding
op_ne
id|ENCODING_FM_SPACE
)paren
(brace
multiline_comment|/* Driver doesn&squot;t support ENCODING_MANCHESTER yet */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|parity
op_ne
id|PARITY_NONE
op_logical_and
id|parity
op_ne
id|PARITY_CRC16_PR0
op_logical_and
id|parity
op_ne
id|PARITY_CRC16_PR1
op_logical_and
id|parity
op_ne
id|PARITY_CRC32_PR1_CCITT
op_logical_and
id|parity
op_ne
id|PARITY_CRC16_PR1_CCITT
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|conf-&gt;proto_settings.encoding
op_assign
id|encoding
suffix:semicolon
id|conf-&gt;proto_settings.parity
op_assign
id|parity
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cpc_opench
r_void
id|cpc_opench
c_func
(paren
id|pc300dev_t
op_star
id|d
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|uclong
id|scabase
op_assign
id|card-&gt;hw.scabase
suffix:semicolon
id|ch_config
c_func
(paren
id|d
)paren
suffix:semicolon
id|rx_config
c_func
(paren
id|d
)paren
suffix:semicolon
id|tx_config
c_func
(paren
id|d
)paren
suffix:semicolon
multiline_comment|/* Assert RTS and DTR */
id|cpc_writeb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
comma
id|cpc_readb
c_func
(paren
id|scabase
op_plus
id|M_REG
c_func
(paren
id|CTL
comma
id|ch
)paren
)paren
op_amp
op_complement
(paren
id|CTL_RTS
op_or
id|CTL_DTR
)paren
)paren
suffix:semicolon
)brace
DECL|function|cpc_closech
r_void
id|cpc_closech
c_func
(paren
id|pc300dev_t
op_star
id|d
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|falc_t
op_star
id|pfalc
op_assign
(paren
id|falc_t
op_star
)paren
op_amp
id|chan-&gt;falc
suffix:semicolon
r_int
id|ch
op_assign
id|chan-&gt;channel
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|M_REG
c_func
(paren
id|CMD
comma
id|ch
)paren
comma
id|CMD_CH_RST
)paren
suffix:semicolon
id|rx_dma_stop
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
id|tx_dma_stop
c_func
(paren
id|card
comma
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|memset
c_func
(paren
id|pfalc
comma
l_int|0
comma
r_sizeof
(paren
id|falc_t
)paren
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg2
)paren
op_amp
op_complement
(paren
(paren
id|CPLD_REG2_FALC_TX_CLK
op_or
id|CPLD_REG2_FALC_RX_CLK
op_or
id|CPLD_REG2_FALC_LED2
)paren
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Reset the FALC chip */
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_or
(paren
id|CPLD_REG1_FALC_RESET
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_amp
op_complement
(paren
id|CPLD_REG1_FALC_RESET
op_lshift
(paren
l_int|2
op_star
id|ch
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|cpc_open
r_int
id|cpc_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|ifreq
id|ifr
suffix:semicolon
r_int
id|result
suffix:semicolon
macro_line|#ifdef&t;PC300_DEBUG_OTHER
id|printk
c_func
(paren
l_string|&quot;pc300: cpc_open&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|hdlc-&gt;proto
op_eq
id|IF_PROTO_PPP
)paren
(brace
id|d-&gt;if_ptr
op_assign
op_amp
id|hdlc-&gt;state.ppp.pppdev
suffix:semicolon
)brace
id|result
op_assign
id|hdlc_open
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdlc-&gt;proto
op_eq
id|IF_PROTO_PPP
)paren
(brace
id|dev-&gt;priv
op_assign
id|d
suffix:semicolon
)brace
r_if
c_cond
(paren
id|result
)paren
(brace
r_return
id|result
suffix:semicolon
)brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|sprintf
c_func
(paren
id|ifr.ifr_name
comma
l_string|&quot;%s&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|cpc_opench
c_func
(paren
id|d
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cpc_close
r_int
id|cpc_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
(paren
id|pc300dev_t
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|pc300ch_t
op_star
id|chan
op_assign
(paren
id|pc300ch_t
op_star
)paren
id|d-&gt;chan
suffix:semicolon
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|chan-&gt;card
suffix:semicolon
id|uclong
id|flags
suffix:semicolon
macro_line|#ifdef&t;PC300_DEBUG_OTHER
id|printk
c_func
(paren
l_string|&quot;pc300: cpc_close&quot;
)paren
suffix:semicolon
macro_line|#endif
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|CPC_LOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|cpc_closech
c_func
(paren
id|d
)paren
suffix:semicolon
id|CPC_UNLOCK
c_func
(paren
id|card
comma
id|flags
)paren
suffix:semicolon
id|hdlc_close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdlc-&gt;proto
op_eq
id|IF_PROTO_PPP
)paren
(brace
id|d-&gt;if_ptr
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PC300_MLPPP
r_if
c_cond
(paren
id|chan-&gt;conf.proto
op_eq
id|PC300_PROTO_MLPPP
)paren
(brace
id|cpc_tty_unregister_service
c_func
(paren
id|d
)paren
suffix:semicolon
id|chan-&gt;conf.proto
op_assign
l_int|0xffff
suffix:semicolon
)brace
macro_line|#endif
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|detect_ram
r_static
id|uclong
id|detect_ram
c_func
(paren
id|pc300_t
op_star
id|card
)paren
(brace
id|uclong
id|i
suffix:semicolon
id|ucchar
id|data
suffix:semicolon
id|uclong
id|rambase
op_assign
id|card-&gt;hw.rambase
suffix:semicolon
id|card-&gt;hw.ramsize
op_assign
id|PC300_RAMSIZE
suffix:semicolon
multiline_comment|/* Let&squot;s find out how much RAM is present on this board */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;hw.ramsize
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_assign
(paren
id|ucchar
)paren
(paren
id|i
op_amp
l_int|0xff
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|rambase
op_plus
id|i
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|rambase
op_plus
id|i
)paren
op_ne
id|data
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_return
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|function|plx_init
r_static
r_void
id|plx_init
c_func
(paren
id|pc300_t
op_star
id|card
)paren
(brace
r_struct
id|RUNTIME_9050
op_star
id|plx_ctl
op_assign
(paren
r_struct
id|RUNTIME_9050
op_star
)paren
id|card-&gt;hw.plxbase
suffix:semicolon
multiline_comment|/* Reset PLX */
id|cpc_writel
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
comma
id|cpc_readl
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
)paren
op_or
l_int|0x40000000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000L
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
comma
id|cpc_readl
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
)paren
op_amp
op_complement
l_int|0x40000000
)paren
suffix:semicolon
multiline_comment|/* Reload Config. Registers from EEPROM */
id|cpc_writel
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
comma
id|cpc_readl
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
)paren
op_or
l_int|0x20000000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000L
)paren
suffix:semicolon
id|cpc_writel
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
comma
id|cpc_readl
c_func
(paren
op_amp
id|plx_ctl-&gt;init_ctrl
)paren
op_amp
op_complement
l_int|0x20000000
)paren
suffix:semicolon
)brace
DECL|function|show_version
r_static
r_inline
r_void
id|show_version
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|rcsvers
comma
op_star
id|rcsdate
comma
op_star
id|tmp
suffix:semicolon
id|rcsvers
op_assign
id|strchr
c_func
(paren
id|rcsid
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
id|rcsvers
op_increment
suffix:semicolon
id|tmp
op_assign
id|strchr
c_func
(paren
id|rcsvers
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
op_star
id|tmp
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rcsdate
op_assign
id|strchr
c_func
(paren
id|tmp
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
id|rcsdate
op_increment
suffix:semicolon
id|tmp
op_assign
id|strrchr
c_func
(paren
id|rcsdate
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
op_star
id|tmp
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Cyclades-PC300 driver %s %s (built %s %s)&bslash;n&quot;
comma
id|rcsvers
comma
id|rcsdate
comma
id|__DATE__
comma
id|__TIME__
)paren
suffix:semicolon
)brace
multiline_comment|/* show_version */
DECL|function|cpc_init_card
r_static
r_void
id|cpc_init_card
c_func
(paren
id|pc300_t
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|devcount
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|board_nbr
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Enable interrupts on the PCI bridge */
id|plx_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|cpc_writew
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.intctl_reg
comma
id|cpc_readw
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.intctl_reg
)paren
op_or
l_int|0x0040
)paren
suffix:semicolon
macro_line|#ifdef USE_PCI_CLOCK
multiline_comment|/* Set board clock to PCI clock */
id|cpc_writel
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.gpioc_reg
comma
id|cpc_readl
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
op_or
l_int|0x00000004UL
)paren
suffix:semicolon
id|card-&gt;hw.clock
op_assign
id|PC300_PCI_CLOCK
suffix:semicolon
macro_line|#else
multiline_comment|/* Set board clock to internal oscillator clock */
id|cpc_writel
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.gpioc_reg
comma
id|cpc_readl
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
op_amp
op_complement
l_int|0x00000004UL
)paren
suffix:semicolon
id|card-&gt;hw.clock
op_assign
id|PC300_OSC_CLOCK
suffix:semicolon
macro_line|#endif
multiline_comment|/* Detect actual on-board RAM size */
id|card-&gt;hw.ramsize
op_assign
id|detect_ram
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* Set Global SCA-II registers */
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|PCR
comma
id|PCR_PR2
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|BTCR
comma
l_int|0x10
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|WCRL
comma
l_int|0
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.scabase
op_plus
id|DMER
comma
l_int|0x80
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|ucchar
id|reg1
suffix:semicolon
multiline_comment|/* Check CPLD version */
id|reg1
op_assign
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|CPLD_REG1
)paren
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|CPLD_REG1
comma
(paren
id|reg1
op_plus
l_int|0x5a
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|CPLD_REG1
)paren
op_eq
id|reg1
)paren
(brace
multiline_comment|/* New CPLD */
id|card-&gt;hw.cpld_id
op_assign
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|CPLD_ID_REG
)paren
suffix:semicolon
id|card-&gt;hw.cpld_reg1
op_assign
id|CPLD_V2_REG1
suffix:semicolon
id|card-&gt;hw.cpld_reg2
op_assign
id|CPLD_V2_REG2
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* old CPLD */
id|card-&gt;hw.cpld_id
op_assign
l_int|0
suffix:semicolon
id|card-&gt;hw.cpld_reg1
op_assign
id|CPLD_REG1
suffix:semicolon
id|card-&gt;hw.cpld_reg2
op_assign
id|CPLD_REG2
suffix:semicolon
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|CPLD_REG1
comma
id|reg1
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable the board&squot;s global clock */
id|cpc_writeb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
comma
id|cpc_readb
c_func
(paren
id|card-&gt;hw.falcbase
op_plus
id|card-&gt;hw.cpld_reg1
)paren
op_or
id|CPLD_REG1_GLOBAL_CLK
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;hw.nchan
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pc300ch_t
op_star
id|chan
op_assign
op_amp
id|card-&gt;chan
(braket
id|i
)braket
suffix:semicolon
id|pc300dev_t
op_star
id|d
op_assign
op_amp
id|chan-&gt;d
suffix:semicolon
id|hdlc_device
op_star
id|hdlc
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|chan-&gt;card
op_assign
id|card
suffix:semicolon
id|chan-&gt;channel
op_assign
id|i
suffix:semicolon
id|chan-&gt;conf.phys_settings.clock_rate
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;conf.phys_settings.clock_type
op_assign
id|CLOCK_EXT
suffix:semicolon
id|chan-&gt;conf.proto_settings.encoding
op_assign
id|ENCODING_NRZ
suffix:semicolon
id|chan-&gt;conf.proto_settings.parity
op_assign
id|PARITY_CRC16_PR1_CCITT
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;hw.type
)paren
(brace
r_case
id|PC300_TE
suffix:colon
id|chan-&gt;conf.media
op_assign
id|IF_IFACE_T1
suffix:semicolon
id|chan-&gt;conf.lcode
op_assign
id|PC300_LC_B8ZS
suffix:semicolon
id|chan-&gt;conf.fr_mode
op_assign
id|PC300_FR_ESF
suffix:semicolon
id|chan-&gt;conf.lbo
op_assign
id|PC300_LBO_0_DB
suffix:semicolon
id|chan-&gt;conf.rx_sens
op_assign
id|PC300_RX_SENS_SH
suffix:semicolon
id|chan-&gt;conf.tslot_bitmap
op_assign
l_int|0xffffffffUL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_X21
suffix:colon
id|chan-&gt;conf.media
op_assign
id|IF_IFACE_X21
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_RSV
suffix:colon
r_default
suffix:colon
id|chan-&gt;conf.media
op_assign
id|IF_IFACE_V35
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chan-&gt;conf.proto
op_assign
id|IF_PROTO_PPP
suffix:semicolon
id|chan-&gt;tx_first_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;tx_next_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;rx_first_bd
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;rx_last_bd
op_assign
id|N_DMA_RX_BUF
op_minus
l_int|1
suffix:semicolon
id|chan-&gt;nfree_tx_bd
op_assign
id|N_DMA_TX_BUF
suffix:semicolon
id|d-&gt;chan
op_assign
id|chan
suffix:semicolon
id|d-&gt;tx_skb
op_assign
l_int|NULL
suffix:semicolon
id|d-&gt;trace_on
op_assign
l_int|0
suffix:semicolon
id|d-&gt;line_on
op_assign
l_int|0
suffix:semicolon
id|d-&gt;line_off
op_assign
l_int|0
suffix:semicolon
id|d-&gt;hdlc
op_assign
(paren
id|hdlc_device
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|hdlc_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;hdlc
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|memset
c_func
(paren
id|d-&gt;hdlc
comma
l_int|0
comma
r_sizeof
(paren
id|hdlc_device
)paren
)paren
suffix:semicolon
id|hdlc
op_assign
id|d-&gt;hdlc
suffix:semicolon
id|hdlc-&gt;xmit
op_assign
id|cpc_queue_xmit
suffix:semicolon
id|hdlc-&gt;attach
op_assign
id|cpc_attach
suffix:semicolon
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|card-&gt;hw.ramphys
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|card-&gt;hw.ramphys
op_plus
id|card-&gt;hw.ramsize
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;irq
op_assign
id|card-&gt;hw.irq
suffix:semicolon
id|dev-&gt;init
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
id|PC300_TX_QUEUE_LEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|PC300_DEF_MTU
suffix:semicolon
id|dev-&gt;open
op_assign
id|cpc_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|cpc_close
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|cpc_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|PC300_TX_TIMEOUT
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|cpc_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|cpc_change_mtu
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|cpc_ioctl
suffix:semicolon
r_if
c_cond
(paren
id|register_hdlc_device
c_func
(paren
id|hdlc
)paren
op_eq
l_int|0
)paren
(brace
id|dev-&gt;priv
op_assign
id|d
suffix:semicolon
multiline_comment|/* We need &squot;priv&squot;, hdlc doesn&squot;t */
id|printk
c_func
(paren
l_string|&quot;%s: Cyclades-PC300/&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;hw.type
)paren
(brace
r_case
id|PC300_TE
suffix:colon
r_if
c_cond
(paren
id|card-&gt;hw.bus
op_eq
id|PC300_PMC
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TE-M&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;TE  &quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PC300_X21
suffix:colon
id|printk
c_func
(paren
l_string|&quot;X21 &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PC300_RSV
suffix:colon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;RSV &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
(paren
l_string|&quot; #%d, %ldKB of RAM at 0x%08lx, IRQ%d, channel %d.&bslash;n&quot;
comma
id|board_nbr
comma
id|card-&gt;hw.ramsize
op_div
l_int|1024
comma
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.irq
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
id|devcount
op_increment
suffix:semicolon
)brace
r_else
(brace
id|printk
(paren
l_string|&quot;Dev%d on card(0x%08lx): unable to allocate i/f name.&bslash;n&quot;
comma
id|i
op_plus
l_int|1
comma
id|card-&gt;hw.ramphys
)paren
suffix:semicolon
op_star
(paren
id|dev-&gt;name
)paren
op_assign
l_int|0
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;hdlc
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;card_lock
)paren
suffix:semicolon
id|board_nbr
op_increment
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|cpc_init_one
id|cpc_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|first_time
op_assign
l_int|1
suffix:semicolon
id|ucchar
id|cpc_rev_id
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|eeprom_outdated
op_assign
l_int|0
suffix:semicolon
id|ucshort
id|device_id
suffix:semicolon
id|pc300_t
op_star
id|card
suffix:semicolon
r_if
c_cond
(paren
id|first_time
)paren
(brace
id|first_time
op_assign
l_int|0
suffix:semicolon
id|show_version
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PC300_MLPPP
id|cpc_tty_reset_var
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|pc300_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC300 found at RAM 0x%08lx, &quot;
l_string|&quot;but could not allocate card structure.&bslash;n&quot;
comma
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|3
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|pc300_t
)paren
)paren
suffix:semicolon
multiline_comment|/* read PCI configuration area */
id|device_id
op_assign
id|ent-&gt;device
suffix:semicolon
id|card-&gt;hw.irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|card-&gt;hw.iophys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|card-&gt;hw.iosize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|card-&gt;hw.scaphys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
id|card-&gt;hw.scasize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|2
)paren
suffix:semicolon
id|card-&gt;hw.ramphys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|3
)paren
suffix:semicolon
id|card-&gt;hw.alloc_ramsize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|3
)paren
suffix:semicolon
id|card-&gt;hw.falcphys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|4
)paren
suffix:semicolon
id|card-&gt;hw.falcsize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|4
)paren
suffix:semicolon
id|card-&gt;hw.plxphys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|5
)paren
suffix:semicolon
id|card-&gt;hw.plxsize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|5
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|cpc_rev_id
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|device_id
)paren
(brace
r_case
id|PCI_DEVICE_ID_PC300_RX_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_1
suffix:colon
id|card-&gt;hw.nchan
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_PC300_RX_2
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_2
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_2
suffix:colon
r_default
suffix:colon
id|card-&gt;hw.nchan
op_assign
id|PC300_MAXCHAN
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef PC300_DEBUG_PCI
id|printk
c_func
(paren
l_string|&quot;cpc (bus=0x0%x,pci_id=0x%x,&quot;
comma
id|pdev-&gt;bus-&gt;number
comma
id|pdev-&gt;devfn
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rev_id=%d) IRQ%d&bslash;n&quot;
comma
id|cpc_rev_id
comma
id|card-&gt;hw.irq
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;cpc:found  ramaddr=0x%08lx plxaddr=0x%08lx &quot;
l_string|&quot;ctladdr=0x%08lx falcaddr=0x%08lx&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.plxphys
comma
id|card-&gt;hw.scaphys
comma
id|card-&gt;hw.falcphys
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Although we don&squot;t use this I/O region, we should&n;&t; * request it from the kernel anyway, to avoid problems&n;&t; * with other drivers accessing it. */
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|card-&gt;hw.iophys
comma
id|card-&gt;hw.iosize
comma
l_string|&quot;PLX Registers&quot;
)paren
)paren
(brace
multiline_comment|/* In case we can&squot;t allocate it, warn user */
id|printk
c_func
(paren
l_string|&quot;WARNING: couldn&squot;t allocate I/O region for PC300 board &quot;
l_string|&quot;at 0x%08lx!&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.plxphys
)paren
(brace
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|PCI_BASE_ADDRESS_0
comma
id|card-&gt;hw.plxphys
)paren
suffix:semicolon
)brace
r_else
(brace
id|eeprom_outdated
op_assign
l_int|1
suffix:semicolon
id|card-&gt;hw.plxphys
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|card-&gt;hw.plxsize
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|card-&gt;hw.plxphys
comma
id|card-&gt;hw.plxsize
comma
l_string|&quot;PLX Registers&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC300 found at RAM 0x%08lx, &quot;
l_string|&quot;but could not allocate PLX mem region.&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_release_io
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.alloc_ramsize
comma
l_string|&quot;On-board RAM&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC300 found at RAM 0x%08lx, &quot;
l_string|&quot;but could not allocate RAM mem region.&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_release_plx
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|card-&gt;hw.scaphys
comma
id|card-&gt;hw.scasize
comma
l_string|&quot;SCA-II Registers&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PC300 found at RAM 0x%08lx, &quot;
l_string|&quot;but could not allocate SCA mem region.&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_release_ram
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|err_release_sca
suffix:semicolon
id|card-&gt;hw.plxbase
op_assign
(paren
id|uclong
)paren
id|ioremap
c_func
(paren
id|card-&gt;hw.plxphys
comma
id|card-&gt;hw.plxsize
)paren
suffix:semicolon
id|card-&gt;hw.rambase
op_assign
(paren
id|uclong
)paren
id|ioremap
c_func
(paren
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.alloc_ramsize
)paren
suffix:semicolon
id|card-&gt;hw.scabase
op_assign
(paren
id|uclong
)paren
id|ioremap
c_func
(paren
id|card-&gt;hw.scaphys
comma
id|card-&gt;hw.scasize
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|device_id
)paren
(brace
r_case
id|PCI_DEVICE_ID_PC300_TE_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_2
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_2
suffix:colon
id|request_mem_region
c_func
(paren
id|card-&gt;hw.falcphys
comma
id|card-&gt;hw.falcsize
comma
l_string|&quot;FALC Registers&quot;
)paren
suffix:semicolon
id|card-&gt;hw.falcbase
op_assign
(paren
id|uclong
)paren
id|ioremap
c_func
(paren
id|card-&gt;hw.falcphys
comma
id|card-&gt;hw.falcsize
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_PC300_RX_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_RX_2
suffix:colon
r_default
suffix:colon
id|card-&gt;hw.falcbase
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef PC300_DEBUG_PCI
id|printk
c_func
(paren
l_string|&quot;cpc: relocate ramaddr=0x%08lx plxaddr=0x%08lx &quot;
l_string|&quot;ctladdr=0x%08lx falcaddr=0x%08lx&bslash;n&quot;
comma
id|card-&gt;hw.rambase
comma
id|card-&gt;hw.plxbase
comma
id|card-&gt;hw.scabase
comma
id|card-&gt;hw.falcbase
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Set PCI drv pointer to the card structure */
id|pdev-&gt;driver_data
op_assign
id|card
suffix:semicolon
multiline_comment|/* Set board type */
r_switch
c_cond
(paren
id|device_id
)paren
(brace
r_case
id|PCI_DEVICE_ID_PC300_TE_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_2
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_TE_M_2
suffix:colon
id|card-&gt;hw.type
op_assign
id|PC300_TE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|device_id
op_eq
id|PCI_DEVICE_ID_PC300_TE_M_1
)paren
op_logical_or
(paren
id|device_id
op_eq
id|PCI_DEVICE_ID_PC300_TE_M_2
)paren
)paren
(brace
id|card-&gt;hw.bus
op_assign
id|PC300_PMC
suffix:semicolon
multiline_comment|/* Set PLX register offsets */
id|card-&gt;hw.gpioc_reg
op_assign
l_int|0x54
suffix:semicolon
id|card-&gt;hw.intctl_reg
op_assign
l_int|0x4c
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;hw.bus
op_assign
id|PC300_PCI
suffix:semicolon
multiline_comment|/* Set PLX register offsets */
id|card-&gt;hw.gpioc_reg
op_assign
l_int|0x50
suffix:semicolon
id|card-&gt;hw.intctl_reg
op_assign
l_int|0x4c
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_PC300_RX_1
suffix:colon
r_case
id|PCI_DEVICE_ID_PC300_RX_2
suffix:colon
r_default
suffix:colon
id|card-&gt;hw.bus
op_assign
id|PC300_PCI
suffix:semicolon
multiline_comment|/* Set PLX register offsets */
id|card-&gt;hw.gpioc_reg
op_assign
l_int|0x50
suffix:semicolon
id|card-&gt;hw.intctl_reg
op_assign
l_int|0x4c
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cpc_readl
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.gpioc_reg
)paren
op_amp
id|PC300_CTYPE_MASK
)paren
)paren
(brace
id|card-&gt;hw.type
op_assign
id|PC300_X21
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;hw.type
op_assign
id|PC300_RSV
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* Allocate IRQ */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|card-&gt;hw.irq
comma
id|cpc_intr
comma
id|SA_SHIRQ
comma
l_string|&quot;Cyclades-PC300&quot;
comma
id|card
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;PC300 found at RAM 0x%08lx, but could not allocate IRQ%d.&bslash;n&quot;
comma
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.irq
)paren
suffix:semicolon
r_goto
id|err_io_unmap
suffix:semicolon
)brace
id|cpc_init_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eeprom_outdated
)paren
id|printk
c_func
(paren
l_string|&quot;WARNING: PC300 with outdated EEPROM.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_io_unmap
suffix:colon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.plxbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.scabase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.rambase
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.falcbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.falcphys
comma
id|card-&gt;hw.falcsize
)paren
suffix:semicolon
)brace
id|err_release_sca
suffix:colon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.scaphys
comma
id|card-&gt;hw.scasize
)paren
suffix:semicolon
id|err_release_ram
suffix:colon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.alloc_ramsize
)paren
suffix:semicolon
id|err_release_plx
suffix:colon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.plxphys
comma
id|card-&gt;hw.plxsize
)paren
suffix:semicolon
id|err_release_io
suffix:colon
id|release_region
c_func
(paren
id|card-&gt;hw.iophys
comma
id|card-&gt;hw.iosize
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|cpc_remove_one
r_static
r_void
id|__devexit
id|cpc_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
id|pc300_t
op_star
id|card
op_assign
(paren
id|pc300_t
op_star
)paren
id|pdev-&gt;driver_data
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.rambase
op_ne
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Disable interrupts on the PCI bridge */
id|cpc_writew
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.intctl_reg
comma
id|cpc_readw
c_func
(paren
id|card-&gt;hw.plxbase
op_plus
id|card-&gt;hw.intctl_reg
)paren
op_amp
op_complement
(paren
l_int|0x0040
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;hw.nchan
suffix:semicolon
id|i
op_increment
)paren
(brace
id|unregister_hdlc_device
c_func
(paren
id|card-&gt;chan
(braket
id|i
)braket
dot
id|d.hdlc
)paren
suffix:semicolon
)brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.plxbase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.scabase
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.rambase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.plxphys
comma
id|card-&gt;hw.plxsize
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.ramphys
comma
id|card-&gt;hw.alloc_ramsize
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.scaphys
comma
id|card-&gt;hw.scasize
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|card-&gt;hw.iophys
comma
id|card-&gt;hw.iosize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|PC300_TE
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;hw.falcbase
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;hw.falcphys
comma
id|card-&gt;hw.falcsize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.irq
)paren
id|free_irq
c_func
(paren
id|card-&gt;hw.irq
comma
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
)brace
DECL|variable|cpc_driver
r_static
r_struct
id|pci_driver
id|cpc_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;pc300&quot;
comma
id|id_table
suffix:colon
id|cpc_pci_dev_id
comma
id|probe
suffix:colon
id|cpc_init_one
comma
id|remove
suffix:colon
id|cpc_remove_one
comma
id|suspend
suffix:colon
l_int|NULL
comma
id|resume
suffix:colon
l_int|NULL
comma
)brace
suffix:semicolon
DECL|function|cpc_init
r_static
r_int
id|__init
id|cpc_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|cpc_driver
)paren
suffix:semicolon
)brace
DECL|function|cpc_cleanup_module
r_static
r_void
id|__exit
id|cpc_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|cpc_driver
)paren
suffix:semicolon
)brace
DECL|variable|cpc_init
id|module_init
c_func
(paren
id|cpc_init
)paren
suffix:semicolon
DECL|variable|cpc_cleanup_module
id|module_exit
c_func
(paren
id|cpc_cleanup_module
)paren
suffix:semicolon
eof
