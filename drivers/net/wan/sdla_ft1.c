multiline_comment|/*****************************************************************************&n;* sdla_chdlc.c&t;WANPIPE(tm) Multiprotocol WAN Link Driver. Cisco HDLC module.&n;*&n;* Authors: &t;Nenad Corbic &lt;ncorbic@sangoma.com&gt;&n;*&t;&t;Gideon Hack  &n;*&n;* Copyright:&t;(c) 1995-1999 Sangoma Technologies Inc.&n;*&n;*&t;&t;This program is free software; you can redistribute it and/or&n;*&t;&t;modify it under the terms of the GNU General Public License&n;*&t;&t;as published by the Free Software Foundation; either version&n;*&t;&t;2 of the License, or (at your option) any later version.&n;* ============================================================================&n;* Sep 30, 1999  Nenad Corbic    Fixed dynamic IP and route setup.&n;* Sep 23, 1999  Nenad Corbic    Added SMP support, fixed tracing &n;* Sep 13, 1999  Nenad Corbic&t;Split up Port 0 and 1 into separate devices.&n;* Jun 02, 1999  Gideon Hack     Added support for the S514 adapter.&n;* Oct 30, 1998&t;Jaspreet Singh&t;Added Support for CHDLC API (HDLC STREAMING).&n;* Oct 28, 1998&t;Jaspreet Singh&t;Added Support for Dual Port CHDLC.&n;* Aug 07, 1998&t;David Fong&t;Initial version.&n;*****************************************************************************/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;&t;/* printk(), and other useful stuff */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;&t;/* offsetof(), etc. */
macro_line|#include &lt;linux/errno.h&gt;&t;/* return codes */
macro_line|#include &lt;linux/string.h&gt;&t;/* inline memset(), etc. */
macro_line|#include &lt;linux/slab.h&gt;&t;&t;/* kmalloc(), kfree() */
macro_line|#include &lt;linux/wanrouter.h&gt;&t;/* WAN router definitions */
macro_line|#include &lt;linux/wanpipe.h&gt;&t;/* WANPIPE common user API definitions */
macro_line|#include &lt;linux/if_arp.h&gt;&t;/* ARPHRD_* defines */
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/in.h&gt;&t;&t;/* sockaddr_in */
macro_line|#include &lt;linux/inet.h&gt;&t;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;&t;/* htons(), etc. */
macro_line|#include &lt;linux/sdlapci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/sdla_chdlc.h&gt;&t;&t;/* CHDLC firmware API definitions */
multiline_comment|/****** Defines &amp; Macros ****************************************************/
multiline_comment|/* reasons for enabling the timer interrupt on the adapter */
DECL|macro|TMR_INT_ENABLED_UDP
mdefine_line|#define TMR_INT_ENABLED_UDP   &t;0x0001
DECL|macro|TMR_INT_ENABLED_UPDATE
mdefine_line|#define TMR_INT_ENABLED_UPDATE&t;0x0002
DECL|macro|CHDLC_DFLT_DATA_LEN
mdefine_line|#define&t;CHDLC_DFLT_DATA_LEN&t;1500&t;&t;/* default MTU */
DECL|macro|CHDLC_HDR_LEN
mdefine_line|#define CHDLC_HDR_LEN&t;&t;1
DECL|macro|IFF_POINTTOPOINT
mdefine_line|#define IFF_POINTTOPOINT 0x10
DECL|macro|WANPIPE
mdefine_line|#define WANPIPE 0x00
DECL|macro|API
mdefine_line|#define API&t;0x01
DECL|macro|CHDLC_API
mdefine_line|#define CHDLC_API 0x01
DECL|macro|PORT
mdefine_line|#define PORT(x)   (x == 0 ? &quot;PRIMARY&quot; : &quot;SECONDARY&quot; )
multiline_comment|/******Data Structures*****************************************************/
multiline_comment|/* This structure is placed in the private data area of the device structure.&n; * The card structure used to occupy the private area but now the following &n; * structure will incorporate the card structure along with CHDLC specific data&n; */
DECL|struct|chdlc_private_area
r_typedef
r_struct
id|chdlc_private_area
(brace
DECL|member|slave
id|netdevice_t
op_star
id|slave
suffix:semicolon
DECL|member|card
id|sdla_t
op_star
id|card
suffix:semicolon
DECL|member|TracingEnabled
r_int
id|TracingEnabled
suffix:semicolon
multiline_comment|/* For enabling Tracing */
DECL|member|curr_trace_addr
r_int
r_int
id|curr_trace_addr
suffix:semicolon
multiline_comment|/* Used for Tracing */
DECL|member|start_trace_addr
r_int
r_int
id|start_trace_addr
suffix:semicolon
DECL|member|end_trace_addr
r_int
r_int
id|end_trace_addr
suffix:semicolon
DECL|member|base_addr_trace_buffer
r_int
r_int
id|base_addr_trace_buffer
suffix:semicolon
DECL|member|end_addr_trace_buffer
r_int
r_int
id|end_addr_trace_buffer
suffix:semicolon
DECL|member|number_trace_elements
r_int
r_int
id|number_trace_elements
suffix:semicolon
DECL|member|available_buffer_space
r_int
id|available_buffer_space
suffix:semicolon
DECL|member|router_start_time
r_int
r_int
id|router_start_time
suffix:semicolon
DECL|member|route_status
r_int
r_char
id|route_status
suffix:semicolon
DECL|member|route_removed
r_int
r_char
id|route_removed
suffix:semicolon
DECL|member|tick_counter
r_int
r_int
id|tick_counter
suffix:semicolon
multiline_comment|/* For 5s timeout counter */
DECL|member|router_up_time
r_int
r_int
id|router_up_time
suffix:semicolon
DECL|member|IP_address
id|u32
id|IP_address
suffix:semicolon
multiline_comment|/* IP addressing */
DECL|member|IP_netmask
id|u32
id|IP_netmask
suffix:semicolon
DECL|member|mc
r_int
r_char
id|mc
suffix:semicolon
multiline_comment|/* Mulitcast support on/off */
DECL|member|udp_pkt_lgth
r_int
r_int
id|udp_pkt_lgth
suffix:semicolon
multiline_comment|/* udp packet processing */
DECL|member|udp_pkt_src
r_char
id|udp_pkt_src
suffix:semicolon
DECL|member|udp_pkt_data
r_char
id|udp_pkt_data
(braket
id|MAX_LGTH_UDP_MGNT_PKT
)braket
suffix:semicolon
DECL|member|timer_int_enabled
r_int
r_int
id|timer_int_enabled
suffix:semicolon
DECL|member|update_comms_stats
r_char
id|update_comms_stats
suffix:semicolon
multiline_comment|/* updating comms stats */
singleline_comment|//FIXME: add driver stats as per frame relay!
DECL|typedef|chdlc_private_area_t
)brace
id|chdlc_private_area_t
suffix:semicolon
multiline_comment|/* Route Status options */
DECL|macro|NO_ROUTE
mdefine_line|#define NO_ROUTE&t;0x00
DECL|macro|ADD_ROUTE
mdefine_line|#define ADD_ROUTE&t;0x01
DECL|macro|ROUTE_ADDED
mdefine_line|#define ROUTE_ADDED&t;0x02
DECL|macro|REMOVE_ROUTE
mdefine_line|#define REMOVE_ROUTE&t;0x03
multiline_comment|/****** Function Prototypes *************************************************/
multiline_comment|/* WAN link driver entry points. These are called by the WAN router module. */
r_static
r_int
id|wpft1_exec
(paren
r_struct
id|sdla
op_star
id|card
comma
r_void
op_star
id|u_cmd
comma
r_void
op_star
id|u_data
)paren
suffix:semicolon
r_static
r_int
id|chdlc_read_version
(paren
id|sdla_t
op_star
id|card
comma
r_char
op_star
id|str
)paren
suffix:semicolon
r_static
r_int
id|chdlc_error
(paren
id|sdla_t
op_star
id|card
comma
r_int
id|err
comma
id|CHDLC_MAILBOX_STRUCT
op_star
id|mb
)paren
suffix:semicolon
multiline_comment|/****** Public Functions ****************************************************/
multiline_comment|/*============================================================================&n; * Cisco HDLC protocol initialization routine.&n; *&n; * This routine is called by the main WANPIPE module during setup.  At this&n; * point adapter is completely initialized and firmware is running.&n; *  o read firmware version (to make sure it&squot;s alive)&n; *  o configure adapter&n; *  o initialize protocol-specific fields of the adapter data space.&n; *&n; * Return:&t;0&t;o.k.&n; *&t;&t;&lt; 0&t;failure.&n; */
DECL|function|wpft1_init
r_int
id|wpft1_init
(paren
id|sdla_t
op_star
id|card
comma
id|wandev_conf_t
op_star
id|conf
)paren
(brace
r_int
r_char
id|port_num
suffix:semicolon
r_int
id|err
suffix:semicolon
r_union
(brace
r_char
id|str
(braket
l_int|80
)braket
suffix:semicolon
)brace
id|u
suffix:semicolon
r_volatile
id|CHDLC_MAILBOX_STRUCT
op_star
id|mb
suffix:semicolon
id|CHDLC_MAILBOX_STRUCT
op_star
id|mb1
suffix:semicolon
r_int
r_int
id|timeout
suffix:semicolon
multiline_comment|/* Verify configuration ID */
r_if
c_cond
(paren
id|conf-&gt;config_id
op_ne
id|WANCONFIG_CHDLC
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: invalid configuration ID %u!&bslash;n&quot;
comma
id|card-&gt;devname
comma
id|conf-&gt;config_id
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Use primary port */
id|card-&gt;u.c.comm_port
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialize protocol-specific fields */
r_if
c_cond
(paren
id|card-&gt;hw.type
op_ne
id|SDLA_S514
)paren
(brace
id|card-&gt;mbox
op_assign
(paren
r_void
op_star
)paren
id|card-&gt;hw.dpmbase
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;mbox
op_assign
(paren
r_void
op_star
)paren
id|card-&gt;hw.dpmbase
op_plus
id|PRI_BASE_ADDR_MB_STRUCT
suffix:semicolon
)brace
id|mb
op_assign
id|mb1
op_assign
id|card-&gt;mbox
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;configured
)paren
(brace
multiline_comment|/* The board will place an &squot;I&squot; in the return code to indicate that it is&n;&t;   &t;ready to accept commands.  We expect this to be completed in less&n;           &t;than 1 second. */
id|timeout
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|mb-&gt;return_code
op_ne
l_char|&squot;I&squot;
)paren
multiline_comment|/* Wait 1s for board to initialize */
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|timeout
)paren
OG
l_int|1
op_star
id|HZ
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|mb-&gt;return_code
op_ne
l_char|&squot;I&squot;
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Initialization not completed by adapter&bslash;n&quot;
comma
id|card-&gt;devname
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Please contact Sangoma representative.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
multiline_comment|/* Read firmware version.  Note that when adapter initializes, it&n;&t; * clears the mailbox, so it may appear that the first command was&n;&t; * executed successfully when in fact it was merely erased. To work&n;&t; * around this, we execute the first command twice.&n;&t; */
r_if
c_cond
(paren
id|chdlc_read_version
c_func
(paren
id|card
comma
id|u.str
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Running FT1 Configuration firmware v%s&bslash;n&quot;
comma
id|card-&gt;devname
comma
id|u.str
)paren
suffix:semicolon
id|card-&gt;isr
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;poll
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;exec
op_assign
op_amp
id|wpft1_exec
suffix:semicolon
id|card-&gt;wandev.update
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;wandev.new_if
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;wandev.del_if
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;wandev.state
op_assign
id|WAN_DUALPORT
suffix:semicolon
id|card-&gt;wandev.udp_port
op_assign
id|conf-&gt;udp_port
suffix:semicolon
id|card-&gt;wandev.new_if_cnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* This is for the ports link state */
id|card-&gt;u.c.state
op_assign
id|WAN_DISCONNECTED
suffix:semicolon
multiline_comment|/* reset the number of times the &squot;update()&squot; proc has been called */
id|card-&gt;u.c.update_call_count
op_assign
l_int|0
suffix:semicolon
id|card-&gt;wandev.ttl
op_assign
l_int|0x7F
suffix:semicolon
id|card-&gt;wandev.interface
op_assign
l_int|0
suffix:semicolon
id|card-&gt;wandev.clocking
op_assign
l_int|0
suffix:semicolon
id|port_num
op_assign
id|card-&gt;u.c.comm_port
suffix:semicolon
multiline_comment|/* Setup Port Bps */
id|card-&gt;wandev.bps
op_assign
l_int|0
suffix:semicolon
id|card-&gt;wandev.mtu
op_assign
id|MIN_LGTH_CHDLC_DATA_CFG
suffix:semicolon
multiline_comment|/* Set up the interrupt status area */
multiline_comment|/* Read the CHDLC Configuration and obtain: &n;&t; *&t;Ptr to shared memory infor struct&n;         * Use this pointer to calculate the value of card-&gt;u.c.flags !&n; &t; */
id|mb1-&gt;buffer_length
op_assign
l_int|0
suffix:semicolon
id|mb1-&gt;command
op_assign
id|READ_CHDLC_CONFIGURATION
suffix:semicolon
id|err
op_assign
id|sdla_exec
c_func
(paren
id|mb1
)paren
ques
c_cond
id|mb1-&gt;return_code
suffix:colon
id|CMD_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|COMMAND_OK
)paren
(brace
id|chdlc_error
c_func
(paren
id|card
comma
id|err
comma
id|mb1
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;hw.type
op_eq
id|SDLA_S514
)paren
(brace
id|card-&gt;u.c.flags
op_assign
(paren
r_void
op_star
)paren
(paren
id|card-&gt;hw.dpmbase
op_plus
(paren
(paren
(paren
id|CHDLC_CONFIGURATION_STRUCT
op_star
)paren
id|mb1-&gt;data
)paren
op_member_access_from_pointer
id|ptr_shared_mem_info_struct
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;u.c.flags
op_assign
(paren
r_void
op_star
)paren
(paren
id|card-&gt;hw.dpmbase
op_plus
(paren
(paren
(paren
id|CHDLC_CONFIGURATION_STRUCT
op_star
)paren
id|mb1-&gt;data
)paren
op_member_access_from_pointer
id|ptr_shared_mem_info_struct
op_mod
id|SDLA_WINDOWSIZE
)paren
)paren
suffix:semicolon
)brace
id|card-&gt;wandev.state
op_assign
id|WAN_FT1_READY
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: FT1 Config Ready !&bslash;n&quot;
comma
id|card-&gt;devname
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wpft1_exec
r_static
r_int
id|wpft1_exec
c_func
(paren
id|sdla_t
op_star
id|card
comma
r_void
op_star
id|u_cmd
comma
r_void
op_star
id|u_data
)paren
(brace
id|CHDLC_MAILBOX_STRUCT
op_star
id|mbox
op_assign
id|card-&gt;mbox
suffix:semicolon
r_int
id|len
suffix:semicolon
macro_line|#if defined(LINUX_2_1) || defined(LINUX_2_4)
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;command
comma
id|u_cmd
comma
r_sizeof
(paren
id|ft1_exec_cmd_t
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|len
op_assign
id|mbox-&gt;buffer_length
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;data
comma
id|u_data
comma
id|len
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
multiline_comment|/* execute command */
r_if
c_cond
(paren
op_logical_neg
id|sdla_exec
c_func
(paren
id|mbox
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* return result */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|u_cmd
comma
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;command
comma
r_sizeof
(paren
id|ft1_exec_cmd_t
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|len
op_assign
id|mbox-&gt;buffer_length
suffix:semicolon
r_if
c_cond
(paren
id|len
op_logical_and
id|u_data
op_logical_and
id|copy_to_user
c_func
(paren
id|u_data
comma
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;data
comma
id|len
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
op_logical_neg
id|u_cmd
op_logical_or
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|u_cmd
comma
r_sizeof
(paren
id|ft1_exec_cmd_t
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|memcpy_fromfs
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;command
comma
id|u_cmd
comma
r_sizeof
(paren
id|ft1_exec_cmd_t
)paren
)paren
suffix:semicolon
id|len
op_assign
id|mbox-&gt;buffer_length
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|u_data
op_logical_or
id|verify_area
c_func
(paren
id|VERIFY_READ
comma
id|u_data
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|memcpy_fromfs
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;data
comma
id|u_data
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/* execute command */
r_if
c_cond
(paren
op_logical_neg
id|sdla_exec
c_func
(paren
id|mbox
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* return result */
id|memcpy_tofs
c_func
(paren
id|u_cmd
comma
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;command
comma
r_sizeof
(paren
id|ft1_exec_cmd_t
)paren
)paren
suffix:semicolon
id|len
op_assign
id|mbox-&gt;buffer_length
suffix:semicolon
r_if
c_cond
(paren
id|len
op_logical_and
id|u_data
op_logical_and
op_logical_neg
id|verify_area
c_func
(paren
id|VERIFY_WRITE
comma
id|u_data
comma
id|len
)paren
)paren
(brace
id|memcpy_tofs
c_func
(paren
id|u_data
comma
(paren
r_void
op_star
)paren
op_amp
id|mbox-&gt;data
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*============================================================================&n; * Read firmware code version.&n; *&t;Put code version as ASCII string in str. &n; */
DECL|function|chdlc_read_version
r_static
r_int
id|chdlc_read_version
(paren
id|sdla_t
op_star
id|card
comma
r_char
op_star
id|str
)paren
(brace
id|CHDLC_MAILBOX_STRUCT
op_star
id|mb
op_assign
id|card-&gt;mbox
suffix:semicolon
r_int
id|len
suffix:semicolon
r_char
id|err
suffix:semicolon
id|mb-&gt;buffer_length
op_assign
l_int|0
suffix:semicolon
id|mb-&gt;command
op_assign
id|READ_CHDLC_CODE_VERSION
suffix:semicolon
id|err
op_assign
id|sdla_exec
c_func
(paren
id|mb
)paren
ques
c_cond
id|mb-&gt;return_code
suffix:colon
id|CMD_TIMEOUT
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|COMMAND_OK
)paren
(brace
id|chdlc_error
c_func
(paren
id|card
comma
id|err
comma
id|mb
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|str
)paren
(brace
multiline_comment|/* is not null */
id|len
op_assign
id|mb-&gt;buffer_length
suffix:semicolon
id|memcpy
c_func
(paren
id|str
comma
id|mb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|str
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
multiline_comment|/*============================================================================&n; * Firmware error handler.&n; *&t;This routine is called whenever firmware command returns non-zero&n; *&t;return code.&n; *&n; * Return zero if previous command has to be cancelled.&n; */
DECL|function|chdlc_error
r_static
r_int
id|chdlc_error
(paren
id|sdla_t
op_star
id|card
comma
r_int
id|err
comma
id|CHDLC_MAILBOX_STRUCT
op_star
id|mb
)paren
(brace
r_int
id|cmd
op_assign
id|mb-&gt;command
suffix:semicolon
r_switch
c_cond
(paren
id|err
)paren
(brace
r_case
id|CMD_TIMEOUT
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: command 0x%02X timed out!&bslash;n&quot;
comma
id|card-&gt;devname
comma
id|cmd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|S514_BOTH_PORTS_SAME_CLK_MODE
suffix:colon
r_if
c_cond
(paren
id|cmd
op_eq
id|SET_CHDLC_CONFIGURATION
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Configure both ports for the same clock source&bslash;n&quot;
comma
id|card-&gt;devname
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: command 0x%02X returned 0x%02X!&bslash;n&quot;
comma
id|card-&gt;devname
comma
id|cmd
comma
id|err
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
