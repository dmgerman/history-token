multiline_comment|/*&n; * Moxa C101 synchronous serial card driver for Linux&n; *&n; * Copyright (C) 2000-2001 Krzysztof Halasa &lt;khc@pm.waw.pl&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * For information see http://hq.pm.waw.pl/hdlc/&n; *&n; * Sources of information:&n; *    Hitachi HD64570 SCA User&squot;s Manual&n; *    Moxa C101 User&squot;s Manual&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/hdlc.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;hd64570.h&quot;
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;Moxa C101 driver version: 1.09&quot;
suffix:semicolon
DECL|variable|devname
r_static
r_const
r_char
op_star
id|devname
op_assign
l_string|&quot;C101&quot;
suffix:semicolon
DECL|macro|C101_PAGE
mdefine_line|#define C101_PAGE 0x1D00
DECL|macro|C101_DTR
mdefine_line|#define C101_DTR 0x1E00
DECL|macro|C101_SCA
mdefine_line|#define C101_SCA 0x1F00
DECL|macro|C101_WINDOW_SIZE
mdefine_line|#define C101_WINDOW_SIZE 0x2000
DECL|macro|C101_MAPPED_RAM_SIZE
mdefine_line|#define C101_MAPPED_RAM_SIZE 0x4000
DECL|macro|RAM_SIZE
mdefine_line|#define RAM_SIZE (256 * 1024)
DECL|macro|CLOCK_BASE
mdefine_line|#define CLOCK_BASE 9830400&t;/* 9.8304 MHz */
DECL|macro|PAGE0_ALWAYS_MAPPED
mdefine_line|#define PAGE0_ALWAYS_MAPPED
DECL|variable|hw
r_static
r_char
op_star
id|hw
suffix:semicolon
multiline_comment|/* pointer to hw=xxx command line string */
DECL|struct|card_s
r_typedef
r_struct
id|card_s
(brace
DECL|member|hdlc
id|hdlc_device
id|hdlc
suffix:semicolon
multiline_comment|/* HDLC device struct - must be first */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* TX lock */
DECL|member|win0base
id|u8
op_star
id|win0base
suffix:semicolon
multiline_comment|/* ISA window base address */
DECL|member|phy_winbase
id|u32
id|phy_winbase
suffix:semicolon
multiline_comment|/* ISA physical base address */
DECL|member|buff_offset
id|u16
id|buff_offset
suffix:semicolon
multiline_comment|/* offset of first buffer of first channel */
DECL|member|settings
id|sync_serial_settings
id|settings
suffix:semicolon
DECL|member|encoding
r_int
r_int
id|encoding
suffix:semicolon
DECL|member|parity
r_int
r_int
id|parity
suffix:semicolon
DECL|member|rxs
DECL|member|txs
DECL|member|tmc
id|u8
id|rxs
comma
id|txs
comma
id|tmc
suffix:semicolon
multiline_comment|/* SCA registers */
DECL|member|irq
id|u8
id|irq
suffix:semicolon
multiline_comment|/* IRQ (3-15) */
DECL|member|ring_buffers
id|u8
id|ring_buffers
suffix:semicolon
multiline_comment|/* number of buffers in a ring */
DECL|member|page
id|u8
id|page
suffix:semicolon
DECL|member|rxin
id|u8
id|rxin
suffix:semicolon
multiline_comment|/* rx ring buffer &squot;in&squot; pointer */
DECL|member|txin
id|u8
id|txin
suffix:semicolon
multiline_comment|/* tx ring buffer &squot;in&squot; and &squot;last&squot; pointers */
DECL|member|txlast
id|u8
id|txlast
suffix:semicolon
DECL|member|rxpart
id|u8
id|rxpart
suffix:semicolon
multiline_comment|/* partial frame received, next frame invalid*/
DECL|member|next_card
r_struct
id|card_s
op_star
id|next_card
suffix:semicolon
DECL|typedef|card_t
)brace
id|card_t
suffix:semicolon
DECL|typedef|port_t
r_typedef
id|card_t
id|port_t
suffix:semicolon
DECL|variable|first_card
r_static
id|card_t
op_star
id|first_card
suffix:semicolon
DECL|variable|new_card
r_static
id|card_t
op_star
op_star
id|new_card
op_assign
op_amp
id|first_card
suffix:semicolon
DECL|macro|sca_in
mdefine_line|#define sca_in(reg, card)&t;   readb((card)-&gt;win0base + C101_SCA + (reg))
DECL|macro|sca_out
mdefine_line|#define sca_out(value, reg, card)  writeb(value, (card)-&gt;win0base + C101_SCA + (reg))
DECL|macro|sca_inw
mdefine_line|#define sca_inw(reg, card)&t;   readw((card)-&gt;win0base + C101_SCA + (reg))
DECL|macro|sca_outw
mdefine_line|#define sca_outw(value, reg, card) writew(value, (card)-&gt;win0base + C101_SCA + (reg))
DECL|macro|port_to_card
mdefine_line|#define port_to_card(port)&t;   (port)
DECL|macro|log_node
mdefine_line|#define log_node(port)&t;&t;   (0)
DECL|macro|phy_node
mdefine_line|#define phy_node(port)&t;&t;   (0)
DECL|macro|winsize
mdefine_line|#define winsize(card)&t;&t;   (C101_WINDOW_SIZE)
DECL|macro|win0base
mdefine_line|#define win0base(card)&t;&t;   ((card)-&gt;win0base)
DECL|macro|winbase
mdefine_line|#define winbase(card)      &t;   ((card)-&gt;win0base + 0x2000)
DECL|macro|get_port
mdefine_line|#define get_port(card, port)&t;   ((port) == 0 ? (card) : NULL)
DECL|function|sca_get_page
r_static
r_inline
id|u8
id|sca_get_page
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
r_return
id|card-&gt;page
suffix:semicolon
)brace
DECL|function|openwin
r_static
r_inline
r_void
id|openwin
c_func
(paren
id|card_t
op_star
id|card
comma
id|u8
id|page
)paren
(brace
id|card-&gt;page
op_assign
id|page
suffix:semicolon
id|writeb
c_func
(paren
id|page
comma
id|card-&gt;win0base
op_plus
id|C101_PAGE
)paren
suffix:semicolon
)brace
DECL|macro|close_windows
mdefine_line|#define close_windows(card) {} /* no hardware support */
macro_line|#include &quot;hd6457x.c&quot;
DECL|function|c101_set_iface
r_static
r_int
id|c101_set_iface
c_func
(paren
id|port_t
op_star
id|port
)paren
(brace
id|u8
id|msci
op_assign
id|get_msci
c_func
(paren
id|port
)paren
suffix:semicolon
id|u8
id|rxs
op_assign
id|port-&gt;rxs
op_amp
id|CLK_BRG_MASK
suffix:semicolon
id|u8
id|txs
op_assign
id|port-&gt;txs
op_amp
id|CLK_BRG_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|port-&gt;settings.clock_type
)paren
(brace
r_case
id|CLOCK_EXT
suffix:colon
id|rxs
op_or_assign
id|CLK_LINE_RX
suffix:semicolon
multiline_comment|/* RXC input */
id|txs
op_or_assign
id|CLK_LINE_TX
suffix:semicolon
multiline_comment|/* TXC input */
r_break
suffix:semicolon
r_case
id|CLOCK_INT
suffix:colon
id|rxs
op_or_assign
id|CLK_BRG_RX
suffix:semicolon
multiline_comment|/* TX clock */
id|txs
op_or_assign
id|CLK_RXCLK_TX
suffix:semicolon
multiline_comment|/* BRG output */
r_break
suffix:semicolon
r_case
id|CLOCK_TXINT
suffix:colon
id|rxs
op_or_assign
id|CLK_LINE_RX
suffix:semicolon
multiline_comment|/* RXC input */
id|txs
op_or_assign
id|CLK_BRG_TX
suffix:semicolon
multiline_comment|/* BRG output */
r_break
suffix:semicolon
r_case
id|CLOCK_TXFROMRX
suffix:colon
id|rxs
op_or_assign
id|CLK_LINE_RX
suffix:semicolon
multiline_comment|/* RXC input */
id|txs
op_or_assign
id|CLK_RXCLK_TX
suffix:semicolon
multiline_comment|/* RX clock */
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|port-&gt;rxs
op_assign
id|rxs
suffix:semicolon
id|port-&gt;txs
op_assign
id|txs
suffix:semicolon
id|sca_out
c_func
(paren
id|rxs
comma
id|msci
op_plus
id|RXS
comma
id|port
)paren
suffix:semicolon
id|sca_out
c_func
(paren
id|txs
comma
id|msci
op_plus
id|TXS
comma
id|port
)paren
suffix:semicolon
id|sca_set_port
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c101_open
r_static
r_int
id|c101_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|port_t
op_star
id|port
op_assign
id|hdlc_to_port
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_int
id|result
op_assign
id|hdlc_open
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_return
id|result
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|writeb
c_func
(paren
l_int|1
comma
id|port-&gt;win0base
op_plus
id|C101_DTR
)paren
suffix:semicolon
id|sca_out
c_func
(paren
l_int|0
comma
id|MSCI1_OFFSET
op_plus
id|CTL
comma
id|port
)paren
suffix:semicolon
multiline_comment|/* RTS uses ch#2 output */
id|sca_open
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_return
id|c101_set_iface
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|function|c101_close
r_static
r_int
id|c101_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|port_t
op_star
id|port
op_assign
id|hdlc_to_port
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|sca_close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|port-&gt;win0base
op_plus
id|C101_DTR
)paren
suffix:semicolon
id|sca_out
c_func
(paren
id|CTL_NORTS
comma
id|MSCI1_OFFSET
op_plus
id|CTL
comma
id|port
)paren
suffix:semicolon
id|hdlc_close
c_func
(paren
id|hdlc
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c101_ioctl
r_static
r_int
id|c101_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
id|hdlc_device
op_star
id|hdlc
op_assign
id|dev_to_hdlc
c_func
(paren
id|dev
)paren
suffix:semicolon
id|port_t
op_star
id|port
op_assign
id|hdlc_to_port
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_const
r_int
id|size
op_assign
r_sizeof
(paren
id|sync_serial_settings
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HDLC_DEBUG_RINGS
r_if
c_cond
(paren
id|cmd
op_eq
id|SIOCDEVPRIVATE
)paren
(brace
id|sca_dump_rings
c_func
(paren
id|hdlc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|cmd
op_ne
id|SIOCDEVICE
)paren
r_return
id|hdlc_ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ifr-&gt;ifr_settings.type
)paren
(brace
r_case
id|IF_GET_IFACE
suffix:colon
id|ifr-&gt;ifr_settings.type
op_assign
id|IF_IFACE_SYNC_SERIAL
suffix:semicolon
r_if
c_cond
(paren
id|ifr-&gt;ifr_settings.data_length
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* return interface type only */
r_if
c_cond
(paren
id|ifr-&gt;ifr_settings.data_length
OL
id|size
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* buffer too small */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ifr-&gt;ifr_settings.data
comma
op_amp
id|port-&gt;settings
comma
id|size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ifr-&gt;ifr_settings.data_length
op_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|IF_IFACE_SYNC_SERIAL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ifr-&gt;ifr_settings.data_length
op_ne
id|size
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* incorrect data length */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|port-&gt;settings
comma
id|ifr-&gt;ifr_settings.data
comma
id|size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* FIXME - put sanity checks here */
r_return
id|c101_set_iface
c_func
(paren
id|port
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|hdlc_ioctl
c_func
(paren
id|dev
comma
id|ifr
comma
id|cmd
)paren
suffix:semicolon
)brace
)brace
DECL|function|c101_destroy_card
r_static
r_void
id|c101_destroy_card
c_func
(paren
id|card_t
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;irq
)paren
id|free_irq
c_func
(paren
id|card-&gt;irq
comma
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;win0base
)paren
(brace
id|iounmap
c_func
(paren
id|card-&gt;win0base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|card-&gt;phy_winbase
comma
id|C101_MAPPED_RAM_SIZE
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|c101_run
r_static
r_int
id|c101_run
c_func
(paren
r_int
r_int
id|irq
comma
r_int
r_int
id|winbase
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|card_t
op_star
id|card
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|irq
l_int|15
op_logical_or
id|irq
op_eq
l_int|6
)paren
multiline_comment|/* FIXME */
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: invalid IRQ value&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|winbase
template_param
l_int|0xDFFFF
op_logical_or
(paren
id|winbase
op_amp
l_int|0x3FFF
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: invalid RAM value&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|card
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|card_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: unable to allocate memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
id|card_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|sca_intr
comma
l_int|0
comma
id|devname
comma
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: could not allocate IRQ&bslash;n&quot;
)paren
suffix:semicolon
id|c101_destroy_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|card-&gt;irq
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|winbase
comma
id|C101_MAPPED_RAM_SIZE
comma
id|devname
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: could not request RAM window&bslash;n&quot;
)paren
suffix:semicolon
id|c101_destroy_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|card-&gt;phy_winbase
op_assign
id|winbase
suffix:semicolon
id|card-&gt;win0base
op_assign
id|ioremap
c_func
(paren
id|winbase
comma
id|C101_MAPPED_RAM_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;win0base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: could not map I/O address&bslash;n&quot;
)paren
suffix:semicolon
id|c101_destroy_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* 2 rings required for 1 port */
id|card-&gt;ring_buffers
op_assign
(paren
id|RAM_SIZE
op_minus
id|C101_WINDOW_SIZE
)paren
op_div
(paren
l_int|2
op_star
id|HDLC_MAX_MRU
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;c101: using %u packets rings&bslash;n&quot;
comma
id|card-&gt;ring_buffers
)paren
suffix:semicolon
id|card-&gt;buff_offset
op_assign
id|C101_WINDOW_SIZE
suffix:semicolon
multiline_comment|/* Bytes 1D00-1FFF reserved */
id|readb
c_func
(paren
id|card-&gt;win0base
op_plus
id|C101_PAGE
)paren
suffix:semicolon
multiline_comment|/* Resets SCA? */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|card-&gt;win0base
op_plus
id|C101_PAGE
)paren
suffix:semicolon
id|writeb
c_func
(paren
l_int|0
comma
id|card-&gt;win0base
op_plus
id|C101_DTR
)paren
suffix:semicolon
multiline_comment|/* Power-up for RAM? */
id|sca_init
c_func
(paren
id|card
comma
l_int|0
)paren
suffix:semicolon
id|dev
op_assign
id|hdlc_to_dev
c_func
(paren
op_amp
id|card-&gt;hdlc
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|winbase
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|winbase
op_plus
id|C101_MAPPED_RAM_SIZE
op_minus
l_int|1
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
l_int|50
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|c101_ioctl
suffix:semicolon
id|dev-&gt;open
op_assign
id|c101_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|c101_close
suffix:semicolon
id|card-&gt;hdlc.attach
op_assign
id|sca_attach
suffix:semicolon
id|card-&gt;hdlc.xmit
op_assign
id|sca_xmit
suffix:semicolon
id|card-&gt;settings.clock_type
op_assign
id|CLOCK_EXT
suffix:semicolon
id|result
op_assign
id|register_hdlc_device
c_func
(paren
op_amp
id|card-&gt;hdlc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;c101: unable to register hdlc device&bslash;n&quot;
)paren
suffix:semicolon
id|c101_destroy_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|sca_init_sync_port
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* Set up C101 memory */
op_star
id|new_card
op_assign
id|card
suffix:semicolon
id|new_card
op_assign
op_amp
id|card-&gt;next_card
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|c101_init
r_static
r_int
id|__init
id|c101_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|hw
op_eq
l_int|NULL
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;c101: no card initialized&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* no parameters specified, abort */
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s (SCA-%s)&bslash;n&quot;
comma
id|version
comma
id|sca_version
)paren
suffix:semicolon
r_do
(brace
r_int
r_int
id|irq
comma
id|ram
suffix:semicolon
id|irq
op_assign
id|simple_strtoul
c_func
(paren
id|hw
comma
op_amp
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|hw
op_increment
op_ne
l_char|&squot;,&squot;
)paren
r_break
suffix:semicolon
id|ram
op_assign
id|simple_strtoul
c_func
(paren
id|hw
comma
op_amp
id|hw
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|hw
op_eq
l_char|&squot;:&squot;
op_logical_or
op_star
id|hw
op_eq
l_char|&squot;&bslash;x0&squot;
)paren
id|c101_run
c_func
(paren
id|irq
comma
id|ram
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|hw
op_eq
l_char|&squot;&bslash;x0&squot;
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|hw
op_increment
op_eq
l_char|&squot;:&squot;
)paren
(brace
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;c101: invalid hardware parameters&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|first_card
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENOSYS
suffix:semicolon
)brace
macro_line|#ifndef MODULE
DECL|function|c101_setup
r_static
r_int
id|__init
id|c101_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|hw
op_assign
id|str
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;c101=&quot;
comma
id|c101_setup
)paren
suffix:semicolon
macro_line|#endif
DECL|function|c101_cleanup
r_static
r_void
id|__exit
id|c101_cleanup
c_func
(paren
r_void
)paren
(brace
id|card_t
op_star
id|card
op_assign
id|first_card
suffix:semicolon
r_while
c_loop
(paren
id|card
)paren
(brace
id|card_t
op_star
id|ptr
op_assign
id|card
suffix:semicolon
id|card
op_assign
id|card-&gt;next_card
suffix:semicolon
id|unregister_hdlc_device
c_func
(paren
op_amp
id|ptr-&gt;hdlc
)paren
suffix:semicolon
id|c101_destroy_card
c_func
(paren
id|ptr
)paren
suffix:semicolon
)brace
)brace
DECL|variable|c101_init
id|module_init
c_func
(paren
id|c101_init
)paren
suffix:semicolon
DECL|variable|c101_cleanup
id|module_exit
c_func
(paren
id|c101_cleanup
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Krzysztof Halasa &lt;khc@pm.waw.pl&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Moxa C101 serial port driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hw
comma
l_string|&quot;s&quot;
)paren
suffix:semicolon
multiline_comment|/* hw=irq,ram:irq,... */
id|EXPORT_NO_SYMBOLS
suffix:semicolon
eof
