multiline_comment|/* 8139cp.c: A Linux PCI Ethernet driver for the RealTek 8139C+ chips. */
multiline_comment|/*&n;&t;Copyright 2001,2002 Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n;&n;&t;Copyright (C) 2001, 2002 David S. Miller (davem@redhat.com) [tg3.c]&n;&t;Copyright (C) 2000, 2001 David S. Miller (davem@redhat.com) [sungem.c]&n;&t;Copyright 2001 Manfred Spraul&t;&t;&t;&t;    [natsemi.c]&n;&t;Copyright 1999-2001 by Donald Becker.&t;&t;&t;    [natsemi.c]&n;       &t;Written 1997-2001 by Donald Becker.&t;&t;&t;    [8139too.c]&n;&t;Copyright 1998-2001 by Jes Sorensen, &lt;jes@trained-monkey.org&gt;. [acenic.c]&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;See the file COPYING in this distribution for more information.&n;&n;&t;TODO, in rough priority order:&n;&t;* dev-&gt;tx_timeout&n;&t;* LinkChg interrupt&n;&t;* Support forcing media type with a module parameter,&n;&t;  like dl2k.c/sundance.c&n;&t;* Implement PCI suspend/resume&n;&t;* Constants (module parms?) for Rx work limit&n;&t;* support 64-bit PCI DMA&n;&t;* Complete reset on PciErr&n;&t;* Consider Rx interrupt mitigation using TimerIntr&n;&t;* Implement 8139C+ statistics dump; maybe not...&n;&t;  h/w stats can be reset only by software reset&n;&t;* Tx checksumming&n;&t;* Handle netif_rx return value&n;&t;* ETHTOOL_GREGS, ETHTOOL_[GS]WOL,&n;&t;* Investigate using skb-&gt;priority with h/w VLAN priority&n;&t;* Investigate using High Priority Tx Queue with skb-&gt;priority&n;&t;* Adjust Rx FIFO threshold and Max Rx DMA burst on Rx FIFO error&n;&t;* Adjust Tx FIFO threshold and Max Tx DMA burst on Tx FIFO error&n;        * Implement Tx software interrupt mitigation via&n;&t;          Tx descriptor bit&n;&t;* The real minimum of CP_MIN_MTU is 4 bytes.  However,&n;&t;  for this to be supported, one must(?) turn on packet padding.&n;&n; */
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&t;&quot;8139cp&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&t;&quot;0.0.7&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&t;&quot;Feb 27, 2002&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/if_vlan.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#if defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE)
DECL|macro|CP_VLAN_TAG_USED
mdefine_line|#define CP_VLAN_TAG_USED 1
DECL|macro|CP_VLAN_TX_TAG
mdefine_line|#define CP_VLAN_TX_TAG(tx_desc,vlan_tag_value) &bslash;&n;&t;do { (tx_desc)-&gt;opts2 = (vlan_tag_value); } while (0)
macro_line|#else
DECL|macro|CP_VLAN_TAG_USED
mdefine_line|#define CP_VLAN_TAG_USED 0
DECL|macro|CP_VLAN_TX_TAG
mdefine_line|#define CP_VLAN_TX_TAG(tx_desc,vlan_tag_value) &bslash;&n;&t;do { (tx_desc)-&gt;opts2 = 0; } while (0)
macro_line|#endif
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|KERN_INFO
id|DRV_NAME
l_string|&quot; 10/100 PCI Ethernet driver v&quot;
id|DRV_VERSION
l_string|&quot; (&quot;
id|DRV_RELDATE
l_string|&quot;)&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;RealTek RTL-8139C+ series 10/100 PCI Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|debug
comma
l_string|&quot;8139cp bitmapped message enable number&quot;
)paren
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast).&n;   The RTL chips use a 64 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
id|MODULE_PARM
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|multicast_filter_limit
comma
l_string|&quot;8139cp maximum number of filtered multicast addresses&quot;
)paren
suffix:semicolon
DECL|macro|PFX
mdefine_line|#define PFX&t;&t;&t;DRV_NAME &quot;: &quot;
DECL|macro|CP_DEF_MSG_ENABLE
mdefine_line|#define CP_DEF_MSG_ENABLE&t;(NETIF_MSG_DRV&t;&t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_PROBE &t;| &bslash;&n;&t;&t;&t;&t; NETIF_MSG_LINK)
DECL|macro|CP_REGS_SIZE
mdefine_line|#define CP_REGS_SIZE&t;&t;(0xff + 1)
DECL|macro|CP_RX_RING_SIZE
mdefine_line|#define CP_RX_RING_SIZE&t;&t;64
DECL|macro|CP_TX_RING_SIZE
mdefine_line|#define CP_TX_RING_SIZE&t;&t;64
DECL|macro|CP_RING_BYTES
mdefine_line|#define CP_RING_BYTES&t;&t;&bslash;&n;&t;&t;((sizeof(struct cp_desc) * CP_RX_RING_SIZE) +&t;&bslash;&n;&t;&t;(sizeof(struct cp_desc) * CP_TX_RING_SIZE))
DECL|macro|NEXT_TX
mdefine_line|#define NEXT_TX(N)&t;&t;(((N) + 1) &amp; (CP_TX_RING_SIZE - 1))
DECL|macro|NEXT_RX
mdefine_line|#define NEXT_RX(N)&t;&t;(((N) + 1) &amp; (CP_RX_RING_SIZE - 1))
DECL|macro|TX_BUFFS_AVAIL
mdefine_line|#define TX_BUFFS_AVAIL(CP)&t;&t;&t;&t;&t;&bslash;&n;&t;(((CP)-&gt;tx_tail &lt;= (CP)-&gt;tx_head) ?&t;&t;&t;&bslash;&n;&t;  (CP)-&gt;tx_tail + (CP_TX_RING_SIZE - 1) - (CP)-&gt;tx_head :&t;&bslash;&n;&t;  (CP)-&gt;tx_tail - (CP)-&gt;tx_head - 1)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;/* Size of each temporary Rx buffer.*/
DECL|macro|RX_OFFSET
mdefine_line|#define RX_OFFSET&t;&t;2
DECL|macro|CP_INTERNAL_PHY
mdefine_line|#define CP_INTERNAL_PHY&t;&t;32
multiline_comment|/* The following settings are log_2(bytes)-4:  0 == 16 bytes .. 6==1024, 7==end of packet. */
DECL|macro|RX_FIFO_THRESH
mdefine_line|#define RX_FIFO_THRESH&t;&t;5&t;/* Rx buffer level before first PCI xfer.  */
DECL|macro|RX_DMA_BURST
mdefine_line|#define RX_DMA_BURST&t;&t;4&t;/* Maximum PCI burst, &squot;4&squot; is 256 */
DECL|macro|TX_DMA_BURST
mdefine_line|#define TX_DMA_BURST&t;&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|TX_EARLY_THRESH
mdefine_line|#define TX_EARLY_THRESH&t;&t;256&t;/* Early Tx threshold, in bytes */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT&t;&t;(6*HZ)
multiline_comment|/* hardware minimum and maximum for a single frame&squot;s data payload */
DECL|macro|CP_MIN_MTU
mdefine_line|#define CP_MIN_MTU&t;&t;60&t;/* TODO: allow lower, but pad */
DECL|macro|CP_MAX_MTU
mdefine_line|#define CP_MAX_MTU&t;&t;4096
r_enum
(brace
multiline_comment|/* NIC register offsets */
DECL|enumerator|MAC0
id|MAC0
op_assign
l_int|0x00
comma
multiline_comment|/* Ethernet hardware address. */
DECL|enumerator|MAR0
id|MAR0
op_assign
l_int|0x08
comma
multiline_comment|/* Multicast filter. */
DECL|enumerator|TxRingAddr
id|TxRingAddr
op_assign
l_int|0x20
comma
multiline_comment|/* 64-bit start addr of Tx ring */
DECL|enumerator|HiTxRingAddr
id|HiTxRingAddr
op_assign
l_int|0x28
comma
multiline_comment|/* 64-bit start addr of high priority Tx ring */
DECL|enumerator|Cmd
id|Cmd
op_assign
l_int|0x37
comma
multiline_comment|/* Command register */
DECL|enumerator|IntrMask
id|IntrMask
op_assign
l_int|0x3C
comma
multiline_comment|/* Interrupt mask */
DECL|enumerator|IntrStatus
id|IntrStatus
op_assign
l_int|0x3E
comma
multiline_comment|/* Interrupt status */
DECL|enumerator|TxConfig
id|TxConfig
op_assign
l_int|0x40
comma
multiline_comment|/* Tx configuration */
DECL|enumerator|ChipVersion
id|ChipVersion
op_assign
l_int|0x43
comma
multiline_comment|/* 8-bit chip version, inside TxConfig */
DECL|enumerator|RxConfig
id|RxConfig
op_assign
l_int|0x44
comma
multiline_comment|/* Rx configuration */
DECL|enumerator|Cfg9346
id|Cfg9346
op_assign
l_int|0x50
comma
multiline_comment|/* EEPROM select/control; Cfg reg [un]lock */
DECL|enumerator|Config1
id|Config1
op_assign
l_int|0x52
comma
multiline_comment|/* Config1 */
DECL|enumerator|Config3
id|Config3
op_assign
l_int|0x59
comma
multiline_comment|/* Config3 */
DECL|enumerator|Config4
id|Config4
op_assign
l_int|0x5A
comma
multiline_comment|/* Config4 */
DECL|enumerator|MultiIntr
id|MultiIntr
op_assign
l_int|0x5C
comma
multiline_comment|/* Multiple interrupt select */
DECL|enumerator|BasicModeCtrl
id|BasicModeCtrl
op_assign
l_int|0x62
comma
multiline_comment|/* MII BMCR */
DECL|enumerator|BasicModeStatus
id|BasicModeStatus
op_assign
l_int|0x64
comma
multiline_comment|/* MII BMSR */
DECL|enumerator|NWayAdvert
id|NWayAdvert
op_assign
l_int|0x66
comma
multiline_comment|/* MII ADVERTISE */
DECL|enumerator|NWayLPAR
id|NWayLPAR
op_assign
l_int|0x68
comma
multiline_comment|/* MII LPA */
DECL|enumerator|NWayExpansion
id|NWayExpansion
op_assign
l_int|0x6A
comma
multiline_comment|/* MII Expansion */
DECL|enumerator|Config5
id|Config5
op_assign
l_int|0xD8
comma
multiline_comment|/* Config5 */
DECL|enumerator|TxPoll
id|TxPoll
op_assign
l_int|0xD9
comma
multiline_comment|/* Tell chip to check Tx descriptors for work */
DECL|enumerator|CpCmd
id|CpCmd
op_assign
l_int|0xE0
comma
multiline_comment|/* C+ Command register (C+ mode only) */
DECL|enumerator|RxRingAddr
id|RxRingAddr
op_assign
l_int|0xE4
comma
multiline_comment|/* 64-bit start addr of Rx ring */
DECL|enumerator|TxThresh
id|TxThresh
op_assign
l_int|0xEC
comma
multiline_comment|/* Early Tx threshold */
DECL|enumerator|OldRxBufAddr
id|OldRxBufAddr
op_assign
l_int|0x30
comma
multiline_comment|/* DMA address of Rx ring buffer (C mode) */
DECL|enumerator|OldTSD0
id|OldTSD0
op_assign
l_int|0x10
comma
multiline_comment|/* DMA address of first Tx desc (C mode) */
multiline_comment|/* Tx and Rx status descriptors */
DECL|enumerator|DescOwn
id|DescOwn
op_assign
(paren
l_int|1
op_lshift
l_int|31
)paren
comma
multiline_comment|/* Descriptor is owned by NIC */
DECL|enumerator|RingEnd
id|RingEnd
op_assign
(paren
l_int|1
op_lshift
l_int|30
)paren
comma
multiline_comment|/* End of descriptor ring */
DECL|enumerator|FirstFrag
id|FirstFrag
op_assign
(paren
l_int|1
op_lshift
l_int|29
)paren
comma
multiline_comment|/* First segment of a packet */
DECL|enumerator|LastFrag
id|LastFrag
op_assign
(paren
l_int|1
op_lshift
l_int|28
)paren
comma
multiline_comment|/* Final segment of a packet */
DECL|enumerator|TxError
id|TxError
op_assign
(paren
l_int|1
op_lshift
l_int|23
)paren
comma
multiline_comment|/* Tx error summary */
DECL|enumerator|RxError
id|RxError
op_assign
(paren
l_int|1
op_lshift
l_int|20
)paren
comma
multiline_comment|/* Rx error summary */
DECL|enumerator|IPCS
id|IPCS
op_assign
(paren
l_int|1
op_lshift
l_int|18
)paren
comma
multiline_comment|/* Calculate IP checksum */
DECL|enumerator|UDPCS
id|UDPCS
op_assign
(paren
l_int|1
op_lshift
l_int|17
)paren
comma
multiline_comment|/* Calculate UDP/IP checksum */
DECL|enumerator|TCPCS
id|TCPCS
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
multiline_comment|/* Calculate TCP/IP checksum */
DECL|enumerator|TxVlanTag
id|TxVlanTag
op_assign
(paren
l_int|1
op_lshift
l_int|17
)paren
comma
multiline_comment|/* Add VLAN tag */
DECL|enumerator|RxVlanTagged
id|RxVlanTagged
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
multiline_comment|/* Rx VLAN tag available */
DECL|enumerator|IPFail
id|IPFail
op_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
multiline_comment|/* IP checksum failed */
DECL|enumerator|UDPFail
id|UDPFail
op_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
comma
multiline_comment|/* UDP/IP checksum failed */
DECL|enumerator|TCPFail
id|TCPFail
op_assign
(paren
l_int|1
op_lshift
l_int|13
)paren
comma
multiline_comment|/* TCP/IP checksum failed */
DECL|enumerator|NormalTxPoll
id|NormalTxPoll
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* One or more normal Tx packets to send */
DECL|enumerator|PID1
id|PID1
op_assign
(paren
l_int|1
op_lshift
l_int|17
)paren
comma
multiline_comment|/* 2 protocol id bits:  0==non-IP, */
DECL|enumerator|PID0
id|PID0
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
comma
multiline_comment|/* 1==UDP/IP, 2==TCP/IP, 3==IP */
DECL|enumerator|RxProtoTCP
id|RxProtoTCP
op_assign
l_int|2
comma
DECL|enumerator|RxProtoUDP
id|RxProtoUDP
op_assign
l_int|1
comma
DECL|enumerator|RxProtoIP
id|RxProtoIP
op_assign
l_int|3
comma
DECL|enumerator|TxFIFOUnder
id|TxFIFOUnder
op_assign
(paren
l_int|1
op_lshift
l_int|25
)paren
comma
multiline_comment|/* Tx FIFO underrun */
DECL|enumerator|TxOWC
id|TxOWC
op_assign
(paren
l_int|1
op_lshift
l_int|22
)paren
comma
multiline_comment|/* Tx Out-of-window collision */
DECL|enumerator|TxLinkFail
id|TxLinkFail
op_assign
(paren
l_int|1
op_lshift
l_int|21
)paren
comma
multiline_comment|/* Link failed during Tx of packet */
DECL|enumerator|TxMaxCol
id|TxMaxCol
op_assign
(paren
l_int|1
op_lshift
l_int|20
)paren
comma
multiline_comment|/* Tx aborted due to excessive collisions */
DECL|enumerator|TxColCntShift
id|TxColCntShift
op_assign
l_int|16
comma
multiline_comment|/* Shift, to get 4-bit Tx collision cnt */
DECL|enumerator|TxColCntMask
id|TxColCntMask
op_assign
l_int|0x01
op_or
l_int|0x02
op_or
l_int|0x04
op_or
l_int|0x08
comma
multiline_comment|/* 4-bit collision count */
DECL|enumerator|RxErrFrame
id|RxErrFrame
op_assign
(paren
l_int|1
op_lshift
l_int|27
)paren
comma
multiline_comment|/* Rx frame alignment error */
DECL|enumerator|RxMcast
id|RxMcast
op_assign
(paren
l_int|1
op_lshift
l_int|26
)paren
comma
multiline_comment|/* Rx multicast packet rcv&squot;d */
DECL|enumerator|RxErrCRC
id|RxErrCRC
op_assign
(paren
l_int|1
op_lshift
l_int|18
)paren
comma
multiline_comment|/* Rx CRC error */
DECL|enumerator|RxErrRunt
id|RxErrRunt
op_assign
(paren
l_int|1
op_lshift
l_int|19
)paren
comma
multiline_comment|/* Rx error, packet &lt; 64 bytes */
DECL|enumerator|RxErrLong
id|RxErrLong
op_assign
(paren
l_int|1
op_lshift
l_int|21
)paren
comma
multiline_comment|/* Rx error, packet &gt; 4096 bytes */
DECL|enumerator|RxErrFIFO
id|RxErrFIFO
op_assign
(paren
l_int|1
op_lshift
l_int|22
)paren
comma
multiline_comment|/* Rx error, FIFO overflowed, pkt bad */
multiline_comment|/* RxConfig register */
DECL|enumerator|RxCfgFIFOShift
id|RxCfgFIFOShift
op_assign
l_int|13
comma
multiline_comment|/* Shift, to get Rx FIFO thresh value */
DECL|enumerator|RxCfgDMAShift
id|RxCfgDMAShift
op_assign
l_int|8
comma
multiline_comment|/* Shift, to get Rx Max DMA value */
DECL|enumerator|AcceptErr
id|AcceptErr
op_assign
l_int|0x20
comma
multiline_comment|/* Accept packets with CRC errors */
DECL|enumerator|AcceptRunt
id|AcceptRunt
op_assign
l_int|0x10
comma
multiline_comment|/* Accept runt (&lt;64 bytes) packets */
DECL|enumerator|AcceptBroadcast
id|AcceptBroadcast
op_assign
l_int|0x08
comma
multiline_comment|/* Accept broadcast packets */
DECL|enumerator|AcceptMulticast
id|AcceptMulticast
op_assign
l_int|0x04
comma
multiline_comment|/* Accept multicast packets */
DECL|enumerator|AcceptMyPhys
id|AcceptMyPhys
op_assign
l_int|0x02
comma
multiline_comment|/* Accept pkts with our MAC as dest */
DECL|enumerator|AcceptAllPhys
id|AcceptAllPhys
op_assign
l_int|0x01
comma
multiline_comment|/* Accept all pkts w/ physical dest */
multiline_comment|/* IntrMask / IntrStatus registers */
DECL|enumerator|PciErr
id|PciErr
op_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
multiline_comment|/* System error on the PCI bus */
DECL|enumerator|TimerIntr
id|TimerIntr
op_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
comma
multiline_comment|/* Asserted when TCTR reaches TimerInt value */
DECL|enumerator|LenChg
id|LenChg
op_assign
(paren
l_int|1
op_lshift
l_int|13
)paren
comma
multiline_comment|/* Cable length change */
DECL|enumerator|SWInt
id|SWInt
op_assign
(paren
l_int|1
op_lshift
l_int|8
)paren
comma
multiline_comment|/* Software-requested interrupt */
DECL|enumerator|TxEmpty
id|TxEmpty
op_assign
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
multiline_comment|/* No Tx descriptors available */
DECL|enumerator|RxFIFOOvr
id|RxFIFOOvr
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* Rx FIFO Overflow */
DECL|enumerator|LinkChg
id|LinkChg
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
multiline_comment|/* Packet underrun, or link change */
DECL|enumerator|RxEmpty
id|RxEmpty
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
multiline_comment|/* No Rx descriptors available */
DECL|enumerator|TxErr
id|TxErr
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/* Tx error */
DECL|enumerator|TxOK
id|TxOK
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
multiline_comment|/* Tx packet sent */
DECL|enumerator|RxErr
id|RxErr
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* Rx error */
DECL|enumerator|RxOK
id|RxOK
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* Rx packet received */
DECL|enumerator|IntrResvd
id|IntrResvd
op_assign
(paren
l_int|1
op_lshift
l_int|10
)paren
comma
multiline_comment|/* reserved, according to RealTek engineers,&n;&t;&t;&t;&t;&t;but hardware likes to raise it */
DECL|enumerator|IntrAll
id|IntrAll
op_assign
id|PciErr
op_or
id|TimerIntr
op_or
id|LenChg
op_or
id|SWInt
op_or
id|TxEmpty
op_or
id|RxFIFOOvr
op_or
id|LinkChg
op_or
id|RxEmpty
op_or
id|TxErr
op_or
id|TxOK
op_or
id|RxErr
op_or
id|RxOK
op_or
id|IntrResvd
comma
multiline_comment|/* C mode command register */
DECL|enumerator|CmdReset
id|CmdReset
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
multiline_comment|/* Enable to reset; self-clearing */
DECL|enumerator|RxOn
id|RxOn
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/* Rx mode enable */
DECL|enumerator|TxOn
id|TxOn
op_assign
(paren
l_int|1
op_lshift
l_int|2
)paren
comma
multiline_comment|/* Tx mode enable */
multiline_comment|/* C+ mode command register */
DECL|enumerator|RxVlanOn
id|RxVlanOn
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* Rx VLAN de-tagging enable */
DECL|enumerator|RxChkSum
id|RxChkSum
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
multiline_comment|/* Rx checksum offload enable */
DECL|enumerator|PCIMulRW
id|PCIMulRW
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/* Enable PCI read/write multiple */
DECL|enumerator|CpRxOn
id|CpRxOn
op_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
comma
multiline_comment|/* Rx mode enable */
DECL|enumerator|CpTxOn
id|CpTxOn
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* Tx mode enable */
multiline_comment|/* Cfg9436 EEPROM control register */
DECL|enumerator|Cfg9346_Lock
id|Cfg9346_Lock
op_assign
l_int|0x00
comma
multiline_comment|/* Lock ConfigX/MII register access */
DECL|enumerator|Cfg9346_Unlock
id|Cfg9346_Unlock
op_assign
l_int|0xC0
comma
multiline_comment|/* Unlock ConfigX/MII register access */
multiline_comment|/* TxConfig register */
DECL|enumerator|IFG
id|IFG
op_assign
(paren
l_int|1
op_lshift
l_int|25
)paren
op_or
(paren
l_int|1
op_lshift
l_int|24
)paren
comma
multiline_comment|/* standard IEEE interframe gap */
DECL|enumerator|TxDMAShift
id|TxDMAShift
op_assign
l_int|8
comma
multiline_comment|/* DMA burst value (0-7) is shift this many bits */
multiline_comment|/* Early Tx Threshold register */
DECL|enumerator|TxThreshMask
id|TxThreshMask
op_assign
l_int|0x3f
comma
multiline_comment|/* Mask bits 5-0 */
DECL|enumerator|TxThreshMax
id|TxThreshMax
op_assign
l_int|2048
comma
multiline_comment|/* Max early Tx threshold */
multiline_comment|/* Config1 register */
DECL|enumerator|DriverLoaded
id|DriverLoaded
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
multiline_comment|/* Software marker, driver is loaded */
DECL|enumerator|PMEnable
id|PMEnable
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* Enable various PM features of chip */
multiline_comment|/* Config3 register */
DECL|enumerator|PARMEnable
id|PARMEnable
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
multiline_comment|/* Enable auto-loading of PHY parms */
multiline_comment|/* Config5 register */
DECL|enumerator|PMEStatus
id|PMEStatus
op_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
comma
multiline_comment|/* PME status can be reset by PCI RST# */
)brace
suffix:semicolon
DECL|variable|cp_intr_mask
r_static
r_const
r_int
r_int
id|cp_intr_mask
op_assign
id|PciErr
op_or
id|LinkChg
op_or
id|RxOK
op_or
id|RxErr
op_or
id|RxEmpty
op_or
id|RxFIFOOvr
op_or
id|TxOK
op_or
id|TxErr
op_or
id|TxEmpty
suffix:semicolon
DECL|variable|cp_rx_config
r_static
r_const
r_int
r_int
id|cp_rx_config
op_assign
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
DECL|struct|cp_desc
r_struct
id|cp_desc
(brace
DECL|member|opts1
id|u32
id|opts1
suffix:semicolon
DECL|member|opts2
id|u32
id|opts2
suffix:semicolon
DECL|member|addr_lo
id|u32
id|addr_lo
suffix:semicolon
DECL|member|addr_hi
id|u32
id|addr_hi
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ring_info
r_struct
id|ring_info
(brace
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|mapping
id|dma_addr_t
id|mapping
suffix:semicolon
DECL|member|frag
r_int
id|frag
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cp_extra_stats
r_struct
id|cp_extra_stats
(brace
DECL|member|rx_frags
r_int
r_int
id|rx_frags
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cp_private
r_struct
id|cp_private
(brace
DECL|member|tx_head
r_int
id|tx_head
suffix:semicolon
DECL|member|tx_tail
r_int
id|tx_tail
suffix:semicolon
DECL|member|rx_tail
r_int
id|rx_tail
suffix:semicolon
DECL|member|regs
r_void
op_star
id|regs
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|rx_ring
r_struct
id|cp_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring
r_struct
id|cp_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|tx_skb
r_struct
id|ring_info
id|tx_skb
(braket
id|CP_TX_RING_SIZE
)braket
suffix:semicolon
DECL|member|rx_skb
r_struct
id|ring_info
id|rx_skb
(braket
id|CP_RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|rx_buf_sz
r_int
id|rx_buf_sz
suffix:semicolon
DECL|member|ring_dma
id|dma_addr_t
id|ring_dma
suffix:semicolon
macro_line|#if CP_VLAN_TAG_USED
DECL|member|vlgrp
r_struct
id|vlan_group
op_star
id|vlgrp
suffix:semicolon
macro_line|#endif
DECL|member|msg_enable
id|u32
id|msg_enable
suffix:semicolon
DECL|member|net_stats
r_struct
id|net_device_stats
id|net_stats
suffix:semicolon
DECL|member|cp_stats
r_struct
id|cp_extra_stats
id|cp_stats
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|rx_config
id|u32
id|rx_config
suffix:semicolon
DECL|member|frag_skb
r_struct
id|sk_buff
op_star
id|frag_skb
suffix:semicolon
DECL|member|dropping_frag
r_int
id|dropping_frag
suffix:colon
l_int|1
suffix:semicolon
DECL|member|mii_if
r_struct
id|mii_if_info
id|mii_if
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|cpr8
mdefine_line|#define cpr8(reg)&t;readb(cp-&gt;regs + (reg))
DECL|macro|cpr16
mdefine_line|#define cpr16(reg)&t;readw(cp-&gt;regs + (reg))
DECL|macro|cpr32
mdefine_line|#define cpr32(reg)&t;readl(cp-&gt;regs + (reg))
DECL|macro|cpw8
mdefine_line|#define cpw8(reg,val)&t;writeb((val), cp-&gt;regs + (reg))
DECL|macro|cpw16
mdefine_line|#define cpw16(reg,val)&t;writew((val), cp-&gt;regs + (reg))
DECL|macro|cpw32
mdefine_line|#define cpw32(reg,val)&t;writel((val), cp-&gt;regs + (reg))
DECL|macro|cpw8_f
mdefine_line|#define cpw8_f(reg,val) do {&t;&t;&t;&bslash;&n;&t;writeb((val), cp-&gt;regs + (reg));&t;&bslash;&n;&t;readb(cp-&gt;regs + (reg));&t;&t;&bslash;&n;&t;} while (0)
DECL|macro|cpw16_f
mdefine_line|#define cpw16_f(reg,val) do {&t;&t;&t;&bslash;&n;&t;writew((val), cp-&gt;regs + (reg));&t;&bslash;&n;&t;readw(cp-&gt;regs + (reg));&t;&t;&bslash;&n;&t;} while (0)
DECL|macro|cpw32_f
mdefine_line|#define cpw32_f(reg,val) do {&t;&t;&t;&bslash;&n;&t;writel((val), cp-&gt;regs + (reg));&t;&bslash;&n;&t;readl(cp-&gt;regs + (reg));&t;&t;&bslash;&n;&t;} while (0)
r_static
r_void
id|__cp_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|cp_tx
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
suffix:semicolon
r_static
r_void
id|cp_clean_rings
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|cp_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_REALTEK
comma
id|PCI_DEVICE_ID_REALTEK_8139
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|cp_pci_tbl
)paren
suffix:semicolon
DECL|function|cp_set_rxbufsize
r_static
r_inline
r_void
id|cp_set_rxbufsize
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
r_int
id|mtu
op_assign
id|cp-&gt;dev-&gt;mtu
suffix:semicolon
r_if
c_cond
(paren
id|mtu
OG
id|ETH_DATA_LEN
)paren
multiline_comment|/* MTU + ethernet header + FCS + optional VLAN tag */
id|cp-&gt;rx_buf_sz
op_assign
id|mtu
op_plus
id|ETH_HLEN
op_plus
l_int|8
suffix:semicolon
r_else
id|cp-&gt;rx_buf_sz
op_assign
id|PKT_BUF_SZ
suffix:semicolon
)brace
DECL|function|cp_rx_skb
r_static
r_inline
r_void
id|cp_rx_skb
(paren
r_struct
id|cp_private
op_star
id|cp
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|cp_desc
op_star
id|desc
)paren
(brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
(paren
id|skb
comma
id|cp-&gt;dev
)paren
suffix:semicolon
id|cp-&gt;net_stats.rx_packets
op_increment
suffix:semicolon
id|cp-&gt;net_stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|cp-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
macro_line|#if CP_VLAN_TAG_USED
r_if
c_cond
(paren
id|cp-&gt;vlgrp
op_logical_and
(paren
id|desc-&gt;opts2
op_amp
id|RxVlanTagged
)paren
)paren
(brace
id|vlan_hwaccel_rx
c_func
(paren
id|skb
comma
id|cp-&gt;vlgrp
comma
id|desc-&gt;opts2
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
DECL|function|cp_rx_err_acct
r_static
r_void
id|cp_rx_err_acct
(paren
r_struct
id|cp_private
op_star
id|cp
comma
r_int
id|rx_tail
comma
id|u32
id|status
comma
id|u32
id|len
)paren
(brace
r_if
c_cond
(paren
id|netif_msg_rx_err
(paren
id|cp
)paren
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx err, slot %d status 0x%x len %d&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
id|cp-&gt;net_stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrFrame
)paren
id|cp-&gt;net_stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrCRC
)paren
id|cp-&gt;net_stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrRunt
)paren
id|cp-&gt;net_stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrLong
)paren
id|cp-&gt;net_stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxErrFIFO
)paren
id|cp-&gt;net_stats.rx_fifo_errors
op_increment
suffix:semicolon
)brace
DECL|function|cp_rx_frag
r_static
r_void
id|cp_rx_frag
(paren
r_struct
id|cp_private
op_star
id|cp
comma
r_int
id|rx_tail
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|status
comma
id|u32
id|len
)paren
(brace
r_struct
id|sk_buff
op_star
id|copy_skb
comma
op_star
id|frag_skb
op_assign
id|cp-&gt;frag_skb
suffix:semicolon
r_int
id|orig_len
op_assign
id|frag_skb
ques
c_cond
id|frag_skb-&gt;len
suffix:colon
l_int|0
suffix:semicolon
r_int
id|target_len
op_assign
id|orig_len
op_plus
id|len
suffix:semicolon
r_int
id|first_frag
op_assign
id|status
op_amp
id|FirstFrag
suffix:semicolon
r_int
id|last_frag
op_assign
id|status
op_amp
id|LastFrag
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_rx_status
(paren
id|cp
)paren
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx %s%sfrag, slot %d status 0x%x len %d&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|cp-&gt;dropping_frag
ques
c_cond
l_string|&quot;dropping &quot;
suffix:colon
l_string|&quot;&quot;
comma
id|first_frag
ques
c_cond
l_string|&quot;first &quot;
suffix:colon
id|last_frag
ques
c_cond
l_string|&quot;last &quot;
suffix:colon
l_string|&quot;&quot;
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
id|cp-&gt;cp_stats.rx_frags
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|frag_skb
op_logical_and
op_logical_neg
id|first_frag
)paren
id|cp-&gt;dropping_frag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;dropping_frag
)paren
r_goto
id|drop_frag
suffix:semicolon
id|copy_skb
op_assign
id|dev_alloc_skb
(paren
id|target_len
op_plus
id|RX_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|copy_skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: rx slot %d alloc failed&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|rx_tail
)paren
suffix:semicolon
id|cp-&gt;dropping_frag
op_assign
l_int|1
suffix:semicolon
id|drop_frag
suffix:colon
r_if
c_cond
(paren
id|frag_skb
)paren
(brace
id|dev_kfree_skb_irq
c_func
(paren
id|frag_skb
)paren
suffix:semicolon
id|cp-&gt;frag_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|last_frag
)paren
(brace
id|cp-&gt;net_stats.rx_dropped
op_increment
suffix:semicolon
id|cp-&gt;dropping_frag
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|copy_skb-&gt;dev
op_assign
id|cp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|copy_skb
comma
id|RX_OFFSET
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|copy_skb
comma
id|target_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frag_skb
)paren
(brace
id|memcpy
c_func
(paren
id|copy_skb-&gt;data
comma
id|frag_skb-&gt;data
comma
id|orig_len
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|frag_skb
)paren
suffix:semicolon
)brace
id|pci_dma_sync_single
c_func
(paren
id|cp-&gt;pdev
comma
id|cp-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|mapping
comma
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|copy_skb-&gt;data
op_plus
id|orig_len
comma
id|skb-&gt;data
comma
id|len
)paren
suffix:semicolon
id|copy_skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
r_if
c_cond
(paren
id|last_frag
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxError
op_or
id|RxErrFIFO
)paren
)paren
(brace
id|cp_rx_err_acct
c_func
(paren
id|cp
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|copy_skb
)paren
suffix:semicolon
)brace
r_else
id|cp_rx_skb
c_func
(paren
id|cp
comma
id|copy_skb
comma
op_amp
id|cp-&gt;rx_ring
(braket
id|rx_tail
)braket
)paren
suffix:semicolon
id|cp-&gt;frag_skb
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|cp-&gt;frag_skb
op_assign
id|copy_skb
suffix:semicolon
)brace
)brace
DECL|function|cp_rx_csum_ok
r_static
r_inline
r_int
r_int
id|cp_rx_csum_ok
(paren
id|u32
id|status
)paren
(brace
r_int
r_int
id|protocol
op_assign
(paren
id|status
op_rshift
l_int|16
)paren
op_amp
l_int|0x3
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
(paren
id|protocol
op_eq
id|RxProtoTCP
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|status
op_amp
id|TCPFail
)paren
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|protocol
op_eq
id|RxProtoUDP
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|status
op_amp
id|UDPFail
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|protocol
op_eq
id|RxProtoIP
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|status
op_amp
id|IPFail
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cp_rx
r_static
r_void
id|cp_rx
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
id|rx_tail
op_assign
id|cp-&gt;rx_tail
suffix:semicolon
r_int
id|rx_work
op_assign
l_int|100
suffix:semicolon
r_while
c_loop
(paren
id|rx_work
op_decrement
)paren
(brace
id|u32
id|status
comma
id|len
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|new_skb
suffix:semicolon
r_struct
id|cp_desc
op_star
id|desc
suffix:semicolon
r_int
id|buflen
suffix:semicolon
id|skb
op_assign
id|cp-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|desc
op_assign
op_amp
id|cp-&gt;rx_ring
(braket
id|rx_tail
)braket
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|desc-&gt;opts1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DescOwn
)paren
r_break
suffix:semicolon
id|len
op_assign
(paren
id|status
op_amp
l_int|0x1fff
)paren
op_minus
l_int|4
suffix:semicolon
id|mapping
op_assign
id|cp-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|mapping
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|FirstFrag
op_or
id|LastFrag
)paren
)paren
op_ne
(paren
id|FirstFrag
op_or
id|LastFrag
)paren
)paren
(brace
id|cp_rx_frag
c_func
(paren
id|cp
comma
id|rx_tail
comma
id|skb
comma
id|status
comma
id|len
)paren
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxError
op_or
id|RxErrFIFO
)paren
)paren
(brace
id|cp_rx_err_acct
c_func
(paren
id|cp
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netif_msg_rx_status
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx slot %d status 0x%x len %d&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|rx_tail
comma
id|status
comma
id|len
)paren
suffix:semicolon
id|buflen
op_assign
id|cp-&gt;rx_buf_sz
op_plus
id|RX_OFFSET
suffix:semicolon
id|new_skb
op_assign
id|dev_alloc_skb
(paren
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_skb
)paren
(brace
id|cp-&gt;net_stats.rx_dropped
op_increment
suffix:semicolon
r_goto
id|rx_next
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|new_skb
comma
id|RX_OFFSET
)paren
suffix:semicolon
id|new_skb-&gt;dev
op_assign
id|cp-&gt;dev
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|cp-&gt;pdev
comma
id|mapping
comma
id|buflen
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* Handle checksum offloading for incoming packets. */
r_if
c_cond
(paren
id|cp_rx_csum_ok
c_func
(paren
id|status
)paren
)paren
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
r_else
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|mapping
op_assign
id|cp-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|cp-&gt;pdev
comma
id|new_skb-&gt;tail
comma
id|buflen
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cp-&gt;rx_skb
(braket
id|rx_tail
)braket
dot
id|skb
op_assign
id|new_skb
suffix:semicolon
id|cp_rx_skb
c_func
(paren
id|cp
comma
id|skb
comma
id|desc
)paren
suffix:semicolon
id|rx_next
suffix:colon
r_if
c_cond
(paren
id|rx_tail
op_eq
(paren
id|CP_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|desc-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
op_or
id|RingEnd
op_or
id|cp-&gt;rx_buf_sz
)paren
suffix:semicolon
r_else
id|desc-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
op_or
id|cp-&gt;rx_buf_sz
)paren
suffix:semicolon
id|cp-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|opts2
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;rx_ring
(braket
id|rx_tail
)braket
dot
id|addr_lo
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|rx_tail
op_assign
id|NEXT_RX
c_func
(paren
id|rx_tail
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rx_work
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: rx work limit reached&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
)paren
suffix:semicolon
id|cp-&gt;rx_tail
op_assign
id|rx_tail
suffix:semicolon
)brace
DECL|function|cp_interrupt
r_static
r_void
id|cp_interrupt
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_instance
suffix:semicolon
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|status
op_assign
id|cpr16
c_func
(paren
id|IntrStatus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
op_logical_or
(paren
id|status
op_eq
l_int|0xFFFF
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_intr
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: intr, status %04x cmd %02x cpcmd %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|cpr8
c_func
(paren
id|Cmd
)paren
comma
id|cpr16
c_func
(paren
id|CpCmd
)paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxOK
op_or
id|RxErr
op_or
id|RxEmpty
op_or
id|RxFIFOOvr
)paren
)paren
id|cp_rx
c_func
(paren
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxOK
op_or
id|TxErr
op_or
id|TxEmpty
op_or
id|SWInt
)paren
)paren
id|cp_tx
c_func
(paren
id|cp
)paren
suffix:semicolon
id|cpw16_f
c_func
(paren
id|IntrStatus
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PciErr
)paren
(brace
id|u16
id|pci_status
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|cp-&gt;pdev
comma
id|PCI_STATUS
comma
op_amp
id|pci_status
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|cp-&gt;pdev
comma
id|PCI_STATUS
comma
id|pci_status
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: PCI bus error, status=%04x, PCI status=%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|pci_status
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|cp_tx
r_static
r_void
id|cp_tx
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
id|tx_head
op_assign
id|cp-&gt;tx_head
suffix:semicolon
r_int
id|tx_tail
op_assign
id|cp-&gt;tx_tail
suffix:semicolon
r_while
c_loop
(paren
id|tx_tail
op_ne
id|tx_head
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|cp-&gt;tx_ring
(braket
id|tx_tail
)braket
dot
id|opts1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|DescOwn
)paren
r_break
suffix:semicolon
id|skb
op_assign
id|cp-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|cp-&gt;pdev
comma
id|cp-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|LastFrag
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxError
op_or
id|TxFIFOUnder
)paren
)paren
(brace
r_if
c_cond
(paren
id|netif_msg_tx_err
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx err, status 0x%x&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|cp-&gt;net_stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxOWC
)paren
id|cp-&gt;net_stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxMaxCol
)paren
id|cp-&gt;net_stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxLinkFail
)paren
id|cp-&gt;net_stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TxFIFOUnder
)paren
id|cp-&gt;net_stats.tx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|cp-&gt;net_stats.collisions
op_add_assign
(paren
(paren
id|status
op_rshift
id|TxColCntShift
)paren
op_amp
id|TxColCntMask
)paren
suffix:semicolon
id|cp-&gt;net_stats.tx_packets
op_increment
suffix:semicolon
id|cp-&gt;net_stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_tx_done
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx done, slot %d&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
comma
id|tx_tail
)paren
suffix:semicolon
)brace
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|cp-&gt;tx_skb
(braket
id|tx_tail
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tx_tail
op_assign
id|NEXT_TX
c_func
(paren
id|tx_tail
)paren
suffix:semicolon
)brace
id|cp-&gt;tx_tail
op_assign
id|tx_tail
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|cp-&gt;dev
)paren
op_logical_and
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|cp
)paren
OG
(paren
id|MAX_SKB_FRAGS
op_plus
l_int|1
)paren
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|cp-&gt;dev
)paren
suffix:semicolon
)brace
DECL|function|cp_start_xmit
r_static
r_int
id|cp_start_xmit
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|u32
id|eor
suffix:semicolon
macro_line|#if CP_VLAN_TAG_USED
id|u32
id|vlan_tag
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* This is a hard error, log it. */
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|cp
)paren
op_le
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_plus
l_int|1
)paren
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: BUG! Tx Ring full when queue awake!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#if CP_VLAN_TAG_USED
r_if
c_cond
(paren
id|cp-&gt;vlgrp
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
id|vlan_tag
op_assign
id|TxVlanTag
op_or
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
id|entry
op_assign
id|cp-&gt;tx_head
suffix:semicolon
id|eor
op_assign
(paren
id|entry
op_eq
(paren
id|CP_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
ques
c_cond
id|RingEnd
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_eq
l_int|0
)paren
(brace
r_struct
id|cp_desc
op_star
id|txd
op_assign
op_amp
id|cp-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|u32
id|mapping
comma
id|len
suffix:semicolon
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|cp-&gt;pdev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|eor
op_assign
(paren
id|entry
op_eq
(paren
id|CP_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
ques
c_cond
id|RingEnd
suffix:colon
l_int|0
suffix:semicolon
id|CP_VLAN_TX_TAG
c_func
(paren
id|txd
comma
id|vlan_tag
)paren
suffix:semicolon
id|txd-&gt;addr_lo
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CP_TX_CHECKSUM
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|eor
op_or
id|len
op_or
id|DescOwn
op_or
id|FirstFrag
op_or
id|LastFrag
op_or
id|IPCS
op_or
id|UDPCS
op_or
id|TCPCS
)paren
suffix:semicolon
macro_line|#else
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|eor
op_or
id|len
op_or
id|DescOwn
op_or
id|FirstFrag
op_or
id|LastFrag
)paren
suffix:semicolon
macro_line|#endif
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|frag
op_assign
l_int|0
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|cp_desc
op_star
id|txd
suffix:semicolon
id|u32
id|first_len
comma
id|first_mapping
suffix:semicolon
r_int
id|frag
comma
id|first_entry
op_assign
id|entry
suffix:semicolon
multiline_comment|/* We must give this initial chunk to the device last.&n;&t;&t; * Otherwise we could race with the device.&n;&t;&t; */
id|first_len
op_assign
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
suffix:semicolon
id|first_mapping
op_assign
id|pci_map_single
c_func
(paren
id|cp-&gt;pdev
comma
id|skb-&gt;data
comma
id|first_len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|first_mapping
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|frag
op_assign
l_int|1
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
r_for
c_loop
(paren
id|frag
op_assign
l_int|0
suffix:semicolon
id|frag
OL
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|frag
op_increment
)paren
(brace
id|skb_frag_t
op_star
id|this_frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|frag
)braket
suffix:semicolon
id|u32
id|len
comma
id|mapping
suffix:semicolon
id|u32
id|ctrl
suffix:semicolon
id|len
op_assign
id|this_frag-&gt;size
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|cp-&gt;pdev
comma
(paren
(paren
r_void
op_star
)paren
id|page_address
c_func
(paren
id|this_frag-&gt;page
)paren
op_plus
id|this_frag-&gt;page_offset
)paren
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|eor
op_assign
(paren
id|entry
op_eq
(paren
id|CP_TX_RING_SIZE
op_minus
l_int|1
)paren
)paren
ques
c_cond
id|RingEnd
suffix:colon
l_int|0
suffix:semicolon
macro_line|#ifdef CP_TX_CHECKSUM
id|ctrl
op_assign
id|eor
op_or
id|len
op_or
id|DescOwn
op_or
id|IPCS
op_or
id|UDPCS
op_or
id|TCPCS
suffix:semicolon
macro_line|#else
id|ctrl
op_assign
id|eor
op_or
id|len
op_or
id|DescOwn
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|frag
op_eq
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
op_minus
l_int|1
)paren
id|ctrl
op_or_assign
id|LastFrag
suffix:semicolon
id|txd
op_assign
op_amp
id|cp-&gt;tx_ring
(braket
id|entry
)braket
suffix:semicolon
id|CP_VLAN_TX_TAG
c_func
(paren
id|txd
comma
id|vlan_tag
)paren
suffix:semicolon
id|txd-&gt;addr_lo
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|ctrl
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|cp-&gt;tx_skb
(braket
id|entry
)braket
dot
id|frag
op_assign
id|frag
op_plus
l_int|2
suffix:semicolon
id|entry
op_assign
id|NEXT_TX
c_func
(paren
id|entry
)paren
suffix:semicolon
)brace
id|txd
op_assign
op_amp
id|cp-&gt;tx_ring
(braket
id|first_entry
)braket
suffix:semicolon
id|CP_VLAN_TX_TAG
c_func
(paren
id|txd
comma
id|vlan_tag
)paren
suffix:semicolon
id|txd-&gt;addr_lo
op_assign
id|cpu_to_le32
c_func
(paren
id|first_mapping
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CP_TX_CHECKSUM
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|first_len
op_or
id|FirstFrag
op_or
id|DescOwn
op_or
id|IPCS
op_or
id|UDPCS
op_or
id|TCPCS
)paren
suffix:semicolon
macro_line|#else
id|txd-&gt;opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|first_len
op_or
id|FirstFrag
op_or
id|DescOwn
)paren
suffix:semicolon
macro_line|#endif
id|wmb
c_func
(paren
)paren
suffix:semicolon
)brace
id|cp-&gt;tx_head
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_tx_queued
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx queued, slot %d, skblen %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|entry
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TX_BUFFS_AVAIL
c_func
(paren
id|cp
)paren
op_le
(paren
id|MAX_SKB_FRAGS
op_plus
l_int|1
)paren
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|TxPoll
comma
id|NormalTxPoll
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   This routine is not state sensitive and need not be SMP locked. */
DECL|function|__cp_set_rx_mode
r_static
r_void
id|__cp_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|i
comma
id|rx_mode
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
multiline_comment|/* Note: do not reorder, GCC is clever about common statements. */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Unconditionally log net taps. */
id|printk
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
op_or
id|AcceptAllPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|bit_nr
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
suffix:semicolon
id|mc_filter
(braket
id|bit_nr
op_rshift
l_int|5
)braket
op_or_assign
id|cpu_to_le32
c_func
(paren
l_int|1
op_lshift
(paren
id|bit_nr
op_amp
l_int|31
)paren
)paren
suffix:semicolon
id|rx_mode
op_or_assign
id|AcceptMulticast
suffix:semicolon
)brace
)brace
multiline_comment|/* We can safely update without stopping the chip. */
id|tmp
op_assign
id|cp_rx_config
op_or
id|rx_mode
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;rx_config
op_ne
id|tmp
)paren
(brace
id|cpw32_f
(paren
id|RxConfig
comma
id|tmp
)paren
suffix:semicolon
id|cp-&gt;rx_config
op_assign
id|tmp
suffix:semicolon
)brace
id|cpw32_f
(paren
id|MAR0
op_plus
l_int|0
comma
id|mc_filter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|cpw32_f
(paren
id|MAR0
op_plus
l_int|4
comma
id|mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|function|cp_set_rx_mode
r_static
r_void
id|cp_set_rx_mode
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|cp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|__cp_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|cp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|__cp_get_stats
r_static
r_void
id|__cp_get_stats
c_func
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
multiline_comment|/* XXX implement */
)brace
DECL|function|cp_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|cp_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* The chip only need report frame silently dropped. */
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
op_logical_and
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
id|__cp_get_stats
c_func
(paren
id|cp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_return
op_amp
id|cp-&gt;net_stats
suffix:semicolon
)brace
DECL|function|cp_stop_hw
r_static
r_void
id|cp_stop_hw
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
id|cpw16
c_func
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
id|cpr16
c_func
(paren
id|IntrMask
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|Cmd
comma
l_int|0
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|CpCmd
comma
l_int|0
)paren
suffix:semicolon
id|cpr16
c_func
(paren
id|CpCmd
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|IntrStatus
comma
op_complement
(paren
id|cpr16
c_func
(paren
id|IntrStatus
)paren
)paren
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cp-&gt;rx_tail
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;tx_head
op_assign
id|cp-&gt;tx_tail
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|cp_reset_hw
r_static
r_void
id|cp_reset_hw
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
id|work
op_assign
l_int|1000
suffix:semicolon
id|cpw8
c_func
(paren
id|Cmd
comma
id|CmdReset
)paren
suffix:semicolon
r_while
c_loop
(paren
id|work
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpr8
c_func
(paren
id|Cmd
)paren
op_amp
id|CmdReset
)paren
)paren
r_return
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: hardware reset timeout&bslash;n&quot;
comma
id|cp-&gt;dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|cp_start_hw
r_static
r_inline
r_void
id|cp_start_hw
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
id|cpw8
c_func
(paren
id|Cmd
comma
id|RxOn
op_or
id|TxOn
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|CpCmd
comma
id|PCIMulRW
op_or
id|RxChkSum
op_or
id|CpRxOn
op_or
id|CpTxOn
)paren
suffix:semicolon
)brace
DECL|function|cp_init_hw
r_static
r_void
id|cp_init_hw
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|cp-&gt;dev
suffix:semicolon
id|cp_reset_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|cpw8_f
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
multiline_comment|/* Restore our idea of the MAC address. */
id|cpw32_f
(paren
id|MAC0
op_plus
l_int|0
comma
id|cpu_to_le32
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|cpw32_f
(paren
id|MAC0
op_plus
l_int|4
comma
id|cpu_to_le32
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|cp_start_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|TxThresh
comma
l_int|0x06
)paren
suffix:semicolon
multiline_comment|/* XXX convert magic num to a constant */
id|__cp_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|cpw32_f
(paren
id|TxConfig
comma
id|IFG
op_or
(paren
id|TX_DMA_BURST
op_lshift
id|TxDMAShift
)paren
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|Config1
comma
id|cpr8
c_func
(paren
id|Config1
)paren
op_or
id|DriverLoaded
op_or
id|PMEnable
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|Config3
comma
id|PARMEnable
)paren
suffix:semicolon
multiline_comment|/* disables magic packet and WOL */
id|cpw8
c_func
(paren
id|Config5
comma
id|cpr8
c_func
(paren
id|Config5
)paren
op_amp
id|PMEStatus
)paren
suffix:semicolon
multiline_comment|/* disables more WOL stuff */
id|cpw32_f
c_func
(paren
id|HiTxRingAddr
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|HiTxRingAddr
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|OldRxBufAddr
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|OldTSD0
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|OldTSD0
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|OldTSD0
op_plus
l_int|8
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|OldTSD0
op_plus
l_int|12
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|RxRingAddr
comma
id|cp-&gt;ring_dma
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|RxRingAddr
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|TxRingAddr
comma
id|cp-&gt;ring_dma
op_plus
(paren
r_sizeof
(paren
r_struct
id|cp_desc
)paren
op_star
id|CP_RX_RING_SIZE
)paren
)paren
suffix:semicolon
id|cpw32_f
c_func
(paren
id|TxRingAddr
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|MultiIntr
comma
l_int|0
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|IntrMask
comma
id|cp_intr_mask
)paren
suffix:semicolon
id|cpw8_f
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
)brace
DECL|function|cp_refill_rx
r_static
r_int
id|cp_refill_rx
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CP_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|cp-&gt;rx_buf_sz
op_plus
id|RX_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|err_out
suffix:semicolon
id|skb-&gt;dev
op_assign
id|cp-&gt;dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|RX_OFFSET
)paren
suffix:semicolon
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|cp-&gt;pdev
comma
id|skb-&gt;tail
comma
id|cp-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|frag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
(paren
id|CP_RX_RING_SIZE
op_minus
l_int|1
)paren
)paren
id|cp-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
op_or
id|RingEnd
op_or
id|cp-&gt;rx_buf_sz
)paren
suffix:semicolon
r_else
id|cp-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwn
op_or
id|cp-&gt;rx_buf_sz
)paren
suffix:semicolon
id|cp-&gt;rx_ring
(braket
id|i
)braket
dot
id|opts2
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr_lo
op_assign
id|cpu_to_le32
c_func
(paren
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
)paren
suffix:semicolon
id|cp-&gt;rx_ring
(braket
id|i
)braket
dot
id|addr_hi
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|cp_clean_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|cp_init_rings
r_static
r_int
id|cp_init_rings
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
id|memset
c_func
(paren
id|cp-&gt;tx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cp_desc
)paren
op_star
id|CP_TX_RING_SIZE
)paren
suffix:semicolon
id|cp-&gt;tx_ring
(braket
id|CP_TX_RING_SIZE
op_minus
l_int|1
)braket
dot
id|opts1
op_assign
id|cpu_to_le32
c_func
(paren
id|RingEnd
)paren
suffix:semicolon
id|cp-&gt;rx_tail
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;tx_head
op_assign
id|cp-&gt;tx_tail
op_assign
l_int|0
suffix:semicolon
r_return
id|cp_refill_rx
(paren
id|cp
)paren
suffix:semicolon
)brace
DECL|function|cp_alloc_rings
r_static
r_int
id|cp_alloc_rings
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
id|cp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|cp-&gt;pdev
comma
id|CP_RING_BYTES
comma
op_amp
id|cp-&gt;ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp-&gt;rx_ring
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|cp-&gt;tx_ring
op_assign
op_amp
id|cp-&gt;rx_ring
(braket
id|CP_RX_RING_SIZE
)braket
suffix:semicolon
r_return
id|cp_init_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
)brace
DECL|function|cp_clean_rings
r_static
r_void
id|cp_clean_rings
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|cp-&gt;rx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cp_desc
)paren
op_star
id|CP_RX_RING_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
id|cp-&gt;tx_ring
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cp_desc
)paren
op_star
id|CP_TX_RING_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CP_RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|cp-&gt;pdev
comma
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|mapping
comma
id|cp-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|cp-&gt;rx_skb
(braket
id|i
)braket
dot
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CP_TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cp-&gt;tx_skb
(braket
id|i
)braket
dot
id|skb
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|cp-&gt;tx_skb
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|cp-&gt;pdev
comma
id|cp-&gt;tx_skb
(braket
id|i
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|cp-&gt;net_stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
id|memset
c_func
(paren
op_amp
id|cp-&gt;rx_skb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
id|CP_RX_RING_SIZE
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp-&gt;tx_skb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ring_info
)paren
op_star
id|CP_TX_RING_SIZE
)paren
suffix:semicolon
)brace
DECL|function|cp_free_rings
r_static
r_void
id|cp_free_rings
(paren
r_struct
id|cp_private
op_star
id|cp
)paren
(brace
id|cp_clean_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|cp-&gt;pdev
comma
id|CP_RING_BYTES
comma
id|cp-&gt;rx_ring
comma
id|cp-&gt;ring_dma
)paren
suffix:semicolon
id|cp-&gt;rx_ring
op_assign
l_int|NULL
suffix:semicolon
id|cp-&gt;tx_ring
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|cp_open
r_static
r_int
id|cp_open
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_ifup
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: enabling interface&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
id|cp_alloc_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|cp_init_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|rc
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|cp_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_hw
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_hw
suffix:colon
id|cp_stop_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|cp_free_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|cp_close
r_static
r_int
id|cp_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|netif_msg_ifdown
c_func
(paren
id|cp
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: disabling interface&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|cp_stop_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|cp_free_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cp_change_mtu
r_static
r_int
id|cp_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
multiline_comment|/* check for invalid MTU, according to hardware limits */
r_if
c_cond
(paren
id|new_mtu
template_param
id|CP_MAX_MTU
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* if network interface not up, no need for complexity */
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|cp_set_rxbufsize
c_func
(paren
id|cp
)paren
suffix:semicolon
multiline_comment|/* set new rx buf size */
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|cp_stop_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
multiline_comment|/* stop h/w and free rings */
id|cp_clean_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|cp_set_rxbufsize
c_func
(paren
id|cp
)paren
suffix:semicolon
multiline_comment|/* set new rx buf size */
id|rc
op_assign
id|cp_init_rings
c_func
(paren
id|cp
)paren
suffix:semicolon
multiline_comment|/* realloc and restart h/w */
id|cp_start_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|mii_2_8139_map
r_static
r_char
id|mii_2_8139_map
(braket
l_int|8
)braket
op_assign
(brace
id|BasicModeCtrl
comma
id|BasicModeStatus
comma
l_int|0
comma
l_int|0
comma
id|NWayAdvert
comma
id|NWayLPAR
comma
id|NWayExpansion
comma
l_int|0
)brace
suffix:semicolon
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
id|location
OL
l_int|8
op_logical_and
id|mii_2_8139_map
(braket
id|location
)braket
ques
c_cond
id|readw
c_func
(paren
id|cp-&gt;regs
op_plus
id|mii_2_8139_map
(braket
id|location
)braket
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|location
op_eq
l_int|0
)paren
(brace
id|cpw8
c_func
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|BasicModeCtrl
comma
id|value
)paren
suffix:semicolon
id|cpw8
c_func
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|location
OL
l_int|8
op_logical_and
id|mii_2_8139_map
(braket
id|location
)braket
)paren
id|cpw16
c_func
(paren
id|mii_2_8139_map
(braket
id|location
)braket
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|cp_ethtool_ioctl
r_static
r_int
id|cp_ethtool_ioctl
(paren
r_struct
id|cp_private
op_star
id|cp
comma
r_void
op_star
id|useraddr
)paren
(brace
id|u32
id|ethcmd
suffix:semicolon
multiline_comment|/* dev_ioctl() in ../../net/core/dev.c has already checked&n;&t;   capable(CAP_NET_ADMIN), so don&squot;t bother with that here.  */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|ethcmd
comma
(paren
id|u32
op_star
)paren
id|useraddr
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
(paren
id|info.driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info.version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|strcpy
(paren
id|info.bus_info
comma
id|cp-&gt;pdev-&gt;slot_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get settings */
r_case
id|ETHTOOL_GSET
suffix:colon
(brace
r_struct
id|ethtool_cmd
id|ecmd
op_assign
(brace
id|ETHTOOL_GSET
)brace
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|mii_ethtool_gset
c_func
(paren
op_amp
id|cp-&gt;mii_if
comma
op_amp
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ecmd
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set settings */
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
r_int
id|r
suffix:semicolon
r_struct
id|ethtool_cmd
id|ecmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ecmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|r
op_assign
id|mii_ethtool_sset
c_func
(paren
op_amp
id|cp-&gt;mii_if
comma
op_amp
id|ecmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* restart autonegotiation */
r_case
id|ETHTOOL_NWAY_RST
suffix:colon
(brace
r_return
id|mii_nway_restart
c_func
(paren
op_amp
id|cp-&gt;mii_if
)paren
suffix:semicolon
)brace
multiline_comment|/* get link status */
r_case
id|ETHTOOL_GLINK
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GLINK
)brace
suffix:semicolon
id|edata.data
op_assign
id|mii_link_ok
c_func
(paren
op_amp
id|cp-&gt;mii_if
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get message-level */
r_case
id|ETHTOOL_GMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
op_assign
(brace
id|ETHTOOL_GMSGLVL
)brace
suffix:semicolon
id|edata.data
op_assign
id|cp-&gt;msg_enable
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|edata
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set message-level */
r_case
id|ETHTOOL_SMSGLVL
suffix:colon
(brace
r_struct
id|ethtool_value
id|edata
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|edata
comma
id|useraddr
comma
r_sizeof
(paren
id|edata
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|cp-&gt;msg_enable
op_assign
id|edata.data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|cp_ioctl
r_static
r_int
id|cp_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|cp_ethtool_ioctl
c_func
(paren
id|cp
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
macro_line|#if CP_VLAN_TAG_USED
DECL|function|cp_vlan_rx_register
r_static
r_void
id|cp_vlan_rx_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|vlan_group
op_star
id|grp
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|cp-&gt;vlgrp
op_assign
id|grp
suffix:semicolon
id|cpw16
c_func
(paren
id|CpCmd
comma
id|cpr16
c_func
(paren
id|CpCmd
)paren
op_or
id|RxVlanOn
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|cp_vlan_rx_kill_vid
r_static
r_void
id|cp_vlan_rx_kill_vid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|cpw16
c_func
(paren
id|CpCmd
comma
id|cpr16
c_func
(paren
id|CpCmd
)paren
op_amp
op_complement
id|RxVlanOn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;vlgrp
)paren
id|cp-&gt;vlgrp-&gt;vlan_devices
(braket
id|vid
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Serial EEPROM section. */
multiline_comment|/*  EEPROM_Ctrl bits. */
DECL|macro|EE_SHIFT_CLK
mdefine_line|#define EE_SHIFT_CLK&t;0x04&t;/* EEPROM shift clock. */
DECL|macro|EE_CS
mdefine_line|#define EE_CS&t;&t;&t;0x08&t;/* EEPROM chip select. */
DECL|macro|EE_DATA_WRITE
mdefine_line|#define EE_DATA_WRITE&t;0x02&t;/* EEPROM chip data in. */
DECL|macro|EE_WRITE_0
mdefine_line|#define EE_WRITE_0&t;&t;0x00
DECL|macro|EE_WRITE_1
mdefine_line|#define EE_WRITE_1&t;&t;0x02
DECL|macro|EE_DATA_READ
mdefine_line|#define EE_DATA_READ&t;0x01&t;/* EEPROM chip data out. */
DECL|macro|EE_ENB
mdefine_line|#define EE_ENB&t;&t;&t;(0x80 | EE_CS)
multiline_comment|/* Delay between EEPROM clock transitions.&n;   No extra delay is needed with 33Mhz PCI, but 66Mhz may change this.&n; */
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay()&t;readl(ee_addr)
multiline_comment|/* The EEPROM commands include the alway-set leading bit. */
DECL|macro|EE_WRITE_CMD
mdefine_line|#define EE_WRITE_CMD&t;(5)
DECL|macro|EE_READ_CMD
mdefine_line|#define EE_READ_CMD&t;&t;(6)
DECL|macro|EE_ERASE_CMD
mdefine_line|#define EE_ERASE_CMD&t;(7)
DECL|function|read_eeprom
r_static
r_int
id|__devinit
id|read_eeprom
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|location
comma
r_int
id|addr_len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_void
op_star
id|ee_addr
op_assign
id|ioaddr
op_plus
id|Cfg9346
suffix:semicolon
r_int
id|read_cmd
op_assign
id|location
op_or
(paren
id|EE_READ_CMD
op_lshift
id|addr_len
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_amp
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|4
op_plus
id|addr_len
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EE_DATA_WRITE
suffix:colon
l_int|0
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_or
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
op_or
id|dataval
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
)brace
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|writeb
(paren
id|EE_ENB
op_or
id|EE_SHIFT_CLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|readb
(paren
id|ee_addr
)paren
op_amp
id|EE_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|writeb
(paren
id|EE_ENB
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|writeb
(paren
op_complement
id|EE_CS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|cp_init_one
r_static
r_int
id|__devinit
id|cp_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|cp_private
op_star
id|cp
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_void
op_star
id|regs
suffix:semicolon
r_int
id|pciaddr
suffix:semicolon
r_int
id|addr_len
comma
id|i
suffix:semicolon
id|u8
id|pci_rev
comma
id|cache_size
suffix:semicolon
id|u16
id|pci_command
suffix:semicolon
macro_line|#ifndef MODULE
r_static
r_int
id|version_printed
suffix:semicolon
r_if
c_cond
(paren
id|version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|pci_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
id|PCI_VENDOR_ID_REALTEK
op_logical_and
id|pdev-&gt;device
op_eq
id|PCI_DEVICE_ID_REALTEK_8139
op_logical_and
id|pci_rev
OL
l_int|0x20
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;pci dev %s (id %04x:%04x rev %02x) is not an 8139C+ compatible chip&bslash;n&quot;
comma
id|pdev-&gt;slot_name
comma
id|pdev-&gt;vendor
comma
id|pdev-&gt;device
comma
id|pci_rev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Try the &bslash;&quot;8139too&bslash;&quot; driver instead.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|cp_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|cp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|cp-&gt;dev
op_assign
id|dev
suffix:semicolon
id|cp-&gt;msg_enable
op_assign
(paren
id|debug
OL
l_int|0
ques
c_cond
id|CP_DEF_MSG_ENABLE
suffix:colon
id|debug
)paren
suffix:semicolon
id|spin_lock_init
(paren
op_amp
id|cp-&gt;lock
)paren
suffix:semicolon
id|cp-&gt;mii_if.dev
op_assign
id|dev
suffix:semicolon
id|cp-&gt;mii_if.mdio_read
op_assign
id|mdio_read
suffix:semicolon
id|cp-&gt;mii_if.mdio_write
op_assign
id|mdio_write
suffix:semicolon
id|cp-&gt;mii_if.phy_id
op_assign
id|CP_INTERNAL_PHY
suffix:semicolon
id|cp_set_rxbufsize
c_func
(paren
id|cp
)paren
suffix:semicolon
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_free
suffix:semicolon
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|DRV_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_disable
suffix:semicolon
r_if
c_cond
(paren
id|pdev-&gt;irq
OL
l_int|2
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;invalid irq (%d) for pci dev %s&bslash;n&quot;
comma
id|pdev-&gt;irq
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|pciaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pciaddr
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;no MMIO resource for pci dev %s&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
OL
id|CP_REGS_SIZE
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;MMIO resource (%lx) too small on pci dev %s&bslash;n&quot;
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|regs
op_assign
id|ioremap_nocache
c_func
(paren
id|pciaddr
comma
id|CP_REGS_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|regs
)paren
(brace
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot map PCI MMIO (%lx@%lx) on pci dev %s&bslash;n&quot;
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pciaddr
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|regs
suffix:semicolon
id|cp-&gt;regs
op_assign
id|regs
suffix:semicolon
id|cp_stop_hw
c_func
(paren
id|cp
)paren
suffix:semicolon
multiline_comment|/* read MAC address from EEPROM */
id|addr_len
op_assign
id|read_eeprom
(paren
id|regs
comma
l_int|0
comma
l_int|8
)paren
op_eq
l_int|0x8129
ques
c_cond
l_int|8
suffix:colon
l_int|6
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
(paren
id|read_eeprom
(paren
id|regs
comma
id|i
op_plus
l_int|7
comma
id|addr_len
)paren
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|cp_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|cp_close
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|cp_set_rx_mode
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|cp_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|cp_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|cp_ioctl
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|cp_change_mtu
suffix:semicolon
macro_line|#if 0
id|dev-&gt;tx_timeout
op_assign
id|cp_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CP_TX_CHECKSUM
id|dev-&gt;features
op_or_assign
id|NETIF_F_SG
op_or
id|NETIF_F_IP_CSUM
suffix:semicolon
macro_line|#endif
macro_line|#if CP_VLAN_TAG_USED
id|dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
id|dev-&gt;vlan_rx_register
op_assign
id|cp_vlan_rx_register
suffix:semicolon
id|dev-&gt;vlan_rx_kill_vid
op_assign
id|cp_vlan_rx_kill_vid
suffix:semicolon
macro_line|#endif
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|rc
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|err_out_iomap
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x, &quot;
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
l_string|&quot;RTL-8139C+&quot;
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Looks like this is necessary to deal with on all architectures,&n;&t; * even this %$#%$# N440BX Intel based thing doesn&squot;t get it right.&n;&t; * Ie. having two NICs in the machine, one will have the cache&n;&t; * line set at boot time, the other will not.&n;&t; */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|cache_size
)paren
suffix:semicolon
id|cache_size
op_lshift_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|cache_size
op_ne
id|SMP_CACHE_BYTES
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: PCI cache line size set incorrectly &quot;
l_string|&quot;(%i bytes) by BIOS/FW, &quot;
comma
id|dev-&gt;name
comma
id|cache_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cache_size
OG
id|SMP_CACHE_BYTES
)paren
id|printk
c_func
(paren
l_string|&quot;expecting %i&bslash;n&quot;
comma
id|SMP_CACHE_BYTES
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;correcting to %i&bslash;n&quot;
comma
id|SMP_CACHE_BYTES
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
id|SMP_CACHE_BYTES
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* enable busmastering and memory-write-invalidate */
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_command
op_amp
id|PCI_COMMAND_INVALIDATE
)paren
)paren
(brace
id|pci_command
op_or_assign
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_iomap
suffix:colon
id|iounmap
c_func
(paren
id|regs
)paren
suffix:semicolon
id|err_out_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_free
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|cp_remove_one
r_static
r_void
id|__devexit
id|cp_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|cp_private
op_star
id|cp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|cp-&gt;regs
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|cp_driver
r_static
r_struct
id|pci_driver
id|cp_driver
op_assign
(brace
id|name
suffix:colon
id|DRV_NAME
comma
id|id_table
suffix:colon
id|cp_pci_tbl
comma
id|probe
suffix:colon
id|cp_init_one
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|cp_remove_one
)paren
comma
)brace
suffix:semicolon
DECL|function|cp_init
r_static
r_int
id|__init
id|cp_init
(paren
r_void
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
(paren
op_amp
id|cp_driver
)paren
suffix:semicolon
)brace
DECL|function|cp_exit
r_static
r_void
id|__exit
id|cp_exit
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|cp_driver
)paren
suffix:semicolon
)brace
DECL|variable|cp_init
id|module_init
c_func
(paren
id|cp_init
)paren
suffix:semicolon
DECL|variable|cp_exit
id|module_exit
c_func
(paren
id|cp_exit
)paren
suffix:semicolon
eof
