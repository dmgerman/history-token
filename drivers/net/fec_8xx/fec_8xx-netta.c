multiline_comment|/*&n; * FEC instantatiation file for NETTA&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/8xx_immap.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/mpc8xx.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/commproc.h&gt;
macro_line|#include &quot;fec_8xx.h&quot;
multiline_comment|/*************************************************/
DECL|variable|fec1_info
r_static
r_struct
id|fec_platform_info
id|fec1_info
op_assign
(brace
dot
id|fec_no
op_assign
l_int|0
comma
dot
id|use_mdio
op_assign
l_int|1
comma
dot
id|phy_addr
op_assign
l_int|8
comma
dot
id|fec_irq
op_assign
id|SIU_LEVEL1
comma
dot
id|phy_irq
op_assign
id|CPM_IRQ_OFFSET
op_plus
id|CPMVEC_PIO_PC6
comma
dot
id|rx_ring
op_assign
l_int|128
comma
dot
id|tx_ring
op_assign
l_int|16
comma
dot
id|rx_copybreak
op_assign
l_int|240
comma
dot
id|use_napi
op_assign
l_int|1
comma
dot
id|napi_weight
op_assign
l_int|17
comma
)brace
suffix:semicolon
DECL|variable|fec2_info
r_static
r_struct
id|fec_platform_info
id|fec2_info
op_assign
(brace
dot
id|fec_no
op_assign
l_int|1
comma
dot
id|use_mdio
op_assign
l_int|1
comma
dot
id|phy_addr
op_assign
l_int|2
comma
dot
id|fec_irq
op_assign
id|SIU_LEVEL3
comma
dot
id|phy_irq
op_assign
id|CPM_IRQ_OFFSET
op_plus
id|CPMVEC_PIO_PC7
comma
dot
id|rx_ring
op_assign
l_int|128
comma
dot
id|tx_ring
op_assign
l_int|16
comma
dot
id|rx_copybreak
op_assign
l_int|240
comma
dot
id|use_napi
op_assign
l_int|1
comma
dot
id|napi_weight
op_assign
l_int|17
comma
)brace
suffix:semicolon
DECL|variable|fec1_dev
r_static
r_struct
id|net_device
op_star
id|fec1_dev
suffix:semicolon
DECL|variable|fec2_dev
r_static
r_struct
id|net_device
op_star
id|fec2_dev
suffix:semicolon
multiline_comment|/* XXX custom u-boot &amp; Linux startup needed */
r_extern
r_const
r_char
op_star
id|__fw_getenv
c_func
(paren
r_const
r_char
op_star
id|var
)paren
suffix:semicolon
multiline_comment|/* access ports */
DECL|macro|setbits32
mdefine_line|#define setbits32(_addr, _v) __fec_out32(&amp;(_addr), __fec_in32(&amp;(_addr)) |  (_v))
DECL|macro|clrbits32
mdefine_line|#define clrbits32(_addr, _v) __fec_out32(&amp;(_addr), __fec_in32(&amp;(_addr)) &amp; ~(_v))
DECL|macro|setbits16
mdefine_line|#define setbits16(_addr, _v) __fec_out16(&amp;(_addr), __fec_in16(&amp;(_addr)) |  (_v))
DECL|macro|clrbits16
mdefine_line|#define clrbits16(_addr, _v) __fec_out16(&amp;(_addr), __fec_in16(&amp;(_addr)) &amp; ~(_v))
DECL|function|fec_8xx_platform_init
r_int
id|fec_8xx_platform_init
c_func
(paren
r_void
)paren
(brace
id|immap_t
op_star
id|immap
op_assign
(paren
id|immap_t
op_star
)paren
id|IMAP_ADDR
suffix:semicolon
id|bd_t
op_star
id|bd
op_assign
(paren
id|bd_t
op_star
)paren
id|__res
suffix:semicolon
r_const
r_char
op_star
id|s
suffix:semicolon
r_char
op_star
id|e
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* use MDC for MII */
id|setbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pdpar
comma
l_int|0x0080
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pddir
comma
l_int|0x0080
)paren
suffix:semicolon
multiline_comment|/* configure FEC1 pins */
id|setbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_papar
comma
l_int|0xe810
)paren
suffix:semicolon
id|setbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_padir
comma
l_int|0x0810
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_padir
comma
l_int|0xe000
)paren
suffix:semicolon
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_pbpar
comma
l_int|0x00000001
)paren
suffix:semicolon
id|clrbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_pbdir
comma
l_int|0x00000001
)paren
suffix:semicolon
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_cptr
comma
l_int|0x00000100
)paren
suffix:semicolon
id|clrbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_cptr
comma
l_int|0x00000050
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcpar
comma
l_int|0x0200
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcdir
comma
l_int|0x0200
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcso
comma
l_int|0x0200
)paren
suffix:semicolon
id|setbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcint
comma
l_int|0x0200
)paren
suffix:semicolon
multiline_comment|/* configure FEC2 pins */
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_pepar
comma
l_int|0x00039620
)paren
suffix:semicolon
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_pedir
comma
l_int|0x00039620
)paren
suffix:semicolon
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_peso
comma
l_int|0x00031000
)paren
suffix:semicolon
id|clrbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_peso
comma
l_int|0x00008620
)paren
suffix:semicolon
id|setbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_cptr
comma
l_int|0x00000080
)paren
suffix:semicolon
id|clrbits32
c_func
(paren
id|immap-&gt;im_cpm.cp_cptr
comma
l_int|0x00000028
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcpar
comma
l_int|0x0200
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcdir
comma
l_int|0x0200
)paren
suffix:semicolon
id|clrbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcso
comma
l_int|0x0200
)paren
suffix:semicolon
id|setbits16
c_func
(paren
id|immap-&gt;im_ioport.iop_pcint
comma
l_int|0x0200
)paren
suffix:semicolon
multiline_comment|/* fill up */
id|fec1_info.sys_clk
op_assign
id|bd-&gt;bi_intfreq
suffix:semicolon
id|fec2_info.sys_clk
op_assign
id|bd-&gt;bi_intfreq
suffix:semicolon
id|s
op_assign
id|__fw_getenv
c_func
(paren
l_string|&quot;ethaddr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fec1_info.macaddr
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|s
comma
op_amp
id|e
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|e
)paren
id|s
op_assign
id|e
op_plus
l_int|1
suffix:semicolon
)brace
)brace
id|s
op_assign
id|__fw_getenv
c_func
(paren
l_string|&quot;eth1addr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fec2_info.macaddr
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|s
comma
op_amp
id|e
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|e
)paren
id|s
op_assign
id|e
op_plus
l_int|1
suffix:semicolon
)brace
)brace
id|fec_8xx_init_one
c_func
(paren
op_amp
id|fec1_info
comma
op_amp
id|fec1_dev
)paren
suffix:semicolon
id|fec_8xx_init_one
c_func
(paren
op_amp
id|fec2_info
comma
op_amp
id|fec2_dev
)paren
suffix:semicolon
r_return
id|fec1_dev
op_ne
l_int|NULL
op_logical_and
id|fec2_dev
op_ne
l_int|NULL
ques
c_cond
l_int|0
suffix:colon
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|fec_8xx_platform_cleanup
r_void
id|fec_8xx_platform_cleanup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|fec2_dev
op_ne
l_int|NULL
)paren
id|fec_8xx_cleanup_one
c_func
(paren
id|fec2_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fec1_dev
op_ne
l_int|NULL
)paren
id|fec_8xx_cleanup_one
c_func
(paren
id|fec1_dev
)paren
suffix:semicolon
)brace
eof
