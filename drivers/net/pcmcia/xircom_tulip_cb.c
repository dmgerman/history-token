multiline_comment|/* xircom_tulip_cb.c: A Xircom CBE-100 ethernet driver for Linux. */
multiline_comment|/*&n;&t;Written/copyright 1994-1999 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU General Public License, incorporated herein by reference.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;-----------------------------------------------------------&n;&n;&t;Linux kernel-specific changes:&n;&n;&t;LK1.0 (Ion Badulescu)&n;&t;- Major cleanup&n;&t;- Use 2.4 PCI API&n;&t;- Support ethtool&n;&t;- Rewrite perfect filter/hash code&n;&t;- Use interrupts for media changes&n;&n;&t;LK1.1 (Ion Badulescu)&n;&t;- Disallow negotiation of unsupported full-duplex modes&n;*/
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;xircom_tulip_cb&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;0.91+LK1.1&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&quot;October 11, 2001&quot;
DECL|macro|CARDBUS
mdefine_line|#define CARDBUS 1
multiline_comment|/* A few user-configurable values. */
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|25
suffix:semicolon
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 4
multiline_comment|/* Used to pass the full-duplex flag, etc. */
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|mtu
r_static
r_int
id|mtu
(braket
id|MAX_UNITS
)braket
suffix:semicolon
multiline_comment|/* Jumbo MTU for interfaces. */
multiline_comment|/* Keep the ring sizes a power of two for efficiency.&n;   Making the Tx ring too large decreases the effectiveness of channel&n;   bonding and packet priority.&n;   There are no ill effects from too-large receive rings. */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE&t;16
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE&t;32
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-buffer Rx structure. */
macro_line|#ifdef __alpha__
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|1518
suffix:semicolon
macro_line|#else
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|100
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;  Set the bus performance register.&n;&t;Typical: Set 16 longword cache alignment, no burst limit.&n;&t;Cache alignment bits 15:14&t;     Burst length 13:8&n;&t;&t;0000&t;No alignment  0x00000000 unlimited&t;&t;0800 8 longwords&n;&t;&t;4000&t;8  longwords&t;&t;0100 1 longword&t;&t;1000 16 longwords&n;&t;&t;8000&t;16 longwords&t;&t;0200 2 longwords&t;2000 32 longwords&n;&t;&t;C000&t;32  longwords&t;&t;0400 4 longwords&n;&t;Warning: many older 486 systems are broken and require setting 0x00A04800&n;&t;   8 longword cache alignment, 8 longword burst.&n;&t;ToDo: Non-Intel setting could be better.&n;*/
macro_line|#if defined(__alpha__) || defined(__ia64__) || defined(__x86_64__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0xE000
suffix:semicolon
macro_line|#elif defined(__powerpc__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01B00000
op_or
l_int|0x8000
suffix:semicolon
macro_line|#elif defined(__sparc__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01B00080
op_or
l_int|0x8000
suffix:semicolon
macro_line|#elif defined(__i386__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x8000
suffix:semicolon
macro_line|#else
macro_line|#warning Processor architecture undefined!
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x00A00000
op_or
l_int|0x4800
suffix:semicolon
macro_line|#endif
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT&t;&t;(4 * HZ)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;&t;1536&t;&t;&t;/* Size of each temporary Rx buffer.*/
DECL|macro|PKT_SETUP_SZ
mdefine_line|#define PKT_SETUP_SZ&t;&t;192&t;&t;&t;/* Size of the setup frame */
multiline_comment|/* PCI registers */
DECL|macro|PCI_POWERMGMT
mdefine_line|#define PCI_POWERMGMT &t;0x40
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;asm/processor.h&gt;&t;&t;/* Processor type for cache alignment. */
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|KERN_INFO
id|DRV_NAME
l_string|&quot;.c derived from tulip.c:v0.91 4/14/99 becker@scyld.com&bslash;n&quot;
id|KERN_INFO
l_string|&quot; unofficial 2.4.x kernel port, version &quot;
id|DRV_VERSION
l_string|&quot;, &quot;
id|DRV_RELDATE
l_string|&quot;&bslash;n&quot;
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Donald Becker &lt;becker@scyld.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Xircom CBE-100 ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL v2&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|csr0
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
DECL|macro|xircom_debug
mdefine_line|#define xircom_debug debug
macro_line|#ifdef XIRCOM_DEBUG
DECL|variable|xircom_debug
r_static
r_int
id|xircom_debug
op_assign
id|XIRCOM_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|xircom_debug
r_static
r_int
id|xircom_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t;&t;&t;&t;Theory of Operation&n;&n;I. Board Compatibility&n;&n;This device driver was forked from the driver for the DECchip &quot;Tulip&quot;,&n;Digital&squot;s single-chip ethernet controllers for PCI.  It supports Xircom&squot;s&n;almost-Tulip-compatible CBE-100 CardBus adapters.&n;&n;II. Board-specific settings&n;&n;PCI bus devices are configured by the system at boot time, so no jumpers&n;need to be set on the board.  The system BIOS preferably should assign the&n;PCI INTA signal to an otherwise unused system IRQ line.&n;&n;III. Driver operation&n;&n;IIIa. Ring buffers&n;&n;The Xircom can use either ring buffers or lists of Tx and Rx descriptors.&n;This driver uses statically allocated rings of Rx and Tx descriptors, set at&n;compile time by RX/TX_RING_SIZE.  This version of the driver allocates skbuffs&n;for the Rx ring buffers at open() time and passes the skb-&gt;data field to the&n;Xircom as receive data buffers.  When an incoming frame is less than&n;RX_COPYBREAK bytes long, a fresh skbuff is allocated and the frame is&n;copied to the new skbuff.  When the incoming frame is larger, the skbuff is&n;passed directly up the protocol stack and replaced by a newly allocated&n;skbuff.&n;&n;The RX_COPYBREAK value is chosen to trade-off the memory wasted by&n;using a full-sized skbuff for small frames vs. the copying costs of larger&n;frames.  For small frames the copying cost is negligible (esp. considering&n;that we are pre-loading the cache with immediately useful header&n;information).  For large frames the copying cost is non-trivial, and the&n;larger copy might flush the cache of useful data.  A subtle aspect of this&n;choice is that the Xircom only receives into longword aligned buffers, thus&n;the IP header at offset 14 isn&squot;t longword aligned for further processing.&n;Copied frames are put into the new skbuff at an offset of &quot;+2&quot;, thus copying&n;has the beneficial effect of aligning the IP header and preloading the&n;cache.&n;&n;IIIC. Synchronization&n;The driver runs as two independent, single-threaded flows of control.  One&n;is the send-packet routine, which enforces single-threaded use by the&n;dev-&gt;tbusy flag.  The other thread is the interrupt handler, which is single&n;threaded by the hardware and other software.&n;&n;The send packet thread has partial control over the Tx ring and &squot;dev-&gt;tbusy&squot;&n;flag.  It sets the tbusy flag whenever it&squot;s queuing a Tx packet. If the next&n;queue slot is empty, it clears the tbusy flag when finished otherwise it sets&n;the &squot;tp-&gt;tx_full&squot; flag.&n;&n;The interrupt handler has exclusive control over the Rx ring and records stats&n;from the Tx ring.  (The Tx-done interrupt can&squot;t be selectively turned off, so&n;we can&squot;t avoid the interrupt overhead by having the Tx routine reap the Tx&n;stats.)&t; After reaping the stats, it marks the queue entry as empty by setting&n;the &squot;base&squot; to zero.&t; Iff the &squot;tp-&gt;tx_full&squot; flag is set, it clears both the&n;tx_full and tbusy flags.&n;&n;IV. Notes&n;&n;IVb. References&n;&n;http://cesdis.gsfc.nasa.gov/linux/misc/NWay.html&n;http://www.digital.com  (search for current 21*4* datasheets and &quot;21X4 SROM&quot;)&n;http://www.national.com/pf/DP/DP83840A.html&n;&n;IVc. Errata&n;&n;*/
multiline_comment|/* A full-duplex map for media types. */
DECL|enum|MediaIs
r_enum
id|MediaIs
(brace
DECL|enumerator|MediaIsFD
DECL|enumerator|MediaAlwaysFD
DECL|enumerator|MediaIsMII
DECL|enumerator|MediaIsFx
id|MediaIsFD
op_assign
l_int|1
comma
id|MediaAlwaysFD
op_assign
l_int|2
comma
id|MediaIsMII
op_assign
l_int|4
comma
id|MediaIsFx
op_assign
l_int|8
comma
DECL|enumerator|MediaIs100
id|MediaIs100
op_assign
l_int|16
)brace
suffix:semicolon
DECL|variable|media_cap
r_static
r_const
r_char
id|media_cap
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|3
comma
l_int|19
comma
l_int|16
comma
l_int|24
comma
l_int|27
comma
l_int|4
comma
l_int|7
comma
l_int|5
comma
l_int|0
comma
l_int|20
comma
l_int|23
comma
l_int|20
)brace
suffix:semicolon
multiline_comment|/* Offsets to the Command and Status Registers, &quot;CSRs&quot;.  All accesses&n;   must be longword instructions and quadword aligned. */
DECL|enum|xircom_offsets
r_enum
id|xircom_offsets
(brace
DECL|enumerator|CSR0
DECL|enumerator|CSR1
DECL|enumerator|CSR2
DECL|enumerator|CSR3
DECL|enumerator|CSR4
DECL|enumerator|CSR5
id|CSR0
op_assign
l_int|0
comma
id|CSR1
op_assign
l_int|0x08
comma
id|CSR2
op_assign
l_int|0x10
comma
id|CSR3
op_assign
l_int|0x18
comma
id|CSR4
op_assign
l_int|0x20
comma
id|CSR5
op_assign
l_int|0x28
comma
DECL|enumerator|CSR6
DECL|enumerator|CSR7
DECL|enumerator|CSR8
DECL|enumerator|CSR9
DECL|enumerator|CSR10
DECL|enumerator|CSR11
id|CSR6
op_assign
l_int|0x30
comma
id|CSR7
op_assign
l_int|0x38
comma
id|CSR8
op_assign
l_int|0x40
comma
id|CSR9
op_assign
l_int|0x48
comma
id|CSR10
op_assign
l_int|0x50
comma
id|CSR11
op_assign
l_int|0x58
comma
DECL|enumerator|CSR12
DECL|enumerator|CSR13
DECL|enumerator|CSR14
DECL|enumerator|CSR15
DECL|enumerator|CSR16
id|CSR12
op_assign
l_int|0x60
comma
id|CSR13
op_assign
l_int|0x68
comma
id|CSR14
op_assign
l_int|0x70
comma
id|CSR15
op_assign
l_int|0x78
comma
id|CSR16
op_assign
l_int|0x04
comma
)brace
suffix:semicolon
multiline_comment|/* The bits in the CSR5 status registers, mostly interrupt sources. */
DECL|enum|status_bits
r_enum
id|status_bits
(brace
DECL|enumerator|LinkChange
id|LinkChange
op_assign
l_int|0x08000000
comma
DECL|enumerator|NormalIntr
DECL|enumerator|NormalIntrMask
id|NormalIntr
op_assign
l_int|0x10000
comma
id|NormalIntrMask
op_assign
l_int|0x00014045
comma
DECL|enumerator|AbnormalIntr
DECL|enumerator|AbnormalIntrMask
id|AbnormalIntr
op_assign
l_int|0x8000
comma
id|AbnormalIntrMask
op_assign
l_int|0x0a00a5a2
comma
DECL|enumerator|ReservedIntrMask
id|ReservedIntrMask
op_assign
l_int|0xe0001a18
comma
DECL|enumerator|EarlyRxIntr
DECL|enumerator|BusErrorIntr
id|EarlyRxIntr
op_assign
l_int|0x4000
comma
id|BusErrorIntr
op_assign
l_int|0x2000
comma
DECL|enumerator|EarlyTxIntr
DECL|enumerator|RxDied
DECL|enumerator|RxNoBuf
DECL|enumerator|RxIntr
id|EarlyTxIntr
op_assign
l_int|0x400
comma
id|RxDied
op_assign
l_int|0x100
comma
id|RxNoBuf
op_assign
l_int|0x80
comma
id|RxIntr
op_assign
l_int|0x40
comma
DECL|enumerator|TxFIFOUnderflow
DECL|enumerator|TxNoBuf
DECL|enumerator|TxDied
DECL|enumerator|TxIntr
id|TxFIFOUnderflow
op_assign
l_int|0x20
comma
id|TxNoBuf
op_assign
l_int|0x04
comma
id|TxDied
op_assign
l_int|0x02
comma
id|TxIntr
op_assign
l_int|0x01
comma
)brace
suffix:semicolon
DECL|enum|csr0_control_bits
r_enum
id|csr0_control_bits
(brace
DECL|enumerator|EnableMWI
DECL|enumerator|EnableMRL
id|EnableMWI
op_assign
l_int|0x01000000
comma
id|EnableMRL
op_assign
l_int|0x00800000
comma
DECL|enumerator|EnableMRM
DECL|enumerator|EqualBusPrio
id|EnableMRM
op_assign
l_int|0x00200000
comma
id|EqualBusPrio
op_assign
l_int|0x02
comma
DECL|enumerator|SoftwareReset
id|SoftwareReset
op_assign
l_int|0x01
comma
)brace
suffix:semicolon
DECL|enum|csr6_control_bits
r_enum
id|csr6_control_bits
(brace
DECL|enumerator|ReceiveAllBit
DECL|enumerator|AllMultiBit
DECL|enumerator|PromiscBit
id|ReceiveAllBit
op_assign
l_int|0x40000000
comma
id|AllMultiBit
op_assign
l_int|0x80
comma
id|PromiscBit
op_assign
l_int|0x40
comma
DECL|enumerator|HashFilterBit
DECL|enumerator|FullDuplexBit
id|HashFilterBit
op_assign
l_int|0x01
comma
id|FullDuplexBit
op_assign
l_int|0x0200
comma
DECL|enumerator|TxThresh10
DECL|enumerator|TxStoreForw
id|TxThresh10
op_assign
l_int|0x400000
comma
id|TxStoreForw
op_assign
l_int|0x200000
comma
DECL|enumerator|TxThreshMask
DECL|enumerator|TxThreshShift
id|TxThreshMask
op_assign
l_int|0xc000
comma
id|TxThreshShift
op_assign
l_int|14
comma
DECL|enumerator|EnableTx
DECL|enumerator|EnableRx
id|EnableTx
op_assign
l_int|0x2000
comma
id|EnableRx
op_assign
l_int|0x02
comma
DECL|enumerator|ReservedZeroMask
DECL|enumerator|ReservedOneMask
id|ReservedZeroMask
op_assign
l_int|0x8d930134
comma
id|ReservedOneMask
op_assign
l_int|0x320c0000
comma
DECL|enumerator|EnableTxRx
id|EnableTxRx
op_assign
(paren
id|EnableTx
op_or
id|EnableRx
)paren
comma
)brace
suffix:semicolon
DECL|enum|tbl_flag
r_enum
id|tbl_flag
(brace
DECL|enumerator|HAS_MII
DECL|enumerator|HAS_ACPI
id|HAS_MII
op_assign
l_int|1
comma
id|HAS_ACPI
op_assign
l_int|2
comma
)brace
suffix:semicolon
DECL|struct|xircom_chip_table
r_static
r_struct
id|xircom_chip_table
(brace
DECL|member|chip_name
r_char
op_star
id|chip_name
suffix:semicolon
DECL|member|valid_intrs
r_int
id|valid_intrs
suffix:semicolon
multiline_comment|/* CSR7 interrupt enable settings */
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|variable|xircom_tbl
)brace
id|xircom_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Xircom Cardbus Adapter&quot;
comma
id|LinkChange
op_or
id|NormalIntr
op_or
id|AbnormalIntr
op_or
id|BusErrorIntr
op_or
id|RxDied
op_or
id|RxNoBuf
op_or
id|RxIntr
op_or
id|TxFIFOUnderflow
op_or
id|TxNoBuf
op_or
id|TxDied
op_or
id|TxIntr
comma
id|HAS_MII
op_or
id|HAS_ACPI
comma
)brace
comma
(brace
l_int|NULL
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* This matches the table above. */
DECL|enum|chips
r_enum
id|chips
(brace
DECL|enumerator|X3201_3
id|X3201_3
comma
)brace
suffix:semicolon
multiline_comment|/* The Xircom Rx and Tx buffer descriptors. */
DECL|struct|xircom_rx_desc
r_struct
id|xircom_rx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
DECL|member|buffer2
id|u32
id|buffer1
comma
id|buffer2
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|xircom_tx_desc
r_struct
id|xircom_tx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|length
id|s32
id|length
suffix:semicolon
DECL|member|buffer1
DECL|member|buffer2
id|u32
id|buffer1
comma
id|buffer2
suffix:semicolon
multiline_comment|/* We use only buffer 1.  */
)brace
suffix:semicolon
DECL|enum|tx_desc0_status_bits
r_enum
id|tx_desc0_status_bits
(brace
DECL|enumerator|Tx0DescOwned
DECL|enumerator|Tx0DescError
DECL|enumerator|Tx0NoCarrier
id|Tx0DescOwned
op_assign
l_int|0x80000000
comma
id|Tx0DescError
op_assign
l_int|0x8000
comma
id|Tx0NoCarrier
op_assign
l_int|0x0800
comma
DECL|enumerator|Tx0LateColl
DECL|enumerator|Tx0ManyColl
DECL|enumerator|Tx0Underflow
id|Tx0LateColl
op_assign
l_int|0x0200
comma
id|Tx0ManyColl
op_assign
l_int|0x0100
comma
id|Tx0Underflow
op_assign
l_int|0x02
comma
)brace
suffix:semicolon
DECL|enum|tx_desc1_status_bits
r_enum
id|tx_desc1_status_bits
(brace
DECL|enumerator|Tx1ComplIntr
DECL|enumerator|Tx1LastSeg
DECL|enumerator|Tx1FirstSeg
id|Tx1ComplIntr
op_assign
l_int|0x80000000
comma
id|Tx1LastSeg
op_assign
l_int|0x40000000
comma
id|Tx1FirstSeg
op_assign
l_int|0x20000000
comma
DECL|enumerator|Tx1SetupPkt
DECL|enumerator|Tx1DisableCRC
DECL|enumerator|Tx1RingWrap
id|Tx1SetupPkt
op_assign
l_int|0x08000000
comma
id|Tx1DisableCRC
op_assign
l_int|0x04000000
comma
id|Tx1RingWrap
op_assign
l_int|0x02000000
comma
DECL|enumerator|Tx1ChainDesc
DECL|enumerator|Tx1NoPad
DECL|enumerator|Tx1HashSetup
id|Tx1ChainDesc
op_assign
l_int|0x01000000
comma
id|Tx1NoPad
op_assign
l_int|0x800000
comma
id|Tx1HashSetup
op_assign
l_int|0x400000
comma
DECL|enumerator|Tx1WholePkt
id|Tx1WholePkt
op_assign
(paren
id|Tx1FirstSeg
op_or
id|Tx1LastSeg
)paren
comma
)brace
suffix:semicolon
DECL|enum|rx_desc0_status_bits
r_enum
id|rx_desc0_status_bits
(brace
DECL|enumerator|Rx0DescOwned
DECL|enumerator|Rx0DescError
DECL|enumerator|Rx0NoSpace
id|Rx0DescOwned
op_assign
l_int|0x80000000
comma
id|Rx0DescError
op_assign
l_int|0x8000
comma
id|Rx0NoSpace
op_assign
l_int|0x4000
comma
DECL|enumerator|Rx0Runt
DECL|enumerator|Rx0McastPkt
DECL|enumerator|Rx0FirstSeg
DECL|enumerator|Rx0LastSeg
id|Rx0Runt
op_assign
l_int|0x0800
comma
id|Rx0McastPkt
op_assign
l_int|0x0400
comma
id|Rx0FirstSeg
op_assign
l_int|0x0200
comma
id|Rx0LastSeg
op_assign
l_int|0x0100
comma
DECL|enumerator|Rx0HugeFrame
DECL|enumerator|Rx0CRCError
id|Rx0HugeFrame
op_assign
l_int|0x80
comma
id|Rx0CRCError
op_assign
l_int|0x02
comma
DECL|enumerator|Rx0WholePkt
id|Rx0WholePkt
op_assign
(paren
id|Rx0FirstSeg
op_or
id|Rx0LastSeg
)paren
comma
)brace
suffix:semicolon
DECL|enum|rx_desc1_status_bits
r_enum
id|rx_desc1_status_bits
(brace
DECL|enumerator|Rx1RingWrap
DECL|enumerator|Rx1ChainDesc
id|Rx1RingWrap
op_assign
l_int|0x02000000
comma
id|Rx1ChainDesc
op_assign
l_int|0x01000000
comma
)brace
suffix:semicolon
DECL|struct|xircom_private
r_struct
id|xircom_private
(brace
DECL|member|rx_ring
r_struct
id|xircom_rx_desc
id|rx_ring
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|tx_ring
r_struct
id|xircom_tx_desc
id|tx_ring
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
multiline_comment|/* The saved address of a sent-in-place packet/buffer, for skfree(). */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
macro_line|#ifdef CARDBUS
multiline_comment|/* The X3201-3 requires 4-byte aligned tx bufs */
DECL|member|tx_aligned_skbuff
r_struct
id|sk_buff
op_star
id|tx_aligned_skbuff
(braket
id|TX_RING_SIZE
)braket
suffix:semicolon
macro_line|#endif
multiline_comment|/* The addresses of receive-in-place skbuffs. */
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING_SIZE
)braket
suffix:semicolon
DECL|member|setup_frame
id|u16
id|setup_frame
(braket
id|PKT_SETUP_SZ
op_div
r_sizeof
(paren
id|u16
)paren
)braket
suffix:semicolon
multiline_comment|/* Pseudo-Tx frame to init address table. */
DECL|member|chip_id
r_int
id|chip_id
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|cur_rx
DECL|member|cur_tx
r_int
r_int
id|cur_rx
comma
id|cur_tx
suffix:semicolon
multiline_comment|/* The next free ring entry */
DECL|member|dirty_rx
DECL|member|dirty_tx
r_int
r_int
id|dirty_rx
comma
id|dirty_tx
suffix:semicolon
multiline_comment|/* The ring entries to be free()ed. */
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* The Tx queue is full. */
DECL|member|speed100
r_int
r_int
id|speed100
suffix:colon
l_int|1
suffix:semicolon
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Full-duplex operation requested. */
DECL|member|autoneg
r_int
r_int
id|autoneg
suffix:colon
l_int|1
suffix:semicolon
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
DECL|member|open
r_int
r_int
id|open
suffix:colon
l_int|1
suffix:semicolon
DECL|member|csr0
r_int
r_int
id|csr0
suffix:semicolon
multiline_comment|/* CSR0 setting. */
DECL|member|csr6
r_int
r_int
id|csr6
suffix:semicolon
multiline_comment|/* Current CSR6 control settings. */
DECL|member|to_advertise
id|u16
id|to_advertise
suffix:semicolon
multiline_comment|/* NWay capabilities advertised.  */
DECL|member|advertising
id|u16
id|advertising
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|phys
DECL|member|mii_cnt
r_int
r_char
id|phys
(braket
l_int|4
)braket
comma
id|mii_cnt
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|saved_if_port
r_int
id|saved_if_port
suffix:semicolon
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|xircom_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|xircom_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|xircom_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|xircom_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|xircom_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|xircom_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|xircom_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|xircom_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|xircom_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|xircom_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|xircom_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/* The Xircom cards are picky about when certain bits in CSR6 can be&n;   manipulated.  Keith Owens &lt;kaos@ocs.com.au&gt;. */
DECL|function|outl_CSR6
r_static
r_void
id|outl_CSR6
c_func
(paren
id|u32
id|newcsr6
comma
r_int
id|ioaddr
)paren
(brace
r_const
r_int
id|strict_bits
op_assign
id|TxThresh10
op_or
id|TxStoreForw
op_or
id|TxThreshMask
op_or
id|EnableTxRx
op_or
id|FullDuplexBit
suffix:semicolon
r_int
id|csr5
comma
id|csr5_22_20
comma
id|csr5_19_17
comma
id|currcsr6
comma
id|attempts
op_assign
l_int|200
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* mask out the reserved bits that always read 0 on the Xircom cards */
id|newcsr6
op_and_assign
op_complement
id|ReservedZeroMask
suffix:semicolon
multiline_comment|/* or in the reserved bits that always read 1 */
id|newcsr6
op_or_assign
id|ReservedOneMask
suffix:semicolon
id|currcsr6
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|newcsr6
op_amp
id|strict_bits
)paren
op_eq
(paren
id|currcsr6
op_amp
id|strict_bits
)paren
)paren
op_logical_or
(paren
(paren
id|currcsr6
op_amp
op_complement
id|EnableTxRx
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|outl
c_func
(paren
id|newcsr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* safe */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* make sure the transmitter and receiver are stopped first */
id|currcsr6
op_and_assign
op_complement
id|EnableTxRx
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|csr5
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_eq
l_int|0xffffffff
)paren
r_break
suffix:semicolon
multiline_comment|/* cannot read csr5, card removed? */
id|csr5_22_20
op_assign
id|csr5
op_amp
l_int|0x700000
suffix:semicolon
id|csr5_19_17
op_assign
id|csr5
op_amp
l_int|0x0e0000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|csr5_22_20
op_eq
l_int|0
op_logical_or
id|csr5_22_20
op_eq
l_int|0x600000
)paren
op_logical_and
(paren
id|csr5_19_17
op_eq
l_int|0
op_logical_or
id|csr5_19_17
op_eq
l_int|0x80000
op_logical_or
id|csr5_19_17
op_eq
l_int|0xc0000
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* both are stopped or suspended */
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|attempts
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|DRV_NAME
l_string|&quot;: outl_CSR6 too many attempts,&quot;
l_string|&quot;csr5=0x%08x&bslash;n&quot;
comma
id|csr5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|newcsr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* unsafe but do it anyway */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outl
c_func
(paren
id|currcsr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* now it is safe to change csr6 */
id|outl
c_func
(paren
id|newcsr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|read_mac_address
r_static
r_void
id|__devinit
id|read_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|tuple
comma
id|link
comma
id|data_id
comma
id|data_count
suffix:semicolon
multiline_comment|/* Xircom has its address stored in the CIS;&n;&t; * we access it through the boot rom interface for now&n;&t; * this might not work, as the CIS is not parsed but I&n;&t; * (danilo) use the offset I found on my card&squot;s CIS !!!&n;&t; *&n;&t; * Doug Ledford: I changed this routine around so that it&n;&t; * walks the CIS memory space, parsing the config items, and&n;&t; * finds the proper lan_node_id tuple and uses the data&n;&t; * stored there.&n;&t; */
id|outl
c_func
(paren
l_int|1
op_lshift
l_int|12
comma
id|ioaddr
op_plus
id|CSR9
)paren
suffix:semicolon
multiline_comment|/* enable boot rom access */
r_for
c_loop
(paren
id|i
op_assign
l_int|0x100
suffix:semicolon
id|i
OL
l_int|0x1f7
suffix:semicolon
id|i
op_add_assign
id|link
op_plus
l_int|2
)paren
(brace
id|outl
c_func
(paren
id|i
comma
id|ioaddr
op_plus
id|CSR10
)paren
suffix:semicolon
id|tuple
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0xff
suffix:semicolon
id|outl
c_func
(paren
id|i
op_plus
l_int|1
comma
id|ioaddr
op_plus
id|CSR10
)paren
suffix:semicolon
id|link
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0xff
suffix:semicolon
id|outl
c_func
(paren
id|i
op_plus
l_int|2
comma
id|ioaddr
op_plus
id|CSR10
)paren
suffix:semicolon
id|data_id
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0xff
suffix:semicolon
id|outl
c_func
(paren
id|i
op_plus
l_int|3
comma
id|ioaddr
op_plus
id|CSR10
)paren
suffix:semicolon
id|data_count
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tuple
op_eq
l_int|0x22
)paren
op_logical_and
(paren
id|data_id
op_eq
l_int|0x04
)paren
op_logical_and
(paren
id|data_count
op_eq
l_int|0x06
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * This is it.  We have the data we want.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|6
suffix:semicolon
id|j
op_increment
)paren
(brace
id|outl
c_func
(paren
id|i
op_plus
id|j
op_plus
l_int|4
comma
id|ioaddr
op_plus
id|CSR10
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|j
)braket
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|link
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * locate the MII interfaces and initialize them.&n; * we disable full-duplex modes here,&n; * because we don&squot;t know how to handle them.&n; */
DECL|function|find_mii_transceivers
r_static
r_void
id|find_mii_transceivers
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|phy
comma
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
id|u16
id|media2advert
(braket
)braket
op_assign
(brace
l_int|0x20
comma
l_int|0x40
comma
l_int|0x03e0
comma
l_int|0x60
comma
l_int|0x80
comma
l_int|0x100
comma
l_int|0x200
)brace
suffix:semicolon
id|tp-&gt;to_advertise
op_assign
id|media2advert
(braket
id|tp-&gt;default_port
op_minus
l_int|9
)braket
suffix:semicolon
)brace
r_else
id|tp-&gt;to_advertise
op_assign
multiline_comment|/*ADVERTISE_100BASE4 | ADVERTISE_100FULL |*/
id|ADVERTISE_100HALF
op_or
multiline_comment|/*ADVERTISE_10FULL |*/
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_CSMA
suffix:semicolon
multiline_comment|/* Find the connected MII xcvrs.&n;&t;   Doing this in open() would allow detecting external xcvrs later,&n;&t;   but takes much time. */
r_for
c_loop
(paren
id|phy
op_assign
l_int|0
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
r_sizeof
(paren
id|tp-&gt;phys
)paren
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_status
op_amp
(paren
id|BMSR_100BASE4
op_or
id|BMSR_100HALF
op_or
id|BMSR_10HALF
)paren
)paren
op_eq
id|BMSR_100BASE4
op_logical_or
(paren
(paren
id|mii_status
op_amp
id|BMSR_100BASE4
)paren
op_eq
l_int|0
op_logical_and
(paren
id|mii_status
op_amp
(paren
id|BMSR_100FULL
op_or
id|BMSR_100HALF
op_or
id|BMSR_10FULL
op_or
id|BMSR_10HALF
)paren
)paren
op_ne
l_int|0
)paren
)paren
(brace
r_int
id|mii_reg0
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
r_int
id|mii_advert
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
r_int
id|reg4
op_assign
(paren
(paren
id|mii_status
op_rshift
l_int|6
)paren
op_amp
id|tp-&gt;to_advertise
)paren
op_or
id|ADVERTISE_CSMA
suffix:semicolon
id|tp-&gt;phys
(braket
id|phy_idx
)braket
op_assign
id|phy
suffix:semicolon
id|tp-&gt;advertising
(braket
id|phy_idx
op_increment
)braket
op_assign
id|reg4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  MII transceiver #%d &quot;
l_string|&quot;config %4.4x status %4.4x advertising %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_reg0
comma
id|mii_status
comma
id|mii_advert
)paren
suffix:semicolon
)brace
)brace
id|tp-&gt;mii_cnt
op_assign
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: ***WARNING***: No MII transceiver found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * To quote Arjan van de Ven:&n; *   tranceiver_voodoo() enables the external UTP plug thingy.&n; *   it&squot;s called voodoo as I stole this code and cannot cross-reference&n; *   it with the specification.&n; * Actually it seems to go like this:&n; * - GPIO2 enables the MII itself so we can talk to it. The MII gets reset&n; *   so any prior MII settings are lost.&n; * - GPIO0 enables the TP port so the MII can talk to the network.&n; * - a software reset will reset both GPIO pins.&n; * I also moved the software reset here, because doing it in xircom_up()&n; * required enabling the GPIO pins each time, which reset the MII each time.&n; * Thus we couldn&squot;t control the MII -- which sucks because we don&squot;t know&n; * how to handle full-duplex modes so we *must* disable them.&n; */
DECL|function|transceiver_voodoo
r_static
r_void
id|transceiver_voodoo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* Reset the chip, holding bit 0 set at least 50 PCI cycles. */
id|outl
c_func
(paren
id|SoftwareReset
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Deassert reset. */
id|outl
c_func
(paren
id|tp-&gt;csr0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
multiline_comment|/* Reset the xcvr interface and turn on heartbeat. */
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* The delays are Xircom-recommended to give the&n;&t;&t;&t;&t; * chipset time to reset the actual hardware&n;&t;&t;&t;&t; * on the PCMCIA card&n;&t;&t;&t;&t; */
id|outl
c_func
(paren
l_int|0xa8050000
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xa00f0000
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
l_int|0
comma
id|ioaddr
)paren
suffix:semicolon
singleline_comment|//outl_CSR6(FullDuplexBit, ioaddr);
)brace
DECL|function|xircom_init_one
r_static
r_int
id|__devinit
id|xircom_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|chip_idx
op_assign
id|id-&gt;driver_data
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u8
id|chip_rev
suffix:semicolon
multiline_comment|/* when built into the kernel, we only print version if device is found */
macro_line|#ifndef MODULE
r_static
r_int
id|printed_version
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|//printk(KERN_INFO &quot;xircom_init_one(%s)&bslash;n&quot;, pdev-&gt;slot_name);
id|board_idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|DRV_NAME
l_string|&quot;%d: cannot alloc etherdev, aborting&bslash;n&quot;
comma
id|board_idx
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|dev-&gt;name
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|DRV_NAME
l_string|&quot; %d: cannot reserve PCI resources, aborting&bslash;n&quot;
comma
id|board_idx
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
multiline_comment|/* Bring the chip out of sleep mode.&n;&t;   Caution: Snooze mode does not work with some boards! */
r_if
c_cond
(paren
id|xircom_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
id|HAS_ACPI
)paren
id|pci_write_config_dword
c_func
(paren
id|pdev
comma
id|PCI_POWERMGMT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|outl_CSR6
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_amp
op_complement
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Clear the missed-packet counter. */
(paren
r_volatile
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|tp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
multiline_comment|/* BugFixes: The 21143-TD hangs with PCI Write-and-Invalidate cycles. */
multiline_comment|/* XXX: is this necessary for Xircom? */
id|tp-&gt;csr0
op_assign
id|csr0
op_amp
op_complement
id|EnableMWI
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|board_idx
op_ge
l_int|0
op_logical_and
id|board_idx
OL
id|MAX_UNITS
)paren
(brace
id|tp-&gt;default_port
op_assign
id|options
(braket
id|board_idx
)braket
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
(paren
id|options
(braket
id|board_idx
)braket
op_amp
l_int|0x90
)paren
op_logical_or
id|full_duplex
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mtu
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|dev-&gt;mtu
op_assign
id|mtu
(braket
id|board_idx
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
id|tp-&gt;default_port
op_assign
id|dev-&gt;mem_start
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;default_port
)paren
(brace
r_if
c_cond
(paren
id|media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaAlwaysFD
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;full_duplex
)paren
id|tp-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
r_else
id|tp-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;speed100
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* The Xircom-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|xircom_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|xircom_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|xircom_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|xircom_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|xircom_ioctl
suffix:semicolon
macro_line|#ifdef HAVE_MULTICAST
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
macro_line|#endif
id|dev-&gt;tx_timeout
op_assign
id|xircom_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|transceiver_voodoo
c_func
(paren
id|dev
)paren
suffix:semicolon
id|read_mac_address
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
r_goto
id|err_out_cleardev
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|chip_rev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s rev %d at %#3lx,&quot;
comma
id|dev-&gt;name
comma
id|xircom_tbl
(braket
id|chip_idx
)braket
dot
id|chip_name
comma
id|chip_rev
comma
id|ioaddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%c%2.2X&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xircom_tbl
(braket
id|chip_idx
)braket
dot
id|flags
op_amp
id|HAS_MII
)paren
(brace
id|find_mii_transceivers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|err_out_cleardev
suffix:colon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_free_netdev
suffix:colon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* MII transceiver control section.&n;   Read and write the MII registers using software-generated serial&n;   MDIO protocol.  See the MII specifications or DP83840A data sheet&n;   for details. */
multiline_comment|/* The maximum data clock rate is 2.5 Mhz.  The minimum timing is usually&n;   met by back-to-back PCI I/O cycles, but we insert a delay to avoid&n;   &quot;overclocking&quot; issues or future 66Mhz PCI. */
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay() inl(mdio_addr)
multiline_comment|/* Read and write the MII registers using software-generated serial&n;   MDIO protocol.  It is just different enough from the EEPROM protocol&n;   to not share code.  The maxium data clock rate is 2.5 Mhz. */
DECL|macro|MDIO_SHIFT_CLK
mdefine_line|#define MDIO_SHIFT_CLK&t;0x10000
DECL|macro|MDIO_DATA_WRITE0
mdefine_line|#define MDIO_DATA_WRITE0 0x00000
DECL|macro|MDIO_DATA_WRITE1
mdefine_line|#define MDIO_DATA_WRITE1 0x20000
DECL|macro|MDIO_ENB
mdefine_line|#define MDIO_ENB&t;&t;0x00000&t;&t;/* Ignore the 0x02000 databook setting. */
DECL|macro|MDIO_ENB_IN
mdefine_line|#define MDIO_ENB_IN&t;&t;0x40000
DECL|macro|MDIO_DATA_READ
mdefine_line|#define MDIO_DATA_READ&t;0x80000
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|read_cmd
op_assign
(paren
l_int|0xf6
op_lshift
l_int|10
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|5
)paren
op_or
id|location
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|mdio_addr
op_assign
id|ioaddr
op_plus
id|CSR9
suffix:semicolon
multiline_comment|/* Establish sync by sending at least 32 logic ones. */
r_for
c_loop
(paren
id|i
op_assign
l_int|32
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|MDIO_DATA_WRITE1
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|MDIO_DATA_WRITE1
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Shift the read command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_DATA_WRITE1
suffix:colon
l_int|0
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|dataval
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the two transition, 16 data, and wire-idle bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|19
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDIO_ENB_IN
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|mdio_addr
)paren
op_amp
id|MDIO_DATA_READ
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB_IN
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
(paren
id|retval
op_rshift
l_int|1
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|cmd
op_assign
(paren
l_int|0x5002
op_lshift
l_int|16
)paren
op_or
(paren
id|phy_id
op_lshift
l_int|23
)paren
op_or
(paren
id|location
op_lshift
l_int|18
)paren
op_or
id|value
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|mdio_addr
op_assign
id|ioaddr
op_plus
id|CSR9
suffix:semicolon
multiline_comment|/* Establish sync by sending 32 logic ones. */
r_for
c_loop
(paren
id|i
op_assign
l_int|32
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|MDIO_DATA_WRITE1
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|MDIO_DATA_WRITE1
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDIO_DATA_WRITE1
suffix:colon
l_int|0
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB
op_or
id|dataval
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear out extra bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDIO_ENB_IN
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO_ENB_IN
op_or
id|MDIO_SHIFT_CLK
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|xircom_up
id|xircom_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Clear the tx ring */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: xircom_up() irq %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;rx_ring
)paren
comma
id|ioaddr
op_plus
id|CSR3
)paren
suffix:semicolon
id|outl
c_func
(paren
id|virt_to_bus
c_func
(paren
id|tp-&gt;tx_ring
)paren
comma
id|ioaddr
op_plus
id|CSR4
)paren
suffix:semicolon
id|tp-&gt;saved_if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|tp-&gt;default_port
suffix:semicolon
id|tp-&gt;csr6
op_assign
id|TxThresh10
multiline_comment|/*| FullDuplexBit*/
suffix:semicolon
multiline_comment|/* XXX: why 10 and not 100? */
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Tx to process setup frame. */
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
comma
id|ioaddr
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTx
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all outstanding interrupts sources */
id|outl
c_func
(paren
id|xircom_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
id|xircom_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
multiline_comment|/* Enable Rx */
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Rx poll demand */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR2
)paren
suffix:semicolon
multiline_comment|/* Tell the net layer we&squot;re ready */
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done xircom_up(), CSR0 %8.8x, CSR5 %8.8x CSR6 %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR0
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|xircom_open
id|xircom_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|xircom_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|xircom_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|xircom_up
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;open
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xircom_tx_timeout
r_static
r_void
id|xircom_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
multiline_comment|/* Do nothing -- the media monitor should handle this. */
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timeout using MII device.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
macro_line|#if defined(way_too_many_messages)
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|3
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
op_star
id|buf
op_assign
(paren
id|u8
op_star
)paren
(paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
)paren
suffix:semicolon
r_int
id|j
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%2d: %8.8x %8.8x %8.8x %8.8x  &quot;
l_string|&quot;%2.2x %2.2x %2.2x.&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
comma
id|buf
(braket
l_int|0
)braket
comma
id|buf
(braket
l_int|1
)braket
comma
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|buf
(braket
id|j
)braket
op_ne
l_int|0xee
op_logical_and
id|j
OL
l_int|1600
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|j
OL
l_int|100
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|buf
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; j=%d.&bslash;n&quot;
comma
id|j
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Stop and restart the chip&squot;s Tx/Rx processes . */
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableRx
comma
id|ioaddr
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|xircom_init_ring
r_static
r_void
id|xircom_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_rx
op_assign
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|PKT_BUF_SZ
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;rx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|tp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|length
op_assign
id|PKT_BUF_SZ
op_or
id|Rx1RingWrap
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;rx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Note the receive buffer must be longword aligned.&n;&t;&t;   dev_alloc_skb() provides 16 byte alignment.  But do *not*&n;&t;&t;   use skb_reserve() to align the IP header! */
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|Rx0DescOwned
suffix:semicolon
multiline_comment|/* Owned by Xircom chip */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;tail
)paren
suffix:semicolon
)brace
id|tp-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* The Tx buffer descriptor is filled in as needed, but we&n;&t;   do need to clear the ownership bit. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;tx_ring
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#ifdef CARDBUS
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|X3201_3
)paren
id|tp-&gt;tx_aligned_skbuff
(braket
id|i
)braket
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
macro_line|#endif /* CARDBUS */
)brace
id|tp-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|virt_to_bus
c_func
(paren
op_amp
id|tp-&gt;tx_ring
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|xircom_start_xmit
id|xircom_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|u32
id|flag
suffix:semicolon
multiline_comment|/* Caution: the write order is important here, set the base address&n;&t;   with the &quot;ownership&quot; bits last. */
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
macro_line|#ifdef CARDBUS
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|X3201_3
)paren
(brace
id|memcpy
c_func
(paren
id|tp-&gt;tx_aligned_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|data
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|virt_to_bus
c_func
(paren
id|tp-&gt;tx_aligned_skbuff
(braket
id|entry
)braket
op_member_access_from_pointer
id|data
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
multiline_comment|/* Typical path */
id|flag
op_assign
id|Tx1WholePkt
suffix:semicolon
multiline_comment|/* No interrupt */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_eq
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
id|flag
op_assign
id|Tx1WholePkt
op_or
id|Tx1ComplIntr
suffix:semicolon
multiline_comment|/* Tx-done intr. */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
id|flag
op_assign
id|Tx1WholePkt
suffix:semicolon
multiline_comment|/* No Tx-done intr. */
)brace
r_else
(brace
multiline_comment|/* Leave room for set_rx_mode() to fill entries. */
id|flag
op_assign
id|Tx1WholePkt
op_or
id|Tx1ComplIntr
suffix:semicolon
multiline_comment|/* Tx-done intr. */
id|tp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|flag
op_or_assign
id|Tx1WholePkt
op_or
id|Tx1ComplIntr
op_or
id|Tx1RingWrap
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|skb-&gt;len
op_or
id|flag
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|Tx0DescOwned
suffix:semicolon
multiline_comment|/* Pass ownership to the chip. */
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tx_full
)paren
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
r_else
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xircom_media_change
r_static
r_void
id|xircom_media_change
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u16
id|reg0
comma
id|reg1
comma
id|reg4
comma
id|reg5
suffix:semicolon
id|u32
id|csr6
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
comma
id|newcsr6
suffix:semicolon
multiline_comment|/* reset status first */
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
)paren
suffix:semicolon
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMSR
)paren
suffix:semicolon
id|reg0
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
)paren
suffix:semicolon
id|reg1
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg1
op_amp
id|BMSR_LSTATUS
)paren
(brace
multiline_comment|/* link is up */
r_if
c_cond
(paren
id|reg0
op_amp
id|BMCR_ANENABLE
)paren
(brace
multiline_comment|/* autonegotiation is enabled */
id|reg4
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|reg5
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_LPA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg4
op_amp
id|ADVERTISE_100FULL
op_logical_and
id|reg5
op_amp
id|LPA_100FULL
)paren
(brace
id|tp-&gt;speed100
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg4
op_amp
id|ADVERTISE_100HALF
op_logical_and
id|reg5
op_amp
id|LPA_100HALF
)paren
(brace
id|tp-&gt;speed100
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|reg4
op_amp
id|ADVERTISE_10FULL
op_logical_and
id|reg5
op_amp
id|LPA_10FULL
)paren
(brace
id|tp-&gt;speed100
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;speed100
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* autonegotiation is disabled */
r_if
c_cond
(paren
id|reg0
op_amp
id|BMCR_SPEED100
)paren
id|tp-&gt;speed100
op_assign
l_int|1
suffix:semicolon
r_else
id|tp-&gt;speed100
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|reg0
op_amp
id|BMCR_FULLDPLX
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_else
id|tp-&gt;full_duplex
op_assign
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Link is up, running at %sMbit %s-duplex&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;speed100
ques
c_cond
l_string|&quot;100&quot;
suffix:colon
l_string|&quot;10&quot;
comma
id|tp-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
id|newcsr6
op_assign
id|csr6
op_amp
op_complement
id|FullDuplexBit
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;full_duplex
)paren
id|newcsr6
op_or_assign
id|FullDuplexBit
suffix:semicolon
r_if
c_cond
(paren
id|newcsr6
op_ne
id|csr6
)paren
id|outl_CSR6
c_func
(paren
id|newcsr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Link is down&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|check_duplex
r_static
r_void
id|check_duplex
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u16
id|reg0
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
comma
id|BMCR_RESET
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_while
c_loop
(paren
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
)paren
op_amp
id|BMCR_RESET
)paren
suffix:semicolon
id|reg0
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_ADVERTISE
comma
id|tp-&gt;advertising
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;autoneg
)paren
(brace
id|reg0
op_and_assign
op_complement
(paren
id|BMCR_SPEED100
op_or
id|BMCR_FULLDPLX
)paren
suffix:semicolon
id|reg0
op_or_assign
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
suffix:semicolon
)brace
r_else
(brace
id|reg0
op_and_assign
op_complement
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;speed100
)paren
id|reg0
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;full_duplex
)paren
id|reg0
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Link forced to %sMbit %s-duplex&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;speed100
ques
c_cond
l_string|&quot;100&quot;
suffix:colon
l_string|&quot;10&quot;
comma
id|tp-&gt;full_duplex
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|MII_BMCR
comma
id|reg0
)paren
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|xircom_interrupt
r_static
r_void
id|xircom_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_instance
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|csr5
comma
id|work_budget
op_assign
id|max_interrupt_work
suffix:semicolon
id|spin_lock
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_do
(brace
id|csr5
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|outl
c_func
(paren
id|csr5
op_amp
l_int|0x0001ffff
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: interrupt  csr5=%#8.8x new csr5=%#8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr5
comma
id|inl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|CSR5
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_eq
l_int|0xffffffff
)paren
r_break
suffix:semicolon
multiline_comment|/* all bits set, assume PCMCIA card removed */
r_if
c_cond
(paren
(paren
id|csr5
op_amp
(paren
id|NormalIntr
op_or
id|AbnormalIntr
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
(paren
id|RxIntr
op_or
id|RxNoBuf
)paren
)paren
id|work_budget
op_sub_assign
id|xircom_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
(paren
id|TxNoBuf
op_or
id|TxDied
op_or
id|TxIntr
)paren
)paren
(brace
r_int
r_int
id|dirty_tx
suffix:semicolon
r_for
c_loop
(paren
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OG
l_int|0
suffix:semicolon
id|dirty_tx
op_increment
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|status
op_assign
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_break
suffix:semicolon
multiline_comment|/* It still hasn&squot;t been Txed */
multiline_comment|/* Check for Rx filter setup frames. */
r_if
c_cond
(paren
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx0DescError
)paren
(brace
multiline_comment|/* There was an major error, log it. */
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Transmit error, Tx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
macro_line|#endif
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx0ManyColl
)paren
(brace
id|tp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
id|tp-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Tx0NoCarrier
)paren
id|tp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx0LateColl
)paren
id|tp-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx0Underflow
)paren
id|tp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|tp-&gt;stats.tx_bytes
op_add_assign
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_amp
l_int|0x7ff
suffix:semicolon
id|tp-&gt;stats.collisions
op_add_assign
(paren
id|status
op_rshift
l_int|3
)paren
op_amp
l_int|15
suffix:semicolon
id|tp-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
id|dev_kfree_skb_irq
c_func
(paren
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OG
id|TX_RING_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Out-of-sync dirty pointer, %d vs. %d, full=%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dirty_tx
comma
id|tp-&gt;cur_tx
comma
id|tp-&gt;tx_full
)paren
suffix:semicolon
id|dirty_tx
op_add_assign
id|TX_RING_SIZE
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|tp-&gt;tx_full
op_logical_and
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OL
id|TX_RING_SIZE
op_minus
l_int|2
)paren
multiline_comment|/* The ring is no longer full */
id|tp-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;tx_full
)paren
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
r_else
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
id|TxDied
)paren
(brace
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: The transmitter stopped.&quot;
l_string|&quot;  CSR5 is %x, CSR6 %x, new CSR6 %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr5
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
comma
id|tp-&gt;csr6
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableRx
comma
id|ioaddr
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Log errors. */
r_if
c_cond
(paren
id|csr5
op_amp
id|AbnormalIntr
)paren
(brace
multiline_comment|/* Abnormal error summary bit. */
r_if
c_cond
(paren
id|csr5
op_amp
id|LinkChange
)paren
id|xircom_media_change
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr5
op_amp
id|TxFIFOUnderflow
)paren
(brace
r_if
c_cond
(paren
(paren
id|tp-&gt;csr6
op_amp
id|TxThreshMask
)paren
op_ne
id|TxThreshMask
)paren
id|tp-&gt;csr6
op_add_assign
(paren
l_int|1
op_lshift
id|TxThreshShift
)paren
suffix:semicolon
multiline_comment|/* Bump up the Tx threshold */
r_else
id|tp-&gt;csr6
op_or_assign
id|TxStoreForw
suffix:semicolon
multiline_comment|/* Store-n-forward. */
multiline_comment|/* Restart the transmit process. */
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableRx
comma
id|ioaddr
)paren
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csr5
op_amp
id|RxDied
)paren
(brace
multiline_comment|/* Missed a Rx frame. */
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|outl_CSR6
c_func
(paren
id|tp-&gt;csr6
op_or
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear all error sources, included undocumented ones! */
id|outl
c_func
(paren
l_int|0x0800f7ba
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|work_budget
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work during an interrupt, &quot;
l_string|&quot;csr5=0x%8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|csr5
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all interrupt sources. */
id|outl
c_func
(paren
l_int|0x8001ffff
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, csr5=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|xircom_rx
id|xircom_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
op_assign
id|tp-&gt;cur_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_int
id|rx_work_limit
op_assign
id|tp-&gt;dirty_rx
op_plus
id|RX_RING_SIZE
op_minus
id|tp-&gt;cur_rx
suffix:semicolon
r_int
id|work_done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; In xircom_rx(), entry %d %8.8x.&bslash;n&quot;
comma
id|entry
comma
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
multiline_comment|/* If we own the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_ge
l_int|0
)paren
(brace
id|s32
id|status
op_assign
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot; In xircom_rx(), entry %d %8.8x.&bslash;n&quot;
comma
id|entry
comma
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|rx_work_limit
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x38008300
)paren
op_ne
l_int|0x0300
)paren
(brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x38000300
)paren
op_ne
l_int|0x0300
)paren
(brace
multiline_comment|/* Ignore earlier buffers. */
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0xffff
)paren
op_ne
l_int|0x7fff
)paren
(brace
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Oversized Ethernet frame &quot;
l_string|&quot;spanned multiple buffers, status %8.8x!&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|Rx0DescError
)paren
(brace
multiline_comment|/* There was a fatal error. */
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Receive error, Rx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* end of a packet.*/
r_if
c_cond
(paren
id|status
op_amp
(paren
id|Rx0Runt
op_or
id|Rx0HugeFrame
)paren
)paren
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Rx0CRCError
)paren
id|tp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Omit the four octet CRC from the length. */
r_int
id|pkt_len
op_assign
(paren
(paren
id|status
op_rshift
l_int|16
)paren
op_amp
l_int|0x7ff
)paren
op_minus
l_int|4
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|pkt_len
OG
l_int|1518
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Bogus packet size of %d (%#x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pkt_len
comma
id|pkt_len
)paren
suffix:semicolon
id|pkt_len
op_assign
l_int|1518
suffix:semicolon
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Check if the packet is long enough to accept without copying&n;&t;&t;&t;   to a minimally-sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
macro_line|#if ! defined(__alpha__)
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|bus_to_virt
c_func
(paren
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|buffer1
)paren
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|bus_to_virt
c_func
(paren
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|buffer1
)paren
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
id|work_done
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Pass up the skb already on the Rx ring. */
id|skb_put
c_func
(paren
id|skb
op_assign
id|tp-&gt;rx_skbuff
(braket
id|entry
)braket
comma
id|pkt_len
)paren
suffix:semicolon
id|tp-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|tp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
id|entry
op_assign
(paren
op_increment
id|tp-&gt;cur_rx
)paren
op_mod
id|RX_RING_SIZE
suffix:semicolon
)brace
multiline_comment|/* Refill the Rx ring buffers. */
r_for
c_loop
(paren
suffix:semicolon
id|tp-&gt;cur_rx
op_minus
id|tp-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|tp-&gt;dirty_rx
op_increment
)paren
(brace
id|entry
op_assign
id|tp-&gt;dirty_rx
op_mod
id|RX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|tp-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|virt_to_bus
c_func
(paren
id|skb-&gt;tail
)paren
suffix:semicolon
id|work_done
op_increment
suffix:semicolon
)brace
id|tp-&gt;rx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|Rx0DescOwned
suffix:semicolon
)brace
r_return
id|work_done
suffix:semicolon
)brace
r_static
r_void
DECL|function|xircom_down
id|xircom_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|outl_CSR6
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_amp
op_complement
id|EnableTxRx
comma
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_ne
l_int|0xffffffff
)paren
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;saved_if_port
suffix:semicolon
)brace
r_static
r_int
DECL|function|xircom_close
id|xircom_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|xircom_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
id|xircom_down
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|tp-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not owned by Xircom chip. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
l_int|0xBADF00D0
suffix:semicolon
multiline_comment|/* An invalid address. */
r_if
c_cond
(paren
id|skb
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
id|dev_kfree_skb
c_func
(paren
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|tp-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|tp-&gt;open
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xircom_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|xircom_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
DECL|function|xircom_ethtool_ioctl
r_static
r_int
id|xircom_ethtool_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|useraddr
)paren
(brace
r_struct
id|ethtool_cmd
id|ecmd
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ecmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ecmd.cmd
)paren
(brace
r_case
id|ETHTOOL_GSET
suffix:colon
id|ecmd.supported
op_assign
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_100baseT_Half
op_or
id|SUPPORTED_100baseT_Full
op_or
id|SUPPORTED_Autoneg
op_or
id|SUPPORTED_MII
suffix:semicolon
id|ecmd.advertising
op_assign
id|ADVERTISED_MII
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_amp
id|ADVERTISE_10HALF
)paren
id|ecmd.advertising
op_or_assign
id|ADVERTISED_10baseT_Half
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_amp
id|ADVERTISE_10FULL
)paren
id|ecmd.advertising
op_or_assign
id|ADVERTISED_10baseT_Full
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_amp
id|ADVERTISE_100HALF
)paren
id|ecmd.advertising
op_or_assign
id|ADVERTISED_100baseT_Half
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_amp
id|ADVERTISE_100FULL
)paren
id|ecmd.advertising
op_or_assign
id|ADVERTISED_100baseT_Full
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;autoneg
)paren
(brace
id|ecmd.advertising
op_or_assign
id|ADVERTISED_Autoneg
suffix:semicolon
id|ecmd.autoneg
op_assign
id|AUTONEG_ENABLE
suffix:semicolon
)brace
r_else
id|ecmd.autoneg
op_assign
id|AUTONEG_DISABLE
suffix:semicolon
id|ecmd.port
op_assign
id|PORT_MII
suffix:semicolon
id|ecmd.transceiver
op_assign
id|XCVR_INTERNAL
suffix:semicolon
id|ecmd.phy_address
op_assign
id|tp-&gt;phys
(braket
l_int|0
)braket
suffix:semicolon
id|ecmd.speed
op_assign
id|tp-&gt;speed100
ques
c_cond
id|SPEED_100
suffix:colon
id|SPEED_10
suffix:semicolon
id|ecmd.duplex
op_assign
id|tp-&gt;full_duplex
ques
c_cond
id|DUPLEX_FULL
suffix:colon
id|DUPLEX_HALF
suffix:semicolon
id|ecmd.maxtxpkt
op_assign
id|TX_RING_SIZE
op_div
l_int|2
suffix:semicolon
id|ecmd.maxrxpkt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|ecmd
comma
r_sizeof
(paren
id|ecmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|ETHTOOL_SSET
suffix:colon
(brace
id|u16
id|autoneg
comma
id|speed100
comma
id|full_duplex
suffix:semicolon
id|autoneg
op_assign
(paren
id|ecmd.autoneg
op_eq
id|AUTONEG_ENABLE
)paren
suffix:semicolon
id|speed100
op_assign
(paren
id|ecmd.speed
op_eq
id|SPEED_100
)paren
suffix:semicolon
id|full_duplex
op_assign
(paren
id|ecmd.duplex
op_eq
id|DUPLEX_FULL
)paren
suffix:semicolon
id|tp-&gt;autoneg
op_assign
id|autoneg
suffix:semicolon
r_if
c_cond
(paren
id|speed100
op_ne
id|tp-&gt;speed100
op_logical_or
id|full_duplex
op_ne
id|tp-&gt;full_duplex
)paren
(brace
id|tp-&gt;speed100
op_assign
id|speed100
suffix:semicolon
id|tp-&gt;full_duplex
op_assign
id|full_duplex
suffix:semicolon
multiline_comment|/* change advertising bits */
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_and_assign
op_complement
(paren
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|speed100
)paren
(brace
r_if
c_cond
(paren
id|full_duplex
)paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
r_else
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|full_duplex
)paren
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_else
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
)brace
)brace
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
id|info.cmd
op_assign
id|ecmd.cmd
suffix:semicolon
id|strcpy
c_func
(paren
id|info.driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info.version
comma
id|DRV_VERSION
)paren
suffix:semicolon
op_star
id|info.fw_version
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|info.bus_info
comma
id|tp-&gt;pdev-&gt;slot_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
multiline_comment|/* Provide ioctl() calls to examine the MII xcvr state. */
DECL|function|xircom_ioctl
r_static
r_int
id|xircom_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_int
id|phy
op_assign
id|tp-&gt;phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|xircom_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
multiline_comment|/* Legacy mii-diag interface */
r_case
id|SIOCGMIIPHY
suffix:colon
multiline_comment|/* Get address of MII PHY in use. */
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
id|data
(braket
l_int|0
)braket
op_assign
id|phy
suffix:semicolon
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCGMIIREG
suffix:colon
multiline_comment|/* Read MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
multiline_comment|/* Write MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
(braket
l_int|0
)braket
op_eq
id|tp-&gt;phys
(braket
l_int|0
)braket
)paren
(brace
id|u16
id|value
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|data
(braket
l_int|1
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|value
op_amp
(paren
id|BMCR_RESET
op_or
id|BMCR_ANENABLE
)paren
)paren
multiline_comment|/* Autonegotiation. */
id|tp-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|tp-&gt;full_duplex
op_assign
(paren
id|value
op_amp
id|BMCR_FULLDPLX
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tp-&gt;advertising
(braket
l_int|0
)braket
op_assign
id|value
suffix:semicolon
r_break
suffix:semicolon
)brace
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|1
)braket
op_amp
l_int|0x1f
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* The little-endian AUTODIN32 ethernet CRC calculation.&n;   N.B. Do not use for bulk data, use a table-based routine instead.&n;   This is common code and should be moved to net/core/crc.c */
DECL|variable|ethernet_polynomial_le
r_static
r_int
r_const
id|ethernet_polynomial_le
op_assign
l_int|0xedb88320U
suffix:semicolon
DECL|function|ether_crc_le
r_static
r_inline
id|u32
id|ether_crc_le
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
id|u32
id|crc
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Initial value. */
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|8
suffix:semicolon
op_decrement
id|bit
op_ge
l_int|0
suffix:semicolon
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|crc
op_xor
id|current_octet
)paren
op_amp
l_int|1
)paren
(brace
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
id|crc
op_xor_assign
id|ethernet_polynomial_le
suffix:semicolon
)brace
r_else
id|crc
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   Note that we only use exclusion around actually queueing the&n;   new frame, not around filling tp-&gt;setup_frame.  This is non-deterministic&n;   when re-entered but still correct. */
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|csr6
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|u16
op_star
id|eaddrs
comma
op_star
id|setup_frm
suffix:semicolon
id|u32
id|tx_flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;csr6
op_and_assign
op_complement
(paren
id|AllMultiBit
op_or
id|PromiscBit
op_or
id|HashFilterBit
)paren
suffix:semicolon
id|csr6
op_and_assign
op_complement
(paren
id|AllMultiBit
op_or
id|PromiscBit
op_or
id|HashFilterBit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|tp-&gt;csr6
op_or_assign
id|PromiscBit
suffix:semicolon
id|csr6
op_or_assign
id|PromiscBit
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
l_int|1000
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter well -- accept all multicasts. */
id|tp-&gt;csr6
op_or_assign
id|AllMultiBit
suffix:semicolon
id|csr6
op_or_assign
id|AllMultiBit
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|tx_flags
op_assign
id|Tx1WholePkt
op_or
id|Tx1SetupPkt
op_or
id|PKT_SETUP_SZ
suffix:semicolon
multiline_comment|/* Note that only the low-address shortword of setup_frame is valid! */
id|setup_frm
op_assign
id|tp-&gt;setup_frame
suffix:semicolon
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
multiline_comment|/* Fill the first entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|14
)paren
(brace
multiline_comment|/* Must use a multicast hash table. */
id|u32
op_star
id|hash_table
op_assign
(paren
id|u32
op_star
)paren
(paren
id|tp-&gt;setup_frame
op_plus
l_int|4
op_star
l_int|12
)paren
suffix:semicolon
id|u32
id|hash
comma
id|hash2
suffix:semicolon
id|tx_flags
op_or_assign
id|Tx1HashSetup
suffix:semicolon
id|tp-&gt;csr6
op_or_assign
id|HashFilterBit
suffix:semicolon
id|csr6
op_or_assign
id|HashFilterBit
suffix:semicolon
multiline_comment|/* Fill the unused 3 entries with the broadcast address.&n;&t;&t;   At least one entry *must* contain the broadcast address!!!*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/* Truly brain-damaged hash filter layout */
multiline_comment|/* XXX: not sure if I should take the last or the first 9 bits */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|u32
op_star
id|hptr
suffix:semicolon
id|hash
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_amp
l_int|0x1ff
suffix:semicolon
r_if
c_cond
(paren
id|hash
OL
l_int|384
)paren
(brace
id|hash2
op_assign
id|hash
op_plus
(paren
(paren
id|hash
op_rshift
l_int|4
)paren
op_lshift
l_int|4
)paren
op_plus
(paren
(paren
id|hash
op_rshift
l_int|5
)paren
op_lshift
l_int|5
)paren
suffix:semicolon
)brace
r_else
(brace
id|hash
op_sub_assign
l_int|384
suffix:semicolon
id|hash2
op_assign
l_int|64
op_plus
id|hash
op_plus
(paren
id|hash
op_rshift
l_int|4
)paren
op_star
l_int|80
suffix:semicolon
)brace
id|hptr
op_assign
op_amp
id|hash_table
(braket
id|hash2
op_amp
op_complement
l_int|0x1f
)braket
suffix:semicolon
op_star
id|hptr
op_or_assign
id|cpu_to_le32
c_func
(paren
l_int|1
op_lshift
(paren
id|hash2
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* We have &lt;= 14 mcast addresses so we can use Xircom&squot;s&n;&t;&t;   wonderful 16-address perfect filter. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|mclist-&gt;dmi_addr
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
id|cpu_to_le16
c_func
(paren
id|eaddrs
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/* Fill the unused entries with the broadcast address.&n;&t;&t;   At least one entry *must* contain the broadcast address!!!*/
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
l_int|15
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
op_star
id|setup_frm
op_assign
l_int|0xffff
suffix:semicolon
id|setup_frm
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
multiline_comment|/* Now add this frame to the Tx list. */
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OG
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
multiline_comment|/* Same setup recently queued, we need not add it. */
multiline_comment|/* XXX: Huh? All it means is that the Tx list is full...*/
)brace
r_else
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
id|dummy
op_assign
op_minus
l_int|1
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Avoid a chip errata by prefixing a dummy entry. */
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
ques
c_cond
id|Tx1RingWrap
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* race with chip, set Tx0DescOwned later */
id|dummy
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
)brace
id|tp-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|tx_flags
op_or_assign
id|Tx1RingWrap
suffix:semicolon
multiline_comment|/* Wrap ring. */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|tx_flags
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|virt_to_bus
c_func
(paren
id|tp-&gt;setup_frame
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|Tx0DescOwned
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_ge
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
id|tp-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dummy
op_ge
l_int|0
)paren
id|tp-&gt;tx_ring
(braket
id|dummy
)braket
dot
id|status
op_assign
id|Tx0DescOwned
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|outl_CSR6
c_func
(paren
id|csr6
comma
id|ioaddr
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|xircom_pci_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x115D
comma
l_int|0x0003
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|X3201_3
)brace
comma
(brace
l_int|0
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|xircom_pci_table
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|function|xircom_suspend
r_static
r_int
id|xircom_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;xircom_suspend(%s)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;open
)paren
id|xircom_down
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xircom_resume
r_static
r_int
id|xircom_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
r_struct
id|xircom_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;xircom_resume(%s)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Bring the chip out of sleep mode.&n;&t;   Caution: Snooze mode does not work with some boards! */
r_if
c_cond
(paren
id|xircom_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|flags
op_amp
id|HAS_ACPI
)paren
id|pci_write_config_dword
c_func
(paren
id|tp-&gt;pdev
comma
id|PCI_POWERMGMT
comma
l_int|0
)paren
suffix:semicolon
id|transceiver_voodoo
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xircom_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|flags
op_amp
id|HAS_MII
)paren
id|check_duplex
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;open
)paren
id|xircom_up
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|function|xircom_remove_one
r_static
r_void
id|__devexit
id|xircom_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pdev-&gt;driver_data
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;xircom_remove_one(%s)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|xircom_driver
r_static
r_struct
id|pci_driver
id|xircom_driver
op_assign
(brace
id|name
suffix:colon
id|DRV_NAME
comma
id|id_table
suffix:colon
id|xircom_pci_table
comma
id|probe
suffix:colon
id|xircom_init_one
comma
id|remove
suffix:colon
id|xircom_remove_one
comma
macro_line|#ifdef CONFIG_PM
id|suspend
suffix:colon
id|xircom_suspend
comma
id|resume
suffix:colon
id|xircom_resume
macro_line|#endif /* CONFIG_PM */
)brace
suffix:semicolon
DECL|function|xircom_init
r_static
r_int
id|__init
id|xircom_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* when a module, this is printed whether or not devices are found in probe */
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|xircom_driver
)paren
suffix:semicolon
)brace
DECL|function|xircom_exit
r_static
r_void
id|__exit
id|xircom_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|xircom_driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|xircom_init
)paren
id|module_exit
c_func
(paren
id|xircom_exit
)paren
multiline_comment|/*&n; * Local variables:&n; *  c-indent-level: 4&n; *  c-basic-offset: 4&n; *  tab-width: 4&n; * End:&n; */
eof
