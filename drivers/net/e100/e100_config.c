multiline_comment|/*******************************************************************************&n;&n;  &n;  Copyright(c) 1999 - 2002 Intel Corporation. All rights reserved.&n;  &n;  This program is free software; you can redistribute it and/or modify it &n;  under the terms of the GNU General Public License as published by the Free &n;  Software Foundation; either version 2 of the License, or (at your option) &n;  any later version.&n;  &n;  This program is distributed in the hope that it will be useful, but WITHOUT &n;  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or &n;  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for &n;  more details.&n;  &n;  You should have received a copy of the GNU General Public License along with&n;  this program; if not, write to the Free Software Foundation, Inc., 59 &n;  Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n;  &n;  The full GNU General Public License is included in this distribution in the&n;  file called LICENSE.&n;  &n;  Contact Information:&n;  Linux NICS &lt;linux.nics@intel.com&gt;&n;  Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497&n;*******************************************************************************/
multiline_comment|/**********************************************************************&n;*                                                                     *&n;* INTEL CORPORATION                                                   *&n;*                                                                     *&n;* This software is supplied under the terms of the license included   *&n;* above.  All use of this driver must be in accordance with the terms *&n;* of that license.                                                    *&n;*                                                                     *&n;* Module Name:  e100_config.c                                         *&n;*                                                                     *&n;* Abstract:     Functions for configuring the network adapter.        *&n;*                                                                     *&n;* Environment:  This file is intended to be specific to the Linux     *&n;*               operating system.                                     *&n;*                                                                     *&n;**********************************************************************/
macro_line|#include &quot;e100_config.h&quot;
r_static
r_void
id|e100_config_long_rx
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
suffix:semicolon
DECL|variable|def_config
r_static
r_const
id|u8
id|def_config
(braket
)braket
op_assign
(brace
id|CB_CFIG_BYTE_COUNT
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x32
comma
l_int|0x07
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x2e
comma
l_int|0x00
comma
l_int|0x60
comma
l_int|0x00
comma
l_int|0xf2
comma
l_int|0xc8
comma
l_int|0x00
comma
l_int|0x40
comma
l_int|0xf2
comma
l_int|0x80
comma
l_int|0x3f
comma
l_int|0x05
)brace
suffix:semicolon
multiline_comment|/**&n; * e100_config_init_82557 - config the 82557 adapter&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This routine will initialize the 82557 configure block.&n; * All other init functions will only set values that are&n; * different from the 82557 default.&n; */
r_static
r_void
id|__devinit
DECL|function|e100_config_init_82557
id|e100_config_init_82557
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
multiline_comment|/* initialize config block */
id|memcpy
c_func
(paren
id|bdp-&gt;config
comma
id|def_config
comma
r_sizeof
(paren
id|def_config
)paren
)paren
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|0
)braket
op_assign
id|CB_CFIG_BYTE_COUNT
suffix:semicolon
multiline_comment|/* just in case */
id|e100_config_ifs
c_func
(paren
id|bdp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable extended statistical counters (82558 and up) and TCO counters&n;&t; * (82559 and up) and set the statistical counters&squot; mode in bdp &n;&t; *  &n;&t; *  stat. mode      |    TCO stat. bit (2)  |  Extended stat. bit (5)&n;&t; * ------------------------------------------------------------------&n;&t; *  Basic (557)     |       0               |         1&n;&t; * ------------------------------------------------------------------&n;&t; *  Extended (558)  |       0               |         0&n;&t; * ------------------------------------------------------------------&n;&t; *  TCO (559)       |       1               |         1&n;&t; * ------------------------------------------------------------------&n;&t; *  Reserved        |       1               |         0&n;&t; * ------------------------------------------------------------------&n;&t; */
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
op_complement
id|CB_CFIG_TCO_STAT
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|6
)braket
op_or_assign
id|CB_CFIG_EXT_STAT_DIS
suffix:semicolon
id|bdp-&gt;stat_mode
op_assign
id|E100_BASIC_STATS
suffix:semicolon
multiline_comment|/* Setup for MII or 503 operation.  The CRS+CDT bit should only be set */
multiline_comment|/* when operating in 503 mode. */
r_if
c_cond
(paren
id|bdp-&gt;phy_addr
op_eq
l_int|32
)paren
(brace
id|bdp-&gt;config
(braket
l_int|8
)braket
op_and_assign
op_complement
id|CB_CFIG_503_MII
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|15
)braket
op_or_assign
id|CB_CFIG_CRS_OR_CDT
suffix:semicolon
)brace
r_else
(brace
id|bdp-&gt;config
(braket
l_int|8
)braket
op_or_assign
id|CB_CFIG_503_MII
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|15
)braket
op_and_assign
op_complement
id|CB_CFIG_CRS_OR_CDT
suffix:semicolon
)brace
id|e100_config_fc
c_func
(paren
id|bdp
)paren
suffix:semicolon
id|e100_config_force_dplx
c_func
(paren
id|bdp
)paren
suffix:semicolon
id|e100_config_promisc
c_func
(paren
id|bdp
comma
l_bool|false
)paren
suffix:semicolon
id|e100_config_mulcast_enbl
c_func
(paren
id|bdp
comma
l_bool|false
)paren
suffix:semicolon
)brace
r_static
r_void
id|__devinit
DECL|function|e100_config_init_82558
id|e100_config_init_82558
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
multiline_comment|/* MWI enable. This should be turned on only if the adapter is a 82558/9&n;&t; * and if the PCI command reg. has enabled the MWI bit. */
id|bdp-&gt;config
(braket
l_int|3
)braket
op_or_assign
id|CB_CFIG_MWI_EN
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
op_complement
id|CB_CFIG_EXT_TCB_DIS
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;rev_id
op_ge
id|D101MA_REV_ID
)paren
(brace
multiline_comment|/* this is 82559 and up - enable TCO counters */
id|bdp-&gt;config
(braket
l_int|6
)braket
op_or_assign
id|CB_CFIG_TCO_STAT
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|6
)braket
op_or_assign
id|CB_CFIG_EXT_STAT_DIS
suffix:semicolon
id|bdp-&gt;stat_mode
op_assign
id|E100_TCO_STATS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bdp-&gt;rev_id
OL
id|D102_REV_ID
)paren
op_logical_and
(paren
id|bdp-&gt;params.b_params
op_amp
id|PRM_XSUMRX
)paren
op_logical_and
(paren
id|bdp-&gt;pdev-&gt;device
op_ne
l_int|0x1209
)paren
)paren
(brace
id|bdp-&gt;flags
op_or_assign
id|DF_CSUM_OFFLOAD
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|9
)braket
op_or_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* this is 82558 */
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
op_complement
id|CB_CFIG_TCO_STAT
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
op_complement
id|CB_CFIG_EXT_STAT_DIS
suffix:semicolon
id|bdp-&gt;stat_mode
op_assign
id|E100_EXTENDED_STATS
suffix:semicolon
)brace
id|e100_config_long_rx
c_func
(paren
id|bdp
comma
l_bool|true
)paren
suffix:semicolon
)brace
r_static
r_void
id|__devinit
DECL|function|e100_config_init_82550
id|e100_config_init_82550
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
multiline_comment|/* The D102 chip allows for 32 config bytes.  This value is&n;&t; * supposed to be in Byte 0.  Just add the extra bytes to&n;&t; * what was already setup in the block. */
id|bdp-&gt;config
(braket
l_int|0
)braket
op_add_assign
id|CB_CFIG_D102_BYTE_COUNT
suffix:semicolon
multiline_comment|/* now we need to enable the extended RFD.  When this is&n;&t; * enabled, the immediated receive data buffer starts at offset&n;&t; * 32 from the RFD base address, instead of at offset 16. */
id|bdp-&gt;config
(braket
l_int|7
)braket
op_or_assign
id|CB_CFIG_EXTENDED_RFD
suffix:semicolon
multiline_comment|/* put the chip into D102 receive mode.  This is neccessary&n;&t; * for any parsing and offloading features. */
id|bdp-&gt;config
(braket
l_int|22
)braket
op_assign
id|CB_CFIG_RECEIVE_GAMLA_MODE
suffix:semicolon
multiline_comment|/* set the flag if checksum offloading was enabled */
r_if
c_cond
(paren
id|bdp-&gt;params.b_params
op_amp
id|PRM_XSUMRX
)paren
(brace
id|bdp-&gt;flags
op_or_assign
id|DF_CSUM_OFFLOAD
suffix:semicolon
)brace
)brace
multiline_comment|/* Initialize the adapter&squot;s configure block */
r_void
id|__devinit
DECL|function|e100_config_init
id|e100_config_init
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|e100_config_init_82557
c_func
(paren
id|bdp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;flags
op_amp
id|IS_BACHELOR
)paren
id|e100_config_init_82558
c_func
(paren
id|bdp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;rev_id
op_ge
id|D102_REV_ID
)paren
id|e100_config_init_82550
c_func
(paren
id|bdp
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_force_config - force a configure command&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This routine will force a configure command to the adapter.&n; * The command will be executed in polled mode as interrupts&n; * are _disabled_ at this time.&n; *&n; * Returns:&n; *      true: if the configure command was successfully issued and completed&n; *      false: otherwise&n; */
r_int
r_char
DECL|function|e100_force_config
id|e100_force_config
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|0
)braket
op_assign
id|CB_CFIG_BYTE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;rev_id
op_ge
id|D102_REV_ID
)paren
(brace
multiline_comment|/* The D102 chip allows for 32 config bytes.  This value is&n;&t;&t;   supposed to be in Byte 0.  Just add the extra bytes to&n;&t;&t;   what was already setup in the block. */
id|bdp-&gt;config
(braket
l_int|0
)braket
op_add_assign
id|CB_CFIG_D102_BYTE_COUNT
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
singleline_comment|// although we call config outside the lock, there is no
singleline_comment|// race condition because config byte count has maximum value
r_return
id|e100_config
c_func
(paren
id|bdp
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config - issue a configure command&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This routine will issue a configure command to the 82557.&n; * This command will be executed in polled mode as interrupts&n; * are _disabled_ at this time.&n; *&n; * Returns:&n; *      true: if the configure command was successfully issued and completed&n; *      false: otherwise&n; */
r_int
r_char
DECL|function|e100_config
id|e100_config
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|cb_header_t
op_star
id|pntcb_hdr
suffix:semicolon
r_int
r_char
id|res
op_assign
l_bool|true
suffix:semicolon
id|nxmit_cb_entry_t
op_star
id|cmd
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cmd
op_assign
id|e100_alloc_non_tx_cmd
c_func
(paren
id|bdp
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|res
op_assign
l_bool|false
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|pntcb_hdr
op_assign
(paren
id|cb_header_t
op_star
)paren
id|cmd-&gt;non_tx_cmd
suffix:semicolon
id|pntcb_hdr-&gt;cb_cmd
op_assign
id|__constant_cpu_to_le16
c_func
(paren
id|CB_CONFIGURE
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|bdp-&gt;config_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|0
)braket
OL
id|CB_CFIG_MIN_PARAMS
)paren
(brace
id|bdp-&gt;config
(braket
l_int|0
)braket
op_assign
id|CB_CFIG_MIN_PARAMS
suffix:semicolon
)brace
multiline_comment|/* Copy the device&squot;s config block to the device&squot;s memory */
id|memcpy
c_func
(paren
id|cmd-&gt;non_tx_cmd-&gt;ntcb.config.cfg_byte
comma
id|bdp-&gt;config
comma
id|bdp-&gt;config
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* reset number of bytes to config next time */
id|bdp-&gt;config
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|bdp-&gt;config_lock
)paren
suffix:semicolon
id|res
op_assign
id|e100_exec_non_cu_cmd
c_func
(paren
id|bdp
comma
id|cmd
)paren
suffix:semicolon
m_exit
suffix:colon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|bdp-&gt;device
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|bdp-&gt;device
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_fc - config flow-control state&n; * @bdp: adapter&squot;s private data struct&n; *&n; * This routine will enable or disable flow control support in the adapter&squot;s&n; * config block. Flow control will be enable only if requested using the command&n; * line option, and if the link is flow-contorl capable (both us and the link&n; * partner). But, if link partner is capable of autoneg, but not capable of&n; * flow control, received PAUSE&t;frames are still honored.&n; */
r_void
DECL|function|e100_config_fc
id|e100_config_fc
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
r_int
r_char
id|enable
op_assign
l_bool|false
suffix:semicolon
multiline_comment|/* 82557 doesn&squot;t support fc. Don&squot;t touch this option */
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;flags
op_amp
id|IS_BACHELOR
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Enable fc if requested and if the link supports it */
r_if
c_cond
(paren
(paren
id|bdp-&gt;params.b_params
op_amp
id|PRM_FC
)paren
op_logical_and
(paren
id|bdp-&gt;flags
op_amp
(paren
id|DF_LINK_FC_CAP
op_or
id|DF_LINK_FC_TX_ONLY
)paren
)paren
)paren
(brace
id|enable
op_assign
l_bool|true
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
id|bdp-&gt;flags
op_amp
id|DF_LINK_FC_TX_ONLY
)paren
(brace
multiline_comment|/* If link partner is capable of autoneg, but  */
multiline_comment|/* not capable of flow control, Received PAUSE */
multiline_comment|/* frames are still honored, i.e.,             */
multiline_comment|/* transmitted frames would be paused by       */
multiline_comment|/* incoming PAUSE frames                       */
id|bdp-&gt;config
(braket
l_int|16
)braket
op_assign
id|DFLT_NO_FC_DELAY_LSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|17
)braket
op_assign
id|DFLT_NO_FC_DELAY_MSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
op_complement
(paren
id|CB_CFIG_FC_RESTOP
op_or
id|CB_CFIG_FC_RESTART
)paren
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_or_assign
id|CB_CFIG_FC_REJECT
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
op_complement
id|CB_CFIG_TX_FC_DIS
suffix:semicolon
)brace
r_else
(brace
id|bdp-&gt;config
(braket
l_int|16
)braket
op_assign
id|DFLT_FC_DELAY_LSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|17
)braket
op_assign
id|DFLT_FC_DELAY_MSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_or_assign
id|CB_CFIG_FC_OPTS
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
op_complement
id|CB_CFIG_TX_FC_DIS
suffix:semicolon
)brace
)brace
r_else
(brace
id|bdp-&gt;config
(braket
l_int|16
)braket
op_assign
id|DFLT_NO_FC_DELAY_LSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|17
)braket
op_assign
id|DFLT_NO_FC_DELAY_MSB
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
op_complement
id|CB_CFIG_FC_OPTS
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|19
)braket
op_or_assign
id|CB_CFIG_TX_FC_DIS
suffix:semicolon
)brace
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|19
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_promisc - configure promiscuous mode&n; * @bdp: atapter&squot;s private data struct&n; * @enable: should we enable this option or not&n; *&n; * This routine will enable or disable promiscuous mode&n; * in the adapter&squot;s config block.&n; */
r_void
DECL|function|e100_config_promisc
id|e100_config_promisc
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
multiline_comment|/* if in promiscuous mode, save bad frames */
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|6
)braket
op_amp
id|CB_CFIG_SAVE_BAD_FRAMES
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|6
)braket
op_or_assign
id|CB_CFIG_SAVE_BAD_FRAMES
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|6
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|7
)braket
op_amp
(paren
id|u8
)paren
id|BIT_0
)paren
(brace
id|bdp-&gt;config
(braket
l_int|7
)braket
op_and_assign
(paren
id|u8
)paren
(paren
op_complement
id|BIT_0
)paren
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|7
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|15
)braket
op_amp
id|CB_CFIG_PROMISCUOUS
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|15
)braket
op_or_assign
id|CB_CFIG_PROMISCUOUS
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|15
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* not in promiscuous mode */
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|6
)braket
op_amp
id|CB_CFIG_SAVE_BAD_FRAMES
)paren
(brace
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
op_complement
id|CB_CFIG_SAVE_BAD_FRAMES
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|6
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|7
)braket
op_amp
(paren
id|u8
)paren
id|BIT_0
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|7
)braket
op_or_assign
(paren
id|u8
)paren
(paren
id|BIT_0
)paren
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|7
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|15
)braket
op_amp
id|CB_CFIG_PROMISCUOUS
)paren
(brace
id|bdp-&gt;config
(braket
l_int|15
)braket
op_and_assign
op_complement
id|CB_CFIG_PROMISCUOUS
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|15
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_mulcast_enbl - configure allmulti mode&n; * @bdp: atapter&squot;s private data struct&n; * @enable: should we enable this option or not&n; *&n; * This routine will enable or disable reception of all multicast packets&n; * in the adapter&squot;s config block.&n; */
r_void
DECL|function|e100_config_mulcast_enbl
id|e100_config_mulcast_enbl
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
multiline_comment|/* this flag is used to enable receiving all multicast packet */
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|21
)braket
op_amp
id|CB_CFIG_MULTICAST_ALL
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|21
)braket
op_or_assign
id|CB_CFIG_MULTICAST_ALL
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|21
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|21
)braket
op_amp
id|CB_CFIG_MULTICAST_ALL
)paren
(brace
id|bdp-&gt;config
(braket
l_int|21
)braket
op_and_assign
op_complement
id|CB_CFIG_MULTICAST_ALL
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|21
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_ifs - configure the IFS parameter&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This routine will configure the adaptive IFS value&n; * in the adapter&squot;s config block. IFS values are only&n; * relevant in half duplex, so set to 0 in full duplex.&n; */
r_void
DECL|function|e100_config_ifs
id|e100_config_ifs
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|u8
id|value
op_assign
l_int|0
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
multiline_comment|/* IFS value is only needed to be specified at half-duplex mode */
r_if
c_cond
(paren
id|bdp-&gt;cur_dplx_mode
op_eq
id|HALF_DUPLEX
)paren
(brace
id|value
op_assign
(paren
id|u8
)paren
id|bdp-&gt;ifs_value
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|2
)braket
op_ne
id|value
)paren
(brace
id|bdp-&gt;config
(braket
l_int|2
)braket
op_assign
id|value
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|2
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_force_dplx - configure the forced full duplex mode&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This routine will enable or disable force full duplex&n; * in the adapter&squot;s config block. If the PHY is 503, and&n; * the duplex is full, consider the adapter forced.&n; */
r_void
DECL|function|e100_config_force_dplx
id|e100_config_force_dplx
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
multiline_comment|/* We must force full duplex on if we are using PHY 0, and we are */
multiline_comment|/* supposed to run in FDX mode. We do this because the e100 has only */
multiline_comment|/* one FDX# input pin, and that pin will be connected to PHY 1. */
multiline_comment|/* Changed the &squot;if&squot; condition below to fix performance problem * at 10&n;&t; * full. The Phy was getting forced to full duplex while the MAC * was&n;&t; * not, because the cur_dplx_mode was not being set to 2 by SetupPhy. *&n;&t; * This is how the condition was, initially. * This has been changed so&n;&t; * that the MAC gets forced to full duplex * simply if the user has&n;&t; * forced full duplex. * * if (( bdp-&gt;phy_addr == 0 ) &amp;&amp; (&n;&t; * bdp-&gt;cur_dplx_mode == 2 )) */
multiline_comment|/* The rest of the fix is in the PhyDetect code. */
r_if
c_cond
(paren
(paren
id|bdp-&gt;params.e100_speed_duplex
op_eq
id|E100_SPEED_10_FULL
)paren
op_logical_or
(paren
id|bdp-&gt;params.e100_speed_duplex
op_eq
id|E100_SPEED_100_FULL
)paren
op_logical_or
(paren
(paren
id|bdp-&gt;phy_addr
op_eq
l_int|32
)paren
op_logical_and
(paren
id|bdp-&gt;cur_dplx_mode
op_eq
id|FULL_DUPLEX
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|19
)braket
op_amp
(paren
id|u8
)paren
id|CB_CFIG_FORCE_FDX
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|19
)braket
op_or_assign
(paren
id|u8
)paren
id|CB_CFIG_FORCE_FDX
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|19
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|19
)braket
op_amp
(paren
id|u8
)paren
id|CB_CFIG_FORCE_FDX
)paren
(brace
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
(paren
id|u8
)paren
(paren
op_complement
id|CB_CFIG_FORCE_FDX
)paren
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|19
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_long_rx&n; * @bdp: atapter&squot;s private data struct&n; * @enable: should we enable this option or not&n; *&n; * This routine will enable or disable reception of larger packets.&n; * This is needed by VLAN implementations.&n; */
r_static
r_void
DECL|function|e100_config_long_rx
id|e100_config_long_rx
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
(brace
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|18
)braket
op_amp
id|CB_CFIG_LONG_RX_OK
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|18
)braket
op_or_assign
id|CB_CFIG_LONG_RX_OK
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|18
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|bdp-&gt;config
(braket
l_int|18
)braket
op_amp
id|CB_CFIG_LONG_RX_OK
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|18
)braket
op_and_assign
op_complement
id|CB_CFIG_LONG_RX_OK
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|18
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/**&n; * e100_config_wol&n; * @bdp: atapter&squot;s private data struct&n; *&n; * This sets configuration options for PHY and Magic Packet WoL &n; */
r_void
DECL|function|e100_config_wol
id|e100_config_wol
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdp-&gt;wolopts
op_amp
id|WAKE_PHY
)paren
(brace
id|bdp-&gt;config
(braket
l_int|9
)braket
op_or_assign
id|CB_LINK_STATUS_WOL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable PHY WoL */
id|bdp-&gt;config
(braket
l_int|9
)braket
op_and_assign
op_complement
id|CB_LINK_STATUS_WOL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bdp-&gt;wolopts
op_amp
id|WAKE_MAGIC
)paren
(brace
id|bdp-&gt;config
(braket
l_int|19
)braket
op_and_assign
op_complement
id|CB_DISABLE_MAGPAK_WAKE
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable Magic Packet WoL */
id|bdp-&gt;config
(braket
l_int|19
)braket
op_or_assign
id|CB_DISABLE_MAGPAK_WAKE
suffix:semicolon
)brace
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|19
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * e100_config_loopback_mode&n; * @bdp: atapter&squot;s private data struct&n; * @mode: loopback mode(phy/mac/none)&n; *&n; */
r_int
r_char
DECL|function|e100_config_loopback_mode
id|e100_config_loopback_mode
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
id|u8
id|mode
)paren
(brace
r_int
r_char
id|bc_changed
op_assign
l_bool|false
suffix:semicolon
id|u8
id|config_byte
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|NO_LOOPBACK
suffix:colon
id|config_byte
op_assign
id|CB_CFIG_LOOPBACK_NORMAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MAC_LOOPBACK
suffix:colon
id|config_byte
op_assign
id|CB_CFIG_LOOPBACK_INTERNAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PHY_LOOPBACK
suffix:colon
id|config_byte
op_assign
id|CB_CFIG_LOOPBACK_EXTERNAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;e100: e100_config_loopback_mode: &quot;
l_string|&quot;Invalid argument &squot;mode&squot;: %d&bslash;n&quot;
comma
id|mode
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bdp-&gt;config
(braket
l_int|10
)braket
op_amp
id|CB_CFIG_LOOPBACK_MODE
)paren
op_ne
id|config_byte
)paren
(brace
id|bdp-&gt;config
(braket
l_int|10
)braket
op_and_assign
(paren
op_complement
id|CB_CFIG_LOOPBACK_MODE
)paren
suffix:semicolon
id|bdp-&gt;config
(braket
l_int|10
)braket
op_or_assign
id|config_byte
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|10
)paren
suffix:semicolon
id|bc_changed
op_assign
l_bool|true
suffix:semicolon
)brace
m_exit
suffix:colon
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_return
id|bc_changed
suffix:semicolon
)brace
r_int
r_char
DECL|function|e100_config_tcb_ext_enable
id|e100_config_tcb_ext_enable
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
(brace
r_int
r_char
id|bc_changed
op_assign
l_bool|false
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|6
)braket
op_amp
id|CB_CFIG_EXT_TCB_DIS
)paren
(brace
id|bdp-&gt;config
(braket
l_int|6
)braket
op_and_assign
(paren
op_complement
id|CB_CFIG_EXT_TCB_DIS
)paren
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|6
)paren
suffix:semicolon
id|bc_changed
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|6
)braket
op_amp
id|CB_CFIG_EXT_TCB_DIS
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|6
)braket
op_or_assign
id|CB_CFIG_EXT_TCB_DIS
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|6
)paren
suffix:semicolon
id|bc_changed
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_return
id|bc_changed
suffix:semicolon
)brace
r_int
r_char
DECL|function|e100_config_dynamic_tbd
id|e100_config_dynamic_tbd
c_func
(paren
r_struct
id|e100_private
op_star
id|bdp
comma
r_int
r_char
id|enable
)paren
(brace
r_int
r_char
id|bc_changed
op_assign
l_bool|false
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bdp-&gt;config
(braket
l_int|7
)braket
op_amp
id|CB_CFIG_DYNTBD_EN
)paren
)paren
(brace
id|bdp-&gt;config
(braket
l_int|7
)braket
op_or_assign
id|CB_CFIG_DYNTBD_EN
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|7
)paren
suffix:semicolon
id|bc_changed
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|bdp-&gt;config
(braket
l_int|7
)braket
op_amp
id|CB_CFIG_DYNTBD_EN
)paren
(brace
id|bdp-&gt;config
(braket
l_int|7
)braket
op_and_assign
(paren
op_complement
id|CB_CFIG_DYNTBD_EN
)paren
suffix:semicolon
id|E100_CONFIG
c_func
(paren
id|bdp
comma
l_int|7
)paren
suffix:semicolon
id|bc_changed
op_assign
l_bool|true
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
(paren
id|bdp-&gt;config_lock
)paren
)paren
suffix:semicolon
r_return
id|bc_changed
suffix:semicolon
)brace
eof
