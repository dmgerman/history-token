multiline_comment|/*&n; * Sun3 i82586 Ethernet driver&n; *&n; * Cloned from ni52.c for the Sun3 by Sam Creasey (sammy@sammy.net)&n; *&n; * Original copyright follows:&n; * --------------------------&n; *&n; * net-3-driver for the NI5210 card (i82586 Ethernet chip)&n; *&n; * This is an extension to the Linux operating system, and is covered by the&n; * same Gnu Public License that covers that work.&n; *&n; * Alphacode 0.82 (96/09/29) for Linux 2.0.0 (or later)&n; * Copyrights (c) 1994,1995,1996 by M.Hipp (hippm@informatik.uni-tuebingen.de)&n; * --------------------------&n; * &n; * Consult ni52.c for further notes from the original driver.&n; *&n; * This incarnation currently supports the OBIO version of the i82586 chip &n; * used in certain sun3 models.  It should be fairly doable to expand this&n; * to support VME if I should every acquire such a board.&n; *&n; */
DECL|variable|debuglevel
r_static
r_int
id|debuglevel
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* debug-printk 0: off 1: a few 2: more */
DECL|variable|automatic_resume
r_static
r_int
id|automatic_resume
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* experimental .. better should be zero */
DECL|variable|rfdadd
r_static
r_int
id|rfdadd
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* rfdadd=1 may be better for 8K MEM cards */
DECL|variable|fifo
r_static
r_int
id|fifo
op_assign
l_int|0x8
suffix:semicolon
multiline_comment|/* don&squot;t change */
multiline_comment|/* #define REALLY_SLOW_IO */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/idprom.h&gt;
macro_line|#include &lt;asm/machines.h&gt;
macro_line|#include &lt;asm/sun3mmu.h&gt;
macro_line|#include &lt;asm/dvma.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &quot;sun3_82586.h&quot;
DECL|macro|DEBUG
mdefine_line|#define DEBUG       /* debug on */
DECL|macro|SYSBUSVAL
mdefine_line|#define SYSBUSVAL 0 /* 16 Bit */
DECL|macro|sun3_attn586
mdefine_line|#define sun3_attn586()  {*(volatile unsigned char *)(dev-&gt;base_addr) |= IEOB_ATTEN; *(volatile unsigned char *)(dev-&gt;base_addr) &amp;= ~IEOB_ATTEN;}
DECL|macro|sun3_reset586
mdefine_line|#define sun3_reset586() {*(volatile unsigned char *)(dev-&gt;base_addr) = 0; udelay(100); *(volatile unsigned char *)(dev-&gt;base_addr) = IEOB_NORSET;}
DECL|macro|sun3_disint
mdefine_line|#define sun3_disint()   {*(volatile unsigned char *)(dev-&gt;base_addr) &amp;= ~IEOB_IENAB;}
DECL|macro|sun3_enaint
mdefine_line|#define sun3_enaint()   {*(volatile unsigned char *)(dev-&gt;base_addr) |= IEOB_IENAB;}
DECL|macro|sun3_active
mdefine_line|#define sun3_active()   {*(volatile unsigned char *)(dev-&gt;base_addr) |= (IEOB_IENAB|IEOB_ONAIR|IEOB_NORSET);}
DECL|macro|make32
mdefine_line|#define make32(ptr16) (p-&gt;memtop + (swab16((unsigned short) (ptr16))) )
DECL|macro|make24
mdefine_line|#define make24(ptr32) (char *)swab32(( ((unsigned long) (ptr32)) - p-&gt;base))
DECL|macro|make16
mdefine_line|#define make16(ptr32) (swab16((unsigned short) ((unsigned long)(ptr32) - (unsigned long) p-&gt;memtop )))
multiline_comment|/******************* how to calculate the buffers *****************************&n;&n;  * IMPORTANT NOTE: if you configure only one NUM_XMIT_BUFFS, the driver works&n;  * --------------- in a different (more stable?) mode. Only in this mode it&squot;s&n;  *                 possible to configure the driver with &squot;NO_NOPCOMMANDS&squot;&n;&n;sizeof(scp)=12; sizeof(scb)=16; sizeof(iscp)=8;&n;sizeof(scp)+sizeof(iscp)+sizeof(scb) = 36 = INIT&n;sizeof(rfd) = 24; sizeof(rbd) = 12;&n;sizeof(tbd) = 8; sizeof(transmit_cmd) = 16;&n;sizeof(nop_cmd) = 8;&n;&n;  * if you don&squot;t know the driver, better do not change these values: */
DECL|macro|RECV_BUFF_SIZE
mdefine_line|#define RECV_BUFF_SIZE 1536 /* slightly oversized */
DECL|macro|XMIT_BUFF_SIZE
mdefine_line|#define XMIT_BUFF_SIZE 1536 /* slightly oversized */
DECL|macro|NUM_XMIT_BUFFS
mdefine_line|#define NUM_XMIT_BUFFS 1    /* config for 32K shmem */
DECL|macro|NUM_RECV_BUFFS_8
mdefine_line|#define NUM_RECV_BUFFS_8 4 /* config for 32K shared mem */
DECL|macro|NUM_RECV_BUFFS_16
mdefine_line|#define NUM_RECV_BUFFS_16 9 /* config for 32K shared mem */
DECL|macro|NUM_RECV_BUFFS_32
mdefine_line|#define NUM_RECV_BUFFS_32 16 /* config for 32K shared mem */
DECL|macro|NO_NOPCOMMANDS
mdefine_line|#define NO_NOPCOMMANDS      /* only possible with NUM_XMIT_BUFFS=1 */
multiline_comment|/**************************************************************************/
multiline_comment|/* different DELAYs */
DECL|macro|DELAY
mdefine_line|#define DELAY(x) mdelay(32 * x);
DECL|macro|DELAY_16
mdefine_line|#define DELAY_16(); { udelay(16); }
DECL|macro|DELAY_18
mdefine_line|#define DELAY_18(); { udelay(4); }
multiline_comment|/* wait for command with timeout: */
DECL|macro|WAIT_4_SCB_CMD
mdefine_line|#define WAIT_4_SCB_CMD() &bslash;&n;{ int i; &bslash;&n;  for(i=0;i&lt;16384;i++) { &bslash;&n;    if(!p-&gt;scb-&gt;cmd_cuc) break; &bslash;&n;    DELAY_18(); &bslash;&n;    if(i == 16383) { &bslash;&n;      printk(&quot;%s: scb_cmd timed out: %04x,%04x .. disabling i82586!!&bslash;n&quot;,dev-&gt;name,p-&gt;scb-&gt;cmd_cuc,p-&gt;scb-&gt;cus); &bslash;&n;       if(!p-&gt;reseted) { p-&gt;reseted = 1; sun3_reset586(); } } } }
DECL|macro|WAIT_4_SCB_CMD_RUC
mdefine_line|#define WAIT_4_SCB_CMD_RUC() { int i; &bslash;&n;  for(i=0;i&lt;16384;i++) { &bslash;&n;    if(!p-&gt;scb-&gt;cmd_ruc) break; &bslash;&n;    DELAY_18(); &bslash;&n;    if(i == 16383) { &bslash;&n;      printk(&quot;%s: scb_cmd (ruc) timed out: %04x,%04x .. disabling i82586!!&bslash;n&quot;,dev-&gt;name,p-&gt;scb-&gt;cmd_ruc,p-&gt;scb-&gt;rus); &bslash;&n;       if(!p-&gt;reseted) { p-&gt;reseted = 1; sun3_reset586(); } } } }
DECL|macro|WAIT_4_STAT_COMPL
mdefine_line|#define WAIT_4_STAT_COMPL(addr) { int i; &bslash;&n;   for(i=0;i&lt;32767;i++) { &bslash;&n;     if(swab16((addr)-&gt;cmd_status) &amp; STAT_COMPL) break; &bslash;&n;     DELAY_16(); DELAY_16(); } }
r_static
r_int
id|sun3_82586_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_void
id|sun3_82586_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|reg_ptr
)paren
suffix:semicolon
r_static
r_int
id|sun3_82586_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sun3_82586_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|sun3_82586_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|sun3_82586_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sun3_82586_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|sun3_82586_dump
c_func
(paren
r_struct
id|net_device
op_star
comma
r_void
op_star
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* helper-functions */
r_static
r_int
id|init586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|check586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|where
comma
r_int
id|size
)paren
suffix:semicolon
r_static
r_void
id|alloc586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|startrecv586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
op_star
id|alloc_rfa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
suffix:semicolon
r_static
r_void
id|sun3_82586_rcv_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sun3_82586_xmt_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sun3_82586_rnr_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|struct|priv
r_struct
id|priv
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|base
r_int
r_int
id|base
suffix:semicolon
DECL|member|memtop
r_char
op_star
id|memtop
suffix:semicolon
DECL|member|lock
r_int
r_int
id|lock
suffix:semicolon
DECL|member|reseted
r_int
id|reseted
suffix:semicolon
DECL|member|rfd_last
DECL|member|rfd_top
DECL|member|rfd_first
r_volatile
r_struct
id|rfd_struct
op_star
id|rfd_last
comma
op_star
id|rfd_top
comma
op_star
id|rfd_first
suffix:semicolon
DECL|member|scp
r_volatile
r_struct
id|scp_struct
op_star
id|scp
suffix:semicolon
multiline_comment|/* volatile is important */
DECL|member|iscp
r_volatile
r_struct
id|iscp_struct
op_star
id|iscp
suffix:semicolon
multiline_comment|/* volatile is important */
DECL|member|scb
r_volatile
r_struct
id|scb_struct
op_star
id|scb
suffix:semicolon
multiline_comment|/* volatile is important */
DECL|member|xmit_buffs
r_volatile
r_struct
id|tbd_struct
op_star
id|xmit_buffs
(braket
id|NUM_XMIT_BUFFS
)braket
suffix:semicolon
DECL|member|xmit_cmds
r_volatile
r_struct
id|transmit_cmd_struct
op_star
id|xmit_cmds
(braket
id|NUM_XMIT_BUFFS
)braket
suffix:semicolon
macro_line|#if (NUM_XMIT_BUFFS == 1)
DECL|member|nop_cmds
r_volatile
r_struct
id|nop_cmd_struct
op_star
id|nop_cmds
(braket
l_int|2
)braket
suffix:semicolon
macro_line|#else
DECL|member|nop_cmds
r_volatile
r_struct
id|nop_cmd_struct
op_star
id|nop_cmds
(braket
id|NUM_XMIT_BUFFS
)braket
suffix:semicolon
macro_line|#endif
DECL|member|nop_point
DECL|member|num_recv_buffs
r_volatile
r_int
id|nop_point
comma
id|num_recv_buffs
suffix:semicolon
DECL|member|xmit_cbuffs
r_volatile
r_char
op_star
id|xmit_cbuffs
(braket
id|NUM_XMIT_BUFFS
)braket
suffix:semicolon
DECL|member|xmit_count
DECL|member|xmit_last
r_volatile
r_int
id|xmit_count
comma
id|xmit_last
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/**********************************************&n; * close device&n; */
DECL|function|sun3_82586_close
r_static
r_int
id|sun3_82586_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|sun3_reset586
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* the hard way to stop the receiver */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**********************************************&n; * open device&n; */
DECL|function|sun3_82586_open
r_static
r_int
id|sun3_82586_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ret
suffix:semicolon
id|sun3_disint
c_func
(paren
)paren
suffix:semicolon
id|alloc586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|startrecv586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sun3_enaint
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|sun3_82586_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|sun3_reset586
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* most done by init */
)brace
multiline_comment|/**********************************************&n; * Check to see if there&squot;s an 82586 out there.&n; */
DECL|function|check586
r_static
r_int
id|check586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_char
op_star
id|where
comma
r_int
id|size
)paren
(brace
r_struct
id|priv
id|pb
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
multiline_comment|/* (struct priv *) dev-&gt;priv*/
op_amp
id|pb
suffix:semicolon
r_char
op_star
id|iscp_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p-&gt;base
op_assign
(paren
r_int
r_int
)paren
id|dvma_btov
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|p-&gt;memtop
op_assign
(paren
r_char
op_star
)paren
id|dvma_btov
c_func
(paren
(paren
r_int
r_int
)paren
id|where
)paren
suffix:semicolon
id|p-&gt;scp
op_assign
(paren
r_struct
id|scp_struct
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|SCP_DEFAULT_ADDRESS
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;scp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|scp_struct
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
r_struct
id|scp_struct
)paren
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* memory was writeable? */
r_if
c_cond
(paren
(paren
(paren
r_char
op_star
)paren
id|p-&gt;scp
)paren
(braket
id|i
)braket
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|p-&gt;scp-&gt;sysbus
op_assign
id|SYSBUSVAL
suffix:semicolon
multiline_comment|/* 1 = 8Bit-Bus, 0 = 16 Bit */
r_if
c_cond
(paren
id|p-&gt;scp-&gt;sysbus
op_ne
id|SYSBUSVAL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|iscp_addr
op_assign
(paren
r_char
op_star
)paren
id|dvma_btov
c_func
(paren
(paren
r_int
r_int
)paren
id|where
)paren
suffix:semicolon
id|p-&gt;iscp
op_assign
(paren
r_struct
id|iscp_struct
op_star
)paren
id|iscp_addr
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;iscp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iscp_struct
)paren
)paren
suffix:semicolon
id|p-&gt;scp-&gt;iscp
op_assign
id|make24
c_func
(paren
id|p-&gt;iscp
)paren
suffix:semicolon
id|p-&gt;iscp-&gt;busy
op_assign
l_int|1
suffix:semicolon
id|sun3_reset586
c_func
(paren
)paren
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|DELAY
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* wait a while... */
r_if
c_cond
(paren
id|p-&gt;iscp-&gt;busy
)paren
(brace
multiline_comment|/* i82586 clears &squot;busy&squot; after successful init */
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/******************************************************************&n; * set iscp at the right place, called by sun3_82586_probe1 and open586.&n; */
DECL|function|alloc586
r_static
r_void
id|alloc586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|sun3_reset586
c_func
(paren
)paren
suffix:semicolon
id|DELAY
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|p-&gt;scp
op_assign
(paren
r_struct
id|scp_struct
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|SCP_DEFAULT_ADDRESS
)paren
suffix:semicolon
id|p-&gt;iscp
op_assign
(paren
r_struct
id|iscp_struct
op_star
)paren
id|dvma_btov
c_func
(paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
id|p-&gt;scb
op_assign
(paren
r_struct
id|scb_struct
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|p-&gt;iscp
op_plus
r_sizeof
(paren
r_struct
id|iscp_struct
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;iscp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|iscp_struct
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;scp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|scp_struct
)paren
)paren
suffix:semicolon
id|p-&gt;scp-&gt;iscp
op_assign
id|make24
c_func
(paren
id|p-&gt;iscp
)paren
suffix:semicolon
id|p-&gt;scp-&gt;sysbus
op_assign
id|SYSBUSVAL
suffix:semicolon
id|p-&gt;iscp-&gt;scb_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;scb
)paren
suffix:semicolon
id|p-&gt;iscp-&gt;scb_base
op_assign
id|make24
c_func
(paren
id|dvma_btov
c_func
(paren
id|dev-&gt;mem_start
)paren
)paren
suffix:semicolon
id|p-&gt;iscp-&gt;busy
op_assign
l_int|1
suffix:semicolon
id|sun3_reset586
c_func
(paren
)paren
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|DELAY
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;iscp-&gt;busy
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Init-Problems (alloc).&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|p-&gt;reseted
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;scb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|scb_struct
)paren
)paren
suffix:semicolon
)brace
DECL|function|sun3_82586_probe
r_int
id|__init
id|sun3_82586_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|ioaddr
comma
id|iopte
suffix:semicolon
r_static
r_int
id|found
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* check that this machine has an onboard lance */
r_switch
c_cond
(paren
id|idprom-&gt;id_machtype
)paren
(brace
r_case
id|SM_SUN3
op_or
id|SM_3_160
suffix:colon
r_case
id|SM_SUN3
op_or
id|SM_3_260
suffix:colon
multiline_comment|/* these machines have lance */
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ioaddr
op_assign
l_int|0xfe00000
suffix:semicolon
id|ioaddr
OL
(paren
l_int|0xfe00000
op_plus
id|SUN3_PMEG_SIZE
)paren
suffix:semicolon
id|ioaddr
op_add_assign
id|SUN3_PTE_SIZE
)paren
(brace
id|iopte
op_assign
id|sun3_get_pte
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|iopte
op_amp
id|SUN3_PAGE_TYPE_IO
)paren
)paren
(brace
multiline_comment|/* this an io page? */
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|iopte
op_amp
id|SUN3_PAGE_PGNUM_MASK
)paren
op_lshift
id|PAGE_SHIFT
)paren
op_eq
id|IE_OBIO
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|IE_IRQ
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
r_if
c_cond
(paren
id|sun3_82586_probe1
c_func
(paren
id|dev
comma
id|ioaddr
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|sun3_82586_probe1
r_static
r_int
id|__init
id|sun3_82586_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
(brace
r_int
id|i
comma
id|size
comma
id|retval
suffix:semicolon
singleline_comment|//&t;if (!request_region(ioaddr, SUN3_82586_TOTAL_SIZE, dev-&gt;name))
singleline_comment|//&t;&t;return -EBUSY;
multiline_comment|/* copy in the ethernet address from the prom */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|idprom-&gt;id_ethaddr
(braket
id|i
)braket
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: SUN3 Intel 82586 found at %lx, &quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * check (or search) IO-Memory, 32K&n;&t; */
id|size
op_assign
l_int|0x8000
suffix:semicolon
id|dev-&gt;mem_start
op_assign
(paren
r_int
r_int
)paren
id|dvma_malloc_align
c_func
(paren
l_int|0x8000
comma
l_int|0x1000
)paren
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|dev-&gt;mem_start
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
l_int|0x2000
op_logical_and
id|size
op_ne
l_int|0x4000
op_logical_and
id|size
op_ne
l_int|0x8000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n%s: Illegal memory size %d. Allowed is 0x2000 or 0x4000 or 0x8000 bytes.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|size
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|check586
c_func
(paren
id|dev
comma
(paren
r_char
op_star
)paren
id|dev-&gt;mem_start
comma
id|size
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;?memcheck, Can&squot;t find memory at 0x%lx with size %d!&bslash;n&quot;
comma
id|dev-&gt;mem_start
comma
id|size
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|priv
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Ooops .. can&squot;t allocate private driver memory.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* warning: we don&squot;t free it on errors */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|dev-&gt;priv
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|priv
)paren
)paren
suffix:semicolon
(paren
(paren
r_struct
id|priv
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|memtop
op_assign
(paren
r_char
op_star
)paren
id|dvma_btov
c_func
(paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
(paren
(paren
r_struct
id|priv
op_star
)paren
(paren
id|dev-&gt;priv
)paren
)paren
op_member_access_from_pointer
id|base
op_assign
(paren
r_int
r_int
)paren
id|dvma_btov
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|alloc586
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set number of receive-buffs according to memsize */
r_if
c_cond
(paren
id|size
op_eq
l_int|0x2000
)paren
(brace
(paren
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|num_recv_buffs
op_assign
id|NUM_RECV_BUFFS_8
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
l_int|0x4000
)paren
(brace
(paren
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|num_recv_buffs
op_assign
id|NUM_RECV_BUFFS_16
suffix:semicolon
)brace
r_else
(paren
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|num_recv_buffs
op_assign
id|NUM_RECV_BUFFS_32
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Memaddr: 0x%lx, Memsize: %d, IRQ %d&bslash;n&quot;
comma
id|dev-&gt;mem_start
comma
id|size
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|sun3_82586_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|sun3_82586_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|sun3_82586_get_stats
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|sun3_82586_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|HZ
op_div
l_int|20
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|sun3_82586_send_packet
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_multicast_list
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|init586
r_static
r_int
id|init586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_void
op_star
id|ptr
suffix:semicolon
r_int
id|i
comma
id|result
op_assign
l_int|0
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
r_struct
id|configure_cmd_struct
op_star
id|cfg_cmd
suffix:semicolon
r_volatile
r_struct
id|iasetup_cmd_struct
op_star
id|ias_cmd
suffix:semicolon
r_volatile
r_struct
id|tdr_cmd_struct
op_star
id|tdr_cmd
suffix:semicolon
r_volatile
r_struct
id|mcsetup_cmd_struct
op_star
id|mc_cmd
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_int
id|num_addrs
op_assign
id|dev-&gt;mc_count
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|p-&gt;scb
op_plus
r_sizeof
(paren
r_struct
id|scb_struct
)paren
)paren
suffix:semicolon
id|cfg_cmd
op_assign
(paren
r_struct
id|configure_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
multiline_comment|/* configure-command */
id|cfg_cmd-&gt;cmd_status
op_assign
l_int|0
suffix:semicolon
id|cfg_cmd-&gt;cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_CONFIGURE
op_or
id|CMD_LAST
)paren
suffix:semicolon
id|cfg_cmd-&gt;cmd_link
op_assign
l_int|0xffff
suffix:semicolon
id|cfg_cmd-&gt;byte_cnt
op_assign
l_int|0x0a
suffix:semicolon
multiline_comment|/* number of cfg bytes */
id|cfg_cmd-&gt;fifo
op_assign
id|fifo
suffix:semicolon
multiline_comment|/* fifo-limit (8=tx:32/rx:64) */
id|cfg_cmd-&gt;sav_bf
op_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* hold or discard bad recv frames (bit 7) */
id|cfg_cmd-&gt;adr_len
op_assign
l_int|0x2e
suffix:semicolon
multiline_comment|/* addr_len |!src_insert |pre-len |loopback */
id|cfg_cmd-&gt;priority
op_assign
l_int|0x00
suffix:semicolon
id|cfg_cmd-&gt;ifs
op_assign
l_int|0x60
suffix:semicolon
id|cfg_cmd-&gt;time_low
op_assign
l_int|0x00
suffix:semicolon
id|cfg_cmd-&gt;time_high
op_assign
l_int|0xf2
suffix:semicolon
id|cfg_cmd-&gt;promisc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
r_int
id|len
op_assign
(paren
(paren
r_char
op_star
)paren
id|p-&gt;iscp
op_minus
(paren
r_char
op_star
)paren
id|ptr
op_minus
l_int|8
)paren
op_div
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|num_addrs
OG
id|len
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: switching to promisc. mode&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_PROMISC
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|cfg_cmd-&gt;promisc
op_assign
l_int|1
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_PROMISC
suffix:semicolon
)brace
id|cfg_cmd-&gt;carr_coll
op_assign
l_int|0x00
suffix:semicolon
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|cfg_cmd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_ruc
op_assign
l_int|0
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
multiline_comment|/* cmd.-unit start */
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_STAT_COMPL
c_func
(paren
id|cfg_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|swab16
c_func
(paren
id|cfg_cmd-&gt;cmd_status
)paren
op_amp
(paren
id|STAT_OK
op_or
id|STAT_COMPL
)paren
)paren
op_ne
(paren
id|STAT_COMPL
op_or
id|STAT_OK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: configure command failed: %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|swab16
c_func
(paren
id|cfg_cmd-&gt;cmd_status
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * individual address setup&n;&t; */
id|ias_cmd
op_assign
(paren
r_struct
id|iasetup_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|ias_cmd-&gt;cmd_status
op_assign
l_int|0
suffix:semicolon
id|ias_cmd-&gt;cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_IASETUP
op_or
id|CMD_LAST
)paren
suffix:semicolon
id|ias_cmd-&gt;cmd_link
op_assign
l_int|0xffff
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|ias_cmd-&gt;iaddr
comma
(paren
r_char
op_star
)paren
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|ias_cmd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
multiline_comment|/* cmd.-unit start */
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_STAT_COMPL
c_func
(paren
id|ias_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|swab16
c_func
(paren
id|ias_cmd-&gt;cmd_status
)paren
op_amp
(paren
id|STAT_OK
op_or
id|STAT_COMPL
)paren
)paren
op_ne
(paren
id|STAT_OK
op_or
id|STAT_COMPL
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s (82586): individual address setup command failed: %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|swab16
c_func
(paren
id|ias_cmd-&gt;cmd_status
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * TDR, wire check .. e.g. no resistor e.t.c&n;&t; */
id|tdr_cmd
op_assign
(paren
r_struct
id|tdr_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|tdr_cmd-&gt;cmd_status
op_assign
l_int|0
suffix:semicolon
id|tdr_cmd-&gt;cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_TDR
op_or
id|CMD_LAST
)paren
suffix:semicolon
id|tdr_cmd-&gt;cmd_link
op_assign
l_int|0xffff
suffix:semicolon
id|tdr_cmd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|tdr_cmd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
multiline_comment|/* cmd.-unit start */
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_STAT_COMPL
c_func
(paren
id|tdr_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|swab16
c_func
(paren
id|tdr_cmd-&gt;cmd_status
)paren
op_amp
id|STAT_COMPL
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Problems while running the TDR.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|DELAY_16
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for result */
id|result
op_assign
id|swab16
c_func
(paren
id|tdr_cmd-&gt;status
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|p-&gt;scb-&gt;cus
op_amp
id|STAT_MASK
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* ack the interrupts */
r_if
c_cond
(paren
id|result
op_amp
id|TDR_LNK_OK
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|result
op_amp
id|TDR_XCVR_PRB
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TDR: Transceiver problem. Check the cable(s)!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|result
op_amp
id|TDR_ET_OPN
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TDR: No correct termination %d clocks away.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|result
op_amp
id|TDR_TIMEMASK
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|result
op_amp
id|TDR_ET_SRT
)paren
(brace
r_if
c_cond
(paren
id|result
op_amp
id|TDR_TIMEMASK
)paren
multiline_comment|/* time == 0 -&gt; strange :-) */
id|printk
c_func
(paren
l_string|&quot;%s: TDR: Detected a short circuit %d clocks away.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|result
op_amp
id|TDR_TIMEMASK
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s: TDR: Unknown status %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|result
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Multicast setup&n;&t; */
r_if
c_cond
(paren
id|num_addrs
op_logical_and
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
)paren
(brace
id|mc_cmd
op_assign
(paren
r_struct
id|mcsetup_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|mc_cmd-&gt;cmd_status
op_assign
l_int|0
suffix:semicolon
id|mc_cmd-&gt;cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_MCSETUP
op_or
id|CMD_LAST
)paren
suffix:semicolon
id|mc_cmd-&gt;cmd_link
op_assign
l_int|0xffff
suffix:semicolon
id|mc_cmd-&gt;mc_cnt
op_assign
id|swab16
c_func
(paren
id|num_addrs
op_star
l_int|6
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_addrs
suffix:semicolon
id|i
op_increment
comma
id|dmi
op_assign
id|dmi-&gt;next
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|mc_cmd-&gt;mc_list
(braket
id|i
)braket
comma
id|dmi-&gt;dmi_addr
comma
l_int|6
)paren
suffix:semicolon
)brace
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|mc_cmd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_STAT_COMPL
c_func
(paren
id|mc_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|swab16
c_func
(paren
id|mc_cmd-&gt;cmd_status
)paren
op_amp
(paren
id|STAT_COMPL
op_or
id|STAT_OK
)paren
)paren
op_ne
(paren
id|STAT_COMPL
op_or
id|STAT_OK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t apply multicast-address-list.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * alloc nop/xmit-cmds&n;&t; */
macro_line|#if (NUM_XMIT_BUFFS == 1)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_assign
(paren
r_struct
id|nop_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_NOP
)paren
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;nop_cmds
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
r_sizeof
(paren
r_struct
id|nop_cmd_struct
)paren
suffix:semicolon
)brace
macro_line|#else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_XMIT_BUFFS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_assign
(paren
r_struct
id|nop_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_NOP
)paren
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;nop_cmds
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
r_sizeof
(paren
r_struct
id|nop_cmd_struct
)paren
suffix:semicolon
)brace
macro_line|#endif
id|ptr
op_assign
id|alloc_rfa
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|ptr
)paren
suffix:semicolon
multiline_comment|/* init receive-frame-area */
multiline_comment|/*&n;&t; * alloc xmit-buffs / init xmit_cmds&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_XMIT_BUFFS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;xmit_cmds
(braket
id|i
)braket
op_assign
(paren
r_struct
id|transmit_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
multiline_comment|/*transmit cmd/buff 0*/
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
r_sizeof
(paren
r_struct
id|transmit_cmd_struct
)paren
suffix:semicolon
id|p-&gt;xmit_cbuffs
(braket
id|i
)braket
op_assign
(paren
r_char
op_star
)paren
id|ptr
suffix:semicolon
multiline_comment|/* char-buffs */
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
id|XMIT_BUFF_SIZE
suffix:semicolon
id|p-&gt;xmit_buffs
(braket
id|i
)braket
op_assign
(paren
r_struct
id|tbd_struct
op_star
)paren
id|ptr
suffix:semicolon
multiline_comment|/* TBD */
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
r_sizeof
(paren
r_struct
id|tbd_struct
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_void
op_star
)paren
id|ptr
OG
(paren
r_void
op_star
)paren
id|dev-&gt;mem_end
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: not enough shared-mem for your configuration!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
(paren
id|p-&gt;xmit_cmds
(braket
id|i
)braket
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|transmit_cmd_struct
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
(paren
id|p-&gt;xmit_buffs
(braket
id|i
)braket
)paren
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tbd_struct
)paren
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
id|p-&gt;nop_cmds
(braket
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|NUM_XMIT_BUFFS
)braket
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
id|swab16
c_func
(paren
id|STAT_COMPL
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_XMIT
op_or
id|CMD_INT
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
id|i
)braket
op_member_access_from_pointer
id|tbd_offset
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;xmit_buffs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|p-&gt;xmit_buffs
(braket
id|i
)braket
op_member_access_from_pointer
id|next
op_assign
l_int|0xffff
suffix:semicolon
id|p-&gt;xmit_buffs
(braket
id|i
)braket
op_member_access_from_pointer
id|buffer
op_assign
id|make24
c_func
(paren
(paren
id|p-&gt;xmit_cbuffs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
)brace
id|p-&gt;xmit_count
op_assign
l_int|0
suffix:semicolon
id|p-&gt;xmit_last
op_assign
l_int|0
suffix:semicolon
macro_line|#ifndef NO_NOPCOMMANDS
id|p-&gt;nop_point
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t;&t;* &squot;start transmitter&squot;&n;&t;&t;*/
macro_line|#ifndef NO_NOPCOMMANDS
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;nop_cmds
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_cmd
op_assign
id|swab16
c_func
(paren
id|CMD_XMIT
op_or
id|CMD_SUSPEND
op_or
id|CMD_INT
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * ack. interrupts&n;&t; */
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|p-&gt;scb-&gt;cus
op_amp
id|STAT_MASK
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|DELAY_16
c_func
(paren
)paren
suffix:semicolon
id|sun3_enaint
c_func
(paren
)paren
suffix:semicolon
id|sun3_active
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************&n; * This is a helper routine for sun3_82586_rnr_int() and init586().&n; * It sets up the Receive Frame Area (RFA).&n; */
DECL|function|alloc_rfa
r_static
r_void
op_star
id|alloc_rfa
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_volatile
r_struct
id|rfd_struct
op_star
id|rfd
op_assign
(paren
r_struct
id|rfd_struct
op_star
)paren
id|ptr
suffix:semicolon
r_volatile
r_struct
id|rbd_struct
op_star
id|rbd
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|rfd
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rfd_struct
)paren
op_star
(paren
id|p-&gt;num_recv_buffs
op_plus
id|rfdadd
)paren
)paren
suffix:semicolon
id|p-&gt;rfd_first
op_assign
id|rfd
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|p-&gt;num_recv_buffs
op_plus
id|rfdadd
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rfd
(braket
id|i
)braket
dot
id|next
op_assign
id|make16
c_func
(paren
id|rfd
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_mod
(paren
id|p-&gt;num_recv_buffs
op_plus
id|rfdadd
)paren
)paren
suffix:semicolon
id|rfd
(braket
id|i
)braket
dot
id|rbd_offset
op_assign
l_int|0xffff
suffix:semicolon
)brace
id|rfd
(braket
id|p-&gt;num_recv_buffs
op_minus
l_int|1
op_plus
id|rfdadd
)braket
dot
id|last
op_assign
id|RFD_SUSP
suffix:semicolon
multiline_comment|/* RU suspend */
id|ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|rfd
op_plus
(paren
id|p-&gt;num_recv_buffs
op_plus
id|rfdadd
)paren
)paren
suffix:semicolon
id|rbd
op_assign
(paren
r_struct
id|rbd_struct
op_star
)paren
id|ptr
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|rbd
op_plus
id|p-&gt;num_recv_buffs
)paren
suffix:semicolon
multiline_comment|/* clr descriptors */
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
id|rbd
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rbd_struct
)paren
op_star
(paren
id|p-&gt;num_recv_buffs
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;num_recv_buffs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rbd
(braket
id|i
)braket
dot
id|next
op_assign
id|make16
c_func
(paren
(paren
id|rbd
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|p-&gt;num_recv_buffs
)paren
)paren
suffix:semicolon
id|rbd
(braket
id|i
)braket
dot
id|size
op_assign
id|swab16
c_func
(paren
id|RECV_BUFF_SIZE
)paren
suffix:semicolon
id|rbd
(braket
id|i
)braket
dot
id|buffer
op_assign
id|make24
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|ptr
op_plus
id|RECV_BUFF_SIZE
suffix:semicolon
)brace
id|p-&gt;rfd_top
op_assign
id|p-&gt;rfd_first
suffix:semicolon
id|p-&gt;rfd_last
op_assign
id|p-&gt;rfd_first
op_plus
(paren
id|p-&gt;num_recv_buffs
op_minus
l_int|1
op_plus
id|rfdadd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;rfa_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;rfd_first
)paren
suffix:semicolon
id|p-&gt;rfd_first-&gt;rbd_offset
op_assign
id|make16
c_func
(paren
id|rbd
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
multiline_comment|/**************************************************&n; * Interrupt Handler ...&n; */
DECL|function|sun3_82586_interrupt
r_static
r_void
id|sun3_82586_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|reg_ptr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|stat
suffix:semicolon
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_struct
id|priv
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
l_string|&quot;sun3_82586-interrupt: irq %d for unknown device.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;I&quot;
)paren
suffix:semicolon
)brace
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for last command&t;*/
r_while
c_loop
(paren
(paren
id|stat
op_assign
id|p-&gt;scb-&gt;cus
op_amp
id|STAT_MASK
)paren
)paren
(brace
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|stat
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|STAT_FR
)paren
(brace
multiline_comment|/* received a frame */
id|sun3_82586_rcv_int
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|STAT_RNR
)paren
multiline_comment|/* RU went &squot;not ready&squot; */
(brace
id|printk
c_func
(paren
l_string|&quot;(R)&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;scb-&gt;rus
op_amp
id|RU_SUSPEND
)paren
multiline_comment|/* special case: RU_SUSPEND */
(brace
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_ruc
op_assign
id|RUC_RESUME
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Receiver-Unit went &squot;NOT READY&squot;: %04x/%02x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|stat
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;rus
)paren
suffix:semicolon
id|sun3_82586_rnr_int
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|STAT_CX
)paren
(brace
multiline_comment|/* command with I-bit set complete */
id|sun3_82586_xmt_int
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifndef NO_NOPCOMMANDS
r_if
c_cond
(paren
id|stat
op_amp
id|STAT_CNA
)paren
multiline_comment|/* CU went &squot;not ready&squot; */
(brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: oops! CU has left active state. stat: %04x/%02x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|stat
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;cus
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d&quot;
comma
id|cnt
op_increment
)paren
suffix:semicolon
)brace
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for ack. (sun3_82586_xmt_int can be faster than ack!!) */
r_if
c_cond
(paren
id|p-&gt;scb-&gt;cmd_cuc
)paren
multiline_comment|/* timed out? */
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Acknowledge timed out.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|sun3_disint
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|debuglevel
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*******************************************************&n; * receive-interrupt&n; */
DECL|function|sun3_82586_rcv_int
r_static
r_void
id|sun3_82586_rcv_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|status
comma
id|cnt
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|totlen
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|rbd_struct
op_star
id|rbd
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;R&quot;
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
(paren
id|status
op_assign
id|p-&gt;rfd_top-&gt;stat_high
)paren
op_amp
id|RFD_COMPL
suffix:semicolon
)paren
(brace
id|rbd
op_assign
(paren
r_struct
id|rbd_struct
op_star
)paren
id|make32
c_func
(paren
id|p-&gt;rfd_top-&gt;rbd_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RFD_OK
)paren
multiline_comment|/* frame received without error? */
(brace
r_if
c_cond
(paren
(paren
id|totlen
op_assign
id|swab16
c_func
(paren
id|rbd-&gt;status
)paren
)paren
op_amp
id|RBD_LAST
)paren
multiline_comment|/* the first and the last buffer? */
(brace
id|totlen
op_and_assign
id|RBD_MASK
suffix:semicolon
multiline_comment|/* length of this frame */
id|rbd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|dev_alloc_skb
c_func
(paren
id|totlen
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|totlen
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_char
op_star
)paren
id|p-&gt;base
op_plus
id|swab32
c_func
(paren
(paren
r_int
r_int
)paren
id|rbd-&gt;buffer
)paren
comma
id|totlen
comma
l_int|0
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|p-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
r_else
id|p-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
r_int
id|rstat
suffix:semicolon
multiline_comment|/* free all RBD&squot;s until RBD_LAST is set */
id|totlen
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|rstat
op_assign
id|swab16
c_func
(paren
id|rbd-&gt;status
)paren
)paren
op_amp
id|RBD_LAST
)paren
)paren
(brace
id|totlen
op_add_assign
id|rstat
op_amp
id|RBD_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rstat
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Whoops .. no end mark in RBD list&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rbd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|rbd
op_assign
(paren
r_struct
id|rbd_struct
op_star
)paren
id|make32
c_func
(paren
id|rbd-&gt;next
)paren
suffix:semicolon
)brace
id|totlen
op_add_assign
id|rstat
op_amp
id|RBD_MASK
suffix:semicolon
id|rbd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: received oversized frame! length: %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|totlen
)paren
suffix:semicolon
id|p-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
)brace
r_else
multiline_comment|/* frame !(ok), only with &squot;save-bad-frames&squot; */
(brace
id|printk
c_func
(paren
l_string|&quot;%s: oops! rfd-error-status: %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|p-&gt;stats.rx_errors
op_increment
suffix:semicolon
)brace
id|p-&gt;rfd_top-&gt;stat_high
op_assign
l_int|0
suffix:semicolon
id|p-&gt;rfd_top-&gt;last
op_assign
id|RFD_SUSP
suffix:semicolon
multiline_comment|/* maybe exchange by RFD_LAST */
id|p-&gt;rfd_top-&gt;rbd_offset
op_assign
l_int|0xffff
suffix:semicolon
id|p-&gt;rfd_last-&gt;last
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* delete RFD_SUSP&t;*/
id|p-&gt;rfd_last
op_assign
id|p-&gt;rfd_top
suffix:semicolon
id|p-&gt;rfd_top
op_assign
(paren
r_struct
id|rfd_struct
op_star
)paren
id|make32
c_func
(paren
id|p-&gt;rfd_top-&gt;next
)paren
suffix:semicolon
multiline_comment|/* step to next RFD */
id|p-&gt;scb-&gt;rfa_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;rfd_top
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d&quot;
comma
id|cnt
op_increment
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|automatic_resume
)paren
(brace
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_ruc
op_assign
id|RUC_RESUME
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef WAIT_4_BUSY
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1024
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;rfd_top-&gt;status
)paren
(brace
r_break
suffix:semicolon
)brace
id|DELAY_16
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|1023
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: RU hasn&squot;t fetched next RFD (not busy/complete)&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
macro_line|#if 0
r_if
c_cond
(paren
op_logical_neg
id|at_least_one
)paren
(brace
r_int
id|i
suffix:semicolon
r_volatile
r_struct
id|rfd_struct
op_star
id|rfds
op_assign
id|p-&gt;rfd_top
suffix:semicolon
r_volatile
r_struct
id|rbd_struct
op_star
id|rbds
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: received a FC intr. without having a frame: %04x %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
comma
id|old_at_least
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|p-&gt;num_recv_buffs
op_plus
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rbds
op_assign
(paren
r_struct
id|rbd_struct
op_star
)paren
id|make32
c_func
(paren
id|rfds-&gt;rbd_offset
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%04x:%04x &quot;
comma
id|rfds-&gt;status
comma
id|rbds-&gt;status
)paren
suffix:semicolon
id|rfds
op_assign
(paren
r_struct
id|rfd_struct
op_star
)paren
id|make32
c_func
(paren
id|rfds-&gt;next
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nerrs: %04x %04x stat: %04x&bslash;n&quot;
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;rsc_errs
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;ovrn_errs
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nerrs: %04x %04x rus: %02x, cus: %02x&bslash;n&quot;
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;rsc_errs
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;ovrn_errs
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;rus
comma
(paren
r_int
)paren
id|p-&gt;scb-&gt;cus
)paren
suffix:semicolon
)brace
id|old_at_least
op_assign
id|at_least_one
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;r&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**********************************************************&n; * handle &squot;Receiver went not ready&squot;.&n; */
DECL|function|sun3_82586_rnr_int
r_static
r_void
id|sun3_82586_rnr_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|p-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for the last cmd, WAIT_4_FULLSTAT?? */
id|p-&gt;scb-&gt;cmd_ruc
op_assign
id|RUC_ABORT
suffix:semicolon
multiline_comment|/* usually the RU is in the &squot;no resource&squot;-state .. abort it now. */
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for accept cmd. */
id|alloc_rfa
c_func
(paren
id|dev
comma
(paren
r_char
op_star
)paren
id|p-&gt;rfd_first
)paren
suffix:semicolon
multiline_comment|/* maybe add a check here, before restarting the RU */
id|startrecv586
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* restart RU */
id|printk
c_func
(paren
l_string|&quot;%s: Receive-Unit restarted. Status: %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|p-&gt;scb-&gt;rus
)paren
suffix:semicolon
)brace
multiline_comment|/**********************************************************&n; * handle xmit - interrupt&n; */
DECL|function|sun3_82586_xmt_int
r_static
r_void
id|sun3_82586_xmt_int
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|status
suffix:semicolon
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|debuglevel
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;X&quot;
)paren
suffix:semicolon
)brace
id|status
op_assign
id|swab16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
id|p-&gt;xmit_last
)braket
op_member_access_from_pointer
id|cmd_status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|STAT_COMPL
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: strange .. xmit-int without a &squot;COMPLETE&squot;&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|STAT_OK
)paren
(brace
id|p-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|p-&gt;stats.collisions
op_add_assign
(paren
id|status
op_amp
id|TCMD_MAXCOLLMASK
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TCMD_LATECOLL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: late collision detected.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|p-&gt;stats.collisions
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|TCMD_NOCARRIER
)paren
(brace
id|p-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: no carrier detected.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|TCMD_LOSTCTS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: loss of CTS detected.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|TCMD_UNDERRUN
)paren
(brace
id|p-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: DMA underrun detected.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_amp
id|TCMD_MAXCOLL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Max. collisions exceeded.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|p-&gt;stats.collisions
op_add_assign
l_int|16
suffix:semicolon
)brace
)brace
macro_line|#if (NUM_XMIT_BUFFS &gt; 1)
r_if
c_cond
(paren
(paren
op_increment
id|p-&gt;xmit_last
)paren
op_eq
id|NUM_XMIT_BUFFS
)paren
(brace
id|p-&gt;xmit_last
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/***********************************************************&n; * (re)start the receiver&n; */
DECL|function|startrecv586
r_static
r_void
id|startrecv586
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;scb-&gt;rfa_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;rfd_first
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_ruc
op_assign
id|RUC_START
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* start cmd. */
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for accept cmd. (no timeout!!) */
)brace
DECL|function|sun3_82586_timeout
r_static
r_void
id|sun3_82586_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#ifndef NO_NOPCOMMANDS
r_if
c_cond
(paren
id|p-&gt;scb-&gt;cus
op_amp
id|CU_ACTIVE
)paren
multiline_comment|/* COMMAND-UNIT active? */
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;%s: strange ... timeout with CU active?!?&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: X0: %04x N0: %04x N1: %04x %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|swab16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
)paren
comma
(paren
r_int
)paren
id|swab16
c_func
(paren
id|p-&gt;nop_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
)paren
comma
(paren
r_int
)paren
id|swab16
c_func
(paren
id|p-&gt;nop_cmds
(braket
l_int|1
)braket
op_member_access_from_pointer
id|cmd_status
)paren
comma
(paren
r_int
)paren
id|p-&gt;nop_point
)paren
suffix:semicolon
macro_line|#endif
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_ABORT
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;nop_cmds
(braket
id|p-&gt;nop_point
)braket
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;%s: xmitter timed out, try to restart! stat: %02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|p-&gt;scb-&gt;cus
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: command-stats: %04x %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|swab16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
)paren
comma
id|swab16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|1
)braket
op_member_access_from_pointer
id|cmd_status
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: check, whether you set the right interrupt number!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#endif
id|sun3_82586_close
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sun3_82586_open
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
multiline_comment|/******************************************************&n; * send frame&n; */
DECL|function|sun3_82586_send_packet
r_static
r_int
id|sun3_82586_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|len
comma
id|i
suffix:semicolon
macro_line|#ifndef NO_NOPCOMMANDS
r_int
id|next_nop
suffix:semicolon
macro_line|#endif
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|XMIT_BUFF_SIZE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Sorry, max. framelength is %d bytes. The length of your frame is %d bytes.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|XMIT_BUFF_SIZE
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#if(NUM_XMIT_BUFFS &gt; 1)
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|p-&gt;lock
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Queue was locked&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|memcpy
c_func
(paren
(paren
r_char
op_star
)paren
id|p-&gt;xmit_cbuffs
(braket
id|p-&gt;xmit_count
)braket
comma
(paren
r_char
op_star
)paren
(paren
id|skb-&gt;data
)paren
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|len
op_assign
(paren
id|ETH_ZLEN
OL
id|skb-&gt;len
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
macro_line|#if (NUM_XMIT_BUFFS == 1)
macro_line|#&t;ifdef NO_NOPCOMMANDS
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|p-&gt;scb-&gt;cus
op_amp
id|CU_ACTIVE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Hmmm .. CU is still running and we wanna send a new packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: stat: %04x %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|p-&gt;scb-&gt;cus
comma
id|swab16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|p-&gt;xmit_buffs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|size
op_assign
id|swab16
c_func
(paren
id|TBD_LAST
op_or
id|len
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;scb-&gt;cus
op_amp
id|CU_STATUS
)paren
op_eq
id|CU_SUSPEND
)paren
(brace
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_RESUME
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
)brace
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
)paren
(brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p-&gt;scb-&gt;cus
op_amp
id|CU_ACTIVE
)paren
)paren
(brace
multiline_comment|/* test it, because CU sometimes doesn&squot;t start immediately */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|15
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t start transmit-command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
macro_line|#&t;else
id|next_nop
op_assign
(paren
id|p-&gt;nop_point
op_plus
l_int|1
)paren
op_amp
l_int|0x1
suffix:semicolon
id|p-&gt;xmit_buffs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|size
op_assign
id|swab16
c_func
(paren
id|TBD_LAST
op_or
id|len
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
)paren
)paren
suffix:semicolon
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|p-&gt;nop_point
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;xmit_cmds
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|p-&gt;nop_point
op_assign
id|next_nop
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#&t;endif
macro_line|#else
id|p-&gt;xmit_buffs
(braket
id|p-&gt;xmit_count
)braket
op_member_access_from_pointer
id|size
op_assign
id|swab16
c_func
(paren
id|TBD_LAST
op_or
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|next_nop
op_assign
id|p-&gt;xmit_count
op_plus
l_int|1
)paren
op_eq
id|NUM_XMIT_BUFFS
)paren
(brace
id|next_nop
op_assign
l_int|0
suffix:semicolon
)brace
id|p-&gt;xmit_cmds
(braket
id|p-&gt;xmit_count
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* linkpointer of xmit-command already points to next nop cmd */
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
)paren
)paren
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|next_nop
)braket
op_member_access_from_pointer
id|cmd_status
op_assign
l_int|0
suffix:semicolon
id|p-&gt;nop_cmds
(braket
id|p-&gt;xmit_count
)braket
op_member_access_from_pointer
id|cmd_link
op_assign
id|make16
c_func
(paren
(paren
id|p-&gt;xmit_cmds
(braket
id|p-&gt;xmit_count
)braket
)paren
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|p-&gt;xmit_count
op_assign
id|next_nop
suffix:semicolon
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;xmit_count
op_ne
id|p-&gt;xmit_last
)paren
(brace
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|p-&gt;lock
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*******************************************&n; * Someone wanna have the statistics&n; */
DECL|function|sun3_82586_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|sun3_82586_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|crc
comma
id|aln
comma
id|rsc
comma
id|ovrn
suffix:semicolon
id|crc
op_assign
id|swab16
c_func
(paren
id|p-&gt;scb-&gt;crc_errs
)paren
suffix:semicolon
multiline_comment|/* get error-statistic from the ni82586 */
id|p-&gt;scb-&gt;crc_errs
op_assign
l_int|0
suffix:semicolon
id|aln
op_assign
id|swab16
c_func
(paren
id|p-&gt;scb-&gt;aln_errs
)paren
suffix:semicolon
id|p-&gt;scb-&gt;aln_errs
op_assign
l_int|0
suffix:semicolon
id|rsc
op_assign
id|swab16
c_func
(paren
id|p-&gt;scb-&gt;rsc_errs
)paren
suffix:semicolon
id|p-&gt;scb-&gt;rsc_errs
op_assign
l_int|0
suffix:semicolon
id|ovrn
op_assign
id|swab16
c_func
(paren
id|p-&gt;scb-&gt;ovrn_errs
)paren
suffix:semicolon
id|p-&gt;scb-&gt;ovrn_errs
op_assign
l_int|0
suffix:semicolon
id|p-&gt;stats.rx_crc_errors
op_add_assign
id|crc
suffix:semicolon
id|p-&gt;stats.rx_fifo_errors
op_add_assign
id|ovrn
suffix:semicolon
id|p-&gt;stats.rx_frame_errors
op_add_assign
id|aln
suffix:semicolon
id|p-&gt;stats.rx_dropped
op_add_assign
id|rsc
suffix:semicolon
r_return
op_amp
id|p-&gt;stats
suffix:semicolon
)brace
multiline_comment|/********************************************************&n; * Set MC list ..&n; */
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sun3_disint
c_func
(paren
)paren
suffix:semicolon
id|alloc586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|startrecv586
c_func
(paren
id|dev
)paren
suffix:semicolon
id|sun3_enaint
c_func
(paren
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
macro_line|#error This code is not currently supported as a module
DECL|variable|dev_sun3_82586
r_static
r_struct
id|net_device
id|dev_sun3_82586
suffix:semicolon
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
id|dev_sun3_82586.init
op_assign
id|sun3_82586_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
op_amp
id|dev_sun3_82586
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|unregister_netdev
c_func
(paren
op_amp
id|dev_sun3_82586
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev_sun3_82586.priv
)paren
suffix:semicolon
id|dev_sun3_82586.priv
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
macro_line|#if 0
multiline_comment|/*&n; * DUMP .. we expect a not running CMD unit and enough space&n; */
r_void
id|sun3_82586_dump
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|priv
op_star
id|p
op_assign
(paren
r_struct
id|priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dump_cmd_struct
op_star
id|dump_cmd
op_assign
(paren
r_struct
id|dump_cmd_struct
op_star
)paren
id|ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_ABORT
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_SCB_CMD_RUC
c_func
(paren
)paren
suffix:semicolon
id|dump_cmd-&gt;cmd_status
op_assign
l_int|0
suffix:semicolon
id|dump_cmd-&gt;cmd_cmd
op_assign
id|CMD_DUMP
op_or
id|CMD_LAST
suffix:semicolon
id|dump_cmd-&gt;dump_offset
op_assign
id|make16
c_func
(paren
(paren
id|dump_cmd
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|dump_cmd-&gt;cmd_link
op_assign
l_int|0xffff
suffix:semicolon
id|p-&gt;scb-&gt;cbl_offset
op_assign
id|make16
c_func
(paren
id|dump_cmd
)paren
suffix:semicolon
id|p-&gt;scb-&gt;cmd_cuc
op_assign
id|CUC_START
suffix:semicolon
id|sun3_attn586
c_func
(paren
)paren
suffix:semicolon
id|WAIT_4_STAT_COMPL
c_func
(paren
id|dump_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dump_cmd-&gt;cmd_status
op_amp
(paren
id|STAT_COMPL
op_or
id|STAT_OK
)paren
)paren
op_ne
(paren
id|STAT_COMPL
op_or
id|STAT_OK
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t get dump information.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|170
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
(paren
r_int
)paren
(paren
(paren
r_int
r_char
op_star
)paren
(paren
id|dump_cmd
op_plus
l_int|1
)paren
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|24
op_eq
l_int|23
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
