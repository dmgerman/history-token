multiline_comment|/*&n; * PHY drivers for the sungem ethernet driver.&n; * &n; * This file could be shared with other drivers.&n; * &n; * (c) 2002, Benjamin Herrenscmidt (benh@kernel.crashing.org)&n; *&n; * TODO:&n; *  - Implement WOL&n; *  - Add support for PHYs that provide an IRQ line&n; *  - Eventually moved the entire polling state machine in&n; *    there (out of the eth driver), so that it can easily be&n; *    skipped on PHYs that implement it in hardware.&n; *  - On LXT971 &amp; BCM5201, Apple uses some chip specific regs&n; *    to read the link status. Figure out why and if it makes&n; *    sense to do the same (magic aneg ?)&n; *  - Apple has some additional power management code for some&n; *    Broadcom PHYs that they &quot;hide&quot; from the OpenSource version&n; *    of darwin, still need to reverse engineer that&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;sungem_phy.h&quot;
multiline_comment|/* Link modes of the BCM5400 PHY */
DECL|variable|phy_BCM5400_link_table
r_static
r_int
id|phy_BCM5400_link_table
(braket
l_int|8
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* No link */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 10BT Half Duplex */
(brace
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 10BT Full Duplex */
(brace
l_int|0
comma
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* 100BT Half Duplex */
(brace
l_int|0
comma
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* 100BT Half Duplex */
(brace
l_int|1
comma
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* 100BT Full Duplex*/
(brace
l_int|1
comma
l_int|0
comma
l_int|1
)brace
comma
multiline_comment|/* 1000BT */
(brace
l_int|1
comma
l_int|0
comma
l_int|1
)brace
comma
multiline_comment|/* 1000BT */
)brace
suffix:semicolon
DECL|function|__phy_read
r_static
r_inline
r_int
id|__phy_read
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|id
comma
r_int
id|reg
)paren
(brace
r_return
id|phy
op_member_access_from_pointer
id|mdio_read
c_func
(paren
id|phy-&gt;dev
comma
id|id
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|__phy_write
r_static
r_inline
r_void
id|__phy_write
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|id
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|phy
op_member_access_from_pointer
id|mdio_write
c_func
(paren
id|phy-&gt;dev
comma
id|id
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|phy_read
r_static
r_inline
r_int
id|phy_read
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|reg
)paren
(brace
r_return
id|phy
op_member_access_from_pointer
id|mdio_read
c_func
(paren
id|phy-&gt;dev
comma
id|phy-&gt;mii_id
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|phy_write
r_static
r_inline
r_void
id|phy_write
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|phy
op_member_access_from_pointer
id|mdio_write
c_func
(paren
id|phy-&gt;dev
comma
id|phy-&gt;mii_id
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|reset_one_mii_phy
r_static
r_int
id|reset_one_mii_phy
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|phy_id
)paren
(brace
id|u16
id|val
suffix:semicolon
r_int
id|limit
op_assign
l_int|10000
suffix:semicolon
id|val
op_assign
id|__phy_read
c_func
(paren
id|phy
comma
id|phy_id
comma
id|MII_BMCR
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|BMCR_ISOLATE
suffix:semicolon
id|val
op_or_assign
id|BMCR_RESET
suffix:semicolon
id|__phy_write
c_func
(paren
id|phy
comma
id|phy_id
comma
id|MII_BMCR
comma
id|val
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_while
c_loop
(paren
id|limit
op_decrement
)paren
(brace
id|val
op_assign
id|__phy_read
c_func
(paren
id|phy
comma
id|phy_id
comma
id|MII_BMCR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|BMCR_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_amp
id|BMCR_ISOLATE
)paren
op_logical_and
id|limit
OG
l_int|0
)paren
id|__phy_write
c_func
(paren
id|phy
comma
id|phy_id
comma
id|MII_BMCR
comma
id|val
op_amp
op_complement
id|BMCR_ISOLATE
)paren
suffix:semicolon
r_return
(paren
id|limit
op_le
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|bcm5201_init
r_static
r_int
id|bcm5201_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5201_MULTIPHY
)paren
suffix:semicolon
id|data
op_and_assign
op_complement
id|MII_BCM5201_MULTIPHY_SUPERISOLATE
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5201_MULTIPHY
comma
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5201_suspend
r_static
r_int
id|bcm5201_suspend
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|wol_options
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|wol_options
)paren
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5201_INTERRUPT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Here&squot;s a strange hack used by both MacOS 9 and X */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_LPA
comma
id|phy_read
c_func
(paren
id|phy
comma
id|MII_LPA
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wol_options
)paren
(brace
macro_line|#if 0 /* Commented out in Darwin... someone has those dawn docs ? */
id|u16
id|val
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5201_AUXMODE2
)paren
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5201_AUXMODE2
comma
id|val
op_amp
op_complement
id|MII_BCM5201_AUXMODE2_LOWPOWER
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5201_MULTIPHY
comma
id|MII_BCM5201_MULTIPHY_SUPERISOLATE
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5221_init
r_static
r_int
id|bcm5221_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5221_TEST
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5221_TEST
comma
id|data
op_or
id|MII_BCM5221_TEST_ENABLE_SHADOWS
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5221_SHDOW_AUX_STAT2
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5221_SHDOW_AUX_STAT2
comma
id|data
op_or
id|MII_BCM5221_SHDOW_AUX_STAT2_APD
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5221_SHDOW_AUX_MODE4
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5221_SHDOW_AUX_MODE4
comma
id|data
op_or
id|MII_BCM5221_SHDOW_AUX_MODE4_CLKLOPWR
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5221_TEST
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5221_TEST
comma
id|data
op_amp
op_complement
id|MII_BCM5221_TEST_ENABLE_SHADOWS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5400_init
r_static
r_int
id|bcm5400_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
multiline_comment|/* Configure for gigabit full duplex */
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_AUXCONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5400_AUXCONTROL_PWR10BASET
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5400_AUXCONTROL
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5400_GB_CONTROL_FULLDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
comma
id|data
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Reset and configure cascaded 10/100 PHY */
(paren
r_void
)paren
id|reset_one_mii_phy
c_func
(paren
id|phy
comma
l_int|0x1f
)paren
suffix:semicolon
id|data
op_assign
id|__phy_read
c_func
(paren
id|phy
comma
l_int|0x1f
comma
id|MII_BCM5201_MULTIPHY
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5201_MULTIPHY_SERIALMODE
suffix:semicolon
id|__phy_write
c_func
(paren
id|phy
comma
l_int|0x1f
comma
id|MII_BCM5201_MULTIPHY
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_AUXCONTROL
)paren
suffix:semicolon
id|data
op_and_assign
op_complement
id|MII_BCM5400_AUXCONTROL_PWR10BASET
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5400_AUXCONTROL
comma
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5400_suspend
r_static
r_int
id|bcm5400_suspend
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|wol_options
)paren
(brace
macro_line|#if 0 /* Commented out in Darwin... someone has those dawn docs ? */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|BMCR_PDOWN
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5401_init
r_static
r_int
id|bcm5401_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
r_int
id|rev
suffix:semicolon
id|rev
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_PHYSID2
)paren
op_amp
l_int|0x000f
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|0
op_logical_or
id|rev
op_eq
l_int|3
)paren
(brace
multiline_comment|/* Some revisions of 5401 appear to need this&n;&t;&t; * initialisation sequence to disable, according&n;&t;&t; * to OF, &quot;tap power management&quot;&n;&t;&t; * &n;&t;&t; * WARNING ! OF and Darwin don&squot;t agree on the&n;&t;&t; * register addresses. OF seem to interpret the&n;&t;&t; * register numbers below as decimal&n;&t;&t; *&n;&t;&t; * Note: This should (and does) match tg3_init_5401phy_dsp&n;&t;&t; *       in the tg3.c driver. -DaveM&n;&t;&t; */
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x18
comma
l_int|0x0c20
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x0012
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
l_int|0x1804
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x0013
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
l_int|0x1204
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x8006
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
l_int|0x0132
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x8006
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
l_int|0x0232
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x201f
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
l_int|0x0a20
)paren
suffix:semicolon
)brace
multiline_comment|/* Configure for gigabit full duplex */
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5400_GB_CONTROL_FULLDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
comma
id|data
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Reset and configure cascaded 10/100 PHY */
(paren
r_void
)paren
id|reset_one_mii_phy
c_func
(paren
id|phy
comma
l_int|0x1f
)paren
suffix:semicolon
id|data
op_assign
id|__phy_read
c_func
(paren
id|phy
comma
l_int|0x1f
comma
id|MII_BCM5201_MULTIPHY
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5201_MULTIPHY_SERIALMODE
suffix:semicolon
id|__phy_write
c_func
(paren
id|phy
comma
l_int|0x1f
comma
id|MII_BCM5201_MULTIPHY
comma
id|data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5401_suspend
r_static
r_int
id|bcm5401_suspend
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|wol_options
)paren
(brace
macro_line|#if 0 /* Commented out in Darwin... someone has those dawn docs ? */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|BMCR_PDOWN
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5411_init
r_static
r_int
id|bcm5411_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
multiline_comment|/* Here&squot;s some more Apple black magic to setup&n;&t; * some voltage stuffs.&n;&t; */
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0x8c23
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0x8ca3
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0x8c23
)paren
suffix:semicolon
multiline_comment|/* Here, Apple seems to want to reset it, do&n;&t; * it as well&n;&t; */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|BMCR_RESET
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
l_int|0x1340
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_BCM5400_GB_CONTROL_FULLDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BCM5400_GB_CONTROL
comma
id|data
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Reset and configure cascaded 10/100 PHY */
(paren
r_void
)paren
id|reset_one_mii_phy
c_func
(paren
id|phy
comma
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5411_suspend
r_static
r_int
id|bcm5411_suspend
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|wol_options
)paren
(brace
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|BMCR_PDOWN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm5421_init
r_static
r_int
id|bcm5421_init
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|data
suffix:semicolon
r_int
id|rev
suffix:semicolon
id|rev
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_PHYSID2
)paren
op_amp
l_int|0x000f
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|0
)paren
(brace
multiline_comment|/* This is borrowed from MacOS&n;&t;&t; */
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x18
comma
l_int|0x1007
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
l_int|0x18
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x18
comma
id|data
op_or
l_int|0x0400
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x18
comma
l_int|0x0007
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
l_int|0x18
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x18
comma
id|data
op_or
l_int|0x0800
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x17
comma
l_int|0x000a
)paren
suffix:semicolon
id|data
op_assign
id|phy_read
c_func
(paren
id|phy
comma
l_int|0x15
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x15
comma
id|data
op_or
l_int|0x0200
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* This has to be verified before I enable it */
multiline_comment|/* Enable automatic low-power */
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0x9002
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0xa821
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
l_int|0x1c
comma
l_int|0x941d
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm54xx_setup_aneg
r_static
r_int
id|bcm54xx_setup_aneg
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
id|u32
id|advertise
)paren
(brace
id|u16
id|ctl
comma
id|adv
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
id|phy-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;advertising
op_assign
id|advertise
suffix:semicolon
multiline_comment|/* Setup standard advertise */
id|adv
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Setup 1000BT advertise */
id|adv
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_1000BASETCONTROL
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
op_or
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|SUPPORTED_1000baseT_Half
)paren
id|adv
op_or_assign
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|SUPPORTED_1000baseT_Full
)paren
id|adv
op_or_assign
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_1000BASETCONTROL
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Start/Restart aneg */
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm54xx_setup_forced
r_static
r_int
id|bcm54xx_setup_forced
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|speed
comma
r_int
id|fd
)paren
(brace
id|u16
id|ctl
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;speed
op_assign
id|speed
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|fd
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_and_assign
op_complement
(paren
id|BMCR_FULLDPLX
op_or
id|BMCR_SPEED100
op_or
id|BMCR_SPD2
op_or
id|BMCR_ANENABLE
)paren
suffix:semicolon
multiline_comment|/* First reset the PHY */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
op_or
id|BMCR_RESET
)paren
suffix:semicolon
multiline_comment|/* Select speed &amp; duplex */
r_switch
c_cond
(paren
id|speed
)paren
(brace
r_case
id|SPEED_10
suffix:colon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_1000
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPD2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fd
op_eq
id|DUPLEX_FULL
)paren
id|ctl
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
singleline_comment|// XXX Should we set the sungem to GII now on 1000BT ?
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm54xx_read_link
r_static
r_int
id|bcm54xx_read_link
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
r_int
id|link_mode
suffix:semicolon
id|u16
id|val
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;autoneg
)paren
(brace
id|val
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BCM5400_AUXSTATUS
)paren
suffix:semicolon
id|link_mode
op_assign
(paren
(paren
id|val
op_amp
id|MII_BCM5400_AUXSTATUS_LINKMODE_MASK
)paren
op_rshift
id|MII_BCM5400_AUXSTATUS_LINKMODE_SHIFT
)paren
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|phy_BCM5400_link_table
(braket
id|link_mode
)braket
(braket
l_int|0
)braket
ques
c_cond
id|DUPLEX_FULL
suffix:colon
id|DUPLEX_HALF
suffix:semicolon
id|phy-&gt;speed
op_assign
id|phy_BCM5400_link_table
(braket
id|link_mode
)braket
(braket
l_int|2
)braket
ques
c_cond
id|SPEED_1000
suffix:colon
(paren
id|phy_BCM5400_link_table
(braket
id|link_mode
)braket
(braket
l_int|1
)braket
ques
c_cond
id|SPEED_100
suffix:colon
id|SPEED_10
)paren
suffix:semicolon
id|val
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_LPA
)paren
suffix:semicolon
id|phy-&gt;pause
op_assign
(paren
(paren
id|val
op_amp
id|LPA_PAUSE
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* On non-aneg, we assume what we put in BMCR is the speed,&n;&t; * though magic-aneg shouldn&squot;t prevent this case from occurring&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|marvell_setup_aneg
r_static
r_int
id|marvell_setup_aneg
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
id|u32
id|advertise
)paren
(brace
id|u16
id|ctl
comma
id|adv
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
id|phy-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;advertising
op_assign
id|advertise
suffix:semicolon
multiline_comment|/* Setup standard advertise */
id|adv
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Setup 1000BT advertise &amp; enable crossover detect&n;&t; * XXX How do we advertise 1000BT ? Darwin source is&n;&t; * confusing here, they read from specific control and&n;&t; * write to control... Someone has specs for those&n;&t; * beasts ?&n;&t; */
id|adv
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_M1011_PHY_SPEC_CONTROL
)paren
suffix:semicolon
id|adv
op_or_assign
id|MII_M1011_PHY_SPEC_CONTROL_AUTO_MDIX
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
op_or
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|SUPPORTED_1000baseT_Half
)paren
id|adv
op_or_assign
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|SUPPORTED_1000baseT_Full
)paren
id|adv
op_or_assign
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_1000BASETCONTROL
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Start/Restart aneg */
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|marvell_setup_forced
r_static
r_int
id|marvell_setup_forced
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|speed
comma
r_int
id|fd
)paren
(brace
id|u16
id|ctl
comma
id|ctl2
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;speed
op_assign
id|speed
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|fd
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_and_assign
op_complement
(paren
id|BMCR_FULLDPLX
op_or
id|BMCR_SPEED100
op_or
id|BMCR_SPD2
op_or
id|BMCR_ANENABLE
)paren
suffix:semicolon
id|ctl
op_or_assign
id|BMCR_RESET
suffix:semicolon
multiline_comment|/* Select speed &amp; duplex */
r_switch
c_cond
(paren
id|speed
)paren
(brace
r_case
id|SPEED_10
suffix:colon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* I&squot;m not sure about the one below, again, Darwin source is&n;&t; * quite confusing and I lack chip specs&n;&t; */
r_case
id|SPEED_1000
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPD2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fd
op_eq
id|DUPLEX_FULL
)paren
id|ctl
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
multiline_comment|/* Disable crossover. Again, the way Apple does it is strange,&n;&t; * though I don&squot;t assume they are wrong ;)&n;&t; */
id|ctl2
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_M1011_PHY_SPEC_CONTROL
)paren
suffix:semicolon
id|ctl2
op_and_assign
op_complement
(paren
id|MII_M1011_PHY_SPEC_CONTROL_MANUAL_MDIX
op_or
id|MII_M1011_PHY_SPEC_CONTROL_AUTO_MDIX
op_or
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
op_or
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|speed
op_eq
id|SPEED_1000
)paren
id|ctl2
op_or_assign
(paren
id|fd
op_eq
id|DUPLEX_FULL
)paren
ques
c_cond
id|MII_1000BASETCONTROL_FULLDUPLEXCAP
suffix:colon
id|MII_1000BASETCONTROL_HALFDUPLEXCAP
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_1000BASETCONTROL
comma
id|ctl2
)paren
suffix:semicolon
singleline_comment|// XXX Should we set the sungem to GII now on 1000BT ?
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|marvell_read_link
r_static
r_int
id|marvell_read_link
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|status
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;autoneg
)paren
(brace
id|status
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_M1011_PHY_SPEC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|MII_M1011_PHY_SPEC_STATUS_RESOLVED
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|MII_M1011_PHY_SPEC_STATUS_1000
)paren
id|phy-&gt;speed
op_assign
id|SPEED_1000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|status
op_amp
id|MII_M1011_PHY_SPEC_STATUS_100
)paren
id|phy-&gt;speed
op_assign
id|SPEED_100
suffix:semicolon
r_else
id|phy-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|MII_M1011_PHY_SPEC_STATUS_FULLDUPLEX
)paren
id|phy-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_else
id|phy-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* XXX Check against spec ! */
)brace
multiline_comment|/* On non-aneg, we assume what we put in BMCR is the speed,&n;&t; * though magic-aneg shouldn&squot;t prevent this case from occurring&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|genmii_setup_aneg
r_static
r_int
id|genmii_setup_aneg
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
id|u32
id|advertise
)paren
(brace
id|u16
id|ctl
comma
id|adv
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
id|phy-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;advertising
op_assign
id|advertise
suffix:semicolon
multiline_comment|/* Setup standard advertise */
id|adv
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Start/Restart aneg */
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|genmii_setup_forced
r_static
r_int
id|genmii_setup_forced
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|speed
comma
r_int
id|fd
)paren
(brace
id|u16
id|ctl
suffix:semicolon
id|phy-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;speed
op_assign
id|speed
suffix:semicolon
id|phy-&gt;duplex
op_assign
id|fd
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|ctl
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_and_assign
op_complement
(paren
id|BMCR_FULLDPLX
op_or
id|BMCR_SPEED100
op_or
id|BMCR_ANENABLE
)paren
suffix:semicolon
multiline_comment|/* First reset the PHY */
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
op_or
id|BMCR_RESET
)paren
suffix:semicolon
multiline_comment|/* Select speed &amp; duplex */
r_switch
c_cond
(paren
id|speed
)paren
(brace
r_case
id|SPEED_10
suffix:colon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_1000
suffix:colon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fd
op_eq
id|DUPLEX_FULL
)paren
id|ctl
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
id|phy_write
c_func
(paren
id|phy
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|genmii_poll_link
r_static
r_int
id|genmii_poll_link
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|status
suffix:semicolon
(paren
r_void
)paren
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMSR
)paren
suffix:semicolon
id|status
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_BMSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|BMSR_LSTATUS
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;autoneg
op_logical_and
op_logical_neg
(paren
id|status
op_amp
id|BMSR_ANEGCOMPLETE
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|genmii_read_link
r_static
r_int
id|genmii_read_link
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|lpa
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;autoneg
)paren
(brace
id|lpa
op_assign
id|phy_read
c_func
(paren
id|phy
comma
id|MII_LPA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lpa
op_amp
(paren
id|LPA_10FULL
op_or
id|LPA_100FULL
)paren
)paren
id|phy-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_else
id|phy-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_if
c_cond
(paren
id|lpa
op_amp
(paren
id|LPA_100FULL
op_or
id|LPA_100HALF
)paren
)paren
id|phy-&gt;speed
op_assign
id|SPEED_100
suffix:semicolon
r_else
id|phy-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* On non-aneg, we assume what we put in BMCR is the speed,&n;&t; * though magic-aneg shouldn&squot;t prevent this case from occurring&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|MII_BASIC_FEATURES
mdefine_line|#define MII_BASIC_FEATURES&t;(SUPPORTED_10baseT_Half | SUPPORTED_10baseT_Full | &bslash;&n;&t;&t;&t;&t; SUPPORTED_100baseT_Half | SUPPORTED_100baseT_Full | &bslash;&n;&t;&t;&t;&t; SUPPORTED_Autoneg | SUPPORTED_TP | SUPPORTED_MII)
DECL|macro|MII_GBIT_FEATURES
mdefine_line|#define MII_GBIT_FEATURES&t;(MII_BASIC_FEATURES | &bslash;&n;&t;&t;&t;&t; SUPPORTED_1000baseT_Half | SUPPORTED_1000baseT_Full)
multiline_comment|/* Broadcom BCM 5201 */
DECL|variable|bcm5201_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5201_phy_ops
op_assign
(brace
dot
id|init
op_assign
id|bcm5201_init
comma
dot
id|suspend
op_assign
id|bcm5201_suspend
comma
dot
id|setup_aneg
op_assign
id|genmii_setup_aneg
comma
dot
id|setup_forced
op_assign
id|genmii_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|genmii_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5201_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5201_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x00406210
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5201&quot;
comma
dot
id|features
op_assign
id|MII_BASIC_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|0
comma
dot
id|ops
op_assign
op_amp
id|bcm5201_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Broadcom BCM 5221 */
DECL|variable|bcm5221_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5221_phy_ops
op_assign
(brace
dot
id|suspend
op_assign
id|bcm5201_suspend
comma
dot
id|init
op_assign
id|bcm5221_init
comma
dot
id|setup_aneg
op_assign
id|genmii_setup_aneg
comma
dot
id|setup_forced
op_assign
id|genmii_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|genmii_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5221_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5221_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x004061e0
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5221&quot;
comma
dot
id|features
op_assign
id|MII_BASIC_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|0
comma
dot
id|ops
op_assign
op_amp
id|bcm5221_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Broadcom BCM 5400 */
DECL|variable|bcm5400_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5400_phy_ops
op_assign
(brace
dot
id|init
op_assign
id|bcm5400_init
comma
dot
id|suspend
op_assign
id|bcm5400_suspend
comma
dot
id|setup_aneg
op_assign
id|bcm54xx_setup_aneg
comma
dot
id|setup_forced
op_assign
id|bcm54xx_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|bcm54xx_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5400_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5400_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x00206040
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5400&quot;
comma
dot
id|features
op_assign
id|MII_GBIT_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|1
comma
dot
id|ops
op_assign
op_amp
id|bcm5400_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Broadcom BCM 5401 */
DECL|variable|bcm5401_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5401_phy_ops
op_assign
(brace
dot
id|init
op_assign
id|bcm5401_init
comma
dot
id|suspend
op_assign
id|bcm5401_suspend
comma
dot
id|setup_aneg
op_assign
id|bcm54xx_setup_aneg
comma
dot
id|setup_forced
op_assign
id|bcm54xx_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|bcm54xx_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5401_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5401_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x00206050
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5401&quot;
comma
dot
id|features
op_assign
id|MII_GBIT_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|1
comma
dot
id|ops
op_assign
op_amp
id|bcm5401_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Broadcom BCM 5411 */
DECL|variable|bcm5411_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5411_phy_ops
op_assign
(brace
dot
id|init
op_assign
id|bcm5411_init
comma
dot
id|suspend
op_assign
id|bcm5411_suspend
comma
dot
id|setup_aneg
op_assign
id|bcm54xx_setup_aneg
comma
dot
id|setup_forced
op_assign
id|bcm54xx_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|bcm54xx_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5411_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5411_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x00206070
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5411&quot;
comma
dot
id|features
op_assign
id|MII_GBIT_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|1
comma
dot
id|ops
op_assign
op_amp
id|bcm5411_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Broadcom BCM 5421 */
DECL|variable|bcm5421_phy_ops
r_static
r_struct
id|mii_phy_ops
id|bcm5421_phy_ops
op_assign
(brace
dot
id|init
op_assign
id|bcm5421_init
comma
dot
id|suspend
op_assign
id|bcm5411_suspend
comma
dot
id|setup_aneg
op_assign
id|bcm54xx_setup_aneg
comma
dot
id|setup_forced
op_assign
id|bcm54xx_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|bcm54xx_read_link
comma
)brace
suffix:semicolon
DECL|variable|bcm5421_phy_def
r_static
r_struct
id|mii_phy_def
id|bcm5421_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x002060e0
comma
dot
id|phy_id_mask
op_assign
l_int|0xfffffff0
comma
dot
id|name
op_assign
l_string|&quot;BCM5421&quot;
comma
dot
id|features
op_assign
id|MII_GBIT_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|1
comma
dot
id|ops
op_assign
op_amp
id|bcm5421_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Marvell 88E1101 (Apple seem to deal with 2 different revs,&n; * I masked out the 8 last bits to get both, but some specs&n; * would be useful here) --BenH.&n; */
DECL|variable|marvell_phy_ops
r_static
r_struct
id|mii_phy_ops
id|marvell_phy_ops
op_assign
(brace
dot
id|setup_aneg
op_assign
id|marvell_setup_aneg
comma
dot
id|setup_forced
op_assign
id|marvell_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|marvell_read_link
)brace
suffix:semicolon
DECL|variable|marvell_phy_def
r_static
r_struct
id|mii_phy_def
id|marvell_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x01410c00
comma
dot
id|phy_id_mask
op_assign
l_int|0xffffff00
comma
dot
id|name
op_assign
l_string|&quot;Marvell 88E1101&quot;
comma
dot
id|features
op_assign
id|MII_GBIT_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|1
comma
dot
id|ops
op_assign
op_amp
id|marvell_phy_ops
)brace
suffix:semicolon
multiline_comment|/* Generic implementation for most 10/100 PHYs */
DECL|variable|generic_phy_ops
r_static
r_struct
id|mii_phy_ops
id|generic_phy_ops
op_assign
(brace
dot
id|setup_aneg
op_assign
id|genmii_setup_aneg
comma
dot
id|setup_forced
op_assign
id|genmii_setup_forced
comma
dot
id|poll_link
op_assign
id|genmii_poll_link
comma
dot
id|read_link
op_assign
id|genmii_read_link
)brace
suffix:semicolon
DECL|variable|genmii_phy_def
r_static
r_struct
id|mii_phy_def
id|genmii_phy_def
op_assign
(brace
dot
id|phy_id
op_assign
l_int|0x00000000
comma
dot
id|phy_id_mask
op_assign
l_int|0x00000000
comma
dot
id|name
op_assign
l_string|&quot;Generic MII&quot;
comma
dot
id|features
op_assign
id|MII_BASIC_FEATURES
comma
dot
id|magic_aneg
op_assign
l_int|0
comma
dot
id|ops
op_assign
op_amp
id|generic_phy_ops
)brace
suffix:semicolon
DECL|variable|mii_phy_table
r_static
r_struct
id|mii_phy_def
op_star
id|mii_phy_table
(braket
)braket
op_assign
(brace
op_amp
id|bcm5201_phy_def
comma
op_amp
id|bcm5221_phy_def
comma
op_amp
id|bcm5400_phy_def
comma
op_amp
id|bcm5401_phy_def
comma
op_amp
id|bcm5411_phy_def
comma
op_amp
id|bcm5421_phy_def
comma
op_amp
id|marvell_phy_def
comma
op_amp
id|genmii_phy_def
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|mii_phy_probe
r_int
id|mii_phy_probe
c_func
(paren
r_struct
id|mii_phy
op_star
id|phy
comma
r_int
id|mii_id
)paren
(brace
r_int
id|rc
suffix:semicolon
id|u32
id|id
suffix:semicolon
r_struct
id|mii_phy_def
op_star
id|def
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* We do not reset the mii_phy structure as the driver&n;&t; * may re-probe the PHY regulary&n;&t; */
id|phy-&gt;mii_id
op_assign
id|mii_id
suffix:semicolon
multiline_comment|/* Take PHY out of isloate mode and reset it. */
id|rc
op_assign
id|reset_one_mii_phy
c_func
(paren
id|phy
comma
id|mii_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|fail
suffix:semicolon
multiline_comment|/* Read ID and find matching entry */
id|id
op_assign
(paren
id|phy_read
c_func
(paren
id|phy
comma
id|MII_PHYSID1
)paren
op_lshift
l_int|16
op_or
id|phy_read
c_func
(paren
id|phy
comma
id|MII_PHYSID2
)paren
)paren
op_amp
l_int|0xfffffff0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|def
op_assign
id|mii_phy_table
(braket
id|i
)braket
)paren
op_ne
l_int|NULL
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|id
op_amp
id|def-&gt;phy_id_mask
)paren
op_eq
id|def-&gt;phy_id
)paren
r_break
suffix:semicolon
multiline_comment|/* Should never be NULL (we have a generic entry), but... */
r_if
c_cond
(paren
id|def
op_eq
l_int|NULL
)paren
r_goto
id|fail
suffix:semicolon
id|phy-&gt;def
op_assign
id|def
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|phy-&gt;speed
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;duplex
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;pause
op_assign
l_int|0
suffix:semicolon
id|phy-&gt;advertising
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|mii_phy_probe
id|EXPORT_SYMBOL
c_func
(paren
id|mii_phy_probe
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
