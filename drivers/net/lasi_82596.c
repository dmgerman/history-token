multiline_comment|/* lasi_82596.c -- driver for the intel 82596 ethernet controller, as&n;   munged into HPPA boxen .&n;&n;   This driver is based upon 82596.c, original credits are below...&n;   but there were too many hoops which HP wants jumped through to&n;   keep this code in there in a sane manner.&n;&n;   3 primary sources of the mess -- &n;   1) hppa needs *lots* of cacheline flushing to keep this kind of&n;   MMIO running.&n;&n;   2) The 82596 needs to see all of its pointers as their physical&n;   address.  Thus virt_to_bus/bus_to_virt are *everywhere*.&n;&n;   3) The implementation HP is using seems to be significantly pickier &n;   about when and how the command and RX units are started.  some&n;   command ordering was changed.&n;&n;   Examination of the mach driver leads one to believe that there&n;   might be a saner way to pull this off...  anyone who feels like a&n;   full rewrite can be my guest.&n;&n;   Split 02/13/2000 Sam Creasey (sammy@oh.verio.com)&n;   &n;   02/01/2000  Initial modifications for parisc by Helge Deller (deller@gmx.de)&n;   03/02/2000  changes for better/correct(?) cache-flushing (deller)&n;*/
multiline_comment|/* 82596.c: A generic 82596 ethernet driver for linux. */
multiline_comment|/*&n;   Based on Apricot.c&n;   Written 1994 by Mark Evans.&n;   This driver is for the Apricot 82596 bus-master interface&n;&n;   Modularised 12/94 Mark Evans&n;&n;&n;   Modified to support the 82596 ethernet chips on 680x0 VME boards.&n;   by Richard Hirst &lt;richard@sleepie.demon.co.uk&gt;&n;   Renamed to be 82596.c&n;&n;   980825:  Changed to receive directly in to sk_buffs which are&n;   allocated at open() time.  Eliminates copy on incoming frames&n;   (small ones are still copied).  Shared data now held in a&n;   non-cached page, so we can run on 68060 in copyback mode.&n;&n;   TBD:&n;   * look at deferring rx frames rather than discarding (as per tulip)&n;   * handle tx ring full as per tulip&n;   * performace test to tune rx_copybreak&n;&n;   Most of my modifications relate to the braindead big-endian&n;   implementation by Intel.  When the i596 is operating in&n;   &squot;big-endian&squot; mode, it thinks a 32 bit value of 0x12345678&n;   should be stored as 0x56781234.  This is a real pain, when&n;   you have linked lists which are shared by the 680x0 and the&n;   i596.&n;&n;   Driver skeleton&n;   Written 1993 by Donald Becker.&n;   Copyright 1993 United States Government as represented by the Director,&n;   National Security Agency. This software may only be used and distributed&n;   according to the terms of the GNU General Public License as modified by SRC,&n;   incorporated herein by reference.&n;&n;   The author may be reached as becker@scyld.com, or C/O&n;   Scyld Computing Corporation, 410 Severn Ave., Suite 210, Annapolis MD 21403&n;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pdc.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/parisc-device.h&gt;
DECL|macro|LASI_82596_DRIVER_VERSION
mdefine_line|#define LASI_82596_DRIVER_VERSION &quot;LASI 82596 driver - Revision: 1.30&quot;
multiline_comment|/* DEBUG flags&n; */
DECL|macro|DEB_INIT
mdefine_line|#define DEB_INIT&t;0x0001
DECL|macro|DEB_PROBE
mdefine_line|#define DEB_PROBE&t;0x0002
DECL|macro|DEB_SERIOUS
mdefine_line|#define DEB_SERIOUS&t;0x0004
DECL|macro|DEB_ERRORS
mdefine_line|#define DEB_ERRORS&t;0x0008
DECL|macro|DEB_MULTI
mdefine_line|#define DEB_MULTI&t;0x0010
DECL|macro|DEB_TDR
mdefine_line|#define DEB_TDR&t;&t;0x0020
DECL|macro|DEB_OPEN
mdefine_line|#define DEB_OPEN&t;0x0040
DECL|macro|DEB_RESET
mdefine_line|#define DEB_RESET&t;0x0080
DECL|macro|DEB_ADDCMD
mdefine_line|#define DEB_ADDCMD&t;0x0100
DECL|macro|DEB_STATUS
mdefine_line|#define DEB_STATUS&t;0x0200
DECL|macro|DEB_STARTTX
mdefine_line|#define DEB_STARTTX&t;0x0400
DECL|macro|DEB_RXADDR
mdefine_line|#define DEB_RXADDR&t;0x0800
DECL|macro|DEB_TXADDR
mdefine_line|#define DEB_TXADDR&t;0x1000
DECL|macro|DEB_RXFRAME
mdefine_line|#define DEB_RXFRAME&t;0x2000
DECL|macro|DEB_INTS
mdefine_line|#define DEB_INTS&t;0x4000
DECL|macro|DEB_STRUCT
mdefine_line|#define DEB_STRUCT&t;0x8000
DECL|macro|DEB_ANY
mdefine_line|#define DEB_ANY&t;&t;0xffff
DECL|macro|DEB
mdefine_line|#define DEB(x,y)&t;if (i596_debug &amp; (x)) { y; }
DECL|macro|CHECK_WBACK
mdefine_line|#define  CHECK_WBACK(addr,len) &bslash;&n;&t;do { dma_cache_sync((void *)addr, len, DMA_TO_DEVICE); } while (0)
DECL|macro|CHECK_INV
mdefine_line|#define  CHECK_INV(addr,len) &bslash;&n;&t;do { dma_cache_sync((void *)addr, len, DMA_FROM_DEVICE); } while(0)
DECL|macro|CHECK_WBACK_INV
mdefine_line|#define  CHECK_WBACK_INV(addr,len) &bslash;&n;&t;do { dma_cache_sync((void *)addr, len, DMA_BIDIRECTIONAL); } while (0)
DECL|macro|PA_I82596_RESET
mdefine_line|#define PA_I82596_RESET&t;&t;0&t;/* Offsets relative to LASI-LAN-Addr.*/
DECL|macro|PA_CPU_PORT_L_ACCESS
mdefine_line|#define PA_CPU_PORT_L_ACCESS&t;4
DECL|macro|PA_CHANNEL_ATTENTION
mdefine_line|#define PA_CHANNEL_ATTENTION&t;8
multiline_comment|/*&n; * Define various macros for Channel Attention, word swapping etc., dependent&n; * on architecture.  MVME and BVME are 680x0 based, otherwise it is Intel.&n; */
macro_line|#ifdef __BIG_ENDIAN
DECL|macro|WSWAPrfd
mdefine_line|#define WSWAPrfd(x)  (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPrbd
mdefine_line|#define WSWAPrbd(x)  (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPiscp
mdefine_line|#define WSWAPiscp(x) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPscb
mdefine_line|#define WSWAPscb(x)  (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPcmd
mdefine_line|#define WSWAPcmd(x)  (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPtbd
mdefine_line|#define WSWAPtbd(x)  (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|WSWAPchar
mdefine_line|#define WSWAPchar(x) (((u32)(x)&lt;&lt;16) | ((((u32)(x)))&gt;&gt;16))
DECL|macro|ISCP_BUSY
mdefine_line|#define ISCP_BUSY&t;0x00010000
DECL|macro|MACH_IS_APRICOT
mdefine_line|#define MACH_IS_APRICOT&t;0
macro_line|#else
DECL|macro|WSWAPrfd
mdefine_line|#define WSWAPrfd(x)     ((struct i596_rfd *)(x))
DECL|macro|WSWAPrbd
mdefine_line|#define WSWAPrbd(x)     ((struct i596_rbd *)(x))
DECL|macro|WSWAPiscp
mdefine_line|#define WSWAPiscp(x)    ((struct i596_iscp *)(x))
DECL|macro|WSWAPscb
mdefine_line|#define WSWAPscb(x)     ((struct i596_scb *)(x))
DECL|macro|WSWAPcmd
mdefine_line|#define WSWAPcmd(x)     ((struct i596_cmd *)(x))
DECL|macro|WSWAPtbd
mdefine_line|#define WSWAPtbd(x)     ((struct i596_tbd *)(x))
DECL|macro|WSWAPchar
mdefine_line|#define WSWAPchar(x)    ((char *)(x))
DECL|macro|ISCP_BUSY
mdefine_line|#define ISCP_BUSY&t;0x0001
DECL|macro|MACH_IS_APRICOT
mdefine_line|#define MACH_IS_APRICOT&t;1
macro_line|#endif
multiline_comment|/*&n; * The MPU_PORT command allows direct access to the 82596. With PORT access&n; * the following commands are available (p5-18). The 32-bit port command&n; * must be word-swapped with the most significant word written first.&n; * This only applies to VME boards.&n; */
DECL|macro|PORT_RESET
mdefine_line|#define PORT_RESET&t;&t;0x00&t;/* reset 82596 */
DECL|macro|PORT_SELFTEST
mdefine_line|#define PORT_SELFTEST&t;&t;0x01&t;/* selftest */
DECL|macro|PORT_ALTSCP
mdefine_line|#define PORT_ALTSCP&t;&t;0x02&t;/* alternate SCB address */
DECL|macro|PORT_ALTDUMP
mdefine_line|#define PORT_ALTDUMP&t;&t;0x03&t;/* Alternate DUMP address */
DECL|variable|i596_debug
r_static
r_int
id|i596_debug
op_assign
(paren
id|DEB_SERIOUS
op_or
id|DEB_PROBE
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Richard Hirst&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;i82596 driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|i596_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|i596_debug
comma
l_string|&quot;lasi_82596 debug mask&quot;
)paren
suffix:semicolon
multiline_comment|/* Copy frames shorter than rx_copybreak, otherwise pass on up in&n; * a full sized sk_buff.  Value of 100 stolen from tulip.c (!alpha).&n; */
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|100
suffix:semicolon
DECL|macro|MAX_DRIVERS
mdefine_line|#define MAX_DRIVERS&t;4&t;/* max count of drivers */
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ&t;1536
DECL|macro|MAX_MC_CNT
mdefine_line|#define MAX_MC_CNT&t;64
DECL|macro|I596_NULL
mdefine_line|#define I596_NULL ((u32)0xffffffff)
DECL|macro|CMD_EOL
mdefine_line|#define CMD_EOL&t;&t;0x8000&t;/* The last command of the list, stop. */
DECL|macro|CMD_SUSP
mdefine_line|#define CMD_SUSP&t;0x4000&t;/* Suspend after doing cmd. */
DECL|macro|CMD_INTR
mdefine_line|#define CMD_INTR&t;0x2000&t;/* Interrupt after doing cmd. */
DECL|macro|CMD_FLEX
mdefine_line|#define CMD_FLEX&t;0x0008&t;/* Enable flexible memory model */
DECL|enum|commands
r_enum
id|commands
(brace
DECL|enumerator|CmdNOp
DECL|enumerator|CmdSASetup
DECL|enumerator|CmdConfigure
DECL|enumerator|CmdMulticastList
id|CmdNOp
op_assign
l_int|0
comma
id|CmdSASetup
op_assign
l_int|1
comma
id|CmdConfigure
op_assign
l_int|2
comma
id|CmdMulticastList
op_assign
l_int|3
comma
DECL|enumerator|CmdTx
DECL|enumerator|CmdTDR
DECL|enumerator|CmdDump
DECL|enumerator|CmdDiagnose
id|CmdTx
op_assign
l_int|4
comma
id|CmdTDR
op_assign
l_int|5
comma
id|CmdDump
op_assign
l_int|6
comma
id|CmdDiagnose
op_assign
l_int|7
)brace
suffix:semicolon
DECL|macro|STAT_C
mdefine_line|#define STAT_C&t;&t;0x8000&t;/* Set to 0 after execution */
DECL|macro|STAT_B
mdefine_line|#define STAT_B&t;&t;0x4000&t;/* Command being executed */
DECL|macro|STAT_OK
mdefine_line|#define STAT_OK&t;&t;0x2000&t;/* Command executed ok */
DECL|macro|STAT_A
mdefine_line|#define STAT_A&t;&t;0x1000&t;/* Command aborted */
DECL|macro|CUC_START
mdefine_line|#define&t; CUC_START&t;0x0100
DECL|macro|CUC_RESUME
mdefine_line|#define&t; CUC_RESUME&t;0x0200
DECL|macro|CUC_SUSPEND
mdefine_line|#define&t; CUC_SUSPEND    0x0300
DECL|macro|CUC_ABORT
mdefine_line|#define&t; CUC_ABORT&t;0x0400
DECL|macro|RX_START
mdefine_line|#define&t; RX_START&t;0x0010
DECL|macro|RX_RESUME
mdefine_line|#define&t; RX_RESUME&t;0x0020
DECL|macro|RX_SUSPEND
mdefine_line|#define&t; RX_SUSPEND&t;0x0030
DECL|macro|RX_ABORT
mdefine_line|#define&t; RX_ABORT&t;0x0040
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT&t;5
DECL|macro|OPT_SWAP_PORT
mdefine_line|#define OPT_SWAP_PORT&t;0x0001&t;/* Need to wordswp on the MPU port */
DECL|struct|i596_reg
r_struct
id|i596_reg
(brace
DECL|member|porthi
r_int
r_int
id|porthi
suffix:semicolon
DECL|member|portlo
r_int
r_int
id|portlo
suffix:semicolon
DECL|member|ca
id|u32
id|ca
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|EOF
mdefine_line|#define EOF&t;&t;0x8000
DECL|macro|SIZE_MASK
mdefine_line|#define SIZE_MASK&t;0x3fff
DECL|struct|i596_tbd
r_struct
id|i596_tbd
(brace
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|next
id|dma_addr_t
id|next
suffix:semicolon
DECL|member|data
id|dma_addr_t
id|data
suffix:semicolon
DECL|member|cache_pad
id|u32
id|cache_pad
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Total 32 bytes... */
)brace
suffix:semicolon
multiline_comment|/* The command structure has two &squot;next&squot; pointers; v_next is the address of&n; * the next command as seen by the CPU, b_next is the address of the next&n; * command as seen by the 82596.  The b_next pointer, as used by the 82596&n; * always references the status field of the next command, rather than the&n; * v_next field, because the 82596 is unaware of v_next.  It may seem more&n; * logical to put v_next at the end of the structure, but we cannot do that&n; * because the 82596 expects other fields to be there, depending on command&n; * type.&n; */
DECL|struct|i596_cmd
r_struct
id|i596_cmd
(brace
DECL|member|v_next
r_struct
id|i596_cmd
op_star
id|v_next
suffix:semicolon
multiline_comment|/* Address from CPUs viewpoint */
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
DECL|member|b_next
id|dma_addr_t
id|b_next
suffix:semicolon
multiline_comment|/* Address from i596 viewpoint */
)brace
suffix:semicolon
DECL|struct|tx_cmd
r_struct
id|tx_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|tbd
id|dma_addr_t
id|tbd
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* So we can free it after tx */
DECL|member|dma_addr
id|dma_addr_t
id|dma_addr
suffix:semicolon
macro_line|#ifdef __LP64__
DECL|member|cache_pad
id|u32
id|cache_pad
(braket
l_int|6
)braket
suffix:semicolon
multiline_comment|/* Total 64 bytes... */
macro_line|#else    
DECL|member|cache_pad
id|u32
id|cache_pad
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Total 32 bytes... */
macro_line|#endif    
)brace
suffix:semicolon
DECL|struct|tdr_cmd
r_struct
id|tdr_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|pad
r_int
r_int
id|pad
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|mc_cmd
r_struct
id|mc_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|mc_cnt
r_int
id|mc_cnt
suffix:semicolon
DECL|member|mc_addrs
r_char
id|mc_addrs
(braket
id|MAX_MC_CNT
op_star
l_int|6
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sa_cmd
r_struct
id|sa_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|eth_addr
r_char
id|eth_addr
(braket
l_int|8
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|cf_cmd
r_struct
id|cf_cmd
(brace
DECL|member|cmd
r_struct
id|i596_cmd
id|cmd
suffix:semicolon
DECL|member|i596_config
r_char
id|i596_config
(braket
l_int|16
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_rfd
r_struct
id|i596_rfd
(brace
DECL|member|stat
r_int
r_int
id|stat
suffix:semicolon
DECL|member|cmd
r_int
r_int
id|cmd
suffix:semicolon
DECL|member|b_next
id|dma_addr_t
id|b_next
suffix:semicolon
multiline_comment|/* Address from i596 viewpoint */
DECL|member|rbd
id|dma_addr_t
id|rbd
suffix:semicolon
DECL|member|count
r_int
r_int
id|count
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|v_next
r_struct
id|i596_rfd
op_star
id|v_next
suffix:semicolon
multiline_comment|/* Address from CPUs viewpoint */
DECL|member|v_prev
r_struct
id|i596_rfd
op_star
id|v_prev
suffix:semicolon
macro_line|#ifndef __LP64__    
DECL|member|cache_pad
id|u32
id|cache_pad
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Total 32 bytes... */
macro_line|#endif    
)brace
suffix:semicolon
DECL|struct|i596_rbd
r_struct
id|i596_rbd
(brace
multiline_comment|/* hardware data */
DECL|member|count
r_int
r_int
id|count
suffix:semicolon
DECL|member|zero1
r_int
r_int
id|zero1
suffix:semicolon
DECL|member|b_next
id|dma_addr_t
id|b_next
suffix:semicolon
DECL|member|b_data
id|dma_addr_t
id|b_data
suffix:semicolon
multiline_comment|/* Address from i596 viewpoint */
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|zero2
r_int
r_int
id|zero2
suffix:semicolon
multiline_comment|/* driver data */
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|v_next
r_struct
id|i596_rbd
op_star
id|v_next
suffix:semicolon
DECL|member|b_addr
id|dma_addr_t
id|b_addr
suffix:semicolon
multiline_comment|/* This rbd addr from i596 view */
DECL|member|v_data
r_int
r_char
op_star
id|v_data
suffix:semicolon
multiline_comment|/* Address from CPUs viewpoint */
multiline_comment|/* Total 32 bytes... */
macro_line|#ifdef __LP64__
DECL|member|cache_pad
id|u32
id|cache_pad
(braket
l_int|4
)braket
suffix:semicolon
macro_line|#endif    
)brace
suffix:semicolon
multiline_comment|/* These values as chosen so struct i596_private fits in one page... */
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE 32
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE 16
DECL|struct|i596_scb
r_struct
id|i596_scb
(brace
DECL|member|status
r_int
r_int
id|status
suffix:semicolon
DECL|member|command
r_int
r_int
id|command
suffix:semicolon
DECL|member|cmd
id|dma_addr_t
id|cmd
suffix:semicolon
DECL|member|rfd
id|dma_addr_t
id|rfd
suffix:semicolon
DECL|member|crc_err
id|u32
id|crc_err
suffix:semicolon
DECL|member|align_err
id|u32
id|align_err
suffix:semicolon
DECL|member|resource_err
id|u32
id|resource_err
suffix:semicolon
DECL|member|over_err
id|u32
id|over_err
suffix:semicolon
DECL|member|rcvdt_err
id|u32
id|rcvdt_err
suffix:semicolon
DECL|member|short_err
id|u32
id|short_err
suffix:semicolon
DECL|member|t_on
r_int
r_int
id|t_on
suffix:semicolon
DECL|member|t_off
r_int
r_int
id|t_off
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_iscp
r_struct
id|i596_iscp
(brace
DECL|member|stat
id|u32
id|stat
suffix:semicolon
DECL|member|scb
id|dma_addr_t
id|scb
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_scp
r_struct
id|i596_scp
(brace
DECL|member|sysbus
id|u32
id|sysbus
suffix:semicolon
DECL|member|pad
id|u32
id|pad
suffix:semicolon
DECL|member|iscp
id|dma_addr_t
id|iscp
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|i596_private
r_struct
id|i596_private
(brace
DECL|member|scp
r_volatile
r_struct
id|i596_scp
id|scp
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|iscp
r_volatile
r_struct
id|i596_iscp
id|iscp
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|scb
r_volatile
r_struct
id|i596_scb
id|scb
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|sa_cmd
r_struct
id|sa_cmd
id|sa_cmd
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|cf_cmd
r_struct
id|cf_cmd
id|cf_cmd
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|tdr_cmd
r_struct
id|tdr_cmd
id|tdr_cmd
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|mc_cmd
r_struct
id|mc_cmd
id|mc_cmd
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|rfds
r_struct
id|i596_rfd
id|rfds
(braket
id|RX_RING_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|rbds
r_struct
id|i596_rbd
id|rbds
(braket
id|RX_RING_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|tx_cmds
r_struct
id|tx_cmd
id|tx_cmds
(braket
id|TX_RING_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|tbds
r_struct
id|i596_tbd
id|tbds
(braket
id|TX_RING_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|32
)paren
)paren
)paren
suffix:semicolon
DECL|member|stat
id|u32
id|stat
suffix:semicolon
DECL|member|last_restart
r_int
id|last_restart
suffix:semicolon
DECL|member|rfd_head
r_struct
id|i596_rfd
op_star
id|rfd_head
suffix:semicolon
DECL|member|rbd_head
r_struct
id|i596_rbd
op_star
id|rbd_head
suffix:semicolon
DECL|member|cmd_tail
r_struct
id|i596_cmd
op_star
id|cmd_tail
suffix:semicolon
DECL|member|cmd_head
r_struct
id|i596_cmd
op_star
id|cmd_head
suffix:semicolon
DECL|member|cmd_backlog
r_int
id|cmd_backlog
suffix:semicolon
DECL|member|last_cmd
id|u32
id|last_cmd
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|next_tx_cmd
r_int
id|next_tx_cmd
suffix:semicolon
DECL|member|options
r_int
id|options
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|dma_addr
id|dma_addr_t
id|dma_addr
suffix:semicolon
DECL|member|dev
r_struct
id|device
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|init_setup
r_static
r_char
id|init_setup
(braket
)braket
op_assign
(brace
l_int|0x8E
comma
multiline_comment|/* length, prefetch on */
l_int|0xC8
comma
multiline_comment|/* fifo to 8, monitor off */
l_int|0x80
comma
multiline_comment|/* don&squot;t save bad frames */
l_int|0x2E
comma
multiline_comment|/* No source address insertion, 8 byte preamble */
l_int|0x00
comma
multiline_comment|/* priority and backoff defaults */
l_int|0x60
comma
multiline_comment|/* interframe spacing */
l_int|0x00
comma
multiline_comment|/* slot time LSB */
l_int|0xf2
comma
multiline_comment|/* slot time and retries */
l_int|0x00
comma
multiline_comment|/* promiscuous mode */
l_int|0x00
comma
multiline_comment|/* collision detect */
l_int|0x40
comma
multiline_comment|/* minimum frame length */
l_int|0xff
comma
l_int|0x00
comma
l_int|0x7f
multiline_comment|/*  *multi IA */
)brace
suffix:semicolon
r_static
r_int
id|i596_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|i596_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|i596_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|i596_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|i596_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|print_eth
c_func
(paren
r_int
r_char
op_star
id|buf
comma
r_char
op_star
id|str
)paren
suffix:semicolon
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|variable|rx_ring_size
r_static
r_int
id|rx_ring_size
op_assign
id|RX_RING_SIZE
suffix:semicolon
DECL|variable|ticks_limit
r_static
r_int
id|ticks_limit
op_assign
l_int|100
suffix:semicolon
DECL|variable|max_cmd_backlog
r_static
r_int
id|max_cmd_backlog
op_assign
id|TX_RING_SIZE
op_minus
l_int|1
suffix:semicolon
DECL|function|CA
r_static
r_inline
r_void
id|CA
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|gsc_writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|PA_CHANNEL_ATTENTION
)paren
suffix:semicolon
)brace
DECL|function|MPU_PORT
r_static
r_inline
r_void
id|MPU_PORT
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|c
comma
id|dma_addr_t
id|x
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|v
op_assign
(paren
id|u32
)paren
(paren
id|c
)paren
op_or
(paren
id|u32
)paren
(paren
id|x
)paren
suffix:semicolon
id|u16
id|a
comma
id|b
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;options
op_amp
id|OPT_SWAP_PORT
)paren
(brace
id|a
op_assign
id|v
op_rshift
l_int|16
suffix:semicolon
id|b
op_assign
id|v
op_amp
l_int|0xffff
suffix:semicolon
)brace
r_else
(brace
id|a
op_assign
id|v
op_amp
l_int|0xffff
suffix:semicolon
id|b
op_assign
id|v
op_rshift
l_int|16
suffix:semicolon
)brace
id|gsc_writel
c_func
(paren
id|a
comma
id|dev-&gt;base_addr
op_plus
id|PA_CPU_PORT_L_ACCESS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|gsc_writel
c_func
(paren
id|b
comma
id|dev-&gt;base_addr
op_plus
id|PA_CPU_PORT_L_ACCESS
)paren
suffix:semicolon
)brace
DECL|function|wait_istat
r_static
r_inline
r_int
id|wait_istat
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_private
op_star
id|lp
comma
r_int
id|delcnt
comma
r_char
op_star
id|str
)paren
(brace
id|CHECK_INV
c_func
(paren
op_amp
(paren
id|lp-&gt;iscp
)paren
comma
r_sizeof
(paren
r_struct
id|i596_iscp
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|delcnt
op_logical_and
id|lp-&gt;iscp.stat
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|CHECK_INV
c_func
(paren
op_amp
(paren
id|lp-&gt;iscp
)paren
comma
r_sizeof
(paren
r_struct
id|i596_iscp
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|delcnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s, iscp.stat %04x, didn&squot;t clear&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|str
comma
id|lp-&gt;iscp.stat
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wait_cmd
r_static
r_inline
r_int
id|wait_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_private
op_star
id|lp
comma
r_int
id|delcnt
comma
r_char
op_star
id|str
)paren
(brace
id|CHECK_INV
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|delcnt
op_logical_and
id|lp-&gt;scb.command
)paren
(brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|CHECK_INV
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|delcnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s, status %4.4x, cmd %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|str
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_display_data
r_static
r_void
id|i596_display_data
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_struct
id|i596_rbd
op_star
id|rbd
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;lp and scp at %p, .sysbus = %08x, .iscp = %08x&bslash;n&quot;
comma
op_amp
id|lp-&gt;scp
comma
id|lp-&gt;scp.sysbus
comma
id|lp-&gt;scp.iscp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;iscp at %p, iscp.stat = %08x, .scb = %08x&bslash;n&quot;
comma
op_amp
id|lp-&gt;iscp
comma
id|lp-&gt;iscp.stat
comma
id|lp-&gt;iscp.scb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;scb at %p, scb.status = %04x, .command = %04x,&quot;
l_string|&quot; .cmd = %08x, .rfd = %08x&bslash;n&quot;
comma
op_amp
id|lp-&gt;scb
comma
id|lp-&gt;scb.status
comma
id|lp-&gt;scb.command
comma
id|lp-&gt;scb.cmd
comma
id|lp-&gt;scb.rfd
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;   errors: crc %x, align %x, resource %x,&quot;
l_string|&quot; over %x, rcvdt %x, short %x&bslash;n&quot;
comma
id|lp-&gt;scb.crc_err
comma
id|lp-&gt;scb.align_err
comma
id|lp-&gt;scb.resource_err
comma
id|lp-&gt;scb.over_err
comma
id|lp-&gt;scb.rcvdt_err
comma
id|lp-&gt;scb.short_err
)paren
suffix:semicolon
id|cmd
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_while
c_loop
(paren
id|cmd
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;cmd at %p, .status = %04x, .command = %04x, .b_next = %08x&bslash;n&quot;
comma
id|cmd
comma
id|cmd-&gt;status
comma
id|cmd-&gt;command
comma
id|cmd-&gt;b_next
)paren
suffix:semicolon
id|cmd
op_assign
id|cmd-&gt;v_next
suffix:semicolon
)brace
id|rfd
op_assign
id|lp-&gt;rfd_head
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rfd_head = %p&bslash;n&quot;
comma
id|rfd
)paren
suffix:semicolon
r_do
(brace
id|printk
c_func
(paren
l_string|&quot;   %p .stat %04x, .cmd %04x, b_next %08x, rbd %08x,&quot;
l_string|&quot; count %04x&bslash;n&quot;
comma
id|rfd
comma
id|rfd-&gt;stat
comma
id|rfd-&gt;cmd
comma
id|rfd-&gt;b_next
comma
id|rfd-&gt;rbd
comma
id|rfd-&gt;count
)paren
suffix:semicolon
id|rfd
op_assign
id|rfd-&gt;v_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rfd
op_ne
id|lp-&gt;rfd_head
)paren
suffix:semicolon
id|rbd
op_assign
id|lp-&gt;rbd_head
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;rbd_head = %p&bslash;n&quot;
comma
id|rbd
)paren
suffix:semicolon
r_do
(brace
id|printk
c_func
(paren
l_string|&quot;   %p .count %04x, b_next %08x, b_data %08x, size %04x&bslash;n&quot;
comma
id|rbd
comma
id|rbd-&gt;count
comma
id|rbd-&gt;b_next
comma
id|rbd-&gt;b_data
comma
id|rbd-&gt;size
)paren
suffix:semicolon
id|rbd
op_assign
id|rbd-&gt;v_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rbd
op_ne
id|lp-&gt;rbd_head
)paren
suffix:semicolon
id|CHECK_INV
c_func
(paren
id|lp
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(ENABLE_MVME16x_NET) || defined(ENABLE_BVME6000_NET)
DECL|function|i596_error
r_static
r_void
id|i596_error
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_volatile
r_int
r_char
op_star
id|pcc2
op_assign
(paren
r_int
r_char
op_star
)paren
l_int|0xfff42000
suffix:semicolon
id|pcc2
(braket
l_int|0x28
)braket
op_assign
l_int|1
suffix:semicolon
id|pcc2
(braket
l_int|0x2b
)braket
op_assign
l_int|0x1d
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Error interrupt&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|i596_display_data
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|virt_to_dma
mdefine_line|#define virt_to_dma(lp,v) ((lp)-&gt;dma_addr + (dma_addr_t)((unsigned long)(v)-(unsigned long)(lp)))
DECL|function|init_rx_bufs
r_static
r_inline
r_void
id|init_rx_bufs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_struct
id|i596_rbd
op_star
id|rbd
suffix:semicolon
multiline_comment|/* First build the Receive Buffer Descriptor List */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|rbd
op_assign
id|lp-&gt;rbds
suffix:semicolon
id|i
OL
id|rx_ring_size
suffix:semicolon
id|i
op_increment
comma
id|rbd
op_increment
)paren
(brace
id|dma_addr_t
id|dma_addr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
id|panic
c_func
(paren
l_string|&quot;%s: alloc_skb() failed&quot;
comma
id|__FILE__
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|dma_addr
op_assign
id|dma_map_single
c_func
(paren
id|lp-&gt;dev
comma
id|skb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|rbd-&gt;v_next
op_assign
id|rbd
op_plus
l_int|1
suffix:semicolon
id|rbd-&gt;b_next
op_assign
id|WSWAPrbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|rbd
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|rbd-&gt;b_addr
op_assign
id|WSWAPrbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|rbd
)paren
)paren
suffix:semicolon
id|rbd-&gt;skb
op_assign
id|skb
suffix:semicolon
id|rbd-&gt;v_data
op_assign
id|skb-&gt;tail
suffix:semicolon
id|rbd-&gt;b_data
op_assign
id|WSWAPchar
c_func
(paren
id|dma_addr
)paren
suffix:semicolon
id|rbd-&gt;size
op_assign
id|PKT_BUF_SZ
suffix:semicolon
)brace
id|lp-&gt;rbd_head
op_assign
id|lp-&gt;rbds
suffix:semicolon
id|rbd
op_assign
id|lp-&gt;rbds
op_plus
id|rx_ring_size
op_minus
l_int|1
suffix:semicolon
id|rbd-&gt;v_next
op_assign
id|lp-&gt;rbds
suffix:semicolon
id|rbd-&gt;b_next
op_assign
id|WSWAPrbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rbds
)paren
)paren
suffix:semicolon
multiline_comment|/* Now build the Receive Frame Descriptor List */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|rfd
op_assign
id|lp-&gt;rfds
suffix:semicolon
id|i
OL
id|rx_ring_size
suffix:semicolon
id|i
op_increment
comma
id|rfd
op_increment
)paren
(brace
id|rfd-&gt;rbd
op_assign
id|I596_NULL
suffix:semicolon
id|rfd-&gt;v_next
op_assign
id|rfd
op_plus
l_int|1
suffix:semicolon
id|rfd-&gt;v_prev
op_assign
id|rfd
op_minus
l_int|1
suffix:semicolon
id|rfd-&gt;b_next
op_assign
id|WSWAPrfd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|rfd
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|rfd-&gt;cmd
op_assign
id|CMD_FLEX
suffix:semicolon
)brace
id|lp-&gt;rfd_head
op_assign
id|lp-&gt;rfds
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rfds
)paren
)paren
suffix:semicolon
id|rfd
op_assign
id|lp-&gt;rfds
suffix:semicolon
id|rfd-&gt;rbd
op_assign
id|WSWAPrbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rbd_head
)paren
)paren
suffix:semicolon
id|rfd-&gt;v_prev
op_assign
id|lp-&gt;rfds
op_plus
id|rx_ring_size
op_minus
l_int|1
suffix:semicolon
id|rfd
op_assign
id|lp-&gt;rfds
op_plus
id|rx_ring_size
op_minus
l_int|1
suffix:semicolon
id|rfd-&gt;v_next
op_assign
id|lp-&gt;rfds
suffix:semicolon
id|rfd-&gt;b_next
op_assign
id|WSWAPrfd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rfds
)paren
)paren
suffix:semicolon
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
op_or
id|CMD_FLEX
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|lp
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
)brace
DECL|function|remove_rx_bufs
r_static
r_inline
r_void
id|remove_rx_bufs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_rbd
op_star
id|rbd
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|rbd
op_assign
id|lp-&gt;rbds
suffix:semicolon
id|i
OL
id|rx_ring_size
suffix:semicolon
id|i
op_increment
comma
id|rbd
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rbd-&gt;skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|dma_unmap_single
c_func
(paren
id|lp-&gt;dev
comma
(paren
id|dma_addr_t
)paren
id|WSWAPchar
c_func
(paren
id|rbd-&gt;b_data
)paren
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|rbd-&gt;skb
)paren
suffix:semicolon
)brace
)brace
DECL|function|rebuild_rx_bufs
r_static
r_void
id|rebuild_rx_bufs
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Ensure rx frame/buffer descriptors are tidy */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rx_ring_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;rfds
(braket
id|i
)braket
dot
id|rbd
op_assign
id|I596_NULL
suffix:semicolon
id|lp-&gt;rfds
(braket
id|i
)braket
dot
id|cmd
op_assign
id|CMD_FLEX
suffix:semicolon
)brace
id|lp-&gt;rfds
(braket
id|rx_ring_size
op_minus
l_int|1
)braket
dot
id|cmd
op_assign
id|CMD_EOL
op_or
id|CMD_FLEX
suffix:semicolon
id|lp-&gt;rfd_head
op_assign
id|lp-&gt;rfds
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rfds
)paren
)paren
suffix:semicolon
id|lp-&gt;rbd_head
op_assign
id|lp-&gt;rbds
suffix:semicolon
id|lp-&gt;rfds
(braket
l_int|0
)braket
dot
id|rbd
op_assign
id|WSWAPrbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rbds
)paren
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|lp
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_i596_mem
r_static
r_int
id|init_i596_mem
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* disable IRQs from LAN */
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;RESET 82596 port: %p (with IRQ %d disabled)&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;base_addr
op_plus
id|PA_I82596_RESET
)paren
comma
id|dev-&gt;irq
)paren
)paren
suffix:semicolon
id|gsc_writel
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;base_addr
op_plus
id|PA_I82596_RESET
)paren
)paren
suffix:semicolon
multiline_comment|/* Hard Reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Wait 100us - seems to help */
multiline_comment|/* change the scp address */
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;scp.sysbus
op_assign
l_int|0x0000006c
suffix:semicolon
id|lp-&gt;scp.iscp
op_assign
id|WSWAPiscp
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
(paren
id|lp-&gt;iscp
)paren
)paren
)paren
suffix:semicolon
id|lp-&gt;iscp.scb
op_assign
id|WSWAPscb
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
(paren
id|lp-&gt;scb
)paren
)paren
)paren
suffix:semicolon
id|lp-&gt;iscp.stat
op_assign
id|ISCP_BUSY
suffix:semicolon
id|lp-&gt;cmd_backlog
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|I596_NULL
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: starting i82596.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scp
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scp
)paren
)paren
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;iscp
)paren
comma
r_sizeof
(paren
r_struct
id|i596_iscp
)paren
)paren
suffix:semicolon
id|MPU_PORT
c_func
(paren
id|dev
comma
id|PORT_ALTSCP
comma
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
id|lp-&gt;scp
)paren
)paren
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_istat
c_func
(paren
id|dev
comma
id|lp
comma
l_int|1000
comma
l_string|&quot;initialization timed out&quot;
)paren
)paren
r_goto
id|failed
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: i82596 initialization successful&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
multiline_comment|/* Ensure rx frame/buffer descriptors are tidy */
id|rebuild_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* enable IRQs from LAN */
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: queuing CmdConfigure&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|lp-&gt;cf_cmd.i596_config
comma
id|init_setup
comma
l_int|14
)paren
suffix:semicolon
id|lp-&gt;cf_cmd.cmd.command
op_assign
id|CmdConfigure
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;cf_cmd
)paren
comma
r_sizeof
(paren
r_struct
id|cf_cmd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;cf_cmd.cmd
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: queuing CmdSASetup&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|lp-&gt;sa_cmd.eth_addr
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|lp-&gt;sa_cmd.cmd.command
op_assign
id|CmdSASetup
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;sa_cmd
)paren
comma
r_sizeof
(paren
r_struct
id|sa_cmd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;sa_cmd.cmd
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: queuing CmdTDR&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|lp-&gt;tdr_cmd.cmd.command
op_assign
id|CmdTDR
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;tdr_cmd
)paren
comma
r_sizeof
(paren
r_struct
id|tdr_cmd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;tdr_cmd.cmd
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|1000
comma
l_string|&quot;timed out waiting to issue RX_START&quot;
)paren
)paren
(brace
id|spin_unlock_irqrestore
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: Issuing RX_START&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|RX_START
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|WSWAPrfd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|lp-&gt;rfds
)paren
)paren
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|1000
comma
l_string|&quot;RX_START not processed&quot;
)paren
)paren
r_goto
id|failed
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: Receive unit started OK&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: Failed to initialise 82596&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|MPU_PORT
c_func
(paren
id|dev
comma
id|PORT_RESET
comma
l_int|0
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|i596_rx
r_static
r_inline
r_int
id|i596_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|i596_rfd
op_star
id|rfd
suffix:semicolon
r_struct
id|i596_rbd
op_star
id|rbd
suffix:semicolon
r_int
id|frames
op_assign
l_int|0
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_RXFRAME
comma
id|printk
c_func
(paren
l_string|&quot;i596_rx(), rfd_head %p, rbd_head %p&bslash;n&quot;
comma
id|lp-&gt;rfd_head
comma
id|lp-&gt;rbd_head
)paren
)paren
suffix:semicolon
id|rfd
op_assign
id|lp-&gt;rfd_head
suffix:semicolon
multiline_comment|/* Ref next frame to check */
id|CHECK_INV
c_func
(paren
id|rfd
comma
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
id|STAT_C
)paren
(brace
multiline_comment|/* Loop while complete frames */
r_if
c_cond
(paren
id|rfd-&gt;rbd
op_eq
id|I596_NULL
)paren
id|rbd
op_assign
l_int|NULL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rfd-&gt;rbd
op_eq
id|lp-&gt;rbd_head-&gt;b_addr
)paren
(brace
id|rbd
op_assign
id|lp-&gt;rbd_head
suffix:semicolon
id|CHECK_INV
c_func
(paren
id|rbd
comma
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: rbd chain broken!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* XXX Now what? */
id|rbd
op_assign
l_int|NULL
suffix:semicolon
)brace
id|DEB
c_func
(paren
id|DEB_RXFRAME
comma
id|printk
c_func
(paren
l_string|&quot;  rfd %p, rfd.rbd %08x, rfd.stat %04x&bslash;n&quot;
comma
id|rfd
comma
id|rfd-&gt;rbd
comma
id|rfd-&gt;stat
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rbd
op_ne
l_int|NULL
op_logical_and
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
id|STAT_OK
)paren
)paren
(brace
multiline_comment|/* a good frame */
r_int
id|pkt_len
op_assign
id|rbd-&gt;count
op_amp
l_int|0x3fff
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|rbd-&gt;skb
suffix:semicolon
r_int
id|rx_in_place
op_assign
l_int|0
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_RXADDR
comma
id|print_eth
c_func
(paren
id|rbd-&gt;v_data
comma
l_string|&quot;received&quot;
)paren
)paren
suffix:semicolon
id|frames
op_increment
suffix:semicolon
multiline_comment|/* Check if the packet is long enough to just accept&n;&t;&t;&t; * without copying to a properly sized skbuff.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|pkt_len
OG
id|rx_copybreak
)paren
(brace
r_struct
id|sk_buff
op_star
id|newskb
suffix:semicolon
id|dma_addr_t
id|dma_addr
suffix:semicolon
id|dma_unmap_single
c_func
(paren
id|lp-&gt;dev
comma
(paren
id|dma_addr_t
)paren
id|WSWAPchar
c_func
(paren
id|rbd-&gt;b_data
)paren
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
multiline_comment|/* Get fresh skbuff to replace filled one. */
id|newskb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newskb
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* drop pkt */
r_goto
id|memory_squeeze
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|newskb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Pass up the skb already on the Rx ring. */
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|rx_in_place
op_assign
l_int|1
suffix:semicolon
id|rbd-&gt;skb
op_assign
id|newskb
suffix:semicolon
id|newskb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|dma_addr
op_assign
id|dma_map_single
c_func
(paren
id|lp-&gt;dev
comma
id|newskb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|rbd-&gt;v_data
op_assign
id|newskb-&gt;tail
suffix:semicolon
id|rbd-&gt;b_data
op_assign
id|WSWAPchar
c_func
(paren
id|dma_addr
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|rbd
comma
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
)paren
suffix:semicolon
)brace
r_else
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
suffix:semicolon
id|memory_squeeze
suffix:colon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* XXX tulip.c can defer packets here!! */
id|printk
c_func
(paren
l_string|&quot;%s: i596_rx Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rx_in_place
)paren
(brace
multiline_comment|/* 16 byte align the data fields */
id|dma_sync_single_for_cpu
c_func
(paren
id|lp-&gt;dev
comma
(paren
id|dma_addr_t
)paren
id|WSWAPchar
c_func
(paren
id|rbd-&gt;b_data
)paren
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|rbd-&gt;v_data
comma
id|pkt_len
)paren
suffix:semicolon
id|dma_sync_single_for_device
c_func
(paren
id|lp-&gt;dev
comma
(paren
id|dma_addr_t
)paren
id|WSWAPchar
c_func
(paren
id|rbd-&gt;b_data
)paren
comma
id|PKT_BUF_SZ
comma
id|DMA_FROM_DEVICE
)paren
suffix:semicolon
)brace
id|skb-&gt;len
op_assign
id|pkt_len
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
)brace
r_else
(brace
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;%s: Error, rfd.stat = 0x%04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rfd-&gt;stat
)paren
)paren
suffix:semicolon
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0001
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0080
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0100
)paren
id|lp-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0200
)paren
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0400
)paren
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x0800
)paren
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rfd-&gt;stat
)paren
op_amp
l_int|0x1000
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
multiline_comment|/* Clear the buffer descriptor count and EOF + F flags */
r_if
c_cond
(paren
id|rbd
op_ne
l_int|NULL
op_logical_and
(paren
id|rbd-&gt;count
op_amp
l_int|0x4000
)paren
)paren
(brace
id|rbd-&gt;count
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;rbd_head
op_assign
id|rbd-&gt;v_next
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|rbd
comma
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Tidy the frame descriptor, marking it as end of list */
id|rfd-&gt;rbd
op_assign
id|I596_NULL
suffix:semicolon
id|rfd-&gt;stat
op_assign
l_int|0
suffix:semicolon
id|rfd-&gt;cmd
op_assign
id|CMD_EOL
op_or
id|CMD_FLEX
suffix:semicolon
id|rfd-&gt;count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Remove end-of-list from old end descriptor */
id|rfd-&gt;v_prev-&gt;cmd
op_assign
id|CMD_FLEX
suffix:semicolon
multiline_comment|/* Update record of next frame descriptor to process */
id|lp-&gt;scb.rfd
op_assign
id|rfd-&gt;b_next
suffix:semicolon
id|lp-&gt;rfd_head
op_assign
id|rfd-&gt;v_next
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|rfd-&gt;v_prev
comma
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|rfd
comma
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
)paren
suffix:semicolon
id|rfd
op_assign
id|lp-&gt;rfd_head
suffix:semicolon
id|CHECK_INV
c_func
(paren
id|rfd
comma
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
)paren
suffix:semicolon
)brace
id|DEB
c_func
(paren
id|DEB_RXFRAME
comma
id|printk
c_func
(paren
l_string|&quot;frames %d&bslash;n&quot;
comma
id|frames
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_cleanup_cmd
r_static
r_inline
r_void
id|i596_cleanup_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_private
op_star
id|lp
)paren
(brace
r_struct
id|i596_cmd
op_star
id|ptr
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;cmd_head
op_ne
l_int|NULL
)paren
(brace
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|ptr-&gt;v_next
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|ptr-&gt;command
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tx_cmd-&gt;skb
suffix:semicolon
id|dma_unmap_single
c_func
(paren
id|lp-&gt;dev
comma
id|tx_cmd-&gt;dma_addr
comma
id|skb-&gt;len
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|ptr-&gt;v_next
op_assign
l_int|NULL
suffix:semicolon
id|ptr-&gt;b_next
op_assign
id|I596_NULL
suffix:semicolon
id|tx_cmd-&gt;cmd.command
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Mark as free */
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ptr-&gt;v_next
op_assign
l_int|NULL
suffix:semicolon
id|ptr-&gt;b_next
op_assign
id|I596_NULL
suffix:semicolon
)brace
id|CHECK_WBACK_INV
c_func
(paren
id|ptr
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
)brace
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596_cleanup_cmd timed out&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|I596_NULL
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
)brace
DECL|function|i596_reset
r_static
r_inline
r_void
id|i596_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_private
op_star
id|lp
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_RESET
comma
id|printk
c_func
(paren
l_string|&quot;i596_reset&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596_reset timed out&quot;
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* FIXME: this command might cause an lpmc */
id|lp-&gt;scb.command
op_assign
id|CUC_ABORT
op_or
id|RX_ABORT
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* wait for shutdown */
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|1000
comma
l_string|&quot;i596_reset 2 timed out&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|dev
comma
id|lp
)paren
suffix:semicolon
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|init_i596_mem
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|i596_add_cmd
r_static
r_void
id|i596_add_cmd
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|i596_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_ADDCMD
comma
id|printk
c_func
(paren
l_string|&quot;i596_add_cmd cmd_head %p&bslash;n&quot;
comma
id|lp-&gt;cmd_head
)paren
)paren
suffix:semicolon
id|cmd-&gt;status
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;command
op_or_assign
(paren
id|CMD_EOL
op_or
id|CMD_INTR
)paren
suffix:semicolon
id|cmd-&gt;v_next
op_assign
l_int|NULL
suffix:semicolon
id|cmd-&gt;b_next
op_assign
id|I596_NULL
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
id|cmd
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cmd_head
op_ne
l_int|NULL
)paren
(brace
id|lp-&gt;cmd_tail-&gt;v_next
op_assign
id|cmd
suffix:semicolon
id|lp-&gt;cmd_tail-&gt;b_next
op_assign
id|WSWAPcmd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
id|cmd-&gt;status
)paren
)paren
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
id|lp-&gt;cmd_tail
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;cmd_head
op_assign
id|cmd
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596_add_cmd timed out&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
id|cmd-&gt;status
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_START
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|lp-&gt;cmd_tail
op_assign
id|cmd
suffix:semicolon
id|lp-&gt;cmd_backlog
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;cmd_backlog
OG
id|max_cmd_backlog
)paren
(brace
r_int
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|lp-&gt;last_cmd
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
id|ticks_limit
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: command unit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
macro_line|#if 1
id|i596_reset
c_func
(paren
id|dev
comma
id|lp
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#if 0
multiline_comment|/* this function makes a perfectly adequate probe...  but we have a&n;   device list */
r_static
r_int
id|i596_test
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_volatile
r_int
op_star
id|tint
suffix:semicolon
id|u32
id|data
suffix:semicolon
id|tint
op_assign
(paren
r_volatile
r_int
op_star
)paren
(paren
op_amp
(paren
id|lp-&gt;scp
)paren
)paren
suffix:semicolon
id|data
op_assign
id|virt_to_dma
c_func
(paren
id|lp
comma
id|tint
)paren
suffix:semicolon
id|tint
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
id|tint
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|MPU_PORT
c_func
(paren
id|dev
comma
l_int|1
comma
id|data
)paren
suffix:semicolon
r_for
c_loop
(paren
id|data
op_assign
l_int|1000000
suffix:semicolon
id|data
suffix:semicolon
id|data
op_decrement
)paren
(brace
id|CHECK_INV
c_func
(paren
id|tint
comma
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tint
(braket
l_int|1
)braket
op_ne
op_minus
l_int|1
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;i596_test result %d&bslash;n&quot;
comma
id|tint
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|i596_open
r_static
r_int
id|i596_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|DEB
c_func
(paren
id|DEB_OPEN
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596_open() irq %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|i596_interrupt
comma
l_int|0
comma
l_string|&quot;i82596&quot;
comma
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: IRQ %d not free&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|init_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_i596_mem
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Failed to init memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|out_remove_rx_bufs
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_remove_rx_bufs
suffix:colon
id|remove_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
DECL|function|i596_tx_timeout
r_static
r_void
id|i596_tx_timeout
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Transmitter timeout, serious problems. */
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;%s: transmit timed out, status resetting.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* Try to restart the adaptor */
r_if
c_cond
(paren
id|lp-&gt;last_restart
op_eq
id|lp-&gt;stats.tx_packets
)paren
(brace
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;Resetting board.&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Shutdown and restart */
id|i596_reset
(paren
id|dev
comma
id|lp
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Issue a channel attention signal */
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;Kicking board.&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_START
op_or
id|RX_START
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
op_amp
(paren
id|lp-&gt;scb
)paren
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|CA
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;last_restart
op_assign
id|lp-&gt;stats.tx_packets
suffix:semicolon
)brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|i596_start_xmit
r_static
r_int
id|i596_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tx_cmd
op_star
id|tx_cmd
suffix:semicolon
r_struct
id|i596_tbd
op_star
id|tbd
suffix:semicolon
r_int
id|length
op_assign
id|skb-&gt;len
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_STARTTX
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596_start_xmit(%x,%p) called&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|skb-&gt;len
comma
id|skb-&gt;data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
OL
id|ETH_ZLEN
)paren
(brace
id|skb
op_assign
id|skb_padto
c_func
(paren
id|skb
comma
id|ETH_ZLEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|length
op_assign
id|ETH_ZLEN
suffix:semicolon
)brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tx_cmd
op_assign
id|lp-&gt;tx_cmds
op_plus
id|lp-&gt;next_tx_cmd
suffix:semicolon
id|tbd
op_assign
id|lp-&gt;tbds
op_plus
id|lp-&gt;next_tx_cmd
suffix:semicolon
r_if
c_cond
(paren
id|tx_cmd-&gt;cmd.command
)paren
(brace
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;%s: xmit ring full, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|lp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_increment
id|lp-&gt;next_tx_cmd
op_eq
id|TX_RING_SIZE
)paren
id|lp-&gt;next_tx_cmd
op_assign
l_int|0
suffix:semicolon
id|tx_cmd-&gt;tbd
op_assign
id|WSWAPtbd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
id|tbd
)paren
)paren
suffix:semicolon
id|tbd-&gt;next
op_assign
id|I596_NULL
suffix:semicolon
id|tx_cmd-&gt;cmd.command
op_assign
id|CMD_FLEX
op_or
id|CmdTx
suffix:semicolon
id|tx_cmd-&gt;skb
op_assign
id|skb
suffix:semicolon
id|tx_cmd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tx_cmd-&gt;size
op_assign
l_int|0
suffix:semicolon
id|tbd-&gt;pad
op_assign
l_int|0
suffix:semicolon
id|tbd-&gt;size
op_assign
id|EOF
op_or
id|length
suffix:semicolon
id|tx_cmd-&gt;dma_addr
op_assign
id|dma_map_single
c_func
(paren
id|lp-&gt;dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|tbd-&gt;data
op_assign
id|WSWAPchar
c_func
(paren
id|tx_cmd-&gt;dma_addr
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_TXADDR
comma
id|print_eth
c_func
(paren
id|skb-&gt;data
comma
l_string|&quot;tx-queued&quot;
)paren
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|tx_cmd
comma
r_sizeof
(paren
r_struct
id|tx_cmd
)paren
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|tbd
comma
r_sizeof
(paren
r_struct
id|i596_tbd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|tx_cmd-&gt;cmd
)paren
suffix:semicolon
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|length
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|print_eth
r_static
r_void
id|print_eth
c_func
(paren
r_int
r_char
op_star
id|add
comma
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;i596 0x%p, &quot;
comma
id|add
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02X&quot;
comma
id|add
(braket
id|i
op_plus
l_int|6
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; --&gt;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02X&quot;
comma
id|add
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %02X%02X, %s&bslash;n&quot;
comma
id|add
(braket
l_int|12
)braket
comma
id|add
(braket
l_int|13
)braket
comma
id|str
)paren
suffix:semicolon
)brace
DECL|macro|LAN_PROM_ADDR
mdefine_line|#define LAN_PROM_ADDR&t;0xF0810000
DECL|function|i82596_probe
r_static
r_int
id|__devinit
id|i82596_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|device
op_star
id|gen_dev
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_char
id|eth_addr
(braket
l_int|6
)braket
suffix:semicolon
id|dma_addr_t
id|dma_addr
suffix:semicolon
multiline_comment|/* This lot is ensure things have been cache line aligned. */
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
op_ne
l_int|32
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;82596: sizeof(struct i596_rfd) = %d&bslash;n&quot;
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|i596_rfd
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
op_mod
l_int|32
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;82596: sizeof(struct i596_rbd) = %d&bslash;n&quot;
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|i596_rbd
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_sizeof
(paren
r_struct
id|tx_cmd
)paren
op_mod
l_int|32
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;82596: sizeof(struct tx_cmd) = %d&bslash;n&quot;
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|tx_cmd
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|i596_tbd
)paren
op_ne
l_int|32
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;82596: sizeof(struct i596_tbd) = %d&bslash;n&quot;
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|i596_tbd
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifndef __LP64__
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|i596_private
)paren
OG
l_int|4096
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;82596: sizeof(struct i596_private) = %d&bslash;n&quot;
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_addr
op_logical_or
op_logical_neg
id|dev-&gt;irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pdc_lan_station_id
c_func
(paren
id|eth_addr
comma
id|dev-&gt;base_addr
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eth_addr
(braket
id|i
)braket
op_assign
id|gsc_readb
c_func
(paren
id|LAN_PROM_ADDR
op_plus
id|i
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MAC of HP700 LAN read from EEPROM&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
)brace
id|dev-&gt;mem_start
op_assign
(paren
r_int
r_int
)paren
id|dma_alloc_noncoherent
c_func
(paren
id|gen_dev
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
comma
op_amp
id|dma_addr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;mem_start
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Couldn&squot;t get shared memory&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|eth_addr
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* The 82596-specific entries in the device structure. */
id|dev-&gt;open
op_assign
id|i596_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|i596_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|i596_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|i596_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_multicast_list
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|i596_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;mem_start
)paren
suffix:semicolon
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|memset
c_func
(paren
id|lp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|I596_NULL
suffix:semicolon
id|lp-&gt;scb.rfd
op_assign
id|I596_NULL
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|lp-&gt;dma_addr
op_assign
id|dma_addr
suffix:semicolon
id|lp-&gt;dev
op_assign
id|gen_dev
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|dev-&gt;mem_start
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
)paren
suffix:semicolon
id|i
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|dma_free_noncoherent
c_func
(paren
id|lp-&gt;dev
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
comma
(paren
r_void
op_star
)paren
id|dev-&gt;mem_start
comma
id|lp-&gt;dma_addr
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_PROBE
comma
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: 82596 at %#3lx,&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|DEB
c_func
(paren
id|DEB_PROBE
comma
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_PROBE
comma
id|printk
c_func
(paren
l_string|&quot; IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: lp at 0x%p (%d bytes), lp-&gt;scb at 0x%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp
comma
(paren
r_int
)paren
r_sizeof
(paren
r_struct
id|i596_private
)paren
comma
op_amp
id|lp-&gt;scb
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i596_interrupt
r_static
id|irqreturn_t
id|i596_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_int
r_int
id|status
comma
id|ack_cmd
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: irq %d for unknown device.&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|spin_lock
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596 interrupt, timeout&quot;
)paren
suffix:semicolon
id|status
op_assign
id|lp-&gt;scb.status
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INTS
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt, IRQ %d, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|irq
comma
id|status
)paren
)paren
suffix:semicolon
id|ack_cmd
op_assign
id|status
op_amp
l_int|0xf000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ack_cmd
)paren
(brace
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;%s: interrupt with no events&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x8000
)paren
op_logical_or
(paren
id|status
op_amp
l_int|0x2000
)paren
)paren
(brace
r_struct
id|i596_cmd
op_star
id|ptr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x8000
)paren
)paren
id|DEB
c_func
(paren
id|DEB_INTS
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt completed command.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x2000
)paren
)paren
id|DEB
c_func
(paren
id|DEB_INTS
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt command unit inactive %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x0700
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;cmd_head
op_ne
l_int|NULL
)paren
(brace
id|CHECK_INV
c_func
(paren
id|lp-&gt;cmd_head
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lp-&gt;cmd_head-&gt;status
op_amp
id|STAT_C
)paren
)paren
r_break
suffix:semicolon
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_STATUS
comma
id|printk
c_func
(paren
l_string|&quot;cmd_head-&gt;status = %04x, -&gt;command = %04x&bslash;n&quot;
comma
id|lp-&gt;cmd_head-&gt;status
comma
id|lp-&gt;cmd_head-&gt;command
)paren
)paren
suffix:semicolon
id|lp-&gt;cmd_head
op_assign
id|ptr-&gt;v_next
suffix:semicolon
id|lp-&gt;cmd_backlog
op_decrement
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|ptr-&gt;command
)paren
op_amp
l_int|0x7
)paren
(brace
r_case
id|CmdTx
suffix:colon
(brace
r_struct
id|tx_cmd
op_star
id|tx_cmd
op_assign
(paren
r_struct
id|tx_cmd
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tx_cmd-&gt;skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
id|STAT_OK
)paren
(brace
id|DEB
c_func
(paren
id|DEB_TXADDR
comma
id|print_eth
c_func
(paren
id|skb-&gt;data
comma
l_string|&quot;tx-done&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0020
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0040
)paren
)paren
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0400
)paren
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x0800
)paren
id|lp-&gt;stats.collisions
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status
)paren
op_amp
l_int|0x1000
)paren
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
)brace
id|dma_unmap_single
c_func
(paren
id|lp-&gt;dev
comma
id|tx_cmd-&gt;dma_addr
comma
id|skb-&gt;len
comma
id|DMA_TO_DEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tx_cmd-&gt;cmd.command
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Mark free */
r_break
suffix:semicolon
)brace
r_case
id|CmdTDR
suffix:colon
(brace
r_int
r_int
id|status
op_assign
(paren
(paren
r_struct
id|tdr_cmd
op_star
)paren
id|ptr
)paren
op_member_access_from_pointer
id|status
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x8000
)paren
(brace
id|DEB
c_func
(paren
id|DEB_ANY
comma
id|printk
c_func
(paren
l_string|&quot;%s: link ok.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x4000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Transceiver problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x2000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Termination problem.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1000
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Short circuit.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_TDR
comma
id|printk
c_func
(paren
l_string|&quot;%s: Time %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
op_amp
l_int|0x07ff
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|CmdConfigure
suffix:colon
multiline_comment|/* Zap command so set_multicast_list() knows it is free */
id|ptr-&gt;command
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ptr-&gt;v_next
op_assign
l_int|NULL
suffix:semicolon
id|ptr-&gt;b_next
op_assign
id|I596_NULL
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
id|ptr
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
id|lp-&gt;last_cmd
op_assign
id|jiffies
suffix:semicolon
)brace
multiline_comment|/* This mess is arranging that only the last of any outstanding&n;&t;&t; * commands has the interrupt bit set.  Should probably really&n;&t;&t; * only add to the cmd queue when the CU is stopped.&n;&t;&t; */
id|ptr
op_assign
id|lp-&gt;cmd_head
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ptr
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|ptr
op_ne
id|lp-&gt;cmd_tail
)paren
)paren
(brace
r_struct
id|i596_cmd
op_star
id|prev
op_assign
id|ptr
suffix:semicolon
id|ptr-&gt;command
op_and_assign
l_int|0x1fff
suffix:semicolon
id|ptr
op_assign
id|ptr-&gt;v_next
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
id|prev
comma
r_sizeof
(paren
r_struct
id|i596_cmd
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lp-&gt;cmd_head
op_ne
l_int|NULL
)paren
)paren
id|ack_cmd
op_or_assign
id|CUC_START
suffix:semicolon
id|lp-&gt;scb.cmd
op_assign
id|WSWAPcmd
c_func
(paren
id|virt_to_dma
c_func
(paren
id|lp
comma
op_amp
id|lp-&gt;cmd_head-&gt;status
)paren
)paren
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
op_amp
id|lp-&gt;scb
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x1000
)paren
op_logical_or
(paren
id|status
op_amp
l_int|0x4000
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x4000
)paren
)paren
id|DEB
c_func
(paren
id|DEB_INTS
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt received a frame.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|i596_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Only RX_START if stopped - RGH 07-07-96 */
r_if
c_cond
(paren
id|status
op_amp
l_int|0x1000
)paren
(brace
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|DEB
c_func
(paren
id|DEB_ERRORS
comma
id|printk
c_func
(paren
l_string|&quot;%s: i596 interrupt receive unit inactive, status 0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
)paren
suffix:semicolon
id|ack_cmd
op_or_assign
id|RX_START
suffix:semicolon
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
id|rebuild_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596 interrupt, timeout&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|ack_cmd
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
id|lp-&gt;scb
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
multiline_comment|/* DANGER: I suspect that some kind of interrupt&n;&t; acknowledgement aside from acking the 82596 might be needed &n;&t; here...  but it&squot;s running acceptably without */
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;i596 interrupt, exit timeout&quot;
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INTS
comma
id|printk
c_func
(paren
l_string|&quot;%s: exiting interrupt.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|i596_close
r_static
r_int
id|i596_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_INIT
comma
id|printk
c_func
(paren
l_string|&quot;%s: Shutting down ethercard, status was %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;scb.status
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;close1 timed out&quot;
)paren
suffix:semicolon
id|lp-&gt;scb.command
op_assign
id|CUC_ABORT
op_or
id|RX_ABORT
suffix:semicolon
id|CHECK_WBACK
c_func
(paren
op_amp
id|lp-&gt;scb
comma
r_sizeof
(paren
r_struct
id|i596_scb
)paren
)paren
suffix:semicolon
id|CA
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wait_cmd
c_func
(paren
id|dev
comma
id|lp
comma
l_int|100
comma
l_string|&quot;close2 timed out&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_STRUCT
comma
id|i596_display_data
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|i596_cleanup_cmd
c_func
(paren
id|dev
comma
id|lp
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|remove_rx_bufs
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|net_device_stats
op_star
DECL|function|i596_get_stats
id|i596_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; *    Set or clear the multicast filter for this adaptor.&n; */
DECL|function|set_multicast_list
r_static
r_void
id|set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|config
op_assign
l_int|0
comma
id|cnt
suffix:semicolon
id|DEB
c_func
(paren
id|DEB_MULTI
comma
id|printk
c_func
(paren
l_string|&quot;%s: set multicast list, %d entries, promisc %s, allmulti %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mc_count
comma
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF&quot;
comma
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
ques
c_cond
l_string|&quot;ON&quot;
suffix:colon
l_string|&quot;OFF&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
op_logical_and
op_logical_neg
(paren
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|8
)braket
op_amp
l_int|0x01
)paren
)paren
(brace
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|8
)braket
op_or_assign
l_int|0x01
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
op_logical_and
(paren
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|8
)braket
op_amp
l_int|0x01
)paren
)paren
(brace
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|8
)braket
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_and
(paren
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|11
)braket
op_amp
l_int|0x20
)paren
)paren
(brace
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|11
)braket
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_and
op_logical_neg
(paren
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|11
)braket
op_amp
l_int|0x20
)paren
)paren
(brace
id|lp-&gt;cf_cmd.i596_config
(braket
l_int|11
)braket
op_or_assign
l_int|0x20
suffix:semicolon
id|config
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|config
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;cf_cmd.cmd.command
)paren
id|printk
c_func
(paren
l_string|&quot;%s: config change request already queued&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_else
(brace
id|lp-&gt;cf_cmd.cmd.command
op_assign
id|CmdConfigure
suffix:semicolon
id|CHECK_WBACK_INV
c_func
(paren
op_amp
id|lp-&gt;cf_cmd
comma
r_sizeof
(paren
r_struct
id|cf_cmd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|lp-&gt;cf_cmd.cmd
)paren
suffix:semicolon
)brace
)brace
id|cnt
op_assign
id|dev-&gt;mc_count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|MAX_MC_CNT
)paren
(brace
id|cnt
op_assign
id|MAX_MC_CNT
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Only %d multicast addresses supported&quot;
comma
id|dev-&gt;name
comma
id|cnt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|0
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|dmi
suffix:semicolon
r_int
r_char
op_star
id|cp
suffix:semicolon
r_struct
id|mc_cmd
op_star
id|cmd
suffix:semicolon
id|cmd
op_assign
op_amp
id|lp-&gt;mc_cmd
suffix:semicolon
id|cmd-&gt;cmd.command
op_assign
id|CmdMulticastList
suffix:semicolon
id|cmd-&gt;mc_cnt
op_assign
id|dev-&gt;mc_count
op_star
l_int|6
suffix:semicolon
id|cp
op_assign
id|cmd-&gt;mc_addrs
suffix:semicolon
r_for
c_loop
(paren
id|dmi
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|cnt
op_logical_and
id|dmi
op_ne
l_int|NULL
suffix:semicolon
id|dmi
op_assign
id|dmi-&gt;next
comma
id|cnt
op_decrement
comma
id|cp
op_add_assign
l_int|6
)paren
(brace
id|memcpy
c_func
(paren
id|cp
comma
id|dmi-&gt;dmi_addr
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i596_debug
OG
l_int|1
)paren
id|DEB
c_func
(paren
id|DEB_MULTI
comma
id|printk
c_func
(paren
l_string|&quot;%s: Adding address %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cp
(braket
l_int|0
)braket
comma
id|cp
(braket
l_int|1
)braket
comma
id|cp
(braket
l_int|2
)braket
comma
id|cp
(braket
l_int|3
)braket
comma
id|cp
(braket
l_int|4
)braket
comma
id|cp
(braket
l_int|5
)braket
)paren
)paren
suffix:semicolon
)brace
id|CHECK_WBACK_INV
c_func
(paren
op_amp
id|lp-&gt;mc_cmd
comma
r_sizeof
(paren
r_struct
id|mc_cmd
)paren
)paren
suffix:semicolon
id|i596_add_cmd
c_func
(paren
id|dev
comma
op_amp
id|cmd-&gt;cmd
)paren
suffix:semicolon
)brace
)brace
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;lasi_82596 debug mask&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|num_drivers
r_static
r_int
id|num_drivers
suffix:semicolon
DECL|variable|netdevs
r_static
r_struct
id|net_device
op_star
id|netdevs
(braket
id|MAX_DRIVERS
)braket
suffix:semicolon
r_static
r_int
id|__devinit
DECL|function|lan_init_chip
id|lan_init_chip
c_func
(paren
r_struct
id|parisc_device
op_star
id|dev
)paren
(brace
r_struct
id|net_device
op_star
id|netdevice
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|num_drivers
op_ge
id|MAX_DRIVERS
)paren
(brace
multiline_comment|/* max count of possible i82596 drivers reached */
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|num_drivers
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
id|LASI_82596_DRIVER_VERSION
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;irq
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: IRQ not found for i82596 at 0x%lx&bslash;n&quot;
comma
id|__FILE__
comma
id|dev-&gt;hpa
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Found i82596 at 0x%lx, IRQ %d&bslash;n&quot;
comma
id|dev-&gt;hpa
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|netdevice
op_assign
id|alloc_etherdev
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netdevice
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|netdevice-&gt;base_addr
op_assign
id|dev-&gt;hpa
suffix:semicolon
id|netdevice-&gt;irq
op_assign
id|dev-&gt;irq
suffix:semicolon
id|retval
op_assign
id|i82596_probe
c_func
(paren
id|netdevice
comma
op_amp
id|dev-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|free_netdev
c_func
(paren
id|netdevice
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;id.sversion
op_eq
l_int|0x72
)paren
(brace
(paren
(paren
r_struct
id|i596_private
op_star
)paren
id|netdevice-&gt;priv
)paren
op_member_access_from_pointer
id|options
op_assign
id|OPT_SWAP_PORT
suffix:semicolon
)brace
id|netdevs
(braket
id|num_drivers
op_increment
)braket
op_assign
id|netdevice
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|variable|lan_tbl
r_static
r_struct
id|parisc_device_id
id|lan_tbl
(braket
)braket
op_assign
(brace
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0008a
)brace
comma
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x00072
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|parisc
comma
id|lan_tbl
)paren
suffix:semicolon
DECL|variable|lan_driver
r_static
r_struct
id|parisc_driver
id|lan_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Apricot&quot;
comma
dot
id|id_table
op_assign
id|lan_tbl
comma
dot
id|probe
op_assign
id|lan_init_chip
comma
)brace
suffix:semicolon
DECL|function|lasi_82596_init
r_static
r_int
id|__devinit
id|lasi_82596_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|debug
op_ge
l_int|0
)paren
id|i596_debug
op_assign
id|debug
suffix:semicolon
r_return
id|register_parisc_driver
c_func
(paren
op_amp
id|lan_driver
)paren
suffix:semicolon
)brace
DECL|variable|lasi_82596_init
id|module_init
c_func
(paren
id|lasi_82596_init
)paren
suffix:semicolon
DECL|function|lasi_82596_exit
r_static
r_void
id|__exit
id|lasi_82596_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_DRIVERS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|i596_private
op_star
id|lp
suffix:semicolon
r_struct
id|net_device
op_star
id|netdevice
suffix:semicolon
id|netdevice
op_assign
id|netdevs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netdevice
)paren
r_continue
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|netdevice
)paren
suffix:semicolon
id|lp
op_assign
id|netdevice-&gt;priv
suffix:semicolon
id|dma_free_noncoherent
c_func
(paren
id|lp-&gt;dev
comma
r_sizeof
(paren
r_struct
id|i596_private
)paren
comma
(paren
r_void
op_star
)paren
id|netdevice-&gt;mem_start
comma
id|lp-&gt;dma_addr
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|netdevice
)paren
suffix:semicolon
)brace
id|num_drivers
op_assign
l_int|0
suffix:semicolon
id|unregister_parisc_driver
c_func
(paren
op_amp
id|lan_driver
)paren
suffix:semicolon
)brace
DECL|variable|lasi_82596_exit
id|module_exit
c_func
(paren
id|lasi_82596_exit
)paren
suffix:semicolon
eof
