multiline_comment|/* tulip_core.c: A DEC 21x4x-family ethernet driver for Linux. */
multiline_comment|/*&n;&t;Maintained by Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt;&n;&t;Copyright 2000,2001  The Linux Kernel Team&n;&t;Written/copyright 1994-2001 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms&n;&t;of the GNU General Public License, incorporated herein by reference.&n;&n;&t;Please refer to Documentation/DocBook/tulip.{pdf,ps,html}&n;&t;for more information on this driver, or visit the project&n;&t;Web page at http://sourceforge.net/projects/tulip/&n;&n;*/
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;tulip&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.1.11&quot;
DECL|macro|DRV_RELDATE
mdefine_line|#define DRV_RELDATE&t;&quot;Feb 08, 2002&quot;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;tulip.h&quot;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef __sparc__
macro_line|#include &lt;asm/pbm.h&gt;
macro_line|#endif
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
l_string|&quot;Linux Tulip driver version &quot;
id|DRV_VERSION
l_string|&quot; (&quot;
id|DRV_RELDATE
l_string|&quot;)&bslash;n&quot;
suffix:semicolon
multiline_comment|/* A few user-configurable values. */
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
r_int
id|max_interrupt_work
op_assign
l_int|25
suffix:semicolon
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
multiline_comment|/* Used to pass the full-duplex flag, etc. */
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
suffix:semicolon
DECL|variable|mtu
r_static
r_int
id|mtu
(braket
id|MAX_UNITS
)braket
suffix:semicolon
multiline_comment|/* Jumbo MTU for interfaces. */
multiline_comment|/*  The possible media types that can be set in options[] are: */
DECL|variable|medianame
r_const
r_char
op_star
r_const
id|medianame
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;10baseT&quot;
comma
l_string|&quot;10base2&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;100baseTx&quot;
comma
l_string|&quot;10baseT-FDX&quot;
comma
l_string|&quot;100baseTx-FDX&quot;
comma
l_string|&quot;100baseT4&quot;
comma
l_string|&quot;100baseFx&quot;
comma
l_string|&quot;100baseFx-FDX&quot;
comma
l_string|&quot;MII 10baseT&quot;
comma
l_string|&quot;MII 10baseT-FDX&quot;
comma
l_string|&quot;MII&quot;
comma
l_string|&quot;10baseT(forced)&quot;
comma
l_string|&quot;MII 100baseTx&quot;
comma
l_string|&quot;MII 100baseTx-FDX&quot;
comma
l_string|&quot;MII 100baseT4&quot;
comma
l_string|&quot;MII 100baseFx-HDX&quot;
comma
l_string|&quot;MII 100baseFx-FDX&quot;
comma
l_string|&quot;Home-PNA 1Mbps&quot;
comma
l_string|&quot;Invalid-19&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;&quot;
comma
l_string|&quot;Transceiver reset&quot;
comma
)brace
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-buffer Rx structure. */
macro_line|#if defined(__alpha__) || defined(__arm__) || defined(__hppa__) &bslash;&n;&t;|| defined(__sparc_) || defined(__ia64__) &bslash;&n;&t;|| defined(__sh__) || defined(__mips__)
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|1518
suffix:semicolon
macro_line|#else
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|100
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;  Set the bus performance register.&n;&t;Typical: Set 16 longword cache alignment, no burst limit.&n;&t;Cache alignment bits 15:14&t;     Burst length 13:8&n;&t;&t;0000&t;No alignment  0x00000000 unlimited&t;&t;0800 8 longwords&n;&t;&t;4000&t;8  longwords&t;&t;0100 1 longword&t;&t;1000 16 longwords&n;&t;&t;8000&t;16 longwords&t;&t;0200 2 longwords&t;2000 32 longwords&n;&t;&t;C000&t;32  longwords&t;&t;0400 4 longwords&n;&t;Warning: many older 486 systems are broken and require setting 0x00A04800&n;&t;   8 longword cache alignment, 8 longword burst.&n;&t;ToDo: Non-Intel setting could be better.&n;*/
macro_line|#if defined(__alpha__) || defined(__ia64__) || defined(__x86_64__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0xE000
suffix:semicolon
macro_line|#elif defined(__i386__) || defined(__powerpc__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x8000
suffix:semicolon
macro_line|#elif defined(__sparc__) || defined(__hppa__)
multiline_comment|/* The UltraSparc PCI controllers will disconnect at every 64-byte&n; * crossing anyways so it makes no sense to tell Tulip to burst&n; * any more than that.&n; */
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x9000
suffix:semicolon
macro_line|#elif defined(__arm__) || defined(__sh__)
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x01A00000
op_or
l_int|0x4800
suffix:semicolon
macro_line|#else
macro_line|#warning Processor architecture undefined!
DECL|variable|csr0
r_static
r_int
id|csr0
op_assign
l_int|0x00A00000
op_or
l_int|0x4800
suffix:semicolon
macro_line|#endif
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (4*HZ)
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;The Linux Kernel Team&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Digital 21*4* Tulip ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|tulip_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|csr0
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|PFX
mdefine_line|#define PFX DRV_NAME &quot;: &quot;
macro_line|#ifdef TULIP_DEBUG
DECL|variable|tulip_debug
r_int
id|tulip_debug
op_assign
id|TULIP_DEBUG
suffix:semicolon
macro_line|#else
DECL|variable|tulip_debug
r_int
id|tulip_debug
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * This table use during operation for capabilities and media timer.&n; *&n; * It is indexed via the values in &squot;enum chips&squot;&n; */
DECL|variable|tulip_tbl
r_struct
id|tulip_chip_table
id|tulip_tbl
(braket
)braket
op_assign
(brace
(brace
)brace
comma
multiline_comment|/* placeholder for array, slot unused currently */
(brace
)brace
comma
multiline_comment|/* placeholder for array, slot unused currently */
multiline_comment|/* DC21140 */
(brace
l_string|&quot;Digital DS21140 Tulip&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
op_or
id|HAS_PCI_MWI
comma
id|tulip_timer
)brace
comma
multiline_comment|/* DC21142, DC21143 */
(brace
l_string|&quot;Digital DS21143 Tulip&quot;
comma
l_int|128
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|ALWAYS_CHECK_MII
op_or
id|HAS_ACPI
op_or
id|HAS_NWAY
op_or
id|HAS_INTR_MITIGATION
op_or
id|HAS_PCI_MWI
comma
id|t21142_timer
)brace
comma
multiline_comment|/* LC82C168 */
(brace
l_string|&quot;Lite-On 82c168 PNIC&quot;
comma
l_int|256
comma
l_int|0x0001fbef
comma
id|HAS_MII
op_or
id|HAS_PNICNWAY
comma
id|pnic_timer
)brace
comma
multiline_comment|/* MX98713 */
(brace
l_string|&quot;Macronix 98713 PMAC&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
comma
id|mxic_timer
)brace
comma
multiline_comment|/* MX98715 */
(brace
l_string|&quot;Macronix 98715 PMAC&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MEDIA_TABLE
comma
id|mxic_timer
)brace
comma
multiline_comment|/* MX98725 */
(brace
l_string|&quot;Macronix 98725 PMAC&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MEDIA_TABLE
comma
id|mxic_timer
)brace
comma
multiline_comment|/* AX88140 */
(brace
l_string|&quot;ASIX AX88140&quot;
comma
l_int|128
comma
l_int|0x0001fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
op_or
id|MC_HASH_ONLY
op_or
id|IS_ASIX
comma
id|tulip_timer
)brace
comma
multiline_comment|/* PNIC2 */
(brace
l_string|&quot;Lite-On PNIC-II&quot;
comma
l_int|256
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_NWAY
op_or
id|HAS_8023X
op_or
id|HAS_PCI_MWI
comma
id|pnic2_timer
)brace
comma
multiline_comment|/* COMET */
(brace
l_string|&quot;ADMtek Comet&quot;
comma
l_int|256
comma
l_int|0x0001abef
comma
id|MC_HASH_ONLY
op_or
id|COMET_MAC_ADDR
comma
id|comet_timer
)brace
comma
multiline_comment|/* COMPEX9881 */
(brace
l_string|&quot;Compex 9881 PMAC&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
comma
id|mxic_timer
)brace
comma
multiline_comment|/* I21145 */
(brace
l_string|&quot;Intel DS21145 Tulip&quot;
comma
l_int|128
comma
l_int|0x0801fbff
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|ALWAYS_CHECK_MII
op_or
id|HAS_ACPI
op_or
id|HAS_NWAY
op_or
id|HAS_PCI_MWI
comma
id|t21142_timer
)brace
comma
multiline_comment|/* DM910X */
(brace
l_string|&quot;Davicom DM9102/DM9102A&quot;
comma
l_int|128
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_MEDIA_TABLE
op_or
id|CSR12_IN_SROM
op_or
id|HAS_ACPI
comma
id|tulip_timer
)brace
comma
multiline_comment|/* RS7112 */
(brace
l_string|&quot;Conexant LANfinity&quot;
comma
l_int|256
comma
l_int|0x0001ebef
comma
id|HAS_MII
op_or
id|HAS_ACPI
comma
id|tulip_timer
)brace
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|tulip_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1011
comma
l_int|0x0009
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21140
)brace
comma
(brace
l_int|0x1011
comma
l_int|0x0019
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DC21143
)brace
comma
(brace
l_int|0x11AD
comma
l_int|0x0002
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|LC82C168
)brace
comma
(brace
l_int|0x10d9
comma
l_int|0x0512
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98713
)brace
comma
(brace
l_int|0x10d9
comma
l_int|0x0531
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98715
)brace
comma
multiline_comment|/*&t;{ 0x10d9, 0x0531, PCI_ANY_ID, PCI_ANY_ID, 0, 0, MX98725 },*/
(brace
l_int|0x125B
comma
l_int|0x1400
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|AX88140
)brace
comma
(brace
l_int|0x11AD
comma
l_int|0xc115
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|PNIC2
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x0981
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x0985
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x1317
comma
l_int|0x1985
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x13D1
comma
l_int|0xAB02
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x13D1
comma
l_int|0xAB03
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x13D1
comma
l_int|0xAB08
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x104A
comma
l_int|0x0981
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x104A
comma
l_int|0x2774
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x11F6
comma
l_int|0x9881
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMPEX9881
)brace
comma
(brace
l_int|0x8086
comma
l_int|0x0039
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|I21145
)brace
comma
(brace
l_int|0x1282
comma
l_int|0x9100
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DM910X
)brace
comma
(brace
l_int|0x1282
comma
l_int|0x9102
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DM910X
)brace
comma
(brace
l_int|0x1113
comma
l_int|0x1216
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x1113
comma
l_int|0x1217
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|MX98715
)brace
comma
(brace
l_int|0x1113
comma
l_int|0x9511
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|COMET
)brace
comma
(brace
l_int|0x14f1
comma
l_int|0x1803
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|CONEXANT
)brace
comma
(brace
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|tulip_pci_tbl
)paren
suffix:semicolon
multiline_comment|/* A full-duplex map for media types. */
DECL|variable|tulip_media_cap
r_const
r_char
id|tulip_media_cap
(braket
l_int|32
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|16
comma
l_int|3
comma
l_int|19
comma
l_int|16
comma
l_int|24
comma
l_int|27
comma
l_int|4
comma
l_int|7
comma
l_int|5
comma
l_int|0
comma
l_int|20
comma
l_int|23
comma
l_int|20
comma
l_int|28
comma
l_int|31
comma
l_int|0
comma
l_int|0
comma
)brace
suffix:semicolon
r_static
r_void
id|tulip_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tulip_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tulip_down
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|private_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|tulip_set_power_state
r_static
r_void
id|tulip_set_power_state
(paren
r_struct
id|tulip_private
op_star
id|tp
comma
r_int
id|sleep
comma
r_int
id|snooze
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_ACPI
)paren
(brace
id|u32
id|tmp
comma
id|newtmp
suffix:semicolon
id|pci_read_config_dword
(paren
id|tp-&gt;pdev
comma
id|CFDD
comma
op_amp
id|tmp
)paren
suffix:semicolon
id|newtmp
op_assign
id|tmp
op_amp
op_complement
(paren
id|CFDD_Sleep
op_or
id|CFDD_Snooze
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sleep
)paren
id|newtmp
op_or_assign
id|CFDD_Sleep
suffix:semicolon
r_else
r_if
c_cond
(paren
id|snooze
)paren
id|newtmp
op_or_assign
id|CFDD_Snooze
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|newtmp
)paren
id|pci_write_config_dword
(paren
id|tp-&gt;pdev
comma
id|CFDD
comma
id|newtmp
)paren
suffix:semicolon
)brace
)brace
DECL|function|tulip_up
r_static
r_void
id|tulip_up
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|3
op_star
id|HZ
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Wake the chip from sleep/snooze mode. */
id|tulip_set_power_state
(paren
id|tp
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* On some chip revs we must set the MII/SYM port before the reset!? */
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
op_logical_or
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
)paren
id|outl
c_func
(paren
l_int|0x00040000
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Reset the chip, holding bit 0 set at least 50 PCI cycles. */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Deassert reset.&n;&t;   Wait the specified 50 PCI cycles after a reset by initializing&n;&t;   Tx and Rx queues and the address filter list. */
id|outl
c_func
(paren
id|tp-&gt;csr0
comma
id|ioaddr
op_plus
id|CSR0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tulip_up(), irq==%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tp-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|CSR3
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tp-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|CSR4
)paren
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;dirty_rx
op_assign
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|MC_HASH_ONLY
)paren
(brace
id|u32
id|addr_low
op_assign
id|cpu_to_le32
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|u32
op_star
)paren
id|dev-&gt;dev_addr
)paren
)paren
suffix:semicolon
id|u32
id|addr_high
op_assign
id|cpu_to_le32
c_func
(paren
id|get_unaligned
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|AX88140
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_low
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|1
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_high
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|COMET_MAC_ADDR
)paren
(brace
id|outl
c_func
(paren
id|addr_low
comma
id|ioaddr
op_plus
l_int|0xA4
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr_high
comma
id|ioaddr
op_plus
l_int|0xA8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
l_int|0xAC
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
l_int|0xB0
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* This is set_rx_mode(), but without starting the transmitter. */
id|u16
op_star
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
id|u16
op_star
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|15
op_star
l_int|6
)braket
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
multiline_comment|/* 21140 bug: you must add the broadcast address. */
id|memset
c_func
(paren
id|tp-&gt;setup_frame
comma
l_int|0xff
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
)paren
suffix:semicolon
multiline_comment|/* Fill the final entry of the table with our physical address. */
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;setup_frame
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|tp-&gt;cur_tx
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|tp-&gt;cur_tx
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
id|tp-&gt;tx_ring
(braket
id|tp-&gt;cur_tx
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x08000000
op_or
l_int|192
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|tp-&gt;cur_tx
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|tp-&gt;cur_tx
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
)brace
id|tp-&gt;saved_if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|tp-&gt;default_port
suffix:semicolon
multiline_comment|/* Allow selecting a default media. */
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mtable
op_eq
l_int|NULL
)paren
r_goto
id|media_picked
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_int
id|looking_for
op_assign
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
ques
c_cond
l_int|11
suffix:colon
(paren
id|dev-&gt;if_port
op_eq
l_int|12
ques
c_cond
l_int|0
suffix:colon
id|dev-&gt;if_port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
id|looking_for
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using user-specified media %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|dev-&gt;if_port
)braket
)paren
suffix:semicolon
r_goto
id|media_picked
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;mtable-&gt;defaultmedia
op_amp
l_int|0x0800
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|looking_for
op_assign
id|tp-&gt;mtable-&gt;defaultmedia
op_amp
id|MEDIA_MASK
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
id|looking_for
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using EEPROM-set media %s.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|looking_for
)braket
)paren
suffix:semicolon
r_goto
id|media_picked
suffix:semicolon
)brace
)brace
multiline_comment|/* Start sensing first non-full-duplex media. */
r_for
c_loop
(paren
id|i
op_assign
id|tp-&gt;mtable-&gt;leafcount
op_minus
l_int|1
suffix:semicolon
(paren
id|tulip_media_cap
(braket
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
)braket
op_amp
id|MediaAlwaysFD
)paren
op_logical_and
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
id|media_picked
suffix:colon
id|tp-&gt;csr6
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_index
op_assign
id|i
suffix:semicolon
id|tp-&gt;nwayset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21143
op_logical_and
(paren
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
)paren
(brace
multiline_comment|/* We must reset the media CSRs when we force-select MII mode. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0008
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
)brace
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21142
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
(brace
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using MII transceiver %d, status &quot;
l_string|&quot;%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
id|tulip_mdio_read
c_func
(paren
id|dev
comma
id|tp-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|csr6_mask_defstate
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|tp-&gt;csr6
op_assign
id|csr6_mask_hdcap
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|11
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
id|t21142_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|PNIC2
)paren
(brace
multiline_comment|/* for initial startup advertise 10/100 Full and Half */
id|tp-&gt;sym_advertise
op_assign
l_int|0x01E0
suffix:semicolon
multiline_comment|/* enable autonegotiate end interrupt */
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
op_or
l_int|0x00008010
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR7
)paren
op_or
l_int|0x00008010
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
id|pnic2_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|LC82C168
op_logical_and
op_logical_neg
id|tp-&gt;medialock
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|11
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x814C0000
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0x0200
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0001
comma
id|ioaddr
op_plus
id|CSR15
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
op_amp
id|TPLnkPass
)paren
id|pnic_do_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Start with 10mbps to do autonegotiation. */
id|outl
c_func
(paren
l_int|0x32
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x00420000
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0001B078
comma
id|ioaddr
op_plus
l_int|0xB8
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0201B078
comma
id|ioaddr
op_plus
l_int|0xB8
)paren
suffix:semicolon
id|next_tick
op_assign
l_int|1
op_star
id|HZ
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|tp-&gt;chip_id
op_eq
id|MX98713
op_logical_or
id|tp-&gt;chip_id
op_eq
id|COMPEX9881
)paren
op_logical_and
op_logical_neg
id|tp-&gt;medialock
)paren
(brace
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x01880000
op_or
(paren
id|tp-&gt;full_duplex
ques
c_cond
l_int|0x0200
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0f370000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0x80
)paren
comma
id|ioaddr
op_plus
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|MX98715
op_logical_or
id|tp-&gt;chip_id
op_eq
id|MX98725
)paren
(brace
multiline_comment|/* Provided by BOLO, Macronix - 12/10/1998. */
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x01a80200
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0f370000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0x80
)paren
comma
id|ioaddr
op_plus
l_int|0x80
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x11000
op_or
id|inw
c_func
(paren
id|ioaddr
op_plus
l_int|0xa0
)paren
comma
id|ioaddr
op_plus
l_int|0xa0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
op_logical_or
id|tp-&gt;chip_id
op_eq
id|CONEXANT
)paren
(brace
multiline_comment|/* Enable automatic Tx underrun recovery. */
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
l_int|0x88
)paren
op_or
l_int|1
comma
id|ioaddr
op_plus
l_int|0x88
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;mii_cnt
ques
c_cond
l_int|11
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;csr6
op_assign
l_int|0x00040000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|AX88140
)paren
(brace
id|tp-&gt;csr6
op_assign
id|tp-&gt;mii_cnt
ques
c_cond
l_int|0x00040100
suffix:colon
l_int|0x00000100
suffix:semicolon
)brace
r_else
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Start the chip&squot;s Tx to process setup frame. */
id|tulip_stop_rxtx
c_func
(paren
id|tp
)paren
suffix:semicolon
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tp-&gt;csr6
op_or
id|TxOn
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Enable interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR5
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
id|tulip_start_rxtx
c_func
(paren
id|tp
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR2
)paren
suffix:semicolon
multiline_comment|/* Rx poll demand */
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done tulip_up(), CSR0 %8.8x, CSR5 %8.8x CSR6 %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR0
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the timer to switch to check for link beat and perhaps switch&n;&t;   to an alternate media type. */
id|tp-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|next_tick
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NET_HW_FLOWCONTROL
multiline_comment|/* Enable receiver */
DECL|function|tulip_xon
r_void
id|tulip_xon
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|clear_bit
c_func
(paren
id|tp-&gt;fc_bit
comma
op_amp
id|netdev_fc_xoff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|tulip_refill_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|valid_intrs
comma
id|dev-&gt;base_addr
op_plus
id|CSR7
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_static
r_int
DECL|function|tulip_open
id|tulip_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
macro_line|#ifdef CONFIG_NET_HW_FLOWCONTROL
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#endif
r_int
id|retval
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|tulip_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|tulip_init_ring
(paren
id|dev
)paren
suffix:semicolon
id|tulip_up
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_HW_FLOWCONTROL
id|tp-&gt;fc_bit
op_assign
id|netdev_register_fc
c_func
(paren
id|dev
comma
id|tulip_xon
)paren
suffix:semicolon
macro_line|#endif
id|netif_start_queue
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_tx_timeout
r_static
r_void
id|tulip_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
multiline_comment|/* Do nothing -- the media monitor should handle this. */
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timeout using MII device.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|DC21140
op_logical_or
id|tp-&gt;chip_id
op_eq
id|DC21142
op_logical_or
id|tp-&gt;chip_id
op_eq
id|MX98713
op_logical_or
id|tp-&gt;chip_id
op_eq
id|COMPEX9881
op_logical_or
id|tp-&gt;chip_id
op_eq
id|DM910X
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: 21140 transmit timed out, status %8.8x, &quot;
l_string|&quot;SIA %8.8x %8.8x %8.8x %8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR13
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR14
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR15
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;medialock
op_logical_and
id|tp-&gt;mtable
)paren
(brace
r_do
op_decrement
id|tp-&gt;cur_index
suffix:semicolon
r_while
c_loop
(paren
id|tp-&gt;cur_index
op_ge
l_int|0
op_logical_and
(paren
id|tulip_media_cap
(braket
id|tp-&gt;mtable-&gt;mleaf
(braket
id|tp-&gt;cur_index
)braket
dot
id|media
)braket
op_amp
id|MediaIsFD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|tp-&gt;cur_index
OL
l_int|0
)paren
(brace
multiline_comment|/* We start again, but should instead look for default. */
id|tp-&gt;cur_index
op_assign
id|tp-&gt;mtable-&gt;leafcount
op_minus
l_int|1
suffix:semicolon
)brace
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: transmit timed out, switching to %s &quot;
l_string|&quot;media.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|medianame
(braket
id|dev-&gt;if_port
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|PNIC2
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: PNIC2 transmit timed out, status %8.8x, &quot;
l_string|&quot;CSR6/7 %8.8x / %8.8x CSR12 %8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR7
)paren
comma
(paren
r_int
)paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timed out, status %8.8x, CSR12 &quot;
l_string|&quot;%8.8x, resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR5
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR12
)paren
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#if defined(way_too_many_messages)
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|3
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
op_star
id|buf
op_assign
(paren
id|u8
op_star
)paren
(paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
)paren
suffix:semicolon
r_int
id|j
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%2d: %8.8x %8.8x %8.8x %8.8x  &quot;
l_string|&quot;%2.2x %2.2x %2.2x.&bslash;n&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
comma
id|buf
(braket
l_int|0
)braket
comma
id|buf
(braket
l_int|1
)braket
comma
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|buf
(braket
id|j
)braket
op_ne
l_int|0xee
op_logical_and
id|j
OL
l_int|1600
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|j
OL
l_int|100
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|buf
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; j=%d.&bslash;n&quot;
comma
id|j
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %8.8x: &quot;
comma
(paren
r_int
)paren
id|tp-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Stop and restart the chip&squot;s Tx processes . */
macro_line|#ifdef CONFIG_NET_HW_FLOWCONTROL
r_if
c_cond
(paren
id|tp-&gt;fc_bit
op_logical_and
id|test_bit
c_func
(paren
id|tp-&gt;fc_bit
comma
op_amp
id|netdev_fc_xoff
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;BUG tx_timeout restarting rx when fc on&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|tulip_restart_rxtx
c_func
(paren
id|tp
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|tulip_init_ring
r_static
r_void
id|tulip_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tp-&gt;susp_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;ttimer
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;nir
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0x00000000
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Mark the last entry as wrapping the ring. */
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|PKT_BUF_SZ
op_or
id|DESC_RING_WRAP
)paren
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dma_addr_t
id|mapping
suffix:semicolon
multiline_comment|/* Note the receive buffer must be longword aligned.&n;&t;&t;   dev_alloc_skb() provides 16 byte alignment.  But do *not*&n;&t;&t;   use skb_reserve() to align the IP header! */
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|PKT_BUF_SZ
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;tail
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
multiline_comment|/* Owned by Tulip chip */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
)brace
id|tp-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|RX_RING_SIZE
)paren
suffix:semicolon
multiline_comment|/* The Tx buffer descriptor is filled in as needed, but we&n;&t;   do need to clear the ownership bit. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0x00000000
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|i
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|buffer2
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_ring_dma
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|tulip_start_xmit
id|tulip_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|entry
suffix:semicolon
id|u32
id|flag
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
id|skb
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|mapping
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
multiline_comment|/* Typical path */
id|flag
op_assign
l_int|0x60000000
suffix:semicolon
multiline_comment|/* No interrupt */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_eq
id|TX_RING_SIZE
op_div
l_int|2
)paren
(brace
id|flag
op_assign
l_int|0xe0000000
suffix:semicolon
multiline_comment|/* Tx-done intr. */
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OL
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
id|flag
op_assign
l_int|0x60000000
suffix:semicolon
multiline_comment|/* No Tx-done intr. */
)brace
r_else
(brace
multiline_comment|/* Leave room for set_rx_mode() to fill entries. */
id|flag
op_assign
l_int|0xe0000000
suffix:semicolon
multiline_comment|/* Tx-done intr. */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|flag
op_assign
l_int|0xe0000000
op_or
id|DESC_RING_WRAP
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|skb-&gt;len
op_or
id|flag
)paren
suffix:semicolon
multiline_comment|/* if we were using Transmit Automatic Polling, we would need a&n;&t; * wmb() here. */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|CSR1
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_clean_tx_ring
r_static
r_void
id|tulip_clean_tx_ring
c_func
(paren
r_struct
id|tulip_private
op_star
id|tp
)paren
(brace
r_int
r_int
id|dirty_tx
suffix:semicolon
r_for
c_loop
(paren
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
OG
l_int|0
suffix:semicolon
id|dirty_tx
op_increment
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
(brace
id|tp-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* It wasn&squot;t Txed */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check for Tx filter setup frames. */
r_if
c_cond
(paren
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* test because dummy frames not mapped */
r_if
c_cond
(paren
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
)paren
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
comma
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* Free the original skb. */
id|dev_kfree_skb_irq
c_func
(paren
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
)paren
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|tulip_down
r_static
r_void
id|tulip_down
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|del_timer_sync
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|CSR7
)paren
suffix:semicolon
multiline_comment|/* Stop the Tx and Rx processes. */
id|tulip_stop_rxtx
c_func
(paren
id|tp
)paren
suffix:semicolon
multiline_comment|/* prepare receive buffers */
id|tulip_refill_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* release any unconsumed transmit buffers */
id|tulip_clean_tx_ring
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_ne
l_int|0xffffffff
)paren
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|tp-&gt;timer.function
op_assign
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|media_timer
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;saved_if_port
suffix:semicolon
multiline_comment|/* Leave the driver in snooze, not sleep, mode. */
id|tulip_set_power_state
(paren
id|tp
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|tulip_close
r_static
r_int
id|tulip_close
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NET_HW_FLOWCONTROL
r_if
c_cond
(paren
id|tp-&gt;fc_bit
)paren
(brace
r_int
id|bit
op_assign
id|tp-&gt;fc_bit
suffix:semicolon
id|tp-&gt;fc_bit
op_assign
l_int|0
suffix:semicolon
id|netdev_unregister_fc
c_func
(paren
id|bit
)paren
suffix:semicolon
)brace
macro_line|#endif
id|tulip_down
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|1
)paren
id|printk
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard, status was %2.2x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|inl
(paren
id|ioaddr
op_plus
id|CSR5
)paren
)paren
suffix:semicolon
id|free_irq
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
id|dma_addr_t
id|mapping
op_assign
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;rx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Not owned by Tulip chip. */
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|length
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer1
op_assign
l_int|0xBADF00D0
suffix:semicolon
multiline_comment|/* An invalid address. */
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|mapping
comma
id|PKT_BUF_SZ
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
(paren
id|skb
)paren
suffix:semicolon
)brace
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|i
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|tulip_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
DECL|function|netdev_ethtool_ioctl
r_static
r_int
id|netdev_ethtool_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|useraddr
)paren
(brace
r_struct
id|tulip_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u32
id|ethcmd
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ethcmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
(brace
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
id|ETHTOOL_GDRVINFO
)brace
suffix:semicolon
id|strcpy
c_func
(paren
id|info.driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info.version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info.bus_info
comma
id|np-&gt;pdev-&gt;slot_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* Provide ioctl() calls to examine the MII xcvr state. */
DECL|function|private_ioctl
r_static
r_int
id|private_ioctl
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_const
r_int
r_int
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_int
id|phy
op_assign
id|tp-&gt;phys
(braket
id|phy_idx
)braket
op_amp
l_int|0x1f
suffix:semicolon
r_int
r_int
id|regnum
op_assign
id|data-&gt;reg_num
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
r_return
id|netdev_ethtool_ioctl
c_func
(paren
id|dev
comma
(paren
r_void
op_star
)paren
id|rq-&gt;ifr_data
)paren
suffix:semicolon
r_case
id|SIOCGMIIPHY
suffix:colon
multiline_comment|/* Get address of MII PHY in use. */
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
)paren
id|data-&gt;phy_id
op_assign
id|phy
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
id|data-&gt;phy_id
op_assign
l_int|32
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|COMET
)paren
id|data-&gt;phy_id
op_assign
l_int|1
suffix:semicolon
r_else
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
id|SIOCGMIIREG
suffix:colon
multiline_comment|/* Read MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
id|data-&gt;phy_id
op_eq
l_int|32
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
)paren
(brace
r_int
id|csr12
op_assign
id|inl
(paren
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_int
id|csr14
op_assign
id|inl
(paren
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|regnum
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
(paren
(paren
id|csr14
op_lshift
l_int|5
)paren
op_amp
l_int|0x1000
)paren
op_logical_or
(paren
id|dev-&gt;if_port
op_eq
l_int|5
op_logical_and
id|tp-&gt;nwayset
)paren
)paren
id|data-&gt;val_out
op_assign
l_int|0x1000
suffix:semicolon
r_else
id|data-&gt;val_out
op_assign
(paren
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIs100
ques
c_cond
l_int|0x2000
suffix:colon
l_int|0
)paren
op_or
(paren
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsFD
ques
c_cond
l_int|0x0100
suffix:colon
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|data-&gt;val_out
op_assign
l_int|0x1848
op_plus
(paren
(paren
id|csr12
op_amp
l_int|0x7000
)paren
op_eq
l_int|0x5000
ques
c_cond
l_int|0x20
suffix:colon
l_int|0
)paren
op_plus
(paren
(paren
id|csr12
op_amp
l_int|0x06
)paren
op_eq
l_int|6
ques
c_cond
l_int|0
suffix:colon
l_int|4
)paren
suffix:semicolon
id|data-&gt;val_out
op_or_assign
l_int|0x6048
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
multiline_comment|/* Advertised value, bogus 10baseTx-FD value from CSR6. */
id|data-&gt;val_out
op_assign
(paren
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_rshift
l_int|3
)paren
op_amp
l_int|0x0040
)paren
op_plus
(paren
(paren
id|csr14
op_rshift
l_int|1
)paren
op_amp
l_int|0x20
)paren
op_plus
l_int|1
suffix:semicolon
id|data-&gt;val_out
op_or_assign
(paren
(paren
id|csr14
op_rshift
l_int|9
)paren
op_amp
l_int|0x03C0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|data-&gt;val_out
op_assign
id|tp-&gt;lpar
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|data-&gt;val_out
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|data-&gt;val_out
op_assign
id|tulip_mdio_read
(paren
id|dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|regnum
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
multiline_comment|/* Write MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
op_logical_neg
id|capable
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|regnum
op_amp
op_complement
l_int|0x1f
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;phy_id
op_eq
id|phy
)paren
(brace
id|u16
id|value
op_assign
id|data-&gt;val_in
suffix:semicolon
r_switch
c_cond
(paren
id|regnum
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Check for autonegotiation on or reset. */
id|tp-&gt;full_duplex_lock
op_assign
(paren
id|value
op_amp
l_int|0x9000
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;full_duplex_lock
)paren
id|tp-&gt;full_duplex
op_assign
(paren
id|value
op_amp
l_int|0x0100
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|tp-&gt;advertising
(braket
id|phy_idx
)braket
op_assign
id|tp-&gt;mii_advertise
op_assign
id|data-&gt;val_in
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|data-&gt;phy_id
op_eq
l_int|32
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
)paren
(brace
id|u16
id|value
op_assign
id|data-&gt;val_in
suffix:semicolon
r_if
c_cond
(paren
id|regnum
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x1200
)paren
op_eq
l_int|0x1200
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|PNIC2
)paren
(brace
id|pnic2_start_nway
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|t21142_start_nway
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|regnum
op_eq
l_int|4
)paren
id|tp-&gt;sym_advertise
op_assign
id|value
suffix:semicolon
)brace
r_else
(brace
id|tulip_mdio_write
(paren
id|dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|regnum
comma
id|data-&gt;val_in
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* Set or clear the multicast filter for this adaptor.&n;   Note that we only use exclusion around actually queueing the&n;   new frame, not around filling tp-&gt;setup_frame.  This is non-deterministic&n;   when re-entered but still correct. */
DECL|macro|set_bit_le
macro_line|#undef set_bit_le
DECL|macro|set_bit_le
mdefine_line|#define set_bit_le(i,p) do { ((char *)(p))[(i)/8] |= (1&lt;&lt;((i)%8)); } while(0)
DECL|function|build_setup_frame_hash
r_static
r_void
id|build_setup_frame_hash
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|hash_table
(braket
l_int|32
)braket
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
id|memset
c_func
(paren
id|hash_table
comma
l_int|0
comma
r_sizeof
(paren
id|hash_table
)paren
)paren
suffix:semicolon
id|set_bit_le
c_func
(paren
l_int|255
comma
id|hash_table
)paren
suffix:semicolon
multiline_comment|/* Broadcast entry */
multiline_comment|/* This should work on big-endian machines as well. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|index
op_assign
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_amp
l_int|0x1ff
suffix:semicolon
id|set_bit_le
c_func
(paren
id|index
comma
id|hash_table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|hash_table
(braket
id|i
)braket
suffix:semicolon
)brace
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|13
op_star
l_int|6
)braket
suffix:semicolon
)brace
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|build_setup_frame_perfect
r_static
r_void
id|build_setup_frame_perfect
c_func
(paren
id|u16
op_star
id|setup_frm
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u16
op_star
id|eaddrs
suffix:semicolon
multiline_comment|/* We have &lt;= 14 addresses so we can use the wonderful&n;&t;   16 address perfect filtering of the Tulip. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|mclist-&gt;dmi_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
op_star
id|eaddrs
op_increment
suffix:semicolon
)brace
multiline_comment|/* Fill the unused entries with the broadcast address. */
id|memset
c_func
(paren
id|setup_frm
comma
l_int|0xff
comma
(paren
l_int|15
op_minus
id|i
)paren
op_star
l_int|12
)paren
suffix:semicolon
id|setup_frm
op_assign
op_amp
id|tp-&gt;setup_frame
(braket
l_int|15
op_star
l_int|6
)braket
suffix:semicolon
multiline_comment|/* Fill the final entry with our physical address. */
id|eaddrs
op_assign
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|1
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
op_star
id|setup_frm
op_increment
op_assign
id|eaddrs
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
(paren
r_struct
id|tulip_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|csr6
suffix:semicolon
id|csr6
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR6
)paren
op_amp
op_complement
l_int|0x00D5
suffix:semicolon
id|tp-&gt;csr6
op_and_assign
op_complement
l_int|0x00D5
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|tp-&gt;csr6
op_or_assign
id|AcceptAllMulticast
op_or
id|AcceptAllPhys
suffix:semicolon
id|csr6
op_or_assign
id|AcceptAllMulticast
op_or
id|AcceptAllPhys
suffix:semicolon
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
l_int|1000
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter well -- accept all multicasts. */
id|tp-&gt;csr6
op_or_assign
id|AcceptAllMulticast
suffix:semicolon
id|csr6
op_or_assign
id|AcceptAllMulticast
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|MC_HASH_ONLY
)paren
(brace
multiline_comment|/* Some work-alikes have only a 64-entry hash filter table. */
multiline_comment|/* Should verify correctness on big-endian/__powerpc__ */
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|64
)paren
(brace
multiline_comment|/* Arbitrary non-effective limit. */
id|tp-&gt;csr6
op_or_assign
id|AcceptAllMulticast
suffix:semicolon
id|csr6
op_or_assign
id|AcceptAllMulticast
suffix:semicolon
)brace
r_else
(brace
id|u32
id|mc_filter
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|filterbit
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|COMET_MAC_ADDR
)paren
id|filterbit
op_assign
id|ether_crc_le
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
suffix:semicolon
r_else
id|filterbit
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
suffix:semicolon
id|filterbit
op_and_assign
l_int|0x3f
suffix:semicolon
id|mc_filter
(braket
id|filterbit
op_rshift
l_int|5
)braket
op_or_assign
id|cpu_to_le32
c_func
(paren
l_int|1
op_lshift
(paren
id|filterbit
op_amp
l_int|31
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Added filter for %2.2x:%2.2x:%2.2x:&quot;
l_string|&quot;%2.2x:%2.2x:%2.2x  %8.8x bit %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mclist-&gt;dmi_addr
(braket
l_int|0
)braket
comma
id|mclist-&gt;dmi_addr
(braket
l_int|1
)braket
comma
id|mclist-&gt;dmi_addr
(braket
l_int|2
)braket
comma
id|mclist-&gt;dmi_addr
(braket
l_int|3
)braket
comma
id|mclist-&gt;dmi_addr
(braket
l_int|4
)braket
comma
id|mclist-&gt;dmi_addr
(braket
l_int|5
)braket
comma
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
comma
id|filterbit
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mc_filter
(braket
l_int|0
)braket
op_eq
id|tp-&gt;mc_filter
(braket
l_int|0
)braket
op_logical_and
id|mc_filter
(braket
l_int|1
)braket
op_eq
id|tp-&gt;mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* No change. */
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|IS_ASIX
)paren
(brace
id|outl
c_func
(paren
l_int|2
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|3
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|COMET_MAC_ADDR
)paren
(brace
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
l_int|0xAC
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
l_int|0xB0
)paren
suffix:semicolon
)brace
id|tp-&gt;mc_filter
(braket
l_int|0
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
suffix:semicolon
id|tp-&gt;mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|1
)braket
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Note that only the low-address shortword of setup_frame is valid!&n;&t;&t;   The values are doubled for big-endian architectures. */
r_if
c_cond
(paren
id|dev-&gt;mc_count
OG
l_int|14
)paren
(brace
multiline_comment|/* Must use a multicast hash table. */
id|build_setup_frame_hash
c_func
(paren
id|tp-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|build_setup_frame_perfect
c_func
(paren
id|tp-&gt;setup_frame
comma
id|dev
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
OG
id|TX_RING_SIZE
op_minus
l_int|2
)paren
(brace
multiline_comment|/* Same setup recently queued, we need not add it. */
)brace
r_else
(brace
id|u32
id|tx_flags
op_assign
l_int|0x08000000
op_or
l_int|192
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
id|dummy
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Now add this frame to the Tx list. */
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|entry
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Avoid a chip errata by prefixing a dummy entry. */
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
ques
c_cond
id|cpu_to_le32
c_func
(paren
id|DESC_RING_WRAP
)paren
suffix:colon
l_int|0
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Must set DescOwned later to avoid race with chip */
id|dummy
op_assign
id|entry
suffix:semicolon
id|entry
op_assign
id|tp-&gt;cur_tx
op_increment
op_mod
id|TX_RING_SIZE
suffix:semicolon
)brace
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|skb
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pdev
comma
id|tp-&gt;setup_frame
comma
r_sizeof
(paren
id|tp-&gt;setup_frame
)paren
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
multiline_comment|/* Put the setup frame on the Tx list. */
r_if
c_cond
(paren
id|entry
op_eq
id|TX_RING_SIZE
op_minus
l_int|1
)paren
id|tx_flags
op_or_assign
id|DESC_RING_WRAP
suffix:semicolon
multiline_comment|/* Wrap ring. */
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|length
op_assign
id|cpu_to_le32
c_func
(paren
id|tx_flags
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|buffer1
op_assign
id|cpu_to_le32
c_func
(paren
id|tp-&gt;tx_buffers
(braket
id|entry
)braket
dot
id|mapping
)paren
suffix:semicolon
id|tp-&gt;tx_ring
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy
op_ge
l_int|0
)paren
id|tp-&gt;tx_ring
(braket
id|dummy
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|DescOwned
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;cur_tx
op_minus
id|tp-&gt;dirty_tx
op_ge
id|TX_RING_SIZE
op_minus
l_int|2
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Trigger an immediate transmit demand. */
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|CSR1
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
id|csr6
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_TULIP_MWI
DECL|function|tulip_mwi_config
r_static
r_void
id|__devinit
id|tulip_mwi_config
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|u8
id|cache
suffix:semicolon
id|u16
id|pci_command
comma
id|new_command
suffix:semicolon
id|u32
id|csr0
suffix:semicolon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tulip_mwi_config()&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
id|tp-&gt;csr0
op_assign
id|csr0
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* check for sane cache line size. from acenic.c. */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|cache
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cache
op_lshift
l_int|2
)paren
op_ne
id|SMP_CACHE_BYTES
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: PCI cache line size set incorrectly &quot;
l_string|&quot;(%i bytes) by BIOS/FW, correcting to %i&bslash;n&quot;
comma
id|pdev-&gt;slot_name
comma
(paren
id|cache
op_lshift
l_int|2
)paren
comma
id|SMP_CACHE_BYTES
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
id|SMP_CACHE_BYTES
op_rshift
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
multiline_comment|/* read cache line size again, hardware may not have accepted&n;&t; * our cache line size change&n;&t; */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|cache
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cache
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* if we have any cache line size at all, we can do MRM */
id|csr0
op_or_assign
id|MRM
suffix:semicolon
multiline_comment|/* ...and barring hardware bugs, MWI */
r_if
c_cond
(paren
op_logical_neg
(paren
id|tp-&gt;chip_id
op_eq
id|DC21143
op_logical_and
id|tp-&gt;revision
op_eq
l_int|65
)paren
)paren
id|csr0
op_or_assign
id|MWI
suffix:semicolon
multiline_comment|/* set or disable MWI in the standard PCI command bit.&n;&t; * Check for the case where  mwi is desired but not available&n;&t; */
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_amp
id|MWI
)paren
id|new_command
op_assign
id|pci_command
op_or
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
r_else
id|new_command
op_assign
id|pci_command
op_amp
op_complement
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
r_if
c_cond
(paren
id|new_command
op_ne
id|pci_command
)paren
(brace
id|pci_write_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
id|new_command
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|csr0
op_amp
id|MWI
)paren
op_logical_and
(paren
op_logical_neg
(paren
id|pci_command
op_amp
id|PCI_COMMAND_INVALIDATE
)paren
)paren
)paren
id|csr0
op_and_assign
op_complement
id|MWI
suffix:semicolon
)brace
multiline_comment|/* assign per-cacheline-size cache alignment and&n;&t; * burst length values&n;&t; */
r_switch
c_cond
(paren
id|cache
)paren
(brace
r_case
l_int|8
suffix:colon
id|csr0
op_or_assign
id|MRL
op_or
(paren
l_int|1
op_lshift
id|CALShift
)paren
op_or
(paren
l_int|16
op_lshift
id|BurstLenShift
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|csr0
op_or_assign
id|MRL
op_or
(paren
l_int|2
op_lshift
id|CALShift
)paren
op_or
(paren
l_int|16
op_lshift
id|BurstLenShift
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|csr0
op_or_assign
id|MRL
op_or
(paren
l_int|3
op_lshift
id|CALShift
)paren
op_or
(paren
l_int|32
op_lshift
id|BurstLenShift
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|out
suffix:semicolon
)brace
id|tp-&gt;csr0
op_assign
id|csr0
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|csr0
op_amp
id|MWI
)paren
(brace
id|pci_command
op_and_assign
op_complement
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pdev
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
suffix:semicolon
id|csr0
op_and_assign
op_complement
id|MWI
suffix:semicolon
)brace
id|tp-&gt;csr0
op_assign
id|csr0
op_or
(paren
l_int|8
op_lshift
id|BurstLenShift
)paren
op_or
(paren
l_int|1
op_lshift
id|CALShift
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MWI config cacheline=%d, csr0=%08x&bslash;n&quot;
comma
id|pdev-&gt;slot_name
comma
id|cache
comma
id|csr0
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|tulip_init_one
r_static
r_int
id|__devinit
id|tulip_init_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|tulip_private
op_star
id|tp
suffix:semicolon
multiline_comment|/* See note below on the multiport cards. */
r_static
r_int
r_char
id|last_phys_addr
(braket
l_int|6
)braket
op_assign
(brace
l_int|0x00
comma
l_char|&squot;L&squot;
comma
l_char|&squot;i&squot;
comma
l_char|&squot;n&squot;
comma
l_char|&squot;u&squot;
comma
l_char|&squot;x&squot;
)brace
suffix:semicolon
r_static
r_int
id|last_irq
suffix:semicolon
r_static
r_int
id|multiport_cnt
suffix:semicolon
multiline_comment|/* For four-port boards w/one EEPROM */
id|u8
id|chip_rev
suffix:semicolon
r_int
id|i
comma
id|irq
suffix:semicolon
r_int
r_int
id|sum
suffix:semicolon
r_int
r_char
op_star
id|ee_data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|chip_idx
op_assign
id|ent-&gt;driver_data
suffix:semicolon
r_int
r_int
id|eeprom_missing
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|force_csr0
op_assign
l_int|0
suffix:semicolon
macro_line|#ifndef MODULE
r_static
r_int
id|did_version
suffix:semicolon
multiline_comment|/* Already printed version info. */
r_if
c_cond
(paren
id|tulip_debug
OG
l_int|0
op_logical_and
id|did_version
op_increment
op_eq
l_int|0
)paren
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
id|board_idx
op_increment
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Lan media wire a tulip chip to a wan interface. Needs a very&n;&t; *&t;different driver (lmc driver)&n;&t; */
r_if
c_cond
(paren
id|pdev-&gt;subsystem_vendor
op_eq
id|PCI_VENDOR_ID_LMC
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;skipping LMC card.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Early DM9100&squot;s need software CRC and the DMFE driver&n;&t; */
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
l_int|0x1282
op_logical_and
id|pdev-&gt;device
op_eq
l_int|0x9100
)paren
(brace
id|u32
id|dev_rev
suffix:semicolon
multiline_comment|/* Read Chip revision */
id|pci_read_config_dword
c_func
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|dev_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev_rev
OL
l_int|0x02000030
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;skipping early DM9100 with Crc bug (use dmfe)&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; *&t;Looks for early PCI chipsets where people report hangs&n;&t; *&t;without the workarounds being on.&n;&t; */
multiline_comment|/* Intel Saturn. Switch to 8 long words burst, 8 long word cache aligned&n;&t;   Aries might need this too. The Saturn errata are not pretty reading but&n;&t;   thankfully its an old 486 chipset.&n;&t;*/
r_if
c_cond
(paren
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82424
comma
l_int|NULL
)paren
)paren
(brace
id|csr0
op_assign
id|MRL
op_or
id|MRM
op_or
(paren
l_int|8
op_lshift
id|BurstLenShift
)paren
op_or
(paren
l_int|1
op_lshift
id|CALShift
)paren
suffix:semicolon
id|force_csr0
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* The dreaded SiS496 486 chipset. Same workaround as above. */
r_if
c_cond
(paren
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_496
comma
l_int|NULL
)paren
)paren
(brace
id|csr0
op_assign
id|MRL
op_or
id|MRM
op_or
(paren
l_int|8
op_lshift
id|BurstLenShift
)paren
op_or
(paren
l_int|1
op_lshift
id|CALShift
)paren
suffix:semicolon
id|force_csr0
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* bugfix: the ASIX must have a burst limit or horrible things happen. */
r_if
c_cond
(paren
id|chip_idx
op_eq
id|AX88140
)paren
(brace
r_if
c_cond
(paren
(paren
id|csr0
op_amp
l_int|0x3f00
)paren
op_eq
l_int|0
)paren
id|csr0
op_or_assign
l_int|0x2000
suffix:semicolon
)brace
multiline_comment|/* PNIC doesn&squot;t have MWI/MRL/MRM... */
r_if
c_cond
(paren
id|chip_idx
op_eq
id|LC82C168
)paren
id|csr0
op_and_assign
op_complement
l_int|0xfff10000
suffix:semicolon
multiline_comment|/* zero reserved bits 31:20, 16 */
multiline_comment|/* DM9102A has troubles with MRM &amp; clear reserved bits 24:22, 20, 16, 7:1 */
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
l_int|0x1282
op_logical_and
id|pdev-&gt;device
op_eq
l_int|0x9102
)paren
id|csr0
op_and_assign
op_complement
l_int|0x01f100ff
suffix:semicolon
macro_line|#if defined(__sparc__)
multiline_comment|/* DM9102A needs 32-dword alignment/burst length on sparc - chip bug? */
r_if
c_cond
(paren
id|pdev-&gt;vendor
op_eq
l_int|0x1282
op_logical_and
id|pdev-&gt;device
op_eq
l_int|0x9102
)paren
id|csr0
op_assign
(paren
id|csr0
op_amp
op_complement
l_int|0xff00
)paren
op_or
l_int|0xe000
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *&t;And back to business&n;&t; */
id|i
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot enable tulip board #%d, aborting&bslash;n&quot;
comma
id|board_idx
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
id|ioaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
multiline_comment|/* alloc_etherdev ensures aligned and zeroed private structures */
id|dev
op_assign
id|alloc_etherdev
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;ether device alloc failed, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
OL
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
(brace
id|printk
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: I/O region (0x%lx@0x%lx) too small, &quot;
l_string|&quot;aborting&bslash;n&quot;
comma
id|pdev-&gt;slot_name
comma
id|pci_resource_len
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_start
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_goto
id|err_out_free_netdev
suffix:semicolon
)brace
multiline_comment|/* grab all resources from both PIO and MMIO regions, as we&n;&t; * don&squot;t want anyone else messing around with our hardware */
r_if
c_cond
(paren
id|pci_request_regions
(paren
id|pdev
comma
l_string|&quot;tulip&quot;
)paren
)paren
r_goto
id|err_out_free_netdev
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|ioaddr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
(paren
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
comma
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|io_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
r_goto
id|err_out_free_res
suffix:semicolon
macro_line|#endif
id|pci_read_config_byte
(paren
id|pdev
comma
id|PCI_REVISION_ID
comma
op_amp
id|chip_rev
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * initialize private data structure &squot;tp&squot;&n;&t; * it is zeroed and aligned in alloc_etherdev&n;&t; */
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
op_amp
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;rx_ring
)paren
r_goto
id|err_out_mtable
suffix:semicolon
id|tp-&gt;tx_ring
op_assign
(paren
r_struct
id|tulip_tx_desc
op_star
)paren
(paren
id|tp-&gt;rx_ring
op_plus
id|RX_RING_SIZE
)paren
suffix:semicolon
id|tp-&gt;tx_ring_dma
op_assign
id|tp-&gt;rx_ring_dma
op_plus
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
suffix:semicolon
id|tp-&gt;chip_id
op_assign
id|chip_idx
suffix:semicolon
id|tp-&gt;flags
op_assign
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|flags
suffix:semicolon
id|tp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|tp-&gt;revision
op_assign
id|chip_rev
suffix:semicolon
id|tp-&gt;csr0
op_assign
id|csr0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;mii_lock
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|tp-&gt;timer
)paren
suffix:semicolon
id|tp-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|tp-&gt;timer.function
op_assign
id|tulip_tbl
(braket
id|tp-&gt;chip_id
)braket
dot
id|media_timer
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
macro_line|#ifdef CONFIG_TULIP_MWI
r_if
c_cond
(paren
op_logical_neg
id|force_csr0
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_PCI_MWI
)paren
)paren
id|tulip_mwi_config
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* MWI is broken for DC21143 rev 65... */
r_if
c_cond
(paren
id|chip_idx
op_eq
id|DC21143
op_logical_and
id|chip_rev
op_eq
l_int|65
)paren
id|tp-&gt;csr0
op_and_assign
op_complement
id|MWI
suffix:semicolon
macro_line|#endif
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|tulip_stop_rxtx
c_func
(paren
id|tp
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
multiline_comment|/* Clear the missed-packet counter. */
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR8
)paren
suffix:semicolon
multiline_comment|/* The station address ROM is read byte serially.  The register must&n;&t;   be polled, waiting for the value to be read bit serially from the&n;&t;   EEPROM.&n;&t;   */
id|ee_data
op_assign
id|tp-&gt;eeprom
suffix:semicolon
id|sum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chip_idx
op_eq
id|LC82C168
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|value
comma
id|boguscnt
op_assign
l_int|100000
suffix:semicolon
id|outl
c_func
(paren
l_int|0x600
op_or
id|i
comma
id|ioaddr
op_plus
l_int|0x98
)paren
suffix:semicolon
r_do
id|value
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|CSR9
)paren
suffix:semicolon
r_while
c_loop
(paren
id|value
template_param
l_int|0
)paren
suffix:semicolon
id|put_unaligned
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|value
)paren
comma
(paren
(paren
id|u16
op_star
)paren
id|dev-&gt;dev_addr
)paren
op_plus
id|i
)paren
suffix:semicolon
id|sum
op_add_assign
id|value
op_amp
l_int|0xffff
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|chip_idx
op_eq
id|COMET
)paren
(brace
multiline_comment|/* No need to read the EEPROM. */
id|put_unaligned
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
l_int|0xA4
)paren
comma
(paren
id|u32
op_star
)paren
id|dev-&gt;dev_addr
)paren
suffix:semicolon
id|put_unaligned
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
l_int|0xA8
)paren
comma
(paren
id|u16
op_star
)paren
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|sum
op_add_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* A serial EEPROM interface, we read now and sort it out later. */
r_int
id|sa_offset
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr_size
op_assign
id|tulip_read_eeprom
c_func
(paren
id|ioaddr
comma
l_int|0xff
comma
l_int|8
)paren
op_amp
l_int|0x40000
ques
c_cond
l_int|8
suffix:colon
l_int|6
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|tp-&gt;eeprom
)paren
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
id|ee_data
)paren
(braket
id|i
)braket
op_assign
id|le16_to_cpu
c_func
(paren
id|tulip_read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
comma
id|ee_addr_size
)paren
)paren
suffix:semicolon
multiline_comment|/* DEC now has a specification (see Notes) but early board makers&n;&t;&t;   just put the address in the first EEPROM locations. */
multiline_comment|/* This does  memcmp(ee_data, ee_data+16, 8) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ee_data
(braket
id|i
)braket
op_ne
id|ee_data
(braket
l_int|16
op_plus
id|i
)braket
)paren
id|sa_offset
op_assign
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|chip_idx
op_eq
id|CONEXANT
)paren
(brace
multiline_comment|/* Check that the tuple type and length is correct. */
r_if
c_cond
(paren
id|ee_data
(braket
l_int|0x198
)braket
op_eq
l_int|0x04
op_logical_and
id|ee_data
(braket
l_int|0x199
)braket
op_eq
l_int|6
)paren
id|sa_offset
op_assign
l_int|0x19A
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ee_data
(braket
l_int|0
)braket
op_eq
l_int|0xff
op_logical_and
id|ee_data
(braket
l_int|1
)braket
op_eq
l_int|0xff
op_logical_and
id|ee_data
(braket
l_int|2
)braket
op_eq
l_int|0
)paren
(brace
id|sa_offset
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Grrr, damn Matrox boards. */
id|multiport_cnt
op_assign
l_int|4
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DDB5476
r_if
c_cond
(paren
(paren
id|pdev-&gt;bus-&gt;number
op_eq
l_int|0
)paren
op_logical_and
(paren
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
op_eq
l_int|6
)paren
)paren
(brace
multiline_comment|/* DDB5476 MAC address in first EEPROM locations. */
id|sa_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No media table either */
id|tp-&gt;flags
op_and_assign
op_complement
id|HAS_MEDIA_TABLE
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_DDB5477
r_if
c_cond
(paren
(paren
id|pdev-&gt;bus-&gt;number
op_eq
l_int|0
)paren
op_logical_and
(paren
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
op_eq
l_int|4
)paren
)paren
(brace
multiline_comment|/* DDB5477 MAC address in first EEPROM locations. */
id|sa_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No media table either */
id|tp-&gt;flags
op_and_assign
op_complement
id|HAS_MEDIA_TABLE
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|ee_data
(braket
id|i
op_plus
id|sa_offset
)braket
suffix:semicolon
id|sum
op_add_assign
id|ee_data
(braket
id|i
op_plus
id|sa_offset
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Lite-On boards have the address byte-swapped. */
r_if
c_cond
(paren
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0xA0
op_logical_or
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_eq
l_int|0xC0
)paren
op_logical_and
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_eq
l_int|0x00
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_char
id|tmp
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
)brace
multiline_comment|/* On the Zynx 315 Etherarray and other multiport boards only the&n;&t;   first Tulip has an EEPROM.&n;&t;   On Sparc systems the mac address is held in the OBP property&n;&t;   &quot;local-mac-address&quot;.&n;&t;   The addresses of the subsequent ports are derived from the first.&n;&t;   Many PCI BIOSes also incorrectly report the IRQ line, so we correct&n;&t;   that here as well. */
r_if
c_cond
(paren
id|sum
op_eq
l_int|0
op_logical_or
id|sum
op_eq
l_int|6
op_star
l_int|0xff
)paren
(brace
macro_line|#if defined(__sparc__)
r_struct
id|pcidev_cookie
op_star
id|pcp
op_assign
id|pdev-&gt;sysdata
suffix:semicolon
macro_line|#endif
id|eeprom_missing
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|last_phys_addr
(braket
id|i
)braket
op_plus
l_int|1
suffix:semicolon
macro_line|#if defined(__sparc__)
r_if
c_cond
(paren
(paren
id|pcp
op_ne
l_int|NULL
)paren
op_logical_and
id|prom_getproplen
c_func
(paren
id|pcp-&gt;prom_node
comma
l_string|&quot;local-mac-address&quot;
)paren
op_eq
l_int|6
)paren
(brace
id|prom_getproperty
c_func
(paren
id|pcp-&gt;prom_node
comma
l_string|&quot;local-mac-address&quot;
comma
id|dev-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(__i386__)&t;&t;/* Patch up x86 BIOS bug. */
r_if
c_cond
(paren
id|last_irq
)paren
id|irq
op_assign
id|last_irq
suffix:semicolon
macro_line|#endif
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|last_phys_addr
(braket
id|i
)braket
op_assign
id|dev-&gt;dev_addr
(braket
id|i
)braket
suffix:semicolon
id|last_irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|board_idx
op_ge
l_int|0
op_logical_and
id|board_idx
OL
id|MAX_UNITS
)paren
(brace
r_if
c_cond
(paren
id|options
(braket
id|board_idx
)braket
op_amp
id|MEDIA_MASK
)paren
id|tp-&gt;default_port
op_assign
id|options
(braket
id|board_idx
)braket
op_amp
id|MEDIA_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|options
(braket
id|board_idx
)braket
op_amp
id|FullDuplex
)paren
op_logical_or
id|full_duplex
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mtu
(braket
id|board_idx
)braket
OG
l_int|0
)paren
id|dev-&gt;mtu
op_assign
id|mtu
(braket
id|board_idx
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mem_start
op_amp
id|MEDIA_MASK
)paren
id|tp-&gt;default_port
op_assign
id|dev-&gt;mem_start
op_amp
id|MEDIA_MASK
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;default_port
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tulip%d: Transceiver selection forced to %s.&bslash;n&quot;
comma
id|board_idx
comma
id|medianame
(braket
id|tp-&gt;default_port
op_amp
id|MEDIA_MASK
)braket
)paren
suffix:semicolon
id|tp-&gt;medialock
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaAlwaysFD
)paren
id|tp-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;full_duplex
)paren
id|tp-&gt;full_duplex_lock
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tulip_media_cap
(braket
id|tp-&gt;default_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
id|u16
id|media2advert
(braket
)braket
op_assign
(brace
l_int|0x20
comma
l_int|0x40
comma
l_int|0x03e0
comma
l_int|0x60
comma
l_int|0x80
comma
l_int|0x100
comma
l_int|0x200
)brace
suffix:semicolon
id|tp-&gt;mii_advertise
op_assign
id|media2advert
(braket
id|tp-&gt;default_port
op_minus
l_int|9
)braket
suffix:semicolon
id|tp-&gt;mii_advertise
op_or_assign
(paren
id|tp-&gt;flags
op_amp
id|HAS_8023X
)paren
suffix:semicolon
multiline_comment|/* Matching bits! */
)brace
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_MEDIA_TABLE
)paren
(brace
id|sprintf
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;tulip%d&quot;
comma
id|board_idx
)paren
suffix:semicolon
multiline_comment|/* hack */
id|tulip_parse_eeprom
c_func
(paren
id|dev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;eth%d&quot;
)paren
suffix:semicolon
multiline_comment|/* un-hack */
)brace
r_if
c_cond
(paren
(paren
id|tp-&gt;flags
op_amp
id|ALWAYS_CHECK_MII
)paren
op_logical_or
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
op_logical_or
(paren
op_logical_neg
id|tp-&gt;mtable
op_logical_and
(paren
id|tp-&gt;flags
op_amp
id|HAS_MII
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mtable
op_logical_and
id|tp-&gt;mtable-&gt;has_mii
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tp-&gt;mtable-&gt;leafcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|tp-&gt;mtable-&gt;mleaf
(braket
id|i
)braket
dot
id|media
op_eq
l_int|11
)paren
(brace
id|tp-&gt;cur_index
op_assign
id|i
suffix:semicolon
id|tp-&gt;saved_if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
id|tulip_select_media
c_func
(paren
id|dev
comma
l_int|2
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|tp-&gt;saved_if_port
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Find the connected MII xcvrs.&n;&t;&t;   Doing this in open() would allow detecting external xcvrs&n;&t;&t;   later, but takes much time. */
id|tulip_find_mii
(paren
id|dev
comma
id|board_idx
)paren
suffix:semicolon
)brace
multiline_comment|/* The Tulip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
id|tulip_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|tulip_start_xmit
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tulip_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;stop
op_assign
id|tulip_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|tulip_get_stats
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|private_ioctl
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_rx_mode
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
r_goto
id|err_out_free_ring
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s rev %d at %#3lx,&quot;
comma
id|dev-&gt;name
comma
id|tulip_tbl
(braket
id|chip_idx
)braket
dot
id|chip_name
comma
id|chip_rev
comma
id|ioaddr
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eeprom_missing
)paren
id|printk
c_func
(paren
l_string|&quot; EEPROM not present,&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%c%2.2X&quot;
comma
id|i
ques
c_cond
l_char|&squot;:&squot;
suffix:colon
l_char|&squot; &squot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, IRQ %d.&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;chip_id
op_eq
id|PNIC2
)paren
id|tp-&gt;link_change
op_assign
id|pnic2_lnk_change
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_NWAY
)paren
id|tp-&gt;link_change
op_assign
id|t21142_lnk_change
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;flags
op_amp
id|HAS_PNICNWAY
)paren
id|tp-&gt;link_change
op_assign
id|pnic_lnk_change
suffix:semicolon
multiline_comment|/* Reset the xcvr interface and turn on heartbeat. */
r_switch
c_cond
(paren
id|chip_idx
)paren
(brace
r_case
id|DC21140
suffix:colon
r_case
id|DM910X
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|tp-&gt;mtable
)paren
id|outl
c_func
(paren
id|tp-&gt;mtable-&gt;csr12dir
op_or
l_int|0x100
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DC21142
suffix:colon
r_if
c_cond
(paren
id|tp-&gt;mii_cnt
op_logical_or
id|tulip_media_cap
(braket
id|dev-&gt;if_port
)braket
op_amp
id|MediaIsMII
)paren
(brace
id|outl
c_func
(paren
id|csr6_mask_defstate
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
id|csr6_mask_hdcap
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
)brace
r_else
id|t21142_start_nway
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PNIC2
suffix:colon
multiline_comment|/* just do a reset for sanity sake */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LC82C168
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;mii_cnt
)paren
(brace
id|tp-&gt;nway
op_assign
l_int|1
suffix:semicolon
id|tp-&gt;nwayset
op_assign
l_int|0
suffix:semicolon
id|outl
c_func
(paren
id|csr6_ttm
op_or
id|csr6_ca
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x30
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0001F078
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0201F078
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
multiline_comment|/* Turn on autonegotiation. */
)brace
r_break
suffix:semicolon
r_case
id|MX98713
suffix:colon
r_case
id|COMPEX9881
suffix:colon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x000711C0
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
multiline_comment|/* Turn on NWay. */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|CSR13
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MX98715
suffix:colon
r_case
id|MX98725
suffix:colon
id|outl
c_func
(paren
l_int|0x01a80000
comma
id|ioaddr
op_plus
id|CSR6
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xFFFFFFFF
comma
id|ioaddr
op_plus
id|CSR14
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00001000
comma
id|ioaddr
op_plus
id|CSR12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMET
suffix:colon
multiline_comment|/* No initialization necessary. */
r_break
suffix:semicolon
)brace
multiline_comment|/* put the chip in snooze mode until opened */
id|tulip_set_power_state
(paren
id|tp
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free_ring
suffix:colon
id|pci_free_consistent
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
id|tp-&gt;rx_ring
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
id|err_out_mtable
suffix:colon
r_if
c_cond
(paren
id|tp-&gt;mtable
)paren
id|kfree
(paren
id|tp-&gt;mtable
)paren
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|ioaddr
)paren
suffix:semicolon
id|err_out_free_res
suffix:colon
macro_line|#endif
id|pci_release_regions
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_free_netdev
suffix:colon
id|kfree
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|tulip_suspend
r_static
r_int
id|tulip_suspend
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|netif_running
(paren
id|dev
)paren
op_logical_and
id|netif_device_present
(paren
id|dev
)paren
)paren
(brace
id|netif_device_detach
(paren
id|dev
)paren
suffix:semicolon
id|tulip_down
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* pci_power_off(pdev, -1); */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tulip_resume
r_static
r_int
id|tulip_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|netif_running
(paren
id|dev
)paren
op_logical_and
op_logical_neg
id|netif_device_present
(paren
id|dev
)paren
)paren
(brace
macro_line|#if 1
id|pci_enable_device
(paren
id|pdev
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* pci_power_on(pdev); */
id|tulip_up
(paren
id|dev
)paren
suffix:semicolon
id|netif_device_attach
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|function|tulip_remove_one
r_static
r_void
id|__devexit
id|tulip_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|tulip_private
op_star
id|tp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pci_free_consistent
(paren
id|pdev
comma
r_sizeof
(paren
r_struct
id|tulip_rx_desc
)paren
op_star
id|RX_RING_SIZE
op_plus
r_sizeof
(paren
r_struct
id|tulip_tx_desc
)paren
op_star
id|TX_RING_SIZE
comma
id|tp-&gt;rx_ring
comma
id|tp-&gt;rx_ring_dma
)paren
suffix:semicolon
id|unregister_netdev
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mtable
)paren
id|kfree
(paren
id|tp-&gt;mtable
)paren
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
macro_line|#endif
id|kfree
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* pci_power_off (pdev, -1); */
)brace
DECL|variable|tulip_driver
r_static
r_struct
id|pci_driver
id|tulip_driver
op_assign
(brace
id|name
suffix:colon
id|DRV_NAME
comma
id|id_table
suffix:colon
id|tulip_pci_tbl
comma
id|probe
suffix:colon
id|tulip_init_one
comma
id|remove
suffix:colon
id|tulip_remove_one
comma
macro_line|#ifdef CONFIG_PM
id|suspend
suffix:colon
id|tulip_suspend
comma
id|resume
suffix:colon
id|tulip_resume
comma
macro_line|#endif /* CONFIG_PM */
)brace
suffix:semicolon
DECL|function|tulip_init
r_static
r_int
id|__init
id|tulip_init
(paren
r_void
)paren
(brace
macro_line|#ifdef MODULE
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* copy module parms into globals */
id|tulip_rx_copybreak
op_assign
id|rx_copybreak
suffix:semicolon
id|tulip_max_interrupt_work
op_assign
id|max_interrupt_work
suffix:semicolon
multiline_comment|/* probe for and init boards */
r_return
id|pci_module_init
(paren
op_amp
id|tulip_driver
)paren
suffix:semicolon
)brace
DECL|function|tulip_cleanup
r_static
r_void
id|__exit
id|tulip_cleanup
(paren
r_void
)paren
(brace
id|pci_unregister_driver
(paren
op_amp
id|tulip_driver
)paren
suffix:semicolon
)brace
DECL|variable|tulip_init
id|module_init
c_func
(paren
id|tulip_init
)paren
suffix:semicolon
DECL|variable|tulip_cleanup
id|module_exit
c_func
(paren
id|tulip_cleanup
)paren
suffix:semicolon
eof
