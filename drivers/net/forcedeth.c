multiline_comment|/*&n; * forcedeth: Ethernet driver for NVIDIA nForce media access controllers.&n; *&n; * Note: This driver is a cleanroom reimplementation based on reverse&n; *      engineered documentation written by Carl-Daniel Hailfinger&n; *      and Andrew de Quincey. It&squot;s neither supported nor endorsed&n; *      by NVIDIA Corp. Use at your own risk.&n; *&n; * NVIDIA, nForce and other NVIDIA marks are trademarks or registered&n; * trademarks of NVIDIA Corporation in the United States and other&n; * countries.&n; *&n; * Copyright (C) 2003 Manfred Spraul&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; * Changelog:&n; * &t;0.01: 05 Oct 2003: First release that compiles without warnings.&n; * &t;0.02: 05 Oct 2003: Fix bug for drain_tx: do not try to free NULL skbs.&n; * &t;&t;&t;   Check all PCI BARs for the register window.&n; * &t;&t;&t;   udelay added to mii_rw.&n; * &t;0.03: 06 Oct 2003: Initialize dev-&gt;irq.&n; * &t;0.04: 07 Oct 2003: Initialize np-&gt;lock, reduce handled irqs, add printks.&n; * &t;0.05: 09 Oct 2003: printk removed again, irq status print tx_timeout.&n; * &t;0.06: 10 Oct 2003: MAC Address read updated, pff flag generation updated,&n; * &t;&t;&t;   irq mask updated&n; * &t;0.07: 14 Oct 2003: Further irq mask updates.&n; * &t;0.08: 20 Oct 2003: rx_desc.Length initialization added, alloc_rx refill&n; * &t;&t;&t;   added into irq handler, NULL check for drain_ring.&n; * &t;0.09: 20 Oct 2003: Basic link speed irq implementation. Only handle the&n; * &t;&t;&t;   requested interrupt sources.&n; * &t;0.10: 20 Oct 2003: First cleanup for release.&n; * &t;0.11: 21 Oct 2003: hexdump for tx added, rx buffer sizes increased.&n; * &t;&t;&t;   MAC Address init fix, set_multicast cleanup.&n; * &t;0.12: 23 Oct 2003: Cleanups for release.&n; * &t;0.13: 25 Oct 2003: Limit for concurrent tx packets increased to 10.&n; * &t;&t;&t;   Set link speed correctly. start rx before starting&n; * &t;&t;&t;   tx (start_rx sets the link speed).&n; * &t;0.14: 25 Oct 2003: Nic dependant irq mask.&n; * &t;0.15: 08 Nov 2003: fix smp deadlock with set_multicast_list during&n; * &t;&t;&t;   open.&n; * &t;0.16: 15 Nov 2003: include file cleanup for ppc64, rx buffer size&n; * &t;&t;&t;   increased to 1628 bytes.&n; * &t;0.17: 16 Nov 2003: undo rx buffer size increase. Substract 1 from&n; * &t;&t;&t;   the tx length.&n; * &t;0.18: 17 Nov 2003: fix oops due to late initialization of dev_stats&n; * &t;0.19: 29 Nov 2003: Handle RxNoBuf, detect &amp; handle invalid mac&n; * &t;&t;&t;   addresses, really stop rx if already running&n; * &t;&t;&t;   in start_rx, clean up a bit.&n; * &t;&t;&t;&t;(C) Carl-Daniel Hailfinger&n; * &t;0.20: 07 Dev 2003: alloc fixes&n; *&n; * Known bugs:&n; * The irq handling is wrong - no tx done interrupts are generated.&n; * This means recovery from netif_stop_queue only happens in the hw timer&n; * interrupt (1/2 second on nForce2, 1/100 second on nForce3), or if an&n; * rx packet arrives by chance.&n; */
DECL|macro|FORCEDETH_VERSION
mdefine_line|#define FORCEDETH_VERSION&t;&t;&quot;0.19&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#if 0
mdefine_line|#define dprintk&t;&t;&t;printk
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(x...)&t;&t;do { } while (0)
macro_line|#endif
multiline_comment|/*&n; * Hardware access:&n; */
DECL|macro|DEV_NEED_LASTPACKET1
mdefine_line|#define DEV_NEED_LASTPACKET1&t;0x0001
DECL|macro|DEV_IRQMASK_1
mdefine_line|#define DEV_IRQMASK_1&t;&t;0x0002
DECL|macro|DEV_IRQMASK_2
mdefine_line|#define DEV_IRQMASK_2&t;&t;0x0004
r_enum
(brace
DECL|enumerator|NvRegIrqStatus
id|NvRegIrqStatus
op_assign
l_int|0x000
comma
DECL|macro|NVREG_IRQSTAT_MIIEVENT
mdefine_line|#define NVREG_IRQSTAT_MIIEVENT&t;0x040
DECL|macro|NVREG_IRQSTAT_MASK
mdefine_line|#define NVREG_IRQSTAT_MASK&t;&t;0x1ff
DECL|enumerator|NvRegIrqMask
id|NvRegIrqMask
op_assign
l_int|0x004
comma
DECL|macro|NVREG_IRQ_RX
mdefine_line|#define NVREG_IRQ_RX&t;&t;&t;0x0002
DECL|macro|NVREG_IRQ_RX_NOBUF
mdefine_line|#define NVREG_IRQ_RX_NOBUF&t;&t;0x0004
DECL|macro|NVREG_IRQ_TX_ERR
mdefine_line|#define NVREG_IRQ_TX_ERR&t;&t;0x0008
DECL|macro|NVREG_IRQ_TX2
mdefine_line|#define NVREG_IRQ_TX2&t;&t;&t;0x0010
DECL|macro|NVREG_IRQ_TIMER
mdefine_line|#define NVREG_IRQ_TIMER&t;&t;&t;0x0020
DECL|macro|NVREG_IRQ_LINK
mdefine_line|#define NVREG_IRQ_LINK&t;&t;&t;0x0040
DECL|macro|NVREG_IRQ_TX1
mdefine_line|#define NVREG_IRQ_TX1&t;&t;&t;0x0100
DECL|macro|NVREG_IRQMASK_WANTED_1
mdefine_line|#define NVREG_IRQMASK_WANTED_1&t;&t;0x005f
DECL|macro|NVREG_IRQMASK_WANTED_2
mdefine_line|#define NVREG_IRQMASK_WANTED_2&t;&t;0x0147
DECL|macro|NVREG_IRQ_UNKNOWN
mdefine_line|#define NVREG_IRQ_UNKNOWN&t;&t;(~(NVREG_IRQ_RX|NVREG_IRQ_RX_NOBUF|NVREG_IRQ_TX_ERR|NVREG_IRQ_TX2|NVREG_IRQ_TIMER|NVREG_IRQ_LINK|NVREG_IRQ_TX1))
DECL|enumerator|NvRegUnknownSetupReg6
id|NvRegUnknownSetupReg6
op_assign
l_int|0x008
comma
DECL|macro|NVREG_UNKSETUP6_VAL
mdefine_line|#define NVREG_UNKSETUP6_VAL&t;&t;3
DECL|enumerator|NvRegPollingInterval
id|NvRegPollingInterval
op_assign
l_int|0x00c
comma
DECL|enumerator|NvRegMisc1
id|NvRegMisc1
op_assign
l_int|0x080
comma
DECL|macro|NVREG_MISC1_HD
mdefine_line|#define NVREG_MISC1_HD&t;&t;0x02
DECL|macro|NVREG_MISC1_FORCE
mdefine_line|#define NVREG_MISC1_FORCE&t;0x3b0f3c
DECL|enumerator|NvRegTransmitterControl
id|NvRegTransmitterControl
op_assign
l_int|0x084
comma
DECL|macro|NVREG_XMITCTL_START
mdefine_line|#define NVREG_XMITCTL_START&t;0x01
DECL|enumerator|NvRegTransmitterStatus
id|NvRegTransmitterStatus
op_assign
l_int|0x088
comma
DECL|macro|NVREG_XMITSTAT_BUSY
mdefine_line|#define NVREG_XMITSTAT_BUSY&t;0x01
DECL|enumerator|NvRegPacketFilterFlags
id|NvRegPacketFilterFlags
op_assign
l_int|0x8c
comma
DECL|macro|NVREG_PFF_ALWAYS
mdefine_line|#define NVREG_PFF_ALWAYS&t;0x7F0008
DECL|macro|NVREG_PFF_PROMISC
mdefine_line|#define NVREG_PFF_PROMISC&t;0x80
DECL|macro|NVREG_PFF_MYADDR
mdefine_line|#define NVREG_PFF_MYADDR&t;0x20
DECL|enumerator|NvRegOffloadConfig
id|NvRegOffloadConfig
op_assign
l_int|0x90
comma
DECL|macro|NVREG_OFFLOAD_HOMEPHY
mdefine_line|#define NVREG_OFFLOAD_HOMEPHY&t;0x601
DECL|macro|NVREG_OFFLOAD_NORMAL
mdefine_line|#define NVREG_OFFLOAD_NORMAL&t;0x5ee
DECL|enumerator|NvRegReceiverControl
id|NvRegReceiverControl
op_assign
l_int|0x094
comma
DECL|macro|NVREG_RCVCTL_START
mdefine_line|#define NVREG_RCVCTL_START&t;0x01
DECL|enumerator|NvRegReceiverStatus
id|NvRegReceiverStatus
op_assign
l_int|0x98
comma
DECL|macro|NVREG_RCVSTAT_BUSY
mdefine_line|#define NVREG_RCVSTAT_BUSY&t;0x01
DECL|enumerator|NvRegRandomSeed
id|NvRegRandomSeed
op_assign
l_int|0x9c
comma
DECL|macro|NVREG_RNDSEED_MASK
mdefine_line|#define NVREG_RNDSEED_MASK&t;0x00ff
DECL|macro|NVREG_RNDSEED_FORCE
mdefine_line|#define NVREG_RNDSEED_FORCE&t;0x7f00
DECL|enumerator|NvRegUnknownSetupReg1
id|NvRegUnknownSetupReg1
op_assign
l_int|0xA0
comma
DECL|macro|NVREG_UNKSETUP1_VAL
mdefine_line|#define NVREG_UNKSETUP1_VAL&t;0x16070f
DECL|enumerator|NvRegUnknownSetupReg2
id|NvRegUnknownSetupReg2
op_assign
l_int|0xA4
comma
DECL|macro|NVREG_UNKSETUP2_VAL
mdefine_line|#define NVREG_UNKSETUP2_VAL&t;0x16
DECL|enumerator|NvRegMacAddrA
id|NvRegMacAddrA
op_assign
l_int|0xA8
comma
DECL|enumerator|NvRegMacAddrB
id|NvRegMacAddrB
op_assign
l_int|0xAC
comma
DECL|enumerator|NvRegMulticastAddrA
id|NvRegMulticastAddrA
op_assign
l_int|0xB0
comma
DECL|macro|NVREG_MCASTADDRA_FORCE
mdefine_line|#define NVREG_MCASTADDRA_FORCE&t;0x01
DECL|enumerator|NvRegMulticastAddrB
id|NvRegMulticastAddrB
op_assign
l_int|0xB4
comma
DECL|enumerator|NvRegMulticastMaskA
id|NvRegMulticastMaskA
op_assign
l_int|0xB8
comma
DECL|enumerator|NvRegMulticastMaskB
id|NvRegMulticastMaskB
op_assign
l_int|0xBC
comma
DECL|enumerator|NvRegTxRingPhysAddr
id|NvRegTxRingPhysAddr
op_assign
l_int|0x100
comma
DECL|enumerator|NvRegRxRingPhysAddr
id|NvRegRxRingPhysAddr
op_assign
l_int|0x104
comma
DECL|enumerator|NvRegRingSizes
id|NvRegRingSizes
op_assign
l_int|0x108
comma
DECL|macro|NVREG_RINGSZ_TXSHIFT
mdefine_line|#define NVREG_RINGSZ_TXSHIFT 0
DECL|macro|NVREG_RINGSZ_RXSHIFT
mdefine_line|#define NVREG_RINGSZ_RXSHIFT 16
DECL|enumerator|NvRegUnknownTransmitterReg
id|NvRegUnknownTransmitterReg
op_assign
l_int|0x10c
comma
DECL|enumerator|NvRegLinkSpeed
id|NvRegLinkSpeed
op_assign
l_int|0x110
comma
DECL|macro|NVREG_LINKSPEED_FORCE
mdefine_line|#define NVREG_LINKSPEED_FORCE 0x10000
DECL|macro|NVREG_LINKSPEED_10
mdefine_line|#define NVREG_LINKSPEED_10&t;10
DECL|macro|NVREG_LINKSPEED_100
mdefine_line|#define NVREG_LINKSPEED_100&t;100
DECL|macro|NVREG_LINKSPEED_1000
mdefine_line|#define NVREG_LINKSPEED_1000&t;1000
DECL|enumerator|NvRegUnknownSetupReg5
id|NvRegUnknownSetupReg5
op_assign
l_int|0x130
comma
DECL|macro|NVREG_UNKSETUP5_BIT31
mdefine_line|#define NVREG_UNKSETUP5_BIT31&t;(1&lt;&lt;31)
DECL|enumerator|NvRegUnknownSetupReg3
id|NvRegUnknownSetupReg3
op_assign
l_int|0x134
comma
DECL|macro|NVREG_UNKSETUP3_VAL1
mdefine_line|#define NVREG_UNKSETUP3_VAL1&t;0x200010
DECL|enumerator|NvRegTxRxControl
id|NvRegTxRxControl
op_assign
l_int|0x144
comma
DECL|macro|NVREG_TXRXCTL_KICK
mdefine_line|#define NVREG_TXRXCTL_KICK&t;0x0001
DECL|macro|NVREG_TXRXCTL_BIT1
mdefine_line|#define NVREG_TXRXCTL_BIT1&t;0x0002
DECL|macro|NVREG_TXRXCTL_BIT2
mdefine_line|#define NVREG_TXRXCTL_BIT2&t;0x0004
DECL|macro|NVREG_TXRXCTL_IDLE
mdefine_line|#define NVREG_TXRXCTL_IDLE&t;0x0008
DECL|macro|NVREG_TXRXCTL_RESET
mdefine_line|#define NVREG_TXRXCTL_RESET&t;0x0010
DECL|enumerator|NvRegMIIStatus
id|NvRegMIIStatus
op_assign
l_int|0x180
comma
DECL|macro|NVREG_MIISTAT_ERROR
mdefine_line|#define NVREG_MIISTAT_ERROR&t;&t;0x0001
DECL|macro|NVREG_MIISTAT_LINKCHANGE
mdefine_line|#define NVREG_MIISTAT_LINKCHANGE&t;0x0008
DECL|macro|NVREG_MIISTAT_MASK
mdefine_line|#define NVREG_MIISTAT_MASK&t;&t;0x000f
DECL|macro|NVREG_MIISTAT_MASK2
mdefine_line|#define NVREG_MIISTAT_MASK2&t;&t;0x000f
DECL|enumerator|NvRegUnknownSetupReg4
id|NvRegUnknownSetupReg4
op_assign
l_int|0x184
comma
DECL|macro|NVREG_UNKSETUP4_VAL
mdefine_line|#define NVREG_UNKSETUP4_VAL&t;8
DECL|enumerator|NvRegAdapterControl
id|NvRegAdapterControl
op_assign
l_int|0x188
comma
DECL|macro|NVREG_ADAPTCTL_START
mdefine_line|#define NVREG_ADAPTCTL_START&t;0x02
DECL|macro|NVREG_ADAPTCTL_LINKUP
mdefine_line|#define NVREG_ADAPTCTL_LINKUP&t;0x04
DECL|macro|NVREG_ADAPTCTL_PHYVALID
mdefine_line|#define NVREG_ADAPTCTL_PHYVALID&t;0x4000
DECL|macro|NVREG_ADAPTCTL_RUNNING
mdefine_line|#define NVREG_ADAPTCTL_RUNNING&t;0x100000
DECL|macro|NVREG_ADAPTCTL_PHYSHIFT
mdefine_line|#define NVREG_ADAPTCTL_PHYSHIFT&t;24
DECL|enumerator|NvRegMIISpeed
id|NvRegMIISpeed
op_assign
l_int|0x18c
comma
DECL|macro|NVREG_MIISPEED_BIT8
mdefine_line|#define NVREG_MIISPEED_BIT8&t;(1&lt;&lt;8)
DECL|macro|NVREG_MIIDELAY
mdefine_line|#define NVREG_MIIDELAY&t;5
DECL|enumerator|NvRegMIIControl
id|NvRegMIIControl
op_assign
l_int|0x190
comma
DECL|macro|NVREG_MIICTL_INUSE
mdefine_line|#define NVREG_MIICTL_INUSE&t;0x10000
DECL|macro|NVREG_MIICTL_WRITE
mdefine_line|#define NVREG_MIICTL_WRITE&t;0x08000
DECL|macro|NVREG_MIICTL_ADDRSHIFT
mdefine_line|#define NVREG_MIICTL_ADDRSHIFT&t;5
DECL|enumerator|NvRegMIIData
id|NvRegMIIData
op_assign
l_int|0x194
comma
DECL|enumerator|NvRegWakeUpFlags
id|NvRegWakeUpFlags
op_assign
l_int|0x200
comma
DECL|macro|NVREG_WAKEUPFLAGS_VAL
mdefine_line|#define NVREG_WAKEUPFLAGS_VAL&t;&t;0x7770
DECL|macro|NVREG_WAKEUPFLAGS_BUSYSHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_BUSYSHIFT&t;24
DECL|macro|NVREG_WAKEUPFLAGS_ENABLESHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_ENABLESHIFT&t;16
DECL|macro|NVREG_WAKEUPFLAGS_D3SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D3SHIFT&t;12
DECL|macro|NVREG_WAKEUPFLAGS_D2SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D2SHIFT&t;8
DECL|macro|NVREG_WAKEUPFLAGS_D1SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D1SHIFT&t;4
DECL|macro|NVREG_WAKEUPFLAGS_D0SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D0SHIFT&t;0
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_MAGPAT
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_MAGPAT&t;&t;0x01
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_WAKEUPPAT
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_WAKEUPPAT&t;0x02
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_LINKCHANGE
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_LINKCHANGE&t;0x04
DECL|enumerator|NvRegPatternCRC
id|NvRegPatternCRC
op_assign
l_int|0x204
comma
DECL|enumerator|NvRegPatternMask
id|NvRegPatternMask
op_assign
l_int|0x208
comma
DECL|enumerator|NvRegPowerCap
id|NvRegPowerCap
op_assign
l_int|0x268
comma
DECL|macro|NVREG_POWERCAP_D3SUPP
mdefine_line|#define NVREG_POWERCAP_D3SUPP&t;(1&lt;&lt;30)
DECL|macro|NVREG_POWERCAP_D2SUPP
mdefine_line|#define NVREG_POWERCAP_D2SUPP&t;(1&lt;&lt;26)
DECL|macro|NVREG_POWERCAP_D1SUPP
mdefine_line|#define NVREG_POWERCAP_D1SUPP&t;(1&lt;&lt;25)
DECL|enumerator|NvRegPowerState
id|NvRegPowerState
op_assign
l_int|0x26c
comma
DECL|macro|NVREG_POWERSTATE_POWEREDUP
mdefine_line|#define NVREG_POWERSTATE_POWEREDUP&t;0x8000
DECL|macro|NVREG_POWERSTATE_VALID
mdefine_line|#define NVREG_POWERSTATE_VALID&t;&t;0x0100
DECL|macro|NVREG_POWERSTATE_MASK
mdefine_line|#define NVREG_POWERSTATE_MASK&t;&t;0x0003
DECL|macro|NVREG_POWERSTATE_D0
mdefine_line|#define NVREG_POWERSTATE_D0&t;&t;0x0000
DECL|macro|NVREG_POWERSTATE_D1
mdefine_line|#define NVREG_POWERSTATE_D1&t;&t;0x0001
DECL|macro|NVREG_POWERSTATE_D2
mdefine_line|#define NVREG_POWERSTATE_D2&t;&t;0x0002
DECL|macro|NVREG_POWERSTATE_D3
mdefine_line|#define NVREG_POWERSTATE_D3&t;&t;0x0003
)brace
suffix:semicolon
DECL|struct|ring_desc
r_struct
id|ring_desc
(brace
DECL|member|PacketBuffer
id|u32
id|PacketBuffer
suffix:semicolon
DECL|member|Length
id|u16
id|Length
suffix:semicolon
DECL|member|Flags
id|u16
id|Flags
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|NV_TX_LASTPACKET
mdefine_line|#define NV_TX_LASTPACKET&t;(1&lt;&lt;0)
DECL|macro|NV_TX_RETRYERROR
mdefine_line|#define NV_TX_RETRYERROR&t;(1&lt;&lt;3)
DECL|macro|NV_TX_LASTPACKET1
mdefine_line|#define NV_TX_LASTPACKET1&t;(1&lt;&lt;8)
DECL|macro|NV_TX_DEFERRED
mdefine_line|#define NV_TX_DEFERRED&t;&t;(1&lt;&lt;10)
DECL|macro|NV_TX_CARRIERLOST
mdefine_line|#define NV_TX_CARRIERLOST&t;(1&lt;&lt;11)
DECL|macro|NV_TX_LATECOLLISION
mdefine_line|#define NV_TX_LATECOLLISION&t;(1&lt;&lt;12)
DECL|macro|NV_TX_UNDERFLOW
mdefine_line|#define NV_TX_UNDERFLOW&t;&t;(1&lt;&lt;13)
DECL|macro|NV_TX_ERROR
mdefine_line|#define NV_TX_ERROR&t;&t;(1&lt;&lt;14)
DECL|macro|NV_TX_VALID
mdefine_line|#define NV_TX_VALID&t;&t;(1&lt;&lt;15)
DECL|macro|NV_RX_DESCRIPTORVALID
mdefine_line|#define NV_RX_DESCRIPTORVALID&t;(1&lt;&lt;0)
DECL|macro|NV_RX_MISSEDFRAME
mdefine_line|#define NV_RX_MISSEDFRAME&t;(1&lt;&lt;1)
DECL|macro|NV_RX_SUBSTRACT1
mdefine_line|#define NV_RX_SUBSTRACT1&t;(1&lt;&lt;3)
DECL|macro|NV_RX_ERROR1
mdefine_line|#define NV_RX_ERROR1&t;&t;(1&lt;&lt;7)
DECL|macro|NV_RX_ERROR2
mdefine_line|#define NV_RX_ERROR2&t;&t;(1&lt;&lt;8)
DECL|macro|NV_RX_ERROR3
mdefine_line|#define NV_RX_ERROR3&t;&t;(1&lt;&lt;9)
DECL|macro|NV_RX_ERROR4
mdefine_line|#define NV_RX_ERROR4&t;&t;(1&lt;&lt;10)
DECL|macro|NV_RX_CRCERR
mdefine_line|#define NV_RX_CRCERR&t;&t;(1&lt;&lt;11)
DECL|macro|NV_RX_OVERFLOW
mdefine_line|#define NV_RX_OVERFLOW&t;&t;(1&lt;&lt;12)
DECL|macro|NV_RX_FRAMINGERR
mdefine_line|#define NV_RX_FRAMINGERR&t;(1&lt;&lt;13)
DECL|macro|NV_RX_ERROR
mdefine_line|#define NV_RX_ERROR&t;&t;(1&lt;&lt;14)
DECL|macro|NV_RX_AVAIL
mdefine_line|#define NV_RX_AVAIL&t;&t;(1&lt;&lt;15)
multiline_comment|/* Miscelaneous hardware related defines: */
DECL|macro|NV_PCI_REGSZ
mdefine_line|#define NV_PCI_REGSZ&t;&t;0x270
multiline_comment|/* various timeout delays: all in usec */
DECL|macro|NV_TXRX_RESET_DELAY
mdefine_line|#define NV_TXRX_RESET_DELAY&t;4
DECL|macro|NV_TXSTOP_DELAY1
mdefine_line|#define NV_TXSTOP_DELAY1&t;10
DECL|macro|NV_TXSTOP_DELAY1MAX
mdefine_line|#define NV_TXSTOP_DELAY1MAX&t;500000
DECL|macro|NV_TXSTOP_DELAY2
mdefine_line|#define NV_TXSTOP_DELAY2&t;100
DECL|macro|NV_RXSTOP_DELAY1
mdefine_line|#define NV_RXSTOP_DELAY1&t;10
DECL|macro|NV_RXSTOP_DELAY1MAX
mdefine_line|#define NV_RXSTOP_DELAY1MAX&t;500000
DECL|macro|NV_RXSTOP_DELAY2
mdefine_line|#define NV_RXSTOP_DELAY2&t;100
DECL|macro|NV_SETUP5_DELAY
mdefine_line|#define NV_SETUP5_DELAY&t;&t;5
DECL|macro|NV_SETUP5_DELAYMAX
mdefine_line|#define NV_SETUP5_DELAYMAX&t;50000
DECL|macro|NV_POWERUP_DELAY
mdefine_line|#define NV_POWERUP_DELAY&t;5
DECL|macro|NV_POWERUP_DELAYMAX
mdefine_line|#define NV_POWERUP_DELAYMAX&t;5000
DECL|macro|NV_MIIBUSY_DELAY
mdefine_line|#define NV_MIIBUSY_DELAY&t;50
DECL|macro|NV_MIIPHY_DELAY
mdefine_line|#define NV_MIIPHY_DELAY&t;10
DECL|macro|NV_MIIPHY_DELAYMAX
mdefine_line|#define NV_MIIPHY_DELAYMAX&t;10000
DECL|macro|NV_WAKEUPPATTERNS
mdefine_line|#define NV_WAKEUPPATTERNS&t;5
DECL|macro|NV_WAKEUPMASKENTRIES
mdefine_line|#define NV_WAKEUPMASKENTRIES&t;4
multiline_comment|/* General driver defaults */
DECL|macro|NV_WATCHDOG_TIMEO
mdefine_line|#define NV_WATCHDOG_TIMEO&t;(2*HZ)
DECL|macro|DEFAULT_MTU
mdefine_line|#define DEFAULT_MTU&t;&t;1500&t;/* also maximum supported, at least for now */
DECL|macro|RX_RING
mdefine_line|#define RX_RING&t;&t;128
DECL|macro|TX_RING
mdefine_line|#define TX_RING&t;&t;16
multiline_comment|/* limited to 1 packet until we understand NV_TX_LASTPACKET */
DECL|macro|TX_LIMIT_STOP
mdefine_line|#define TX_LIMIT_STOP&t;10
DECL|macro|TX_LIMIT_START
mdefine_line|#define TX_LIMIT_START&t;5
multiline_comment|/* rx/tx mac addr + type + vlan + align + slack*/
DECL|macro|RX_NIC_BUFSIZE
mdefine_line|#define RX_NIC_BUFSIZE&t;&t;(DEFAULT_MTU + 64)
multiline_comment|/* even more slack */
DECL|macro|RX_ALLOC_BUFSIZE
mdefine_line|#define RX_ALLOC_BUFSIZE&t;(DEFAULT_MTU + 128)
DECL|macro|OOM_REFILL
mdefine_line|#define OOM_REFILL&t;(1+HZ/20)
DECL|macro|POLL_WAIT
mdefine_line|#define POLL_WAIT&t;(1+HZ/100)
multiline_comment|/*&n; * SMP locking:&n; * All hardware access under dev-&gt;priv-&gt;lock, except the performance&n; * critical parts:&n; * - rx is (pseudo-) lockless: it relies on the single-threading provided&n; * &t;by the arch code for interrupts.&n; * - tx setup is lockless: it relies on dev-&gt;xmit_lock. Actual submission&n; *&t;needs dev-&gt;priv-&gt;lock :-(&n; * - set_multicast_list: preparation lockless, relies on dev-&gt;xmit_lock.&n; */
multiline_comment|/* in dev: base, irq */
DECL|struct|fe_priv
r_struct
id|fe_priv
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* General data:&n;&t; * Locking: spin_lock(&amp;np-&gt;lock); */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|in_shutdown
r_int
id|in_shutdown
suffix:semicolon
DECL|member|linkspeed
id|u32
id|linkspeed
suffix:semicolon
DECL|member|duplex
r_int
id|duplex
suffix:semicolon
DECL|member|phyaddr
r_int
id|phyaddr
suffix:semicolon
multiline_comment|/* General data: RO fields */
DECL|member|ring_addr
id|dma_addr_t
id|ring_addr
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|orig_mac
id|u32
id|orig_mac
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|irqmask
id|u32
id|irqmask
suffix:semicolon
multiline_comment|/* rx specific fields.&n;&t; * Locking: Within irq hander or disable_irq+spin_lock(&amp;np-&gt;lock);&n;&t; */
DECL|member|rx_ring
r_struct
id|ring_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|cur_rx
DECL|member|refill_rx
r_int
r_int
id|cur_rx
comma
id|refill_rx
suffix:semicolon
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING
)braket
suffix:semicolon
DECL|member|rx_dma
id|dma_addr_t
id|rx_dma
(braket
id|RX_RING
)braket
suffix:semicolon
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
DECL|member|oom_kick
r_struct
id|timer_list
id|oom_kick
suffix:semicolon
DECL|member|nic_poll
r_struct
id|timer_list
id|nic_poll
suffix:semicolon
multiline_comment|/*&n;&t; * tx specific fields.&n;&t; */
DECL|member|tx_ring
r_struct
id|ring_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|next_tx
DECL|member|nic_tx
r_int
r_int
id|next_tx
comma
id|nic_tx
suffix:semicolon
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING
)braket
suffix:semicolon
DECL|member|tx_dma
id|dma_addr_t
id|tx_dma
(braket
id|TX_RING
)braket
suffix:semicolon
DECL|member|tx_flags
id|u16
id|tx_flags
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Maximum number of loops until we assume that a bit in the irq mask&n; * is stuck. Overridable with module param.&n; */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|5
suffix:semicolon
DECL|function|get_nvpriv
r_static
r_inline
r_struct
id|fe_priv
op_star
id|get_nvpriv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
(paren
r_struct
id|fe_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
)brace
DECL|function|get_hwbase
r_static
r_inline
id|u8
op_star
id|get_hwbase
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
(paren
id|u8
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
)brace
DECL|function|pci_push
r_static
r_inline
r_void
id|pci_push
c_func
(paren
id|u8
op_star
id|base
)paren
(brace
multiline_comment|/* force out pending posted writes */
id|readl
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|reg_delay
r_static
r_int
id|reg_delay
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|offset
comma
id|u32
id|mask
comma
id|u32
id|target
comma
r_int
id|delay
comma
r_int
id|delaymax
comma
r_const
r_char
op_star
id|msg
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
r_do
(brace
id|udelay
c_func
(paren
id|delay
)paren
suffix:semicolon
id|delaymax
op_sub_assign
id|delay
suffix:semicolon
r_if
c_cond
(paren
id|delaymax
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|msg
)paren
id|printk
c_func
(paren
id|msg
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|readl
c_func
(paren
id|base
op_plus
id|offset
)paren
op_amp
id|mask
)paren
op_ne
id|target
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|MII_READ
mdefine_line|#define MII_READ&t;(-1)
multiline_comment|/* mii_rw: read/write a register on the PHY.&n; *&n; * Caller must guarantee serialization&n; */
DECL|function|mii_rw
r_static
r_int
id|mii_rw
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|addr
comma
r_int
id|miireg
comma
r_int
id|value
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|was_running
suffix:semicolon
id|u32
id|reg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|was_running
op_assign
l_int|0
suffix:semicolon
id|reg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|NVREG_ADAPTCTL_RUNNING
)paren
(brace
id|was_running
op_assign
l_int|1
suffix:semicolon
id|writel
c_func
(paren
id|reg
op_amp
op_complement
id|NVREG_ADAPTCTL_RUNNING
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
)brace
id|reg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|NVREG_MIICTL_INUSE
)paren
(brace
id|writel
c_func
(paren
id|NVREG_MIICTL_INUSE
comma
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_MIIBUSY_DELAY
)paren
suffix:semicolon
)brace
id|reg
op_assign
id|NVREG_MIICTL_INUSE
op_or
(paren
id|addr
op_lshift
id|NVREG_MIICTL_ADDRSHIFT
)paren
op_or
id|miireg
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
id|MII_READ
)paren
(brace
id|writel
c_func
(paren
id|value
comma
id|base
op_plus
id|NvRegMIIData
)paren
suffix:semicolon
id|reg
op_or_assign
id|NVREG_MIICTL_WRITE
suffix:semicolon
)brace
id|writel
c_func
(paren
id|reg
comma
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegMIIControl
comma
id|NVREG_MIICTL_INUSE
comma
l_int|0
comma
id|NV_MIIPHY_DELAY
comma
id|NV_MIIPHY_DELAYMAX
comma
l_int|NULL
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw of reg %d at PHY %d timed out.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_ne
id|MII_READ
)paren
(brace
multiline_comment|/* it was a write operation - fewer failures are detectable */
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw wrote 0x%x to reg %d at PHY %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|value
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIStatus
)paren
op_amp
id|NVREG_MIISTAT_ERROR
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw of reg %d at PHY %d failed.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* FIXME: why is that required? */
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|retval
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIData
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw read from reg %d at PHY %d: 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
comma
id|retval
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|was_running
)paren
(brace
id|reg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
id|reg
op_or
id|NVREG_ADAPTCTL_RUNNING
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|start_rx
r_static
r_void
id|start_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: start_rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Already running? Stop it. */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegReceiverControl
)paren
op_amp
id|NVREG_RCVCTL_START
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|np-&gt;linkspeed
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_RCVCTL_START
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|stop_rx
r_static
r_void
id|stop_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: stop_rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegReceiverStatus
comma
id|NVREG_RCVSTAT_BUSY
comma
l_int|0
comma
id|NV_RXSTOP_DELAY1
comma
id|NV_RXSTOP_DELAY1MAX
comma
id|KERN_INFO
l_string|&quot;stop_rx: ReceiverStatus remained busy&quot;
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_RXSTOP_DELAY2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_void
id|start_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: start_tx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_XMITCTL_START
comma
id|base
op_plus
id|NvRegTransmitterControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|stop_tx
r_static
r_void
id|stop_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: stop_tx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegTransmitterControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegTransmitterStatus
comma
id|NVREG_XMITSTAT_BUSY
comma
l_int|0
comma
id|NV_TXSTOP_DELAY1
comma
id|NV_TXSTOP_DELAY1MAX
comma
id|KERN_INFO
l_string|&quot;stop_tx: TransmitterStatus remained busy&quot;
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_TXSTOP_DELAY2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownTransmitterReg
)paren
suffix:semicolon
)brace
DECL|function|txrx_reset
r_static
r_void
id|txrx_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: txrx_reset&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT2
op_or
id|NVREG_TXRXCTL_RESET
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_TXRX_RESET_DELAY
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT2
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * get_stats: dev-&gt;get_stats function&n; * Get latest stats value from the nic.&n; * Called with read_lock(&amp;dev_base_lock) held for read -&n; * only synchronized against unregister_netdevice.&n; */
DECL|function|get_stats
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* It seems that the nic always generates interrupts and doesn&squot;t&n;&t; * accumulate errors internally. Thus the current values in np-&gt;stats&n;&t; * are already up to date.&n;&t; */
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * nic_ioctl: dev-&gt;do_ioctl function&n; * Called with rtnl_lock held.&n; */
DECL|function|nic_ioctl
r_static
r_int
id|nic_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/*&n; * alloc_rx: fill rx ring entries.&n; * Return 1 if the allocations for the skbs failed and the&n; * rx engine is without Available descriptors&n; */
DECL|function|alloc_rx
r_static
r_int
id|alloc_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|refill_rx
op_assign
id|np-&gt;refill_rx
suffix:semicolon
r_while
c_loop
(paren
id|np-&gt;cur_rx
op_ne
id|refill_rx
)paren
(brace
r_int
id|nr
op_assign
id|refill_rx
op_mod
id|RX_RING
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_ALLOC_BUFSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
op_assign
id|skb
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
suffix:semicolon
)brace
id|np-&gt;rx_dma
(braket
id|nr
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|nr
)braket
dot
id|PacketBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_dma
(braket
id|nr
)braket
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|nr
)braket
dot
id|Length
op_assign
id|cpu_to_le16
c_func
(paren
id|RX_NIC_BUFSIZE
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|nr
)braket
dot
id|Flags
op_assign
id|cpu_to_le16
c_func
(paren
id|NV_RX_AVAIL
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: alloc_rx: Packet  %d marked as Available&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|refill_rx
)paren
suffix:semicolon
id|refill_rx
op_increment
suffix:semicolon
)brace
id|np-&gt;refill_rx
op_assign
id|refill_rx
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_rx
op_minus
id|refill_rx
op_eq
id|RX_RING
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|do_rx_refill
r_static
r_void
id|do_rx_refill
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alloc_rx
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
DECL|function|init_ring
r_static
r_int
id|init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np-&gt;next_tx
op_assign
id|np-&gt;nic_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|Flags
op_assign
l_int|0
suffix:semicolon
)brace
id|np-&gt;cur_rx
op_assign
id|RX_RING
suffix:semicolon
id|np-&gt;refill_rx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|Flags
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|alloc_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|drain_tx
r_static
r_void
id|drain_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|Flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_dma
(braket
id|i
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|drain_rx
r_static
r_void
id|drain_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|Flags
op_assign
l_int|0
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_dma
(braket
id|i
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|function|drain_ring
r_static
r_void
id|drain_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|drain_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|drain_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * start_xmit: dev-&gt;hard_start_xmit function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|start_xmit
r_static
r_int
id|start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|nr
op_assign
id|np-&gt;next_tx
op_mod
id|TX_RING
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|nr
)braket
op_assign
id|skb
suffix:semicolon
id|np-&gt;tx_dma
(braket
id|nr
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|nr
)braket
dot
id|PacketBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;tx_dma
(braket
id|nr
)braket
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|nr
)braket
dot
id|Length
op_assign
id|cpu_to_le16
c_func
(paren
id|skb-&gt;len
op_minus
l_int|1
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|nr
)braket
dot
id|Flags
op_assign
id|np-&gt;tx_flags
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: start_xmit: packet packet %d queued for transmission.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;next_tx
)paren
suffix:semicolon
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|64
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|j
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n%03x:&quot;
comma
id|j
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; %02x&quot;
comma
(paren
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;data
)paren
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|np-&gt;next_tx
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;next_tx
op_minus
id|np-&gt;nic_tx
op_ge
id|TX_LIMIT_STOP
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_KICK
comma
id|get_hwbase
c_func
(paren
id|dev
)paren
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * tx_done: check for completed packets, release the skbs.&n; *&n; * Caller must own np-&gt;lock.&n; */
DECL|function|tx_done
r_static
r_void
id|tx_done
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|np-&gt;nic_tx
OL
id|np-&gt;next_tx
)paren
(brace
r_struct
id|ring_desc
op_star
id|prd
suffix:semicolon
r_int
id|i
op_assign
id|np-&gt;nic_tx
op_mod
id|TX_RING
suffix:semicolon
id|prd
op_assign
op_amp
id|np-&gt;tx_ring
(braket
id|i
)braket
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx_done: looking at packet %d, Flags 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;nic_tx
comma
id|prd-&gt;Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_TX_VALID
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_TX_RETRYERROR
op_or
id|NV_TX_CARRIERLOST
op_or
id|NV_TX_LATECOLLISION
op_or
id|NV_TX_UNDERFLOW
op_or
id|NV_TX_ERROR
)paren
)paren
(brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_TX_UNDERFLOW
)paren
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_TX_CARRIERLOST
)paren
)paren
id|np-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.tx_bytes
op_add_assign
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_dma
(braket
id|i
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;nic_tx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;next_tx
op_minus
id|np-&gt;nic_tx
OL
id|TX_LIMIT_START
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * tx_timeout: dev-&gt;tx_timeout function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|tx_timeout
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Got tx_timeout. irq: %08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|base
op_plus
id|NvRegIrqStatus
)paren
op_amp
id|NVREG_IRQSTAT_MASK
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* 1) stop tx engine */
id|stop_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 2) check that the packets were not sent already: */
id|tx_done
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 3) if there are dead entries: clear everything */
r_if
c_cond
(paren
id|np-&gt;next_tx
op_ne
id|np-&gt;nic_tx
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx_timeout: dead entries!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|drain_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;next_tx
op_assign
id|np-&gt;nic_tx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|np-&gt;ring_addr
op_plus
id|RX_RING
op_star
r_sizeof
(paren
r_struct
id|ring_desc
)paren
)paren
comma
id|base
op_plus
id|NvRegTxRingPhysAddr
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* 4) restart tx engine */
id|start_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|rx_process
r_static
r_void
id|rx_process
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_struct
id|ring_desc
op_star
id|prd
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_rx
op_minus
id|np-&gt;refill_rx
op_ge
id|RX_RING
)paren
r_break
suffix:semicolon
multiline_comment|/* we scanned the whole ring - do not continue */
id|i
op_assign
id|np-&gt;cur_rx
op_mod
id|RX_RING
suffix:semicolon
id|prd
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|i
)braket
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx_process: looking at packet %d, Flags 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_rx
comma
id|prd-&gt;Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_AVAIL
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* still owned by hardware, */
multiline_comment|/*&n;&t;&t; * the packet is for us - immediately tear down the pci mapping, and&n;&t;&t; * prefetch the first cacheline of the packet.&n;&t;&t; */
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_dma
(braket
id|i
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|prefetch
c_func
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|data
)paren
suffix:semicolon
(brace
r_int
id|j
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Dumping packet (flags 0x%x).&quot;
comma
id|prd-&gt;Flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|64
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|j
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n%03x:&quot;
comma
id|j
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; %02x&quot;
comma
(paren
(paren
r_int
r_char
op_star
)paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|data
)paren
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* look at what we actually got: */
r_if
c_cond
(paren
op_logical_neg
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_DESCRIPTORVALID
)paren
)paren
)paren
r_goto
id|next_pkt
suffix:semicolon
id|len
op_assign
id|le16_to_cpu
c_func
(paren
id|prd-&gt;Length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_MISSEDFRAME
)paren
)paren
(brace
id|np-&gt;stats.rx_missed_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_ERROR1
op_or
id|NV_RX_ERROR2
op_or
id|NV_RX_ERROR3
op_or
id|NV_RX_ERROR4
)paren
)paren
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_CRCERR
)paren
)paren
(brace
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_OVERFLOW
)paren
)paren
(brace
id|np-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_ERROR
)paren
)paren
(brace
multiline_comment|/* framing errors are soft errors, the rest is fatal. */
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_FRAMINGERR
)paren
)paren
(brace
r_if
c_cond
(paren
id|prd-&gt;Flags
op_amp
id|cpu_to_le16
c_func
(paren
id|NV_RX_SUBSTRACT1
)paren
)paren
(brace
id|len
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
)brace
multiline_comment|/* got a valid packet - forward it to the network core */
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: rx_process: packet %d with %d bytes, proto %d accepted.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_rx
comma
id|len
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_add_assign
id|len
suffix:semicolon
id|next_pkt
suffix:colon
id|np-&gt;cur_rx
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * change_mtu: dev-&gt;change_mtu function&n; * Called with dev_base_lock held for read.&n; */
DECL|function|change_mtu
r_static
r_int
id|change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
id|new_mtu
OG
id|DEFAULT_MTU
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * change_mtu: dev-&gt;change_mtu function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|set_multicast
r_static
r_void
id|set_multicast
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|addr
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|mask
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|pff
suffix:semicolon
id|memset
c_func
(paren
id|addr
comma
l_int|0
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mask
comma
l_int|0
comma
r_sizeof
(paren
id|mask
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|pff
op_assign
id|NVREG_PFF_PROMISC
suffix:semicolon
)brace
r_else
(brace
id|pff
op_assign
id|NVREG_PFF_MYADDR
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
op_logical_or
id|dev-&gt;mc_list
)paren
(brace
id|u32
id|alwaysOff
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|alwaysOn
(braket
l_int|2
)braket
suffix:semicolon
id|alwaysOn
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_assign
id|alwaysOff
(braket
l_int|0
)braket
op_assign
id|alwaysOff
(braket
l_int|1
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
id|alwaysOn
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_assign
id|alwaysOff
(braket
l_int|0
)braket
op_assign
id|alwaysOff
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|walk
suffix:semicolon
id|walk
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_while
c_loop
(paren
id|walk
op_ne
l_int|NULL
)paren
(brace
id|u32
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|walk-&gt;dmi_addr
)paren
suffix:semicolon
id|b
op_assign
id|le16_to_cpu
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
(paren
op_amp
id|walk-&gt;dmi_addr
(braket
l_int|4
)braket
)paren
)paren
suffix:semicolon
id|alwaysOn
(braket
l_int|0
)braket
op_and_assign
id|a
suffix:semicolon
id|alwaysOff
(braket
l_int|0
)braket
op_and_assign
op_complement
id|a
suffix:semicolon
id|alwaysOn
(braket
l_int|1
)braket
op_and_assign
id|b
suffix:semicolon
id|alwaysOff
(braket
l_int|1
)braket
op_and_assign
op_complement
id|b
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
suffix:semicolon
)brace
)brace
id|addr
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|0
)braket
suffix:semicolon
id|addr
(braket
l_int|1
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
suffix:semicolon
id|mask
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|0
)braket
op_or
id|alwaysOff
(braket
l_int|0
)braket
suffix:semicolon
id|mask
(braket
l_int|1
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_or
id|alwaysOff
(braket
l_int|1
)braket
suffix:semicolon
)brace
)brace
id|addr
(braket
l_int|0
)braket
op_or_assign
id|NVREG_MCASTADDRA_FORCE
suffix:semicolon
id|pff
op_or_assign
id|NVREG_PFF_ALWAYS
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|addr
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|addr
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pff
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|update_linkspeed
r_static
r_int
id|update_linkspeed
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|adv
comma
id|lpa
comma
id|newls
comma
id|newdup
suffix:semicolon
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
id|lpa
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_LPA
comma
id|MII_READ
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: update_linkspeed: PHY advertises 0x%04x, lpa 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|adv
comma
id|lpa
)paren
suffix:semicolon
multiline_comment|/* FIXME: handle parallel detection properly, handle gigabit ethernet */
id|lpa
op_assign
id|lpa
op_amp
id|adv
suffix:semicolon
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_100FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_100HALF
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_10FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_10HALF
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: bad ability %04x - falling back to 10HD.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lpa
)paren
suffix:semicolon
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;duplex
op_ne
id|newdup
op_logical_or
id|np-&gt;linkspeed
op_ne
id|newls
)paren
(brace
id|np-&gt;duplex
op_assign
id|newdup
suffix:semicolon
id|np-&gt;linkspeed
op_assign
id|newls
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|link_irq
r_static
r_void
id|link_irq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|miistat
suffix:semicolon
r_int
id|miival
suffix:semicolon
id|miistat
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: link change notification, status 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miistat
)paren
suffix:semicolon
id|miival
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMSR
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|miival
op_amp
id|BMSR_ANEGCOMPLETE
)paren
(brace
id|update_linkspeed
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
id|stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link up.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|NVREG_MISC1_FORCE
op_or
(paren
id|np-&gt;duplex
ques
c_cond
l_int|0
suffix:colon
id|NVREG_MISC1_HD
)paren
comma
id|base
op_plus
id|NvRegMisc1
)paren
suffix:semicolon
id|start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|np-&gt;linkspeed
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
)brace
DECL|function|nic_irq
r_static
id|irqreturn_t
id|nic_irq
c_func
(paren
r_int
id|foo
comma
r_void
op_star
id|data
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|events
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nic_irq&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
id|events
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegIrqStatus
)paren
op_amp
id|NVREG_IRQSTAT_MASK
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: irq: %08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|events
op_amp
id|np-&gt;irqmask
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_TX1
op_or
id|NVREG_IRQ_TX2
op_or
id|NVREG_IRQ_TX_ERR
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|tx_done
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_RX
op_or
id|NVREG_IRQ_RX_NOBUF
)paren
)paren
(brace
id|rx_process
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|alloc_rx
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|events
op_amp
id|NVREG_IRQ_LINK
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|link_irq
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_TX_ERR
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: received irq with events 0x%x. Probably TX fail.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_UNKNOWN
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: received irq with unknown events 0x%x. Please report&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OG
id|max_interrupt_work
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* disable interrupts on the nic */
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;nic_poll
comma
id|jiffies
op_plus
id|POLL_WAIT
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: too many iterations (%d) in nic_irq.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nic_irq completed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|function|do_nic_poll
r_static
r_void
id|do_nic_poll
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * reenable interrupts on the nic, we have to do this before calling&n;&t; * nic_irq because that may decide to do otherwise&n;&t; */
id|writel
c_func
(paren
id|np-&gt;irqmask
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|nic_irq
c_func
(paren
(paren
r_int
)paren
l_int|0
comma
(paren
r_void
op_star
)paren
id|data
comma
(paren
r_struct
id|pt_regs
op_star
)paren
l_int|NULL
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
DECL|function|open
r_static
r_int
id|open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
comma
id|oom
comma
id|i
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;forcedeth: open&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* 1) erase previous misconfiguration */
multiline_comment|/* 4.1-1: stop adapter: ignored, 4.3 seems to be overkill */
id|writel
c_func
(paren
id|NVREG_MCASTADDRA_FORCE
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownTransmitterReg
)paren
suffix:semicolon
id|txrx_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownSetupReg6
)paren
suffix:semicolon
multiline_comment|/* 2) initialize descriptor rings */
id|np-&gt;in_shutdown
op_assign
l_int|0
suffix:semicolon
id|oom
op_assign
id|init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 3) set mac address */
(brace
id|u32
id|mac
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|0
)braket
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_lshift
l_int|0
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mac
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mac
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
)brace
multiline_comment|/* 4) continue setup */
id|np-&gt;linkspeed
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|np-&gt;duplex
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP3_VAL1
comma
id|base
op_plus
id|NvRegUnknownSetupReg3
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT1
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegUnknownSetupReg5
comma
id|NVREG_UNKSETUP5_BIT31
comma
id|NVREG_UNKSETUP5_BIT31
comma
id|NV_SETUP5_DELAY
comma
id|NV_SETUP5_DELAYMAX
comma
id|KERN_INFO
l_string|&quot;open: SetupReg5, Bit 31 remained off&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownSetupReg4
)paren
suffix:semicolon
multiline_comment|/* 5) Find a suitable PHY */
id|writel
c_func
(paren
id|NVREG_MIISPEED_BIT8
op_or
id|NVREG_MIIDELAY
comma
id|base
op_plus
id|NvRegMIISpeed
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|id1
comma
id|id2
suffix:semicolon
id|id1
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|i
comma
id|MII_PHYSID1
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id1
OL
l_int|0
)paren
r_continue
suffix:semicolon
id|id2
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|i
comma
id|MII_PHYSID2
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id2
OL
l_int|0
)paren
r_continue
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: open: Found PHY %04x:%04x at address %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|id1
comma
id|id2
comma
id|i
)paren
suffix:semicolon
id|np-&gt;phyaddr
op_assign
id|i
suffix:semicolon
id|update_linkspeed
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|32
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: open: failing due to lack of suitable PHY.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out_drain
suffix:semicolon
)brace
multiline_comment|/* 6) continue setup */
id|writel
c_func
(paren
id|NVREG_MISC1_FORCE
op_or
(paren
id|np-&gt;duplex
ques
c_cond
l_int|0
suffix:colon
id|NVREG_MISC1_HD
)paren
comma
id|base
op_plus
id|NvRegMisc1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegTransmitterStatus
)paren
comma
id|base
op_plus
id|NvRegTransmitterStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_PFF_ALWAYS
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_OFFLOAD_NORMAL
comma
id|base
op_plus
id|NvRegOffloadConfig
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegReceiverStatus
)paren
comma
id|base
op_plus
id|NvRegReceiverStatus
)paren
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|i
comma
r_sizeof
(paren
id|i
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_RNDSEED_FORCE
op_or
(paren
id|i
op_amp
id|NVREG_RNDSEED_MASK
)paren
comma
id|base
op_plus
id|NvRegRandomSeed
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP1_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP2_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg2
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP6_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg6
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|np-&gt;phyaddr
op_lshift
id|NVREG_ADAPTCTL_PHYSHIFT
)paren
op_or
id|NVREG_ADAPTCTL_PHYVALID
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP4_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg4
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_WAKEUPFLAGS_VAL
comma
id|base
op_plus
id|NvRegWakeUpFlags
)paren
suffix:semicolon
multiline_comment|/* 7) start packet processing */
id|writel
c_func
(paren
(paren
id|u32
)paren
id|np-&gt;ring_addr
comma
id|base
op_plus
id|NvRegRxRingPhysAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|np-&gt;ring_addr
op_plus
id|RX_RING
op_star
r_sizeof
(paren
r_struct
id|ring_desc
)paren
)paren
comma
id|base
op_plus
id|NvRegTxRingPhysAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
(paren
id|RX_RING
op_minus
l_int|1
)paren
op_lshift
id|NVREG_RINGSZ_RXSHIFT
)paren
op_plus
(paren
(paren
id|TX_RING
op_minus
l_int|1
)paren
op_lshift
id|NVREG_RINGSZ_TXSHIFT
)paren
comma
id|base
op_plus
id|NvRegRingSizes
)paren
suffix:semicolon
id|i
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
id|NVREG_POWERSTATE_POWEREDUP
)paren
op_eq
l_int|0
)paren
(brace
id|writel
c_func
(paren
id|NVREG_POWERSTATE_POWEREDUP
op_or
id|i
comma
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
)brace
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPowerState
)paren
op_or
id|NVREG_POWERSTATE_VALID
comma
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_ADAPTCTL_RUNNING
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK2
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|nic_irq
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out_drain
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;irqmask
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MCASTADDRA_FORCE
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_PFF_ALWAYS
op_or
id|NVREG_PFF_MYADDR
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|start_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|oom
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMSR
comma
id|MII_READ
)paren
op_amp
id|BMSR_ANEGCOMPLETE
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no link during initialization.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_drain
suffix:colon
id|drain_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|close
r_static
r_int
id|close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|np-&gt;in_shutdown
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;oom_kick
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;nic_poll
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|stop_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|drain_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* FIXME: power down nic */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|probe_nic
r_static
r_int
id|__devinit
id|probe_nic
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
id|u8
op_star
id|base
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|fe_priv
)paren
)paren
suffix:semicolon
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
id|np-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pci_dev-&gt;dev
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
)paren
suffix:semicolon
id|np-&gt;oom_kick.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;oom_kick.function
op_assign
op_amp
id|do_rx_refill
suffix:semicolon
multiline_comment|/* timer handler */
id|init_timer
c_func
(paren
op_amp
id|np-&gt;nic_poll
)paren
suffix:semicolon
id|np-&gt;nic_poll.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;nic_poll.function
op_assign
op_amp
id|do_nic_poll
suffix:semicolon
multiline_comment|/* timer handler */
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: pci_enable_dev failed (%d) for device %s&bslash;n&quot;
comma
id|err
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pci_dev
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out_disable
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEVICE_COUNT_RESOURCE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: resource %d start %p len %ld flags 0x%08lx.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|i
comma
(paren
r_void
op_star
)paren
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
id|i
)paren
comma
id|pci_resource_len
c_func
(paren
id|pci_dev
comma
id|i
)paren
comma
id|pci_resource_flags
c_func
(paren
id|pci_dev
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_resource_flags
c_func
(paren
id|pci_dev
comma
id|i
)paren
op_amp
id|IORESOURCE_MEM
op_logical_and
id|pci_resource_len
c_func
(paren
id|pci_dev
comma
id|i
)paren
op_ge
id|NV_PCI_REGSZ
)paren
(brace
id|addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|DEVICE_COUNT_RESOURCE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: Couldn&squot;t find register window for device %s.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_goto
id|out_relreg
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|addr
comma
id|NV_PCI_REGSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;base_addr
)paren
r_goto
id|out_disable
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|np-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
op_amp
id|np-&gt;ring_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;rx_ring
)paren
r_goto
id|out_unmap
suffix:semicolon
id|np-&gt;tx_ring
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|RX_RING
)braket
suffix:semicolon
id|dev-&gt;open
op_assign
id|open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|get_stats
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|change_mtu
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|set_multicast
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|nic_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|NV_WATCHDOG_TIMEO
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* read the mac address */
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_valid_ether_addr
c_func
(paren
id|dev-&gt;dev_addr
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Bad mac address. At least one bios sets the mac address&n;&t;&t; * to 01:23:45:67:89:ab&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Invalid Mac address detected: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Please complain to your hardware vendor. Switching to a random MAC.&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
l_int|0x6c
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
l_int|3
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MAC Address %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|np-&gt;tx_flags
op_assign
id|cpu_to_le16
c_func
(paren
id|NV_TX_LASTPACKET
op_or
id|NV_TX_LASTPACKET1
op_or
id|NV_TX_VALID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_NEED_LASTPACKET1
)paren
id|np-&gt;tx_flags
op_or_assign
id|cpu_to_le16
c_func
(paren
id|NV_TX_LASTPACKET1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_IRQMASK_1
)paren
id|np-&gt;irqmask
op_assign
id|NVREG_IRQMASK_WANTED_1
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_IRQMASK_2
)paren
id|np-&gt;irqmask
op_assign
id|NVREG_IRQMASK_WANTED_2
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: unable to register netdev: %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_goto
id|out_freering
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: forcedeth.c: subsystem: %05x:%04x bound to %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_dev-&gt;subsystem_vendor
comma
id|pci_dev-&gt;subsystem_device
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_freering
suffix:colon
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
id|np-&gt;rx_ring
comma
id|np-&gt;ring_addr
)paren
suffix:semicolon
id|out_unmap
suffix:colon
id|iounmap
c_func
(paren
id|get_hwbase
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|out_relreg
suffix:colon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|out_free
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|remove_nic
r_static
r_void
id|__devexit
id|remove_nic
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* special op: write back the misordered MAC address - otherwise&n;&t; * the next probe_nic would see a wrong address.&n;&t; */
id|writel
c_func
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
multiline_comment|/* free all structures */
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
id|np-&gt;rx_ring
comma
id|np-&gt;ring_addr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|get_hwbase
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|pci_tbl
r_static
r_struct
id|pci_device_id
id|pci_tbl
(braket
)braket
op_assign
(brace
(brace
multiline_comment|/* nForce Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
l_int|0x1C3
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_IRQMASK_1
comma
)brace
comma
(brace
multiline_comment|/* nForce2 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
l_int|0x0066
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
l_int|0x00D6
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
comma
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;forcedeth&quot;
comma
dot
id|id_table
op_assign
id|pci_tbl
comma
dot
id|probe
op_assign
id|probe_nic
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|remove_nic
)paren
comma
)brace
suffix:semicolon
DECL|function|init_nic
r_static
r_int
id|__init
id|init_nic
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth.c: Reverse Engineered nForce ethernet driver. Version %s.&bslash;n&quot;
comma
id|FORCEDETH_VERSION
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|exit_nic
r_static
r_void
id|__exit
id|exit_nic
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;forcedeth maximum events handled per interrupt&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Manfred Spraul &lt;manfred@colorfullife.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Reverse Engineered nForce ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|pci_tbl
)paren
suffix:semicolon
DECL|variable|init_nic
id|module_init
c_func
(paren
id|init_nic
)paren
suffix:semicolon
DECL|variable|exit_nic
id|module_exit
c_func
(paren
id|exit_nic
)paren
suffix:semicolon
eof
