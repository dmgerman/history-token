multiline_comment|/*&n; * forcedeth: Ethernet driver for NVIDIA nForce media access controllers.&n; *&n; * Note: This driver is a cleanroom reimplementation based on reverse&n; *      engineered documentation written by Carl-Daniel Hailfinger&n; *      and Andrew de Quincey. It&squot;s neither supported nor endorsed&n; *      by NVIDIA Corp. Use at your own risk.&n; *&n; * NVIDIA, nForce and other NVIDIA marks are trademarks or registered&n; * trademarks of NVIDIA Corporation in the United States and other&n; * countries.&n; *&n; * Copyright (C) 2003,4 Manfred Spraul&n; * Copyright (C) 2004 Andrew de Quincey (wol support)&n; * Copyright (C) 2004 Carl-Daniel Hailfinger (invalid MAC handling, insane&n; *&t;&t;IRQ rate fixes, bigendian fixes, cleanups, verification)&n; * Copyright (c) 2004 NVIDIA Corporation&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; * Changelog:&n; * &t;0.01: 05 Oct 2003: First release that compiles without warnings.&n; * &t;0.02: 05 Oct 2003: Fix bug for nv_drain_tx: do not try to free NULL skbs.&n; * &t;&t;&t;   Check all PCI BARs for the register window.&n; * &t;&t;&t;   udelay added to mii_rw.&n; * &t;0.03: 06 Oct 2003: Initialize dev-&gt;irq.&n; * &t;0.04: 07 Oct 2003: Initialize np-&gt;lock, reduce handled irqs, add printks.&n; * &t;0.05: 09 Oct 2003: printk removed again, irq status print tx_timeout.&n; * &t;0.06: 10 Oct 2003: MAC Address read updated, pff flag generation updated,&n; * &t;&t;&t;   irq mask updated&n; * &t;0.07: 14 Oct 2003: Further irq mask updates.&n; * &t;0.08: 20 Oct 2003: rx_desc.Length initialization added, nv_alloc_rx refill&n; * &t;&t;&t;   added into irq handler, NULL check for drain_ring.&n; * &t;0.09: 20 Oct 2003: Basic link speed irq implementation. Only handle the&n; * &t;&t;&t;   requested interrupt sources.&n; * &t;0.10: 20 Oct 2003: First cleanup for release.&n; * &t;0.11: 21 Oct 2003: hexdump for tx added, rx buffer sizes increased.&n; * &t;&t;&t;   MAC Address init fix, set_multicast cleanup.&n; * &t;0.12: 23 Oct 2003: Cleanups for release.&n; * &t;0.13: 25 Oct 2003: Limit for concurrent tx packets increased to 10.&n; * &t;&t;&t;   Set link speed correctly. start rx before starting&n; * &t;&t;&t;   tx (nv_start_rx sets the link speed).&n; * &t;0.14: 25 Oct 2003: Nic dependant irq mask.&n; * &t;0.15: 08 Nov 2003: fix smp deadlock with set_multicast_list during&n; * &t;&t;&t;   open.&n; * &t;0.16: 15 Nov 2003: include file cleanup for ppc64, rx buffer size&n; * &t;&t;&t;   increased to 1628 bytes.&n; * &t;0.17: 16 Nov 2003: undo rx buffer size increase. Substract 1 from&n; * &t;&t;&t;   the tx length.&n; * &t;0.18: 17 Nov 2003: fix oops due to late initialization of dev_stats&n; * &t;0.19: 29 Nov 2003: Handle RxNoBuf, detect &amp; handle invalid mac&n; * &t;&t;&t;   addresses, really stop rx if already running&n; * &t;&t;&t;   in nv_start_rx, clean up a bit.&n; * &t;0.20: 07 Dec 2003: alloc fixes&n; * &t;0.21: 12 Jan 2004: additional alloc fix, nic polling fix.&n; *&t;0.22: 19 Jan 2004: reprogram timer to a sane rate, avoid lockup&n; *&t;&t;&t;   on close.&n; *&t;0.23: 26 Jan 2004: various small cleanups&n; *&t;0.24: 27 Feb 2004: make driver even less anonymous in backtraces&n; *&t;0.25: 09 Mar 2004: wol support&n; *&t;0.26: 03 Jun 2004: netdriver specific annotation, sparse-related fixes&n; *&t;0.27: 19 Jun 2004: Gigabit support, new descriptor rings,&n; *&t;&t;&t;   added CK804/MCP04 device IDs, code fixes&n; *&t;&t;&t;   for registers, link status and other minor fixes.&n; *&t;0.28: 21 Jun 2004: Big cleanup, making driver mostly endian safe&n; *&t;0.29: 31 Aug 2004: Add backup timer for link change notification.&n; *&t;0.30: 25 Sep 2004: rx checksum support for nf 250 Gb. Add rx reset&n; *&t;&t;&t;   into nv_close, otherwise reenabling for wol can&n; *&t;&t;&t;   cause DMA to kfree&squot;d memory.&n; *&t;0.31: 14 Nov 2004: ethtool support for getting/setting link&n; *&t;                   capabilities.&n; *&n; * Known bugs:&n; * We suspect that on some hardware no TX done interrupts are generated.&n; * This means recovery from netif_stop_queue only happens if the hw timer&n; * interrupt fires (100 times/second, configurable with NVREG_POLL_DEFAULT)&n; * and the timer is active in the IRQMask, or if a rx packet arrives by chance.&n; * If your hardware reliably generates tx done interrupts, then you can remove&n; * DEV_NEED_TIMERIRQ from the driver_data flags.&n; * DEV_NEED_TIMERIRQ will not harm you on sane hardware, only generating a few&n; * superfluous timer interrupts from the nic.&n; */
DECL|macro|FORCEDETH_VERSION
mdefine_line|#define FORCEDETH_VERSION&t;&t;&quot;0.31&quot;
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&t;&t;&quot;forcedeth&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#if 0
mdefine_line|#define dprintk&t;&t;&t;printk
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(x...)&t;&t;do { } while (0)
macro_line|#endif
multiline_comment|/*&n; * Hardware access:&n; */
DECL|macro|DEV_NEED_LASTPACKET1
mdefine_line|#define DEV_NEED_LASTPACKET1&t;0x0001&t;/* set LASTPACKET1 in tx flags */
DECL|macro|DEV_IRQMASK_1
mdefine_line|#define DEV_IRQMASK_1&t;&t;0x0002  /* use NVREG_IRQMASK_WANTED_1 for irq mask */
DECL|macro|DEV_IRQMASK_2
mdefine_line|#define DEV_IRQMASK_2&t;&t;0x0004  /* use NVREG_IRQMASK_WANTED_2 for irq mask */
DECL|macro|DEV_NEED_TIMERIRQ
mdefine_line|#define DEV_NEED_TIMERIRQ&t;0x0008  /* set the timer irq flag in the irq mask */
DECL|macro|DEV_NEED_LINKTIMER
mdefine_line|#define DEV_NEED_LINKTIMER&t;0x0010&t;/* poll link settings. Relies on the timer irq */
r_enum
(brace
DECL|enumerator|NvRegIrqStatus
id|NvRegIrqStatus
op_assign
l_int|0x000
comma
DECL|macro|NVREG_IRQSTAT_MIIEVENT
mdefine_line|#define NVREG_IRQSTAT_MIIEVENT&t;0x040
DECL|macro|NVREG_IRQSTAT_MASK
mdefine_line|#define NVREG_IRQSTAT_MASK&t;&t;0x1ff
DECL|enumerator|NvRegIrqMask
id|NvRegIrqMask
op_assign
l_int|0x004
comma
DECL|macro|NVREG_IRQ_RX_ERROR
mdefine_line|#define NVREG_IRQ_RX_ERROR&t;&t;0x0001
DECL|macro|NVREG_IRQ_RX
mdefine_line|#define NVREG_IRQ_RX&t;&t;&t;0x0002
DECL|macro|NVREG_IRQ_RX_NOBUF
mdefine_line|#define NVREG_IRQ_RX_NOBUF&t;&t;0x0004
DECL|macro|NVREG_IRQ_TX_ERR
mdefine_line|#define NVREG_IRQ_TX_ERR&t;&t;0x0008
DECL|macro|NVREG_IRQ_TX2
mdefine_line|#define NVREG_IRQ_TX2&t;&t;&t;0x0010
DECL|macro|NVREG_IRQ_TIMER
mdefine_line|#define NVREG_IRQ_TIMER&t;&t;&t;0x0020
DECL|macro|NVREG_IRQ_LINK
mdefine_line|#define NVREG_IRQ_LINK&t;&t;&t;0x0040
DECL|macro|NVREG_IRQ_TX1
mdefine_line|#define NVREG_IRQ_TX1&t;&t;&t;0x0100
DECL|macro|NVREG_IRQMASK_WANTED_1
mdefine_line|#define NVREG_IRQMASK_WANTED_1&t;&t;0x005f
DECL|macro|NVREG_IRQMASK_WANTED_2
mdefine_line|#define NVREG_IRQMASK_WANTED_2&t;&t;0x0147
DECL|macro|NVREG_IRQ_UNKNOWN
mdefine_line|#define NVREG_IRQ_UNKNOWN&t;&t;(~(NVREG_IRQ_RX_ERROR|NVREG_IRQ_RX|NVREG_IRQ_RX_NOBUF|NVREG_IRQ_TX_ERR|NVREG_IRQ_TX2|NVREG_IRQ_TIMER|NVREG_IRQ_LINK|NVREG_IRQ_TX1))
DECL|enumerator|NvRegUnknownSetupReg6
id|NvRegUnknownSetupReg6
op_assign
l_int|0x008
comma
DECL|macro|NVREG_UNKSETUP6_VAL
mdefine_line|#define NVREG_UNKSETUP6_VAL&t;&t;3
multiline_comment|/*&n; * NVREG_POLL_DEFAULT is the interval length of the timer source on the nic&n; * NVREG_POLL_DEFAULT=97 would result in an interval length of 1 ms&n; */
DECL|enumerator|NvRegPollingInterval
id|NvRegPollingInterval
op_assign
l_int|0x00c
comma
DECL|macro|NVREG_POLL_DEFAULT
mdefine_line|#define NVREG_POLL_DEFAULT&t;970
DECL|enumerator|NvRegMisc1
id|NvRegMisc1
op_assign
l_int|0x080
comma
DECL|macro|NVREG_MISC1_HD
mdefine_line|#define NVREG_MISC1_HD&t;&t;0x02
DECL|macro|NVREG_MISC1_FORCE
mdefine_line|#define NVREG_MISC1_FORCE&t;0x3b0f3c
DECL|enumerator|NvRegTransmitterControl
id|NvRegTransmitterControl
op_assign
l_int|0x084
comma
DECL|macro|NVREG_XMITCTL_START
mdefine_line|#define NVREG_XMITCTL_START&t;0x01
DECL|enumerator|NvRegTransmitterStatus
id|NvRegTransmitterStatus
op_assign
l_int|0x088
comma
DECL|macro|NVREG_XMITSTAT_BUSY
mdefine_line|#define NVREG_XMITSTAT_BUSY&t;0x01
DECL|enumerator|NvRegPacketFilterFlags
id|NvRegPacketFilterFlags
op_assign
l_int|0x8c
comma
DECL|macro|NVREG_PFF_ALWAYS
mdefine_line|#define NVREG_PFF_ALWAYS&t;0x7F0008
DECL|macro|NVREG_PFF_PROMISC
mdefine_line|#define NVREG_PFF_PROMISC&t;0x80
DECL|macro|NVREG_PFF_MYADDR
mdefine_line|#define NVREG_PFF_MYADDR&t;0x20
DECL|enumerator|NvRegOffloadConfig
id|NvRegOffloadConfig
op_assign
l_int|0x90
comma
DECL|macro|NVREG_OFFLOAD_HOMEPHY
mdefine_line|#define NVREG_OFFLOAD_HOMEPHY&t;0x601
DECL|macro|NVREG_OFFLOAD_NORMAL
mdefine_line|#define NVREG_OFFLOAD_NORMAL&t;RX_NIC_BUFSIZE
DECL|enumerator|NvRegReceiverControl
id|NvRegReceiverControl
op_assign
l_int|0x094
comma
DECL|macro|NVREG_RCVCTL_START
mdefine_line|#define NVREG_RCVCTL_START&t;0x01
DECL|enumerator|NvRegReceiverStatus
id|NvRegReceiverStatus
op_assign
l_int|0x98
comma
DECL|macro|NVREG_RCVSTAT_BUSY
mdefine_line|#define NVREG_RCVSTAT_BUSY&t;0x01
DECL|enumerator|NvRegRandomSeed
id|NvRegRandomSeed
op_assign
l_int|0x9c
comma
DECL|macro|NVREG_RNDSEED_MASK
mdefine_line|#define NVREG_RNDSEED_MASK&t;0x00ff
DECL|macro|NVREG_RNDSEED_FORCE
mdefine_line|#define NVREG_RNDSEED_FORCE&t;0x7f00
DECL|macro|NVREG_RNDSEED_FORCE2
mdefine_line|#define NVREG_RNDSEED_FORCE2&t;0x2d00
DECL|macro|NVREG_RNDSEED_FORCE3
mdefine_line|#define NVREG_RNDSEED_FORCE3&t;0x7400
DECL|enumerator|NvRegUnknownSetupReg1
id|NvRegUnknownSetupReg1
op_assign
l_int|0xA0
comma
DECL|macro|NVREG_UNKSETUP1_VAL
mdefine_line|#define NVREG_UNKSETUP1_VAL&t;0x16070f
DECL|enumerator|NvRegUnknownSetupReg2
id|NvRegUnknownSetupReg2
op_assign
l_int|0xA4
comma
DECL|macro|NVREG_UNKSETUP2_VAL
mdefine_line|#define NVREG_UNKSETUP2_VAL&t;0x16
DECL|enumerator|NvRegMacAddrA
id|NvRegMacAddrA
op_assign
l_int|0xA8
comma
DECL|enumerator|NvRegMacAddrB
id|NvRegMacAddrB
op_assign
l_int|0xAC
comma
DECL|enumerator|NvRegMulticastAddrA
id|NvRegMulticastAddrA
op_assign
l_int|0xB0
comma
DECL|macro|NVREG_MCASTADDRA_FORCE
mdefine_line|#define NVREG_MCASTADDRA_FORCE&t;0x01
DECL|enumerator|NvRegMulticastAddrB
id|NvRegMulticastAddrB
op_assign
l_int|0xB4
comma
DECL|enumerator|NvRegMulticastMaskA
id|NvRegMulticastMaskA
op_assign
l_int|0xB8
comma
DECL|enumerator|NvRegMulticastMaskB
id|NvRegMulticastMaskB
op_assign
l_int|0xBC
comma
DECL|enumerator|NvRegPhyInterface
id|NvRegPhyInterface
op_assign
l_int|0xC0
comma
DECL|macro|PHY_RGMII
mdefine_line|#define PHY_RGMII&t;&t;0x10000000
DECL|enumerator|NvRegTxRingPhysAddr
id|NvRegTxRingPhysAddr
op_assign
l_int|0x100
comma
DECL|enumerator|NvRegRxRingPhysAddr
id|NvRegRxRingPhysAddr
op_assign
l_int|0x104
comma
DECL|enumerator|NvRegRingSizes
id|NvRegRingSizes
op_assign
l_int|0x108
comma
DECL|macro|NVREG_RINGSZ_TXSHIFT
mdefine_line|#define NVREG_RINGSZ_TXSHIFT 0
DECL|macro|NVREG_RINGSZ_RXSHIFT
mdefine_line|#define NVREG_RINGSZ_RXSHIFT 16
DECL|enumerator|NvRegUnknownTransmitterReg
id|NvRegUnknownTransmitterReg
op_assign
l_int|0x10c
comma
DECL|enumerator|NvRegLinkSpeed
id|NvRegLinkSpeed
op_assign
l_int|0x110
comma
DECL|macro|NVREG_LINKSPEED_FORCE
mdefine_line|#define NVREG_LINKSPEED_FORCE 0x10000
DECL|macro|NVREG_LINKSPEED_10
mdefine_line|#define NVREG_LINKSPEED_10&t;1000
DECL|macro|NVREG_LINKSPEED_100
mdefine_line|#define NVREG_LINKSPEED_100&t;100
DECL|macro|NVREG_LINKSPEED_1000
mdefine_line|#define NVREG_LINKSPEED_1000&t;50
DECL|macro|NVREG_LINKSPEED_MASK
mdefine_line|#define NVREG_LINKSPEED_MASK&t;(0xFFF)
DECL|enumerator|NvRegUnknownSetupReg5
id|NvRegUnknownSetupReg5
op_assign
l_int|0x130
comma
DECL|macro|NVREG_UNKSETUP5_BIT31
mdefine_line|#define NVREG_UNKSETUP5_BIT31&t;(1&lt;&lt;31)
DECL|enumerator|NvRegUnknownSetupReg3
id|NvRegUnknownSetupReg3
op_assign
l_int|0x13c
comma
DECL|macro|NVREG_UNKSETUP3_VAL1
mdefine_line|#define NVREG_UNKSETUP3_VAL1&t;0x200010
DECL|enumerator|NvRegTxRxControl
id|NvRegTxRxControl
op_assign
l_int|0x144
comma
DECL|macro|NVREG_TXRXCTL_KICK
mdefine_line|#define NVREG_TXRXCTL_KICK&t;0x0001
DECL|macro|NVREG_TXRXCTL_BIT1
mdefine_line|#define NVREG_TXRXCTL_BIT1&t;0x0002
DECL|macro|NVREG_TXRXCTL_BIT2
mdefine_line|#define NVREG_TXRXCTL_BIT2&t;0x0004
DECL|macro|NVREG_TXRXCTL_IDLE
mdefine_line|#define NVREG_TXRXCTL_IDLE&t;0x0008
DECL|macro|NVREG_TXRXCTL_RESET
mdefine_line|#define NVREG_TXRXCTL_RESET&t;0x0010
DECL|macro|NVREG_TXRXCTL_RXCHECK
mdefine_line|#define NVREG_TXRXCTL_RXCHECK&t;0x0400
DECL|enumerator|NvRegMIIStatus
id|NvRegMIIStatus
op_assign
l_int|0x180
comma
DECL|macro|NVREG_MIISTAT_ERROR
mdefine_line|#define NVREG_MIISTAT_ERROR&t;&t;0x0001
DECL|macro|NVREG_MIISTAT_LINKCHANGE
mdefine_line|#define NVREG_MIISTAT_LINKCHANGE&t;0x0008
DECL|macro|NVREG_MIISTAT_MASK
mdefine_line|#define NVREG_MIISTAT_MASK&t;&t;0x000f
DECL|macro|NVREG_MIISTAT_MASK2
mdefine_line|#define NVREG_MIISTAT_MASK2&t;&t;0x000f
DECL|enumerator|NvRegUnknownSetupReg4
id|NvRegUnknownSetupReg4
op_assign
l_int|0x184
comma
DECL|macro|NVREG_UNKSETUP4_VAL
mdefine_line|#define NVREG_UNKSETUP4_VAL&t;8
DECL|enumerator|NvRegAdapterControl
id|NvRegAdapterControl
op_assign
l_int|0x188
comma
DECL|macro|NVREG_ADAPTCTL_START
mdefine_line|#define NVREG_ADAPTCTL_START&t;0x02
DECL|macro|NVREG_ADAPTCTL_LINKUP
mdefine_line|#define NVREG_ADAPTCTL_LINKUP&t;0x04
DECL|macro|NVREG_ADAPTCTL_PHYVALID
mdefine_line|#define NVREG_ADAPTCTL_PHYVALID&t;0x40000
DECL|macro|NVREG_ADAPTCTL_RUNNING
mdefine_line|#define NVREG_ADAPTCTL_RUNNING&t;0x100000
DECL|macro|NVREG_ADAPTCTL_PHYSHIFT
mdefine_line|#define NVREG_ADAPTCTL_PHYSHIFT&t;24
DECL|enumerator|NvRegMIISpeed
id|NvRegMIISpeed
op_assign
l_int|0x18c
comma
DECL|macro|NVREG_MIISPEED_BIT8
mdefine_line|#define NVREG_MIISPEED_BIT8&t;(1&lt;&lt;8)
DECL|macro|NVREG_MIIDELAY
mdefine_line|#define NVREG_MIIDELAY&t;5
DECL|enumerator|NvRegMIIControl
id|NvRegMIIControl
op_assign
l_int|0x190
comma
DECL|macro|NVREG_MIICTL_INUSE
mdefine_line|#define NVREG_MIICTL_INUSE&t;0x08000
DECL|macro|NVREG_MIICTL_WRITE
mdefine_line|#define NVREG_MIICTL_WRITE&t;0x00400
DECL|macro|NVREG_MIICTL_ADDRSHIFT
mdefine_line|#define NVREG_MIICTL_ADDRSHIFT&t;5
DECL|enumerator|NvRegMIIData
id|NvRegMIIData
op_assign
l_int|0x194
comma
DECL|enumerator|NvRegWakeUpFlags
id|NvRegWakeUpFlags
op_assign
l_int|0x200
comma
DECL|macro|NVREG_WAKEUPFLAGS_VAL
mdefine_line|#define NVREG_WAKEUPFLAGS_VAL&t;&t;0x7770
DECL|macro|NVREG_WAKEUPFLAGS_BUSYSHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_BUSYSHIFT&t;24
DECL|macro|NVREG_WAKEUPFLAGS_ENABLESHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_ENABLESHIFT&t;16
DECL|macro|NVREG_WAKEUPFLAGS_D3SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D3SHIFT&t;12
DECL|macro|NVREG_WAKEUPFLAGS_D2SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D2SHIFT&t;8
DECL|macro|NVREG_WAKEUPFLAGS_D1SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D1SHIFT&t;4
DECL|macro|NVREG_WAKEUPFLAGS_D0SHIFT
mdefine_line|#define NVREG_WAKEUPFLAGS_D0SHIFT&t;0
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_MAGPAT
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_MAGPAT&t;&t;0x01
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_WAKEUPPAT
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_WAKEUPPAT&t;0x02
DECL|macro|NVREG_WAKEUPFLAGS_ACCEPT_LINKCHANGE
mdefine_line|#define NVREG_WAKEUPFLAGS_ACCEPT_LINKCHANGE&t;0x04
DECL|macro|NVREG_WAKEUPFLAGS_ENABLE
mdefine_line|#define NVREG_WAKEUPFLAGS_ENABLE&t;0x1111
DECL|enumerator|NvRegPatternCRC
id|NvRegPatternCRC
op_assign
l_int|0x204
comma
DECL|enumerator|NvRegPatternMask
id|NvRegPatternMask
op_assign
l_int|0x208
comma
DECL|enumerator|NvRegPowerCap
id|NvRegPowerCap
op_assign
l_int|0x268
comma
DECL|macro|NVREG_POWERCAP_D3SUPP
mdefine_line|#define NVREG_POWERCAP_D3SUPP&t;(1&lt;&lt;30)
DECL|macro|NVREG_POWERCAP_D2SUPP
mdefine_line|#define NVREG_POWERCAP_D2SUPP&t;(1&lt;&lt;26)
DECL|macro|NVREG_POWERCAP_D1SUPP
mdefine_line|#define NVREG_POWERCAP_D1SUPP&t;(1&lt;&lt;25)
DECL|enumerator|NvRegPowerState
id|NvRegPowerState
op_assign
l_int|0x26c
comma
DECL|macro|NVREG_POWERSTATE_POWEREDUP
mdefine_line|#define NVREG_POWERSTATE_POWEREDUP&t;0x8000
DECL|macro|NVREG_POWERSTATE_VALID
mdefine_line|#define NVREG_POWERSTATE_VALID&t;&t;0x0100
DECL|macro|NVREG_POWERSTATE_MASK
mdefine_line|#define NVREG_POWERSTATE_MASK&t;&t;0x0003
DECL|macro|NVREG_POWERSTATE_D0
mdefine_line|#define NVREG_POWERSTATE_D0&t;&t;0x0000
DECL|macro|NVREG_POWERSTATE_D1
mdefine_line|#define NVREG_POWERSTATE_D1&t;&t;0x0001
DECL|macro|NVREG_POWERSTATE_D2
mdefine_line|#define NVREG_POWERSTATE_D2&t;&t;0x0002
DECL|macro|NVREG_POWERSTATE_D3
mdefine_line|#define NVREG_POWERSTATE_D3&t;&t;0x0003
)brace
suffix:semicolon
multiline_comment|/* Big endian: should work, but is untested */
DECL|struct|ring_desc
r_struct
id|ring_desc
(brace
DECL|member|PacketBuffer
id|u32
id|PacketBuffer
suffix:semicolon
DECL|member|FlagLen
id|u32
id|FlagLen
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|FLAG_MASK_V1
mdefine_line|#define FLAG_MASK_V1 0xffff0000
DECL|macro|FLAG_MASK_V2
mdefine_line|#define FLAG_MASK_V2 0xffffc000
DECL|macro|LEN_MASK_V1
mdefine_line|#define LEN_MASK_V1 (0xffffffff ^ FLAG_MASK_V1)
DECL|macro|LEN_MASK_V2
mdefine_line|#define LEN_MASK_V2 (0xffffffff ^ FLAG_MASK_V2)
DECL|macro|NV_TX_LASTPACKET
mdefine_line|#define NV_TX_LASTPACKET&t;(1&lt;&lt;16)
DECL|macro|NV_TX_RETRYERROR
mdefine_line|#define NV_TX_RETRYERROR&t;(1&lt;&lt;19)
DECL|macro|NV_TX_LASTPACKET1
mdefine_line|#define NV_TX_LASTPACKET1&t;(1&lt;&lt;24)
DECL|macro|NV_TX_DEFERRED
mdefine_line|#define NV_TX_DEFERRED&t;&t;(1&lt;&lt;26)
DECL|macro|NV_TX_CARRIERLOST
mdefine_line|#define NV_TX_CARRIERLOST&t;(1&lt;&lt;27)
DECL|macro|NV_TX_LATECOLLISION
mdefine_line|#define NV_TX_LATECOLLISION&t;(1&lt;&lt;28)
DECL|macro|NV_TX_UNDERFLOW
mdefine_line|#define NV_TX_UNDERFLOW&t;&t;(1&lt;&lt;29)
DECL|macro|NV_TX_ERROR
mdefine_line|#define NV_TX_ERROR&t;&t;(1&lt;&lt;30)
DECL|macro|NV_TX_VALID
mdefine_line|#define NV_TX_VALID&t;&t;(1&lt;&lt;31)
DECL|macro|NV_TX2_LASTPACKET
mdefine_line|#define NV_TX2_LASTPACKET&t;(1&lt;&lt;29)
DECL|macro|NV_TX2_RETRYERROR
mdefine_line|#define NV_TX2_RETRYERROR&t;(1&lt;&lt;18)
DECL|macro|NV_TX2_LASTPACKET1
mdefine_line|#define NV_TX2_LASTPACKET1&t;(1&lt;&lt;23)
DECL|macro|NV_TX2_DEFERRED
mdefine_line|#define NV_TX2_DEFERRED&t;&t;(1&lt;&lt;25)
DECL|macro|NV_TX2_CARRIERLOST
mdefine_line|#define NV_TX2_CARRIERLOST&t;(1&lt;&lt;26)
DECL|macro|NV_TX2_LATECOLLISION
mdefine_line|#define NV_TX2_LATECOLLISION&t;(1&lt;&lt;27)
DECL|macro|NV_TX2_UNDERFLOW
mdefine_line|#define NV_TX2_UNDERFLOW&t;(1&lt;&lt;28)
multiline_comment|/* error and valid are the same for both */
DECL|macro|NV_TX2_ERROR
mdefine_line|#define NV_TX2_ERROR&t;&t;(1&lt;&lt;30)
DECL|macro|NV_TX2_VALID
mdefine_line|#define NV_TX2_VALID&t;&t;(1&lt;&lt;31)
DECL|macro|NV_RX_DESCRIPTORVALID
mdefine_line|#define NV_RX_DESCRIPTORVALID&t;(1&lt;&lt;16)
DECL|macro|NV_RX_MISSEDFRAME
mdefine_line|#define NV_RX_MISSEDFRAME&t;(1&lt;&lt;17)
DECL|macro|NV_RX_SUBSTRACT1
mdefine_line|#define NV_RX_SUBSTRACT1&t;(1&lt;&lt;18)
DECL|macro|NV_RX_ERROR1
mdefine_line|#define NV_RX_ERROR1&t;&t;(1&lt;&lt;23)
DECL|macro|NV_RX_ERROR2
mdefine_line|#define NV_RX_ERROR2&t;&t;(1&lt;&lt;24)
DECL|macro|NV_RX_ERROR3
mdefine_line|#define NV_RX_ERROR3&t;&t;(1&lt;&lt;25)
DECL|macro|NV_RX_ERROR4
mdefine_line|#define NV_RX_ERROR4&t;&t;(1&lt;&lt;26)
DECL|macro|NV_RX_CRCERR
mdefine_line|#define NV_RX_CRCERR&t;&t;(1&lt;&lt;27)
DECL|macro|NV_RX_OVERFLOW
mdefine_line|#define NV_RX_OVERFLOW&t;&t;(1&lt;&lt;28)
DECL|macro|NV_RX_FRAMINGERR
mdefine_line|#define NV_RX_FRAMINGERR&t;(1&lt;&lt;29)
DECL|macro|NV_RX_ERROR
mdefine_line|#define NV_RX_ERROR&t;&t;(1&lt;&lt;30)
DECL|macro|NV_RX_AVAIL
mdefine_line|#define NV_RX_AVAIL&t;&t;(1&lt;&lt;31)
DECL|macro|NV_RX2_CHECKSUMMASK
mdefine_line|#define NV_RX2_CHECKSUMMASK&t;(0x1C000000)
DECL|macro|NV_RX2_CHECKSUMOK1
mdefine_line|#define NV_RX2_CHECKSUMOK1&t;(0x10000000)
DECL|macro|NV_RX2_CHECKSUMOK2
mdefine_line|#define NV_RX2_CHECKSUMOK2&t;(0x14000000)
DECL|macro|NV_RX2_CHECKSUMOK3
mdefine_line|#define NV_RX2_CHECKSUMOK3&t;(0x18000000)
DECL|macro|NV_RX2_DESCRIPTORVALID
mdefine_line|#define NV_RX2_DESCRIPTORVALID&t;(1&lt;&lt;29)
DECL|macro|NV_RX2_SUBSTRACT1
mdefine_line|#define NV_RX2_SUBSTRACT1&t;(1&lt;&lt;25)
DECL|macro|NV_RX2_ERROR1
mdefine_line|#define NV_RX2_ERROR1&t;&t;(1&lt;&lt;18)
DECL|macro|NV_RX2_ERROR2
mdefine_line|#define NV_RX2_ERROR2&t;&t;(1&lt;&lt;19)
DECL|macro|NV_RX2_ERROR3
mdefine_line|#define NV_RX2_ERROR3&t;&t;(1&lt;&lt;20)
DECL|macro|NV_RX2_ERROR4
mdefine_line|#define NV_RX2_ERROR4&t;&t;(1&lt;&lt;21)
DECL|macro|NV_RX2_CRCERR
mdefine_line|#define NV_RX2_CRCERR&t;&t;(1&lt;&lt;22)
DECL|macro|NV_RX2_OVERFLOW
mdefine_line|#define NV_RX2_OVERFLOW&t;&t;(1&lt;&lt;23)
DECL|macro|NV_RX2_FRAMINGERR
mdefine_line|#define NV_RX2_FRAMINGERR&t;(1&lt;&lt;24)
multiline_comment|/* error and avail are the same for both */
DECL|macro|NV_RX2_ERROR
mdefine_line|#define NV_RX2_ERROR&t;&t;(1&lt;&lt;30)
DECL|macro|NV_RX2_AVAIL
mdefine_line|#define NV_RX2_AVAIL&t;&t;(1&lt;&lt;31)
multiline_comment|/* Miscelaneous hardware related defines: */
DECL|macro|NV_PCI_REGSZ
mdefine_line|#define NV_PCI_REGSZ&t;&t;0x270
multiline_comment|/* various timeout delays: all in usec */
DECL|macro|NV_TXRX_RESET_DELAY
mdefine_line|#define NV_TXRX_RESET_DELAY&t;4
DECL|macro|NV_TXSTOP_DELAY1
mdefine_line|#define NV_TXSTOP_DELAY1&t;10
DECL|macro|NV_TXSTOP_DELAY1MAX
mdefine_line|#define NV_TXSTOP_DELAY1MAX&t;500000
DECL|macro|NV_TXSTOP_DELAY2
mdefine_line|#define NV_TXSTOP_DELAY2&t;100
DECL|macro|NV_RXSTOP_DELAY1
mdefine_line|#define NV_RXSTOP_DELAY1&t;10
DECL|macro|NV_RXSTOP_DELAY1MAX
mdefine_line|#define NV_RXSTOP_DELAY1MAX&t;500000
DECL|macro|NV_RXSTOP_DELAY2
mdefine_line|#define NV_RXSTOP_DELAY2&t;100
DECL|macro|NV_SETUP5_DELAY
mdefine_line|#define NV_SETUP5_DELAY&t;&t;5
DECL|macro|NV_SETUP5_DELAYMAX
mdefine_line|#define NV_SETUP5_DELAYMAX&t;50000
DECL|macro|NV_POWERUP_DELAY
mdefine_line|#define NV_POWERUP_DELAY&t;5
DECL|macro|NV_POWERUP_DELAYMAX
mdefine_line|#define NV_POWERUP_DELAYMAX&t;5000
DECL|macro|NV_MIIBUSY_DELAY
mdefine_line|#define NV_MIIBUSY_DELAY&t;50
DECL|macro|NV_MIIPHY_DELAY
mdefine_line|#define NV_MIIPHY_DELAY&t;10
DECL|macro|NV_MIIPHY_DELAYMAX
mdefine_line|#define NV_MIIPHY_DELAYMAX&t;10000
DECL|macro|NV_WAKEUPPATTERNS
mdefine_line|#define NV_WAKEUPPATTERNS&t;5
DECL|macro|NV_WAKEUPMASKENTRIES
mdefine_line|#define NV_WAKEUPMASKENTRIES&t;4
multiline_comment|/* General driver defaults */
DECL|macro|NV_WATCHDOG_TIMEO
mdefine_line|#define NV_WATCHDOG_TIMEO&t;(5*HZ)
DECL|macro|RX_RING
mdefine_line|#define RX_RING&t;&t;128
DECL|macro|TX_RING
mdefine_line|#define TX_RING&t;&t;64
multiline_comment|/* &n; * If your nic mysteriously hangs then try to reduce the limits&n; * to 1/0: It might be required to set NV_TX_LASTPACKET in the&n; * last valid ring entry. But this would be impossible to&n; * implement - probably a disassembly error.&n; */
DECL|macro|TX_LIMIT_STOP
mdefine_line|#define TX_LIMIT_STOP&t;63
DECL|macro|TX_LIMIT_START
mdefine_line|#define TX_LIMIT_START&t;62
multiline_comment|/* rx/tx mac addr + type + vlan + align + slack*/
DECL|macro|RX_NIC_BUFSIZE
mdefine_line|#define RX_NIC_BUFSIZE&t;&t;(ETH_DATA_LEN + 64)
multiline_comment|/* even more slack */
DECL|macro|RX_ALLOC_BUFSIZE
mdefine_line|#define RX_ALLOC_BUFSIZE&t;(ETH_DATA_LEN + 128)
DECL|macro|OOM_REFILL
mdefine_line|#define OOM_REFILL&t;(1+HZ/20)
DECL|macro|POLL_WAIT
mdefine_line|#define POLL_WAIT&t;(1+HZ/100)
DECL|macro|LINK_TIMEOUT
mdefine_line|#define LINK_TIMEOUT&t;(3*HZ)
multiline_comment|/* &n; * desc_ver values:&n; * This field has two purposes:&n; * - Newer nics uses a different ring layout. The layout is selected by&n; *   comparing np-&gt;desc_ver with DESC_VER_xy.&n; * - It contains bits that are forced on when writing to NvRegTxRxControl.&n; */
DECL|macro|DESC_VER_1
mdefine_line|#define DESC_VER_1&t;0x0
DECL|macro|DESC_VER_2
mdefine_line|#define DESC_VER_2&t;(0x02100|NVREG_TXRXCTL_RXCHECK)
multiline_comment|/* PHY defines */
DECL|macro|PHY_OUI_MARVELL
mdefine_line|#define PHY_OUI_MARVELL&t;0x5043
DECL|macro|PHY_OUI_CICADA
mdefine_line|#define PHY_OUI_CICADA&t;0x03f1
DECL|macro|PHYID1_OUI_MASK
mdefine_line|#define PHYID1_OUI_MASK&t;0x03ff
DECL|macro|PHYID1_OUI_SHFT
mdefine_line|#define PHYID1_OUI_SHFT&t;6
DECL|macro|PHYID2_OUI_MASK
mdefine_line|#define PHYID2_OUI_MASK&t;0xfc00
DECL|macro|PHYID2_OUI_SHFT
mdefine_line|#define PHYID2_OUI_SHFT&t;10
DECL|macro|PHY_INIT1
mdefine_line|#define PHY_INIT1&t;0x0f000
DECL|macro|PHY_INIT2
mdefine_line|#define PHY_INIT2&t;0x0e00
DECL|macro|PHY_INIT3
mdefine_line|#define PHY_INIT3&t;0x01000
DECL|macro|PHY_INIT4
mdefine_line|#define PHY_INIT4&t;0x0200
DECL|macro|PHY_INIT5
mdefine_line|#define PHY_INIT5&t;0x0004
DECL|macro|PHY_INIT6
mdefine_line|#define PHY_INIT6&t;0x02000
DECL|macro|PHY_GIGABIT
mdefine_line|#define PHY_GIGABIT&t;0x0100
DECL|macro|PHY_TIMEOUT
mdefine_line|#define PHY_TIMEOUT&t;0x1
DECL|macro|PHY_ERROR
mdefine_line|#define PHY_ERROR&t;0x2
DECL|macro|PHY_100
mdefine_line|#define PHY_100&t;0x1
DECL|macro|PHY_1000
mdefine_line|#define PHY_1000&t;0x2
DECL|macro|PHY_HALF
mdefine_line|#define PHY_HALF&t;0x100
multiline_comment|/* FIXME: MII defines that should be added to &lt;linux/mii.h&gt; */
DECL|macro|MII_1000BT_CR
mdefine_line|#define MII_1000BT_CR&t;0x09
DECL|macro|MII_1000BT_SR
mdefine_line|#define MII_1000BT_SR&t;0x0a
DECL|macro|ADVERTISE_1000FULL
mdefine_line|#define ADVERTISE_1000FULL&t;0x0200
DECL|macro|ADVERTISE_1000HALF
mdefine_line|#define ADVERTISE_1000HALF&t;0x0100
DECL|macro|LPA_1000FULL
mdefine_line|#define LPA_1000FULL&t;0x0800
DECL|macro|LPA_1000HALF
mdefine_line|#define LPA_1000HALF&t;0x0400
multiline_comment|/*&n; * SMP locking:&n; * All hardware access under dev-&gt;priv-&gt;lock, except the performance&n; * critical parts:&n; * - rx is (pseudo-) lockless: it relies on the single-threading provided&n; *&t;by the arch code for interrupts.&n; * - tx setup is lockless: it relies on dev-&gt;xmit_lock. Actual submission&n; *&t;needs dev-&gt;priv-&gt;lock :-(&n; * - set_multicast_list: preparation lockless, relies on dev-&gt;xmit_lock.&n; */
multiline_comment|/* in dev: base, irq */
DECL|struct|fe_priv
r_struct
id|fe_priv
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* General data:&n;&t; * Locking: spin_lock(&amp;np-&gt;lock); */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|in_shutdown
r_int
id|in_shutdown
suffix:semicolon
DECL|member|linkspeed
id|u32
id|linkspeed
suffix:semicolon
DECL|member|duplex
r_int
id|duplex
suffix:semicolon
DECL|member|autoneg
r_int
id|autoneg
suffix:semicolon
DECL|member|fixed_mode
r_int
id|fixed_mode
suffix:semicolon
DECL|member|phyaddr
r_int
id|phyaddr
suffix:semicolon
DECL|member|wolenabled
r_int
id|wolenabled
suffix:semicolon
DECL|member|phy_oui
r_int
r_int
id|phy_oui
suffix:semicolon
DECL|member|gigabit
id|u16
id|gigabit
suffix:semicolon
multiline_comment|/* General data: RO fields */
DECL|member|ring_addr
id|dma_addr_t
id|ring_addr
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|orig_mac
id|u32
id|orig_mac
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|irqmask
id|u32
id|irqmask
suffix:semicolon
DECL|member|desc_ver
id|u32
id|desc_ver
suffix:semicolon
DECL|member|base
r_void
id|__iomem
op_star
id|base
suffix:semicolon
multiline_comment|/* rx specific fields.&n;&t; * Locking: Within irq hander or disable_irq+spin_lock(&amp;np-&gt;lock);&n;&t; */
DECL|member|rx_ring
r_struct
id|ring_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|cur_rx
DECL|member|refill_rx
r_int
r_int
id|cur_rx
comma
id|refill_rx
suffix:semicolon
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|RX_RING
)braket
suffix:semicolon
DECL|member|rx_dma
id|dma_addr_t
id|rx_dma
(braket
id|RX_RING
)braket
suffix:semicolon
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
DECL|member|oom_kick
r_struct
id|timer_list
id|oom_kick
suffix:semicolon
DECL|member|nic_poll
r_struct
id|timer_list
id|nic_poll
suffix:semicolon
multiline_comment|/* media detection workaround.&n;&t; * Locking: Within irq hander or disable_irq+spin_lock(&amp;np-&gt;lock);&n;&t; */
DECL|member|need_linktimer
r_int
id|need_linktimer
suffix:semicolon
DECL|member|link_timeout
r_int
r_int
id|link_timeout
suffix:semicolon
multiline_comment|/*&n;&t; * tx specific fields.&n;&t; */
DECL|member|tx_ring
r_struct
id|ring_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|next_tx
DECL|member|nic_tx
r_int
r_int
id|next_tx
comma
id|nic_tx
suffix:semicolon
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|TX_RING
)braket
suffix:semicolon
DECL|member|tx_dma
id|dma_addr_t
id|tx_dma
(braket
id|TX_RING
)braket
suffix:semicolon
DECL|member|tx_flags
id|u32
id|tx_flags
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Maximum number of loops until we assume that a bit in the irq mask&n; * is stuck. Overridable with module param.&n; */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|5
suffix:semicolon
DECL|function|get_nvpriv
r_static
r_inline
r_struct
id|fe_priv
op_star
id|get_nvpriv
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|get_hwbase
r_static
r_inline
id|u8
id|__iomem
op_star
id|get_hwbase
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|get_nvpriv
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|base
suffix:semicolon
)brace
DECL|function|pci_push
r_static
r_inline
r_void
id|pci_push
c_func
(paren
id|u8
id|__iomem
op_star
id|base
)paren
(brace
multiline_comment|/* force out pending posted writes */
id|readl
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|nv_descr_getlength
r_static
r_inline
id|u32
id|nv_descr_getlength
c_func
(paren
r_struct
id|ring_desc
op_star
id|prd
comma
id|u32
id|v
)paren
(brace
r_return
id|le32_to_cpu
c_func
(paren
id|prd-&gt;FlagLen
)paren
op_amp
(paren
(paren
id|v
op_eq
id|DESC_VER_1
)paren
ques
c_cond
id|LEN_MASK_V1
suffix:colon
id|LEN_MASK_V2
)paren
suffix:semicolon
)brace
DECL|function|reg_delay
r_static
r_int
id|reg_delay
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|offset
comma
id|u32
id|mask
comma
id|u32
id|target
comma
r_int
id|delay
comma
r_int
id|delaymax
comma
r_const
r_char
op_star
id|msg
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
r_do
(brace
id|udelay
c_func
(paren
id|delay
)paren
suffix:semicolon
id|delaymax
op_sub_assign
id|delay
suffix:semicolon
r_if
c_cond
(paren
id|delaymax
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|msg
)paren
id|printk
c_func
(paren
id|msg
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|readl
c_func
(paren
id|base
op_plus
id|offset
)paren
op_amp
id|mask
)paren
op_ne
id|target
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|MII_READ
mdefine_line|#define MII_READ&t;(-1)
multiline_comment|/* mii_rw: read/write a register on the PHY.&n; *&n; * Caller must guarantee serialization&n; */
DECL|function|mii_rw
r_static
r_int
id|mii_rw
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|addr
comma
r_int
id|miireg
comma
r_int
id|value
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|reg
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|reg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|NVREG_MIICTL_INUSE
)paren
(brace
id|writel
c_func
(paren
id|NVREG_MIICTL_INUSE
comma
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_MIIBUSY_DELAY
)paren
suffix:semicolon
)brace
id|reg
op_assign
(paren
id|addr
op_lshift
id|NVREG_MIICTL_ADDRSHIFT
)paren
op_or
id|miireg
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
id|MII_READ
)paren
(brace
id|writel
c_func
(paren
id|value
comma
id|base
op_plus
id|NvRegMIIData
)paren
suffix:semicolon
id|reg
op_or_assign
id|NVREG_MIICTL_WRITE
suffix:semicolon
)brace
id|writel
c_func
(paren
id|reg
comma
id|base
op_plus
id|NvRegMIIControl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegMIIControl
comma
id|NVREG_MIICTL_INUSE
comma
l_int|0
comma
id|NV_MIIPHY_DELAY
comma
id|NV_MIIPHY_DELAYMAX
comma
l_int|NULL
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw of reg %d at PHY %d timed out.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|value
op_ne
id|MII_READ
)paren
(brace
multiline_comment|/* it was a write operation - fewer failures are detectable */
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw wrote 0x%x to reg %d at PHY %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|value
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIStatus
)paren
op_amp
id|NVREG_MIISTAT_ERROR
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw of reg %d at PHY %d failed.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
)paren
suffix:semicolon
id|retval
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|retval
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIData
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: mii_rw read from reg %d at PHY %d: 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miireg
comma
id|addr
comma
id|retval
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|phy_reset
r_static
r_int
id|phy_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|miicontrol
suffix:semicolon
r_int
r_int
id|tries
op_assign
l_int|0
suffix:semicolon
id|miicontrol
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|MII_READ
)paren
suffix:semicolon
id|miicontrol
op_or_assign
id|BMCR_RESET
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|miicontrol
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* wait for 500ms */
id|msleep
c_func
(paren
l_int|500
)paren
suffix:semicolon
multiline_comment|/* must wait till reset is deasserted */
r_while
c_loop
(paren
id|miicontrol
op_amp
id|BMCR_RESET
)paren
(brace
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|miicontrol
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|MII_READ
)paren
suffix:semicolon
multiline_comment|/* FIXME: 100 tries seem excessive */
r_if
c_cond
(paren
id|tries
op_increment
OG
l_int|100
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|phy_init
r_static
r_int
id|phy_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|phyinterface
comma
id|phy_reserved
comma
id|mii_status
comma
id|mii_control
comma
id|mii_control_1000
comma
id|reg
suffix:semicolon
multiline_comment|/* set advertise register */
id|reg
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
id|reg
op_or_assign
(paren
id|ADVERTISE_10HALF
op_or
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
op_or
l_int|0x800
op_or
l_int|0x400
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|reg
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy write to advertise failed.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
multiline_comment|/* get phy interface type */
id|phyinterface
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPhyInterface
)paren
suffix:semicolon
multiline_comment|/* see if gigabit phy */
id|mii_status
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMSR
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_amp
id|PHY_GIGABIT
)paren
(brace
id|np-&gt;gigabit
op_assign
id|PHY_GIGABIT
suffix:semicolon
id|mii_control_1000
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|MII_READ
)paren
suffix:semicolon
id|mii_control_1000
op_and_assign
op_complement
id|ADVERTISE_1000HALF
suffix:semicolon
r_if
c_cond
(paren
id|phyinterface
op_amp
id|PHY_RGMII
)paren
id|mii_control_1000
op_or_assign
id|ADVERTISE_1000FULL
suffix:semicolon
r_else
id|mii_control_1000
op_and_assign
op_complement
id|ADVERTISE_1000FULL
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|mii_control_1000
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy init failed.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
)brace
r_else
id|np-&gt;gigabit
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* reset the phy */
r_if
c_cond
(paren
id|phy_reset
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy reset failed&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
multiline_comment|/* phy vendor specific configuration */
r_if
c_cond
(paren
(paren
id|np-&gt;phy_oui
op_eq
id|PHY_OUI_CICADA
)paren
op_logical_and
(paren
id|phyinterface
op_amp
id|PHY_RGMII
)paren
)paren
(brace
id|phy_reserved
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_RESV1
comma
id|MII_READ
)paren
suffix:semicolon
id|phy_reserved
op_and_assign
op_complement
(paren
id|PHY_INIT1
op_or
id|PHY_INIT2
)paren
suffix:semicolon
id|phy_reserved
op_or_assign
(paren
id|PHY_INIT3
op_or
id|PHY_INIT4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_RESV1
comma
id|phy_reserved
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy init failed.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
id|phy_reserved
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_NCONFIG
comma
id|MII_READ
)paren
suffix:semicolon
id|phy_reserved
op_or_assign
id|PHY_INIT5
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_NCONFIG
comma
id|phy_reserved
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy init failed.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|np-&gt;phy_oui
op_eq
id|PHY_OUI_CICADA
)paren
(brace
id|phy_reserved
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_SREVISION
comma
id|MII_READ
)paren
suffix:semicolon
id|phy_reserved
op_or_assign
id|PHY_INIT6
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_SREVISION
comma
id|phy_reserved
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: phy init failed.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
r_return
id|PHY_ERROR
suffix:semicolon
)brace
)brace
multiline_comment|/* restart auto negotiation */
id|mii_control
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|MII_READ
)paren
suffix:semicolon
id|mii_control
op_or_assign
(paren
id|BMCR_ANRESTART
op_or
id|BMCR_ANENABLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|mii_control
)paren
)paren
(brace
r_return
id|PHY_ERROR
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nv_start_rx
r_static
r_void
id|nv_start_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_start_rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Already running? Stop it. */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegReceiverControl
)paren
op_amp
id|NVREG_RCVCTL_START
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
id|np-&gt;linkspeed
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_RCVCTL_START
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_start_rx to duplex %d, speed 0x%08x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;duplex
comma
id|np-&gt;linkspeed
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|nv_stop_rx
r_static
r_void
id|nv_stop_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_stop_rx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegReceiverStatus
comma
id|NVREG_RCVSTAT_BUSY
comma
l_int|0
comma
id|NV_RXSTOP_DELAY1
comma
id|NV_RXSTOP_DELAY1MAX
comma
id|KERN_INFO
l_string|&quot;nv_stop_rx: ReceiverStatus remained busy&quot;
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_RXSTOP_DELAY2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
)brace
DECL|function|nv_start_tx
r_static
r_void
id|nv_start_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_start_tx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_XMITCTL_START
comma
id|base
op_plus
id|NvRegTransmitterControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
DECL|function|nv_stop_tx
r_static
r_void
id|nv_stop_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_stop_tx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegTransmitterControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegTransmitterStatus
comma
id|NVREG_XMITSTAT_BUSY
comma
l_int|0
comma
id|NV_TXSTOP_DELAY1
comma
id|NV_TXSTOP_DELAY1MAX
comma
id|KERN_INFO
l_string|&quot;nv_stop_tx: TransmitterStatus remained busy&quot;
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_TXSTOP_DELAY2
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownTransmitterReg
)paren
suffix:semicolon
)brace
DECL|function|nv_txrx_reset
r_static
r_void
id|nv_txrx_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_txrx_reset&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT2
op_or
id|NVREG_TXRXCTL_RESET
op_or
id|np-&gt;desc_ver
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|NV_TXRX_RESET_DELAY
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT2
op_or
id|np-&gt;desc_ver
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_get_stats: dev-&gt;get_stats function&n; * Get latest stats value from the nic.&n; * Called with read_lock(&amp;dev_base_lock) held for read -&n; * only synchronized against unregister_netdevice.&n; */
DECL|function|nv_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|nv_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* It seems that the nic always generates interrupts and doesn&squot;t&n;&t; * accumulate errors internally. Thus the current values in np-&gt;stats&n;&t; * are already up to date.&n;&t; */
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_alloc_rx: fill rx ring entries.&n; * Return 1 if the allocations for the skbs failed and the&n; * rx engine is without Available descriptors&n; */
DECL|function|nv_alloc_rx
r_static
r_int
id|nv_alloc_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|refill_rx
op_assign
id|np-&gt;refill_rx
suffix:semicolon
r_int
id|nr
suffix:semicolon
r_while
c_loop
(paren
id|np-&gt;cur_rx
op_ne
id|refill_rx
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|nr
op_assign
id|refill_rx
op_mod
id|RX_RING
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
op_eq
l_int|NULL
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_ALLOC_BUFSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_break
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
op_assign
id|skb
suffix:semicolon
)brace
r_else
(brace
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|nr
)braket
suffix:semicolon
)brace
id|np-&gt;rx_dma
(braket
id|nr
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|nr
)braket
dot
id|PacketBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;rx_dma
(braket
id|nr
)braket
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|nr
)braket
dot
id|FlagLen
op_assign
id|cpu_to_le32
c_func
(paren
id|RX_NIC_BUFSIZE
op_or
id|NV_RX_AVAIL
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_alloc_rx: Packet %d marked as Available&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|refill_rx
)paren
suffix:semicolon
id|refill_rx
op_increment
suffix:semicolon
)brace
id|np-&gt;refill_rx
op_assign
id|refill_rx
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_rx
op_minus
id|refill_rx
op_eq
id|RX_RING
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nv_do_rx_refill
r_static
r_void
id|nv_do_rx_refill
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nv_alloc_rx
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
DECL|function|nv_init_ring
r_static
r_int
id|nv_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|np-&gt;next_tx
op_assign
id|np-&gt;nic_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING
suffix:semicolon
id|i
op_increment
)paren
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|FlagLen
op_assign
l_int|0
suffix:semicolon
id|np-&gt;cur_rx
op_assign
id|RX_RING
suffix:semicolon
id|np-&gt;refill_rx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING
suffix:semicolon
id|i
op_increment
)paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|FlagLen
op_assign
l_int|0
suffix:semicolon
r_return
id|nv_alloc_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|nv_drain_tx
r_static
r_void
id|nv_drain_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|FlagLen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_dma
(braket
id|i
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|nv_drain_rx
r_static
r_void
id|nv_drain_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|FlagLen
op_assign
l_int|0
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_dma
(braket
id|i
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|function|drain_ring
r_static
r_void
id|drain_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|nv_drain_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nv_drain_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_start_xmit: dev-&gt;hard_start_xmit function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|nv_start_xmit
r_static
r_int
id|nv_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|nr
op_assign
id|np-&gt;next_tx
op_mod
id|TX_RING
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|nr
)braket
op_assign
id|skb
suffix:semicolon
id|np-&gt;tx_dma
(braket
id|nr
)braket
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|nr
)braket
dot
id|PacketBuffer
op_assign
id|cpu_to_le32
c_func
(paren
id|np-&gt;tx_dma
(braket
id|nr
)braket
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|nr
)braket
dot
id|FlagLen
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|skb-&gt;len
op_minus
l_int|1
)paren
op_or
id|np-&gt;tx_flags
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_start_xmit: packet packet %d queued for transmission.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;next_tx
)paren
suffix:semicolon
(brace
r_int
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|64
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|j
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n%03x:&quot;
comma
id|j
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; %02x&quot;
comma
(paren
(paren
r_int
r_char
op_star
)paren
id|skb-&gt;data
)paren
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|np-&gt;next_tx
op_increment
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;next_tx
op_minus
id|np-&gt;nic_tx
op_ge
id|TX_LIMIT_STOP
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_KICK
op_or
id|np-&gt;desc_ver
comma
id|get_hwbase
c_func
(paren
id|dev
)paren
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|get_hwbase
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_tx_done: check for completed packets, release the skbs.&n; *&n; * Caller must own np-&gt;lock.&n; */
DECL|function|nv_tx_done
r_static
r_void
id|nv_tx_done
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|Flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|np-&gt;nic_tx
op_ne
id|np-&gt;next_tx
)paren
(brace
id|i
op_assign
id|np-&gt;nic_tx
op_mod
id|TX_RING
suffix:semicolon
id|Flags
op_assign
id|le32_to_cpu
c_func
(paren
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|FlagLen
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_tx_done: looking at packet %d, Flags 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;nic_tx
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_TX_VALID
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;desc_ver
op_eq
id|DESC_VER_1
)paren
(brace
r_if
c_cond
(paren
id|Flags
op_amp
(paren
id|NV_TX_RETRYERROR
op_or
id|NV_TX_CARRIERLOST
op_or
id|NV_TX_LATECOLLISION
op_or
id|NV_TX_UNDERFLOW
op_or
id|NV_TX_ERROR
)paren
)paren
(brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_TX_UNDERFLOW
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_TX_CARRIERLOST
)paren
id|np-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.tx_bytes
op_add_assign
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|Flags
op_amp
(paren
id|NV_TX2_RETRYERROR
op_or
id|NV_TX2_CARRIERLOST
op_or
id|NV_TX2_LATECOLLISION
op_or
id|NV_TX2_UNDERFLOW
op_or
id|NV_TX2_ERROR
)paren
)paren
(brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_TX2_UNDERFLOW
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_TX2_CARRIERLOST
)paren
id|np-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.tx_bytes
op_add_assign
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
)brace
)brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_dma
(braket
id|i
)braket
comma
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|np-&gt;tx_skbuff
(braket
id|i
)braket
)paren
suffix:semicolon
id|np-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;nic_tx
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;next_tx
op_minus
id|np-&gt;nic_tx
OL
id|TX_LIMIT_START
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_tx_timeout: dev-&gt;tx_timeout function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|nv_tx_timeout
r_static
r_void
id|nv_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Got tx_timeout. irq: %08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|base
op_plus
id|NvRegIrqStatus
)paren
op_amp
id|NVREG_IRQSTAT_MASK
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* 1) stop tx engine */
id|nv_stop_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 2) check that the packets were not sent already: */
id|nv_tx_done
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* 3) if there are dead entries: clear everything */
r_if
c_cond
(paren
id|np-&gt;next_tx
op_ne
id|np-&gt;nic_tx
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: tx_timeout: dead entries!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|nv_drain_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;next_tx
op_assign
id|np-&gt;nic_tx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|np-&gt;ring_addr
op_plus
id|RX_RING
op_star
r_sizeof
(paren
r_struct
id|ring_desc
)paren
)paren
comma
id|base
op_plus
id|NvRegTxRingPhysAddr
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* 4) restart tx engine */
id|nv_start_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|nv_rx_process
r_static
r_void
id|nv_rx_process
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|Flags
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_rx
op_minus
id|np-&gt;refill_rx
op_ge
id|RX_RING
)paren
r_break
suffix:semicolon
multiline_comment|/* we scanned the whole ring - do not continue */
id|i
op_assign
id|np-&gt;cur_rx
op_mod
id|RX_RING
suffix:semicolon
id|Flags
op_assign
id|le32_to_cpu
c_func
(paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|FlagLen
)paren
suffix:semicolon
id|len
op_assign
id|nv_descr_getlength
c_func
(paren
op_amp
id|np-&gt;rx_ring
(braket
id|i
)braket
comma
id|np-&gt;desc_ver
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_rx_process: looking at packet %d, Flags 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_rx
comma
id|Flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_AVAIL
)paren
r_break
suffix:semicolon
multiline_comment|/* still owned by hardware, */
multiline_comment|/*&n;&t;&t; * the packet is for us - immediately tear down the pci mapping.&n;&t;&t; * TODO: check if a prefetch of the first cacheline improves&n;&t;&t; * the performance.&n;&t;&t; */
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_dma
(braket
id|i
)braket
comma
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|len
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
(brace
r_int
id|j
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Dumping packet (flags 0x%x).&quot;
comma
id|Flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|64
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|j
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n%03x:&quot;
comma
id|j
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; %02x&quot;
comma
(paren
(paren
r_int
r_char
op_star
)paren
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|data
)paren
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* look at what we actually got: */
r_if
c_cond
(paren
id|np-&gt;desc_ver
op_eq
id|DESC_VER_1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|Flags
op_amp
id|NV_RX_DESCRIPTORVALID
)paren
)paren
r_goto
id|next_pkt
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_MISSEDFRAME
)paren
(brace
id|np-&gt;stats.rx_missed_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
(paren
id|NV_RX_ERROR1
op_or
id|NV_RX_ERROR2
op_or
id|NV_RX_ERROR3
op_or
id|NV_RX_ERROR4
)paren
)paren
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_CRCERR
)paren
(brace
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_OVERFLOW
)paren
(brace
id|np-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_ERROR
)paren
(brace
multiline_comment|/* framing errors are soft errors, the rest is fatal. */
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_FRAMINGERR
)paren
(brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX_SUBSTRACT1
)paren
(brace
id|len
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|Flags
op_amp
id|NV_RX2_DESCRIPTORVALID
)paren
)paren
r_goto
id|next_pkt
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_amp
(paren
id|NV_RX2_ERROR1
op_or
id|NV_RX2_ERROR2
op_or
id|NV_RX2_ERROR3
op_or
id|NV_RX2_ERROR4
)paren
)paren
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX2_CRCERR
)paren
(brace
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX2_OVERFLOW
)paren
(brace
id|np-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX2_ERROR
)paren
(brace
multiline_comment|/* framing errors are soft errors, the rest is fatal. */
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX2_FRAMINGERR
)paren
(brace
r_if
c_cond
(paren
id|Flags
op_amp
id|NV_RX2_SUBSTRACT1
)paren
(brace
id|len
op_decrement
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_goto
id|next_pkt
suffix:semicolon
)brace
)brace
id|Flags
op_and_assign
id|NV_RX2_CHECKSUMMASK
suffix:semicolon
r_if
c_cond
(paren
id|Flags
op_eq
id|NV_RX2_CHECKSUMOK1
op_logical_or
id|Flags
op_eq
id|NV_RX2_CHECKSUMOK2
op_logical_or
id|Flags
op_eq
id|NV_RX2_CHECKSUMOK3
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: hw checksum hit!.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_member_access_from_pointer
id|ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: hwchecksum miss!.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* got a valid packet - forward it to the network core */
id|skb
op_assign
id|np-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
id|np-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_rx_process: packet %d with %d bytes, proto %d accepted.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;cur_rx
comma
id|len
comma
id|skb-&gt;protocol
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_add_assign
id|len
suffix:semicolon
id|next_pkt
suffix:colon
id|np-&gt;cur_rx
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * nv_change_mtu: dev-&gt;change_mtu function&n; * Called with dev_base_lock held for read.&n; */
DECL|function|nv_change_mtu
r_static
r_int
id|nv_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
id|new_mtu
OG
id|ETH_DATA_LEN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * nv_set_multicast: dev-&gt;set_multicast function&n; * Called with dev-&gt;xmit_lock held.&n; */
DECL|function|nv_set_multicast
r_static
r_void
id|nv_set_multicast
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|addr
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|mask
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|pff
suffix:semicolon
id|memset
c_func
(paren
id|addr
comma
l_int|0
comma
r_sizeof
(paren
id|addr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mask
comma
l_int|0
comma
r_sizeof
(paren
id|mask
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|pff
op_assign
id|NVREG_PFF_PROMISC
suffix:semicolon
)brace
r_else
(brace
id|pff
op_assign
id|NVREG_PFF_MYADDR
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
op_logical_or
id|dev-&gt;mc_list
)paren
(brace
id|u32
id|alwaysOff
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|alwaysOn
(braket
l_int|2
)braket
suffix:semicolon
id|alwaysOn
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_assign
id|alwaysOff
(braket
l_int|0
)braket
op_assign
id|alwaysOff
(braket
l_int|1
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
(brace
id|alwaysOn
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_assign
id|alwaysOff
(braket
l_int|0
)braket
op_assign
id|alwaysOff
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|walk
suffix:semicolon
id|walk
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_while
c_loop
(paren
id|walk
op_ne
l_int|NULL
)paren
(brace
id|u32
id|a
comma
id|b
suffix:semicolon
id|a
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|walk-&gt;dmi_addr
)paren
suffix:semicolon
id|b
op_assign
id|le16_to_cpu
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
(paren
op_amp
id|walk-&gt;dmi_addr
(braket
l_int|4
)braket
)paren
)paren
suffix:semicolon
id|alwaysOn
(braket
l_int|0
)braket
op_and_assign
id|a
suffix:semicolon
id|alwaysOff
(braket
l_int|0
)braket
op_and_assign
op_complement
id|a
suffix:semicolon
id|alwaysOn
(braket
l_int|1
)braket
op_and_assign
id|b
suffix:semicolon
id|alwaysOff
(braket
l_int|1
)braket
op_and_assign
op_complement
id|b
suffix:semicolon
id|walk
op_assign
id|walk-&gt;next
suffix:semicolon
)brace
)brace
id|addr
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|0
)braket
suffix:semicolon
id|addr
(braket
l_int|1
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
suffix:semicolon
id|mask
(braket
l_int|0
)braket
op_assign
id|alwaysOn
(braket
l_int|0
)braket
op_or
id|alwaysOff
(braket
l_int|0
)braket
suffix:semicolon
id|mask
(braket
l_int|1
)braket
op_assign
id|alwaysOn
(braket
l_int|1
)braket
op_or
id|alwaysOff
(braket
l_int|1
)braket
suffix:semicolon
)brace
)brace
id|addr
(braket
l_int|0
)braket
op_or_assign
id|NVREG_MCASTADDRA_FORCE
suffix:semicolon
id|pff
op_or_assign
id|NVREG_PFF_ALWAYS
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|nv_stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|addr
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|addr
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mask
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|pff
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: reconfiguration for multicast lists.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|nv_start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|nv_update_linkspeed
r_static
r_int
id|nv_update_linkspeed
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|adv
comma
id|lpa
suffix:semicolon
r_int
id|newls
op_assign
id|np-&gt;linkspeed
suffix:semicolon
r_int
id|newdup
op_assign
id|np-&gt;duplex
suffix:semicolon
r_int
id|mii_status
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|u32
id|control_1000
comma
id|status_1000
comma
id|phyreg
suffix:semicolon
multiline_comment|/* BMSR_LSTATUS is latched, read it twice:&n;&t; * we want the current value.&n;&t; */
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMSR
comma
id|MII_READ
)paren
suffix:semicolon
id|mii_status
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMSR
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mii_status
op_amp
id|BMSR_LSTATUS
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: no link detected by phy - falling back to 10HD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|set_speed
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;autoneg
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_update_linkspeed: autoneg off, PHY set to 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;fixed_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;fixed_mode
op_amp
id|LPA_100FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|np-&gt;fixed_mode
op_amp
id|LPA_100HALF
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|np-&gt;fixed_mode
op_amp
id|LPA_10FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
id|retval
op_assign
l_int|1
suffix:semicolon
r_goto
id|set_speed
suffix:semicolon
)brace
multiline_comment|/* check auto negotiation is complete */
r_if
c_cond
(paren
op_logical_neg
(paren
id|mii_status
op_amp
id|BMSR_ANEGCOMPLETE
)paren
)paren
(brace
multiline_comment|/* still in autonegotiation - configure nic for 10 MBit HD and wait. */
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: autoneg not completed - falling back to 10HD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|set_speed
suffix:semicolon
)brace
id|retval
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
(brace
id|control_1000
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|MII_READ
)paren
suffix:semicolon
id|status_1000
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_SR
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|control_1000
op_amp
id|ADVERTISE_1000FULL
)paren
op_logical_and
(paren
id|status_1000
op_amp
id|LPA_1000FULL
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_update_linkspeed: GBit ethernet detected.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_1000
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
r_goto
id|set_speed
suffix:semicolon
)brace
)brace
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
id|lpa
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_LPA
comma
id|MII_READ
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_update_linkspeed: PHY advertises 0x%04x, lpa 0x%04x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|adv
comma
id|lpa
)paren
suffix:semicolon
multiline_comment|/* FIXME: handle parallel detection properly */
id|lpa
op_assign
id|lpa
op_amp
id|adv
suffix:semicolon
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_100FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_100HALF
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_100
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_10FULL
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lpa
op_amp
id|LPA_10HALF
)paren
(brace
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: bad ability %04x - falling back to 10HD.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lpa
)paren
suffix:semicolon
id|newls
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|newdup
op_assign
l_int|0
suffix:semicolon
)brace
id|set_speed
suffix:colon
r_if
c_cond
(paren
id|np-&gt;duplex
op_eq
id|newdup
op_logical_and
id|np-&gt;linkspeed
op_eq
id|newls
)paren
r_return
id|retval
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: changing link setting from %d/%d to %d/%d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|np-&gt;linkspeed
comma
id|np-&gt;duplex
comma
id|newls
comma
id|newdup
)paren
suffix:semicolon
id|np-&gt;duplex
op_assign
id|newdup
suffix:semicolon
id|np-&gt;linkspeed
op_assign
id|newls
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
(brace
id|phyreg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegRandomSeed
)paren
suffix:semicolon
id|phyreg
op_and_assign
op_complement
(paren
l_int|0x3FF00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|np-&gt;linkspeed
op_amp
l_int|0xFFF
)paren
op_eq
id|NVREG_LINKSPEED_10
)paren
id|phyreg
op_or_assign
id|NVREG_RNDSEED_FORCE3
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|np-&gt;linkspeed
op_amp
l_int|0xFFF
)paren
op_eq
id|NVREG_LINKSPEED_100
)paren
id|phyreg
op_or_assign
id|NVREG_RNDSEED_FORCE2
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|np-&gt;linkspeed
op_amp
l_int|0xFFF
)paren
op_eq
id|NVREG_LINKSPEED_1000
)paren
id|phyreg
op_or_assign
id|NVREG_RNDSEED_FORCE
suffix:semicolon
id|writel
c_func
(paren
id|phyreg
comma
id|base
op_plus
id|NvRegRandomSeed
)paren
suffix:semicolon
)brace
id|phyreg
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPhyInterface
)paren
suffix:semicolon
id|phyreg
op_and_assign
op_complement
(paren
id|PHY_HALF
op_or
id|PHY_100
op_or
id|PHY_1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;duplex
op_eq
l_int|0
)paren
id|phyreg
op_or_assign
id|PHY_HALF
suffix:semicolon
r_if
c_cond
(paren
(paren
id|np-&gt;linkspeed
op_amp
id|NVREG_LINKSPEED_MASK
)paren
op_eq
id|NVREG_LINKSPEED_100
)paren
id|phyreg
op_or_assign
id|PHY_100
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|np-&gt;linkspeed
op_amp
id|NVREG_LINKSPEED_MASK
)paren
op_eq
id|NVREG_LINKSPEED_1000
)paren
id|phyreg
op_or_assign
id|PHY_1000
suffix:semicolon
id|writel
c_func
(paren
id|phyreg
comma
id|base
op_plus
id|NvRegPhyInterface
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MISC1_FORCE
op_or
(paren
id|np-&gt;duplex
ques
c_cond
l_int|0
suffix:colon
id|NVREG_MISC1_HD
)paren
comma
id|base
op_plus
id|NvRegMisc1
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;linkspeed
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|nv_linkchange
r_static
r_void
id|nv_linkchange
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|nv_update_linkspeed
c_func
(paren
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
id|nv_stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link up.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|nv_start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link down.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|nv_stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|nv_link_irq
r_static
r_void
id|nv_link_irq
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|miistat
suffix:semicolon
id|miistat
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link change irq, status 0x%x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|miistat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|miistat
op_amp
(paren
id|NVREG_MIISTAT_LINKCHANGE
)paren
)paren
id|nv_linkchange
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: link change notification done.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|nv_nic_irq
r_static
id|irqreturn_t
id|nv_nic_irq
c_func
(paren
r_int
id|foo
comma
r_void
op_star
id|data
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|events
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_nic_irq&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
id|events
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegIrqStatus
)paren
op_amp
id|NVREG_IRQSTAT_MASK
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: irq: %08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|events
op_amp
id|np-&gt;irqmask
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_TX1
op_or
id|NVREG_IRQ_TX2
op_or
id|NVREG_IRQ_TX_ERR
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|nv_tx_done
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_RX_ERROR
op_or
id|NVREG_IRQ_RX
op_or
id|NVREG_IRQ_RX_NOBUF
)paren
)paren
(brace
id|nv_rx_process
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nv_alloc_rx
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|events
op_amp
id|NVREG_IRQ_LINK
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|nv_link_irq
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;need_linktimer
op_logical_and
id|time_after
c_func
(paren
id|jiffies
comma
id|np-&gt;link_timeout
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|nv_linkchange
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|np-&gt;link_timeout
op_assign
id|jiffies
op_plus
id|LINK_TIMEOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_TX_ERR
)paren
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: received irq with events 0x%x. Probably TX fail.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events
op_amp
(paren
id|NVREG_IRQ_UNKNOWN
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: received irq with unknown events 0x%x. Please report&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|events
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OG
id|max_interrupt_work
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* disable interrupts on the nic */
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;in_shutdown
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;nic_poll
comma
id|jiffies
op_plus
id|POLL_WAIT
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: too many iterations (%d) in nv_nic_irq.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: nv_nic_irq completed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
DECL|function|nv_do_nic_poll
r_static
r_void
id|nv_do_nic_poll
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|disable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* FIXME: Do we need synchronize_irq(dev-&gt;irq) here? */
multiline_comment|/*&n;&t; * reenable interrupts on the nic, we have to do this before calling&n;&t; * nv_nic_irq because that may decide to do otherwise&n;&t; */
id|writel
c_func
(paren
id|np-&gt;irqmask
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|nv_nic_irq
c_func
(paren
(paren
r_int
)paren
l_int|0
comma
(paren
r_void
op_star
)paren
id|data
comma
(paren
r_struct
id|pt_regs
op_star
)paren
l_int|NULL
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
DECL|function|nv_get_drvinfo
r_static
r_void
id|nv_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;driver
comma
l_string|&quot;forcedeth&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;version
comma
id|FORCEDETH_VERSION
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;bus_info
comma
id|pci_name
c_func
(paren
id|np-&gt;pci_dev
)paren
)paren
suffix:semicolon
)brace
DECL|function|nv_get_wol
r_static
r_void
id|nv_get_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wolinfo
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|wolinfo-&gt;supported
op_assign
id|WAKE_MAGIC
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;wolenabled
)paren
id|wolinfo-&gt;wolopts
op_assign
id|WAKE_MAGIC
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|nv_set_wol
r_static
r_int
id|nv_set_wol
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_wolinfo
op_star
id|wolinfo
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wolinfo-&gt;wolopts
op_eq
l_int|0
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegWakeUpFlags
)paren
suffix:semicolon
id|np-&gt;wolenabled
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wolinfo-&gt;wolopts
op_amp
id|WAKE_MAGIC
)paren
(brace
id|writel
c_func
(paren
id|NVREG_WAKEUPFLAGS_ENABLE
comma
id|base
op_plus
id|NvRegWakeUpFlags
)paren
suffix:semicolon
id|np-&gt;wolenabled
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nv_get_settings
r_static
r_int
id|nv_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|adv
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|ecmd-&gt;port
op_assign
id|PORT_MII
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* We do not track link speed / duplex setting if the&n;&t;&t; * interface is disabled. Force a link check */
id|nv_update_linkspeed
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|np-&gt;linkspeed
op_amp
(paren
id|NVREG_LINKSPEED_MASK
)paren
)paren
(brace
r_case
id|NVREG_LINKSPEED_10
suffix:colon
id|ecmd-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NVREG_LINKSPEED_100
suffix:colon
id|ecmd-&gt;speed
op_assign
id|SPEED_100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NVREG_LINKSPEED_1000
suffix:colon
id|ecmd-&gt;speed
op_assign
id|SPEED_1000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;duplex
)paren
id|ecmd-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
id|ecmd-&gt;autoneg
op_assign
id|np-&gt;autoneg
suffix:semicolon
id|ecmd-&gt;advertising
op_assign
id|ADVERTISED_MII
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;autoneg
)paren
(brace
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_Autoneg
suffix:semicolon
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
)brace
r_else
(brace
id|adv
op_assign
id|np-&gt;fixed_mode
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adv
op_amp
id|ADVERTISE_10HALF
)paren
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_10baseT_Half
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
id|ADVERTISE_10FULL
)paren
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_10baseT_Full
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
id|ADVERTISE_100HALF
)paren
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_100baseT_Half
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
id|ADVERTISE_100FULL
)paren
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_100baseT_Full
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;autoneg
op_logical_and
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
(brace
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|MII_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
id|ADVERTISE_1000FULL
)paren
id|ecmd-&gt;advertising
op_or_assign
id|ADVERTISED_1000baseT_Full
suffix:semicolon
)brace
id|ecmd-&gt;supported
op_assign
(paren
id|SUPPORTED_Autoneg
op_or
id|SUPPORTED_10baseT_Half
op_or
id|SUPPORTED_10baseT_Full
op_or
id|SUPPORTED_100baseT_Half
op_or
id|SUPPORTED_100baseT_Full
op_or
id|SUPPORTED_MII
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
id|ecmd-&gt;supported
op_or_assign
id|SUPPORTED_1000baseT_Full
suffix:semicolon
id|ecmd-&gt;phy_address
op_assign
id|np-&gt;phyaddr
suffix:semicolon
id|ecmd-&gt;transceiver
op_assign
id|XCVR_EXTERNAL
suffix:semicolon
multiline_comment|/* ignore maxtxpkt, maxrxpkt for now */
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nv_set_settings
r_static
r_int
id|nv_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|ecmd
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|netdev_priv
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;port
op_ne
id|PORT_MII
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;transceiver
op_ne
id|XCVR_EXTERNAL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;phy_address
op_ne
id|np-&gt;phyaddr
)paren
(brace
multiline_comment|/* TODO: support switching between multiple phys. Should be&n;&t;&t; * trivial, but not enabled due to lack of test hardware. */
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
id|u32
id|mask
suffix:semicolon
id|mask
op_assign
id|ADVERTISED_10baseT_Half
op_or
id|ADVERTISED_10baseT_Full
op_or
id|ADVERTISED_100baseT_Half
op_or
id|ADVERTISED_100baseT_Full
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
id|mask
op_or_assign
id|ADVERTISED_1000baseT_Full
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ecmd-&gt;advertising
op_amp
id|mask
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_DISABLE
)paren
(brace
multiline_comment|/* Note: autonegotiation disable, speed 1000 intentionally&n;&t;&t; * forbidden - noone should need that. */
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_ne
id|SPEED_10
op_logical_and
id|ecmd-&gt;speed
op_ne
id|SPEED_100
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_HALF
op_logical_and
id|ecmd-&gt;duplex
op_ne
id|DUPLEX_FULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
r_int
id|adv
comma
id|bmcr
suffix:semicolon
id|np-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* advertise only what has been requested */
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
(brace
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|MII_READ
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
id|ADVERTISE_1000FULL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;advertising
op_amp
id|ADVERTISED_1000baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_1000FULL
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|adv
)paren
suffix:semicolon
)brace
id|bmcr
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|MII_READ
)paren
suffix:semicolon
id|bmcr
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|bmcr
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|adv
comma
id|bmcr
suffix:semicolon
id|np-&gt;autoneg
op_assign
l_int|0
suffix:semicolon
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|MII_READ
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_eq
id|SPEED_10
op_logical_and
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_HALF
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_eq
id|SPEED_10
op_logical_and
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_FULL
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_eq
id|SPEED_100
op_logical_and
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_HALF
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|ecmd-&gt;speed
op_eq
id|SPEED_100
op_logical_and
id|ecmd-&gt;duplex
op_eq
id|DUPLEX_FULL
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
id|np-&gt;fixed_mode
op_assign
id|adv
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;gigabit
op_eq
id|PHY_GIGABIT
)paren
(brace
id|adv
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|MII_READ
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
id|ADVERTISE_1000FULL
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_1000BT_CR
comma
id|adv
)paren
suffix:semicolon
)brace
id|bmcr
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|MII_READ
)paren
suffix:semicolon
id|bmcr
op_or_assign
op_complement
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_SPEED100
op_or
id|BMCR_FULLDPLX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
(paren
id|ADVERTISE_10FULL
op_or
id|ADVERTISE_100FULL
)paren
)paren
id|bmcr
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
r_if
c_cond
(paren
id|adv
op_amp
(paren
id|ADVERTISE_100HALF
op_or
id|ADVERTISE_100FULL
)paren
)paren
id|bmcr
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
id|mii_rw
c_func
(paren
id|dev
comma
id|np-&gt;phyaddr
comma
id|MII_BMCR
comma
id|bmcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/* Wait a bit and then reconfigure the nic. */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|nv_linkchange
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ops
r_static
r_struct
id|ethtool_ops
id|ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|nv_get_drvinfo
comma
dot
id|get_link
op_assign
id|ethtool_op_get_link
comma
dot
id|get_wol
op_assign
id|nv_get_wol
comma
dot
id|set_wol
op_assign
id|nv_set_wol
comma
dot
id|get_settings
op_assign
id|nv_get_settings
comma
dot
id|set_settings
op_assign
id|nv_set_settings
comma
)brace
suffix:semicolon
DECL|function|nv_open
r_static
r_int
id|nv_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|ret
comma
id|oom
comma
id|i
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;nv_open: begin&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* 1) erase previous misconfiguration */
multiline_comment|/* 4.1-1: stop adapter: ignored, 4.3 seems to be overkill */
id|writel
c_func
(paren
id|NVREG_MCASTADDRA_FORCE
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegTransmitterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegReceiverControl
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
multiline_comment|/* 2) initialize descriptor rings */
id|oom
op_assign
id|nv_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownTransmitterReg
)paren
suffix:semicolon
id|nv_txrx_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownSetupReg6
)paren
suffix:semicolon
id|np-&gt;in_shutdown
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 3) set mac address */
(brace
id|u32
id|mac
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|0
)braket
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_lshift
l_int|0
)paren
op_plus
(paren
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mac
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mac
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
)brace
multiline_comment|/* 4) give hw rings */
id|writel
c_func
(paren
(paren
id|u32
)paren
id|np-&gt;ring_addr
comma
id|base
op_plus
id|NvRegRxRingPhysAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
(paren
id|np-&gt;ring_addr
op_plus
id|RX_RING
op_star
r_sizeof
(paren
r_struct
id|ring_desc
)paren
)paren
comma
id|base
op_plus
id|NvRegTxRingPhysAddr
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
(paren
id|RX_RING
op_minus
l_int|1
)paren
op_lshift
id|NVREG_RINGSZ_RXSHIFT
)paren
op_plus
(paren
(paren
id|TX_RING
op_minus
l_int|1
)paren
op_lshift
id|NVREG_RINGSZ_TXSHIFT
)paren
comma
id|base
op_plus
id|NvRegRingSizes
)paren
suffix:semicolon
multiline_comment|/* 5) continue setup */
id|writel
c_func
(paren
id|np-&gt;linkspeed
comma
id|base
op_plus
id|NvRegLinkSpeed
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP3_VAL1
comma
id|base
op_plus
id|NvRegUnknownSetupReg3
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;desc_ver
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_TXRXCTL_BIT1
op_or
id|np-&gt;desc_ver
comma
id|base
op_plus
id|NvRegTxRxControl
)paren
suffix:semicolon
id|reg_delay
c_func
(paren
id|dev
comma
id|NvRegUnknownSetupReg5
comma
id|NVREG_UNKSETUP5_BIT31
comma
id|NVREG_UNKSETUP5_BIT31
comma
id|NV_SETUP5_DELAY
comma
id|NV_SETUP5_DELAYMAX
comma
id|KERN_INFO
l_string|&quot;open: SetupReg5, Bit 31 remained off&bslash;n&quot;
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegUnknownSetupReg4
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK2
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
multiline_comment|/* 6) continue setup */
id|writel
c_func
(paren
id|NVREG_MISC1_FORCE
op_or
id|NVREG_MISC1_HD
comma
id|base
op_plus
id|NvRegMisc1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegTransmitterStatus
)paren
comma
id|base
op_plus
id|NvRegTransmitterStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_PFF_ALWAYS
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_OFFLOAD_NORMAL
comma
id|base
op_plus
id|NvRegOffloadConfig
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegReceiverStatus
)paren
comma
id|base
op_plus
id|NvRegReceiverStatus
)paren
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|i
comma
r_sizeof
(paren
id|i
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_RNDSEED_FORCE
op_or
(paren
id|i
op_amp
id|NVREG_RNDSEED_MASK
)paren
comma
id|base
op_plus
id|NvRegRandomSeed
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP1_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg1
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP2_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg2
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_POLL_DEFAULT
comma
id|base
op_plus
id|NvRegPollingInterval
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP6_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg6
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|np-&gt;phyaddr
op_lshift
id|NVREG_ADAPTCTL_PHYSHIFT
)paren
op_or
id|NVREG_ADAPTCTL_PHYVALID
op_or
id|NVREG_ADAPTCTL_RUNNING
comma
id|base
op_plus
id|NvRegAdapterControl
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISPEED_BIT8
op_or
id|NVREG_MIIDELAY
comma
id|base
op_plus
id|NvRegMIISpeed
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_UNKSETUP4_VAL
comma
id|base
op_plus
id|NvRegUnknownSetupReg4
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_WAKEUPFLAGS_VAL
comma
id|base
op_plus
id|NvRegWakeUpFlags
)paren
suffix:semicolon
id|i
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
id|NVREG_POWERSTATE_POWEREDUP
)paren
op_eq
l_int|0
)paren
id|writel
c_func
(paren
id|NVREG_POWERSTATE_POWEREDUP
op_or
id|i
comma
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|base
op_plus
id|NvRegPowerState
)paren
op_or
id|NVREG_POWERSTATE_VALID
comma
id|base
op_plus
id|NvRegPowerState
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK2
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_IRQSTAT_MASK
comma
id|base
op_plus
id|NvRegIrqStatus
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|nv_nic_irq
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|out_drain
suffix:semicolon
multiline_comment|/* ask for interrupts */
id|writel
c_func
(paren
id|np-&gt;irqmask
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MCASTADDRA_FORCE
comma
id|base
op_plus
id|NvRegMulticastAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastAddrB
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskA
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegMulticastMaskB
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_PFF_ALWAYS
op_or
id|NVREG_PFF_MYADDR
comma
id|base
op_plus
id|NvRegPacketFilterFlags
)paren
suffix:semicolon
multiline_comment|/* One manual link speed update: Interrupts are enabled, future link&n;&t; * speed changes cause interrupts and are handled by nv_link_irq().&n;&t; */
(brace
id|u32
id|miistat
suffix:semicolon
id|miistat
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|writel
c_func
(paren
id|NVREG_MIISTAT_MASK
comma
id|base
op_plus
id|NvRegMIIStatus
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;startup: got 0x%08x.&bslash;n&quot;
comma
id|miistat
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|nv_update_linkspeed
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nv_start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nv_start_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no link during initialization.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|oom
)paren
id|mod_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
comma
id|jiffies
op_plus
id|OOM_REFILL
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_drain
suffix:colon
id|drain_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|nv_close
r_static
r_int
id|nv_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|np-&gt;in_shutdown
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;oom_kick
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;nic_poll
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|nv_stop_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nv_stop_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|nv_txrx_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* disable interrupts on the nic or we will lock up */
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegIrqMask
)paren
suffix:semicolon
id|pci_push
c_func
(paren
id|base
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Irqmask is zero again&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|drain_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;wolenabled
)paren
id|nv_start_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* FIXME: power down nic */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nv_probe
r_static
r_int
id|__devinit
id|nv_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|fe_priv
)paren
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pci_dev-&gt;dev
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|np-&gt;oom_kick
)paren
suffix:semicolon
id|np-&gt;oom_kick.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;oom_kick.function
op_assign
op_amp
id|nv_do_rx_refill
suffix:semicolon
multiline_comment|/* timer handler */
id|init_timer
c_func
(paren
op_amp
id|np-&gt;nic_poll
)paren
suffix:semicolon
id|np-&gt;nic_poll.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;nic_poll.function
op_assign
op_amp
id|nv_do_nic_poll
suffix:semicolon
multiline_comment|/* timer handler */
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: pci_enable_dev failed (%d) for device %s&bslash;n&quot;
comma
id|err
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_goto
id|out_free
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pci_dev
comma
id|DRV_NAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|out_disable
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|addr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEVICE_COUNT_RESOURCE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: resource %d start %p len %ld flags 0x%08lx.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|i
comma
(paren
r_void
op_star
)paren
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
id|i
)paren
comma
id|pci_resource_len
c_func
(paren
id|pci_dev
comma
id|i
)paren
comma
id|pci_resource_flags
c_func
(paren
id|pci_dev
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_resource_flags
c_func
(paren
id|pci_dev
comma
id|i
)paren
op_amp
id|IORESOURCE_MEM
op_logical_and
id|pci_resource_len
c_func
(paren
id|pci_dev
comma
id|i
)paren
op_ge
id|NV_PCI_REGSZ
)paren
(brace
id|addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|DEVICE_COUNT_RESOURCE
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: Couldn&squot;t find register window for device %s.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_goto
id|out_relreg
suffix:semicolon
)brace
multiline_comment|/* handle different descriptor versions */
r_if
c_cond
(paren
id|pci_dev-&gt;device
op_eq
id|PCI_DEVICE_ID_NVIDIA_NVENET_1
op_logical_or
id|pci_dev-&gt;device
op_eq
id|PCI_DEVICE_ID_NVIDIA_NVENET_2
op_logical_or
id|pci_dev-&gt;device
op_eq
id|PCI_DEVICE_ID_NVIDIA_NVENET_3
)paren
id|np-&gt;desc_ver
op_assign
id|DESC_VER_1
suffix:semicolon
r_else
id|np-&gt;desc_ver
op_assign
id|DESC_VER_2
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|np-&gt;base
op_assign
id|ioremap
c_func
(paren
id|addr
comma
id|NV_PCI_REGSZ
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;base
)paren
r_goto
id|out_relreg
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|np-&gt;base
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|np-&gt;rx_ring
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
op_amp
id|np-&gt;ring_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|np-&gt;rx_ring
)paren
r_goto
id|out_unmap
suffix:semicolon
id|np-&gt;tx_ring
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|RX_RING
)braket
suffix:semicolon
id|dev-&gt;open
op_assign
id|nv_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|nv_close
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|nv_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|nv_get_stats
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|nv_change_mtu
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|nv_set_multicast
suffix:semicolon
id|SET_ETHTOOL_OPS
c_func
(paren
id|dev
comma
op_amp
id|ops
)paren
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|nv_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|NV_WATCHDOG_TIMEO
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* read the mac address */
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_assign
id|readl
c_func
(paren
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_assign
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_valid_ether_addr
c_func
(paren
id|dev-&gt;dev_addr
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Bad mac address. At least one bios sets the mac address&n;&t;&t; * to 01:23:45:67:89:ab&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Invalid Mac address detected: %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Please complain to your hardware vendor. Switching to a random MAC.&bslash;n&quot;
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
l_int|0x6c
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
l_int|3
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: MAC Address %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
)paren
suffix:semicolon
multiline_comment|/* disable WOL */
id|writel
c_func
(paren
l_int|0
comma
id|base
op_plus
id|NvRegWakeUpFlags
)paren
suffix:semicolon
id|np-&gt;wolenabled
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;desc_ver
op_eq
id|DESC_VER_1
)paren
(brace
id|np-&gt;tx_flags
op_assign
id|NV_TX_LASTPACKET
op_or
id|NV_TX_VALID
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_NEED_LASTPACKET1
)paren
id|np-&gt;tx_flags
op_or_assign
id|NV_TX_LASTPACKET1
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;tx_flags
op_assign
id|NV_TX2_LASTPACKET
op_or
id|NV_TX2_VALID
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_NEED_LASTPACKET1
)paren
id|np-&gt;tx_flags
op_or_assign
id|NV_TX2_LASTPACKET1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_IRQMASK_1
)paren
id|np-&gt;irqmask
op_assign
id|NVREG_IRQMASK_WANTED_1
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_IRQMASK_2
)paren
id|np-&gt;irqmask
op_assign
id|NVREG_IRQMASK_WANTED_2
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_NEED_TIMERIRQ
)paren
id|np-&gt;irqmask
op_or_assign
id|NVREG_IRQ_TIMER
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;driver_data
op_amp
id|DEV_NEED_LINKTIMER
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link timer on.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
id|np-&gt;need_linktimer
op_assign
l_int|1
suffix:semicolon
id|np-&gt;link_timeout
op_assign
id|jiffies
op_plus
id|LINK_TIMEOUT
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link timer off.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
id|np-&gt;need_linktimer
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* find a suitable phy */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|id1
comma
id|id2
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|id1
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|i
comma
id|MII_PHYSID1
comma
id|MII_READ
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id1
OL
l_int|0
op_logical_or
id|id1
op_eq
l_int|0xffff
)paren
r_continue
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
id|id2
op_assign
id|mii_rw
c_func
(paren
id|dev
comma
id|i
comma
id|MII_PHYSID2
comma
id|MII_READ
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|np-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id2
OL
l_int|0
op_logical_or
id|id2
op_eq
l_int|0xffff
)paren
r_continue
suffix:semicolon
id|id1
op_assign
(paren
id|id1
op_amp
id|PHYID1_OUI_MASK
)paren
op_lshift
id|PHYID1_OUI_SHFT
suffix:semicolon
id|id2
op_assign
(paren
id|id2
op_amp
id|PHYID2_OUI_MASK
)paren
op_rshift
id|PHYID2_OUI_SHFT
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: open: Found PHY %04x:%04x at address %d.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
comma
id|id1
comma
id|id2
comma
id|i
)paren
suffix:semicolon
id|np-&gt;phyaddr
op_assign
id|i
suffix:semicolon
id|np-&gt;phy_oui
op_assign
id|id1
op_or
id|id2
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|32
)paren
(brace
multiline_comment|/* PHY in isolate mode? No phy attached and user wants to&n;&t;&t; * test loopback? Very odd, but can be correct.&n;&t;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: open: Could not find a valid PHY.&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ne
l_int|32
)paren
(brace
multiline_comment|/* reset it */
id|phy_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* set default link speed settings */
id|np-&gt;linkspeed
op_assign
id|NVREG_LINKSPEED_FORCE
op_or
id|NVREG_LINKSPEED_10
suffix:semicolon
id|np-&gt;duplex
op_assign
l_int|0
suffix:semicolon
id|np-&gt;autoneg
op_assign
l_int|1
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth: unable to register netdev: %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_goto
id|out_freering
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: forcedeth.c: subsystem: %05x:%04x bound to %s&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|pci_dev-&gt;subsystem_vendor
comma
id|pci_dev-&gt;subsystem_device
comma
id|pci_name
c_func
(paren
id|pci_dev
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_freering
suffix:colon
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
id|np-&gt;rx_ring
comma
id|np-&gt;ring_addr
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
id|out_unmap
suffix:colon
id|iounmap
c_func
(paren
id|get_hwbase
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|out_relreg
suffix:colon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|out_free
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|nv_remove
r_static
r_void
id|__devexit
id|nv_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_struct
id|fe_priv
op_star
id|np
op_assign
id|get_nvpriv
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u8
id|__iomem
op_star
id|base
op_assign
id|get_hwbase
c_func
(paren
id|dev
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* special op: write back the misordered MAC address - otherwise&n;&t; * the next nv_probe would see a wrong address.&n;&t; */
id|writel
c_func
(paren
id|np-&gt;orig_mac
(braket
l_int|0
)braket
comma
id|base
op_plus
id|NvRegMacAddrA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;orig_mac
(braket
l_int|1
)braket
comma
id|base
op_plus
id|NvRegMacAddrB
)paren
suffix:semicolon
multiline_comment|/* free all structures */
id|pci_free_consistent
c_func
(paren
id|np-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|ring_desc
)paren
op_star
(paren
id|RX_RING
op_plus
id|TX_RING
)paren
comma
id|np-&gt;rx_ring
comma
id|np-&gt;ring_addr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|get_hwbase
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|pci_tbl
r_static
r_struct
id|pci_device_id
id|pci_tbl
(braket
)braket
op_assign
(brace
(brace
multiline_comment|/* nForce Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_1
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_IRQMASK_1
op_or
id|DEV_NEED_TIMERIRQ
op_or
id|DEV_NEED_LINKTIMER
comma
)brace
comma
(brace
multiline_comment|/* nForce2 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_2
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
op_or
id|DEV_NEED_LINKTIMER
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_3
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
op_or
id|DEV_NEED_LINKTIMER
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_4
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_5
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_6
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* nForce3 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_7
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* CK804 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_8
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* CK804 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_9
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* MCP04 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_10
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
multiline_comment|/* MCP04 Ethernet Controller */
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_NVIDIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_NVIDIA_NVENET_11
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
dot
id|driver_data
op_assign
id|DEV_NEED_LASTPACKET1
op_or
id|DEV_IRQMASK_2
op_or
id|DEV_NEED_TIMERIRQ
comma
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;forcedeth&quot;
comma
dot
id|id_table
op_assign
id|pci_tbl
comma
dot
id|probe
op_assign
id|nv_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|nv_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|init_nic
r_static
r_int
id|__init
id|init_nic
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;forcedeth.c: Reverse Engineered nForce ethernet driver. Version %s.&bslash;n&quot;
comma
id|FORCEDETH_VERSION
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|exit_nic
r_static
r_void
id|__exit
id|exit_nic
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_param
c_func
(paren
id|max_interrupt_work
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;forcedeth maximum events handled per interrupt&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Manfred Spraul &lt;manfred@colorfullife.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Reverse Engineered nForce ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|pci_tbl
)paren
suffix:semicolon
DECL|variable|init_nic
id|module_init
c_func
(paren
id|init_nic
)paren
suffix:semicolon
DECL|variable|exit_nic
id|module_exit
c_func
(paren
id|exit_nic
)paren
suffix:semicolon
eof
