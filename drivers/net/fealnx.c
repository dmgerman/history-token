multiline_comment|/*&n;&t;Written 1998-2000 by Donald Becker.&n;&n;&t;This software may be used and distributed according to the terms of&n;&t;the GNU General Public License (GPL), incorporated herein by reference.&n;&t;Drivers based on or derived from this code fall under the GPL and must&n;&t;retain the authorship, copyright and license notice.  This file is not&n;&t;a complete program and may only be used when the entire operating&n;&t;system is licensed under the GPL.&n;&n;&t;The author may be reached as becker@scyld.com, or C/O&n;&t;Scyld Computing Corporation&n;&t;410 Severn Ave., Suite 210&n;&t;Annapolis MD 21403&n;&n;&t;Support information and updates available at&n;&t;http://www.scyld.com/network/pci-skeleton.html&n;*/
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
multiline_comment|/* 1-&gt; print debug message */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast). */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* Set the copy breakpoint for the copy-only-tiny-frames scheme. */
multiline_comment|/* Setting to &gt; 1518 effectively disables this feature.          */
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
suffix:semicolon
multiline_comment|/* Used to pass the media type, etc.                            */
multiline_comment|/* Both &squot;options[]&squot; and &squot;full_duplex[]&squot; should exist for driver */
multiline_comment|/* interoperability.                                            */
multiline_comment|/* The media type is usually passed in &squot;options[]&squot;.             */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8&t;&t;/* More are supported, limit only on options */
DECL|variable|options
r_static
r_int
id|options
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|full_duplex
r_static
r_int
id|full_duplex
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Operational parameters that are set at compile time.                 */
multiline_comment|/* Keep the ring sizes a power of two for compile efficiency.           */
multiline_comment|/* The compiler will convert &lt;unsigned&gt;&squot;%&squot;&lt;2^N&gt; into a bit mask.        */
multiline_comment|/* Making the Tx ring too large decreases the effectiveness of channel  */
multiline_comment|/* bonding and packet priority.                                         */
multiline_comment|/* There are no ill effects from too-large receive rings.               */
singleline_comment|// 88-12-9 modify,
singleline_comment|// #define TX_RING_SIZE    16
singleline_comment|// #define RX_RING_SIZE    32
DECL|macro|TX_RING_SIZE
mdefine_line|#define TX_RING_SIZE    6
DECL|macro|RX_RING_SIZE
mdefine_line|#define RX_RING_SIZE    12
DECL|macro|TX_TOTAL_SIZE
mdefine_line|#define TX_TOTAL_SIZE&t;TX_RING_SIZE*sizeof(struct fealnx_desc)
DECL|macro|RX_TOTAL_SIZE
mdefine_line|#define RX_TOTAL_SIZE&t;RX_RING_SIZE*sizeof(struct fealnx_desc)
multiline_comment|/* Operational parameters that usually are not changed. */
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT      (2*HZ)
DECL|macro|PKT_BUF_SZ
mdefine_line|#define PKT_BUF_SZ      1536&t;/* Size of each temporary Rx buffer. */
multiline_comment|/* Include files, designed to support most kernel versions 2.0.0 and later. */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;asm/processor.h&gt;&t;/* Processor type for cache alignment. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* These identify the driver base version and may not be removed. */
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|KERN_INFO
l_string|&quot;fealnx.c:v2.50 1/17/2001&bslash;n&quot;
suffix:semicolon
multiline_comment|/* This driver was written to use PCI memory space, however some x86 systems&n;   work only with I/O space accesses. */
macro_line|#ifndef __alpha__
DECL|macro|USE_IO_OPS
mdefine_line|#define USE_IO_OPS
macro_line|#endif
macro_line|#ifdef USE_IO_OPS
DECL|macro|readb
macro_line|#undef readb
DECL|macro|readw
macro_line|#undef readw
DECL|macro|readl
macro_line|#undef readl
DECL|macro|writeb
macro_line|#undef writeb
DECL|macro|writew
macro_line|#undef writew
DECL|macro|writel
macro_line|#undef writel
DECL|macro|readb
mdefine_line|#define readb inb
DECL|macro|readw
mdefine_line|#define readw inw
DECL|macro|readl
mdefine_line|#define readl inl
DECL|macro|writeb
mdefine_line|#define writeb outb
DECL|macro|writew
mdefine_line|#define writew outw
DECL|macro|writel
mdefine_line|#define writel outl
macro_line|#endif
multiline_comment|/* Kernel compatibility defines, some common to David Hinds&squot; PCMCIA package. */
multiline_comment|/* This is only in the support-all-kernels source code. */
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Myson or whoever&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Myson MTD-8xx 100/10M Ethernet PCI Adapter Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
singleline_comment|//MODULE_PARM(min_pci_latency, &quot;i&quot;);
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|options
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|full_duplex
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;fealnx maximum events handled per interrupt&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;fealnx enable debugging (0-1)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;fealnx copy breakpoint for copy-only-tiny-frames&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;fealnx maximum number of filtered multicast addresses&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|options
comma
l_string|&quot;fealnx: Bits 0-3: media type, bit 17: full duplex&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|full_duplex
comma
l_string|&quot;fealnx full duplex setting(s) (1)&quot;
)paren
suffix:semicolon
DECL|macro|MIN_REGION_SIZE
mdefine_line|#define MIN_REGION_SIZE 136
DECL|enum|pci_flags_bit
r_enum
id|pci_flags_bit
(brace
DECL|enumerator|PCI_USES_IO
id|PCI_USES_IO
op_assign
l_int|1
comma
DECL|enumerator|PCI_USES_MEM
id|PCI_USES_MEM
op_assign
l_int|2
comma
DECL|enumerator|PCI_USES_MASTER
id|PCI_USES_MASTER
op_assign
l_int|4
comma
DECL|enumerator|PCI_ADDR0
id|PCI_ADDR0
op_assign
l_int|0x10
op_lshift
l_int|0
comma
DECL|enumerator|PCI_ADDR1
id|PCI_ADDR1
op_assign
l_int|0x10
op_lshift
l_int|1
comma
DECL|enumerator|PCI_ADDR2
id|PCI_ADDR2
op_assign
l_int|0x10
op_lshift
l_int|2
comma
DECL|enumerator|PCI_ADDR3
id|PCI_ADDR3
op_assign
l_int|0x10
op_lshift
l_int|3
comma
)brace
suffix:semicolon
multiline_comment|/* A chip capabilities table, matching the entries in pci_tbl[] above. */
DECL|enum|chip_capability_flags
r_enum
id|chip_capability_flags
(brace
DECL|enumerator|HAS_MII_XCVR
id|HAS_MII_XCVR
comma
DECL|enumerator|HAS_CHIP_XCVR
id|HAS_CHIP_XCVR
comma
)brace
suffix:semicolon
multiline_comment|/* 89/6/13 add, */
multiline_comment|/* for different PHY */
DECL|enum|phy_type_flags
r_enum
id|phy_type_flags
(brace
DECL|enumerator|MysonPHY
id|MysonPHY
op_assign
l_int|1
comma
DECL|enumerator|AhdocPHY
id|AhdocPHY
op_assign
l_int|2
comma
DECL|enumerator|SeeqPHY
id|SeeqPHY
op_assign
l_int|3
comma
DECL|enumerator|MarvellPHY
id|MarvellPHY
op_assign
l_int|4
comma
DECL|enumerator|Myson981
id|Myson981
op_assign
l_int|5
comma
DECL|enumerator|LevelOnePHY
id|LevelOnePHY
op_assign
l_int|6
comma
DECL|enumerator|OtherPHY
id|OtherPHY
op_assign
l_int|10
comma
)brace
suffix:semicolon
DECL|struct|chip_info
r_struct
id|chip_info
(brace
DECL|member|chip_name
r_char
op_star
id|chip_name
suffix:semicolon
DECL|member|io_size
r_int
id|io_size
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|skel_netdrv_tbl
r_static
r_struct
id|chip_info
id|skel_netdrv_tbl
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;100/10M Ethernet PCI Adapter&quot;
comma
l_int|136
comma
id|HAS_MII_XCVR
)brace
comma
(brace
l_string|&quot;100/10M Ethernet PCI Adapter&quot;
comma
l_int|136
comma
id|HAS_CHIP_XCVR
)brace
comma
(brace
l_string|&quot;1000/100/10M Ethernet PCI Adapter&quot;
comma
l_int|136
comma
id|HAS_MII_XCVR
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* Offsets to the Command and Status Registers. */
DECL|enum|fealnx_offsets
r_enum
id|fealnx_offsets
(brace
DECL|enumerator|PAR0
id|PAR0
op_assign
l_int|0x0
comma
multiline_comment|/* physical address 0-3 */
DECL|enumerator|PAR1
id|PAR1
op_assign
l_int|0x04
comma
multiline_comment|/* physical address 4-5 */
DECL|enumerator|MAR0
id|MAR0
op_assign
l_int|0x08
comma
multiline_comment|/* multicast address 0-3 */
DECL|enumerator|MAR1
id|MAR1
op_assign
l_int|0x0C
comma
multiline_comment|/* multicast address 4-7 */
DECL|enumerator|FAR0
id|FAR0
op_assign
l_int|0x10
comma
multiline_comment|/* flow-control address 0-3 */
DECL|enumerator|FAR1
id|FAR1
op_assign
l_int|0x14
comma
multiline_comment|/* flow-control address 4-5 */
DECL|enumerator|TCRRCR
id|TCRRCR
op_assign
l_int|0x18
comma
multiline_comment|/* receive &amp; transmit configuration */
DECL|enumerator|BCR
id|BCR
op_assign
l_int|0x1C
comma
multiline_comment|/* bus command */
DECL|enumerator|TXPDR
id|TXPDR
op_assign
l_int|0x20
comma
multiline_comment|/* transmit polling demand */
DECL|enumerator|RXPDR
id|RXPDR
op_assign
l_int|0x24
comma
multiline_comment|/* receive polling demand */
DECL|enumerator|RXCWP
id|RXCWP
op_assign
l_int|0x28
comma
multiline_comment|/* receive current word pointer */
DECL|enumerator|TXLBA
id|TXLBA
op_assign
l_int|0x2C
comma
multiline_comment|/* transmit list base address */
DECL|enumerator|RXLBA
id|RXLBA
op_assign
l_int|0x30
comma
multiline_comment|/* receive list base address */
DECL|enumerator|ISR
id|ISR
op_assign
l_int|0x34
comma
multiline_comment|/* interrupt status */
DECL|enumerator|IMR
id|IMR
op_assign
l_int|0x38
comma
multiline_comment|/* interrupt mask */
DECL|enumerator|FTH
id|FTH
op_assign
l_int|0x3C
comma
multiline_comment|/* flow control high/low threshold */
DECL|enumerator|MANAGEMENT
id|MANAGEMENT
op_assign
l_int|0x40
comma
multiline_comment|/* bootrom/eeprom and mii management */
DECL|enumerator|TALLY
id|TALLY
op_assign
l_int|0x44
comma
multiline_comment|/* tally counters for crc and mpa */
DECL|enumerator|TSR
id|TSR
op_assign
l_int|0x48
comma
multiline_comment|/* tally counter for transmit status */
DECL|enumerator|BMCRSR
id|BMCRSR
op_assign
l_int|0x4c
comma
multiline_comment|/* basic mode control and status */
DECL|enumerator|PHYIDENTIFIER
id|PHYIDENTIFIER
op_assign
l_int|0x50
comma
multiline_comment|/* phy identifier */
DECL|enumerator|ANARANLPAR
id|ANARANLPAR
op_assign
l_int|0x54
comma
multiline_comment|/* auto-negotiation advertisement and link&n;&t;&t;&t;&t;   partner ability */
DECL|enumerator|ANEROCR
id|ANEROCR
op_assign
l_int|0x58
comma
multiline_comment|/* auto-negotiation expansion and pci conf. */
DECL|enumerator|BPREMRPSR
id|BPREMRPSR
op_assign
l_int|0x5c
comma
multiline_comment|/* bypass &amp; receive error mask and phy status */
)brace
suffix:semicolon
multiline_comment|/* Bits in the interrupt status/enable registers. */
multiline_comment|/* The bits in the Intr Status/Enable registers, mostly interrupt sources. */
DECL|enum|intr_status_bits
r_enum
id|intr_status_bits
(brace
DECL|enumerator|RFCON
id|RFCON
op_assign
l_int|0x00020000
comma
multiline_comment|/* receive flow control xon packet */
DECL|enumerator|RFCOFF
id|RFCOFF
op_assign
l_int|0x00010000
comma
multiline_comment|/* receive flow control xoff packet */
DECL|enumerator|LSCStatus
id|LSCStatus
op_assign
l_int|0x00008000
comma
multiline_comment|/* link status change */
DECL|enumerator|ANCStatus
id|ANCStatus
op_assign
l_int|0x00004000
comma
multiline_comment|/* autonegotiation completed */
DECL|enumerator|FBE
id|FBE
op_assign
l_int|0x00002000
comma
multiline_comment|/* fatal bus error */
DECL|enumerator|FBEMask
id|FBEMask
op_assign
l_int|0x00001800
comma
multiline_comment|/* mask bit12-11 */
DECL|enumerator|ParityErr
id|ParityErr
op_assign
l_int|0x00000000
comma
multiline_comment|/* parity error */
DECL|enumerator|TargetErr
id|TargetErr
op_assign
l_int|0x00001000
comma
multiline_comment|/* target abort */
DECL|enumerator|MasterErr
id|MasterErr
op_assign
l_int|0x00000800
comma
multiline_comment|/* master error */
DECL|enumerator|TUNF
id|TUNF
op_assign
l_int|0x00000400
comma
multiline_comment|/* transmit underflow */
DECL|enumerator|ROVF
id|ROVF
op_assign
l_int|0x00000200
comma
multiline_comment|/* receive overflow */
DECL|enumerator|ETI
id|ETI
op_assign
l_int|0x00000100
comma
multiline_comment|/* transmit early int */
DECL|enumerator|ERI
id|ERI
op_assign
l_int|0x00000080
comma
multiline_comment|/* receive early int */
DECL|enumerator|CNTOVF
id|CNTOVF
op_assign
l_int|0x00000040
comma
multiline_comment|/* counter overflow */
DECL|enumerator|RBU
id|RBU
op_assign
l_int|0x00000020
comma
multiline_comment|/* receive buffer unavailable */
DECL|enumerator|TBU
id|TBU
op_assign
l_int|0x00000010
comma
multiline_comment|/* transmit buffer unavilable */
DECL|enumerator|TI
id|TI
op_assign
l_int|0x00000008
comma
multiline_comment|/* transmit interrupt */
DECL|enumerator|RI
id|RI
op_assign
l_int|0x00000004
comma
multiline_comment|/* receive interrupt */
DECL|enumerator|RxErr
id|RxErr
op_assign
l_int|0x00000002
comma
multiline_comment|/* receive error */
)brace
suffix:semicolon
multiline_comment|/* Bits in the NetworkConfig register. */
DECL|enum|rx_mode_bits
r_enum
id|rx_mode_bits
(brace
DECL|enumerator|RxModeMask
id|RxModeMask
op_assign
l_int|0xe0
comma
DECL|enumerator|PROM
id|PROM
op_assign
l_int|0x80
comma
multiline_comment|/* promiscuous mode */
DECL|enumerator|AB
id|AB
op_assign
l_int|0x40
comma
multiline_comment|/* accept broadcast */
DECL|enumerator|AM
id|AM
op_assign
l_int|0x20
comma
multiline_comment|/* accept mutlicast */
DECL|enumerator|ARP
id|ARP
op_assign
l_int|0x08
comma
multiline_comment|/* receive runt pkt */
DECL|enumerator|ALP
id|ALP
op_assign
l_int|0x04
comma
multiline_comment|/* receive long pkt */
DECL|enumerator|SEP
id|SEP
op_assign
l_int|0x02
comma
multiline_comment|/* receive error pkt */
)brace
suffix:semicolon
multiline_comment|/* The Tulip Rx and Tx buffer descriptors. */
DECL|struct|fealnx_desc
r_struct
id|fealnx_desc
(brace
DECL|member|status
id|s32
id|status
suffix:semicolon
DECL|member|control
id|s32
id|control
suffix:semicolon
DECL|member|buffer
id|u32
id|buffer
suffix:semicolon
DECL|member|next_desc
id|u32
id|next_desc
suffix:semicolon
DECL|member|next_desc_logical
r_struct
id|fealnx_desc
op_star
id|next_desc_logical
suffix:semicolon
DECL|member|skbuff
r_struct
id|sk_buff
op_star
id|skbuff
suffix:semicolon
DECL|member|reserved1
id|u32
id|reserved1
suffix:semicolon
DECL|member|reserved2
id|u32
id|reserved2
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Bits in network_desc.status */
DECL|enum|rx_desc_status_bits
r_enum
id|rx_desc_status_bits
(brace
DECL|enumerator|RXOWN
id|RXOWN
op_assign
l_int|0x80000000
comma
multiline_comment|/* own bit */
DECL|enumerator|FLNGMASK
id|FLNGMASK
op_assign
l_int|0x0fff0000
comma
multiline_comment|/* frame length */
DECL|enumerator|FLNGShift
id|FLNGShift
op_assign
l_int|16
comma
DECL|enumerator|MARSTATUS
id|MARSTATUS
op_assign
l_int|0x00004000
comma
multiline_comment|/* multicast address received */
DECL|enumerator|BARSTATUS
id|BARSTATUS
op_assign
l_int|0x00002000
comma
multiline_comment|/* broadcast address received */
DECL|enumerator|PHYSTATUS
id|PHYSTATUS
op_assign
l_int|0x00001000
comma
multiline_comment|/* physical address received */
DECL|enumerator|RXFSD
id|RXFSD
op_assign
l_int|0x00000800
comma
multiline_comment|/* first descriptor */
DECL|enumerator|RXLSD
id|RXLSD
op_assign
l_int|0x00000400
comma
multiline_comment|/* last descriptor */
DECL|enumerator|ErrorSummary
id|ErrorSummary
op_assign
l_int|0x80
comma
multiline_comment|/* error summary */
DECL|enumerator|RUNT
id|RUNT
op_assign
l_int|0x40
comma
multiline_comment|/* runt packet received */
DECL|enumerator|LONG
id|LONG
op_assign
l_int|0x20
comma
multiline_comment|/* long packet received */
DECL|enumerator|FAE
id|FAE
op_assign
l_int|0x10
comma
multiline_comment|/* frame align error */
DECL|enumerator|CRC
id|CRC
op_assign
l_int|0x08
comma
multiline_comment|/* crc error */
DECL|enumerator|RXER
id|RXER
op_assign
l_int|0x04
comma
multiline_comment|/* receive error */
)brace
suffix:semicolon
DECL|enum|rx_desc_control_bits
r_enum
id|rx_desc_control_bits
(brace
DECL|enumerator|RXIC
id|RXIC
op_assign
l_int|0x00800000
comma
multiline_comment|/* interrupt control */
DECL|enumerator|RBSShift
id|RBSShift
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|enum|tx_desc_status_bits
r_enum
id|tx_desc_status_bits
(brace
DECL|enumerator|TXOWN
id|TXOWN
op_assign
l_int|0x80000000
comma
multiline_comment|/* own bit */
DECL|enumerator|JABTO
id|JABTO
op_assign
l_int|0x00004000
comma
multiline_comment|/* jabber timeout */
DECL|enumerator|CSL
id|CSL
op_assign
l_int|0x00002000
comma
multiline_comment|/* carrier sense lost */
DECL|enumerator|LC
id|LC
op_assign
l_int|0x00001000
comma
multiline_comment|/* late collision */
DECL|enumerator|EC
id|EC
op_assign
l_int|0x00000800
comma
multiline_comment|/* excessive collision */
DECL|enumerator|UDF
id|UDF
op_assign
l_int|0x00000400
comma
multiline_comment|/* fifo underflow */
DECL|enumerator|DFR
id|DFR
op_assign
l_int|0x00000200
comma
multiline_comment|/* deferred */
DECL|enumerator|HF
id|HF
op_assign
l_int|0x00000100
comma
multiline_comment|/* heartbeat fail */
DECL|enumerator|NCRMask
id|NCRMask
op_assign
l_int|0x000000ff
comma
multiline_comment|/* collision retry count */
DECL|enumerator|NCRShift
id|NCRShift
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|enum|tx_desc_control_bits
r_enum
id|tx_desc_control_bits
(brace
DECL|enumerator|TXIC
id|TXIC
op_assign
l_int|0x80000000
comma
multiline_comment|/* interrupt control */
DECL|enumerator|ETIControl
id|ETIControl
op_assign
l_int|0x40000000
comma
multiline_comment|/* early transmit interrupt */
DECL|enumerator|TXLD
id|TXLD
op_assign
l_int|0x20000000
comma
multiline_comment|/* last descriptor */
DECL|enumerator|TXFD
id|TXFD
op_assign
l_int|0x10000000
comma
multiline_comment|/* first descriptor */
DECL|enumerator|CRCEnable
id|CRCEnable
op_assign
l_int|0x08000000
comma
multiline_comment|/* crc control */
DECL|enumerator|PADEnable
id|PADEnable
op_assign
l_int|0x04000000
comma
multiline_comment|/* padding control */
DECL|enumerator|RetryTxLC
id|RetryTxLC
op_assign
l_int|0x02000000
comma
multiline_comment|/* retry late collision */
DECL|enumerator|PKTSMask
id|PKTSMask
op_assign
l_int|0x3ff800
comma
multiline_comment|/* packet size bit21-11 */
DECL|enumerator|PKTSShift
id|PKTSShift
op_assign
l_int|11
comma
DECL|enumerator|TBSMask
id|TBSMask
op_assign
l_int|0x000007ff
comma
multiline_comment|/* transmit buffer bit 10-0 */
DECL|enumerator|TBSShift
id|TBSShift
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* BootROM/EEPROM/MII Management Register */
DECL|macro|MASK_MIIR_MII_READ
mdefine_line|#define MASK_MIIR_MII_READ       0x00000000
DECL|macro|MASK_MIIR_MII_WRITE
mdefine_line|#define MASK_MIIR_MII_WRITE      0x00000008
DECL|macro|MASK_MIIR_MII_MDO
mdefine_line|#define MASK_MIIR_MII_MDO        0x00000004
DECL|macro|MASK_MIIR_MII_MDI
mdefine_line|#define MASK_MIIR_MII_MDI        0x00000002
DECL|macro|MASK_MIIR_MII_MDC
mdefine_line|#define MASK_MIIR_MII_MDC        0x00000001
multiline_comment|/* ST+OP+PHYAD+REGAD+TA */
DECL|macro|OP_READ
mdefine_line|#define OP_READ             0x6000&t;/* ST:01+OP:10+PHYAD+REGAD+TA:Z0 */
DECL|macro|OP_WRITE
mdefine_line|#define OP_WRITE            0x5002&t;/* ST:01+OP:01+PHYAD+REGAD+TA:10 */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*      Constants for Myson PHY                                              */
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|macro|MysonPHYID
mdefine_line|#define MysonPHYID      0xd0000302
multiline_comment|/* 89-7-27 add, (begin) */
DECL|macro|MysonPHYID0
mdefine_line|#define MysonPHYID0     0x0302
DECL|macro|StatusRegister
mdefine_line|#define StatusRegister  18
DECL|macro|SPEED100
mdefine_line|#define SPEED100        0x0400&t;
singleline_comment|// bit10
DECL|macro|FULLMODE
mdefine_line|#define FULLMODE        0x0800&t;
singleline_comment|// bit11
multiline_comment|/* 89-7-27 add, (end) */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*      Constants for Seeq 80225 PHY                                         */
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|macro|SeeqPHYID0
mdefine_line|#define SeeqPHYID0      0x0016
DECL|macro|MIIRegister18
mdefine_line|#define MIIRegister18   18
DECL|macro|SPD_DET_100
mdefine_line|#define SPD_DET_100     0x80
DECL|macro|DPLX_DET_FULL
mdefine_line|#define DPLX_DET_FULL   0x40
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*      Constants for Ahdoc 101 PHY                                          */
multiline_comment|/* ------------------------------------------------------------------------- */
DECL|macro|AhdocPHYID0
mdefine_line|#define AhdocPHYID0     0x0022
DECL|macro|DiagnosticReg
mdefine_line|#define DiagnosticReg   18
DECL|macro|DPLX_FULL
mdefine_line|#define DPLX_FULL       0x0800
DECL|macro|Speed_100
mdefine_line|#define Speed_100       0x0400
multiline_comment|/* 89/6/13 add, */
multiline_comment|/* -------------------------------------------------------------------------- */
multiline_comment|/*      Constants                                                             */
multiline_comment|/* -------------------------------------------------------------------------- */
DECL|macro|MarvellPHYID0
mdefine_line|#define MarvellPHYID0           0x0141
DECL|macro|LevelOnePHYID0
mdefine_line|#define LevelOnePHYID0&t;&t;0x0013
DECL|macro|MII1000BaseTControlReg
mdefine_line|#define MII1000BaseTControlReg  9
DECL|macro|MII1000BaseTStatusReg
mdefine_line|#define MII1000BaseTStatusReg   10
DECL|macro|SpecificReg
mdefine_line|#define SpecificReg&t;&t;17
multiline_comment|/* for 1000BaseT Control Register */
DECL|macro|PHYAbletoPerform1000FullDuplex
mdefine_line|#define PHYAbletoPerform1000FullDuplex  0x0200
DECL|macro|PHYAbletoPerform1000HalfDuplex
mdefine_line|#define PHYAbletoPerform1000HalfDuplex  0x0100
DECL|macro|PHY1000AbilityMask
mdefine_line|#define PHY1000AbilityMask              0x300
singleline_comment|// for phy specific status register, marvell phy.
DECL|macro|SpeedMask
mdefine_line|#define SpeedMask       0x0c000
DECL|macro|Speed_1000M
mdefine_line|#define Speed_1000M     0x08000
DECL|macro|Speed_100M
mdefine_line|#define Speed_100M      0x4000
DECL|macro|Speed_10M
mdefine_line|#define Speed_10M       0
DECL|macro|Full_Duplex
mdefine_line|#define Full_Duplex     0x2000
singleline_comment|// 89/12/29 add, for phy specific status register, levelone phy, (begin)
DECL|macro|LXT1000_100M
mdefine_line|#define LXT1000_100M    0x08000
DECL|macro|LXT1000_1000M
mdefine_line|#define LXT1000_1000M   0x0c000
DECL|macro|LXT1000_Full
mdefine_line|#define LXT1000_Full    0x200
singleline_comment|// 89/12/29 add, for phy specific status register, levelone phy, (end)
multiline_comment|/* for 3-in-1 case */
DECL|macro|PS10
mdefine_line|#define PS10            0x00080000
DECL|macro|FD
mdefine_line|#define FD              0x00100000
DECL|macro|PS1000
mdefine_line|#define PS1000          0x00010000
DECL|macro|LinkIsUp2
mdefine_line|#define LinkIsUp2&t;0x00040000
multiline_comment|/* for PHY */
DECL|macro|LinkIsUp
mdefine_line|#define LinkIsUp        0x0004
DECL|struct|netdev_private
r_struct
id|netdev_private
(brace
multiline_comment|/* Descriptor rings first for alignment. */
DECL|member|rx_ring
r_struct
id|fealnx_desc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring
r_struct
id|fealnx_desc
op_star
id|tx_ring
suffix:semicolon
DECL|member|rx_ring_dma
id|dma_addr_t
id|rx_ring_dma
suffix:semicolon
DECL|member|tx_ring_dma
id|dma_addr_t
id|tx_ring_dma
suffix:semicolon
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
multiline_comment|/* Media monitoring timer. */
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Frequently used values: keep some adjacent for cache effect. */
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|crvalue
r_int
r_int
id|crvalue
suffix:semicolon
DECL|member|bcrvalue
r_int
r_int
id|bcrvalue
suffix:semicolon
DECL|member|imrvalue
r_int
r_int
id|imrvalue
suffix:semicolon
DECL|member|cur_rx
r_struct
id|fealnx_desc
op_star
id|cur_rx
suffix:semicolon
DECL|member|lack_rxbuf
r_struct
id|fealnx_desc
op_star
id|lack_rxbuf
suffix:semicolon
DECL|member|really_rx_count
r_int
id|really_rx_count
suffix:semicolon
DECL|member|cur_tx
r_struct
id|fealnx_desc
op_star
id|cur_tx
suffix:semicolon
DECL|member|cur_tx_copy
r_struct
id|fealnx_desc
op_star
id|cur_tx_copy
suffix:semicolon
DECL|member|really_tx_count
r_int
id|really_tx_count
suffix:semicolon
DECL|member|free_tx_count
r_int
id|free_tx_count
suffix:semicolon
DECL|member|rx_buf_sz
r_int
r_int
id|rx_buf_sz
suffix:semicolon
multiline_comment|/* Based on MTU+slack. */
multiline_comment|/* These values are keep track of the transceiver/media in use. */
DECL|member|linkok
r_int
r_int
id|linkok
suffix:semicolon
DECL|member|line_speed
r_int
r_int
id|line_speed
suffix:semicolon
DECL|member|duplexmode
r_int
r_int
id|duplexmode
suffix:semicolon
DECL|member|full_duplex
r_int
r_int
id|full_duplex
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Full-duplex operation requested. */
DECL|member|duplex_lock
r_int
r_int
id|duplex_lock
suffix:colon
l_int|1
suffix:semicolon
DECL|member|medialock
r_int
r_int
id|medialock
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* Do not sense media. */
DECL|member|default_port
r_int
r_int
id|default_port
suffix:colon
l_int|4
suffix:semicolon
multiline_comment|/* Last dev-&gt;if_port value. */
DECL|member|PHYType
r_int
r_int
id|PHYType
suffix:semicolon
multiline_comment|/* MII transceiver section. */
DECL|member|mii_cnt
r_int
id|mii_cnt
suffix:semicolon
multiline_comment|/* MII device addresses. */
DECL|member|phys
r_int
r_char
id|phys
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* MII device addresses. */
)brace
suffix:semicolon
r_static
r_int
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|getlinktype
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|getlinkstatus
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_inline
r_int
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|stop_nic_tx
r_void
id|stop_nic_tx
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|crvalue
)paren
(brace
id|writel
c_func
(paren
id|crvalue
op_amp
(paren
op_complement
l_int|0x40000
)paren
comma
id|ioaddr
op_plus
id|TCRRCR
)paren
suffix:semicolon
multiline_comment|/* wait for tx stop */
(brace
r_int
id|i
op_assign
l_int|0
comma
id|delay
op_assign
l_int|0x1000
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TCRRCR
)paren
op_amp
l_int|0x04000000
)paren
)paren
op_logical_and
(paren
id|i
OL
id|delay
)paren
)paren
(brace
op_increment
id|i
suffix:semicolon
)brace
)brace
)brace
DECL|function|stop_nic_rx
r_void
id|stop_nic_rx
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|crvalue
)paren
(brace
id|writel
c_func
(paren
id|crvalue
op_amp
(paren
op_complement
l_int|0x1
)paren
comma
id|ioaddr
op_plus
id|TCRRCR
)paren
suffix:semicolon
multiline_comment|/* wait for rx stop */
(brace
r_int
id|i
op_assign
l_int|0
comma
id|delay
op_assign
l_int|0x1000
suffix:semicolon
r_while
c_loop
(paren
(paren
op_logical_neg
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TCRRCR
)paren
op_amp
l_int|0x00008000
)paren
)paren
op_logical_and
(paren
id|i
OL
id|delay
)paren
)paren
(brace
op_increment
id|i
suffix:semicolon
)brace
)brace
)brace
DECL|function|fealnx_init_one
r_static
r_int
id|__devinit
id|fealnx_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
suffix:semicolon
r_int
id|i
comma
id|option
comma
id|err
comma
id|irq
suffix:semicolon
r_static
r_int
id|card_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_char
id|boardname
(braket
l_int|12
)braket
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
r_int
id|chip_id
op_assign
id|ent-&gt;driver_data
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_void
op_star
id|ring_space
suffix:semicolon
id|dma_addr_t
id|ring_dma
suffix:semicolon
multiline_comment|/* when built into the kernel, we only print version if device is found */
macro_line|#ifndef MODULE
r_static
r_int
id|printed_version
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
id|card_idx
op_increment
suffix:semicolon
id|sprintf
c_func
(paren
id|boardname
comma
l_string|&quot;fealnx%d&quot;
comma
id|card_idx
)paren
suffix:semicolon
id|option
op_assign
id|card_idx
OL
id|MAX_UNITS
ques
c_cond
id|options
(braket
id|card_idx
)braket
suffix:colon
l_int|0
suffix:semicolon
id|i
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
id|ioaddr
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
id|ioaddr
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ioaddr
OL
id|MIN_REGION_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: region size %ld too small, aborting&bslash;n&quot;
comma
id|boardname
comma
id|ioaddr
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|i
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|boardname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
r_return
id|i
suffix:semicolon
id|irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
macro_line|#ifdef USE_IO_OPS
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#else
id|ioaddr
op_assign
(paren
r_int
)paren
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioaddr
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_res
suffix:semicolon
)brace
macro_line|#endif
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|netdev_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_unmap
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* read ethernet id */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
op_increment
id|i
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|readb
c_func
(paren
id|ioaddr
op_plus
id|PAR0
op_plus
id|i
)paren
suffix:semicolon
multiline_comment|/* Reset the chip to erase previous misconfiguration. */
id|writel
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|BCR
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* Make certain the descriptor lists are aligned. */
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|np-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|np-&gt;flags
op_assign
id|skel_netdrv_tbl
(braket
id|chip_id
)braket
dot
id|flags
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_dev
suffix:semicolon
)brace
id|np-&gt;rx_ring
op_assign
(paren
r_struct
id|fealnx_desc
op_star
)paren
id|ring_space
suffix:semicolon
id|np-&gt;rx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_free_rx
suffix:semicolon
)brace
id|np-&gt;tx_ring
op_assign
(paren
r_struct
id|fealnx_desc
op_star
)paren
id|ring_space
suffix:semicolon
id|np-&gt;tx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
multiline_comment|/* find the connected MII xcvrs */
r_if
c_cond
(paren
id|np-&gt;flags
op_eq
id|HAS_MII_XCVR
)paren
(brace
r_int
id|phy
comma
id|phy_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
l_int|1
suffix:semicolon
id|phy
OL
l_int|32
op_logical_and
id|phy_idx
OL
l_int|4
suffix:semicolon
id|phy
op_increment
)paren
(brace
r_int
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_ne
l_int|0xffff
op_logical_and
id|mii_status
op_ne
l_int|0x0000
)paren
(brace
id|np-&gt;phys
(braket
id|phy_idx
op_increment
)braket
op_assign
id|phy
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: MII PHY found at address %d, status &quot;
l_string|&quot;0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|phy
comma
id|mii_status
)paren
suffix:semicolon
multiline_comment|/* get phy type */
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
id|SeeqPHYID0
)paren
id|np-&gt;PHYType
op_assign
id|SeeqPHY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|data
op_eq
id|AhdocPHYID0
)paren
id|np-&gt;PHYType
op_assign
id|AhdocPHY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|data
op_eq
id|MarvellPHYID0
)paren
id|np-&gt;PHYType
op_assign
id|MarvellPHY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|data
op_eq
id|MysonPHYID0
)paren
id|np-&gt;PHYType
op_assign
id|Myson981
suffix:semicolon
r_else
r_if
c_cond
(paren
id|data
op_eq
id|LevelOnePHYID0
)paren
id|np-&gt;PHYType
op_assign
id|LevelOnePHY
suffix:semicolon
r_else
id|np-&gt;PHYType
op_assign
id|OtherPHY
suffix:semicolon
)brace
)brace
)brace
id|np-&gt;mii_cnt
op_assign
id|phy_idx
suffix:semicolon
r_if
c_cond
(paren
id|phy_idx
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: MII PHY not found -- this device may &quot;
l_string|&quot;not operate correctly.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;phys
(braket
l_int|0
)braket
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* 89/6/23 add, (begin) */
multiline_comment|/* get phy type */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|PHYIDENTIFIER
)paren
op_eq
id|MysonPHYID
)paren
id|np-&gt;PHYType
op_assign
id|MysonPHY
suffix:semicolon
r_else
id|np-&gt;PHYType
op_assign
id|OtherPHY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;mem_start
)paren
id|option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
multiline_comment|/* The lower four bits are the media type. */
r_if
c_cond
(paren
id|option
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|option
op_amp
l_int|0x200
)paren
id|np-&gt;full_duplex
op_assign
l_int|1
suffix:semicolon
id|np-&gt;default_port
op_assign
id|option
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;default_port
)paren
id|np-&gt;medialock
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card_idx
template_param
l_int|0
)paren
id|np-&gt;full_duplex
op_assign
id|full_duplex
(braket
id|card_idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;full_duplex
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media type forced to Full Duplex.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* 89/6/13 add, (begin) */
singleline_comment|//      if (np-&gt;PHYType==MarvellPHY)
r_if
c_cond
(paren
(paren
id|np-&gt;PHYType
op_eq
id|MarvellPHY
)paren
op_logical_or
(paren
id|np-&gt;PHYType
op_eq
id|LevelOnePHY
)paren
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|9
)paren
suffix:semicolon
id|data
op_assign
(paren
id|data
op_amp
l_int|0xfcff
)paren
op_or
l_int|0x0200
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|9
comma
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* 89/6/13 add, (end) */
r_if
c_cond
(paren
id|np-&gt;flags
op_eq
id|HAS_MII_XCVR
)paren
id|mdio_write
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|4
comma
l_int|0x141
)paren
suffix:semicolon
r_else
id|writel
c_func
(paren
l_int|0x141
comma
id|dev-&gt;base_addr
op_plus
id|ANARANLPAR
)paren
suffix:semicolon
id|np-&gt;duplex_lock
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* The chip-specific entries in the device structure. */
id|dev-&gt;open
op_assign
op_amp
id|netdev_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
op_amp
id|start_tx
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|netdev_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
op_amp
id|get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_out_free_tx
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
comma
id|dev-&gt;name
comma
id|skel_netdrv_tbl
(braket
id|chip_id
)braket
dot
id|chip_name
comma
id|ioaddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x, IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
comma
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free_tx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
id|err_out_free_rx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|err_out_free_dev
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out_unmap
suffix:colon
macro_line|#ifndef USE_IO_OPS
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|ioaddr
)paren
suffix:semicolon
id|err_out_res
suffix:colon
macro_line|#endif
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|fealnx_remove_one
r_static
r_void
id|__devexit
id|fealnx_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|TX_TOTAL_SIZE
comma
id|np-&gt;tx_ring
comma
id|np-&gt;tx_ring_dma
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|RX_TOTAL_SIZE
comma
id|np-&gt;rx_ring
comma
id|np-&gt;rx_ring_dma
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifndef USE_IO_OPS
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|dev-&gt;base_addr
)paren
suffix:semicolon
macro_line|#endif
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;fealnx: remove for unknown device&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|m80x_read_tick
r_int
r_int
id|m80x_read_tick
c_func
(paren
r_void
)paren
multiline_comment|/* function: Reads the Timer tick count register which decrements by 2 from  */
multiline_comment|/*           65536 to 0 every 1/36.414 of a second. Each 2 decrements of the */
multiline_comment|/*           count represents 838 nsec&squot;s.                                    */
multiline_comment|/* input   : none.                                                           */
multiline_comment|/* output  : none.                                                           */
(brace
r_int
r_char
id|tmp
suffix:semicolon
r_int
id|value
suffix:semicolon
id|writeb
c_func
(paren
(paren
r_char
)paren
l_int|0x06
comma
l_int|0x43
)paren
suffix:semicolon
singleline_comment|// Command 8254 to latch T0&squot;s count
singleline_comment|// now read the count.
id|tmp
op_assign
(paren
r_int
r_char
)paren
id|readb
c_func
(paren
l_int|0x40
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
r_int
)paren
id|tmp
)paren
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_assign
(paren
r_int
r_char
)paren
id|readb
c_func
(paren
l_int|0x40
)paren
suffix:semicolon
id|value
op_or_assign
(paren
(paren
(paren
r_int
)paren
id|tmp
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
r_return
(paren
id|value
)paren
suffix:semicolon
)brace
DECL|function|m80x_delay
r_void
id|m80x_delay
c_func
(paren
r_int
r_int
id|interval
)paren
multiline_comment|/* function: to wait for a specified time.                                   */
multiline_comment|/* input   : interval ... the specified time.                                */
multiline_comment|/* output  : none.                                                           */
(brace
r_int
r_int
id|interval1
comma
id|interval2
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|interval1
op_assign
id|m80x_read_tick
c_func
(paren
)paren
suffix:semicolon
singleline_comment|// get initial value
r_do
(brace
id|interval2
op_assign
id|m80x_read_tick
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|interval1
OL
id|interval2
)paren
id|interval1
op_assign
id|interval2
suffix:semicolon
op_increment
id|i
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
(paren
id|interval1
op_minus
id|interval2
)paren
OL
(paren
id|ushort
)paren
id|interval
)paren
op_logical_and
(paren
id|i
OL
l_int|65535
)paren
)paren
suffix:semicolon
)brace
DECL|function|m80x_send_cmd_to_phy
r_static
id|ulong
id|m80x_send_cmd_to_phy
c_func
(paren
r_int
id|miiport
comma
r_int
id|opcode
comma
r_int
id|phyad
comma
r_int
id|regad
)paren
(brace
id|ulong
id|miir
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|mask
comma
id|data
suffix:semicolon
multiline_comment|/* enable MII output */
id|miir
op_assign
(paren
id|ulong
)paren
id|readl
c_func
(paren
id|miiport
)paren
suffix:semicolon
id|miir
op_and_assign
l_int|0xfffffff0
suffix:semicolon
id|miir
op_or_assign
id|MASK_MIIR_MII_WRITE
op_plus
id|MASK_MIIR_MII_MDO
suffix:semicolon
multiline_comment|/* send 32 1&squot;s preamble */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* low MDC; MDO is already high (miir) */
id|miir
op_and_assign
op_complement
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
multiline_comment|/* high MDC */
id|miir
op_or_assign
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
)brace
multiline_comment|/* calculate ST+OP+PHYAD+REGAD+TA */
id|data
op_assign
id|opcode
op_or
(paren
id|phyad
op_lshift
l_int|7
)paren
op_or
(paren
id|regad
op_lshift
l_int|2
)paren
suffix:semicolon
multiline_comment|/* sent out */
id|mask
op_assign
l_int|0x8000
suffix:semicolon
r_while
c_loop
(paren
id|mask
)paren
(brace
multiline_comment|/* low MDC, prepare MDO */
id|miir
op_and_assign
op_complement
(paren
id|MASK_MIIR_MII_MDC
op_plus
id|MASK_MIIR_MII_MDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|data
)paren
id|miir
op_or_assign
id|MASK_MIIR_MII_MDO
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
multiline_comment|/* high MDC */
id|miir
op_or_assign
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
id|m80x_delay
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* next */
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_eq
l_int|0x2
op_logical_and
id|opcode
op_eq
id|OP_READ
)paren
id|miir
op_and_assign
op_complement
id|MASK_MIIR_MII_WRITE
suffix:semicolon
)brace
r_return
id|miir
suffix:semicolon
)brace
DECL|function|mdio_read
r_static
r_int
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phyad
comma
r_int
id|regad
)paren
(brace
r_int
id|miiport
op_assign
id|dev-&gt;base_addr
op_plus
id|MANAGEMENT
suffix:semicolon
id|ulong
id|miir
suffix:semicolon
r_int
r_int
id|mask
comma
id|data
suffix:semicolon
id|miir
op_assign
id|m80x_send_cmd_to_phy
c_func
(paren
id|miiport
comma
id|OP_READ
comma
id|phyad
comma
id|regad
)paren
suffix:semicolon
multiline_comment|/* read data */
id|mask
op_assign
l_int|0x8000
suffix:semicolon
id|data
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mask
)paren
(brace
multiline_comment|/* low MDC */
id|miir
op_and_assign
op_complement
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
multiline_comment|/* read MDI */
id|miir
op_assign
id|readl
c_func
(paren
id|miiport
)paren
suffix:semicolon
r_if
c_cond
(paren
id|miir
op_amp
id|MASK_MIIR_MII_MDI
)paren
id|data
op_or_assign
id|mask
suffix:semicolon
multiline_comment|/* high MDC, and wait */
id|miir
op_or_assign
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
id|m80x_delay
c_func
(paren
(paren
r_int
)paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* next */
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* low MDC */
id|miir
op_and_assign
op_complement
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phyad
comma
r_int
id|regad
comma
r_int
id|data
)paren
(brace
r_int
id|miiport
op_assign
id|dev-&gt;base_addr
op_plus
id|MANAGEMENT
suffix:semicolon
id|ulong
id|miir
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
id|miir
op_assign
id|m80x_send_cmd_to_phy
c_func
(paren
id|miiport
comma
id|OP_WRITE
comma
id|phyad
comma
id|regad
)paren
suffix:semicolon
multiline_comment|/* write data */
id|mask
op_assign
l_int|0x8000
suffix:semicolon
r_while
c_loop
(paren
id|mask
)paren
(brace
multiline_comment|/* low MDC, prepare MDO */
id|miir
op_and_assign
op_complement
(paren
id|MASK_MIIR_MII_MDC
op_plus
id|MASK_MIIR_MII_MDO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|data
)paren
id|miir
op_or_assign
id|MASK_MIIR_MII_MDO
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
multiline_comment|/* high MDC */
id|miir
op_or_assign
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
multiline_comment|/* next */
id|mask
op_rshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* low MDC */
id|miir
op_and_assign
op_complement
id|MASK_MIIR_MII_MDC
suffix:semicolon
id|writel
c_func
(paren
id|miir
comma
id|miiport
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|netdev_open
r_static
r_int
id|netdev_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|writel
c_func
(paren
l_int|0x00000001
comma
id|ioaddr
op_plus
id|BCR
)paren
suffix:semicolon
multiline_comment|/* Reset */
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|intr_handler
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|RXLBA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|TXLBA
)paren
suffix:semicolon
multiline_comment|/* Initialize other registers. */
multiline_comment|/* Configure the PCI bus bursts and FIFO thresholds.&n;&t;   486: Set 8 longword burst.&n;&t;   586: no burst limit.&n;&t;   Burst length 5:3&n;&t;   0 0 0   1&n;&t;   0 0 1   4&n;&t;   0 1 0   8&n;&t;   0 1 1   16&n;&t;   1 0 0   32&n;&t;   1 0 1   64&n;&t;   1 1 0   128&n;&t;   1 1 1   256&n;&t;   Wait the specified 50 PCI cycles after a reset by initializing&n;&t;   Tx and Rx queues and the address filter list. */
macro_line|#if defined(__powerpc__) || defined(__sparc__)
singleline_comment|// 89/9/1 modify, 
singleline_comment|//   np-&gt;bcrvalue=0x04 | 0x0x38;  /* big-endian, 256 burst length */
id|np-&gt;bcrvalue
op_assign
l_int|0x04
op_or
l_int|0x10
suffix:semicolon
multiline_comment|/* big-endian, tx 8 burst length */
id|np-&gt;crvalue
op_assign
l_int|0xe00
suffix:semicolon
multiline_comment|/* rx 128 burst length */
macro_line|#elif defined(__alpha__) || defined(__x86_64__)
singleline_comment|// 89/9/1 modify, 
singleline_comment|//   np-&gt;bcrvalue=0x38;           /* little-endian, 256 burst length */
id|np-&gt;bcrvalue
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* little-endian, 8 burst length */
id|np-&gt;crvalue
op_assign
l_int|0xe00
suffix:semicolon
multiline_comment|/* rx 128 burst length */
macro_line|#elif defined(__i386__)
macro_line|#if defined(MODULE)
singleline_comment|// 89/9/1 modify, 
singleline_comment|//   np-&gt;bcrvalue=0x38;           /* little-endian, 256 burst length */
id|np-&gt;bcrvalue
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* little-endian, 8 burst length */
id|np-&gt;crvalue
op_assign
l_int|0xe00
suffix:semicolon
multiline_comment|/* rx 128 burst length */
macro_line|#else
multiline_comment|/* When not a module we can work around broken &squot;486 PCI boards. */
mdefine_line|#define x86 boot_cpu_data.x86
singleline_comment|// 89/9/1 modify, 
singleline_comment|//   np-&gt;bcrvalue=(x86 &lt;= 4 ? 0x10 : 0x38);
id|np-&gt;bcrvalue
op_assign
l_int|0x10
suffix:semicolon
id|np-&gt;crvalue
op_assign
(paren
id|x86
op_le
l_int|4
ques
c_cond
l_int|0xa00
suffix:colon
l_int|0xe00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x86
op_le
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: This is a 386/486 PCI system, setting burst &quot;
l_string|&quot;length to %x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|x86
op_le
l_int|4
ques
c_cond
l_int|0x10
suffix:colon
l_int|0x38
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else
singleline_comment|// 89/9/1 modify,
singleline_comment|//   np-&gt;bcrvalue=0x38;
id|np-&gt;bcrvalue
op_assign
l_int|0x10
suffix:semicolon
id|np-&gt;cralue
op_assign
l_int|0xe00
suffix:semicolon
multiline_comment|/* rx 128 burst length */
macro_line|#warning Processor architecture undefined!
macro_line|#endif
singleline_comment|// 89/12/29 add,
singleline_comment|// 90/1/16 modify,
singleline_comment|//   np-&gt;imrvalue=FBE|TUNF|CNTOVF|RBU|TI|RI;
id|np-&gt;imrvalue
op_assign
id|TUNF
op_or
id|CNTOVF
op_or
id|RBU
op_or
id|TI
op_or
id|RI
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;pci_dev-&gt;device
op_eq
l_int|0x891
)paren
(brace
id|np-&gt;bcrvalue
op_or_assign
l_int|0x200
suffix:semicolon
multiline_comment|/* set PROG bit */
id|np-&gt;crvalue
op_or_assign
l_int|0x02000000
suffix:semicolon
multiline_comment|/* set enhanced bit */
id|np-&gt;imrvalue
op_or_assign
id|ETI
suffix:semicolon
)brace
id|writel
c_func
(paren
id|np-&gt;bcrvalue
comma
id|ioaddr
op_plus
id|BCR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
l_int|0
)paren
id|dev-&gt;if_port
op_assign
id|np-&gt;default_port
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|RXPDR
)paren
suffix:semicolon
singleline_comment|// 89/9/1 modify,
singleline_comment|//   np-&gt;crvalue = 0x00e40001;    /* tx store and forward, tx/rx enable */
id|np-&gt;crvalue
op_or_assign
l_int|0x00e40001
suffix:semicolon
multiline_comment|/* tx store and forward, tx/rx enable */
id|np-&gt;full_duplex
op_assign
id|np-&gt;duplex_lock
suffix:semicolon
id|getlinkstatus
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;linkok
)paren
id|getlinktype
c_func
(paren
id|dev
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Clear and Enable interrupts by setting the interrupt mask. */
id|writel
c_func
(paren
id|FBE
op_or
id|TUNF
op_or
id|CNTOVF
op_or
id|RBU
op_or
id|TI
op_or
id|RI
comma
id|ioaddr
op_plus
id|ISR
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;imrvalue
comma
id|ioaddr
op_plus
id|IMR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Done netdev_open().&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Set the timer to check for link beat. */
id|init_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
l_int|3
op_star
id|HZ
)paren
suffix:semicolon
id|np-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|np-&gt;timer.function
op_assign
op_amp
id|netdev_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|getlinkstatus
r_static
r_void
id|getlinkstatus
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
multiline_comment|/* function: Routine will read MII Status Register to get link status.       */
multiline_comment|/* input   : dev... pointer to the adapter block.                            */
multiline_comment|/* output  : none.                                                           */
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|i
comma
id|DelayTime
op_assign
l_int|0x1000
suffix:semicolon
id|np-&gt;linkok
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|MysonPHY
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DelayTime
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|readl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|BMCRSR
)paren
op_amp
id|LinkIsUp2
)paren
(brace
id|np-&gt;linkok
op_assign
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// delay
id|m80x_delay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DelayTime
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
l_int|1
)paren
op_amp
l_int|0x4
)paren
(brace
id|np-&gt;linkok
op_assign
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// delay
id|m80x_delay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|getlinktype
r_static
r_void
id|getlinktype
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|MysonPHY
)paren
(brace
multiline_comment|/* 3-in-1 case */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|TCRRCR
)paren
op_amp
id|FD
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* full duplex */
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* half duplex */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|TCRRCR
)paren
op_amp
id|PS10
)paren
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 10M */
r_else
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* 100M */
)brace
r_else
(brace
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|SeeqPHY
)paren
(brace
multiline_comment|/* this PHY is SEEQ 80225 */
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|MIIRegister18
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SPD_DET_100
)paren
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* 100M */
r_else
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 10M */
r_if
c_cond
(paren
id|data
op_amp
id|DPLX_DET_FULL
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* full duplex mode */
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* half duplex mode */
)brace
r_else
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|AhdocPHY
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|DiagnosticReg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|Speed_100
)paren
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* 100M */
r_else
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 10M */
r_if
c_cond
(paren
id|data
op_amp
id|DPLX_FULL
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* full duplex mode */
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* half duplex mode */
)brace
multiline_comment|/* 89/6/13 add, (begin) */
r_else
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|MarvellPHY
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|SpecificReg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|Full_Duplex
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* full duplex mode */
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* half duplex mode */
id|data
op_and_assign
id|SpeedMask
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
id|Speed_1000M
)paren
id|np-&gt;line_speed
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* 1000M */
r_else
r_if
c_cond
(paren
id|data
op_eq
id|Speed_100M
)paren
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* 100M */
r_else
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 10M */
)brace
multiline_comment|/* 89/6/13 add, (end) */
multiline_comment|/* 89/7/27 add, (begin) */
r_else
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|Myson981
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|StatusRegister
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|SPEED100
)paren
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
r_else
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|FULLMODE
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* 89/7/27 add, (end) */
multiline_comment|/* 89/12/29 add */
r_else
r_if
c_cond
(paren
id|np-&gt;PHYType
op_eq
id|LevelOnePHY
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|np-&gt;phys
(braket
l_int|0
)braket
comma
id|SpecificReg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|LXT1000_Full
)paren
id|np-&gt;duplexmode
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* full duplex mode */
r_else
id|np-&gt;duplexmode
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* half duplex mode */
id|data
op_and_assign
id|SpeedMask
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
id|LXT1000_1000M
)paren
id|np-&gt;line_speed
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* 1000M */
r_else
r_if
c_cond
(paren
id|data
op_eq
id|LXT1000_100M
)paren
id|np-&gt;line_speed
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* 100M */
r_else
id|np-&gt;line_speed
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 10M */
)brace
singleline_comment|// chage crvalue
singleline_comment|// np-&gt;crvalue&amp;=(~PS10)&amp;(~FD);
id|np-&gt;crvalue
op_and_assign
(paren
op_complement
id|PS10
)paren
op_amp
(paren
op_complement
id|FD
)paren
op_amp
(paren
op_complement
id|PS1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;line_speed
op_eq
l_int|1
)paren
id|np-&gt;crvalue
op_or_assign
id|PS10
suffix:semicolon
r_else
r_if
c_cond
(paren
id|np-&gt;line_speed
op_eq
l_int|3
)paren
id|np-&gt;crvalue
op_or_assign
id|PS1000
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;duplexmode
op_eq
l_int|2
)paren
id|np-&gt;crvalue
op_or_assign
id|FD
suffix:semicolon
)brace
)brace
DECL|function|allocate_rx_buffers
r_static
r_void
id|allocate_rx_buffers
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*  allocate skb for rx buffers */
r_while
c_loop
(paren
id|np-&gt;really_rx_count
op_ne
id|RX_RING_SIZE
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
id|np-&gt;lack_rxbuf-&gt;skbuff
op_assign
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
multiline_comment|/* Better luck next round. */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;lack_rxbuf-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;lack_rxbuf
op_assign
id|np-&gt;lack_rxbuf-&gt;next_desc_logical
suffix:semicolon
op_increment
id|np-&gt;really_rx_count
suffix:semicolon
)brace
)brace
DECL|function|netdev_timer
r_static
r_void
id|netdev_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|next_tick
op_assign
l_int|10
op_star
id|HZ
suffix:semicolon
r_int
id|old_crvalue
op_assign
id|np-&gt;crvalue
suffix:semicolon
r_int
r_int
id|old_linkok
op_assign
id|np-&gt;linkok
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Media selection timer tick, status %8.8x &quot;
l_string|&quot;config %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|ioaddr
op_plus
id|ISR
)paren
comma
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TCRRCR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;flags
op_eq
id|HAS_MII_XCVR
)paren
(brace
id|getlinkstatus
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_linkok
op_eq
l_int|0
)paren
op_logical_and
(paren
id|np-&gt;linkok
op_eq
l_int|1
)paren
)paren
(brace
multiline_comment|/* we need to detect the media type again */
id|getlinktype
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;crvalue
op_ne
id|old_crvalue
)paren
(brace
id|stop_nic_tx
c_func
(paren
id|ioaddr
comma
id|np-&gt;crvalue
)paren
suffix:semicolon
id|stop_nic_rx
c_func
(paren
id|ioaddr
comma
id|np-&gt;crvalue
op_amp
(paren
op_complement
l_int|0x40000
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;crvalue
comma
id|ioaddr
op_plus
id|TCRRCR
)paren
suffix:semicolon
)brace
)brace
)brace
id|allocate_rx_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|np-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
id|next_tick
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|tx_timeout
r_static
r_void
id|tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmit timed out, status %8.8x,&quot;
l_string|&quot; resetting...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|ioaddr
op_plus
id|ISR
)paren
)paren
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  Rx ring %p: &quot;
comma
id|np-&gt;rx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
(paren
r_int
r_int
)paren
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
id|KERN_DEBUG
l_string|&quot;  Tx ring %p: &quot;
comma
id|np-&gt;tx_ring
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %4.4x&quot;
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Perhaps we should reinitialize the hardware here.  Just trigger a&n;&t;   Tx demand for now. */
id|writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|TXPDR
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Stop and restart the chip&squot;s Tx processes . */
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Initialize the Rx and Tx rings, along with various &squot;dev&squot; bits. */
DECL|function|init_ring
r_static
r_void
id|init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* initialize rx variables */
id|np-&gt;rx_buf_sz
op_assign
(paren
id|dev-&gt;mtu
op_le
l_int|1500
ques
c_cond
id|PKT_BUF_SZ
suffix:colon
id|dev-&gt;mtu
op_plus
l_int|32
)paren
suffix:semicolon
id|np-&gt;cur_rx
op_assign
op_amp
id|np-&gt;rx_ring
(braket
l_int|0
)braket
suffix:semicolon
id|np-&gt;lack_rxbuf
op_assign
l_int|NULL
suffix:semicolon
id|np-&gt;really_rx_count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initial rx descriptors. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|control
op_assign
id|np-&gt;rx_buf_sz
op_lshift
id|RBSShift
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|next_desc
op_assign
id|np-&gt;rx_ring_dma
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|fealnx_desc
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|next_desc_logical
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|skbuff
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* for the last rx descriptor */
id|np-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next_desc
op_assign
id|np-&gt;rx_ring_dma
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next_desc_logical
op_assign
id|np-&gt;rx_ring
suffix:semicolon
multiline_comment|/* allocate skb for rx buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|np-&gt;lack_rxbuf
op_assign
op_amp
id|np-&gt;rx_ring
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
op_increment
id|np-&gt;really_rx_count
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|skbuff
op_assign
id|skb
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
id|RXOWN
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|control
op_or_assign
id|RXIC
suffix:semicolon
)brace
multiline_comment|/* initialize tx variables */
id|np-&gt;cur_tx
op_assign
op_amp
id|np-&gt;tx_ring
(braket
l_int|0
)braket
suffix:semicolon
id|np-&gt;cur_tx_copy
op_assign
op_amp
id|np-&gt;tx_ring
(braket
l_int|0
)braket
suffix:semicolon
id|np-&gt;really_tx_count
op_assign
l_int|0
suffix:semicolon
id|np-&gt;free_tx_count
op_assign
id|TX_RING_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|next_desc
op_assign
id|np-&gt;tx_ring_dma
op_plus
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|fealnx_desc
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|next_desc_logical
op_assign
op_amp
id|np-&gt;tx_ring
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|skbuff
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* for the last tx descriptor */
id|np-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next_desc
op_assign
id|np-&gt;tx_ring_dma
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
op_minus
l_int|1
)braket
dot
id|next_desc_logical
op_assign
op_amp
id|np-&gt;tx_ring
(braket
l_int|0
)braket
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|start_tx
r_static
r_int
id|start_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;skbuff
op_assign
id|skb
suffix:semicolon
DECL|macro|one_buffer
mdefine_line|#define one_buffer
DECL|macro|BPT
mdefine_line|#define BPT 1022
macro_line|#if defined(one_buffer)
id|np-&gt;cur_tx_copy-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_assign
id|TXIC
op_or
id|TXLD
op_or
id|TXFD
op_or
id|CRCEnable
op_or
id|PADEnable
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|PKTSShift
)paren
suffix:semicolon
multiline_comment|/* pkt size */
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|TBSShift
)paren
suffix:semicolon
multiline_comment|/* buffer size */
singleline_comment|// 89/12/29 add,
r_if
c_cond
(paren
id|np-&gt;pci_dev-&gt;device
op_eq
l_int|0x891
)paren
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
id|ETIControl
op_or
id|RetryTxLC
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;status
op_assign
id|TXOWN
suffix:semicolon
id|np-&gt;cur_tx_copy
op_assign
id|np-&gt;cur_tx_copy-&gt;next_desc_logical
suffix:semicolon
op_decrement
id|np-&gt;free_tx_count
suffix:semicolon
macro_line|#elif defined(two_buffer)
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|BPT
)paren
(brace
r_struct
id|fealnx_desc
op_star
id|next
suffix:semicolon
multiline_comment|/* for the first descriptor */
id|np-&gt;cur_tx_copy-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|BPT
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_assign
id|TXIC
op_or
id|TXFD
op_or
id|CRCEnable
op_or
id|PADEnable
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|PKTSShift
)paren
suffix:semicolon
multiline_comment|/* pkt size */
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|BPT
op_lshift
id|TBSShift
)paren
suffix:semicolon
multiline_comment|/* buffer size */
multiline_comment|/* for the last descriptor */
id|next
op_assign
(paren
r_struct
id|fealnx
op_star
)paren
id|np-&gt;cur_tx_copy.next_desc_logical
suffix:semicolon
id|next-&gt;skbuff
op_assign
id|skb
suffix:semicolon
id|next-&gt;control
op_assign
id|TXIC
op_or
id|TXLD
op_or
id|CRCEnable
op_or
id|PADEnable
suffix:semicolon
id|next-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|PKTSShift
)paren
suffix:semicolon
multiline_comment|/* pkt size */
id|next-&gt;control
op_or_assign
(paren
(paren
id|skb-&gt;len
op_minus
id|BPT
)paren
op_lshift
id|TBSShift
)paren
suffix:semicolon
multiline_comment|/* buf size */
singleline_comment|// 89/12/29 add,
r_if
c_cond
(paren
id|np-&gt;pci_dev-&gt;device
op_eq
l_int|0x891
)paren
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
id|ETIControl
op_or
id|RetryTxLC
suffix:semicolon
id|next-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|ep-&gt;pci_dev
comma
id|skb-&gt;data
op_plus
id|BPT
comma
id|skb-&gt;len
op_minus
id|BPT
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|next-&gt;status
op_assign
id|TXOWN
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;status
op_assign
id|TXOWN
suffix:semicolon
id|np-&gt;cur_tx_copy
op_assign
id|next-&gt;next_desc_logical
suffix:semicolon
id|np-&gt;free_tx_count
op_sub_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;cur_tx_copy-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_assign
id|TXIC
op_or
id|TXLD
op_or
id|TXFD
op_or
id|CRCEnable
op_or
id|PADEnable
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|PKTSShift
)paren
suffix:semicolon
multiline_comment|/* pkt size */
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
(paren
id|skb-&gt;len
op_lshift
id|TBSShift
)paren
suffix:semicolon
multiline_comment|/* buffer size */
singleline_comment|// 89/12/29 add,
r_if
c_cond
(paren
id|np-&gt;pci_dev-&gt;device
op_eq
l_int|0x891
)paren
id|np-&gt;cur_tx_copy-&gt;control
op_or_assign
id|ETIControl
op_or
id|RetryTxLC
suffix:semicolon
id|np-&gt;cur_tx_copy-&gt;status
op_assign
id|TXOWN
suffix:semicolon
id|np-&gt;cur_tx_copy
op_assign
id|np-&gt;cur_tx_copy-&gt;next_desc_logical
suffix:semicolon
op_decrement
id|np-&gt;free_tx_count
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|np-&gt;free_tx_count
OL
l_int|2
)paren
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
op_increment
id|np-&gt;really_tx_count
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|TXPDR
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|free_one_rx_descriptor
r_void
id|free_one_rx_descriptor
c_func
(paren
r_struct
id|netdev_private
op_star
id|np
)paren
(brace
r_if
c_cond
(paren
id|np-&gt;really_rx_count
op_eq
id|RX_RING_SIZE
)paren
id|np-&gt;cur_rx-&gt;status
op_assign
id|RXOWN
suffix:semicolon
r_else
(brace
id|np-&gt;lack_rxbuf-&gt;skbuff
op_assign
id|np-&gt;cur_rx-&gt;skbuff
suffix:semicolon
id|np-&gt;lack_rxbuf-&gt;buffer
op_assign
id|np-&gt;cur_rx-&gt;buffer
suffix:semicolon
id|np-&gt;lack_rxbuf-&gt;status
op_assign
id|RXOWN
suffix:semicolon
op_increment
id|np-&gt;really_rx_count
suffix:semicolon
id|np-&gt;lack_rxbuf
op_assign
id|np-&gt;lack_rxbuf-&gt;next_desc_logical
suffix:semicolon
)brace
id|np-&gt;cur_rx
op_assign
id|np-&gt;cur_rx-&gt;next_desc_logical
suffix:semicolon
)brace
DECL|function|reset_rx_descriptors
r_void
id|reset_rx_descriptors
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
id|stop_nic_rx
c_func
(paren
id|dev-&gt;base_addr
comma
id|np-&gt;crvalue
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|np-&gt;cur_rx-&gt;status
op_amp
id|RXOWN
)paren
)paren
id|free_one_rx_descriptor
c_func
(paren
id|np
)paren
suffix:semicolon
id|allocate_rx_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;rx_ring_dma
op_plus
(paren
id|np-&gt;cur_rx
op_minus
id|np-&gt;rx_ring
)paren
comma
id|dev-&gt;base_addr
op_plus
id|RXLBA
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;crvalue
comma
id|dev-&gt;base_addr
op_plus
id|TCRRCR
)paren
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up&n;   after the Tx thread. */
DECL|function|intr_handler
r_static
r_void
id|intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|rgs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
comma
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
r_int
r_int
id|num_tx
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|dev-&gt;base_addr
op_plus
id|IMR
)paren
suffix:semicolon
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|np
op_assign
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_do
(brace
id|u32
id|intr_status
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|ISR
)paren
suffix:semicolon
multiline_comment|/* Acknowledge all of the current interrupt sources ASAP. */
id|writel
c_func
(paren
id|intr_status
comma
id|ioaddr
op_plus
id|ISR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Interrupt, status %4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|intr_status
op_amp
id|np-&gt;imrvalue
)paren
)paren
r_break
suffix:semicolon
singleline_comment|// 90/1/16 delete,
singleline_comment|//
singleline_comment|//      if (intr_status &amp; FBE)
singleline_comment|//      {   /* fatal error */
singleline_comment|//          stop_nic_tx(ioaddr, 0);
singleline_comment|//          stop_nic_rx(ioaddr, 0);
singleline_comment|//          break;
singleline_comment|//      };
r_if
c_cond
(paren
id|intr_status
op_amp
id|TUNF
)paren
id|writel
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|TXPDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intr_status
op_amp
id|CNTOVF
)paren
(brace
multiline_comment|/* missed pkts */
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff
suffix:semicolon
multiline_comment|/* crc error */
id|np-&gt;stats.rx_crc_errors
op_add_assign
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff0000
)paren
op_rshift
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intr_status
op_amp
(paren
id|RI
op_or
id|RBU
)paren
)paren
(brace
r_if
c_cond
(paren
id|intr_status
op_amp
id|RI
)paren
id|netdev_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
r_else
id|reset_rx_descriptors
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|np-&gt;really_tx_count
)paren
(brace
r_int
id|tx_status
op_assign
id|np-&gt;cur_tx-&gt;status
suffix:semicolon
r_int
id|tx_control
op_assign
id|np-&gt;cur_tx-&gt;control
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tx_control
op_amp
id|TXLD
)paren
)paren
(brace
multiline_comment|/* this pkt is combined by two tx descriptors */
r_struct
id|fealnx_desc
op_star
id|next
suffix:semicolon
id|next
op_assign
id|np-&gt;cur_tx-&gt;next_desc_logical
suffix:semicolon
id|tx_status
op_assign
id|next-&gt;status
suffix:semicolon
id|tx_control
op_assign
id|next-&gt;control
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
id|TXOWN
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|np-&gt;crvalue
op_amp
l_int|0x02000000
)paren
)paren
(brace
r_if
c_cond
(paren
id|tx_status
op_amp
(paren
id|CSL
op_or
id|LC
op_or
id|EC
op_or
id|UDF
op_or
id|HF
)paren
)paren
(brace
id|np-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|EC
)paren
id|np-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|CSL
)paren
id|np-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|LC
)paren
id|np-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|UDF
)paren
id|np-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tx_status
op_amp
id|HF
)paren
op_logical_and
id|np-&gt;full_duplex
op_eq
l_int|0
)paren
id|np-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|tx_status
op_amp
id|EC
)paren
id|np-&gt;stats.collisions16
op_increment
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
macro_line|#ifdef ETHER_STATS
r_if
c_cond
(paren
id|tx_status
op_amp
id|DFR
)paren
id|np-&gt;stats.tx_deferred
op_increment
suffix:semicolon
macro_line|#endif
id|np-&gt;stats.tx_bytes
op_add_assign
(paren
(paren
id|tx_control
op_amp
id|PKTSMask
)paren
op_rshift
id|PKTSShift
)paren
suffix:semicolon
id|np-&gt;stats.collisions
op_add_assign
(paren
(paren
id|tx_status
op_amp
id|NCRMask
)paren
op_rshift
id|NCRShift
)paren
suffix:semicolon
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|np-&gt;stats.tx_bytes
op_add_assign
(paren
(paren
id|tx_control
op_amp
id|PKTSMask
)paren
op_rshift
id|PKTSShift
)paren
suffix:semicolon
id|np-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;cur_tx-&gt;buffer
comma
id|np-&gt;cur_tx-&gt;skbuff-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|np-&gt;cur_tx-&gt;skbuff
)paren
suffix:semicolon
id|np-&gt;cur_tx-&gt;skbuff
op_assign
l_int|NULL
suffix:semicolon
op_decrement
id|np-&gt;really_tx_count
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;cur_tx-&gt;control
op_amp
id|TXLD
)paren
(brace
id|np-&gt;cur_tx
op_assign
id|np-&gt;cur_tx-&gt;next_desc_logical
suffix:semicolon
op_increment
id|np-&gt;free_tx_count
suffix:semicolon
)brace
r_else
(brace
id|np-&gt;cur_tx
op_assign
id|np-&gt;cur_tx-&gt;next_desc_logical
suffix:semicolon
id|np-&gt;cur_tx
op_assign
id|np-&gt;cur_tx-&gt;next_desc_logical
suffix:semicolon
id|np-&gt;free_tx_count
op_add_assign
l_int|2
suffix:semicolon
)brace
id|num_tx
op_increment
suffix:semicolon
)brace
multiline_comment|/* end of for loop */
r_if
c_cond
(paren
id|num_tx
op_logical_and
id|np-&gt;free_tx_count
op_ge
l_int|2
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* read transmit status for enhanced mode only */
r_if
c_cond
(paren
id|np-&gt;crvalue
op_amp
l_int|0x02000000
)paren
(brace
r_int
id|data
suffix:semicolon
id|data
op_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TSR
)paren
suffix:semicolon
id|np-&gt;stats.tx_errors
op_add_assign
(paren
id|data
op_amp
l_int|0xff000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|np-&gt;stats.tx_aborted_errors
op_add_assign
(paren
id|data
op_amp
l_int|0xff000000
)paren
op_rshift
l_int|24
suffix:semicolon
id|np-&gt;stats.tx_window_errors
op_add_assign
(paren
id|data
op_amp
l_int|0x00ff0000
)paren
op_rshift
l_int|16
suffix:semicolon
macro_line|#ifdef ETHER_STATS
id|np-&gt;stats.collisions16
op_add_assign
(paren
id|data
op_amp
l_int|0xff000000
)paren
op_rshift
l_int|24
suffix:semicolon
macro_line|#endif
id|np-&gt;stats.collisions
op_add_assign
(paren
id|data
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;status=0x%4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|intr_status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* read the tally counters */
multiline_comment|/* missed pkts */
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff
suffix:semicolon
multiline_comment|/* crc error */
id|np-&gt;stats.rx_crc_errors
op_add_assign
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff0000
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: exiting interrupt, status=%#4.4x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|readl
c_func
(paren
id|ioaddr
op_plus
id|ISR
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;imrvalue
comma
id|ioaddr
op_plus
id|IMR
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* This routine is logically part of the interrupt handler, but seperated&n;   for clarity and better register allocation. */
DECL|function|netdev_rx
r_static
r_int
id|netdev_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* If EOP is set on the next entry, it&squot;s a new packet. Send it up. */
r_while
c_loop
(paren
op_logical_neg
(paren
id|np-&gt;cur_rx-&gt;status
op_amp
id|RXOWN
)paren
)paren
(brace
id|s32
id|rx_status
op_assign
id|np-&gt;cur_rx-&gt;status
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;really_rx_count
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() status was %8.8x.&bslash;n&quot;
comma
id|rx_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
(paren
id|rx_status
op_amp
id|RXFSD
)paren
op_logical_and
(paren
id|rx_status
op_amp
id|RXLSD
)paren
)paren
)paren
op_logical_or
(paren
id|rx_status
op_amp
id|ErrorSummary
)paren
)paren
(brace
r_if
c_cond
(paren
id|rx_status
op_amp
id|ErrorSummary
)paren
(brace
multiline_comment|/* there was a fatal error */
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Receive error, Rx status %8.8x.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
id|np-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* end of a packet. */
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|LONG
op_or
id|RUNT
)paren
)paren
id|np-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|RXER
)paren
id|np-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|CRC
)paren
id|np-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_int
id|need_to_reset
op_assign
l_int|0
suffix:semicolon
r_int
id|desno
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|RXFSD
)paren
(brace
multiline_comment|/* this pkt is too long, over one rx buffer */
r_struct
id|fealnx_desc
op_star
id|cur
suffix:semicolon
multiline_comment|/* check this packet is received completely? */
id|cur
op_assign
id|np-&gt;cur_rx
suffix:semicolon
r_while
c_loop
(paren
id|desno
op_le
id|np-&gt;really_rx_count
)paren
(brace
op_increment
id|desno
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|cur-&gt;status
op_amp
id|RXOWN
)paren
)paren
op_logical_and
(paren
id|cur-&gt;status
op_amp
id|RXLSD
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* goto next rx descriptor */
id|cur
op_assign
id|cur-&gt;next_desc_logical
suffix:semicolon
)brace
r_if
c_cond
(paren
id|desno
OG
id|np-&gt;really_rx_count
)paren
id|need_to_reset
op_assign
l_int|1
suffix:semicolon
)brace
r_else
multiline_comment|/* RXLSD did not find, something error */
id|need_to_reset
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|need_to_reset
op_eq
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|np-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
multiline_comment|/* free all rx descriptors related this long pkt */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|desno
suffix:semicolon
op_increment
id|i
)paren
id|free_one_rx_descriptor
c_func
(paren
id|np
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* something error, need to reset this chip */
id|reset_rx_descriptors
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* exit the while loop */
)brace
)brace
r_else
(brace
multiline_comment|/* this received pkt is ok */
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* Omit the four octet CRC from the length. */
r_int
id|pkt_len
op_assign
(paren
(paren
id|rx_status
op_amp
id|FLNGMASK
)paren
op_rshift
id|FLNGShift
)paren
op_minus
l_int|4
suffix:semicolon
macro_line|#ifndef final_version
r_if
c_cond
(paren
id|debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  netdev_rx() normal Rx pkt length %d&quot;
l_string|&quot; status %x.&bslash;n&quot;
comma
id|pkt_len
comma
id|rx_status
)paren
suffix:semicolon
macro_line|#endif
id|pci_dma_sync_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;cur_rx-&gt;buffer
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;cur_rx-&gt;buffer
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* Check if the packet is long enough to accept without copying&n;&t;&t;&t;   to a minimally-sized skbuff. */
r_if
c_cond
(paren
id|pkt_len
OL
id|rx_copybreak
op_logical_and
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte align the IP header */
multiline_comment|/* Call copy + cksum if available. */
macro_line|#if ! defined(__alpha__)
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|np-&gt;cur_rx-&gt;skbuff-&gt;tail
comma
id|pkt_len
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#else
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
comma
id|np-&gt;cur_rx-&gt;skbuff-&gt;tail
comma
id|pkt_len
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|skb_put
c_func
(paren
id|skb
op_assign
id|np-&gt;cur_rx-&gt;skbuff
comma
id|pkt_len
)paren
suffix:semicolon
id|np-&gt;cur_rx-&gt;skbuff
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|np-&gt;really_rx_count
op_eq
id|RX_RING_SIZE
)paren
id|np-&gt;lack_rxbuf
op_assign
id|np-&gt;cur_rx
suffix:semicolon
op_decrement
id|np-&gt;really_rx_count
suffix:semicolon
)brace
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|np-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|np-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|np-&gt;cur_rx-&gt;skbuff
op_eq
l_int|NULL
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|np-&gt;rx_buf_sz
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/* Mark as being used by this device. */
id|np-&gt;cur_rx-&gt;buffer
op_assign
id|pci_map_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|np-&gt;cur_rx-&gt;skbuff
op_assign
id|skb
suffix:semicolon
op_increment
id|np-&gt;really_rx_count
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|np-&gt;cur_rx-&gt;skbuff
op_ne
l_int|NULL
)paren
id|free_one_rx_descriptor
c_func
(paren
id|np
)paren
suffix:semicolon
)brace
multiline_comment|/* end of while loop */
multiline_comment|/*  allocate skb for rx buffers */
id|allocate_rx_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_stats
r_static
r_struct
id|net_device_stats
op_star
id|get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* The chip only need report frame silently dropped. */
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|np-&gt;stats.rx_missed_errors
op_add_assign
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff
suffix:semicolon
id|np-&gt;stats.rx_crc_errors
op_add_assign
(paren
id|readl
c_func
(paren
id|ioaddr
op_plus
id|TALLY
)paren
op_amp
l_int|0x7fff0000
)paren
op_rshift
l_int|16
suffix:semicolon
)brace
r_return
op_amp
id|np-&gt;stats
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
(brace
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
id|u32
id|rx_mode
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
id|rx_mode
op_assign
id|PROM
op_or
id|AB
op_or
id|AM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to match, or accept all multicasts. */
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0xff
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AB
op_or
id|AM
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|mc_filter
comma
l_int|0
comma
r_sizeof
(paren
id|mc_filter
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|set_bit
c_func
(paren
(paren
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
)paren
op_xor
l_int|0x3F
comma
id|mc_filter
)paren
suffix:semicolon
)brace
id|rx_mode
op_assign
id|AB
op_or
id|AM
suffix:semicolon
)brace
id|stop_nic_tx
c_func
(paren
id|ioaddr
comma
id|np-&gt;crvalue
)paren
suffix:semicolon
id|stop_nic_rx
c_func
(paren
id|ioaddr
comma
id|np-&gt;crvalue
op_amp
(paren
op_complement
l_int|0x40000
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mc_filter
(braket
l_int|0
)braket
comma
id|ioaddr
op_plus
id|MAR0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mc_filter
(braket
l_int|1
)braket
comma
id|ioaddr
op_plus
id|MAR1
)paren
suffix:semicolon
id|np-&gt;crvalue
op_and_assign
op_complement
id|RxModeMask
suffix:semicolon
id|np-&gt;crvalue
op_or_assign
id|rx_mode
suffix:semicolon
id|writel
c_func
(paren
id|np-&gt;crvalue
comma
id|ioaddr
op_plus
id|TCRRCR
)paren
suffix:semicolon
)brace
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGMIIPHY
suffix:colon
multiline_comment|/* Get address of MII PHY in use. */
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
id|data-&gt;phy_id
op_assign
(paren
(paren
r_struct
id|netdev_private
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|phys
(braket
l_int|0
)braket
op_amp
l_int|0x1f
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCGMIIREG
suffix:colon
multiline_comment|/* Read MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
id|data-&gt;val_out
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
multiline_comment|/* Write MII PHY register. */
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* for binary compat, remove in 2.5 */
r_if
c_cond
(paren
op_logical_neg
id|suser
c_func
(paren
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
id|data-&gt;val_in
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|netdev_close
r_static
r_int
id|netdev_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|netdev_private
op_star
id|np
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|writel
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|IMR
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx processes. */
id|stop_nic_tx
c_func
(paren
id|ioaddr
comma
l_int|0
)paren
suffix:semicolon
id|stop_nic_rx
c_func
(paren
id|ioaddr
comma
l_int|0
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|np-&gt;timer
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
multiline_comment|/* Free all the skbuffs in the Rx queue. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|skbuff
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|buffer
comma
id|np-&gt;rx_buf_sz
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;rx_ring
(braket
id|i
)braket
dot
id|skbuff
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_RING_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|skbuff
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|np-&gt;pci_dev
comma
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|buffer
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|np-&gt;tx_ring
(braket
id|i
)braket
dot
id|skbuff
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fealnx_pci_tbl
r_static
r_struct
id|pci_device_id
id|fealnx_pci_tbl
(braket
)braket
op_assign
id|__devinitdata
(brace
(brace
l_int|0x1516
comma
l_int|0x0800
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0x1516
comma
l_int|0x0803
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|1
)brace
comma
(brace
l_int|0x1516
comma
l_int|0x0891
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|2
)brace
comma
(brace
)brace
multiline_comment|/* terminate list */
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|fealnx_pci_tbl
)paren
suffix:semicolon
DECL|variable|fealnx_driver
r_static
r_struct
id|pci_driver
id|fealnx_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;fealnx&quot;
comma
id|id_table
suffix:colon
id|fealnx_pci_tbl
comma
id|probe
suffix:colon
id|fealnx_init_one
comma
id|remove
suffix:colon
id|fealnx_remove_one
comma
)brace
suffix:semicolon
DECL|function|fealnx_init
r_static
r_int
id|__init
id|fealnx_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* when a module, this is printed whether or not devices are found in probe */
macro_line|#ifdef MODULE
id|printk
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|fealnx_driver
)paren
suffix:semicolon
)brace
DECL|function|fealnx_exit
r_static
r_void
id|__exit
id|fealnx_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|fealnx_driver
)paren
suffix:semicolon
)brace
DECL|variable|fealnx_init
id|module_init
c_func
(paren
id|fealnx_init
)paren
suffix:semicolon
DECL|variable|fealnx_exit
id|module_exit
c_func
(paren
id|fealnx_exit
)paren
suffix:semicolon
eof
