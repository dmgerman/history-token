multiline_comment|/* sis900.c: A SiS 900/7016 PCI Fast Ethernet driver for Linux.&n;   Copyright 1999 Silicon Integrated System Corporation &n;   Revision:&t;1.08.06 Sep. 24 2002&n;   &n;   Modified from the driver which is originally written by Donald Becker.&n;   &n;   This software may be used and distributed according to the terms&n;   of the GNU General Public License (GPL), incorporated herein by reference.&n;   Drivers based on this skeleton fall under the GPL and must retain&n;   the authorship (implicit copyright) notice.&n;   &n;   References:&n;   SiS 7016 Fast Ethernet PCI Bus 10/100 Mbps LAN Controller with OnNow Support,&n;   preliminary Rev. 1.0 Jan. 14, 1998&n;   SiS 900 Fast Ethernet PCI Bus 10/100 Mbps LAN Single Chip with OnNow Support,&n;   preliminary Rev. 1.0 Nov. 10, 1998&n;   SiS 7014 Single Chip 100BASE-TX/10BASE-T Physical Layer Solution,&n;   preliminary Rev. 1.0 Jan. 18, 1998&n;   http://www.sis.com.tw/support/databook.htm&n;&n;   Rev 1.08.06 Sep. 24 2002 Mufasa Yang bug fix for Tx timeout &amp; add SiS963 support&n;   Rev 1.08.05 Jun. 6 2002 Mufasa Yang bug fix for read_eeprom &amp; Tx descriptor over-boundary &n;   Rev 1.08.04 Apr. 25 2002 Mufasa Yang &lt;mufasa@sis.com.tw&gt; added SiS962 support&n;   Rev 1.08.03 Feb. 1 2002 Matt Domsch &lt;Matt_Domsch@dell.com&gt; update to use library crc32 function&n;   Rev 1.08.02 Nov. 30 2001 Hui-Fen Hsu workaround for EDB &amp; bug fix for dhcp problem&n;   Rev 1.08.01 Aug. 25 2001 Hui-Fen Hsu update for 630ET &amp; workaround for ICS1893 PHY&n;   Rev 1.08.00 Jun. 11 2001 Hui-Fen Hsu workaround for RTL8201 PHY and some bug fix&n;   Rev 1.07.11 Apr.  2 2001 Hui-Fen Hsu updates PCI drivers to use the new pci_set_dma_mask for kernel 2.4.3&n;   Rev 1.07.10 Mar.  1 2001 Hui-Fen Hsu &lt;hfhsu@sis.com.tw&gt; some bug fix &amp; 635M/B support &n;   Rev 1.07.09 Feb.  9 2001 Dave Jones &lt;davej@suse.de&gt; PCI enable cleanup&n;   Rev 1.07.08 Jan.  8 2001 Lei-Chun Chang added RTL8201 PHY support&n;   Rev 1.07.07 Nov. 29 2000 Lei-Chun Chang added kernel-doc extractable documentation and 630 workaround fix&n;   Rev 1.07.06 Nov.  7 2000 Jeff Garzik &lt;jgarzik@pobox.com&gt; some bug fix and cleaning&n;   Rev 1.07.05 Nov.  6 2000 metapirat&lt;metapirat@gmx.de&gt; contribute media type select by ifconfig&n;   Rev 1.07.04 Sep.  6 2000 Lei-Chun Chang added ICS1893 PHY support&n;   Rev 1.07.03 Aug. 24 2000 Lei-Chun Chang (lcchang@sis.com.tw) modified 630E eqaulizer workaround rule&n;   Rev 1.07.01 Aug. 08 2000 Ollie Lho minor update for SiS 630E and SiS 630E A1&n;   Rev 1.07    Mar. 07 2000 Ollie Lho bug fix in Rx buffer ring&n;   Rev 1.06.04 Feb. 11 2000 Jeff Garzik &lt;jgarzik@pobox.com&gt; softnet and init for kernel 2.4&n;   Rev 1.06.03 Dec. 23 1999 Ollie Lho Third release&n;   Rev 1.06.02 Nov. 23 1999 Ollie Lho bug in mac probing fixed&n;   Rev 1.06.01 Nov. 16 1999 Ollie Lho CRC calculation provide by Joseph Zbiciak (im14u2c@primenet.com)&n;   Rev 1.06 Nov. 4 1999 Ollie Lho (ollie@sis.com.tw) Second release&n;   Rev 1.05.05 Oct. 29 1999 Ollie Lho (ollie@sis.com.tw) Single buffer Tx/Rx&n;   Chin-Shan Li (lcs@sis.com.tw) Added AMD Am79c901 HomePNA PHY support&n;   Rev 1.05 Aug. 7 1999 Jim Huang (cmhuang@sis.com.tw) Initial release&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/processor.h&gt;      /* Processor type for cache alignment. */
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;&t;/* User space memory access functions */
macro_line|#include &quot;sis900.h&quot;
DECL|macro|SIS900_MODULE_NAME
mdefine_line|#define SIS900_MODULE_NAME &quot;sis900&quot;
DECL|macro|SIS900_DRV_VERSION
mdefine_line|#define SIS900_DRV_VERSION &quot;v1.08.06 9/24/2002&quot;
DECL|variable|__devinitdata
r_static
r_char
id|version
(braket
)braket
id|__devinitdata
op_assign
id|KERN_INFO
l_string|&quot;sis900.c: &quot;
id|SIS900_DRV_VERSION
l_string|&quot;&bslash;n&quot;
suffix:semicolon
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|40
suffix:semicolon
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|128
suffix:semicolon
DECL|macro|sis900_debug
mdefine_line|#define sis900_debug debug
DECL|variable|sis900_debug
r_static
r_int
id|sis900_debug
suffix:semicolon
multiline_comment|/* Time in jiffies before concluding the transmitter is hung. */
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT  (4*HZ)
multiline_comment|/* SiS 900 is capable of 32 bits BM DMA */
DECL|macro|SIS900_DMA_MASK
mdefine_line|#define SIS900_DMA_MASK 0xffffffff
r_enum
(brace
DECL|enumerator|SIS_900
id|SIS_900
op_assign
l_int|0
comma
DECL|enumerator|SIS_7016
id|SIS_7016
)brace
suffix:semicolon
DECL|variable|card_names
r_static
r_char
op_star
id|card_names
(braket
)braket
op_assign
(brace
l_string|&quot;SiS 900 PCI Fast Ethernet&quot;
comma
l_string|&quot;SiS 7016 PCI Fast Ethernet&quot;
)brace
suffix:semicolon
DECL|variable|sis900_pci_tbl
r_static
r_struct
id|pci_device_id
id|sis900_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_900
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|SIS_900
)brace
comma
(brace
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_7016
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|SIS_7016
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|pci
comma
id|sis900_pci_tbl
)paren
suffix:semicolon
r_static
r_void
id|sis900_read_mode
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
op_star
id|speed
comma
r_int
op_star
id|duplex
)paren
suffix:semicolon
DECL|struct|mii_chip_info
r_static
r_struct
id|mii_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|phy_id0
id|u16
id|phy_id0
suffix:semicolon
DECL|member|phy_id1
id|u16
id|phy_id1
suffix:semicolon
DECL|member|phy_types
id|u8
id|phy_types
suffix:semicolon
DECL|macro|HOME
mdefine_line|#define&t;HOME &t;0x0001
DECL|macro|LAN
mdefine_line|#define LAN&t;0x0002
DECL|macro|MIX
mdefine_line|#define MIX&t;0x0003
DECL|variable|mii_chip_table
)brace
id|mii_chip_table
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;SiS 900 Internal MII PHY&quot;
comma
l_int|0x001d
comma
l_int|0x8000
comma
id|LAN
)brace
comma
(brace
l_string|&quot;SiS 7014 Physical Layer Solution&quot;
comma
l_int|0x0016
comma
l_int|0xf830
comma
id|LAN
)brace
comma
(brace
l_string|&quot;AMD 79C901 10BASE-T PHY&quot;
comma
l_int|0x0000
comma
l_int|0x6B70
comma
id|LAN
)brace
comma
(brace
l_string|&quot;AMD 79C901 HomePNA PHY&quot;
comma
l_int|0x0000
comma
l_int|0x6B90
comma
id|HOME
)brace
comma
(brace
l_string|&quot;ICS LAN PHY&quot;
comma
l_int|0x0015
comma
l_int|0xF440
comma
id|LAN
)brace
comma
(brace
l_string|&quot;NS 83851 PHY&quot;
comma
l_int|0x2000
comma
l_int|0x5C20
comma
id|MIX
)brace
comma
(brace
l_string|&quot;Realtek RTL8201 PHY&quot;
comma
l_int|0x0000
comma
l_int|0x8200
comma
id|LAN
)brace
comma
(brace
l_string|&quot;VIA 6103 PHY&quot;
comma
l_int|0x0101
comma
l_int|0x8f20
comma
id|LAN
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|struct|mii_phy
r_struct
id|mii_phy
(brace
DECL|member|next
r_struct
id|mii_phy
op_star
id|next
suffix:semicolon
DECL|member|phy_addr
r_int
id|phy_addr
suffix:semicolon
DECL|member|phy_id0
id|u16
id|phy_id0
suffix:semicolon
DECL|member|phy_id1
id|u16
id|phy_id1
suffix:semicolon
DECL|member|status
id|u16
id|status
suffix:semicolon
DECL|member|phy_types
id|u8
id|phy_types
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|_BufferDesc
r_typedef
r_struct
id|_BufferDesc
(brace
DECL|member|link
id|u32
id|link
suffix:semicolon
DECL|member|cmdsts
id|u32
id|cmdsts
suffix:semicolon
DECL|member|bufptr
id|u32
id|bufptr
suffix:semicolon
DECL|typedef|BufferDesc
)brace
id|BufferDesc
suffix:semicolon
DECL|struct|sis900_private
r_struct
id|sis900_private
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|mii
r_struct
id|mii_phy
op_star
id|mii
suffix:semicolon
DECL|member|first_mii
r_struct
id|mii_phy
op_star
id|first_mii
suffix:semicolon
multiline_comment|/* record the first mii structure */
DECL|member|cur_phy
r_int
r_int
id|cur_phy
suffix:semicolon
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
multiline_comment|/* Link status detection timer. */
DECL|member|autong_complete
id|u8
id|autong_complete
suffix:semicolon
multiline_comment|/* 1: auto-negotiate complete  */
DECL|member|cur_rx
DECL|member|dirty_rx
r_int
r_int
id|cur_rx
comma
id|dirty_rx
suffix:semicolon
multiline_comment|/* producer/comsumer pointers for Tx/Rx ring */
DECL|member|cur_tx
DECL|member|dirty_tx
r_int
r_int
id|cur_tx
comma
id|dirty_tx
suffix:semicolon
multiline_comment|/* The saved address of a sent/receive-in-place packet buffer */
DECL|member|tx_skbuff
r_struct
id|sk_buff
op_star
id|tx_skbuff
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
DECL|member|rx_skbuff
r_struct
id|sk_buff
op_star
id|rx_skbuff
(braket
id|NUM_RX_DESC
)braket
suffix:semicolon
DECL|member|tx_ring
id|BufferDesc
op_star
id|tx_ring
suffix:semicolon
DECL|member|rx_ring
id|BufferDesc
op_star
id|rx_ring
suffix:semicolon
DECL|member|tx_ring_dma
id|dma_addr_t
id|tx_ring_dma
suffix:semicolon
DECL|member|rx_ring_dma
id|dma_addr_t
id|rx_ring_dma
suffix:semicolon
DECL|member|tx_full
r_int
r_int
id|tx_full
suffix:semicolon
multiline_comment|/* The Tx queue is full.    */
DECL|member|host_bridge_rev
id|u8
id|host_bridge_rev
suffix:semicolon
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jim Huang &lt;cmhuang@sis.com.tw&gt;, Ollie Lho &lt;ollie@sis.com.tw&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 900 PCI Fast Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|multicast_filter_limit
comma
l_string|&quot;SiS 900/7016 maximum number of filtered multicast addresses&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|max_interrupt_work
comma
l_string|&quot;SiS 900/7016 maximum events handled per interrupt&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;SiS 900/7016 debug level (2-4)&quot;
)paren
suffix:semicolon
r_static
r_int
id|sis900_open
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_int
id|sis900_mii_probe
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_init_rxfilter
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
id|u16
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
suffix:semicolon
r_static
id|u16
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|val
)paren
suffix:semicolon
r_static
r_void
id|sis900_timer
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_void
id|sis900_check_mode
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|mii_phy
op_star
id|mii_phy
)paren
suffix:semicolon
r_static
r_void
id|sis900_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_init_tx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_init_rx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_int
id|sis900_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_int
id|sis900_rx
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_finish_xmit
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|sis900_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|sis900_close
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|sis900_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
id|u16
id|sis900_mcast_bitnr
c_func
(paren
id|u8
op_star
id|addr
comma
id|u8
id|revision
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_reset
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis630_set_eq
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
id|u8
id|revision
)paren
suffix:semicolon
r_static
r_int
id|sis900_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
suffix:semicolon
r_static
id|u16
id|sis900_default_phy
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
suffix:semicolon
r_static
r_void
id|sis900_set_capability
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|mii_phy
op_star
id|phy
)paren
suffix:semicolon
r_static
id|u16
id|sis900_reset_phy
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_addr
)paren
suffix:semicolon
r_static
r_void
id|sis900_auto_negotiate
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_addr
)paren
suffix:semicolon
r_static
r_void
id|sis900_set_mode
(paren
r_int
id|ioaddr
comma
r_int
id|speed
comma
r_int
id|duplex
)paren
suffix:semicolon
DECL|variable|sis900_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|sis900_ethtool_ops
suffix:semicolon
multiline_comment|/**&n; *&t;sis900_get_mac_addr - Get MAC address for stand alone SiS900 model&n; *&t;@pci_dev: the sis900 pci device&n; *&t;@net_dev: the net device to get address for &n; *&n; *&t;Older SiS900 and friends, use EEPROM to store MAC address.&n; *&t;MAC address is read from read_eeprom() into @net_dev-&gt;dev_addr.&n; */
DECL|function|sis900_get_mac_addr
r_static
r_int
id|__devinit
id|sis900_get_mac_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|u16
id|signature
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* check to see if we have sane EEPROM */
id|signature
op_assign
(paren
id|u16
)paren
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|EEPROMSignature
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signature
op_eq
l_int|0xffff
op_logical_or
id|signature
op_eq
l_int|0x0000
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s: Error EERPOM read %x&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|signature
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* get MAC address from EEPROM */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
(paren
id|net_dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
op_plus
id|EEPROMMACAddr
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis630e_get_mac_addr - Get MAC address for SiS630E model&n; *&t;@pci_dev: the sis900 pci device&n; *&t;@net_dev: the net device to get address for &n; *&n; *&t;SiS630E model, use APC CMOS RAM to store MAC address.&n; *&t;APC CMOS RAM is accessed through ISA bridge.&n; *&t;MAC address is read into @net_dev-&gt;dev_addr.&n; */
DECL|function|sis630e_get_mac_addr
r_static
r_int
id|__devinit
id|sis630e_get_mac_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|pci_dev
op_star
id|isa_bridge
op_assign
l_int|NULL
suffix:semicolon
id|u8
id|reg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|isa_bridge
op_assign
id|pci_find_device
c_func
(paren
l_int|0x1039
comma
l_int|0x0008
comma
id|isa_bridge
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can not find ISA bridge&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|isa_bridge
comma
l_int|0x48
comma
op_amp
id|reg
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|isa_bridge
comma
l_int|0x48
comma
id|reg
op_or
l_int|0x40
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
l_int|0x09
op_plus
id|i
comma
l_int|0x70
)paren
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
(paren
id|net_dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|inb
c_func
(paren
l_int|0x71
)paren
suffix:semicolon
)brace
id|pci_write_config_byte
c_func
(paren
id|isa_bridge
comma
l_int|0x48
comma
id|reg
op_amp
op_complement
l_int|0x40
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis635_get_mac_addr - Get MAC address for SIS635 model&n; *&t;@pci_dev: the sis900 pci device&n; *&t;@net_dev: the net device to get address for &n; *&n; *&t;SiS635 model, set MAC Reload Bit to load Mac address from APC&n; *&t;to rfdr. rfdr is accessed through rfcr. MAC address is read into &n; *&t;@net_dev-&gt;dev_addr.&n; */
DECL|function|sis635_get_mac_addr
r_static
r_int
id|__devinit
id|sis635_get_mac_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
id|u32
id|rfcrSave
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|rfcrSave
op_assign
id|inl
c_func
(paren
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|rfcrSave
op_or
id|RELOAD
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
multiline_comment|/* disable packet filtering before setting filter */
id|outl
c_func
(paren
id|rfcrSave
op_amp
op_complement
id|RFEN
comma
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* load MAC addr to filter data register */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outl
c_func
(paren
(paren
id|i
op_lshift
id|RFADDR_shift
)paren
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
op_star
(paren
(paren
(paren
id|u16
op_star
)paren
id|net_dev-&gt;dev_addr
)paren
op_plus
id|i
)paren
op_assign
id|inw
c_func
(paren
id|ioaddr
op_plus
id|rfdr
)paren
suffix:semicolon
)brace
multiline_comment|/* enable packet filitering */
id|outl
c_func
(paren
id|rfcrSave
op_or
id|RFEN
comma
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis96x_get_mac_addr - Get MAC address for SiS962 or SiS963 model&n; *&t;@pci_dev: the sis900 pci device&n; *&t;@net_dev: the net device to get address for &n; *&n; *&t;SiS962 or SiS963 model, use EEPROM to store MAC address. And EEPROM &n; *&t;is shared by&n; *&t;LAN and 1394. When access EEPROM, send EEREQ signal to hardware first &n; *&t;and wait for EEGNT. If EEGNT is ON, EEPROM is permitted to be access &n; *&t;by LAN, otherwise is not. After MAC address is read from EEPROM, send&n; *&t;EEDONE signal to refuse EEPROM access by LAN. &n; *&t;The EEPROM map of SiS962 or SiS963 is different to SiS900. &n; *&t;The signature field in SiS962 or SiS963 spec is meaningless. &n; *&t;MAC address is read into @net_dev-&gt;dev_addr.&n; */
DECL|function|sis96x_get_mac_addr
r_static
r_int
id|__devinit
id|sis96x_get_mac_addr
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
id|ee_addr
op_assign
id|ioaddr
op_plus
id|mear
suffix:semicolon
id|u32
id|waittime
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|outl
c_func
(paren
id|EEREQ
comma
id|ee_addr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|waittime
OL
l_int|2000
)paren
(brace
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EEGNT
)paren
(brace
multiline_comment|/* get MAC address from EEPROM */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(paren
(paren
id|u16
op_star
)paren
(paren
id|net_dev-&gt;dev_addr
)paren
)paren
(braket
id|i
)braket
op_assign
id|read_eeprom
c_func
(paren
id|ioaddr
comma
id|i
op_plus
id|EEPROMMACAddr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EEDONE
comma
id|ee_addr
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|waittime
op_increment
suffix:semicolon
)brace
)brace
id|outl
c_func
(paren
id|EEDONE
comma
id|ee_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_probe - Probe for sis900 device&n; *&t;@pci_dev: the sis900 pci device&n; *&t;@pci_id: the pci device ID&n; *&n; *&t;Check and probe sis900 net device for @pci_dev.&n; *&t;Get mac address according to the chip revision, &n; *&t;and assign SiS900-specific entries in the device structure.&n; *&t;ie: sis900_open(), sis900_start_xmit(), sis900_close(), etc.&n; */
DECL|function|sis900_probe
r_static
r_int
id|__devinit
id|sis900_probe
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
suffix:semicolon
r_struct
id|net_device
op_star
id|net_dev
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|dma_addr_t
id|ring_dma
suffix:semicolon
r_void
op_star
id|ring_space
suffix:semicolon
r_int
id|ioaddr
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
id|u8
id|revision
suffix:semicolon
r_char
op_star
id|card_name
op_assign
id|card_names
(braket
id|pci_id-&gt;driver_data
)braket
suffix:semicolon
multiline_comment|/* when built into the kernel, we only print version if device is found */
macro_line|#ifndef MODULE
r_static
r_int
id|printed_version
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
op_increment
)paren
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* setup various bits in PCI command register */
id|ret
op_assign
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|i
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pci_dev
comma
id|SIS900_DMA_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sis900.c: architecture does not support&quot;
l_string|&quot;32bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|net_dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|sis900_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|net_dev
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|net_dev
comma
op_amp
id|pci_dev-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* We do a request_region() to register /proc/ioports info. */
id|ioaddr
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|ret
op_assign
id|pci_request_regions
c_func
(paren
id|pci_dev
comma
l_string|&quot;sis900&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_out
suffix:semicolon
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|net_dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|net_dev-&gt;irq
op_assign
id|pci_dev-&gt;irq
suffix:semicolon
id|sis_priv-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|sis_priv-&gt;lock
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
id|net_dev
)paren
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci_dev
comma
id|TX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out_cleardev
suffix:semicolon
)brace
id|sis_priv-&gt;tx_ring
op_assign
(paren
id|BufferDesc
op_star
)paren
id|ring_space
suffix:semicolon
id|sis_priv-&gt;tx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
id|ring_space
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci_dev
comma
id|RX_TOTAL_SIZE
comma
op_amp
id|ring_dma
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ring_space
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_unmap_tx
suffix:semicolon
)brace
id|sis_priv-&gt;rx_ring
op_assign
(paren
id|BufferDesc
op_star
)paren
id|ring_space
suffix:semicolon
id|sis_priv-&gt;rx_ring_dma
op_assign
id|ring_dma
suffix:semicolon
multiline_comment|/* The SiS900-specific entries in the device structure. */
id|net_dev-&gt;open
op_assign
op_amp
id|sis900_open
suffix:semicolon
id|net_dev-&gt;hard_start_xmit
op_assign
op_amp
id|sis900_start_xmit
suffix:semicolon
id|net_dev-&gt;stop
op_assign
op_amp
id|sis900_close
suffix:semicolon
id|net_dev-&gt;get_stats
op_assign
op_amp
id|sis900_get_stats
suffix:semicolon
id|net_dev-&gt;set_config
op_assign
op_amp
id|sis900_set_config
suffix:semicolon
id|net_dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|net_dev-&gt;do_ioctl
op_assign
op_amp
id|mii_ioctl
suffix:semicolon
id|net_dev-&gt;tx_timeout
op_assign
id|sis900_tx_timeout
suffix:semicolon
id|net_dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|net_dev-&gt;ethtool_ops
op_assign
op_amp
id|sis900_ethtool_ops
suffix:semicolon
id|ret
op_assign
id|register_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err_unmap_rx
suffix:semicolon
multiline_comment|/* Get Mac address according to the chip revision */
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630E_900_REV
)paren
id|ret
op_assign
id|sis630e_get_mac_addr
c_func
(paren
id|pci_dev
comma
id|net_dev
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|revision
OG
l_int|0x81
)paren
op_logical_and
(paren
id|revision
op_le
l_int|0x90
)paren
)paren
id|ret
op_assign
id|sis635_get_mac_addr
c_func
(paren
id|pci_dev
comma
id|net_dev
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|revision
op_eq
id|SIS96x_900_REV
)paren
id|ret
op_assign
id|sis96x_get_mac_addr
c_func
(paren
id|pci_dev
comma
id|net_dev
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|sis900_get_mac_addr
c_func
(paren
id|pci_dev
comma
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_unregister
suffix:semicolon
)brace
multiline_comment|/* 630ET : set the mii access mode as software-mode */
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630ET_900_REV
)paren
id|outl
c_func
(paren
id|ACCESSMODE
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
multiline_comment|/* probe for mii transceiver */
r_if
c_cond
(paren
id|sis900_mii_probe
c_func
(paren
id|net_dev
)paren
op_eq
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_unregister
suffix:semicolon
)brace
multiline_comment|/* save our host bridge revision */
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_630
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|sis_priv-&gt;host_bridge_rev
)paren
suffix:semicolon
multiline_comment|/* print some information about our NIC */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at %#lx, IRQ %d, &quot;
comma
id|net_dev-&gt;name
comma
id|card_name
comma
id|ioaddr
comma
id|net_dev-&gt;irq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%2.2x:&quot;
comma
(paren
id|u8
)paren
id|net_dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%2.2x.&bslash;n&quot;
comma
id|net_dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_unregister
suffix:colon
id|unregister_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|err_unmap_rx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pci_dev
comma
id|RX_TOTAL_SIZE
comma
id|sis_priv-&gt;rx_ring
comma
id|sis_priv-&gt;rx_ring_dma
)paren
suffix:semicolon
id|err_unmap_tx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pci_dev
comma
id|TX_TOTAL_SIZE
comma
id|sis_priv-&gt;tx_ring
comma
id|sis_priv-&gt;tx_ring_dma
)paren
suffix:semicolon
id|err_out_cleardev
suffix:colon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|err_out
suffix:colon
id|free_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_mii_probe - Probe MII PHY for sis900&n; *&t;@net_dev: the net device to probe for&n; *&t;&n; *&t;Search for total of 32 possible mii phy addresses.&n; *&t;Identify and set current phy if found one,&n; *&t;return error if it failed to found.&n; */
DECL|function|sis900_mii_probe
r_static
r_int
id|__init
id|sis900_mii_probe
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|u16
id|poll_bit
op_assign
id|MII_STAT_LINK
comma
id|status
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
l_int|5
op_star
id|HZ
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
id|u8
id|revision
suffix:semicolon
id|sis_priv-&gt;mii
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* search for total of 32 possible mii phy addresses */
r_for
c_loop
(paren
id|phy_addr
op_assign
l_int|0
suffix:semicolon
id|phy_addr
OL
l_int|32
suffix:semicolon
id|phy_addr
op_increment
)paren
(brace
r_struct
id|mii_phy
op_star
id|mii_phy
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|mii_status
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mii_phy
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_status
op_eq
l_int|0xffff
op_logical_or
id|mii_status
op_eq
l_int|0x0000
)paren
multiline_comment|/* the mii is not accessible, try next one */
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_phy
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mii_phy
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Cannot allocate mem for struct mii_phy&bslash;n&quot;
)paren
suffix:semicolon
id|mii_phy
op_assign
id|sis_priv-&gt;first_mii
suffix:semicolon
r_while
c_loop
(paren
id|mii_phy
)paren
(brace
r_struct
id|mii_phy
op_star
id|phy
suffix:semicolon
id|phy
op_assign
id|mii_phy
suffix:semicolon
id|mii_phy
op_assign
id|mii_phy-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|phy
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|mii_phy-&gt;phy_id0
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_PHY_ID0
)paren
suffix:semicolon
id|mii_phy-&gt;phy_id1
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_PHY_ID1
)paren
suffix:semicolon
id|mii_phy-&gt;phy_addr
op_assign
id|phy_addr
suffix:semicolon
id|mii_phy-&gt;status
op_assign
id|mii_status
suffix:semicolon
id|mii_phy-&gt;next
op_assign
id|sis_priv-&gt;mii
suffix:semicolon
id|sis_priv-&gt;mii
op_assign
id|mii_phy
suffix:semicolon
id|sis_priv-&gt;first_mii
op_assign
id|mii_phy
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
(paren
id|mii_phy-&gt;phy_id0
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id0
)paren
op_logical_and
(paren
(paren
id|mii_phy-&gt;phy_id1
op_amp
l_int|0xFFF0
)paren
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
)paren
)paren
(brace
id|mii_phy-&gt;phy_types
op_assign
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_types
suffix:semicolon
r_if
c_cond
(paren
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_types
op_eq
id|MIX
)paren
id|mii_phy-&gt;phy_types
op_assign
(paren
id|mii_status
op_amp
(paren
id|MII_STAT_CAN_TX_FDX
op_or
id|MII_STAT_CAN_TX
)paren
)paren
ques
c_cond
id|LAN
suffix:colon
id|HOME
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s transceiver found at address %d.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|mii_chip_table
(braket
id|i
)braket
dot
id|name
comma
id|phy_addr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Unknown PHY transceiver found at address %d.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|phy_addr
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|sis_priv-&gt;mii
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No MII transceivers found!&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* select default PHY for mac */
id|sis_priv-&gt;mii
op_assign
l_int|NULL
suffix:semicolon
id|sis900_default_phy
c_func
(paren
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* Reset phy if default phy is internal sis900 */
r_if
c_cond
(paren
(paren
id|sis_priv-&gt;mii-&gt;phy_id0
op_eq
l_int|0x001D
)paren
op_logical_and
(paren
(paren
id|sis_priv-&gt;mii-&gt;phy_id1
op_amp
l_int|0xFFF0
)paren
op_eq
l_int|0x8000
)paren
)paren
id|status
op_assign
id|sis900_reset_phy
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
)paren
suffix:semicolon
multiline_comment|/* workaround for ICS1893 PHY */
r_if
c_cond
(paren
(paren
id|sis_priv-&gt;mii-&gt;phy_id0
op_eq
l_int|0x0015
)paren
op_logical_and
(paren
(paren
id|sis_priv-&gt;mii-&gt;phy_id1
op_amp
l_int|0xFFF0
)paren
op_eq
l_int|0xF440
)paren
)paren
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
l_int|0x0018
comma
l_int|0xD200
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
(brace
r_while
c_loop
(paren
id|poll_bit
)paren
(brace
id|yield
c_func
(paren
)paren
suffix:semicolon
id|poll_bit
op_xor_assign
(paren
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_STATUS
)paren
op_amp
id|poll_bit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after_eq
c_func
(paren
id|jiffies
comma
id|timeout
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: reset phy and link down now&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ETIME
suffix:semicolon
)brace
)brace
)brace
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630E_900_REV
)paren
(brace
multiline_comment|/* SiS 630E has some bugs on default value of PHY registers */
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_ANADV
comma
l_int|0x05e1
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_CONFIG1
comma
l_int|0x22
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_CONFIG2
comma
l_int|0xff00
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_MASK
comma
l_int|0xffc0
)paren
suffix:semicolon
singleline_comment|//mdio_write(net_dev, sis_priv-&gt;cur_phy, MII_CONTROL, 0x1000);&t;
)brace
r_if
c_cond
(paren
id|sis_priv-&gt;mii-&gt;status
op_amp
id|MII_STAT_LINK
)paren
id|netif_carrier_on
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_else
id|netif_carrier_off
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_default_phy - Select default PHY for sis900 mac.&n; *&t;@net_dev: the net device to probe for&n; *&n; *&t;Select first detected PHY with link as default.&n; *&t;If no one is link on, select PHY whose types is HOME as default.&n; *&t;If HOME doesn&squot;t exist, select LAN.&n; */
DECL|function|sis900_default_phy
r_static
id|u16
id|sis900_default_phy
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|mii_phy
op_star
id|phy
op_assign
l_int|NULL
comma
op_star
id|phy_home
op_assign
l_int|NULL
comma
op_star
id|default_phy
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|status
suffix:semicolon
r_for
c_loop
(paren
id|phy
op_assign
id|sis_priv-&gt;first_mii
suffix:semicolon
id|phy
suffix:semicolon
id|phy
op_assign
id|phy-&gt;next
)paren
(brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
multiline_comment|/* Link ON &amp; Not select deafalut PHY */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
op_logical_and
op_logical_neg
(paren
id|default_phy
)paren
)paren
id|default_phy
op_assign
id|phy
suffix:semicolon
r_else
(brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|status
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_ISOLATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|phy-&gt;phy_types
op_eq
id|HOME
)paren
(brace
id|phy_home
op_assign
id|phy
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|default_phy
)paren
op_logical_and
id|phy_home
)paren
(brace
id|default_phy
op_assign
id|phy_home
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|default_phy
)paren
(brace
id|default_phy
op_assign
id|sis_priv-&gt;first_mii
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sis_priv-&gt;mii
op_ne
id|default_phy
)paren
(brace
id|sis_priv-&gt;mii
op_assign
id|default_phy
suffix:semicolon
id|sis_priv-&gt;cur_phy
op_assign
id|default_phy-&gt;phy_addr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using transceiver found at address %d as default&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|sis_priv-&gt;cur_phy
)paren
suffix:semicolon
)brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|status
op_and_assign
(paren
op_complement
id|MII_CNTL_ISOLATE
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_CONTROL
comma
id|status
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_STATUS
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_STATUS
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/**&n; * &t;sis900_set_capability - set the media capability of network adapter.&n; *&t;@net_dev : the net device to probe for&n; *&t;@phy : default PHY&n; *&n; *&t;Set the media capability of network adapter according to&n; *&t;mii status register. It&squot;s necessary before auto-negotiate.&n; */
DECL|function|sis900_set_capability
r_static
r_void
id|sis900_set_capability
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|mii_phy
op_star
id|phy
)paren
(brace
id|u16
id|cap
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
id|cap
op_assign
id|MII_NWAY_CSMA_CD
op_or
(paren
(paren
id|phy-&gt;status
op_amp
id|MII_STAT_CAN_TX_FDX
)paren
ques
c_cond
id|MII_NWAY_TX_FDX
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|phy-&gt;status
op_amp
id|MII_STAT_CAN_TX
)paren
ques
c_cond
id|MII_NWAY_TX
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|phy-&gt;status
op_amp
id|MII_STAT_CAN_T_FDX
)paren
ques
c_cond
id|MII_NWAY_T_FDX
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|phy-&gt;status
op_amp
id|MII_STAT_CAN_T
)paren
ques
c_cond
id|MII_NWAY_T
suffix:colon
l_int|0
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|phy-&gt;phy_addr
comma
id|MII_ANADV
comma
id|cap
)paren
suffix:semicolon
)brace
multiline_comment|/* Delay between EEPROM clock transitions. */
DECL|macro|eeprom_delay
mdefine_line|#define eeprom_delay()  inl(ee_addr)
multiline_comment|/**&n; *&t;read_eeprom - Read Serial EEPROM&n; *&t;@ioaddr: base i/o address&n; *&t;@location: the EEPROM location to read&n; *&n; *&t;Read Serial EEPROM through EEPROM Access Register.&n; *&t;Note that location is in word (16 bits) unit&n; */
DECL|function|read_eeprom
r_static
id|u16
id|__devinit
id|read_eeprom
c_func
(paren
r_int
id|ioaddr
comma
r_int
id|location
)paren
(brace
r_int
id|i
suffix:semicolon
id|u16
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|ee_addr
op_assign
id|ioaddr
op_plus
id|mear
suffix:semicolon
id|u32
id|read_cmd
op_assign
id|location
op_or
id|EEread
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EECS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Shift the read command (9) bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|u32
id|dataval
op_assign
(paren
id|read_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|EEDI
op_or
id|EECS
suffix:colon
id|EECS
suffix:semicolon
id|outl
c_func
(paren
id|dataval
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dataval
op_or
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
id|EECS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* read the 16-bits data in */
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|EECS
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|EECS
op_or
id|EECLK
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|ee_addr
)paren
op_amp
id|EEDO
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Terminate the EEPROM access. */
id|outl
c_func
(paren
l_int|0
comma
id|ee_addr
)paren
suffix:semicolon
id|eeprom_delay
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|retval
)paren
suffix:semicolon
)brace
multiline_comment|/* Read and write the MII management registers using software-generated&n;   serial MDIO protocol. Note that the command bits and data bits are&n;   send out separately */
DECL|macro|mdio_delay
mdefine_line|#define mdio_delay()    inl(mdio_addr)
DECL|function|mdio_idle
r_static
r_void
id|mdio_idle
c_func
(paren
r_int
id|mdio_addr
)paren
(brace
id|outl
c_func
(paren
id|MDIO
op_or
id|MDDIR
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDIO
op_or
id|MDDIR
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
)brace
multiline_comment|/* Syncronize the MII management interface by shifting 32 one bits out. */
DECL|function|mdio_reset
r_static
r_void
id|mdio_reset
c_func
(paren
r_int
id|mdio_addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|31
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
id|MDDIR
op_or
id|MDIO
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDDIR
op_or
id|MDIO
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;mdio_read - read MII PHY register&n; *&t;@net_dev: the net device to read&n; *&t;@phy_id: the phy address to read&n; *&t;@location: the phy regiester id to read&n; *&n; *&t;Read MII registers through MDIO and MDC&n; *&t;using MDIO management frame structure and protocol(defined by ISO/IEC).&n; *&t;Please see SiS7014 or ICS spec&n; */
DECL|function|mdio_read
r_static
id|u16
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_id
comma
r_int
id|location
)paren
(brace
r_int
id|mdio_addr
op_assign
id|net_dev-&gt;base_addr
op_plus
id|mear
suffix:semicolon
r_int
id|mii_cmd
op_assign
id|MIIread
op_or
(paren
id|phy_id
op_lshift
id|MIIpmdShift
)paren
op_or
(paren
id|location
op_lshift
id|MIIregShift
)paren
suffix:semicolon
id|u16
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdio_reset
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|mdio_idle
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDDIR
op_or
id|MDIO
suffix:colon
id|MDDIR
suffix:semicolon
id|outl
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dataval
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the 16 data bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
(paren
id|retval
op_lshift
l_int|1
)paren
op_or
(paren
(paren
id|inl
c_func
(paren
id|mdio_addr
)paren
op_amp
id|MDIO
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
l_int|0x00
comma
id|mdio_addr
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;mdio_write - write MII PHY register&n; *&t;@net_dev: the net device to write&n; *&t;@phy_id: the phy address to write&n; *&t;@location: the phy regiester id to write&n; *&t;@value: the register value to write with&n; *&n; *&t;Write MII registers with @value through MDIO and MDC&n; *&t;using MDIO management frame structure and protocol(defined by ISO/IEC)&n; *&t;please see SiS7014 or ICS spec&n; */
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_id
comma
r_int
id|location
comma
r_int
id|value
)paren
(brace
r_int
id|mdio_addr
op_assign
id|net_dev-&gt;base_addr
op_plus
id|mear
suffix:semicolon
r_int
id|mii_cmd
op_assign
id|MIIwrite
op_or
(paren
id|phy_id
op_lshift
id|MIIpmdShift
)paren
op_or
(paren
id|location
op_lshift
id|MIIregShift
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdio_reset
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
id|mdio_idle
c_func
(paren
id|mdio_addr
)paren
suffix:semicolon
multiline_comment|/* Shift the command bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|mii_cmd
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDDIR
op_or
id|MDIO
suffix:colon
id|MDDIR
suffix:semicolon
id|outb
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dataval
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Shift the value bits out. */
r_for
c_loop
(paren
id|i
op_assign
l_int|15
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
id|dataval
op_assign
(paren
id|value
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
ques
c_cond
id|MDDIR
op_or
id|MDIO
suffix:colon
id|MDDIR
suffix:semicolon
id|outl
c_func
(paren
id|dataval
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dataval
op_or
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Clear out extra bits. */
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|outb
c_func
(paren
l_int|0
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|MDC
comma
id|mdio_addr
)paren
suffix:semicolon
id|mdio_delay
c_func
(paren
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
l_int|0x00
comma
id|mdio_addr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_reset_phy - reset sis900 mii phy.&n; *&t;@net_dev: the net device to write&n; *&t;@phy_addr: default phy address&n; *&n; *&t;Some specific phy can&squot;t work properly without reset.&n; *&t;This function will be called during initialization and&n; *&t;link status change from ON to DOWN.&n; */
DECL|function|sis900_reset_phy
r_static
id|u16
id|sis900_reset_phy
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_addr
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|u16
id|status
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
l_int|2
)paren
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|MII_CNTL_RESET
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_open - open sis900 device&n; *&t;@net_dev: the net device to open&n; *&n; *&t;Do some initialization and start net interface.&n; *&t;enable interrupts and set sis900 timer.&n; */
r_static
r_int
DECL|function|sis900_open
id|sis900_open
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
id|u8
id|revision
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|sis900_reset
c_func
(paren
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* Equalizer workaround Rule */
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
id|sis630_set_eq
c_func
(paren
id|net_dev
comma
id|revision
)paren
suffix:semicolon
id|ret
op_assign
id|request_irq
c_func
(paren
id|net_dev-&gt;irq
comma
op_amp
id|sis900_interrupt
comma
id|SA_SHIRQ
comma
id|net_dev-&gt;name
comma
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|sis900_init_rxfilter
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|sis900_init_tx_ring
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|sis900_init_rx_ring
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|set_rx_mode
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* Workaround for EDB */
id|sis900_set_mode
c_func
(paren
id|ioaddr
comma
id|HW_SPEED_10_MBPS
comma
id|FDX_CAPABLE_HALF_SELECTED
)paren
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|RxSOVR
op_or
id|RxORN
op_or
id|RxERR
op_or
id|RxOK
op_or
id|TxURN
op_or
id|TxERR
op_or
id|TxIDLE
)paren
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|RxENA
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|IE
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
id|sis900_check_mode
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;mii
)paren
suffix:semicolon
multiline_comment|/* Set the timer to switch to check for link beat and perhaps switch&n;&t;   to an alternate media type. */
id|init_timer
c_func
(paren
op_amp
id|sis_priv-&gt;timer
)paren
suffix:semicolon
id|sis_priv-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|sis_priv-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|net_dev
suffix:semicolon
id|sis_priv-&gt;timer.function
op_assign
op_amp
id|sis900_timer
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sis_priv-&gt;timer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_init_rxfilter - Initialize the Rx filter&n; *&t;@net_dev: the net device to initialize for&n; *&n; *&t;Set receive filter address to our MAC address&n; *&t;and enable packet filtering.&n; */
r_static
r_void
DECL|function|sis900_init_rxfilter
id|sis900_init_rxfilter
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
id|u32
id|rfcrSave
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|rfcrSave
op_assign
id|inl
c_func
(paren
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* disable packet filtering before setting filter */
id|outl
c_func
(paren
id|rfcrSave
op_amp
op_complement
id|RFEN
comma
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* load MAC addr to filter data register */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|w
suffix:semicolon
id|w
op_assign
(paren
id|u32
)paren
op_star
(paren
(paren
id|u16
op_star
)paren
(paren
id|net_dev-&gt;dev_addr
)paren
op_plus
id|i
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|i
op_lshift
id|RFADDR_shift
)paren
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|w
comma
id|ioaddr
op_plus
id|rfdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Receive Filter Addrss[%d]=%x&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|i
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rfdr
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* enable packet filitering */
id|outl
c_func
(paren
id|rfcrSave
op_or
id|RFEN
comma
id|rfcr
op_plus
id|ioaddr
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_init_tx_ring - Initialize the Tx descriptor ring&n; *&t;@net_dev: the net device to initialize for&n; *&n; *&t;Initialize the Tx descriptor ring, &n; */
r_static
r_void
DECL|function|sis900_init_tx_ring
id|sis900_init_tx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sis_priv-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;dirty_tx
op_assign
id|sis_priv-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sis_priv-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|link
op_assign
id|sis_priv-&gt;tx_ring_dma
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|NUM_TX_DESC
)paren
op_star
r_sizeof
(paren
id|BufferDesc
)paren
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|bufptr
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* load Transmit Descriptor Register */
id|outl
c_func
(paren
id|sis_priv-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|txdp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: TX descriptor register loaded with: %8.8x&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txdp
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_init_rx_ring - Initialize the Rx descriptor ring&n; *&t;@net_dev: the net device to initialize for&n; *&n; *&t;Initialize the Rx descriptor ring, &n; *&t;and pre-allocate recevie buffers (socket buffer)&n; */
r_static
r_void
DECL|function|sis900_init_rx_ring
id|sis900_init_rx_ring
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sis_priv-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;dirty_rx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* init RX descriptor */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sis_priv-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|link
op_assign
id|sis_priv-&gt;rx_ring_dma
op_plus
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
id|NUM_RX_DESC
)paren
op_star
r_sizeof
(paren
id|BufferDesc
)paren
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|bufptr
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* allocate sock buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUF_SIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* not enough memory for skbuff, this makes a &quot;hole&quot;&n;&t;&t;&t;   on the buffer ring, it is not clear how the&n;&t;&t;&t;   hardware will react to this kind of degenerated&n;&t;&t;&t;   buffer */
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|net_dev
suffix:semicolon
id|sis_priv-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
id|skb
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|bufptr
op_assign
id|pci_map_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
id|sis_priv-&gt;dirty_rx
op_assign
(paren
r_int
r_int
)paren
(paren
id|i
op_minus
id|NUM_RX_DESC
)paren
suffix:semicolon
multiline_comment|/* load Receive Descriptor Register */
id|outl
c_func
(paren
id|sis_priv-&gt;rx_ring_dma
comma
id|ioaddr
op_plus
id|rxdp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: RX descriptor register loaded with: %8.8x&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxdp
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis630_set_eq - set phy equalizer value for 630 LAN&n; *&t;@net_dev: the net device to set equalizer value&n; *&t;@revision: 630 LAN revision number&n; *&n; *&t;630E equalizer workaround rule(Cyrus Huang 08/15)&n; *&t;PHY register 14h(Test)&n; *&t;Bit 14: 0 -- Automatically dectect (default)&n; *&t;&t;1 -- Manually set Equalizer filter&n; *&t;Bit 13: 0 -- (Default)&n; *&t;&t;1 -- Speed up convergence of equalizer setting&n; *&t;Bit 9 : 0 -- (Default)&n; *&t;&t;1 -- Disable Baseline Wander&n; *&t;Bit 3~7   -- Equalizer filter setting&n; *&t;Link ON: Set Bit 9, 13 to 1, Bit 14 to 0&n; *&t;Then calculate equalizer value&n; *&t;Then set equalizer value, and set Bit 14 to 1, Bit 9 to 0&n; *&t;Link Off:Set Bit 13 to 1, Bit 14 to 0&n; *&t;Calculate Equalizer value:&n; *&t;When Link is ON and Bit 14 is 0, SIS900PHY will auto-dectect proper equalizer value.&n; *&t;When the equalizer is stable, this value is not a fixed value. It will be within&n; *&t;a small range(eg. 7~9). Then we get a minimum and a maximum value(eg. min=7, max=9)&n; *&t;0 &lt;= max &lt;= 4  --&gt; set equalizer to max&n; *&t;5 &lt;= max &lt;= 14 --&gt; set equalizer to max+1 or set equalizer to max+2 if max == min&n; *&t;max &gt;= 15      --&gt; set equalizer to max+5 or set equalizer to max+6 if max == min&n; */
DECL|function|sis630_set_eq
r_static
r_void
id|sis630_set_eq
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
id|u8
id|revision
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|u16
id|reg14h
comma
id|eq_value
op_assign
l_int|0
comma
id|max_value
op_assign
l_int|0
comma
id|min_value
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|maxcount
op_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|revision
op_eq
id|SIS630E_900_REV
op_logical_or
id|revision
op_eq
id|SIS630EA1_900_REV
op_logical_or
id|revision
op_eq
id|SIS630A_900_REV
op_logical_or
id|revision
op_eq
id|SIS630ET_900_REV
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|net_dev
)paren
)paren
(brace
id|reg14h
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
comma
(paren
l_int|0x2200
op_or
id|reg14h
)paren
op_amp
l_int|0xBFFF
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|maxcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|eq_value
op_assign
(paren
l_int|0x00F8
op_amp
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
)paren
)paren
op_rshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|max_value
op_assign
id|min_value
op_assign
id|eq_value
suffix:semicolon
id|max_value
op_assign
(paren
id|eq_value
OG
id|max_value
)paren
ques
c_cond
id|eq_value
suffix:colon
id|max_value
suffix:semicolon
id|min_value
op_assign
(paren
id|eq_value
OL
id|min_value
)paren
ques
c_cond
id|eq_value
suffix:colon
id|min_value
suffix:semicolon
)brace
multiline_comment|/* 630E rule to determine the equalizer value */
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630E_900_REV
op_logical_or
id|revision
op_eq
id|SIS630EA1_900_REV
op_logical_or
id|revision
op_eq
id|SIS630ET_900_REV
)paren
(brace
r_if
c_cond
(paren
id|max_value
OL
l_int|5
)paren
id|eq_value
op_assign
id|max_value
suffix:semicolon
r_else
r_if
c_cond
(paren
id|max_value
op_ge
l_int|5
op_logical_and
id|max_value
OL
l_int|15
)paren
id|eq_value
op_assign
(paren
id|max_value
op_eq
id|min_value
)paren
ques
c_cond
id|max_value
op_plus
l_int|2
suffix:colon
id|max_value
op_plus
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|max_value
op_ge
l_int|15
)paren
id|eq_value
op_assign
(paren
id|max_value
op_eq
id|min_value
)paren
ques
c_cond
id|max_value
op_plus
l_int|6
suffix:colon
id|max_value
op_plus
l_int|5
suffix:semicolon
)brace
multiline_comment|/* 630B0&amp;B1 rule to determine the equalizer value */
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630A_900_REV
op_logical_and
(paren
id|sis_priv-&gt;host_bridge_rev
op_eq
id|SIS630B0
op_logical_or
id|sis_priv-&gt;host_bridge_rev
op_eq
id|SIS630B1
)paren
)paren
(brace
r_if
c_cond
(paren
id|max_value
op_eq
l_int|0
)paren
id|eq_value
op_assign
l_int|3
suffix:semicolon
r_else
id|eq_value
op_assign
(paren
id|max_value
op_plus
id|min_value
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
)brace
multiline_comment|/* write equalizer value and setting */
id|reg14h
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
)paren
suffix:semicolon
id|reg14h
op_assign
(paren
id|reg14h
op_amp
l_int|0xFF07
)paren
op_or
(paren
(paren
id|eq_value
op_lshift
l_int|3
)paren
op_amp
l_int|0x00F8
)paren
suffix:semicolon
id|reg14h
op_assign
(paren
id|reg14h
op_or
l_int|0x6000
)paren
op_amp
l_int|0xFDFF
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
comma
id|reg14h
)paren
suffix:semicolon
)brace
r_else
(brace
id|reg14h
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
)paren
suffix:semicolon
r_if
c_cond
(paren
id|revision
op_eq
id|SIS630A_900_REV
op_logical_and
(paren
id|sis_priv-&gt;host_bridge_rev
op_eq
id|SIS630B0
op_logical_or
id|sis_priv-&gt;host_bridge_rev
op_eq
id|SIS630B1
)paren
)paren
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
comma
(paren
id|reg14h
op_or
l_int|0x2200
)paren
op_amp
l_int|0xBFFF
)paren
suffix:semicolon
r_else
id|mdio_write
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_RESV
comma
(paren
id|reg14h
op_or
l_int|0x2000
)paren
op_amp
l_int|0xBFFF
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_timer - sis900 timer routine&n; *&t;@data: pointer to sis900 net device&n; *&n; *&t;On each timer ticks we check two things, &n; *&t;link status (ON/OFF) and link mode (10/100/Full/Half)&n; */
DECL|function|sis900_timer
r_static
r_void
id|sis900_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|mii_phy
op_star
id|mii_phy
op_assign
id|sis_priv-&gt;mii
suffix:semicolon
r_static
r_int
id|next_tick
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
id|u16
id|status
suffix:semicolon
id|u8
id|revision
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sis_priv-&gt;autong_complete
)paren
(brace
r_int
id|speed
comma
id|duplex
op_assign
l_int|0
suffix:semicolon
id|sis900_read_mode
c_func
(paren
id|net_dev
comma
op_amp
id|speed
comma
op_amp
id|duplex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|duplex
)paren
(brace
id|sis900_set_mode
c_func
(paren
id|net_dev-&gt;base_addr
comma
id|speed
comma
id|duplex
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
id|sis630_set_eq
c_func
(paren
id|net_dev
comma
id|revision
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
id|sis_priv-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sis_priv-&gt;timer
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_STATUS
)paren
suffix:semicolon
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
comma
id|MII_STATUS
)paren
suffix:semicolon
multiline_comment|/* Link OFF -&gt; ON */
r_if
c_cond
(paren
op_logical_neg
id|netif_carrier_ok
c_func
(paren
id|net_dev
)paren
)paren
(brace
id|LookForLink
suffix:colon
multiline_comment|/* Search for new PHY */
id|status
op_assign
id|sis900_default_phy
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|mii_phy
op_assign
id|sis_priv-&gt;mii
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
(brace
id|sis900_check_mode
c_func
(paren
id|net_dev
comma
id|mii_phy
)paren
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Link ON -&gt; OFF */
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link Off&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Change mode issue */
r_if
c_cond
(paren
(paren
id|mii_phy-&gt;phy_id0
op_eq
l_int|0x001D
)paren
op_logical_and
(paren
(paren
id|mii_phy-&gt;phy_id1
op_amp
l_int|0xFFF0
)paren
op_eq
l_int|0x8000
)paren
)paren
id|sis900_reset_phy
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
id|sis630_set_eq
c_func
(paren
id|net_dev
comma
id|revision
)paren
suffix:semicolon
r_goto
id|LookForLink
suffix:semicolon
)brace
)brace
id|sis_priv-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|next_tick
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sis_priv-&gt;timer
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_check_mode - check the media mode for sis900&n; *&t;@net_dev: the net device to be checked&n; *&t;@mii_phy: the mii phy&n; *&n; *&t;Older driver gets the media mode from mii status output&n; *&t;register. Now we set our media capability and auto-negotiate&n; *&t;to get the upper bound of speed and duplex between two ends.&n; *&t;If the types of mii phy is HOME, it doesn&squot;t need to auto-negotiate&n; *&t;and autong_complete should be set to 1.&n; */
DECL|function|sis900_check_mode
r_static
r_void
id|sis900_check_mode
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|mii_phy
op_star
id|mii_phy
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
id|speed
comma
id|duplex
suffix:semicolon
r_if
c_cond
(paren
id|mii_phy-&gt;phy_types
op_eq
id|LAN
)paren
(brace
id|outl
c_func
(paren
op_complement
id|EXD
op_amp
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cfg
)paren
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
id|sis900_set_capability
c_func
(paren
id|net_dev
comma
id|mii_phy
)paren
suffix:semicolon
id|sis900_auto_negotiate
c_func
(paren
id|net_dev
comma
id|sis_priv-&gt;cur_phy
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
id|EXD
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cfg
)paren
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
id|speed
op_assign
id|HW_SPEED_HOME
suffix:semicolon
id|duplex
op_assign
id|FDX_CAPABLE_HALF_SELECTED
suffix:semicolon
id|sis900_set_mode
c_func
(paren
id|ioaddr
comma
id|speed
comma
id|duplex
)paren
suffix:semicolon
id|sis_priv-&gt;autong_complete
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; *&t;sis900_set_mode - Set the media mode of mac register.&n; *&t;@ioaddr: the address of the device&n; *&t;@speed : the transmit speed to be determined&n; *&t;@duplex: the duplex mode to be determined&n; *&n; *&t;Set the media mode of mac register txcfg/rxcfg according to&n; *&t;speed and duplex of phy. Bit EDB_MASTER_EN indicates the EDB&n; *&t;bus is used instead of PCI bus. When this bit is set 1, the&n; *&t;Max DMA Burst Size for TX/RX DMA should be no larger than 16&n; *&t;double words.&n; */
DECL|function|sis900_set_mode
r_static
r_void
id|sis900_set_mode
(paren
r_int
id|ioaddr
comma
r_int
id|speed
comma
r_int
id|duplex
)paren
(brace
id|u32
id|tx_flags
op_assign
l_int|0
comma
id|rx_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cfg
)paren
op_amp
id|EDB_MASTER_EN
)paren
(brace
id|tx_flags
op_assign
id|TxATP
op_or
(paren
id|DMA_BURST_64
op_lshift
id|TxMXDMA_shift
)paren
op_or
(paren
id|TX_FILL_THRESH
op_lshift
id|TxFILLT_shift
)paren
suffix:semicolon
id|rx_flags
op_assign
id|DMA_BURST_64
op_lshift
id|RxMXDMA_shift
suffix:semicolon
)brace
r_else
(brace
id|tx_flags
op_assign
id|TxATP
op_or
(paren
id|DMA_BURST_512
op_lshift
id|TxMXDMA_shift
)paren
op_or
(paren
id|TX_FILL_THRESH
op_lshift
id|TxFILLT_shift
)paren
suffix:semicolon
id|rx_flags
op_assign
id|DMA_BURST_512
op_lshift
id|RxMXDMA_shift
suffix:semicolon
)brace
r_if
c_cond
(paren
id|speed
op_eq
id|HW_SPEED_HOME
op_logical_or
id|speed
op_eq
id|HW_SPEED_10_MBPS
)paren
(brace
id|rx_flags
op_or_assign
(paren
id|RxDRNT_10
op_lshift
id|RxDRNT_shift
)paren
suffix:semicolon
id|tx_flags
op_or_assign
(paren
id|TxDRNT_10
op_lshift
id|TxDRNT_shift
)paren
suffix:semicolon
)brace
r_else
(brace
id|rx_flags
op_or_assign
(paren
id|RxDRNT_100
op_lshift
id|RxDRNT_shift
)paren
suffix:semicolon
id|tx_flags
op_or_assign
(paren
id|TxDRNT_100
op_lshift
id|TxDRNT_shift
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
)paren
(brace
id|tx_flags
op_or_assign
(paren
id|TxCSI
op_or
id|TxHBI
)paren
suffix:semicolon
id|rx_flags
op_or_assign
id|RxATX
suffix:semicolon
)brace
id|outl
(paren
id|tx_flags
comma
id|ioaddr
op_plus
id|txcfg
)paren
suffix:semicolon
id|outl
(paren
id|rx_flags
comma
id|ioaddr
op_plus
id|rxcfg
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_auto_negotiate - Set the Auto-Negotiation Enable/Reset bit.&n; *&t;@net_dev: the net device to read mode for&n; *&t;@phy_addr: mii phy address&n; *&n; *&t;If the adapter is link-on, set the auto-negotiate enable/reset bit.&n; *&t;autong_complete should be set to 0 when starting auto-negotiation.&n; *&t;autong_complete should be set to 1 if we didn&squot;t start auto-negotiation.&n; *&t;sis900_timer will wait for link on again if autong_complete = 0.&n; */
DECL|function|sis900_auto_negotiate
r_static
r_void
id|sis900_auto_negotiate
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
id|phy_addr
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|u32
id|status
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
l_int|2
)paren
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link Off&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
id|sis_priv-&gt;autong_complete
op_assign
l_int|1
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* (Re)start AutoNegotiate */
id|mdio_write
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_RST_AUTO
)paren
suffix:semicolon
id|sis_priv-&gt;autong_complete
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_read_mode - read media mode for sis900 internal phy&n; *&t;@net_dev: the net device to read mode for&n; *&t;@speed  : the transmit speed to be determined&n; *&t;@duplex : the duplex mode to be determined&n; *&n; *&t;The capability of remote end will be put in mii register autorec&n; *&t;after auto-negotiation. Use AND operation to get the upper bound&n; *&t;of speed and duplex between two ends.&n; */
DECL|function|sis900_read_mode
r_static
r_void
id|sis900_read_mode
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_int
op_star
id|speed
comma
r_int
op_star
id|duplex
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|mii_phy
op_star
id|phy
op_assign
id|sis_priv-&gt;mii
suffix:semicolon
r_int
id|phy_addr
op_assign
id|sis_priv-&gt;cur_phy
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|u16
id|autoadv
comma
id|autorec
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
op_increment
OL
l_int|2
)paren
id|status
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|MII_STAT_LINK
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* AutoNegotiate completed */
id|autoadv
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_ANADV
)paren
suffix:semicolon
id|autorec
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_ANLPAR
)paren
suffix:semicolon
id|status
op_assign
id|autoadv
op_amp
id|autorec
suffix:semicolon
op_star
id|speed
op_assign
id|HW_SPEED_10_MBPS
suffix:semicolon
op_star
id|duplex
op_assign
id|FDX_CAPABLE_HALF_SELECTED
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
)paren
)paren
op_star
id|speed
op_assign
id|HW_SPEED_100_MBPS
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
)paren
)paren
op_star
id|duplex
op_assign
id|FDX_CAPABLE_FULL_SELECTED
suffix:semicolon
id|sis_priv-&gt;autong_complete
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Workaround for Realtek RTL8201 PHY issue */
r_if
c_cond
(paren
(paren
id|phy-&gt;phy_id0
op_eq
l_int|0x0000
)paren
op_logical_and
(paren
(paren
id|phy-&gt;phy_id1
op_amp
l_int|0xFFF0
)paren
op_eq
l_int|0x8200
)paren
)paren
(brace
r_if
c_cond
(paren
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
op_amp
id|MII_CNTL_FDX
)paren
(brace
op_star
id|duplex
op_assign
id|FDX_CAPABLE_FULL_SELECTED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mdio_read
c_func
(paren
id|net_dev
comma
id|phy_addr
comma
l_int|0x0019
)paren
op_amp
l_int|0x01
)paren
(brace
op_star
id|speed
op_assign
id|HW_SPEED_100_MBPS
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Media Link On %s %s-duplex &bslash;n&quot;
comma
id|net_dev-&gt;name
comma
op_star
id|speed
op_eq
id|HW_SPEED_100_MBPS
ques
c_cond
l_string|&quot;100mbps&quot;
suffix:colon
l_string|&quot;10mbps&quot;
comma
op_star
id|duplex
op_eq
id|FDX_CAPABLE_FULL_SELECTED
ques
c_cond
l_string|&quot;full&quot;
suffix:colon
l_string|&quot;half&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_tx_timeout - sis900 transmit timeout routine&n; *&t;@net_dev: the net device to transmit&n; *&n; *&t;print transmit timeout status&n; *&t;disable interrupts and do some tasks&n; */
DECL|function|sis900_tx_timeout
r_static
r_void
id|sis900_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Transmit timeout, status %8.8x %8.8x &bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
multiline_comment|/* use spinlock to prevent interrupt handler accessing buffer ring */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sis_priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* discard unsent packets */
id|sis_priv-&gt;dirty_tx
op_assign
id|sis_priv-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|sis_priv-&gt;tx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|bufptr
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sis_priv-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|bufptr
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
id|sis_priv-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sis_priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|net_dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* load Transmit Descriptor Register */
id|outl
c_func
(paren
id|sis_priv-&gt;tx_ring_dma
comma
id|ioaddr
op_plus
id|txdp
)paren
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|outl
c_func
(paren
(paren
id|RxSOVR
op_or
id|RxORN
op_or
id|RxERR
op_or
id|RxOK
op_or
id|TxURN
op_or
id|TxERR
op_or
id|TxIDLE
)paren
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_start_xmit - sis900 start transmit routine&n; *&t;@skb: socket buffer pointer to put the data being transmitted&n; *&t;@net_dev: the net device to transmit with&n; *&n; *&t;Set the transmit buffer descriptor, &n; *&t;and write TxENA to enable transimt state machine.&n; *&t;tell upper layer if the buffer is full&n; */
r_static
r_int
DECL|function|sis900_start_xmit
id|sis900_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|index_cur_tx
comma
id|index_dirty_tx
suffix:semicolon
r_int
r_int
id|count_dirty_tx
suffix:semicolon
multiline_comment|/* Don&squot;t transmit data before the complete of auto-negotiation */
r_if
c_cond
(paren
op_logical_neg
id|sis_priv-&gt;autong_complete
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sis_priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Calculate the next Tx descriptor entry. */
id|entry
op_assign
id|sis_priv-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
id|sis_priv-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
multiline_comment|/* set the transmit buffer descriptor and enable Transmit State Machine */
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|bufptr
op_assign
id|pci_map_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
(paren
id|OWN
op_or
id|skb-&gt;len
)paren
suffix:semicolon
id|outl
c_func
(paren
id|TxENA
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|sis_priv-&gt;cur_tx
op_increment
suffix:semicolon
id|index_cur_tx
op_assign
id|sis_priv-&gt;cur_tx
suffix:semicolon
id|index_dirty_tx
op_assign
id|sis_priv-&gt;dirty_tx
suffix:semicolon
r_for
c_loop
(paren
id|count_dirty_tx
op_assign
l_int|0
suffix:semicolon
id|index_cur_tx
op_ne
id|index_dirty_tx
suffix:semicolon
id|index_dirty_tx
op_increment
)paren
id|count_dirty_tx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|index_cur_tx
op_eq
id|index_dirty_tx
)paren
(brace
multiline_comment|/* dirty_tx is met in the cycle of cur_tx, buffer full */
id|sis_priv-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|count_dirty_tx
OL
id|NUM_TX_DESC
)paren
(brace
multiline_comment|/* Typical path, tell upper layer that more transmission is possible */
id|netif_start_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* buffer full, tell upper layer no more transmission */
id|sis_priv-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sis_priv-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|net_dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Queued Tx packet at %p size %d &quot;
l_string|&quot;to slot %d.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|skb-&gt;data
comma
(paren
r_int
)paren
id|skb-&gt;len
comma
id|entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_interrupt - sis900 interrupt handler&n; *&t;@irq: the irq number&n; *&t;@dev_instance: the client data object&n; *&t;@regs: snapshot of processor context&n; *&n; *&t;The interrupt handler does all of the Rx thread work, &n; *&t;and cleans up after the Tx thread&n; */
DECL|function|sis900_interrupt
r_static
id|irqreturn_t
id|sis900_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
id|dev_instance
suffix:semicolon
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
id|u32
id|status
suffix:semicolon
r_int
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
id|spin_lock
(paren
op_amp
id|sis_priv-&gt;lock
)paren
suffix:semicolon
r_do
(brace
id|status
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|HIBERR
op_or
id|TxURN
op_or
id|TxERR
op_or
id|TxIDLE
op_or
id|RxORN
op_or
id|RxERR
op_or
id|RxOK
)paren
)paren
op_eq
l_int|0
)paren
multiline_comment|/* nothing intresting happened */
r_break
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* why dow&squot;t we break after Tx/Rx case ?? keyword: full-duplex */
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxORN
op_or
id|RxERR
op_or
id|RxOK
)paren
)paren
multiline_comment|/* Rx interrupt */
id|sis900_rx
c_func
(paren
id|net_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxURN
op_or
id|TxERR
op_or
id|TxIDLE
)paren
)paren
multiline_comment|/* Tx interrupt */
id|sis900_finish_xmit
c_func
(paren
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* something strange happened !!! */
r_if
c_cond
(paren
id|status
op_amp
id|HIBERR
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Abnormal interrupt,&quot;
l_string|&quot;status %#8.8x.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|boguscnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Too much work at interrupt, &quot;
l_string|&quot;interrupt status = %#8.8x.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: exiting interrupt, &quot;
l_string|&quot;interrupt status = 0x%#8.8x.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|inl
c_func
(paren
id|ioaddr
op_plus
id|isr
)paren
)paren
suffix:semicolon
id|spin_unlock
(paren
op_amp
id|sis_priv-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_rx - sis900 receive routine&n; *&t;@net_dev: the net device which receives data&n; *&n; *&t;Process receive interrupt events, &n; *&t;put buffer to higher layer and refill buffer pool&n; *&t;Note: This fucntion is called by interrupt handler, &n; *&t;don&squot;t do &quot;too much&quot; work here&n; */
DECL|function|sis900_rx
r_static
r_int
id|sis900_rx
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|entry
op_assign
id|sis_priv-&gt;cur_rx
op_mod
id|NUM_RX_DESC
suffix:semicolon
id|u32
id|rx_status
op_assign
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
suffix:semicolon
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;sis900_rx, cur_rx:%4.4d, dirty_rx:%4.4d &quot;
l_string|&quot;status:0x%8.8x&bslash;n&quot;
comma
id|sis_priv-&gt;cur_rx
comma
id|sis_priv-&gt;dirty_rx
comma
id|rx_status
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rx_status
op_amp
id|OWN
)paren
(brace
r_int
r_int
id|rx_size
suffix:semicolon
id|rx_size
op_assign
(paren
id|rx_status
op_amp
id|DSIZE
)paren
op_minus
id|CRC_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|ABORT
op_or
id|OVERRUN
op_or
id|TOOLONG
op_or
id|RUNT
op_or
id|RXISERR
op_or
id|CRCERR
op_or
id|FAERR
)paren
)paren
(brace
multiline_comment|/* corrupted packet received */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Corrupted packet &quot;
l_string|&quot;received, buffer status = 0x%8.8x.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|rx_status
)paren
suffix:semicolon
id|sis_priv-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|OVERRUN
)paren
id|sis_priv-&gt;stats.rx_over_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|TOOLONG
op_or
id|RUNT
)paren
)paren
id|sis_priv-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
(paren
id|RXISERR
op_or
id|FAERR
)paren
)paren
id|sis_priv-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|rx_status
op_amp
id|CRCERR
)paren
id|sis_priv-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
multiline_comment|/* reset buffer descriptor state */
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* This situation should never happen, but due to&n;&t;&t;&t;   some unknow bugs, it is possible that&n;&t;&t;&t;   we are working on NULL sk_buff :-( */
r_if
c_cond
(paren
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: NULL pointer &quot;
l_string|&quot;encountered in Rx ring, skipping&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pci_dma_sync_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufptr
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufptr
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
multiline_comment|/* give the socket buffer to upper layers */
id|skb
op_assign
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|rx_size
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|net_dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* some network statistics */
r_if
c_cond
(paren
(paren
id|rx_status
op_amp
id|BCAST
)paren
op_eq
id|MCAST
)paren
id|sis_priv-&gt;stats.multicast
op_increment
suffix:semicolon
id|net_dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|sis_priv-&gt;stats.rx_bytes
op_add_assign
id|rx_size
suffix:semicolon
id|sis_priv-&gt;stats.rx_packets
op_increment
suffix:semicolon
multiline_comment|/* refill the Rx buffer, what if there is not enought memory for&n;&t;&t;&t;   new socket buffer ?? */
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUF_SIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* not enough memory for skbuff, this makes a &quot;hole&quot;&n;&t;&t;&t;&t;   on the buffer ring, it is not clear how the&n;&t;&t;&t;&t;   hardware will react to this kind of degenerated&n;&t;&t;&t;&t;   buffer */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Memory squeeze,&quot;
l_string|&quot;deferring packet.&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* reset buffer descriptor state */
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufptr
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|net_dev
suffix:semicolon
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufptr
op_assign
id|pci_map_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|sis_priv-&gt;dirty_rx
op_increment
suffix:semicolon
)brace
id|sis_priv-&gt;cur_rx
op_increment
suffix:semicolon
id|entry
op_assign
id|sis_priv-&gt;cur_rx
op_mod
id|NUM_RX_DESC
suffix:semicolon
id|rx_status
op_assign
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
suffix:semicolon
)brace
singleline_comment|// while
multiline_comment|/* refill the Rx buffer, what if the rate of refilling is slower than &n;&t;   consuming ?? */
r_for
c_loop
(paren
suffix:semicolon
id|sis_priv-&gt;cur_rx
op_minus
id|sis_priv-&gt;dirty_rx
OG
l_int|0
suffix:semicolon
id|sis_priv-&gt;dirty_rx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|entry
op_assign
id|sis_priv-&gt;dirty_rx
op_mod
id|NUM_RX_DESC
suffix:semicolon
r_if
c_cond
(paren
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUF_SIZE
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* not enough memory for skbuff, this makes a &quot;hole&quot;&n;&t;&t;&t;&t;   on the buffer ring, it is not clear how the &n;&t;&t;&t;&t;   hardware will react to this kind of degenerated &n;&t;&t;&t;&t;   buffer */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Memory squeeze,&quot;
l_string|&quot;deferring packet.&bslash;n&quot;
comma
id|net_dev-&gt;name
)paren
suffix:semicolon
id|sis_priv-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|net_dev
suffix:semicolon
id|sis_priv-&gt;rx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
id|RX_BUF_SIZE
suffix:semicolon
id|sis_priv-&gt;rx_ring
(braket
id|entry
)braket
dot
id|bufptr
op_assign
id|pci_map_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|skb-&gt;tail
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* re-enable the potentially idle receive state matchine */
id|outl
c_func
(paren
id|RxENA
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_finish_xmit - finish up transmission of packets&n; *&t;@net_dev: the net device to be transmitted on&n; *&n; *&t;Check for error condition and free socket buffer etc &n; *&t;schedule for more transmission as needed&n; *&t;Note: This fucntion is called by interrupt handler, &n; *&t;don&squot;t do &quot;too much&quot; work here&n; */
DECL|function|sis900_finish_xmit
r_static
r_void
id|sis900_finish_xmit
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|sis_priv-&gt;dirty_tx
op_ne
id|sis_priv-&gt;cur_tx
suffix:semicolon
id|sis_priv-&gt;dirty_tx
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|entry
suffix:semicolon
id|u32
id|tx_status
suffix:semicolon
id|entry
op_assign
id|sis_priv-&gt;dirty_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
id|tx_status
op_assign
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|cmdsts
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|OWN
)paren
(brace
multiline_comment|/* The packet is not transmitted yet (owned by hardware) !&n;&t;&t;&t;   Note: the interrupt is generated only when Tx Machine&n;&t;&t;&t;   is idle, so this is an almost impossible case */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_status
op_amp
(paren
id|ABORT
op_or
id|UNDERRUN
op_or
id|OWCOLL
)paren
)paren
(brace
multiline_comment|/* packet unsuccessfully transmitted */
r_if
c_cond
(paren
id|sis900_debug
OG
l_int|3
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Transmit &quot;
l_string|&quot;error, Tx status %8.8x.&bslash;n&quot;
comma
id|net_dev-&gt;name
comma
id|tx_status
)paren
suffix:semicolon
id|sis_priv-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|UNDERRUN
)paren
id|sis_priv-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|ABORT
)paren
id|sis_priv-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|NOCARRIER
)paren
id|sis_priv-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tx_status
op_amp
id|OWCOLL
)paren
id|sis_priv-&gt;stats.tx_window_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* packet successfully transmitted */
id|sis_priv-&gt;stats.collisions
op_add_assign
(paren
id|tx_status
op_amp
id|COLCNT
)paren
op_rshift
l_int|16
suffix:semicolon
id|sis_priv-&gt;stats.tx_bytes
op_add_assign
id|tx_status
op_amp
id|DSIZE
suffix:semicolon
id|sis_priv-&gt;stats.tx_packets
op_increment
suffix:semicolon
)brace
multiline_comment|/* Free the original skb. */
id|skb
op_assign
id|sis_priv-&gt;tx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|bufptr
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sis_priv-&gt;tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|bufptr
op_assign
l_int|0
suffix:semicolon
id|sis_priv-&gt;tx_ring
(braket
id|entry
)braket
dot
id|cmdsts
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sis_priv-&gt;tx_full
op_logical_and
id|netif_queue_stopped
c_func
(paren
id|net_dev
)paren
op_logical_and
id|sis_priv-&gt;cur_tx
op_minus
id|sis_priv-&gt;dirty_tx
OL
id|NUM_TX_DESC
op_minus
l_int|4
)paren
(brace
multiline_comment|/* The ring is no longer full, clear tx_full and schedule more transmission&n;&t;&t;   by netif_wake_queue(net_dev) */
id|sis_priv-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
(paren
id|net_dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; *&t;sis900_close - close sis900 device &n; *&t;@net_dev: the net device to be closed&n; *&n; *&t;Disable interrupts, stop the Tx and Rx Status Machine &n; *&t;free Tx and RX socket buffer&n; */
r_static
r_int
DECL|function|sis900_close
id|sis900_close
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x0000
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx Status Machine */
id|outl
c_func
(paren
id|RxDIS
op_or
id|TxDIS
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|sis_priv-&gt;timer
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|net_dev-&gt;irq
comma
id|net_dev
)paren
suffix:semicolon
multiline_comment|/* Free Tx and RX skbuff */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb
op_assign
id|sis_priv-&gt;rx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;rx_ring
(braket
id|i
)braket
dot
id|bufptr
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sis_priv-&gt;rx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb
op_assign
id|sis_priv-&gt;tx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|sis_priv-&gt;tx_ring
(braket
id|i
)braket
dot
id|bufptr
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sis_priv-&gt;tx_skbuff
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Green! Put the chip in low-power mode. */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_get_drvinfo - Return information about driver&n; *&t;@net_dev: the net device to probe&n; *&t;@info: container for info returned&n; *&n; *&t;Process ethtool command such as &quot;ehtool -i&quot; to show information&n; */
DECL|function|sis900_get_drvinfo
r_static
r_void
id|sis900_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|strcpy
(paren
id|info-&gt;driver
comma
id|SIS900_MODULE_NAME
)paren
suffix:semicolon
id|strcpy
(paren
id|info-&gt;version
comma
id|SIS900_DRV_VERSION
)paren
suffix:semicolon
id|strcpy
(paren
id|info-&gt;bus_info
comma
id|pci_name
c_func
(paren
id|sis_priv-&gt;pci_dev
)paren
)paren
suffix:semicolon
)brace
DECL|variable|sis900_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|sis900_ethtool_ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|sis900_get_drvinfo
comma
)brace
suffix:semicolon
multiline_comment|/**&n; *&t;mii_ioctl - process MII i/o control command &n; *&t;@net_dev: the net device to command for&n; *&t;@rq: parameter for command&n; *&t;@cmd: the i/o command&n; *&n; *&t;Process MII command like read/write MII register&n; */
DECL|function|mii_ioctl
r_static
r_int
id|mii_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|mii_ioctl_data
op_star
id|data
op_assign
(paren
r_struct
id|mii_ioctl_data
op_star
)paren
op_amp
id|rq-&gt;ifr_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCGMIIPHY
suffix:colon
multiline_comment|/* Get address of MII PHY in use. */
id|data-&gt;phy_id
op_assign
id|sis_priv-&gt;mii-&gt;phy_addr
suffix:semicolon
multiline_comment|/* Fall Through */
r_case
id|SIOCGMIIREG
suffix:colon
multiline_comment|/* Read MII PHY register. */
id|data-&gt;val_out
op_assign
id|mdio_read
c_func
(paren
id|net_dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
multiline_comment|/* Write MII PHY register. */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|mdio_write
c_func
(paren
id|net_dev
comma
id|data-&gt;phy_id
op_amp
l_int|0x1f
comma
id|data-&gt;reg_num
op_amp
l_int|0x1f
comma
id|data-&gt;val_in
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; *&t;sis900_get_stats - Get sis900 read/write statistics &n; *&t;@net_dev: the net device to get statistics for&n; *&n; *&t;get tx/rx statistics for sis900&n; */
r_static
r_struct
id|net_device_stats
op_star
DECL|function|sis900_get_stats
id|sis900_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|sis_priv-&gt;stats
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_set_config - Set media type by net_device.set_config &n; *&t;@dev: the net device for media type change&n; *&t;@map: ifmap passed by ifconfig&n; *&n; *&t;Set media type to 10baseT, 100baseT or 0(for auto) by ifconfig&n; *&t;we support only port changes. All other runtime configuration&n; *&t;changes will be ignored&n; */
DECL|function|sis900_set_config
r_static
r_int
id|sis900_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|mii_phy
op_star
id|mii_phy
op_assign
id|sis_priv-&gt;mii
suffix:semicolon
id|u16
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|map-&gt;port
op_ne
(paren
id|u_char
)paren
(paren
op_minus
l_int|1
)paren
)paren
op_logical_and
(paren
id|map-&gt;port
op_ne
id|dev-&gt;if_port
)paren
)paren
(brace
multiline_comment|/* we switch on the ifmap-&gt;port field. I couldn&squot;t find anything&n;&t;&t;   like a definition or standard for the values of that field.&n;&t;&t;   I think the meaning of those values is device specific. But&n;&t;&t;   since I would like to change the media type via the ifconfig&n;&t;&t;   command I use the definition from linux/netdevice.h &n;&t;&t;   (which seems to be different from the ifport(pcmcia) definition) &n;&t;&t;*/
r_switch
c_cond
(paren
id|map-&gt;port
)paren
(brace
r_case
id|IF_PORT_UNKNOWN
suffix:colon
multiline_comment|/* use auto here */
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* we are going to change the media type, so the Link will&n;&t;&t;&t;   be temporary down and we need to reflect that here. When&n;&t;&t;&t;   the Link comes up again, it will be sensed by the sis_timer&n;&t;&t;&t;   procedure, which also does all the rest for us */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* read current state */
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
multiline_comment|/* enable auto negotiation and reset the negotioation&n;&t;&t;&t;   (I don&squot;t really know what the auto negatiotiation reset&n;&t;&t;&t;   really means, but it sounds for me right to do one here)*/
id|mdio_write
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|status
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_RST_AUTO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
multiline_comment|/* 10BaseT */
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* we are going to change the media type, so the Link will&n;&t;&t;&t;   be temporary down and we need to reflect that here. When&n;&t;&t;&t;   the Link comes up again, it will be sensed by the sis_timer&n;&t;&t;&t;   procedure, which also does all the rest for us */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set Speed to 10Mbps */
multiline_comment|/* read current state */
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
multiline_comment|/* disable auto negotiation and force 10MBit mode*/
id|mdio_write
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|status
op_amp
op_complement
(paren
id|MII_CNTL_SPEED
op_or
id|MII_CNTL_AUTO
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_100BASET
suffix:colon
multiline_comment|/* 100BaseT */
r_case
id|IF_PORT_100BASETX
suffix:colon
multiline_comment|/* 100BaseTx */
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* we are going to change the media type, so the Link will&n;&t;&t;&t;   be temporary down and we need to reflect that here. When&n;&t;&t;&t;   the Link comes up again, it will be sensed by the sis_timer&n;&t;&t;&t;   procedure, which also does all the rest for us */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set Speed to 100Mbps */
multiline_comment|/* disable auto negotiation and enable 100MBit Mode */
id|status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|mii_phy-&gt;phy_addr
comma
id|MII_CONTROL
comma
(paren
id|status
op_amp
op_complement
id|MII_CNTL_SPEED
)paren
op_or
id|MII_CNTL_SPEED
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASE2
suffix:colon
multiline_comment|/* 10Base2 */
r_case
id|IF_PORT_AUI
suffix:colon
multiline_comment|/* AUI */
r_case
id|IF_PORT_100BASEFX
suffix:colon
multiline_comment|/* 100BaseFx */
multiline_comment|/* These Modes are not supported (are they?)*/
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Not supported&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Invalid&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_mcast_bitnr - compute hashtable index &n; *&t;@addr: multicast address&n; *&t;@revision: revision id of chip&n; *&n; *&t;SiS 900 uses the most sigificant 7 bits to index a 128 bits multicast&n; *&t;hash table, which makes this function a little bit different from other drivers&n; *&t;SiS 900 B0 &amp; 635 M/B uses the most significat 8 bits to index 256 bits&n; *   &t;multicast hash table. &n; */
DECL|function|sis900_mcast_bitnr
r_static
r_inline
id|u16
id|sis900_mcast_bitnr
c_func
(paren
id|u8
op_star
id|addr
comma
id|u8
id|revision
)paren
(brace
id|u32
id|crc
op_assign
id|ether_crc
c_func
(paren
l_int|6
comma
id|addr
)paren
suffix:semicolon
multiline_comment|/* leave 8 or 7 most siginifant bits */
r_if
c_cond
(paren
(paren
id|revision
op_ge
id|SIS635A_900_REV
)paren
op_logical_or
(paren
id|revision
op_eq
id|SIS900B_900_REV
)paren
)paren
r_return
(paren
(paren
r_int
)paren
(paren
id|crc
op_rshift
l_int|24
)paren
)paren
suffix:semicolon
r_else
r_return
(paren
(paren
r_int
)paren
(paren
id|crc
op_rshift
l_int|25
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;set_rx_mode - Set SiS900 receive mode &n; *&t;@net_dev: the net device to be set&n; *&n; *&t;Set SiS900 receive mode for promiscuous, multicast, or broadcast mode.&n; *&t;And set the appropriate multicast filter.&n; *&t;Multicast hash table changes from 128 to 256 bits for 635M/B &amp; 900B0.&n; */
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
id|u16
id|mc_filter
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
multiline_comment|/* 256/128 bits multicast hash table */
r_int
id|i
comma
id|table_entries
suffix:semicolon
id|u32
id|rx_mode
suffix:semicolon
id|u8
id|revision
suffix:semicolon
multiline_comment|/* 635 Hash Table entires = 256(2^16) */
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|revision
op_ge
id|SIS635A_900_REV
)paren
op_logical_or
(paren
id|revision
op_eq
id|SIS900B_900_REV
)paren
)paren
(brace
id|table_entries
op_assign
l_int|16
suffix:semicolon
)brace
r_else
id|table_entries
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Accept any kinds of packets */
id|rx_mode
op_assign
id|RFPromiscuous
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|table_entries
suffix:semicolon
id|i
op_increment
)paren
id|mc_filter
(braket
id|i
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|net_dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* too many multicast addresses or accept all multicast packet */
id|rx_mode
op_assign
id|RFAAB
op_or
id|RFAAM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|table_entries
suffix:semicolon
id|i
op_increment
)paren
id|mc_filter
(braket
id|i
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Accept Broadcast packet, destination address matchs our MAC address,&n;&t;&t;   use Receive Filter to reject unwanted MCAST packet */
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|RFAAB
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|net_dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|net_dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
r_int
id|bit_nr
op_assign
id|sis900_mcast_bitnr
c_func
(paren
id|mclist-&gt;dmi_addr
comma
id|revision
)paren
suffix:semicolon
id|mc_filter
(braket
id|bit_nr
op_rshift
l_int|4
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|bit_nr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* update Multicast Hash Table in Receive Filter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|table_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* why plus 0x04 ??, That makes the correct value for hash table. */
id|outl
c_func
(paren
(paren
id|u32
)paren
(paren
l_int|0x00000004
op_plus
id|i
)paren
op_lshift
id|RFADDR_shift
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mc_filter
(braket
id|i
)braket
comma
id|ioaddr
op_plus
id|rfdr
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
id|RFEN
op_or
id|rx_mode
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
multiline_comment|/* sis900 is capatable of looping back packet at MAC level for debugging purpose */
r_if
c_cond
(paren
id|net_dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
(brace
id|u32
id|cr_saved
suffix:semicolon
multiline_comment|/* We must disable Tx/Rx before setting loopback mode */
id|cr_saved
op_assign
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|cr_saved
op_or
id|TxDIS
op_or
id|RxDIS
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
multiline_comment|/* enable loopback */
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|txcfg
)paren
op_or
id|TxMLB
comma
id|ioaddr
op_plus
id|txcfg
)paren
suffix:semicolon
id|outl
c_func
(paren
id|inl
c_func
(paren
id|ioaddr
op_plus
id|rxcfg
)paren
op_or
id|RxATX
comma
id|ioaddr
op_plus
id|rxcfg
)paren
suffix:semicolon
multiline_comment|/* restore cr */
id|outl
c_func
(paren
id|cr_saved
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_reset - Reset sis900 MAC &n; *&t;@net_dev: the net device to reset&n; *&n; *&t;reset sis900 MAC and wait until finished&n; *&t;reset through command register&n; *&t;change backoff algorithm for 900B0 &amp; 635 M/B&n; */
DECL|function|sis900_reset
r_static
r_void
id|sis900_reset
c_func
(paren
r_struct
id|net_device
op_star
id|net_dev
)paren
(brace
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_int
id|ioaddr
op_assign
id|net_dev-&gt;base_addr
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|u32
id|status
op_assign
id|TxRCMP
op_or
id|RxRCMP
suffix:semicolon
id|u8
id|revision
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|ier
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|imr
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ioaddr
op_plus
id|rfcr
)paren
suffix:semicolon
id|outl
c_func
(paren
id|RxRESET
op_or
id|TxRESET
op_or
id|RESET
op_or
id|inl
c_func
(paren
id|ioaddr
op_plus
id|cr
)paren
comma
id|ioaddr
op_plus
id|cr
)paren
suffix:semicolon
multiline_comment|/* Check that the chip has finished the reset. */
r_while
c_loop
(paren
id|status
op_logical_and
(paren
id|i
op_increment
OL
l_int|1000
)paren
)paren
(brace
id|status
op_xor_assign
(paren
id|inl
c_func
(paren
id|isr
op_plus
id|ioaddr
)paren
op_amp
id|status
)paren
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|sis_priv-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|revision
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|revision
op_ge
id|SIS635A_900_REV
)paren
op_logical_or
(paren
id|revision
op_eq
id|SIS900B_900_REV
)paren
)paren
(brace
id|outl
c_func
(paren
id|PESEL
op_or
id|RND_CNT
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
)brace
r_else
id|outl
c_func
(paren
id|PESEL
comma
id|ioaddr
op_plus
id|cfg
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;sis900_remove - Remove sis900 device &n; *&t;@pci_dev: the pci device to be removed&n; *&n; *&t;remove and release SiS900 net device&n; */
DECL|function|sis900_remove
r_static
r_void
id|__devexit
id|sis900_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_struct
id|sis900_private
op_star
id|sis_priv
op_assign
id|net_dev-&gt;priv
suffix:semicolon
r_struct
id|mii_phy
op_star
id|phy
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
id|sis_priv-&gt;first_mii
)paren
(brace
id|phy
op_assign
id|sis_priv-&gt;first_mii
suffix:semicolon
id|sis_priv-&gt;first_mii
op_assign
id|phy-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|phy
)paren
suffix:semicolon
)brace
id|pci_free_consistent
c_func
(paren
id|pci_dev
comma
id|RX_TOTAL_SIZE
comma
id|sis_priv-&gt;rx_ring
comma
id|sis_priv-&gt;rx_ring_dma
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pci_dev
comma
id|TX_TOTAL_SIZE
comma
id|sis_priv-&gt;tx_ring
comma
id|sis_priv-&gt;tx_ring_dma
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|net_dev
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|sis900_pci_driver
r_static
r_struct
id|pci_driver
id|sis900_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|SIS900_MODULE_NAME
comma
dot
id|id_table
op_assign
id|sis900_pci_tbl
comma
dot
id|probe
op_assign
id|sis900_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|sis900_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|sis900_init_module
r_static
r_int
id|__init
id|sis900_init_module
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* when a module, this is printed whether or not devices are found in probe */
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|version
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|sis900_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|sis900_cleanup_module
r_static
r_void
id|__exit
id|sis900_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|sis900_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|sis900_init_module
id|module_init
c_func
(paren
id|sis900_init_module
)paren
suffix:semicolon
DECL|variable|sis900_cleanup_module
id|module_exit
c_func
(paren
id|sis900_cleanup_module
)paren
suffix:semicolon
eof
