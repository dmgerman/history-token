multiline_comment|/*&n; *&n; * Alchemy Au1x00 ethernet driver&n; *&n; * Copyright 2001,2002,2003 MontaVista Software Inc.&n; * Copyright 2002 TimeSys Corp.&n; * Added ethtool/mii-tool support,&n; * Copyright 2004 Matt Porter &lt;mporter@kernel.crashing.org&gt;&n; * Update: 2004 Bjoern Riemer, riemer@fokus.fraunhofer.de &n; * or riemer@riemer-nt.de: fixed the link beat detection with &n; * ioctls (SIOCGMIIPHY)&n; * Author: MontaVista Software, Inc.&n; *         &t;ppopov@mvista.com or source@mvista.com&n; *&n; * ########################################################################&n; *&n; *  This program is free software; you can distribute it and/or modify it&n; *  under the terms of the GNU General Public License (Version 2) as&n; *  published by the Free Software Foundation.&n; *&n; *  This program is distributed in the hope it will be useful, but WITHOUT&n; *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or&n; *  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n; *  for more details.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * ########################################################################&n; *&n; * &n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/mipsregs.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/mach-au1x00/au1000.h&gt;
macro_line|#include &lt;asm/cpu.h&gt;
macro_line|#include &quot;au1000_eth.h&quot;
macro_line|#ifdef AU1000_ETH_DEBUG
DECL|variable|au1000_debug
r_static
r_int
id|au1000_debug
op_assign
l_int|5
suffix:semicolon
macro_line|#else
DECL|variable|au1000_debug
r_static
r_int
id|au1000_debug
op_assign
l_int|3
suffix:semicolon
macro_line|#endif
DECL|macro|DRV_NAME
mdefine_line|#define DRV_NAME&t;&quot;au1000eth&quot;
DECL|macro|DRV_VERSION
mdefine_line|#define DRV_VERSION&t;&quot;1.5&quot;
DECL|macro|DRV_AUTHOR
mdefine_line|#define DRV_AUTHOR&t;&quot;Pete Popov &lt;ppopov@embeddedalley.com&gt;&quot;
DECL|macro|DRV_DESC
mdefine_line|#define DRV_DESC&t;&quot;Au1xxx on-chip Ethernet driver&quot;
DECL|variable|DRV_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRV_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRV_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRV_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
singleline_comment|// prototypes
r_static
r_void
id|hard_stop
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|enable_rx_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device
op_star
id|au1000_probe
c_func
(paren
id|u32
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|port_num
)paren
suffix:semicolon
r_static
r_int
id|au1000_init
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|au1000_open
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|au1000_close
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|au1000_tx
c_func
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|au1000_rx
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|au1000_interrupt
c_func
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
r_static
r_void
id|au1000_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_int
id|au1000_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
suffix:semicolon
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|au1000_get_stats
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_inline
r_void
id|update_tx_stats
c_func
(paren
r_struct
id|net_device
op_star
comma
id|u32
comma
id|u32
)paren
suffix:semicolon
r_static
r_inline
r_void
id|update_rx_stats
c_func
(paren
r_struct
id|net_device
op_star
comma
id|u32
)paren
suffix:semicolon
r_static
r_void
id|au1000_timer
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
id|au1000_ioctl
c_func
(paren
r_struct
id|net_device
op_star
comma
r_struct
id|ifreq
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
comma
r_int
comma
r_int
comma
id|u16
)paren
suffix:semicolon
r_static
r_void
id|dump_mii
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
)paren
suffix:semicolon
singleline_comment|// externs
r_extern
r_void
id|ack_rise_edge_irq
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
id|get_ethernet_addr
c_func
(paren
r_char
op_star
id|ethernet_addr
)paren
suffix:semicolon
r_extern
r_void
id|str2eaddr
c_func
(paren
r_int
r_char
op_star
id|ea
comma
r_int
r_char
op_star
id|str
)paren
suffix:semicolon
r_extern
r_char
op_star
id|__init
id|prom_getcmdline
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*&n; * Theory of operation&n; *&n; * The Au1000 MACs use a simple rx and tx descriptor ring scheme. &n; * There are four receive and four transmit descriptors.  These &n; * descriptors are not in memory; rather, they are just a set of &n; * hardware registers.&n; *&n; * Since the Au1000 has a coherent data cache, the receive and&n; * transmit buffers are allocated from the KSEG0 segment. The &n; * hardware registers, however, are still mapped at KSEG1 to&n; * make sure there&squot;s no out-of-order writes, and that all writes&n; * complete immediately.&n; */
multiline_comment|/* These addresses are only used if yamon doesn&squot;t tell us what&n; * the mac address is, and the mac address is not passed on the&n; * command line.&n; */
DECL|variable|__devinitdata
r_static
r_int
r_char
id|au1000_mac_addr
(braket
l_int|6
)braket
id|__devinitdata
op_assign
(brace
l_int|0x00
comma
l_int|0x50
comma
l_int|0xc2
comma
l_int|0x0c
comma
l_int|0x30
comma
l_int|0x00
)brace
suffix:semicolon
DECL|macro|nibswap
mdefine_line|#define nibswap(x) ((((x) &gt;&gt; 4) &amp; 0x0f) | (((x) &lt;&lt; 4) &amp; 0xf0))
DECL|macro|RUN_AT
mdefine_line|#define RUN_AT(x) (jiffies + (x))
singleline_comment|// For reading/writing 32-bit words from/to DMA memory
DECL|macro|cpu_to_dma32
mdefine_line|#define cpu_to_dma32 cpu_to_be32
DECL|macro|dma32_to_cpu
mdefine_line|#define dma32_to_cpu be32_to_cpu
DECL|variable|au_macs
r_struct
id|au1000_private
op_star
id|au_macs
(braket
id|NUM_ETH_INTERFACES
)braket
suffix:semicolon
multiline_comment|/* FIXME &n; * All of the PHY code really should be detached from the MAC &n; * code.&n; */
multiline_comment|/* Default advertise */
DECL|macro|GENMII_DEFAULT_ADVERTISE
mdefine_line|#define GENMII_DEFAULT_ADVERTISE &bslash;&n;&t;ADVERTISED_10baseT_Half | ADVERTISED_10baseT_Full | &bslash;&n;&t;ADVERTISED_100baseT_Half | ADVERTISED_100baseT_Full | &bslash;&n;&t;ADVERTISED_Autoneg
DECL|macro|GENMII_DEFAULT_FEATURES
mdefine_line|#define GENMII_DEFAULT_FEATURES &bslash;&n;&t;SUPPORTED_10baseT_Half | SUPPORTED_10baseT_Full | &bslash;&n;&t;SUPPORTED_100baseT_Half | SUPPORTED_100baseT_Full | &bslash;&n;&t;SUPPORTED_Autoneg
DECL|variable|phy_link
r_static
r_char
op_star
id|phy_link
(braket
)braket
op_assign
(brace
l_string|&quot;unknown&quot;
comma
l_string|&quot;10Base2&quot;
comma
l_string|&quot;10BaseT&quot;
comma
l_string|&quot;AUI&quot;
comma
l_string|&quot;100BaseT&quot;
comma
l_string|&quot;100BaseTX&quot;
comma
l_string|&quot;100BaseFX&quot;
)brace
suffix:semicolon
DECL|function|bcm_5201_init
r_int
id|bcm_5201_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|data
suffix:semicolon
multiline_comment|/* Stop auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
op_amp
op_complement
id|MII_CNTL_AUTO
)paren
suffix:semicolon
multiline_comment|/* Set advertisement to 10/100 and Half/Full duplex&n;&t; * (full capabilities) */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_T
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Restart auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_CNTL_RST_AUTO
op_or
id|MII_CNTL_AUTO
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bcm_5201_reset
r_int
id|bcm_5201_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|bcm_5201_status
id|bcm_5201_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bcm_5201_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_AUX_CNTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AUX_100
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AUX_FDX
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lsi_80227_init
r_int
id|lsi_80227_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;lsi_80227_init&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* restart auto-negotiation */
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|MII_CNTL_F100
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_RST_AUTO
)paren
suffix:semicolon
singleline_comment|// | MII_CNTL_FDX);
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* set up LEDs to correct display */
macro_line|#ifdef CONFIG_MIPS_MTX1
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
l_int|17
comma
l_int|0xff80
)paren
suffix:semicolon
macro_line|#else
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
l_int|17
comma
l_int|0xffc0
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lsi_80227_reset
r_int
id|lsi_80227_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;lsi_80227_reset&bslash;n&quot;
)paren
suffix:semicolon
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
)brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|lsi_80227_status
id|lsi_80227_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lsi_80227_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_LSI_PHY_STAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_LSI_PHY_STAT_SPD
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_LSI_PHY_STAT_FDX
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|am79c901_init
r_int
id|am79c901_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;am79c901_init&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|am79c901_reset
r_int
id|am79c901_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;am79c901_reset&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|am79c901_status
id|am79c901_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|am79c874_init
r_int
id|am79c874_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|data
suffix:semicolon
multiline_comment|/* 79c874 has quit resembled bit assignments to BCM5201 */
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;am79c847_init&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Stop auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
op_amp
op_complement
id|MII_CNTL_AUTO
)paren
suffix:semicolon
multiline_comment|/* Set advertisement to 10/100 and Half/Full duplex&n;&t; * (full capabilities) */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_T
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Restart auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_CNTL_RST_AUTO
op_or
id|MII_CNTL_AUTO
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|am79c874_reset
r_int
id|am79c874_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;am79c874_reset&bslash;n&quot;
)paren
suffix:semicolon
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|am79c874_status
id|am79c874_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
singleline_comment|// printk(&quot;am79c874_status&bslash;n&quot;);
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;am79c874_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_AMD_PHY_STAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AMD_PHY_STAT_SPD
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AMD_PHY_STAT_FDX
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lxt971a_init
r_int
id|lxt971a_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;lxt971a_init&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* restart auto-negotiation */
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|MII_CNTL_F100
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_RST_AUTO
op_or
id|MII_CNTL_FDX
)paren
suffix:semicolon
multiline_comment|/* set up LEDs to correct display */
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
l_int|20
comma
l_int|0x0422
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lxt971a_reset
r_int
id|lxt971a_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;lxt971a_reset&bslash;n&quot;
)paren
suffix:semicolon
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
)brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|lxt971a_status
id|lxt971a_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;lxt971a_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_INTEL_PHY_STAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_INTEL_PHY_STAT_SPD
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_INTEL_PHY_STAT_FDX
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ks8995m_init
r_int
id|ks8995m_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|data
suffix:semicolon
singleline_comment|//&t;printk(&quot;ks8995m_init&bslash;n&quot;);
multiline_comment|/* Stop auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
op_amp
op_complement
id|MII_CNTL_AUTO
)paren
suffix:semicolon
multiline_comment|/* Set advertisement to 10/100 and Half/Full duplex&n;&t; * (full capabilities) */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_T
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Restart auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_CNTL_RST_AUTO
op_or
id|MII_CNTL_AUTO
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ks8995m_reset
r_int
id|ks8995m_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
singleline_comment|//&t;printk(&quot;ks8995m_reset&bslash;n&quot;);
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ks8995m_status
r_int
id|ks8995m_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ks8995m_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_AUX_CNTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AUX_100
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_AUX_FDX
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|smsc_83C185_init
id|smsc_83C185_init
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|data
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;smsc_83C185_init&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Stop auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
op_amp
op_complement
id|MII_CNTL_AUTO
)paren
suffix:semicolon
multiline_comment|/* Set advertisement to 10/100 and Half/Full duplex&n;&t; * (full capabilities) */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_NWAY_TX
op_or
id|MII_NWAY_TX_FDX
op_or
id|MII_NWAY_T_FDX
op_or
id|MII_NWAY_T
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_ANADV
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* Restart auto-negotiation */
id|data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|data
op_or_assign
id|MII_CNTL_RST_AUTO
op_or
id|MII_CNTL_AUTO
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|dump_mii
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|smsc_83C185_reset
id|smsc_83C185_reset
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
id|s16
id|mii_control
comma
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;smsc_83C185_reset&bslash;n&quot;
)paren
suffix:semicolon
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
comma
id|mii_control
op_or
id|MII_CNTL_RESET
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|100
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
op_decrement
id|timeout
)paren
(brace
id|mii_control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mii_control
op_amp
id|MII_CNTL_RESET
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s PHY reset timeout !&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|smsc_83C185_status
id|smsc_83C185_status
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
id|u16
id|mii_data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;smsc_83C185_status error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
id|MII_STAT_LINK
)paren
(brace
op_star
id|link
op_assign
l_int|1
suffix:semicolon
id|mii_data
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data
op_amp
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
(brace
r_if
c_cond
(paren
id|mii_data
op_amp
(paren
l_int|1
op_lshift
l_int|4
)paren
)paren
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASETX
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|speed
op_assign
id|IF_PORT_10BASET
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_10BASET
suffix:semicolon
)brace
)brace
r_else
(brace
op_star
id|link
op_assign
l_int|0
suffix:semicolon
op_star
id|speed
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_UNKNOWN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
DECL|function|stub_init
r_int
id|stub_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
singleline_comment|//printk(&quot;PHY stub_init&bslash;n&quot;);
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|stub_reset
r_int
id|stub_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
)paren
(brace
singleline_comment|//printk(&quot;PHY stub_reset&bslash;n&quot;);
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|stub_status
id|stub_status
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_addr
comma
id|u16
op_star
id|link
comma
id|u16
op_star
id|speed
)paren
(brace
singleline_comment|//printk(&quot;PHY stub_status&bslash;n&quot;);
op_star
id|link
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* hmmm, revisit */
op_star
id|speed
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|IF_PORT_100BASEFX
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|bcm_5201_ops
r_struct
id|phy_ops
id|bcm_5201_ops
op_assign
(brace
id|bcm_5201_init
comma
id|bcm_5201_reset
comma
id|bcm_5201_status
comma
)brace
suffix:semicolon
DECL|variable|am79c874_ops
r_struct
id|phy_ops
id|am79c874_ops
op_assign
(brace
id|am79c874_init
comma
id|am79c874_reset
comma
id|am79c874_status
comma
)brace
suffix:semicolon
DECL|variable|am79c901_ops
r_struct
id|phy_ops
id|am79c901_ops
op_assign
(brace
id|am79c901_init
comma
id|am79c901_reset
comma
id|am79c901_status
comma
)brace
suffix:semicolon
DECL|variable|lsi_80227_ops
r_struct
id|phy_ops
id|lsi_80227_ops
op_assign
(brace
id|lsi_80227_init
comma
id|lsi_80227_reset
comma
id|lsi_80227_status
comma
)brace
suffix:semicolon
DECL|variable|lxt971a_ops
r_struct
id|phy_ops
id|lxt971a_ops
op_assign
(brace
id|lxt971a_init
comma
id|lxt971a_reset
comma
id|lxt971a_status
comma
)brace
suffix:semicolon
DECL|variable|ks8995m_ops
r_struct
id|phy_ops
id|ks8995m_ops
op_assign
(brace
id|ks8995m_init
comma
id|ks8995m_reset
comma
id|ks8995m_status
comma
)brace
suffix:semicolon
DECL|variable|smsc_83C185_ops
r_struct
id|phy_ops
id|smsc_83C185_ops
op_assign
(brace
id|smsc_83C185_init
comma
id|smsc_83C185_reset
comma
id|smsc_83C185_status
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
DECL|variable|stub_ops
r_struct
id|phy_ops
id|stub_ops
op_assign
(brace
id|stub_init
comma
id|stub_reset
comma
id|stub_status
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|struct|mii_chip_info
r_static
r_struct
id|mii_chip_info
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|phy_id0
id|u16
id|phy_id0
suffix:semicolon
DECL|member|phy_id1
id|u16
id|phy_id1
suffix:semicolon
DECL|member|phy_ops
r_struct
id|phy_ops
op_star
id|phy_ops
suffix:semicolon
DECL|member|dual_phy
r_int
id|dual_phy
suffix:semicolon
DECL|variable|mii_chip_table
)brace
id|mii_chip_table
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Broadcom BCM5201 10/100 BaseT PHY&quot;
comma
l_int|0x0040
comma
l_int|0x6212
comma
op_amp
id|bcm_5201_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Broadcom BCM5221 10/100 BaseT PHY&quot;
comma
l_int|0x0040
comma
l_int|0x61e4
comma
op_amp
id|bcm_5201_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Broadcom BCM5222 10/100 BaseT PHY&quot;
comma
l_int|0x0040
comma
l_int|0x6322
comma
op_amp
id|bcm_5201_ops
comma
l_int|1
)brace
comma
(brace
l_string|&quot;AMD 79C901 HomePNA PHY&quot;
comma
l_int|0x0000
comma
l_int|0x35c8
comma
op_amp
id|am79c901_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;AMD 79C874 10/100 BaseT PHY&quot;
comma
l_int|0x0022
comma
l_int|0x561b
comma
op_amp
id|am79c874_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;LSI 80227 10/100 BaseT PHY&quot;
comma
l_int|0x0016
comma
l_int|0xf840
comma
op_amp
id|lsi_80227_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Intel LXT971A Dual Speed PHY&quot;
comma
l_int|0x0013
comma
l_int|0x78e2
comma
op_amp
id|lxt971a_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Kendin KS8995M 10/100 BaseT PHY&quot;
comma
l_int|0x0022
comma
l_int|0x1450
comma
op_amp
id|ks8995m_ops
comma
l_int|0
)brace
comma
(brace
l_string|&quot;SMSC LAN83C185 10/100 BaseT PHY&quot;
comma
l_int|0x0007
comma
l_int|0xc0a3
comma
op_amp
id|smsc_83C185_ops
comma
l_int|0
)brace
comma
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
(brace
l_string|&quot;Stub&quot;
comma
l_int|0x1234
comma
l_int|0x5678
comma
op_amp
id|stub_ops
)brace
comma
macro_line|#endif
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|reg
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
id|u32
op_star
id|mii_control_reg
suffix:semicolon
r_volatile
id|u32
op_star
id|mii_data_reg
suffix:semicolon
id|u32
id|timedout
op_assign
l_int|20
suffix:semicolon
id|u32
id|mii_control
suffix:semicolon
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
multiline_comment|/* First time we probe, it&squot;s for the mac0 phy.&n;&t; * Since we haven&squot;t determined yet that we have a dual phy,&n;&t; * aup-&gt;mii-&gt;mii_control_reg won&squot;t be setup and we&squot;ll&n;&t; * default to the else statement.&n;&t; * By the time we probe for the mac1 phy, the mii_control_reg&n;&t; * will be setup to be the address of the mac0 phy control since&n;&t; * both phys are controlled through mac0.&n;&t; */
r_if
c_cond
(paren
id|aup-&gt;mii
op_logical_and
id|aup-&gt;mii-&gt;mii_control_reg
)paren
(brace
id|mii_control_reg
op_assign
id|aup-&gt;mii-&gt;mii_control_reg
suffix:semicolon
id|mii_data_reg
op_assign
id|aup-&gt;mii-&gt;mii_data_reg
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii
op_logical_and
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_control_reg
)paren
(brace
multiline_comment|/* assume both phys are controlled through mac0 */
id|mii_control_reg
op_assign
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_control_reg
suffix:semicolon
id|mii_data_reg
op_assign
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_data_reg
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
multiline_comment|/* default control and data reg addresses */
id|mii_control_reg
op_assign
op_amp
id|aup-&gt;mac-&gt;mii_control
suffix:semicolon
id|mii_data_reg
op_assign
op_amp
id|aup-&gt;mac-&gt;mii_data
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|mii_control_reg
op_amp
id|MAC_MII_BUSY
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timedout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: read_MII busy timeout!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|mii_control
op_assign
id|MAC_SET_MII_SELECT_REG
c_func
(paren
id|reg
)paren
op_or
id|MAC_SET_MII_SELECT_PHY
c_func
(paren
id|phy_id
)paren
op_or
id|MAC_MII_READ
suffix:semicolon
op_star
id|mii_control_reg
op_assign
id|mii_control
suffix:semicolon
id|timedout
op_assign
l_int|20
suffix:semicolon
r_while
c_loop
(paren
op_star
id|mii_control_reg
op_amp
id|MAC_MII_BUSY
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timedout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: mdio_read busy timeout!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
(paren
r_int
)paren
op_star
id|mii_data_reg
suffix:semicolon
)brace
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|reg
comma
id|u16
id|value
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
id|u32
op_star
id|mii_control_reg
suffix:semicolon
r_volatile
id|u32
op_star
id|mii_data_reg
suffix:semicolon
id|u32
id|timedout
op_assign
l_int|20
suffix:semicolon
id|u32
id|mii_control
suffix:semicolon
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
r_if
c_cond
(paren
id|aup-&gt;mii
op_logical_and
id|aup-&gt;mii-&gt;mii_control_reg
)paren
(brace
id|mii_control_reg
op_assign
id|aup-&gt;mii-&gt;mii_control_reg
suffix:semicolon
id|mii_data_reg
op_assign
id|aup-&gt;mii-&gt;mii_data_reg
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii
op_logical_and
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_control_reg
)paren
(brace
multiline_comment|/* assume both phys are controlled through mac0 */
id|mii_control_reg
op_assign
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_control_reg
suffix:semicolon
id|mii_data_reg
op_assign
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_data_reg
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
multiline_comment|/* default control and data reg addresses */
id|mii_control_reg
op_assign
op_amp
id|aup-&gt;mac-&gt;mii_control
suffix:semicolon
id|mii_data_reg
op_assign
op_amp
id|aup-&gt;mac-&gt;mii_data
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|mii_control_reg
op_amp
id|MAC_MII_BUSY
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timedout
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: mdio_write busy timeout!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|mii_control
op_assign
id|MAC_SET_MII_SELECT_REG
c_func
(paren
id|reg
)paren
op_or
id|MAC_SET_MII_SELECT_PHY
c_func
(paren
id|phy_id
)paren
op_or
id|MAC_MII_WRITE
suffix:semicolon
op_star
id|mii_data_reg
op_assign
id|value
suffix:semicolon
op_star
id|mii_control_reg
op_assign
id|mii_control
suffix:semicolon
)brace
DECL|function|dump_mii
r_static
r_void
id|dump_mii
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
)paren
(brace
r_int
id|i
comma
id|val
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|i
)paren
)paren
op_ge
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: MII Reg %d=%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
comma
id|val
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_id
comma
id|i
)paren
)paren
op_ge
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: MII Reg %d=%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
comma
id|val
)paren
suffix:semicolon
)brace
)brace
DECL|function|mii_probe
r_static
r_int
id|mii_probe
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|phy_addr
suffix:semicolon
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
r_int
id|phy_found
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* search for total of 32 possible mii phy addresses */
r_for
c_loop
(paren
id|phy_addr
op_assign
l_int|0
suffix:semicolon
id|phy_addr
OL
l_int|32
suffix:semicolon
id|phy_addr
op_increment
)paren
(brace
id|u16
id|mii_status
suffix:semicolon
id|u16
id|phy_id0
comma
id|phy_id1
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
multiline_comment|/* Mask the already found phy, try next one */
r_if
c_cond
(paren
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii
op_logical_and
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii-&gt;mii_control_reg
)paren
(brace
r_if
c_cond
(paren
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|phy_addr
op_eq
id|phy_addr
)paren
r_continue
suffix:semicolon
)brace
macro_line|#endif
id|mii_status
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_status
op_eq
l_int|0xffff
op_logical_or
id|mii_status
op_eq
l_int|0x0000
)paren
multiline_comment|/* the mii is not accessable, try next one */
r_continue
suffix:semicolon
id|phy_id0
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_ID0
)paren
suffix:semicolon
id|phy_id1
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|phy_addr
comma
id|MII_PHY_ID1
)paren
suffix:semicolon
multiline_comment|/* search our mii table for the current mii */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|phy_id0
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id0
op_logical_and
id|phy_id1
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
)paren
(brace
r_struct
id|mii_phy
op_star
id|mii_phy
op_assign
id|aup-&gt;mii
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at phy address %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mii_chip_table
(braket
id|i
)braket
dot
id|name
comma
id|phy_addr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
id|phy_found
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|mii_phy-&gt;chip_info
op_assign
id|mii_chip_table
op_plus
id|i
suffix:semicolon
id|aup-&gt;phy_addr
op_assign
id|phy_addr
suffix:semicolon
id|aup-&gt;want_autoneg
op_assign
l_int|1
suffix:semicolon
id|aup-&gt;phy_ops
op_assign
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_ops
suffix:semicolon
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_init
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
singleline_comment|// Check for dual-phy and then store required 
singleline_comment|// values and set indicators. We need to do 
singleline_comment|// this now since mdio_{read,write} need the 
singleline_comment|// control and data register addresses.
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
r_if
c_cond
(paren
id|mii_chip_table
(braket
id|i
)braket
dot
id|dual_phy
)paren
(brace
multiline_comment|/* assume both phys are controlled &n;&t;&t;&t;&t;&t; * through MAC0. Board specific? */
multiline_comment|/* sanity check */
r_if
c_cond
(paren
op_logical_neg
id|au_macs
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mii
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|aup-&gt;mii-&gt;mii_control_reg
op_assign
(paren
id|u32
op_star
)paren
op_amp
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mac-&gt;mii_control
suffix:semicolon
id|aup-&gt;mii-&gt;mii_data_reg
op_assign
(paren
id|u32
op_star
)paren
op_amp
id|au_macs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|mac-&gt;mii_data
suffix:semicolon
)brace
macro_line|#endif
r_goto
id|found
suffix:semicolon
)brace
)brace
)brace
id|found
suffix:colon
macro_line|#ifdef CONFIG_MIPS_BOSPORUS
multiline_comment|/* This is a workaround for the Micrel/Kendin 5 port switch&n;&t;   The second MAC doesn&squot;t see a PHY connected... so we need to&n;&t;   trick it into thinking we have one.&n;&t;&t;&n;&t;   If this kernel is run on another Au1500 development board&n;&t;   the stub will be found as well as the actual PHY. However,&n;&t;   the last found PHY will be used... usually at Addr 31 (Db1500).&t;&n;&t;*/
r_if
c_cond
(paren
(paren
op_logical_neg
id|phy_found
)paren
)paren
(brace
id|u16
id|phy_id0
comma
id|phy_id1
suffix:semicolon
r_int
id|i
suffix:semicolon
id|phy_id0
op_assign
l_int|0x1234
suffix:semicolon
id|phy_id1
op_assign
l_int|0x5678
suffix:semicolon
multiline_comment|/* search our mii table for the current mii */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|phy_id0
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id0
op_logical_and
id|phy_id1
op_eq
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_id1
)paren
(brace
r_struct
id|mii_phy
op_star
id|mii_phy
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at phy address %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|mii_chip_table
(braket
id|i
)braket
dot
id|name
comma
id|phy_addr
)paren
suffix:semicolon
id|mii_phy
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mii_phy
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_phy
)paren
(brace
id|mii_phy-&gt;chip_info
op_assign
id|mii_chip_table
op_plus
id|i
suffix:semicolon
id|aup-&gt;phy_addr
op_assign
id|phy_addr
suffix:semicolon
id|mii_phy-&gt;next
op_assign
id|aup-&gt;mii
suffix:semicolon
id|aup-&gt;phy_ops
op_assign
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_ops
suffix:semicolon
id|aup-&gt;mii
op_assign
id|mii_phy
suffix:semicolon
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_init
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|mii_phy-&gt;chip_info
op_assign
id|mii_chip_table
op_plus
id|i
suffix:semicolon
id|aup-&gt;phy_addr
op_assign
id|phy_addr
suffix:semicolon
id|aup-&gt;phy_ops
op_assign
id|mii_chip_table
(braket
id|i
)braket
dot
id|phy_ops
suffix:semicolon
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_init
c_func
(paren
id|dev
comma
id|phy_addr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|aup-&gt;mac_id
op_eq
l_int|0
)paren
(brace
multiline_comment|/* the Bosporus phy responds to addresses 0-5 but &n;&t;&t; * 5 is the correct one.&n;&t;&t; */
id|aup-&gt;phy_addr
op_assign
l_int|5
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|aup-&gt;mii-&gt;chip_info
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Au1x No MII transceivers found!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Using %s as default&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|aup-&gt;mii-&gt;chip_info-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Buffer allocation/deallocation routines. The buffer descriptor returned&n; * has the virtual and dma address of a buffer suitable for &n; * both, receive and transmit operations.&n; */
DECL|function|GetFreeDB
r_static
id|db_dest_t
op_star
id|GetFreeDB
c_func
(paren
r_struct
id|au1000_private
op_star
id|aup
)paren
(brace
id|db_dest_t
op_star
id|pDB
suffix:semicolon
id|pDB
op_assign
id|aup-&gt;pDBfree
suffix:semicolon
r_if
c_cond
(paren
id|pDB
)paren
(brace
id|aup-&gt;pDBfree
op_assign
id|pDB-&gt;pnext
suffix:semicolon
)brace
r_return
id|pDB
suffix:semicolon
)brace
DECL|function|ReleaseDB
r_void
id|ReleaseDB
c_func
(paren
r_struct
id|au1000_private
op_star
id|aup
comma
id|db_dest_t
op_star
id|pDB
)paren
(brace
id|db_dest_t
op_star
id|pDBfree
op_assign
id|aup-&gt;pDBfree
suffix:semicolon
r_if
c_cond
(paren
id|pDBfree
)paren
id|pDBfree-&gt;pnext
op_assign
id|pDB
suffix:semicolon
id|aup-&gt;pDBfree
op_assign
id|pDB
suffix:semicolon
)brace
DECL|function|enable_rx_tx
r_static
r_void
id|enable_rx_tx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: enable_rx_tx&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_or_assign
(paren
id|MAC_RX_ENABLE
op_or
id|MAC_TX_ENABLE
)paren
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|hard_stop
r_static
r_void
id|hard_stop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: hard stop&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_and_assign
op_complement
(paren
id|MAC_RX_ENABLE
op_or
id|MAC_TX_ENABLE
)paren
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|reset_mac
r_static
r_void
id|reset_mac
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|flags
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: reset mac, aup %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|aup
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aup-&gt;timer.function
op_eq
op_amp
id|au1000_timer
)paren
(brace
multiline_comment|/* check if timer initted */
id|del_timer
c_func
(paren
op_amp
id|aup-&gt;timer
)paren
suffix:semicolon
)brace
id|hard_stop
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
r_if
c_cond
(paren
id|aup-&gt;mac_id
op_ne
l_int|0
)paren
(brace
macro_line|#endif
multiline_comment|/* If BCM5222, we can&squot;t leave MAC0 in reset because then &n;&t;&t; * we can&squot;t access the dual phy for ETH1 */
op_star
id|aup-&gt;enable
op_assign
id|MAC_EN_CLOCK_ENABLE
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|2
)paren
suffix:semicolon
op_star
id|aup-&gt;enable
op_assign
l_int|0
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|2
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BCM5222_DUAL_PHY
)brace
macro_line|#endif
id|aup-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* reset control bits */
id|aup-&gt;rx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|buff_stat
op_and_assign
op_complement
l_int|0xf
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* reset control bits */
id|aup-&gt;tx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|buff_stat
op_and_assign
op_complement
l_int|0xf
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * Setup the receive and transmit &quot;rings&quot;.  These pointers are the addresses&n; * of the rx and tx MAC DMA registers so they are fixed by the hardware --&n; * these are not descriptors sitting in memory.&n; */
r_static
r_void
DECL|function|setup_hw_rings
id|setup_hw_rings
c_func
(paren
r_struct
id|au1000_private
op_star
id|aup
comma
id|u32
id|rx_base
comma
id|u32
id|tx_base
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|aup-&gt;rx_dma_ring
(braket
id|i
)braket
op_assign
(paren
r_volatile
id|rx_dma_t
op_star
)paren
(paren
id|rx_base
op_plus
r_sizeof
(paren
id|rx_dma_t
)paren
op_star
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|aup-&gt;tx_dma_ring
(braket
id|i
)braket
op_assign
(paren
r_volatile
id|tx_dma_t
op_star
)paren
(paren
id|tx_base
op_plus
r_sizeof
(paren
id|tx_dma_t
)paren
op_star
id|i
)paren
suffix:semicolon
)brace
)brace
r_static
r_struct
(brace
DECL|member|port
r_int
id|port
suffix:semicolon
DECL|member|base_addr
id|u32
id|base_addr
suffix:semicolon
DECL|member|macen_addr
id|u32
id|macen_addr
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|variable|iflist
)brace
id|iflist
(braket
l_int|2
)braket
suffix:semicolon
DECL|variable|num_ifs
r_static
r_int
id|num_ifs
suffix:semicolon
multiline_comment|/*&n; * Setup the base address and interupt of the Au1xxx ethernet macs&n; * based on cpu type and whether the interface is enabled in sys_pinfunc&n; * register. The last interface is enabled if SYS_PF_NI2 (bit 4) is 0.&n; */
DECL|function|au1000_init_module
r_static
r_int
id|__init
id|au1000_init_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|cpuinfo_mips
op_star
id|c
op_assign
op_amp
id|current_cpu_data
suffix:semicolon
r_int
id|ni
op_assign
(paren
r_int
)paren
(paren
(paren
id|au_readl
c_func
(paren
id|SYS_PINFUNC
)paren
op_amp
(paren
id|u32
)paren
(paren
id|SYS_PF_NI2
)paren
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|i
comma
id|found_one
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|c-&gt;cputype
)paren
(brace
macro_line|#ifdef CONFIG_SOC_AU1000
r_case
id|CPU_AU1000
suffix:colon
id|num_ifs
op_assign
l_int|2
op_minus
id|ni
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|base_addr
op_assign
id|AU1000_ETH0_BASE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|base_addr
op_assign
id|AU1000_ETH1_BASE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|macen_addr
op_assign
id|AU1000_MAC0_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|macen_addr
op_assign
id|AU1000_MAC1_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|irq
op_assign
id|AU1000_MAC0_DMA_INT
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|irq
op_assign
id|AU1000_MAC1_DMA_INT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SOC_AU1100
r_case
id|CPU_AU1100
suffix:colon
id|num_ifs
op_assign
l_int|1
op_minus
id|ni
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|base_addr
op_assign
id|AU1100_ETH0_BASE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|macen_addr
op_assign
id|AU1100_MAC0_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|irq
op_assign
id|AU1100_MAC0_DMA_INT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SOC_AU1500
r_case
id|CPU_AU1500
suffix:colon
id|num_ifs
op_assign
l_int|2
op_minus
id|ni
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|base_addr
op_assign
id|AU1500_ETH0_BASE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|base_addr
op_assign
id|AU1500_ETH1_BASE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|macen_addr
op_assign
id|AU1500_MAC0_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|macen_addr
op_assign
id|AU1500_MAC1_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|irq
op_assign
id|AU1500_MAC0_DMA_INT
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|irq
op_assign
id|AU1500_MAC1_DMA_INT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SOC_AU1550
r_case
id|CPU_AU1550
suffix:colon
id|num_ifs
op_assign
l_int|2
op_minus
id|ni
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|base_addr
op_assign
id|AU1550_ETH0_BASE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|base_addr
op_assign
id|AU1550_ETH1_BASE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|macen_addr
op_assign
id|AU1550_MAC0_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|macen_addr
op_assign
id|AU1550_MAC1_ENABLE
suffix:semicolon
id|iflist
(braket
l_int|0
)braket
dot
id|irq
op_assign
id|AU1550_MAC0_DMA_INT
suffix:semicolon
id|iflist
(braket
l_int|1
)braket
dot
id|irq
op_assign
id|AU1550_MAC1_DMA_INT
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|num_ifs
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_ifs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev
op_assign
id|au1000_probe
c_func
(paren
id|iflist
(braket
id|i
)braket
dot
id|base_addr
comma
id|iflist
(braket
id|i
)braket
dot
id|irq
comma
id|i
)paren
suffix:semicolon
id|iflist
(braket
id|i
)braket
dot
id|dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
id|found_one
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|found_one
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_setup_aneg
r_static
r_int
id|au1000_setup_aneg
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|advertise
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|ctl
comma
id|adv
suffix:semicolon
multiline_comment|/* Setup standard advertise */
id|adv
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_ADVERTISE
)paren
suffix:semicolon
id|adv
op_and_assign
op_complement
(paren
id|ADVERTISE_ALL
op_or
id|ADVERTISE_100BASE4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_10HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_10baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_10FULL
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Half
)paren
id|adv
op_or_assign
id|ADVERTISE_100HALF
suffix:semicolon
r_if
c_cond
(paren
id|advertise
op_amp
id|ADVERTISED_100baseT_Full
)paren
id|adv
op_or_assign
id|ADVERTISE_100FULL
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_ADVERTISE
comma
id|adv
)paren
suffix:semicolon
multiline_comment|/* Start/Restart aneg */
id|ctl
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_or_assign
(paren
id|BMCR_ANENABLE
op_or
id|BMCR_ANRESTART
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_setup_forced
r_static
r_int
id|au1000_setup_forced
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|speed
comma
r_int
id|fd
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|ctl
suffix:semicolon
id|ctl
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_BMCR
)paren
suffix:semicolon
id|ctl
op_and_assign
op_complement
(paren
id|BMCR_FULLDPLX
op_or
id|BMCR_SPEED100
op_or
id|BMCR_ANENABLE
)paren
suffix:semicolon
multiline_comment|/* First reset the PHY */
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_BMCR
comma
id|ctl
op_or
id|BMCR_RESET
)paren
suffix:semicolon
multiline_comment|/* Select speed &amp; duplex */
r_switch
c_cond
(paren
id|speed
)paren
(brace
r_case
id|SPEED_10
suffix:colon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
id|ctl
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_1000
suffix:colon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fd
op_eq
id|DUPLEX_FULL
)paren
id|ctl
op_or_assign
id|BMCR_FULLDPLX
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_BMCR
comma
id|ctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|au1000_start_link
id|au1000_start_link
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u32
id|advertise
suffix:semicolon
r_int
id|autoneg
suffix:semicolon
r_int
id|forced_speed
suffix:semicolon
r_int
id|forced_duplex
suffix:semicolon
multiline_comment|/* Default advertise */
id|advertise
op_assign
id|GENMII_DEFAULT_ADVERTISE
suffix:semicolon
id|autoneg
op_assign
id|aup-&gt;want_autoneg
suffix:semicolon
id|forced_speed
op_assign
id|SPEED_100
suffix:semicolon
id|forced_duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
multiline_comment|/* Setup link parameters */
r_if
c_cond
(paren
id|cmd
)paren
(brace
r_if
c_cond
(paren
id|cmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
)paren
(brace
id|advertise
op_assign
id|cmd-&gt;advertising
suffix:semicolon
id|autoneg
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|autoneg
op_assign
l_int|0
suffix:semicolon
id|forced_speed
op_assign
id|cmd-&gt;speed
suffix:semicolon
id|forced_duplex
op_assign
id|cmd-&gt;duplex
suffix:semicolon
)brace
)brace
multiline_comment|/* Configure PHY &amp; start aneg */
id|aup-&gt;want_autoneg
op_assign
id|autoneg
suffix:semicolon
r_if
c_cond
(paren
id|autoneg
)paren
id|au1000_setup_aneg
c_func
(paren
id|dev
comma
id|advertise
)paren
suffix:semicolon
r_else
id|au1000_setup_forced
c_func
(paren
id|dev
comma
id|forced_speed
comma
id|forced_duplex
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|aup-&gt;timer
comma
id|jiffies
op_plus
id|HZ
)paren
suffix:semicolon
)brace
DECL|function|au1000_get_settings
r_static
r_int
id|au1000_get_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|link
comma
id|speed
suffix:semicolon
id|cmd-&gt;supported
op_assign
id|GENMII_DEFAULT_FEATURES
suffix:semicolon
id|cmd-&gt;advertising
op_assign
id|GENMII_DEFAULT_ADVERTISE
suffix:semicolon
id|cmd-&gt;port
op_assign
id|PORT_MII
suffix:semicolon
id|cmd-&gt;transceiver
op_assign
id|XCVR_EXTERNAL
suffix:semicolon
id|cmd-&gt;phy_address
op_assign
id|aup-&gt;phy_addr
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
id|cmd-&gt;autoneg
op_assign
id|aup-&gt;want_autoneg
suffix:semicolon
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_status
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
op_amp
id|link
comma
op_amp
id|speed
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|speed
op_eq
id|IF_PORT_100BASETX
)paren
op_logical_or
(paren
id|speed
op_eq
id|IF_PORT_100BASEFX
)paren
)paren
id|cmd-&gt;speed
op_assign
id|SPEED_100
suffix:semicolon
r_else
r_if
c_cond
(paren
id|speed
op_eq
id|IF_PORT_10BASET
)paren
id|cmd-&gt;speed
op_assign
id|SPEED_10
suffix:semicolon
r_if
c_cond
(paren
id|link
op_logical_and
(paren
id|dev-&gt;if_port
op_eq
id|IF_PORT_100BASEFX
)paren
)paren
id|cmd-&gt;duplex
op_assign
id|DUPLEX_FULL
suffix:semicolon
r_else
id|cmd-&gt;duplex
op_assign
id|DUPLEX_HALF
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_set_settings
r_static
r_int
id|au1000_set_settings
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_cmd
op_star
id|cmd
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|features
op_assign
id|GENMII_DEFAULT_FEATURES
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;autoneg
op_ne
id|AUTONEG_ENABLE
op_logical_and
id|cmd-&gt;autoneg
op_ne
id|AUTONEG_DISABLE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;autoneg
op_eq
id|AUTONEG_ENABLE
op_logical_and
id|cmd-&gt;advertising
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;duplex
op_ne
id|DUPLEX_HALF
op_logical_and
id|cmd-&gt;duplex
op_ne
id|DUPLEX_FULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;autoneg
op_eq
id|AUTONEG_DISABLE
)paren
r_switch
c_cond
(paren
id|cmd-&gt;speed
)paren
(brace
r_case
id|SPEED_10
suffix:colon
r_if
c_cond
(paren
id|cmd-&gt;duplex
op_eq
id|DUPLEX_HALF
op_logical_and
(paren
id|features
op_amp
id|SUPPORTED_10baseT_Half
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;duplex
op_eq
id|DUPLEX_FULL
op_logical_and
(paren
id|features
op_amp
id|SUPPORTED_10baseT_Full
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SPEED_100
suffix:colon
r_if
c_cond
(paren
id|cmd-&gt;duplex
op_eq
id|DUPLEX_HALF
op_logical_and
(paren
id|features
op_amp
id|SUPPORTED_100baseT_Half
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;duplex
op_eq
id|DUPLEX_FULL
op_logical_and
(paren
id|features
op_amp
id|SUPPORTED_100baseT_Full
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|features
op_amp
id|SUPPORTED_Autoneg
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
id|au1000_start_link
c_func
(paren
id|dev
comma
id|cmd
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_nway_reset
r_static
r_int
id|au1000_nway_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aup-&gt;want_autoneg
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
id|au1000_start_link
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|au1000_get_drvinfo
id|au1000_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;driver
comma
id|DRV_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;version
comma
id|DRV_VERSION
)paren
suffix:semicolon
id|info-&gt;fw_version
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|sprintf
c_func
(paren
id|info-&gt;bus_info
comma
l_string|&quot;%s %d&quot;
comma
id|DRV_NAME
comma
id|aup-&gt;mac_id
)paren
suffix:semicolon
id|info-&gt;regdump_len
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_get_link
r_static
id|u32
id|au1000_get_link
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_return
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|au1000_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|au1000_ethtool_ops
op_assign
(brace
dot
id|get_settings
op_assign
id|au1000_get_settings
comma
dot
id|set_settings
op_assign
id|au1000_set_settings
comma
dot
id|get_drvinfo
op_assign
id|au1000_get_drvinfo
comma
dot
id|nway_reset
op_assign
id|au1000_nway_reset
comma
dot
id|get_link
op_assign
id|au1000_get_link
)brace
suffix:semicolon
r_static
r_struct
id|net_device
op_star
DECL|function|au1000_probe
id|au1000_probe
c_func
(paren
id|u32
id|ioaddr
comma
r_int
id|irq
comma
r_int
id|port_num
)paren
(brace
r_static
r_int
id|version_printed
op_assign
l_int|0
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|db_dest_t
op_star
id|pDB
comma
op_star
id|pDBfree
suffix:semicolon
r_char
op_star
id|pmac
comma
op_star
id|argptr
suffix:semicolon
r_char
id|ethaddr
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|CPHYSADDR
c_func
(paren
id|ioaddr
)paren
comma
id|MAC_IOSIZE
comma
l_string|&quot;Au1x00 ENET&quot;
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s version %s %s&bslash;n&quot;
comma
id|DRV_NAME
comma
id|DRV_VERSION
comma
id|DRV_AUTHOR
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
r_struct
id|au1000_private
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;au1000 eth: alloc_etherdev failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Au1x_eth Cannot register net device err %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: Au1x Ethernet found at 0x%x, irq %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ioaddr
comma
id|irq
)paren
suffix:semicolon
id|aup
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* Allocate the data buffers */
multiline_comment|/* Snooping works fine with eth on all au1xxx */
id|aup-&gt;vaddr
op_assign
(paren
id|u32
)paren
id|dma_alloc_noncoherent
c_func
(paren
l_int|NULL
comma
id|MAX_BUF_SIZE
op_star
(paren
id|NUM_TX_BUFFS
op_plus
id|NUM_RX_BUFFS
)paren
comma
op_amp
id|aup-&gt;dma_addr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aup-&gt;vaddr
)paren
(brace
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|CPHYSADDR
c_func
(paren
id|ioaddr
)paren
comma
id|MAC_IOSIZE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* aup-&gt;mac is the base address of the MAC&squot;s registers */
id|aup-&gt;mac
op_assign
(paren
r_volatile
id|mac_reg_t
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Setup some variables for quick register address access */
r_if
c_cond
(paren
id|ioaddr
op_eq
id|iflist
(braket
l_int|0
)braket
dot
id|base_addr
)paren
(brace
multiline_comment|/* check env variables first */
r_if
c_cond
(paren
op_logical_neg
id|get_ethernet_addr
c_func
(paren
id|ethaddr
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|au1000_mac_addr
comma
id|ethaddr
comma
r_sizeof
(paren
id|au1000_mac_addr
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Check command line */
id|argptr
op_assign
id|prom_getcmdline
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pmac
op_assign
id|strstr
c_func
(paren
id|argptr
comma
l_string|&quot;ethaddr=&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: No mac address found&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* use the hard coded mac addresses */
)brace
r_else
(brace
id|str2eaddr
c_func
(paren
id|ethaddr
comma
id|pmac
op_plus
id|strlen
c_func
(paren
l_string|&quot;ethaddr=&quot;
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|au1000_mac_addr
comma
id|ethaddr
comma
r_sizeof
(paren
id|au1000_mac_addr
)paren
)paren
suffix:semicolon
)brace
)brace
id|aup-&gt;enable
op_assign
(paren
r_volatile
id|u32
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|iflist
(braket
l_int|0
)braket
dot
id|macen_addr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|au1000_mac_addr
comma
r_sizeof
(paren
id|au1000_mac_addr
)paren
)paren
suffix:semicolon
id|setup_hw_rings
c_func
(paren
id|aup
comma
id|MAC0_RX_DMA_ADDR
comma
id|MAC0_TX_DMA_ADDR
)paren
suffix:semicolon
id|aup-&gt;mac_id
op_assign
l_int|0
suffix:semicolon
id|au_macs
(braket
l_int|0
)braket
op_assign
id|aup
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ioaddr
op_eq
id|iflist
(braket
l_int|1
)braket
dot
id|base_addr
)paren
(brace
id|aup-&gt;enable
op_assign
(paren
r_volatile
id|u32
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|iflist
(braket
l_int|1
)braket
dot
id|macen_addr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|au1000_mac_addr
comma
r_sizeof
(paren
id|au1000_mac_addr
)paren
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
op_add_assign
l_int|0x10
suffix:semicolon
id|setup_hw_rings
c_func
(paren
id|aup
comma
id|MAC1_RX_DMA_ADDR
comma
id|MAC1_TX_DMA_ADDR
)paren
suffix:semicolon
id|aup-&gt;mac_id
op_assign
l_int|1
suffix:semicolon
id|au_macs
(braket
l_int|1
)braket
op_assign
id|aup
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: bad ioaddr&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* bring the device out of reset, otherwise probing the mii&n;&t; * will hang */
op_star
id|aup-&gt;enable
op_assign
id|MAC_EN_CLOCK_ENABLE
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|2
)paren
suffix:semicolon
op_star
id|aup-&gt;enable
op_assign
id|MAC_EN_RESET0
op_or
id|MAC_EN_RESET1
op_or
id|MAC_EN_RESET2
op_or
id|MAC_EN_CLOCK_ENABLE
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|aup-&gt;mii
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mii_phy
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aup-&gt;mii
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: out of memory&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
id|aup-&gt;mii-&gt;mii_control_reg
op_assign
l_int|0
suffix:semicolon
id|aup-&gt;mii-&gt;mii_data_reg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mii_probe
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
(brace
r_goto
id|err_out
suffix:semicolon
)brace
id|pDBfree
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* setup the data buffer descriptors and attach a buffer to each one */
id|pDB
op_assign
id|aup-&gt;db
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|NUM_TX_BUFFS
op_plus
id|NUM_RX_BUFFS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pDB-&gt;pnext
op_assign
id|pDBfree
suffix:semicolon
id|pDBfree
op_assign
id|pDB
suffix:semicolon
id|pDB-&gt;vaddr
op_assign
(paren
id|u32
op_star
)paren
(paren
(paren
r_int
)paren
id|aup-&gt;vaddr
op_plus
id|MAX_BUF_SIZE
op_star
id|i
)paren
suffix:semicolon
id|pDB-&gt;dma_addr
op_assign
(paren
id|dma_addr_t
)paren
id|virt_to_bus
c_func
(paren
id|pDB-&gt;vaddr
)paren
suffix:semicolon
id|pDB
op_increment
suffix:semicolon
)brace
id|aup-&gt;pDBfree
op_assign
id|pDBfree
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pDB
op_assign
id|GetFreeDB
c_func
(paren
id|aup
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pDB
)paren
(brace
r_goto
id|err_out
suffix:semicolon
)brace
id|aup-&gt;rx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|buff_stat
op_assign
(paren
r_int
)paren
id|pDB-&gt;dma_addr
suffix:semicolon
id|aup-&gt;rx_db_inuse
(braket
id|i
)braket
op_assign
id|pDB
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pDB
op_assign
id|GetFreeDB
c_func
(paren
id|aup
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pDB
)paren
(brace
r_goto
id|err_out
suffix:semicolon
)brace
id|aup-&gt;tx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|buff_stat
op_assign
(paren
r_int
)paren
id|pDB-&gt;dma_addr
suffix:semicolon
id|aup-&gt;tx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|len
op_assign
l_int|0
suffix:semicolon
id|aup-&gt;tx_db_inuse
(braket
id|i
)braket
op_assign
id|pDB
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|aup-&gt;lock
)paren
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;open
op_assign
id|au1000_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|au1000_tx
suffix:semicolon
id|dev-&gt;stop
op_assign
id|au1000_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|au1000_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
op_amp
id|set_rx_mode
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
op_amp
id|au1000_ioctl
suffix:semicolon
id|SET_ETHTOOL_OPS
c_func
(paren
id|dev
comma
op_amp
id|au1000_ethtool_ops
)paren
suffix:semicolon
id|dev-&gt;set_config
op_assign
op_amp
id|au1000_set_config
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|au1000_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|ETH_TX_TIMEOUT
suffix:semicolon
multiline_comment|/* &n;&t; * The boot code uses the ethernet controller, so reset it to start &n;&t; * fresh.  au1000_init() expects that the device is in reset state.&n;&t; */
id|reset_mac
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
id|err_out
suffix:colon
multiline_comment|/* here we should have a valid dev plus aup-&gt; register addresses&n;&t; * so we can reset the mac properly.*/
id|reset_mac
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aup-&gt;mii
)paren
id|kfree
c_func
(paren
id|aup-&gt;mii
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aup-&gt;rx_db_inuse
(braket
id|i
)braket
)paren
id|ReleaseDB
c_func
(paren
id|aup
comma
id|aup-&gt;rx_db_inuse
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aup-&gt;tx_db_inuse
(braket
id|i
)braket
)paren
id|ReleaseDB
c_func
(paren
id|aup
comma
id|aup-&gt;tx_db_inuse
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|dma_free_noncoherent
c_func
(paren
l_int|NULL
comma
id|MAX_BUF_SIZE
op_star
(paren
id|NUM_TX_BUFFS
op_plus
id|NUM_RX_BUFFS
)paren
comma
(paren
r_void
op_star
)paren
id|aup-&gt;vaddr
comma
id|aup-&gt;dma_addr
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|CPHYSADDR
c_func
(paren
id|ioaddr
)paren
comma
id|MAC_IOSIZE
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* &n; * Initialize the interface.&n; *&n; * When the device powers up, the clocks are disabled and the&n; * mac is in reset state.  When the interface is closed, we&n; * do the same -- reset the device and disable the clocks to&n; * conserve power. Thus, whenever au1000_init() is called,&n; * the device should already be in reset state.&n; */
DECL|function|au1000_init
r_static
r_int
id|au1000_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u32
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|u32
id|control
suffix:semicolon
id|u16
id|link
comma
id|speed
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: au1000_init&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* bring the device out of reset */
op_star
id|aup-&gt;enable
op_assign
id|MAC_EN_CLOCK_ENABLE
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|2
)paren
suffix:semicolon
op_star
id|aup-&gt;enable
op_assign
id|MAC_EN_RESET0
op_or
id|MAC_EN_RESET1
op_or
id|MAC_EN_RESET2
op_or
id|MAC_EN_CLOCK_ENABLE
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_assign
l_int|0
suffix:semicolon
id|aup-&gt;tx_head
op_assign
(paren
id|aup-&gt;tx_dma_ring
(braket
l_int|0
)braket
op_member_access_from_pointer
id|buff_stat
op_amp
l_int|0xC
)paren
op_rshift
l_int|2
suffix:semicolon
id|aup-&gt;tx_tail
op_assign
id|aup-&gt;tx_head
suffix:semicolon
id|aup-&gt;rx_head
op_assign
(paren
id|aup-&gt;rx_dma_ring
(braket
l_int|0
)braket
op_member_access_from_pointer
id|buff_stat
op_amp
l_int|0xC
)paren
op_rshift
l_int|2
suffix:semicolon
id|aup-&gt;mac-&gt;mac_addr_high
op_assign
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
op_lshift
l_int|8
op_or
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
suffix:semicolon
id|aup-&gt;mac-&gt;mac_addr_low
op_assign
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_lshift
l_int|24
op_or
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|16
op_or
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_lshift
l_int|8
op_or
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DMA
suffix:semicolon
id|i
op_increment
)paren
(brace
id|aup-&gt;rx_dma_ring
(braket
id|i
)braket
op_member_access_from_pointer
id|buff_stat
op_or_assign
id|RX_DMA_ENABLE
suffix:semicolon
)brace
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_status
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
op_amp
id|link
comma
op_amp
id|speed
)paren
suffix:semicolon
id|control
op_assign
id|MAC_DISABLE_RX_OWN
op_or
id|MAC_RX_ENABLE
op_or
id|MAC_TX_ENABLE
suffix:semicolon
macro_line|#ifndef CONFIG_CPU_LITTLE_ENDIAN
id|control
op_or_assign
id|MAC_BIG_ENDIAN
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|link
op_logical_and
(paren
id|dev-&gt;if_port
op_eq
id|IF_PORT_100BASEFX
)paren
)paren
(brace
id|control
op_or_assign
id|MAC_FULL_DUPLEX
suffix:semicolon
)brace
multiline_comment|/* fix for startup without cable */
r_if
c_cond
(paren
op_logical_neg
id|link
)paren
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_assign
id|control
suffix:semicolon
id|aup-&gt;mac-&gt;vlan1_tag
op_assign
l_int|0x8100
suffix:semicolon
multiline_comment|/* activate vlan support */
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_timer
r_static
r_void
id|au1000_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|data
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
r_char
id|if_port
suffix:semicolon
id|u16
id|link
comma
id|speed
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
multiline_comment|/* fatal error, don&squot;t restart the timer */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;au1000_timer error: NULL dev&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|if_port
op_assign
id|dev-&gt;if_port
suffix:semicolon
r_if
c_cond
(paren
id|aup-&gt;phy_ops
op_member_access_from_pointer
id|phy_status
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
op_amp
id|link
comma
op_amp
id|speed
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|link
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_RUNNING
)paren
)paren
(brace
id|netif_carrier_on
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|IFF_RUNNING
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link up&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_RUNNING
)paren
(brace
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_RUNNING
suffix:semicolon
id|dev-&gt;if_port
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: link down&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|link
op_logical_and
(paren
id|dev-&gt;if_port
op_ne
id|if_port
)paren
op_logical_and
(paren
id|dev-&gt;if_port
op_ne
id|IF_PORT_UNKNOWN
)paren
)paren
(brace
id|hard_stop
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|IF_PORT_100BASEFX
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: going to full duplex&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_or_assign
id|MAC_FULL_DUPLEX
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|aup-&gt;mac-&gt;control
op_and_assign
op_complement
id|MAC_FULL_DUPLEX
suffix:semicolon
id|au_sync_delay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|enable_rx_tx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|aup-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
l_int|1
op_star
id|HZ
)paren
)paren
suffix:semicolon
id|aup-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|aup-&gt;timer.function
op_assign
op_amp
id|au1000_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|aup-&gt;timer
)paren
suffix:semicolon
)brace
DECL|function|au1000_open
r_static
r_int
id|au1000_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|retval
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: open: dev=%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|au1000_init
c_func
(paren
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: error in au1000_init&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|au1000_interrupt
comma
l_int|0
comma
id|dev-&gt;name
comma
id|dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to get IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;irq
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|aup-&gt;timer
)paren
suffix:semicolon
multiline_comment|/* used in ioctl() */
id|aup-&gt;timer.expires
op_assign
id|RUN_AT
c_func
(paren
(paren
l_int|3
op_star
id|HZ
)paren
)paren
suffix:semicolon
id|aup-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dev
suffix:semicolon
id|aup-&gt;timer.function
op_assign
op_amp
id|au1000_timer
suffix:semicolon
multiline_comment|/* timer handler */
id|add_timer
c_func
(paren
op_amp
id|aup-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: open: Initialization done.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_close
r_static
r_int
id|au1000_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|u32
id|flags
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: close: dev=%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
id|reset_mac
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* stop the device */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* disable the interrupt */
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|aup-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_cleanup_module
r_static
r_void
id|__exit
id|au1000_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|au1000_private
op_star
id|aup
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_ifs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev
op_assign
id|iflist
(braket
id|i
)braket
dot
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|aup-&gt;mii
)paren
id|kfree
c_func
(paren
id|aup-&gt;mii
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NUM_RX_DMA
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aup-&gt;rx_db_inuse
(braket
id|j
)braket
)paren
id|ReleaseDB
c_func
(paren
id|aup
comma
id|aup-&gt;rx_db_inuse
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|NUM_TX_DMA
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|aup-&gt;tx_db_inuse
(braket
id|j
)braket
)paren
id|ReleaseDB
c_func
(paren
id|aup
comma
id|aup-&gt;tx_db_inuse
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|dma_free_noncoherent
c_func
(paren
l_int|NULL
comma
id|MAX_BUF_SIZE
op_star
(paren
id|NUM_TX_BUFFS
op_plus
id|NUM_RX_BUFFS
)paren
comma
(paren
r_void
op_star
)paren
id|aup-&gt;vaddr
comma
id|aup-&gt;dma_addr
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|CPHYSADDR
c_func
(paren
id|iflist
(braket
id|i
)braket
dot
id|base_addr
)paren
comma
id|MAC_IOSIZE
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_inline
r_void
DECL|function|update_tx_stats
id|update_tx_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|status
comma
id|u32
id|pkt_len
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|ps
op_assign
op_amp
id|aup-&gt;stats
suffix:semicolon
id|ps-&gt;tx_packets
op_increment
suffix:semicolon
id|ps-&gt;tx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|TX_FRAME_ABORTED
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;if_port
op_eq
id|IF_PORT_100BASEFX
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TX_JAB_TIMEOUT
op_or
id|TX_UNDERRUN
)paren
)paren
(brace
multiline_comment|/* any other tx errors are only valid&n;&t;&t;&t;&t; * in half duplex mode */
id|ps-&gt;tx_errors
op_increment
suffix:semicolon
id|ps-&gt;tx_aborted_errors
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|ps-&gt;tx_errors
op_increment
suffix:semicolon
id|ps-&gt;tx_aborted_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TX_NO_CARRIER
op_or
id|TX_LOSS_CARRIER
)paren
)paren
id|ps-&gt;tx_carrier_errors
op_increment
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Called from the interrupt service routine to acknowledge&n; * the TX DONE bits.  This is a must if the irq is setup as&n; * edge triggered.&n; */
DECL|function|au1000_tx_ack
r_static
r_void
id|au1000_tx_ack
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
id|tx_dma_t
op_star
id|ptxd
suffix:semicolon
id|ptxd
op_assign
id|aup-&gt;tx_dma_ring
(braket
id|aup-&gt;tx_tail
)braket
suffix:semicolon
r_while
c_loop
(paren
id|ptxd-&gt;buff_stat
op_amp
id|TX_T_DONE
)paren
(brace
id|update_tx_stats
c_func
(paren
id|dev
comma
id|ptxd-&gt;status
comma
id|ptxd-&gt;len
op_amp
l_int|0x3ff
)paren
suffix:semicolon
id|ptxd-&gt;buff_stat
op_and_assign
op_complement
id|TX_T_DONE
suffix:semicolon
id|ptxd-&gt;len
op_assign
l_int|0
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|aup-&gt;tx_tail
op_assign
(paren
id|aup-&gt;tx_tail
op_plus
l_int|1
)paren
op_amp
(paren
id|NUM_TX_DMA
op_minus
l_int|1
)paren
suffix:semicolon
id|ptxd
op_assign
id|aup-&gt;tx_dma_ring
(braket
id|aup-&gt;tx_tail
)braket
suffix:semicolon
r_if
c_cond
(paren
id|aup-&gt;tx_full
)paren
(brace
id|aup-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Au1000 transmit routine.&n; */
DECL|function|au1000_tx
r_static
r_int
id|au1000_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_volatile
id|tx_dma_t
op_star
id|ptxd
suffix:semicolon
id|u32
id|buff_stat
suffix:semicolon
id|db_dest_t
op_star
id|pDB
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s: tx: aup %x len=%d, data=%p, head %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
r_int
)paren
id|aup
comma
id|skb-&gt;len
comma
id|skb-&gt;data
comma
id|aup-&gt;tx_head
)paren
suffix:semicolon
id|ptxd
op_assign
id|aup-&gt;tx_dma_ring
(braket
id|aup-&gt;tx_head
)braket
suffix:semicolon
id|buff_stat
op_assign
id|ptxd-&gt;buff_stat
suffix:semicolon
r_if
c_cond
(paren
id|buff_stat
op_amp
id|TX_DMA_ENABLE
)paren
(brace
multiline_comment|/* We&squot;ve wrapped around and the transmitter is still busy */
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|aup-&gt;tx_full
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|buff_stat
op_amp
id|TX_T_DONE
)paren
(brace
id|update_tx_stats
c_func
(paren
id|dev
comma
id|ptxd-&gt;status
comma
id|ptxd-&gt;len
op_amp
l_int|0x3ff
)paren
suffix:semicolon
id|ptxd-&gt;len
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|aup-&gt;tx_full
)paren
(brace
id|aup-&gt;tx_full
op_assign
l_int|0
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|pDB
op_assign
id|aup-&gt;tx_db_inuse
(braket
id|aup-&gt;tx_head
)braket
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|pDB-&gt;vaddr
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
id|ETH_ZLEN
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|skb-&gt;len
suffix:semicolon
id|i
OL
id|ETH_ZLEN
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
r_char
op_star
)paren
id|pDB-&gt;vaddr
)paren
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|ptxd-&gt;len
op_assign
id|ETH_ZLEN
suffix:semicolon
)brace
r_else
id|ptxd-&gt;len
op_assign
id|skb-&gt;len
suffix:semicolon
id|ptxd-&gt;buff_stat
op_assign
id|pDB-&gt;dma_addr
op_or
id|TX_DMA_ENABLE
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|aup-&gt;tx_head
op_assign
(paren
id|aup-&gt;tx_head
op_plus
l_int|1
)paren
op_amp
(paren
id|NUM_TX_DMA
op_minus
l_int|1
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|update_rx_stats
r_static
r_inline
r_void
id|update_rx_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|status
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|net_device_stats
op_star
id|ps
op_assign
op_amp
id|aup-&gt;stats
suffix:semicolon
id|ps-&gt;rx_packets
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_MCAST_FRAME
)paren
id|ps-&gt;multicast
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_ERROR
)paren
(brace
id|ps-&gt;rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_MISSED_FRAME
)paren
id|ps-&gt;rx_missed_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RX_OVERLEN
op_or
id|RX_OVERLEN
op_or
id|RX_LEN_ERROR
)paren
)paren
id|ps-&gt;rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_CRC_ERROR
)paren
id|ps-&gt;rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_COLL
)paren
id|ps-&gt;collisions
op_increment
suffix:semicolon
)brace
r_else
id|ps-&gt;rx_bytes
op_add_assign
id|status
op_amp
id|RX_FRAME_LEN_MASK
suffix:semicolon
)brace
multiline_comment|/*&n; * Au1000 receive routine.&n; */
DECL|function|au1000_rx
r_static
r_int
id|au1000_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_volatile
id|rx_dma_t
op_star
id|prxd
suffix:semicolon
id|u32
id|buff_stat
comma
id|status
suffix:semicolon
id|db_dest_t
op_star
id|pDB
suffix:semicolon
id|u32
id|frmlen
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|5
)paren
id|printk
c_func
(paren
l_string|&quot;%s: au1000_rx head %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|aup-&gt;rx_head
)paren
suffix:semicolon
id|prxd
op_assign
id|aup-&gt;rx_dma_ring
(braket
id|aup-&gt;rx_head
)braket
suffix:semicolon
id|buff_stat
op_assign
id|prxd-&gt;buff_stat
suffix:semicolon
r_while
c_loop
(paren
id|buff_stat
op_amp
id|RX_T_DONE
)paren
(brace
id|status
op_assign
id|prxd-&gt;status
suffix:semicolon
id|pDB
op_assign
id|aup-&gt;rx_db_inuse
(braket
id|aup-&gt;rx_head
)braket
suffix:semicolon
id|update_rx_stats
c_func
(paren
id|dev
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|RX_ERROR
)paren
)paren
(brace
multiline_comment|/* good frame */
id|frmlen
op_assign
(paren
id|status
op_amp
id|RX_FRAME_LEN_MASK
)paren
suffix:semicolon
id|frmlen
op_sub_assign
l_int|4
suffix:semicolon
multiline_comment|/* Remove FCS */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|frmlen
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|aup-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 byte IP header align */
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
(paren
r_int
r_char
op_star
)paren
id|pDB-&gt;vaddr
comma
id|frmlen
comma
l_int|0
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|frmlen
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* pass the packet to upper layers */
)brace
r_else
(brace
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|RX_MISSED_FRAME
)paren
id|printk
c_func
(paren
l_string|&quot;rx miss&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_WDOG_TIMER
)paren
id|printk
c_func
(paren
l_string|&quot;rx wdog&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_RUNT
)paren
id|printk
c_func
(paren
l_string|&quot;rx runt&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_OVERLEN
)paren
id|printk
c_func
(paren
l_string|&quot;rx overlen&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_COLL
)paren
id|printk
c_func
(paren
l_string|&quot;rx coll&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_MII_ERROR
)paren
id|printk
c_func
(paren
l_string|&quot;rx mii error&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_CRC_ERROR
)paren
id|printk
c_func
(paren
l_string|&quot;rx crc error&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_LEN_ERROR
)paren
id|printk
c_func
(paren
l_string|&quot;rx len error&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_U_CNTRL_FRAME
)paren
id|printk
c_func
(paren
l_string|&quot;rx u control frame&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RX_MISSED_FRAME
)paren
id|printk
c_func
(paren
l_string|&quot;rx miss&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|prxd-&gt;buff_stat
op_assign
(paren
id|u32
)paren
(paren
id|pDB-&gt;dma_addr
op_or
id|RX_DMA_ENABLE
)paren
suffix:semicolon
id|aup-&gt;rx_head
op_assign
(paren
id|aup-&gt;rx_head
op_plus
l_int|1
)paren
op_amp
(paren
id|NUM_RX_DMA
op_minus
l_int|1
)paren
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* next descriptor */
id|prxd
op_assign
id|aup-&gt;rx_dma_ring
(braket
id|aup-&gt;rx_head
)braket
suffix:semicolon
id|buff_stat
op_assign
id|prxd-&gt;buff_stat
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Au1000 interrupt service routine.&n; */
DECL|function|au1000_interrupt
r_static
id|irqreturn_t
id|au1000_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: isr: null dev ptr&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Handle RX interrupts first to minimize chance of overrun */
id|au1000_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
id|au1000_tx_ack
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The Tx ring has been full longer than the watchdog timeout&n; * value. The transmitter must be hung?&n; */
DECL|function|au1000_tx_timeout
r_static
r_void
id|au1000_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: au1000_tx_timeout: dev=%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
id|reset_mac
c_func
(paren
id|dev
)paren
suffix:semicolon
id|au1000_init
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|ethernet_polynomial
r_static
r_int
r_const
id|ethernet_polynomial
op_assign
l_int|0x04c11db7U
suffix:semicolon
DECL|function|ether_crc
r_static
r_inline
id|u32
id|ether_crc
c_func
(paren
r_int
id|length
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|crc
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|length
op_ge
l_int|0
)paren
(brace
r_int
r_char
id|current_octet
op_assign
op_star
id|data
op_increment
suffix:semicolon
r_int
id|bit
suffix:semicolon
r_for
c_loop
(paren
id|bit
op_assign
l_int|0
suffix:semicolon
id|bit
OL
l_int|8
suffix:semicolon
id|bit
op_increment
comma
id|current_octet
op_rshift_assign
l_int|1
)paren
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
OL
l_int|0
)paren
op_xor
(paren
id|current_octet
op_amp
l_int|1
)paren
ques
c_cond
id|ethernet_polynomial
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|set_rx_mode
r_static
r_void
id|set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: set_rx_mode: flags=%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Set promiscuous. */
id|aup-&gt;mac-&gt;control
op_or_assign
id|MAC_PROMISCUOUS
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
id|dev-&gt;mc_count
OG
id|MULTICAST_FILTER_LIMIT
)paren
(brace
id|aup-&gt;mac-&gt;control
op_or_assign
id|MAC_PASS_ALL_MULTI
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_and_assign
op_complement
id|MAC_PROMISCUOUS
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Pass all multicast&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
id|set_bit
c_func
(paren
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
comma
(paren
r_int
op_star
)paren
id|mc_filter
)paren
suffix:semicolon
)brace
id|aup-&gt;mac-&gt;multi_hash_high
op_assign
id|mc_filter
(braket
l_int|1
)braket
suffix:semicolon
id|aup-&gt;mac-&gt;multi_hash_low
op_assign
id|mc_filter
(braket
l_int|0
)braket
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_and_assign
op_complement
id|MAC_PROMISCUOUS
suffix:semicolon
id|aup-&gt;mac-&gt;control
op_or_assign
id|MAC_HASH_MODE
suffix:semicolon
)brace
)brace
DECL|function|au1000_ioctl
r_static
r_int
id|au1000_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
op_star
id|data
op_assign
(paren
id|u16
op_star
)paren
op_amp
id|rq-&gt;ifr_ifru
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCDEVPRIVATE
suffix:colon
multiline_comment|/* Get the address of the PHY in use. */
r_case
id|SIOCGMIIPHY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|data
(braket
l_int|0
)braket
op_assign
id|aup-&gt;phy_addr
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|1
suffix:colon
multiline_comment|/* Read the specified MII register. */
r_case
id|SIOCGMIIREG
suffix:colon
id|data
(braket
l_int|3
)braket
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SIOCDEVPRIVATE
op_plus
l_int|2
suffix:colon
multiline_comment|/* Write the specified MII register */
r_case
id|SIOCSMIIREG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
DECL|function|au1000_set_config
r_static
r_int
id|au1000_set_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifmap
op_star
id|map
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|u16
id|control
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: set_config called: dev-&gt;if_port %d map-&gt;port %x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;if_port
comma
id|map-&gt;port
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|map-&gt;port
)paren
(brace
r_case
id|IF_PORT_UNKNOWN
suffix:colon
multiline_comment|/* use auto here */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: config phy for aneg&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* Link Down: the timer will bring it up */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* read current control */
id|control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|control
op_and_assign
op_complement
(paren
id|MII_CNTL_FDX
op_or
id|MII_CNTL_F100
)paren
suffix:semicolon
multiline_comment|/* enable auto negotiation and reset the negotiation */
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|control
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_RST_AUTO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASET
suffix:colon
multiline_comment|/* 10BaseT */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: config phy for 10BaseT&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* Link Down: the timer will bring it up */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set Speed to 10Mbps, Half Duplex */
id|control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|control
op_and_assign
op_complement
(paren
id|MII_CNTL_F100
op_or
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_FDX
)paren
suffix:semicolon
multiline_comment|/* disable auto negotiation and force 10M/HD mode*/
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|control
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_100BASET
suffix:colon
multiline_comment|/* 100BaseT */
r_case
id|IF_PORT_100BASETX
suffix:colon
multiline_comment|/* 100BaseTx */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: config phy for 100BaseTX&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* Link Down: the timer will bring it up */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set Speed to 100Mbps, Half Duplex */
multiline_comment|/* disable auto negotiation and enable 100MBit Mode */
id|control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|control
op_and_assign
op_complement
(paren
id|MII_CNTL_AUTO
op_or
id|MII_CNTL_FDX
)paren
suffix:semicolon
id|control
op_or_assign
id|MII_CNTL_F100
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|control
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_100BASEFX
suffix:colon
multiline_comment|/* 100BaseFx */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: config phy for 100BaseFX&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;if_port
op_assign
id|map-&gt;port
suffix:semicolon
multiline_comment|/* Link Down: the timer will bring it up */
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* set Speed to 100Mbps, Full Duplex */
multiline_comment|/* disable auto negotiation and enable 100MBit Mode */
id|control
op_assign
id|mdio_read
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|control
op_and_assign
op_complement
id|MII_CNTL_AUTO
suffix:semicolon
id|control
op_or_assign
id|MII_CNTL_F100
op_or
id|MII_CNTL_FDX
suffix:semicolon
id|mdio_write
c_func
(paren
id|dev
comma
id|aup-&gt;phy_addr
comma
id|MII_CONTROL
comma
id|control
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IF_PORT_10BASE2
suffix:colon
multiline_comment|/* 10Base2 */
r_case
id|IF_PORT_AUI
suffix:colon
multiline_comment|/* AUI */
multiline_comment|/* These Modes are not supported (are they?)*/
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: 10Base2/AUI not supported&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: Invalid media selected&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|au1000_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|au1000_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|au1000_private
op_star
id|aup
op_assign
(paren
r_struct
id|au1000_private
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|au1000_debug
OG
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;%s: au1000_get_stats: dev=%p&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|netif_device_present
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
op_amp
id|aup-&gt;stats
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|au1000_init_module
id|module_init
c_func
(paren
id|au1000_init_module
)paren
suffix:semicolon
DECL|variable|au1000_cleanup_module
id|module_exit
c_func
(paren
id|au1000_cleanup_module
)paren
suffix:semicolon
eof
