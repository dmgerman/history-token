multiline_comment|/* ne.c: A general non-shared-memory NS8390 ethernet driver for linux. */
multiline_comment|/*&n;    Written 1992-94 by Donald Becker.&n;&n;    Copyright 1993 United States Government as represented by the&n;    Director, National Security Agency.&n;&n;    This software may be used and distributed according to the terms&n;    of the GNU General Public License, incorporated herein by reference.&n;&n;    The author may be reached as becker@scyld.com, or C/O&n;    Scyld Computing Corporation, 410 Severn Ave., Suite 210, Annapolis MD 21403&n;&n;    This driver should work with many programmed-I/O 8390-based ethernet&n;    boards.  Currently it supports the NE1000, NE2000, many clones,&n;    and some Cabletron products.&n;&n;    Changelog:&n;&n;    Paul Gortmaker&t;: use ENISR_RDC to monitor Tx PIO uploads, made&n;&t;&t;&t;  sanity checks and bad clone support optional.&n;    Paul Gortmaker&t;: new reset code, reset card after probe at boot.&n;    Paul Gortmaker&t;: multiple card support for module users.&n;    Paul Gortmaker&t;: Support for PCI ne2k clones, similar to lance.c&n;    Paul Gortmaker&t;: Allow users with bad cards to avoid full probe.&n;    Paul Gortmaker&t;: PCI probe changes, more PCI cards supported.&n;    rjohnson@analogic.com : Changed init order so an interrupt will only&n;    occur after memory is allocated for dev-&gt;priv. Deallocated memory&n;    last in cleanup_modue()&n;    Richard Guenther    : Added support for ISAPnP cards&n;    Paul Gortmaker&t;: Discontinued PCI support - use ne2k-pci.c instead.&n;    Osamu Tomita&t;: Separate driver for NEC PC-9800.&n;&n;*/
multiline_comment|/* Routines for the NatSemi-based designs (NE[12]000). */
DECL|variable|version1
r_static
r_const
r_char
id|version1
(braket
)braket
op_assign
l_string|&quot;ne.c:v1.10 9/23/94 Donald Becker (becker@scyld.com)&bslash;n&quot;
suffix:semicolon
DECL|variable|version2
r_static
r_const
r_char
id|version2
(braket
)braket
op_assign
l_string|&quot;Last modified Nov 1, 2000 by Paul Gortmaker&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;8390.h&quot;
multiline_comment|/* Some defines that people can play with if so inclined. */
multiline_comment|/* Do we support clones that don&squot;t adhere to 14,15 of the SAprom ? */
DECL|macro|SUPPORT_NE_BAD_CLONES
mdefine_line|#define SUPPORT_NE_BAD_CLONES
multiline_comment|/* Do we perform extra sanity checks on stuff ? */
multiline_comment|/* #define NE_SANITY_CHECK */
multiline_comment|/* Do we implement the read before write bugfix ? */
multiline_comment|/* #define NE_RW_BUGFIX */
multiline_comment|/* Do we have a non std. amount of memory? (in units of 256 byte pages) */
multiline_comment|/* #define PACKETBUF_MEMSIZE&t;0x40 */
macro_line|#ifdef SUPPORT_NE_BAD_CLONES
multiline_comment|/* A list of bad clones that we none-the-less recognize. */
DECL|member|name8
DECL|member|name16
DECL|member|SAprefix
r_static
r_struct
(brace
r_const
r_char
op_star
id|name8
comma
op_star
id|name16
suffix:semicolon
r_int
r_char
id|SAprefix
(braket
l_int|4
)braket
suffix:semicolon
)brace
DECL|variable|__initdata
id|bad_clone_list
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_string|&quot;LA/T-98?&quot;
comma
l_string|&quot;LA/T-98&quot;
comma
(brace
l_int|0x00
comma
l_int|0xa0
comma
l_int|0xb0
)brace
)brace
comma
multiline_comment|/* I/O Data */
(brace
l_string|&quot;EGY-98?&quot;
comma
l_string|&quot;EGY-98&quot;
comma
(brace
l_int|0x00
comma
l_int|0x40
comma
l_int|0x26
)brace
)brace
comma
multiline_comment|/* Melco EGY98 */
(brace
l_string|&quot;ICM?&quot;
comma
l_string|&quot;ICM-27xx-ET&quot;
comma
(brace
l_int|0x00
comma
l_int|0x80
comma
l_int|0xc8
)brace
)brace
comma
multiline_comment|/* ICM IF-27xx-ET */
(brace
l_string|&quot;CNET-98/EL?&quot;
comma
l_string|&quot;CNET(98)E/L&quot;
comma
(brace
l_int|0x00
comma
l_int|0x80
comma
l_int|0x4C
)brace
)brace
comma
multiline_comment|/* Contec CNET-98/EL */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/* ---- No user-serviceable parts below ---- */
DECL|macro|NE_BASE
mdefine_line|#define NE_BASE&t; (dev-&gt;base_addr)
DECL|macro|NE_CMD
mdefine_line|#define NE_CMD&t; &t;EI_SHIFT(0x00)
DECL|macro|NE_DATAPORT
mdefine_line|#define NE_DATAPORT&t;EI_SHIFT(0x10)&t;/* NatSemi-defined port window offset. */
DECL|macro|NE_RESET
mdefine_line|#define NE_RESET&t;EI_SHIFT(0x1f) /* Issue a read to reset, a write to clear. */
DECL|macro|NE_IO_EXTENT
mdefine_line|#define NE_IO_EXTENT&t;0x20
DECL|macro|NE1SM_START_PG
mdefine_line|#define NE1SM_START_PG&t;0x20&t;/* First page of TX buffer */
DECL|macro|NE1SM_STOP_PG
mdefine_line|#define NE1SM_STOP_PG &t;0x40&t;/* Last page +1 of RX ring */
DECL|macro|NESM_START_PG
mdefine_line|#define NESM_START_PG&t;0x40&t;/* First page of TX buffer */
DECL|macro|NESM_STOP_PG
mdefine_line|#define NESM_STOP_PG&t;0x80&t;/* Last page +1 of RX ring */
macro_line|#include &quot;ne2k_cbus.h&quot;
r_int
id|ne_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ne_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
suffix:semicolon
r_static
r_int
id|ne_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|ne_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ne_reset_8390
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|ne_get_8390_hdr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|e8390_pkt_hdr
op_star
id|hdr
comma
r_int
id|ring_page
)paren
suffix:semicolon
r_static
r_void
id|ne_block_input
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|count
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|ring_offset
)paren
suffix:semicolon
r_static
r_void
id|ne_block_output
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_const
r_int
id|count
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_const
r_int
id|start_page
)paren
suffix:semicolon
"&f;"
multiline_comment|/*  Probe for various non-shared-memory ethercards.&n;&n;   NEx000-clone boards have a Station Address PROM (SAPROM) in the packet&n;   buffer memory space.  NE2000 clones have 0x57,0x57 in bytes 0x0e,0x0f of&n;   the SAPROM, while other supposed NE2000 clones must be detected by their&n;   SA prefix.&n;&n;   Reading the SAPROM from a word-wide card with the 8390 set in byte-wide&n;   mode results in doubled values, which can be detected and compensated for.&n;&n;   The probe is also responsible for initializing the card and filling&n;   in the &squot;dev&squot; and &squot;ei_status&squot; structures.&n;&n;   We use the minimum memory size for some ethercard product lines, iff we can&squot;t&n;   distinguish models.  You can increase the packet buffer size by setting&n;   PACKETBUF_MEMSIZE.  Reported Cabletron packet buffer locations are:&n;&t;E1010   starts at 0x100 and ends at 0x2000.&n;&t;E1010-x starts at 0x100 and ends at 0x8000. (&quot;-x&quot; means &quot;more memory&quot;)&n;&t;E2010&t; starts at 0x100 and ends at 0x4000.&n;&t;E2010-x starts at 0x100 and ends at 0xffff.  */
DECL|function|ne_probe
r_int
id|__init
id|ne_probe
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|base_addr
op_assign
id|dev-&gt;base_addr
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe(): entered.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* If CONFIG_NET_CBUS,&n;&t;   we need dev-&gt;priv-&gt;reg_offset BEFORE to probe */
r_if
c_cond
(paren
id|ne2k_cbus_init
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* First check any supplied i/o locations. User knows best. &lt;cough&gt; */
r_if
c_cond
(paren
id|base_addr
OG
l_int|0
)paren
(brace
r_int
id|result
suffix:semicolon
r_const
r_struct
id|ne2k_cbus_hwinfo
op_star
id|hw
op_assign
id|ne2k_cbus_get_hwinfo
c_func
(paren
(paren
r_int
)paren
(paren
id|dev-&gt;mem_start
op_amp
id|NE2K_CBUS_HARDWARE_TYPE_MASK
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe(): call ne_probe_cbus(base_addr=0x%x)&bslash;n&quot;
comma
id|base_addr
)paren
suffix:semicolon
id|result
op_assign
id|ne_probe_cbus
c_func
(paren
id|dev
comma
id|hw
comma
id|base_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
l_int|0
)paren
id|ne2k_cbus_destroy
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe(): base_addr is not specified.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifndef MODULE
multiline_comment|/* Last resort. The semi-risky C-Bus auto-probe. */
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe(): auto-probe start.&bslash;n&quot;
)paren
suffix:semicolon
(brace
r_const
r_struct
id|ne2k_cbus_hwinfo
op_star
id|hw
op_assign
id|ne2k_cbus_get_hwinfo
c_func
(paren
(paren
r_int
)paren
(paren
id|dev-&gt;mem_start
op_amp
id|NE2K_CBUS_HARDWARE_TYPE_MASK
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw
op_logical_and
id|hw-&gt;hwtype
)paren
(brace
r_const
r_int
r_int
op_star
id|plist
suffix:semicolon
r_for
c_loop
(paren
id|plist
op_assign
id|hw-&gt;portlist
suffix:semicolon
op_star
id|plist
suffix:semicolon
id|plist
op_increment
)paren
r_if
c_cond
(paren
id|ne_probe_cbus
c_func
(paren
id|dev
comma
id|hw
comma
op_star
id|plist
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|hw
op_assign
op_amp
id|ne2k_cbus_hwinfo_list
(braket
l_int|0
)braket
suffix:semicolon
id|hw-&gt;hwtype
suffix:semicolon
id|hw
op_increment
)paren
(brace
r_const
r_int
r_int
op_star
id|plist
suffix:semicolon
r_for
c_loop
(paren
id|plist
op_assign
id|hw-&gt;portlist
suffix:semicolon
op_star
id|plist
suffix:semicolon
id|plist
op_increment
)paren
r_if
c_cond
(paren
id|ne_probe_cbus
c_func
(paren
id|dev
comma
id|hw
comma
op_star
id|plist
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|ne2k_cbus_destroy
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|ne_probe_cbus
r_static
r_int
id|__init
id|ne_probe_cbus
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_const
r_struct
id|ne2k_cbus_hwinfo
op_star
id|hw
comma
r_int
id|ioaddr
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe_cbus(): entered. (called from %p)&bslash;n&quot;
comma
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw
op_logical_and
id|hw-&gt;hwtype
)paren
(brace
id|ne2k_cbus_set_hwtype
c_func
(paren
id|dev
comma
id|hw
comma
id|ioaddr
)paren
suffix:semicolon
r_return
id|ne_probe1
c_func
(paren
id|dev
comma
id|ioaddr
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* auto detect */
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ne_probe_cbus(): try to determine hardware types.&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|hw
op_assign
op_amp
id|ne2k_cbus_hwinfo_list
(braket
l_int|0
)braket
suffix:semicolon
id|hw-&gt;hwtype
suffix:semicolon
id|hw
op_increment
)paren
(brace
id|ne2k_cbus_set_hwtype
c_func
(paren
id|dev
comma
id|hw
comma
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ne_probe1
c_func
(paren
id|dev
comma
id|ioaddr
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|ne_probe1
r_static
r_int
id|__init
id|ne_probe1
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|ioaddr
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
id|SA_prom
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|wordlength
op_assign
l_int|2
suffix:semicolon
r_const
r_char
op_star
id|name
op_assign
l_int|NULL
suffix:semicolon
r_int
id|start_page
comma
id|stop_page
suffix:semicolon
r_int
id|neX000
comma
id|bad_card
suffix:semicolon
r_int
id|reg0
comma
id|ret
suffix:semicolon
r_static
r_int
id|version_printed
suffix:semicolon
r_const
r_struct
id|ne2k_cbus_region
op_star
id|rlist
suffix:semicolon
r_const
r_struct
id|ne2k_cbus_hwinfo
op_star
id|hw
op_assign
id|ne2k_cbus_get_hwinfo
c_func
(paren
(paren
r_int
)paren
(paren
id|dev-&gt;mem_start
op_amp
id|NE2K_CBUS_HARDWARE_TYPE_MASK
)paren
)paren
suffix:semicolon
r_struct
id|ei_device
op_star
id|ei_local
op_assign
(paren
r_struct
id|ei_device
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_NE2K_CBUS_CNET98EL
r_if
c_cond
(paren
id|hw-&gt;hwtype
op_eq
id|NE2K_CBUS_HARDWARE_TYPE_CNET98EL
)paren
(brace
id|outb_p
c_func
(paren
l_int|0
comma
id|CONFIG_NE2K_CBUS_CNET98EL_IO_BASE
)paren
suffix:semicolon
multiline_comment|/* udelay(5000);&t;*/
id|outb_p
c_func
(paren
l_int|1
comma
id|CONFIG_NE2K_CBUS_CNET98EL_IO_BASE
)paren
suffix:semicolon
multiline_comment|/* udelay(5000);&t;*/
id|outb_p
c_func
(paren
(paren
id|ioaddr
op_amp
l_int|0xf000
)paren
op_rshift
l_int|8
op_or
l_int|0x08
op_or
l_int|0x01
comma
id|CONFIG_NE2K_CBUS_CNET98EL_IO_BASE
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* udelay(5000); */
)brace
macro_line|#endif
r_for
c_loop
(paren
id|rlist
op_assign
id|hw-&gt;regionlist
suffix:semicolon
id|rlist-&gt;range
suffix:semicolon
id|rlist
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|ioaddr
op_plus
id|rlist-&gt;start
comma
id|rlist-&gt;range
comma
id|dev-&gt;name
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
id|reg0
op_assign
id|inb_p
c_func
(paren
id|ioaddr
op_plus
id|EI_SHIFT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg0
op_eq
l_int|0xFF
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* Do a preliminary verification that we have a 8390. */
macro_line|#ifdef CONFIG_NE2K_CBUS_CNET98EL
r_if
c_cond
(paren
id|hw-&gt;hwtype
op_ne
id|NE2K_CBUS_HARDWARE_TYPE_CNET98EL
)paren
macro_line|#endif
(brace
r_int
id|regd
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_NODMA
op_plus
id|E8390_PAGE1
op_plus
id|E8390_STOP
comma
id|ioaddr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|regd
op_assign
id|inb_p
c_func
(paren
id|ioaddr
op_plus
id|EI_SHIFT
c_func
(paren
l_int|0x0d
)paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0xff
comma
id|ioaddr
op_plus
id|EI_SHIFT
c_func
(paren
l_int|0x0d
)paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_NODMA
op_plus
id|E8390_PAGE0
comma
id|ioaddr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
id|inb_p
c_func
(paren
id|ioaddr
op_plus
id|EN0_COUNTER0
)paren
suffix:semicolon
multiline_comment|/* Clear the counter by reading. */
r_if
c_cond
(paren
id|inb_p
c_func
(paren
id|ioaddr
op_plus
id|EN0_COUNTER0
)paren
op_ne
l_int|0
)paren
(brace
id|outb_p
c_func
(paren
id|reg0
comma
id|ioaddr
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|regd
comma
id|ioaddr
op_plus
id|EI_SHIFT
c_func
(paren
l_int|0x0d
)paren
)paren
suffix:semicolon
multiline_comment|/* Restore the old values. */
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ei_debug
op_logical_and
id|version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&quot;
id|KERN_INFO
l_string|&quot;%s&quot;
comma
id|version1
comma
id|version2
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NE*000 ethercard probe at %#3x:&quot;
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* A user with a poor card that fails to ack the reset, or that&n;&t;   does not have a valid 0x57,0x57 signature can still use this&n;&t;   without having to recompile. Specifying an i/o address along&n;&t;   with an otherwise unused dev-&gt;mem_end value of &quot;0xBAD&quot; will&n;&t;   cause the driver to skip these parts of the probe. */
id|bad_card
op_assign
(paren
(paren
id|dev-&gt;base_addr
op_ne
l_int|0
)paren
op_logical_and
(paren
id|dev-&gt;mem_end
op_eq
l_int|0xbad
)paren
)paren
suffix:semicolon
multiline_comment|/* Reset card. Who knows what dain-bramaged state it was left in. */
(brace
r_int
r_int
id|reset_start_time
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* derived from CNET98EL-patch for bad clones */
id|outb_p
c_func
(paren
id|E8390_NODMA
op_or
id|E8390_STOP
comma
id|ioaddr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
multiline_comment|/* DON&squot;T change these to inb_p/outb_p or reset will fail on clones. */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|NE_RESET
)paren
comma
id|ioaddr
op_plus
id|NE_RESET
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inb_p
c_func
(paren
id|ioaddr
op_plus
id|EN0_ISR
)paren
op_amp
id|ENISR_RESET
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|jiffies
op_minus
id|reset_start_time
OG
l_int|2
op_star
id|HZ
op_div
l_int|100
)paren
(brace
r_if
c_cond
(paren
id|bad_card
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; (warning: no reset ack)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot; not found (no reset ack).&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
)brace
id|outb_p
c_func
(paren
l_int|0xff
comma
id|ioaddr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Ack all intr. */
)brace
macro_line|#ifdef CONFIG_NE2K_CBUS_CNET98EL
r_if
c_cond
(paren
id|hw-&gt;hwtype
op_eq
id|NE2K_CBUS_HARDWARE_TYPE_CNET98EL
)paren
(brace
r_static
r_const
r_char
id|pat
(braket
l_int|32
)braket
op_assign
l_string|&quot;AbcdeFghijKlmnoPqrstUvwxyZ789012&quot;
suffix:semicolon
r_char
id|buf
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|maxwait
op_assign
l_int|200
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot; [CNET98EL-specific initialize...&quot;
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_NODMA
op_or
id|E8390_STOP
comma
id|ioaddr
op_plus
id|E8390_CMD
)paren
suffix:semicolon
multiline_comment|/* 0x20|0x1 */
id|i
op_assign
id|inb
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
op_complement
l_int|0x2
)paren
op_ne
(paren
l_int|0x20
op_or
l_int|0x01
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
l_int|0x7
)paren
op_amp
l_int|0x80
)paren
op_ne
l_int|0x80
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RXOFF
comma
id|ioaddr
op_plus
id|EN0_RXCR
)paren
suffix:semicolon
multiline_comment|/* out(ioaddr+0xc, 0x20) */
multiline_comment|/* outb_p(ENDCFG_WTS|ENDCFG_FT1|ENDCFG_LS, ioaddr+EN0_DCFG); */
id|outb_p
c_func
(paren
id|ENDCFG_WTS
op_or
l_int|0x48
comma
id|ioaddr
op_plus
id|EN0_DCFG
)paren
suffix:semicolon
multiline_comment|/* 0x49 */
id|outb_p
c_func
(paren
id|CNET98EL_START_PG
comma
id|ioaddr
op_plus
id|EN0_STARTPG
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|CNET98EL_STOP_PG
comma
id|ioaddr
op_plus
id|EN0_STOPPG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;memory check&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|65536
suffix:semicolon
id|i
op_add_assign
l_int|1024
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot; %04x&quot;
comma
id|i
)paren
suffix:semicolon
id|ne2k_cbus_writemem
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|i
comma
id|pat
comma
l_int|32
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|EN0_ISR
)paren
op_amp
id|ENISR_RDC
)paren
op_ne
id|ENISR_RDC
)paren
op_logical_and
op_decrement
id|maxwait
)paren
suffix:semicolon
id|ne2k_cbus_readmem
c_func
(paren
id|dev
comma
id|ioaddr
comma
id|i
comma
id|buf
comma
l_int|32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|pat
comma
id|buf
comma
l_int|32
)paren
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot; failed.&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_ne
l_int|16384
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;] &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;memory failure at %x&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot; good...&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;irq
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;] &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IRQ must be specified for C-NET(98)E/L. probe failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|outb
c_func
(paren
(paren
id|dev-&gt;irq
OG
l_int|5
)paren
ques
c_cond
(paren
id|dev-&gt;irq
op_amp
l_int|4
)paren
suffix:colon
(paren
id|dev-&gt;irq
op_rshift
l_int|1
)paren
comma
id|ioaddr
op_plus
(paren
l_int|0x2
op_or
l_int|0x400
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x7e
comma
id|ioaddr
op_plus
(paren
l_int|0x4
op_or
l_int|0x400
)paren
)paren
suffix:semicolon
id|ne2k_cbus_readmem
c_func
(paren
id|dev
comma
id|ioaddr
comma
l_int|16384
comma
id|SA_prom
comma
l_int|32
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|ioaddr
op_plus
id|EN0_ISR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;done]&quot;
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif /* CONFIG_NE2K_CBUS_CNET98EL */
multiline_comment|/* Read the 16 bytes of station address PROM.&n;&t;   We must first initialize registers, similar to NS8390_init(eifdev, 0).&n;&t;   We can&squot;t reliably read the SAPROM address without this.&n;&t;   (I learned the hard way!). */
(brace
r_struct
(brace
r_int
r_char
id|value
suffix:semicolon
r_int
r_int
id|offset
suffix:semicolon
)brace
id|program_seq
(braket
)braket
op_assign
(brace
(brace
id|E8390_NODMA
op_plus
id|E8390_PAGE0
op_plus
id|E8390_STOP
comma
id|E8390_CMD
)brace
comma
multiline_comment|/* Select page 0*/
multiline_comment|/* NEC PC-9800: some board can only handle word-wide access? */
(brace
l_int|0x48
op_or
id|ENDCFG_WTS
comma
id|EN0_DCFG
)brace
comma
multiline_comment|/* Set word-wide (0x48) access. */
(brace
l_int|16384
op_div
l_int|256
comma
id|EN0_STARTPG
)brace
comma
(brace
l_int|32768
op_div
l_int|256
comma
id|EN0_STOPPG
)brace
comma
(brace
l_int|0x00
comma
id|EN0_RCNTLO
)brace
comma
multiline_comment|/* Clear the count regs. */
(brace
l_int|0x00
comma
id|EN0_RCNTHI
)brace
comma
(brace
l_int|0x00
comma
id|EN0_IMR
)brace
comma
multiline_comment|/* Mask completion irq. */
(brace
l_int|0xFF
comma
id|EN0_ISR
)brace
comma
(brace
id|E8390_RXOFF
comma
id|EN0_RXCR
)brace
comma
multiline_comment|/* 0x20  Set to monitor */
(brace
id|E8390_TXOFF
comma
id|EN0_TXCR
)brace
comma
multiline_comment|/* 0x02  and loopback mode. */
(brace
l_int|32
comma
id|EN0_RCNTLO
)brace
comma
(brace
l_int|0x00
comma
id|EN0_RCNTHI
)brace
comma
(brace
l_int|0x00
comma
id|EN0_RSARLO
)brace
comma
multiline_comment|/* DMA starting at 0x0000. */
(brace
l_int|0x00
comma
id|EN0_RSARHI
)brace
comma
(brace
id|E8390_RREAD
op_plus
id|E8390_START
comma
id|E8390_CMD
)brace
comma
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|program_seq
)paren
op_div
r_sizeof
(paren
id|program_seq
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
id|outb_p
c_func
(paren
id|program_seq
(braket
id|i
)braket
dot
id|value
comma
id|ioaddr
op_plus
id|program_seq
(braket
id|i
)braket
dot
id|offset
)paren
suffix:semicolon
id|insw
c_func
(paren
id|ioaddr
op_plus
id|NE_DATAPORT
comma
id|SA_prom
comma
l_int|32
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|wordlength
op_eq
l_int|2
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|SA_prom
(braket
id|i
)braket
op_assign
id|SA_prom
(braket
id|i
op_plus
id|i
)braket
suffix:semicolon
id|start_page
op_assign
id|NESM_START_PG
suffix:semicolon
id|stop_page
op_assign
id|NESM_STOP_PG
suffix:semicolon
macro_line|#ifdef CONFIG_NE2K_CBUS_CNET98EL
r_if
c_cond
(paren
id|hw-&gt;hwtype
op_eq
id|NE2K_CBUS_HARDWARE_TYPE_CNET98EL
)paren
(brace
id|start_page
op_assign
id|CNET98EL_START_PG
suffix:semicolon
id|stop_page
op_assign
id|CNET98EL_STOP_PG
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
id|start_page
op_assign
id|NE1SM_START_PG
suffix:semicolon
id|stop_page
op_assign
id|NE1SM_STOP_PG
suffix:semicolon
)brace
id|neX000
op_assign
(paren
id|SA_prom
(braket
l_int|14
)braket
op_eq
l_int|0x57
op_logical_and
id|SA_prom
(braket
l_int|15
)braket
op_eq
l_int|0x57
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neX000
)paren
(brace
id|name
op_assign
l_string|&quot;C-Bus-NE2K-compat&quot;
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef SUPPORT_NE_BAD_CLONES
multiline_comment|/* Ack!  Well, there might be a *bad* NE*000 clone there.&n;&t;&t;   Check for total bogus addresses. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|bad_clone_list
(braket
id|i
)braket
dot
id|name8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|SA_prom
(braket
l_int|0
)braket
op_eq
id|bad_clone_list
(braket
id|i
)braket
dot
id|SAprefix
(braket
l_int|0
)braket
op_logical_and
id|SA_prom
(braket
l_int|1
)braket
op_eq
id|bad_clone_list
(braket
id|i
)braket
dot
id|SAprefix
(braket
l_int|1
)braket
op_logical_and
id|SA_prom
(braket
l_int|2
)braket
op_eq
id|bad_clone_list
(braket
id|i
)braket
dot
id|SAprefix
(braket
l_int|2
)braket
)paren
(brace
r_if
c_cond
(paren
id|wordlength
op_eq
l_int|2
)paren
(brace
id|name
op_assign
id|bad_clone_list
(braket
id|i
)braket
dot
id|name16
suffix:semicolon
)brace
r_else
(brace
id|name
op_assign
id|bad_clone_list
(braket
id|i
)braket
dot
id|name8
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bad_clone_list
(braket
id|i
)braket
dot
id|name8
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; not found (invalid signature %2.2x %2.2x).&bslash;n&quot;
comma
id|SA_prom
(braket
l_int|14
)braket
comma
id|SA_prom
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
macro_line|#else
id|printk
c_func
(paren
l_string|&quot; not found.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|dev-&gt;irq
OL
l_int|2
)paren
(brace
r_int
r_int
id|cookie
op_assign
id|probe_irq_on
c_func
(paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x50
comma
id|ioaddr
op_plus
id|EN0_IMR
)paren
suffix:semicolon
multiline_comment|/* Enable one interrupt. */
id|outb_p
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RREAD
op_plus
id|E8390_START
comma
id|ioaddr
)paren
suffix:semicolon
multiline_comment|/* Trigger it... */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* wait 10ms for interrupt to propagate */
id|outb_p
c_func
(paren
l_int|0x00
comma
id|ioaddr
op_plus
id|EN0_IMR
)paren
suffix:semicolon
multiline_comment|/* Mask it again. */
id|dev-&gt;irq
op_assign
id|probe_irq_off
c_func
(paren
id|cookie
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot; autoirq is %d&bslash;n&quot;
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
l_int|7
)paren
multiline_comment|/* Fixup for users that don&squot;t know that IRQ 7 is really IRQ 11,&n;&t;&t;   or don&squot;t know which one to set. */
id|dev-&gt;irq
op_assign
l_int|11
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;irq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; failed to detect IRQ line.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* Allocate dev-&gt;priv and fill in 8390 specific dev fields. */
r_if
c_cond
(paren
id|ethdev_init
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
(paren
l_string|&quot; unable to get memory for dev-&gt;priv.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* Snarf the interrupt now.  There&squot;s no point in waiting since we cannot&n;&t;   share and the board will usually be enabled. */
id|ret
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|ei_interrupt
comma
l_int|0
comma
id|name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
(paren
l_string|&quot; unable to get IRQ %d (errno=%d).&bslash;n&quot;
comma
id|dev-&gt;irq
comma
id|ret
)paren
suffix:semicolon
r_goto
id|err_out_kfree
suffix:semicolon
)brace
id|dev-&gt;base_addr
op_assign
id|ioaddr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ETHER_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|SA_prom
(braket
id|i
)braket
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|SA_prom
(braket
id|i
)braket
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n%s: %s found at %#x, hardware type %d(%s), using IRQ %d.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|name
comma
id|ioaddr
comma
id|hw-&gt;hwtype
comma
id|hw-&gt;hwident
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|ei_status.name
op_assign
id|name
suffix:semicolon
id|ei_status.tx_start_page
op_assign
id|start_page
suffix:semicolon
id|ei_status.stop_page
op_assign
id|stop_page
suffix:semicolon
id|ei_status.word16
op_assign
(paren
id|wordlength
op_eq
l_int|2
)paren
suffix:semicolon
id|ei_status.rx_start_page
op_assign
id|start_page
op_plus
id|TX_PAGES
suffix:semicolon
macro_line|#ifdef PACKETBUF_MEMSIZE
multiline_comment|/* Allow the packet buffer size to be overridden by know-it-alls. */
id|ei_status.stop_page
op_assign
id|ei_status.tx_start_page
op_plus
id|PACKETBUF_MEMSIZE
suffix:semicolon
macro_line|#endif
id|ei_status.reset_8390
op_assign
op_amp
id|ne_reset_8390
suffix:semicolon
id|ei_status.block_input
op_assign
op_amp
id|ne_block_input
suffix:semicolon
id|ei_status.block_output
op_assign
op_amp
id|ne_block_output
suffix:semicolon
id|ei_status.get_8390_hdr
op_assign
op_amp
id|ne_get_8390_hdr
suffix:semicolon
id|ei_status.priv
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;open
op_assign
op_amp
id|ne_open
suffix:semicolon
id|dev-&gt;stop
op_assign
op_amp
id|ne_close
suffix:semicolon
id|NS8390_init
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_kfree
suffix:colon
id|ne2k_cbus_destroy
c_func
(paren
id|dev
)paren
suffix:semicolon
id|err_out
suffix:colon
r_while
c_loop
(paren
id|rlist
OG
id|hw-&gt;regionlist
)paren
(brace
id|rlist
op_decrement
suffix:semicolon
id|release_region
c_func
(paren
id|ioaddr
op_plus
id|rlist-&gt;start
comma
id|rlist-&gt;range
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ne_open
r_static
r_int
id|ne_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|ei_open
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ne_close
r_static
r_int
id|ne_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|ei_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Shutting down ethercard.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ei_close
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Hard reset the card.  This used to pause for the same period that a&n;   8390 reset command required, but that shouldn&squot;t be necessary. */
DECL|function|ne_reset_8390
r_static
r_void
id|ne_reset_8390
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
r_int
id|reset_start_time
op_assign
id|jiffies
suffix:semicolon
r_struct
id|ei_device
op_star
id|ei_local
op_assign
(paren
r_struct
id|ei_device
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;resetting the 8390 t=%ld...&quot;
comma
id|jiffies
)paren
suffix:semicolon
multiline_comment|/* derived from CNET98EL-patch for bad clones... */
id|outb_p
c_func
(paren
id|E8390_NODMA
op_or
id|E8390_STOP
comma
id|NE_BASE
op_plus
id|E8390_CMD
)paren
suffix:semicolon
multiline_comment|/* 0x20 | 0x1 */
multiline_comment|/* DON&squot;T change these to inb_p/outb_p or reset will fail on clones. */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|NE_BASE
op_plus
id|NE_RESET
)paren
comma
id|NE_BASE
op_plus
id|NE_RESET
)paren
suffix:semicolon
id|ei_status.txing
op_assign
l_int|0
suffix:semicolon
id|ei_status.dmaing
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* This check _should_not_ be necessary, omit eventually. */
r_while
c_loop
(paren
(paren
id|inb_p
c_func
(paren
id|NE_BASE
op_plus
id|EN0_ISR
)paren
op_amp
id|ENISR_RESET
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|jiffies
op_minus
id|reset_start_time
OG
l_int|2
op_star
id|HZ
op_div
l_int|100
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: ne_reset_8390() did not complete.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|ENISR_RESET
comma
id|NE_BASE
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Ack intr. */
)brace
multiline_comment|/* Grab the 8390 specific header. Similar to the block_input routine, but&n;   we don&squot;t need to be concerned with ring wrap as the header will be at&n;   the start of a page, so we optimize accordingly. */
DECL|function|ne_get_8390_hdr
r_static
r_void
id|ne_get_8390_hdr
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|e8390_pkt_hdr
op_star
id|hdr
comma
r_int
id|ring_page
)paren
(brace
r_int
id|nic_base
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|ei_device
op_star
id|ei_local
op_assign
(paren
r_struct
id|ei_device
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
multiline_comment|/* This *shouldn&squot;t* happen. If it does, it&squot;s the last thing you&squot;ll see */
r_if
c_cond
(paren
id|ei_status.dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: DMAing conflict in ne_get_8390_hdr &quot;
l_string|&quot;[DMAstat:%d][irqlock:%d].&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_status.dmaing
comma
id|ei_status.irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ei_status.dmaing
op_or_assign
l_int|0x01
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_NODMA
op_plus
id|E8390_PAGE0
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
id|outb_p
c_func
(paren
r_sizeof
(paren
r_struct
id|e8390_pkt_hdr
)paren
comma
id|nic_base
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
id|nic_base
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
multiline_comment|/* On page boundary */
id|outb_p
c_func
(paren
id|ring_page
comma
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RREAD
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_status.word16
)paren
id|insw
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|hdr
comma
r_sizeof
(paren
r_struct
id|e8390_pkt_hdr
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|insb
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|hdr
comma
r_sizeof
(paren
r_struct
id|e8390_pkt_hdr
)paren
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|ENISR_RDC
comma
id|nic_base
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Ack intr. */
id|ei_status.dmaing
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|le16_to_cpus
c_func
(paren
op_amp
id|hdr-&gt;count
)paren
suffix:semicolon
)brace
multiline_comment|/* Block input and output, similar to the Crynwr packet driver.  If you&n;   are porting to a new ethercard, look at the packet driver source for hints.&n;   The NEx000 doesn&squot;t share the on-board packet memory -- you have to put&n;   the packet out through the &quot;remote DMA&quot; dataport using outb. */
DECL|function|ne_block_input
r_static
r_void
id|ne_block_input
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|count
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|ring_offset
)paren
(brace
macro_line|#ifdef NE_SANITY_CHECK
r_int
id|xfer_count
op_assign
id|count
suffix:semicolon
macro_line|#endif
r_int
id|nic_base
op_assign
id|dev-&gt;base_addr
suffix:semicolon
r_char
op_star
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
r_struct
id|ei_device
op_star
id|ei_local
op_assign
(paren
r_struct
id|ei_device
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
multiline_comment|/* This *shouldn&squot;t* happen. If it does, it&squot;s the last thing you&squot;ll see */
r_if
c_cond
(paren
id|ei_status.dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: DMAing conflict in ne_block_input &quot;
l_string|&quot;[DMAstat:%d][irqlock:%d].&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_status.dmaing
comma
id|ei_status.irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ei_status.dmaing
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* round up count to a word (derived from ICM-patch) */
id|count
op_assign
(paren
id|count
op_plus
l_int|1
)paren
op_amp
op_complement
l_int|1
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_NODMA
op_plus
id|E8390_PAGE0
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|count
op_amp
l_int|0xff
comma
id|nic_base
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|count
op_rshift
l_int|8
comma
id|nic_base
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|ring_offset
op_amp
l_int|0xff
comma
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|ring_offset
op_rshift
l_int|8
comma
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RREAD
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_status.word16
)paren
(brace
id|insw
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|buf
comma
id|count
op_rshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_amp
l_int|0x01
)paren
(brace
id|buf
(braket
id|count
op_minus
l_int|1
)braket
op_assign
id|inb
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
)paren
suffix:semicolon
macro_line|#ifdef NE_SANITY_CHECK
id|xfer_count
op_increment
suffix:semicolon
macro_line|#endif
)brace
)brace
r_else
(brace
id|insb
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
macro_line|#ifdef NE_SANITY_CHECK
multiline_comment|/* This was for the ALPHA version only, but enough people have&n;&t;   been encountering problems so it is still here.  If you see&n;&t;   this message you either 1) have a slightly incompatible clone&n;&t;   or 2) have noise/speed problems with your bus. */
r_if
c_cond
(paren
id|ei_debug
OG
l_int|1
)paren
(brace
multiline_comment|/* DMA termination address check... */
r_int
id|addr
comma
id|tries
op_assign
l_int|20
suffix:semicolon
r_do
(brace
multiline_comment|/* DON&squot;T check for &squot;inb_p(EN0_ISR) &amp; ENISR_RDC&squot; here&n;&t;&t;&t;   -- it&squot;s broken for Rx on some cards! */
r_int
id|high
op_assign
id|inb_p
c_func
(paren
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
r_int
id|low
op_assign
id|inb_p
c_func
(paren
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|addr
op_assign
(paren
id|high
op_lshift
l_int|8
)paren
op_plus
id|low
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|ring_offset
op_plus
id|xfer_count
)paren
op_amp
l_int|0xff
)paren
op_eq
id|low
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|tries
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tries
op_le
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: RX transfer address mismatch,&quot;
l_string|&quot;%#4.4x (expected) vs. %#4.4x (actual).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ring_offset
op_plus
id|xfer_count
comma
id|addr
)paren
suffix:semicolon
)brace
macro_line|#endif
id|outb_p
c_func
(paren
id|ENISR_RDC
comma
id|nic_base
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Ack intr. */
id|ei_status.dmaing
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
)brace
DECL|function|ne_block_output
r_static
r_void
id|ne_block_output
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|count
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_const
r_int
id|start_page
)paren
(brace
r_int
id|nic_base
op_assign
id|NE_BASE
suffix:semicolon
r_int
r_int
id|dma_start
suffix:semicolon
macro_line|#ifdef NE_SANITY_CHECK
r_int
id|retries
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_struct
id|ei_device
op_star
id|ei_local
op_assign
(paren
r_struct
id|ei_device
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
multiline_comment|/* Round the count up for word writes.  Do we need to do this?&n;&t;   What effect will an odd byte count have on the 8390?&n;&t;   I should check someday. */
r_if
c_cond
(paren
id|ei_status.word16
op_logical_and
(paren
id|count
op_amp
l_int|0x01
)paren
)paren
id|count
op_increment
suffix:semicolon
multiline_comment|/* This *shouldn&squot;t* happen. If it does, it&squot;s the last thing you&squot;ll see */
r_if
c_cond
(paren
id|ei_status.dmaing
)paren
(brace
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: DMAing conflict in ne_block_output.&quot;
l_string|&quot;[DMAstat:%d][irqlock:%d]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ei_status.dmaing
comma
id|ei_status.irqlock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ei_status.dmaing
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* We should already be in page 0, but to be safe... */
id|outb_p
c_func
(paren
id|E8390_PAGE0
op_plus
id|E8390_START
op_plus
id|E8390_NODMA
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
macro_line|#ifdef NE_SANITY_CHECK
id|retry
suffix:colon
macro_line|#endif
macro_line|#ifdef NE8390_RW_BUGFIX
multiline_comment|/* Handle the read-before-write bug the same way as the&n;&t;   Crynwr packet driver -- the NatSemi method doesn&squot;t work.&n;&t;   Actually this doesn&squot;t always work either, but if you have&n;&t;   problems with your NEx000 this is better than nothing! */
id|outb_p
c_func
(paren
l_int|0x42
comma
id|nic_base
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|nic_base
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x42
comma
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RREAD
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
multiline_comment|/* Make certain that the dummy read has occurred. */
id|udelay
c_func
(paren
l_int|6
)paren
suffix:semicolon
macro_line|#endif
id|outb_p
c_func
(paren
id|ENISR_RDC
comma
id|nic_base
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Now the normal output. */
id|outb_p
c_func
(paren
id|count
op_amp
l_int|0xff
comma
id|nic_base
op_plus
id|EN0_RCNTLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|count
op_rshift
l_int|8
comma
id|nic_base
op_plus
id|EN0_RCNTHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0x00
comma
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|start_page
comma
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|E8390_RWRITE
op_plus
id|E8390_START
comma
id|nic_base
op_plus
id|NE_CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei_status.word16
)paren
(brace
id|outsw
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|buf
comma
id|count
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|outsb
c_func
(paren
id|NE_BASE
op_plus
id|NE_DATAPORT
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
id|dma_start
op_assign
id|jiffies
suffix:semicolon
macro_line|#ifdef NE_SANITY_CHECK
multiline_comment|/* This was for the ALPHA version only, but enough people have&n;&t;   been encountering problems so it is still here. */
r_if
c_cond
(paren
id|ei_debug
OG
l_int|1
)paren
(brace
multiline_comment|/* DMA termination address check... */
r_int
id|addr
comma
id|tries
op_assign
l_int|20
suffix:semicolon
r_do
(brace
r_int
id|high
op_assign
id|inb_p
c_func
(paren
id|nic_base
op_plus
id|EN0_RSARHI
)paren
suffix:semicolon
r_int
id|low
op_assign
id|inb_p
c_func
(paren
id|nic_base
op_plus
id|EN0_RSARLO
)paren
suffix:semicolon
id|addr
op_assign
(paren
id|high
op_lshift
l_int|8
)paren
op_plus
id|low
suffix:semicolon
r_if
c_cond
(paren
(paren
id|start_page
op_lshift
l_int|8
)paren
op_plus
id|count
op_eq
id|addr
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|tries
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tries
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Tx packet transfer address mismatch,&quot;
l_string|&quot;%#4.4x (expected) vs. %#4.4x (actual).&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|start_page
op_lshift
l_int|8
)paren
op_plus
id|count
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_increment
op_eq
l_int|0
)paren
r_goto
id|retry
suffix:semicolon
)brace
)brace
macro_line|#endif
r_while
c_loop
(paren
(paren
id|inb_p
c_func
(paren
id|nic_base
op_plus
id|EN0_ISR
)paren
op_amp
id|ENISR_RDC
)paren
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|jiffies
op_minus
id|dma_start
OG
l_int|2
op_star
id|HZ
op_div
l_int|100
)paren
(brace
multiline_comment|/* 20ms */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: timeout waiting for Tx RDC.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|ne_reset_8390
c_func
(paren
id|dev
)paren
suffix:semicolon
id|NS8390_init
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|ENISR_RDC
comma
id|nic_base
op_plus
id|EN0_ISR
)paren
suffix:semicolon
multiline_comment|/* Ack intr. */
id|ei_status.dmaing
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
r_return
suffix:semicolon
)brace
"&f;"
macro_line|#ifdef MODULE
DECL|macro|MAX_NE_CARDS
mdefine_line|#define MAX_NE_CARDS&t;4&t;/* Max number of NE cards per module */
DECL|variable|dev_ne
r_static
r_struct
id|net_device
id|dev_ne
(braket
id|MAX_NE_CARDS
)braket
suffix:semicolon
DECL|variable|io
r_static
r_int
id|io
(braket
id|MAX_NE_CARDS
)braket
suffix:semicolon
DECL|variable|irq
r_static
r_int
id|irq
(braket
id|MAX_NE_CARDS
)braket
suffix:semicolon
DECL|variable|bad
r_static
r_int
id|bad
(braket
id|MAX_NE_CARDS
)braket
suffix:semicolon
multiline_comment|/* 0xbad = bad sig or no reset ack */
DECL|variable|hwtype
r_static
r_int
id|hwtype
(braket
id|MAX_NE_CARDS
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* board type */
id|MODULE_PARM
c_func
(paren
id|io
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_NE_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|irq
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_NE_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|bad
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_NE_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|hwtype
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_NE_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|io
comma
l_string|&quot;I/O base address(es),required&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq
comma
l_string|&quot;IRQ number(s)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|bad
comma
l_string|&quot;Accept card(s) with bad signatures&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|hwtype
comma
l_string|&quot;Board type of PC-9800 C-Bus NIC&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;NE1000/NE2000 PC-9800 C-bus Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* This is set up so that no ISA autoprobe takes place. We can&squot;t guarantee&n;that the ne2k probe is the last 8390 based probe to take place (as it&n;is at boot) and so the probe will get confused by any other 8390 cards.&n;ISA device autoprobes on a running machine are not recommended anyway. */
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|this_dev
comma
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|this_dev
op_assign
l_int|0
suffix:semicolon
id|this_dev
OL
id|MAX_NE_CARDS
suffix:semicolon
id|this_dev
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|dev_ne
(braket
id|this_dev
)braket
suffix:semicolon
id|dev-&gt;irq
op_assign
id|irq
(braket
id|this_dev
)braket
suffix:semicolon
id|dev-&gt;mem_end
op_assign
id|bad
(braket
id|this_dev
)braket
suffix:semicolon
id|dev-&gt;base_addr
op_assign
id|io
(braket
id|this_dev
)braket
suffix:semicolon
id|dev-&gt;mem_start
op_assign
id|hwtype
(braket
id|this_dev
)braket
suffix:semicolon
id|dev-&gt;init
op_assign
id|ne_probe
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
op_eq
l_int|0
)paren
(brace
id|found
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Got at least one. */
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io
(braket
id|this_dev
)braket
op_ne
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ne.c: No NE*000 card found at i/o = %#x&bslash;n&quot;
comma
id|io
(braket
id|this_dev
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;ne.c: You must supply &bslash;&quot;io=0xNNN&bslash;&quot; value(s) for C-Bus cards.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_int
id|this_dev
suffix:semicolon
r_for
c_loop
(paren
id|this_dev
op_assign
l_int|0
suffix:semicolon
id|this_dev
OL
id|MAX_NE_CARDS
suffix:semicolon
id|this_dev
op_increment
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
op_amp
id|dev_ne
(braket
id|this_dev
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_ne
l_int|NULL
)paren
(brace
r_const
r_struct
id|ne2k_cbus_region
op_star
id|rlist
suffix:semicolon
r_const
r_struct
id|ne2k_cbus_hwinfo
op_star
id|hw
op_assign
id|ne2k_cbus_get_hwinfo
c_func
(paren
(paren
r_int
)paren
(paren
id|dev-&gt;mem_start
op_amp
id|NE2K_CBUS_HARDWARE_TYPE_MASK
)paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rlist
op_assign
id|hw-&gt;regionlist
suffix:semicolon
id|rlist-&gt;range
suffix:semicolon
id|rlist
op_increment
)paren
(brace
id|release_region
c_func
(paren
id|dev-&gt;base_addr
op_plus
id|rlist-&gt;start
comma
id|rlist-&gt;range
)paren
suffix:semicolon
)brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ne2k_cbus_destroy
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* MODULE */
"&f;"
multiline_comment|/*&n; * Local variables:&n; *  compile-command: &quot;gcc -DKERNEL -Wall -O6 -fomit-frame-pointer -I/usr/src/linux/net/tcp -c ne.c&quot;&n; *  version-control: t&n; *  kept-new-versions: 5&n; * End:&n; */
eof
