multiline_comment|/* tc35815.c: A TOSHIBA TC35815CF PCI 10/100Mbps ethernet driver for linux.&n; *&n; * Copyright 2001 MontaVista Software Inc.&n; * Author: MontaVista Software, Inc. &n; *                ahennessy@mvista.com&n; *&n; * Based on skelton.c by Donald Becker.&n; * Copyright (C) 2000-2001 Toshiba Corporation&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; *&n; * THIS  SOFTWARE  IS PROVIDED   ``AS  IS&squot;&squot; AND   ANY  EXPRESS OR IMPLIED&n; * WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF&n; * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN&n; * NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,&n; * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; * NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF&n; * USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; * ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT&n; * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * You should have received a copy of the  GNU General Public License along&n; * with this program; if not, write  to the Free Software Foundation, Inc.,&n; * 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;tc35815.c:v0.00 26/07/2000 by Toshiba Corporation&bslash;n&quot;
suffix:semicolon
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
multiline_comment|/*&n; * The name of the card. Is used for messages and in the requests for&n; * io regions, irqs and dma channels&n; */
DECL|variable|cardname
r_static
r_const
r_char
op_star
id|cardname
op_assign
l_string|&quot;TC35815CF&quot;
suffix:semicolon
DECL|macro|TC35815_PROC_ENTRY
mdefine_line|#define TC35815_PROC_ENTRY &quot;net/tc35815&quot;
DECL|macro|TC35815_MODULE_NAME
mdefine_line|#define TC35815_MODULE_NAME &quot;TC35815CF&quot;
DECL|macro|TX_TIMEOUT
mdefine_line|#define TX_TIMEOUT (4*HZ)
multiline_comment|/* First, a few definitions that the brave might change. */
multiline_comment|/* use 0 for production, 1 for verification, &gt;2 for debug */
macro_line|#ifndef TC35815_DEBUG
DECL|macro|TC35815_DEBUG
mdefine_line|#define TC35815_DEBUG 1
macro_line|#endif
DECL|variable|tc35815_debug
r_static
r_int
r_int
id|tc35815_debug
op_assign
id|TC35815_DEBUG
suffix:semicolon
DECL|macro|GATHER_TXINT
mdefine_line|#define GATHER_TXINT&t;/* On-Demand Tx Interrupt */
DECL|macro|vtonocache
mdefine_line|#define vtonocache(p)&t;KSEG1ADDR(virt_to_phys(p))
multiline_comment|/*&n; * Registers&n; */
DECL|struct|tc35815_regs
r_struct
id|tc35815_regs
(brace
DECL|member|DMA_Ctl
r_volatile
id|__u32
id|DMA_Ctl
suffix:semicolon
multiline_comment|/* 0x00 */
DECL|member|TxFrmPtr
r_volatile
id|__u32
id|TxFrmPtr
suffix:semicolon
DECL|member|TxThrsh
r_volatile
id|__u32
id|TxThrsh
suffix:semicolon
DECL|member|TxPollCtr
r_volatile
id|__u32
id|TxPollCtr
suffix:semicolon
DECL|member|BLFrmPtr
r_volatile
id|__u32
id|BLFrmPtr
suffix:semicolon
DECL|member|RxFragSize
r_volatile
id|__u32
id|RxFragSize
suffix:semicolon
DECL|member|Int_En
r_volatile
id|__u32
id|Int_En
suffix:semicolon
DECL|member|FDA_Bas
r_volatile
id|__u32
id|FDA_Bas
suffix:semicolon
DECL|member|FDA_Lim
r_volatile
id|__u32
id|FDA_Lim
suffix:semicolon
multiline_comment|/* 0x20 */
DECL|member|Int_Src
r_volatile
id|__u32
id|Int_Src
suffix:semicolon
DECL|member|unused0
r_volatile
id|__u32
id|unused0
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|PauseCnt
r_volatile
id|__u32
id|PauseCnt
suffix:semicolon
DECL|member|RemPauCnt
r_volatile
id|__u32
id|RemPauCnt
suffix:semicolon
DECL|member|TxCtlFrmStat
r_volatile
id|__u32
id|TxCtlFrmStat
suffix:semicolon
DECL|member|unused1
r_volatile
id|__u32
id|unused1
suffix:semicolon
DECL|member|MAC_Ctl
r_volatile
id|__u32
id|MAC_Ctl
suffix:semicolon
multiline_comment|/* 0x40 */
DECL|member|CAM_Ctl
r_volatile
id|__u32
id|CAM_Ctl
suffix:semicolon
DECL|member|Tx_Ctl
r_volatile
id|__u32
id|Tx_Ctl
suffix:semicolon
DECL|member|Tx_Stat
r_volatile
id|__u32
id|Tx_Stat
suffix:semicolon
DECL|member|Rx_Ctl
r_volatile
id|__u32
id|Rx_Ctl
suffix:semicolon
DECL|member|Rx_Stat
r_volatile
id|__u32
id|Rx_Stat
suffix:semicolon
DECL|member|MD_Data
r_volatile
id|__u32
id|MD_Data
suffix:semicolon
DECL|member|MD_CA
r_volatile
id|__u32
id|MD_CA
suffix:semicolon
DECL|member|CAM_Adr
r_volatile
id|__u32
id|CAM_Adr
suffix:semicolon
multiline_comment|/* 0x60 */
DECL|member|CAM_Data
r_volatile
id|__u32
id|CAM_Data
suffix:semicolon
DECL|member|CAM_Ena
r_volatile
id|__u32
id|CAM_Ena
suffix:semicolon
DECL|member|PROM_Ctl
r_volatile
id|__u32
id|PROM_Ctl
suffix:semicolon
DECL|member|PROM_Data
r_volatile
id|__u32
id|PROM_Data
suffix:semicolon
DECL|member|Algn_Cnt
r_volatile
id|__u32
id|Algn_Cnt
suffix:semicolon
DECL|member|CRC_Cnt
r_volatile
id|__u32
id|CRC_Cnt
suffix:semicolon
DECL|member|Miss_Cnt
r_volatile
id|__u32
id|Miss_Cnt
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * Bit assignments&n; */
multiline_comment|/* DMA_Ctl bit asign ------------------------------------------------------- */
DECL|macro|DMA_IntMask
mdefine_line|#define DMA_IntMask            0x00040000 /* 1:Interupt mask                 */
DECL|macro|DMA_SWIntReq
mdefine_line|#define DMA_SWIntReq           0x00020000 /* 1:Software Interrupt request    */
DECL|macro|DMA_TxWakeUp
mdefine_line|#define DMA_TxWakeUp           0x00010000 /* 1:Transmit Wake Up              */
DECL|macro|DMA_RxBigE
mdefine_line|#define DMA_RxBigE             0x00008000 /* 1:Receive Big Endian            */
DECL|macro|DMA_TxBigE
mdefine_line|#define DMA_TxBigE             0x00004000 /* 1:Transmit Big Endian           */
DECL|macro|DMA_TestMode
mdefine_line|#define DMA_TestMode           0x00002000 /* 1:Test Mode                     */
DECL|macro|DMA_PowrMgmnt
mdefine_line|#define DMA_PowrMgmnt          0x00001000 /* 1:Power Management              */
DECL|macro|DMA_DmBurst_Mask
mdefine_line|#define DMA_DmBurst_Mask       0x000001fc /* DMA Burst size                  */
multiline_comment|/* RxFragSize bit asign ---------------------------------------------------- */
DECL|macro|RxFrag_EnPack
mdefine_line|#define RxFrag_EnPack          0x00008000 /* 1:Enable Packing                */
DECL|macro|RxFrag_MinFragMask
mdefine_line|#define RxFrag_MinFragMask     0x00000ffc /* Minimum Fragment                */
multiline_comment|/* MAC_Ctl bit asign ------------------------------------------------------- */
DECL|macro|MAC_Link10
mdefine_line|#define MAC_Link10             0x00008000 /* 1:Link Status 10Mbits           */
DECL|macro|MAC_EnMissRoll
mdefine_line|#define MAC_EnMissRoll         0x00002000 /* 1:Enable Missed Roll            */
DECL|macro|MAC_MissRoll
mdefine_line|#define MAC_MissRoll           0x00000400 /* 1:Missed Roll                   */
DECL|macro|MAC_Loop10
mdefine_line|#define MAC_Loop10             0x00000080 /* 1:Loop 10 Mbps                  */
DECL|macro|MAC_Conn_Auto
mdefine_line|#define MAC_Conn_Auto          0x00000000 /*00:Connection mode (Automatic)   */
DECL|macro|MAC_Conn_10M
mdefine_line|#define MAC_Conn_10M           0x00000020 /*01:                (10Mbps endec)*/
DECL|macro|MAC_Conn_Mll
mdefine_line|#define MAC_Conn_Mll           0x00000040 /*10:                (Mll clock)   */
DECL|macro|MAC_MacLoop
mdefine_line|#define MAC_MacLoop            0x00000010 /* 1:MAC Loopback                  */
DECL|macro|MAC_FullDup
mdefine_line|#define MAC_FullDup            0x00000008 /* 1:Full Duplex 0:Half Duplex     */
DECL|macro|MAC_Reset
mdefine_line|#define MAC_Reset              0x00000004 /* 1:Software Reset                */
DECL|macro|MAC_HaltImm
mdefine_line|#define MAC_HaltImm            0x00000002 /* 1:Halt Immediate                */
DECL|macro|MAC_HaltReq
mdefine_line|#define MAC_HaltReq            0x00000001 /* 1:Halt request                  */
multiline_comment|/* PROM_Ctl bit asign ------------------------------------------------------ */
DECL|macro|PROM_Busy
mdefine_line|#define PROM_Busy              0x00008000 /* 1:Busy (Start Operation)        */
DECL|macro|PROM_Read
mdefine_line|#define PROM_Read              0x00004000 /*10:Read operation                */
DECL|macro|PROM_Write
mdefine_line|#define PROM_Write             0x00002000 /*01:Write operation               */
DECL|macro|PROM_Erase
mdefine_line|#define PROM_Erase             0x00006000 /*11:Erase operation               */
multiline_comment|/*00:Enable or Disable Writting,   */
multiline_comment|/*      as specified in PROM_Addr. */
DECL|macro|PROM_Addr_Ena
mdefine_line|#define PROM_Addr_Ena          0x00000030 /*11xxxx:PROM Write enable         */
multiline_comment|/*00xxxx:           disable        */
multiline_comment|/* CAM_Ctl bit asign ------------------------------------------------------- */
DECL|macro|CAM_CompEn
mdefine_line|#define CAM_CompEn             0x00000010 /* 1:CAM Compare Enable            */
DECL|macro|CAM_NegCAM
mdefine_line|#define CAM_NegCAM             0x00000008 /* 1:Reject packets CAM recognizes,*/
multiline_comment|/*                    accept other */
DECL|macro|CAM_BroadAcc
mdefine_line|#define CAM_BroadAcc           0x00000004 /* 1:Broadcast assept              */
DECL|macro|CAM_GroupAcc
mdefine_line|#define CAM_GroupAcc           0x00000002 /* 1:Multicast assept              */
DECL|macro|CAM_StationAcc
mdefine_line|#define CAM_StationAcc         0x00000001 /* 1:unicast accept                */
multiline_comment|/* CAM_Ena bit asign ------------------------------------------------------- */
DECL|macro|CAM_ENTRY_MAX
mdefine_line|#define CAM_ENTRY_MAX                  21   /* CAM Data entry max count      */
DECL|macro|CAM_Ena_Mask
mdefine_line|#define CAM_Ena_Mask ((1&lt;&lt;CAM_ENTRY_MAX)-1) /* CAM Enable bits (Max 21bits)  */
DECL|macro|CAM_Ena_Bit
mdefine_line|#define CAM_Ena_Bit(index)         (1&lt;&lt;(index))
DECL|macro|CAM_ENTRY_DESTINATION
mdefine_line|#define CAM_ENTRY_DESTINATION&t;0
DECL|macro|CAM_ENTRY_SOURCE
mdefine_line|#define CAM_ENTRY_SOURCE&t;1
DECL|macro|CAM_ENTRY_MACCTL
mdefine_line|#define CAM_ENTRY_MACCTL&t;20
multiline_comment|/* Tx_Ctl bit asign -------------------------------------------------------- */
DECL|macro|Tx_En
mdefine_line|#define Tx_En                  0x00000001 /* 1:Transmit enable               */
DECL|macro|Tx_TxHalt
mdefine_line|#define Tx_TxHalt              0x00000002 /* 1:Transmit Halt Request         */
DECL|macro|Tx_NoPad
mdefine_line|#define Tx_NoPad               0x00000004 /* 1:Suppress Padding              */
DECL|macro|Tx_NoCRC
mdefine_line|#define Tx_NoCRC               0x00000008 /* 1:Suppress Padding              */
DECL|macro|Tx_FBack
mdefine_line|#define Tx_FBack               0x00000010 /* 1:Fast Back-off                 */
DECL|macro|Tx_EnUnder
mdefine_line|#define Tx_EnUnder             0x00000100 /* 1:Enable Underrun               */
DECL|macro|Tx_EnExDefer
mdefine_line|#define Tx_EnExDefer           0x00000200 /* 1:Enable Excessive Deferral     */
DECL|macro|Tx_EnLCarr
mdefine_line|#define Tx_EnLCarr             0x00000400 /* 1:Enable Lost Carrier           */
DECL|macro|Tx_EnExColl
mdefine_line|#define Tx_EnExColl            0x00000800 /* 1:Enable Excessive Collision    */
DECL|macro|Tx_EnLateColl
mdefine_line|#define Tx_EnLateColl          0x00001000 /* 1:Enable Late Collision         */
DECL|macro|Tx_EnTxPar
mdefine_line|#define Tx_EnTxPar             0x00002000 /* 1:Enable Transmit Parity        */
DECL|macro|Tx_EnComp
mdefine_line|#define Tx_EnComp              0x00004000 /* 1:Enable Completion             */
multiline_comment|/* Tx_Stat bit asign ------------------------------------------------------- */
DECL|macro|Tx_TxColl_MASK
mdefine_line|#define Tx_TxColl_MASK         0x0000000F /* Tx Collision Count              */
DECL|macro|Tx_ExColl
mdefine_line|#define Tx_ExColl              0x00000010 /* Excessive Collision             */
DECL|macro|Tx_TXDefer
mdefine_line|#define Tx_TXDefer             0x00000020 /* Transmit Defered                */
DECL|macro|Tx_Paused
mdefine_line|#define Tx_Paused              0x00000040 /* Transmit Paused                 */
DECL|macro|Tx_IntTx
mdefine_line|#define Tx_IntTx               0x00000080 /* Interrupt on Tx                 */
DECL|macro|Tx_Under
mdefine_line|#define Tx_Under               0x00000100 /* Underrun                        */
DECL|macro|Tx_Defer
mdefine_line|#define Tx_Defer               0x00000200 /* Deferral                        */
DECL|macro|Tx_NCarr
mdefine_line|#define Tx_NCarr               0x00000400 /* No Carrier                      */
DECL|macro|Tx_10Stat
mdefine_line|#define Tx_10Stat              0x00000800 /* 10Mbps Status                   */
DECL|macro|Tx_LateColl
mdefine_line|#define Tx_LateColl            0x00001000 /* Late Collision                  */
DECL|macro|Tx_TxPar
mdefine_line|#define Tx_TxPar               0x00002000 /* Tx Parity Error                 */
DECL|macro|Tx_Comp
mdefine_line|#define Tx_Comp                0x00004000 /* Completion                      */
DECL|macro|Tx_Halted
mdefine_line|#define Tx_Halted              0x00008000 /* Tx Halted                       */
DECL|macro|Tx_SQErr
mdefine_line|#define Tx_SQErr               0x00010000 /* Signal Quality Error(SQE)       */
multiline_comment|/* Rx_Ctl bit asign -------------------------------------------------------- */
DECL|macro|Rx_EnGood
mdefine_line|#define Rx_EnGood              0x00004000 /* 1:Enable Good                   */
DECL|macro|Rx_EnRxPar
mdefine_line|#define Rx_EnRxPar             0x00002000 /* 1:Enable Receive Parity         */
DECL|macro|Rx_EnLongErr
mdefine_line|#define Rx_EnLongErr           0x00000800 /* 1:Enable Long Error             */
DECL|macro|Rx_EnOver
mdefine_line|#define Rx_EnOver              0x00000400 /* 1:Enable OverFlow               */
DECL|macro|Rx_EnCRCErr
mdefine_line|#define Rx_EnCRCErr            0x00000200 /* 1:Enable CRC Error              */
DECL|macro|Rx_EnAlign
mdefine_line|#define Rx_EnAlign             0x00000100 /* 1:Enable Alignment              */
DECL|macro|Rx_IgnoreCRC
mdefine_line|#define Rx_IgnoreCRC           0x00000040 /* 1:Ignore CRC Value              */
DECL|macro|Rx_StripCRC
mdefine_line|#define Rx_StripCRC            0x00000010 /* 1:Strip CRC Value               */
DECL|macro|Rx_ShortEn
mdefine_line|#define Rx_ShortEn             0x00000008 /* 1:Short Enable                  */
DECL|macro|Rx_LongEn
mdefine_line|#define Rx_LongEn              0x00000004 /* 1:Long Enable                   */
DECL|macro|Rx_RxHalt
mdefine_line|#define Rx_RxHalt              0x00000002 /* 1:Receive Halt Request          */
DECL|macro|Rx_RxEn
mdefine_line|#define Rx_RxEn                0x00000001 /* 1:Receive Intrrupt Enable       */
multiline_comment|/* Rx_Stat bit asign ------------------------------------------------------- */
DECL|macro|Rx_Halted
mdefine_line|#define Rx_Halted              0x00008000 /* Rx Halted                       */
DECL|macro|Rx_Good
mdefine_line|#define Rx_Good                0x00004000 /* Rx Good                         */
DECL|macro|Rx_RxPar
mdefine_line|#define Rx_RxPar               0x00002000 /* Rx Parity Error                 */
multiline_comment|/* 0x00001000    not use                         */
DECL|macro|Rx_LongErr
mdefine_line|#define Rx_LongErr             0x00000800 /* Rx Long Error                   */
DECL|macro|Rx_Over
mdefine_line|#define Rx_Over                0x00000400 /* Rx Overflow                     */
DECL|macro|Rx_CRCErr
mdefine_line|#define Rx_CRCErr              0x00000200 /* Rx CRC Error                    */
DECL|macro|Rx_Align
mdefine_line|#define Rx_Align               0x00000100 /* Rx Alignment Error              */
DECL|macro|Rx_10Stat
mdefine_line|#define Rx_10Stat              0x00000080 /* Rx 10Mbps Status                */
DECL|macro|Rx_IntRx
mdefine_line|#define Rx_IntRx               0x00000040 /* Rx Interrupt                    */
DECL|macro|Rx_CtlRecd
mdefine_line|#define Rx_CtlRecd             0x00000020 /* Rx Control Receive              */
DECL|macro|Rx_Stat_Mask
mdefine_line|#define Rx_Stat_Mask           0x0000EFC0 /* Rx All Status Mask              */
multiline_comment|/* Int_En bit asign -------------------------------------------------------- */
DECL|macro|Int_NRAbtEn
mdefine_line|#define Int_NRAbtEn            0x00000800 /* 1:Non-recoverable Abort Enable  */
DECL|macro|Int_TxCtlCmpEn
mdefine_line|#define Int_TxCtlCmpEn         0x00000400 /* 1:Transmit Control Complete Enable */
DECL|macro|Int_DmParErrEn
mdefine_line|#define Int_DmParErrEn         0x00000200 /* 1:DMA Parity Error Enable       */
DECL|macro|Int_DParDEn
mdefine_line|#define Int_DParDEn            0x00000100 /* 1:Data Parity Error Enable      */
DECL|macro|Int_EarNotEn
mdefine_line|#define Int_EarNotEn           0x00000080 /* 1:Early Notify Enable           */
DECL|macro|Int_DParErrEn
mdefine_line|#define Int_DParErrEn          0x00000040 /* 1:Detected Parity Error Enable  */
DECL|macro|Int_SSysErrEn
mdefine_line|#define Int_SSysErrEn          0x00000020 /* 1:Signalled System Error Enable */
DECL|macro|Int_RMasAbtEn
mdefine_line|#define Int_RMasAbtEn          0x00000010 /* 1:Received Master Abort Enable  */
DECL|macro|Int_RTargAbtEn
mdefine_line|#define Int_RTargAbtEn         0x00000008 /* 1:Received Target Abort Enable  */
DECL|macro|Int_STargAbtEn
mdefine_line|#define Int_STargAbtEn         0x00000004 /* 1:Signalled Target Abort Enable */
DECL|macro|Int_BLExEn
mdefine_line|#define Int_BLExEn             0x00000002 /* 1:Buffer List Exhausted Enable  */
DECL|macro|Int_FDAExEn
mdefine_line|#define Int_FDAExEn            0x00000001 /* 1:Free Descriptor Area          */
multiline_comment|/*               Exhausted Enable  */
multiline_comment|/* Int_Src bit asign ------------------------------------------------------- */
DECL|macro|Int_NRabt
mdefine_line|#define Int_NRabt              0x00004000 /* 1:Non Recoverable error         */
DECL|macro|Int_DmParErrStat
mdefine_line|#define Int_DmParErrStat       0x00002000 /* 1:DMA Parity Error &amp; Clear      */
DECL|macro|Int_BLEx
mdefine_line|#define Int_BLEx               0x00001000 /* 1:Buffer List Empty &amp; Clear     */
DECL|macro|Int_FDAEx
mdefine_line|#define Int_FDAEx              0x00000800 /* 1:FDA Empty &amp; Clear             */
DECL|macro|Int_IntNRAbt
mdefine_line|#define Int_IntNRAbt           0x00000400 /* 1:Non Recoverable Abort         */
DECL|macro|Int_IntCmp
mdefine_line|#define&t;Int_IntCmp             0x00000200 /* 1:MAC control packet complete   */
DECL|macro|Int_IntExBD
mdefine_line|#define Int_IntExBD            0x00000100 /* 1:Interrupt Extra BD &amp; Clear    */
DECL|macro|Int_DmParErr
mdefine_line|#define Int_DmParErr           0x00000080 /* 1:DMA Parity Error &amp; Clear      */
DECL|macro|Int_IntEarNot
mdefine_line|#define Int_IntEarNot          0x00000040 /* 1:Receive Data write &amp; Clear    */
DECL|macro|Int_SWInt
mdefine_line|#define Int_SWInt              0x00000020 /* 1:Software request &amp; Clear      */
DECL|macro|Int_IntBLEx
mdefine_line|#define Int_IntBLEx            0x00000010 /* 1:Buffer List Empty &amp; Clear     */
DECL|macro|Int_IntFDAEx
mdefine_line|#define Int_IntFDAEx           0x00000008 /* 1:FDA Empty &amp; Clear             */
DECL|macro|Int_IntPCI
mdefine_line|#define Int_IntPCI             0x00000004 /* 1:PCI controller &amp; Clear        */
DECL|macro|Int_IntMacRx
mdefine_line|#define Int_IntMacRx           0x00000002 /* 1:Rx controller &amp; Clear         */
DECL|macro|Int_IntMacTx
mdefine_line|#define Int_IntMacTx           0x00000001 /* 1:Tx controller &amp; Clear         */
multiline_comment|/* MD_CA bit asign --------------------------------------------------------- */
DECL|macro|MD_CA_PreSup
mdefine_line|#define MD_CA_PreSup           0x00001000 /* 1:Preamble Supress              */
DECL|macro|MD_CA_Busy
mdefine_line|#define MD_CA_Busy             0x00000800 /* 1:Busy (Start Operation)        */
DECL|macro|MD_CA_Wr
mdefine_line|#define MD_CA_Wr               0x00000400 /* 1:Write 0:Read                  */
multiline_comment|/* MII register offsets */
DECL|macro|MII_CONTROL
mdefine_line|#define MII_CONTROL             0x0000
DECL|macro|MII_STATUS
mdefine_line|#define MII_STATUS              0x0001
DECL|macro|MII_PHY_ID0
mdefine_line|#define MII_PHY_ID0             0x0002
DECL|macro|MII_PHY_ID1
mdefine_line|#define MII_PHY_ID1             0x0003
DECL|macro|MII_ANAR
mdefine_line|#define MII_ANAR                0x0004
DECL|macro|MII_ANLPAR
mdefine_line|#define MII_ANLPAR              0x0005
DECL|macro|MII_ANER
mdefine_line|#define MII_ANER                0x0006
multiline_comment|/* MII Control register bit definitions. */
DECL|macro|MIICNTL_FDX
mdefine_line|#define MIICNTL_FDX             0x0100
DECL|macro|MIICNTL_RST_AUTO
mdefine_line|#define MIICNTL_RST_AUTO        0x0200
DECL|macro|MIICNTL_ISOLATE
mdefine_line|#define MIICNTL_ISOLATE         0x0400
DECL|macro|MIICNTL_PWRDWN
mdefine_line|#define MIICNTL_PWRDWN          0x0800
DECL|macro|MIICNTL_AUTO
mdefine_line|#define MIICNTL_AUTO            0x1000
DECL|macro|MIICNTL_SPEED
mdefine_line|#define MIICNTL_SPEED           0x2000
DECL|macro|MIICNTL_LPBK
mdefine_line|#define MIICNTL_LPBK            0x4000
DECL|macro|MIICNTL_RESET
mdefine_line|#define MIICNTL_RESET           0x8000
multiline_comment|/* MII Status register bit significance. */
DECL|macro|MIISTAT_EXT
mdefine_line|#define MIISTAT_EXT             0x0001
DECL|macro|MIISTAT_JAB
mdefine_line|#define MIISTAT_JAB             0x0002
DECL|macro|MIISTAT_LINK
mdefine_line|#define MIISTAT_LINK            0x0004
DECL|macro|MIISTAT_CAN_AUTO
mdefine_line|#define MIISTAT_CAN_AUTO        0x0008
DECL|macro|MIISTAT_FAULT
mdefine_line|#define MIISTAT_FAULT           0x0010
DECL|macro|MIISTAT_AUTO_DONE
mdefine_line|#define MIISTAT_AUTO_DONE       0x0020
DECL|macro|MIISTAT_CAN_T
mdefine_line|#define MIISTAT_CAN_T           0x0800
DECL|macro|MIISTAT_CAN_T_FDX
mdefine_line|#define MIISTAT_CAN_T_FDX       0x1000
DECL|macro|MIISTAT_CAN_TX
mdefine_line|#define MIISTAT_CAN_TX          0x2000
DECL|macro|MIISTAT_CAN_TX_FDX
mdefine_line|#define MIISTAT_CAN_TX_FDX      0x4000
DECL|macro|MIISTAT_CAN_T4
mdefine_line|#define MIISTAT_CAN_T4          0x8000
multiline_comment|/* MII Auto-Negotiation Expansion/RemoteEnd Register Bits */
DECL|macro|MII_AN_TX_FDX
mdefine_line|#define MII_AN_TX_FDX           0x0100
DECL|macro|MII_AN_TX_HDX
mdefine_line|#define MII_AN_TX_HDX           0x0080
DECL|macro|MII_AN_10_FDX
mdefine_line|#define MII_AN_10_FDX           0x0040
DECL|macro|MII_AN_10_HDX
mdefine_line|#define MII_AN_10_HDX           0x0020
multiline_comment|/*&n; * Descriptors&n; */
multiline_comment|/* Frame descripter */
DECL|struct|FDesc
r_struct
id|FDesc
(brace
DECL|member|FDNext
r_volatile
id|__u32
id|FDNext
suffix:semicolon
DECL|member|FDSystem
r_volatile
id|__u32
id|FDSystem
suffix:semicolon
DECL|member|FDStat
r_volatile
id|__u32
id|FDStat
suffix:semicolon
DECL|member|FDCtl
r_volatile
id|__u32
id|FDCtl
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Buffer descripter */
DECL|struct|BDesc
r_struct
id|BDesc
(brace
DECL|member|BuffData
r_volatile
id|__u32
id|BuffData
suffix:semicolon
DECL|member|BDCtl
r_volatile
id|__u32
id|BDCtl
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|FD_ALIGN
mdefine_line|#define FD_ALIGN&t;16
multiline_comment|/* Frame Descripter bit asign ---------------------------------------------- */
DECL|macro|FD_FDLength_MASK
mdefine_line|#define FD_FDLength_MASK       0x0000FFFF /* Length MASK                     */
DECL|macro|FD_BDCnt_MASK
mdefine_line|#define FD_BDCnt_MASK          0x001F0000 /* BD count MASK in FD             */
DECL|macro|FD_FrmOpt_MASK
mdefine_line|#define FD_FrmOpt_MASK         0x7C000000 /* Frame option MASK               */
DECL|macro|FD_FrmOpt_BigEndian
mdefine_line|#define FD_FrmOpt_BigEndian    0x40000000 /* Tx/Rx */
DECL|macro|FD_FrmOpt_IntTx
mdefine_line|#define FD_FrmOpt_IntTx        0x20000000 /* Tx only */
DECL|macro|FD_FrmOpt_NoCRC
mdefine_line|#define FD_FrmOpt_NoCRC        0x10000000 /* Tx only */
DECL|macro|FD_FrmOpt_NoPadding
mdefine_line|#define FD_FrmOpt_NoPadding    0x08000000 /* Tx only */
DECL|macro|FD_FrmOpt_Packing
mdefine_line|#define FD_FrmOpt_Packing      0x04000000 /* Rx only */
DECL|macro|FD_CownsFD
mdefine_line|#define FD_CownsFD             0x80000000 /* FD Controller owner bit         */
DECL|macro|FD_Next_EOL
mdefine_line|#define FD_Next_EOL            0x00000001 /* FD EOL indicator                */
DECL|macro|FD_BDCnt_SHIFT
mdefine_line|#define FD_BDCnt_SHIFT         16
multiline_comment|/* Buffer Descripter bit asign --------------------------------------------- */
DECL|macro|BD_BuffLength_MASK
mdefine_line|#define BD_BuffLength_MASK     0x0000FFFF /* Recieve Data Size               */
DECL|macro|BD_RxBDID_MASK
mdefine_line|#define BD_RxBDID_MASK         0x00FF0000 /* BD ID Number MASK               */
DECL|macro|BD_RxBDSeqN_MASK
mdefine_line|#define BD_RxBDSeqN_MASK       0x7F000000 /* Rx BD Sequence Number           */
DECL|macro|BD_CownsBD
mdefine_line|#define BD_CownsBD             0x80000000 /* BD Controller owner bit         */
DECL|macro|BD_RxBDID_SHIFT
mdefine_line|#define BD_RxBDID_SHIFT        16
DECL|macro|BD_RxBDSeqN_SHIFT
mdefine_line|#define BD_RxBDSeqN_SHIFT      24
multiline_comment|/* Some useful constants. */
DECL|macro|NO_CHECK_CARRIER
macro_line|#undef NO_CHECK_CARRIER&t;/* Does not check No-Carrier with TP */
macro_line|#ifdef NO_CHECK_CARRIER
DECL|macro|TX_CTL_CMD
mdefine_line|#define TX_CTL_CMD&t;(Tx_EnComp | Tx_EnTxPar | Tx_EnLateColl | &bslash;&n;&t;Tx_EnExColl | Tx_EnLCarr | Tx_EnExDefer | Tx_EnUnder | &bslash;&n;&t;Tx_En)&t;/* maybe  0x7d01 */
macro_line|#else
DECL|macro|TX_CTL_CMD
mdefine_line|#define TX_CTL_CMD&t;(Tx_EnComp | Tx_EnTxPar | Tx_EnLateColl | &bslash;&n;&t;Tx_EnExColl | Tx_EnExDefer | Tx_EnUnder | &bslash;&n;&t;Tx_En)&t;/* maybe  0x7f01 */
macro_line|#endif
DECL|macro|RX_CTL_CMD
mdefine_line|#define RX_CTL_CMD&t;(Rx_EnGood | Rx_EnRxPar | Rx_EnLongErr | Rx_EnOver &bslash;&n;&t;| Rx_EnCRCErr | Rx_EnAlign | Rx_RxEn)&t;/* maybe 0x6f01 */
DECL|macro|INT_EN_CMD
mdefine_line|#define INT_EN_CMD  (Int_NRAbtEn | &bslash;&n;&t; Int_DParDEn | Int_DParErrEn | &bslash;&n;&t;Int_SSysErrEn  | Int_RMasAbtEn | Int_RTargAbtEn | &bslash;&n;&t;Int_STargAbtEn | &bslash;&n;&t;Int_BLExEn  | Int_FDAExEn) /* maybe 0xb7f*/
multiline_comment|/* Tuning parameters */
DECL|macro|DMA_BURST_SIZE
mdefine_line|#define DMA_BURST_SIZE&t;32
DECL|macro|TX_THRESHOLD
mdefine_line|#define TX_THRESHOLD&t;1024
DECL|macro|FD_PAGE_NUM
mdefine_line|#define FD_PAGE_NUM 2
DECL|macro|FD_PAGE_ORDER
mdefine_line|#define FD_PAGE_ORDER 1
multiline_comment|/* 16 + RX_BUF_PAGES * 8 + RX_FD_NUM * 16 + TX_FD_NUM * 32 &lt;= PAGE_SIZE*2 */
DECL|macro|RX_BUF_PAGES
mdefine_line|#define RX_BUF_PAGES&t;8&t;/* &gt;= 2 */
DECL|macro|RX_FD_NUM
mdefine_line|#define RX_FD_NUM&t;250&t;/* &gt;= 32 */
DECL|macro|TX_FD_NUM
mdefine_line|#define TX_FD_NUM&t;128
DECL|struct|TxFD
r_struct
id|TxFD
(brace
DECL|member|fd
r_struct
id|FDesc
id|fd
suffix:semicolon
DECL|member|bd
r_struct
id|BDesc
id|bd
suffix:semicolon
DECL|member|unused
r_struct
id|BDesc
id|unused
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|RxFD
r_struct
id|RxFD
(brace
DECL|member|fd
r_struct
id|FDesc
id|fd
suffix:semicolon
DECL|member|bd
r_struct
id|BDesc
id|bd
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* variable length */
)brace
suffix:semicolon
DECL|struct|FrFD
r_struct
id|FrFD
(brace
DECL|member|fd
r_struct
id|FDesc
id|fd
suffix:semicolon
DECL|member|bd
r_struct
id|BDesc
id|bd
(braket
id|RX_BUF_PAGES
)braket
suffix:semicolon
)brace
suffix:semicolon
r_extern
r_int
r_int
id|tc_readl
c_func
(paren
r_volatile
id|__u32
op_star
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|tc_writel
c_func
(paren
r_int
r_int
id|data
comma
r_volatile
id|__u32
op_star
id|addr
)paren
suffix:semicolon
DECL|variable|priv_dma_handle
id|dma_addr_t
id|priv_dma_handle
suffix:semicolon
multiline_comment|/* Information that need to be kept for each board. */
DECL|struct|tc35815_local
r_struct
id|tc35815_local
(brace
DECL|member|next_module
r_struct
id|net_device
op_star
id|next_module
suffix:semicolon
multiline_comment|/* statistics */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
r_struct
(brace
DECL|member|max_tx_qlen
r_int
id|max_tx_qlen
suffix:semicolon
DECL|member|tx_ints
r_int
id|tx_ints
suffix:semicolon
DECL|member|rx_ints
r_int
id|rx_ints
suffix:semicolon
DECL|member|lstats
)brace
id|lstats
suffix:semicolon
DECL|member|tbusy
r_int
id|tbusy
suffix:semicolon
DECL|member|option
r_int
id|option
suffix:semicolon
DECL|macro|TC35815_OPT_AUTO
mdefine_line|#define TC35815_OPT_AUTO&t;0x00
DECL|macro|TC35815_OPT_10M
mdefine_line|#define TC35815_OPT_10M&t;0x01
DECL|macro|TC35815_OPT_100M
mdefine_line|#define TC35815_OPT_100M&t;0x02
DECL|macro|TC35815_OPT_FULLDUP
mdefine_line|#define TC35815_OPT_FULLDUP&t;0x04
DECL|member|linkspeed
r_int
id|linkspeed
suffix:semicolon
multiline_comment|/* 10 or 100 */
DECL|member|fullduplex
r_int
id|fullduplex
suffix:semicolon
multiline_comment|/*&n;&t; * Transmitting: Batch Mode.&n;&t; *&t;1 BD in 1 TxFD.&n;&t; * Receiving: Packing Mode.&n;&t; *&t;1 circular FD for Free Buffer List.&n;&t; *&t;RX_BUG_PAGES BD in Free Buffer FD.&n;&t; *&t;One Free Buffer BD has PAGE_SIZE data buffer.&n;&t; */
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|fd_buf_dma_handle
id|dma_addr_t
id|fd_buf_dma_handle
suffix:semicolon
DECL|member|fd_buf
r_void
op_star
id|fd_buf
suffix:semicolon
multiline_comment|/* for TxFD, TxFD, FrFD */
DECL|member|tfd_base
r_struct
id|TxFD
op_star
id|tfd_base
suffix:semicolon
DECL|member|tfd_start
r_int
id|tfd_start
suffix:semicolon
DECL|member|tfd_end
r_int
id|tfd_end
suffix:semicolon
DECL|member|rfd_base
r_struct
id|RxFD
op_star
id|rfd_base
suffix:semicolon
DECL|member|rfd_limit
r_struct
id|RxFD
op_star
id|rfd_limit
suffix:semicolon
DECL|member|rfd_cur
r_struct
id|RxFD
op_star
id|rfd_cur
suffix:semicolon
DECL|member|fbl_ptr
r_struct
id|FrFD
op_star
id|fbl_ptr
suffix:semicolon
DECL|member|fbl_curid
r_int
r_char
id|fbl_curid
suffix:semicolon
DECL|member|data_buf_dma_handle
id|dma_addr_t
id|data_buf_dma_handle
(braket
id|RX_BUF_PAGES
)braket
suffix:semicolon
DECL|member|data_buf
r_void
op_star
id|data_buf
(braket
id|RX_BUF_PAGES
)braket
suffix:semicolon
multiline_comment|/* packing */
)brace
suffix:semicolon
multiline_comment|/* Index to functions, as function prototypes. */
r_static
r_int
id|__init
id|tc35815_probe1
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
r_int
id|base_addr
comma
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_int
id|tc35815_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tc35815_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|tc35815_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_txdone
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tc35815_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|tc35815_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_chip_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_chip_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|tc35815_phy_chip_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|tc35815_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
suffix:semicolon
multiline_comment|/* A list of all installed tc35815 devices. */
DECL|variable|root_tc35815_dev
r_static
r_struct
id|net_device
op_star
id|root_tc35815_dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n; * PCI device identifiers for &quot;new style&quot; Linux PCI Device Drivers&n; */
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|tc35815_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_TOSHIBA_2
comma
id|PCI_DEVICE_ID_TOSHIBA_TC35815CF
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|pci
comma
id|tc35815_pci_tbl
)paren
suffix:semicolon
r_int
DECL|function|tc35815_probe
id|tc35815_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_static
r_int
id|called
op_assign
l_int|0
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|called
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|called
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pdev
)paren
(brace
r_int
r_int
id|pci_memaddr
suffix:semicolon
r_int
r_int
id|pci_irq_line
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tc35815_probe: found device %#08x.%#08x&bslash;n&quot;
comma
id|ent-&gt;vendor
comma
id|ent-&gt;device
)paren
suffix:semicolon
id|pci_memaddr
op_assign
id|pci_resource_start
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;    pci_memaddr=%#08lx  resource_flags=%#08lx&bslash;n&quot;
comma
id|pci_memaddr
comma
id|pci_resource_flags
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_memaddr
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;no PCI MEM resources, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pci_irq_line
op_assign
id|pdev-&gt;irq
suffix:semicolon
multiline_comment|/* irq disabled. */
r_if
c_cond
(paren
id|pci_irq_line
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;no PCI irq, aborting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ret
op_assign
id|tc35815_probe1
c_func
(paren
id|pdev
comma
id|pci_memaddr
comma
id|pci_irq_line
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;tc35815_probe: failed to enable device -- err=%d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|tc35815_probe1
r_static
r_int
id|__init
id|tc35815_probe1
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_int
r_int
id|base_addr
comma
r_int
r_int
id|irq
)paren
(brace
r_static
r_int
id|version_printed
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|tc35815_local
op_star
id|lp
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
multiline_comment|/* Allocate a new &squot;dev&squot; if needed. */
id|dev
op_assign
id|init_etherdev
c_func
(paren
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
op_logical_and
id|version_printed
op_increment
op_eq
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s&quot;
comma
id|version
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s found at %#x, irq %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cardname
comma
id|base_addr
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/* Fill in the &squot;dev&squot; fields. */
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|base_addr
comma
r_sizeof
(paren
r_struct
id|tc35815_regs
)paren
)paren
suffix:semicolon
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Retrieve and print the ethernet address. */
r_while
c_loop
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;PROM_Ctl
)paren
op_amp
id|PROM_Busy
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|tc_writel
c_func
(paren
id|PROM_Busy
op_or
id|PROM_Read
op_or
(paren
id|i
op_div
l_int|2
op_plus
l_int|2
)paren
comma
op_amp
id|tr-&gt;PROM_Ctl
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;PROM_Ctl
)paren
op_amp
id|PROM_Busy
)paren
suffix:semicolon
id|data
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;PROM_Data
)paren
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|data
op_amp
l_int|0xff
suffix:semicolon
id|dev-&gt;dev_addr
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|data
op_rshift
l_int|8
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2x&quot;
comma
id|dev-&gt;dev_addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Initialize the device structure. */
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
(brace
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|tc35815_local
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|memset
c_func
(paren
id|lp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tc35815_local
)paren
)paren
suffix:semicolon
id|lp-&gt;next_module
op_assign
id|root_tc35815_dev
suffix:semicolon
id|root_tc35815_dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mem_start
OG
l_int|0
)paren
(brace
id|lp-&gt;option
op_assign
id|dev-&gt;mem_start
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_10M
)paren
op_logical_and
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_100M
)paren
)paren
(brace
multiline_comment|/* if both speed speficied, auto select. */
id|lp-&gt;option
op_and_assign
op_complement
(paren
id|TC35815_OPT_10M
op_or
id|TC35815_OPT_100M
)paren
suffix:semicolon
)brace
)brace
singleline_comment|//XXX fixme
id|lp-&gt;option
op_or_assign
id|TC35815_OPT_10M
suffix:semicolon
multiline_comment|/* do auto negotiation */
id|tc35815_phy_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: linkspeed %dMbps, %s Duplex&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;linkspeed
comma
id|lp-&gt;fullduplex
ques
c_cond
l_string|&quot;Full&quot;
suffix:colon
l_string|&quot;Half&quot;
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|tc35815_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|tc35815_close
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|tc35815_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|TX_TIMEOUT
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|tc35815_send_packet
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|tc35815_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|tc35815_set_multicast_list
suffix:semicolon
macro_line|#if 0&t;/* XXX called in init_etherdev */
multiline_comment|/* Fill in the fields of the device structure with ethernet values. */
id|ether_setup
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|tc35815_init_queues
id|tc35815_init_queues
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|fd_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;fd_buf
)paren
(brace
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|FDesc
)paren
op_plus
r_sizeof
(paren
r_struct
id|BDesc
)paren
op_star
id|RX_BUF_PAGES
op_plus
r_sizeof
(paren
r_struct
id|FDesc
)paren
op_star
id|RX_FD_NUM
op_plus
r_sizeof
(paren
r_struct
id|TxFD
)paren
op_star
id|TX_FD_NUM
OG
id|PAGE_SIZE
op_star
id|FD_PAGE_NUM
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Invalid Queue Size.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lp-&gt;fd_buf
op_assign
(paren
r_void
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|FD_PAGE_ORDER
)paren
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_BUF_PAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|lp-&gt;data_buf
(braket
id|i
)braket
op_assign
(paren
r_void
op_star
)paren
id|get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_while
c_loop
(paren
op_decrement
id|i
op_ge
l_int|0
)paren
(brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;data_buf
(braket
id|i
)braket
)paren
suffix:semicolon
id|lp-&gt;data_buf
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;fd_buf
)paren
suffix:semicolon
id|lp-&gt;fd_buf
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef __mips__
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;data_buf
(braket
id|i
)braket
comma
id|PAGE_SIZE
op_star
id|FD_PAGE_NUM
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef __mips__
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;fd_buf
comma
id|PAGE_SIZE
op_star
id|FD_PAGE_NUM
)paren
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|clear_page
c_func
(paren
id|lp-&gt;fd_buf
)paren
suffix:semicolon
macro_line|#ifdef __mips__
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;fd_buf
comma
id|PAGE_SIZE
op_star
id|FD_PAGE_NUM
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef __mips__
id|fd_addr
op_assign
(paren
r_int
r_int
)paren
id|vtonocache
c_func
(paren
id|lp-&gt;fd_buf
)paren
suffix:semicolon
macro_line|#else
id|fd_addr
op_assign
(paren
r_int
r_int
)paren
id|lp-&gt;fd_buf
suffix:semicolon
macro_line|#endif
multiline_comment|/* Free Descriptors (for Receive) */
id|lp-&gt;rfd_base
op_assign
(paren
r_struct
id|RxFD
op_star
)paren
id|fd_addr
suffix:semicolon
id|fd_addr
op_add_assign
r_sizeof
(paren
r_struct
id|RxFD
)paren
op_star
id|RX_FD_NUM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;rfd_base
(braket
id|i
)braket
dot
id|fd.FDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|FD_CownsFD
)paren
suffix:semicolon
)brace
id|lp-&gt;rfd_cur
op_assign
id|lp-&gt;rfd_base
suffix:semicolon
id|lp-&gt;rfd_limit
op_assign
(paren
r_struct
id|RxFD
op_star
)paren
(paren
id|fd_addr
op_minus
r_sizeof
(paren
r_struct
id|FDesc
)paren
op_minus
r_sizeof
(paren
r_struct
id|BDesc
)paren
op_star
l_int|30
)paren
suffix:semicolon
multiline_comment|/* Transmit Descriptors */
id|lp-&gt;tfd_base
op_assign
(paren
r_struct
id|TxFD
op_star
)paren
id|fd_addr
suffix:semicolon
id|fd_addr
op_add_assign
r_sizeof
(paren
r_struct
id|TxFD
)paren
op_star
id|TX_FD_NUM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDNext
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|lp-&gt;tfd_base
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDSystem
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDCtl
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|lp-&gt;tfd_base
(braket
id|TX_FD_NUM
op_minus
l_int|1
)braket
dot
id|fd.FDNext
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
op_amp
id|lp-&gt;tfd_base
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|lp-&gt;tfd_start
op_assign
l_int|0
suffix:semicolon
id|lp-&gt;tfd_end
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Buffer List (for Receive) */
id|lp-&gt;fbl_ptr
op_assign
(paren
r_struct
id|FrFD
op_star
)paren
id|fd_addr
suffix:semicolon
id|lp-&gt;fbl_ptr-&gt;fd.FDNext
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|lp-&gt;fbl_ptr
)paren
)paren
suffix:semicolon
id|lp-&gt;fbl_ptr-&gt;fd.FDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|RX_BUF_PAGES
op_or
id|FD_CownsFD
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_BUF_PAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|lp-&gt;fbl_ptr-&gt;bd
(braket
id|i
)braket
dot
id|BuffData
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|lp-&gt;data_buf
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* BDID is index of FrFD.bd[] */
id|lp-&gt;fbl_ptr-&gt;bd
(braket
id|i
)braket
dot
id|BDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|BD_CownsBD
op_or
(paren
id|i
op_lshift
id|BD_RxBDID_SHIFT
)paren
op_or
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
id|lp-&gt;fbl_curid
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|tc35815_clear_queues
id|tc35815_clear_queues
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDSystem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDSystem
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|tc35815_init_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|tc35815_free_queues
id|tc35815_free_queues
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tfd_base
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDSystem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;tfd_base
(braket
id|i
)braket
dot
id|fd.FDSystem
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|lp-&gt;rfd_base
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;rfd_base
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;rfd_limit
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;rfd_cur
op_assign
l_int|NULL
suffix:semicolon
id|lp-&gt;fbl_ptr
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_BUF_PAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|lp-&gt;data_buf
(braket
id|i
)braket
)paren
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;data_buf
(braket
id|i
)braket
)paren
suffix:semicolon
id|lp-&gt;data_buf
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;fd_buf
)paren
id|__free_pages
c_func
(paren
id|lp-&gt;fd_buf
comma
id|FD_PAGE_ORDER
)paren
suffix:semicolon
id|lp-&gt;fd_buf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
r_void
DECL|function|dump_txfd
id|dump_txfd
c_func
(paren
r_struct
id|TxFD
op_star
id|fd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;TxFD(%p): %08x %08x %08x %08x&bslash;n&quot;
comma
id|fd
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDNext
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDSystem
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDStat
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDCtl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BD: &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08x %08x&quot;
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd.BuffData
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd.BDCtl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|dump_rxfd
id|dump_rxfd
c_func
(paren
r_struct
id|RxFD
op_star
id|fd
)paren
(brace
r_int
id|i
comma
id|bd_count
op_assign
(paren
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDCtl
)paren
op_amp
id|FD_BDCnt_MASK
)paren
op_rshift
id|FD_BDCnt_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|bd_count
OG
l_int|8
)paren
id|bd_count
op_assign
l_int|8
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RxFD(%p): %08x %08x %08x %08x&bslash;n&quot;
comma
id|fd
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDNext
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDSystem
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDStat
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDCtl
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDCtl
)paren
op_amp
id|FD_CownsFD
)paren
r_return
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BD: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bd_count
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %08x %08x&quot;
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd
(braket
id|i
)braket
dot
id|BuffData
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd
(braket
id|i
)braket
dot
id|BDCtl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|bd_count
suffix:semicolon
)brace
r_static
r_void
DECL|function|dump_frfd
id|dump_frfd
c_func
(paren
r_struct
id|FrFD
op_star
id|fd
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FrFD(%p): %08x %08x %08x %08x&bslash;n&quot;
comma
id|fd
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDNext
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDSystem
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDStat
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;fd.FDCtl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BD: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_BUF_PAGES
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %08x %08x&quot;
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd
(braket
id|i
)braket
dot
id|BuffData
)paren
comma
id|le32_to_cpu
c_func
(paren
id|fd-&gt;bd
(braket
id|i
)braket
dot
id|BDCtl
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|panic_queues
id|panic_queues
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;TxFD base %p, start %d, end %d&bslash;n&quot;
comma
id|lp-&gt;tfd_base
comma
id|lp-&gt;tfd_start
comma
id|lp-&gt;tfd_end
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RxFD base %p limit %p cur %p&bslash;n&quot;
comma
id|lp-&gt;rfd_base
comma
id|lp-&gt;rfd_limit
comma
id|lp-&gt;rfd_cur
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FrFD %p&bslash;n&quot;
comma
id|lp-&gt;fbl_ptr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
id|dump_txfd
c_func
(paren
op_amp
id|lp-&gt;tfd_base
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RX_FD_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|bd_count
op_assign
id|dump_rxfd
c_func
(paren
op_amp
id|lp-&gt;rfd_base
(braket
id|i
)braket
)paren
suffix:semicolon
id|i
op_add_assign
(paren
id|bd_count
op_plus
l_int|1
)paren
op_div
l_int|2
suffix:semicolon
multiline_comment|/* skip BDs */
)brace
id|dump_frfd
c_func
(paren
id|lp-&gt;fbl_ptr
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;%s: Illegal queue state.&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|function|print_buf
r_static
r_void
id|print_buf
c_func
(paren
r_char
op_star
id|add
comma
r_int
id|length
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|len
op_assign
id|length
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;print_buf(%08x)(%x)&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|add
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|100
)paren
id|len
op_assign
l_int|100
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
l_int|16
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|print_eth
r_static
r_void
id|print_eth
c_func
(paren
r_char
op_star
id|add
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;print_eth(%08x)&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|add
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
op_plus
l_int|6
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; =&gt;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %2.2X&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; : %2.2X%2.2X&bslash;n&quot;
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|12
)braket
comma
(paren
r_int
r_char
)paren
id|add
(braket
l_int|13
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Open/initialize the board. This is called (in the current kernel)&n; * sometime after booting when the &squot;ifconfig&squot; program is run.&n; *&n; * This routine should set everything up anew at each open, even&n; * registers that &quot;should&quot; only need to be set once at boot, so that&n; * there is non-reboot way to recover if something goes wrong.&n; */
r_static
r_int
DECL|function|tc35815_open
id|tc35815_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/*&n;&t; * This is used if the interrupt line can turned off (shared).&n;&t; * See 3c503.c for an example of selecting the IRQ at config-time.&n;&t; */
r_if
c_cond
(paren
id|dev-&gt;irq
op_eq
l_int|0
op_logical_or
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
op_amp
id|tc35815_interrupt
comma
id|SA_SHIRQ
comma
id|cardname
comma
id|dev
)paren
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_init_queues
c_func
(paren
id|dev
)paren
op_ne
l_int|0
)paren
(brace
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
multiline_comment|/* Reset the hardware here. Don&squot;t forget to set the station address. */
id|tc35815_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tc35815_tx_timeout
r_static
r_void
id|tc35815_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: transmit timed out, status %#x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Tx_Stat
)paren
)paren
suffix:semicolon
multiline_comment|/* Try to restart the adaptor. */
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_clear_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|tc35815_send_packet
r_static
r_int
id|tc35815_send_packet
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * If we get here, some higher level has decided we are broken.&n;&t;&t; * There should really be a &quot;kick me&quot; function call instead.&n;&t;&t; */
r_int
id|tickssofar
op_assign
id|jiffies
op_minus
id|dev-&gt;trans_start
suffix:semicolon
r_if
c_cond
(paren
id|tickssofar
OL
l_int|5
)paren
r_return
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: transmit timed out, status %#x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Tx_Stat
)paren
)paren
suffix:semicolon
multiline_comment|/* Try to restart the adaptor. */
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_clear_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Block a timer-based transmit from overlapping. This could better be&n;&t; * done with atomic_swap(1, lp-&gt;tbusy), but set_bit() works as well.&n;&t; */
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
l_int|0
comma
(paren
r_void
op_star
)paren
op_amp
id|lp-&gt;tbusy
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Transmitter access conflict.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|length
op_assign
id|ETH_ZLEN
OL
id|skb-&gt;len
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
r_int
r_char
op_star
id|buf
op_assign
id|skb-&gt;data
suffix:semicolon
r_struct
id|TxFD
op_star
id|txfd
op_assign
op_amp
id|lp-&gt;tfd_base
(braket
id|lp-&gt;tfd_start
)braket
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
macro_line|#ifdef __mips__
id|dma_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|buf
comma
id|length
)paren
suffix:semicolon
macro_line|#endif
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* failsafe... */
r_if
c_cond
(paren
id|lp-&gt;tfd_start
op_ne
id|lp-&gt;tfd_end
)paren
id|tc35815_txdone
c_func
(paren
id|dev
)paren
suffix:semicolon
id|txfd-&gt;bd.BuffData
op_assign
id|cpu_to_le32
c_func
(paren
id|virt_to_bus
c_func
(paren
id|buf
)paren
)paren
suffix:semicolon
id|txfd-&gt;bd.BDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|length
)paren
suffix:semicolon
id|txfd-&gt;fd.FDSystem
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|__u32
)paren
id|skb
)paren
suffix:semicolon
id|txfd-&gt;fd.FDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|FD_CownsFD
op_or
(paren
l_int|1
op_lshift
id|FD_BDCnt_SHIFT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;tfd_start
op_eq
id|lp-&gt;tfd_end
)paren
(brace
multiline_comment|/* Start DMA Transmitter. */
id|txfd-&gt;fd.FDNext
op_or_assign
id|cpu_to_le32
c_func
(paren
id|FD_Next_EOL
)paren
suffix:semicolon
macro_line|#ifdef GATHER_TXINT
id|txfd-&gt;fd.FDCtl
op_or_assign
id|cpu_to_le32
c_func
(paren
id|FD_FrmOpt_IntTx
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: starting TxFD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dump_txfd
c_func
(paren
id|txfd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|3
)paren
id|print_eth
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
id|tc_writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|txfd
)paren
comma
op_amp
id|tr-&gt;TxFrmPtr
)paren
suffix:semicolon
)brace
r_else
(brace
id|txfd-&gt;fd.FDNext
op_and_assign
id|cpu_to_le32
c_func
(paren
op_complement
id|FD_Next_EOL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: queueing TxFD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dump_txfd
c_func
(paren
id|txfd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|3
)paren
id|print_eth
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
)brace
id|lp-&gt;tfd_start
op_assign
(paren
id|lp-&gt;tfd_start
op_plus
l_int|1
)paren
op_mod
id|TX_FD_NUM
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lp-&gt;tfd_start
op_plus
l_int|1
)paren
op_mod
id|TX_FD_NUM
op_ne
id|lp-&gt;tfd_end
)paren
(brace
multiline_comment|/* we can send another packet */
id|lp-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: TxFD Exhausted.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|FATAL_ERROR_INT
mdefine_line|#define FATAL_ERROR_INT &bslash;&n;&t;(Int_IntPCI | Int_DmParErr | Int_IntNRAbt)
DECL|function|tc35815_fatal_error_interrupt
r_static
r_void
id|tc35815_fatal_error_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|status
)paren
(brace
r_static
r_int
id|count
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Fatal Error Intterrupt (%#x):&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntPCI
)paren
id|printk
c_func
(paren
l_string|&quot; IntPCI&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Int_DmParErr
)paren
id|printk
c_func
(paren
l_string|&quot; DmParErr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntNRAbt
)paren
id|printk
c_func
(paren
l_string|&quot; IntNRAbt&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_increment
OG
l_int|100
)paren
id|panic
c_func
(paren
l_string|&quot;%s: Too many fatal errors.&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Resetting %s...&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cardname
)paren
suffix:semicolon
multiline_comment|/* Try to restart the adaptor. */
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_clear_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tc35815_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The typical workload of the driver:&n; *   Handle the network interface interrupts.&n; */
DECL|function|tc35815_interrupt
r_static
r_void
id|tc35815_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
suffix:semicolon
r_struct
id|tc35815_local
op_star
id|lp
suffix:semicolon
r_int
id|status
comma
id|boguscount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: irq %d for unknown device.&bslash;n&quot;
comma
id|cardname
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_do
(brace
id|status
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Int_Src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|tc_writel
c_func
(paren
id|status
comma
op_amp
id|tr-&gt;Int_Src
)paren
suffix:semicolon
multiline_comment|/* write to clear */
multiline_comment|/* Fatal errors... */
r_if
c_cond
(paren
id|status
op_amp
id|FATAL_ERROR_INT
)paren
(brace
id|tc35815_fatal_error_interrupt
c_func
(paren
id|dev
comma
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* recoverable errors */
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntFDAEx
)paren
(brace
multiline_comment|/* disable FDAEx int. (until we make rooms...) */
id|tc_writel
c_func
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Int_En
)paren
op_amp
op_complement
id|Int_FDAExEn
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Free Descriptor Area Exhausted (%#x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntBLEx
)paren
(brace
multiline_comment|/* disable BLEx int. (until we make rooms...) */
id|tc_writel
c_func
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Int_En
)paren
op_amp
op_complement
id|Int_BLExEn
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Buffer List Exhausted (%#x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntExBD
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Excessive Buffer Descriptiors (%#x).&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|status
)paren
suffix:semicolon
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
)brace
multiline_comment|/* normal notification */
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntMacRx
)paren
(brace
multiline_comment|/* Got a packet(s). */
id|lp-&gt;lstats.rx_ints
op_increment
suffix:semicolon
id|tc35815_rx
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Int_IntMacTx
)paren
(brace
id|lp-&gt;lstats.tx_ints
op_increment
suffix:semicolon
id|tc35815_txdone
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_increment
id|boguscount
OL
l_int|20
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* We have a good packet(s), get it/them out of the buffers. */
r_static
r_void
DECL|function|tc35815_rx
id|tc35815_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|fdctl
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|buf_free_count
op_assign
l_int|0
suffix:semicolon
r_int
id|fd_free_count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|fdctl
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;fd.FDCtl
)paren
)paren
op_amp
id|FD_CownsFD
)paren
)paren
(brace
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;fd.FDStat
)paren
suffix:semicolon
r_int
id|pkt_len
op_assign
id|fdctl
op_amp
id|FD_FDLength_MASK
suffix:semicolon
r_struct
id|RxFD
op_star
id|next_rfd
suffix:semicolon
r_int
id|bd_count
op_assign
(paren
id|fdctl
op_amp
id|FD_BDCnt_MASK
)paren
op_rshift
id|FD_BDCnt_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
id|dump_rxfd
c_func
(paren
id|lp-&gt;rfd_cur
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Rx_Good
)paren
(brace
multiline_comment|/* Malloc up new buffer. */
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
r_int
id|cur_bd
comma
id|offset
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|pkt_len
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_len
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* +2: for reserve */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Memory squeeze, dropping packet.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* 16 bit alignment */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|data
op_assign
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
multiline_comment|/* copy from receive buffer */
id|cur_bd
op_assign
l_int|0
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|offset
OL
id|pkt_len
op_logical_and
id|cur_bd
OL
id|bd_count
)paren
(brace
r_int
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;bd
(braket
id|cur_bd
)braket
dot
id|BDCtl
)paren
op_amp
id|BD_BuffLength_MASK
suffix:semicolon
r_void
op_star
id|rxbuf
op_assign
id|bus_to_virt
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;bd
(braket
id|cur_bd
)braket
dot
id|BuffData
)paren
)paren
suffix:semicolon
macro_line|#ifdef __mips__
id|dma_cache_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|rxbuf
comma
id|len
)paren
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|data
op_plus
id|offset
comma
id|rxbuf
comma
id|len
)paren
suffix:semicolon
id|offset
op_add_assign
id|len
suffix:semicolon
id|cur_bd
op_increment
suffix:semicolon
)brace
singleline_comment|//&t;&t;print_buf(data,pkt_len);
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|3
)paren
id|print_eth
c_func
(paren
id|data
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
r_else
(brace
id|lp-&gt;stats.rx_errors
op_increment
suffix:semicolon
multiline_comment|/* WORKAROUND: LongErr and CRCErr means Overflow. */
r_if
c_cond
(paren
(paren
id|status
op_amp
id|Rx_LongErr
)paren
op_logical_and
(paren
id|status
op_amp
id|Rx_CRCErr
)paren
)paren
(brace
id|status
op_and_assign
op_complement
(paren
id|Rx_LongErr
op_or
id|Rx_CRCErr
)paren
suffix:semicolon
id|status
op_or_assign
id|Rx_Over
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Rx_LongErr
)paren
id|lp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Rx_Over
)paren
id|lp-&gt;stats.rx_fifo_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Rx_CRCErr
)paren
id|lp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Rx_Align
)paren
id|lp-&gt;stats.rx_frame_errors
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bd_count
OG
l_int|0
)paren
(brace
multiline_comment|/* put Free Buffer back to controller */
r_int
id|bdctl
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;bd
(braket
id|bd_count
op_minus
l_int|1
)braket
dot
id|BDCtl
)paren
suffix:semicolon
r_int
r_char
id|id
op_assign
(paren
id|bdctl
op_amp
id|BD_RxBDID_MASK
)paren
op_rshift
id|BD_RxBDID_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ge
id|RX_BUF_PAGES
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: invalid BDID.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|panic_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* free old buffers */
r_while
c_loop
(paren
id|lp-&gt;fbl_curid
op_ne
id|id
)paren
(brace
id|bdctl
op_assign
id|le32_to_cpu
c_func
(paren
id|lp-&gt;fbl_ptr-&gt;bd
(braket
id|lp-&gt;fbl_curid
)braket
dot
id|BDCtl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bdctl
op_amp
id|BD_CownsBD
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Freeing invalid BD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|panic_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* pass BD to controler */
multiline_comment|/* Note: BDLength was modified by chip. */
id|lp-&gt;fbl_ptr-&gt;bd
(braket
id|lp-&gt;fbl_curid
)braket
dot
id|BDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|BD_CownsBD
op_or
(paren
id|lp-&gt;fbl_curid
op_lshift
id|BD_RxBDID_SHIFT
)paren
op_or
id|PAGE_SIZE
)paren
suffix:semicolon
id|lp-&gt;fbl_curid
op_assign
(paren
id|lp-&gt;fbl_curid
op_plus
l_int|1
)paren
op_mod
id|RX_BUF_PAGES
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Entering new FBD %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;fbl_curid
)paren
suffix:semicolon
id|dump_frfd
c_func
(paren
id|lp-&gt;fbl_ptr
)paren
suffix:semicolon
)brace
id|buf_free_count
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* put RxFD back to controller */
id|next_rfd
op_assign
id|bus_to_virt
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|lp-&gt;rfd_cur-&gt;fd.FDNext
)paren
)paren
suffix:semicolon
macro_line|#ifdef __mips__
id|next_rfd
op_assign
(paren
r_struct
id|RxFD
op_star
)paren
id|vtonocache
c_func
(paren
id|next_rfd
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|next_rfd
template_param
id|lp-&gt;rfd_limit
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: RxFD FDNext invalid.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|panic_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|bd_count
op_plus
l_int|1
)paren
op_div
l_int|2
op_plus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* pass FD to controler */
id|lp-&gt;rfd_cur-&gt;fd.FDNext
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0xdeaddead
)paren
suffix:semicolon
multiline_comment|/* for debug */
id|lp-&gt;rfd_cur-&gt;fd.FDCtl
op_assign
id|cpu_to_le32
c_func
(paren
id|FD_CownsFD
)paren
suffix:semicolon
id|lp-&gt;rfd_cur
op_increment
suffix:semicolon
id|fd_free_count
op_increment
suffix:semicolon
)brace
id|lp-&gt;rfd_cur
op_assign
id|next_rfd
suffix:semicolon
)brace
multiline_comment|/* re-enable BL/FDA Exhaust interupts. */
r_if
c_cond
(paren
id|fd_free_count
)paren
(brace
id|tc_writel
c_func
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Int_En
)paren
op_or
id|Int_FDAExEn
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf_free_count
)paren
id|tc_writel
c_func
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Int_En
)paren
op_or
id|Int_BLExEn
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef NO_CHECK_CARRIER
DECL|macro|TX_STA_ERR
mdefine_line|#define TX_STA_ERR&t;(Tx_ExColl|Tx_Under|Tx_Defer|Tx_LateColl|Tx_TxPar|Tx_SQErr)
macro_line|#else
DECL|macro|TX_STA_ERR
mdefine_line|#define TX_STA_ERR&t;(Tx_ExColl|Tx_Under|Tx_Defer|Tx_NCarr|Tx_LateColl|Tx_TxPar|Tx_SQErr)
macro_line|#endif
r_static
r_void
DECL|function|tc35815_check_tx_stat
id|tc35815_check_tx_stat
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|status
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_const
r_char
op_star
id|msg
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* count collisions */
r_if
c_cond
(paren
id|status
op_amp
id|Tx_ExColl
)paren
id|lp-&gt;stats.collisions
op_add_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx_TxColl_MASK
)paren
id|lp-&gt;stats.collisions
op_add_assign
id|status
op_amp
id|Tx_TxColl_MASK
suffix:semicolon
multiline_comment|/* WORKAROUND: ignore LostCrS in full duplex operation */
r_if
c_cond
(paren
id|lp-&gt;fullduplex
)paren
id|status
op_and_assign
op_complement
id|Tx_NCarr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|TX_STA_ERR
)paren
)paren
(brace
multiline_comment|/* no error. */
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lp-&gt;stats.tx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|Tx_ExColl
)paren
(brace
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Excessive Collision.&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Tx_Under
)paren
(brace
id|lp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Tx FIFO Underrun.&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Tx_Defer
)paren
(brace
id|lp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Excessive Deferral.&quot;
suffix:semicolon
)brace
macro_line|#ifndef NO_CHECK_CARRIER
r_if
c_cond
(paren
id|status
op_amp
id|Tx_NCarr
)paren
(brace
id|lp-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Lost Carrier Sense.&quot;
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|status
op_amp
id|Tx_LateColl
)paren
(brace
id|lp-&gt;stats.tx_aborted_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Late Collision.&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Tx_TxPar
)paren
(brace
id|lp-&gt;stats.tx_fifo_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Transmit Parity Error.&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|Tx_SQErr
)paren
(brace
id|lp-&gt;stats.tx_heartbeat_errors
op_increment
suffix:semicolon
id|msg
op_assign
l_string|&quot;Signal Quality Error.&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: %s (%#x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|msg
comma
id|status
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|tc35815_txdone
id|tc35815_txdone
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_struct
id|TxFD
op_star
id|txfd
suffix:semicolon
r_int
r_int
id|fdctl
suffix:semicolon
r_int
id|num_done
op_assign
l_int|0
suffix:semicolon
id|txfd
op_assign
op_amp
id|lp-&gt;tfd_base
(braket
id|lp-&gt;tfd_end
)braket
suffix:semicolon
r_while
c_loop
(paren
id|lp-&gt;tfd_start
op_ne
id|lp-&gt;tfd_end
op_logical_and
op_logical_neg
(paren
(paren
id|fdctl
op_assign
id|le32_to_cpu
c_func
(paren
id|txfd-&gt;fd.FDCtl
)paren
)paren
op_amp
id|FD_CownsFD
)paren
)paren
(brace
r_int
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|txfd-&gt;fd.FDStat
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
r_int
id|fdnext
op_assign
id|le32_to_cpu
c_func
(paren
id|txfd-&gt;fd.FDNext
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: complete TxFD.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dump_txfd
c_func
(paren
id|txfd
)paren
suffix:semicolon
)brace
id|tc35815_check_tx_stat
c_func
(paren
id|dev
comma
id|status
)paren
suffix:semicolon
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
id|le32_to_cpu
c_func
(paren
id|txfd-&gt;fd.FDSystem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|txfd-&gt;fd.FDSystem
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|num_done
op_increment
suffix:semicolon
id|lp-&gt;tfd_end
op_assign
(paren
id|lp-&gt;tfd_end
op_plus
l_int|1
)paren
op_mod
id|TX_FD_NUM
suffix:semicolon
id|txfd
op_assign
op_amp
id|lp-&gt;tfd_base
(braket
id|lp-&gt;tfd_end
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fdnext
op_amp
op_complement
id|FD_Next_EOL
)paren
op_ne
id|virt_to_bus
c_func
(paren
id|txfd
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TxFD FDNext invalid.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|panic_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fdnext
op_amp
id|FD_Next_EOL
)paren
(brace
multiline_comment|/* DMA Transmitter has been stopping... */
r_if
c_cond
(paren
id|lp-&gt;tfd_end
op_ne
id|lp-&gt;tfd_start
)paren
(brace
r_int
id|head
op_assign
(paren
id|lp-&gt;tfd_start
op_plus
id|TX_FD_NUM
op_minus
l_int|1
)paren
op_mod
id|TX_FD_NUM
suffix:semicolon
r_struct
id|TxFD
op_star
id|txhead
op_assign
op_amp
id|lp-&gt;tfd_base
(braket
id|head
)braket
suffix:semicolon
r_int
id|qlen
op_assign
(paren
id|lp-&gt;tfd_start
op_plus
id|TX_FD_NUM
op_minus
id|lp-&gt;tfd_end
)paren
op_mod
id|TX_FD_NUM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|le32_to_cpu
c_func
(paren
id|txfd-&gt;fd.FDCtl
)paren
op_amp
id|FD_CownsFD
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TxFD FDCtl invalid.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|panic_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* log max queue length */
r_if
c_cond
(paren
id|lp-&gt;lstats.max_tx_qlen
OL
id|qlen
)paren
id|lp-&gt;lstats.max_tx_qlen
op_assign
id|qlen
suffix:semicolon
multiline_comment|/* start DMA Transmitter again */
id|txhead-&gt;fd.FDNext
op_or_assign
id|cpu_to_le32
c_func
(paren
id|FD_Next_EOL
)paren
suffix:semicolon
macro_line|#ifdef GATHER_TXINT
id|txhead-&gt;fd.FDCtl
op_or_assign
id|cpu_to_le32
c_func
(paren
id|FD_FrmOpt_IntTx
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: start TxFD on queue.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dump_txfd
c_func
(paren
id|txfd
)paren
suffix:semicolon
)brace
id|tc_writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|txfd
)paren
comma
op_amp
id|tr-&gt;TxFrmPtr
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|num_done
OG
l_int|0
op_logical_and
id|lp-&gt;tbusy
)paren
(brace
id|lp-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* The inverse routine to tc35815_open(). */
r_static
r_int
DECL|function|tc35815_close
id|tc35815_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|lp-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* Flush the Tx and disable Rx here. */
id|tc35815_chip_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|tc35815_free_queues
c_func
(paren
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the current statistics.&n; * This may be called with the card open or closed.&n; */
DECL|function|tc35815_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|tc35815_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* Update the statistics from the device registers. */
id|lp-&gt;stats.rx_missed_errors
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Miss_Cnt
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
DECL|function|tc35815_set_cam_entry
r_static
r_void
id|tc35815_set_cam_entry
c_func
(paren
r_struct
id|tc35815_regs
op_star
id|tr
comma
r_int
id|index
comma
r_int
r_char
op_star
id|addr
)paren
(brace
r_int
id|cam_index
op_assign
id|index
op_star
l_int|6
suffix:semicolon
r_int
r_int
id|cam_data
suffix:semicolon
r_int
r_int
id|saved_addr
suffix:semicolon
id|saved_addr
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|1
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: CAM %d:&quot;
comma
id|cardname
comma
id|index
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index
op_amp
l_int|1
)paren
(brace
multiline_comment|/* read modify write */
id|tc_writel
c_func
(paren
id|cam_index
op_minus
l_int|2
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
id|cam_data
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;CAM_Data
)paren
op_amp
l_int|0xffff0000
suffix:semicolon
id|cam_data
op_or_assign
id|addr
(braket
l_int|0
)braket
op_lshift
l_int|8
op_or
id|addr
(braket
l_int|1
)braket
suffix:semicolon
id|tc_writel
c_func
(paren
id|cam_data
comma
op_amp
id|tr-&gt;CAM_Data
)paren
suffix:semicolon
multiline_comment|/* write whole word */
id|tc_writel
c_func
(paren
id|cam_index
op_plus
l_int|2
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
id|cam_data
op_assign
(paren
id|addr
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|addr
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|addr
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|addr
(braket
l_int|5
)braket
suffix:semicolon
id|tc_writel
c_func
(paren
id|cam_data
comma
op_amp
id|tr-&gt;CAM_Data
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* write whole word */
id|tc_writel
c_func
(paren
id|cam_index
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
id|cam_data
op_assign
(paren
id|addr
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|addr
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|addr
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|addr
(braket
l_int|3
)braket
suffix:semicolon
id|tc_writel
c_func
(paren
id|cam_data
comma
op_amp
id|tr-&gt;CAM_Data
)paren
suffix:semicolon
multiline_comment|/* read modify write */
id|tc_writel
c_func
(paren
id|cam_index
op_plus
l_int|4
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
id|cam_data
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;CAM_Data
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
id|cam_data
op_or_assign
id|addr
(braket
l_int|4
)braket
op_lshift
l_int|24
op_or
(paren
id|addr
(braket
l_int|5
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|cam_data
comma
op_amp
id|tr-&gt;CAM_Data
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tc35815_debug
OG
l_int|2
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|cam_index
op_div
l_int|4
suffix:semicolon
id|i
OL
id|cam_index
op_div
l_int|4
op_plus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tc_writel
c_func
(paren
id|i
op_star
l_int|4
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CAM 0x%x: %08x&quot;
comma
id|i
op_star
l_int|4
comma
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;CAM_Data
)paren
)paren
suffix:semicolon
)brace
)brace
id|tc_writel
c_func
(paren
id|saved_addr
comma
op_amp
id|tr-&gt;CAM_Adr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set or clear the multicast filter for this adaptor.&n; * num_addrs == -1&t;Promiscuous mode, receive all packets&n; * num_addrs == 0&t;Normal mode, clear multicast list&n; * num_addrs &gt; 0&t;Multicast mode, receive normal and MC packets,&n; *&t;&t;&t;and do best-effort filtering.&n; */
r_static
r_void
DECL|function|tc35815_set_multicast_list
id|tc35815_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Enable promiscuous mode */
id|tc_writel
c_func
(paren
id|CAM_CompEn
op_or
id|CAM_BroadAcc
op_or
id|CAM_GroupAcc
op_or
id|CAM_StationAcc
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
op_logical_or
id|dev-&gt;mc_count
OG
id|CAM_ENTRY_MAX
op_minus
l_int|3
)paren
(brace
multiline_comment|/* CAM 0, 1, 20 are reserved. */
multiline_comment|/* Disable promiscuous mode, use normal mode. */
id|tc_writel
c_func
(paren
id|CAM_CompEn
op_or
id|CAM_BroadAcc
op_or
id|CAM_GroupAcc
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
)paren
(brace
r_struct
id|dev_mc_list
op_star
id|cur_addr
op_assign
id|dev-&gt;mc_list
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ena_bits
op_assign
id|CAM_Ena_Bit
c_func
(paren
id|CAM_ENTRY_SOURCE
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
multiline_comment|/* Walk the address list, and load the filter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|cur_addr
op_assign
id|cur_addr-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cur_addr
)paren
r_break
suffix:semicolon
multiline_comment|/* entry 0,1 is reserved. */
id|tc35815_set_cam_entry
c_func
(paren
id|tr
comma
id|i
op_plus
l_int|2
comma
id|cur_addr-&gt;dmi_addr
)paren
suffix:semicolon
id|ena_bits
op_or_assign
id|CAM_Ena_Bit
c_func
(paren
id|i
op_plus
l_int|2
)paren
suffix:semicolon
)brace
id|tc_writel
c_func
(paren
id|ena_bits
comma
op_amp
id|tr-&gt;CAM_Ena
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|CAM_CompEn
op_or
id|CAM_BroadAcc
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
)brace
r_else
(brace
id|tc_writel
c_func
(paren
id|CAM_Ena_Bit
c_func
(paren
id|CAM_ENTRY_SOURCE
)paren
comma
op_amp
id|tr-&gt;CAM_Ena
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|CAM_CompEn
op_or
id|CAM_BroadAcc
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
)brace
)brace
DECL|function|tc_phy_read
r_static
r_int
r_int
id|tc_phy_read
c_func
(paren
r_struct
id|tc35815_regs
op_star
id|tr
comma
r_int
id|phy
comma
r_int
id|phy_reg
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|MD_CA_Busy
op_or
(paren
id|phy
op_lshift
l_int|5
)paren
op_or
id|phy_reg
comma
op_amp
id|tr-&gt;MD_CA
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;MD_CA
)paren
op_amp
id|MD_CA_Busy
)paren
suffix:semicolon
id|data
op_assign
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;MD_Data
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|tc_phy_write
r_static
r_void
id|tc_phy_write
c_func
(paren
r_int
r_int
id|d
comma
r_struct
id|tc35815_regs
op_star
id|tr
comma
r_int
id|phy
comma
r_int
id|phy_reg
)paren
(brace
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|d
comma
op_amp
id|tr-&gt;MD_Data
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|MD_CA_Busy
op_or
id|MD_CA_Wr
op_or
(paren
id|phy
op_lshift
l_int|5
)paren
op_or
id|phy_reg
comma
op_amp
id|tr-&gt;MD_CA
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;MD_CA
)paren
op_amp
id|MD_CA_Busy
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|tc35815_phy_chip_init
r_static
r_void
id|tc35815_phy_chip_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_static
r_int
id|first
op_assign
l_int|1
suffix:semicolon
r_int
r_int
id|ctl
suffix:semicolon
r_if
c_cond
(paren
id|first
)paren
(brace
r_int
r_int
id|id0
comma
id|id1
suffix:semicolon
r_int
id|count
suffix:semicolon
id|first
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* first data written to the PHY will be an ID number */
id|tc_phy_write
c_func
(paren
l_int|0
comma
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
suffix:semicolon
multiline_comment|/* ID:0 */
macro_line|#if 0
id|tc_phy_write
c_func
(paren
id|MIICNTL_RESET
comma
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Resetting PHY...&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tc_phy_read
c_func
(paren
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
op_amp
id|MIICNTL_RESET
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|tc_phy_write
c_func
(paren
id|MIICNTL_AUTO
op_or
id|MIICNTL_SPEED
op_or
id|MIICNTL_FDX
comma
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
suffix:semicolon
macro_line|#endif
id|id0
op_assign
id|tc_phy_read
c_func
(paren
id|tr
comma
l_int|0
comma
id|MII_PHY_ID0
)paren
suffix:semicolon
id|id1
op_assign
id|tc_phy_read
c_func
(paren
id|tr
comma
l_int|0
comma
id|MII_PHY_ID1
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: PHY ID %04x %04x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|id0
comma
id|id1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_10M
)paren
(brace
id|lp-&gt;linkspeed
op_assign
l_int|10
suffix:semicolon
id|lp-&gt;fullduplex
op_assign
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_FULLDUP
)paren
op_ne
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_100M
)paren
(brace
id|lp-&gt;linkspeed
op_assign
l_int|100
suffix:semicolon
id|lp-&gt;fullduplex
op_assign
(paren
id|lp-&gt;option
op_amp
id|TC35815_OPT_FULLDUP
)paren
op_ne
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* auto negotiation */
r_int
r_int
id|neg_result
suffix:semicolon
id|tc_phy_write
c_func
(paren
id|MIICNTL_AUTO
op_or
id|MIICNTL_RST_AUTO
comma
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Auto Negotiation...&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|tc_phy_read
c_func
(paren
id|tr
comma
l_int|0
comma
id|MII_STATUS
)paren
op_amp
id|MIISTAT_AUTO_DONE
)paren
)paren
(brace
r_if
c_cond
(paren
id|count
op_increment
OG
l_int|5000
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; failed. Assume 10Mbps&bslash;n&quot;
)paren
suffix:semicolon
id|lp-&gt;linkspeed
op_assign
l_int|10
suffix:semicolon
id|lp-&gt;fullduplex
op_assign
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_mod
l_int|512
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; done.&bslash;n&quot;
)paren
suffix:semicolon
id|neg_result
op_assign
id|tc_phy_read
c_func
(paren
id|tr
comma
l_int|0
comma
id|MII_ANLPAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|neg_result
op_amp
(paren
id|MII_AN_TX_FDX
op_or
id|MII_AN_TX_HDX
)paren
)paren
id|lp-&gt;linkspeed
op_assign
l_int|100
suffix:semicolon
r_else
id|lp-&gt;linkspeed
op_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|neg_result
op_amp
(paren
id|MII_AN_TX_FDX
op_or
id|MII_AN_10_FDX
)paren
)paren
id|lp-&gt;fullduplex
op_assign
l_int|1
suffix:semicolon
r_else
id|lp-&gt;fullduplex
op_assign
l_int|0
suffix:semicolon
id|done
suffix:colon
suffix:semicolon
)brace
)brace
id|ctl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;linkspeed
op_eq
l_int|100
)paren
id|ctl
op_or_assign
id|MIICNTL_SPEED
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;fullduplex
)paren
id|ctl
op_or_assign
id|MIICNTL_FDX
suffix:semicolon
id|tc_phy_write
c_func
(paren
id|ctl
comma
id|tr
comma
l_int|0
comma
id|MII_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;fullduplex
)paren
(brace
id|tc_writel
c_func
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;MAC_Ctl
)paren
op_or
id|MAC_FullDup
comma
op_amp
id|tr-&gt;MAC_Ctl
)paren
suffix:semicolon
)brace
)brace
DECL|function|tc35815_chip_reset
r_static
r_void
id|tc35815_chip_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
multiline_comment|/* reset the controller */
id|tc_writel
c_func
(paren
id|MAC_Reset
comma
op_amp
id|tr-&gt;MAC_Ctl
)paren
suffix:semicolon
r_while
c_loop
(paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;MAC_Ctl
)paren
op_amp
id|MAC_Reset
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;MAC_Ctl
)paren
suffix:semicolon
multiline_comment|/* initialize registers to default value */
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;DMA_Ctl
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;TxThrsh
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;TxPollCtr
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;RxFragSize
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;FDA_Bas
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;FDA_Lim
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|tr-&gt;Int_Src
)paren
suffix:semicolon
multiline_comment|/* Write 1 to clear */
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;Tx_Ctl
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;Rx_Ctl
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;CAM_Ena
)paren
suffix:semicolon
(paren
r_void
)paren
id|tc_readl
c_func
(paren
op_amp
id|tr-&gt;Miss_Cnt
)paren
suffix:semicolon
multiline_comment|/* Read to clear */
)brace
DECL|function|tc35815_chip_init
r_static
r_void
id|tc35815_chip_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|tc35815_regs
op_star
id|tr
op_assign
(paren
r_struct
id|tc35815_regs
op_star
)paren
id|dev-&gt;base_addr
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_int
r_int
id|txctl
op_assign
id|TX_CTL_CMD
suffix:semicolon
id|tc35815_phy_chip_init
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* load station address to CAM */
id|tc35815_set_cam_entry
c_func
(paren
id|tr
comma
id|CAM_ENTRY_SOURCE
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
multiline_comment|/* Enable CAM (broadcast and unicast) */
id|tc_writel
c_func
(paren
id|CAM_Ena_Bit
c_func
(paren
id|CAM_ENTRY_SOURCE
)paren
comma
op_amp
id|tr-&gt;CAM_Ena
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|CAM_CompEn
op_or
id|CAM_BroadAcc
comma
op_amp
id|tr-&gt;CAM_Ctl
)paren
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|DMA_BURST_SIZE
comma
op_amp
id|tr-&gt;DMA_Ctl
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|RxFrag_EnPack
op_or
id|ETH_ZLEN
comma
op_amp
id|tr-&gt;RxFragSize
)paren
suffix:semicolon
multiline_comment|/* Packing */
id|tc_writel
c_func
(paren
l_int|0
comma
op_amp
id|tr-&gt;TxPollCtr
)paren
suffix:semicolon
multiline_comment|/* Batch mode */
id|tc_writel
c_func
(paren
id|TX_THRESHOLD
comma
op_amp
id|tr-&gt;TxThrsh
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
id|INT_EN_CMD
comma
op_amp
id|tr-&gt;Int_En
)paren
suffix:semicolon
multiline_comment|/* set queues */
id|tc_writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|lp-&gt;rfd_base
)paren
comma
op_amp
id|tr-&gt;FDA_Bas
)paren
suffix:semicolon
id|tc_writel
c_func
(paren
(paren
r_int
r_int
)paren
id|lp-&gt;rfd_limit
op_minus
(paren
r_int
r_int
)paren
id|lp-&gt;rfd_base
comma
op_amp
id|tr-&gt;FDA_Lim
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Activation method:&n;&t; * First, enable eht MAC Transmitter and the DMA Receive circuits.&n;&t; * Then enable the DMA Transmitter and the MAC Receive circuits.&n;&t; */
id|tc_writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|lp-&gt;fbl_ptr
)paren
comma
op_amp
id|tr-&gt;BLFrmPtr
)paren
suffix:semicolon
multiline_comment|/* start DMA receiver */
id|tc_writel
c_func
(paren
id|RX_CTL_CMD
comma
op_amp
id|tr-&gt;Rx_Ctl
)paren
suffix:semicolon
multiline_comment|/* start MAC receiver */
multiline_comment|/* start MAC transmitter */
multiline_comment|/* WORKAROUND: ignore LostCrS in full duplex operation */
r_if
c_cond
(paren
id|lp-&gt;fullduplex
)paren
id|txctl
op_assign
id|TX_CTL_CMD
op_amp
op_complement
id|Tx_EnLCarr
suffix:semicolon
macro_line|#ifdef GATHER_TXINT
id|txctl
op_and_assign
op_complement
id|Tx_EnComp
suffix:semicolon
multiline_comment|/* disable global tx completion int. */
macro_line|#endif
id|tc_writel
c_func
(paren
id|txctl
comma
op_amp
id|tr-&gt;Tx_Ctl
)paren
suffix:semicolon
macro_line|#if 0&t;/* No need to polling */
id|tc_writel
c_func
(paren
id|virt_to_bus
c_func
(paren
id|lp-&gt;tfd_base
)paren
comma
op_amp
id|tr-&gt;TxFrmPtr
)paren
suffix:semicolon
multiline_comment|/* start DMA transmitter */
macro_line|#endif
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|tc35815_proc_info
r_static
r_int
id|tc35815_proc_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;TC35815 statistics:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|root_tc35815_dev
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
(paren
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|next_module
)paren
(brace
r_struct
id|tc35815_local
op_star
id|lp
op_assign
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%s: tx_ints %d, rx_ints %d, max_tx_qlen %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|lp-&gt;lstats.tx_ints
comma
id|lp-&gt;lstats.rx_ints
comma
id|lp-&gt;lstats.max_tx_qlen
)paren
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
r_break
suffix:semicolon
)brace
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* XXX */
r_void
DECL|function|tc35815_killall
id|tc35815_killall
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|root_tc35815_dev
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
(paren
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|next_module
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_UP
)paren
(brace
id|dev
op_member_access_from_pointer
id|stop
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|variable|tc35815_driver
r_static
r_struct
id|pci_driver
id|tc35815_driver
op_assign
(brace
id|name
suffix:colon
id|TC35815_MODULE_NAME
comma
id|probe
suffix:colon
id|tc35815_probe
comma
id|remove
suffix:colon
l_int|NULL
comma
id|id_table
suffix:colon
id|tc35815_pci_tbl
comma
)brace
suffix:semicolon
DECL|function|tc35815_init_module
r_static
r_int
id|__init
id|tc35815_init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|tc35815_driver
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tc35815_cleanup_module
r_static
r_void
id|__exit
id|tc35815_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|net_device
op_star
id|next_dev
suffix:semicolon
multiline_comment|/* No need to check MOD_IN_USE, as sys_delete_module() checks. */
r_while
c_loop
(paren
id|root_tc35815_dev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|root_tc35815_dev
suffix:semicolon
id|next_dev
op_assign
(paren
(paren
r_struct
id|tc35815_local
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|next_module
suffix:semicolon
id|kfree
c_func
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|dev-&gt;base_addr
)paren
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|root_tc35815_dev
op_assign
id|next_dev
suffix:semicolon
)brace
)brace
DECL|variable|tc35815_init_module
id|module_init
c_func
(paren
id|tc35815_init_module
)paren
suffix:semicolon
DECL|variable|tc35815_cleanup_module
id|module_exit
c_func
(paren
id|tc35815_cleanup_module
)paren
suffix:semicolon
eof
