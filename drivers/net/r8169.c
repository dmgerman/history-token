multiline_comment|/*&n;=========================================================================&n; r8169.c: A RealTek RTL-8169 Gigabit Ethernet driver for Linux kernel 2.4.x.&n; --------------------------------------------------------------------&n;&n; History:&n; Feb  4 2002&t;- created initially by ShuChen &lt;shuchen@realtek.com.tw&gt;.&n; May 20 2002&t;- Add link status force-mode and TBI mode support.&n;=========================================================================&n;  1. The media can be forced in 5 modes.&n;&t; Command: &squot;insmod r8169 media = SET_MEDIA&squot;&n;&t; Ex:&t;  &squot;insmod r8169 media = 0x04&squot; will force PHY to operate in 100Mpbs Half-duplex.&n;&t;&n;&t; SET_MEDIA can be:&n; &t;&t;_10_Half&t;= 0x01&n; &t;&t;_10_Full&t;= 0x02&n; &t;&t;_100_Half&t;= 0x04&n; &t;&t;_100_Full&t;= 0x08&n; &t;&t;_1000_Full&t;= 0x10&n;  &n;  2. Support TBI mode.&n;=========================================================================&n;VERSION 1.1&t;&lt;2002/10/4&gt;&n;&n;&t;The bit4:0 of MII register 4 is called &quot;selector field&quot;, and have to be&n;&t;00001b to indicate support of IEEE std 802.3 during NWay process of&n;&t;exchanging Link Code Word (FLP). &n;&n;VERSION 1.2&t;&lt;2002/11/30&gt;&n;&n;&t;- Large style cleanup&n;&t;- Use ether_crc in stock kernel (linux/crc32.h)&n;&t;- Copy mc_filter setup code from 8139cp&n;&t;  (includes an optimization, and avoids set_bit use)&n;&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/ethtool.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|RTL8169_VERSION
mdefine_line|#define RTL8169_VERSION &quot;1.2&quot;
DECL|macro|MODULENAME
mdefine_line|#define MODULENAME &quot;r8169&quot;
DECL|macro|RTL8169_DRIVER_NAME
mdefine_line|#define RTL8169_DRIVER_NAME   MODULENAME &quot; Gigabit Ethernet driver &quot; RTL8169_VERSION
DECL|macro|PFX
mdefine_line|#define PFX MODULENAME &quot;: &quot;
macro_line|#ifdef RTL8169_DEBUG
DECL|macro|assert
mdefine_line|#define assert(expr) &bslash;&n;        if(!(expr)) {&t;&t;&t;&t;&t;&bslash;&n;&t;        printk( &quot;Assertion failed! %s,%s,%s,line=%d&bslash;n&quot;,&t;&bslash;&n;        &t;#expr,__FILE__,__FUNCTION__,__LINE__);&t;&t;&bslash;&n;        }
DECL|macro|dprintk
mdefine_line|#define dprintk(fmt, args...)&t;do { printk(PFX fmt, ## args) } while (0)
macro_line|#else
DECL|macro|assert
mdefine_line|#define assert(expr) do {} while (0)
DECL|macro|dprintk
mdefine_line|#define dprintk(fmt, args...)&t;do {} while (0)
macro_line|#endif /* RTL8169_DEBUG */
multiline_comment|/* media options */
DECL|macro|MAX_UNITS
mdefine_line|#define MAX_UNITS 8
DECL|variable|media
r_static
r_int
id|media
(braket
id|MAX_UNITS
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Maximum events (Rx packets, etc.) to handle at each interrupt. */
DECL|variable|max_interrupt_work
r_static
r_int
id|max_interrupt_work
op_assign
l_int|20
suffix:semicolon
multiline_comment|/* Maximum number of multicast addresses to filter (vs. Rx-all-multicast).&n;   The RTL chips use a 64 element hash table based on the Ethernet CRC.  */
DECL|variable|multicast_filter_limit
r_static
r_int
id|multicast_filter_limit
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* MAC address length*/
DECL|macro|MAC_ADDR_LEN
mdefine_line|#define MAC_ADDR_LEN&t;6
multiline_comment|/* max supported gigabit ethernet frame size -- must be at least (dev-&gt;mtu+14+4).*/
DECL|macro|MAX_ETH_FRAME_SIZE
mdefine_line|#define MAX_ETH_FRAME_SIZE&t;1536
DECL|macro|TX_FIFO_THRESH
mdefine_line|#define TX_FIFO_THRESH 256&t;/* In bytes */
DECL|macro|RX_FIFO_THRESH
mdefine_line|#define RX_FIFO_THRESH&t;7&t;/* 7 means NO threshold, Rx buffer level before first PCI xfer.  */
DECL|macro|RX_DMA_BURST
mdefine_line|#define RX_DMA_BURST&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|TX_DMA_BURST
mdefine_line|#define TX_DMA_BURST&t;6&t;/* Maximum PCI burst, &squot;6&squot; is 1024 */
DECL|macro|EarlyTxThld
mdefine_line|#define EarlyTxThld &t;0x3F&t;/* 0x3F means NO early transmit */
DECL|macro|RxPacketMaxSize
mdefine_line|#define RxPacketMaxSize&t;0x0800&t;/* Maximum size supported is 16K-1 */
DECL|macro|InterFrameGap
mdefine_line|#define InterFrameGap&t;0x03&t;/* 3 means InterFrameGap = the shortest one */
DECL|macro|NUM_TX_DESC
mdefine_line|#define NUM_TX_DESC&t;64&t;/* Number of Tx descriptor registers */
DECL|macro|NUM_RX_DESC
mdefine_line|#define NUM_RX_DESC&t;64&t;/* Number of Rx descriptor registers */
DECL|macro|RX_BUF_SIZE
mdefine_line|#define RX_BUF_SIZE&t;1536&t;/* Rx Buffer size */
DECL|macro|R8169_TX_RING_BYTES
mdefine_line|#define R8169_TX_RING_BYTES&t;(NUM_TX_DESC * sizeof(struct TxDesc))
DECL|macro|R8169_RX_RING_BYTES
mdefine_line|#define R8169_RX_RING_BYTES&t;(NUM_RX_DESC * sizeof(struct RxDesc))
DECL|macro|RTL_MIN_IO_SIZE
mdefine_line|#define RTL_MIN_IO_SIZE 0x80
DECL|macro|RTL8169_TX_TIMEOUT
mdefine_line|#define RTL8169_TX_TIMEOUT&t;(6*HZ)
DECL|macro|RTL8169_PHY_TIMEOUT
mdefine_line|#define RTL8169_PHY_TIMEOUT&t;(HZ) 
multiline_comment|/* write/read MMIO register */
DECL|macro|RTL_W8
mdefine_line|#define RTL_W8(reg, val8)&t;writeb ((val8), ioaddr + (reg))
DECL|macro|RTL_W16
mdefine_line|#define RTL_W16(reg, val16)&t;writew ((val16), ioaddr + (reg))
DECL|macro|RTL_W32
mdefine_line|#define RTL_W32(reg, val32)&t;writel ((val32), ioaddr + (reg))
DECL|macro|RTL_R8
mdefine_line|#define RTL_R8(reg)&t;&t;readb (ioaddr + (reg))
DECL|macro|RTL_R16
mdefine_line|#define RTL_R16(reg)&t;&t;readw (ioaddr + (reg))
DECL|macro|RTL_R32
mdefine_line|#define RTL_R32(reg)&t;&t;((unsigned long) readl (ioaddr + (reg)))
DECL|enum|mac_version
r_enum
id|mac_version
(brace
DECL|enumerator|RTL_GIGA_MAC_VER_B
id|RTL_GIGA_MAC_VER_B
op_assign
l_int|0x00
comma
multiline_comment|/* RTL_GIGA_MAC_VER_C = 0x03, */
DECL|enumerator|RTL_GIGA_MAC_VER_D
id|RTL_GIGA_MAC_VER_D
op_assign
l_int|0x01
comma
DECL|enumerator|RTL_GIGA_MAC_VER_E
id|RTL_GIGA_MAC_VER_E
op_assign
l_int|0x02
)brace
suffix:semicolon
DECL|enum|phy_version
r_enum
id|phy_version
(brace
DECL|enumerator|RTL_GIGA_PHY_VER_C
id|RTL_GIGA_PHY_VER_C
op_assign
l_int|0x03
comma
multiline_comment|/* PHY Reg 0x03 bit0-3 == 0x0000 */
DECL|enumerator|RTL_GIGA_PHY_VER_D
id|RTL_GIGA_PHY_VER_D
op_assign
l_int|0x04
comma
multiline_comment|/* PHY Reg 0x03 bit0-3 == 0x0000 */
DECL|enumerator|RTL_GIGA_PHY_VER_E
id|RTL_GIGA_PHY_VER_E
op_assign
l_int|0x05
comma
multiline_comment|/* PHY Reg 0x03 bit0-3 == 0x0000 */
DECL|enumerator|RTL_GIGA_PHY_VER_F
id|RTL_GIGA_PHY_VER_F
op_assign
l_int|0x06
comma
multiline_comment|/* PHY Reg 0x03 bit0-3 == 0x0001 */
DECL|enumerator|RTL_GIGA_PHY_VER_G
id|RTL_GIGA_PHY_VER_G
op_assign
l_int|0x07
comma
multiline_comment|/* PHY Reg 0x03 bit0-3 == 0x0002 */
)brace
suffix:semicolon
DECL|macro|_R
mdefine_line|#define _R(NAME,MAC,MASK) &bslash;&n;&t;{ .name = NAME, .mac_version = MAC, .RxConfigMask = MASK }
r_const
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|mac_version
id|u8
id|mac_version
suffix:semicolon
DECL|member|RxConfigMask
id|u32
id|RxConfigMask
suffix:semicolon
multiline_comment|/* Clears the bits supported by this chip */
DECL|variable|rtl_chip_info
)brace
id|rtl_chip_info
(braket
)braket
op_assign
(brace
id|_R
c_func
(paren
l_string|&quot;RTL8169&quot;
comma
id|RTL_GIGA_MAC_VER_B
comma
l_int|0xff7e1880
)paren
comma
id|_R
c_func
(paren
l_string|&quot;RTL8169s/8110s&quot;
comma
id|RTL_GIGA_MAC_VER_D
comma
l_int|0xff7e1880
)paren
comma
id|_R
c_func
(paren
l_string|&quot;RTL8169s/8110s&quot;
comma
id|RTL_GIGA_MAC_VER_E
comma
l_int|0xff7e1880
)paren
)brace
suffix:semicolon
DECL|macro|_R
macro_line|#undef _R
DECL|variable|rtl8169_pci_tbl
r_static
r_struct
id|pci_device_id
id|rtl8169_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x10ec
comma
l_int|0x8169
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|rtl8169_pci_tbl
)paren
suffix:semicolon
DECL|variable|rx_copybreak
r_static
r_int
id|rx_copybreak
op_assign
l_int|200
suffix:semicolon
DECL|enum|RTL8169_registers
r_enum
id|RTL8169_registers
(brace
DECL|enumerator|MAC0
id|MAC0
op_assign
l_int|0
comma
multiline_comment|/* Ethernet hardware address. */
DECL|enumerator|MAR0
id|MAR0
op_assign
l_int|8
comma
multiline_comment|/* Multicast filter. */
DECL|enumerator|TxDescStartAddrLow
id|TxDescStartAddrLow
op_assign
l_int|0x20
comma
DECL|enumerator|TxDescStartAddrHigh
id|TxDescStartAddrHigh
op_assign
l_int|0x24
comma
DECL|enumerator|TxHDescStartAddrLow
id|TxHDescStartAddrLow
op_assign
l_int|0x28
comma
DECL|enumerator|TxHDescStartAddrHigh
id|TxHDescStartAddrHigh
op_assign
l_int|0x2c
comma
DECL|enumerator|FLASH
id|FLASH
op_assign
l_int|0x30
comma
DECL|enumerator|ERSR
id|ERSR
op_assign
l_int|0x36
comma
DECL|enumerator|ChipCmd
id|ChipCmd
op_assign
l_int|0x37
comma
DECL|enumerator|TxPoll
id|TxPoll
op_assign
l_int|0x38
comma
DECL|enumerator|IntrMask
id|IntrMask
op_assign
l_int|0x3C
comma
DECL|enumerator|IntrStatus
id|IntrStatus
op_assign
l_int|0x3E
comma
DECL|enumerator|TxConfig
id|TxConfig
op_assign
l_int|0x40
comma
DECL|enumerator|RxConfig
id|RxConfig
op_assign
l_int|0x44
comma
DECL|enumerator|RxMissed
id|RxMissed
op_assign
l_int|0x4C
comma
DECL|enumerator|Cfg9346
id|Cfg9346
op_assign
l_int|0x50
comma
DECL|enumerator|Config0
id|Config0
op_assign
l_int|0x51
comma
DECL|enumerator|Config1
id|Config1
op_assign
l_int|0x52
comma
DECL|enumerator|Config2
id|Config2
op_assign
l_int|0x53
comma
DECL|enumerator|Config3
id|Config3
op_assign
l_int|0x54
comma
DECL|enumerator|Config4
id|Config4
op_assign
l_int|0x55
comma
DECL|enumerator|Config5
id|Config5
op_assign
l_int|0x56
comma
DECL|enumerator|MultiIntr
id|MultiIntr
op_assign
l_int|0x5C
comma
DECL|enumerator|PHYAR
id|PHYAR
op_assign
l_int|0x60
comma
DECL|enumerator|TBICSR
id|TBICSR
op_assign
l_int|0x64
comma
DECL|enumerator|TBI_ANAR
id|TBI_ANAR
op_assign
l_int|0x68
comma
DECL|enumerator|TBI_LPAR
id|TBI_LPAR
op_assign
l_int|0x6A
comma
DECL|enumerator|PHYstatus
id|PHYstatus
op_assign
l_int|0x6C
comma
DECL|enumerator|RxMaxSize
id|RxMaxSize
op_assign
l_int|0xDA
comma
DECL|enumerator|CPlusCmd
id|CPlusCmd
op_assign
l_int|0xE0
comma
DECL|enumerator|RxDescAddrLow
id|RxDescAddrLow
op_assign
l_int|0xE4
comma
DECL|enumerator|RxDescAddrHigh
id|RxDescAddrHigh
op_assign
l_int|0xE8
comma
DECL|enumerator|EarlyTxThres
id|EarlyTxThres
op_assign
l_int|0xEC
comma
DECL|enumerator|FuncEvent
id|FuncEvent
op_assign
l_int|0xF0
comma
DECL|enumerator|FuncEventMask
id|FuncEventMask
op_assign
l_int|0xF4
comma
DECL|enumerator|FuncPresetState
id|FuncPresetState
op_assign
l_int|0xF8
comma
DECL|enumerator|FuncForceEvent
id|FuncForceEvent
op_assign
l_int|0xFC
comma
)brace
suffix:semicolon
DECL|enum|RTL8169_register_content
r_enum
id|RTL8169_register_content
(brace
multiline_comment|/*InterruptStatusBits */
DECL|enumerator|SYSErr
id|SYSErr
op_assign
l_int|0x8000
comma
DECL|enumerator|PCSTimeout
id|PCSTimeout
op_assign
l_int|0x4000
comma
DECL|enumerator|SWInt
id|SWInt
op_assign
l_int|0x0100
comma
DECL|enumerator|TxDescUnavail
id|TxDescUnavail
op_assign
l_int|0x80
comma
DECL|enumerator|RxFIFOOver
id|RxFIFOOver
op_assign
l_int|0x40
comma
DECL|enumerator|RxUnderrun
id|RxUnderrun
op_assign
l_int|0x20
comma
DECL|enumerator|RxOverflow
id|RxOverflow
op_assign
l_int|0x10
comma
DECL|enumerator|TxErr
id|TxErr
op_assign
l_int|0x08
comma
DECL|enumerator|TxOK
id|TxOK
op_assign
l_int|0x04
comma
DECL|enumerator|RxErr
id|RxErr
op_assign
l_int|0x02
comma
DECL|enumerator|RxOK
id|RxOK
op_assign
l_int|0x01
comma
multiline_comment|/*RxStatusDesc */
DECL|enumerator|RxRES
id|RxRES
op_assign
l_int|0x00200000
comma
DECL|enumerator|RxCRC
id|RxCRC
op_assign
l_int|0x00080000
comma
DECL|enumerator|RxRUNT
id|RxRUNT
op_assign
l_int|0x00100000
comma
DECL|enumerator|RxRWT
id|RxRWT
op_assign
l_int|0x00400000
comma
multiline_comment|/*ChipCmdBits */
DECL|enumerator|CmdReset
id|CmdReset
op_assign
l_int|0x10
comma
DECL|enumerator|CmdRxEnb
id|CmdRxEnb
op_assign
l_int|0x08
comma
DECL|enumerator|CmdTxEnb
id|CmdTxEnb
op_assign
l_int|0x04
comma
DECL|enumerator|RxBufEmpty
id|RxBufEmpty
op_assign
l_int|0x01
comma
multiline_comment|/*Cfg9346Bits */
DECL|enumerator|Cfg9346_Lock
id|Cfg9346_Lock
op_assign
l_int|0x00
comma
DECL|enumerator|Cfg9346_Unlock
id|Cfg9346_Unlock
op_assign
l_int|0xC0
comma
multiline_comment|/*rx_mode_bits */
DECL|enumerator|AcceptErr
id|AcceptErr
op_assign
l_int|0x20
comma
DECL|enumerator|AcceptRunt
id|AcceptRunt
op_assign
l_int|0x10
comma
DECL|enumerator|AcceptBroadcast
id|AcceptBroadcast
op_assign
l_int|0x08
comma
DECL|enumerator|AcceptMulticast
id|AcceptMulticast
op_assign
l_int|0x04
comma
DECL|enumerator|AcceptMyPhys
id|AcceptMyPhys
op_assign
l_int|0x02
comma
DECL|enumerator|AcceptAllPhys
id|AcceptAllPhys
op_assign
l_int|0x01
comma
multiline_comment|/*RxConfigBits */
DECL|enumerator|RxCfgFIFOShift
id|RxCfgFIFOShift
op_assign
l_int|13
comma
DECL|enumerator|RxCfgDMAShift
id|RxCfgDMAShift
op_assign
l_int|8
comma
multiline_comment|/*TxConfigBits */
DECL|enumerator|TxInterFrameGapShift
id|TxInterFrameGapShift
op_assign
l_int|24
comma
DECL|enumerator|TxDMAShift
id|TxDMAShift
op_assign
l_int|8
comma
multiline_comment|/* DMA burst value (0-7) is shift this many bits */
multiline_comment|/* CPlusCmd p.31 */
DECL|enumerator|RxVlan
id|RxVlan
op_assign
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
DECL|enumerator|RxChkSum
id|RxChkSum
op_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
comma
DECL|enumerator|PCIDAC
id|PCIDAC
op_assign
(paren
l_int|1
op_lshift
l_int|4
)paren
comma
DECL|enumerator|PCIMulRW
id|PCIMulRW
op_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
comma
multiline_comment|/*rtl8169_PHYstatus */
DECL|enumerator|TBI_Enable
id|TBI_Enable
op_assign
l_int|0x80
comma
DECL|enumerator|TxFlowCtrl
id|TxFlowCtrl
op_assign
l_int|0x40
comma
DECL|enumerator|RxFlowCtrl
id|RxFlowCtrl
op_assign
l_int|0x20
comma
DECL|enumerator|_1000bpsF
id|_1000bpsF
op_assign
l_int|0x10
comma
DECL|enumerator|_100bps
id|_100bps
op_assign
l_int|0x08
comma
DECL|enumerator|_10bps
id|_10bps
op_assign
l_int|0x04
comma
DECL|enumerator|LinkStatus
id|LinkStatus
op_assign
l_int|0x02
comma
DECL|enumerator|FullDup
id|FullDup
op_assign
l_int|0x01
comma
multiline_comment|/*GIGABIT_PHY_registers */
DECL|enumerator|PHY_CTRL_REG
id|PHY_CTRL_REG
op_assign
l_int|0
comma
DECL|enumerator|PHY_STAT_REG
id|PHY_STAT_REG
op_assign
l_int|1
comma
DECL|enumerator|PHY_AUTO_NEGO_REG
id|PHY_AUTO_NEGO_REG
op_assign
l_int|4
comma
DECL|enumerator|PHY_1000_CTRL_REG
id|PHY_1000_CTRL_REG
op_assign
l_int|9
comma
multiline_comment|/*GIGABIT_PHY_REG_BIT */
DECL|enumerator|PHY_Restart_Auto_Nego
id|PHY_Restart_Auto_Nego
op_assign
l_int|0x0200
comma
DECL|enumerator|PHY_Enable_Auto_Nego
id|PHY_Enable_Auto_Nego
op_assign
l_int|0x1000
comma
singleline_comment|//PHY_STAT_REG = 1;
DECL|enumerator|PHY_Auto_Neco_Comp
id|PHY_Auto_Neco_Comp
op_assign
l_int|0x0020
comma
singleline_comment|//PHY_AUTO_NEGO_REG = 4;
DECL|enumerator|PHY_Cap_10_Half
id|PHY_Cap_10_Half
op_assign
l_int|0x0020
comma
DECL|enumerator|PHY_Cap_10_Full
id|PHY_Cap_10_Full
op_assign
l_int|0x0040
comma
DECL|enumerator|PHY_Cap_100_Half
id|PHY_Cap_100_Half
op_assign
l_int|0x0080
comma
DECL|enumerator|PHY_Cap_100_Full
id|PHY_Cap_100_Full
op_assign
l_int|0x0100
comma
singleline_comment|//PHY_1000_CTRL_REG = 9;
DECL|enumerator|PHY_Cap_1000_Full
id|PHY_Cap_1000_Full
op_assign
l_int|0x0200
comma
DECL|enumerator|PHY_Cap_Null
id|PHY_Cap_Null
op_assign
l_int|0x0
comma
multiline_comment|/*_MediaType*/
DECL|enumerator|_10_Half
id|_10_Half
op_assign
l_int|0x01
comma
DECL|enumerator|_10_Full
id|_10_Full
op_assign
l_int|0x02
comma
DECL|enumerator|_100_Half
id|_100_Half
op_assign
l_int|0x04
comma
DECL|enumerator|_100_Full
id|_100_Full
op_assign
l_int|0x08
comma
DECL|enumerator|_1000_Full
id|_1000_Full
op_assign
l_int|0x10
comma
multiline_comment|/*_TBICSRBit*/
DECL|enumerator|TBILinkOK
id|TBILinkOK
op_assign
l_int|0x02000000
comma
)brace
suffix:semicolon
DECL|enum|_DescStatusBit
r_enum
id|_DescStatusBit
(brace
DECL|enumerator|OWNbit
id|OWNbit
op_assign
l_int|0x80000000
comma
DECL|enumerator|EORbit
id|EORbit
op_assign
l_int|0x40000000
comma
DECL|enumerator|FSbit
id|FSbit
op_assign
l_int|0x20000000
comma
DECL|enumerator|LSbit
id|LSbit
op_assign
l_int|0x10000000
comma
)brace
suffix:semicolon
DECL|macro|RsvdMask
mdefine_line|#define RsvdMask&t;0x3fffc000
DECL|struct|TxDesc
r_struct
id|TxDesc
(brace
DECL|member|status
id|u32
id|status
suffix:semicolon
DECL|member|vlan_tag
id|u32
id|vlan_tag
suffix:semicolon
DECL|member|addr
id|u64
id|addr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|RxDesc
r_struct
id|RxDesc
(brace
DECL|member|status
id|u32
id|status
suffix:semicolon
DECL|member|vlan_tag
id|u32
id|vlan_tag
suffix:semicolon
DECL|member|addr
id|u64
id|addr
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|rtl8169_private
r_struct
id|rtl8169_private
(brace
DECL|member|mmio_addr
r_void
op_star
id|mmio_addr
suffix:semicolon
multiline_comment|/* memory map physical address */
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
multiline_comment|/* Index of PCI device  */
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
multiline_comment|/* statistics of net device */
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
multiline_comment|/* spin lock flag */
DECL|member|chipset
r_int
id|chipset
suffix:semicolon
DECL|member|mac_version
r_int
id|mac_version
suffix:semicolon
DECL|member|phy_version
r_int
id|phy_version
suffix:semicolon
DECL|member|cur_rx
id|u32
id|cur_rx
suffix:semicolon
multiline_comment|/* Index into the Rx descriptor buffer of next Rx pkt. */
DECL|member|cur_tx
id|u32
id|cur_tx
suffix:semicolon
multiline_comment|/* Index into the Tx descriptor buffer of next Rx pkt. */
DECL|member|dirty_rx
id|u32
id|dirty_rx
suffix:semicolon
DECL|member|dirty_tx
id|u32
id|dirty_tx
suffix:semicolon
DECL|member|TxDescArray
r_struct
id|TxDesc
op_star
id|TxDescArray
suffix:semicolon
multiline_comment|/* Index of 256-alignment Tx Descriptor buffer */
DECL|member|RxDescArray
r_struct
id|RxDesc
op_star
id|RxDescArray
suffix:semicolon
multiline_comment|/* Index of 256-alignment Rx Descriptor buffer */
DECL|member|TxPhyAddr
id|dma_addr_t
id|TxPhyAddr
suffix:semicolon
DECL|member|RxPhyAddr
id|dma_addr_t
id|RxPhyAddr
suffix:semicolon
DECL|member|Rx_skbuff
r_struct
id|sk_buff
op_star
id|Rx_skbuff
(braket
id|NUM_RX_DESC
)braket
suffix:semicolon
multiline_comment|/* Rx data buffers */
DECL|member|Tx_skbuff
r_struct
id|sk_buff
op_star
id|Tx_skbuff
(braket
id|NUM_TX_DESC
)braket
suffix:semicolon
multiline_comment|/* Index of Transmit data buffer */
DECL|member|timer
r_struct
id|timer_list
id|timer
suffix:semicolon
DECL|member|phy_link_down_cnt
r_int
r_int
id|phy_link_down_cnt
suffix:semicolon
DECL|member|cp_cmd
id|u16
id|cp_cmd
suffix:semicolon
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Realtek&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;RealTek RTL-8169 Gigabit Ethernet driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|media
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|MAX_UNITS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|rx_copybreak
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
r_static
r_int
id|rtl8169_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|rtl8169_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|rtl8169_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_int
id|rtl8169_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8169_hw_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|rtl8169_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8169_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|rtl8169_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_struct
id|net_device_stats
op_star
id|rtl8169_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|netdev
)paren
suffix:semicolon
DECL|variable|rtl8169_intr_mask
r_static
r_const
id|u16
id|rtl8169_intr_mask
op_assign
id|RxUnderrun
op_or
id|RxOverflow
op_or
id|RxFIFOOver
op_or
id|TxErr
op_or
id|TxOK
op_or
id|RxErr
op_or
id|RxOK
suffix:semicolon
DECL|variable|rtl8169_rx_config
r_static
r_const
r_int
r_int
id|rtl8169_rx_config
op_assign
(paren
id|RX_FIFO_THRESH
op_lshift
id|RxCfgFIFOShift
)paren
op_or
(paren
id|RX_DMA_BURST
op_lshift
id|RxCfgDMAShift
)paren
suffix:semicolon
DECL|macro|PHY_Cap_10_Half_Or_Less
mdefine_line|#define PHY_Cap_10_Half_Or_Less PHY_Cap_10_Half
DECL|macro|PHY_Cap_10_Full_Or_Less
mdefine_line|#define PHY_Cap_10_Full_Or_Less PHY_Cap_10_Full | PHY_Cap_10_Half_Or_Less
DECL|macro|PHY_Cap_100_Half_Or_Less
mdefine_line|#define PHY_Cap_100_Half_Or_Less PHY_Cap_100_Half | PHY_Cap_10_Full_Or_Less
DECL|macro|PHY_Cap_100_Full_Or_Less
mdefine_line|#define PHY_Cap_100_Full_Or_Less PHY_Cap_100_Full | PHY_Cap_100_Half_Or_Less
DECL|function|mdio_write
r_static
r_void
id|mdio_write
c_func
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|RegAddr
comma
r_int
id|value
)paren
(brace
r_int
id|i
suffix:semicolon
id|RTL_W32
c_func
(paren
id|PHYAR
comma
l_int|0x80000000
op_or
(paren
id|RegAddr
op_amp
l_int|0xFF
)paren
op_lshift
l_int|16
op_or
id|value
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
singleline_comment|// Check if the RTL8169 has completed writing to the specified MII register
r_if
c_cond
(paren
op_logical_neg
(paren
id|RTL_R32
c_func
(paren
id|PHYAR
)paren
op_amp
l_int|0x80000000
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|mdio_read
r_static
r_int
id|mdio_read
c_func
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|RegAddr
)paren
(brace
r_int
id|i
comma
id|value
op_assign
op_minus
l_int|1
suffix:semicolon
id|RTL_W32
c_func
(paren
id|PHYAR
comma
l_int|0x0
op_or
(paren
id|RegAddr
op_amp
l_int|0xFF
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
singleline_comment|// Check if the RTL8169 has completed retrieving data from the specified MII register
r_if
c_cond
(paren
id|RTL_R32
c_func
(paren
id|PHYAR
)paren
op_amp
l_int|0x80000000
)paren
(brace
id|value
op_assign
(paren
r_int
)paren
(paren
id|RTL_R32
c_func
(paren
id|PHYAR
)paren
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
DECL|function|rtl8169_get_drvinfo
r_static
r_void
id|rtl8169_get_drvinfo
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ethtool_drvinfo
op_star
id|info
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;driver
comma
id|RTL8169_DRIVER_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;version
comma
id|RTL8169_VERSION
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;bus_info
comma
id|pci_name
c_func
(paren
id|tp-&gt;pci_dev
)paren
)paren
suffix:semicolon
)brace
DECL|variable|rtl8169_ethtool_ops
r_static
r_struct
id|ethtool_ops
id|rtl8169_ethtool_ops
op_assign
(brace
dot
id|get_drvinfo
op_assign
id|rtl8169_get_drvinfo
comma
)brace
suffix:semicolon
DECL|function|rtl8169_write_gmii_reg_bit
r_static
r_void
id|rtl8169_write_gmii_reg_bit
c_func
(paren
r_void
op_star
id|ioaddr
comma
r_int
id|reg
comma
r_int
id|bitnum
comma
r_int
id|bitval
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|reg
)paren
suffix:semicolon
id|val
op_assign
(paren
id|bitval
op_eq
l_int|1
)paren
ques
c_cond
id|val
op_or
(paren
id|bitval
op_lshift
id|bitnum
)paren
suffix:colon
id|val
op_amp
op_complement
(paren
l_int|0x0001
op_lshift
id|bitnum
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|reg
comma
id|val
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_get_mac_version
r_static
r_void
id|rtl8169_get_mac_version
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_const
r_struct
(brace
id|u32
id|mask
suffix:semicolon
r_int
id|mac_version
suffix:semicolon
)brace
id|mac_info
(braket
)braket
op_assign
(brace
(brace
l_int|0x1
op_lshift
l_int|26
comma
id|RTL_GIGA_MAC_VER_E
)brace
comma
(brace
l_int|0x1
op_lshift
l_int|23
comma
id|RTL_GIGA_MAC_VER_D
)brace
comma
(brace
l_int|0x00000000
comma
id|RTL_GIGA_MAC_VER_B
)brace
multiline_comment|/* Catch-all */
)brace
comma
op_star
id|p
op_assign
id|mac_info
suffix:semicolon
id|u32
id|reg
suffix:semicolon
id|reg
op_assign
id|RTL_R32
c_func
(paren
id|TxConfig
)paren
op_amp
l_int|0x7c800000
suffix:semicolon
r_while
c_loop
(paren
(paren
id|reg
op_amp
id|p-&gt;mask
)paren
op_ne
id|p-&gt;mask
)paren
id|p
op_increment
suffix:semicolon
id|tp-&gt;mac_version
op_assign
id|p-&gt;mac_version
suffix:semicolon
)brace
DECL|function|rtl8169_print_mac_version
r_static
r_void
id|rtl8169_print_mac_version
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
)paren
(brace
r_struct
(brace
r_int
id|version
suffix:semicolon
r_char
op_star
id|msg
suffix:semicolon
)brace
id|mac_print
(braket
)braket
op_assign
(brace
(brace
id|RTL_GIGA_MAC_VER_E
comma
l_string|&quot;RTL_GIGA_MAC_VER_E&quot;
)brace
comma
(brace
id|RTL_GIGA_MAC_VER_D
comma
l_string|&quot;RTL_GIGA_MAC_VER_D&quot;
)brace
comma
(brace
id|RTL_GIGA_MAC_VER_B
comma
l_string|&quot;RTL_GIGA_MAC_VER_B&quot;
)brace
comma
(brace
l_int|0
comma
l_int|NULL
)brace
)brace
comma
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|mac_print
suffix:semicolon
id|p-&gt;msg
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mac_version
op_eq
id|p-&gt;version
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;mac_version == %s (%04d)&bslash;n&quot;
comma
id|p-&gt;msg
comma
id|p-&gt;version
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
l_string|&quot;mac_version == Unknown&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_get_phy_version
r_static
r_void
id|rtl8169_get_phy_version
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_const
r_struct
(brace
id|u16
id|mask
suffix:semicolon
id|u16
id|set
suffix:semicolon
r_int
id|phy_version
suffix:semicolon
)brace
id|phy_info
(braket
)braket
op_assign
(brace
(brace
l_int|0x000f
comma
l_int|0x0002
comma
id|RTL_GIGA_PHY_VER_G
)brace
comma
(brace
l_int|0x000f
comma
l_int|0x0001
comma
id|RTL_GIGA_PHY_VER_F
)brace
comma
(brace
l_int|0x000f
comma
l_int|0x0000
comma
id|RTL_GIGA_PHY_VER_E
)brace
comma
(brace
l_int|0x0000
comma
l_int|0x0000
comma
id|RTL_GIGA_PHY_VER_D
)brace
multiline_comment|/* Catch-all */
)brace
comma
op_star
id|p
op_assign
id|phy_info
suffix:semicolon
id|u16
id|reg
suffix:semicolon
id|reg
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
l_int|3
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_while
c_loop
(paren
(paren
id|reg
op_amp
id|p-&gt;mask
)paren
op_ne
id|p-&gt;set
)paren
id|p
op_increment
suffix:semicolon
id|tp-&gt;phy_version
op_assign
id|p-&gt;phy_version
suffix:semicolon
)brace
DECL|function|rtl8169_print_phy_version
r_static
r_void
id|rtl8169_print_phy_version
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
)paren
(brace
r_struct
(brace
r_int
id|version
suffix:semicolon
r_char
op_star
id|msg
suffix:semicolon
id|u32
id|reg
suffix:semicolon
)brace
id|phy_print
(braket
)braket
op_assign
(brace
(brace
id|RTL_GIGA_PHY_VER_G
comma
l_string|&quot;RTL_GIGA_PHY_VER_G&quot;
comma
l_int|0x0002
)brace
comma
(brace
id|RTL_GIGA_PHY_VER_F
comma
l_string|&quot;RTL_GIGA_PHY_VER_F&quot;
comma
l_int|0x0001
)brace
comma
(brace
id|RTL_GIGA_PHY_VER_E
comma
l_string|&quot;RTL_GIGA_PHY_VER_E&quot;
comma
l_int|0x0000
)brace
comma
(brace
id|RTL_GIGA_PHY_VER_D
comma
l_string|&quot;RTL_GIGA_PHY_VER_D&quot;
comma
l_int|0x0000
)brace
comma
(brace
l_int|0
comma
l_int|NULL
comma
l_int|0x0000
)brace
)brace
comma
op_star
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|phy_print
suffix:semicolon
id|p-&gt;msg
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;phy_version
op_eq
id|p-&gt;version
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;phy_version == %s (%04x)&bslash;n&quot;
comma
id|p-&gt;msg
comma
id|p-&gt;reg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
l_string|&quot;phy_version == Unknown&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_hw_phy_config
r_static
r_void
id|rtl8169_hw_phy_config
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_struct
(brace
id|u16
id|regs
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Beware of bit-sign propagation */
)brace
id|phy_magic
(braket
l_int|5
)braket
op_assign
(brace
(brace
(brace
l_int|0x0000
comma
singleline_comment|//w 4 15 12 0
l_int|0x00a1
comma
singleline_comment|//w 3 15 0 00a1
l_int|0x0008
comma
singleline_comment|//w 2 15 0 0008
l_int|0x1020
comma
singleline_comment|//w 1 15 0 1020
l_int|0x1000
)brace
)brace
comma
(brace
singleline_comment|//w 0 15 0 1000
(brace
l_int|0x7000
comma
singleline_comment|//w 4 15 12 7
l_int|0xff41
comma
singleline_comment|//w 3 15 0 ff41
l_int|0xde60
comma
singleline_comment|//w 2 15 0 de60
l_int|0x0140
comma
singleline_comment|//w 1 15 0 0140
l_int|0x0077
)brace
)brace
comma
(brace
singleline_comment|//w 0 15 0 0077
(brace
l_int|0xa000
comma
singleline_comment|//w 4 15 12 a
l_int|0xdf01
comma
singleline_comment|//w 3 15 0 df01
l_int|0xdf20
comma
singleline_comment|//w 2 15 0 df20
l_int|0xff95
comma
singleline_comment|//w 1 15 0 ff95
l_int|0xfa00
)brace
)brace
comma
(brace
singleline_comment|//w 0 15 0 fa00
(brace
l_int|0xb000
comma
singleline_comment|//w 4 15 12 b
l_int|0xff41
comma
singleline_comment|//w 3 15 0 ff41
l_int|0xde20
comma
singleline_comment|//w 2 15 0 de20
l_int|0x0140
comma
singleline_comment|//w 1 15 0 0140
l_int|0x00bb
)brace
)brace
comma
(brace
singleline_comment|//w 0 15 0 00bb
(brace
l_int|0xf000
comma
singleline_comment|//w 4 15 12 f
l_int|0xdf01
comma
singleline_comment|//w 3 15 0 df01
l_int|0xdf20
comma
singleline_comment|//w 2 15 0 df20
l_int|0xff95
comma
singleline_comment|//w 1 15 0 ff95
l_int|0xbf00
)brace
singleline_comment|//w 0 15 0 bf00
)brace
)brace
comma
op_star
id|p
op_assign
id|phy_magic
suffix:semicolon
r_int
id|i
suffix:semicolon
id|rtl8169_print_mac_version
c_func
(paren
id|tp
)paren
suffix:semicolon
id|rtl8169_print_phy_version
c_func
(paren
id|tp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mac_version
op_le
id|RTL_GIGA_MAC_VER_B
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_version
op_ge
id|RTL_GIGA_PHY_VER_F
)paren
r_return
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;MAC version != 0 &amp;&amp; PHY version == 0 or 1&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Do final_reg2.cfg&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Shazam ! */
singleline_comment|// phy config for RTL8169s mac_version C chip
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|31
comma
l_int|0x0001
)paren
suffix:semicolon
singleline_comment|//w 31 2 0 1
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|21
comma
l_int|0x1000
)paren
suffix:semicolon
singleline_comment|//w 21 15 0 1000
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|24
comma
l_int|0x65c7
)paren
suffix:semicolon
singleline_comment|//w 24 15 0 65c7
id|rtl8169_write_gmii_reg_bit
c_func
(paren
id|ioaddr
comma
l_int|4
comma
l_int|11
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//w 4 11 11 0
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|phy_magic
)paren
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
r_int
id|val
comma
id|pos
op_assign
l_int|4
suffix:semicolon
id|val
op_assign
(paren
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|pos
)paren
op_amp
l_int|0x0fff
)paren
op_or
(paren
id|p-&gt;regs
(braket
l_int|0
)braket
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|pos
comma
id|val
)paren
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|pos
op_ge
l_int|0
)paren
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|pos
comma
id|p-&gt;regs
(braket
l_int|4
op_minus
id|pos
)braket
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|rtl8169_write_gmii_reg_bit
c_func
(paren
id|ioaddr
comma
l_int|4
comma
l_int|11
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|//w 4 11 11 1
id|rtl8169_write_gmii_reg_bit
c_func
(paren
id|ioaddr
comma
l_int|4
comma
l_int|11
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//w 4 11 11 0
)brace
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|31
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|//w 31 2 0 0
)brace
DECL|function|rtl8169_hw_phy_reset
r_static
r_void
id|rtl8169_hw_phy_reset
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;%s: Reset RTL8169s PHY&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|val
op_assign
(paren
id|mdio_read
c_func
(paren
id|ioaddr
comma
l_int|0
)paren
op_or
l_int|0x8000
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|0
comma
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|50
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mdio_read
c_func
(paren
id|ioaddr
comma
l_int|0
)paren
op_amp
l_int|0x8000
)paren
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Gross */
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
id|PFX
l_string|&quot;%s: no PHY Reset ack. Giving up.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
)brace
DECL|function|rtl8169_phy_timer
r_static
r_void
id|rtl8169_phy_timer
c_func
(paren
r_int
r_int
id|__opaque
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|__opaque
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|timer
op_assign
op_amp
id|tp-&gt;timer
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
m_assert
(paren
id|tp-&gt;mac_version
OG
id|RTL_GIGA_MAC_VER_B
)paren
suffix:semicolon
m_assert
(paren
id|tp-&gt;phy_version
OL
id|RTL_GIGA_PHY_VER_G
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RTL_R8
c_func
(paren
id|PHYstatus
)paren
op_amp
id|LinkStatus
)paren
id|tp-&gt;phy_link_down_cnt
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|tp-&gt;phy_link_down_cnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;phy_link_down_cnt
op_ge
l_int|12
)paren
(brace
r_int
id|reg
suffix:semicolon
singleline_comment|// If link on 1000, perform phy reset.
id|reg
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|PHY_1000_CTRL_REG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
id|PHY_Cap_1000_Full
)paren
id|rtl8169_hw_phy_reset
c_func
(paren
id|dev
)paren
suffix:semicolon
id|tp-&gt;phy_link_down_cnt
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|mod_timer
c_func
(paren
id|timer
comma
id|jiffies
op_plus
id|RTL8169_PHY_TIMEOUT
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_delete_timer
r_static
r_inline
r_void
id|rtl8169_delete_timer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|timer
op_assign
op_amp
id|tp-&gt;timer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;mac_version
op_le
id|RTL_GIGA_MAC_VER_B
)paren
op_logical_or
(paren
id|tp-&gt;phy_version
op_ge
id|RTL_GIGA_PHY_VER_G
)paren
)paren
r_return
suffix:semicolon
id|del_timer_sync
c_func
(paren
id|timer
)paren
suffix:semicolon
id|tp-&gt;phy_link_down_cnt
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8169_request_timer
r_static
r_inline
r_void
id|rtl8169_request_timer
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|timer_list
op_star
id|timer
op_assign
op_amp
id|tp-&gt;timer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;mac_version
op_le
id|RTL_GIGA_MAC_VER_B
)paren
op_logical_or
(paren
id|tp-&gt;phy_version
op_ge
id|RTL_GIGA_PHY_VER_G
)paren
)paren
r_return
suffix:semicolon
id|tp-&gt;phy_link_down_cnt
op_assign
l_int|0
suffix:semicolon
id|init_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
id|timer-&gt;expires
op_assign
id|jiffies
op_plus
id|RTL8169_PHY_TIMEOUT
suffix:semicolon
id|timer-&gt;data
op_assign
(paren
r_int
r_int
)paren
(paren
id|dev
)paren
suffix:semicolon
id|timer-&gt;function
op_assign
id|rtl8169_phy_timer
suffix:semicolon
id|add_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|rtl8169_init_board
id|rtl8169_init_board
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|net_device
op_star
op_star
id|dev_out
comma
r_void
op_star
op_star
id|ioaddr_out
)paren
(brace
r_void
op_star
id|ioaddr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
suffix:semicolon
r_int
r_int
id|mmio_start
comma
id|mmio_end
comma
id|mmio_flags
comma
id|mmio_len
suffix:semicolon
r_int
id|rc
comma
id|i
comma
id|acpi_idle_state
op_assign
l_int|0
comma
id|pm_cap
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr_out
op_ne
l_int|NULL
)paren
suffix:semicolon
op_star
id|ioaddr_out
op_assign
l_int|NULL
suffix:semicolon
op_star
id|dev_out
op_assign
l_int|NULL
suffix:semicolon
singleline_comment|// dev zeroed in alloc_etherdev 
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
r_sizeof
(paren
op_star
id|tp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to alloc new ethernet&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|pdev-&gt;dev
)paren
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
singleline_comment|// enable device (incl. PCI PM wakeup and hotplug setup)
id|rc
op_assign
id|pci_enable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: unable to enable device&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out
suffix:semicolon
)brace
multiline_comment|/* save power state before pci_enable_device overwrites it */
id|pm_cap
op_assign
id|pci_find_capability
c_func
(paren
id|pdev
comma
id|PCI_CAP_ID_PM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pm_cap
)paren
(brace
id|u16
id|pwr_command
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
id|pm_cap
op_plus
id|PCI_PM_CTRL
comma
op_amp
id|pwr_command
)paren
suffix:semicolon
id|acpi_idle_state
op_assign
id|pwr_command
op_amp
id|PCI_PM_CTRL_STATE_MASK
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Cannot find PowerManagement capability, aborting.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
id|mmio_start
op_assign
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_end
op_assign
id|pci_resource_end
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_flags
op_assign
id|pci_resource_flags
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
id|mmio_len
op_assign
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// make sure PCI base addr 1 is MMIO
r_if
c_cond
(paren
op_logical_neg
(paren
id|mmio_flags
op_amp
id|IORESOURCE_MEM
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;region #1 not an MMIO resource, aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_disable
suffix:semicolon
)brace
singleline_comment|// check for weird/broken PCI region reporting
r_if
c_cond
(paren
id|mmio_len
OL
id|RTL_MIN_IO_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;Invalid PCI region size(s), aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_out_disable
suffix:semicolon
)brace
id|rc
op_assign
id|pci_request_regions
c_func
(paren
id|pdev
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;%s: Could not request regions.&bslash;n&quot;
comma
id|pdev-&gt;slot_name
)paren
suffix:semicolon
r_goto
id|err_out_disable
suffix:semicolon
)brace
id|tp-&gt;cp_cmd
op_assign
id|PCIMulRW
op_or
id|RxChkSum
suffix:semicolon
r_if
c_cond
(paren
(paren
r_sizeof
(paren
id|dma_addr_t
)paren
OG
l_int|32
)paren
op_logical_and
op_logical_neg
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
id|DMA_64BIT_MASK
)paren
)paren
id|tp-&gt;cp_cmd
op_or_assign
id|PCIDAC
suffix:semicolon
r_else
(brace
id|rc
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pdev
comma
id|DMA_32BIT_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;DMA configuration failed.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
)brace
singleline_comment|// enable PCI bus-mastering
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
singleline_comment|// ioremap MMIO region 
id|ioaddr
op_assign
id|ioremap
c_func
(paren
id|mmio_start
comma
id|mmio_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioaddr
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot remap MMIO, aborting&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|err_out_free_res
suffix:semicolon
)brace
singleline_comment|// Soft reset the chip. 
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
id|CmdReset
)paren
suffix:semicolon
singleline_comment|// Check that the chip has finished the reset.
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|RTL_R8
c_func
(paren
id|ChipCmd
)paren
op_amp
id|CmdReset
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
singleline_comment|// Identify chip attached to board
id|rtl8169_get_mac_version
c_func
(paren
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
id|rtl8169_get_phy_version
c_func
(paren
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
id|rtl8169_print_mac_version
c_func
(paren
id|tp
)paren
suffix:semicolon
id|rtl8169_print_phy_version
c_func
(paren
id|tp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ARRAY_SIZE
c_func
(paren
id|rtl_chip_info
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;mac_version
op_eq
id|rtl_chip_info
(braket
id|i
)braket
dot
id|mac_version
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
multiline_comment|/* Unknown chip: assume array element #0, original RTL-8169 */
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;PCI device %s: unknown chip version, assuming %s&bslash;n&quot;
comma
id|pci_name
c_func
(paren
id|pdev
)paren
comma
id|rtl_chip_info
(braket
l_int|0
)braket
dot
id|name
)paren
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|tp-&gt;chipset
op_assign
id|i
suffix:semicolon
op_star
id|ioaddr_out
op_assign
id|ioaddr
suffix:semicolon
op_star
id|dev_out
op_assign
id|dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out_free_res
suffix:colon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out_disable
suffix:colon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|err_out
suffix:colon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|rtl8169_init_one
id|rtl8169_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
l_int|NULL
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
l_int|NULL
suffix:semicolon
r_static
r_int
id|board_idx
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
r_int
id|printed_version
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
r_int
id|option
op_assign
op_minus
l_int|1
comma
id|Cap10_100
op_assign
l_int|0
comma
id|Cap1000
op_assign
l_int|0
suffix:semicolon
m_assert
(paren
id|pdev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ent
op_ne
l_int|NULL
)paren
suffix:semicolon
id|board_idx
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|printed_version
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|RTL8169_DRIVER_NAME
l_string|&quot; loaded&bslash;n&quot;
)paren
suffix:semicolon
id|printed_version
op_assign
l_int|1
suffix:semicolon
)brace
id|rc
op_assign
id|rtl8169_init_board
c_func
(paren
id|pdev
comma
op_amp
id|dev
comma
op_amp
id|ioaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
singleline_comment|// Get MAC address.  FIXME: read EEPROM
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAC_ADDR_LEN
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;dev_addr
(braket
id|i
)braket
op_assign
id|RTL_R8
c_func
(paren
id|MAC0
op_plus
id|i
)paren
suffix:semicolon
id|dev-&gt;open
op_assign
id|rtl8169_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|rtl8169_start_xmit
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|rtl8169_get_stats
suffix:semicolon
id|dev-&gt;ethtool_ops
op_assign
op_amp
id|rtl8169_ethtool_ops
suffix:semicolon
id|dev-&gt;stop
op_assign
id|rtl8169_close
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|rtl8169_tx_timeout
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|rtl8169_set_rx_mode
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|RTL8169_TX_TIMEOUT
suffix:semicolon
id|dev-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
id|dev-&gt;base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioaddr
suffix:semicolon
singleline_comment|//      dev-&gt;do_ioctl           = mii_ioctl;
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
singleline_comment|// private data //
id|tp-&gt;pci_dev
op_assign
id|pdev
suffix:semicolon
id|tp-&gt;mmio_addr
op_assign
id|ioaddr
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|rc
op_assign
id|register_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iounmap
c_func
(paren
id|ioaddr
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: Identified chip type is &squot;%s&squot;.&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|name
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %s at 0x%lx, &quot;
l_string|&quot;%2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x, &quot;
l_string|&quot;IRQ %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|rtl_chip_info
(braket
id|ent-&gt;driver_data
)braket
dot
id|name
comma
id|dev-&gt;base_addr
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;irq
)paren
suffix:semicolon
id|rtl8169_hw_phy_config
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Set MAC Reg C+CR Offset 0x82h = 0x01h&bslash;n&quot;
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
l_int|0x82
comma
l_int|0x01
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mac_version
OL
id|RTL_GIGA_MAC_VER_E
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Set PCI Latency=0x40&bslash;n&quot;
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
id|PCI_LATENCY_TIMER
comma
l_int|0x40
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;mac_version
op_eq
id|RTL_GIGA_MAC_VER_D
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Set MAC Reg C+CR Offset 0x82h = 0x01h&bslash;n&quot;
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
l_int|0x82
comma
l_int|0x01
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Set PHY Reg 0x0bh = 0x00h&bslash;n&quot;
)paren
suffix:semicolon
id|mdio_write
c_func
(paren
id|ioaddr
comma
l_int|0x0b
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|//w 0x0b 15 0 0
)brace
singleline_comment|// if TBI is not endbled
r_if
c_cond
(paren
op_logical_neg
(paren
id|RTL_R8
c_func
(paren
id|PHYstatus
)paren
op_amp
id|TBI_Enable
)paren
)paren
(brace
r_int
id|val
op_assign
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|PHY_AUTO_NEGO_REG
)paren
suffix:semicolon
id|option
op_assign
(paren
id|board_idx
op_ge
id|MAX_UNITS
)paren
ques
c_cond
l_int|0
suffix:colon
id|media
(braket
id|board_idx
)braket
suffix:semicolon
singleline_comment|// Force RTL8169 in 10/100/1000 Full/Half mode.
r_if
c_cond
(paren
id|option
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Force-mode Enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|Cap10_100
op_assign
l_int|0
comma
id|Cap1000
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|option
)paren
(brace
r_case
id|_10_Half
suffix:colon
id|Cap10_100
op_assign
id|PHY_Cap_10_Half_Or_Less
suffix:semicolon
id|Cap1000
op_assign
id|PHY_Cap_Null
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_10_Full
suffix:colon
id|Cap10_100
op_assign
id|PHY_Cap_10_Full_Or_Less
suffix:semicolon
id|Cap1000
op_assign
id|PHY_Cap_Null
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_100_Half
suffix:colon
id|Cap10_100
op_assign
id|PHY_Cap_100_Half_Or_Less
suffix:semicolon
id|Cap1000
op_assign
id|PHY_Cap_Null
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_100_Full
suffix:colon
id|Cap10_100
op_assign
id|PHY_Cap_100_Full_Or_Less
suffix:semicolon
id|Cap1000
op_assign
id|PHY_Cap_Null
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_1000_Full
suffix:colon
id|Cap10_100
op_assign
id|PHY_Cap_100_Full_Or_Less
suffix:semicolon
id|Cap1000
op_assign
id|PHY_Cap_1000_Full
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_AUTO_NEGO_REG
comma
id|Cap10_100
op_or
(paren
id|val
op_amp
l_int|0x1F
)paren
)paren
suffix:semicolon
singleline_comment|//leave PHY_AUTO_NEGO_REG bit4:0 unchanged
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_1000_CTRL_REG
comma
id|Cap1000
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Auto-negotiation Enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
singleline_comment|// enable 10/100 Full/Half Mode, leave PHY_AUTO_NEGO_REG bit4:0 unchanged
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_AUTO_NEGO_REG
comma
id|PHY_Cap_100_Full_Or_Less
op_or
(paren
id|val
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
singleline_comment|// enable 1000 Full Mode
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_1000_CTRL_REG
comma
id|PHY_Cap_1000_Full
)paren
suffix:semicolon
)brace
singleline_comment|// Enable auto-negotiation and restart auto-nigotiation
id|mdio_write
c_func
(paren
id|ioaddr
comma
id|PHY_CTRL_REG
comma
id|PHY_Enable_Auto_Nego
op_or
id|PHY_Restart_Auto_Nego
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
singleline_comment|// wait for auto-negotiation process
r_for
c_loop
(paren
id|i
op_assign
l_int|10000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
singleline_comment|//check if auto-negotiation complete
r_if
c_cond
(paren
id|mdio_read
c_func
(paren
id|ioaddr
comma
id|PHY_STAT_REG
)paren
op_amp
id|PHY_Auto_Neco_Comp
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|option
op_assign
id|RTL_R8
c_func
(paren
id|PHYstatus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|option
op_amp
id|_1000bpsF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: 1000Mbps Full-duplex operation.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: %sMbps %s-duplex operation.&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|option
op_amp
id|_100bps
)paren
ques
c_cond
l_string|&quot;100&quot;
suffix:colon
l_string|&quot;10&quot;
comma
(paren
id|option
op_amp
id|FullDup
)paren
ques
c_cond
l_string|&quot;Full&quot;
suffix:colon
l_string|&quot;Half&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// end for-loop to wait for auto-negotiation process
)brace
r_else
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: 1000Mbps Full-duplex operation, TBI Link %s!&bslash;n&quot;
comma
id|dev-&gt;name
comma
(paren
id|RTL_R32
c_func
(paren
id|TBICSR
)paren
op_amp
id|TBILinkOK
)paren
ques
c_cond
l_string|&quot;OK&quot;
suffix:colon
l_string|&quot;Failed&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__devexit
DECL|function|rtl8169_remove_one
id|rtl8169_remove_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|tp-&gt;mmio_addr
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|rtl8169_suspend
r_static
r_int
id|rtl8169_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
id|u32
id|state
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|netif_device_detach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts, stop Rx and Tx */
id|RTL_W16
c_func
(paren
id|IntrMask
comma
l_int|0
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
c_func
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|rtl8169_resume
r_static
r_int
id|rtl8169_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|netif_device_attach
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtl8169_hw_start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
r_static
r_int
DECL|function|rtl8169_open
id|rtl8169_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|tp-&gt;pci_dev
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|rtl8169_interrupt
comma
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/*&n;&t; * Rx and Tx desscriptors needs 256 bytes alignment.&n;&t; * pci_alloc_consistent provides more.&n;&t; */
id|tp-&gt;TxDescArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|R8169_TX_RING_BYTES
comma
op_amp
id|tp-&gt;TxPhyAddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;TxDescArray
)paren
r_goto
id|err_free_irq
suffix:semicolon
id|tp-&gt;RxDescArray
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pdev
comma
id|R8169_RX_RING_BYTES
comma
op_amp
id|tp-&gt;RxPhyAddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;RxDescArray
)paren
r_goto
id|err_free_tx
suffix:semicolon
id|retval
op_assign
id|rtl8169_init_ring
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|err_free_rx
suffix:semicolon
id|rtl8169_hw_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtl8169_request_timer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
id|err_free_rx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|R8169_RX_RING_BYTES
comma
id|tp-&gt;RxDescArray
comma
id|tp-&gt;RxPhyAddr
)paren
suffix:semicolon
id|err_free_tx
suffix:colon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|R8169_TX_RING_BYTES
comma
id|tp-&gt;TxDescArray
comma
id|tp-&gt;TxPhyAddr
)paren
suffix:semicolon
id|err_free_irq
suffix:colon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtl8169_hw_start
id|rtl8169_hw_start
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u32
id|i
suffix:semicolon
multiline_comment|/* Soft reset the chip. */
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
id|CmdReset
)paren
suffix:semicolon
multiline_comment|/* Check that the chip has finished the reset. */
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|RTL_R8
c_func
(paren
id|ChipCmd
)paren
op_amp
id|CmdReset
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|RTL_W8
c_func
(paren
id|Cfg9346
comma
id|Cfg9346_Unlock
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
id|CmdTxEnb
op_or
id|CmdRxEnb
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
id|EarlyTxThres
comma
id|EarlyTxThld
)paren
suffix:semicolon
singleline_comment|// For gigabit rtl8169
id|RTL_W16
c_func
(paren
id|RxMaxSize
comma
id|RxPacketMaxSize
)paren
suffix:semicolon
singleline_comment|// Set Rx Config register
id|i
op_assign
id|rtl8169_rx_config
op_or
(paren
id|RTL_R32
c_func
(paren
id|RxConfig
)paren
op_amp
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|RxConfigMask
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxConfig
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Set DMA burst size and Interframe Gap Time */
id|RTL_W32
c_func
(paren
id|TxConfig
comma
(paren
id|TX_DMA_BURST
op_lshift
id|TxDMAShift
)paren
op_or
(paren
id|InterFrameGap
op_lshift
id|TxInterFrameGapShift
)paren
)paren
suffix:semicolon
id|tp-&gt;cp_cmd
op_or_assign
id|RTL_R16
c_func
(paren
id|CPlusCmd
)paren
suffix:semicolon
id|RTL_W16
c_func
(paren
id|CPlusCmd
comma
id|tp-&gt;cp_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;mac_version
op_eq
id|RTL_GIGA_MAC_VER_D
)paren
(brace
id|dprintk
c_func
(paren
id|KERN_INFO
id|PFX
l_string|&quot;Set MAC Reg C+CR Offset 0xE0: bit-3 and bit-14 MUST be 1&bslash;n&quot;
)paren
suffix:semicolon
id|tp-&gt;cp_cmd
op_or_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
id|PCIMulRW
suffix:semicolon
id|RTL_W16
c_func
(paren
id|CPlusCmd
comma
id|tp-&gt;cp_cmd
)paren
suffix:semicolon
)brace
id|tp-&gt;cur_rx
op_assign
l_int|0
suffix:semicolon
id|RTL_W32
c_func
(paren
id|TxDescStartAddrLow
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;TxPhyAddr
op_amp
id|DMA_32BIT_MASK
)paren
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|TxDescStartAddrHigh
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;TxPhyAddr
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxDescAddrLow
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;RxPhyAddr
op_amp
id|DMA_32BIT_MASK
)paren
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxDescAddrHigh
comma
(paren
(paren
id|u64
)paren
id|tp-&gt;RxPhyAddr
op_rshift
l_int|32
)paren
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
id|Cfg9346
comma
id|Cfg9346_Lock
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|rtl8169_set_rx_mode
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* no early-rx interrupts */
id|RTL_W16
c_func
(paren
id|MultiIntr
comma
id|RTL_R16
c_func
(paren
id|MultiIntr
)paren
op_amp
l_int|0xF000
)paren
suffix:semicolon
multiline_comment|/* Enable all known interrupts by setting the interrupt mask. */
id|RTL_W16
c_func
(paren
id|IntrMask
comma
id|rtl8169_intr_mask
)paren
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_make_unusable_by_asic
r_static
r_inline
r_void
id|rtl8169_make_unusable_by_asic
c_func
(paren
r_struct
id|RxDesc
op_star
id|desc
)paren
(brace
id|desc-&gt;addr
op_assign
l_int|0x0badbadbadbadbad
suffix:semicolon
id|desc-&gt;status
op_and_assign
op_complement
id|cpu_to_le32
c_func
(paren
id|OWNbit
op_or
id|RsvdMask
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_free_rx_skb
r_static
r_void
id|rtl8169_free_rx_skb
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|sk_buff
op_star
op_star
id|sk_buff
comma
r_struct
id|RxDesc
op_star
id|desc
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|pdev
comma
id|le64_to_cpu
c_func
(paren
id|desc-&gt;addr
)paren
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
op_star
id|sk_buff
)paren
suffix:semicolon
op_star
id|sk_buff
op_assign
l_int|NULL
suffix:semicolon
id|rtl8169_make_unusable_by_asic
c_func
(paren
id|desc
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_return_to_asic
r_static
r_inline
r_void
id|rtl8169_return_to_asic
c_func
(paren
r_struct
id|RxDesc
op_star
id|desc
)paren
(brace
id|desc-&gt;status
op_or_assign
id|cpu_to_le32
c_func
(paren
id|OWNbit
op_plus
id|RX_BUF_SIZE
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_give_to_asic
r_static
r_inline
r_void
id|rtl8169_give_to_asic
c_func
(paren
r_struct
id|RxDesc
op_star
id|desc
comma
id|dma_addr_t
id|mapping
)paren
(brace
id|desc-&gt;addr
op_assign
id|cpu_to_le64
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|desc-&gt;status
op_or_assign
id|cpu_to_le32
c_func
(paren
id|OWNbit
op_plus
id|RX_BUF_SIZE
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_alloc_rx_skb
r_static
r_int
id|rtl8169_alloc_rx_skb
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|sk_buff
op_star
op_star
id|sk_buff
comma
r_struct
id|RxDesc
op_star
id|desc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|mapping
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|RX_BUF_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|err_out
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
op_star
id|sk_buff
op_assign
id|skb
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|pdev
comma
id|skb-&gt;tail
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|rtl8169_give_to_asic
c_func
(paren
id|desc
comma
id|mapping
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
id|err_out
suffix:colon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|rtl8169_make_unusable_by_asic
c_func
(paren
id|desc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|rtl8169_rx_clear
r_static
r_void
id|rtl8169_rx_clear
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_RX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tp-&gt;Rx_skbuff
(braket
id|i
)braket
)paren
(brace
id|rtl8169_free_rx_skb
c_func
(paren
id|tp-&gt;pci_dev
comma
id|tp-&gt;Rx_skbuff
op_plus
id|i
comma
id|tp-&gt;RxDescArray
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|rtl8169_rx_fill
r_static
id|u32
id|rtl8169_rx_fill
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
comma
r_struct
id|net_device
op_star
id|dev
comma
id|u32
id|start
comma
id|u32
id|end
)paren
(brace
id|u32
id|cur
suffix:semicolon
r_for
c_loop
(paren
id|cur
op_assign
id|start
suffix:semicolon
id|end
op_minus
id|cur
OG
l_int|0
suffix:semicolon
id|cur
op_increment
)paren
(brace
r_int
id|ret
comma
id|i
op_assign
id|cur
op_mod
id|NUM_RX_DESC
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;Rx_skbuff
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|ret
op_assign
id|rtl8169_alloc_rx_skb
c_func
(paren
id|tp-&gt;pci_dev
comma
id|dev
comma
id|tp-&gt;Rx_skbuff
op_plus
id|i
comma
id|tp-&gt;RxDescArray
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_return
id|cur
op_minus
id|start
suffix:semicolon
)brace
DECL|function|rtl8169_mark_as_last_descriptor
r_static
r_inline
r_void
id|rtl8169_mark_as_last_descriptor
c_func
(paren
r_struct
id|RxDesc
op_star
id|desc
)paren
(brace
id|desc-&gt;status
op_or_assign
id|cpu_to_le32
c_func
(paren
id|EORbit
)paren
suffix:semicolon
)brace
DECL|function|rtl8169_init_ring
r_static
r_int
id|rtl8169_init_ring
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|tp-&gt;cur_rx
op_assign
id|tp-&gt;dirty_rx
op_assign
l_int|0
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
id|tp-&gt;dirty_tx
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;TxDescArray
comma
l_int|0x0
comma
id|NUM_TX_DESC
op_star
r_sizeof
(paren
r_struct
id|TxDesc
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;RxDescArray
comma
l_int|0x0
comma
id|NUM_RX_DESC
op_star
r_sizeof
(paren
r_struct
id|RxDesc
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;Tx_skbuff
comma
l_int|0x0
comma
id|NUM_TX_DESC
op_star
r_sizeof
(paren
r_struct
id|sk_buff
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|tp-&gt;Rx_skbuff
comma
l_int|0x0
comma
id|NUM_RX_DESC
op_star
r_sizeof
(paren
r_struct
id|sk_buff
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtl8169_rx_fill
c_func
(paren
id|tp
comma
id|dev
comma
l_int|0
comma
id|NUM_RX_DESC
)paren
op_ne
id|NUM_RX_DESC
)paren
r_goto
id|err_out
suffix:semicolon
id|rtl8169_mark_as_last_descriptor
c_func
(paren
id|tp-&gt;RxDescArray
op_plus
id|NUM_RX_DESC
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_out
suffix:colon
id|rtl8169_rx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|rtl8169_unmap_tx_skb
r_static
r_void
id|rtl8169_unmap_tx_skb
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|sk_buff
op_star
op_star
id|sk_buff
comma
r_struct
id|TxDesc
op_star
id|desc
)paren
(brace
id|u32
id|len
op_assign
id|sk_buff
(braket
l_int|0
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|pdev
comma
id|le64_to_cpu
c_func
(paren
id|desc-&gt;addr
)paren
comma
id|len
OL
id|ETH_ZLEN
ques
c_cond
id|ETH_ZLEN
suffix:colon
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|desc-&gt;addr
op_assign
l_int|0x00
suffix:semicolon
op_star
id|sk_buff
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtl8169_tx_clear
id|rtl8169_tx_clear
c_func
(paren
r_struct
id|rtl8169_private
op_star
id|tp
)paren
(brace
r_int
id|i
suffix:semicolon
id|tp-&gt;cur_tx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_TX_DESC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;Tx_skbuff
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|rtl8169_unmap_tx_skb
c_func
(paren
id|tp-&gt;pci_dev
comma
id|tp-&gt;Tx_skbuff
op_plus
id|i
comma
id|tp-&gt;TxDescArray
op_plus
id|i
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|rtl8169_tx_timeout
id|rtl8169_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|u8
id|tmp8
suffix:semicolon
multiline_comment|/* disable Tx, if not already */
id|tmp8
op_assign
id|RTL_R8
c_func
(paren
id|ChipCmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp8
op_amp
id|CmdTxEnb
)paren
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
id|tmp8
op_amp
op_complement
id|CmdTxEnb
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|RTL_W16
c_func
(paren
id|IntrMask
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Stop a shared interrupt from scavenging while we are. */
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|rtl8169_tx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* ...and finally, reset everything */
id|rtl8169_hw_start
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rtl8169_start_xmit
id|rtl8169_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|entry
op_assign
id|tp-&gt;cur_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
id|u32
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|skb-&gt;len
OL
id|ETH_ZLEN
)paren
)paren
(brace
id|skb
op_assign
id|skb_padto
c_func
(paren
id|skb
comma
id|ETH_ZLEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|err_update_stats
suffix:semicolon
id|len
op_assign
id|ETH_ZLEN
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
)paren
op_amp
id|OWNbit
)paren
)paren
(brace
id|dma_addr_t
id|mapping
suffix:semicolon
id|mapping
op_assign
id|pci_map_single
c_func
(paren
id|tp-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
op_assign
id|skb
suffix:semicolon
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|addr
op_assign
id|cpu_to_le64
c_func
(paren
id|mapping
)paren
suffix:semicolon
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|OWNbit
op_or
id|FSbit
op_or
id|LSbit
op_or
id|len
op_or
(paren
id|EORbit
op_star
op_logical_neg
(paren
(paren
id|entry
op_plus
l_int|1
)paren
op_mod
id|NUM_TX_DESC
)paren
)paren
)paren
suffix:semicolon
id|RTL_W8
c_func
(paren
id|TxPoll
comma
l_int|0x40
)paren
suffix:semicolon
singleline_comment|//set polling bit
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;cur_tx
op_increment
suffix:semicolon
)brace
r_else
r_goto
id|err_drop
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tp-&gt;cur_tx
op_minus
id|NUM_TX_DESC
)paren
op_eq
id|tp-&gt;dirty_tx
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_drop
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|err_update_stats
suffix:colon
id|tp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtl8169_tx_interrupt
id|rtl8169_tx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8169_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
r_int
id|dirty_tx
comma
id|tx_left
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|dirty_tx
op_assign
id|tp-&gt;dirty_tx
suffix:semicolon
id|tx_left
op_assign
id|tp-&gt;cur_tx
op_minus
id|dirty_tx
suffix:semicolon
r_while
c_loop
(paren
id|tx_left
OG
l_int|0
)paren
(brace
r_int
id|entry
op_assign
id|dirty_tx
op_mod
id|NUM_TX_DESC
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|tp-&gt;TxDescArray
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|OWNbit
)paren
r_break
suffix:semicolon
multiline_comment|/* FIXME: is it really accurate for TxErr ? */
id|tp-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
op_ge
id|ETH_ZLEN
ques
c_cond
id|skb-&gt;len
suffix:colon
id|ETH_ZLEN
suffix:semicolon
id|tp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|rtl8169_unmap_tx_skb
c_func
(paren
id|tp-&gt;pci_dev
comma
id|tp-&gt;Tx_skbuff
op_plus
id|entry
comma
id|tp-&gt;TxDescArray
op_plus
id|entry
)paren
suffix:semicolon
id|dev_kfree_skb_irq
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tp-&gt;Tx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dirty_tx
op_increment
suffix:semicolon
id|tx_left
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tp-&gt;dirty_tx
op_ne
id|dirty_tx
)paren
(brace
id|tp-&gt;dirty_tx
op_assign
id|dirty_tx
suffix:semicolon
r_if
c_cond
(paren
id|netif_queue_stopped
c_func
(paren
id|dev
)paren
)paren
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|rtl8169_try_rx_copy
r_static
r_inline
r_int
id|rtl8169_try_rx_copy
c_func
(paren
r_struct
id|sk_buff
op_star
op_star
id|sk_buff
comma
r_int
id|pkt_size
comma
r_struct
id|RxDesc
op_star
id|desc
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|ret
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pkt_size
OL
id|rx_copybreak
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pkt_size
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|eth_copy_and_sum
c_func
(paren
id|skb
comma
id|sk_buff
(braket
l_int|0
)braket
op_member_access_from_pointer
id|tail
comma
id|pkt_size
comma
l_int|0
)paren
suffix:semicolon
op_star
id|sk_buff
op_assign
id|skb
suffix:semicolon
id|rtl8169_return_to_asic
c_func
(paren
id|desc
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtl8169_rx_interrupt
id|rtl8169_rx_interrupt
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|rtl8169_private
op_star
id|tp
comma
r_void
op_star
id|ioaddr
)paren
(brace
r_int
r_int
id|cur_rx
comma
id|rx_left
suffix:semicolon
r_int
id|delta
suffix:semicolon
m_assert
(paren
id|dev
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
m_assert
(paren
id|ioaddr
op_ne
l_int|NULL
)paren
suffix:semicolon
id|cur_rx
op_assign
id|tp-&gt;cur_rx
suffix:semicolon
id|rx_left
op_assign
id|NUM_RX_DESC
op_plus
id|tp-&gt;dirty_rx
op_minus
id|cur_rx
suffix:semicolon
r_while
c_loop
(paren
id|rx_left
OG
l_int|0
)paren
(brace
r_int
id|entry
op_assign
id|cur_rx
op_mod
id|NUM_RX_DESC
suffix:semicolon
id|u32
id|status
suffix:semicolon
id|rmb
c_func
(paren
)paren
suffix:semicolon
id|status
op_assign
id|le32_to_cpu
c_func
(paren
id|tp-&gt;RxDescArray
(braket
id|entry
)braket
dot
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|OWNbit
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxRES
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Rx ERROR!!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|tp-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxRWT
op_or
id|RxRUNT
)paren
)paren
id|tp-&gt;stats.rx_length_errors
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|RxCRC
)paren
id|tp-&gt;stats.rx_crc_errors
op_increment
suffix:semicolon
)brace
r_else
(brace
r_struct
id|RxDesc
op_star
id|desc
op_assign
id|tp-&gt;RxDescArray
op_plus
id|entry
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|tp-&gt;Rx_skbuff
(braket
id|entry
)braket
suffix:semicolon
r_int
id|pkt_size
op_assign
(paren
id|status
op_amp
l_int|0x00001FFF
)paren
op_minus
l_int|4
suffix:semicolon
r_void
(paren
op_star
id|pci_action
)paren
(paren
r_struct
id|pci_dev
op_star
comma
id|dma_addr_t
comma
r_int
comma
r_int
)paren
op_assign
id|pci_dma_sync_single_for_device
suffix:semicolon
id|pci_dma_sync_single_for_cpu
c_func
(paren
id|tp-&gt;pci_dev
comma
id|le64_to_cpu
c_func
(paren
id|desc-&gt;addr
)paren
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rtl8169_try_rx_copy
c_func
(paren
op_amp
id|skb
comma
id|pkt_size
comma
id|desc
comma
id|dev
)paren
)paren
(brace
id|pci_action
op_assign
id|pci_unmap_single
suffix:semicolon
id|tp-&gt;Rx_skbuff
(braket
id|entry
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|pci_action
c_func
(paren
id|tp-&gt;pci_dev
comma
id|le64_to_cpu
c_func
(paren
id|desc-&gt;addr
)paren
comma
id|RX_BUF_SIZE
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|pkt_size
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|eth_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|tp-&gt;stats.rx_bytes
op_add_assign
id|pkt_size
suffix:semicolon
id|tp-&gt;stats.rx_packets
op_increment
suffix:semicolon
)brace
id|cur_rx
op_increment
suffix:semicolon
id|rx_left
op_decrement
suffix:semicolon
)brace
id|tp-&gt;cur_rx
op_assign
id|cur_rx
suffix:semicolon
id|delta
op_assign
id|rtl8169_rx_fill
c_func
(paren
id|tp
comma
id|dev
comma
id|tp-&gt;dirty_rx
comma
id|tp-&gt;cur_rx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delta
OG
l_int|0
)paren
id|tp-&gt;dirty_rx
op_add_assign
id|delta
suffix:semicolon
r_else
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: no Rx buffer allocated&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME: until there is periodic timer to try and refill the ring,&n;&t; * a temporary shortage may definitely kill the Rx process.&n;&t; * - disable the asic to try and avoid an overflow and kick it again&n;&t; *   after refill ?&n;&t; * - how do others driver handle this condition (Uh oh...).&n;&t; */
r_if
c_cond
(paren
id|tp-&gt;dirty_rx
op_plus
id|NUM_RX_DESC
op_eq
id|tp-&gt;cur_rx
)paren
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;%s: Rx buffers exhausted&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* The interrupt handler does all of the Rx thread work and cleans up after the Tx thread. */
r_static
id|irqreturn_t
DECL|function|rtl8169_interrupt
id|rtl8169_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_instance
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|dev_instance
suffix:semicolon
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|boguscnt
op_assign
id|max_interrupt_work
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|status
op_assign
id|RTL_R16
c_func
(paren
id|IntrStatus
)paren
suffix:semicolon
multiline_comment|/* hotplug/major error/no more work/shared irq */
r_if
c_cond
(paren
(paren
id|status
op_eq
l_int|0xFFFF
)paren
op_logical_or
op_logical_neg
id|status
)paren
r_break
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t;&t;if (status &amp; RxUnderrun)&n;&t;&t;&t;link_changed = RTL_R16 (CSCR) &amp; CSCR_LinkChangeBit;&n;*/
id|RTL_W16
c_func
(paren
id|IntrStatus
comma
(paren
id|status
op_amp
id|RxFIFOOver
)paren
ques
c_cond
(paren
id|status
op_or
id|RxOverflow
)paren
suffix:colon
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|rtl8169_intr_mask
)paren
)paren
r_break
suffix:semicolon
singleline_comment|// Rx interrupt 
r_if
c_cond
(paren
id|status
op_amp
(paren
id|RxOK
op_or
id|RxUnderrun
op_or
id|RxOverflow
op_or
id|RxFIFOOver
)paren
)paren
(brace
id|rtl8169_rx_interrupt
c_func
(paren
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
)brace
singleline_comment|// Tx interrupt
r_if
c_cond
(paren
id|status
op_amp
(paren
id|TxOK
op_or
id|TxErr
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|rtl8169_tx_interrupt
c_func
(paren
id|dev
comma
id|tp
comma
id|ioaddr
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
)brace
id|boguscnt
op_decrement
suffix:semicolon
)brace
r_while
c_loop
(paren
id|boguscnt
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|boguscnt
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too much work at interrupt!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Clear all interrupt sources. */
id|RTL_W16
c_func
(paren
id|IntrStatus
comma
l_int|0xffff
)paren
suffix:semicolon
)brace
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rtl8169_close
id|rtl8169_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|tp-&gt;pci_dev
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtl8169_delete_timer
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
multiline_comment|/* Stop the chip&squot;s Tx and Rx DMA processes. */
id|RTL_W8
c_func
(paren
id|ChipCmd
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts by clearing the interrupt mask. */
id|RTL_W16
c_func
(paren
id|IntrMask
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Update the error counts. */
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
c_func
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|tp-&gt;lock
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|dev-&gt;irq
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|rtl8169_tx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
id|rtl8169_rx_clear
c_func
(paren
id|tp
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|R8169_RX_RING_BYTES
comma
id|tp-&gt;RxDescArray
comma
id|tp-&gt;RxPhyAddr
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pdev
comma
id|R8169_TX_RING_BYTES
comma
id|tp-&gt;TxDescArray
comma
id|tp-&gt;TxPhyAddr
)paren
suffix:semicolon
id|tp-&gt;TxDescArray
op_assign
l_int|NULL
suffix:semicolon
id|tp-&gt;RxDescArray
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|rtl8169_set_rx_mode
id|rtl8169_set_rx_mode
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|mc_filter
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Multicast hash filter */
r_int
id|i
comma
id|rx_mode
suffix:semicolon
id|u32
id|tmp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
(brace
multiline_comment|/* Unconditionally log net taps. */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: Promiscuous mode enabled.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
op_or
id|AcceptAllPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|dev-&gt;mc_count
OG
id|multicast_filter_limit
)paren
op_logical_or
(paren
id|dev-&gt;flags
op_amp
id|IFF_ALLMULTI
)paren
)paren
(brace
multiline_comment|/* Too many to filter perfectly -- accept all multicasts. */
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMulticast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0xffffffff
suffix:semicolon
)brace
r_else
(brace
r_struct
id|dev_mc_list
op_star
id|mclist
suffix:semicolon
id|rx_mode
op_assign
id|AcceptBroadcast
op_or
id|AcceptMyPhys
suffix:semicolon
id|mc_filter
(braket
l_int|1
)braket
op_assign
id|mc_filter
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|mclist
op_assign
id|dev-&gt;mc_list
suffix:semicolon
id|mclist
op_logical_and
id|i
OL
id|dev-&gt;mc_count
suffix:semicolon
id|i
op_increment
comma
id|mclist
op_assign
id|mclist-&gt;next
)paren
(brace
r_int
id|bit_nr
op_assign
id|ether_crc
c_func
(paren
id|ETH_ALEN
comma
id|mclist-&gt;dmi_addr
)paren
op_rshift
l_int|26
suffix:semicolon
id|mc_filter
(braket
id|bit_nr
op_rshift
l_int|5
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|bit_nr
op_amp
l_int|31
)paren
suffix:semicolon
id|rx_mode
op_or_assign
id|AcceptMulticast
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|rtl8169_rx_config
op_or
id|rx_mode
op_or
(paren
id|RTL_R32
c_func
(paren
id|RxConfig
)paren
op_amp
id|rtl_chip_info
(braket
id|tp-&gt;chipset
)braket
dot
id|RxConfigMask
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxConfig
comma
id|tmp
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|MAR0
op_plus
l_int|0
comma
id|mc_filter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|MAR0
op_plus
l_int|4
comma
id|mc_filter
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *  rtl8169_get_stats - Get rtl8169 read/write statistics&n; *  @dev: The Ethernet Device to get statistics for&n; *&n; *  Get TX/RX statistics for rtl8169&n; */
DECL|function|rtl8169_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|rtl8169_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|rtl8169_private
op_star
id|tp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_void
op_star
id|ioaddr
op_assign
id|tp-&gt;mmio_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tp-&gt;stats.rx_missed_errors
op_add_assign
id|RTL_R32
c_func
(paren
id|RxMissed
)paren
suffix:semicolon
id|RTL_W32
c_func
(paren
id|RxMissed
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|tp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
op_amp
id|tp-&gt;stats
suffix:semicolon
)brace
DECL|variable|rtl8169_pci_driver
r_static
r_struct
id|pci_driver
id|rtl8169_pci_driver
op_assign
(brace
dot
id|name
op_assign
id|MODULENAME
comma
dot
id|id_table
op_assign
id|rtl8169_pci_tbl
comma
dot
id|probe
op_assign
id|rtl8169_init_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|rtl8169_remove_one
)paren
comma
macro_line|#ifdef CONFIG_PM
dot
id|suspend
op_assign
id|rtl8169_suspend
comma
dot
id|resume
op_assign
id|rtl8169_resume
comma
macro_line|#endif
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|rtl8169_init_module
id|rtl8169_init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|rtl8169_pci_driver
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|rtl8169_cleanup_module
id|rtl8169_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|rtl8169_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|rtl8169_init_module
id|module_init
c_func
(paren
id|rtl8169_init_module
)paren
suffix:semicolon
DECL|variable|rtl8169_cleanup_module
id|module_exit
c_func
(paren
id|rtl8169_cleanup_module
)paren
suffix:semicolon
eof
