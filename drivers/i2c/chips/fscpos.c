multiline_comment|/*&n;&t;fscpos.c - Kernel module for hardware monitoring with FSC Poseidon chips&n;&t;Copyright (C) 2004, 2005 Stefan Ott &lt;stefan@desire.ch&gt;&n;&n;&t;This program is free software; you can redistribute it and/or modify&n;&t;it under the terms of the GNU General Public License as published by&n;&t;the Free Software Foundation; either version 2 of the License, or&n;&t;(at your option) any later version.&n;&n;&t;This program is distributed in the hope that it will be useful,&n;&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n;&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&n;&t;GNU General Public License for more details.&n;&n;&t;You should have received a copy of the GNU General Public License&n;&t;along with this program; if not, write to the Free Software&n;&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
multiline_comment|/*&n;&t;fujitsu siemens poseidon chip,&n;&t;module based on the old fscpos module by Hermann Jung &lt;hej@odn.de&gt; and&n;&t;the fscher module by Reinhard Nissl &lt;rnissl@gmx.de&gt;&n;&n;&t;original module based on lm80.c&n;&t;Copyright (C) 1998, 1999 Frodo Looijaard &lt;frodol@dds.nl&gt;&n;&t;and Philip Edelbrock &lt;phil@netroedge.com&gt;&n;&n;&t;Thanks to Jean Delvare for reviewing my code and suggesting a lot of&n;&t;improvements.&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
macro_line|#include &lt;linux/init.h&gt;
multiline_comment|/*&n; * Addresses to scan&n; */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
l_int|0x73
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/*&n; * Insmod parameters&n; */
DECL|variable|fscpos
id|SENSORS_INSMOD_1
c_func
(paren
id|fscpos
)paren
suffix:semicolon
multiline_comment|/*&n; * The FSCPOS registers&n; */
DECL|macro|DEBUG
mdefine_line|#define DEBUG
multiline_comment|/* chip identification */
DECL|macro|FSCPOS_REG_IDENT_0
mdefine_line|#define FSCPOS_REG_IDENT_0&t;&t;0x00
DECL|macro|FSCPOS_REG_IDENT_1
mdefine_line|#define FSCPOS_REG_IDENT_1&t;&t;0x01
DECL|macro|FSCPOS_REG_IDENT_2
mdefine_line|#define FSCPOS_REG_IDENT_2&t;&t;0x02
DECL|macro|FSCPOS_REG_REVISION
mdefine_line|#define FSCPOS_REG_REVISION&t;&t;0x03
multiline_comment|/* global control and status */
DECL|macro|FSCPOS_REG_EVENT_STATE
mdefine_line|#define FSCPOS_REG_EVENT_STATE&t;&t;0x04
DECL|macro|FSCPOS_REG_CONTROL
mdefine_line|#define FSCPOS_REG_CONTROL&t;&t;0x05
multiline_comment|/* watchdog */
DECL|macro|FSCPOS_REG_WDOG_PRESET
mdefine_line|#define FSCPOS_REG_WDOG_PRESET&t;&t;0x28
DECL|macro|FSCPOS_REG_WDOG_STATE
mdefine_line|#define FSCPOS_REG_WDOG_STATE&t;&t;0x23
DECL|macro|FSCPOS_REG_WDOG_CONTROL
mdefine_line|#define FSCPOS_REG_WDOG_CONTROL&t;&t;0x21
multiline_comment|/* voltages */
DECL|macro|FSCPOS_REG_VOLT_12
mdefine_line|#define FSCPOS_REG_VOLT_12&t;&t;0x45
DECL|macro|FSCPOS_REG_VOLT_5
mdefine_line|#define FSCPOS_REG_VOLT_5&t;&t;0x42
DECL|macro|FSCPOS_REG_VOLT_BATT
mdefine_line|#define FSCPOS_REG_VOLT_BATT&t;&t;0x48
multiline_comment|/* fans - the chip does not support minimum speed for fan2 */
DECL|variable|FSCPOS_REG_PWM
r_static
id|u8
id|FSCPOS_REG_PWM
(braket
)braket
op_assign
(brace
l_int|0x55
comma
l_int|0x65
)brace
suffix:semicolon
DECL|variable|FSCPOS_REG_FAN_ACT
r_static
id|u8
id|FSCPOS_REG_FAN_ACT
(braket
)braket
op_assign
(brace
l_int|0x0e
comma
l_int|0x6b
comma
l_int|0xab
)brace
suffix:semicolon
DECL|variable|FSCPOS_REG_FAN_STATE
r_static
id|u8
id|FSCPOS_REG_FAN_STATE
(braket
)braket
op_assign
(brace
l_int|0x0d
comma
l_int|0x62
comma
l_int|0xa2
)brace
suffix:semicolon
DECL|variable|FSCPOS_REG_FAN_RIPPLE
r_static
id|u8
id|FSCPOS_REG_FAN_RIPPLE
(braket
)braket
op_assign
(brace
l_int|0x0f
comma
l_int|0x6f
comma
l_int|0xaf
)brace
suffix:semicolon
multiline_comment|/* temperatures */
DECL|variable|FSCPOS_REG_TEMP_ACT
r_static
id|u8
id|FSCPOS_REG_TEMP_ACT
(braket
)braket
op_assign
(brace
l_int|0x64
comma
l_int|0x32
comma
l_int|0x35
)brace
suffix:semicolon
DECL|variable|FSCPOS_REG_TEMP_STATE
r_static
id|u8
id|FSCPOS_REG_TEMP_STATE
(braket
)braket
op_assign
(brace
l_int|0x71
comma
l_int|0x81
comma
l_int|0x91
)brace
suffix:semicolon
multiline_comment|/*&n; * Functions declaration&n; */
r_static
r_int
id|fscpos_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|fscpos_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|fscpos_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|fscpos_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
)paren
suffix:semicolon
r_static
r_int
id|fscpos_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
comma
id|u8
id|value
)paren
suffix:semicolon
r_static
r_struct
id|fscpos_data
op_star
id|fscpos_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|fscpos_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_void
id|reset_fan_alarm
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
id|nr
)paren
suffix:semicolon
multiline_comment|/*&n; * Driver data (common to all clients)&n; */
DECL|variable|fscpos_driver
r_static
r_struct
id|i2c_driver
id|fscpos_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;fscpos&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_FSCPOS
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|fscpos_attach_adapter
comma
dot
id|detach_client
op_assign
id|fscpos_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Client data (each client gets its own)&n; */
DECL|struct|fscpos_data
r_struct
id|fscpos_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* 0 until following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* In jiffies */
multiline_comment|/* register values */
DECL|member|revision
id|u8
id|revision
suffix:semicolon
multiline_comment|/* revision of chip */
DECL|member|global_event
id|u8
id|global_event
suffix:semicolon
multiline_comment|/* global event status */
DECL|member|global_control
id|u8
id|global_control
suffix:semicolon
multiline_comment|/* global control register */
DECL|member|wdog_control
id|u8
id|wdog_control
suffix:semicolon
multiline_comment|/* watchdog control */
DECL|member|wdog_state
id|u8
id|wdog_state
suffix:semicolon
multiline_comment|/* watchdog status */
DECL|member|wdog_preset
id|u8
id|wdog_preset
suffix:semicolon
multiline_comment|/* watchdog preset */
DECL|member|volt
id|u8
id|volt
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* 12, 5, battery current */
DECL|member|temp_act
id|u8
id|temp_act
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* temperature */
DECL|member|temp_status
id|u8
id|temp_status
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* status of sensor */
DECL|member|fan_act
id|u8
id|fan_act
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fans revolutions per second */
DECL|member|fan_status
id|u8
id|fan_status
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fan status */
DECL|member|pwm
id|u8
id|pwm
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* fan min value for rps */
DECL|member|fan_ripple
id|u8
id|fan_ripple
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* divider for rps */
)brace
suffix:semicolon
multiline_comment|/* Temperature */
DECL|macro|TEMP_FROM_REG
mdefine_line|#define TEMP_FROM_REG(val)&t;(((val) - 128) * 1000)
DECL|function|show_temp_input
r_static
id|ssize_t
id|show_temp_input
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_act
(braket
id|nr
op_minus
l_int|1
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_status
r_static
id|ssize_t
id|show_temp_status
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;temp_status
(braket
id|nr
op_minus
l_int|1
)braket
op_amp
l_int|0x03
)paren
suffix:semicolon
)brace
DECL|function|show_temp_reset
r_static
id|ssize_t
id|show_temp_reset
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;1&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|set_temp_reset
r_static
id|ssize_t
id|set_temp_reset
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_ne
l_int|1
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;temp_reset value %ld not supported. &quot;
l_string|&quot;Use 1 to reset the alarm!&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dev_info
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;You used the temp_reset feature which has not &quot;
l_string|&quot;been proplerly tested. Please report your &quot;
l_string|&quot;experience to the module author.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Supported value: 2 (clears the status) */
id|fscpos_write_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_TEMP_STATE
(braket
id|nr
)braket
comma
l_int|2
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* Fans */
DECL|macro|RPM_FROM_REG
mdefine_line|#define RPM_FROM_REG(val)&t;((val) * 60)
DECL|function|show_fan_status
r_static
id|ssize_t
id|show_fan_status
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 0..1, 3..7 reserved =&gt; mask with 0x04 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;fan_status
(braket
id|nr
op_minus
l_int|1
)braket
op_amp
l_int|0x04
)paren
suffix:semicolon
)brace
DECL|function|show_fan_input
r_static
id|ssize_t
id|show_fan_input
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|RPM_FROM_REG
c_func
(paren
id|data-&gt;fan_act
(braket
id|nr
op_minus
l_int|1
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_fan_ripple
r_static
id|ssize_t
id|show_fan_ripple
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;fan_ripple
(braket
id|nr
op_minus
l_int|1
)braket
op_amp
l_int|0x03
)paren
suffix:semicolon
)brace
DECL|function|set_fan_ripple
r_static
id|ssize_t
id|set_fan_ripple
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* supported values: 2, 4, 8 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|v
)paren
(brace
r_case
l_int|2
suffix:colon
id|v
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|v
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|v
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;fan_ripple value %ld not supported. &quot;
l_string|&quot;Must be one of 2, 4 or 8!&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
id|data-&gt;fan_ripple
(braket
id|nr
op_minus
l_int|1
)braket
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
id|data-&gt;fan_ripple
(braket
id|nr
op_minus
l_int|1
)braket
op_or_assign
id|v
suffix:semicolon
id|fscpos_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;fan_ripple
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_pwm
r_static
id|ssize_t
id|show_pwm
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|function|set_pwm
r_static
id|ssize_t
id|set_pwm
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Range: 0..255 */
r_if
c_cond
(paren
id|v
OL
l_int|0
)paren
id|v
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|v
OG
l_int|255
)paren
id|v
op_assign
l_int|255
suffix:semicolon
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|v
suffix:semicolon
id|fscpos_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|reset_fan_alarm
r_static
r_void
id|reset_fan_alarm
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
id|nr
)paren
(brace
id|fscpos_write_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_FAN_STATE
(braket
id|nr
)braket
comma
l_int|4
)paren
suffix:semicolon
)brace
multiline_comment|/* Volts */
DECL|macro|VOLT_FROM_REG
mdefine_line|#define VOLT_FROM_REG(val, mult)&t;((val) * (mult) / 255)
DECL|function|show_volt_12
r_static
id|ssize_t
id|show_volt_12
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|fscpos_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|VOLT_FROM_REG
c_func
(paren
id|data-&gt;volt
(braket
l_int|0
)braket
comma
l_int|1420
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_volt_5
r_static
id|ssize_t
id|show_volt_5
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|fscpos_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|VOLT_FROM_REG
c_func
(paren
id|data-&gt;volt
(braket
l_int|1
)braket
comma
l_int|660
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_volt_batt
r_static
id|ssize_t
id|show_volt_batt
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|fscpos_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|VOLT_FROM_REG
c_func
(paren
id|data-&gt;volt
(braket
l_int|2
)braket
comma
l_int|330
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Watchdog */
DECL|function|show_wdog_control
r_static
id|ssize_t
id|show_wdog_control
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
)paren
(brace
multiline_comment|/* bits 0..3 reserved, bit 6 write only =&gt; mask with 0xb0 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;wdog_control
op_amp
l_int|0xb0
)paren
suffix:semicolon
)brace
DECL|function|set_wdog_control
r_static
id|ssize_t
id|set_wdog_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 0..3 reserved =&gt; mask with 0xf0 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|data-&gt;wdog_control
op_and_assign
op_complement
l_int|0xf0
suffix:semicolon
id|data-&gt;wdog_control
op_or_assign
id|v
suffix:semicolon
id|fscpos_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;wdog_control
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_wdog_state
r_static
id|ssize_t
id|show_wdog_state
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
)paren
(brace
multiline_comment|/* bits 0, 2..7 reserved =&gt; mask with 0x02 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;wdog_state
op_amp
l_int|0x02
)paren
suffix:semicolon
)brace
DECL|function|set_wdog_state
r_static
id|ssize_t
id|set_wdog_state
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|reg
)paren
(brace
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0x02
suffix:semicolon
multiline_comment|/* Valid values: 2 (clear) */
r_if
c_cond
(paren
id|v
op_ne
l_int|2
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;wdog_state value %ld not supported. &quot;
l_string|&quot;Must be 2 to clear the state!&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|data-&gt;wdog_state
op_and_assign
op_complement
id|v
suffix:semicolon
id|fscpos_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|v
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_wdog_preset
r_static
id|ssize_t
id|show_wdog_preset
c_func
(paren
r_struct
id|fscpos_data
op_star
id|data
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;wdog_preset
)paren
suffix:semicolon
)brace
DECL|function|set_wdog_preset
r_static
id|ssize_t
id|set_wdog_preset
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscpos_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|reg
)paren
(brace
id|data-&gt;wdog_preset
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0xff
suffix:semicolon
id|fscpos_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;wdog_preset
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* Event */
DECL|function|show_event
r_static
id|ssize_t
id|show_event
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
multiline_comment|/* bits 5..7 reserved =&gt; mask with 0x1f */
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|fscpos_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;global_event
op_amp
l_int|0x9b
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Sysfs stuff&n; */
DECL|macro|create_getter
mdefine_line|#define create_getter(kind, sub) &bslash;&n;&t;static ssize_t sysfs_show_##kind##sub(struct device *dev, char *buf) &bslash;&n;&t;{ &bslash;&n;&t;&t;struct fscpos_data *data = fscpos_update_device(dev); &bslash;&n;&t;&t;return show_##kind##sub(data, buf); &bslash;&n;&t;}
DECL|macro|create_getter_n
mdefine_line|#define create_getter_n(kind, offset, sub) &bslash;&n;&t;static ssize_t sysfs_show_##kind##offset##sub(struct device *dev, char&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t; &t;*buf) &bslash;&n;&t;{ &bslash;&n;&t;&t;struct fscpos_data *data = fscpos_update_device(dev); &bslash;&n;&t;&t;return show_##kind##sub(data, buf, offset); &bslash;&n;&t;}
DECL|macro|create_setter
mdefine_line|#define create_setter(kind, sub, reg) &bslash;&n;&t;static ssize_t sysfs_set_##kind##sub (struct device *dev, const char &bslash;&n;&t;&t;&t;&t;&t;&t;&t;*buf, size_t count) &bslash;&n;&t;{ &bslash;&n;&t;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;&t;struct fscpos_data *data = i2c_get_clientdata(client); &bslash;&n;&t;&t;return set_##kind##sub(client, data, buf, count, reg); &bslash;&n;&t;}
DECL|macro|create_setter_n
mdefine_line|#define create_setter_n(kind, offset, sub, reg) &bslash;&n;&t;static ssize_t sysfs_set_##kind##offset##sub (struct device *dev, &bslash;&n;&t;&t;&t;&t;&t;const char *buf, size_t count) &bslash;&n;&t;{ &bslash;&n;&t;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;&t;struct fscpos_data *data = i2c_get_clientdata(client); &bslash;&n;&t;&t;return set_##kind##sub(client, data, buf, count, offset, reg);&bslash;&n;&t;}
DECL|macro|create_sysfs_device_ro
mdefine_line|#define create_sysfs_device_ro(kind, sub, offset) &bslash;&n;&t;static DEVICE_ATTR(kind##offset##sub, S_IRUGO, &bslash;&n;&t;&t;&t;&t;&t;sysfs_show_##kind##offset##sub, NULL);
DECL|macro|create_sysfs_device_rw
mdefine_line|#define create_sysfs_device_rw(kind, sub, offset) &bslash;&n;&t;static DEVICE_ATTR(kind##offset##sub, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;sysfs_show_##kind##offset##sub, sysfs_set_##kind##offset##sub);
DECL|macro|sysfs_ro_n
mdefine_line|#define sysfs_ro_n(kind, sub, offset) &bslash;&n;&t;create_getter_n(kind, offset, sub); &bslash;&n;&t;create_sysfs_device_ro(kind, sub, offset);
DECL|macro|sysfs_rw_n
mdefine_line|#define sysfs_rw_n(kind, sub, offset, reg) &bslash;&n;&t;create_getter_n(kind, offset, sub); &bslash;&n;&t;create_setter_n(kind, offset, sub, reg); &bslash;&n;&t;create_sysfs_device_rw(kind, sub, offset);
DECL|macro|sysfs_rw
mdefine_line|#define sysfs_rw(kind, sub, reg) &bslash;&n;&t;create_getter(kind, sub); &bslash;&n;&t;create_setter(kind, sub, reg); &bslash;&n;&t;create_sysfs_device_rw(kind, sub,);
DECL|macro|sysfs_fan_with_min
mdefine_line|#define sysfs_fan_with_min(offset, reg_status, reg_ripple, reg_min) &bslash;&n;&t;sysfs_fan(offset, reg_status, reg_ripple); &bslash;&n;&t;sysfs_rw_n(pwm,, offset, reg_min);
DECL|macro|sysfs_fan
mdefine_line|#define sysfs_fan(offset, reg_status, reg_ripple) &bslash;&n;&t;sysfs_ro_n(fan, _input, offset); &bslash;&n;&t;sysfs_ro_n(fan, _status, offset); &bslash;&n;&t;sysfs_rw_n(fan, _ripple, offset, reg_ripple);
DECL|macro|sysfs_temp
mdefine_line|#define sysfs_temp(offset, reg_status) &bslash;&n;&t;sysfs_ro_n(temp, _input, offset); &bslash;&n;&t;sysfs_ro_n(temp, _status, offset); &bslash;&n;&t;sysfs_rw_n(temp, _reset, offset, reg_status);
DECL|macro|sysfs_watchdog
mdefine_line|#define sysfs_watchdog(reg_wdog_preset, reg_wdog_state, reg_wdog_control) &bslash;&n;&t;sysfs_rw(wdog, _control, reg_wdog_control); &bslash;&n;&t;sysfs_rw(wdog, _preset, reg_wdog_preset); &bslash;&n;&t;sysfs_rw(wdog, _state, reg_wdog_state);
id|sysfs_fan_with_min
c_func
(paren
l_int|1
comma
id|FSCPOS_REG_FAN_STATE
(braket
l_int|0
)braket
comma
id|FSCPOS_REG_FAN_RIPPLE
(braket
l_int|0
)braket
comma
id|FSCPOS_REG_PWM
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sysfs_fan_with_min
c_func
(paren
l_int|2
comma
id|FSCPOS_REG_FAN_STATE
(braket
l_int|1
)braket
comma
id|FSCPOS_REG_FAN_RIPPLE
(braket
l_int|1
)braket
comma
id|FSCPOS_REG_PWM
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|sysfs_fan
c_func
(paren
l_int|3
comma
id|FSCPOS_REG_FAN_STATE
(braket
l_int|2
)braket
comma
id|FSCPOS_REG_FAN_RIPPLE
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|sysfs_temp
c_func
(paren
l_int|1
comma
id|FSCPOS_REG_TEMP_STATE
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sysfs_temp
c_func
(paren
l_int|2
comma
id|FSCPOS_REG_TEMP_STATE
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|sysfs_temp
c_func
(paren
l_int|3
comma
id|FSCPOS_REG_TEMP_STATE
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|sysfs_watchdog
c_func
(paren
id|FSCPOS_REG_WDOG_PRESET
comma
id|FSCPOS_REG_WDOG_STATE
comma
id|FSCPOS_REG_WDOG_CONTROL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|event
comma
id|S_IRUGO
comma
id|show_event
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_input
comma
id|S_IRUGO
comma
id|show_volt_12
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in1_input
comma
id|S_IRUGO
comma
id|show_volt_5
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in2_input
comma
id|S_IRUGO
comma
id|show_volt_batt
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|fscpos_attach_adapter
r_static
r_int
id|fscpos_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|fscpos_detect
)paren
suffix:semicolon
)brace
DECL|function|fscpos_detect
r_int
id|fscpos_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|fscpos_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_BYTE_DATA
)paren
)paren
r_goto
m_exit
suffix:semicolon
multiline_comment|/*&n;&t; * OK. For now, we presume we have a valid client. We now create the&n;&t; * client structure, even though we cannot fill it completely yet.&n;&t; * But it allows us to access fscpos_{read,write}_value.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fscpos_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fscpos_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|fscpos_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Do the remaining detection unless force or force_fscpos parameter */
r_if
c_cond
(paren
id|kind
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|fscpos_read_value
c_func
(paren
id|new_client
comma
id|FSCPOS_REG_IDENT_0
)paren
op_ne
l_int|0x50
)paren
multiline_comment|/* &squot;P&squot; */
op_logical_or
(paren
id|fscpos_read_value
c_func
(paren
id|new_client
comma
id|FSCPOS_REG_IDENT_1
)paren
op_ne
l_int|0x45
)paren
multiline_comment|/* &squot;E&squot; */
op_logical_or
(paren
id|fscpos_read_value
c_func
(paren
id|new_client
comma
id|FSCPOS_REG_IDENT_2
)paren
op_ne
l_int|0x47
)paren
)paren
multiline_comment|/* &squot;G&squot; */
(brace
id|dev_dbg
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;fscpos detection failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|exit_free
suffix:semicolon
)brace
)brace
multiline_comment|/* Fill in the remaining client fields and put it in the global list */
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
l_string|&quot;fscpos&quot;
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|exit_free
suffix:semicolon
multiline_comment|/* Inizialize the fscpos chip */
id|fscpos_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* Announce that the chip was found */
id|dev_info
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;Found fscpos chip, rev %u&bslash;n&quot;
comma
id|data-&gt;revision
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_event
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_wdog_control
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_wdog_preset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_wdog_state
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_reset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_reset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_reset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_ripple
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_ripple
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_status
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_ripple
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|exit_free
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|fscpos_detach_client
r_static
r_int
id|fscpos_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, client&quot;
l_string|&quot; not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fscpos_read_value
r_static
r_int
id|fscpos_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Read reg 0x%02x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
id|i2c_smbus_read_byte_data
c_func
(paren
id|client
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|fscpos_write_value
r_static
r_int
id|fscpos_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Write reg 0x%02x, val 0x%02x&bslash;n&quot;
comma
id|reg
comma
id|value
)paren
suffix:semicolon
r_return
id|i2c_smbus_write_byte_data
c_func
(paren
id|client
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new FSCPOS chip */
DECL|function|fscpos_init_client
r_static
r_void
id|fscpos_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
multiline_comment|/* read revision from chip */
id|data-&gt;revision
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_REVISION
)paren
suffix:semicolon
)brace
DECL|function|fscpos_update_device
r_static
r_struct
id|fscpos_data
op_star
id|fscpos_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|fscpos_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|data-&gt;last_updated
OG
l_int|2
op_star
id|HZ
)paren
op_logical_or
(paren
id|jiffies
OL
id|data-&gt;last_updated
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Starting fscpos update&bslash;n&quot;
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;temp_act
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_TEMP_ACT
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;temp_status
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_TEMP_STATE
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;fan_act
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_FAN_ACT
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;fan_status
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_FAN_STATE
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;fan_ripple
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_FAN_RIPPLE
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|2
)paren
(brace
multiline_comment|/* fan2_min is not supported by the chip */
id|data-&gt;pwm
(braket
id|i
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_PWM
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* reset fan status if speed is back to &gt; 0 */
r_if
c_cond
(paren
id|data-&gt;fan_status
(braket
id|i
)braket
op_ne
l_int|0
op_logical_and
id|data-&gt;fan_act
(braket
id|i
)braket
OG
l_int|0
)paren
(brace
id|reset_fan_alarm
c_func
(paren
id|client
comma
id|i
)paren
suffix:semicolon
)brace
)brace
id|data-&gt;volt
(braket
l_int|0
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_VOLT_12
)paren
suffix:semicolon
id|data-&gt;volt
(braket
l_int|1
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_VOLT_5
)paren
suffix:semicolon
id|data-&gt;volt
(braket
l_int|2
)braket
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_VOLT_BATT
)paren
suffix:semicolon
id|data-&gt;wdog_preset
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_WDOG_PRESET
)paren
suffix:semicolon
id|data-&gt;wdog_state
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_WDOG_STATE
)paren
suffix:semicolon
id|data-&gt;wdog_control
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_WDOG_CONTROL
)paren
suffix:semicolon
id|data-&gt;global_event
op_assign
id|fscpos_read_value
c_func
(paren
id|client
comma
id|FSCPOS_REG_EVENT_STATE
)paren
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|sm_fscpos_init
r_static
r_int
id|__init
id|sm_fscpos_init
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|fscpos_driver
)paren
suffix:semicolon
)brace
DECL|function|sm_fscpos_exit
r_static
r_void
id|__exit
id|sm_fscpos_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|fscpos_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Stefan Ott &lt;stefan@desire.ch&gt; based on work from Hermann Jung &quot;
l_string|&quot;&lt;hej@odn.de&gt;, Frodo Looijaard &lt;frodol@dds.nl&gt;&quot;
l_string|&quot; and Philip Edelbrock &lt;phil@netroedge.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;fujitsu siemens poseidon chip driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sm_fscpos_init
id|module_init
c_func
(paren
id|sm_fscpos_init
)paren
suffix:semicolon
DECL|variable|sm_fscpos_exit
id|module_exit
c_func
(paren
id|sm_fscpos_exit
)paren
suffix:semicolon
eof
