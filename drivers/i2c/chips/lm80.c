multiline_comment|/*&n; * lm80.c - From lm_sensors, Linux kernel modules for hardware&n; * monitoring&n; * Copyright (C) 1998, 1999  Frodo Looijaard &lt;frodol@dds.nl&gt;&n; * and Philip Edelbrock &lt;phil@netroedge.com&gt;&n; *&n; * Ported to Linux 2.6 by Tiago Sousa &lt;mirage@kaotik.org&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
multiline_comment|/* Addresses to scan */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
l_int|0x28
comma
l_int|0x29
comma
l_int|0x2a
comma
l_int|0x2b
comma
l_int|0x2c
comma
l_int|0x2d
comma
l_int|0x2e
comma
l_int|0x2f
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/* Insmod parameters */
DECL|variable|lm80
id|SENSORS_INSMOD_1
c_func
(paren
id|lm80
)paren
suffix:semicolon
multiline_comment|/* Many LM80 constants specified below */
multiline_comment|/* The LM80 registers */
DECL|macro|LM80_REG_IN_MAX
mdefine_line|#define LM80_REG_IN_MAX(nr)&t;&t;(0x2a + (nr) * 2)
DECL|macro|LM80_REG_IN_MIN
mdefine_line|#define LM80_REG_IN_MIN(nr)&t;&t;(0x2b + (nr) * 2)
DECL|macro|LM80_REG_IN
mdefine_line|#define LM80_REG_IN(nr)&t;&t;&t;(0x20 + (nr))
DECL|macro|LM80_REG_FAN1
mdefine_line|#define LM80_REG_FAN1&t;&t;&t;0x28
DECL|macro|LM80_REG_FAN2
mdefine_line|#define LM80_REG_FAN2&t;&t;&t;0x29
DECL|macro|LM80_REG_FAN_MIN
mdefine_line|#define LM80_REG_FAN_MIN(nr)&t;&t;(0x3b + (nr))
DECL|macro|LM80_REG_TEMP
mdefine_line|#define LM80_REG_TEMP&t;&t;&t;0x27
DECL|macro|LM80_REG_TEMP_HOT_MAX
mdefine_line|#define LM80_REG_TEMP_HOT_MAX&t;&t;0x38
DECL|macro|LM80_REG_TEMP_HOT_HYST
mdefine_line|#define LM80_REG_TEMP_HOT_HYST&t;&t;0x39
DECL|macro|LM80_REG_TEMP_OS_MAX
mdefine_line|#define LM80_REG_TEMP_OS_MAX&t;&t;0x3a
DECL|macro|LM80_REG_TEMP_OS_HYST
mdefine_line|#define LM80_REG_TEMP_OS_HYST&t;&t;0x3b
DECL|macro|LM80_REG_CONFIG
mdefine_line|#define LM80_REG_CONFIG&t;&t;&t;0x00
DECL|macro|LM80_REG_ALARM1
mdefine_line|#define LM80_REG_ALARM1&t;&t;&t;0x01
DECL|macro|LM80_REG_ALARM2
mdefine_line|#define LM80_REG_ALARM2&t;&t;&t;0x02
DECL|macro|LM80_REG_MASK1
mdefine_line|#define LM80_REG_MASK1&t;&t;&t;0x03
DECL|macro|LM80_REG_MASK2
mdefine_line|#define LM80_REG_MASK2&t;&t;&t;0x04
DECL|macro|LM80_REG_FANDIV
mdefine_line|#define LM80_REG_FANDIV&t;&t;&t;0x05
DECL|macro|LM80_REG_RES
mdefine_line|#define LM80_REG_RES&t;&t;&t;0x06
multiline_comment|/* Conversions. Rounding and limit checking is only done on the TO_REG&n;   variants. Note that you should be a bit careful with which arguments&n;   these macros are called: arguments may be evaluated more than once.&n;   Fixing this is just not worth it. */
DECL|macro|IN_TO_REG
mdefine_line|#define IN_TO_REG(val)&t;&t;(SENSORS_LIMIT(((val)+5)/10,0,255))
DECL|macro|IN_FROM_REG
mdefine_line|#define IN_FROM_REG(val)&t;((val)*10)
DECL|function|FAN_TO_REG
r_static
r_inline
r_int
r_char
id|FAN_TO_REG
c_func
(paren
r_int
id|rpm
comma
r_int
id|div
)paren
(brace
r_if
c_cond
(paren
id|rpm
op_eq
l_int|0
)paren
r_return
l_int|255
suffix:semicolon
id|rpm
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|rpm
comma
l_int|1
comma
l_int|1000000
)paren
suffix:semicolon
r_return
id|SENSORS_LIMIT
c_func
(paren
(paren
l_int|1350000
op_plus
id|rpm
op_star
id|div
op_div
l_int|2
)paren
op_div
(paren
id|rpm
op_star
id|div
)paren
comma
l_int|1
comma
l_int|254
)paren
suffix:semicolon
)brace
DECL|macro|FAN_FROM_REG
mdefine_line|#define FAN_FROM_REG(val,div)&t;((val)==0?-1:&bslash;&n;&t;&t;&t;&t;(val)==255?0:1350000/((div)*(val)))
DECL|function|TEMP_FROM_REG
r_static
r_inline
r_int
id|TEMP_FROM_REG
c_func
(paren
id|u16
id|temp
)paren
(brace
r_int
id|res
suffix:semicolon
id|temp
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|temp
OL
l_int|0x0800
)paren
id|res
op_assign
l_int|625
op_star
(paren
r_int
)paren
id|temp
suffix:semicolon
r_else
id|res
op_assign
(paren
(paren
r_int
)paren
id|temp
op_minus
l_int|0x01000
)paren
op_star
l_int|625
suffix:semicolon
r_return
id|res
op_div
l_int|10
suffix:semicolon
)brace
DECL|macro|TEMP_LIMIT_FROM_REG
mdefine_line|#define TEMP_LIMIT_FROM_REG(val)&t;(((val)&gt;0x80?(val)-0x100:(val))*1000)
DECL|macro|TEMP_LIMIT_TO_REG
mdefine_line|#define TEMP_LIMIT_TO_REG(val)&t;&t;SENSORS_LIMIT((val)&lt;0?&bslash;&n;&t;&t;&t;&t;&t;((val)-500)/1000:((val)+500)/1000,0,255)
DECL|macro|DIV_FROM_REG
mdefine_line|#define DIV_FROM_REG(val)&t;&t;(1 &lt;&lt; (val))
multiline_comment|/*&n; * Client data (each client gets its own)&n; */
DECL|struct|lm80_data
r_struct
id|lm80_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* !=0 if following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|in
id|u8
id|in
(braket
l_int|7
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_max
id|u8
id|in_max
(braket
l_int|7
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_min
id|u8
id|in_min
(braket
l_int|7
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan
id|u8
id|fan
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_div
id|u8
id|fan_div
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register encoding, shifted right */
DECL|member|temp
id|u16
id|temp
suffix:semicolon
multiline_comment|/* Register values, shifted right */
DECL|member|temp_hot_max
id|u8
id|temp_hot_max
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_hot_hyst
id|u8
id|temp_hot_hyst
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_os_max
id|u8
id|temp_os_max
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_os_hyst
id|u8
id|temp_os_hyst
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|alarms
id|u16
id|alarms
suffix:semicolon
multiline_comment|/* Register encoding, combined */
)brace
suffix:semicolon
multiline_comment|/* &n; * Functions declaration&n; */
r_static
r_int
id|lm80_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|lm80_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_void
id|lm80_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|lm80_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_struct
id|lm80_data
op_star
id|lm80_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|lm80_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
suffix:semicolon
r_static
r_int
id|lm80_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
suffix:semicolon
multiline_comment|/*&n; * Driver data (common to all clients)&n; */
DECL|variable|lm80_driver
r_static
r_struct
id|i2c_driver
id|lm80_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;lm80&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_LM80
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|lm80_attach_adapter
comma
dot
id|detach_client
op_assign
id|lm80_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Sysfs stuff&n; */
DECL|macro|show_in
mdefine_line|#define show_in(suffix, value) &bslash;&n;static ssize_t show_in_##suffix(struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct lm80_data *data = lm80_update_device(dev); &bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, IN_FROM_REG(data-&gt;value)); &bslash;&n;}
id|show_in
c_func
(paren
id|min0
comma
id|in_min
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min1
comma
id|in_min
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min2
comma
id|in_min
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min3
comma
id|in_min
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min4
comma
id|in_min
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min5
comma
id|in_min
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|min6
comma
id|in_min
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max0
comma
id|in_max
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max1
comma
id|in_max
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max2
comma
id|in_max
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max3
comma
id|in_max
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max4
comma
id|in_max
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max5
comma
id|in_max
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|max6
comma
id|in_max
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input0
comma
id|in
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input1
comma
id|in
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input2
comma
id|in
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input3
comma
id|in
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input4
comma
id|in
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input5
comma
id|in
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|show_in
c_func
(paren
id|input6
comma
id|in
(braket
l_int|6
)braket
)paren
suffix:semicolon
DECL|macro|set_in
mdefine_line|#define set_in(suffix, value, reg) &bslash;&n;static ssize_t set_in_##suffix(struct device *dev, const char *buf, &bslash;&n;&t;size_t count) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct lm80_data *data = i2c_get_clientdata(client); &bslash;&n;&t;long val = simple_strtol(buf, NULL, 10); &bslash;&n;&t;data-&gt;value = IN_TO_REG(val); &bslash;&n;&t;lm80_write_value(client, reg, data-&gt;value); &bslash;&n;&t;return count; &bslash;&n;}
id|set_in
c_func
(paren
id|min0
comma
id|in_min
(braket
l_int|0
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min1
comma
id|in_min
(braket
l_int|1
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min2
comma
id|in_min
(braket
l_int|2
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min3
comma
id|in_min
(braket
l_int|3
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min4
comma
id|in_min
(braket
l_int|4
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|4
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min5
comma
id|in_min
(braket
l_int|5
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|5
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|min6
comma
id|in_min
(braket
l_int|6
)braket
comma
id|LM80_REG_IN_MIN
c_func
(paren
l_int|6
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max0
comma
id|in_max
(braket
l_int|0
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max1
comma
id|in_max
(braket
l_int|1
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max2
comma
id|in_max
(braket
l_int|2
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max3
comma
id|in_max
(braket
l_int|3
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max4
comma
id|in_max
(braket
l_int|4
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|4
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max5
comma
id|in_max
(braket
l_int|5
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|5
)paren
)paren
suffix:semicolon
id|set_in
c_func
(paren
id|max6
comma
id|in_max
(braket
l_int|6
)braket
comma
id|LM80_REG_IN_MAX
c_func
(paren
l_int|6
)paren
)paren
suffix:semicolon
DECL|macro|show_fan
mdefine_line|#define show_fan(suffix, value, div) &bslash;&n;static ssize_t show_fan_##suffix(struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct lm80_data *data = lm80_update_device(dev); &bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, FAN_FROM_REG(data-&gt;value, &bslash;&n;&t;&t;       DIV_FROM_REG(data-&gt;div))); &bslash;&n;}
id|show_fan
c_func
(paren
id|min1
comma
id|fan_min
(braket
l_int|0
)braket
comma
id|fan_div
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_fan
c_func
(paren
id|min2
comma
id|fan_min
(braket
l_int|1
)braket
comma
id|fan_div
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|show_fan
c_func
(paren
id|input1
comma
id|fan
(braket
l_int|0
)braket
comma
id|fan_div
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_fan
c_func
(paren
id|input2
comma
id|fan
(braket
l_int|1
)braket
comma
id|fan_div
(braket
l_int|1
)braket
)paren
suffix:semicolon
DECL|macro|show_fan_div
mdefine_line|#define show_fan_div(suffix, value) &bslash;&n;static ssize_t show_fan_div##suffix(struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct lm80_data *data = lm80_update_device(dev); &bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, DIV_FROM_REG(data-&gt;value)); &bslash;&n;}
id|show_fan_div
c_func
(paren
l_int|1
comma
id|fan_div
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|show_fan_div
c_func
(paren
l_int|2
comma
id|fan_div
(braket
l_int|1
)braket
)paren
suffix:semicolon
DECL|macro|set_fan
mdefine_line|#define set_fan(suffix, value, reg, div) &bslash;&n;static ssize_t set_fan_##suffix(struct device *dev, const char *buf, &bslash;&n;&t;size_t count) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct lm80_data *data = i2c_get_clientdata(client); &bslash;&n;&t;long val = simple_strtoul(buf, NULL, 10); &bslash;&n;&t;data-&gt;value = FAN_TO_REG(val, DIV_FROM_REG(data-&gt;div)); &bslash;&n;&t;lm80_write_value(client, reg, data-&gt;value); &bslash;&n;&t;return count; &bslash;&n;}
id|set_fan
c_func
(paren
id|min1
comma
id|fan_min
(braket
l_int|0
)braket
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|1
)paren
comma
id|fan_div
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|set_fan
c_func
(paren
id|min2
comma
id|fan_min
(braket
l_int|1
)braket
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|2
)paren
comma
id|fan_div
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* Note: we save and restore the fan minimum here, because its value is&n;   determined in part by the fan divisor.  This follows the principle of&n;   least suprise; the user doesn&squot;t expect the fan minimum to change just&n;   because the divisor changed. */
DECL|function|set_fan_div
r_static
id|ssize_t
id|set_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|lm80_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|min
comma
id|val
suffix:semicolon
id|u8
id|reg
suffix:semicolon
multiline_comment|/* Save fan_min */
id|min
op_assign
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|1
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;fan_div value %ld not &quot;
l_string|&quot;supported. Choose one of 1, 2, 4 or 8!&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|reg
op_assign
(paren
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FANDIV
)paren
op_amp
op_complement
(paren
l_int|3
op_lshift
(paren
l_int|2
op_star
(paren
id|nr
op_plus
l_int|1
)paren
)paren
)paren
)paren
op_or
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_lshift
(paren
l_int|2
op_star
(paren
id|nr
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|lm80_write_value
c_func
(paren
id|client
comma
id|LM80_REG_FANDIV
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Restore fan_min */
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|min
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|lm80_write_value
c_func
(paren
id|client
comma
id|LM80_REG_FAN_MIN
c_func
(paren
id|nr
op_plus
l_int|1
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|set_fan_div
mdefine_line|#define set_fan_div(number) &bslash;&n;static ssize_t set_fan_div##number(struct device *dev, const char *buf, &bslash;&n;&t;size_t count) &bslash;&n;{ &bslash;&n;&t;return set_fan_div(dev, buf, count, number - 1); &bslash;&n;}
id|set_fan_div
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_fan_div
c_func
(paren
l_int|2
)paren
suffix:semicolon
DECL|function|show_temp_input1
r_static
id|ssize_t
id|show_temp_input1
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|lm80_data
op_star
id|data
op_assign
id|lm80_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp
)paren
)paren
suffix:semicolon
)brace
DECL|macro|show_temp
mdefine_line|#define show_temp(suffix, value) &bslash;&n;static ssize_t show_temp_##suffix(struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct lm80_data *data = lm80_update_device(dev); &bslash;&n;&t;return sprintf(buf, &quot;%d&bslash;n&quot;, TEMP_LIMIT_FROM_REG(data-&gt;value)); &bslash;&n;}
id|show_temp
c_func
(paren
id|hot_max
comma
id|temp_hot_max
)paren
suffix:semicolon
id|show_temp
c_func
(paren
id|hot_hyst
comma
id|temp_hot_hyst
)paren
suffix:semicolon
id|show_temp
c_func
(paren
id|os_max
comma
id|temp_os_max
)paren
suffix:semicolon
id|show_temp
c_func
(paren
id|os_hyst
comma
id|temp_os_hyst
)paren
suffix:semicolon
DECL|macro|set_temp
mdefine_line|#define set_temp(suffix, value, reg) &bslash;&n;static ssize_t set_temp_##suffix(struct device *dev, const char *buf, &bslash;&n;&t;size_t count) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct lm80_data *data = i2c_get_clientdata(client); &bslash;&n;&t;long val = simple_strtoul(buf, NULL, 10); &bslash;&n;&t;data-&gt;value = TEMP_LIMIT_TO_REG(val); &bslash;&n;&t;lm80_write_value(client, reg, data-&gt;value); &bslash;&n;&t;return count; &bslash;&n;}
id|set_temp
c_func
(paren
id|hot_max
comma
id|temp_hot_max
comma
id|LM80_REG_TEMP_HOT_MAX
)paren
suffix:semicolon
id|set_temp
c_func
(paren
id|hot_hyst
comma
id|temp_hot_hyst
comma
id|LM80_REG_TEMP_HOT_HYST
)paren
suffix:semicolon
id|set_temp
c_func
(paren
id|os_max
comma
id|temp_os_max
comma
id|LM80_REG_TEMP_OS_MAX
)paren
suffix:semicolon
id|set_temp
c_func
(paren
id|os_hyst
comma
id|temp_os_hyst
comma
id|LM80_REG_TEMP_OS_HYST
)paren
suffix:semicolon
DECL|function|show_alarms
r_static
id|ssize_t
id|show_alarms
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|lm80_data
op_star
id|data
op_assign
id|lm80_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;alarms
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min0
comma
id|set_in_min0
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in1_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min1
comma
id|set_in_min1
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in2_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min2
comma
id|set_in_min2
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in3_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min3
comma
id|set_in_min3
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in4_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min4
comma
id|set_in_min4
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in5_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min5
comma
id|set_in_min5
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in6_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_min6
comma
id|set_in_min6
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max0
comma
id|set_in_max0
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in1_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max1
comma
id|set_in_max1
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in2_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max2
comma
id|set_in_max2
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in3_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max3
comma
id|set_in_max3
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in4_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max4
comma
id|set_in_max4
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in5_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max5
comma
id|set_in_max5
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in6_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_in_max6
comma
id|set_in_max6
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_input
comma
id|S_IRUGO
comma
id|show_in_input0
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in1_input
comma
id|S_IRUGO
comma
id|show_in_input1
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in2_input
comma
id|S_IRUGO
comma
id|show_in_input2
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in3_input
comma
id|S_IRUGO
comma
id|show_in_input3
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in4_input
comma
id|S_IRUGO
comma
id|show_in_input4
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in5_input
comma
id|S_IRUGO
comma
id|show_in_input5
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in6_input
comma
id|S_IRUGO
comma
id|show_in_input6
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan1_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_fan_min1
comma
id|set_fan_min1
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan2_min
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_fan_min2
comma
id|set_fan_min2
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan1_input
comma
id|S_IRUGO
comma
id|show_fan_input1
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan2_input
comma
id|S_IRUGO
comma
id|show_fan_input2
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan1_div
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_fan_div1
comma
id|set_fan_div1
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan2_div
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_fan_div2
comma
id|set_fan_div2
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_input
comma
id|S_IRUGO
comma
id|show_temp_input1
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_max
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_temp_hot_max
comma
id|set_temp_hot_max
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_max_hyst
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_temp_hot_hyst
comma
id|set_temp_hot_hyst
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_crit
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_temp_os_max
comma
id|set_temp_os_max
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_crit_hyst
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show_temp_os_hyst
comma
id|set_temp_os_hyst
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarms
comma
id|S_IRUGO
comma
id|show_alarms
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n; * Real code&n; */
DECL|function|lm80_attach_adapter
r_static
r_int
id|lm80_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|lm80_detect
)paren
suffix:semicolon
)brace
DECL|function|lm80_detect
r_int
id|lm80_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_int
id|i
comma
id|cur
suffix:semicolon
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|lm80_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_BYTE_DATA
)paren
)paren
r_goto
m_exit
suffix:semicolon
multiline_comment|/* OK. For now, we presume we have a valid client. We now create the&n;&t;   client structure, even though we cannot fill it completely yet.&n;&t;   But it allows us to access lm80_{read,write}_value. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|lm80_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|lm80_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|lm80_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now, we do the remaining detection. It is lousy. */
r_if
c_cond
(paren
id|lm80_read_value
c_func
(paren
id|new_client
comma
id|LM80_REG_ALARM2
)paren
op_amp
l_int|0xc0
)paren
r_goto
id|error_free
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x2a
suffix:semicolon
id|i
op_le
l_int|0x3d
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cur
op_assign
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|i
op_plus
l_int|0x40
)paren
op_ne
id|cur
)paren
op_logical_or
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|i
op_plus
l_int|0x80
)paren
op_ne
id|cur
)paren
op_logical_or
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|i
op_plus
l_int|0xc0
)paren
op_ne
id|cur
)paren
)paren
r_goto
id|error_free
suffix:semicolon
)brace
multiline_comment|/* Determine the chip type - only one kind supported! */
id|kind
op_assign
id|lm80
suffix:semicolon
id|name
op_assign
l_string|&quot;lm80&quot;
suffix:semicolon
multiline_comment|/* Fill in the remaining client fields and put it into the global list */
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
id|name
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|error_free
suffix:semicolon
multiline_comment|/* Initialize the LM80 chip */
id|lm80_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* A few vars need to be filled upon startup */
id|data-&gt;fan_min
(braket
l_int|0
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|new_client
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|1
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|new_client
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_crit
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_crit_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_alarms
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error_free
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|lm80_detach_client
r_static
r_int
id|lm80_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, &quot;
l_string|&quot;client not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|lm80_read_value
r_static
r_int
id|lm80_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
r_return
id|i2c_smbus_read_byte_data
c_func
(paren
id|client
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|lm80_write_value
r_static
r_int
id|lm80_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
(brace
r_return
id|i2c_smbus_write_byte_data
c_func
(paren
id|client
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new LM80. */
DECL|function|lm80_init_client
r_static
r_void
id|lm80_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
multiline_comment|/* Reset all except Watchdog values and last conversion values&n;&t;   This sets fan-divs to 2, among others. This makes most other&n;&t;   initializations unnecessary */
id|lm80_write_value
c_func
(paren
id|client
comma
id|LM80_REG_CONFIG
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Set 11-bit temperature resolution */
id|lm80_write_value
c_func
(paren
id|client
comma
id|LM80_REG_RES
comma
l_int|0x08
)paren
suffix:semicolon
multiline_comment|/* Start monitoring */
id|lm80_write_value
c_func
(paren
id|client
comma
id|LM80_REG_CONFIG
comma
l_int|0x01
)paren
suffix:semicolon
)brace
DECL|function|lm80_update_device
r_static
r_struct
id|lm80_data
op_star
id|lm80_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|lm80_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|data-&gt;last_updated
OG
l_int|2
op_star
id|HZ
)paren
op_logical_or
(paren
id|jiffies
OL
id|data-&gt;last_updated
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Starting lm80 update&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;in
(braket
id|i
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_IN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|i
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_IN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|i
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_IN_MAX
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
id|data-&gt;fan
(braket
l_int|0
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FAN1
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|0
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;fan
(braket
l_int|1
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FAN2
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|1
)braket
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FAN_MIN
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|data-&gt;temp
op_assign
(paren
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_TEMP
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_RES
)paren
op_amp
l_int|0xf0
)paren
suffix:semicolon
id|data-&gt;temp_os_max
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_TEMP_OS_MAX
)paren
suffix:semicolon
id|data-&gt;temp_os_hyst
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_TEMP_OS_HYST
)paren
suffix:semicolon
id|data-&gt;temp_hot_max
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_TEMP_HOT_MAX
)paren
suffix:semicolon
id|data-&gt;temp_hot_hyst
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_TEMP_HOT_HYST
)paren
suffix:semicolon
id|i
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_FANDIV
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_assign
(paren
id|i
op_rshift
l_int|2
)paren
op_amp
l_int|0x03
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_assign
(paren
id|i
op_rshift
l_int|4
)paren
op_amp
l_int|0x03
suffix:semicolon
id|data-&gt;alarms
op_assign
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_ALARM1
)paren
op_plus
(paren
id|lm80_read_value
c_func
(paren
id|client
comma
id|LM80_REG_ALARM2
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|sensors_lm80_init
r_static
r_int
id|__init
id|sensors_lm80_init
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|lm80_driver
)paren
suffix:semicolon
)brace
DECL|function|sensors_lm80_exit
r_static
r_void
id|__exit
id|sensors_lm80_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|lm80_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Frodo Looijaard &lt;frodol@dds.nl&gt; and &quot;
l_string|&quot;Philip Edelbrock &lt;phil@netroedge.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;LM80 driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sensors_lm80_init
id|module_init
c_func
(paren
id|sensors_lm80_init
)paren
suffix:semicolon
DECL|variable|sensors_lm80_exit
id|module_exit
c_func
(paren
id|sensors_lm80_exit
)paren
suffix:semicolon
eof
