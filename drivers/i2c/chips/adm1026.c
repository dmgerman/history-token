multiline_comment|/*&n;    adm1026.c - Part of lm_sensors, Linux kernel modules for hardware&n;&t;     monitoring&n;    Copyright (C) 2002, 2003  Philip Pokorny &lt;ppokorny@penguincomputing.com&gt;&n;    Copyright (C) 2004 Justin Thiessen &lt;jthiessen@penguincomputing.com&gt;&n;&n;    Chip details at:&n;&n;    &lt;http://www.analog.com/UploadedFiles/Data_Sheets/779263102ADM1026_a.pdf&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
macro_line|#include &lt;linux/i2c-vid.h&gt;
multiline_comment|/* Addresses to scan */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
l_int|0x2c
comma
l_int|0x2d
comma
l_int|0x2e
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/* Insmod parameters */
DECL|variable|adm1026
id|SENSORS_INSMOD_1
c_func
(paren
id|adm1026
)paren
suffix:semicolon
DECL|variable|gpio_input
r_static
r_int
id|gpio_input
(braket
l_int|17
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|gpio_output
r_static
r_int
id|gpio_output
(braket
l_int|17
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|gpio_inverted
r_static
r_int
id|gpio_inverted
(braket
l_int|17
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|gpio_normal
r_static
r_int
id|gpio_normal
(braket
l_int|17
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|gpio_fan
r_static
r_int
id|gpio_fan
(braket
l_int|8
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
id|module_param_array
c_func
(paren
id|gpio_input
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_input
comma
l_string|&quot;List of GPIO pins (0-16) to program as inputs&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|gpio_output
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_output
comma
l_string|&quot;List of GPIO pins (0-16) to program as &quot;
l_string|&quot;outputs&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|gpio_inverted
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_inverted
comma
l_string|&quot;List of GPIO pins (0-16) to program as &quot;
l_string|&quot;inverted&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|gpio_normal
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_normal
comma
l_string|&quot;List of GPIO pins (0-16) to program as &quot;
l_string|&quot;normal/non-inverted&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|gpio_fan
comma
r_int
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_fan
comma
l_string|&quot;List of GPIO pins (0-7) to program as fan tachs&quot;
)paren
suffix:semicolon
multiline_comment|/* Many ADM1026 constants specified below */
multiline_comment|/* The ADM1026 registers */
DECL|macro|ADM1026_REG_CONFIG1
mdefine_line|#define ADM1026_REG_CONFIG1  0x00
DECL|macro|CFG1_MONITOR
mdefine_line|#define CFG1_MONITOR     0x01
DECL|macro|CFG1_INT_ENABLE
mdefine_line|#define CFG1_INT_ENABLE  0x02
DECL|macro|CFG1_INT_CLEAR
mdefine_line|#define CFG1_INT_CLEAR   0x04
DECL|macro|CFG1_AIN8_9
mdefine_line|#define CFG1_AIN8_9      0x08
DECL|macro|CFG1_THERM_HOT
mdefine_line|#define CFG1_THERM_HOT   0x10
DECL|macro|CFG1_DAC_AFC
mdefine_line|#define CFG1_DAC_AFC     0x20
DECL|macro|CFG1_PWM_AFC
mdefine_line|#define CFG1_PWM_AFC     0x40
DECL|macro|CFG1_RESET
mdefine_line|#define CFG1_RESET       0x80
DECL|macro|ADM1026_REG_CONFIG2
mdefine_line|#define ADM1026_REG_CONFIG2  0x01
multiline_comment|/* CONFIG2 controls FAN0/GPIO0 through FAN7/GPIO7 */
DECL|macro|ADM1026_REG_CONFIG3
mdefine_line|#define ADM1026_REG_CONFIG3  0x07
DECL|macro|CFG3_GPIO16_ENABLE
mdefine_line|#define CFG3_GPIO16_ENABLE  0x01
DECL|macro|CFG3_CI_CLEAR
mdefine_line|#define CFG3_CI_CLEAR  0x02
DECL|macro|CFG3_VREF_250
mdefine_line|#define CFG3_VREF_250  0x04
DECL|macro|CFG3_GPIO16_DIR
mdefine_line|#define CFG3_GPIO16_DIR  0x40
DECL|macro|CFG3_GPIO16_POL
mdefine_line|#define CFG3_GPIO16_POL  0x80
DECL|macro|ADM1026_REG_E2CONFIG
mdefine_line|#define ADM1026_REG_E2CONFIG  0x13
DECL|macro|E2CFG_READ
mdefine_line|#define E2CFG_READ  0x01
DECL|macro|E2CFG_WRITE
mdefine_line|#define E2CFG_WRITE  0x02
DECL|macro|E2CFG_ERASE
mdefine_line|#define E2CFG_ERASE  0x04
DECL|macro|E2CFG_ROM
mdefine_line|#define E2CFG_ROM  0x08
DECL|macro|E2CFG_CLK_EXT
mdefine_line|#define E2CFG_CLK_EXT  0x80
multiline_comment|/* There are 10 general analog inputs and 7 dedicated inputs&n; * They are:&n; *    0 - 9  =  AIN0 - AIN9&n; *       10  =  Vbat&n; *       11  =  3.3V Standby&n; *       12  =  3.3V Main&n; *       13  =  +5V&n; *       14  =  Vccp (CPU core voltage)&n; *       15  =  +12V&n; *       16  =  -12V&n; */
DECL|variable|ADM1026_REG_IN
r_static
id|u16
id|ADM1026_REG_IN
(braket
)braket
op_assign
(brace
l_int|0x30
comma
l_int|0x31
comma
l_int|0x32
comma
l_int|0x33
comma
l_int|0x34
comma
l_int|0x35
comma
l_int|0x36
comma
l_int|0x37
comma
l_int|0x27
comma
l_int|0x29
comma
l_int|0x26
comma
l_int|0x2a
comma
l_int|0x2b
comma
l_int|0x2c
comma
l_int|0x2d
comma
l_int|0x2e
comma
l_int|0x2f
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_IN_MIN
r_static
id|u16
id|ADM1026_REG_IN_MIN
(braket
)braket
op_assign
(brace
l_int|0x58
comma
l_int|0x59
comma
l_int|0x5a
comma
l_int|0x5b
comma
l_int|0x5c
comma
l_int|0x5d
comma
l_int|0x5e
comma
l_int|0x5f
comma
l_int|0x6d
comma
l_int|0x49
comma
l_int|0x6b
comma
l_int|0x4a
comma
l_int|0x4b
comma
l_int|0x4c
comma
l_int|0x4d
comma
l_int|0x4e
comma
l_int|0x4f
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_IN_MAX
r_static
id|u16
id|ADM1026_REG_IN_MAX
(braket
)braket
op_assign
(brace
l_int|0x50
comma
l_int|0x51
comma
l_int|0x52
comma
l_int|0x53
comma
l_int|0x54
comma
l_int|0x55
comma
l_int|0x56
comma
l_int|0x57
comma
l_int|0x6c
comma
l_int|0x41
comma
l_int|0x6a
comma
l_int|0x42
comma
l_int|0x43
comma
l_int|0x44
comma
l_int|0x45
comma
l_int|0x46
comma
l_int|0x47
)brace
suffix:semicolon
multiline_comment|/* Temperatures are:&n; *    0 - Internal&n; *    1 - External 1&n; *    2 - External 2&n; */
DECL|variable|ADM1026_REG_TEMP
r_static
id|u16
id|ADM1026_REG_TEMP
(braket
)braket
op_assign
(brace
l_int|0x1f
comma
l_int|0x28
comma
l_int|0x29
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_TEMP_MIN
r_static
id|u16
id|ADM1026_REG_TEMP_MIN
(braket
)braket
op_assign
(brace
l_int|0x69
comma
l_int|0x48
comma
l_int|0x49
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_TEMP_MAX
r_static
id|u16
id|ADM1026_REG_TEMP_MAX
(braket
)braket
op_assign
(brace
l_int|0x68
comma
l_int|0x40
comma
l_int|0x41
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_TEMP_TMIN
r_static
id|u16
id|ADM1026_REG_TEMP_TMIN
(braket
)braket
op_assign
(brace
l_int|0x10
comma
l_int|0x11
comma
l_int|0x12
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_TEMP_THERM
r_static
id|u16
id|ADM1026_REG_TEMP_THERM
(braket
)braket
op_assign
(brace
l_int|0x0d
comma
l_int|0x0e
comma
l_int|0x0f
)brace
suffix:semicolon
DECL|variable|ADM1026_REG_TEMP_OFFSET
r_static
id|u16
id|ADM1026_REG_TEMP_OFFSET
(braket
)braket
op_assign
(brace
l_int|0x1e
comma
l_int|0x6e
comma
l_int|0x6f
)brace
suffix:semicolon
DECL|macro|ADM1026_REG_FAN
mdefine_line|#define ADM1026_REG_FAN(nr) (0x38 + (nr))
DECL|macro|ADM1026_REG_FAN_MIN
mdefine_line|#define ADM1026_REG_FAN_MIN(nr) (0x60 + (nr))
DECL|macro|ADM1026_REG_FAN_DIV_0_3
mdefine_line|#define ADM1026_REG_FAN_DIV_0_3 0x02
DECL|macro|ADM1026_REG_FAN_DIV_4_7
mdefine_line|#define ADM1026_REG_FAN_DIV_4_7 0x03
DECL|macro|ADM1026_REG_DAC
mdefine_line|#define ADM1026_REG_DAC  0x04
DECL|macro|ADM1026_REG_PWM
mdefine_line|#define ADM1026_REG_PWM  0x05
DECL|macro|ADM1026_REG_GPIO_CFG_0_3
mdefine_line|#define ADM1026_REG_GPIO_CFG_0_3 0x08
DECL|macro|ADM1026_REG_GPIO_CFG_4_7
mdefine_line|#define ADM1026_REG_GPIO_CFG_4_7 0x09
DECL|macro|ADM1026_REG_GPIO_CFG_8_11
mdefine_line|#define ADM1026_REG_GPIO_CFG_8_11 0x0a
DECL|macro|ADM1026_REG_GPIO_CFG_12_15
mdefine_line|#define ADM1026_REG_GPIO_CFG_12_15 0x0b
multiline_comment|/* CFG_16 in REG_CFG3 */
DECL|macro|ADM1026_REG_GPIO_STATUS_0_7
mdefine_line|#define ADM1026_REG_GPIO_STATUS_0_7 0x24
DECL|macro|ADM1026_REG_GPIO_STATUS_8_15
mdefine_line|#define ADM1026_REG_GPIO_STATUS_8_15 0x25
multiline_comment|/* STATUS_16 in REG_STATUS4 */
DECL|macro|ADM1026_REG_GPIO_MASK_0_7
mdefine_line|#define ADM1026_REG_GPIO_MASK_0_7 0x1c
DECL|macro|ADM1026_REG_GPIO_MASK_8_15
mdefine_line|#define ADM1026_REG_GPIO_MASK_8_15 0x1d
multiline_comment|/* MASK_16 in REG_MASK4 */
DECL|macro|ADM1026_REG_COMPANY
mdefine_line|#define ADM1026_REG_COMPANY 0x16
DECL|macro|ADM1026_REG_VERSTEP
mdefine_line|#define ADM1026_REG_VERSTEP 0x17
multiline_comment|/* These are the recognized values for the above regs */
DECL|macro|ADM1026_COMPANY_ANALOG_DEV
mdefine_line|#define ADM1026_COMPANY_ANALOG_DEV 0x41
DECL|macro|ADM1026_VERSTEP_GENERIC
mdefine_line|#define ADM1026_VERSTEP_GENERIC 0x40
DECL|macro|ADM1026_VERSTEP_ADM1026
mdefine_line|#define ADM1026_VERSTEP_ADM1026 0x44
DECL|macro|ADM1026_REG_MASK1
mdefine_line|#define ADM1026_REG_MASK1 0x18
DECL|macro|ADM1026_REG_MASK2
mdefine_line|#define ADM1026_REG_MASK2 0x19
DECL|macro|ADM1026_REG_MASK3
mdefine_line|#define ADM1026_REG_MASK3 0x1a
DECL|macro|ADM1026_REG_MASK4
mdefine_line|#define ADM1026_REG_MASK4 0x1b
DECL|macro|ADM1026_REG_STATUS1
mdefine_line|#define ADM1026_REG_STATUS1 0x20
DECL|macro|ADM1026_REG_STATUS2
mdefine_line|#define ADM1026_REG_STATUS2 0x21
DECL|macro|ADM1026_REG_STATUS3
mdefine_line|#define ADM1026_REG_STATUS3 0x22
DECL|macro|ADM1026_REG_STATUS4
mdefine_line|#define ADM1026_REG_STATUS4 0x23
DECL|macro|ADM1026_FAN_ACTIVATION_TEMP_HYST
mdefine_line|#define ADM1026_FAN_ACTIVATION_TEMP_HYST -6
DECL|macro|ADM1026_FAN_CONTROL_TEMP_RANGE
mdefine_line|#define ADM1026_FAN_CONTROL_TEMP_RANGE 20
DECL|macro|ADM1026_PWM_MAX
mdefine_line|#define ADM1026_PWM_MAX 255
multiline_comment|/* Conversions. Rounding and limit checking is only done on the TO_REG &n; * variants. Note that you should be a bit careful with which arguments&n; * these macros are called: arguments may be evaluated more than once.&n; */
multiline_comment|/* IN are scaled acording to built-in resistors.  These are the&n; *   voltages corresponding to 3/4 of full scale (192 or 0xc0)&n; *   NOTE: The -12V input needs an additional factor to account&n; *      for the Vref pullup resistor.&n; *      NEG12_OFFSET = SCALE * Vref / V-192 - Vref&n; *                   = 13875 * 2.50 / 1.875 - 2500&n; *                   = 16000&n; *&n; * The values in this table are based on Table II, page 15 of the&n; *    datasheet.&n; */
DECL|variable|adm1026_scaling
r_static
r_int
id|adm1026_scaling
(braket
)braket
op_assign
(brace
multiline_comment|/* .001 Volts */
l_int|2250
comma
l_int|2250
comma
l_int|2250
comma
l_int|2250
comma
l_int|2250
comma
l_int|2250
comma
l_int|1875
comma
l_int|1875
comma
l_int|1875
comma
l_int|1875
comma
l_int|3000
comma
l_int|3330
comma
l_int|3330
comma
l_int|4995
comma
l_int|2250
comma
l_int|12000
comma
l_int|13875
)brace
suffix:semicolon
DECL|macro|NEG12_OFFSET
mdefine_line|#define NEG12_OFFSET  16000
DECL|macro|SCALE
mdefine_line|#define SCALE(val,from,to) (((val)*(to) + ((from)/2))/(from))
DECL|macro|INS_TO_REG
mdefine_line|#define INS_TO_REG(n,val)  (SENSORS_LIMIT(SCALE(val,adm1026_scaling[n],192),&bslash;&n;&t;0,255))
DECL|macro|INS_FROM_REG
mdefine_line|#define INS_FROM_REG(n,val) (SCALE(val,192,adm1026_scaling[n]))
multiline_comment|/* FAN speed is measured using 22.5kHz clock and counts for 2 pulses&n; *   and we assume a 2 pulse-per-rev fan tach signal&n; *      22500 kHz * 60 (sec/min) * 2 (pulse) / 2 (pulse/rev) == 1350000&n; */
DECL|macro|FAN_TO_REG
mdefine_line|#define FAN_TO_REG(val,div)  ((val)&lt;=0 ? 0xff : SENSORS_LIMIT(1350000/((val)*&bslash;&n;&t;(div)),1,254)) 
DECL|macro|FAN_FROM_REG
mdefine_line|#define FAN_FROM_REG(val,div) ((val)==0?-1:(val)==0xff ? 0 : 1350000/((val)*&bslash;&n;&t;(div)))
DECL|macro|DIV_FROM_REG
mdefine_line|#define DIV_FROM_REG(val) (1&lt;&lt;(val))
DECL|macro|DIV_TO_REG
mdefine_line|#define DIV_TO_REG(val) ((val)&gt;=8 ? 3 : (val)&gt;=4 ? 2 : (val)&gt;=2 ? 1 : 0)
multiline_comment|/* Temperature is reported in 1 degC increments */
DECL|macro|TEMP_TO_REG
mdefine_line|#define TEMP_TO_REG(val) (SENSORS_LIMIT(((val)+((val)&lt;0 ? -500 : 500))/1000,&bslash;&n;&t;-127,127))
DECL|macro|TEMP_FROM_REG
mdefine_line|#define TEMP_FROM_REG(val) ((val) * 1000)
DECL|macro|OFFSET_TO_REG
mdefine_line|#define OFFSET_TO_REG(val) (SENSORS_LIMIT(((val)+((val)&lt;0 ? -500 : 500))/1000,&bslash;&n;&t;-127,127))
DECL|macro|OFFSET_FROM_REG
mdefine_line|#define OFFSET_FROM_REG(val) ((val) * 1000)
DECL|macro|PWM_TO_REG
mdefine_line|#define PWM_TO_REG(val) (SENSORS_LIMIT(val,0,255))
DECL|macro|PWM_FROM_REG
mdefine_line|#define PWM_FROM_REG(val) (val)
DECL|macro|PWM_MIN_TO_REG
mdefine_line|#define PWM_MIN_TO_REG(val) ((val) &amp; 0xf0)
DECL|macro|PWM_MIN_FROM_REG
mdefine_line|#define PWM_MIN_FROM_REG(val) (((val) &amp; 0xf0) + ((val) &gt;&gt; 4))
multiline_comment|/* Analog output is a voltage, and scaled to millivolts.  The datasheet &n; *   indicates that the DAC could be used to drive the fans, but in our &n; *   example board (Arima HDAMA) it isn&squot;t connected to the fans at all.&n; */
DECL|macro|DAC_TO_REG
mdefine_line|#define DAC_TO_REG(val) (SENSORS_LIMIT(((((val)*255)+500)/2500),0,255)) 
DECL|macro|DAC_FROM_REG
mdefine_line|#define DAC_FROM_REG(val) (((val)*2500)/255)
multiline_comment|/* Typically used with systems using a v9.1 VRM spec ? */
DECL|macro|ADM1026_INIT_VRM
mdefine_line|#define ADM1026_INIT_VRM  91
multiline_comment|/* Chip sampling rates&n; *&n; * Some sensors are not updated more frequently than once per second&n; *    so it doesn&squot;t make sense to read them more often than that.&n; *    We cache the results and return the saved data if the driver&n; *    is called again before a second has elapsed.&n; *&n; * Also, there is significant configuration data for this chip&n; *    So, we keep the config data up to date in the cache&n; *    when it is written and only sample it once every 5 *minutes*&n; */
DECL|macro|ADM1026_DATA_INTERVAL
mdefine_line|#define ADM1026_DATA_INTERVAL  (1 * HZ)
DECL|macro|ADM1026_CONFIG_INTERVAL
mdefine_line|#define ADM1026_CONFIG_INTERVAL  (5 * 60 * HZ)
multiline_comment|/* We allow for multiple chips in a single system.&n; *&n; * For each registered ADM1026, we need to keep state information&n; * at client-&gt;data. The adm1026_data structure is dynamically&n; * allocated, when a new client structure is allocated. */
DECL|struct|pwm_data
r_struct
id|pwm_data
(brace
DECL|member|pwm
id|u8
id|pwm
suffix:semicolon
DECL|member|enable
id|u8
id|enable
suffix:semicolon
DECL|member|auto_pwm_min
id|u8
id|auto_pwm_min
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|adm1026_data
r_struct
id|adm1026_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|lock
r_struct
id|semaphore
id|lock
suffix:semicolon
DECL|member|type
r_enum
id|chips
id|type
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_int
id|valid
suffix:semicolon
multiline_comment|/* !=0 if following fields are valid */
DECL|member|last_reading
r_int
r_int
id|last_reading
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|last_config
r_int
r_int
id|last_config
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|in
id|u8
id|in
(braket
l_int|17
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_max
id|u8
id|in_max
(braket
l_int|17
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_min
id|u8
id|in_min
(braket
l_int|17
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp
id|s8
id|temp
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_min
id|s8
id|temp_min
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_max
id|s8
id|temp_max
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_tmin
id|s8
id|temp_tmin
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_crit
id|s8
id|temp_crit
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_offset
id|s8
id|temp_offset
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan
id|u8
id|fan
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_div
id|u8
id|fan_div
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Decoded value */
DECL|member|pwm1
r_struct
id|pwm_data
id|pwm1
suffix:semicolon
multiline_comment|/* Pwm control values */
DECL|member|vid
r_int
id|vid
suffix:semicolon
multiline_comment|/* Decoded value */
DECL|member|vrm
id|u8
id|vrm
suffix:semicolon
multiline_comment|/* VRM version */
DECL|member|analog_out
id|u8
id|analog_out
suffix:semicolon
multiline_comment|/* Register value (DAC) */
DECL|member|alarms
r_int
id|alarms
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|alarm_mask
r_int
id|alarm_mask
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|gpio
r_int
id|gpio
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|gpio_mask
r_int
id|gpio_mask
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|gpio_config
id|u8
id|gpio_config
(braket
l_int|17
)braket
suffix:semicolon
multiline_comment|/* Decoded value */
DECL|member|config1
id|u8
id|config1
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|config2
id|u8
id|config2
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|config3
id|u8
id|config3
suffix:semicolon
multiline_comment|/* Register value */
)brace
suffix:semicolon
r_static
r_int
id|adm1026_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|adm1026_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|adm1026_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|adm1026_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
)paren
suffix:semicolon
r_static
r_int
id|adm1026_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|adm1026_print_gpio
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_void
id|adm1026_fixup_gpio
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_struct
id|adm1026_data
op_star
id|adm1026_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|adm1026_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
DECL|variable|adm1026_driver
r_static
r_struct
id|i2c_driver
id|adm1026_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;adm1026&quot;
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|adm1026_attach_adapter
comma
dot
id|detach_client
op_assign
id|adm1026_detach_client
comma
)brace
suffix:semicolon
DECL|variable|adm1026_id
r_static
r_int
id|adm1026_id
suffix:semicolon
DECL|function|adm1026_attach_adapter
r_int
id|adm1026_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|adm1026_detect
)paren
suffix:semicolon
)brace
DECL|function|adm1026_detach_client
r_int
id|adm1026_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|adm1026_read_value
r_int
id|adm1026_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0x80
)paren
(brace
multiline_comment|/* &quot;RAM&quot; locations */
id|res
op_assign
id|i2c_smbus_read_byte_data
c_func
(paren
id|client
comma
id|reg
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* EEPROM, do nothing */
id|res
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|adm1026_write_value
r_int
id|adm1026_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
r_int
id|value
)paren
(brace
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0x80
)paren
(brace
multiline_comment|/* &quot;RAM&quot; locations */
id|res
op_assign
id|i2c_smbus_write_byte_data
c_func
(paren
id|client
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* EEPROM, do nothing */
id|res
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|adm1026_init_client
r_void
id|adm1026_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|value
comma
id|i
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Initializing device&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
multiline_comment|/* Read chip config */
id|data-&gt;config1
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
)paren
suffix:semicolon
id|data-&gt;config2
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG2
)paren
suffix:semicolon
id|data-&gt;config3
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG3
)paren
suffix:semicolon
multiline_comment|/* Inform user of chip config */
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): ADM1026_REG_CONFIG1 is: 0x%02x&bslash;n&quot;
comma
id|client-&gt;id
comma
id|data-&gt;config1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;config1
op_amp
id|CFG1_MONITOR
)paren
op_eq
l_int|0
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Monitoring not currently &quot;
l_string|&quot;enabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;config1
op_amp
id|CFG1_INT_ENABLE
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): SMBALERT interrupts are &quot;
l_string|&quot;enabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;config1
op_amp
id|CFG1_AIN8_9
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): in8 and in9 enabled. &quot;
l_string|&quot;temp3 disabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): temp3 enabled.  in8 and &quot;
l_string|&quot;in9 disabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;config1
op_amp
id|CFG1_THERM_HOT
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Automatic THERM, PWM, &quot;
l_string|&quot;and temp limits enabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
id|value
op_assign
id|data-&gt;config3
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;config3
op_amp
id|CFG3_GPIO16_ENABLE
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): GPIO16 enabled.  THERM&quot;
l_string|&quot;pin disabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): THERM pin enabled.  &quot;
l_string|&quot;GPIO16 disabled.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;config3
op_amp
id|CFG3_VREF_250
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Vref is 2.50 Volts.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Vref is 1.82 Volts.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
multiline_comment|/* Read and pick apart the existing GPIO configuration */
id|value
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|15
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
id|value
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_CFG_0_3
op_plus
id|i
op_div
l_int|4
)paren
suffix:semicolon
)brace
id|data-&gt;gpio_config
(braket
id|i
)braket
op_assign
id|value
op_amp
l_int|0x03
suffix:semicolon
id|value
op_rshift_assign
l_int|2
suffix:semicolon
)brace
id|data-&gt;gpio_config
(braket
l_int|16
)braket
op_assign
(paren
id|data-&gt;config3
op_rshift
l_int|6
)paren
op_amp
l_int|0x03
suffix:semicolon
multiline_comment|/* ... and then print it */
id|adm1026_print_gpio
c_func
(paren
id|client
)paren
suffix:semicolon
multiline_comment|/* If the user asks us to reprogram the GPIO config, then&n;&t; *   do it now.  But only if this is the first ADM1026.&n;&t; */
r_if
c_cond
(paren
id|client-&gt;id
op_eq
l_int|0
op_logical_and
(paren
id|gpio_input
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
op_logical_or
id|gpio_output
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
op_logical_or
id|gpio_inverted
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
op_logical_or
id|gpio_normal
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
op_logical_or
id|gpio_fan
(braket
l_int|0
)braket
op_ne
op_minus
l_int|1
)paren
)paren
(brace
id|adm1026_fixup_gpio
c_func
(paren
id|client
)paren
suffix:semicolon
)brace
multiline_comment|/* WE INTENTIONALLY make no changes to the limits,&n;&t; *   offsets, pwms, fans and zones.  If they were&n;&t; *   configured, we don&squot;t want to mess with them.&n;&t; *   If they weren&squot;t, the default is 100% PWM, no&n;&t; *   control and will suffice until &squot;sensors -s&squot;&n;&t; *   can be run by the user.  We DO set the default &n;&t; *   value for pwm1.auto_pwm_min to its maximum&n;&t; *   so that enabling automatic pwm fan control&n;&t; *   without first setting a value for pwm1.auto_pwm_min &n;&t; *   will not result in potentially dangerous fan speed decrease.&n;&t; */
id|data-&gt;pwm1.auto_pwm_min
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* Start monitoring */
id|value
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
)paren
suffix:semicolon
multiline_comment|/* Set MONITOR, clear interrupt acknowledge and s/w reset */
id|value
op_assign
(paren
id|value
op_or
id|CFG1_MONITOR
)paren
op_amp
(paren
op_complement
id|CFG1_INT_CLEAR
op_amp
op_complement
id|CFG1_RESET
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Setting CONFIG to: 0x%02x&bslash;n&quot;
comma
id|client-&gt;id
comma
id|value
)paren
suffix:semicolon
id|data-&gt;config1
op_assign
id|value
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|adm1026_print_gpio
r_void
id|adm1026_print_gpio
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): GPIO config is:&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|data-&gt;config2
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;&bslash;t(%d): %sGP%s%d&bslash;n&quot;
comma
id|client-&gt;id
comma
id|data-&gt;gpio_config
(braket
id|i
)braket
op_amp
l_int|0x02
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;!&quot;
comma
id|data-&gt;gpio_config
(braket
id|i
)braket
op_amp
l_int|0x01
ques
c_cond
l_string|&quot;OUT&quot;
suffix:colon
l_string|&quot;IN&quot;
comma
id|i
)paren
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;&bslash;t(%d): FAN%d&bslash;n&quot;
comma
id|client-&gt;id
comma
id|i
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|8
suffix:semicolon
id|i
op_le
l_int|15
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;&bslash;t(%d): %sGP%s%d&bslash;n&quot;
comma
id|client-&gt;id
comma
id|data-&gt;gpio_config
(braket
id|i
)braket
op_amp
l_int|0x02
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;!&quot;
comma
id|data-&gt;gpio_config
(braket
id|i
)braket
op_amp
l_int|0x01
ques
c_cond
l_string|&quot;OUT&quot;
suffix:colon
l_string|&quot;IN&quot;
comma
id|i
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;config3
op_amp
id|CFG3_GPIO16_ENABLE
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;&bslash;t(%d): %sGP%s16&bslash;n&quot;
comma
id|client-&gt;id
comma
id|data-&gt;gpio_config
(braket
l_int|16
)braket
op_amp
l_int|0x02
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;!&quot;
comma
id|data-&gt;gpio_config
(braket
l_int|16
)braket
op_amp
l_int|0x01
ques
c_cond
l_string|&quot;OUT&quot;
suffix:colon
l_string|&quot;IN&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* GPIO16 is THERM  */
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;&bslash;t(%d): THERM&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
)brace
)brace
DECL|function|adm1026_fixup_gpio
r_void
id|adm1026_fixup_gpio
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|value
suffix:semicolon
multiline_comment|/* Make the changes requested. */
multiline_comment|/* We may need to unlock/stop monitoring or soft-reset the&n;&t; *    chip before we can make changes.  This hasn&squot;t been&n;&t; *    tested much.  FIXME&n;&t; */
multiline_comment|/* Make outputs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gpio_output
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_output
(braket
id|i
)braket
op_le
l_int|16
)paren
(brace
id|data-&gt;gpio_config
(braket
id|gpio_output
(braket
id|i
)braket
)braket
op_or_assign
l_int|0x01
suffix:semicolon
)brace
multiline_comment|/* if GPIO0-7 is output, it isn&squot;t a FAN tach */
r_if
c_cond
(paren
id|gpio_output
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_output
(braket
id|i
)braket
op_le
l_int|7
)paren
(brace
id|data-&gt;config2
op_or_assign
l_int|1
op_lshift
id|gpio_output
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Input overrides output */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gpio_input
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_input
(braket
id|i
)braket
op_le
l_int|16
)paren
(brace
id|data-&gt;gpio_config
(braket
id|gpio_input
(braket
id|i
)braket
)braket
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
)brace
multiline_comment|/* if GPIO0-7 is input, it isn&squot;t a FAN tach */
r_if
c_cond
(paren
id|gpio_input
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_input
(braket
id|i
)braket
op_le
l_int|7
)paren
(brace
id|data-&gt;config2
op_or_assign
l_int|1
op_lshift
id|gpio_input
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* Inverted  */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gpio_inverted
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_inverted
(braket
id|i
)braket
op_le
l_int|16
)paren
(brace
id|data-&gt;gpio_config
(braket
id|gpio_inverted
(braket
id|i
)braket
)braket
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
)brace
)brace
multiline_comment|/* Normal overrides inverted  */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gpio_normal
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_normal
(braket
id|i
)braket
op_le
l_int|16
)paren
(brace
id|data-&gt;gpio_config
(braket
id|gpio_normal
(braket
id|i
)braket
)braket
op_or_assign
l_int|0x02
suffix:semicolon
)brace
)brace
multiline_comment|/* Fan overrides input and output */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|gpio_fan
(braket
id|i
)braket
op_ge
l_int|0
op_logical_and
id|gpio_fan
(braket
id|i
)braket
op_le
l_int|7
)paren
(brace
id|data-&gt;config2
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio_fan
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Write new configs to registers */
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG2
comma
id|data-&gt;config2
)paren
suffix:semicolon
id|data-&gt;config3
op_assign
(paren
id|data-&gt;config3
op_amp
l_int|0x3f
)paren
op_or
(paren
(paren
id|data-&gt;gpio_config
(braket
l_int|16
)braket
op_amp
l_int|0x03
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG3
comma
id|data-&gt;config3
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|15
comma
id|value
op_assign
l_int|0
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
op_decrement
id|i
)paren
(brace
id|value
op_lshift_assign
l_int|2
suffix:semicolon
id|value
op_or_assign
id|data-&gt;gpio_config
(braket
id|i
)braket
op_amp
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_CFG_0_3
op_plus
id|i
op_div
l_int|4
comma
id|value
)paren
suffix:semicolon
id|value
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Print the new config */
id|adm1026_print_gpio
c_func
(paren
id|client
)paren
suffix:semicolon
)brace
DECL|function|adm1026_update_device
r_static
r_struct
id|adm1026_data
op_star
id|adm1026_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|value
comma
id|alarms
comma
id|gpio
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;valid
op_logical_or
(paren
id|jiffies
op_minus
id|data-&gt;last_reading
OG
id|ADM1026_DATA_INTERVAL
)paren
)paren
(brace
multiline_comment|/* Things that change quickly */
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Reading sensor values&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
id|data-&gt;in
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
op_increment
id|i
)paren
(brace
id|data-&gt;fan
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|2
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* NOTE: temp[] is s8 and we assume 2&squot;s complement&n;&t;&t;&t; *   &quot;conversion&quot; in the assignment   */
id|data-&gt;temp
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|data-&gt;pwm1.pwm
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_PWM
)paren
suffix:semicolon
id|data-&gt;analog_out
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_DAC
)paren
suffix:semicolon
multiline_comment|/* GPIO16 is MSbit of alarms, move it to gpio */
id|alarms
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_STATUS4
)paren
suffix:semicolon
id|gpio
op_assign
id|alarms
op_amp
l_int|0x80
ques
c_cond
l_int|0x0100
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* GPIO16 */
id|alarms
op_and_assign
l_int|0x7f
suffix:semicolon
id|alarms
op_lshift_assign
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_STATUS3
)paren
suffix:semicolon
id|alarms
op_lshift_assign
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_STATUS2
)paren
suffix:semicolon
id|alarms
op_lshift_assign
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_STATUS1
)paren
suffix:semicolon
id|data-&gt;alarms
op_assign
id|alarms
suffix:semicolon
multiline_comment|/* Read the GPIO values */
id|gpio
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_STATUS_8_15
)paren
suffix:semicolon
id|gpio
op_lshift_assign
l_int|8
suffix:semicolon
id|gpio
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_STATUS_0_7
)paren
suffix:semicolon
id|data-&gt;gpio
op_assign
id|gpio
suffix:semicolon
id|data-&gt;last_reading
op_assign
id|jiffies
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* last_reading */
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;valid
op_logical_or
(paren
id|jiffies
op_minus
id|data-&gt;last_config
OG
id|ADM1026_CONFIG_INTERVAL
)paren
)paren
(brace
multiline_comment|/* Things that don&squot;t change often */
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Reading config values&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|16
suffix:semicolon
op_increment
id|i
)paren
(brace
id|data-&gt;in_min
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MIN
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MAX
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|value
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_DIV_0_3
)paren
op_or
(paren
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_DIV_4_7
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
op_increment
id|i
)paren
(brace
id|data-&gt;fan_min
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
id|i
)braket
op_assign
id|DIV_FROM_REG
c_func
(paren
id|value
op_amp
l_int|0x03
)paren
suffix:semicolon
id|value
op_rshift_assign
l_int|2
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|2
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* NOTE: temp_xxx[] are s8 and we assume 2&squot;s &n;&t;&t;&t; *    complement &quot;conversion&quot; in the assignment&n;&t;&t;&t; */
id|data-&gt;temp_min
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_MIN
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;temp_max
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_MAX
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;temp_tmin
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_TMIN
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;temp_crit
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_THERM
(braket
id|i
)braket
)paren
suffix:semicolon
id|data-&gt;temp_offset
(braket
id|i
)braket
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_OFFSET
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the STATUS/alarm masks */
id|alarms
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK4
)paren
suffix:semicolon
id|gpio
op_assign
id|alarms
op_amp
l_int|0x80
ques
c_cond
l_int|0x0100
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* GPIO16 */
id|alarms
op_assign
(paren
id|alarms
op_amp
l_int|0x7f
)paren
op_lshift
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK3
)paren
suffix:semicolon
id|alarms
op_lshift_assign
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK2
)paren
suffix:semicolon
id|alarms
op_lshift_assign
l_int|8
suffix:semicolon
id|alarms
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK1
)paren
suffix:semicolon
id|data-&gt;alarm_mask
op_assign
id|alarms
suffix:semicolon
multiline_comment|/* Read the GPIO values */
id|gpio
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_MASK_8_15
)paren
suffix:semicolon
id|gpio
op_lshift_assign
l_int|8
suffix:semicolon
id|gpio
op_or_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_MASK_0_7
)paren
suffix:semicolon
id|data-&gt;gpio_mask
op_assign
id|gpio
suffix:semicolon
multiline_comment|/* Read various values from CONFIG1 */
id|data-&gt;config1
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;config1
op_amp
id|CFG1_PWM_AFC
)paren
(brace
id|data-&gt;pwm1.enable
op_assign
l_int|2
suffix:semicolon
id|data-&gt;pwm1.auto_pwm_min
op_assign
id|PWM_MIN_FROM_REG
c_func
(paren
id|data-&gt;pwm1.pwm
)paren
suffix:semicolon
)brace
multiline_comment|/* Read the GPIO config */
id|data-&gt;config2
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG2
)paren
suffix:semicolon
id|data-&gt;config3
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG3
)paren
suffix:semicolon
id|data-&gt;gpio_config
(braket
l_int|16
)braket
op_assign
(paren
id|data-&gt;config3
op_rshift
l_int|6
)paren
op_amp
l_int|0x03
suffix:semicolon
id|value
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|15
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_amp
l_int|0x03
)paren
op_eq
l_int|0
)paren
(brace
id|value
op_assign
id|adm1026_read_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_CFG_0_3
op_plus
id|i
op_div
l_int|4
)paren
suffix:semicolon
)brace
id|data-&gt;gpio_config
(braket
id|i
)braket
op_assign
id|value
op_amp
l_int|0x03
suffix:semicolon
id|value
op_rshift_assign
l_int|2
suffix:semicolon
)brace
id|data-&gt;last_config
op_assign
id|jiffies
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* last_config */
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;(%d): Setting VID from GPIO11-15.&bslash;n&quot;
comma
id|client-&gt;id
)paren
suffix:semicolon
id|data-&gt;vid
op_assign
(paren
id|data-&gt;gpio
op_rshift
l_int|11
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|show_in
r_static
id|ssize_t
id|show_in
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
id|nr
comma
id|data-&gt;in
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_in_min
r_static
id|ssize_t
id|show_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
id|nr
comma
id|data-&gt;in_min
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_in_min
r_static
id|ssize_t
id|set_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|nr
)braket
op_assign
id|INS_TO_REG
c_func
(paren
id|nr
comma
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MIN
(braket
id|nr
)braket
comma
id|data-&gt;in_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_in_max
r_static
id|ssize_t
id|show_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
id|nr
comma
id|data-&gt;in_max
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_in_max
r_static
id|ssize_t
id|set_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|nr
)braket
op_assign
id|INS_TO_REG
c_func
(paren
id|nr
comma
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MAX
(braket
id|nr
)braket
comma
id|data-&gt;in_max
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|in_reg
mdefine_line|#define in_reg(offset)                                                    &bslash;&n;static ssize_t show_in##offset (struct device *dev, char *buf)            &bslash;&n;{                                                                         &bslash;&n;&t;return show_in(dev, buf, offset);                                 &bslash;&n;}                                                                         &bslash;&n;static ssize_t show_in##offset##_min (struct device *dev, char *buf)      &bslash;&n;{                                                                         &bslash;&n;&t;return show_in_min(dev, buf, offset);                             &bslash;&n;}                                                                         &bslash;&n;static ssize_t set_in##offset##_min (struct device *dev,                  &bslash;&n;&t;const char *buf, size_t count)                                    &bslash;&n;{                                                                         &bslash;&n;&t;return set_in_min(dev, buf, count, offset);                       &bslash;&n;}                                                                         &bslash;&n;static ssize_t show_in##offset##_max (struct device *dev, char *buf)      &bslash;&n;{                                                                         &bslash;&n;&t;return show_in_max(dev, buf, offset);                             &bslash;&n;}                                                                         &bslash;&n;static ssize_t set_in##offset##_max (struct device *dev,                  &bslash;&n;&t;const char *buf, size_t count)                                    &bslash;&n;{                                                                         &bslash;&n;&t;return set_in_max(dev, buf, count, offset);                       &bslash;&n;}                                                                         &bslash;&n;static DEVICE_ATTR(in##offset##_input, S_IRUGO, show_in##offset, NULL);   &bslash;&n;static DEVICE_ATTR(in##offset##_min, S_IRUGO | S_IWUSR,                   &bslash;&n;&t;&t;show_in##offset##_min, set_in##offset##_min);             &bslash;&n;static DEVICE_ATTR(in##offset##_max, S_IRUGO | S_IWUSR,                   &bslash;&n;&t;&t;show_in##offset##_max, set_in##offset##_max);
id|in_reg
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|11
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|13
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|14
)paren
suffix:semicolon
id|in_reg
c_func
(paren
l_int|15
)paren
suffix:semicolon
DECL|function|show_in16
r_static
id|ssize_t
id|show_in16
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
l_int|16
comma
id|data-&gt;in
(braket
l_int|16
)braket
)paren
op_minus
id|NEG12_OFFSET
)paren
suffix:semicolon
)brace
DECL|function|show_in16_min
r_static
id|ssize_t
id|show_in16_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
l_int|16
comma
id|data-&gt;in_min
(braket
l_int|16
)braket
)paren
op_minus
id|NEG12_OFFSET
)paren
suffix:semicolon
)brace
DECL|function|set_in16_min
r_static
id|ssize_t
id|set_in16_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
l_int|16
)braket
op_assign
id|INS_TO_REG
c_func
(paren
l_int|16
comma
id|val
op_plus
id|NEG12_OFFSET
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MIN
(braket
l_int|16
)braket
comma
id|data-&gt;in_min
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_in16_max
r_static
id|ssize_t
id|show_in16_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|INS_FROM_REG
c_func
(paren
l_int|16
comma
id|data-&gt;in_max
(braket
l_int|16
)braket
)paren
op_minus
id|NEG12_OFFSET
)paren
suffix:semicolon
)brace
DECL|function|set_in16_max
r_static
id|ssize_t
id|set_in16_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
l_int|16
)braket
op_assign
id|INS_TO_REG
c_func
(paren
l_int|16
comma
id|val
op_plus
id|NEG12_OFFSET
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_IN_MAX
(braket
l_int|16
)braket
comma
id|data-&gt;in_max
(braket
l_int|16
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|in16_input
comma
id|S_IRUGO
comma
id|show_in16
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in16_min
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_in16_min
comma
id|set_in16_min
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in16_max
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_in16_max
comma
id|set_in16_max
)paren
suffix:semicolon
multiline_comment|/* Now add fan read/write functions */
DECL|function|show_fan
r_static
id|ssize_t
id|show_fan
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan
(braket
id|nr
)braket
comma
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_fan_min
r_static
id|ssize_t
id|show_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_fan_min
r_static
id|ssize_t
id|set_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|val
comma
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|fan_offset
mdefine_line|#define fan_offset(offset)                                                  &bslash;&n;static ssize_t show_fan_##offset (struct device *dev, char *buf)            &bslash;&n;{                                                                           &bslash;&n;&t;return show_fan(dev, buf, offset - 1);                              &bslash;&n;}                                                                           &bslash;&n;static ssize_t show_fan_##offset##_min (struct device *dev, char *buf)      &bslash;&n;{                                                                           &bslash;&n;&t;return show_fan_min(dev, buf, offset - 1);                          &bslash;&n;}                                                                           &bslash;&n;static ssize_t set_fan_##offset##_min (struct device *dev,                  &bslash;&n;&t;const char *buf, size_t count)                                      &bslash;&n;{                                                                           &bslash;&n;&t;return set_fan_min(dev, buf, count, offset - 1);                    &bslash;&n;}                                                                           &bslash;&n;static DEVICE_ATTR(fan##offset##_input, S_IRUGO, show_fan_##offset, NULL);  &bslash;&n;static DEVICE_ATTR(fan##offset##_min, S_IRUGO | S_IWUSR,                    &bslash;&n;&t;&t;show_fan_##offset##_min, set_fan_##offset##_min);
id|fan_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|fan_offset
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Adjust fan_min to account for new fan divisor */
DECL|function|fixup_fan_min
r_void
id|fixup_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|fan
comma
r_int
id|old_div
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|new_min
suffix:semicolon
r_int
id|new_div
op_assign
id|data-&gt;fan_div
(braket
id|fan
)braket
suffix:semicolon
multiline_comment|/* 0 and 0xff are special.  Don&squot;t adjust them */
r_if
c_cond
(paren
id|data-&gt;fan_min
(braket
id|fan
)braket
op_eq
l_int|0
op_logical_or
id|data-&gt;fan_min
(braket
id|fan
)braket
op_eq
l_int|0xff
)paren
(brace
r_return
suffix:semicolon
)brace
id|new_min
op_assign
id|data-&gt;fan_min
(braket
id|fan
)braket
op_star
id|old_div
op_div
id|new_div
suffix:semicolon
id|new_min
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|new_min
comma
l_int|1
comma
l_int|254
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|fan
)braket
op_assign
id|new_min
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_MIN
c_func
(paren
id|fan
)paren
comma
id|new_min
)paren
suffix:semicolon
)brace
multiline_comment|/* Now add fan_div read/write functions */
DECL|function|show_fan_div
r_static
id|ssize_t
id|show_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
suffix:semicolon
)brace
DECL|function|set_fan_div
r_static
id|ssize_t
id|set_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
comma
id|orig_div
comma
id|new_div
comma
id|shift
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|new_div
op_assign
id|DIV_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_div
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|orig_div
op_assign
id|data-&gt;fan_div
(braket
id|nr
)braket
suffix:semicolon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
id|DIV_FROM_REG
c_func
(paren
id|new_div
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr
OL
l_int|4
)paren
(brace
multiline_comment|/* 0 &lt;= nr &lt; 4 */
id|shift
op_assign
l_int|2
op_star
id|nr
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_DIV_0_3
comma
(paren
(paren
id|DIV_TO_REG
c_func
(paren
id|orig_div
)paren
op_amp
(paren
op_complement
(paren
l_int|0x03
op_lshift
id|shift
)paren
)paren
)paren
op_or
(paren
id|new_div
op_lshift
id|shift
)paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 3 &lt; nr &lt; 8 */
id|shift
op_assign
l_int|2
op_star
(paren
id|nr
op_minus
l_int|4
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_FAN_DIV_4_7
comma
(paren
(paren
id|DIV_TO_REG
c_func
(paren
id|orig_div
)paren
op_amp
(paren
op_complement
(paren
l_int|0x03
op_lshift
(paren
l_int|2
op_star
id|shift
)paren
)paren
)paren
)paren
op_or
(paren
id|new_div
op_lshift
id|shift
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_ne
id|orig_div
)paren
(brace
id|fixup_fan_min
c_func
(paren
id|dev
comma
id|nr
comma
id|orig_div
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|fan_offset_div
mdefine_line|#define fan_offset_div(offset)                                          &bslash;&n;static ssize_t show_fan_##offset##_div (struct device *dev, char *buf)  &bslash;&n;{                                                                       &bslash;&n;&t;return show_fan_div(dev, buf, offset - 1);                      &bslash;&n;}                                                                       &bslash;&n;static ssize_t set_fan_##offset##_div (struct device *dev,              &bslash;&n;&t;const char *buf, size_t count)                                  &bslash;&n;{                                                                       &bslash;&n;&t;return set_fan_div(dev, buf, count, offset - 1);                &bslash;&n;}                                                                       &bslash;&n;static DEVICE_ATTR(fan##offset##_div, S_IRUGO | S_IWUSR,                &bslash;&n;&t;&t;show_fan_##offset##_div, set_fan_##offset##_div);
id|fan_offset_div
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|fan_offset_div
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Temps */
DECL|function|show_temp
r_static
id|ssize_t
id|show_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_min
r_static
id|ssize_t
id|show_temp_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_min
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_min
r_static
id|ssize_t
id|set_temp_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_min
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_MIN
(braket
id|nr
)braket
comma
id|data-&gt;temp_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_temp_max
r_static
id|ssize_t
id|show_temp_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_max
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_max
r_static
id|ssize_t
id|set_temp_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_max
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_MAX
(braket
id|nr
)braket
comma
id|data-&gt;temp_max
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|temp_reg
mdefine_line|#define temp_reg(offset)                                                      &bslash;&n;static ssize_t show_temp_##offset (struct device *dev, char *buf)             &bslash;&n;{                                                                             &bslash;&n;&t;return show_temp(dev, buf, offset - 1);                               &bslash;&n;}                                                                             &bslash;&n;static ssize_t show_temp_##offset##_min (struct device *dev, char *buf)       &bslash;&n;{                                                                             &bslash;&n;&t;return show_temp_min(dev, buf, offset - 1);                           &bslash;&n;}                                                                             &bslash;&n;static ssize_t show_temp_##offset##_max (struct device *dev, char *buf)       &bslash;&n;{                                                                             &bslash;&n;&t;return show_temp_max(dev, buf, offset - 1);                           &bslash;&n;}                                                                             &bslash;&n;static ssize_t set_temp_##offset##_min (struct device *dev,                   &bslash;&n;&t;const char *buf, size_t count)                                        &bslash;&n;{                                                                             &bslash;&n;&t;return set_temp_min(dev, buf, count, offset - 1);                     &bslash;&n;}                                                                             &bslash;&n;static ssize_t set_temp_##offset##_max (struct device *dev,                   &bslash;&n;&t;const char *buf, size_t count)                                        &bslash;&n;{                                                                             &bslash;&n;&t;return set_temp_max(dev, buf, count, offset - 1);                     &bslash;&n;}                                                                             &bslash;&n;static DEVICE_ATTR(temp##offset##_input, S_IRUGO, show_temp_##offset, NULL);  &bslash;&n;static DEVICE_ATTR(temp##offset##_min, S_IRUGO | S_IWUSR,                     &bslash;&n;&t;&t;show_temp_##offset##_min, set_temp_##offset##_min);           &bslash;&n;static DEVICE_ATTR(temp##offset##_max, S_IRUGO | S_IWUSR,                     &bslash;&n;&t;&t;show_temp_##offset##_max, set_temp_##offset##_max);
id|temp_reg
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|temp_reg
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|temp_reg
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|function|show_temp_offset
r_static
id|ssize_t
id|show_temp_offset
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_offset
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_offset
r_static
id|ssize_t
id|set_temp_offset
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_offset
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_OFFSET
(braket
id|nr
)braket
comma
id|data-&gt;temp_offset
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|temp_offset_reg
mdefine_line|#define temp_offset_reg(offset)                                             &bslash;&n;static ssize_t show_temp_##offset##_offset (struct device *dev, char *buf)  &bslash;&n;{                                                                           &bslash;&n;&t;return show_temp_offset(dev, buf, offset - 1);                      &bslash;&n;}                                                                           &bslash;&n;static ssize_t set_temp_##offset##_offset (struct device *dev,              &bslash;&n;&t;const char *buf, size_t count)                                      &bslash;&n;{                                                                           &bslash;&n;&t;return set_temp_offset(dev, buf, count, offset - 1);                &bslash;&n;}                                                                           &bslash;&n;static DEVICE_ATTR(temp##offset##_offset, S_IRUGO | S_IWUSR,                &bslash;&n;&t;&t;show_temp_##offset##_offset, set_temp_##offset##_offset);
id|temp_offset_reg
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|temp_offset_reg
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|temp_offset_reg
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|function|show_temp_auto_point1_temp_hyst
r_static
id|ssize_t
id|show_temp_auto_point1_temp_hyst
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|ADM1026_FAN_ACTIVATION_TEMP_HYST
op_plus
id|data-&gt;temp_tmin
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_auto_point2_temp
r_static
id|ssize_t
id|show_temp_auto_point2_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_tmin
(braket
id|nr
)braket
op_plus
id|ADM1026_FAN_CONTROL_TEMP_RANGE
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_auto_point1_temp
r_static
id|ssize_t
id|show_temp_auto_point1_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_tmin
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_auto_point1_temp
r_static
id|ssize_t
id|set_temp_auto_point1_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_tmin
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_TMIN
(braket
id|nr
)braket
comma
id|data-&gt;temp_tmin
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|temp_auto_point
mdefine_line|#define temp_auto_point(offset)                                             &bslash;&n;static ssize_t show_temp##offset##_auto_point1_temp (struct device *dev,    &bslash;&n;&t;char *buf)                                                          &bslash;&n;{                                                                           &bslash;&n;&t;return show_temp_auto_point1_temp(dev, buf, offset - 1);            &bslash;&n;}                                                                           &bslash;&n;static ssize_t set_temp##offset##_auto_point1_temp (struct device *dev,     &bslash;&n;&t;const char *buf, size_t count)                                      &bslash;&n;{                                                                           &bslash;&n;&t;return set_temp_auto_point1_temp(dev, buf, count, offset - 1);      &bslash;&n;}                                                                           &bslash;&n;static ssize_t show_temp##offset##_auto_point1_temp_hyst (struct device     &bslash;&n;&t;*dev, char *buf)                                                    &bslash;&n;{                                                                           &bslash;&n;&t;return show_temp_auto_point1_temp_hyst(dev, buf, offset - 1);       &bslash;&n;}                                                                           &bslash;&n;static ssize_t show_temp##offset##_auto_point2_temp (struct device *dev,    &bslash;&n;&t; char *buf)                                                         &bslash;&n;{                                                                           &bslash;&n;&t;return show_temp_auto_point2_temp(dev, buf, offset - 1);            &bslash;&n;}                                                                           &bslash;&n;static DEVICE_ATTR(temp##offset##_auto_point1_temp, S_IRUGO | S_IWUSR,      &bslash;&n;&t;&t;show_temp##offset##_auto_point1_temp,                       &bslash;&n;&t;&t;set_temp##offset##_auto_point1_temp);                       &bslash;&n;static DEVICE_ATTR(temp##offset##_auto_point1_temp_hyst, S_IRUGO,           &bslash;&n;&t;&t;show_temp##offset##_auto_point1_temp_hyst, NULL);           &bslash;&n;static DEVICE_ATTR(temp##offset##_auto_point2_temp, S_IRUGO,                &bslash;&n;&t;&t;show_temp##offset##_auto_point2_temp, NULL);
id|temp_auto_point
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|temp_auto_point
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|temp_auto_point
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|function|show_temp_crit_enable
r_static
id|ssize_t
id|show_temp_crit_enable
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
(paren
id|data-&gt;config1
op_amp
id|CFG1_THERM_HOT
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
)brace
DECL|function|set_temp_crit_enable
r_static
id|ssize_t
id|set_temp_crit_enable
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_eq
l_int|1
)paren
op_logical_or
(paren
id|val
op_eq
l_int|0
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;config1
op_assign
(paren
id|data-&gt;config1
op_amp
op_complement
id|CFG1_THERM_HOT
)paren
op_or
(paren
id|val
op_lshift
l_int|4
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
comma
id|data-&gt;config1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_crit_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_temp_crit_enable
comma
id|set_temp_crit_enable
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp2_crit_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_temp_crit_enable
comma
id|set_temp_crit_enable
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp3_crit_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_temp_crit_enable
comma
id|set_temp_crit_enable
)paren
suffix:semicolon
DECL|function|show_temp_crit
r_static
id|ssize_t
id|show_temp_crit
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_crit
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_crit
r_static
id|ssize_t
id|set_temp_crit
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_crit
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_TEMP_THERM
(braket
id|nr
)braket
comma
id|data-&gt;temp_crit
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|temp_crit_reg
mdefine_line|#define temp_crit_reg(offset)                                             &bslash;&n;static ssize_t show_temp_##offset##_crit (struct device *dev, char *buf)  &bslash;&n;{                                                                         &bslash;&n;&t;return show_temp_crit(dev, buf, offset - 1);                      &bslash;&n;}                                                                         &bslash;&n;static ssize_t set_temp_##offset##_crit (struct device *dev,              &bslash;&n;&t;const char *buf, size_t count)                                    &bslash;&n;{                                                                         &bslash;&n;&t;return set_temp_crit(dev, buf, count, offset - 1);                &bslash;&n;}                                                                         &bslash;&n;static DEVICE_ATTR(temp##offset##_crit, S_IRUGO | S_IWUSR,                &bslash;&n;&t;&t;show_temp_##offset##_crit, set_temp_##offset##_crit);
id|temp_crit_reg
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|temp_crit_reg
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|temp_crit_reg
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|function|show_analog_out_reg
r_static
id|ssize_t
id|show_analog_out_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|DAC_FROM_REG
c_func
(paren
id|data-&gt;analog_out
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_analog_out_reg
r_static
id|ssize_t
id|set_analog_out_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;analog_out
op_assign
id|DAC_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_DAC
comma
id|data-&gt;analog_out
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|analog_out
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_analog_out_reg
comma
id|set_analog_out_reg
)paren
suffix:semicolon
DECL|function|show_vid_reg
r_static
id|ssize_t
id|show_vid_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|vid_from_reg
c_func
(paren
id|data-&gt;vid
op_amp
l_int|0x3f
comma
id|data-&gt;vrm
)paren
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|vid
comma
id|S_IRUGO
comma
id|show_vid_reg
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_vrm_reg
r_static
id|ssize_t
id|show_vrm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;vrm
)paren
suffix:semicolon
)brace
DECL|function|store_vrm_reg
r_static
id|ssize_t
id|store_vrm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|data-&gt;vrm
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|vrm
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_vrm_reg
comma
id|store_vrm_reg
)paren
suffix:semicolon
DECL|function|show_alarms_reg
r_static
id|ssize_t
id|show_alarms_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
(paren
id|data-&gt;alarms
)paren
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarms
comma
id|S_IRUGO
comma
id|show_alarms_reg
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|show_alarm_mask
r_static
id|ssize_t
id|show_alarm_mask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|data-&gt;alarm_mask
)paren
suffix:semicolon
)brace
DECL|function|set_alarm_mask
r_static
id|ssize_t
id|set_alarm_mask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;alarm_mask
op_assign
id|val
op_amp
l_int|0x7fffffff
suffix:semicolon
id|mask
op_assign
id|data-&gt;alarm_mask
op_or
(paren
id|data-&gt;gpio_mask
op_amp
l_int|0x10000
ques
c_cond
l_int|0x80000000
suffix:colon
l_int|0
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK1
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|mask
op_rshift_assign
l_int|8
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK2
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|mask
op_rshift_assign
l_int|8
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK3
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|mask
op_rshift_assign
l_int|8
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK4
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarm_mask
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_alarm_mask
comma
id|set_alarm_mask
)paren
suffix:semicolon
DECL|function|show_gpio
r_static
id|ssize_t
id|show_gpio
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|data-&gt;gpio
)paren
suffix:semicolon
)brace
DECL|function|set_gpio
r_static
id|ssize_t
id|set_gpio
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
id|gpio
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;gpio
op_assign
id|val
op_amp
l_int|0x1ffff
suffix:semicolon
id|gpio
op_assign
id|data-&gt;gpio
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_STATUS_0_7
comma
id|gpio
op_amp
l_int|0xff
)paren
suffix:semicolon
id|gpio
op_rshift_assign
l_int|8
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_STATUS_8_15
comma
id|gpio
op_amp
l_int|0xff
)paren
suffix:semicolon
id|gpio
op_assign
(paren
(paren
id|gpio
op_rshift
l_int|1
)paren
op_amp
l_int|0x80
)paren
op_or
(paren
id|data-&gt;alarms
op_rshift
l_int|24
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_STATUS4
comma
id|gpio
op_amp
l_int|0xff
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|gpio
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_gpio
comma
id|set_gpio
)paren
suffix:semicolon
DECL|function|show_gpio_mask
r_static
id|ssize_t
id|show_gpio_mask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|data-&gt;gpio_mask
)paren
suffix:semicolon
)brace
DECL|function|set_gpio_mask
r_static
id|ssize_t
id|set_gpio_mask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
id|mask
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;gpio_mask
op_assign
id|val
op_amp
l_int|0x1ffff
suffix:semicolon
id|mask
op_assign
id|data-&gt;gpio_mask
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_MASK_0_7
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|mask
op_rshift_assign
l_int|8
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_GPIO_MASK_8_15
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|mask
op_assign
(paren
(paren
id|mask
op_rshift
l_int|1
)paren
op_amp
l_int|0x80
)paren
op_or
(paren
id|data-&gt;alarm_mask
op_rshift
l_int|24
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_MASK1
comma
id|mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|gpio_mask
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_gpio_mask
comma
id|set_gpio_mask
)paren
suffix:semicolon
DECL|function|show_pwm_reg
r_static
id|ssize_t
id|show_pwm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|PWM_FROM_REG
c_func
(paren
id|data-&gt;pwm1.pwm
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_pwm_reg
r_static
id|ssize_t
id|set_pwm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;pwm1.enable
op_eq
l_int|1
)paren
(brace
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;pwm1.pwm
op_assign
id|PWM_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_PWM
comma
id|data-&gt;pwm1.pwm
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_auto_pwm_min
r_static
id|ssize_t
id|show_auto_pwm_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;pwm1.auto_pwm_min
)paren
suffix:semicolon
)brace
DECL|function|set_auto_pwm_min
r_static
id|ssize_t
id|set_auto_pwm_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;pwm1.auto_pwm_min
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|val
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;pwm1.enable
op_eq
l_int|2
)paren
(brace
multiline_comment|/* apply immediately */
id|data-&gt;pwm1.pwm
op_assign
id|PWM_TO_REG
c_func
(paren
(paren
id|data-&gt;pwm1.pwm
op_amp
l_int|0x0f
)paren
op_or
id|PWM_MIN_TO_REG
c_func
(paren
id|data-&gt;pwm1.auto_pwm_min
)paren
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_PWM
comma
id|data-&gt;pwm1.pwm
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_auto_pwm_max
r_static
id|ssize_t
id|show_auto_pwm_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|ADM1026_PWM_MAX
)paren
suffix:semicolon
)brace
DECL|function|show_pwm_enable
r_static
id|ssize_t
id|show_pwm_enable
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|adm1026_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;pwm1.enable
)paren
suffix:semicolon
)brace
DECL|function|set_pwm_enable
r_static
id|ssize_t
id|set_pwm_enable
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
id|old_enable
suffix:semicolon
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_ge
l_int|0
)paren
op_logical_and
(paren
id|val
OL
l_int|3
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|old_enable
op_assign
id|data-&gt;pwm1.enable
suffix:semicolon
id|data-&gt;pwm1.enable
op_assign
id|val
suffix:semicolon
id|data-&gt;config1
op_assign
(paren
id|data-&gt;config1
op_amp
op_complement
id|CFG1_PWM_AFC
)paren
op_or
(paren
(paren
id|val
op_eq
l_int|2
)paren
ques
c_cond
id|CFG1_PWM_AFC
suffix:colon
l_int|0
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_CONFIG1
comma
id|data-&gt;config1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
l_int|2
)paren
(brace
multiline_comment|/* apply pwm1_auto_pwm_min to pwm1 */
id|data-&gt;pwm1.pwm
op_assign
id|PWM_TO_REG
c_func
(paren
(paren
id|data-&gt;pwm1.pwm
op_amp
l_int|0x0f
)paren
op_or
id|PWM_MIN_TO_REG
c_func
(paren
id|data-&gt;pwm1.auto_pwm_min
)paren
)paren
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_PWM
comma
id|data-&gt;pwm1.pwm
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|old_enable
op_eq
l_int|1
)paren
op_logical_and
(paren
id|val
op_eq
l_int|1
)paren
)paren
)paren
(brace
multiline_comment|/* set pwm to safe value */
id|data-&gt;pwm1.pwm
op_assign
l_int|255
suffix:semicolon
id|adm1026_write_value
c_func
(paren
id|client
comma
id|ADM1026_REG_PWM
comma
id|data-&gt;pwm1.pwm
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/* enable PWM fan control */
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm1
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_reg
comma
id|set_pwm_reg
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm2
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_reg
comma
id|set_pwm_reg
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm3
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_reg
comma
id|set_pwm_reg
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm1_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_enable
comma
id|set_pwm_enable
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm2_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_enable
comma
id|set_pwm_enable
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|pwm3_enable
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_pwm_enable
comma
id|set_pwm_enable
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_auto_point1_pwm
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_auto_pwm_min
comma
id|set_auto_pwm_min
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp2_auto_point1_pwm
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_auto_pwm_min
comma
id|set_auto_pwm_min
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp3_auto_point1_pwm
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_auto_pwm_min
comma
id|set_auto_pwm_min
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_auto_point2_pwm
comma
id|S_IRUGO
comma
id|show_auto_pwm_max
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp2_auto_point2_pwm
comma
id|S_IRUGO
comma
id|show_auto_pwm_max
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp3_auto_point2_pwm
comma
id|S_IRUGO
comma
id|show_auto_pwm_max
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|adm1026_detect
r_int
id|adm1026_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_int
id|company
comma
id|verstep
suffix:semicolon
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|adm1026_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|type_name
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_BYTE_DATA
)paren
)paren
(brace
multiline_comment|/* We need to be able to do byte I/O */
r_goto
m_exit
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* OK. For now, we presume we have a valid client. We now create the&n;&t;   client structure, even though we cannot fill it completely yet.&n;&t;   But it allows us to access adm1026_{read,write}_value. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|adm1026_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|adm1026_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|adm1026_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Now, we do the remaining detection. */
id|company
op_assign
id|adm1026_read_value
c_func
(paren
id|new_client
comma
id|ADM1026_REG_COMPANY
)paren
suffix:semicolon
id|verstep
op_assign
id|adm1026_read_value
c_func
(paren
id|new_client
comma
id|ADM1026_REG_VERSTEP
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;Detecting device at %d,0x%02x with&quot;
l_string|&quot; COMPANY: 0x%02x and VERSTEP: 0x%02x&bslash;n&quot;
comma
id|i2c_adapter_id
c_func
(paren
id|new_client-&gt;adapter
)paren
comma
id|new_client-&gt;addr
comma
id|company
comma
id|verstep
)paren
suffix:semicolon
multiline_comment|/* If auto-detecting, Determine the chip type. */
r_if
c_cond
(paren
id|kind
op_le
l_int|0
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;Autodetecting device at %d,0x%02x &quot;
l_string|&quot;...&bslash;n&quot;
comma
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|company
op_eq
id|ADM1026_COMPANY_ANALOG_DEV
op_logical_and
id|verstep
op_eq
id|ADM1026_VERSTEP_ADM1026
)paren
(brace
id|kind
op_assign
id|adm1026
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|company
op_eq
id|ADM1026_COMPANY_ANALOG_DEV
op_logical_and
(paren
id|verstep
op_amp
l_int|0xf0
)paren
op_eq
id|ADM1026_VERSTEP_GENERIC
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;: Unrecognized stepping &quot;
l_string|&quot;0x%02x. Defaulting to ADM1026.&bslash;n&quot;
comma
id|verstep
)paren
suffix:semicolon
id|kind
op_assign
id|adm1026
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|verstep
op_amp
l_int|0xf0
)paren
op_eq
id|ADM1026_VERSTEP_GENERIC
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;: Found version/stepping &quot;
l_string|&quot;0x%02x. Assuming generic ADM1026.&bslash;n&quot;
comma
id|verstep
)paren
suffix:semicolon
id|kind
op_assign
id|any_chip
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;: Autodetection &quot;
l_string|&quot;failed&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Not an ADM1026 ... */
r_if
c_cond
(paren
id|kind
op_eq
l_int|0
)paren
(brace
multiline_comment|/* User used force=x,y */
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;Generic ADM1026 not &quot;
l_string|&quot;found at %d,0x%02x.  Try &quot;
l_string|&quot;force_adm1026.&bslash;n&quot;
comma
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
comma
id|address
)paren
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|exitfree
suffix:semicolon
)brace
)brace
multiline_comment|/* Fill in the chip specific driver values */
r_switch
c_cond
(paren
id|kind
)paren
(brace
r_case
id|any_chip
suffix:colon
id|type_name
op_assign
l_string|&quot;adm1026&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|adm1026
suffix:colon
id|type_name
op_assign
l_string|&quot;adm1026&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;: Internal error, invalid &quot;
l_string|&quot;kind (%d)!&quot;
comma
id|kind
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|exitfree
suffix:semicolon
)brace
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
id|type_name
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
multiline_comment|/* Fill in the remaining client fields */
id|new_client-&gt;id
op_assign
id|adm1026_id
op_increment
suffix:semicolon
id|data-&gt;type
op_assign
id|kind
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
l_string|&quot;(%d): Assigning ID %d to %s at %d,0x%02x&bslash;n&quot;
comma
id|new_client-&gt;id
comma
id|new_client-&gt;id
comma
id|new_client-&gt;name
comma
id|i2c_adapter_id
c_func
(paren
id|new_client-&gt;adapter
)paren
comma
id|new_client-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|exitfree
suffix:semicolon
multiline_comment|/* Set the VRM version */
id|data-&gt;vrm
op_assign
id|i2c_which_vrm
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Initialize the ADM1026 chip */
id|adm1026_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in5_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in6_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in7_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in7_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in7_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in8_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in8_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in8_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in9_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in9_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in9_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in10_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in10_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in10_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in11_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in11_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in11_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in12_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in12_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in12_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in13_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in13_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in13_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in14_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in14_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in14_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in15_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in15_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in15_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in16_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in16_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in16_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan4_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan4_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan4_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan5_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan5_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan5_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan6_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan6_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan6_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan7_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan7_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan7_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan8_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan8_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan8_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_offset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_offset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_offset
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_auto_point1_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_auto_point1_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_auto_point1_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_auto_point1_temp_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_auto_point1_temp_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_auto_point1_temp_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_auto_point2_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_auto_point2_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_auto_point2_temp
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_crit
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_crit
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_crit
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_crit_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_crit_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_crit_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_vid
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_vrm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_alarms
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_alarm_mask
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_gpio
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_gpio_mask
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm1
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm2
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm3
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm1_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm2_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_pwm3_enable
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_auto_point1_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_auto_point1_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_auto_point1_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_auto_point2_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_auto_point2_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_auto_point2_pwm
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_analog_out
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Error out and cleanup code */
id|exitfree
suffix:colon
id|kfree
c_func
(paren
id|new_client
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|sm_adm1026_init
r_static
r_int
id|__init
id|sm_adm1026_init
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|adm1026_driver
)paren
suffix:semicolon
)brace
DECL|function|sm_adm1026_exit
r_static
r_void
id|__exit
id|sm_adm1026_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|adm1026_driver
)paren
suffix:semicolon
)brace
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Philip Pokorny &lt;ppokorny@penguincomputing.com&gt;, &quot;
l_string|&quot;Justin Thiessen &lt;jthiessen@penguincomputing.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ADM1026 driver&quot;
)paren
suffix:semicolon
DECL|variable|sm_adm1026_init
id|module_init
c_func
(paren
id|sm_adm1026_init
)paren
suffix:semicolon
DECL|variable|sm_adm1026_exit
id|module_exit
c_func
(paren
id|sm_adm1026_exit
)paren
suffix:semicolon
eof
