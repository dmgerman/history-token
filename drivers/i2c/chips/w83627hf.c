multiline_comment|/*&n;    w83627hf.c - Part of lm_sensors, Linux kernel modules for hardware&n;                monitoring&n;    Copyright (c) 1998 - 2003  Frodo Looijaard &lt;frodol@dds.nl&gt;,&n;    Philip Edelbrock &lt;phil@netroedge.com&gt;,&n;    and Mark Studebaker &lt;mdsxyz123@yahoo.com&gt;&n;    Ported to 2.6 by Bernhard C. Schrenk &lt;clemy@clemy.org&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
multiline_comment|/*&n;    Supports following chips:&n;&n;    Chip&t;#vin&t;#fanin&t;#pwm&t;#temp&t;wchipid&t;vendid&t;i2c&t;ISA&n;    w83627hf&t;9&t;3&t;2&t;3&t;0x20&t;0x5ca3&t;no&t;yes(LPC)&n;    w83627thf&t;7&t;3&t;3&t;3&t;0x90&t;0x5ca3&t;no&t;yes(LPC)&n;    w83637hf&t;7&t;3&t;3&t;3&t;0x80&t;0x5ca3&t;no&t;yes(LPC)&n;    w83697hf&t;8&t;2&t;2&t;2&t;0x60&t;0x5ca3&t;no&t;yes(LPC)&n;&n;    For other winbond chips, and for i2c support in the above chips,&n;    use w83781d.c.&n;&n;    Note: automatic (&quot;cruise&quot;) fan control for 697, 637 &amp; 627thf not&n;    supported yet.&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
macro_line|#include &lt;linux/i2c-vid.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;lm75.h&quot;
DECL|variable|force_addr
r_static
id|u16
id|force_addr
suffix:semicolon
id|module_param
c_func
(paren
id|force_addr
comma
id|ushort
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_addr
comma
l_string|&quot;Initialize the base address of the sensors&quot;
)paren
suffix:semicolon
DECL|variable|force_i2c
r_static
id|u8
id|force_i2c
op_assign
l_int|0x1f
suffix:semicolon
id|module_param
c_func
(paren
id|force_i2c
comma
id|byte
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_i2c
comma
l_string|&quot;Initialize the i2c address of the sensors&quot;
)paren
suffix:semicolon
multiline_comment|/* Addresses to scan */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
l_int|0
comma
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/* Insmod parameters */
id|SENSORS_INSMOD_4
c_func
(paren
id|w83627hf
comma
id|w83627thf
comma
id|w83697hf
comma
id|w83637hf
)paren
suffix:semicolon
DECL|variable|init
r_static
r_int
id|init
op_assign
l_int|1
suffix:semicolon
id|module_param
c_func
(paren
id|init
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|init
comma
l_string|&quot;Set to zero to bypass chip initialization&quot;
)paren
suffix:semicolon
multiline_comment|/* modified from kernel/include/traps.c */
DECL|variable|REG
r_static
r_int
id|REG
suffix:semicolon
multiline_comment|/* The register to read/write */
DECL|macro|DEV
mdefine_line|#define&t;DEV&t;0x07&t;/* Register: Logical device select */
DECL|variable|VAL
r_static
r_int
id|VAL
suffix:semicolon
multiline_comment|/* The value to read/write */
multiline_comment|/* logical device numbers for superio_select (below) */
DECL|macro|W83627HF_LD_FDC
mdefine_line|#define W83627HF_LD_FDC&t;&t;0x00
DECL|macro|W83627HF_LD_PRT
mdefine_line|#define W83627HF_LD_PRT&t;&t;0x01
DECL|macro|W83627HF_LD_UART1
mdefine_line|#define W83627HF_LD_UART1&t;0x02
DECL|macro|W83627HF_LD_UART2
mdefine_line|#define W83627HF_LD_UART2&t;0x03
DECL|macro|W83627HF_LD_KBC
mdefine_line|#define W83627HF_LD_KBC&t;&t;0x05
DECL|macro|W83627HF_LD_CIR
mdefine_line|#define W83627HF_LD_CIR&t;&t;0x06 /* w83627hf only */
DECL|macro|W83627HF_LD_GAME
mdefine_line|#define W83627HF_LD_GAME&t;0x07
DECL|macro|W83627HF_LD_MIDI
mdefine_line|#define W83627HF_LD_MIDI&t;0x07
DECL|macro|W83627HF_LD_GPIO1
mdefine_line|#define W83627HF_LD_GPIO1&t;0x07
DECL|macro|W83627HF_LD_GPIO5
mdefine_line|#define W83627HF_LD_GPIO5&t;0x07 /* w83627thf only */
DECL|macro|W83627HF_LD_GPIO2
mdefine_line|#define W83627HF_LD_GPIO2&t;0x08
DECL|macro|W83627HF_LD_GPIO3
mdefine_line|#define W83627HF_LD_GPIO3&t;0x09
DECL|macro|W83627HF_LD_GPIO4
mdefine_line|#define W83627HF_LD_GPIO4&t;0x09 /* w83627thf only */
DECL|macro|W83627HF_LD_ACPI
mdefine_line|#define W83627HF_LD_ACPI&t;0x0a
DECL|macro|W83627HF_LD_HWM
mdefine_line|#define W83627HF_LD_HWM&t;&t;0x0b
DECL|macro|DEVID
mdefine_line|#define&t;DEVID&t;0x20&t;/* Register: Device ID */
DECL|macro|W83627THF_GPIO5_EN
mdefine_line|#define W83627THF_GPIO5_EN&t;0x30 /* w83627thf only */
DECL|macro|W83627THF_GPIO5_IOSR
mdefine_line|#define W83627THF_GPIO5_IOSR&t;0xf3 /* w83627thf only */
DECL|macro|W83627THF_GPIO5_DR
mdefine_line|#define W83627THF_GPIO5_DR&t;0xf4 /* w83627thf only */
r_static
r_inline
r_void
DECL|function|superio_outb
id|superio_outb
c_func
(paren
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|REG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|VAL
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|superio_inb
id|superio_inb
c_func
(paren
r_int
id|reg
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|REG
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|VAL
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|superio_select
id|superio_select
c_func
(paren
r_int
id|ld
)paren
(brace
id|outb
c_func
(paren
id|DEV
comma
id|REG
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ld
comma
id|VAL
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|superio_enter
id|superio_enter
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0x87
comma
id|REG
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x87
comma
id|REG
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|superio_exit
id|superio_exit
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
l_int|0xAA
comma
id|REG
)paren
suffix:semicolon
)brace
DECL|macro|W627_DEVID
mdefine_line|#define W627_DEVID 0x52
DECL|macro|W627THF_DEVID
mdefine_line|#define W627THF_DEVID 0x82
DECL|macro|W697_DEVID
mdefine_line|#define W697_DEVID 0x60
DECL|macro|W637_DEVID
mdefine_line|#define W637_DEVID 0x70
DECL|macro|WINB_ACT_REG
mdefine_line|#define WINB_ACT_REG 0x30
DECL|macro|WINB_BASE_REG
mdefine_line|#define WINB_BASE_REG 0x60
multiline_comment|/* Constants specified below */
multiline_comment|/* Length of ISA address segment */
DECL|macro|WINB_EXTENT
mdefine_line|#define WINB_EXTENT 8
multiline_comment|/* Where are the ISA address/data registers relative to the base address */
DECL|macro|W83781D_ADDR_REG_OFFSET
mdefine_line|#define W83781D_ADDR_REG_OFFSET 5
DECL|macro|W83781D_DATA_REG_OFFSET
mdefine_line|#define W83781D_DATA_REG_OFFSET 6
multiline_comment|/* The W83781D registers */
multiline_comment|/* The W83782D registers for nr=7,8 are in bank 5 */
DECL|macro|W83781D_REG_IN_MAX
mdefine_line|#define W83781D_REG_IN_MAX(nr) ((nr &lt; 7) ? (0x2b + (nr) * 2) : &bslash;&n;&t;&t;&t;&t;&t;   (0x554 + (((nr) - 7) * 2)))
DECL|macro|W83781D_REG_IN_MIN
mdefine_line|#define W83781D_REG_IN_MIN(nr) ((nr &lt; 7) ? (0x2c + (nr) * 2) : &bslash;&n;&t;&t;&t;&t;&t;   (0x555 + (((nr) - 7) * 2)))
DECL|macro|W83781D_REG_IN
mdefine_line|#define W83781D_REG_IN(nr)     ((nr &lt; 7) ? (0x20 + (nr)) : &bslash;&n;&t;&t;&t;&t;&t;   (0x550 + (nr) - 7))
DECL|macro|W83781D_REG_FAN_MIN
mdefine_line|#define W83781D_REG_FAN_MIN(nr) (0x3a + (nr))
DECL|macro|W83781D_REG_FAN
mdefine_line|#define W83781D_REG_FAN(nr) (0x27 + (nr))
DECL|macro|W83781D_REG_TEMP2_CONFIG
mdefine_line|#define W83781D_REG_TEMP2_CONFIG 0x152
DECL|macro|W83781D_REG_TEMP3_CONFIG
mdefine_line|#define W83781D_REG_TEMP3_CONFIG 0x252
DECL|macro|W83781D_REG_TEMP
mdefine_line|#define W83781D_REG_TEMP(nr)&t;&t;((nr == 3) ? (0x0250) : &bslash;&n;&t;&t;&t;&t;&t;((nr == 2) ? (0x0150) : &bslash;&n;&t;&t;&t;&t;&t;             (0x27)))
DECL|macro|W83781D_REG_TEMP_HYST
mdefine_line|#define W83781D_REG_TEMP_HYST(nr)&t;((nr == 3) ? (0x253) : &bslash;&n;&t;&t;&t;&t;&t;((nr == 2) ? (0x153) : &bslash;&n;&t;&t;&t;&t;&t;             (0x3A)))
DECL|macro|W83781D_REG_TEMP_OVER
mdefine_line|#define W83781D_REG_TEMP_OVER(nr)&t;((nr == 3) ? (0x255) : &bslash;&n;&t;&t;&t;&t;&t;((nr == 2) ? (0x155) : &bslash;&n;&t;&t;&t;&t;&t;             (0x39)))
DECL|macro|W83781D_REG_BANK
mdefine_line|#define W83781D_REG_BANK 0x4E
DECL|macro|W83781D_REG_CONFIG
mdefine_line|#define W83781D_REG_CONFIG 0x40
DECL|macro|W83781D_REG_ALARM1
mdefine_line|#define W83781D_REG_ALARM1 0x41
DECL|macro|W83781D_REG_ALARM2
mdefine_line|#define W83781D_REG_ALARM2 0x42
DECL|macro|W83781D_REG_ALARM3
mdefine_line|#define W83781D_REG_ALARM3 0x450
DECL|macro|W83781D_REG_IRQ
mdefine_line|#define W83781D_REG_IRQ 0x4C
DECL|macro|W83781D_REG_BEEP_CONFIG
mdefine_line|#define W83781D_REG_BEEP_CONFIG 0x4D
DECL|macro|W83781D_REG_BEEP_INTS1
mdefine_line|#define W83781D_REG_BEEP_INTS1 0x56
DECL|macro|W83781D_REG_BEEP_INTS2
mdefine_line|#define W83781D_REG_BEEP_INTS2 0x57
DECL|macro|W83781D_REG_BEEP_INTS3
mdefine_line|#define W83781D_REG_BEEP_INTS3 0x453
DECL|macro|W83781D_REG_VID_FANDIV
mdefine_line|#define W83781D_REG_VID_FANDIV 0x47
DECL|macro|W83781D_REG_CHIPID
mdefine_line|#define W83781D_REG_CHIPID 0x49
DECL|macro|W83781D_REG_WCHIPID
mdefine_line|#define W83781D_REG_WCHIPID 0x58
DECL|macro|W83781D_REG_CHIPMAN
mdefine_line|#define W83781D_REG_CHIPMAN 0x4F
DECL|macro|W83781D_REG_PIN
mdefine_line|#define W83781D_REG_PIN 0x4B
DECL|macro|W83781D_REG_VBAT
mdefine_line|#define W83781D_REG_VBAT 0x5D
DECL|macro|W83627HF_REG_PWM1
mdefine_line|#define W83627HF_REG_PWM1 0x5A
DECL|macro|W83627HF_REG_PWM2
mdefine_line|#define W83627HF_REG_PWM2 0x5B
DECL|macro|W83627HF_REG_PWMCLK12
mdefine_line|#define W83627HF_REG_PWMCLK12 0x5C
DECL|macro|W83627THF_REG_PWM1
mdefine_line|#define W83627THF_REG_PWM1&t;&t;0x01&t;/* 697HF and 637HF too */
DECL|macro|W83627THF_REG_PWM2
mdefine_line|#define W83627THF_REG_PWM2&t;&t;0x03&t;/* 697HF and 637HF too */
DECL|macro|W83627THF_REG_PWM3
mdefine_line|#define W83627THF_REG_PWM3&t;&t;0x11&t;/* 637HF too */
DECL|macro|W83627THF_REG_VRM_OVT_CFG
mdefine_line|#define W83627THF_REG_VRM_OVT_CFG &t;0x18&t;/* 637HF too */
DECL|variable|regpwm_627hf
r_static
r_const
id|u8
id|regpwm_627hf
(braket
)braket
op_assign
(brace
id|W83627HF_REG_PWM1
comma
id|W83627HF_REG_PWM2
)brace
suffix:semicolon
DECL|variable|regpwm
r_static
r_const
id|u8
id|regpwm
(braket
)braket
op_assign
(brace
id|W83627THF_REG_PWM1
comma
id|W83627THF_REG_PWM2
comma
id|W83627THF_REG_PWM3
)brace
suffix:semicolon
DECL|macro|W836X7HF_REG_PWM
mdefine_line|#define W836X7HF_REG_PWM(type, nr) (((type) == w83627hf) ? &bslash;&n;                                     regpwm_627hf[(nr) - 1] : regpwm[(nr) - 1])
DECL|macro|W83781D_REG_I2C_ADDR
mdefine_line|#define W83781D_REG_I2C_ADDR 0x48
DECL|macro|W83781D_REG_I2C_SUBADDR
mdefine_line|#define W83781D_REG_I2C_SUBADDR 0x4A
multiline_comment|/* Sensor selection */
DECL|macro|W83781D_REG_SCFG1
mdefine_line|#define W83781D_REG_SCFG1 0x5D
DECL|variable|BIT_SCFG1
r_static
r_const
id|u8
id|BIT_SCFG1
(braket
)braket
op_assign
(brace
l_int|0x02
comma
l_int|0x04
comma
l_int|0x08
)brace
suffix:semicolon
DECL|macro|W83781D_REG_SCFG2
mdefine_line|#define W83781D_REG_SCFG2 0x59
DECL|variable|BIT_SCFG2
r_static
r_const
id|u8
id|BIT_SCFG2
(braket
)braket
op_assign
(brace
l_int|0x10
comma
l_int|0x20
comma
l_int|0x40
)brace
suffix:semicolon
DECL|macro|W83781D_DEFAULT_BETA
mdefine_line|#define W83781D_DEFAULT_BETA 3435
multiline_comment|/* Conversions. Limit checking is only done on the TO_REG&n;   variants. Note that you should be a bit careful with which arguments&n;   these macros are called: arguments may be evaluated more than once.&n;   Fixing this is just not worth it. */
DECL|macro|IN_TO_REG
mdefine_line|#define IN_TO_REG(val)  (SENSORS_LIMIT((((val) + 8)/16),0,255))
DECL|macro|IN_FROM_REG
mdefine_line|#define IN_FROM_REG(val) ((val) * 16)
DECL|function|FAN_TO_REG
r_static
r_inline
id|u8
id|FAN_TO_REG
c_func
(paren
r_int
id|rpm
comma
r_int
id|div
)paren
(brace
r_if
c_cond
(paren
id|rpm
op_eq
l_int|0
)paren
r_return
l_int|255
suffix:semicolon
id|rpm
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|rpm
comma
l_int|1
comma
l_int|1000000
)paren
suffix:semicolon
r_return
id|SENSORS_LIMIT
c_func
(paren
(paren
l_int|1350000
op_plus
id|rpm
op_star
id|div
op_div
l_int|2
)paren
op_div
(paren
id|rpm
op_star
id|div
)paren
comma
l_int|1
comma
l_int|254
)paren
suffix:semicolon
)brace
DECL|macro|TEMP_MIN
mdefine_line|#define TEMP_MIN (-128000)
DECL|macro|TEMP_MAX
mdefine_line|#define TEMP_MAX ( 127000)
multiline_comment|/* TEMP: 0.001C/bit (-128C to +127C)&n;   REG: 1C/bit, two&squot;s complement */
DECL|function|TEMP_TO_REG
r_static
id|u8
id|TEMP_TO_REG
c_func
(paren
r_int
id|temp
)paren
(brace
r_int
id|ntemp
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|temp
comma
id|TEMP_MIN
comma
id|TEMP_MAX
)paren
suffix:semicolon
id|ntemp
op_add_assign
(paren
id|ntemp
OL
l_int|0
ques
c_cond
op_minus
l_int|500
suffix:colon
l_int|500
)paren
suffix:semicolon
r_return
(paren
id|u8
)paren
(paren
id|ntemp
op_div
l_int|1000
)paren
suffix:semicolon
)brace
DECL|function|TEMP_FROM_REG
r_static
r_int
id|TEMP_FROM_REG
c_func
(paren
id|u8
id|reg
)paren
(brace
r_return
(paren
id|s8
)paren
id|reg
op_star
l_int|1000
suffix:semicolon
)brace
DECL|macro|FAN_FROM_REG
mdefine_line|#define FAN_FROM_REG(val,div) ((val)==0?-1:(val)==255?0:1350000/((val)*(div)))
DECL|macro|PWM_TO_REG
mdefine_line|#define PWM_TO_REG(val) (SENSORS_LIMIT((val),0,255))
DECL|macro|BEEP_MASK_FROM_REG
mdefine_line|#define BEEP_MASK_FROM_REG(val)&t;&t; (val)
DECL|macro|BEEP_MASK_TO_REG
mdefine_line|#define BEEP_MASK_TO_REG(val)&t;&t;((val) &amp; 0xffffff)
DECL|macro|BEEP_ENABLE_TO_REG
mdefine_line|#define BEEP_ENABLE_TO_REG(val)&t;&t;((val)?1:0)
DECL|macro|BEEP_ENABLE_FROM_REG
mdefine_line|#define BEEP_ENABLE_FROM_REG(val)&t;((val)?1:0)
DECL|macro|DIV_FROM_REG
mdefine_line|#define DIV_FROM_REG(val) (1 &lt;&lt; (val))
DECL|function|DIV_TO_REG
r_static
r_inline
id|u8
id|DIV_TO_REG
c_func
(paren
r_int
id|val
)paren
(brace
r_int
id|i
suffix:semicolon
id|val
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|val
comma
l_int|1
comma
l_int|128
)paren
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|val
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|val
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
(paren
(paren
id|u8
)paren
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* For each registered chip, we need to keep some data in memory. That&n;   data is pointed to by w83627hf_list[NR]-&gt;data. The structure itself is&n;   dynamically allocated, at the same time when a new client is allocated. */
DECL|struct|w83627hf_data
r_struct
id|w83627hf_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|lock
r_struct
id|semaphore
id|lock
suffix:semicolon
DECL|member|type
r_enum
id|chips
id|type
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* !=0 if following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|lm75
r_struct
id|i2c_client
op_star
id|lm75
suffix:semicolon
multiline_comment|/* for secondary I2C addresses */
multiline_comment|/* pointer to array of 2 subclients */
DECL|member|in
id|u8
id|in
(braket
l_int|9
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_max
id|u8
id|in_max
(braket
l_int|9
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_min
id|u8
id|in_min
(braket
l_int|9
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan
id|u8
id|fan
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp
id|u8
id|temp
suffix:semicolon
DECL|member|temp_max
id|u8
id|temp_max
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_max_hyst
id|u8
id|temp_max_hyst
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_add
id|u16
id|temp_add
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_max_add
id|u16
id|temp_max_add
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_max_hyst_add
id|u16
id|temp_max_hyst_add
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_div
id|u8
id|fan_div
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register encoding, shifted right */
DECL|member|vid
id|u8
id|vid
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|alarms
id|u32
id|alarms
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|beep_mask
id|u32
id|beep_mask
suffix:semicolon
multiline_comment|/* Register encoding, combined */
DECL|member|beep_enable
id|u8
id|beep_enable
suffix:semicolon
multiline_comment|/* Boolean */
DECL|member|pwm
id|u8
id|pwm
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|pwmenable
id|u8
id|pwmenable
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* bool */
DECL|member|sens
id|u16
id|sens
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* 782D/783S only.&n;&t;&t;&t;&t;   1 = pentium diode; 2 = 3904 diode;&n;&t;&t;&t;&t;   3000-5000 = thermistor beta.&n;&t;&t;&t;&t;   Default = 3435.&n;&t;&t;&t;&t;   Other Betas unimplemented */
DECL|member|vrm
id|u8
id|vrm
suffix:semicolon
DECL|member|vrm_ovt
id|u8
id|vrm_ovt
suffix:semicolon
multiline_comment|/* Register value, 627thf &amp; 637hf only */
)brace
suffix:semicolon
r_static
r_int
id|w83627hf_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|w83627hf_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|w83627hf_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|w83627hf_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u16
r_register
)paren
suffix:semicolon
r_static
r_int
id|w83627hf_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u16
r_register
comma
id|u16
id|value
)paren
suffix:semicolon
r_static
r_struct
id|w83627hf_data
op_star
id|w83627hf_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|w83627hf_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
DECL|variable|w83627hf_driver
r_static
r_struct
id|i2c_driver
id|w83627hf_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;w83627hf&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_W83627HF
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|w83627hf_attach_adapter
comma
dot
id|detach_client
op_assign
id|w83627hf_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/* following are the sysfs callback functions */
DECL|macro|show_in_reg
mdefine_line|#define show_in_reg(reg) &bslash;&n;static ssize_t show_##reg (struct device *dev, char *buf, int nr) &bslash;&n;{ &bslash;&n;&t;struct w83627hf_data *data = w83627hf_update_device(dev); &bslash;&n;&t;return sprintf(buf,&quot;%ld&bslash;n&quot;, (long)IN_FROM_REG(data-&gt;reg[nr])); &bslash;&n;}
id|show_in_reg
c_func
(paren
id|in
)paren
id|show_in_reg
c_func
(paren
id|in_min
)paren
id|show_in_reg
c_func
(paren
id|in_max
)paren
DECL|macro|store_in_reg
mdefine_line|#define store_in_reg(REG, reg) &bslash;&n;static ssize_t &bslash;&n;store_in_##reg (struct device *dev, const char *buf, size_t count, int nr) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct w83627hf_data *data = i2c_get_clientdata(client); &bslash;&n;&t;u32 val; &bslash;&n;&t; &bslash;&n;&t;val = simple_strtoul(buf, NULL, 10); &bslash;&n;&t;data-&gt;in_##reg[nr] = IN_TO_REG(val); &bslash;&n;&t;w83627hf_write_value(client, W83781D_REG_IN_##REG(nr), &bslash;&n;&t;&t;&t;    data-&gt;in_##reg[nr]); &bslash;&n;&t; &bslash;&n;&t;return count; &bslash;&n;}
id|store_in_reg
c_func
(paren
id|MIN
comma
id|min
)paren
id|store_in_reg
c_func
(paren
id|MAX
comma
id|max
)paren
DECL|macro|sysfs_in_offset
mdefine_line|#define sysfs_in_offset(offset) &bslash;&n;static ssize_t &bslash;&n;show_regs_in_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;        return show_in(dev, buf, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(in##offset##_input, S_IRUGO, show_regs_in_##offset, NULL);
DECL|macro|sysfs_in_reg_offset
mdefine_line|#define sysfs_in_reg_offset(reg, offset) &bslash;&n;static ssize_t show_regs_in_##reg##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_in_##reg (dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_in_##reg##offset (struct device *dev, &bslash;&n;&t;&t;&t;    const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_in_##reg (dev, buf, count, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(in##offset##_##reg, S_IRUGO| S_IWUSR, &bslash;&n;&t;&t;  show_regs_in_##reg##offset, store_regs_in_##reg##offset);
DECL|macro|sysfs_in_offsets
mdefine_line|#define sysfs_in_offsets(offset) &bslash;&n;sysfs_in_offset(offset) &bslash;&n;sysfs_in_reg_offset(min, offset) &bslash;&n;sysfs_in_reg_offset(max, offset)
id|sysfs_in_offsets
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|6
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|sysfs_in_offsets
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* use a different set of functions for in0 */
DECL|function|show_in_0
r_static
id|ssize_t
id|show_in_0
c_func
(paren
r_struct
id|w83627hf_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
id|u8
id|reg
)paren
(brace
r_int
id|in0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;vrm_ovt
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|w83627thf
op_eq
id|data-&gt;type
op_logical_or
id|w83637hf
op_eq
id|data-&gt;type
)paren
)paren
multiline_comment|/* use VRM9 calculation */
id|in0
op_assign
(paren
r_int
)paren
(paren
(paren
id|reg
op_star
l_int|488
op_plus
l_int|70000
op_plus
l_int|50
)paren
op_div
l_int|100
)paren
suffix:semicolon
r_else
multiline_comment|/* use VRM8 (standard) calculation */
id|in0
op_assign
(paren
r_int
)paren
id|IN_FROM_REG
c_func
(paren
id|reg
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|in0
)paren
suffix:semicolon
)brace
DECL|function|show_regs_in_0
r_static
id|ssize_t
id|show_regs_in_0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|show_in_0
c_func
(paren
id|data
comma
id|buf
comma
id|data-&gt;in
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|show_regs_in_min0
r_static
id|ssize_t
id|show_regs_in_min0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|show_in_0
c_func
(paren
id|data
comma
id|buf
comma
id|data-&gt;in_min
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|show_regs_in_max0
r_static
id|ssize_t
id|show_regs_in_max0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|show_in_0
c_func
(paren
id|data
comma
id|buf
comma
id|data-&gt;in_max
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|store_regs_in_min0
r_static
id|ssize_t
id|store_regs_in_min0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;vrm_ovt
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|w83627thf
op_eq
id|data-&gt;type
op_logical_or
id|w83637hf
op_eq
id|data-&gt;type
)paren
)paren
multiline_comment|/* use VRM9 calculation */
id|data-&gt;in_min
(braket
l_int|0
)braket
op_assign
(paren
id|u8
)paren
(paren
(paren
(paren
id|val
op_star
l_int|100
)paren
op_minus
l_int|70000
op_plus
l_int|244
)paren
op_div
l_int|488
)paren
suffix:semicolon
r_else
multiline_comment|/* use VRM8 (standard) calculation */
id|data-&gt;in_min
(braket
l_int|0
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_IN_MIN
c_func
(paren
l_int|0
)paren
comma
id|data-&gt;in_min
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|store_regs_in_max0
r_static
id|ssize_t
id|store_regs_in_max0
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data-&gt;vrm_ovt
op_amp
l_int|0x01
)paren
op_logical_and
(paren
id|w83627thf
op_eq
id|data-&gt;type
op_logical_or
id|w83637hf
op_eq
id|data-&gt;type
)paren
)paren
multiline_comment|/* use VRM9 calculation */
id|data-&gt;in_max
(braket
l_int|0
)braket
op_assign
(paren
id|u8
)paren
(paren
(paren
(paren
id|val
op_star
l_int|100
)paren
op_minus
l_int|70000
op_plus
l_int|244
)paren
op_div
l_int|488
)paren
suffix:semicolon
r_else
multiline_comment|/* use VRM8 (standard) calculation */
id|data-&gt;in_max
(braket
l_int|0
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_IN_MAX
c_func
(paren
l_int|0
)paren
comma
id|data-&gt;in_max
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_input
comma
id|S_IRUGO
comma
id|show_regs_in_0
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_min
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_regs_in_min0
comma
id|store_regs_in_min0
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|in0_max
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_regs_in_max0
comma
id|store_regs_in_max0
)paren
suffix:semicolon
DECL|macro|device_create_file_in
mdefine_line|#define device_create_file_in(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_in##offset##_input); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_in##offset##_min); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_in##offset##_max); &bslash;&n;} while (0)
DECL|macro|show_fan_reg
mdefine_line|#define show_fan_reg(reg) &bslash;&n;static ssize_t show_##reg (struct device *dev, char *buf, int nr) &bslash;&n;{ &bslash;&n;&t;struct w83627hf_data *data = w83627hf_update_device(dev); &bslash;&n;&t;return sprintf(buf,&quot;%ld&bslash;n&quot;, &bslash;&n;&t;&t;FAN_FROM_REG(data-&gt;reg[nr-1], &bslash;&n;&t;&t;&t;    (long)DIV_FROM_REG(data-&gt;fan_div[nr-1]))); &bslash;&n;}
DECL|variable|fan
id|show_fan_reg
c_func
(paren
id|fan
)paren
suffix:semicolon
DECL|variable|fan_min
id|show_fan_reg
c_func
(paren
id|fan_min
)paren
suffix:semicolon
r_static
id|ssize_t
DECL|function|store_fan_min
id|store_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|val
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
op_minus
l_int|1
)braket
)paren
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|sysfs_fan_offset
mdefine_line|#define sysfs_fan_offset(offset) &bslash;&n;static ssize_t show_regs_fan_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_fan(dev, buf, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(fan##offset##_input, S_IRUGO, show_regs_fan_##offset, NULL);
DECL|macro|sysfs_fan_min_offset
mdefine_line|#define sysfs_fan_min_offset(offset) &bslash;&n;static ssize_t show_regs_fan_min##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_fan_min(dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_fan_min##offset (struct device *dev, const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_fan_min(dev, buf, count, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(fan##offset##_min, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;  show_regs_fan_min##offset, store_regs_fan_min##offset);
id|sysfs_fan_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_fan_min_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_fan_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_fan_min_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_fan_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|sysfs_fan_min_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|macro|device_create_file_fan
mdefine_line|#define device_create_file_fan(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_input); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_min); &bslash;&n;} while (0)
DECL|macro|show_temp_reg
mdefine_line|#define show_temp_reg(reg) &bslash;&n;static ssize_t show_##reg (struct device *dev, char *buf, int nr) &bslash;&n;{ &bslash;&n;&t;struct w83627hf_data *data = w83627hf_update_device(dev); &bslash;&n;&t;if (nr &gt;= 2) {&t;/* TEMP2 and TEMP3 */ &bslash;&n;&t;&t;return sprintf(buf,&quot;%ld&bslash;n&quot;, &bslash;&n;&t;&t;&t;(long)LM75_TEMP_FROM_REG(data-&gt;reg##_add[nr-2])); &bslash;&n;&t;} else {&t;/* TEMP1 */ &bslash;&n;&t;&t;return sprintf(buf,&quot;%ld&bslash;n&quot;, (long)TEMP_FROM_REG(data-&gt;reg)); &bslash;&n;&t;} &bslash;&n;}
DECL|variable|temp
id|show_temp_reg
c_func
(paren
id|temp
)paren
suffix:semicolon
DECL|variable|temp_max
id|show_temp_reg
c_func
(paren
id|temp_max
)paren
suffix:semicolon
DECL|variable|temp_max_hyst
id|show_temp_reg
c_func
(paren
id|temp_max_hyst
)paren
suffix:semicolon
DECL|macro|store_temp_reg
mdefine_line|#define store_temp_reg(REG, reg) &bslash;&n;static ssize_t &bslash;&n;store_temp_##reg (struct device *dev, const char *buf, size_t count, int nr) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct w83627hf_data *data = i2c_get_clientdata(client); &bslash;&n;&t;u32 val; &bslash;&n;&t; &bslash;&n;&t;val = simple_strtoul(buf, NULL, 10); &bslash;&n;&t; &bslash;&n;&t;if (nr &gt;= 2) {&t;/* TEMP2 and TEMP3 */ &bslash;&n;&t;&t;data-&gt;temp_##reg##_add[nr-2] = LM75_TEMP_TO_REG(val); &bslash;&n;&t;&t;w83627hf_write_value(client, W83781D_REG_TEMP_##REG(nr), &bslash;&n;&t;&t;&t;&t;data-&gt;temp_##reg##_add[nr-2]); &bslash;&n;&t;} else {&t;/* TEMP1 */ &bslash;&n;&t;&t;data-&gt;temp_##reg = TEMP_TO_REG(val); &bslash;&n;&t;&t;w83627hf_write_value(client, W83781D_REG_TEMP_##REG(nr), &bslash;&n;&t;&t;&t;data-&gt;temp_##reg); &bslash;&n;&t;} &bslash;&n;&t; &bslash;&n;&t;return count; &bslash;&n;}
id|store_temp_reg
c_func
(paren
id|OVER
comma
id|max
)paren
suffix:semicolon
id|store_temp_reg
c_func
(paren
id|HYST
comma
id|max_hyst
)paren
suffix:semicolon
DECL|macro|sysfs_temp_offset
mdefine_line|#define sysfs_temp_offset(offset) &bslash;&n;static ssize_t &bslash;&n;show_regs_temp_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_temp(dev, buf, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(temp##offset##_input, S_IRUGO, show_regs_temp_##offset, NULL);
DECL|macro|sysfs_temp_reg_offset
mdefine_line|#define sysfs_temp_reg_offset(reg, offset) &bslash;&n;static ssize_t show_regs_temp_##reg##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_temp_##reg (dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_temp_##reg##offset (struct device *dev, &bslash;&n;&t;&t;&t;      const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_temp_##reg (dev, buf, count, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(temp##offset##_##reg, S_IRUGO| S_IWUSR, &bslash;&n;&t;&t;  show_regs_temp_##reg##offset, store_regs_temp_##reg##offset);
DECL|macro|sysfs_temp_offsets
mdefine_line|#define sysfs_temp_offsets(offset) &bslash;&n;sysfs_temp_offset(offset) &bslash;&n;sysfs_temp_reg_offset(max, offset) &bslash;&n;sysfs_temp_reg_offset(max_hyst, offset)
id|sysfs_temp_offsets
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_temp_offsets
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_temp_offsets
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|macro|device_create_file_temp
mdefine_line|#define device_create_file_temp(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_input); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_max); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_max_hyst); &bslash;&n;} while (0)
r_static
id|ssize_t
DECL|function|show_vid_reg
id|show_vid_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|vid_from_reg
c_func
(paren
id|data-&gt;vid
comma
id|data-&gt;vrm
)paren
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|cpu0_vid
comma
id|S_IRUGO
comma
id|show_vid_reg
comma
l_int|NULL
)paren
suffix:semicolon
DECL|macro|device_create_file_vid
mdefine_line|#define device_create_file_vid(client) &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_cpu0_vid)
r_static
id|ssize_t
DECL|function|show_vrm_reg
id|show_vrm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|data-&gt;vrm
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_vrm_reg
id|store_vrm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;vrm
op_assign
id|val
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|vrm
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_vrm_reg
comma
id|store_vrm_reg
)paren
suffix:semicolon
DECL|macro|device_create_file_vrm
mdefine_line|#define device_create_file_vrm(client) &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_vrm)
r_static
id|ssize_t
DECL|function|show_alarms_reg
id|show_alarms_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|data-&gt;alarms
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarms
comma
id|S_IRUGO
comma
id|show_alarms_reg
comma
l_int|NULL
)paren
suffix:semicolon
DECL|macro|device_create_file_alarms
mdefine_line|#define device_create_file_alarms(client) &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_alarms)
DECL|macro|show_beep_reg
mdefine_line|#define show_beep_reg(REG, reg) &bslash;&n;static ssize_t show_beep_##reg (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct w83627hf_data *data = w83627hf_update_device(dev); &bslash;&n;&t;return sprintf(buf,&quot;%ld&bslash;n&quot;, &bslash;&n;&t;&t;      (long)BEEP_##REG##_FROM_REG(data-&gt;beep_##reg)); &bslash;&n;}
id|show_beep_reg
c_func
(paren
id|ENABLE
comma
id|enable
)paren
id|show_beep_reg
c_func
(paren
id|MASK
comma
id|mask
)paren
DECL|macro|BEEP_ENABLE
mdefine_line|#define BEEP_ENABLE&t;&t;&t;0&t;/* Store beep_enable */
DECL|macro|BEEP_MASK
mdefine_line|#define BEEP_MASK&t;&t;&t;1&t;/* Store beep_mask */
r_static
id|ssize_t
DECL|function|store_beep_reg
id|store_beep_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|update_mask
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
comma
id|val2
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|update_mask
op_eq
id|BEEP_MASK
)paren
(brace
multiline_comment|/* We are storing beep_mask */
id|data-&gt;beep_mask
op_assign
id|BEEP_MASK_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS1
comma
id|data-&gt;beep_mask
op_amp
l_int|0xff
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS3
comma
(paren
(paren
id|data-&gt;beep_mask
)paren
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|val2
op_assign
(paren
id|data-&gt;beep_mask
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* We are storing beep_enable */
id|val2
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS2
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|data-&gt;beep_enable
op_assign
id|BEEP_ENABLE_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS2
comma
id|val2
op_or
id|data-&gt;beep_enable
op_lshift
l_int|7
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|sysfs_beep
mdefine_line|#define sysfs_beep(REG, reg) &bslash;&n;static ssize_t show_regs_beep_##reg (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_beep_##reg(dev, buf); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_beep_##reg (struct device *dev, const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_beep_reg(dev, buf, count, BEEP_##REG); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(beep_##reg, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;  show_regs_beep_##reg, store_regs_beep_##reg);
id|sysfs_beep
c_func
(paren
id|ENABLE
comma
id|enable
)paren
suffix:semicolon
id|sysfs_beep
c_func
(paren
id|MASK
comma
id|mask
)paren
suffix:semicolon
DECL|macro|device_create_file_beep
mdefine_line|#define device_create_file_beep(client) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_beep_enable); &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_beep_mask); &bslash;&n;} while (0)
r_static
id|ssize_t
DECL|function|show_fan_div_reg
id|show_fan_div_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
op_minus
l_int|1
)braket
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Note: we save and restore the fan minimum here, because its value is&n;   determined in part by the fan divisor.  This follows the principle of&n;   least suprise; the user doesn&squot;t expect the fan minimum to change just&n;   because the divisor changed. */
r_static
id|ssize_t
DECL|function|store_fan_div_reg
id|store_fan_div_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|min
suffix:semicolon
id|u8
id|reg
suffix:semicolon
multiline_comment|/* Save fan_min */
id|min
op_assign
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
id|DIV_TO_REG
c_func
(paren
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|nr
op_eq
l_int|2
ques
c_cond
id|W83781D_REG_PIN
suffix:colon
id|W83781D_REG_VID_FANDIV
)paren
op_amp
(paren
id|nr
op_eq
l_int|0
ques
c_cond
l_int|0xcf
suffix:colon
l_int|0x3f
)paren
)paren
op_or
(paren
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_amp
l_int|0x03
)paren
op_lshift
(paren
id|nr
op_eq
l_int|0
ques
c_cond
l_int|4
suffix:colon
l_int|6
)paren
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|nr
op_eq
l_int|2
ques
c_cond
id|W83781D_REG_PIN
suffix:colon
id|W83781D_REG_VID_FANDIV
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_VBAT
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
(paren
l_int|5
op_plus
id|nr
)paren
)paren
)paren
op_or
(paren
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_amp
l_int|0x04
)paren
op_lshift
(paren
l_int|3
op_plus
id|nr
)paren
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_VBAT
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* Restore fan_min */
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|min
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
id|nr
op_plus
l_int|1
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|sysfs_fan_div
mdefine_line|#define sysfs_fan_div(offset) &bslash;&n;static ssize_t show_regs_fan_div_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_fan_div_reg(dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_fan_div_##offset (struct device *dev, &bslash;&n;&t;&t;&t;    const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_fan_div_reg(dev, buf, count, offset - 1); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(fan##offset##_div, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;  show_regs_fan_div_##offset, store_regs_fan_div_##offset);
id|sysfs_fan_div
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_fan_div
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_fan_div
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|macro|device_create_file_fan_div
mdefine_line|#define device_create_file_fan_div(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_div); &bslash;&n;} while (0)
r_static
id|ssize_t
DECL|function|show_pwm_reg
id|show_pwm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_pwm_reg
id|store_pwm_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;type
op_eq
id|w83627thf
)paren
(brace
multiline_comment|/* bits 0-3 are reserved  in 627THF */
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|PWM_TO_REG
c_func
(paren
id|val
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W836X7HF_REG_PWM
c_func
(paren
id|data-&gt;type
comma
id|nr
)paren
comma
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
op_or
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W836X7HF_REG_PWM
c_func
(paren
id|data-&gt;type
comma
id|nr
)paren
)paren
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|PWM_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W836X7HF_REG_PWM
c_func
(paren
id|data-&gt;type
comma
id|nr
)paren
comma
id|data-&gt;pwm
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|macro|sysfs_pwm
mdefine_line|#define sysfs_pwm(offset) &bslash;&n;static ssize_t show_regs_pwm_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;return show_pwm_reg(dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_pwm_##offset (struct device *dev, const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;return store_pwm_reg(dev, buf, count, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(pwm##offset, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;  show_regs_pwm_##offset, store_regs_pwm_##offset);
id|sysfs_pwm
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_pwm
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_pwm
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|macro|device_create_file_pwm
mdefine_line|#define device_create_file_pwm(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_pwm##offset); &bslash;&n;} while (0)
r_static
id|ssize_t
DECL|function|show_sensor_reg
id|show_sensor_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|w83627hf_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|data-&gt;sens
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|store_sensor_reg
id|store_sensor_reg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|u32
id|val
comma
id|tmp
suffix:semicolon
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* PII/Celeron diode */
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
comma
id|tmp
op_or
id|BIT_SCFG1
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG2
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG2
comma
id|tmp
op_or
id|BIT_SCFG2
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|data-&gt;sens
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* 3904 */
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
comma
id|tmp
op_or
id|BIT_SCFG1
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG2
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG2
comma
id|tmp
op_amp
op_complement
id|BIT_SCFG2
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|data-&gt;sens
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|W83781D_DEFAULT_BETA
suffix:colon
multiline_comment|/* thermistor */
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
comma
id|tmp
op_amp
op_complement
id|BIT_SCFG1
(braket
id|nr
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|data-&gt;sens
(braket
id|nr
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Invalid sensor type %ld; must be 1, 2, or %d&bslash;n&quot;
comma
(paren
r_int
)paren
id|val
comma
id|W83781D_DEFAULT_BETA
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|macro|sysfs_sensor
mdefine_line|#define sysfs_sensor(offset) &bslash;&n;static ssize_t show_regs_sensor_##offset (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;    return show_sensor_reg(dev, buf, offset); &bslash;&n;} &bslash;&n;static ssize_t &bslash;&n;store_regs_sensor_##offset (struct device *dev, const char *buf, size_t count) &bslash;&n;{ &bslash;&n;    return store_sensor_reg(dev, buf, count, offset); &bslash;&n;} &bslash;&n;static DEVICE_ATTR(temp##offset##_type, S_IRUGO | S_IWUSR, &bslash;&n;&t;&t;  show_regs_sensor_##offset, store_regs_sensor_##offset);
id|sysfs_sensor
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|sysfs_sensor
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|sysfs_sensor
c_func
(paren
l_int|3
)paren
suffix:semicolon
DECL|macro|device_create_file_sensor
mdefine_line|#define device_create_file_sensor(client, offset) &bslash;&n;do { &bslash;&n;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_type); &bslash;&n;} while (0)
multiline_comment|/* This function is called when:&n;     * w83627hf_driver is inserted (when this module is loaded), for each&n;       available adapter&n;     * when a new adapter is inserted (and w83627hf_driver is still present) */
DECL|function|w83627hf_attach_adapter
r_static
r_int
id|w83627hf_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|w83627hf_detect
)paren
suffix:semicolon
)brace
DECL|function|w83627hf_find
r_static
r_int
id|w83627hf_find
c_func
(paren
r_int
id|sioaddr
comma
r_int
op_star
id|address
)paren
(brace
id|u16
id|val
suffix:semicolon
id|REG
op_assign
id|sioaddr
suffix:semicolon
id|VAL
op_assign
id|sioaddr
op_plus
l_int|1
suffix:semicolon
id|superio_enter
c_func
(paren
)paren
suffix:semicolon
id|val
op_assign
id|superio_inb
c_func
(paren
id|DEVID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|W627_DEVID
op_logical_and
id|val
op_ne
id|W627THF_DEVID
op_logical_and
id|val
op_ne
id|W697_DEVID
op_logical_and
id|val
op_ne
id|W637_DEVID
)paren
(brace
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|superio_select
c_func
(paren
id|W83627HF_LD_HWM
)paren
suffix:semicolon
id|val
op_assign
(paren
id|superio_inb
c_func
(paren
id|WINB_BASE_REG
)paren
op_lshift
l_int|8
)paren
op_or
id|superio_inb
c_func
(paren
id|WINB_BASE_REG
op_plus
l_int|1
)paren
suffix:semicolon
op_star
id|address
op_assign
id|val
op_amp
op_complement
(paren
id|WINB_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|address
op_eq
l_int|0
op_logical_and
id|force_addr
op_eq
l_int|0
)paren
(brace
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
op_star
id|address
op_assign
id|force_addr
suffix:semicolon
multiline_comment|/* so detect will get called */
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|w83627hf_detect
r_int
id|w83627hf_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_int
id|val
suffix:semicolon
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|client_name
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2c_is_isa_adapter
c_func
(paren
id|adapter
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|address
op_assign
id|force_addr
op_amp
op_complement
(paren
id|WINB_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|address
comma
id|WINB_EXTENT
comma
id|w83627hf_driver.name
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;w83627hf.o: forcing ISA address 0x%04X&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
id|superio_enter
c_func
(paren
)paren
suffix:semicolon
id|superio_select
c_func
(paren
id|W83627HF_LD_HWM
)paren
suffix:semicolon
id|superio_outb
c_func
(paren
id|WINB_BASE_REG
comma
id|address
op_rshift
l_int|8
)paren
suffix:semicolon
id|superio_outb
c_func
(paren
id|WINB_BASE_REG
op_plus
l_int|1
comma
id|address
op_amp
l_int|0xff
)paren
suffix:semicolon
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
)brace
id|superio_enter
c_func
(paren
)paren
suffix:semicolon
id|val
op_assign
id|superio_inb
c_func
(paren
id|DEVID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|W627_DEVID
)paren
(brace
id|kind
op_assign
id|w83627hf
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_eq
id|W697_DEVID
)paren
(brace
id|kind
op_assign
id|w83697hf
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_eq
id|W627THF_DEVID
)paren
(brace
id|kind
op_assign
id|w83627thf
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_eq
id|W637_DEVID
)paren
(brace
id|kind
op_assign
id|w83637hf
suffix:semicolon
)brace
r_else
(brace
id|dev_info
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;Unsupported chip (dev_id=0x%02X).&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_goto
id|ERROR1
suffix:semicolon
)brace
id|superio_select
c_func
(paren
id|W83627HF_LD_HWM
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
l_int|0x01
op_amp
id|superio_inb
c_func
(paren
id|WINB_ACT_REG
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|superio_outb
c_func
(paren
id|WINB_ACT_REG
comma
l_int|1
)paren
suffix:semicolon
)brace
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* OK. For now, we presume we have a valid client. We now create the&n;&t;   client structure, even though we cannot fill it completely yet.&n;&t;   But it allows us to access w83627hf_{read,write}_value. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|w83627hf_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|ERROR1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|w83627hf_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|w83627hf_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_eq
id|w83627hf
)paren
(brace
id|client_name
op_assign
l_string|&quot;w83627hf&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|kind
op_eq
id|w83627thf
)paren
(brace
id|client_name
op_assign
l_string|&quot;w83627thf&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|kind
op_eq
id|w83697hf
)paren
(brace
id|client_name
op_assign
l_string|&quot;w83697hf&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|kind
op_eq
id|w83637hf
)paren
(brace
id|client_name
op_assign
l_string|&quot;w83637hf&quot;
suffix:semicolon
)brace
multiline_comment|/* Fill in the remaining client fields and put into the global list */
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
id|client_name
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|data-&gt;type
op_assign
id|kind
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|ERROR2
suffix:semicolon
id|data-&gt;lm75
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Initialize the chip */
id|w83627hf_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* A few vars need to be filled upon startup */
id|data-&gt;fan_min
(braket
l_int|0
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|new_client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|new_client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|2
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|new_client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83627thf
op_logical_and
id|kind
op_ne
id|w83637hf
)paren
(brace
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|5
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|6
)paren
suffix:semicolon
)brace
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|7
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|8
)paren
suffix:semicolon
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_vid
c_func
(paren
id|new_client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_vrm
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_fan_div
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_fan_div
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_fan_div
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
id|device_create_file_alarms
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_beep
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_pwm
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_pwm
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_eq
id|w83627thf
op_logical_or
id|kind
op_eq
id|w83637hf
)paren
id|device_create_file_pwm
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
id|device_create_file_sensor
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_sensor
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kind
op_ne
id|w83697hf
)paren
id|device_create_file_sensor
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ERROR2
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
id|ERROR1
suffix:colon
id|release_region
c_func
(paren
id|address
comma
id|WINB_EXTENT
)paren
suffix:semicolon
id|ERROR0
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|w83627hf_detach_client
r_static
r_int
id|w83627hf_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, client not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|release_region
c_func
(paren
id|client-&gt;addr
comma
id|WINB_EXTENT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;   ISA access must always be locked explicitly!&n;   We ignore the W83781D BUSY flag at this moment - it could lead to deadlocks,&n;   would slow down the W83781D access and should not be necessary.&n;   There are some ugly typecasts here, but the good news is - they should&n;   nowhere else be necessary! */
DECL|function|w83627hf_read_value
r_static
r_int
id|w83627hf_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u16
id|reg
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|res
comma
id|word_sized
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|word_sized
op_assign
(paren
(paren
(paren
id|reg
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x100
)paren
op_logical_or
(paren
(paren
id|reg
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x200
)paren
)paren
op_logical_and
(paren
(paren
(paren
id|reg
op_amp
l_int|0x00ff
)paren
op_eq
l_int|0x50
)paren
op_logical_or
(paren
(paren
id|reg
op_amp
l_int|0x00ff
)paren
op_eq
l_int|0x53
)paren
op_logical_or
(paren
(paren
id|reg
op_amp
l_int|0x00ff
)paren
op_eq
l_int|0x55
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0xff00
)paren
(brace
id|outb_p
c_func
(paren
id|W83781D_REG_BANK
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|reg
op_rshift
l_int|8
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|reg
op_amp
l_int|0xff
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|res
op_assign
id|inb_p
c_func
(paren
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|word_sized
)paren
(brace
id|outb_p
c_func
(paren
(paren
id|reg
op_amp
l_int|0xff
)paren
op_plus
l_int|1
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|res
op_assign
(paren
id|res
op_lshift
l_int|8
)paren
op_plus
id|inb_p
c_func
(paren
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reg
op_amp
l_int|0xff00
)paren
(brace
id|outb_p
c_func
(paren
id|W83781D_REG_BANK
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|w83627thf_read_gpio5
r_static
r_int
id|w83627thf_read_gpio5
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|res
op_assign
l_int|0xff
comma
id|sel
suffix:semicolon
id|superio_enter
c_func
(paren
)paren
suffix:semicolon
id|superio_select
c_func
(paren
id|W83627HF_LD_GPIO5
)paren
suffix:semicolon
multiline_comment|/* Make sure these GPIO pins are enabled */
r_if
c_cond
(paren
op_logical_neg
(paren
id|superio_inb
c_func
(paren
id|W83627THF_GPIO5_EN
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;GPIO5 disabled, no VID function&bslash;n&quot;
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
multiline_comment|/* Make sure the pins are configured for input&n;&t;   There must be at least five (VRM 9), and possibly 6 (VRM 10) */
id|sel
op_assign
id|superio_inb
c_func
(paren
id|W83627THF_GPIO5_IOSR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sel
op_amp
l_int|0x1f
)paren
op_ne
l_int|0x1f
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;GPIO5 not configured for VID &quot;
l_string|&quot;function&bslash;n&quot;
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|dev_info
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Reading VID from GPIO5&bslash;n&quot;
)paren
suffix:semicolon
id|res
op_assign
id|superio_inb
c_func
(paren
id|W83627THF_GPIO5_DR
)paren
op_amp
id|sel
suffix:semicolon
m_exit
suffix:colon
id|superio_exit
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|w83627hf_write_value
r_static
r_int
id|w83627hf_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u16
id|reg
comma
id|u16
id|value
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|word_sized
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|word_sized
op_assign
(paren
(paren
(paren
id|reg
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x100
)paren
op_logical_or
(paren
(paren
id|reg
op_amp
l_int|0xff00
)paren
op_eq
l_int|0x200
)paren
)paren
op_logical_and
(paren
(paren
(paren
id|reg
op_amp
l_int|0x00ff
)paren
op_eq
l_int|0x53
)paren
op_logical_or
(paren
(paren
id|reg
op_amp
l_int|0x00ff
)paren
op_eq
l_int|0x55
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0xff00
)paren
(brace
id|outb_p
c_func
(paren
id|W83781D_REG_BANK
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|reg
op_rshift
l_int|8
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|reg
op_amp
l_int|0xff
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|word_sized
)paren
(brace
id|outb_p
c_func
(paren
id|value
op_rshift
l_int|8
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
(paren
id|reg
op_amp
l_int|0xff
)paren
op_plus
l_int|1
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
)brace
id|outb_p
c_func
(paren
id|value
op_amp
l_int|0xff
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
l_int|0xff00
)paren
(brace
id|outb_p
c_func
(paren
id|W83781D_REG_BANK
comma
id|client-&gt;addr
op_plus
id|W83781D_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
l_int|0
comma
id|client-&gt;addr
op_plus
id|W83781D_DATA_REG_OFFSET
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new W83781D. It should set limits, etc. */
DECL|function|w83627hf_init_client
r_static
r_void
id|w83627hf_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|type
op_assign
id|data-&gt;type
suffix:semicolon
id|u8
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|init
)paren
(brace
multiline_comment|/* save this register */
id|i
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_CONFIG
)paren
suffix:semicolon
multiline_comment|/* Reset all except Watchdog values and last conversion values&n;&t;&t;   This sets fan-divs to 2, among others */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_CONFIG
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Restore the register and disable power-on abnormal beep.&n;&t;&t;   This saves FAN 1/2/3 input/output values set by BIOS. */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_CONFIG
comma
id|i
op_or
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Disable master beep-enable (reset turns it on).&n;&t;&t;   Individual beeps should be reset to off but for some reason&n;&t;&t;   disabling this bit helps some people not get beeped */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS2
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Minimize conflicts with other winbond i2c-only clients...  */
multiline_comment|/* disable i2c subclients... how to disable main i2c client?? */
multiline_comment|/* force i2c address to relatively uncommon address */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_I2C_SUBADDR
comma
l_int|0x89
)paren
suffix:semicolon
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_I2C_ADDR
comma
id|force_i2c
)paren
suffix:semicolon
multiline_comment|/* Read VID only once */
r_if
c_cond
(paren
id|w83627hf
op_eq
id|data-&gt;type
op_logical_or
id|w83637hf
op_eq
id|data-&gt;type
)paren
(brace
r_int
id|lo
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_VID_FANDIV
)paren
suffix:semicolon
r_int
id|hi
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_CHIPID
)paren
suffix:semicolon
id|data-&gt;vid
op_assign
(paren
id|lo
op_amp
l_int|0x0f
)paren
op_or
(paren
(paren
id|hi
op_amp
l_int|0x01
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|w83627thf
op_eq
id|data-&gt;type
)paren
(brace
id|data-&gt;vid
op_assign
id|w83627thf_read_gpio5
c_func
(paren
id|client
)paren
op_amp
l_int|0x3f
suffix:semicolon
)brace
multiline_comment|/* Read VRM &amp; OVT Config only once */
r_if
c_cond
(paren
id|w83627thf
op_eq
id|data-&gt;type
op_logical_or
id|w83637hf
op_eq
id|data-&gt;type
)paren
(brace
id|data-&gt;vrm_ovt
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83627THF_REG_VRM_OVT_CFG
)paren
suffix:semicolon
id|data-&gt;vrm
op_assign
(paren
id|data-&gt;vrm_ovt
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|90
suffix:colon
l_int|82
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Convert VID to voltage based on default VRM */
id|data-&gt;vrm
op_assign
id|i2c_which_vrm
c_func
(paren
)paren
suffix:semicolon
)brace
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_SCFG1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|BIT_SCFG1
(braket
id|i
op_minus
l_int|1
)braket
)paren
)paren
(brace
id|data-&gt;sens
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|W83781D_DEFAULT_BETA
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|w83627hf_read_value
(paren
id|client
comma
id|W83781D_REG_SCFG2
)paren
op_amp
id|BIT_SCFG2
(braket
id|i
op_minus
l_int|1
)braket
)paren
id|data-&gt;sens
(braket
id|i
op_minus
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|data-&gt;sens
(braket
id|i
op_minus
l_int|1
)braket
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|type
op_eq
id|w83697hf
)paren
op_logical_and
(paren
id|i
op_eq
l_int|2
)paren
)paren
r_break
suffix:semicolon
)brace
id|data-&gt;pwmenable
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|data-&gt;pwmenable
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|data-&gt;pwmenable
(braket
l_int|2
)braket
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|init
)paren
(brace
r_if
c_cond
(paren
id|type
op_eq
id|w83627hf
)paren
(brace
multiline_comment|/* enable PWM2 control (can&squot;t hurt since PWM reg&n;&t;&t;           should have been reset to 0xff) */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83627HF_REG_PWMCLK12
comma
l_int|0x19
)paren
suffix:semicolon
)brace
multiline_comment|/* enable comparator mode for temp2 and temp3 so&n;&t;           alarm indication will work correctly */
id|i
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_IRQ
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_amp
l_int|0x40
)paren
)paren
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_IRQ
comma
id|i
op_or
l_int|0x40
)paren
suffix:semicolon
)brace
multiline_comment|/* Start monitoring */
id|w83627hf_write_value
c_func
(paren
id|client
comma
id|W83781D_REG_CONFIG
comma
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_CONFIG
)paren
op_amp
l_int|0xf7
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
)brace
DECL|function|w83627hf_update_device
r_static
r_struct
id|w83627hf_data
op_star
id|w83627hf_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|w83627hf_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|data-&gt;last_updated
OG
id|HZ
op_plus
id|HZ
op_div
l_int|2
)paren
op_logical_or
(paren
id|jiffies
OL
id|data-&gt;last_updated
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* skip missing sensors */
r_if
c_cond
(paren
(paren
(paren
id|data-&gt;type
op_eq
id|w83697hf
)paren
op_logical_and
(paren
id|i
op_eq
l_int|1
)paren
)paren
op_logical_or
(paren
(paren
id|data-&gt;type
op_eq
id|w83627thf
op_logical_or
id|data-&gt;type
op_eq
id|w83637hf
)paren
op_logical_and
(paren
id|i
op_eq
l_int|4
op_logical_or
id|i
op_eq
l_int|5
)paren
)paren
)paren
r_continue
suffix:semicolon
id|data-&gt;in
(braket
id|i
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_IN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|i
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_IN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|i
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_IN_MAX
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;fan
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_FAN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_FAN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
id|tmp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W836X7HF_REG_PWM
c_func
(paren
id|data-&gt;type
comma
id|i
)paren
)paren
suffix:semicolon
multiline_comment|/* bits 0-3 are reserved  in 627THF */
r_if
c_cond
(paren
id|data-&gt;type
op_eq
id|w83627thf
)paren
id|tmp
op_and_assign
l_int|0xf0
suffix:semicolon
id|data-&gt;pwm
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|2
op_logical_and
(paren
id|data-&gt;type
op_eq
id|w83627hf
op_logical_or
id|data-&gt;type
op_eq
id|w83697hf
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|data-&gt;temp
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_OVER
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max_hyst
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_HYST
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|data-&gt;temp_add
(braket
l_int|0
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max_add
(braket
l_int|0
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_OVER
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max_hyst_add
(braket
l_int|0
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_HYST
c_func
(paren
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;type
op_ne
id|w83697hf
)paren
(brace
id|data-&gt;temp_add
(braket
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max_add
(braket
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_OVER
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
id|data-&gt;temp_max_hyst_add
(braket
l_int|1
)braket
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_TEMP_HYST
c_func
(paren
l_int|3
)paren
)paren
suffix:semicolon
)brace
id|i
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_VID_FANDIV
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_assign
(paren
id|i
op_rshift
l_int|4
)paren
op_amp
l_int|0x03
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_assign
(paren
id|i
op_rshift
l_int|6
)paren
op_amp
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;type
op_ne
id|w83697hf
)paren
(brace
id|data-&gt;fan_div
(braket
l_int|2
)braket
op_assign
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_PIN
)paren
op_rshift
l_int|6
)paren
op_amp
l_int|0x03
suffix:semicolon
)brace
id|i
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_VBAT
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_or_assign
(paren
id|i
op_rshift
l_int|3
)paren
op_amp
l_int|0x04
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_or_assign
(paren
id|i
op_rshift
l_int|4
)paren
op_amp
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;type
op_ne
id|w83697hf
)paren
id|data-&gt;fan_div
(braket
l_int|2
)braket
op_or_assign
(paren
id|i
op_rshift
l_int|5
)paren
op_amp
l_int|0x04
suffix:semicolon
id|data-&gt;alarms
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_ALARM1
)paren
op_or
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_ALARM2
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_ALARM3
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|i
op_assign
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS2
)paren
suffix:semicolon
id|data-&gt;beep_enable
op_assign
id|i
op_rshift
l_int|7
suffix:semicolon
id|data-&gt;beep_mask
op_assign
(paren
(paren
id|i
op_amp
l_int|0x7f
)paren
op_lshift
l_int|8
)paren
op_or
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS1
)paren
op_or
id|w83627hf_read_value
c_func
(paren
id|client
comma
id|W83781D_REG_BEEP_INTS3
)paren
op_lshift
l_int|16
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|sensors_w83627hf_init
r_static
r_int
id|__init
id|sensors_w83627hf_init
c_func
(paren
r_void
)paren
(brace
r_int
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|w83627hf_find
c_func
(paren
l_int|0x2e
comma
op_amp
id|addr
)paren
op_logical_and
id|w83627hf_find
c_func
(paren
l_int|0x4e
comma
op_amp
id|addr
)paren
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|normal_isa
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|w83627hf_driver
)paren
suffix:semicolon
)brace
DECL|function|sensors_w83627hf_exit
r_static
r_void
id|__exit
id|sensors_w83627hf_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|w83627hf_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Frodo Looijaard &lt;frodol@dds.nl&gt;, &quot;
l_string|&quot;Philip Edelbrock &lt;phil@netroedge.com&gt;, &quot;
l_string|&quot;and Mark Studebaker &lt;mdsxyz123@yahoo.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;W83627HF driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sensors_w83627hf_init
id|module_init
c_func
(paren
id|sensors_w83627hf_init
)paren
suffix:semicolon
DECL|variable|sensors_w83627hf_exit
id|module_exit
c_func
(paren
id|sensors_w83627hf_exit
)paren
suffix:semicolon
eof
