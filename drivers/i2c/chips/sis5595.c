multiline_comment|/*&n;    sis5595.c - Part of lm_sensors, Linux kernel modules&n;&t;&t;for hardware monitoring&n;&n;    Copyright (C) 1998 - 2001 Frodo Looijaard &lt;frodol@dds.nl&gt;,&n;&t;&t;&t;Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;, and&n;&t;&t;&t;Mark D. Studebaker &lt;mdsxyz123@yahoo.com&gt;&n;    Ported to Linux 2.6 by Aurelien Jarno &lt;aurelien@aurel32.net&gt; with&n;    the help of Jean Delvare &lt;khali@linux-fr.org&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
multiline_comment|/*&n;   SiS southbridge has a LM78-like chip integrated on the same IC.&n;   This driver is a customized copy of lm78.c&n;   &n;   Supports following revisions:&n;&t;Version&t;&t;PCI ID&t;&t;PCI Revision&n;&t;1&t;&t;1039/0008&t;AF or less&n;&t;2&t;&t;1039/0008&t;B0 or greater&n;&n;   Note: these chips contain a 0008 device which is incompatible with the&n;&t; 5595. We recognize these by the presence of the listed&n;&t; &quot;blacklist&quot; PCI ID and refuse to load.&n;&n;   NOT SUPPORTED&t;PCI ID&t;&t;BLACKLIST PCI ID&t;&n;&t; 540&t;&t;0008&t;&t;0540&n;&t; 550&t;&t;0008&t;&t;0550&n;&t;5513&t;&t;0008&t;&t;5511&n;&t;5581&t;&t;0008&t;&t;5597&n;&t;5582&t;&t;0008&t;&t;5597&n;&t;5597&t;&t;0008&t;&t;5597&n;&t;5598&t;&t;0008&t;&t;5597/5598&n;&t; 630&t;&t;0008&t;&t;0630&n;&t; 645&t;&t;0008&t;&t;0645&n;&t; 730&t;&t;0008&t;&t;0730&n;&t; 735&t;&t;0008&t;&t;0735&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* If force_addr is set to anything different from 0, we forcibly enable&n;   the device at the given address. */
DECL|variable|force_addr
r_static
id|u16
id|force_addr
suffix:semicolon
id|module_param
c_func
(paren
id|force_addr
comma
id|ushort
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_addr
comma
l_string|&quot;Initialize the base address of the sensors&quot;
)paren
suffix:semicolon
multiline_comment|/* Addresses to scan.&n;   Note that we can&squot;t determine the ISA address until we have initialized&n;   our module */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
l_int|0x0000
comma
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/* Insmod parameters */
DECL|variable|sis5595
id|SENSORS_INSMOD_1
c_func
(paren
id|sis5595
)paren
suffix:semicolon
multiline_comment|/* Many SIS5595 constants specified below */
multiline_comment|/* Length of ISA address segment */
DECL|macro|SIS5595_EXTENT
mdefine_line|#define SIS5595_EXTENT 8
multiline_comment|/* PCI Config Registers */
DECL|macro|SIS5595_REVISION_REG
mdefine_line|#define SIS5595_REVISION_REG 0x08
DECL|macro|SIS5595_BASE_REG
mdefine_line|#define SIS5595_BASE_REG 0x68
DECL|macro|SIS5595_PIN_REG
mdefine_line|#define SIS5595_PIN_REG 0x7A
DECL|macro|SIS5595_ENABLE_REG
mdefine_line|#define SIS5595_ENABLE_REG 0x7B
multiline_comment|/* Where are the ISA address/data registers relative to the base address */
DECL|macro|SIS5595_ADDR_REG_OFFSET
mdefine_line|#define SIS5595_ADDR_REG_OFFSET 5
DECL|macro|SIS5595_DATA_REG_OFFSET
mdefine_line|#define SIS5595_DATA_REG_OFFSET 6
multiline_comment|/* The SIS5595 registers */
DECL|macro|SIS5595_REG_IN_MAX
mdefine_line|#define SIS5595_REG_IN_MAX(nr) (0x2b + (nr) * 2)
DECL|macro|SIS5595_REG_IN_MIN
mdefine_line|#define SIS5595_REG_IN_MIN(nr) (0x2c + (nr) * 2)
DECL|macro|SIS5595_REG_IN
mdefine_line|#define SIS5595_REG_IN(nr) (0x20 + (nr))
DECL|macro|SIS5595_REG_FAN_MIN
mdefine_line|#define SIS5595_REG_FAN_MIN(nr) (0x3b + (nr))
DECL|macro|SIS5595_REG_FAN
mdefine_line|#define SIS5595_REG_FAN(nr) (0x28 + (nr))
multiline_comment|/* On the first version of the chip, the temp registers are separate.&n;   On the second version,&n;   TEMP pin is shared with IN4, configured in PCI register 0x7A.&n;   The registers are the same as well.&n;   OVER and HYST are really MAX and MIN. */
DECL|macro|REV2MIN
mdefine_line|#define REV2MIN&t;0xb0
DECL|macro|SIS5595_REG_TEMP
mdefine_line|#define SIS5595_REG_TEMP &t;(( data-&gt;revision) &gt;= REV2MIN) ? &bslash;&n;&t;&t;&t;&t;&t;SIS5595_REG_IN(4) : 0x27
DECL|macro|SIS5595_REG_TEMP_OVER
mdefine_line|#define SIS5595_REG_TEMP_OVER&t;(( data-&gt;revision) &gt;= REV2MIN) ? &bslash;&n;&t;&t;&t;&t;&t;SIS5595_REG_IN_MAX(4) : 0x39
DECL|macro|SIS5595_REG_TEMP_HYST
mdefine_line|#define SIS5595_REG_TEMP_HYST&t;(( data-&gt;revision) &gt;= REV2MIN) ? &bslash;&n;&t;&t;&t;&t;&t;SIS5595_REG_IN_MIN(4) : 0x3a
DECL|macro|SIS5595_REG_CONFIG
mdefine_line|#define SIS5595_REG_CONFIG 0x40
DECL|macro|SIS5595_REG_ALARM1
mdefine_line|#define SIS5595_REG_ALARM1 0x41
DECL|macro|SIS5595_REG_ALARM2
mdefine_line|#define SIS5595_REG_ALARM2 0x42
DECL|macro|SIS5595_REG_FANDIV
mdefine_line|#define SIS5595_REG_FANDIV 0x47
multiline_comment|/* Conversions. Limit checking is only done on the TO_REG&n;   variants. */
multiline_comment|/* IN: mV, (0V to 4.08V)&n;   REG: 16mV/bit */
DECL|function|IN_TO_REG
r_static
r_inline
id|u8
id|IN_TO_REG
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|nval
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|val
comma
l_int|0
comma
l_int|4080
)paren
suffix:semicolon
r_return
(paren
id|nval
op_plus
l_int|8
)paren
op_div
l_int|16
suffix:semicolon
)brace
DECL|macro|IN_FROM_REG
mdefine_line|#define IN_FROM_REG(val) ((val) *  16)
DECL|function|FAN_TO_REG
r_static
r_inline
id|u8
id|FAN_TO_REG
c_func
(paren
r_int
id|rpm
comma
r_int
id|div
)paren
(brace
r_if
c_cond
(paren
id|rpm
op_le
l_int|0
)paren
r_return
l_int|255
suffix:semicolon
r_return
id|SENSORS_LIMIT
c_func
(paren
(paren
l_int|1350000
op_plus
id|rpm
op_star
id|div
op_div
l_int|2
)paren
op_div
(paren
id|rpm
op_star
id|div
)paren
comma
l_int|1
comma
l_int|254
)paren
suffix:semicolon
)brace
DECL|function|FAN_FROM_REG
r_static
r_inline
r_int
id|FAN_FROM_REG
c_func
(paren
id|u8
id|val
comma
r_int
id|div
)paren
(brace
r_return
id|val
op_eq
l_int|0
ques
c_cond
op_minus
l_int|1
suffix:colon
id|val
op_eq
l_int|255
ques
c_cond
l_int|0
suffix:colon
l_int|1350000
op_div
(paren
id|val
op_star
id|div
)paren
suffix:semicolon
)brace
multiline_comment|/* TEMP: mC (-54.12C to +157.53C)&n;   REG: 0.83C/bit + 52.12, two&squot;s complement  */
DECL|function|TEMP_FROM_REG
r_static
r_inline
r_int
id|TEMP_FROM_REG
c_func
(paren
id|s8
id|val
)paren
(brace
r_return
id|val
op_star
l_int|830
op_plus
l_int|52120
suffix:semicolon
)brace
DECL|function|TEMP_TO_REG
r_static
r_inline
id|s8
id|TEMP_TO_REG
c_func
(paren
r_int
id|val
)paren
(brace
r_int
id|nval
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|val
comma
op_minus
l_int|54120
comma
l_int|157530
)paren
suffix:semicolon
r_return
id|nval
OL
l_int|0
ques
c_cond
(paren
id|nval
op_minus
l_int|5212
op_minus
l_int|415
)paren
op_div
l_int|830
suffix:colon
(paren
id|nval
op_minus
l_int|5212
op_plus
l_int|415
)paren
op_div
l_int|830
suffix:semicolon
)brace
multiline_comment|/* FAN DIV: 1, 2, 4, or 8 (defaults to 2)&n;   REG: 0, 1, 2, or 3 (respectively) (defaults to 1) */
DECL|function|DIV_TO_REG
r_static
r_inline
id|u8
id|DIV_TO_REG
c_func
(paren
r_int
id|val
)paren
(brace
r_return
id|val
op_eq
l_int|8
ques
c_cond
l_int|3
suffix:colon
id|val
op_eq
l_int|4
ques
c_cond
l_int|2
suffix:colon
id|val
op_eq
l_int|1
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
DECL|macro|DIV_FROM_REG
mdefine_line|#define DIV_FROM_REG(val) (1 &lt;&lt; (val))
multiline_comment|/* For the SIS5595, we need to keep some data in memory. That&n;   data is pointed to by sis5595_list[NR]-&gt;data. The structure itself is&n;   dynamically allocated, at the time when the new sis5595 client is&n;   allocated. */
DECL|struct|sis5595_data
r_struct
id|sis5595_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|lock
r_struct
id|semaphore
id|lock
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* !=0 if following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|maxins
r_char
id|maxins
suffix:semicolon
multiline_comment|/* == 3 if temp enabled, otherwise == 4 */
DECL|member|revision
id|u8
id|revision
suffix:semicolon
multiline_comment|/* Reg. value */
DECL|member|in
id|u8
id|in
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_max
id|u8
id|in_max
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_min
id|u8
id|in_min
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan
id|u8
id|fan
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp
id|s8
id|temp
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_over
id|s8
id|temp_over
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_hyst
id|s8
id|temp_hyst
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_div
id|u8
id|fan_div
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register encoding, shifted right */
DECL|member|alarms
id|u16
id|alarms
suffix:semicolon
multiline_comment|/* Register encoding, combined */
)brace
suffix:semicolon
DECL|variable|s_bridge
r_static
r_struct
id|pci_dev
op_star
id|s_bridge
suffix:semicolon
multiline_comment|/* pointer to the (only) sis5595 */
r_static
r_int
id|sis5595_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|sis5595_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|sis5595_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|sis5595_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
)paren
suffix:semicolon
r_static
r_int
id|sis5595_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
r_register
comma
id|u8
id|value
)paren
suffix:semicolon
r_static
r_struct
id|sis5595_data
op_star
id|sis5595_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|sis5595_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
DECL|variable|sis5595_driver
r_static
r_struct
id|i2c_driver
id|sis5595_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;sis5595&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_SIS5595
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|sis5595_attach_adapter
comma
dot
id|detach_client
op_assign
id|sis5595_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/* 4 Voltages */
DECL|function|show_in
r_static
id|ssize_t
id|show_in
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_in_min
r_static
id|ssize_t
id|show_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in_min
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_in_max
r_static
id|ssize_t
id|show_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in_max
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_in_min
r_static
id|ssize_t
id|set_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|nr
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_IN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;in_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|set_in_max
r_static
id|ssize_t
id|set_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|nr
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_IN_MAX
c_func
(paren
id|nr
)paren
comma
id|data-&gt;in_max
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|show_in_offset
mdefine_line|#define show_in_offset(offset)&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset (struct device *dev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in(dev, buf, offset);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(in##offset##_input, S_IRUGO, &t;&t;&bslash;&n;&t;&t;show_in##offset, NULL);&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset##_min (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in_min(dev, buf, offset);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset##_max (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in_max(dev, buf, offset);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_in##offset##_min (struct device *dev,&t;&bslash;&n;&t;&t;const char *buf, size_t count)&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_in_min(dev, buf, count, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_in##offset##_max (struct device *dev,&t;&bslash;&n;&t;&t;const char *buf, size_t count)&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_in_max(dev, buf, count, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(in##offset##_min, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;show_in##offset##_min, set_in##offset##_min);&t;&bslash;&n;static DEVICE_ATTR(in##offset##_max, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;show_in##offset##_max, set_in##offset##_max);
id|show_in_offset
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Temperature */
DECL|function|show_temp
r_static
id|ssize_t
id|show_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_over
r_static
id|ssize_t
id|show_temp_over
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_over
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_over
r_static
id|ssize_t
id|set_temp_over
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;temp_over
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_TEMP_OVER
comma
id|data-&gt;temp_over
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_temp_hyst
r_static
id|ssize_t
id|show_temp_hyst
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_hyst
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_hyst
r_static
id|ssize_t
id|set_temp_hyst
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;temp_hyst
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_TEMP_HYST
comma
id|data-&gt;temp_hyst
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_input
comma
id|S_IRUGO
comma
id|show_temp
comma
l_int|NULL
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_max
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_temp_over
comma
id|set_temp_over
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|temp1_max_hyst
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_temp_hyst
comma
id|set_temp_hyst
)paren
suffix:semicolon
multiline_comment|/* 2 Fans */
DECL|function|show_fan
r_static
id|ssize_t
id|show_fan
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_fan_min
r_static
id|ssize_t
id|show_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_fan_min
r_static
id|ssize_t
id|set_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|val
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FAN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_fan_div
r_static
id|ssize_t
id|show_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Note: we save and restore the fan minimum here, because its value is&n;   determined in part by the fan divisor.  This follows the principle of&n;   least suprise; the user doesn&squot;t expect the fan minimum to change just&n;   because the divisor changed. */
DECL|function|set_fan_div
r_static
id|ssize_t
id|set_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|min
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_int
id|reg
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
id|min
op_assign
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|reg
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FANDIV
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
l_int|1
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;fan_div value %ld not &quot;
l_string|&quot;supported. Choose one of 1, 2, 4 or 8!&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|nr
)paren
(brace
r_case
l_int|0
suffix:colon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0xcf
)paren
op_or
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_lshift
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0x3f
)paren
op_or
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
op_lshift
l_int|6
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FANDIV
comma
id|reg
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|min
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FAN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|show_fan_offset
mdefine_line|#define show_fan_offset(offset)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset##_min (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan_min(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset##_div (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan_div(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_fan_##offset##_min (struct device *dev,&t;&t;&bslash;&n;&t;&t;const char *buf, size_t count)&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_fan_min(dev, buf, count, offset - 1);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(fan##offset##_input, S_IRUGO, show_fan_##offset, NULL);&bslash;&n;static DEVICE_ATTR(fan##offset##_min, S_IRUGO | S_IWUSR,&t;&t;&bslash;&n;&t;&t;show_fan_##offset##_min, set_fan_##offset##_min);
id|show_fan_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_fan_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
DECL|function|set_fan_1_div
r_static
id|ssize_t
id|set_fan_1_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|set_fan_div
c_func
(paren
id|dev
comma
id|buf
comma
id|count
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_fan_2_div
r_static
id|ssize_t
id|set_fan_2_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|set_fan_div
c_func
(paren
id|dev
comma
id|buf
comma
id|count
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan1_div
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_fan_1_div
comma
id|set_fan_1_div
)paren
suffix:semicolon
r_static
id|DEVICE_ATTR
c_func
(paren
id|fan2_div
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_fan_2_div
comma
id|set_fan_2_div
)paren
suffix:semicolon
multiline_comment|/* Alarms */
DECL|function|show_alarms
r_static
id|ssize_t
id|show_alarms
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|sis5595_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|data-&gt;alarms
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarms
comma
id|S_IRUGO
comma
id|show_alarms
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* This is called when the module is loaded */
DECL|function|sis5595_attach_adapter
r_static
r_int
id|sis5595_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|sis5595_detect
)paren
suffix:semicolon
)brace
DECL|function|sis5595_detect
r_int
id|sis5595_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
suffix:semicolon
r_char
id|val
suffix:semicolon
id|u16
id|a
suffix:semicolon
multiline_comment|/* Make sure we are probing the ISA bus!!  */
r_if
c_cond
(paren
op_logical_neg
id|i2c_is_isa_adapter
c_func
(paren
id|adapter
)paren
)paren
r_goto
m_exit
suffix:semicolon
r_if
c_cond
(paren
id|force_addr
)paren
id|address
op_assign
id|force_addr
op_amp
op_complement
(paren
id|SIS5595_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Reserve the ISA region */
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|address
comma
id|SIS5595_EXTENT
comma
id|sis5595_driver.name
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;forcing ISA address 0x%04X&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_write_config_word
c_func
(paren
id|s_bridge
comma
id|SIS5595_BASE_REG
comma
id|address
)paren
)paren
r_goto
id|exit_release
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_word
c_func
(paren
id|s_bridge
comma
id|SIS5595_BASE_REG
comma
op_amp
id|a
)paren
)paren
r_goto
id|exit_release
suffix:semicolon
r_if
c_cond
(paren
(paren
id|a
op_amp
op_complement
(paren
id|SIS5595_EXTENT
op_minus
l_int|1
)paren
)paren
op_ne
id|address
)paren
multiline_comment|/* doesn&squot;t work for some chips? */
r_goto
id|exit_release
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_byte
c_func
(paren
id|s_bridge
comma
id|SIS5595_ENABLE_REG
comma
op_amp
id|val
)paren
)paren
(brace
r_goto
id|exit_release
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_write_config_byte
c_func
(paren
id|s_bridge
comma
id|SIS5595_ENABLE_REG
comma
id|val
op_or
l_int|0x80
)paren
)paren
r_goto
id|exit_release
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_byte
c_func
(paren
id|s_bridge
comma
id|SIS5595_ENABLE_REG
comma
op_amp
id|val
)paren
)paren
r_goto
id|exit_release
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
multiline_comment|/* doesn&squot;t work for some chips! */
r_goto
id|exit_release
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|sis5595_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|exit_release
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sis5595_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|sis5595_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Check revision and pin registers to determine whether 4 or 5 voltages */
id|pci_read_config_byte
c_func
(paren
id|s_bridge
comma
id|SIS5595_REVISION_REG
comma
op_amp
(paren
id|data-&gt;revision
)paren
)paren
suffix:semicolon
multiline_comment|/* 4 voltages, 1 temp */
id|data-&gt;maxins
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;revision
op_ge
id|REV2MIN
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|s_bridge
comma
id|SIS5595_PIN_REG
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
l_int|0x80
)paren
)paren
multiline_comment|/* 5 voltages, no temps */
id|data-&gt;maxins
op_assign
l_int|4
suffix:semicolon
)brace
multiline_comment|/* Fill in the remaining client fields and put it into the global list */
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
l_string|&quot;sis5595&quot;
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|exit_free
suffix:semicolon
multiline_comment|/* Initialize the SIS5595 chip */
id|sis5595_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* A few vars need to be filled upon startup */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;fan_min
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|new_client
comma
id|SIS5595_REG_FAN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Register sysfs hooks */
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_max
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;maxins
op_eq
l_int|4
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_max
)paren
suffix:semicolon
)brace
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_alarms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;maxins
op_eq
l_int|3
)paren
(brace
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max_hyst
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|exit_free
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
id|exit_release
suffix:colon
id|release_region
c_func
(paren
id|address
comma
id|SIS5595_EXTENT
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|sis5595_detach_client
r_static
r_int
id|sis5595_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, client not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_is_isa_client
c_func
(paren
id|client
)paren
)paren
id|release_region
c_func
(paren
id|client-&gt;addr
comma
id|SIS5595_EXTENT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ISA access must be locked explicitly. */
DECL|function|sis5595_read_value
r_static
r_int
id|sis5595_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
r_int
id|res
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|reg
comma
id|client-&gt;addr
op_plus
id|SIS5595_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|res
op_assign
id|inb_p
c_func
(paren
id|client-&gt;addr
op_plus
id|SIS5595_DATA_REG_OFFSET
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|sis5595_write_value
r_static
r_int
id|sis5595_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
(brace
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|reg
comma
id|client-&gt;addr
op_plus
id|SIS5595_ADDR_REG_OFFSET
)paren
suffix:semicolon
id|outb_p
c_func
(paren
id|value
comma
id|client-&gt;addr
op_plus
id|SIS5595_DATA_REG_OFFSET
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|data-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new SIS5595. */
DECL|function|sis5595_init_client
r_static
r_void
id|sis5595_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
id|u8
id|config
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_CONFIG
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|config
op_amp
l_int|0x01
)paren
)paren
id|sis5595_write_value
c_func
(paren
id|client
comma
id|SIS5595_REG_CONFIG
comma
(paren
id|config
op_amp
l_int|0xf7
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
)brace
DECL|function|sis5595_update_device
r_static
r_struct
id|sis5595_data
op_star
id|sis5595_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|sis5595_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|data-&gt;last_updated
op_plus
id|HZ
op_plus
id|HZ
op_div
l_int|2
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|data-&gt;maxins
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;in
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_IN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_IN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_IN_MAX
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;fan
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FAN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|i
)braket
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FAN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|data-&gt;maxins
op_eq
l_int|3
)paren
(brace
id|data-&gt;temp
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_TEMP
)paren
suffix:semicolon
id|data-&gt;temp_over
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_TEMP_OVER
)paren
suffix:semicolon
id|data-&gt;temp_hyst
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_TEMP_HYST
)paren
suffix:semicolon
)brace
id|i
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_FANDIV
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_assign
(paren
id|i
op_rshift
l_int|4
)paren
op_amp
l_int|0x03
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_assign
id|i
op_rshift
l_int|6
suffix:semicolon
id|data-&gt;alarms
op_assign
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_ALARM1
)paren
op_or
(paren
id|sis5595_read_value
c_func
(paren
id|client
comma
id|SIS5595_REG_ALARM2
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|variable|sis5595_pci_ids
r_static
r_struct
id|pci_device_id
id|sis5595_pci_ids
(braket
)braket
op_assign
(brace
(brace
id|PCI_DEVICE
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_503
)paren
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|sis5595_pci_ids
)paren
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_int
id|blacklist
(braket
)braket
id|__devinitdata
op_assign
(brace
id|PCI_DEVICE_ID_SI_540
comma
id|PCI_DEVICE_ID_SI_550
comma
id|PCI_DEVICE_ID_SI_630
comma
id|PCI_DEVICE_ID_SI_645
comma
id|PCI_DEVICE_ID_SI_730
comma
id|PCI_DEVICE_ID_SI_735
comma
id|PCI_DEVICE_ID_SI_5511
comma
multiline_comment|/* 5513 chip has the 0008 device but&n;&t;&t;&t;&t;  that ID shows up in other chips so we&n;&t;&t;&t;&t;  use the 5511 ID for recognition */
id|PCI_DEVICE_ID_SI_5597
comma
id|PCI_DEVICE_ID_SI_5598
comma
l_int|0
)brace
suffix:semicolon
DECL|function|sis5595_pci_probe
r_static
r_int
id|__devinit
id|sis5595_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
id|u16
id|val
suffix:semicolon
r_int
op_star
id|i
suffix:semicolon
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|blacklist
suffix:semicolon
op_star
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|pci_get_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
op_star
id|i
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Looked for SIS5595 but found unsupported device %.4x&bslash;n&quot;
comma
op_star
id|i
)paren
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|SIS5595_BASE_REG
comma
op_amp
id|val
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|addr
op_assign
id|val
op_amp
op_complement
(paren
id|SIS5595_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|0
op_logical_and
id|force_addr
op_eq
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;Base address not set - upgrade BIOS or use force_addr=0xaddr&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
id|addr
op_assign
id|force_addr
suffix:semicolon
multiline_comment|/* so detect will get called */
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;No SiS 5595 sensors found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|normal_isa
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
id|s_bridge
op_assign
id|pci_dev_get
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_add_driver
c_func
(paren
op_amp
id|sis5595_driver
)paren
)paren
(brace
id|pci_dev_put
c_func
(paren
id|s_bridge
)paren
suffix:semicolon
id|s_bridge
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Always return failure here.  This is to allow other drivers to bind&n;&t; * to this pci device.  We don&squot;t really want to have control over the&n;&t; * pci device, we only wanted to read as few register values from it.&n;&t; */
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|sis5595_pci_driver
r_static
r_struct
id|pci_driver
id|sis5595_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sis5595&quot;
comma
dot
id|id_table
op_assign
id|sis5595_pci_ids
comma
dot
id|probe
op_assign
id|sis5595_pci_probe
comma
)brace
suffix:semicolon
DECL|function|sm_sis5595_init
r_static
r_int
id|__init
id|sm_sis5595_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_register_driver
c_func
(paren
op_amp
id|sis5595_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|sm_sis5595_exit
r_static
r_void
id|__exit
id|sm_sis5595_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|sis5595_pci_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s_bridge
op_ne
l_int|NULL
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|sis5595_driver
)paren
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|s_bridge
)paren
suffix:semicolon
id|s_bridge
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Aurelien Jarno &lt;aurelien@aurel32.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SiS 5595 Sensor device&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sm_sis5595_init
id|module_init
c_func
(paren
id|sm_sis5595_init
)paren
suffix:semicolon
DECL|variable|sm_sis5595_exit
id|module_exit
c_func
(paren
id|sm_sis5595_exit
)paren
suffix:semicolon
eof
