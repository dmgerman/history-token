multiline_comment|/*&n;    via686a.c - Part of lm_sensors, Linux kernel modules&n;                for hardware monitoring&n;                &n;    Copyright (c) 1998 - 2002  Frodo Looijaard &lt;frodol@dds.nl&gt;,&n;                        Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;,&n;&t;&t;&t;Mark Studebaker &lt;mdsxyz123@yahoo.com&gt;,&n;&t;&t;&t;and Bob Dougherty &lt;bobd@stanford.edu&gt;&n;    (Some conversion-factor data were contributed by Jonathan Teh Soon Yew &n;    &lt;j.teh@iname.com&gt; and Alex van Kaam &lt;darkside@chello.nl&gt;.)&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
multiline_comment|/*&n;    Supports the Via VT82C686A, VT82C686B south bridges.&n;    Reports all as a 686A.&n;    Warning - only supports a single device.&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* If force_addr is set to anything different from 0, we forcibly enable&n;   the device at the given address. */
DECL|variable|force_addr
r_static
r_int
r_int
id|force_addr
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|force_addr
comma
id|ushort
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_addr
comma
l_string|&quot;Initialize the base address of the sensors&quot;
)paren
suffix:semicolon
multiline_comment|/* Addresses to scan.&n;   Note that we can&squot;t determine the ISA address until we have initialized&n;   our module */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_i2c_range
r_static
r_int
r_int
id|normal_i2c_range
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
l_int|0x0000
comma
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/* Insmod parameters */
DECL|variable|via686a
id|SENSORS_INSMOD_1
c_func
(paren
id|via686a
)paren
suffix:semicolon
multiline_comment|/*&n;   The Via 686a southbridge has a LM78-like chip integrated on the same IC.&n;   This driver is a customized copy of lm78.c&n;*/
multiline_comment|/* Many VIA686A constants specified below */
multiline_comment|/* Length of ISA address segment */
DECL|macro|VIA686A_EXTENT
mdefine_line|#define VIA686A_EXTENT 0x80
DECL|macro|VIA686A_BASE_REG
mdefine_line|#define VIA686A_BASE_REG 0x70
DECL|macro|VIA686A_ENABLE_REG
mdefine_line|#define VIA686A_ENABLE_REG 0x74
multiline_comment|/* The VIA686A registers */
multiline_comment|/* ins numbered 0-4 */
DECL|macro|VIA686A_REG_IN_MAX
mdefine_line|#define VIA686A_REG_IN_MAX(nr) (0x2b + ((nr) * 2))
DECL|macro|VIA686A_REG_IN_MIN
mdefine_line|#define VIA686A_REG_IN_MIN(nr) (0x2c + ((nr) * 2))
DECL|macro|VIA686A_REG_IN
mdefine_line|#define VIA686A_REG_IN(nr)     (0x22 + (nr))
multiline_comment|/* fans numbered 1-2 */
DECL|macro|VIA686A_REG_FAN_MIN
mdefine_line|#define VIA686A_REG_FAN_MIN(nr) (0x3a + (nr))
DECL|macro|VIA686A_REG_FAN
mdefine_line|#define VIA686A_REG_FAN(nr)     (0x28 + (nr))
multiline_comment|/* the following values are as speced by VIA: */
DECL|variable|regtemp
r_static
r_const
id|u8
id|regtemp
(braket
)braket
op_assign
(brace
l_int|0x20
comma
l_int|0x21
comma
l_int|0x1f
)brace
suffix:semicolon
DECL|variable|regover
r_static
r_const
id|u8
id|regover
(braket
)braket
op_assign
(brace
l_int|0x39
comma
l_int|0x3d
comma
l_int|0x1d
)brace
suffix:semicolon
DECL|variable|reghyst
r_static
r_const
id|u8
id|reghyst
(braket
)braket
op_assign
(brace
l_int|0x3a
comma
l_int|0x3e
comma
l_int|0x1e
)brace
suffix:semicolon
multiline_comment|/* temps numbered 1-3 */
DECL|macro|VIA686A_REG_TEMP
mdefine_line|#define VIA686A_REG_TEMP(nr)&t;&t;(regtemp[nr])
DECL|macro|VIA686A_REG_TEMP_OVER
mdefine_line|#define VIA686A_REG_TEMP_OVER(nr)&t;(regover[nr])
DECL|macro|VIA686A_REG_TEMP_HYST
mdefine_line|#define VIA686A_REG_TEMP_HYST(nr)&t;(reghyst[nr])
DECL|macro|VIA686A_REG_TEMP_LOW1
mdefine_line|#define VIA686A_REG_TEMP_LOW1&t;0x4b&t;
singleline_comment|// bits 7-6
DECL|macro|VIA686A_REG_TEMP_LOW23
mdefine_line|#define VIA686A_REG_TEMP_LOW23&t;0x49&t;
singleline_comment|// 2 = bits 5-4, 3 = bits 7-6
DECL|macro|VIA686A_REG_ALARM1
mdefine_line|#define VIA686A_REG_ALARM1 0x41
DECL|macro|VIA686A_REG_ALARM2
mdefine_line|#define VIA686A_REG_ALARM2 0x42
DECL|macro|VIA686A_REG_FANDIV
mdefine_line|#define VIA686A_REG_FANDIV 0x47
DECL|macro|VIA686A_REG_CONFIG
mdefine_line|#define VIA686A_REG_CONFIG 0x40
multiline_comment|/* The following register sets temp interrupt mode (bits 1-0 for temp1, &n; 3-2 for temp2, 5-4 for temp3).  Modes are:&n;    00 interrupt stays as long as value is out-of-range&n;    01 interrupt is cleared once register is read (default)&n;    10 comparator mode- like 00, but ignores hysteresis&n;    11 same as 00 */
DECL|macro|VIA686A_REG_TEMP_MODE
mdefine_line|#define VIA686A_REG_TEMP_MODE 0x4b
multiline_comment|/* We&squot;ll just assume that you want to set all 3 simultaneously: */
DECL|macro|VIA686A_TEMP_MODE_MASK
mdefine_line|#define VIA686A_TEMP_MODE_MASK 0x3F
DECL|macro|VIA686A_TEMP_MODE_CONTINUOUS
mdefine_line|#define VIA686A_TEMP_MODE_CONTINUOUS (0x00)
multiline_comment|/* Conversions. Limit checking is only done on the TO_REG&n;   variants. &n;&n;********* VOLTAGE CONVERSIONS (Bob Dougherty) ********&n; From HWMon.cpp (Copyright 1998-2000 Jonathan Teh Soon Yew):&n; voltagefactor[0]=1.25/2628; (2628/1.25=2102.4)   // Vccp&n; voltagefactor[1]=1.25/2628; (2628/1.25=2102.4)   // +2.5V&n; voltagefactor[2]=1.67/2628; (2628/1.67=1573.7)   // +3.3V&n; voltagefactor[3]=2.6/2628;  (2628/2.60=1010.8)   // +5V&n; voltagefactor[4]=6.3/2628;  (2628/6.30=417.14)   // +12V&n; in[i]=(data[i+2]*25.0+133)*voltagefactor[i];&n; That is:&n; volts = (25*regVal+133)*factor&n; regVal = (volts/factor-133)/25&n; (These conversions were contributed by Jonathan Teh Soon Yew &n; &lt;j.teh@iname.com&gt;) */
DECL|function|IN_TO_REG
r_static
r_inline
id|u8
id|IN_TO_REG
c_func
(paren
r_int
id|val
comma
r_int
id|inNum
)paren
(brace
multiline_comment|/* To avoid floating point, we multiply constants by 10 (100 for +12V).&n;&t;   Rounding is done (120500 is actually 133000 - 12500).&n;&t;   Remember that val is expressed in 0.001V/bit, which is why we divide&n;&t;   by an additional 10000 (100000 for +12V): 1000 for val and 10 (100)&n;&t;   for the constants. */
r_if
c_cond
(paren
id|inNum
op_le
l_int|1
)paren
r_return
(paren
id|u8
)paren
id|SENSORS_LIMIT
c_func
(paren
(paren
id|val
op_star
l_int|21024
op_minus
l_int|1205000
)paren
op_div
l_int|250000
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|inNum
op_eq
l_int|2
)paren
r_return
(paren
id|u8
)paren
id|SENSORS_LIMIT
c_func
(paren
(paren
id|val
op_star
l_int|15737
op_minus
l_int|1205000
)paren
op_div
l_int|250000
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|inNum
op_eq
l_int|3
)paren
r_return
(paren
id|u8
)paren
id|SENSORS_LIMIT
c_func
(paren
(paren
id|val
op_star
l_int|10108
op_minus
l_int|1205000
)paren
op_div
l_int|250000
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
r_else
r_return
(paren
id|u8
)paren
id|SENSORS_LIMIT
c_func
(paren
(paren
id|val
op_star
l_int|41714
op_minus
l_int|12050000
)paren
op_div
l_int|2500000
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
)brace
DECL|function|IN_FROM_REG
r_static
r_inline
r_int
id|IN_FROM_REG
c_func
(paren
id|u8
id|val
comma
r_int
id|inNum
)paren
(brace
multiline_comment|/* To avoid floating point, we multiply constants by 10 (100 for +12V).&n;&t;   We also multiply them by 1000 because we want 0.001V/bit for the&n;&t;   output value. Rounding is done. */
r_if
c_cond
(paren
id|inNum
op_le
l_int|1
)paren
r_return
(paren
r_int
)paren
(paren
(paren
l_int|250000
op_star
id|val
op_plus
l_int|1330000
op_plus
l_int|21024
op_div
l_int|2
)paren
op_div
l_int|21024
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|inNum
op_eq
l_int|2
)paren
r_return
(paren
r_int
)paren
(paren
(paren
l_int|250000
op_star
id|val
op_plus
l_int|1330000
op_plus
l_int|15737
op_div
l_int|2
)paren
op_div
l_int|15737
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|inNum
op_eq
l_int|3
)paren
r_return
(paren
r_int
)paren
(paren
(paren
l_int|250000
op_star
id|val
op_plus
l_int|1330000
op_plus
l_int|10108
op_div
l_int|2
)paren
op_div
l_int|10108
)paren
suffix:semicolon
r_else
r_return
(paren
r_int
)paren
(paren
(paren
l_int|2500000
op_star
id|val
op_plus
l_int|13300000
op_plus
l_int|41714
op_div
l_int|2
)paren
op_div
l_int|41714
)paren
suffix:semicolon
)brace
multiline_comment|/********* FAN RPM CONVERSIONS ********/
multiline_comment|/* Higher register values = slower fans (the fan&squot;s strobe gates a counter).&n; But this chip saturates back at 0, not at 255 like all the other chips.&n; So, 0 means 0 RPM */
DECL|function|FAN_TO_REG
r_static
r_inline
id|u8
id|FAN_TO_REG
c_func
(paren
r_int
id|rpm
comma
r_int
id|div
)paren
(brace
r_if
c_cond
(paren
id|rpm
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|rpm
op_assign
id|SENSORS_LIMIT
c_func
(paren
id|rpm
comma
l_int|1
comma
l_int|1000000
)paren
suffix:semicolon
r_return
id|SENSORS_LIMIT
c_func
(paren
(paren
l_int|1350000
op_plus
id|rpm
op_star
id|div
op_div
l_int|2
)paren
op_div
(paren
id|rpm
op_star
id|div
)paren
comma
l_int|1
comma
l_int|255
)paren
suffix:semicolon
)brace
DECL|macro|FAN_FROM_REG
mdefine_line|#define FAN_FROM_REG(val,div) ((val)==0?0:(val)==255?0:1350000/((val)*(div)))
multiline_comment|/******** TEMP CONVERSIONS (Bob Dougherty) *********/
multiline_comment|/* linear fits from HWMon.cpp (Copyright 1998-2000 Jonathan Teh Soon Yew)&n;      if(temp&lt;169)&n;              return double(temp)*0.427-32.08;&n;      else if(temp&gt;=169 &amp;&amp; temp&lt;=202)&n;              return double(temp)*0.582-58.16;&n;      else&n;              return double(temp)*0.924-127.33;&n;&n; A fifth-order polynomial fits the unofficial data (provided by Alex van &n; Kaam &lt;darkside@chello.nl&gt;) a bit better.  It also give more reasonable &n; numbers on my machine (ie. they agree with what my BIOS tells me).  &n; Here&squot;s the fifth-order fit to the 8-bit data:&n; temp = 1.625093e-10*val^5 - 1.001632e-07*val^4 + 2.457653e-05*val^3 - &n;        2.967619e-03*val^2 + 2.175144e-01*val - 7.090067e+0.&n;&n; (2000-10-25- RFD: thanks to Uwe Andersen &lt;uandersen@mayah.com&gt; for &n; finding my typos in this formula!)&n;&n; Alas, none of the elegant function-fit solutions will work because we &n; aren&squot;t allowed to use floating point in the kernel and doing it with &n; integers doesn&squot;t rpovide enough precision.  So we&squot;ll do boring old &n; look-up table stuff.  The unofficial data (see below) have effectively &n; 7-bit resolution (they are rounded to the nearest degree).  I&squot;m assuming &n; that the transfer function of the device is monotonic and smooth, so a &n; smooth function fit to the data will allow us to get better precision.  &n; I used the 5th-order poly fit described above and solved for&n; VIA register values 0-255.  I *10 before rounding, so we get tenth-degree &n; precision.  (I could have done all 1024 values for our 10-bit readings, &n; but the function is very linear in the useful range (0-80 deg C), so &n; we&squot;ll just use linear interpolation for 10-bit readings.)  So, tempLUT &n; is the temp at via register values 0-255: */
DECL|variable|tempLUT
r_static
r_const
r_int
id|tempLUT
(braket
)braket
op_assign
(brace
op_minus
l_int|709
comma
op_minus
l_int|688
comma
op_minus
l_int|667
comma
op_minus
l_int|646
comma
op_minus
l_int|627
comma
op_minus
l_int|607
comma
op_minus
l_int|589
comma
op_minus
l_int|570
comma
op_minus
l_int|553
comma
op_minus
l_int|536
comma
op_minus
l_int|519
comma
op_minus
l_int|503
comma
op_minus
l_int|487
comma
op_minus
l_int|471
comma
op_minus
l_int|456
comma
op_minus
l_int|442
comma
op_minus
l_int|428
comma
op_minus
l_int|414
comma
op_minus
l_int|400
comma
op_minus
l_int|387
comma
op_minus
l_int|375
comma
op_minus
l_int|362
comma
op_minus
l_int|350
comma
op_minus
l_int|339
comma
op_minus
l_int|327
comma
op_minus
l_int|316
comma
op_minus
l_int|305
comma
op_minus
l_int|295
comma
op_minus
l_int|285
comma
op_minus
l_int|275
comma
op_minus
l_int|265
comma
op_minus
l_int|255
comma
op_minus
l_int|246
comma
op_minus
l_int|237
comma
op_minus
l_int|229
comma
op_minus
l_int|220
comma
op_minus
l_int|212
comma
op_minus
l_int|204
comma
op_minus
l_int|196
comma
op_minus
l_int|188
comma
op_minus
l_int|180
comma
op_minus
l_int|173
comma
op_minus
l_int|166
comma
op_minus
l_int|159
comma
op_minus
l_int|152
comma
op_minus
l_int|145
comma
op_minus
l_int|139
comma
op_minus
l_int|132
comma
op_minus
l_int|126
comma
op_minus
l_int|120
comma
op_minus
l_int|114
comma
op_minus
l_int|108
comma
op_minus
l_int|102
comma
op_minus
l_int|96
comma
op_minus
l_int|91
comma
op_minus
l_int|85
comma
op_minus
l_int|80
comma
op_minus
l_int|74
comma
op_minus
l_int|69
comma
op_minus
l_int|64
comma
op_minus
l_int|59
comma
op_minus
l_int|54
comma
op_minus
l_int|49
comma
op_minus
l_int|44
comma
op_minus
l_int|39
comma
op_minus
l_int|34
comma
op_minus
l_int|29
comma
op_minus
l_int|25
comma
op_minus
l_int|20
comma
op_minus
l_int|15
comma
op_minus
l_int|11
comma
op_minus
l_int|6
comma
op_minus
l_int|2
comma
l_int|3
comma
l_int|7
comma
l_int|12
comma
l_int|16
comma
l_int|20
comma
l_int|25
comma
l_int|29
comma
l_int|33
comma
l_int|37
comma
l_int|42
comma
l_int|46
comma
l_int|50
comma
l_int|54
comma
l_int|59
comma
l_int|63
comma
l_int|67
comma
l_int|71
comma
l_int|75
comma
l_int|79
comma
l_int|84
comma
l_int|88
comma
l_int|92
comma
l_int|96
comma
l_int|100
comma
l_int|104
comma
l_int|109
comma
l_int|113
comma
l_int|117
comma
l_int|121
comma
l_int|125
comma
l_int|130
comma
l_int|134
comma
l_int|138
comma
l_int|142
comma
l_int|146
comma
l_int|151
comma
l_int|155
comma
l_int|159
comma
l_int|163
comma
l_int|168
comma
l_int|172
comma
l_int|176
comma
l_int|181
comma
l_int|185
comma
l_int|189
comma
l_int|193
comma
l_int|198
comma
l_int|202
comma
l_int|206
comma
l_int|211
comma
l_int|215
comma
l_int|219
comma
l_int|224
comma
l_int|228
comma
l_int|232
comma
l_int|237
comma
l_int|241
comma
l_int|245
comma
l_int|250
comma
l_int|254
comma
l_int|259
comma
l_int|263
comma
l_int|267
comma
l_int|272
comma
l_int|276
comma
l_int|281
comma
l_int|285
comma
l_int|290
comma
l_int|294
comma
l_int|299
comma
l_int|303
comma
l_int|307
comma
l_int|312
comma
l_int|316
comma
l_int|321
comma
l_int|325
comma
l_int|330
comma
l_int|334
comma
l_int|339
comma
l_int|344
comma
l_int|348
comma
l_int|353
comma
l_int|357
comma
l_int|362
comma
l_int|366
comma
l_int|371
comma
l_int|376
comma
l_int|380
comma
l_int|385
comma
l_int|390
comma
l_int|395
comma
l_int|399
comma
l_int|404
comma
l_int|409
comma
l_int|414
comma
l_int|419
comma
l_int|423
comma
l_int|428
comma
l_int|433
comma
l_int|438
comma
l_int|443
comma
l_int|449
comma
l_int|454
comma
l_int|459
comma
l_int|464
comma
l_int|469
comma
l_int|475
comma
l_int|480
comma
l_int|486
comma
l_int|491
comma
l_int|497
comma
l_int|502
comma
l_int|508
comma
l_int|514
comma
l_int|520
comma
l_int|526
comma
l_int|532
comma
l_int|538
comma
l_int|544
comma
l_int|551
comma
l_int|557
comma
l_int|564
comma
l_int|571
comma
l_int|578
comma
l_int|584
comma
l_int|592
comma
l_int|599
comma
l_int|606
comma
l_int|614
comma
l_int|621
comma
l_int|629
comma
l_int|637
comma
l_int|645
comma
l_int|654
comma
l_int|662
comma
l_int|671
comma
l_int|680
comma
l_int|689
comma
l_int|698
comma
l_int|708
comma
l_int|718
comma
l_int|728
comma
l_int|738
comma
l_int|749
comma
l_int|759
comma
l_int|770
comma
l_int|782
comma
l_int|793
comma
l_int|805
comma
l_int|818
comma
l_int|830
comma
l_int|843
comma
l_int|856
comma
l_int|870
comma
l_int|883
comma
l_int|898
comma
l_int|912
comma
l_int|927
comma
l_int|943
comma
l_int|958
comma
l_int|975
comma
l_int|991
comma
l_int|1008
comma
l_int|1026
comma
l_int|1044
comma
l_int|1062
comma
l_int|1081
comma
l_int|1101
comma
l_int|1121
comma
l_int|1141
comma
l_int|1162
comma
l_int|1184
comma
l_int|1206
comma
l_int|1229
comma
l_int|1252
comma
l_int|1276
comma
l_int|1301
comma
l_int|1326
comma
l_int|1352
comma
l_int|1378
comma
l_int|1406
comma
l_int|1434
comma
l_int|1462
)brace
suffix:semicolon
multiline_comment|/* the original LUT values from Alex van Kaam &lt;darkside@chello.nl&gt; &n;   (for via register values 12-240):&n;{-50,-49,-47,-45,-43,-41,-39,-38,-37,-35,-34,-33,-32,-31,&n;-30,-29,-28,-27,-26,-25,-24,-24,-23,-22,-21,-20,-20,-19,-18,-17,-17,-16,-15,&n;-15,-14,-14,-13,-12,-12,-11,-11,-10,-9,-9,-8,-8,-7,-7,-6,-6,-5,-5,-4,-4,-3,&n;-3,-2,-2,-1,-1,0,0,1,1,1,3,3,3,4,4,4,5,5,5,6,6,7,7,8,8,9,9,9,10,10,11,11,12,&n;12,12,13,13,13,14,14,15,15,16,16,16,17,17,18,18,19,19,20,20,21,21,21,22,22,&n;22,23,23,24,24,25,25,26,26,26,27,27,27,28,28,29,29,30,30,30,31,31,32,32,33,&n;33,34,34,35,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,&n;45,46,46,47,48,48,49,49,50,51,51,52,52,53,53,54,55,55,56,57,57,58,59,59,60,&n;61,62,62,63,64,65,66,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,83,84,&n;85,86,88,89,91,92,94,96,97,99,101,103,105,107,109,110};&n;&n;&n; Here&squot;s the reverse LUT.  I got it by doing a 6-th order poly fit (needed&n; an extra term for a good fit to these inverse data!) and then &n; solving for each temp value from -50 to 110 (the useable range for &n; this chip).  Here&squot;s the fit: &n; viaRegVal = -1.160370e-10*val^6 +3.193693e-08*val^5 - 1.464447e-06*val^4 &n; - 2.525453e-04*val^3 + 1.424593e-02*val^2 + 2.148941e+00*val +7.275808e+01)&n; Note that n=161: */
DECL|variable|viaLUT
r_static
r_const
id|u8
id|viaLUT
(braket
)braket
op_assign
(brace
l_int|12
comma
l_int|12
comma
l_int|13
comma
l_int|14
comma
l_int|14
comma
l_int|15
comma
l_int|16
comma
l_int|16
comma
l_int|17
comma
l_int|18
comma
l_int|18
comma
l_int|19
comma
l_int|20
comma
l_int|20
comma
l_int|21
comma
l_int|22
comma
l_int|23
comma
l_int|23
comma
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|29
comma
l_int|30
comma
l_int|31
comma
l_int|32
comma
l_int|33
comma
l_int|35
comma
l_int|36
comma
l_int|37
comma
l_int|39
comma
l_int|40
comma
l_int|41
comma
l_int|43
comma
l_int|45
comma
l_int|46
comma
l_int|48
comma
l_int|49
comma
l_int|51
comma
l_int|53
comma
l_int|55
comma
l_int|57
comma
l_int|59
comma
l_int|60
comma
l_int|62
comma
l_int|64
comma
l_int|66
comma
l_int|69
comma
l_int|71
comma
l_int|73
comma
l_int|75
comma
l_int|77
comma
l_int|79
comma
l_int|82
comma
l_int|84
comma
l_int|86
comma
l_int|88
comma
l_int|91
comma
l_int|93
comma
l_int|95
comma
l_int|98
comma
l_int|100
comma
l_int|103
comma
l_int|105
comma
l_int|107
comma
l_int|110
comma
l_int|112
comma
l_int|115
comma
l_int|117
comma
l_int|119
comma
l_int|122
comma
l_int|124
comma
l_int|126
comma
l_int|129
comma
l_int|131
comma
l_int|134
comma
l_int|136
comma
l_int|138
comma
l_int|140
comma
l_int|143
comma
l_int|145
comma
l_int|147
comma
l_int|150
comma
l_int|152
comma
l_int|154
comma
l_int|156
comma
l_int|158
comma
l_int|160
comma
l_int|162
comma
l_int|164
comma
l_int|166
comma
l_int|168
comma
l_int|170
comma
l_int|172
comma
l_int|174
comma
l_int|176
comma
l_int|178
comma
l_int|180
comma
l_int|182
comma
l_int|183
comma
l_int|185
comma
l_int|187
comma
l_int|188
comma
l_int|190
comma
l_int|192
comma
l_int|193
comma
l_int|195
comma
l_int|196
comma
l_int|198
comma
l_int|199
comma
l_int|200
comma
l_int|202
comma
l_int|203
comma
l_int|205
comma
l_int|206
comma
l_int|207
comma
l_int|208
comma
l_int|209
comma
l_int|210
comma
l_int|211
comma
l_int|212
comma
l_int|213
comma
l_int|214
comma
l_int|215
comma
l_int|216
comma
l_int|217
comma
l_int|218
comma
l_int|219
comma
l_int|220
comma
l_int|221
comma
l_int|222
comma
l_int|222
comma
l_int|223
comma
l_int|224
comma
l_int|225
comma
l_int|226
comma
l_int|226
comma
l_int|227
comma
l_int|228
comma
l_int|228
comma
l_int|229
comma
l_int|230
comma
l_int|230
comma
l_int|231
comma
l_int|232
comma
l_int|232
comma
l_int|233
comma
l_int|233
comma
l_int|234
comma
l_int|235
comma
l_int|235
comma
l_int|236
comma
l_int|236
comma
l_int|237
comma
l_int|237
comma
l_int|238
comma
l_int|238
comma
l_int|239
comma
l_int|239
comma
l_int|240
)brace
suffix:semicolon
multiline_comment|/* Converting temps to (8-bit) hyst and over registers&n;   No interpolation here.&n;   The +50 is because the temps start at -50 */
DECL|function|TEMP_TO_REG
r_static
r_inline
id|u8
id|TEMP_TO_REG
c_func
(paren
r_int
id|val
)paren
(brace
r_return
id|viaLUT
(braket
id|val
op_le
op_minus
l_int|50000
ques
c_cond
l_int|0
suffix:colon
id|val
op_ge
l_int|110000
ques
c_cond
l_int|160
suffix:colon
(paren
id|val
OL
l_int|0
ques
c_cond
id|val
op_minus
l_int|500
suffix:colon
id|val
op_plus
l_int|500
)paren
op_div
l_int|1000
op_plus
l_int|50
)braket
suffix:semicolon
)brace
multiline_comment|/* for 8-bit temperature hyst and over registers */
DECL|macro|TEMP_FROM_REG
mdefine_line|#define TEMP_FROM_REG(val) (tempLUT[(val)] * 100)
multiline_comment|/* for 10-bit temperature readings */
DECL|function|TEMP_FROM_REG10
r_static
r_inline
r_int
id|TEMP_FROM_REG10
c_func
(paren
id|u16
id|val
)paren
(brace
id|u16
id|eightBits
op_assign
id|val
op_rshift
l_int|2
suffix:semicolon
id|u16
id|twoBits
op_assign
id|val
op_amp
l_int|3
suffix:semicolon
multiline_comment|/* no interpolation for these */
r_if
c_cond
(paren
id|twoBits
op_eq
l_int|0
op_logical_or
id|eightBits
op_eq
l_int|255
)paren
r_return
id|TEMP_FROM_REG
c_func
(paren
id|eightBits
)paren
suffix:semicolon
multiline_comment|/* do some linear interpolation */
r_return
(paren
id|tempLUT
(braket
id|eightBits
)braket
op_star
(paren
l_int|4
op_minus
id|twoBits
)paren
op_plus
id|tempLUT
(braket
id|eightBits
op_plus
l_int|1
)braket
op_star
id|twoBits
)paren
op_star
l_int|25
suffix:semicolon
)brace
DECL|macro|ALARMS_FROM_REG
mdefine_line|#define ALARMS_FROM_REG(val) (val)
DECL|macro|DIV_FROM_REG
mdefine_line|#define DIV_FROM_REG(val) (1 &lt;&lt; (val))
DECL|macro|DIV_TO_REG
mdefine_line|#define DIV_TO_REG(val) ((val)==8?3:(val)==4?2:(val)==1?0:1)
multiline_comment|/* For the VIA686A, we need to keep some data in memory.&n;   The structure is dynamically allocated, at the same time when a new&n;   via686a client is allocated. */
DECL|struct|via686a_data
r_struct
id|via686a_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* !=0 if following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* In jiffies */
DECL|member|in
id|u8
id|in
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_max
id|u8
id|in_max
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|in_min
id|u8
id|in_min
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan
id|u8
id|fan
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp
id|u16
id|temp
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value 10 bit */
DECL|member|temp_over
id|u8
id|temp_over
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|temp_hyst
id|u8
id|temp_hyst
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* Register value */
DECL|member|fan_div
id|u8
id|fan_div
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Register encoding, shifted right */
DECL|member|alarms
id|u16
id|alarms
suffix:semicolon
multiline_comment|/* Register encoding, combined */
)brace
suffix:semicolon
DECL|variable|s_bridge
r_static
r_struct
id|pci_dev
op_star
id|s_bridge
suffix:semicolon
multiline_comment|/* pointer to the (only) via686a */
r_static
r_int
id|via686a_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|via686a_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|via686a_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
DECL|function|via686a_read_value
r_static
r_inline
r_int
id|via686a_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
r_return
(paren
id|inb_p
c_func
(paren
id|client-&gt;addr
op_plus
id|reg
)paren
)paren
suffix:semicolon
)brace
DECL|function|via686a_write_value
r_static
r_inline
r_void
id|via686a_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
(brace
id|outb_p
c_func
(paren
id|value
comma
id|client-&gt;addr
op_plus
id|reg
)paren
suffix:semicolon
)brace
r_static
r_struct
id|via686a_data
op_star
id|via686a_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|via686a_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
multiline_comment|/* following are the sysfs callback functions */
multiline_comment|/* 7 voltage sensors */
DECL|function|show_in
r_static
id|ssize_t
id|show_in
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in
(braket
id|nr
)braket
comma
id|nr
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_in_min
r_static
id|ssize_t
id|show_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in_min
(braket
id|nr
)braket
comma
id|nr
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_in_max
r_static
id|ssize_t
id|show_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|IN_FROM_REG
c_func
(paren
id|data-&gt;in_max
(braket
id|nr
)braket
comma
id|nr
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_in_min
r_static
id|ssize_t
id|set_in_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|nr
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
comma
id|nr
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_IN_MIN
c_func
(paren
id|nr
)paren
comma
id|data-&gt;in_min
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|set_in_max
r_static
id|ssize_t
id|set_in_max
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|nr
)braket
op_assign
id|IN_TO_REG
c_func
(paren
id|val
comma
id|nr
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_IN_MAX
c_func
(paren
id|nr
)paren
comma
id|data-&gt;in_max
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|show_in_offset
mdefine_line|#define show_in_offset(offset)&t;&t;&t;&t;&t;&bslash;&n;static ssize_t &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset (struct device *dev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in(dev, buf, offset);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset##_min (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in_min(dev, buf, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t &t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;show_in##offset##_max (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_in_max(dev, buf, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_in##offset##_min (struct device *dev, &t;&bslash;&n;&t;&t;const char *buf, size_t count) &t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_in_min(dev, buf, count, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_in##offset##_max (struct device *dev,&t;&bslash;&n;&t;&t;&t;const char *buf, size_t count)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_in_max(dev, buf, count, offset);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(in##offset##_input, S_IRUGO, show_in##offset, NULL);&bslash;&n;static DEVICE_ATTR(in##offset##_min, S_IRUGO | S_IWUSR, &t;&bslash;&n;&t;&t;show_in##offset##_min, set_in##offset##_min);&t;&bslash;&n;static DEVICE_ATTR(in##offset##_max, S_IRUGO | S_IWUSR, &t;&bslash;&n;&t;&t;show_in##offset##_max, set_in##offset##_max);
id|show_in_offset
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|show_in_offset
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* 3 temperatures */
DECL|function|show_temp
r_static
id|ssize_t
id|show_temp
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|TEMP_FROM_REG10
c_func
(paren
id|data-&gt;temp
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_over
r_static
id|ssize_t
id|show_temp_over
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_over
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_temp_hyst
r_static
id|ssize_t
id|show_temp_hyst
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%ld&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_hyst
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_temp_over
r_static
id|ssize_t
id|set_temp_over
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_over
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_OVER
c_func
(paren
id|nr
)paren
comma
id|data-&gt;temp_over
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|set_temp_hyst
r_static
id|ssize_t
id|set_temp_hyst
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;temp_hyst
(braket
id|nr
)braket
op_assign
id|TEMP_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_HYST
c_func
(paren
id|nr
)paren
comma
id|data-&gt;temp_hyst
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|show_temp_offset
mdefine_line|#define show_temp_offset(offset)&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_temp_##offset (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_temp(dev, buf, offset - 1);&t;&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_temp_##offset##_over (struct device *dev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_temp_over(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;show_temp_##offset##_hyst (struct device *dev, char *buf)&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_temp_hyst(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_temp_##offset##_over (struct device *dev, &t;&t;&bslash;&n;&t;&t;const char *buf, size_t count) &t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_temp_over(dev, buf, count, offset - 1);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_temp_##offset##_hyst (struct device *dev, &t;&t;&bslash;&n;&t;&t;const char *buf, size_t count) &t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_temp_hyst(dev, buf, count, offset - 1);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(temp##offset##_input, S_IRUGO, show_temp_##offset, NULL);&bslash;&n;static DEVICE_ATTR(temp##offset##_max, S_IRUGO | S_IWUSR, &t;&t;&bslash;&n;&t;&t;show_temp_##offset##_over, set_temp_##offset##_over);&t;&bslash;&n;static DEVICE_ATTR(temp##offset##_max_hyst, S_IRUGO | S_IWUSR, &t;&t;&bslash;&n;&t;&t;show_temp_##offset##_hyst, set_temp_##offset##_hyst);&t;
id|show_temp_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_temp_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|show_temp_offset
c_func
(paren
l_int|3
)paren
suffix:semicolon
multiline_comment|/* 2 Fans */
DECL|function|show_fan
r_static
id|ssize_t
id|show_fan
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_fan_min
r_static
id|ssize_t
id|show_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|FAN_FROM_REG
c_func
(paren
id|data-&gt;fan_min
(braket
id|nr
)braket
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_fan_div
r_static
id|ssize_t
id|show_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|set_fan_min
r_static
id|ssize_t
id|set_fan_min
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|nr
)braket
op_assign
id|FAN_TO_REG
c_func
(paren
id|val
comma
id|DIV_FROM_REG
c_func
(paren
id|data-&gt;fan_div
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FAN_MIN
c_func
(paren
id|nr
op_plus
l_int|1
)paren
comma
id|data-&gt;fan_min
(braket
id|nr
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|set_fan_div
r_static
id|ssize_t
id|set_fan_div
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|val
op_assign
id|simple_strtol
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_int
id|old
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FANDIV
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
id|nr
)braket
op_assign
id|DIV_TO_REG
c_func
(paren
id|val
)paren
suffix:semicolon
id|old
op_assign
(paren
id|old
op_amp
l_int|0x0f
)paren
op_or
(paren
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_lshift
l_int|6
)paren
op_or
(paren
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_lshift
l_int|4
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FANDIV
comma
id|old
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|macro|show_fan_offset
mdefine_line|#define show_fan_offset(offset)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan(dev, buf, offset - 1);&t;&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset##_min (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan_min(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t show_fan_##offset##_div (struct device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return show_fan_div(dev, buf, offset - 1);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_fan_##offset##_min (struct device *dev, &t;&t;&bslash;&n;&t;const char *buf, size_t count) &t;&t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_fan_min(dev, buf, count, offset - 1);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t set_fan_##offset##_div (struct device *dev, &t;&t;&bslash;&n;&t;&t;const char *buf, size_t count) &t;&t;&t;&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return set_fan_div(dev, buf, count, offset - 1);&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static DEVICE_ATTR(fan##offset##_input, S_IRUGO, show_fan_##offset, NULL);&bslash;&n;static DEVICE_ATTR(fan##offset##_min, S_IRUGO | S_IWUSR, &t;&t;&bslash;&n;&t;&t;show_fan_##offset##_min, set_fan_##offset##_min);&t;&bslash;&n;static DEVICE_ATTR(fan##offset##_div, S_IRUGO | S_IWUSR, &t;&t;&bslash;&n;&t;&t;show_fan_##offset##_div, set_fan_##offset##_div);
id|show_fan_offset
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|show_fan_offset
c_func
(paren
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Alarms */
DECL|function|show_alarms
r_static
id|ssize_t
id|show_alarms
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|via686a_data
op_star
id|data
op_assign
id|via686a_update_device
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|ALARMS_FROM_REG
c_func
(paren
id|data-&gt;alarms
)paren
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|alarms
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|show_alarms
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* The driver. I choose to use type i2c_driver, as at is identical to both&n;   smbus_driver and isa_driver, and clients could be of either kind */
DECL|variable|via686a_driver
r_static
r_struct
id|i2c_driver
id|via686a_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;via686a&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_VIA686A
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|via686a_attach_adapter
comma
dot
id|detach_client
op_assign
id|via686a_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/* This is called when the module is loaded */
DECL|function|via686a_attach_adapter
r_static
r_int
id|via686a_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|via686a_detect
)paren
suffix:semicolon
)brace
DECL|function|via686a_detect
r_static
r_int
id|via686a_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_const
r_char
id|client_name
(braket
)braket
op_assign
l_string|&quot;via686a&quot;
suffix:semicolon
id|u16
id|val
suffix:semicolon
multiline_comment|/* Make sure we are probing the ISA bus!!  */
r_if
c_cond
(paren
op_logical_neg
id|i2c_is_isa_adapter
c_func
(paren
id|adapter
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;via686a_detect called for an I2C bus adapter?!?&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* 8231 requires multiple of 256, we enforce that on 686 as well */
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|address
op_assign
id|force_addr
op_amp
l_int|0xFF00
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;forcing ISA address 0x%04X&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_write_config_word
c_func
(paren
id|s_bridge
comma
id|VIA686A_BASE_REG
comma
id|address
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_word
c_func
(paren
id|s_bridge
comma
id|VIA686A_ENABLE_REG
comma
op_amp
id|val
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
l_int|0x0001
)paren
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;enabling sensors&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_write_config_word
c_func
(paren
id|s_bridge
comma
id|VIA686A_ENABLE_REG
comma
id|val
op_or
l_int|0x0001
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* Reserve the ISA region */
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|address
comma
id|VIA686A_EXTENT
comma
l_string|&quot;via686a-sensor&quot;
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;region 0x%x already in use!&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|via686a_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|ERROR0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|via686a_data
)paren
)paren
suffix:semicolon
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|via686a_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|new_client-&gt;dev.parent
op_assign
op_amp
id|adapter-&gt;dev
suffix:semicolon
multiline_comment|/* Fill in the remaining client fields and put into the global list */
id|snprintf
c_func
(paren
id|new_client-&gt;name
comma
id|I2C_NAME_SIZE
comma
id|client_name
)paren
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|ERROR3
suffix:semicolon
multiline_comment|/* Initialize the VIA686A chip */
id|via686a_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in0_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in3_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_in4_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_max
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp1_max_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp2_max_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_temp3_max_hyst
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_input
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_min
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan1_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_fan2_div
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|new_client-&gt;dev
comma
op_amp
id|dev_attr_alarms
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ERROR3
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
id|ERROR0
suffix:colon
id|release_region
c_func
(paren
id|address
comma
id|VIA686A_EXTENT
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|via686a_detach_client
r_static
r_int
id|via686a_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, client not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|release_region
c_func
(paren
id|client-&gt;addr
comma
id|VIA686A_EXTENT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new VIA686A. Set limits, etc. */
DECL|function|via686a_init_client
r_static
r_void
id|via686a_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
id|u8
id|reg
suffix:semicolon
multiline_comment|/* Start monitoring */
id|reg
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_CONFIG
)paren
suffix:semicolon
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_CONFIG
comma
(paren
id|reg
op_or
l_int|0x01
)paren
op_amp
l_int|0x7F
)paren
suffix:semicolon
multiline_comment|/* Configure temp interrupt mode for continuous-interrupt operation */
id|via686a_write_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_MODE
comma
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_MODE
)paren
op_amp
op_logical_neg
(paren
id|VIA686A_TEMP_MODE_MASK
op_or
id|VIA686A_TEMP_MODE_CONTINUOUS
)paren
)paren
suffix:semicolon
)brace
DECL|function|via686a_update_device
r_static
r_struct
id|via686a_data
op_star
id|via686a_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|via686a_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|data-&gt;last_updated
OG
id|HZ
op_plus
id|HZ
op_div
l_int|2
)paren
op_logical_or
(paren
id|jiffies
OL
id|data-&gt;last_updated
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;in
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_IN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_min
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_IN_MIN
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;in_max
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_IN_MAX
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;fan
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FAN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FAN_MIN
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;temp
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP
c_func
(paren
id|i
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
id|data-&gt;temp_over
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_OVER
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
id|data-&gt;temp_hyst
(braket
id|i
)braket
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_HYST
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* add in lower 2 bits &n;&t;&t;   temp1 uses bits 7-6 of VIA686A_REG_TEMP_LOW1&n;&t;&t;   temp2 uses bits 5-4 of VIA686A_REG_TEMP_LOW23&n;&t;&t;   temp3 uses bits 7-6 of VIA686A_REG_TEMP_LOW23&n;&t;&t; */
id|data-&gt;temp
(braket
l_int|0
)braket
op_or_assign
(paren
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_LOW1
)paren
op_amp
l_int|0xc0
)paren
op_rshift
l_int|6
suffix:semicolon
id|data-&gt;temp
(braket
l_int|1
)braket
op_or_assign
(paren
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_LOW23
)paren
op_amp
l_int|0x30
)paren
op_rshift
l_int|4
suffix:semicolon
id|data-&gt;temp
(braket
l_int|2
)braket
op_or_assign
(paren
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_TEMP_LOW23
)paren
op_amp
l_int|0xc0
)paren
op_rshift
l_int|6
suffix:semicolon
id|i
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_FANDIV
)paren
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|0
)braket
op_assign
(paren
id|i
op_rshift
l_int|4
)paren
op_amp
l_int|0x03
suffix:semicolon
id|data-&gt;fan_div
(braket
l_int|1
)braket
op_assign
id|i
op_rshift
l_int|6
suffix:semicolon
id|data-&gt;alarms
op_assign
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_ALARM1
)paren
op_or
(paren
id|via686a_read_value
c_func
(paren
id|client
comma
id|VIA686A_REG_ALARM2
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|variable|via686a_pci_ids
r_static
r_struct
id|pci_device_id
id|via686a_pci_ids
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_VIA
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_VIA_82C686_4
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|function|via686a_pci_probe
r_static
r_int
id|__devinit
id|via686a_pci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
id|u16
id|val
suffix:semicolon
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|PCIBIOS_SUCCESSFUL
op_ne
id|pci_read_config_word
c_func
(paren
id|dev
comma
id|VIA686A_BASE_REG
comma
op_amp
id|val
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|addr
op_assign
id|val
op_amp
op_complement
(paren
id|VIA686A_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|0
op_logical_and
id|force_addr
op_eq
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;base address not set - upgrade BIOS or use force_addr=0xaddr&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
id|addr
op_assign
id|force_addr
suffix:semicolon
multiline_comment|/* so detect will get called */
r_if
c_cond
(paren
op_logical_neg
id|addr
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;No Via 686A sensors found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|normal_isa
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
id|s_bridge
op_assign
id|dev
suffix:semicolon
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|via686a_driver
)paren
suffix:semicolon
)brace
DECL|function|via686a_pci_remove
r_static
r_void
id|__devexit
id|via686a_pci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|via686a_driver
)paren
suffix:semicolon
)brace
DECL|variable|via686a_pci_driver
r_static
r_struct
id|pci_driver
id|via686a_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;via686a&quot;
comma
dot
id|id_table
op_assign
id|via686a_pci_ids
comma
dot
id|probe
op_assign
id|via686a_pci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|via686a_pci_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|sm_via686a_init
r_static
r_int
id|__init
id|sm_via686a_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_register_driver
c_func
(paren
op_amp
id|via686a_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|sm_via686a_exit
r_static
r_void
id|__exit
id|sm_via686a_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|via686a_pci_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;, &quot;
l_string|&quot;Mark Studebaker &lt;mdsxyz123@yahoo.com&gt; &quot;
l_string|&quot;and Bob Dougherty &lt;bobd@stanford.edu&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;VIA 686A Sensor device&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sm_via686a_init
id|module_init
c_func
(paren
id|sm_via686a_init
)paren
suffix:semicolon
DECL|variable|sm_via686a_exit
id|module_exit
c_func
(paren
id|sm_via686a_exit
)paren
suffix:semicolon
eof
