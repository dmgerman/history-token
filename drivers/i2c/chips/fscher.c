multiline_comment|/*&n; * fscher.c - Part of lm_sensors, Linux kernel modules for hardware&n; * monitoring&n; * Copyright (C) 2003, 2004 Reinhard Nissl &lt;rnissl@gmx.de&gt;&n; * &n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
multiline_comment|/* &n; *  fujitsu siemens hermes chip, &n; *  module based on fscpos.c &n; *  Copyright (C) 2000 Hermann Jung &lt;hej@odn.de&gt;&n; *  Copyright (C) 1998, 1999 Frodo Looijaard &lt;frodol@dds.nl&gt;&n; *  and Philip Edelbrock &lt;phil@netroedge.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-sensor.h&gt;
multiline_comment|/*&n; * Addresses to scan&n; */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
l_int|0x73
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_isa
r_static
r_int
r_int
id|normal_isa
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_ISA_END
)brace
suffix:semicolon
multiline_comment|/*&n; * Insmod parameters&n; */
DECL|variable|fscher
id|SENSORS_INSMOD_1
c_func
(paren
id|fscher
)paren
suffix:semicolon
multiline_comment|/*&n; * The FSCHER registers&n; */
multiline_comment|/* chip identification */
DECL|macro|FSCHER_REG_IDENT_0
mdefine_line|#define FSCHER_REG_IDENT_0&t;&t;0x00
DECL|macro|FSCHER_REG_IDENT_1
mdefine_line|#define FSCHER_REG_IDENT_1&t;&t;0x01
DECL|macro|FSCHER_REG_IDENT_2
mdefine_line|#define FSCHER_REG_IDENT_2&t;&t;0x02
DECL|macro|FSCHER_REG_REVISION
mdefine_line|#define FSCHER_REG_REVISION&t;&t;0x03
multiline_comment|/* global control and status */
DECL|macro|FSCHER_REG_EVENT_STATE
mdefine_line|#define FSCHER_REG_EVENT_STATE&t;&t;0x04
DECL|macro|FSCHER_REG_CONTROL
mdefine_line|#define FSCHER_REG_CONTROL&t;&t;0x05
multiline_comment|/* watchdog */
DECL|macro|FSCHER_REG_WDOG_PRESET
mdefine_line|#define FSCHER_REG_WDOG_PRESET&t;&t;0x28
DECL|macro|FSCHER_REG_WDOG_STATE
mdefine_line|#define FSCHER_REG_WDOG_STATE&t;&t;0x23
DECL|macro|FSCHER_REG_WDOG_CONTROL
mdefine_line|#define FSCHER_REG_WDOG_CONTROL&t;&t;0x21
multiline_comment|/* fan 0 */
DECL|macro|FSCHER_REG_FAN0_MIN
mdefine_line|#define FSCHER_REG_FAN0_MIN&t;&t;0x55
DECL|macro|FSCHER_REG_FAN0_ACT
mdefine_line|#define FSCHER_REG_FAN0_ACT&t;&t;0x0e
DECL|macro|FSCHER_REG_FAN0_STATE
mdefine_line|#define FSCHER_REG_FAN0_STATE&t;&t;0x0d
DECL|macro|FSCHER_REG_FAN0_RIPPLE
mdefine_line|#define FSCHER_REG_FAN0_RIPPLE&t;&t;0x0f
multiline_comment|/* fan 1 */
DECL|macro|FSCHER_REG_FAN1_MIN
mdefine_line|#define FSCHER_REG_FAN1_MIN&t;&t;0x65
DECL|macro|FSCHER_REG_FAN1_ACT
mdefine_line|#define FSCHER_REG_FAN1_ACT&t;&t;0x6b
DECL|macro|FSCHER_REG_FAN1_STATE
mdefine_line|#define FSCHER_REG_FAN1_STATE&t;&t;0x62
DECL|macro|FSCHER_REG_FAN1_RIPPLE
mdefine_line|#define FSCHER_REG_FAN1_RIPPLE&t;&t;0x6f
multiline_comment|/* fan 2 */
DECL|macro|FSCHER_REG_FAN2_MIN
mdefine_line|#define FSCHER_REG_FAN2_MIN&t;&t;0xb5
DECL|macro|FSCHER_REG_FAN2_ACT
mdefine_line|#define FSCHER_REG_FAN2_ACT&t;&t;0xbb
DECL|macro|FSCHER_REG_FAN2_STATE
mdefine_line|#define FSCHER_REG_FAN2_STATE&t;&t;0xb2
DECL|macro|FSCHER_REG_FAN2_RIPPLE
mdefine_line|#define FSCHER_REG_FAN2_RIPPLE&t;&t;0xbf
multiline_comment|/* voltage supervision */
DECL|macro|FSCHER_REG_VOLT_12
mdefine_line|#define FSCHER_REG_VOLT_12&t;&t;0x45
DECL|macro|FSCHER_REG_VOLT_5
mdefine_line|#define FSCHER_REG_VOLT_5&t;&t;0x42
DECL|macro|FSCHER_REG_VOLT_BATT
mdefine_line|#define FSCHER_REG_VOLT_BATT&t;&t;0x48
multiline_comment|/* temperature 0 */
DECL|macro|FSCHER_REG_TEMP0_ACT
mdefine_line|#define FSCHER_REG_TEMP0_ACT&t;&t;0x64
DECL|macro|FSCHER_REG_TEMP0_STATE
mdefine_line|#define FSCHER_REG_TEMP0_STATE&t;&t;0x71
multiline_comment|/* temperature 1 */
DECL|macro|FSCHER_REG_TEMP1_ACT
mdefine_line|#define FSCHER_REG_TEMP1_ACT&t;&t;0x32
DECL|macro|FSCHER_REG_TEMP1_STATE
mdefine_line|#define FSCHER_REG_TEMP1_STATE&t;&t;0x81
multiline_comment|/* temperature 2 */
DECL|macro|FSCHER_REG_TEMP2_ACT
mdefine_line|#define FSCHER_REG_TEMP2_ACT&t;&t;0x35
DECL|macro|FSCHER_REG_TEMP2_STATE
mdefine_line|#define FSCHER_REG_TEMP2_STATE&t;&t;0x91
multiline_comment|/*&n; * Functions declaration&n; */
r_static
r_int
id|fscher_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
suffix:semicolon
r_static
r_int
id|fscher_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
suffix:semicolon
r_static
r_int
id|fscher_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_struct
id|fscher_data
op_star
id|fscher_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|fscher_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
suffix:semicolon
r_static
r_int
id|fscher_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
suffix:semicolon
r_static
r_int
id|fscher_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
suffix:semicolon
multiline_comment|/*&n; * Driver data (common to all clients)&n; */
DECL|variable|fscher_driver
r_static
r_struct
id|i2c_driver
id|fscher_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;fscher&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_FSCHER
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|fscher_attach_adapter
comma
dot
id|detach_client
op_assign
id|fscher_detach_client
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Client data (each client gets its own)&n; */
DECL|struct|fscher_data
r_struct
id|fscher_data
(brace
DECL|member|client
r_struct
id|i2c_client
id|client
suffix:semicolon
DECL|member|update_lock
r_struct
id|semaphore
id|update_lock
suffix:semicolon
DECL|member|valid
r_char
id|valid
suffix:semicolon
multiline_comment|/* zero until following fields are valid */
DECL|member|last_updated
r_int
r_int
id|last_updated
suffix:semicolon
multiline_comment|/* in jiffies */
multiline_comment|/* register values */
DECL|member|revision
id|u8
id|revision
suffix:semicolon
multiline_comment|/* revision of chip */
DECL|member|global_event
id|u8
id|global_event
suffix:semicolon
multiline_comment|/* global event status */
DECL|member|global_control
id|u8
id|global_control
suffix:semicolon
multiline_comment|/* global control register */
DECL|member|watchdog
id|u8
id|watchdog
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* watchdog */
DECL|member|volt
id|u8
id|volt
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* 12, 5, battery voltage */
DECL|member|temp_act
id|u8
id|temp_act
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* temperature */
DECL|member|temp_status
id|u8
id|temp_status
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* status of sensor */
DECL|member|fan_act
id|u8
id|fan_act
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fans revolutions per second */
DECL|member|fan_status
id|u8
id|fan_status
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fan status */
DECL|member|fan_min
id|u8
id|fan_min
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* fan min value for rps */
DECL|member|fan_ripple
id|u8
id|fan_ripple
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* divider for rps */
)brace
suffix:semicolon
multiline_comment|/*&n; * Internal variables&n; */
DECL|variable|fscher_id
r_static
r_int
id|fscher_id
suffix:semicolon
multiline_comment|/*&n; * Sysfs stuff&n; */
DECL|macro|sysfs_r
mdefine_line|#define sysfs_r(kind, sub, offset, reg) &bslash;&n;static ssize_t show_##kind##sub (struct fscher_data *, char *, int); &bslash;&n;static ssize_t show_##kind##offset##sub (struct device *, char *); &bslash;&n;static ssize_t show_##kind##offset##sub (struct device *dev, char *buf) &bslash;&n;{ &bslash;&n;&t;struct fscher_data *data = fscher_update_device(dev); &bslash;&n;&t;return show_##kind##sub(data, buf, (offset)); &bslash;&n;}
DECL|macro|sysfs_w
mdefine_line|#define sysfs_w(kind, sub, offset, reg) &bslash;&n;static ssize_t set_##kind##sub (struct i2c_client *, struct fscher_data *, const char *, size_t, int, int); &bslash;&n;static ssize_t set_##kind##offset##sub (struct device *, const char *, size_t); &bslash;&n;static ssize_t set_##kind##offset##sub (struct device *dev, const char *buf, size_t count) &bslash;&n;{ &bslash;&n;&t;struct i2c_client *client = to_i2c_client(dev); &bslash;&n;&t;struct fscher_data *data = i2c_get_clientdata(client); &bslash;&n;&t;return set_##kind##sub(client, data, buf, count, (offset), reg); &bslash;&n;}
DECL|macro|sysfs_rw_n
mdefine_line|#define sysfs_rw_n(kind, sub, offset, reg) &bslash;&n;sysfs_r(kind, sub, offset, reg) &bslash;&n;sysfs_w(kind, sub, offset, reg) &bslash;&n;static DEVICE_ATTR(kind##offset##sub, S_IRUGO | S_IWUSR, show_##kind##offset##sub, set_##kind##offset##sub);
DECL|macro|sysfs_rw
mdefine_line|#define sysfs_rw(kind, sub, reg) &bslash;&n;sysfs_r(kind, sub, 0, reg) &bslash;&n;sysfs_w(kind, sub, 0, reg) &bslash;&n;static DEVICE_ATTR(kind##sub, S_IRUGO | S_IWUSR, show_##kind##0##sub, set_##kind##0##sub);
DECL|macro|sysfs_ro_n
mdefine_line|#define sysfs_ro_n(kind, sub, offset, reg) &bslash;&n;sysfs_r(kind, sub, offset, reg) &bslash;&n;static DEVICE_ATTR(kind##offset##sub, S_IRUGO, show_##kind##offset##sub, NULL);
DECL|macro|sysfs_ro
mdefine_line|#define sysfs_ro(kind, sub, reg) &bslash;&n;sysfs_r(kind, sub, 0, reg) &bslash;&n;static DEVICE_ATTR(kind, S_IRUGO, show_##kind##0##sub, NULL);
DECL|macro|sysfs_fan
mdefine_line|#define sysfs_fan(offset, reg_status, reg_min, reg_ripple, reg_act) &bslash;&n;sysfs_rw_n(fan, _pwm   , offset, reg_min) &bslash;&n;sysfs_rw_n(fan, _status, offset, reg_status) &bslash;&n;sysfs_rw_n(fan, _div   , offset, reg_ripple) &bslash;&n;sysfs_ro_n(fan, _input , offset, reg_act)
DECL|macro|sysfs_temp
mdefine_line|#define sysfs_temp(offset, reg_status, reg_act) &bslash;&n;sysfs_rw_n(temp, _status, offset, reg_status) &bslash;&n;sysfs_ro_n(temp, _input , offset, reg_act)
DECL|macro|sysfs_in
mdefine_line|#define sysfs_in(offset, reg_act) &bslash;&n;sysfs_ro_n(in, _input, offset, reg_act)
DECL|macro|sysfs_revision
mdefine_line|#define sysfs_revision(reg_revision) &bslash;&n;sysfs_ro(revision, , reg_revision)
DECL|macro|sysfs_alarms
mdefine_line|#define sysfs_alarms(reg_events) &bslash;&n;sysfs_ro(alarms, , reg_events)
DECL|macro|sysfs_control
mdefine_line|#define sysfs_control(reg_control) &bslash;&n;sysfs_rw(control, , reg_control)
DECL|macro|sysfs_watchdog
mdefine_line|#define sysfs_watchdog(reg_control, reg_status, reg_preset) &bslash;&n;sysfs_rw(watchdog, _control, reg_control) &bslash;&n;sysfs_rw(watchdog, _status , reg_status) &bslash;&n;sysfs_rw(watchdog, _preset , reg_preset)
id|sysfs_fan
c_func
(paren
l_int|1
comma
id|FSCHER_REG_FAN0_STATE
comma
id|FSCHER_REG_FAN0_MIN
comma
id|FSCHER_REG_FAN0_RIPPLE
comma
id|FSCHER_REG_FAN0_ACT
)paren
id|sysfs_fan
c_func
(paren
l_int|2
comma
id|FSCHER_REG_FAN1_STATE
comma
id|FSCHER_REG_FAN1_MIN
comma
id|FSCHER_REG_FAN1_RIPPLE
comma
id|FSCHER_REG_FAN1_ACT
)paren
id|sysfs_fan
c_func
(paren
l_int|3
comma
id|FSCHER_REG_FAN2_STATE
comma
id|FSCHER_REG_FAN2_MIN
comma
id|FSCHER_REG_FAN2_RIPPLE
comma
id|FSCHER_REG_FAN2_ACT
)paren
id|sysfs_temp
c_func
(paren
l_int|1
comma
id|FSCHER_REG_TEMP0_STATE
comma
id|FSCHER_REG_TEMP0_ACT
)paren
id|sysfs_temp
c_func
(paren
l_int|2
comma
id|FSCHER_REG_TEMP1_STATE
comma
id|FSCHER_REG_TEMP1_ACT
)paren
id|sysfs_temp
c_func
(paren
l_int|3
comma
id|FSCHER_REG_TEMP2_STATE
comma
id|FSCHER_REG_TEMP2_ACT
)paren
id|sysfs_in
c_func
(paren
l_int|0
comma
id|FSCHER_REG_VOLT_12
)paren
id|sysfs_in
c_func
(paren
l_int|1
comma
id|FSCHER_REG_VOLT_5
)paren
id|sysfs_in
c_func
(paren
l_int|2
comma
id|FSCHER_REG_VOLT_BATT
)paren
id|sysfs_revision
c_func
(paren
id|FSCHER_REG_REVISION
)paren
id|sysfs_alarms
c_func
(paren
id|FSCHER_REG_EVENTS
)paren
id|sysfs_control
c_func
(paren
id|FSCHER_REG_CONTROL
)paren
id|sysfs_watchdog
c_func
(paren
id|FSCHER_REG_WDOG_CONTROL
comma
id|FSCHER_REG_WDOG_STATE
comma
id|FSCHER_REG_WDOG_PRESET
)paren
DECL|macro|device_create_file_fan
mdefine_line|#define device_create_file_fan(client, offset) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_status); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_pwm); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_div); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_fan##offset##_input); &bslash;&n;} while (0)
DECL|macro|device_create_file_temp
mdefine_line|#define device_create_file_temp(client, offset) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_status); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_temp##offset##_input); &bslash;&n;} while (0)
DECL|macro|device_create_file_in
mdefine_line|#define device_create_file_in(client, offset) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_in##offset##_input); &bslash;&n;} while (0)
DECL|macro|device_create_file_revision
mdefine_line|#define device_create_file_revision(client) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_revision); &bslash;&n;} while (0)
DECL|macro|device_create_file_alarms
mdefine_line|#define device_create_file_alarms(client) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_alarms); &bslash;&n;} while (0)
DECL|macro|device_create_file_control
mdefine_line|#define device_create_file_control(client) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_control); &bslash;&n;} while (0)
DECL|macro|device_create_file_watchdog
mdefine_line|#define device_create_file_watchdog(client) &bslash;&n;do { &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_watchdog_status); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_watchdog_control); &bslash;&n;&t;device_create_file(&amp;client-&gt;dev, &amp;dev_attr_watchdog_preset); &bslash;&n;} while (0)
multiline_comment|/*&n; * Real code&n; */
DECL|function|fscher_attach_adapter
r_static
r_int
id|fscher_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_HWMON
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|i2c_detect
c_func
(paren
id|adapter
comma
op_amp
id|addr_data
comma
id|fscher_detect
)paren
suffix:semicolon
)brace
DECL|function|fscher_detect
r_static
r_int
id|fscher_detect
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
comma
r_int
id|kind
)paren
(brace
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_struct
id|fscher_data
op_star
id|data
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_BYTE_DATA
)paren
)paren
r_goto
m_exit
suffix:semicolon
multiline_comment|/* OK. For now, we presume we have a valid client. We now create the&n;&t; * client structure, even though we cannot fill it completely yet.&n;&t; * But it allows us to access i2c_smbus_read_byte_data. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|fscher_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|fscher_data
)paren
)paren
suffix:semicolon
multiline_comment|/* The common I2C client data is placed right before the&n;&t; * Hermes-specific data. */
id|new_client
op_assign
op_amp
id|data-&gt;client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|new_client
comma
id|data
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|fscher_driver
suffix:semicolon
id|new_client-&gt;flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Do the remaining detection unless force or force_fscher parameter */
r_if
c_cond
(paren
id|kind
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|FSCHER_REG_IDENT_0
)paren
op_ne
l_int|0x48
)paren
multiline_comment|/* &squot;H&squot; */
op_logical_or
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|FSCHER_REG_IDENT_1
)paren
op_ne
l_int|0x45
)paren
multiline_comment|/* &squot;E&squot; */
op_logical_or
(paren
id|i2c_smbus_read_byte_data
c_func
(paren
id|new_client
comma
id|FSCHER_REG_IDENT_2
)paren
op_ne
l_int|0x52
)paren
)paren
multiline_comment|/* &squot;R&squot; */
r_goto
id|exit_free
suffix:semicolon
)brace
multiline_comment|/* Fill in the remaining client fields and put it into the&n;&t; * global list */
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
l_string|&quot;fscher&quot;
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|new_client-&gt;id
op_assign
id|fscher_id
op_increment
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
multiline_comment|/* Tell the I2C layer a new client has arrived */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
)paren
r_goto
id|exit_free
suffix:semicolon
id|fscher_init_client
c_func
(paren
id|new_client
)paren
suffix:semicolon
multiline_comment|/* Register sysfs hooks */
id|device_create_file_revision
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_alarms
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_control
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_watchdog
c_func
(paren
id|new_client
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|0
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_in
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
id|device_create_file_fan
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|1
)paren
suffix:semicolon
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|2
)paren
suffix:semicolon
id|device_create_file_temp
c_func
(paren
id|new_client
comma
l_int|3
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|exit_free
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|fscher_detach_client
r_static
r_int
id|fscher_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|i2c_detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Client deregistration failed, &quot;
l_string|&quot;client not detached.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fscher_read_value
r_static
r_int
id|fscher_read_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;read reg 0x%02x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
id|i2c_smbus_read_byte_data
c_func
(paren
id|client
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|fscher_write_value
r_static
r_int
id|fscher_write_value
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|reg
comma
id|u8
id|value
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;write reg 0x%02x, val 0x%02x&bslash;n&quot;
comma
id|reg
comma
id|value
)paren
suffix:semicolon
r_return
id|i2c_smbus_write_byte_data
c_func
(paren
id|client
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/* Called when we have found a new FSC Hermes. */
DECL|function|fscher_init_client
r_static
r_void
id|fscher_init_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|fscher_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
multiline_comment|/* Read revision from chip */
id|data-&gt;revision
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_REVISION
)paren
suffix:semicolon
)brace
DECL|function|fscher_update_device
r_static
r_struct
id|fscher_data
op_star
id|fscher_update_device
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|fscher_data
op_star
id|data
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|data-&gt;last_updated
OG
l_int|2
op_star
id|HZ
)paren
op_logical_or
(paren
id|jiffies
OL
id|data-&gt;last_updated
)paren
op_logical_or
op_logical_neg
id|data-&gt;valid
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;Starting fscher update&bslash;n&quot;
)paren
suffix:semicolon
id|data-&gt;temp_act
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP0_ACT
)paren
suffix:semicolon
id|data-&gt;temp_act
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP1_ACT
)paren
suffix:semicolon
id|data-&gt;temp_act
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP2_ACT
)paren
suffix:semicolon
id|data-&gt;temp_status
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP0_STATE
)paren
suffix:semicolon
id|data-&gt;temp_status
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP1_STATE
)paren
suffix:semicolon
id|data-&gt;temp_status
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_TEMP2_STATE
)paren
suffix:semicolon
id|data-&gt;volt
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_VOLT_12
)paren
suffix:semicolon
id|data-&gt;volt
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_VOLT_5
)paren
suffix:semicolon
id|data-&gt;volt
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_VOLT_BATT
)paren
suffix:semicolon
id|data-&gt;fan_act
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN0_ACT
)paren
suffix:semicolon
id|data-&gt;fan_act
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN1_ACT
)paren
suffix:semicolon
id|data-&gt;fan_act
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN2_ACT
)paren
suffix:semicolon
id|data-&gt;fan_status
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN0_STATE
)paren
suffix:semicolon
id|data-&gt;fan_status
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN1_STATE
)paren
suffix:semicolon
id|data-&gt;fan_status
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN2_STATE
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN0_MIN
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN1_MIN
)paren
suffix:semicolon
id|data-&gt;fan_min
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN2_MIN
)paren
suffix:semicolon
id|data-&gt;fan_ripple
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN0_RIPPLE
)paren
suffix:semicolon
id|data-&gt;fan_ripple
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN1_RIPPLE
)paren
suffix:semicolon
id|data-&gt;fan_ripple
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_FAN2_RIPPLE
)paren
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|0
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_WDOG_PRESET
)paren
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|1
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_WDOG_STATE
)paren
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|2
)braket
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_WDOG_CONTROL
)paren
suffix:semicolon
id|data-&gt;global_event
op_assign
id|fscher_read_value
c_func
(paren
id|client
comma
id|FSCHER_REG_EVENT_STATE
)paren
suffix:semicolon
id|data-&gt;last_updated
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;valid
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|data-&gt;update_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|macro|FAN_INDEX_FROM_NUM
mdefine_line|#define FAN_INDEX_FROM_NUM(nr)&t;((nr) - 1)
DECL|function|set_fan_status
r_static
id|ssize_t
id|set_fan_status
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 0..1, 3..7 reserved =&gt; mask with 0x04 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0x04
suffix:semicolon
id|data-&gt;fan_status
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_and_assign
op_complement
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|v
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_fan_status
r_static
id|ssize_t
id|show_fan_status
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 0..1, 3..7 reserved =&gt; mask with 0x04 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;fan_status
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_amp
l_int|0x04
)paren
suffix:semicolon
)brace
DECL|function|set_fan_pwm
r_static
id|ssize_t
id|set_fan_pwm
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
id|data-&gt;fan_min
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0xff
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;fan_min
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_fan_pwm
r_static
id|ssize_t
id|show_fan_pwm
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;fan_min
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
)paren
suffix:semicolon
)brace
DECL|function|set_fan_div
r_static
id|ssize_t
id|set_fan_div
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* supported values: 2, 4, 8 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|v
)paren
(brace
r_case
l_int|2
suffix:colon
id|v
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|v
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|v
op_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;fan_div value %ld not &quot;
l_string|&quot;supported. Choose one of 2, 4 or 8!&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
id|data-&gt;fan_ripple
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
id|data-&gt;fan_ripple
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_or_assign
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;fan_ripple
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_fan_div
r_static
id|ssize_t
id|show_fan_div
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
l_int|1
op_lshift
(paren
id|data-&gt;fan_ripple
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_amp
l_int|0x03
)paren
)paren
suffix:semicolon
)brace
DECL|macro|RPM_FROM_REG
mdefine_line|#define RPM_FROM_REG(val)&t;(val*60)
DECL|function|show_fan_input
r_static
id|ssize_t
id|show_fan_input
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|RPM_FROM_REG
c_func
(paren
id|data-&gt;fan_act
(braket
id|FAN_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|macro|TEMP_INDEX_FROM_NUM
mdefine_line|#define TEMP_INDEX_FROM_NUM(nr)&t;&t;((nr) - 1)
DECL|function|set_temp_status
r_static
id|ssize_t
id|set_temp_status
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 2..7 reserved, 0 read only =&gt; mask with 0x02 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0x02
suffix:semicolon
id|data-&gt;temp_status
(braket
id|TEMP_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_and_assign
op_complement
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|v
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_temp_status
r_static
id|ssize_t
id|show_temp_status
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 2..7 reserved =&gt; mask with 0x03 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;temp_status
(braket
id|TEMP_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
op_amp
l_int|0x03
)paren
suffix:semicolon
)brace
DECL|macro|TEMP_FROM_REG
mdefine_line|#define TEMP_FROM_REG(val)&t;(((val) - 128) * 1000)
DECL|function|show_temp_input
r_static
id|ssize_t
id|show_temp_input
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|TEMP_FROM_REG
c_func
(paren
id|data-&gt;temp_act
(braket
id|TEMP_INDEX_FROM_NUM
c_func
(paren
id|nr
)paren
)braket
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The final conversion is specified in sensors.conf, as it depends on&n; * mainboard specific values. We export the registers contents as&n; * pseudo-hundredths-of-Volts (range 0V - 2.55V). Not that it makes much&n; * sense per se, but it minimizes the conversions count and keeps the&n; * values within a usual range.&n; */
DECL|macro|VOLT_FROM_REG
mdefine_line|#define VOLT_FROM_REG(val)&t;((val) * 10)
DECL|function|show_in_input
r_static
id|ssize_t
id|show_in_input
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|VOLT_FROM_REG
c_func
(paren
id|data-&gt;volt
(braket
id|nr
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|function|show_revision
r_static
id|ssize_t
id|show_revision
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;revision
)paren
suffix:semicolon
)brace
DECL|function|show_alarms
r_static
id|ssize_t
id|show_alarms
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 2, 5..6 reserved =&gt; mask with 0x9b */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;global_event
op_amp
l_int|0x9b
)paren
suffix:semicolon
)brace
DECL|function|set_control
r_static
id|ssize_t
id|set_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 1..7 reserved =&gt; mask with 0x01 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0x01
suffix:semicolon
id|data-&gt;global_control
op_and_assign
op_complement
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|v
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_control
r_static
id|ssize_t
id|show_control
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 1..7 reserved =&gt; mask with 0x01 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;global_control
op_amp
l_int|0x01
)paren
suffix:semicolon
)brace
DECL|function|set_watchdog_control
r_static
id|ssize_t
id|set_watchdog_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 0..3 reserved =&gt; mask with 0xf0 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0xf0
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|2
)braket
op_and_assign
op_complement
l_int|0xf0
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|2
)braket
op_or_assign
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;watchdog
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_watchdog_control
r_static
id|ssize_t
id|show_watchdog_control
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 0..3 reserved, bit 5 write only =&gt; mask with 0xd0 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;watchdog
(braket
l_int|2
)braket
op_amp
l_int|0xd0
)paren
suffix:semicolon
)brace
DECL|function|set_watchdog_status
r_static
id|ssize_t
id|set_watchdog_status
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
multiline_comment|/* bits 0, 2..7 reserved =&gt; mask with 0x02 */
r_int
r_int
id|v
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0x02
suffix:semicolon
id|data-&gt;watchdog
(braket
l_int|1
)braket
op_and_assign
op_complement
id|v
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|v
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_watchdog_status
r_static
id|ssize_t
id|show_watchdog_status
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
multiline_comment|/* bits 0, 2..7 reserved =&gt; mask with 0x02 */
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;watchdog
(braket
l_int|1
)braket
op_amp
l_int|0x02
)paren
suffix:semicolon
)brace
DECL|function|set_watchdog_preset
r_static
id|ssize_t
id|set_watchdog_preset
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_struct
id|fscher_data
op_star
id|data
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|nr
comma
r_int
id|reg
)paren
(brace
id|data-&gt;watchdog
(braket
l_int|0
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|10
)paren
op_amp
l_int|0xff
suffix:semicolon
id|fscher_write_value
c_func
(paren
id|client
comma
id|reg
comma
id|data-&gt;watchdog
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|show_watchdog_preset
r_static
id|ssize_t
id|show_watchdog_preset
c_func
(paren
r_struct
id|fscher_data
op_star
id|data
comma
r_char
op_star
id|buf
comma
r_int
id|nr
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%u&bslash;n&quot;
comma
id|data-&gt;watchdog
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|sensors_fscher_init
r_static
r_int
id|__init
id|sensors_fscher_init
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|fscher_driver
)paren
suffix:semicolon
)brace
DECL|function|sensors_fscher_exit
r_static
r_void
id|__exit
id|sensors_fscher_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|fscher_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Reinhard Nissl &lt;rnissl@gmx.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;FSC Hermes driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|sensors_fscher_init
id|module_init
c_func
(paren
id|sensors_fscher_init
)paren
suffix:semicolon
DECL|variable|sensors_fscher_exit
id|module_exit
c_func
(paren
id|sensors_fscher_exit
)paren
suffix:semicolon
eof
