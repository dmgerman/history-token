multiline_comment|/* i2c-core.c - a device driver for the iic-bus interface&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*   Copyright (C) 1995-99 Simon G. Vogl&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* With some changes from Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;.&n;   All SMBus-related things are written by Frodo Looijaard &lt;frodol@dds.nl&gt;&n;   SMBus 2.0 support by Mark Studebaker &lt;mdsxyz123@yahoo.com&gt;                */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/idr.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
r_static
id|LIST_HEAD
c_func
(paren
id|adapters
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|drivers
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|core_lists
)paren
suffix:semicolon
r_static
id|DEFINE_IDR
c_func
(paren
id|i2c_adapter_idr
)paren
suffix:semicolon
DECL|function|i2c_device_probe
r_int
id|i2c_device_probe
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|i2c_device_remove
r_int
id|i2c_device_remove
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_adapter_dev_release
r_static
r_void
id|i2c_adapter_dev_release
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|dev_to_i2c_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|adap-&gt;dev_released
)paren
suffix:semicolon
)brace
DECL|variable|i2c_adapter_driver
r_static
r_struct
id|device_driver
id|i2c_adapter_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i2c_adapter&quot;
comma
dot
id|bus
op_assign
op_amp
id|i2c_bus_type
comma
dot
id|probe
op_assign
id|i2c_device_probe
comma
dot
id|remove
op_assign
id|i2c_device_remove
comma
)brace
suffix:semicolon
DECL|function|i2c_adapter_class_dev_release
r_static
r_void
id|i2c_adapter_class_dev_release
c_func
(paren
r_struct
id|class_device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|class_dev_to_i2c_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|adap-&gt;class_dev_released
)paren
suffix:semicolon
)brace
DECL|variable|i2c_adapter_class
r_static
r_struct
r_class
id|i2c_adapter_class
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i2c-adapter&quot;
comma
dot
id|release
op_assign
op_amp
id|i2c_adapter_class_dev_release
comma
)brace
suffix:semicolon
DECL|function|show_adapter_name
r_static
id|ssize_t
id|show_adapter_name
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|dev_to_i2c_adapter
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|adap-&gt;name
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|name
comma
id|S_IRUGO
comma
id|show_adapter_name
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|i2c_client_release
r_static
r_void
id|i2c_client_release
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
id|complete
c_func
(paren
op_amp
id|client-&gt;released
)paren
suffix:semicolon
)brace
DECL|function|show_client_name
r_static
id|ssize_t
id|show_client_name
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|to_i2c_client
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * We can&squot;t use the DEVICE_ATTR() macro here as we want the same filename for a&n; * different type of a device.  So beware if the DEVICE_ATTR() macro ever&n; * changes, this definition will also have to change.&n; */
DECL|variable|dev_attr_client_name
r_static
r_struct
id|device_attribute
id|dev_attr_client_name
op_assign
(brace
dot
id|attr
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;name&quot;
comma
dot
id|mode
op_assign
id|S_IRUGO
comma
dot
id|owner
op_assign
id|THIS_MODULE
)brace
comma
dot
id|show
op_assign
op_amp
id|show_client_name
comma
)brace
suffix:semicolon
multiline_comment|/* ---------------------------------------------------&n; * registering functions &n; * --------------------------------------------------- &n; */
multiline_comment|/* -----&n; * i2c_add_adapter is called from within the algorithm layer,&n; * when a new hw adapter registers. A new device is register to be&n; * available for clients.&n; */
DECL|function|i2c_add_adapter
r_int
id|i2c_add_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|id
comma
id|res
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_struct
id|i2c_driver
op_star
id|driver
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idr_pre_get
c_func
(paren
op_amp
id|i2c_adapter_idr
comma
id|GFP_KERNEL
)paren
op_eq
l_int|0
)paren
(brace
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
id|res
op_assign
id|idr_get_new
c_func
(paren
op_amp
id|i2c_adapter_idr
comma
l_int|NULL
comma
op_amp
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|res
op_eq
op_minus
id|EAGAIN
)paren
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
id|adap-&gt;nr
op_assign
id|id
op_amp
id|MAX_ID_MASK
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adap-&gt;clist_lock
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|adap-&gt;list
comma
op_amp
id|adapters
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|adap-&gt;clients
)paren
suffix:semicolon
multiline_comment|/* Add the adapter to the driver core.&n;&t; * If the parent pointer is not set up,&n;&t; * we add this adapter to the host bus.&n;&t; */
r_if
c_cond
(paren
id|adap-&gt;dev.parent
op_eq
l_int|NULL
)paren
id|adap-&gt;dev.parent
op_assign
op_amp
id|platform_bus
suffix:semicolon
id|sprintf
c_func
(paren
id|adap-&gt;dev.bus_id
comma
l_string|&quot;i2c-%d&quot;
comma
id|adap-&gt;nr
)paren
suffix:semicolon
id|adap-&gt;dev.driver
op_assign
op_amp
id|i2c_adapter_driver
suffix:semicolon
id|adap-&gt;dev.release
op_assign
op_amp
id|i2c_adapter_dev_release
suffix:semicolon
id|device_register
c_func
(paren
op_amp
id|adap-&gt;dev
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|adap-&gt;dev
comma
op_amp
id|dev_attr_name
)paren
suffix:semicolon
multiline_comment|/* Add this adapter to the i2c_adapter class */
id|memset
c_func
(paren
op_amp
id|adap-&gt;class_dev
comma
l_int|0x00
comma
r_sizeof
(paren
r_struct
id|class_device
)paren
)paren
suffix:semicolon
id|adap-&gt;class_dev.dev
op_assign
op_amp
id|adap-&gt;dev
suffix:semicolon
id|adap-&gt;class_dev
dot
r_class
op_assign
op_amp
id|i2c_adapter_class
suffix:semicolon
id|strlcpy
c_func
(paren
id|adap-&gt;class_dev.class_id
comma
id|adap-&gt;dev.bus_id
comma
id|BUS_ID_SIZE
)paren
suffix:semicolon
id|class_device_register
c_func
(paren
op_amp
id|adap-&gt;class_dev
)paren
suffix:semicolon
multiline_comment|/* inform drivers of new adapters */
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|drivers
)paren
(brace
id|driver
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_driver
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
id|I2C_DF_NOTIFY
)paren
multiline_comment|/* We ignore the return code; if it fails, too bad */
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
suffix:semicolon
)brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;registered as adapter #%d&bslash;n&quot;
comma
id|adap-&gt;nr
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_del_adapter
r_int
id|i2c_del_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_struct
id|list_head
op_star
id|item
comma
op_star
id|_n
suffix:semicolon
r_struct
id|i2c_driver
op_star
id|driver
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|drivers
)paren
(brace
id|driver
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_driver
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver-&gt;detach_adapter
)paren
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|detach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;can&squot;t detach adapter &quot;
l_string|&quot;while detaching driver %s: driver not &quot;
l_string|&quot;detached!&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
multiline_comment|/* detach any active clients. This must be done first, because&n;&t; * it can fail; in which case we give upp. */
id|list_for_each_safe
c_func
(paren
id|item
comma
id|_n
comma
op_amp
id|adap-&gt;clients
)paren
(brace
id|client
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_client
comma
id|list
)paren
suffix:semicolon
multiline_comment|/* detaching devices is unconditional of the set notify&n;&t;&t; * flag, as _all_ clients that reside on the adapter&n;&t;&t; * must be deleted, as this would cause invalid states.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|res
op_assign
id|client-&gt;driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;adapter not &quot;
l_string|&quot;unregistered, because client at &quot;
l_string|&quot;address %02x can&squot;t be detached. &quot;
comma
id|client-&gt;addr
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
multiline_comment|/* clean up the sysfs representation */
id|init_completion
c_func
(paren
op_amp
id|adap-&gt;dev_released
)paren
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|adap-&gt;class_dev_released
)paren
suffix:semicolon
id|class_device_unregister
c_func
(paren
op_amp
id|adap-&gt;class_dev
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|adap-&gt;dev
comma
op_amp
id|dev_attr_name
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|adap-&gt;dev
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|adap-&gt;list
)paren
suffix:semicolon
multiline_comment|/* wait for sysfs to drop all references */
id|wait_for_completion
c_func
(paren
op_amp
id|adap-&gt;dev_released
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|adap-&gt;class_dev_released
)paren
suffix:semicolon
multiline_comment|/* free dynamically allocated bus id */
id|idr_remove
c_func
(paren
op_amp
id|i2c_adapter_idr
comma
id|adap-&gt;nr
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;adapter unregistered&bslash;n&quot;
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* -----&n; * What follows is the &quot;upwards&quot; interface: commands for talking to clients,&n; * which implement the functions to access the physical information of the&n; * chips.&n; */
DECL|function|i2c_add_driver
r_int
id|i2c_add_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adapter
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
multiline_comment|/* add the driver to the list of i2c drivers in the driver core */
id|driver-&gt;driver.name
op_assign
id|driver-&gt;name
suffix:semicolon
id|driver-&gt;driver.bus
op_assign
op_amp
id|i2c_bus_type
suffix:semicolon
id|driver-&gt;driver.probe
op_assign
id|i2c_device_probe
suffix:semicolon
id|driver-&gt;driver.remove
op_assign
id|i2c_device_remove
suffix:semicolon
id|res
op_assign
id|driver_register
c_func
(paren
op_amp
id|driver-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_goto
id|out_unlock
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|driver-&gt;list
comma
op_amp
id|drivers
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core: driver %s registered.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
multiline_comment|/* now look for instances of driver on our adapters */
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
id|I2C_DF_NOTIFY
)paren
(brace
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|adapters
)paren
(brace
id|adapter
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_adapter
comma
id|list
)paren
suffix:semicolon
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
)brace
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_del_driver
r_int
id|i2c_del_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_struct
id|list_head
op_star
id|item1
comma
op_star
id|item2
comma
op_star
id|_n
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
multiline_comment|/* Have a look at each adapter, if clients of this driver are still&n;&t; * attached. If so, detach them to be able to kill the driver &n;&t; * afterwards.&n;&t; */
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core: unregister_driver - looking for clients.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* removing clients does not depend on the notify flag, else &n;&t; * invalid operation might (will!) result, when using stale client&n;&t; * pointers.&n;&t; */
id|list_for_each
c_func
(paren
id|item1
comma
op_amp
id|adapters
)paren
(brace
id|adap
op_assign
id|list_entry
c_func
(paren
id|item1
comma
r_struct
id|i2c_adapter
comma
id|list
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;examining adapter&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver-&gt;detach_adapter
)paren
(brace
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|detach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;while unregistering &quot;
l_string|&quot;dummy driver %s, adapter could &quot;
l_string|&quot;not be detached properly; driver &quot;
l_string|&quot;not unloaded!&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
r_else
(brace
id|list_for_each_safe
c_func
(paren
id|item2
comma
id|_n
comma
op_amp
id|adap-&gt;clients
)paren
(brace
id|client
op_assign
id|list_entry
c_func
(paren
id|item2
comma
r_struct
id|i2c_client
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;driver
op_ne
id|driver
)paren
r_continue
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core.o: detaching client %s:&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;while &quot;
l_string|&quot;unregistering driver &quot;
l_string|&quot;`%s&squot;, the client at &quot;
l_string|&quot;address %02x of &quot;
l_string|&quot;adapter could not &quot;
l_string|&quot;be detached; driver &quot;
l_string|&quot;not unloaded!&quot;
comma
id|driver-&gt;name
comma
id|client-&gt;addr
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
)brace
)brace
id|driver_unregister
c_func
(paren
op_amp
id|driver-&gt;driver
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|driver-&gt;list
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core: driver unregistered: %s&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__i2c_check_addr
r_static
r_int
id|__i2c_check_addr
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
r_int
id|addr
)paren
(brace
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|adapter-&gt;clients
)paren
(brace
id|client
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_client
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;addr
op_eq
id|addr
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_check_addr
r_int
id|i2c_check_addr
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|addr
)paren
(brace
r_int
id|rval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
id|rval
op_assign
id|__i2c_check_addr
c_func
(paren
id|adapter
comma
id|addr
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
DECL|function|i2c_attach_client
r_int
id|i2c_attach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__i2c_check_addr
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|client-&gt;list
comma
op_amp
id|adapter-&gt;clients
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;client_register
)paren
(brace
r_if
c_cond
(paren
id|adapter
op_member_access_from_pointer
id|client_register
c_func
(paren
id|client
)paren
)paren
(brace
id|dev_warn
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;warning: client_register &quot;
l_string|&quot;seems to have failed for client %02x&bslash;n&quot;
comma
id|client-&gt;addr
)paren
suffix:semicolon
)brace
)brace
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;client [%s] registered to adapter&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
id|client-&gt;usage_count
op_assign
l_int|0
suffix:semicolon
id|client-&gt;dev.parent
op_assign
op_amp
id|client-&gt;adapter-&gt;dev
suffix:semicolon
id|client-&gt;dev.driver
op_assign
op_amp
id|client-&gt;driver-&gt;driver
suffix:semicolon
id|client-&gt;dev.bus
op_assign
op_amp
id|i2c_bus_type
suffix:semicolon
id|client-&gt;dev.release
op_assign
op_amp
id|i2c_client_release
suffix:semicolon
id|snprintf
c_func
(paren
op_amp
id|client-&gt;dev.bus_id
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|client-&gt;dev.bus_id
)paren
comma
l_string|&quot;%d-%04x&quot;
comma
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
comma
id|client-&gt;addr
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;registering %s&bslash;n&quot;
comma
id|client-&gt;dev.bus_id
)paren
suffix:semicolon
id|device_register
c_func
(paren
op_amp
id|client-&gt;dev
)paren
suffix:semicolon
id|device_create_file
c_func
(paren
op_amp
id|client-&gt;dev
comma
op_amp
id|dev_attr_client_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_detach_client
r_int
id|i2c_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
op_logical_and
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;client_unregister
)paren
(brace
id|res
op_assign
id|adapter
op_member_access_from_pointer
id|client_unregister
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;dev
comma
l_string|&quot;client_unregister [%s] failed, &quot;
l_string|&quot;client not detached&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|down
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|client-&gt;list
)paren
suffix:semicolon
id|init_completion
c_func
(paren
op_amp
id|client-&gt;released
)paren
suffix:semicolon
id|device_remove_file
c_func
(paren
op_amp
id|client-&gt;dev
comma
op_amp
id|dev_attr_client_name
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|client-&gt;dev
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;clist_lock
)paren
suffix:semicolon
id|wait_for_completion
c_func
(paren
op_amp
id|client-&gt;released
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_inc_use_client
r_static
r_int
id|i2c_inc_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|client-&gt;adapter-&gt;owner
)paren
)paren
(brace
id|module_put
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_dec_use_client
r_static
r_void
id|i2c_dec_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
id|module_put
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|client-&gt;adapter-&gt;owner
)paren
suffix:semicolon
)brace
DECL|function|i2c_use_client
r_int
id|i2c_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|i2c_inc_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_MULTIPLE_USE
)paren
id|client-&gt;usage_count
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
r_goto
id|busy
suffix:semicolon
r_else
id|client-&gt;usage_count
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|busy
suffix:colon
id|i2c_dec_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|i2c_release_client
r_int
id|i2c_release_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
(brace
id|client-&gt;usage_count
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core: %s used one too many times&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
id|i2c_dec_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_clients_command
r_void
id|i2c_clients_command
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;clist_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|adap-&gt;clients
)paren
(brace
id|client
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_client
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|client-&gt;driver-&gt;command
)paren
(brace
id|up
c_func
(paren
op_amp
id|adap-&gt;clist_lock
)paren
suffix:semicolon
id|client-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|client
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;clist_lock
)paren
suffix:semicolon
)brace
id|module_put
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|adap-&gt;clist_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* match always succeeds, as we want the probe() to tell if we really accept this match */
DECL|function|i2c_device_match
r_static
r_int
id|i2c_device_match
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|i2c_bus_suspend
r_static
r_int
id|i2c_bus_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver
op_logical_and
id|dev-&gt;driver-&gt;suspend
)paren
id|rc
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|suspend
c_func
(paren
id|dev
comma
id|state
comma
l_int|0
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|i2c_bus_resume
r_static
r_int
id|i2c_bus_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver
op_logical_and
id|dev-&gt;driver-&gt;resume
)paren
id|rc
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|resume
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|i2c_bus_type
r_struct
id|bus_type
id|i2c_bus_type
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i2c&quot;
comma
dot
id|match
op_assign
id|i2c_device_match
comma
dot
id|suspend
op_assign
id|i2c_bus_suspend
comma
dot
id|resume
op_assign
id|i2c_bus_resume
comma
)brace
suffix:semicolon
DECL|function|i2c_init
r_static
r_int
id|__init
id|i2c_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
suffix:semicolon
id|retval
op_assign
id|bus_register
c_func
(paren
op_amp
id|i2c_bus_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
id|retval
op_assign
id|driver_register
c_func
(paren
op_amp
id|i2c_adapter_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_return
id|retval
suffix:semicolon
r_return
id|class_register
c_func
(paren
op_amp
id|i2c_adapter_class
)paren
suffix:semicolon
)brace
DECL|function|i2c_exit
r_static
r_void
id|__exit
id|i2c_exit
c_func
(paren
r_void
)paren
(brace
id|class_unregister
c_func
(paren
op_amp
id|i2c_adapter_class
)paren
suffix:semicolon
id|driver_unregister
c_func
(paren
op_amp
id|i2c_adapter_driver
)paren
suffix:semicolon
id|bus_unregister
c_func
(paren
op_amp
id|i2c_bus_type
)paren
suffix:semicolon
)brace
DECL|variable|i2c_init
id|subsys_initcall
c_func
(paren
id|i2c_init
)paren
suffix:semicolon
DECL|variable|i2c_exit
id|module_exit
c_func
(paren
id|i2c_exit
)paren
suffix:semicolon
multiline_comment|/* ----------------------------------------------------&n; * the functional interface to the i2c busses.&n; * ----------------------------------------------------&n; */
DECL|function|i2c_transfer
r_int
id|i2c_transfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_struct
id|i2c_msg
id|msgs
(braket
)braket
comma
r_int
id|num
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;master_xfer
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;master_xfer: with %d msgs.&bslash;n&quot;
comma
id|num
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
id|msgs
comma
id|num
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;I2C level transfers not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_send
r_int
id|i2c_master_send
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
id|msg.buf
op_assign
(paren
r_char
op_star
)paren
id|buf
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;master_send: writing %d bytes.&bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t;&t; * transmitted, else error code.&n;&t;&t; */
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;I2C level transfers not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_recv
r_int
id|i2c_master_recv
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.flags
op_or_assign
id|I2C_M_RD
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
id|msg.buf
op_assign
id|buf
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;master_recv: reading %d bytes.&bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus_lock
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;master_recv: return:%d (count:%d, addr:0x%02x)&bslash;n&quot;
comma
id|ret
comma
id|count
comma
id|client-&gt;addr
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t; &t;* transmitted, else error code.&n;&t; &t;*/
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|dev_err
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;I2C level transfers not supported&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_control
r_int
id|i2c_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|client-&gt;adapter-&gt;dev
comma
l_string|&quot;i2c ioctl, cmd: 0x%x, arg: %#lx&bslash;n&quot;
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|I2C_RETRIES
suffix:colon
id|adap-&gt;retries
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_TIMEOUT
suffix:colon
id|adap-&gt;timeout
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;algo_control
op_ne
l_int|NULL
)paren
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|algo_control
c_func
(paren
id|adap
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------&n; * the i2c address scanning function&n; * Will not work for 10-bit addresses!&n; * ----------------------------------------------------&n; */
DECL|function|i2c_probe
r_int
id|i2c_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_struct
id|i2c_client_address_data
op_star
id|address_data
comma
r_int
(paren
op_star
id|found_proc
)paren
(paren
r_struct
id|i2c_adapter
op_star
comma
r_int
comma
r_int
)paren
)paren
(brace
r_int
id|addr
comma
id|i
comma
id|found
comma
id|err
suffix:semicolon
r_int
id|adap_id
op_assign
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
suffix:semicolon
multiline_comment|/* Forget it if we can&squot;t probe using SMBUS_QUICK */
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_QUICK
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|addr
op_assign
l_int|0x00
suffix:semicolon
id|addr
op_le
l_int|0x7f
suffix:semicolon
id|addr
op_increment
)paren
(brace
multiline_comment|/* Skip if already in use */
r_if
c_cond
(paren
id|i2c_check_addr
c_func
(paren
id|adapter
comma
id|addr
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* If it is in one of the force entries, we don&squot;t do any detection&n;&t;&t;   at all */
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;force
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;force
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found force parameter for adapter %d, addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* If this address is in one of the ignores, we can forget about&n;&t;&t;   it right now */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;ignore
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found ignore parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found ignore_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* Now, we will do a detection, but only if it is in the normal or &n;&t;&t;   probe entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|addr
op_eq
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found normal i2c entry for adapter %d, &quot;
l_string|&quot;addr %02x&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_ge
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;normal_i2c_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found normal i2c_range entry for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;probe
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found probe parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;found probe_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* OK, so we really should examine this address. First check&n;&t;&t;   whether there is some client here at all! */
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
op_ge
l_int|0
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
op_minus
l_int|1
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return id number for a specific adapter&n; */
DECL|function|i2c_adapter_id
r_int
id|i2c_adapter_id
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_return
id|adap-&gt;nr
suffix:semicolon
)brace
DECL|function|i2c_get_adapter
r_struct
id|i2c_adapter
op_star
id|i2c_get_adapter
c_func
(paren
r_int
id|id
)paren
(brace
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adapter
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|adapters
)paren
(brace
id|adapter
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_adapter
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
id|adapter-&gt;nr
op_logical_and
id|try_module_get
c_func
(paren
id|adapter-&gt;owner
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|adapter
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|i2c_put_adapter
r_void
id|i2c_put_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
id|module_put
c_func
(paren
id|adap-&gt;owner
)paren
suffix:semicolon
)brace
multiline_comment|/* The SMBus parts */
DECL|macro|POLY
mdefine_line|#define POLY    (0x1070U &lt;&lt; 3) 
r_static
id|u8
DECL|function|crc8
id|crc8
c_func
(paren
id|u16
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|0x8000
)paren
id|data
op_assign
id|data
op_xor
id|POLY
suffix:semicolon
id|data
op_assign
id|data
op_lshift
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|u8
)paren
(paren
id|data
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* CRC over count bytes in the first array plus the bytes in the rest&n;   array if it is non-null. rest[0] is the (length of rest) - 1&n;   and is included. */
DECL|function|i2c_smbus_partial_pec
id|u8
id|i2c_smbus_partial_pec
c_func
(paren
id|u8
id|crc
comma
r_int
id|count
comma
id|u8
op_star
id|first
comma
id|u8
op_star
id|rest
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crc
op_assign
id|crc8
c_func
(paren
(paren
id|crc
op_xor
id|first
(braket
id|i
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rest
op_ne
l_int|NULL
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|rest
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crc
op_assign
id|crc8
c_func
(paren
(paren
id|crc
op_xor
id|rest
(braket
id|i
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|i2c_smbus_pec
id|u8
id|i2c_smbus_pec
c_func
(paren
r_int
id|count
comma
id|u8
op_star
id|first
comma
id|u8
op_star
id|rest
)paren
(brace
r_return
id|i2c_smbus_partial_pec
c_func
(paren
l_int|0
comma
id|count
comma
id|first
comma
id|rest
)paren
suffix:semicolon
)brace
multiline_comment|/* Returns new &quot;size&quot; (transaction type)&n;   Note that we convert byte to byte_data and byte_data to word_data&n;   rather than invent new xxx_PEC transactions. */
DECL|function|i2c_smbus_add_pec
r_int
id|i2c_smbus_add_pec
c_func
(paren
id|u16
id|addr
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|u8
id|buf
(braket
l_int|3
)braket
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|addr
op_lshift
l_int|1
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|data-&gt;byte
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BYTE_DATA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|buf
(braket
l_int|2
)braket
op_assign
id|data-&gt;byte
suffix:semicolon
id|data-&gt;word
op_assign
id|buf
(braket
l_int|2
)braket
op_logical_or
(paren
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
l_int|NULL
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_WORD_DATA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
multiline_comment|/* unsupported */
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA
suffix:colon
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
DECL|function|i2c_smbus_check_pec
r_int
id|i2c_smbus_check_pec
c_func
(paren
id|u16
id|addr
comma
id|u8
id|command
comma
r_int
id|size
comma
id|u8
id|partial
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|u8
id|buf
(braket
l_int|3
)braket
comma
id|rpec
comma
id|cpec
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;byte
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;word
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA_PEC
suffix:colon
multiline_comment|/* unsupported */
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL_PEC
suffix:colon
multiline_comment|/* unsupported */
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|rpec
op_assign
id|i2c_smbus_partial_pec
c_func
(paren
id|partial
comma
l_int|1
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|cpec
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpec
op_ne
id|cpec
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;i2c-core: Bad PEC 0x%02x vs. 0x%02x&bslash;n&quot;
comma
id|rpec
comma
id|cpec
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_quick
id|s32
id|i2c_smbus_write_quick
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|value
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte
id|s32
id|i2c_smbus_read_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
l_int|0
comma
id|I2C_SMBUS_BYTE
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte
id|s32
id|i2c_smbus_write_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
multiline_comment|/* only for PEC */
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|value
comma
id|I2C_SMBUS_BYTE
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte_data
id|s32
id|i2c_smbus_read_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte_data
id|s32
id|i2c_smbus_write_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.byte
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_word_data
id|s32
id|i2c_smbus_read_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_word_data
id|s32
id|i2c_smbus_write_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_process_call
id|s32
id|i2c_smbus_process_call
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_PROC_CALL
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_read_block_data
id|s32
id|i2c_smbus_read_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
DECL|function|i2c_smbus_write_block_data
id|s32
id|i2c_smbus_write_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_BLOCK_MAX
)paren
id|length
op_assign
id|I2C_SMBUS_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_block_process_call
id|s32
id|i2c_smbus_block_process_call
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_BLOCK_MAX
op_minus
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BLOCK_PROC_CALL
comma
op_amp
id|data
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_read_i2c_block_data
id|s32
id|i2c_smbus_read_i2c_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_I2C_BLOCK_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
DECL|function|i2c_smbus_write_i2c_block_data
id|s32
id|i2c_smbus_write_i2c_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_I2C_BLOCK_MAX
)paren
id|length
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_I2C_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* Simulate a SMBus command using the i2c protocol &n;   No checking of parameters is done!  */
DECL|function|i2c_smbus_xfer_emulated
r_static
id|s32
id|i2c_smbus_xfer_emulated
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
multiline_comment|/* So we need to generate a series of msgs. In the case of writing, we&n;&t;  need to use only one message; when reading, we need two. We initialize&n;&t;  most things with sane defaults, to keep the code below somewhat&n;&t;  simpler. */
r_int
r_char
id|msgbuf0
(braket
l_int|34
)braket
suffix:semicolon
r_int
r_char
id|msgbuf1
(braket
l_int|34
)braket
suffix:semicolon
r_int
id|num
op_assign
id|read_write
op_eq
id|I2C_SMBUS_READ
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|addr
comma
id|flags
comma
l_int|1
comma
id|msgbuf0
)brace
comma
(brace
id|addr
comma
id|flags
op_or
id|I2C_M_RD
comma
l_int|0
comma
id|msgbuf1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|msgbuf0
(braket
l_int|0
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_QUICK
suffix:colon
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Special case: The read/write field is used as data */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|flags
op_or
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
ques
c_cond
id|I2C_M_RD
suffix:colon
l_int|0
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
multiline_comment|/* Special case: only a read! */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|I2C_M_RD
op_or
id|flags
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;byte
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|num
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Special case */
id|read_write
op_assign
id|I2C_SMBUS_READ
suffix:semicolon
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA
suffix:colon
r_case
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;Block read not supported &quot;
l_string|&quot;under I2C emulation!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
OG
id|I2C_SMBUS_BLOCK_MAX
op_plus
l_int|2
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;smbus_access called with &quot;
l_string|&quot;invalid block write size (%d)&bslash;n&quot;
comma
id|data-&gt;block
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BLOCK_DATA_PEC
)paren
(brace
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
)paren
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|msg
(braket
l_int|0
)braket
dot
id|len
suffix:semicolon
id|i
op_increment
)paren
id|msgbuf0
(braket
id|i
)braket
op_assign
id|data-&gt;block
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL
suffix:colon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:colon
id|dev_dbg
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;Block process call not supported &quot;
l_string|&quot;under I2C emulation!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_case
id|I2C_SMBUS_I2C_BLOCK_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
)brace
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
OG
id|I2C_SMBUS_I2C_BLOCK_MAX
op_plus
l_int|1
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;i2c_smbus_xfer_emulated called with &quot;
l_string|&quot;invalid block write size (%d)&bslash;n&quot;
comma
id|data-&gt;block
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data-&gt;block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|msgbuf0
(braket
id|i
)braket
op_assign
id|data-&gt;block
(braket
id|i
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_err
c_func
(paren
op_amp
id|adapter-&gt;dev
comma
l_string|&quot;smbus_access called with invalid size (%d)&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
id|adapter
comma
id|msg
comma
id|num
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf0
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf1
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|data-&gt;word
op_assign
id|msgbuf1
(braket
l_int|0
)braket
op_or
(paren
id|msgbuf1
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_I2C_BLOCK_DATA
suffix:colon
multiline_comment|/* fixed at 32 for now */
id|data-&gt;block
(braket
l_int|0
)braket
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
id|i
op_increment
)paren
id|data-&gt;block
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|msgbuf1
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_smbus_xfer
id|s32
id|i2c_smbus_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|s32
id|res
suffix:semicolon
r_int
id|swpec
op_assign
l_int|0
suffix:semicolon
id|u8
id|partial
op_assign
l_int|0
suffix:semicolon
id|flags
op_and_assign
id|I2C_M_TEN
op_or
id|I2C_CLIENT_PEC
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|I2C_CLIENT_PEC
)paren
op_logical_and
op_logical_neg
(paren
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_HWPEC_CALC
)paren
)paren
)paren
(brace
id|swpec
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
op_logical_and
id|size
op_eq
id|I2C_SMBUS_BLOCK_DATA
)paren
(brace
id|size
op_assign
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_PROC_CALL
)paren
(brace
id|size
op_assign
id|I2C_SMBUS_PROC_CALL_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BLOCK_PROC_CALL
)paren
(brace
id|i2c_smbus_add_pec
c_func
(paren
id|addr
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
id|data
)paren
suffix:semicolon
id|partial
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
op_logical_and
id|size
op_ne
id|I2C_SMBUS_QUICK
op_logical_and
id|size
op_ne
id|I2C_SMBUS_I2C_BLOCK_DATA
)paren
(brace
id|size
op_assign
id|i2c_smbus_add_pec
c_func
(paren
id|addr
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|adapter-&gt;algo-&gt;smbus_xfer
)paren
(brace
id|down
c_func
(paren
op_amp
id|adapter-&gt;bus_lock
)paren
suffix:semicolon
id|res
op_assign
id|adapter-&gt;algo
op_member_access_from_pointer
id|smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;bus_lock
)paren
suffix:semicolon
)brace
r_else
id|res
op_assign
id|i2c_smbus_xfer_emulated
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_ge
l_int|0
op_logical_and
id|swpec
op_logical_and
id|size
op_ne
id|I2C_SMBUS_QUICK
op_logical_and
id|size
op_ne
id|I2C_SMBUS_I2C_BLOCK_DATA
op_logical_and
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
op_logical_or
id|size
op_eq
id|I2C_SMBUS_PROC_CALL_PEC
op_logical_or
id|size
op_eq
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
)paren
)paren
(brace
r_if
c_cond
(paren
id|i2c_smbus_check_pec
c_func
(paren
id|addr
comma
id|command
comma
id|size
comma
id|partial
comma
id|data
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* You should always define `functionality&squot;; the &squot;else&squot; is just for&n;   backward compatibility. */
DECL|function|i2c_get_functionality
id|u32
id|i2c_get_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;functionality
)paren
r_return
id|adap-&gt;algo
op_member_access_from_pointer
id|functionality
c_func
(paren
id|adap
)paren
suffix:semicolon
r_else
r_return
l_int|0xffffffff
suffix:semicolon
)brace
DECL|function|i2c_check_functionality
r_int
id|i2c_check_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
id|u32
id|func
)paren
(brace
id|u32
id|adap_func
op_assign
id|i2c_get_functionality
(paren
id|adap
)paren
suffix:semicolon
r_return
(paren
id|func
op_amp
id|adap_func
)paren
op_eq
id|func
suffix:semicolon
)brace
DECL|variable|i2c_add_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_adapter
)paren
suffix:semicolon
DECL|variable|i2c_del_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_adapter
)paren
suffix:semicolon
DECL|variable|i2c_add_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_driver
)paren
suffix:semicolon
DECL|variable|i2c_del_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_driver
)paren
suffix:semicolon
DECL|variable|i2c_attach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_attach_client
)paren
suffix:semicolon
DECL|variable|i2c_detach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_detach_client
)paren
suffix:semicolon
DECL|variable|i2c_use_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_use_client
)paren
suffix:semicolon
DECL|variable|i2c_release_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_release_client
)paren
suffix:semicolon
DECL|variable|i2c_clients_command
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_clients_command
)paren
suffix:semicolon
DECL|variable|i2c_check_addr
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_addr
)paren
suffix:semicolon
DECL|variable|i2c_master_send
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_send
)paren
suffix:semicolon
DECL|variable|i2c_master_recv
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_recv
)paren
suffix:semicolon
DECL|variable|i2c_control
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_control
)paren
suffix:semicolon
DECL|variable|i2c_transfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_transfer
)paren
suffix:semicolon
DECL|variable|i2c_adapter_id
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_adapter_id
)paren
suffix:semicolon
DECL|variable|i2c_get_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_get_adapter
)paren
suffix:semicolon
DECL|variable|i2c_put_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_put_adapter
)paren
suffix:semicolon
DECL|variable|i2c_probe
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_probe
)paren
suffix:semicolon
DECL|variable|i2c_smbus_xfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_xfer
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_quick
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_quick
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_process_call
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_process_call
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_i2c_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_i2c_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_i2c_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_i2c_block_data
)paren
suffix:semicolon
DECL|variable|i2c_get_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_get_functionality
)paren
suffix:semicolon
DECL|variable|i2c_check_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_functionality
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Simon G. Vogl &lt;simon@tk.uni-linz.ac.at&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;I2C-Bus main module&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
