multiline_comment|/* i2c-core.c - a device driver for the iic-bus interface&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/*   Copyright (C) 1995-99 Simon G. Vogl&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&t;&t;     */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* With some changes from Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;.&n;   All SMBus-related things are written by Frodo Looijaard &lt;frodol@dds.nl&gt;&n;   SMBus 2.0 support by Mark Studebaker &lt;mdsxyz123@yahoo.com&gt;                */
multiline_comment|/* $Id: i2c-core.c,v 1.95 2003/01/22 05:25:08 kmalkki Exp $ */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|DEB
mdefine_line|#define DEB(x) if (i2c_debug&gt;=1) x;
DECL|macro|DEB2
mdefine_line|#define DEB2(x) if (i2c_debug&gt;=2) x;
DECL|variable|adapters
r_static
r_struct
id|i2c_adapter
op_star
id|adapters
(braket
id|I2C_ADAP_MAX
)braket
suffix:semicolon
DECL|variable|drivers
r_static
r_struct
id|i2c_driver
op_star
id|drivers
(braket
id|I2C_DRIVER_MAX
)braket
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|core_lists
)paren
suffix:semicolon
multiline_comment|/**** debug level */
DECL|variable|i2c_debug
r_static
r_int
id|i2c_debug
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
r_static
r_int
id|i2cproc_register
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
id|bus
)paren
suffix:semicolon
r_static
r_void
id|i2cproc_remove
c_func
(paren
r_int
id|bus
)paren
suffix:semicolon
macro_line|#else
DECL|macro|i2cproc_register
macro_line|# define i2cproc_register(adap, bus)&t;0
DECL|macro|i2cproc_remove
macro_line|# define i2cproc_remove(bus)&t;&t;do { } while (0)
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/* ---------------------------------------------------&n; * registering functions &n; * --------------------------------------------------- &n; */
multiline_comment|/* -----&n; * i2c_add_adapter is called from within the algorithm layer,&n; * when a new hw adapter registers. A new device is register to be&n; * available for clients.&n; */
DECL|function|i2c_add_adapter
r_int
id|i2c_add_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|res
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_ADAP_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: register_adapter(%s) - enlarge I2C_ADAP_MAX.&bslash;n&quot;
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
id|res
op_assign
id|i2cproc_register
c_func
(paren
id|adap
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_goto
id|out_unlock
suffix:semicolon
id|adapters
(braket
id|i
)braket
op_assign
id|adap
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adap-&gt;list
)paren
suffix:semicolon
multiline_comment|/* inform drivers of new adapters */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|drivers
(braket
id|j
)braket
op_ne
l_int|NULL
op_logical_and
(paren
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|flags
op_amp
(paren
id|I2C_DF_NOTIFY
op_or
id|I2C_DF_DUMMY
)paren
)paren
)paren
multiline_comment|/* We ignore the return code; if it fails, too bad */
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: adapter %s registered as adapter %d.&bslash;n&quot;
comma
id|adap-&gt;name
comma
id|i
)paren
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
suffix:semicolon
)brace
DECL|function|i2c_del_adapter
r_int
id|i2c_del_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|res
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adap
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_ADAP_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2c-core.o: unregister_adapter adap [%s] not found.&bslash;n&quot;
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
multiline_comment|/* DUMMY drivers do not register their clients, so we have to&n;&t; * use a trick here: we call driver-&gt;attach_adapter to&n;&t; * *detach* it! Of course, each dummy driver should know about&n;&t; * this or hell will break loose...&n;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|drivers
(braket
id|j
)braket
op_logical_and
(paren
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|flags
op_amp
id|I2C_DF_DUMMY
)paren
)paren
r_if
c_cond
(paren
(paren
id|res
op_assign
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2c-core.o: can&squot;t detach adapter %s &quot;
l_string|&quot;while detaching driver %s: driver not &quot;
l_string|&quot;detached!&quot;
comma
id|adap-&gt;name
comma
id|drivers
(braket
id|j
)braket
op_member_access_from_pointer
id|name
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
multiline_comment|/* detach any active clients. This must be done first, because&n;&t; * it can fail; in which case we give upp. */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|adap-&gt;clients
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|client
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* detaching devices is unconditional of the set notify&n;&t;&t;     * flag, as _all_ clients that reside on the adapter&n;&t;&t;     * must be deleted, as this would cause invalid states.&n;&t;&t;     */
r_if
c_cond
(paren
(paren
id|res
op_assign
id|client-&gt;driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: adapter %s not &quot;
l_string|&quot;unregistered, because client at &quot;
l_string|&quot;address %02x can&squot;t be detached. &quot;
comma
id|adap-&gt;name
comma
id|client-&gt;addr
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
)brace
id|i2cproc_remove
c_func
(paren
id|i
)paren
suffix:semicolon
id|adapters
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: adapter unregistered: %s&bslash;n&quot;
comma
id|adap-&gt;name
)paren
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* -----&n; * What follows is the &quot;upwards&quot; interface: commands for talking to clients,&n; * which implement the functions to access the physical information of the&n; * chips.&n; */
DECL|function|i2c_add_driver
r_int
id|i2c_add_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_int
id|res
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|drivers
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_DRIVER_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: register_driver(%s) &quot;
l_string|&quot;- enlarge I2C_DRIVER_MAX.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
id|drivers
(braket
id|i
)braket
op_assign
id|driver
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: driver %s registered.&bslash;n&quot;
comma
id|driver-&gt;name
)paren
)paren
suffix:semicolon
multiline_comment|/* now look for instances of driver on our adapters&n;&t; */
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
(paren
id|I2C_DF_NOTIFY
op_or
id|I2C_DF_DUMMY
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
multiline_comment|/* Ignore errors */
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adapters
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_del_driver
r_int
id|i2c_del_driver
c_func
(paren
r_struct
id|i2c_driver
op_star
id|driver
)paren
(brace
r_int
id|res
op_assign
l_int|0
comma
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_DRIVER_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|driver
op_eq
id|drivers
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_DRIVER_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: unregister_driver: &quot;
l_string|&quot;[%s] not found&bslash;n&quot;
comma
id|driver-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
multiline_comment|/* Have a look at each adapter, if clients of this driver are still&n;&t; * attached. If so, detach them to be able to kill the driver &n;&t; * afterwards.&n;&t; */
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: unregister_driver - looking for clients.&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* removing clients does not depend on the notify flag, else &n;&t; * invalid operation might (will!) result, when using stale client&n;&t; * pointers.&n;&t; */
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|k
op_increment
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|adapters
(braket
id|k
)braket
suffix:semicolon
r_if
c_cond
(paren
id|adap
op_eq
l_int|NULL
)paren
multiline_comment|/* skip empty entries. */
r_continue
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: examining adapter %s:&bslash;n&quot;
comma
id|adap-&gt;name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver-&gt;flags
op_amp
id|I2C_DF_DUMMY
)paren
(brace
multiline_comment|/* DUMMY drivers do not register their clients, so we have to&n;&t;&t; * use a trick here: we call driver-&gt;attach_adapter to&n;&t;&t; * *detach* it! Of course, each dummy driver should know about&n;&t;&t; * this or hell will break loose...  &n;&t;&t; */
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|attach_adapter
c_func
(paren
id|adap
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;i2c-core.o: while unregistering &quot;
l_string|&quot;dummy driver %s, adapter %s could &quot;
l_string|&quot;not be detached properly; driver &quot;
l_string|&quot;not unloaded!&quot;
comma
id|driver-&gt;name
comma
id|adap-&gt;name
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
op_assign
id|adap-&gt;clients
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|client
op_ne
l_int|NULL
op_logical_and
id|client-&gt;driver
op_eq
id|driver
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: &quot;
l_string|&quot;detaching client %s:&bslash;n&quot;
comma
id|client-&gt;name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|driver
op_member_access_from_pointer
id|detach_client
c_func
(paren
id|client
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: while &quot;
l_string|&quot;unregistering driver &quot;
l_string|&quot;`%s&squot;, the client at &quot;
l_string|&quot;address %02x of &quot;
l_string|&quot;adapter `%s&squot; could not &quot;
l_string|&quot;be detached; driver &quot;
l_string|&quot;not unloaded!&quot;
comma
id|driver-&gt;name
comma
id|client-&gt;addr
comma
id|adap-&gt;name
)paren
suffix:semicolon
r_goto
id|out_unlock
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|drivers
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: driver unregistered: %s&bslash;n&quot;
comma
id|driver-&gt;name
)paren
)paren
suffix:semicolon
id|out_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__i2c_check_addr
r_static
r_int
id|__i2c_check_addr
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapter-&gt;clients
(braket
id|i
)braket
op_logical_and
(paren
id|adapter-&gt;clients
(braket
id|i
)braket
op_member_access_from_pointer
id|addr
op_eq
id|addr
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_check_addr
r_int
id|i2c_check_addr
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|addr
)paren
(brace
r_int
id|rval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
id|rval
op_assign
id|__i2c_check_addr
c_func
(paren
id|adapter
comma
id|addr
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
DECL|function|i2c_attach_client
r_int
id|i2c_attach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
r_int
id|res
op_assign
op_minus
id|EBUSY
comma
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__i2c_check_addr
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
)paren
)paren
r_goto
id|out_unlock_list
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
l_int|NULL
op_eq
id|adapter-&gt;clients
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|I2C_CLIENT_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: attach_client(%s) - enlarge I2C_CLIENT_MAX.&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
id|res
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_unlock_list
suffix:semicolon
)brace
id|adapter-&gt;clients
(braket
id|i
)braket
op_assign
id|client
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;client_register
)paren
r_if
c_cond
(paren
id|adapter
op_member_access_from_pointer
id|client_register
c_func
(paren
id|client
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: warning: client_register seems &quot;
l_string|&quot;to have failed for client %02x at adapter %s&bslash;n&quot;
comma
id|client-&gt;addr
comma
id|adapter-&gt;name
)paren
suffix:semicolon
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: client [%s] registered to adapter [%s](pos. %d).&bslash;n&quot;
comma
id|client-&gt;name
comma
id|adapter-&gt;name
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
id|client-&gt;usage_count
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|out_unlock_list
suffix:colon
id|up
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|i2c_detach_client
r_int
id|i2c_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adapter
op_assign
id|client-&gt;adapter
suffix:semicolon
r_int
id|res
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
op_logical_and
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;client_unregister
)paren
(brace
id|res
op_assign
id|adapter
op_member_access_from_pointer
id|client_unregister
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: client_unregister [%s] failed, &quot;
l_string|&quot;client not detached&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
)brace
id|down
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|client
op_eq
id|adapter-&gt;clients
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I2C_CLIENT_MAX
op_eq
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: unregister_client &quot;
l_string|&quot;[%s] not found&bslash;n&quot;
comma
id|client-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_else
id|adapter-&gt;clients
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_inc_use_client
r_static
r_int
id|i2c_inc_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|client-&gt;adapter-&gt;owner
)paren
)paren
(brace
id|module_put
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_dec_use_client
r_static
r_void
id|i2c_dec_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
id|module_put
c_func
(paren
id|client-&gt;driver-&gt;owner
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|client-&gt;adapter-&gt;owner
)paren
suffix:semicolon
)brace
DECL|function|i2c_use_client
r_int
id|i2c_use_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|i2c_inc_use_client
c_func
(paren
id|client
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_MULTIPLE_USE
)paren
id|client-&gt;usage_count
op_increment
suffix:semicolon
r_else
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
r_goto
id|busy
suffix:semicolon
r_else
id|client-&gt;usage_count
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|busy
suffix:colon
id|i2c_dec_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|i2c_release_client
r_int
id|i2c_release_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;flags
op_amp
id|I2C_CLIENT_ALLOW_USE
)paren
(brace
r_if
c_cond
(paren
id|client-&gt;usage_count
OG
l_int|0
)paren
(brace
id|client-&gt;usage_count
op_decrement
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot; i2c-core.o: dec_use_client used one too many times&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
id|i2c_dec_use_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------&n; * The /proc functions&n; * ----------------------------------------------------&n; */
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/* This function generates the output for /proc/bus/i2c */
DECL|function|read_bus_i2c
r_static
r_int
id|read_bus_i2c
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
op_star
id|eof
comma
r_void
op_star
r_private
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|nr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Note that it is safe to write a `little&squot; beyond len. Yes, really. */
multiline_comment|/* Fuck you.  Will convert this to seq_file later.  --hch */
id|down
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|I2C_ADAP_MAX
)paren
op_logical_and
(paren
id|nr
OL
id|len
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
)paren
(brace
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;i2c-%d&bslash;t&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;smbus_xfer
)paren
(brace
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;master_xfer
)paren
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;smbus/i2c&quot;
)paren
suffix:semicolon
r_else
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;smbus    &quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;master_xfer
)paren
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;i2c       &quot;
)paren
suffix:semicolon
r_else
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;dummy     &quot;
)paren
suffix:semicolon
id|nr
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|nr
comma
l_string|&quot;&bslash;t%-32s&bslash;t%-32s&bslash;n&quot;
comma
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|name
comma
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|algo-&gt;name
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|core_lists
)paren
suffix:semicolon
r_return
id|nr
suffix:semicolon
)brace
multiline_comment|/* This function generates the output for /proc/bus/i2c-? */
DECL|function|i2cproc_bus_read
r_static
id|ssize_t
id|i2cproc_bus_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_char
op_star
id|kbuf
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
comma
id|order_nr
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|len_total
suffix:semicolon
r_int
id|order
(braket
id|I2C_CLIENT_MAX
)braket
suffix:semicolon
DECL|macro|OUTPUT_LENGTH_PER_LINE
mdefine_line|#define OUTPUT_LENGTH_PER_LINE 70
id|len_total
op_assign
id|file-&gt;f_pos
op_plus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len_total
OG
(paren
id|I2C_CLIENT_MAX
op_star
id|OUTPUT_LENGTH_PER_LINE
)paren
)paren
multiline_comment|/* adjust to maximum file size */
id|len_total
op_assign
(paren
id|I2C_CLIENT_MAX
op_star
id|OUTPUT_LENGTH_PER_LINE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|inode
op_eq
id|inode-&gt;i_ino
)paren
(brace
multiline_comment|/* We need a bit of slack in the kernel buffer; this makes the&n;&t;&t;   sprintf safe. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|kbuf
op_assign
id|kmalloc
c_func
(paren
id|len_total
op_plus
id|OUTPUT_LENGTH_PER_LINE
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Order will hold the indexes of the clients&n;&t;&t;&t;   sorted by address */
id|order_nr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|I2C_CLIENT_MAX
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|client
op_assign
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|j
)braket
)paren
op_logical_and
(paren
id|client-&gt;driver-&gt;id
op_ne
id|I2C_DRIVERID_I2CDEV
)paren
)paren
(brace
r_for
c_loop
(paren
id|k
op_assign
id|order_nr
suffix:semicolon
(paren
id|k
OG
l_int|0
)paren
op_logical_and
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|order
(braket
id|k
op_minus
l_int|1
)braket
)braket
op_member_access_from_pointer
id|addr
OG
id|client-&gt;addr
suffix:semicolon
id|k
op_decrement
)paren
(brace
id|order
(braket
id|k
)braket
op_assign
id|order
(braket
id|k
op_minus
l_int|1
)braket
suffix:semicolon
)brace
id|order
(braket
id|k
)braket
op_assign
id|j
suffix:semicolon
id|order_nr
op_increment
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
(paren
id|j
OL
id|order_nr
)paren
op_logical_and
(paren
id|len
OL
id|len_total
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|client
op_assign
id|adapters
(braket
id|i
)braket
op_member_access_from_pointer
id|clients
(braket
id|order
(braket
id|j
)braket
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|kbuf
op_plus
id|len
comma
l_string|&quot;%02x&bslash;t%-32s&bslash;t%-32s&bslash;n&quot;
comma
id|client-&gt;addr
comma
id|client-&gt;name
comma
id|client-&gt;driver-&gt;name
)paren
suffix:semicolon
)brace
id|len
op_assign
id|len
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|count
)paren
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
(paren
id|buf
comma
id|kbuf
op_plus
id|file-&gt;f_pos
comma
id|len
)paren
)paren
(brace
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
id|len
suffix:semicolon
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|variable|i2cproc_operations
r_static
r_struct
id|file_operations
id|i2cproc_operations
op_assign
(brace
dot
id|read
op_assign
id|i2cproc_bus_read
comma
)brace
suffix:semicolon
DECL|function|i2cproc_register
r_static
r_int
id|i2cproc_register
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
id|bus
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|proc_entry
suffix:semicolon
r_char
id|name
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;i2c-%d&quot;
comma
id|bus
)paren
suffix:semicolon
id|proc_entry
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
l_int|0
comma
id|proc_bus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_entry
)paren
r_goto
id|fail
suffix:semicolon
id|proc_entry-&gt;proc_fops
op_assign
op_amp
id|i2cproc_operations
suffix:semicolon
id|proc_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|adap-&gt;inode
op_assign
id|proc_entry-&gt;low_ino
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: Could not create /proc/bus/%s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|i2cproc_remove
r_static
r_void
id|i2cproc_remove
c_func
(paren
r_int
id|bus
)paren
(brace
r_char
id|name
(braket
l_int|8
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;i2c-%d&quot;
comma
id|bus
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|name
comma
id|proc_bus
)paren
suffix:semicolon
)brace
DECL|function|i2cproc_init
r_static
r_int
id|__init
id|i2cproc_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|proc_bus_i2c
suffix:semicolon
id|proc_bus_i2c
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;i2c&quot;
comma
l_int|0
comma
id|proc_bus
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_bus_i2c
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: Could not create /proc/bus/i2c&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|proc_bus_i2c-&gt;read_proc
op_assign
op_amp
id|read_bus_i2c
suffix:semicolon
id|proc_bus_i2c-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2cproc_cleanup
r_static
r_void
id|__exit
id|i2cproc_cleanup
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;i2c&quot;
comma
id|proc_bus
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|i2cproc_init
r_static
r_int
id|__init
id|i2cproc_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2cproc_cleanup
r_static
r_void
id|__exit
id|i2cproc_cleanup
c_func
(paren
r_void
)paren
(brace
)brace
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/* match always succeeds, as we want the probe() to tell if we really accept this match */
DECL|function|i2c_device_match
r_static
r_int
id|i2c_device_match
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|i2c_bus_type
r_struct
id|bus_type
id|i2c_bus_type
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;i2c&quot;
comma
dot
id|match
op_assign
id|i2c_device_match
comma
)brace
suffix:semicolon
DECL|function|i2c_init
r_static
r_int
id|__init
id|i2c_init
c_func
(paren
r_void
)paren
(brace
id|bus_register
c_func
(paren
op_amp
id|i2c_bus_type
)paren
suffix:semicolon
r_return
id|i2cproc_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|i2c_exit
r_static
r_void
id|__exit
id|i2c_exit
c_func
(paren
r_void
)paren
(brace
id|i2cproc_cleanup
c_func
(paren
)paren
suffix:semicolon
id|bus_unregister
c_func
(paren
op_amp
id|i2c_bus_type
)paren
suffix:semicolon
)brace
DECL|variable|i2c_init
id|module_init
c_func
(paren
id|i2c_init
)paren
suffix:semicolon
DECL|variable|i2c_exit
id|module_exit
c_func
(paren
id|i2c_exit
)paren
suffix:semicolon
multiline_comment|/* ----------------------------------------------------&n; * the functional interface to the i2c busses.&n; * ----------------------------------------------------&n; */
DECL|function|i2c_transfer
r_int
id|i2c_transfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_struct
id|i2c_msg
id|msgs
(braket
)braket
comma
r_int
id|num
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;master_xfer
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: master_xfer: %s with %d msgs.&bslash;n&quot;
comma
id|adap-&gt;name
comma
id|num
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
id|msgs
comma
id|num
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|adap-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_send
r_int
id|i2c_master_send
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
(paren
r_const
r_char
op_star
)paren
id|msg.buf
op_assign
id|buf
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: master_send: writing %d bytes on %s.&bslash;n&quot;
comma
id|count
comma
id|client-&gt;adapter-&gt;name
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t;&t; * transmitted, else error code.&n;&t;&t; */
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|client-&gt;adapter-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_master_recv
r_int
id|i2c_master_recv
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|client-&gt;adapter-&gt;algo-&gt;master_xfer
)paren
(brace
id|msg.addr
op_assign
id|client-&gt;addr
suffix:semicolon
id|msg.flags
op_assign
id|client-&gt;flags
op_amp
id|I2C_M_TEN
suffix:semicolon
id|msg.flags
op_or_assign
id|I2C_M_RD
suffix:semicolon
id|msg.len
op_assign
id|count
suffix:semicolon
id|msg.buf
op_assign
id|buf
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: master_recv: reading %d bytes on %s.&bslash;n&quot;
comma
id|count
comma
id|client-&gt;adapter-&gt;name
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
id|adap
comma
op_amp
id|msg
comma
l_int|1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adap-&gt;bus
)paren
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: master_recv: return:%d (count:%d, addr:0x%02x)&bslash;n&quot;
comma
id|ret
comma
id|count
comma
id|client-&gt;addr
)paren
)paren
suffix:semicolon
multiline_comment|/* if everything went ok (i.e. 1 msg transmitted), return #bytes&n;&t; &t;* transmitted, else error code.&n;&t; &t;*/
r_return
(paren
id|ret
op_eq
l_int|1
)paren
ques
c_cond
id|count
suffix:colon
id|ret
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: I2C adapter %04x: I2C level transfers not supported&bslash;n&quot;
comma
id|client-&gt;adapter-&gt;id
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
)brace
DECL|function|i2c_control
r_int
id|i2c_control
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_struct
id|i2c_adapter
op_star
id|adap
op_assign
id|client-&gt;adapter
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: i2c ioctl, cmd: 0x%x, arg: %#lx&bslash;n&quot;
comma
id|cmd
comma
id|arg
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|I2C_RETRIES
suffix:colon
id|adap-&gt;retries
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_TIMEOUT
suffix:colon
id|adap-&gt;timeout
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;algo_control
op_ne
l_int|NULL
)paren
id|ret
op_assign
id|adap-&gt;algo
op_member_access_from_pointer
id|algo_control
c_func
(paren
id|adap
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------&n; * the i2c address scanning function&n; * Will not work for 10-bit addresses!&n; * ----------------------------------------------------&n; */
DECL|function|i2c_probe
r_int
id|i2c_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_struct
id|i2c_client_address_data
op_star
id|address_data
comma
id|i2c_client_found_addr_proc
op_star
id|found_proc
)paren
(brace
r_int
id|addr
comma
id|i
comma
id|found
comma
id|err
suffix:semicolon
r_int
id|adap_id
op_assign
id|i2c_adapter_id
c_func
(paren
id|adapter
)paren
suffix:semicolon
multiline_comment|/* Forget it if we can&squot;t probe using SMBUS_QUICK */
r_if
c_cond
(paren
op_logical_neg
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_QUICK
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|addr
op_assign
l_int|0x00
suffix:semicolon
id|addr
op_le
l_int|0x7f
suffix:semicolon
id|addr
op_increment
)paren
(brace
multiline_comment|/* Skip if already in use */
r_if
c_cond
(paren
id|i2c_check_addr
c_func
(paren
id|adapter
comma
id|addr
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* If it is in one of the force entries, we don&squot;t do any detection&n;&t;&t;   at all */
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;force
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;force
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;force
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found force parameter for adapter %d, addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* If this address is in one of the ignores, we can forget about&n;&t;&t;   it right now */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;ignore
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found ignore parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;ignore_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;ignore_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;ignore_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found ignore_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* Now, we will do a detection, but only if it is in the normal or &n;&t;&t;   probe entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|addr
op_eq
id|address_data-&gt;normal_i2c
(braket
id|i
)braket
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found normal i2c entry for adapter %d, &quot;
l_string|&quot;addr %02x&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_ge
id|address_data-&gt;normal_i2c_range
(braket
id|i
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;normal_i2c_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found normal i2c_range entry for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe
(braket
id|i
)braket
)paren
op_logical_or
(paren
(paren
id|address_data-&gt;probe
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
)paren
op_logical_and
(paren
id|addr
op_eq
id|address_data-&gt;probe
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found probe parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|found
op_logical_and
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_ne
id|I2C_CLIENT_END
)paren
suffix:semicolon
id|i
op_add_assign
l_int|3
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|adap_id
op_eq
id|address_data-&gt;probe_range
(braket
id|i
)braket
)paren
op_logical_or
(paren
id|address_data-&gt;probe_range
(braket
id|i
)braket
op_eq
id|ANY_I2C_BUS
)paren
)paren
op_logical_and
(paren
id|addr
op_ge
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|1
)braket
)paren
op_logical_and
(paren
id|addr
op_le
id|address_data-&gt;probe_range
(braket
id|i
op_plus
l_int|2
)braket
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
id|DEB2
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: found probe_range parameter for adapter %d, &quot;
l_string|&quot;addr %04x&bslash;n&quot;
comma
id|adap_id
comma
id|addr
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
r_continue
suffix:semicolon
multiline_comment|/* OK, so we really should examine this address. First check&n;&t;&t;   whether there is some client here at all! */
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
op_ge
l_int|0
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|found_proc
c_func
(paren
id|adapter
comma
id|addr
comma
l_int|0
comma
op_minus
l_int|1
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * return id number for a specific adapter&n; */
DECL|function|i2c_adapter_id
r_int
id|i2c_adapter_id
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_ADAP_MAX
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adap
op_eq
id|adapters
(braket
id|i
)braket
)paren
r_return
id|i
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* The SMBus parts */
DECL|macro|POLY
mdefine_line|#define POLY    (0x1070U &lt;&lt; 3) 
r_static
id|u8
DECL|function|crc8
id|crc8
c_func
(paren
id|u16
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|0x8000
)paren
id|data
op_assign
id|data
op_xor
id|POLY
suffix:semicolon
id|data
op_assign
id|data
op_lshift
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|u8
)paren
(paren
id|data
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* CRC over count bytes in the first array plus the bytes in the rest&n;   array if it is non-null. rest[0] is the (length of rest) - 1&n;   and is included. */
DECL|function|i2c_smbus_partial_pec
id|u8
id|i2c_smbus_partial_pec
c_func
(paren
id|u8
id|crc
comma
r_int
id|count
comma
id|u8
op_star
id|first
comma
id|u8
op_star
id|rest
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crc
op_assign
id|crc8
c_func
(paren
(paren
id|crc
op_xor
id|first
(braket
id|i
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rest
op_ne
l_int|NULL
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|rest
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|crc
op_assign
id|crc8
c_func
(paren
(paren
id|crc
op_xor
id|rest
(braket
id|i
)braket
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
DECL|function|i2c_smbus_pec
id|u8
id|i2c_smbus_pec
c_func
(paren
r_int
id|count
comma
id|u8
op_star
id|first
comma
id|u8
op_star
id|rest
)paren
(brace
r_return
id|i2c_smbus_partial_pec
c_func
(paren
l_int|0
comma
id|count
comma
id|first
comma
id|rest
)paren
suffix:semicolon
)brace
multiline_comment|/* Returns new &quot;size&quot; (transaction type)&n;   Note that we convert byte to byte_data and byte_data to word_data&n;   rather than invent new xxx_PEC transactions. */
DECL|function|i2c_smbus_add_pec
r_int
id|i2c_smbus_add_pec
c_func
(paren
id|u16
id|addr
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|u8
id|buf
(braket
l_int|3
)braket
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|addr
op_lshift
l_int|1
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|data-&gt;byte
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BYTE_DATA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|buf
(braket
l_int|2
)braket
op_assign
id|data-&gt;byte
suffix:semicolon
id|data-&gt;word
op_assign
id|buf
(braket
l_int|2
)braket
op_logical_or
(paren
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
l_int|NULL
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_WORD_DATA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
multiline_comment|/* unsupported */
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA
suffix:colon
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
DECL|function|i2c_smbus_check_pec
r_int
id|i2c_smbus_check_pec
c_func
(paren
id|u16
id|addr
comma
id|u8
id|command
comma
r_int
id|size
comma
id|u8
id|partial
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|u8
id|buf
(braket
l_int|3
)braket
comma
id|rpec
comma
id|cpec
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|2
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;byte
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;word
op_rshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA_PEC
suffix:colon
multiline_comment|/* unsupported */
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL_PEC
suffix:colon
multiline_comment|/* unsupported */
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|cpec
op_assign
id|i2c_smbus_pec
c_func
(paren
l_int|3
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|rpec
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:colon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|addr
op_lshift
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|rpec
op_assign
id|i2c_smbus_partial_pec
c_func
(paren
id|partial
comma
l_int|1
comma
id|buf
comma
id|data-&gt;block
)paren
suffix:semicolon
id|cpec
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cpec
op_assign
id|rpec
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpec
op_ne
id|cpec
)paren
(brace
id|DEB
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;i2c-core.o: Bad PEC 0x%02x vs. 0x%02x&bslash;n&quot;
comma
id|rpec
comma
id|cpec
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_quick
r_extern
id|s32
id|i2c_smbus_write_quick
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|value
comma
l_int|0
comma
id|I2C_SMBUS_QUICK
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte
r_extern
id|s32
id|i2c_smbus_read_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
l_int|0
comma
id|I2C_SMBUS_BYTE
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte
r_extern
id|s32
id|i2c_smbus_write_byte
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
multiline_comment|/* only for PEC */
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|value
comma
id|I2C_SMBUS_BYTE
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_byte_data
r_extern
id|s32
id|i2c_smbus_read_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FF
op_amp
id|data.byte
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_byte_data
r_extern
id|s32
id|i2c_smbus_write_byte_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.byte
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BYTE_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_read_word_data
r_extern
id|s32
id|i2c_smbus_read_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
DECL|function|i2c_smbus_write_word_data
r_extern
id|s32
id|i2c_smbus_write_word_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_WORD_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|i2c_smbus_process_call
r_extern
id|s32
id|i2c_smbus_process_call
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u16
id|value
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
id|data.word
op_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_PROC_CALL
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
r_return
l_int|0x0FFFF
op_amp
id|data.word
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_read_block_data
r_extern
id|s32
id|i2c_smbus_read_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
DECL|function|i2c_smbus_write_block_data
r_extern
id|s32
id|i2c_smbus_write_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_BLOCK_MAX
)paren
id|length
op_assign
id|I2C_SMBUS_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_block_process_call
r_extern
id|s32
id|i2c_smbus_block_process_call
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_BLOCK_MAX
op_minus
l_int|1
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_BLOCK_PROC_CALL
comma
op_amp
id|data
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
multiline_comment|/* Returns the number of read bytes */
DECL|function|i2c_smbus_read_i2c_block_data
r_extern
id|s32
id|i2c_smbus_read_i2c_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_READ
comma
id|command
comma
id|I2C_SMBUS_I2C_BLOCK_DATA
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|values
(braket
id|i
op_minus
l_int|1
)braket
op_assign
id|data.block
(braket
id|i
)braket
suffix:semicolon
r_return
id|data.block
(braket
l_int|0
)braket
suffix:semicolon
)brace
)brace
DECL|function|i2c_smbus_write_i2c_block_data
r_extern
id|s32
id|i2c_smbus_write_i2c_block_data
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
id|u8
id|command
comma
id|u8
id|length
comma
id|u8
op_star
id|values
)paren
(brace
r_union
id|i2c_smbus_data
id|data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
id|I2C_SMBUS_I2C_BLOCK_MAX
)paren
id|length
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|length
suffix:semicolon
id|i
op_increment
)paren
id|data.block
(braket
id|i
)braket
op_assign
id|values
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
id|data.block
(braket
l_int|0
)braket
op_assign
id|length
suffix:semicolon
r_return
id|i2c_smbus_xfer
c_func
(paren
id|client-&gt;adapter
comma
id|client-&gt;addr
comma
id|client-&gt;flags
comma
id|I2C_SMBUS_WRITE
comma
id|command
comma
id|I2C_SMBUS_I2C_BLOCK_DATA
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* Simulate a SMBus command using the i2c protocol &n;   No checking of parameters is done!  */
DECL|function|i2c_smbus_xfer_emulated
r_static
id|s32
id|i2c_smbus_xfer_emulated
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
multiline_comment|/* So we need to generate a series of msgs. In the case of writing, we&n;&t;  need to use only one message; when reading, we need two. We initialize&n;&t;  most things with sane defaults, to keep the code below somewhat&n;&t;  simpler. */
r_int
r_char
id|msgbuf0
(braket
l_int|34
)braket
suffix:semicolon
r_int
r_char
id|msgbuf1
(braket
l_int|34
)braket
suffix:semicolon
r_int
id|num
op_assign
id|read_write
op_eq
id|I2C_SMBUS_READ
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|addr
comma
id|flags
comma
l_int|1
comma
id|msgbuf0
)brace
comma
(brace
id|addr
comma
id|flags
op_or
id|I2C_M_RD
comma
l_int|0
comma
id|msgbuf1
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|msgbuf0
(braket
l_int|0
)braket
op_assign
id|command
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_QUICK
suffix:colon
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Special case: The read/write field is used as data */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|flags
op_or
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
ques
c_cond
id|I2C_M_RD
suffix:colon
l_int|0
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
multiline_comment|/* Special case: only a read! */
id|msg
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|I2C_M_RD
op_or
id|flags
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|1
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;byte
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|num
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* Special case */
id|read_write
op_assign
id|I2C_SMBUS_READ
suffix:semicolon
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|3
suffix:semicolon
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|2
suffix:semicolon
id|msgbuf0
(braket
l_int|1
)braket
op_assign
id|data-&gt;word
op_amp
l_int|0xff
suffix:semicolon
id|msgbuf0
(braket
l_int|2
)braket
op_assign
(paren
id|data-&gt;word
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_DATA
suffix:colon
r_case
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: Block read not supported &quot;
l_string|&quot;under I2C emulation!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
OG
id|I2C_SMBUS_BLOCK_MAX
op_plus
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: smbus_access called with &quot;
l_string|&quot;invalid block write size (%d)&bslash;n&quot;
comma
id|data-&gt;block
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BLOCK_DATA_PEC
)paren
(brace
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
)paren
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|msg
(braket
l_int|0
)braket
dot
id|len
suffix:semicolon
id|i
op_increment
)paren
id|msgbuf0
(braket
id|i
)braket
op_assign
id|data-&gt;block
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL
suffix:colon
r_case
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: Block process call not supported &quot;
l_string|&quot;under I2C emulation!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
r_case
id|I2C_SMBUS_I2C_BLOCK_DATA
suffix:colon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
(brace
id|msg
(braket
l_int|1
)braket
dot
id|len
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
)brace
r_else
(brace
id|msg
(braket
l_int|0
)braket
dot
id|len
op_assign
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg
(braket
l_int|0
)braket
dot
id|len
OG
id|I2C_SMBUS_I2C_BLOCK_MAX
op_plus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;i2c-core.o: i2c_smbus_xfer_emulated called with &quot;
l_string|&quot;invalid block write size (%d)&bslash;n&quot;
comma
id|data-&gt;block
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|data-&gt;block
(braket
l_int|0
)braket
suffix:semicolon
id|i
op_increment
)paren
id|msgbuf0
(braket
id|i
)braket
op_assign
id|data-&gt;block
(braket
id|i
)braket
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;i2c-core.o: smbus_access called with invalid size (%d)&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
id|adapter
comma
id|msg
comma
id|num
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
)paren
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf0
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|data-&gt;byte
op_assign
id|msgbuf1
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
id|data-&gt;word
op_assign
id|msgbuf1
(braket
l_int|0
)braket
op_or
(paren
id|msgbuf1
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_I2C_BLOCK_DATA
suffix:colon
multiline_comment|/* fixed at 32 for now */
id|data-&gt;block
(braket
l_int|0
)braket
op_assign
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|I2C_SMBUS_I2C_BLOCK_MAX
suffix:semicolon
id|i
op_increment
)paren
id|data-&gt;block
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|msgbuf1
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_smbus_xfer
id|s32
id|i2c_smbus_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
id|s32
id|res
suffix:semicolon
r_int
id|swpec
op_assign
l_int|0
suffix:semicolon
id|u8
id|partial
op_assign
l_int|0
suffix:semicolon
id|flags
op_and_assign
id|I2C_M_TEN
op_or
id|I2C_CLIENT_PEC
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|I2C_CLIENT_PEC
)paren
op_logical_and
op_logical_neg
(paren
id|i2c_check_functionality
c_func
(paren
id|adapter
comma
id|I2C_FUNC_SMBUS_HWPEC_CALC
)paren
)paren
)paren
(brace
id|swpec
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
op_logical_and
id|size
op_eq
id|I2C_SMBUS_BLOCK_DATA
)paren
(brace
id|size
op_assign
id|I2C_SMBUS_BLOCK_DATA_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_PROC_CALL
)paren
(brace
id|size
op_assign
id|I2C_SMBUS_PROC_CALL_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|size
op_eq
id|I2C_SMBUS_BLOCK_PROC_CALL
)paren
(brace
id|i2c_smbus_add_pec
c_func
(paren
id|addr
comma
id|command
comma
id|I2C_SMBUS_BLOCK_DATA
comma
id|data
)paren
suffix:semicolon
id|partial
op_assign
id|data-&gt;block
(braket
id|data-&gt;block
(braket
l_int|0
)braket
op_plus
l_int|1
)braket
suffix:semicolon
id|size
op_assign
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
op_logical_and
id|size
op_ne
id|I2C_SMBUS_QUICK
op_logical_and
id|size
op_ne
id|I2C_SMBUS_I2C_BLOCK_DATA
)paren
(brace
id|size
op_assign
id|i2c_smbus_add_pec
c_func
(paren
id|addr
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|adapter-&gt;algo-&gt;smbus_xfer
)paren
(brace
id|down
c_func
(paren
op_amp
id|adapter-&gt;bus
)paren
suffix:semicolon
id|res
op_assign
id|adapter-&gt;algo
op_member_access_from_pointer
id|smbus_xfer
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|adapter-&gt;bus
)paren
suffix:semicolon
)brace
r_else
id|res
op_assign
id|i2c_smbus_xfer_emulated
c_func
(paren
id|adapter
comma
id|addr
comma
id|flags
comma
id|read_write
comma
id|command
comma
id|size
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_ge
l_int|0
op_logical_and
id|swpec
op_logical_and
id|size
op_ne
id|I2C_SMBUS_QUICK
op_logical_and
id|size
op_ne
id|I2C_SMBUS_I2C_BLOCK_DATA
op_logical_and
(paren
id|read_write
op_eq
id|I2C_SMBUS_READ
op_logical_or
id|size
op_eq
id|I2C_SMBUS_PROC_CALL_PEC
op_logical_or
id|size
op_eq
id|I2C_SMBUS_BLOCK_PROC_CALL_PEC
)paren
)paren
(brace
r_if
c_cond
(paren
id|i2c_smbus_check_pec
c_func
(paren
id|addr
comma
id|command
comma
id|size
comma
id|partial
comma
id|data
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* You should always define `functionality&squot;; the &squot;else&squot; is just for&n;   backward compatibility. */
DECL|function|i2c_get_functionality
id|u32
id|i2c_get_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
id|adap-&gt;algo-&gt;functionality
)paren
r_return
id|adap-&gt;algo
op_member_access_from_pointer
id|functionality
c_func
(paren
id|adap
)paren
suffix:semicolon
r_else
r_return
l_int|0xffffffff
suffix:semicolon
)brace
DECL|function|i2c_check_functionality
r_int
id|i2c_check_functionality
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
id|u32
id|func
)paren
(brace
id|u32
id|adap_func
op_assign
id|i2c_get_functionality
(paren
id|adap
)paren
suffix:semicolon
r_return
(paren
id|func
op_amp
id|adap_func
)paren
op_eq
id|func
suffix:semicolon
)brace
DECL|variable|i2c_add_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_adapter
)paren
suffix:semicolon
DECL|variable|i2c_del_adapter
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_adapter
)paren
suffix:semicolon
DECL|variable|i2c_add_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_add_driver
)paren
suffix:semicolon
DECL|variable|i2c_del_driver
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_del_driver
)paren
suffix:semicolon
DECL|variable|i2c_attach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_attach_client
)paren
suffix:semicolon
DECL|variable|i2c_detach_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_detach_client
)paren
suffix:semicolon
DECL|variable|i2c_use_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_use_client
)paren
suffix:semicolon
DECL|variable|i2c_release_client
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_release_client
)paren
suffix:semicolon
DECL|variable|i2c_check_addr
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_addr
)paren
suffix:semicolon
DECL|variable|i2c_master_send
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_send
)paren
suffix:semicolon
DECL|variable|i2c_master_recv
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_master_recv
)paren
suffix:semicolon
DECL|variable|i2c_control
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_control
)paren
suffix:semicolon
DECL|variable|i2c_transfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_transfer
)paren
suffix:semicolon
DECL|variable|i2c_adapter_id
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_adapter_id
)paren
suffix:semicolon
DECL|variable|i2c_probe
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_probe
)paren
suffix:semicolon
DECL|variable|i2c_smbus_xfer
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_xfer
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_quick
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_quick
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_byte_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_byte_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_word_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_word_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_process_call
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_process_call
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_read_i2c_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_read_i2c_block_data
)paren
suffix:semicolon
DECL|variable|i2c_smbus_write_i2c_block_data
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_smbus_write_i2c_block_data
)paren
suffix:semicolon
DECL|variable|i2c_get_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_get_functionality
)paren
suffix:semicolon
DECL|variable|i2c_check_functionality
id|EXPORT_SYMBOL
c_func
(paren
id|i2c_check_functionality
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Simon G. Vogl &lt;simon@tk.uni-linz.ac.at&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;I2C-Bus main module&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|i2c_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|i2c_debug
comma
l_string|&quot;debug level&quot;
)paren
suffix:semicolon
eof
