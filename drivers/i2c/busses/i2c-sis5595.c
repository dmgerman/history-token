multiline_comment|/*&n;    sis5595.c - Part of lm_sensors, Linux kernel modules for hardware&n;              monitoring&n;    Copyright (c) 1998, 1999  Frodo Looijaard &lt;frodol@dds.nl&gt; and&n;    Philip Edelbrock &lt;phil@netroedge.com&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
multiline_comment|/* Note: we assume there can only be one SIS5595 with one SMBus interface */
multiline_comment|/*&n;   Note: all have mfr. ID 0x1039.&n;   SUPPORTED&t;&t;PCI ID&t;&t;&n;&t;5595&t;&t;0008&n;&n;   Note: these chips contain a 0008 device which is incompatible with the&n;         5595. We recognize these by the presence of the listed&n;         &quot;blacklist&quot; PCI ID and refuse to load.&n;&n;   NOT SUPPORTED&t;PCI ID&t;&t;BLACKLIST PCI ID&t;&n;&t; 540&t;&t;0008&t;&t;0540&n;&t; 550&t;&t;0008&t;&t;0550&n;&t;5513&t;&t;0008&t;&t;5511&n;&t;5581&t;&t;0008&t;&t;5597&n;&t;5582&t;&t;0008&t;&t;5597&n;&t;5597&t;&t;0008&t;&t;5597&n;&t;5598&t;&t;0008&t;&t;5597/5598&n;&t; 630&t;&t;0008&t;&t;0630&n;&t; 645&t;&t;0008&t;&t;0645&n;&t; 646&t;&t;0008&t;&t;0646&n;&t; 648&t;&t;0008&t;&t;0648&n;&t; 650&t;&t;0008&t;&t;0650&n;&t; 651&t;&t;0008&t;&t;0651&n;&t; 730&t;&t;0008&t;&t;0730&n;&t; 735&t;&t;0008&t;&t;0735&n;&t; 745&t;&t;0008&t;&t;0745&n;&t; 746&t;&t;0008&t;&t;0746&n;*/
multiline_comment|/* TO DO: &n; * Add Block Transfers (ugly, but supported by the adapter)&n; * Add adapter resets&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|variable|blacklist
r_static
r_int
id|blacklist
(braket
)braket
op_assign
(brace
id|PCI_DEVICE_ID_SI_540
comma
id|PCI_DEVICE_ID_SI_550
comma
id|PCI_DEVICE_ID_SI_630
comma
id|PCI_DEVICE_ID_SI_645
comma
id|PCI_DEVICE_ID_SI_646
comma
id|PCI_DEVICE_ID_SI_648
comma
id|PCI_DEVICE_ID_SI_650
comma
id|PCI_DEVICE_ID_SI_651
comma
id|PCI_DEVICE_ID_SI_730
comma
id|PCI_DEVICE_ID_SI_735
comma
id|PCI_DEVICE_ID_SI_745
comma
id|PCI_DEVICE_ID_SI_746
comma
id|PCI_DEVICE_ID_SI_5511
comma
multiline_comment|/* 5513 chip has the 0008 device but that ID&n;&t;&t;&t;&t;   shows up in other chips so we use the 5511&n;&t;&t;&t;&t;   ID for recognition */
id|PCI_DEVICE_ID_SI_5597
comma
id|PCI_DEVICE_ID_SI_5598
comma
l_int|0
comma
multiline_comment|/* terminates the list */
)brace
suffix:semicolon
multiline_comment|/* Length of ISA address segment */
DECL|macro|SIS5595_EXTENT
mdefine_line|#define SIS5595_EXTENT&t;&t;8
multiline_comment|/* SIS5595 SMBus registers */
DECL|macro|SMB_STS_LO
mdefine_line|#define SMB_STS_LO&t;&t;0x00
DECL|macro|SMB_STS_HI
mdefine_line|#define SMB_STS_HI&t;&t;0x01
DECL|macro|SMB_CTL_LO
mdefine_line|#define SMB_CTL_LO&t;&t;0x02
DECL|macro|SMB_CTL_HI
mdefine_line|#define SMB_CTL_HI&t;&t;0x03
DECL|macro|SMB_ADDR
mdefine_line|#define SMB_ADDR&t;&t;0x04
DECL|macro|SMB_CMD
mdefine_line|#define SMB_CMD&t;&t;&t;0x05
DECL|macro|SMB_PCNT
mdefine_line|#define SMB_PCNT&t;&t;0x06
DECL|macro|SMB_CNT
mdefine_line|#define SMB_CNT&t;&t;&t;0x07
DECL|macro|SMB_BYTE
mdefine_line|#define SMB_BYTE&t;&t;0x08
DECL|macro|SMB_DEV
mdefine_line|#define SMB_DEV&t;&t;&t;0x10
DECL|macro|SMB_DB0
mdefine_line|#define SMB_DB0&t;&t;&t;0x11
DECL|macro|SMB_DB1
mdefine_line|#define SMB_DB1&t;&t;&t;0x12
DECL|macro|SMB_HAA
mdefine_line|#define SMB_HAA&t;&t;&t;0x13
multiline_comment|/* PCI Address Constants */
DECL|macro|SMB_INDEX
mdefine_line|#define SMB_INDEX&t;&t;0x38
DECL|macro|SMB_DAT
mdefine_line|#define SMB_DAT&t;&t;&t;0x39
DECL|macro|SIS5595_ENABLE_REG
mdefine_line|#define SIS5595_ENABLE_REG&t;0x40
DECL|macro|ACPI_BASE
mdefine_line|#define ACPI_BASE&t;&t;0x90
multiline_comment|/* Other settings */
DECL|macro|MAX_TIMEOUT
mdefine_line|#define MAX_TIMEOUT&t;&t;500
multiline_comment|/* SIS5595 constants */
DECL|macro|SIS5595_QUICK
mdefine_line|#define SIS5595_QUICK&t;&t;0x00
DECL|macro|SIS5595_BYTE
mdefine_line|#define SIS5595_BYTE&t;&t;0x02
DECL|macro|SIS5595_BYTE_DATA
mdefine_line|#define SIS5595_BYTE_DATA&t;0x04
DECL|macro|SIS5595_WORD_DATA
mdefine_line|#define SIS5595_WORD_DATA&t;0x06
DECL|macro|SIS5595_PROC_CALL
mdefine_line|#define SIS5595_PROC_CALL&t;0x08
DECL|macro|SIS5595_BLOCK_DATA
mdefine_line|#define SIS5595_BLOCK_DATA&t;0x0A
multiline_comment|/* insmod parameters */
multiline_comment|/* If force_addr is set to anything different from 0, we forcibly enable&n;   the device at the given address. */
DECL|variable|force_addr
r_static
id|u16
id|force_addr
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|force_addr
comma
id|ushort
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|force_addr
comma
l_string|&quot;Initialize the base address of the i2c controller&quot;
)paren
suffix:semicolon
DECL|variable|sis5595_base
r_static
r_int
r_int
id|sis5595_base
op_assign
l_int|0
suffix:semicolon
DECL|function|sis5595_read
r_static
id|u8
id|sis5595_read
c_func
(paren
id|u8
id|reg
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|sis5595_base
op_plus
id|SMB_INDEX
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|sis5595_base
op_plus
id|SMB_DAT
)paren
suffix:semicolon
)brace
DECL|function|sis5595_write
r_static
r_void
id|sis5595_write
c_func
(paren
id|u8
id|reg
comma
id|u8
id|data
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|sis5595_base
op_plus
id|SMB_INDEX
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|sis5595_base
op_plus
id|SMB_DAT
)paren
suffix:semicolon
)brace
DECL|function|sis5595_setup
r_static
r_int
id|sis5595_setup
c_func
(paren
r_struct
id|pci_dev
op_star
id|SIS5595_dev
)paren
(brace
id|u16
id|a
suffix:semicolon
id|u8
id|val
suffix:semicolon
r_int
op_star
id|i
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Look for imposters */
r_for
c_loop
(paren
id|i
op_assign
id|blacklist
suffix:semicolon
op_star
id|i
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|dev
op_assign
id|pci_get_device
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
op_star
id|i
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;Looked for SIS5595 but found unsupported device %.4x&bslash;n&quot;
comma
op_star
id|i
)paren
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
multiline_comment|/* Determine the address of the SMBus areas */
id|pci_read_config_word
c_func
(paren
id|SIS5595_dev
comma
id|ACPI_BASE
comma
op_amp
id|sis5595_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis5595_base
op_eq
l_int|0
op_logical_and
id|force_addr
op_eq
l_int|0
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;ACPI base address uninitialized - upgrade BIOS or use force_addr=0xaddr&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
id|sis5595_base
op_assign
id|force_addr
op_amp
op_complement
(paren
id|SIS5595_EXTENT
op_minus
l_int|1
)paren
suffix:semicolon
id|dev_dbg
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;ACPI Base address: %04x&bslash;n&quot;
comma
id|sis5595_base
)paren
suffix:semicolon
multiline_comment|/* NB: We grab just the two SMBus registers here, but this may still&n;&t; * interfere with ACPI :-(  */
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|sis5595_base
op_plus
id|SMB_INDEX
comma
l_int|2
comma
l_string|&quot;sis5595-smbus&quot;
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;SMBus registers 0x%04x-0x%04x already in use!&bslash;n&quot;
comma
id|sis5595_base
op_plus
id|SMB_INDEX
comma
id|sis5595_base
op_plus
id|SMB_INDEX
op_plus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_addr
)paren
(brace
id|dev_info
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;forcing ISA address 0x%04X&bslash;n&quot;
comma
id|sis5595_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_word
c_func
(paren
id|SIS5595_dev
comma
id|ACPI_BASE
comma
id|sis5595_base
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|SIS5595_dev
comma
id|ACPI_BASE
comma
op_amp
id|a
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|a
op_amp
op_complement
(paren
id|SIS5595_EXTENT
op_minus
l_int|1
)paren
)paren
op_ne
id|sis5595_base
)paren
(brace
multiline_comment|/* doesn&squot;t work for some chips! */
id|dev_err
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;force address failed - not supported?&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|SIS5595_dev
comma
id|SIS5595_ENABLE_REG
comma
op_amp
id|val
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|dev_info
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;enabling ACPI&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_byte
c_func
(paren
id|SIS5595_dev
comma
id|SIS5595_ENABLE_REG
comma
id|val
op_or
l_int|0x80
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|SIS5595_dev
comma
id|SIS5595_ENABLE_REG
comma
op_amp
id|val
)paren
op_ne
id|PCIBIOS_SUCCESSFUL
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* doesn&squot;t work for some chips? */
id|dev_err
c_func
(paren
op_amp
id|SIS5595_dev-&gt;dev
comma
l_string|&quot;ACPI enable failed - not supported?&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
)brace
multiline_comment|/* Everything is happy */
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|release_region
c_func
(paren
id|sis5595_base
op_plus
id|SMB_INDEX
comma
l_int|2
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|sis5595_transaction
r_static
r_int
id|sis5595_transaction
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_int
id|temp
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|timeout
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Make sure the SMBus host is ready to start transmitting */
id|temp
op_assign
id|sis5595_read
c_func
(paren
id|SMB_STS_LO
)paren
op_plus
(paren
id|sis5595_read
c_func
(paren
id|SMB_STS_HI
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|0x00
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;SMBus busy (%04x). Resetting... &bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_STS_LO
comma
id|temp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_STS_HI
comma
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_assign
id|sis5595_read
c_func
(paren
id|SMB_STS_LO
)paren
op_plus
(paren
id|sis5595_read
c_func
(paren
id|SMB_STS_HI
)paren
op_lshift
l_int|8
)paren
)paren
op_ne
l_int|0x00
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;Failed! (%02x)&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;Successfull!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* start the transaction by setting bit 4 */
id|sis5595_write
c_func
(paren
id|SMB_CTL_LO
comma
id|sis5595_read
c_func
(paren
id|SMB_CTL_LO
)paren
op_or
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* We will always wait for a fraction of a second! */
r_do
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
id|sis5595_read
c_func
(paren
id|SMB_STS_LO
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|temp
op_amp
l_int|0x40
)paren
op_logical_and
(paren
id|timeout
op_increment
OL
id|MAX_TIMEOUT
)paren
)paren
suffix:semicolon
multiline_comment|/* If the SMBus is still busy, we give up */
r_if
c_cond
(paren
id|timeout
op_ge
id|MAX_TIMEOUT
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;SMBus Timeout!&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x10
)paren
(brace
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;Error: Failed bus transaction&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x20
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;Bus collision! SMBus may be locked until &quot;
l_string|&quot;next hard reset (or not...)&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Clock stops and slave is stuck in mid-transmission */
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|temp
op_assign
id|sis5595_read
c_func
(paren
id|SMB_STS_LO
)paren
op_plus
(paren
id|sis5595_read
c_func
(paren
id|SMB_STS_HI
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|0x00
)paren
(brace
id|sis5595_write
c_func
(paren
id|SMB_STS_LO
comma
id|temp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_STS_HI
comma
id|temp
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
id|temp
op_assign
id|sis5595_read
c_func
(paren
id|SMB_STS_LO
)paren
op_plus
(paren
id|sis5595_read
c_func
(paren
id|SMB_STS_HI
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
l_int|0x00
)paren
id|dev_dbg
c_func
(paren
op_amp
id|adap-&gt;dev
comma
l_string|&quot;Failed reset at end of transaction (%02x)&bslash;n&quot;
comma
id|temp
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* Return -1 on error. */
DECL|function|sis5595_access
r_static
id|s32
id|sis5595_access
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
id|u16
id|addr
comma
r_int
r_int
id|flags
comma
r_char
id|read_write
comma
id|u8
id|command
comma
r_int
id|size
comma
r_union
id|i2c_smbus_data
op_star
id|data
)paren
(brace
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|I2C_SMBUS_QUICK
suffix:colon
id|sis5595_write
c_func
(paren
id|SMB_ADDR
comma
(paren
(paren
id|addr
op_amp
l_int|0x7f
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|read_write
op_amp
l_int|0x01
)paren
)paren
suffix:semicolon
id|size
op_assign
id|SIS5595_QUICK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE
suffix:colon
id|sis5595_write
c_func
(paren
id|SMB_ADDR
comma
(paren
(paren
id|addr
op_amp
l_int|0x7f
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|read_write
op_amp
l_int|0x01
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
id|sis5595_write
c_func
(paren
id|SMB_CMD
comma
id|command
)paren
suffix:semicolon
id|size
op_assign
id|SIS5595_BYTE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_BYTE_DATA
suffix:colon
id|sis5595_write
c_func
(paren
id|SMB_ADDR
comma
(paren
(paren
id|addr
op_amp
l_int|0x7f
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|read_write
op_amp
l_int|0x01
)paren
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_CMD
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
id|sis5595_write
c_func
(paren
id|SMB_BYTE
comma
id|data-&gt;byte
)paren
suffix:semicolon
id|size
op_assign
id|SIS5595_BYTE_DATA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_SMBUS_PROC_CALL
suffix:colon
r_case
id|I2C_SMBUS_WORD_DATA
suffix:colon
id|sis5595_write
c_func
(paren
id|SMB_ADDR
comma
(paren
(paren
id|addr
op_amp
l_int|0x7f
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|read_write
op_amp
l_int|0x01
)paren
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_CMD
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
(brace
id|sis5595_write
c_func
(paren
id|SMB_BYTE
comma
id|data-&gt;word
op_amp
l_int|0xff
)paren
suffix:semicolon
id|sis5595_write
c_func
(paren
id|SMB_BYTE
op_plus
l_int|1
comma
(paren
id|data-&gt;word
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
id|size
op_assign
(paren
id|size
op_eq
id|I2C_SMBUS_PROC_CALL
)paren
ques
c_cond
id|SIS5595_PROC_CALL
suffix:colon
id|SIS5595_WORD_DATA
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/*&n;&t;case I2C_SMBUS_BLOCK_DATA:&n;&t;&t;printk(KERN_WARNING &quot;sis5595.o: Block data not yet implemented!&bslash;n&quot;);&n;&t;&t;return -1;&n;&t;&t;break;&n;*/
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;sis5595.o: Unsupported transaction %d&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|sis5595_write
c_func
(paren
id|SMB_CTL_LO
comma
(paren
(paren
id|size
op_amp
l_int|0x0E
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sis5595_transaction
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|size
op_ne
id|SIS5595_PROC_CALL
)paren
op_logical_and
(paren
(paren
id|read_write
op_eq
id|I2C_SMBUS_WRITE
)paren
op_logical_or
(paren
id|size
op_eq
id|SIS5595_QUICK
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
id|SIS5595_BYTE
suffix:colon
multiline_comment|/* Where is the result put? I assume here it is in&n;&t;&t;&t;&t;   SMB_DATA but it might just as well be in the&n;&t;&t;&t;&t;   SMB_CMD. No clue in the docs */
r_case
id|SIS5595_BYTE_DATA
suffix:colon
id|data-&gt;byte
op_assign
id|sis5595_read
c_func
(paren
id|SMB_BYTE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIS5595_WORD_DATA
suffix:colon
r_case
id|SIS5595_PROC_CALL
suffix:colon
id|data-&gt;word
op_assign
id|sis5595_read
c_func
(paren
id|SMB_BYTE
)paren
op_plus
(paren
id|sis5595_read
c_func
(paren
id|SMB_BYTE
op_plus
l_int|1
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sis5595_func
r_static
id|u32
id|sis5595_func
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_return
id|I2C_FUNC_SMBUS_QUICK
op_or
id|I2C_FUNC_SMBUS_BYTE
op_or
id|I2C_FUNC_SMBUS_BYTE_DATA
op_or
id|I2C_FUNC_SMBUS_WORD_DATA
op_or
id|I2C_FUNC_SMBUS_PROC_CALL
suffix:semicolon
)brace
DECL|variable|smbus_algorithm
r_static
r_struct
id|i2c_algorithm
id|smbus_algorithm
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Non-I2C SMBus adapter&quot;
comma
dot
id|id
op_assign
id|I2C_ALGO_SMBUS
comma
dot
id|smbus_xfer
op_assign
id|sis5595_access
comma
dot
id|functionality
op_assign
id|sis5595_func
comma
)brace
suffix:semicolon
DECL|variable|sis5595_adapter
r_static
r_struct
id|i2c_adapter
id|sis5595_adapter
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
r_class
op_assign
id|I2C_CLASS_HWMON
comma
dot
id|name
op_assign
l_string|&quot;unset&quot;
comma
dot
id|algo
op_assign
op_amp
id|smbus_algorithm
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|sis5595_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_DEVICE
c_func
(paren
id|PCI_VENDOR_ID_SI
comma
id|PCI_DEVICE_ID_SI_503
)paren
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
(paren
id|pci
comma
id|sis5595_ids
)paren
suffix:semicolon
DECL|function|sis5595_probe
r_static
r_int
id|__devinit
id|sis5595_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_if
c_cond
(paren
id|sis5595_setup
c_func
(paren
id|dev
)paren
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|dev-&gt;dev
comma
l_string|&quot;SIS5595 not detected, module not inserted.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* set up the driverfs linkage to our parent device */
id|sis5595_adapter.dev.parent
op_assign
op_amp
id|dev-&gt;dev
suffix:semicolon
id|sprintf
c_func
(paren
id|sis5595_adapter.name
comma
l_string|&quot;SMBus SIS5595 adapter at %04x&quot;
comma
id|sis5595_base
op_plus
id|SMB_INDEX
)paren
suffix:semicolon
r_return
id|i2c_add_adapter
c_func
(paren
op_amp
id|sis5595_adapter
)paren
suffix:semicolon
)brace
DECL|function|sis5595_remove
r_static
r_void
id|__devexit
id|sis5595_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|i2c_del_adapter
c_func
(paren
op_amp
id|sis5595_adapter
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|sis5595_base
op_plus
id|SMB_INDEX
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|variable|sis5595_driver
r_static
r_struct
id|pci_driver
id|sis5595_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sis5595_smbus&quot;
comma
dot
id|id_table
op_assign
id|sis5595_ids
comma
dot
id|probe
op_assign
id|sis5595_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|sis5595_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|i2c_sis5595_init
r_static
r_int
id|__init
id|i2c_sis5595_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_register_driver
c_func
(paren
op_amp
id|sis5595_driver
)paren
suffix:semicolon
)brace
DECL|function|i2c_sis5595_exit
r_static
r_void
id|__exit
id|i2c_sis5595_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|sis5595_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Frodo Looijaard &lt;frodol@dds.nl&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SIS5595 SMBus driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|i2c_sis5595_init
id|module_init
c_func
(paren
id|i2c_sis5595_init
)paren
suffix:semicolon
DECL|variable|i2c_sis5595_exit
id|module_exit
c_func
(paren
id|i2c_sis5595_exit
)paren
suffix:semicolon
eof
