multiline_comment|/*&n; * i2c-au1550.c: SMBus (i2c) adapter for Alchemy PSC interface&n; * Copyright (C) 2004 Embedded Edge, LLC &lt;dan@embeddededge.com&gt;&n; *&n; * 2.6 port by Matt Porter &lt;mporter@kernel.crashing.org&gt;&n; *&n; * The documentation describes this as an SMBus controller, but it doesn&squot;t&n; * understand any of the SMBus protocol in hardware.  It&squot;s really an I2C&n; * controller that could emulate most of the SMBus in software.&n; *&n; * This is just a skeleton adapter to use with the Au1550 PSC&n; * algorithm.  It was developed for the Pb1550, but will work with&n; * any Au1550 board that has a similar PSC configuration.&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;asm/mach-au1x00/au1000.h&gt;
macro_line|#include &lt;asm/mach-pb1x00/pb1550.h&gt;
macro_line|#include &lt;asm/mach-au1x00/au1xxx_psc.h&gt;
macro_line|#include &quot;i2c-au1550.h&quot;
r_static
r_int
DECL|function|wait_xfer_done
id|wait_xfer_done
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
)paren
(brace
id|u32
id|stat
suffix:semicolon
r_int
id|i
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
multiline_comment|/* Wait for Tx FIFO Underflow.&n;&t;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adap-&gt;xfer_timeout
suffix:semicolon
id|i
op_increment
)paren
(brace
id|stat
op_assign
id|sp-&gt;psc_smbevnt
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|PSC_SMBEVNT_TU
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* Clear it.  */
id|sp-&gt;psc_smbevnt
op_assign
id|PSC_SMBEVNT_TU
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
r_static
r_int
DECL|function|wait_ack
id|wait_ack
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
)paren
(brace
id|u32
id|stat
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|wait_xfer_done
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
id|stat
op_assign
id|sp-&gt;psc_smbevnt
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
(paren
id|PSC_SMBEVNT_DN
op_or
id|PSC_SMBEVNT_AN
op_or
id|PSC_SMBEVNT_AL
)paren
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|wait_master_done
id|wait_master_done
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
)paren
(brace
id|u32
id|stat
suffix:semicolon
r_int
id|i
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
multiline_comment|/* Wait for Master Done.&n;&t;*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adap-&gt;xfer_timeout
suffix:semicolon
id|i
op_increment
)paren
(brace
id|stat
op_assign
id|sp-&gt;psc_smbevnt
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|PSC_SMBEVNT_MD
)paren
op_ne
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
r_static
r_int
DECL|function|do_address
id|do_address
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
comma
r_int
r_int
id|addr
comma
r_int
id|rd
)paren
(brace
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
id|u32
id|stat
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
multiline_comment|/* Reset the FIFOs, clear events.&n;&t;*/
id|sp-&gt;psc_smbpcr
op_assign
id|PSC_SMBPCR_DC
suffix:semicolon
id|sp-&gt;psc_smbevnt
op_assign
id|PSC_SMBEVNT_ALLCLR
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
id|stat
op_assign
id|sp-&gt;psc_smbpcr
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|stat
op_amp
id|PSC_SMBPCR_DC
)paren
op_ne
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Write out the i2c chip address and specify operation&n;&t;*/
id|addr
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rd
)paren
id|addr
op_or_assign
l_int|1
suffix:semicolon
multiline_comment|/* Put byte into fifo, start up master.&n;&t;*/
id|sp-&gt;psc_smbtxrx
op_assign
id|addr
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|sp-&gt;psc_smbpcr
op_assign
id|PSC_SMBPCR_MS
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_ack
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|u32
DECL|function|wait_for_rx_byte
id|wait_for_rx_byte
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
comma
id|u32
op_star
id|ret_data
)paren
(brace
r_int
id|j
suffix:semicolon
id|u32
id|data
comma
id|stat
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|wait_xfer_done
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
id|j
op_assign
id|adap-&gt;xfer_timeout
op_star
l_int|100
suffix:semicolon
r_do
(brace
id|j
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|j
op_le
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|stat
op_assign
id|sp-&gt;psc_smbstat
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|PSC_SMBSTAT_RE
)paren
op_eq
l_int|0
)paren
id|j
op_assign
l_int|0
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|j
OG
l_int|0
)paren
suffix:semicolon
id|data
op_assign
id|sp-&gt;psc_smbtxrx
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
op_star
id|ret_data
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|i2c_read
id|i2c_read
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
comma
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|data
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* A read is performed by stuffing the transmit fifo with&n;&t; * zero bytes for timing, waiting for bytes to appear in the&n;&t; * receive fifo, then reading the bytes.&n;&t; */
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
(paren
id|len
op_minus
l_int|1
)paren
)paren
(brace
id|sp-&gt;psc_smbtxrx
op_assign
l_int|0
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_for_rx_byte
c_func
(paren
id|adap
comma
op_amp
id|data
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|buf
(braket
id|i
)braket
op_assign
id|data
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
multiline_comment|/* The last byte has to indicate transfer done.&n;&t;*/
id|sp-&gt;psc_smbtxrx
op_assign
id|PSC_SMBTXRX_STP
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_master_done
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|data
op_assign
id|sp-&gt;psc_smbtxrx
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|buf
(braket
id|i
)braket
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|i2c_write
id|i2c_write
c_func
(paren
r_struct
id|i2c_au1550_data
op_star
id|adap
comma
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|data
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
(paren
id|len
op_minus
l_int|1
)paren
)paren
(brace
id|data
op_assign
id|buf
(braket
id|i
)braket
suffix:semicolon
id|sp-&gt;psc_smbtxrx
op_assign
id|data
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_ack
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
multiline_comment|/* The last byte has to indicate transfer done.&n;&t;*/
id|data
op_assign
id|buf
(braket
id|i
)braket
suffix:semicolon
id|data
op_or_assign
id|PSC_SMBTXRX_STP
suffix:semicolon
id|sp-&gt;psc_smbtxrx
op_assign
id|data
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait_master_done
c_func
(paren
id|adap
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|au1550_xfer
id|au1550_xfer
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|i2c_adap
comma
r_struct
id|i2c_msg
id|msgs
(braket
)braket
comma
r_int
id|num
)paren
(brace
r_struct
id|i2c_au1550_data
op_star
id|adap
op_assign
id|i2c_adap-&gt;algo_data
suffix:semicolon
r_struct
id|i2c_msg
op_star
id|p
suffix:semicolon
r_int
id|i
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
op_logical_neg
id|err
op_logical_and
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p
op_assign
op_amp
id|msgs
(braket
id|i
)braket
suffix:semicolon
id|err
op_assign
id|do_address
c_func
(paren
id|adap
comma
id|p-&gt;addr
comma
id|p-&gt;flags
op_amp
id|I2C_M_RD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_or
op_logical_neg
id|p-&gt;len
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|I2C_M_RD
)paren
id|err
op_assign
id|i2c_read
c_func
(paren
id|adap
comma
id|p-&gt;buf
comma
id|p-&gt;len
)paren
suffix:semicolon
r_else
id|err
op_assign
id|i2c_write
c_func
(paren
id|adap
comma
id|p-&gt;buf
comma
id|p-&gt;len
)paren
suffix:semicolon
)brace
multiline_comment|/* Return the number of messages processed, or the error code.&n;&t;*/
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
id|err
op_assign
id|num
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
id|u32
DECL|function|au1550_func
id|au1550_func
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_return
id|I2C_FUNC_I2C
suffix:semicolon
)brace
DECL|variable|au1550_algo
r_static
r_struct
id|i2c_algorithm
id|au1550_algo
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Au1550 algorithm&quot;
comma
dot
id|id
op_assign
id|I2C_ALGO_AU1550
comma
dot
id|master_xfer
op_assign
id|au1550_xfer
comma
dot
id|functionality
op_assign
id|au1550_func
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * registering functions to load algorithms at runtime&n; * Prior to calling us, the 50MHz clock frequency and routing&n; * must have been set up for the PSC indicated by the adapter.&n; */
r_int
DECL|function|i2c_au1550_add_bus
id|i2c_au1550_add_bus
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|i2c_adap
)paren
(brace
r_struct
id|i2c_au1550_data
op_star
id|adap
op_assign
id|i2c_adap-&gt;algo_data
suffix:semicolon
r_volatile
id|psc_smb_t
op_star
id|sp
suffix:semicolon
id|u32
id|stat
suffix:semicolon
id|i2c_adap-&gt;algo
op_assign
op_amp
id|au1550_algo
suffix:semicolon
multiline_comment|/* Now, set up the PSC for SMBus PIO mode.&n;&t;*/
id|sp
op_assign
(paren
r_volatile
id|psc_smb_t
op_star
)paren
(paren
id|adap-&gt;psc_base
)paren
suffix:semicolon
id|sp-&gt;psc_ctrl
op_assign
id|PSC_CTRL_DISABLE
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|sp-&gt;psc_sel
op_assign
id|PSC_SEL_PS_SMBUSMODE
suffix:semicolon
id|sp-&gt;psc_smbcfg
op_assign
l_int|0
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|sp-&gt;psc_ctrl
op_assign
id|PSC_CTRL_ENABLE
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
r_do
(brace
id|stat
op_assign
id|sp-&gt;psc_smbstat
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|stat
op_amp
id|PSC_SMBSTAT_SR
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|sp-&gt;psc_smbcfg
op_assign
(paren
id|PSC_SMBCFG_RT_FIFO8
op_or
id|PSC_SMBCFG_TT_FIFO8
op_or
id|PSC_SMBCFG_DD_DISABLE
)paren
suffix:semicolon
multiline_comment|/* Divide by 8 to get a 6.25 MHz clock.  The later protocol&n;&t; * timings are based on this clock.&n;&t; */
id|sp-&gt;psc_smbcfg
op_or_assign
id|PSC_SMBCFG_SET_DIV
c_func
(paren
id|PSC_SMBCFG_DIV8
)paren
suffix:semicolon
id|sp-&gt;psc_smbmsk
op_assign
id|PSC_SMBMSK_ALLMASK
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set the protocol timer values.  See Table 71 in the&n;&t; * Au1550 Data Book for standard timing values.&n;&t; */
id|sp-&gt;psc_smbtmr
op_assign
id|PSC_SMBTMR_SET_TH
c_func
(paren
l_int|0
)paren
op_or
id|PSC_SMBTMR_SET_PS
c_func
(paren
l_int|15
)paren
op_or
"&bslash;"
id|PSC_SMBTMR_SET_PU
c_func
(paren
l_int|15
)paren
op_or
id|PSC_SMBTMR_SET_SH
c_func
(paren
l_int|15
)paren
op_or
"&bslash;"
id|PSC_SMBTMR_SET_SU
c_func
(paren
l_int|15
)paren
op_or
id|PSC_SMBTMR_SET_CL
c_func
(paren
l_int|15
)paren
op_or
"&bslash;"
id|PSC_SMBTMR_SET_CH
c_func
(paren
l_int|15
)paren
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
id|sp-&gt;psc_smbcfg
op_or_assign
id|PSC_SMBCFG_DE_ENABLE
suffix:semicolon
r_do
(brace
id|stat
op_assign
id|sp-&gt;psc_smbstat
suffix:semicolon
id|au_sync
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|stat
op_amp
id|PSC_SMBSTAT_DR
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_return
id|i2c_add_adapter
c_func
(paren
id|i2c_adap
)paren
suffix:semicolon
)brace
r_int
DECL|function|i2c_au1550_del_bus
id|i2c_au1550_del_bus
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_return
id|i2c_del_adapter
c_func
(paren
id|adap
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|pb1550_reg
id|pb1550_reg
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|pb1550_unreg
id|pb1550_unreg
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pb1550_i2c_info
r_static
r_struct
id|i2c_au1550_data
id|pb1550_i2c_info
op_assign
(brace
id|SMBUS_PSC_BASE
comma
l_int|200
comma
l_int|200
)brace
suffix:semicolon
DECL|variable|pb1550_board_adapter
r_static
r_struct
id|i2c_adapter
id|pb1550_board_adapter
op_assign
(brace
id|name
suffix:colon
l_string|&quot;pb1550 adapter&quot;
comma
id|id
suffix:colon
id|I2C_HW_AU1550_PSC
comma
id|algo
suffix:colon
l_int|NULL
comma
id|algo_data
suffix:colon
op_amp
id|pb1550_i2c_info
comma
id|client_register
suffix:colon
id|pb1550_reg
comma
id|client_unregister
suffix:colon
id|pb1550_unreg
comma
)brace
suffix:semicolon
multiline_comment|/* BIG hack to support the control interface on the Wolfson WM8731&n; * audio codec on the Pb1550 board.  We get an address and two data&n; * bytes to write, create an i2c message, and send it across the&n; * i2c transfer function.  We do this here because we have access to&n; * the i2c adapter structure.&n; */
DECL|variable|wm_i2c_msg
r_static
r_struct
id|i2c_msg
id|wm_i2c_msg
suffix:semicolon
multiline_comment|/* We don&squot;t want this stuff on the stack */
DECL|variable|i2cbuf
r_static
id|u8
id|i2cbuf
(braket
l_int|2
)braket
suffix:semicolon
r_int
DECL|function|pb1550_wm_codec_write
id|pb1550_wm_codec_write
c_func
(paren
id|u8
id|addr
comma
id|u8
id|reg
comma
id|u8
id|val
)paren
(brace
id|wm_i2c_msg.addr
op_assign
id|addr
suffix:semicolon
id|wm_i2c_msg.flags
op_assign
l_int|0
suffix:semicolon
id|wm_i2c_msg.buf
op_assign
id|i2cbuf
suffix:semicolon
id|wm_i2c_msg.len
op_assign
l_int|2
suffix:semicolon
id|i2cbuf
(braket
l_int|0
)braket
op_assign
id|reg
suffix:semicolon
id|i2cbuf
(braket
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_return
id|pb1550_board_adapter.algo
op_member_access_from_pointer
id|master_xfer
c_func
(paren
op_amp
id|pb1550_board_adapter
comma
op_amp
id|wm_i2c_msg
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|i2c_au1550_init
id|i2c_au1550_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Au1550 I2C: &quot;
)paren
suffix:semicolon
multiline_comment|/* This is where we would set up a 50MHz clock source&n;&t; * and routing.  On the Pb1550, the SMBus is PSC2, which&n;&t; * uses a shared clock with USB.  This has been already&n;&t; * configured by Yamon as a 48MHz clock, close enough&n;&t; * for our work.&n;&t; */
r_if
c_cond
(paren
id|i2c_au1550_add_bus
c_func
(paren
op_amp
id|pb1550_board_adapter
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;failed to initialize.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;initialized.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|i2c_au1550_exit
id|i2c_au1550_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_au1550_del_bus
c_func
(paren
op_amp
id|pb1550_board_adapter
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Dan Malek, Embedded Edge, LLC.&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SMBus adapter Alchemy pb1550&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|i2c_au1550_init
id|module_init
(paren
id|i2c_au1550_init
)paren
suffix:semicolon
DECL|variable|i2c_au1550_exit
id|module_exit
(paren
id|i2c_au1550_exit
)paren
suffix:semicolon
eof
