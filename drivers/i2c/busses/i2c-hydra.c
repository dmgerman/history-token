multiline_comment|/*&n;    i2c-hydra.c - Part of lm_sensors,  Linux kernel modules&n;                  for hardware monitoring&n;&n;    i2c Support for the Apple `Hydra&squot; Mac I/O&n;&n;    Copyright (c) 1999-2004 Geert Uytterhoeven &lt;geert@linux-m68k.org&gt;&n;&n;    Based on i2c Support for Via Technologies 82C586B South Bridge&n;    Copyright (c) 1998, 1999 Ky&#xfffd;sti M&#xfffd;lkki &lt;kmalkki@cc.hut.fi&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-algo-bit.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hydra.h&gt;
DECL|macro|HYDRA_CPD_PD0
mdefine_line|#define HYDRA_CPD_PD0&t;0x00000001&t;/* CachePD lines */
DECL|macro|HYDRA_CPD_PD1
mdefine_line|#define HYDRA_CPD_PD1&t;0x00000002
DECL|macro|HYDRA_CPD_PD2
mdefine_line|#define HYDRA_CPD_PD2&t;0x00000004
DECL|macro|HYDRA_CPD_PD3
mdefine_line|#define HYDRA_CPD_PD3&t;0x00000008
DECL|macro|HYDRA_SCLK
mdefine_line|#define HYDRA_SCLK&t;HYDRA_CPD_PD0
DECL|macro|HYDRA_SDAT
mdefine_line|#define HYDRA_SDAT&t;HYDRA_CPD_PD1
DECL|macro|HYDRA_SCLK_OE
mdefine_line|#define HYDRA_SCLK_OE&t;0x00000010
DECL|macro|HYDRA_SDAT_OE
mdefine_line|#define HYDRA_SDAT_OE&t;0x00000020
DECL|function|pdregw
r_static
r_inline
r_void
id|pdregw
c_func
(paren
r_void
op_star
id|data
comma
id|u32
id|val
)paren
(brace
r_struct
id|Hydra
op_star
id|hydra
op_assign
(paren
r_struct
id|Hydra
op_star
)paren
id|data
suffix:semicolon
id|writel
c_func
(paren
id|val
comma
op_amp
id|hydra-&gt;CachePD
)paren
suffix:semicolon
)brace
DECL|function|pdregr
r_static
r_inline
id|u32
id|pdregr
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|Hydra
op_star
id|hydra
op_assign
(paren
r_struct
id|Hydra
op_star
)paren
id|data
suffix:semicolon
r_return
id|readl
c_func
(paren
op_amp
id|hydra-&gt;CachePD
)paren
suffix:semicolon
)brace
DECL|function|hydra_bit_setscl
r_static
r_void
id|hydra_bit_setscl
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
id|u32
id|val
op_assign
id|pdregr
c_func
(paren
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|val
op_and_assign
op_complement
id|HYDRA_SCLK_OE
suffix:semicolon
r_else
(brace
id|val
op_and_assign
op_complement
id|HYDRA_SCLK
suffix:semicolon
id|val
op_or_assign
id|HYDRA_SCLK_OE
suffix:semicolon
)brace
id|pdregw
c_func
(paren
id|data
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|hydra_bit_setsda
r_static
r_void
id|hydra_bit_setsda
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
id|u32
id|val
op_assign
id|pdregr
c_func
(paren
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|val
op_and_assign
op_complement
id|HYDRA_SDAT_OE
suffix:semicolon
r_else
(brace
id|val
op_and_assign
op_complement
id|HYDRA_SDAT
suffix:semicolon
id|val
op_or_assign
id|HYDRA_SDAT_OE
suffix:semicolon
)brace
id|pdregw
c_func
(paren
id|data
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|hydra_bit_getscl
r_static
r_int
id|hydra_bit_getscl
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_return
(paren
id|pdregr
c_func
(paren
id|data
)paren
op_amp
id|HYDRA_SCLK
)paren
op_ne
l_int|0
suffix:semicolon
)brace
DECL|function|hydra_bit_getsda
r_static
r_int
id|hydra_bit_getsda
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_return
(paren
id|pdregr
c_func
(paren
id|data
)paren
op_amp
id|HYDRA_SDAT
)paren
op_ne
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------ */
DECL|variable|hydra_bit_data
r_static
r_struct
id|i2c_algo_bit_data
id|hydra_bit_data
op_assign
(brace
dot
id|setsda
op_assign
id|hydra_bit_setsda
comma
dot
id|setscl
op_assign
id|hydra_bit_setscl
comma
dot
id|getsda
op_assign
id|hydra_bit_getsda
comma
dot
id|getscl
op_assign
id|hydra_bit_getscl
comma
dot
id|udelay
op_assign
l_int|5
comma
dot
id|mdelay
op_assign
l_int|5
comma
dot
id|timeout
op_assign
id|HZ
)brace
suffix:semicolon
DECL|variable|hydra_adap
r_static
r_struct
id|i2c_adapter
id|hydra_adap
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;Hydra i2c&quot;
comma
dot
id|id
op_assign
id|I2C_HW_B_HYDRA
comma
dot
id|algo_data
op_assign
op_amp
id|hydra_bit_data
comma
)brace
suffix:semicolon
DECL|variable|hydra_ids
r_static
r_struct
id|pci_device_id
id|hydra_ids
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_APPLE
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_APPLE_HYDRA
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|function|hydra_probe
r_static
r_int
id|__devinit
id|hydra_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_int
r_int
id|base
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|base
op_plus
m_offsetof
(paren
r_struct
id|Hydra
comma
id|CachePD
)paren
comma
l_int|4
comma
id|hydra_adap.name
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|hydra_bit_data.data
op_assign
id|ioremap
c_func
(paren
id|base
comma
id|pci_resource_len
c_func
(paren
id|dev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hydra_bit_data.data
op_eq
l_int|NULL
)paren
(brace
id|release_mem_region
c_func
(paren
id|base
op_plus
m_offsetof
(paren
r_struct
id|Hydra
comma
id|CachePD
)paren
comma
l_int|4
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pdregw
c_func
(paren
id|hydra_bit_data.data
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clear SCLK_OE and SDAT_OE */
id|hydra_adap.dev.parent
op_assign
op_amp
id|dev-&gt;dev
suffix:semicolon
id|res
op_assign
id|i2c_bit_add_bus
c_func
(paren
op_amp
id|hydra_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
id|iounmap
c_func
(paren
id|hydra_bit_data.data
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|base
op_plus
m_offsetof
(paren
r_struct
id|Hydra
comma
id|CachePD
)paren
comma
l_int|4
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hydra_remove
r_static
r_void
id|__devexit
id|hydra_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|pdregw
c_func
(paren
id|hydra_bit_data.data
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clear SCLK_OE and SDAT_OE */
id|i2c_bit_del_bus
c_func
(paren
op_amp
id|hydra_adap
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|hydra_bit_data.data
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|0
)paren
op_plus
m_offsetof
(paren
r_struct
id|Hydra
comma
id|CachePD
)paren
comma
l_int|4
)paren
suffix:semicolon
)brace
DECL|variable|hydra_driver
r_static
r_struct
id|pci_driver
id|hydra_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;hydra smbus&quot;
comma
dot
id|id_table
op_assign
id|hydra_ids
comma
dot
id|probe
op_assign
id|hydra_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|hydra_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|i2c_hydra_init
r_static
r_int
id|__init
id|i2c_hydra_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|hydra_driver
)paren
suffix:semicolon
)brace
DECL|function|i2c_hydra_exit
r_static
r_void
id|__exit
id|i2c_hydra_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|hydra_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Geert Uytterhoeven &lt;geert@linux-m68k.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;i2c for Apple Hydra Mac I/O&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|i2c_hydra_init
id|module_init
c_func
(paren
id|i2c_hydra_init
)paren
suffix:semicolon
DECL|variable|i2c_hydra_exit
id|module_exit
c_func
(paren
id|i2c_hydra_exit
)paren
suffix:semicolon
eof
