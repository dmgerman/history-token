multiline_comment|/*&n; * EISA bus support functions for sysfs.&n; *&n; * (C) 2002, 2003 Marc Zyngier &lt;maz@wild-wind.fr.eu.org&gt;&n; *&n; * This code is released under the GPL version 2.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/eisa.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|SLOT_ADDRESS
mdefine_line|#define SLOT_ADDRESS(r,n) (r-&gt;bus_base_addr + (0x1000 * n))
DECL|macro|EISA_DEVINFO
mdefine_line|#define EISA_DEVINFO(i,s) { .id = { .sig = i }, .name = s }
DECL|struct|eisa_device_info
r_struct
id|eisa_device_info
(brace
DECL|member|id
r_struct
id|eisa_device_id
id|id
suffix:semicolon
DECL|member|name
r_char
id|name
(braket
id|DEVICE_NAME_SIZE
)braket
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_EISA_NAMES
DECL|variable|eisa_table
r_static
r_struct
id|eisa_device_info
id|__initdata
id|eisa_table
(braket
)braket
op_assign
(brace
macro_line|#include &quot;devlist.h&quot;
)brace
suffix:semicolon
DECL|macro|EISA_INFOS
mdefine_line|#define EISA_INFOS (sizeof (eisa_table) / (sizeof (struct eisa_device_info)))
macro_line|#endif
DECL|macro|EISA_MAX_FORCED_DEV
mdefine_line|#define EISA_MAX_FORCED_DEV 16
DECL|macro|EISA_FORCED_OFFSET
mdefine_line|#define EISA_FORCED_OFFSET  2
DECL|variable|enable_dev
r_static
r_int
id|enable_dev
(braket
id|EISA_MAX_FORCED_DEV
op_plus
id|EISA_FORCED_OFFSET
)braket
op_assign
(brace
l_int|1
comma
id|EISA_MAX_FORCED_DEV
comma
)brace
suffix:semicolon
DECL|variable|disable_dev
r_static
r_int
id|disable_dev
(braket
id|EISA_MAX_FORCED_DEV
op_plus
id|EISA_FORCED_OFFSET
)braket
op_assign
(brace
l_int|1
comma
id|EISA_MAX_FORCED_DEV
comma
)brace
suffix:semicolon
DECL|function|is_forced_dev
r_static
r_int
id|is_forced_dev
(paren
r_int
op_star
id|forced_tab
comma
r_struct
id|eisa_root_device
op_star
id|root
comma
r_struct
id|eisa_device
op_star
id|edev
)paren
(brace
r_int
id|i
comma
id|x
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EISA_MAX_FORCED_DEV
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|forced_tab
(braket
id|EISA_FORCED_OFFSET
op_plus
id|i
)braket
)paren
r_return
l_int|0
suffix:semicolon
id|x
op_assign
(paren
id|root-&gt;bus_nr
op_lshift
l_int|8
)paren
op_or
id|edev-&gt;slot
suffix:semicolon
r_if
c_cond
(paren
id|forced_tab
(braket
id|EISA_FORCED_OFFSET
op_plus
id|i
)braket
op_eq
id|x
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eisa_name_device
r_static
r_void
id|__init
id|eisa_name_device
(paren
r_struct
id|eisa_device
op_star
id|edev
)paren
(brace
macro_line|#ifdef CONFIG_EISA_NAMES
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EISA_INFOS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|edev-&gt;id.sig
comma
id|eisa_table
(braket
id|i
)braket
dot
id|id.sig
)paren
)paren
(brace
id|strlcpy
(paren
id|edev-&gt;pretty_name
comma
id|eisa_table
(braket
id|i
)braket
dot
id|name
comma
id|DEVICE_NAME_SIZE
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* No name was found */
id|sprintf
(paren
id|edev-&gt;pretty_name
comma
l_string|&quot;EISA device %.7s&quot;
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|decode_eisa_sig
r_static
r_char
id|__init
op_star
id|decode_eisa_sig
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
r_static
r_char
id|sig_str
(braket
id|EISA_SIG_LEN
)braket
suffix:semicolon
id|u8
id|sig
(braket
l_int|4
)braket
suffix:semicolon
id|u16
id|rev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef CONFIG_EISA_VLB_PRIMING
multiline_comment|/*&n;&t;&t; * This ugly stuff is used to wake up VL-bus cards&n;&t;&t; * (AHA-284x is the only known example), so we can&n;&t;&t; * read the EISA id.&n;&t;&t; *&n;&t;&t; * Thankfully, this only exists on x86...&n;&t;&t; */
id|outb
c_func
(paren
l_int|0x80
op_plus
id|i
comma
id|addr
)paren
suffix:semicolon
macro_line|#endif
id|sig
(braket
id|i
)braket
op_assign
id|inb
(paren
id|addr
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|i
op_logical_and
(paren
id|sig
(braket
l_int|0
)braket
op_amp
l_int|0x80
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
id|sig_str
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|sig
(braket
l_int|0
)braket
op_rshift
l_int|2
)paren
op_amp
l_int|0x1f
)paren
op_plus
(paren
l_char|&squot;A&squot;
op_minus
l_int|1
)paren
suffix:semicolon
id|sig_str
(braket
l_int|1
)braket
op_assign
(paren
(paren
(paren
id|sig
(braket
l_int|0
)braket
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
op_or
(paren
id|sig
(braket
l_int|1
)braket
op_rshift
l_int|5
)paren
)paren
op_plus
(paren
l_char|&squot;A&squot;
op_minus
l_int|1
)paren
suffix:semicolon
id|sig_str
(braket
l_int|2
)braket
op_assign
(paren
id|sig
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
op_plus
(paren
l_char|&squot;A&squot;
op_minus
l_int|1
)paren
suffix:semicolon
id|rev
op_assign
(paren
id|sig
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|sig
(braket
l_int|3
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|sig_str
op_plus
l_int|3
comma
l_string|&quot;%04X&quot;
comma
id|rev
)paren
suffix:semicolon
r_return
id|sig_str
suffix:semicolon
)brace
DECL|function|eisa_bus_match
r_static
r_int
id|eisa_bus_match
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
r_struct
id|eisa_device
op_star
id|edev
op_assign
id|to_eisa_device
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|eisa_driver
op_star
id|edrv
op_assign
id|to_eisa_driver
(paren
id|drv
)paren
suffix:semicolon
r_const
r_struct
id|eisa_device_id
op_star
id|eids
op_assign
id|edrv-&gt;id_table
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|eids
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|strlen
(paren
id|eids-&gt;sig
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
(paren
id|eids-&gt;sig
comma
id|edev-&gt;id.sig
)paren
op_logical_and
id|edev-&gt;state
op_amp
id|EISA_CONFIG_ENABLED
)paren
(brace
id|edev-&gt;id.driver_data
op_assign
id|eids-&gt;driver_data
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|eids
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|eisa_bus_type
r_struct
id|bus_type
id|eisa_bus_type
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;eisa&quot;
comma
dot
id|match
op_assign
id|eisa_bus_match
comma
)brace
suffix:semicolon
DECL|function|eisa_driver_register
r_int
id|eisa_driver_register
(paren
r_struct
id|eisa_driver
op_star
id|edrv
)paren
(brace
r_int
id|r
suffix:semicolon
id|edrv-&gt;driver.bus
op_assign
op_amp
id|eisa_bus_type
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|driver_register
(paren
op_amp
id|edrv-&gt;driver
)paren
)paren
OL
l_int|0
)paren
r_return
id|r
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eisa_driver_unregister
r_void
id|eisa_driver_unregister
(paren
r_struct
id|eisa_driver
op_star
id|edrv
)paren
(brace
id|driver_unregister
(paren
op_amp
id|edrv-&gt;driver
)paren
suffix:semicolon
)brace
DECL|function|eisa_show_sig
r_static
id|ssize_t
id|eisa_show_sig
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|eisa_device
op_star
id|edev
op_assign
id|to_eisa_device
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|signature
comma
id|S_IRUGO
comma
id|eisa_show_sig
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|eisa_show_state
r_static
id|ssize_t
id|eisa_show_state
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|eisa_device
op_star
id|edev
op_assign
id|to_eisa_device
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|edev-&gt;state
op_amp
id|EISA_CONFIG_ENABLED
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|enabled
comma
id|S_IRUGO
comma
id|eisa_show_state
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|eisa_init_device
r_static
r_int
id|__init
id|eisa_init_device
(paren
r_struct
id|eisa_root_device
op_star
id|root
comma
r_struct
id|eisa_device
op_star
id|edev
comma
r_int
id|slot
)paren
(brace
r_char
op_star
id|sig
suffix:semicolon
r_int
r_int
id|sig_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sig_addr
op_assign
id|SLOT_ADDRESS
(paren
id|root
comma
id|slot
)paren
op_plus
id|EISA_VENDOR_ID_OFFSET
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sig
op_assign
id|decode_eisa_sig
(paren
id|sig_addr
)paren
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* No EISA device here */
id|memcpy
(paren
id|edev-&gt;id.sig
comma
id|sig
comma
id|EISA_SIG_LEN
)paren
suffix:semicolon
id|edev-&gt;slot
op_assign
id|slot
suffix:semicolon
id|edev-&gt;state
op_assign
id|inb
(paren
id|SLOT_ADDRESS
(paren
id|root
comma
id|slot
)paren
op_plus
id|EISA_CONFIG_OFFSET
)paren
op_amp
id|EISA_CONFIG_ENABLED
suffix:semicolon
id|edev-&gt;base_addr
op_assign
id|SLOT_ADDRESS
(paren
id|root
comma
id|slot
)paren
suffix:semicolon
id|edev-&gt;dma_mask
op_assign
id|root-&gt;dma_mask
suffix:semicolon
multiline_comment|/* Default DMA mask */
id|eisa_name_device
(paren
id|edev
)paren
suffix:semicolon
id|edev-&gt;dev.parent
op_assign
id|root-&gt;dev
suffix:semicolon
id|edev-&gt;dev.bus
op_assign
op_amp
id|eisa_bus_type
suffix:semicolon
id|edev-&gt;dev.dma_mask
op_assign
op_amp
id|edev-&gt;dma_mask
suffix:semicolon
id|sprintf
(paren
id|edev-&gt;dev.bus_id
comma
l_string|&quot;%02X:%02X&quot;
comma
id|root-&gt;bus_nr
comma
id|slot
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EISA_MAX_RESOURCES
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#ifdef CONFIG_EISA_NAMES
id|edev-&gt;res
(braket
id|i
)braket
dot
id|name
op_assign
id|edev-&gt;pretty_name
suffix:semicolon
macro_line|#else
id|edev-&gt;res
(braket
id|i
)braket
dot
id|name
op_assign
id|edev-&gt;id.sig
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|is_forced_dev
(paren
id|enable_dev
comma
id|root
comma
id|edev
)paren
)paren
id|edev-&gt;state
op_assign
id|EISA_CONFIG_ENABLED
op_or
id|EISA_CONFIG_FORCED
suffix:semicolon
r_if
c_cond
(paren
id|is_forced_dev
(paren
id|disable_dev
comma
id|root
comma
id|edev
)paren
)paren
id|edev-&gt;state
op_assign
id|EISA_CONFIG_FORCED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eisa_register_device
r_static
r_int
id|__init
id|eisa_register_device
(paren
r_struct
id|eisa_device
op_star
id|edev
)paren
(brace
r_if
c_cond
(paren
id|device_register
(paren
op_amp
id|edev-&gt;dev
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|device_create_file
(paren
op_amp
id|edev-&gt;dev
comma
op_amp
id|dev_attr_signature
)paren
suffix:semicolon
id|device_create_file
(paren
op_amp
id|edev-&gt;dev
comma
op_amp
id|dev_attr_enabled
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eisa_request_resources
r_static
r_int
id|__init
id|eisa_request_resources
(paren
r_struct
id|eisa_root_device
op_star
id|root
comma
r_struct
id|eisa_device
op_star
id|edev
comma
r_int
id|slot
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EISA_MAX_RESOURCES
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Don&squot;t register resource for slot 0, since this is&n;&t;&t; * very likely to fail... :-( Instead, grab the EISA&n;&t;&t; * id, now we can display something in /proc/ioports.&n;&t;&t; */
multiline_comment|/* Only one region for mainboard */
r_if
c_cond
(paren
op_logical_neg
id|slot
op_logical_and
id|i
OG
l_int|0
)paren
(brace
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_assign
id|edev-&gt;res
(braket
id|i
)braket
dot
id|end
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slot
)paren
(brace
id|edev-&gt;res
(braket
id|i
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_assign
id|SLOT_ADDRESS
(paren
id|root
comma
id|slot
)paren
op_plus
(paren
id|i
op_star
l_int|0x400
)paren
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|end
op_assign
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_plus
l_int|0xff
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
)brace
r_else
(brace
id|edev-&gt;res
(braket
id|i
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_assign
id|SLOT_ADDRESS
(paren
id|root
comma
id|slot
)paren
op_plus
id|EISA_VENDOR_ID_OFFSET
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|end
op_assign
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_plus
l_int|3
suffix:semicolon
id|edev-&gt;res
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_BUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_resource
(paren
id|root-&gt;res
comma
op_amp
id|edev-&gt;res
(braket
id|i
)braket
)paren
)paren
r_goto
id|failed
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|failed
suffix:colon
r_while
c_loop
(paren
op_decrement
id|i
op_ge
l_int|0
)paren
id|release_resource
(paren
op_amp
id|edev-&gt;res
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|eisa_release_resources
r_static
r_void
id|__init
id|eisa_release_resources
(paren
r_struct
id|eisa_device
op_star
id|edev
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EISA_MAX_RESOURCES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|edev-&gt;res
(braket
id|i
)braket
dot
id|start
op_logical_or
id|edev-&gt;res
(braket
id|i
)braket
dot
id|end
)paren
id|release_resource
(paren
op_amp
id|edev-&gt;res
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
DECL|function|eisa_probe
r_static
r_int
id|__init
id|eisa_probe
(paren
r_struct
id|eisa_root_device
op_star
id|root
)paren
(brace
r_int
id|i
comma
id|c
suffix:semicolon
r_struct
id|eisa_device
op_star
id|edev
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;EISA: Probing bus %d at %s&bslash;n&quot;
comma
id|root-&gt;bus_nr
comma
id|root-&gt;dev-&gt;bus_id
)paren
suffix:semicolon
multiline_comment|/* First try to get hold of slot 0. If there is no device&n;&t; * here, simply fail, unless root-&gt;force_probe is set. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|edev
op_assign
id|kmalloc
(paren
r_sizeof
(paren
op_star
id|edev
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;EISA: Couldn&squot;t allocate mainboard slot&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
(paren
id|edev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|edev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eisa_request_resources
(paren
id|root
comma
id|edev
comma
l_int|0
)paren
)paren
(brace
id|printk
(paren
id|KERN_WARNING
"&bslash;"
l_string|&quot;EISA: Cannot allocate resource for mainboard&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root-&gt;force_probe
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|force_probe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eisa_init_device
(paren
id|root
comma
id|edev
comma
l_int|0
)paren
)paren
(brace
id|eisa_release_resources
(paren
id|edev
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|root-&gt;force_probe
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|force_probe
suffix:semicolon
)brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;EISA: Mainboard %s detected.&bslash;n&quot;
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eisa_register_device
(paren
id|edev
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;EISA: Failed to register %s&bslash;n&quot;
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
id|eisa_release_resources
(paren
id|edev
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
)brace
id|force_probe
suffix:colon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|root-&gt;slots
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|edev
op_assign
id|kmalloc
(paren
r_sizeof
(paren
op_star
id|edev
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;EISA: Out of memory for slot %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|memset
(paren
id|edev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|edev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eisa_request_resources
(paren
id|root
comma
id|edev
comma
id|i
)paren
)paren
(brace
id|printk
(paren
id|KERN_WARNING
"&bslash;"
l_string|&quot;Cannot allocate resource for EISA slot %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eisa_init_device
(paren
id|root
comma
id|edev
comma
id|i
)paren
)paren
(brace
id|eisa_release_resources
(paren
id|edev
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;EISA: slot %d : %s detected&quot;
comma
id|i
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|edev-&gt;state
)paren
(brace
r_case
id|EISA_CONFIG_ENABLED
op_or
id|EISA_CONFIG_FORCED
suffix:colon
id|printk
(paren
l_string|&quot; (forced enabled)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EISA_CONFIG_FORCED
suffix:colon
id|printk
(paren
l_string|&quot; (forced disabled)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|printk
(paren
l_string|&quot; (disabled)&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
id|c
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|eisa_register_device
(paren
id|edev
)paren
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;EISA: Failed to register %s&bslash;n&quot;
comma
id|edev-&gt;id.sig
)paren
suffix:semicolon
id|eisa_release_resources
(paren
id|edev
)paren
suffix:semicolon
id|kfree
(paren
id|edev
)paren
suffix:semicolon
)brace
)brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;EISA: Detected %d card%s.&bslash;n&quot;
comma
id|c
comma
id|c
op_eq
l_int|1
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;s&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|eisa_root_res
r_static
r_struct
id|resource
id|eisa_root_res
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;EISA root resource&quot;
comma
dot
id|start
op_assign
l_int|0
comma
dot
id|end
op_assign
l_int|0xffffffff
comma
dot
id|flags
op_assign
id|IORESOURCE_IO
comma
)brace
suffix:semicolon
DECL|variable|eisa_bus_count
r_static
r_int
id|eisa_bus_count
suffix:semicolon
DECL|function|eisa_root_register
r_int
id|__init
id|eisa_root_register
(paren
r_struct
id|eisa_root_device
op_star
id|root
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* Use our own resources to check if this bus base address has&n;&t; * been already registered. This prevents the virtual root&n;&t; * device from registering after the real one has, for&n;&t; * example... */
id|root-&gt;eisa_root_res.name
op_assign
id|eisa_root_res.name
suffix:semicolon
id|root-&gt;eisa_root_res.start
op_assign
id|root-&gt;res-&gt;start
suffix:semicolon
id|root-&gt;eisa_root_res.end
op_assign
id|root-&gt;res-&gt;end
suffix:semicolon
id|root-&gt;eisa_root_res.flags
op_assign
id|IORESOURCE_BUSY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|request_resource
(paren
op_amp
id|eisa_root_res
comma
op_amp
id|root-&gt;eisa_root_res
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|root-&gt;bus_nr
op_assign
id|eisa_bus_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|eisa_probe
(paren
id|root
)paren
)paren
)paren
id|release_resource
(paren
op_amp
id|root-&gt;eisa_root_res
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|eisa_init
r_static
r_int
id|__init
id|eisa_init
(paren
r_void
)paren
(brace
r_int
id|r
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|bus_register
(paren
op_amp
id|eisa_bus_type
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
id|printk
(paren
id|KERN_INFO
l_string|&quot;EISA bus registered&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Couldn&squot;t use intarray with checking on... :-( */
DECL|macro|param_check_intarray
macro_line|#undef  param_check_intarray
DECL|macro|param_check_intarray
mdefine_line|#define param_check_intarray(name, p)
id|module_param
c_func
(paren
id|enable_dev
comma
id|intarray
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|disable_dev
comma
id|intarray
comma
l_int|0444
)paren
suffix:semicolon
DECL|variable|eisa_init
id|postcore_initcall
(paren
id|eisa_init
)paren
suffix:semicolon
DECL|variable|eisa_bus_type
id|EXPORT_SYMBOL
(paren
id|eisa_bus_type
)paren
suffix:semicolon
DECL|variable|eisa_driver_register
id|EXPORT_SYMBOL
(paren
id|eisa_driver_register
)paren
suffix:semicolon
DECL|variable|eisa_driver_unregister
id|EXPORT_SYMBOL
(paren
id|eisa_driver_unregister
)paren
suffix:semicolon
eof
