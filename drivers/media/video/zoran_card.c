multiline_comment|/*&n; * Zoran zr36057/zr36067 PCI controller driver, for the&n; * Pinnacle/Miro DC10/DC10+/DC30/DC30+, Iomega Buz, Linux&n; * Media Labs LML33/LML33R10.&n; *&n; * This part handles card-specific data and detection&n; * &n; * Copyright (C) 2000 Serguei Miridonov &lt;mirsev@cicese.mx&gt;&n; *&n; * Currently maintained by:&n; *   Ronald Bultje    &lt;rbultje@ronald.bitfreak.net&gt;&n; *   Laurent Pinchart &lt;laurent.pinchart@skynet.be&gt;&n; *   Mailinglist      &lt;mjpeg-users@lists.sf.net&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/i2c-algo-bit.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/sem.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/video_decoder.h&gt;
macro_line|#include &lt;linux/video_encoder.h&gt;
macro_line|#include &quot;videocodec.h&quot;
macro_line|#include &quot;zoran.h&quot;
macro_line|#include &quot;zoran_card.h&quot;
macro_line|#include &quot;zoran_device.h&quot;
macro_line|#include &quot;zoran_procfs.h&quot;
DECL|macro|I2C_NAME
mdefine_line|#define I2C_NAME(x) (x)-&gt;name
r_extern
r_const
r_struct
id|zoran_format
id|zoran_formats
(braket
)braket
suffix:semicolon
r_extern
r_const
r_int
id|zoran_num_formats
suffix:semicolon
DECL|variable|card
r_static
r_int
id|card
(braket
id|BUZ_MAX
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|card
comma
l_string|&quot;1-&quot;
id|__stringify
c_func
(paren
id|BUZ_MAX
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|card
comma
l_string|&quot;The type of card&quot;
)paren
suffix:semicolon
DECL|variable|encoder
r_static
r_int
id|encoder
(braket
id|BUZ_MAX
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|encoder
comma
l_string|&quot;1-&quot;
id|__stringify
c_func
(paren
id|BUZ_MAX
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|encoder
comma
l_string|&quot;i2c TV encoder&quot;
)paren
suffix:semicolon
DECL|variable|decoder
r_static
r_int
id|decoder
(braket
id|BUZ_MAX
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|decoder
comma
l_string|&quot;1-&quot;
id|__stringify
c_func
(paren
id|BUZ_MAX
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|decoder
comma
l_string|&quot;i2c TV decoder&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;   The video mem address of the video card.&n;   The driver has a little database for some videocards&n;   to determine it from there. If your video card is not in there&n;   you have either to give it to the driver as a parameter&n;   or set in in a VIDIOCSFBUF ioctl&n; */
DECL|variable|vidmem
r_static
r_int
r_int
id|vidmem
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Video memory base address */
id|MODULE_PARM
c_func
(paren
id|vidmem
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;   Default input and video norm at startup of the driver.&n;*/
DECL|variable|default_input
r_static
r_int
id|default_input
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0=Composite, 1=S-Video */
id|MODULE_PARM
c_func
(paren
id|default_input
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|default_input
comma
l_string|&quot;Default input (0=Composite, 1=S-Video, 2=Internal)&quot;
)paren
suffix:semicolon
DECL|variable|default_norm
r_static
r_int
id|default_norm
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0=PAL, 1=NTSC 2=SECAM */
id|MODULE_PARM
c_func
(paren
id|default_norm
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|default_norm
comma
l_string|&quot;Default norm (0=PAL, 1=NTSC, 2=SECAM)&quot;
)paren
suffix:semicolon
DECL|variable|video_nr
r_static
r_int
id|video_nr
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* /dev/videoN, -1 for autodetect */
id|MODULE_PARM
c_func
(paren
id|video_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|video_nr
comma
l_string|&quot;video device number&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;   Number and size of grab buffers for Video 4 Linux&n;   The vast majority of applications should not need more than 2,&n;   the very popular BTTV driver actually does ONLY have 2.&n;   Time sensitive applications might need more, the maximum&n;   is VIDEO_MAX_FRAME (defined in &lt;linux/videodev.h&gt;).&n;&n;   The size is set so that the maximum possible request&n;   can be satisfied. Decrease  it, if bigphys_area alloc&squot;d&n;   memory is low. If you don&squot;t have the bigphys_area patch,&n;   set it to 128 KB. Will you allow only to grab small&n;   images with V4L, but that&squot;s better than nothing.&n;&n;   v4l_bufsize has to be given in KB !&n;&n;*/
DECL|variable|v4l_nbufs
r_int
id|v4l_nbufs
op_assign
l_int|2
suffix:semicolon
DECL|variable|v4l_bufsize
r_int
id|v4l_bufsize
op_assign
l_int|128
suffix:semicolon
multiline_comment|/* Everybody should be able to work with this setting */
id|MODULE_PARM
c_func
(paren
id|v4l_nbufs
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|v4l_nbufs
comma
l_string|&quot;Maximum number of V4L buffers to use&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|v4l_bufsize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|v4l_bufsize
comma
l_string|&quot;Maximum size per V4L buffer (in kB)&quot;
)paren
suffix:semicolon
DECL|variable|jpg_nbufs
r_int
id|jpg_nbufs
op_assign
l_int|32
suffix:semicolon
DECL|variable|jpg_bufsize
r_int
id|jpg_bufsize
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* max size for 100% quality full-PAL frame */
id|MODULE_PARM
c_func
(paren
id|jpg_nbufs
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|jpg_nbufs
comma
l_string|&quot;Maximum number of JPG buffers to use&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|jpg_bufsize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|jpg_bufsize
comma
l_string|&quot;Maximum size per JPG buffer (in kB)&quot;
)paren
suffix:semicolon
DECL|variable|pass_through
r_int
id|pass_through
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 1=Pass through TV signal when device is not used */
multiline_comment|/* 0=Show color bar when device is not used (LML33: only if lml33dpath=1) */
id|MODULE_PARM
c_func
(paren
id|pass_through
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|pass_through
comma
l_string|&quot;Pass TV signal through to TV-out when idling&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|1
suffix:semicolon
DECL|variable|zr_debug
r_int
op_star
id|zr_debug
op_assign
op_amp
id|debug
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Debug level (0-4)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Zoran-36057/36067 JPEG codec driver&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Serguei Miridonov&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|zr36067_pci_tbl
r_static
r_struct
id|pci_device_id
id|zr36067_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_ZORAN
comma
id|PCI_DEVICE_ID_ZORAN_36057
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|zr36067_pci_tbl
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(num, format, args...) &bslash;&n;&t;do { &bslash;&n;&t;&t;if (*zr_debug &gt;= num) &bslash;&n;&t;&t;&t;printk(format, ##args); &bslash;&n;&t;} while (0)
DECL|variable|zoran_num
r_int
id|zoran_num
suffix:semicolon
multiline_comment|/* number of Buzs in use */
DECL|variable|zoran
r_struct
id|zoran
id|zoran
(braket
id|BUZ_MAX
)braket
suffix:semicolon
multiline_comment|/* videocodec bus functions ZR36060 */
r_static
id|u32
DECL|function|zr36060_read
id|zr36060_read
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
id|__u32
id|data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|1
comma
id|reg
op_rshift
l_int|8
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|2
comma
id|reg
op_amp
l_int|0xff
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data
op_assign
id|post_office_read
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|3
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
r_static
r_void
DECL|function|zr36060_write
id|zr36060_write
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
comma
id|u32
id|val
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|1
comma
id|reg
op_rshift
l_int|8
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|2
comma
id|reg
op_amp
l_int|0xff
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
l_int|3
comma
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
multiline_comment|/* videocodec bus functions ZR36050 */
r_static
id|u32
DECL|function|zr36050_read
id|zr36050_read
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
id|__u32
id|data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|1
comma
l_int|0
comma
id|reg
op_rshift
l_int|2
)paren
)paren
(brace
singleline_comment|// reg. HIGHBYTES
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data
op_assign
id|post_office_read
c_func
(paren
id|zr
comma
l_int|0
comma
id|reg
op_amp
l_int|0x03
)paren
op_amp
l_int|0xff
suffix:semicolon
singleline_comment|// reg. LOWBYTES + read
r_return
id|data
suffix:semicolon
)brace
r_static
r_void
DECL|function|zr36050_write
id|zr36050_write
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
comma
id|u32
id|val
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
op_logical_or
id|post_office_write
c_func
(paren
id|zr
comma
l_int|1
comma
l_int|0
comma
id|reg
op_rshift
l_int|2
)paren
)paren
(brace
singleline_comment|// reg. HIGHBYTES
r_return
suffix:semicolon
)brace
id|post_office_write
c_func
(paren
id|zr
comma
l_int|0
comma
id|reg
op_amp
l_int|0x03
comma
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
singleline_comment|// reg. LOWBYTES + wr. data
)brace
multiline_comment|/* videocodec bus functions ZR36016 */
r_static
id|u32
DECL|function|zr36016_read
id|zr36016_read
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
id|__u32
id|data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data
op_assign
id|post_office_read
c_func
(paren
id|zr
comma
l_int|2
comma
id|reg
op_amp
l_int|0x03
)paren
op_amp
l_int|0xff
suffix:semicolon
singleline_comment|// read
r_return
id|data
suffix:semicolon
)brace
multiline_comment|/* hack for in zoran_device.c */
r_void
DECL|function|zr36016_write
id|zr36016_write
(paren
r_struct
id|videocodec
op_star
id|codec
comma
id|u16
id|reg
comma
id|u32
id|val
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|codec-&gt;master_data-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|post_office_wait
c_func
(paren
id|zr
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|post_office_write
c_func
(paren
id|zr
comma
l_int|2
comma
id|reg
op_amp
l_int|0x03
comma
id|val
op_amp
l_int|0x0ff
)paren
suffix:semicolon
singleline_comment|// wr. data
)brace
multiline_comment|/*&n; * Board specific information&n; */
r_static
r_void
DECL|function|dc10_init
id|dc10_init
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: dc10_init()&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
multiline_comment|/* Pixel clock selection */
id|GPIO
c_func
(paren
id|zr
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|GPIO
c_func
(paren
id|zr
comma
l_int|5
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Enable the video bus sync signals */
id|GPIO
c_func
(paren
id|zr
comma
l_int|7
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|dc10plus_init
id|dc10plus_init
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: dc10plus_init()&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|buz_init
id|buz_init
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: buz_init()&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
multiline_comment|/* some stuff from Iomega */
id|pci_write_config_dword
c_func
(paren
id|zr-&gt;pci_dev
comma
l_int|0xfc
comma
l_int|0x90680f15
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|zr-&gt;pci_dev
comma
l_int|0x0c
comma
l_int|0x00012020
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|zr-&gt;pci_dev
comma
l_int|0xe8
comma
l_int|0xc0200000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|lml33_init
id|lml33_init
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: lml33_init()&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|GPIO
c_func
(paren
id|zr
comma
l_int|2
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// Set Composite input/output
)brace
r_static
r_char
op_star
DECL|function|i2cid_to_modulename
id|i2cid_to_modulename
(paren
id|u16
id|i2c_id
)paren
(brace
r_char
op_star
id|name
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|i2c_id
)paren
(brace
r_case
id|I2C_DRIVERID_SAA7110
suffix:colon
id|name
op_assign
l_string|&quot;saa7110&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_SAA7111A
suffix:colon
id|name
op_assign
l_string|&quot;saa7111&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_SAA7114
suffix:colon
id|name
op_assign
l_string|&quot;saa7114&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_SAA7185B
suffix:colon
id|name
op_assign
l_string|&quot;saa7185&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_ADV7170
suffix:colon
id|name
op_assign
l_string|&quot;adv7170&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_ADV7175
suffix:colon
id|name
op_assign
l_string|&quot;adv7175&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_BT819
suffix:colon
id|name
op_assign
l_string|&quot;bt819&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_BT856
suffix:colon
id|name
op_assign
l_string|&quot;bt856&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|I2C_DRIVERID_VPX3220
suffix:colon
id|name
op_assign
l_string|&quot;vpx3220&quot;
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/*&t;case I2C_DRIVERID_VPX3224:&n;&t;&t;name = &quot;vpx3224&quot;;&n;&t;&t;break;&n;&t;case I2C_DRIVERID_MSE3000:&n;&t;&t;name = &quot;mse3000&quot;;&n;&t;&t;break;*/
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|name
suffix:semicolon
)brace
r_static
r_char
op_star
DECL|function|codecid_to_modulename
id|codecid_to_modulename
(paren
id|u16
id|codecid
)paren
(brace
r_char
op_star
id|name
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|codecid
)paren
(brace
r_case
id|CODEC_TYPE_ZR36060
suffix:colon
id|name
op_assign
l_string|&quot;zr36060&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_TYPE_ZR36050
suffix:colon
id|name
op_assign
l_string|&quot;zr36050&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_TYPE_ZR36016
suffix:colon
id|name
op_assign
l_string|&quot;zr36016&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|name
suffix:semicolon
)brace
singleline_comment|// struct tvnorm {
singleline_comment|//      u16 Wt, Wa, HStart, HSyncStart, Ht, Ha, VStart;
singleline_comment|// };
DECL|variable|f50sqpixel
r_static
r_struct
id|tvnorm
id|f50sqpixel
op_assign
(brace
l_int|944
comma
l_int|768
comma
l_int|83
comma
l_int|880
comma
l_int|625
comma
l_int|576
comma
l_int|16
)brace
suffix:semicolon
DECL|variable|f60sqpixel
r_static
r_struct
id|tvnorm
id|f60sqpixel
op_assign
(brace
l_int|780
comma
l_int|640
comma
l_int|51
comma
l_int|716
comma
l_int|525
comma
l_int|480
comma
l_int|12
)brace
suffix:semicolon
DECL|variable|f50ccir601
r_static
r_struct
id|tvnorm
id|f50ccir601
op_assign
(brace
l_int|864
comma
l_int|720
comma
l_int|75
comma
l_int|804
comma
l_int|625
comma
l_int|576
comma
l_int|18
)brace
suffix:semicolon
DECL|variable|f60ccir601
r_static
r_struct
id|tvnorm
id|f60ccir601
op_assign
(brace
l_int|858
comma
l_int|720
comma
l_int|57
comma
l_int|788
comma
l_int|525
comma
l_int|480
comma
l_int|16
)brace
suffix:semicolon
DECL|variable|f50ccir601_lml33
r_static
r_struct
id|tvnorm
id|f50ccir601_lml33
op_assign
(brace
l_int|864
comma
l_int|720
comma
l_int|75
op_plus
l_int|34
comma
l_int|804
comma
l_int|625
comma
l_int|576
comma
l_int|18
)brace
suffix:semicolon
DECL|variable|f60ccir601_lml33
r_static
r_struct
id|tvnorm
id|f60ccir601_lml33
op_assign
(brace
l_int|858
comma
l_int|720
comma
l_int|57
op_plus
l_int|34
comma
l_int|788
comma
l_int|525
comma
l_int|480
comma
l_int|16
)brace
suffix:semicolon
multiline_comment|/* The DC10 (57/16/50) uses VActive as HSync, so HStart must be 0 */
DECL|variable|f50sqpixel_dc10
r_static
r_struct
id|tvnorm
id|f50sqpixel_dc10
op_assign
(brace
l_int|944
comma
l_int|768
comma
l_int|0
comma
l_int|880
comma
l_int|625
comma
l_int|576
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|f60sqpixel_dc10
r_static
r_struct
id|tvnorm
id|f60sqpixel_dc10
op_assign
(brace
l_int|780
comma
l_int|640
comma
l_int|0
comma
l_int|716
comma
l_int|525
comma
l_int|480
comma
l_int|12
)brace
suffix:semicolon
multiline_comment|/* FIXME: I cannot swap U and V in saa7114, so i do one&n; * pixel left shift in zoran (75 -&gt; 74)&n; * (Maxim Yevtyushkin &lt;max@linuxmedialabs.com&gt;) */
DECL|variable|f50ccir601_lm33r10
r_static
r_struct
id|tvnorm
id|f50ccir601_lm33r10
op_assign
(brace
l_int|864
comma
l_int|720
comma
l_int|74
op_plus
l_int|54
comma
l_int|804
comma
l_int|625
comma
l_int|576
comma
l_int|18
)brace
suffix:semicolon
DECL|variable|f60ccir601_lm33r10
r_static
r_struct
id|tvnorm
id|f60ccir601_lm33r10
op_assign
(brace
l_int|858
comma
l_int|720
comma
l_int|56
op_plus
l_int|54
comma
l_int|788
comma
l_int|525
comma
l_int|480
comma
l_int|16
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|card_info
id|zoran_cards
(braket
id|NUM_CARDS
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|type
op_assign
id|DC10_old
comma
dot
id|name
op_assign
l_string|&quot;DC10(old)&quot;
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_VPX3220
comma
multiline_comment|/*.i2c_encoder = I2C_DRIVERID_MSE3000,*/
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36050
comma
dot
id|video_vfe
op_assign
id|CODEC_TYPE_ZR36016
comma
dot
id|inputs
op_assign
l_int|3
comma
dot
id|input
op_assign
(brace
(brace
l_int|1
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|2
comma
l_string|&quot;S-Video&quot;
)brace
comma
(brace
l_int|0
comma
l_string|&quot;Internal/comp&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50sqpixel_dc10
comma
op_amp
id|f60sqpixel_dc10
comma
op_amp
id|f50sqpixel_dc10
)brace
comma
dot
id|jpeg_int
op_assign
l_int|0
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|gpio
op_assign
(brace
l_int|2
comma
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
l_int|7
comma
l_int|0
comma
l_int|4
comma
l_int|5
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
op_minus
l_int|1
comma
l_int|0
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|0
comma
dot
id|init
op_assign
op_amp
id|dc10_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|DC10_new
comma
dot
id|name
op_assign
l_string|&quot;DC10(new)&quot;
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_SAA7110
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_ADV7175
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36060
comma
dot
id|inputs
op_assign
l_int|3
comma
dot
id|input
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|7
comma
l_string|&quot;S-Video&quot;
)brace
comma
(brace
l_int|5
comma
l_string|&quot;Internal/comp&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50sqpixel
comma
op_amp
id|f60sqpixel
comma
op_amp
id|f50sqpixel
)brace
comma
dot
id|jpeg_int
op_assign
id|ZR36057_ISR_GIRQ0
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|gpio
op_assign
(brace
l_int|3
comma
l_int|0
comma
l_int|6
comma
l_int|1
comma
l_int|2
comma
op_minus
l_int|1
comma
l_int|4
comma
l_int|5
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
op_minus
l_int|1
comma
l_int|1
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|0
comma
dot
id|init
op_assign
op_amp
id|dc10plus_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|DC10plus
comma
dot
id|name
op_assign
l_string|&quot;DC10plus&quot;
comma
dot
id|vendor_id
op_assign
id|PCI_VENDOR_ID_MIRO
comma
dot
id|device_id
op_assign
id|PCI_DEVICE_ID_MIRO_DC10PLUS
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_SAA7110
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_ADV7175
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36060
comma
dot
id|inputs
op_assign
l_int|3
comma
dot
id|input
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|7
comma
l_string|&quot;S-Video&quot;
)brace
comma
(brace
l_int|5
comma
l_string|&quot;Internal/comp&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50sqpixel
comma
op_amp
id|f60sqpixel
comma
op_amp
id|f50sqpixel
)brace
comma
dot
id|jpeg_int
op_assign
id|ZR36057_ISR_GIRQ0
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|gpio
op_assign
(brace
l_int|3
comma
l_int|0
comma
l_int|6
comma
l_int|1
comma
l_int|2
comma
op_minus
l_int|1
comma
l_int|4
comma
l_int|5
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
op_minus
l_int|1
comma
l_int|1
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|0
comma
dot
id|init
op_assign
op_amp
id|dc10plus_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|DC30
comma
dot
id|name
op_assign
l_string|&quot;DC30&quot;
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_VPX3220
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_ADV7175
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36050
comma
dot
id|video_vfe
op_assign
id|CODEC_TYPE_ZR36016
comma
dot
id|inputs
op_assign
l_int|3
comma
dot
id|input
op_assign
(brace
(brace
l_int|1
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|2
comma
l_string|&quot;S-Video&quot;
)brace
comma
(brace
l_int|0
comma
l_string|&quot;Internal/comp&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50sqpixel_dc10
comma
op_amp
id|f60sqpixel_dc10
comma
op_amp
id|f50sqpixel_dc10
)brace
comma
dot
id|jpeg_int
op_assign
l_int|0
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|gpio
op_assign
(brace
l_int|2
comma
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
l_int|7
comma
l_int|0
comma
l_int|4
comma
l_int|5
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
op_minus
l_int|1
comma
l_int|0
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|0
comma
dot
id|init
op_assign
op_amp
id|dc10_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|DC30plus
comma
dot
id|name
op_assign
l_string|&quot;DC30plus&quot;
comma
dot
id|vendor_id
op_assign
id|PCI_VENDOR_ID_MIRO
comma
dot
id|device_id
op_assign
id|PCI_DEVICE_ID_MIRO_DC30PLUS
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_VPX3220
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_ADV7175
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36050
comma
dot
id|video_vfe
op_assign
id|CODEC_TYPE_ZR36016
comma
dot
id|inputs
op_assign
l_int|3
comma
dot
id|input
op_assign
(brace
(brace
l_int|1
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|2
comma
l_string|&quot;S-Video&quot;
)brace
comma
(brace
l_int|0
comma
l_string|&quot;Internal/comp&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50sqpixel_dc10
comma
op_amp
id|f60sqpixel_dc10
comma
op_amp
id|f50sqpixel_dc10
)brace
comma
dot
id|jpeg_int
op_assign
l_int|0
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|gpio
op_assign
(brace
l_int|2
comma
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
l_int|7
comma
l_int|0
comma
l_int|4
comma
l_int|5
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
op_minus
l_int|1
comma
l_int|0
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|0
comma
dot
id|init
op_assign
op_amp
id|dc10_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|LML33
comma
dot
id|name
op_assign
l_string|&quot;LML33&quot;
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_BT819
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_BT856
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36060
comma
dot
id|inputs
op_assign
l_int|2
comma
dot
id|input
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|7
comma
l_string|&quot;S-Video&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|2
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50ccir601_lml33
comma
op_amp
id|f60ccir601_lml33
comma
l_int|NULL
)brace
comma
dot
id|jpeg_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ0
comma
dot
id|gpio
op_assign
(brace
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
l_int|5
comma
l_int|7
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
l_int|3
comma
l_int|1
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|1
comma
dot
id|init
op_assign
op_amp
id|lml33_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|LML33R10
comma
dot
id|name
op_assign
l_string|&quot;LML33R10&quot;
comma
dot
id|vendor_id
op_assign
id|PCI_VENDOR_ID_ELECTRONICDESIGNGMBH
comma
dot
id|device_id
op_assign
id|PCI_DEVICE_ID_LML_33R10
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_SAA7114
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_ADV7170
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36060
comma
dot
id|inputs
op_assign
l_int|2
comma
dot
id|input
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|7
comma
l_string|&quot;S-Video&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|2
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50ccir601_lm33r10
comma
op_amp
id|f60ccir601_lm33r10
comma
l_int|NULL
)brace
comma
dot
id|jpeg_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ0
comma
dot
id|gpio
op_assign
(brace
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
l_int|5
comma
l_int|7
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
l_int|3
comma
l_int|1
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|1
comma
dot
id|init
op_assign
op_amp
id|lml33_init
comma
)brace
comma
(brace
dot
id|type
op_assign
id|BUZ
comma
dot
id|name
op_assign
l_string|&quot;Buz&quot;
comma
dot
id|vendor_id
op_assign
id|PCI_VENDOR_ID_IOMEGA
comma
dot
id|device_id
op_assign
id|PCI_DEVICE_ID_IOMEGA_BUZ
comma
dot
id|i2c_decoder
op_assign
id|I2C_DRIVERID_SAA7111A
comma
dot
id|i2c_encoder
op_assign
id|I2C_DRIVERID_SAA7185B
comma
dot
id|video_codec
op_assign
id|CODEC_TYPE_ZR36060
comma
dot
id|inputs
op_assign
l_int|2
comma
dot
id|input
op_assign
(brace
(brace
l_int|3
comma
l_string|&quot;Composite&quot;
)brace
comma
(brace
l_int|7
comma
l_string|&quot;S-Video&quot;
)brace
)brace
comma
dot
id|norms
op_assign
l_int|3
comma
dot
id|tvn
op_assign
(brace
op_amp
id|f50ccir601
comma
op_amp
id|f60ccir601
comma
op_amp
id|f50ccir601
)brace
comma
dot
id|jpeg_int
op_assign
id|ZR36057_ISR_GIRQ1
comma
dot
id|vsync_int
op_assign
id|ZR36057_ISR_GIRQ0
comma
dot
id|gpio
op_assign
(brace
l_int|1
comma
op_minus
l_int|1
comma
l_int|3
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
comma
dot
id|gpio_pol
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gpcs
op_assign
(brace
l_int|3
comma
l_int|1
)brace
comma
dot
id|vfe_pol
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
dot
id|gws_not_connected
op_assign
l_int|1
comma
dot
id|init
op_assign
op_amp
id|buz_init
comma
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * I2C functions&n; */
multiline_comment|/* software I2C functions */
r_static
r_int
DECL|function|zoran_i2c_getsda
id|zoran_i2c_getsda
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|data
suffix:semicolon
r_return
(paren
id|btread
c_func
(paren
id|ZR36057_I2CBR
)paren
op_rshift
l_int|1
)paren
op_amp
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|zoran_i2c_getscl
id|zoran_i2c_getscl
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|data
suffix:semicolon
r_return
id|btread
c_func
(paren
id|ZR36057_I2CBR
)paren
op_amp
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|zoran_i2c_setsda
id|zoran_i2c_setsda
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|zr-&gt;i2cbr
op_or_assign
l_int|2
suffix:semicolon
r_else
id|zr-&gt;i2cbr
op_and_assign
op_complement
l_int|2
suffix:semicolon
id|btwrite
c_func
(paren
id|zr-&gt;i2cbr
comma
id|ZR36057_I2CBR
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|zoran_i2c_setscl
id|zoran_i2c_setscl
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|zr-&gt;i2cbr
op_or_assign
l_int|1
suffix:semicolon
r_else
id|zr-&gt;i2cbr
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|btwrite
c_func
(paren
id|zr-&gt;i2cbr
comma
id|ZR36057_I2CBR
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|zoran_i2c_client_register
id|zoran_i2c_client_register
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_DEBUG
l_string|&quot;%s: i2c_client_register() - driver id = %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|client-&gt;driver-&gt;id
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|zr-&gt;resource_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zr-&gt;user
OG
l_int|0
)paren
(brace
multiline_comment|/* we&squot;re already busy, so we keep a reference to&n;&t;&t; * them... Could do a lot of stuff here, but this&n;&t;&t; * is easiest. (Did I ever mention I&squot;m a lazy ass?)&n;&t;&t; */
id|res
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|clientreg_unlock_and_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|client-&gt;driver-&gt;id
op_eq
id|zr-&gt;card.i2c_decoder
)paren
id|zr-&gt;decoder
op_assign
id|client
suffix:semicolon
r_else
r_if
c_cond
(paren
id|client-&gt;driver-&gt;id
op_eq
id|zr-&gt;card.i2c_encoder
)paren
id|zr-&gt;encoder
op_assign
id|client
suffix:semicolon
r_else
(brace
id|res
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|clientreg_unlock_and_return
suffix:semicolon
)brace
id|clientreg_unlock_and_return
suffix:colon
id|up
c_func
(paren
op_amp
id|zr-&gt;resource_lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|zoran_i2c_client_unregister
id|zoran_i2c_client_unregister
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
(paren
r_struct
id|zoran
op_star
)paren
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_DEBUG
l_string|&quot;%s: i2c_client_unregister()&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|zr-&gt;resource_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zr-&gt;user
OG
l_int|0
)paren
(brace
id|res
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|clientunreg_unlock_and_return
suffix:semicolon
)brace
multiline_comment|/* try to locate it */
r_if
c_cond
(paren
id|client
op_eq
id|zr-&gt;encoder
)paren
(brace
id|zr-&gt;encoder
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|client
op_eq
id|zr-&gt;decoder
)paren
(brace
id|zr-&gt;decoder
op_assign
l_int|NULL
suffix:semicolon
id|snprintf
c_func
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
r_sizeof
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
comma
l_string|&quot;MJPEG[%d]&quot;
comma
id|zr-&gt;id
)paren
suffix:semicolon
)brace
id|clientunreg_unlock_and_return
suffix:colon
id|up
c_func
(paren
op_amp
id|zr-&gt;resource_lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|variable|zoran_i2c_bit_data_template
r_static
r_struct
id|i2c_algo_bit_data
id|zoran_i2c_bit_data_template
op_assign
(brace
dot
id|setsda
op_assign
id|zoran_i2c_setsda
comma
dot
id|setscl
op_assign
id|zoran_i2c_setscl
comma
dot
id|getsda
op_assign
id|zoran_i2c_getsda
comma
dot
id|getscl
op_assign
id|zoran_i2c_getscl
comma
dot
id|udelay
op_assign
l_int|10
comma
dot
id|mdelay
op_assign
l_int|0
comma
dot
id|timeout
op_assign
l_int|100
comma
)brace
suffix:semicolon
DECL|variable|zoran_i2c_adapter_template
r_static
r_struct
id|i2c_adapter
id|zoran_i2c_adapter_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;zr36057&quot;
)paren
comma
dot
id|id
op_assign
id|I2C_HW_B_ZR36067
comma
dot
id|algo
op_assign
l_int|NULL
comma
dot
id|client_register
op_assign
id|zoran_i2c_client_register
comma
dot
id|client_unregister
op_assign
id|zoran_i2c_client_unregister
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|zoran_register_i2c
id|zoran_register_i2c
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|zr-&gt;i2c_algo
comma
op_amp
id|zoran_i2c_bit_data_template
comma
r_sizeof
(paren
r_struct
id|i2c_algo_bit_data
)paren
)paren
suffix:semicolon
id|zr-&gt;i2c_algo.data
op_assign
id|zr
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|zr-&gt;i2c_adapter
comma
op_amp
id|zoran_i2c_adapter_template
comma
r_sizeof
(paren
r_struct
id|i2c_adapter
)paren
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|I2C_NAME
c_func
(paren
op_amp
id|zr-&gt;i2c_adapter
)paren
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
r_sizeof
(paren
id|I2C_NAME
c_func
(paren
op_amp
id|zr-&gt;i2c_adapter
)paren
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|i2c_set_adapdata
c_func
(paren
op_amp
id|zr-&gt;i2c_adapter
comma
id|zr
)paren
suffix:semicolon
id|zr-&gt;i2c_adapter.algo_data
op_assign
op_amp
id|zr-&gt;i2c_algo
suffix:semicolon
r_return
id|i2c_bit_add_bus
c_func
(paren
op_amp
id|zr-&gt;i2c_adapter
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|zoran_unregister_i2c
id|zoran_unregister_i2c
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
id|i2c_bit_del_bus
c_func
(paren
(paren
op_amp
id|zr-&gt;i2c_adapter
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Check a zoran_params struct for correctness, insert default params */
r_int
DECL|function|zoran_check_jpg_settings
id|zoran_check_jpg_settings
(paren
r_struct
id|zoran
op_star
id|zr
comma
r_struct
id|zoran_jpg_settings
op_star
id|settings
)paren
(brace
r_int
id|err
op_assign
l_int|0
comma
id|err0
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
id|KERN_DEBUG
l_string|&quot;%s: check_jpg_settings() - dec: %d, Hdcm: %d, Vdcm: %d, Tdcm: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|settings-&gt;decimation
comma
id|settings-&gt;HorDcm
comma
id|settings-&gt;VerDcm
comma
id|settings-&gt;TmpDcm
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
id|KERN_DEBUG
l_string|&quot;%s: check_jpg_settings() - x: %d, y: %d, w: %d, y: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|settings-&gt;img_x
comma
id|settings-&gt;img_y
comma
id|settings-&gt;img_width
comma
id|settings-&gt;img_height
)paren
suffix:semicolon
multiline_comment|/* Check decimation, set default values for decimation = 1, 2, 4 */
r_switch
c_cond
(paren
id|settings-&gt;decimation
)paren
(brace
r_case
l_int|1
suffix:colon
id|settings-&gt;HorDcm
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;VerDcm
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;TmpDcm
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;field_per_buff
op_assign
l_int|2
suffix:semicolon
id|settings-&gt;img_x
op_assign
l_int|0
suffix:semicolon
id|settings-&gt;img_y
op_assign
l_int|0
suffix:semicolon
id|settings-&gt;img_width
op_assign
id|BUZ_MAX_WIDTH
suffix:semicolon
id|settings-&gt;img_height
op_assign
id|BUZ_MAX_HEIGHT
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|settings-&gt;HorDcm
op_assign
l_int|2
suffix:semicolon
id|settings-&gt;VerDcm
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;TmpDcm
op_assign
l_int|2
suffix:semicolon
id|settings-&gt;field_per_buff
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;img_x
op_assign
(paren
id|BUZ_MAX_WIDTH
op_eq
l_int|720
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|0
suffix:semicolon
id|settings-&gt;img_y
op_assign
l_int|0
suffix:semicolon
id|settings-&gt;img_width
op_assign
(paren
id|BUZ_MAX_WIDTH
op_eq
l_int|720
)paren
ques
c_cond
l_int|704
suffix:colon
id|BUZ_MAX_WIDTH
suffix:semicolon
id|settings-&gt;img_height
op_assign
id|BUZ_MAX_HEIGHT
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|zr-&gt;card.type
op_eq
id|DC10_new
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_DEBUG
l_string|&quot;%s: check_jpg_settings() - HDec by 4 is not supported on the DC10&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|err0
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
id|settings-&gt;HorDcm
op_assign
l_int|4
suffix:semicolon
id|settings-&gt;VerDcm
op_assign
l_int|2
suffix:semicolon
id|settings-&gt;TmpDcm
op_assign
l_int|2
suffix:semicolon
id|settings-&gt;field_per_buff
op_assign
l_int|1
suffix:semicolon
id|settings-&gt;img_x
op_assign
(paren
id|BUZ_MAX_WIDTH
op_eq
l_int|720
)paren
ques
c_cond
l_int|8
suffix:colon
l_int|0
suffix:semicolon
id|settings-&gt;img_y
op_assign
l_int|0
suffix:semicolon
id|settings-&gt;img_width
op_assign
(paren
id|BUZ_MAX_WIDTH
op_eq
l_int|720
)paren
ques
c_cond
l_int|704
suffix:colon
id|BUZ_MAX_WIDTH
suffix:semicolon
id|settings-&gt;img_height
op_assign
id|BUZ_MAX_HEIGHT
op_div
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* We have to check the data the user has set */
r_if
c_cond
(paren
id|settings-&gt;HorDcm
op_ne
l_int|1
op_logical_and
id|settings-&gt;HorDcm
op_ne
l_int|2
op_logical_and
(paren
id|zr-&gt;card.type
op_eq
id|DC10_new
op_logical_or
id|settings-&gt;HorDcm
op_ne
l_int|4
)paren
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;VerDcm
op_ne
l_int|1
op_logical_and
id|settings-&gt;VerDcm
op_ne
l_int|2
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;TmpDcm
op_ne
l_int|1
op_logical_and
id|settings-&gt;TmpDcm
op_ne
l_int|2
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;field_per_buff
op_ne
l_int|1
op_logical_and
id|settings-&gt;field_per_buff
op_ne
l_int|2
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_x
OL
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_y
OL
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_width
OL
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_height
OL
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_x
op_plus
id|settings-&gt;img_width
OG
id|BUZ_MAX_WIDTH
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_y
op_plus
id|settings-&gt;img_height
OG
id|BUZ_MAX_HEIGHT
op_div
l_int|2
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;HorDcm
op_logical_and
id|settings-&gt;VerDcm
)paren
(brace
r_if
c_cond
(paren
id|settings-&gt;img_width
op_mod
(paren
l_int|16
op_star
id|settings-&gt;HorDcm
)paren
op_ne
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;img_height
op_mod
(paren
l_int|8
op_star
id|settings-&gt;VerDcm
)paren
op_ne
l_int|0
)paren
id|err0
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: check_jpg_settings() - error in params for decimation = 0&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|err
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: check_jpg_settings() - decimation = %d, must be 0, 1, 2 or 4&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|settings-&gt;decimation
)paren
suffix:semicolon
id|err
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.quality
OG
l_int|100
)paren
id|settings-&gt;jpg_comp.quality
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.quality
OL
l_int|5
)paren
id|settings-&gt;jpg_comp.quality
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.APPn
OL
l_int|0
)paren
id|settings-&gt;jpg_comp.APPn
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.APPn
OG
l_int|15
)paren
id|settings-&gt;jpg_comp.APPn
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.APP_len
OL
l_int|0
)paren
id|settings-&gt;jpg_comp.APP_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.APP_len
OG
l_int|60
)paren
id|settings-&gt;jpg_comp.APP_len
op_assign
l_int|60
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.COM_len
OL
l_int|0
)paren
id|settings-&gt;jpg_comp.COM_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|settings-&gt;jpg_comp.COM_len
OG
l_int|60
)paren
id|settings-&gt;jpg_comp.COM_len
op_assign
l_int|60
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|zoran_open_init_params
id|zoran_open_init_params
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* User must explicitly set a window */
id|zr-&gt;overlay_settings.is_set
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;overlay_mask
op_assign
l_int|NULL
suffix:semicolon
id|zr-&gt;overlay_active
op_assign
id|ZORAN_FREE
suffix:semicolon
id|zr-&gt;v4l_memgrab_active
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_overlay_active
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_grab_frame
op_assign
id|NO_GRAB_ACTIVE
suffix:semicolon
id|zr-&gt;v4l_grab_seq
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_settings.width
op_assign
l_int|192
suffix:semicolon
id|zr-&gt;v4l_settings.height
op_assign
l_int|144
suffix:semicolon
id|zr-&gt;v4l_settings.format
op_assign
op_amp
id|zoran_formats
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* YUY2 - YUV-4:2:2 packed */
id|zr-&gt;v4l_settings.bytesperline
op_assign
id|zr-&gt;v4l_settings.width
op_star
(paren
(paren
id|zr-&gt;v4l_settings.format-&gt;depth
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
suffix:semicolon
multiline_comment|/* DMA ring stuff for V4L */
id|zr-&gt;v4l_pend_tail
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_pend_head
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_sync_tail
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_buffers.active
op_assign
id|ZORAN_FREE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
id|zr-&gt;v4l_buffers.buffer
(braket
id|i
)braket
dot
id|state
op_assign
id|BUZ_STATE_USER
suffix:semicolon
multiline_comment|/* nothing going on */
)brace
id|zr-&gt;v4l_buffers.allocated
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BUZ_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
id|zr-&gt;jpg_buffers.buffer
(braket
id|i
)braket
dot
id|state
op_assign
id|BUZ_STATE_USER
suffix:semicolon
multiline_comment|/* nothing going on */
)brace
id|zr-&gt;jpg_buffers.active
op_assign
id|ZORAN_FREE
suffix:semicolon
id|zr-&gt;jpg_buffers.allocated
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set necessary params and call zoran_check_jpg_settings to set the defaults */
id|zr-&gt;jpg_settings.decimation
op_assign
l_int|1
suffix:semicolon
id|zr-&gt;jpg_settings.jpg_comp.quality
op_assign
l_int|50
suffix:semicolon
multiline_comment|/* default compression factor 8 */
r_if
c_cond
(paren
id|zr-&gt;card.type
op_ne
id|BUZ
)paren
id|zr-&gt;jpg_settings.odd_even
op_assign
l_int|1
suffix:semicolon
r_else
id|zr-&gt;jpg_settings.odd_even
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;jpg_settings.jpg_comp.APPn
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;jpg_settings.jpg_comp.APP_len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No APPn marker */
id|memset
c_func
(paren
id|zr-&gt;jpg_settings.jpg_comp.APP_data
comma
l_int|0
comma
r_sizeof
(paren
id|zr-&gt;jpg_settings.jpg_comp.APP_data
)paren
)paren
suffix:semicolon
id|zr-&gt;jpg_settings.jpg_comp.COM_len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* No COM marker */
id|memset
c_func
(paren
id|zr-&gt;jpg_settings.jpg_comp.COM_data
comma
l_int|0
comma
r_sizeof
(paren
id|zr-&gt;jpg_settings.jpg_comp.COM_data
)paren
)paren
suffix:semicolon
id|zr-&gt;jpg_settings.jpg_comp.jpeg_markers
op_assign
id|JPEG_MARKER_DHT
op_or
id|JPEG_MARKER_DQT
suffix:semicolon
id|i
op_assign
id|zoran_check_jpg_settings
c_func
(paren
id|zr
comma
op_amp
id|zr-&gt;jpg_settings
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: zoran_open_init_params() internal error&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|clear_interrupt_counters
c_func
(paren
id|zr
)paren
suffix:semicolon
id|zr-&gt;testing
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__devinit
DECL|function|test_interrupts
id|test_interrupts
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
r_int
id|timeout
comma
id|icr
suffix:semicolon
id|clear_interrupt_counters
c_func
(paren
id|zr
)paren
suffix:semicolon
id|zr-&gt;testing
op_assign
l_int|1
suffix:semicolon
id|icr
op_assign
id|btread
c_func
(paren
id|ZR36057_ICR
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x78000000
op_or
id|ZR36057_ICR_IntPinEn
comma
id|ZR36057_ICR
)paren
suffix:semicolon
id|timeout
op_assign
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|zr-&gt;test_q
comma
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0
comma
id|ZR36057_ICR
)paren
suffix:semicolon
id|btwrite
c_func
(paren
l_int|0x78000000
comma
id|ZR36057_ISR
)paren
suffix:semicolon
id|zr-&gt;testing
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|5
comma
id|KERN_INFO
l_string|&quot;%s: Testing interrupts...&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;: time spent: %d&bslash;n&quot;
comma
l_int|1
op_star
id|HZ
op_minus
id|timeout
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|zr_debug
OG
l_int|1
)paren
id|print_interrupts
c_func
(paren
id|zr
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|icr
comma
id|ZR36057_ICR
)paren
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|zr36057_init
id|zr36057_init
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
r_int
r_int
id|mem
suffix:semicolon
r_void
op_star
id|vdev
suffix:semicolon
r_int
id|mem_needed
suffix:semicolon
r_int
id|j
suffix:semicolon
r_int
id|two
op_assign
l_int|2
suffix:semicolon
r_int
id|zero
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: zr36057_init() - initializing card[%d], zr=%p&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|zr-&gt;id
comma
id|zr
)paren
suffix:semicolon
multiline_comment|/* default setup of all parameters which will persist between opens */
id|zr-&gt;user
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|zr-&gt;v4l_capq
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|zr-&gt;jpg_capq
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|zr-&gt;test_q
)paren
suffix:semicolon
id|zr-&gt;jpg_buffers.allocated
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;v4l_buffers.allocated
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;buffer.base
op_assign
(paren
r_void
op_star
)paren
id|vidmem
suffix:semicolon
id|zr-&gt;buffer.width
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;buffer.height
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;buffer.depth
op_assign
l_int|0
suffix:semicolon
id|zr-&gt;buffer.bytesperline
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Avoid nonsense settings from user for default input/norm */
r_if
c_cond
(paren
id|default_norm
template_param
id|VIDEO_MODE_SECAM
)paren
id|default_norm
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
id|zr-&gt;norm
op_assign
id|default_norm
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|zr-&gt;timing
op_assign
id|zr-&gt;card.tvn
(braket
id|zr-&gt;norm
)braket
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_WARNING
l_string|&quot;%s: zr36057_init() - default TV standard not supported by hardware. PAL will be used.&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
id|zr-&gt;norm
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
id|zr-&gt;timing
op_assign
id|zr-&gt;card.tvn
(braket
id|zr-&gt;norm
)braket
suffix:semicolon
)brace
id|zr-&gt;input
op_assign
id|default_input
op_assign
(paren
id|default_input
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Should the following be reset at every open ? */
id|zr-&gt;hue
op_assign
l_int|32768
suffix:semicolon
id|zr-&gt;contrast
op_assign
l_int|32768
suffix:semicolon
id|zr-&gt;saturation
op_assign
l_int|32768
suffix:semicolon
id|zr-&gt;brightness
op_assign
l_int|32768
suffix:semicolon
multiline_comment|/* default setup (will be repeated at every open) */
id|zoran_open_init_params
c_func
(paren
id|zr
)paren
suffix:semicolon
multiline_comment|/* allocate memory *before* doing anything to the hardware&n;&t; * in case allocation fails */
id|mem_needed
op_assign
id|BUZ_NUM_STAT_COM
op_star
l_int|4
suffix:semicolon
id|mem
op_assign
(paren
r_int
r_int
)paren
id|kmalloc
c_func
(paren
id|mem_needed
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|vdev
op_assign
(paren
r_void
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|video_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
op_logical_or
op_logical_neg
id|vdev
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: zr36057_init() - kmalloc (STAT_COM) failed&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vdev
)paren
id|kfree
c_func
(paren
id|vdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|mem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|mem
comma
l_int|0
comma
id|mem_needed
)paren
suffix:semicolon
id|zr-&gt;stat_com
op_assign
(paren
id|u32
op_star
)paren
id|mem
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|BUZ_NUM_STAT_COM
suffix:semicolon
id|j
op_increment
)paren
(brace
id|zr-&gt;stat_com
(braket
id|j
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* mark as unavailable to zr36057 */
)brace
multiline_comment|/*&n;&t; *   Now add the template and register the device unit.&n;&t; */
id|zr-&gt;video_dev
op_assign
id|vdev
suffix:semicolon
id|memcpy
c_func
(paren
id|zr-&gt;video_dev
comma
op_amp
id|zoran_template
comma
r_sizeof
(paren
id|zoran_template
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|zr-&gt;video_dev-&gt;name
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
id|zr-&gt;video_dev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
)paren
OL
l_int|0
)paren
(brace
id|zoran_unregister_i2c
c_func
(paren
id|zr
)paren
suffix:semicolon
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|zr-&gt;stat_com
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|vdev
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|zoran_init_hardware
c_func
(paren
id|zr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|zr_debug
OG
l_int|2
)paren
id|detect_guest_activity
c_func
(paren
id|zr
)paren
suffix:semicolon
id|test_interrupts
c_func
(paren
id|zr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pass_through
)paren
(brace
id|decoder_command
c_func
(paren
id|zr
comma
id|DECODER_ENABLE_OUTPUT
comma
op_amp
id|zero
)paren
suffix:semicolon
id|encoder_command
c_func
(paren
id|zr
comma
id|ENCODER_SET_INPUT
comma
op_amp
id|two
)paren
suffix:semicolon
)brace
id|zr-&gt;zoran_proc
op_assign
l_int|NULL
suffix:semicolon
id|zr-&gt;initialized
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|zoran_release
id|zoran_release
(paren
r_struct
id|zoran
op_star
id|zr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|zr-&gt;initialized
)paren
r_return
suffix:semicolon
multiline_comment|/* unregister videocodec bus */
r_if
c_cond
(paren
id|zr-&gt;codec
)paren
(brace
r_struct
id|videocodec_master
op_star
id|master
op_assign
id|zr-&gt;codec-&gt;master_data
suffix:semicolon
id|videocodec_detach
c_func
(paren
id|zr-&gt;codec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master
)paren
id|kfree
c_func
(paren
id|master
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zr-&gt;vfe
)paren
(brace
r_struct
id|videocodec_master
op_star
id|master
op_assign
id|zr-&gt;vfe-&gt;master_data
suffix:semicolon
id|videocodec_detach
c_func
(paren
id|zr-&gt;vfe
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master
)paren
id|kfree
c_func
(paren
id|master
)paren
suffix:semicolon
)brace
multiline_comment|/* unregister i2c bus */
id|zoran_unregister_i2c
c_func
(paren
id|zr
)paren
suffix:semicolon
multiline_comment|/* disable PCI bus-mastering */
id|zoran_set_pci_master
c_func
(paren
id|zr
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* put chip into reset */
id|btwrite
c_func
(paren
l_int|0
comma
id|ZR36057_SPGPPCR
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|zr-&gt;pci_dev-&gt;irq
comma
id|zr
)paren
suffix:semicolon
multiline_comment|/* unmap and free memory */
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|zr-&gt;stat_com
)paren
suffix:semicolon
id|zoran_proc_cleanup
c_func
(paren
id|zr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|zr-&gt;zr36057_mem
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|zr-&gt;pci_dev
)paren
suffix:semicolon
id|video_unregister_device
c_func
(paren
id|zr-&gt;video_dev
)paren
suffix:semicolon
)brace
r_void
DECL|function|zoran_vdev_release
id|zoran_vdev_release
(paren
r_struct
id|video_device
op_star
id|vdev
)paren
(brace
id|kfree
c_func
(paren
id|vdev
)paren
suffix:semicolon
)brace
r_static
r_struct
id|videocodec_master
op_star
id|__devinit
DECL|function|zoran_setup_videocodec
id|zoran_setup_videocodec
(paren
r_struct
id|zoran
op_star
id|zr
comma
r_int
id|type
)paren
(brace
r_struct
id|videocodec_master
op_star
id|m
op_assign
l_int|NULL
suffix:semicolon
id|m
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|videocodec_master
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|m
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: zoran_setup_videocodec() - no memory&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_return
id|m
suffix:semicolon
)brace
id|m-&gt;magic
op_assign
l_int|0L
suffix:semicolon
multiline_comment|/* magic not used */
id|m-&gt;type
op_assign
id|VID_HARDWARE_ZR36067
suffix:semicolon
id|m-&gt;flags
op_assign
id|CODEC_FLAG_ENCODER
op_or
id|CODEC_FLAG_DECODER
suffix:semicolon
id|strncpy
c_func
(paren
id|m-&gt;name
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
r_sizeof
(paren
id|m-&gt;name
)paren
)paren
suffix:semicolon
id|m-&gt;data
op_assign
id|zr
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|CODEC_TYPE_ZR36060
suffix:colon
id|m-&gt;readreg
op_assign
id|zr36060_read
suffix:semicolon
id|m-&gt;writereg
op_assign
id|zr36060_write
suffix:semicolon
id|m-&gt;flags
op_or_assign
id|CODEC_FLAG_JPEG
op_or
id|CODEC_FLAG_VFE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_TYPE_ZR36050
suffix:colon
id|m-&gt;readreg
op_assign
id|zr36050_read
suffix:semicolon
id|m-&gt;writereg
op_assign
id|zr36050_write
suffix:semicolon
id|m-&gt;flags
op_or_assign
id|CODEC_FLAG_JPEG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_TYPE_ZR36016
suffix:colon
id|m-&gt;readreg
op_assign
id|zr36016_read
suffix:semicolon
id|m-&gt;writereg
op_assign
id|zr36016_write
suffix:semicolon
id|m-&gt;flags
op_or_assign
id|CODEC_FLAG_VFE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|m
suffix:semicolon
)brace
multiline_comment|/*&n; *   Scan for a Buz card (actually for the PCI contoler ZR36057),&n; *   request the irq and map the io memory&n; */
r_static
r_int
id|__devinit
DECL|function|find_zr36057
id|find_zr36057
(paren
r_void
)paren
(brace
r_int
r_char
id|latency
comma
id|need_latency
suffix:semicolon
r_struct
id|zoran
op_star
id|zr
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|result
suffix:semicolon
r_struct
id|videocodec_master
op_star
id|master_vfe
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|videocodec_master
op_star
id|master_codec
op_assign
l_int|NULL
suffix:semicolon
r_int
id|card_num
suffix:semicolon
r_char
op_star
id|i2c_enc_name
comma
op_star
id|i2c_dec_name
comma
op_star
id|codec_name
comma
op_star
id|vfe_name
suffix:semicolon
id|zoran_num
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|zoran_num
OL
id|BUZ_MAX
op_logical_and
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_ZORAN
comma
id|PCI_DEVICE_ID_ZORAN_36057
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|card_num
op_assign
id|card
(braket
id|zoran_num
)braket
suffix:semicolon
id|zr
op_assign
op_amp
id|zoran
(braket
id|zoran_num
)braket
suffix:semicolon
id|memset
c_func
(paren
id|zr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zoran
)paren
)paren
suffix:semicolon
singleline_comment|// Just in case if previous cycle failed
id|zr-&gt;pci_dev
op_assign
id|dev
suffix:semicolon
singleline_comment|//zr-&gt;zr36057_mem = NULL;
id|zr-&gt;id
op_assign
id|zoran_num
suffix:semicolon
id|snprintf
c_func
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
r_sizeof
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
comma
l_string|&quot;MJPEG[%u]&quot;
comma
id|zr-&gt;id
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|zr-&gt;spinlock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|zr-&gt;resource_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|dev
)paren
)paren
r_continue
suffix:semicolon
id|zr-&gt;zr36057_adr
op_assign
id|pci_resource_start
c_func
(paren
id|zr-&gt;pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|zr-&gt;pci_dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|zr-&gt;revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zr-&gt;revision
OL
l_int|2
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: Zoran ZR36057 (rev %d) irq: %d, memory: 0x%08x.&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|zr-&gt;revision
comma
id|zr-&gt;pci_dev-&gt;irq
comma
id|zr-&gt;zr36057_adr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card_num
op_eq
op_minus
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - no card specified, please use the card=X insmod option&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|ss_vendor
comma
id|ss_device
suffix:semicolon
id|ss_vendor
op_assign
id|zr-&gt;pci_dev-&gt;subsystem_vendor
suffix:semicolon
id|ss_device
op_assign
id|zr-&gt;pci_dev-&gt;subsystem_device
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: Zoran ZR36067 (rev %d) irq: %d, memory: 0x%08x&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|zr-&gt;revision
comma
id|zr-&gt;pci_dev-&gt;irq
comma
id|zr-&gt;zr36057_adr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: subsystem vendor=0x%04x id=0x%04x&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|ss_vendor
comma
id|ss_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card_num
op_eq
op_minus
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: find_zr36057() - trying to autodetect card type&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ss_vendor
op_eq
id|zoran_cards
(braket
id|i
)braket
dot
id|vendor_id
op_logical_and
id|ss_device
op_eq
id|zoran_cards
(braket
id|i
)braket
dot
id|device_id
)paren
(brace
id|dprintk
c_func
(paren
l_int|3
comma
id|KERN_DEBUG
l_string|&quot;%s: find_zr36057() - card %s detected&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|zoran_cards
(braket
id|i
)braket
dot
id|name
)paren
suffix:semicolon
id|card_num
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|NUM_CARDS
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - unknown card&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|card_num
OL
l_int|0
op_logical_or
id|card_num
op_ge
id|NUM_CARDS
)paren
(brace
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - invalid cardnum %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|card_num
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* even though we make this a non pointer and thus&n;&t;&t; * theoretically allow for making changes to this struct&n;&t;&t; * on a per-individual card basis at runtime, this is&n;&t;&t; * strongly discouraged. This structure is intended to&n;&t;&t; * keep general card information, no settings or anything */
id|zr-&gt;card
op_assign
id|zoran_cards
(braket
id|card_num
)braket
suffix:semicolon
id|snprintf
c_func
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
r_sizeof
(paren
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
comma
l_string|&quot;%s[%u]&quot;
comma
id|zr-&gt;card.name
comma
id|zr-&gt;id
)paren
suffix:semicolon
id|zr-&gt;zr36057_mem
op_assign
id|ioremap_nocache
c_func
(paren
id|zr-&gt;zr36057_adr
comma
l_int|0x1000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|zr-&gt;zr36057_mem
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - ioremap failed&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|result
op_assign
id|request_irq
c_func
(paren
id|zr-&gt;pci_dev-&gt;irq
comma
id|zoran_irq
comma
id|SA_SHIRQ
op_or
id|SA_INTERRUPT
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
(paren
r_void
op_star
)paren
id|zr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EINVAL
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - bad irq number or handler&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|EBUSY
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - IRQ %d busy, change your PnP config in BIOS&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|zr-&gt;pci_dev-&gt;irq
)paren
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - can&squot;t assign irq, error code %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|result
)paren
suffix:semicolon
)brace
r_goto
id|zr_unmap
suffix:semicolon
)brace
multiline_comment|/* set PCI latency timer */
id|pci_read_config_byte
c_func
(paren
id|zr-&gt;pci_dev
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|latency
)paren
suffix:semicolon
id|need_latency
op_assign
id|zr-&gt;revision
OG
l_int|1
ques
c_cond
l_int|32
suffix:colon
l_int|48
suffix:semicolon
r_if
c_cond
(paren
id|latency
op_ne
id|need_latency
)paren
(brace
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_INFO
l_string|&quot;%s: Changing PCI latency from %d to %d.&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|latency
comma
id|need_latency
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|zr-&gt;pci_dev
comma
id|PCI_LATENCY_TIMER
comma
id|need_latency
)paren
suffix:semicolon
)brace
id|zr36057_restart
c_func
(paren
id|zr
)paren
suffix:semicolon
multiline_comment|/* i2c */
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_INFO
l_string|&quot;%s: Initializing i2c bus...&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
multiline_comment|/* i2c decoder */
r_if
c_cond
(paren
id|decoder
(braket
id|zr-&gt;id
)braket
op_ne
op_minus
l_int|1
)paren
(brace
id|i2c_dec_name
op_assign
id|i2cid_to_modulename
c_func
(paren
id|decoder
(braket
id|zr-&gt;id
)braket
)paren
suffix:semicolon
id|zr-&gt;card.i2c_decoder
op_assign
id|decoder
(braket
id|zr-&gt;id
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|zr-&gt;card.i2c_decoder
op_ne
l_int|0
)paren
(brace
id|i2c_dec_name
op_assign
id|i2cid_to_modulename
c_func
(paren
id|zr-&gt;card.i2c_decoder
)paren
suffix:semicolon
)brace
r_else
(brace
id|i2c_dec_name
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_dec_name
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
id|i2c_dec_name
)paren
)paren
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: failed to load module %s: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|i2c_dec_name
comma
id|result
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* i2c encoder */
r_if
c_cond
(paren
id|encoder
(braket
id|zr-&gt;id
)braket
op_ne
op_minus
l_int|1
)paren
(brace
id|i2c_enc_name
op_assign
id|i2cid_to_modulename
c_func
(paren
id|encoder
(braket
id|zr-&gt;id
)braket
)paren
suffix:semicolon
id|zr-&gt;card.i2c_encoder
op_assign
id|encoder
(braket
id|zr-&gt;id
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|zr-&gt;card.i2c_encoder
op_ne
l_int|0
)paren
(brace
id|i2c_enc_name
op_assign
id|i2cid_to_modulename
c_func
(paren
id|zr-&gt;card.i2c_encoder
)paren
suffix:semicolon
)brace
r_else
(brace
id|i2c_enc_name
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_enc_name
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
id|i2c_enc_name
)paren
)paren
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: failed to load module %s: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|i2c_enc_name
comma
id|result
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|zoran_register_i2c
c_func
(paren
id|zr
)paren
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - can&squot;t initialize i2c bus&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_goto
id|zr_free_irq
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|2
comma
id|KERN_INFO
l_string|&quot;%s: Initializing videocodec bus...&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zr-&gt;card.video_codec
op_ne
l_int|0
op_logical_and
(paren
id|codec_name
op_assign
id|codecid_to_modulename
c_func
(paren
id|zr-&gt;card.video_codec
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
id|codec_name
)paren
)paren
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: failed to load modules %s: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|codec_name
comma
id|result
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|zr-&gt;card.video_vfe
op_ne
l_int|0
op_logical_and
(paren
id|vfe_name
op_assign
id|codecid_to_modulename
c_func
(paren
id|zr-&gt;card.video_vfe
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
id|vfe_name
)paren
)paren
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: failed to load modules %s: %d&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
comma
id|vfe_name
comma
id|result
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* reset JPEG codec */
id|jpeg_codec_sleep
c_func
(paren
id|zr
comma
l_int|1
)paren
suffix:semicolon
id|jpeg_codec_reset
c_func
(paren
id|zr
)paren
suffix:semicolon
multiline_comment|/* video bus enabled */
multiline_comment|/* display codec revision */
r_if
c_cond
(paren
id|zr-&gt;card.video_codec
op_ne
l_int|0
)paren
(brace
id|master_codec
op_assign
id|zoran_setup_videocodec
c_func
(paren
id|zr
comma
id|zr-&gt;card.video_codec
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|master_codec
)paren
r_goto
id|zr_unreg_i2c
suffix:semicolon
id|zr-&gt;codec
op_assign
id|videocodec_attach
c_func
(paren
id|master_codec
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|zr-&gt;codec
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - no codec found&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_goto
id|zr_free_codec
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zr-&gt;codec-&gt;type
op_ne
id|zr-&gt;card.video_codec
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - wrong codec&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_goto
id|zr_detach_codec
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|zr-&gt;card.video_vfe
op_ne
l_int|0
)paren
(brace
id|master_vfe
op_assign
id|zoran_setup_videocodec
c_func
(paren
id|zr
comma
id|zr-&gt;card.video_vfe
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|master_vfe
)paren
r_goto
id|zr_detach_codec
suffix:semicolon
id|zr-&gt;vfe
op_assign
id|videocodec_attach
c_func
(paren
id|master_vfe
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|zr-&gt;vfe
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() - no VFE found&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_goto
id|zr_free_vfe
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zr-&gt;vfe-&gt;type
op_ne
id|zr-&gt;card.video_vfe
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: find_zr36057() = wrong VFE&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
r_goto
id|zr_detach_vfe
suffix:semicolon
)brace
)brace
id|zoran_num
op_increment
suffix:semicolon
r_continue
suffix:semicolon
singleline_comment|// Init errors
id|zr_detach_vfe
suffix:colon
id|videocodec_detach
c_func
(paren
id|zr-&gt;vfe
)paren
suffix:semicolon
id|zr_free_vfe
suffix:colon
id|kfree
c_func
(paren
id|master_vfe
)paren
suffix:semicolon
id|zr_detach_codec
suffix:colon
id|videocodec_detach
c_func
(paren
id|zr-&gt;codec
)paren
suffix:semicolon
id|zr_free_codec
suffix:colon
id|kfree
c_func
(paren
id|master_codec
)paren
suffix:semicolon
id|zr_unreg_i2c
suffix:colon
id|zoran_unregister_i2c
c_func
(paren
id|zr
)paren
suffix:semicolon
id|zr_free_irq
suffix:colon
id|btwrite
c_func
(paren
l_int|0
comma
id|ZR36057_SPGPPCR
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|zr-&gt;pci_dev-&gt;irq
comma
id|zr
)paren
suffix:semicolon
id|zr_unmap
suffix:colon
id|iounmap
c_func
(paren
id|zr-&gt;zr36057_mem
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zoran_num
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;No known MJPEG cards found.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|zoran_num
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|init_dc10_cards
id|init_dc10_cards
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|zoran
comma
l_int|0
comma
r_sizeof
(paren
id|zoran
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Zoran MJPEG board driver version %d.%d.%d&bslash;n&quot;
comma
id|MAJOR_VERSION
comma
id|MINOR_VERSION
comma
id|RELEASE_VERSION
)paren
suffix:semicolon
multiline_comment|/* Look for cards */
r_if
c_cond
(paren
id|find_zr36057
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zoran_num
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: %d card(s) found&bslash;n&quot;
comma
id|ZORAN_NAME
comma
id|zoran_num
)paren
suffix:semicolon
multiline_comment|/* check the parameters we have been given, adjust if necessary */
r_if
c_cond
(paren
id|v4l_nbufs
OL
l_int|2
)paren
id|v4l_nbufs
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|v4l_nbufs
OG
id|VIDEO_MAX_FRAME
)paren
id|v4l_nbufs
op_assign
id|VIDEO_MAX_FRAME
suffix:semicolon
multiline_comment|/* The user specfies the in KB, we want them in byte&n;&t; * (and page aligned) */
id|v4l_bufsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|v4l_bufsize
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v4l_bufsize
OL
l_int|32768
)paren
id|v4l_bufsize
op_assign
l_int|32768
suffix:semicolon
multiline_comment|/* 2 MB is arbitrary but sufficient for the maximum possible images */
r_if
c_cond
(paren
id|v4l_bufsize
OG
l_int|2048
op_star
l_int|1024
)paren
id|v4l_bufsize
op_assign
l_int|2048
op_star
l_int|1024
suffix:semicolon
r_if
c_cond
(paren
id|jpg_nbufs
OL
l_int|4
)paren
id|jpg_nbufs
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|jpg_nbufs
OG
id|BUZ_MAX_FRAME
)paren
id|jpg_nbufs
op_assign
id|BUZ_MAX_FRAME
suffix:semicolon
id|jpg_bufsize
op_assign
id|PAGE_ALIGN
c_func
(paren
id|jpg_bufsize
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|jpg_bufsize
OL
l_int|8192
)paren
id|jpg_bufsize
op_assign
l_int|8192
suffix:semicolon
r_if
c_cond
(paren
id|jpg_bufsize
OG
(paren
l_int|512
op_star
l_int|1024
)paren
)paren
id|jpg_bufsize
op_assign
l_int|512
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* Use parameter for vidmem or try to find a video card */
r_if
c_cond
(paren
id|vidmem
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: Using supplied video memory base address @ 0x%lx&bslash;n&quot;
comma
id|ZORAN_NAME
comma
id|vidmem
)paren
suffix:semicolon
)brace
multiline_comment|/* random nonsense */
id|dprintk
c_func
(paren
l_int|5
comma
id|KERN_DEBUG
l_string|&quot;Jotti is een held!&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* some mainboards might not do PCI-PCI data transfer well */
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_FAIL
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_WARNING
l_string|&quot;%s: chipset may not support reliable PCI-PCI DMA&bslash;n&quot;
comma
id|ZORAN_NAME
)paren
suffix:semicolon
)brace
multiline_comment|/* take care of Natoma chipset and a revision 1 zr36057 */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|zoran_num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|zoran
op_star
id|zr
op_assign
op_amp
id|zoran
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_NATOMA
op_logical_and
id|zr-&gt;revision
op_le
l_int|1
)paren
(brace
id|zr-&gt;jpg_buffers.need_contiguous
op_assign
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: ZR36057/Natoma bug, max. buffer size is 128K&bslash;n&quot;
comma
id|ZR_DEVNAME
c_func
(paren
id|zr
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zr36057_init
c_func
(paren
id|zr
)paren
OL
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|zoran_num
suffix:semicolon
id|i
op_increment
)paren
id|zoran_release
c_func
(paren
op_amp
id|zoran
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|zoran_proc_init
c_func
(paren
id|zr
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|unload_dc10_cards
id|unload_dc10_cards
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|zoran_num
suffix:semicolon
id|i
op_increment
)paren
id|zoran_release
c_func
(paren
op_amp
id|zoran
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
DECL|variable|init_dc10_cards
id|module_init
c_func
(paren
id|init_dc10_cards
)paren
suffix:semicolon
DECL|variable|unload_dc10_cards
id|module_exit
c_func
(paren
id|unload_dc10_cards
)paren
suffix:semicolon
eof
