multiline_comment|/* &n; * Motion Eye video4linux driver for Sony Vaio PictureBook&n; *&n; * Copyright (C) 2001 Stelian Pop &lt;stelian.pop@fr.alcove.com&gt;, Alc&#xfffd;ve&n; *&n; * Copyright (C) 2000 Andrew Tridgell &lt;tridge@valinux.com&gt;&n; *&n; * Earlier work by Werner Almesberger, Paul `Rusty&squot; Russell and Paul Mackerras.&n; *&n; * Some parts borrowed from various video4linux drivers, especially&n; * bttv-driver.c and zoran.c, see original files for credits.&n; * &n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; * &n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/wrapper.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &quot;meye.h&quot;
macro_line|#include &quot;linux/meye.h&quot;
multiline_comment|/* driver structure - only one possible */
DECL|variable|meye
r_static
r_struct
id|meye
id|meye
suffix:semicolon
multiline_comment|/* number of grab buffers */
DECL|variable|gbuffers
r_static
r_int
r_int
id|gbuffers
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* size of a grab buffer */
DECL|variable|gbufsize
r_static
r_int
r_int
id|gbufsize
op_assign
id|MEYE_MAX_BUFSIZE
suffix:semicolon
multiline_comment|/* /dev/videoX registration number */
DECL|variable|video_nr
r_static
r_int
id|video_nr
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/****************************************************************************/
multiline_comment|/* Queue routines                                                           */
multiline_comment|/****************************************************************************/
multiline_comment|/* Inits the queue */
DECL|function|meye_initq
r_static
r_inline
r_void
id|meye_initq
c_func
(paren
r_struct
id|meye_queue
op_star
id|queue
)paren
(brace
id|queue-&gt;head
op_assign
id|queue-&gt;tail
op_assign
l_int|0
suffix:semicolon
id|queue-&gt;len
op_assign
l_int|0
suffix:semicolon
id|queue-&gt;s_lock
op_assign
(paren
id|spinlock_t
)paren
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|queue-&gt;proc_list
)paren
suffix:semicolon
)brace
multiline_comment|/* Pulls an element from the queue */
DECL|function|meye_pullq
r_static
r_inline
r_int
id|meye_pullq
c_func
(paren
r_struct
id|meye_queue
op_star
id|queue
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|queue-&gt;len
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|result
op_assign
id|queue-&gt;buf
(braket
id|queue-&gt;head
)braket
suffix:semicolon
id|queue-&gt;head
op_increment
suffix:semicolon
id|queue-&gt;head
op_and_assign
(paren
id|MEYE_QUEUE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|queue-&gt;len
op_decrement
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* Pushes an element into the queue */
DECL|function|meye_pushq
r_static
r_inline
r_void
id|meye_pushq
c_func
(paren
r_struct
id|meye_queue
op_star
id|queue
comma
r_int
id|element
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue-&gt;len
op_eq
id|MEYE_QUEUE_SIZE
)paren
(brace
multiline_comment|/* remove the first element */
id|queue-&gt;head
op_increment
suffix:semicolon
id|queue-&gt;head
op_and_assign
(paren
id|MEYE_QUEUE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|queue-&gt;len
op_decrement
suffix:semicolon
)brace
id|queue-&gt;buf
(braket
id|queue-&gt;tail
)braket
op_assign
id|element
suffix:semicolon
id|queue-&gt;tail
op_increment
suffix:semicolon
id|queue-&gt;tail
op_and_assign
(paren
id|MEYE_QUEUE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|queue-&gt;len
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Tests if the queue is empty */
DECL|function|meye_emptyq
r_static
r_inline
r_int
id|meye_emptyq
c_func
(paren
r_struct
id|meye_queue
op_star
id|queue
comma
r_int
op_star
id|elem
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
(paren
id|queue-&gt;len
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|result
op_logical_and
id|elem
)paren
op_star
id|elem
op_assign
id|queue-&gt;buf
(braket
id|queue-&gt;head
)braket
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|queue-&gt;s_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* Memory allocation routines (stolen from bttv-driver.c)                   */
multiline_comment|/****************************************************************************/
DECL|macro|MDEBUG
mdefine_line|#define MDEBUG(x)&t;do {} while (0)
multiline_comment|/* #define MDEBUG(x)&t;x */
multiline_comment|/* Given PGD from the address space&squot;s page table, return the kernel&n; * virtual mapping of the physical memory mapped at ADR.&n; */
DECL|function|uvirt_to_kva
r_static
r_inline
r_int
r_int
id|uvirt_to_kva
c_func
(paren
id|pgd_t
op_star
id|pgd
comma
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|ret
op_assign
l_int|0UL
suffix:semicolon
id|pmd_t
op_star
id|pmd
suffix:semicolon
id|pte_t
op_star
id|ptep
comma
id|pte
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pgd_none
c_func
(paren
op_star
id|pgd
)paren
)paren
(brace
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|pgd
comma
id|adr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmd_none
c_func
(paren
op_star
id|pmd
)paren
)paren
(brace
id|ptep
op_assign
id|pte_offset
c_func
(paren
id|pmd
comma
id|adr
)paren
suffix:semicolon
id|pte
op_assign
op_star
id|ptep
suffix:semicolon
r_if
c_cond
(paren
id|pte_present
c_func
(paren
id|pte
)paren
)paren
(brace
id|ret
op_assign
(paren
r_int
r_int
)paren
id|page_address
c_func
(paren
id|pte_page
c_func
(paren
id|pte
)paren
)paren
suffix:semicolon
id|ret
op_or_assign
(paren
id|adr
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;uv2kva(%lx--&gt;%lx)&bslash;n&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|uvirt_to_bus
r_static
r_inline
r_int
r_int
id|uvirt_to_bus
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|kva
comma
id|ret
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset
c_func
(paren
id|current-&gt;mm
comma
id|adr
)paren
comma
id|adr
)paren
suffix:semicolon
id|ret
op_assign
id|virt_to_bus
c_func
(paren
(paren
r_void
op_star
)paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;uv2b(%lx--&gt;%lx)&bslash;n&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|kvirt_to_bus
r_static
r_inline
r_int
r_int
id|kvirt_to_bus
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|va
comma
id|kva
comma
id|ret
suffix:semicolon
id|va
op_assign
id|VMALLOC_VMADDR
c_func
(paren
id|adr
)paren
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset_k
c_func
(paren
id|va
)paren
comma
id|va
)paren
suffix:semicolon
id|ret
op_assign
id|virt_to_bus
c_func
(paren
(paren
r_void
op_star
)paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;kv2b(%lx--&gt;%lx)&bslash;n&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Here we want the physical address of the memory.&n; * This is used when initializing the contents of the&n; * area and marking the pages as reserved.&n; */
DECL|function|kvirt_to_pa
r_static
r_inline
r_int
r_int
id|kvirt_to_pa
c_func
(paren
r_int
r_int
id|adr
)paren
(brace
r_int
r_int
id|va
comma
id|kva
comma
id|ret
suffix:semicolon
id|va
op_assign
id|VMALLOC_VMADDR
c_func
(paren
id|adr
)paren
suffix:semicolon
id|kva
op_assign
id|uvirt_to_kva
c_func
(paren
id|pgd_offset_k
c_func
(paren
id|va
)paren
comma
id|va
)paren
suffix:semicolon
id|ret
op_assign
id|__pa
c_func
(paren
id|kva
)paren
suffix:semicolon
id|MDEBUG
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;kv2pa(%lx--&gt;%lx)&bslash;n&quot;
comma
id|adr
comma
id|ret
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|rvmalloc
r_static
r_void
op_star
id|rvmalloc
c_func
(paren
r_int
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
suffix:semicolon
r_int
r_int
id|adr
comma
id|page
suffix:semicolon
id|mem
op_assign
id|vmalloc_32
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
(brace
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* Clear the ram out, no junk to the user */
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|adr
)paren
suffix:semicolon
id|mem_map_reserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|__va
c_func
(paren
id|page
)paren
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|rvfree
r_static
r_void
id|rvfree
c_func
(paren
r_void
op_star
id|mem
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|adr
comma
id|page
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
(brace
id|adr
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|adr
)paren
suffix:semicolon
id|mem_map_unreserve
c_func
(paren
id|virt_to_page
c_func
(paren
id|__va
c_func
(paren
id|page
)paren
)paren
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* return a page table pointing to N pages of locked memory */
DECL|function|ptable_alloc
r_static
r_void
op_star
id|ptable_alloc
c_func
(paren
r_int
id|npages
comma
id|u32
op_star
id|pt_addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_void
op_star
id|vmem
suffix:semicolon
id|u32
op_star
id|ptable
suffix:semicolon
r_int
r_int
id|adr
suffix:semicolon
id|vmem
op_assign
id|rvmalloc
c_func
(paren
(paren
id|npages
op_plus
l_int|1
)paren
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vmem
)paren
r_return
l_int|NULL
suffix:semicolon
id|adr
op_assign
(paren
r_int
r_int
)paren
id|vmem
suffix:semicolon
id|ptable
op_assign
(paren
id|u32
op_star
)paren
(paren
id|vmem
op_plus
id|npages
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ptable
(braket
id|i
)braket
op_assign
(paren
id|u32
)paren
id|kvirt_to_bus
c_func
(paren
id|adr
)paren
suffix:semicolon
id|adr
op_add_assign
id|PAGE_SIZE
suffix:semicolon
)brace
op_star
id|pt_addr
op_assign
(paren
id|u32
)paren
id|kvirt_to_bus
c_func
(paren
id|adr
)paren
suffix:semicolon
r_return
id|vmem
suffix:semicolon
)brace
DECL|function|ptable_free
r_static
r_void
id|ptable_free
c_func
(paren
r_void
op_star
id|vmem
comma
r_int
id|npages
)paren
(brace
id|rvfree
c_func
(paren
id|vmem
comma
(paren
id|npages
op_plus
l_int|1
)paren
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* JPEG tables at different qualities to load into the VRJ chip             */
multiline_comment|/****************************************************************************/
multiline_comment|/* return a set of quantisation tables based on a quality from 1 to 10 */
DECL|function|jpeg_quantisation_tables
r_static
id|u16
op_star
id|jpeg_quantisation_tables
c_func
(paren
r_int
op_star
id|size
comma
r_int
id|quality
)paren
(brace
r_static
id|u16
id|tables0
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0xff00
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0xff01
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables1
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x5000
comma
l_int|0x3c37
comma
l_int|0x3c46
comma
l_int|0x5032
comma
l_int|0x4146
comma
l_int|0x5a46
comma
l_int|0x5055
comma
l_int|0x785f
comma
l_int|0x82c8
comma
l_int|0x6e78
comma
l_int|0x786e
comma
l_int|0xaff5
comma
l_int|0x91b9
comma
l_int|0xffc8
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x5501
comma
l_int|0x5a5a
comma
l_int|0x6978
comma
l_int|0xeb78
comma
l_int|0x8282
comma
l_int|0xffeb
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables2
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x2800
comma
l_int|0x1e1c
comma
l_int|0x1e23
comma
l_int|0x2819
comma
l_int|0x2123
comma
l_int|0x2d23
comma
l_int|0x282b
comma
l_int|0x3c30
comma
l_int|0x4164
comma
l_int|0x373c
comma
l_int|0x3c37
comma
l_int|0x587b
comma
l_int|0x495d
comma
l_int|0x9164
comma
l_int|0x9980
comma
l_int|0x8f96
comma
l_int|0x8c80
comma
l_int|0xa08a
comma
l_int|0xe6b4
comma
l_int|0xa0c3
comma
l_int|0xdaaa
comma
l_int|0x8aad
comma
l_int|0xc88c
comma
l_int|0xcbff
comma
l_int|0xeeda
comma
l_int|0xfff5
comma
l_int|0xffff
comma
l_int|0xc19b
comma
l_int|0xffff
comma
l_int|0xfaff
comma
l_int|0xe6ff
comma
l_int|0xfffd
comma
l_int|0xfff8
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x2b01
comma
l_int|0x2d2d
comma
l_int|0x353c
comma
l_int|0x763c
comma
l_int|0x4141
comma
l_int|0xf876
comma
l_int|0x8ca5
comma
l_int|0xf8a5
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xf8f8
comma
l_int|0xfff8
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables3
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1b00
comma
l_int|0x1412
comma
l_int|0x1417
comma
l_int|0x1b11
comma
l_int|0x1617
comma
l_int|0x1e17
comma
l_int|0x1b1c
comma
l_int|0x2820
comma
l_int|0x2b42
comma
l_int|0x2528
comma
l_int|0x2825
comma
l_int|0x3a51
comma
l_int|0x303d
comma
l_int|0x6042
comma
l_int|0x6555
comma
l_int|0x5f64
comma
l_int|0x5d55
comma
l_int|0x6a5b
comma
l_int|0x9978
comma
l_int|0x6a81
comma
l_int|0x9071
comma
l_int|0x5b73
comma
l_int|0x855d
comma
l_int|0x86b5
comma
l_int|0x9e90
comma
l_int|0xaba3
comma
l_int|0xabad
comma
l_int|0x8067
comma
l_int|0xc9bc
comma
l_int|0xa6ba
comma
l_int|0x99c7
comma
l_int|0xaba8
comma
l_int|0xffa4
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1c01
comma
l_int|0x1e1e
comma
l_int|0x2328
comma
l_int|0x4e28
comma
l_int|0x2b2b
comma
l_int|0xa44e
comma
l_int|0x5d6e
comma
l_int|0xa46e
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xa4a4
comma
l_int|0xffa4
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables4
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1400
comma
l_int|0x0f0e
comma
l_int|0x0f12
comma
l_int|0x140d
comma
l_int|0x1012
comma
l_int|0x1712
comma
l_int|0x1415
comma
l_int|0x1e18
comma
l_int|0x2132
comma
l_int|0x1c1e
comma
l_int|0x1e1c
comma
l_int|0x2c3d
comma
l_int|0x242e
comma
l_int|0x4932
comma
l_int|0x4c40
comma
l_int|0x474b
comma
l_int|0x4640
comma
l_int|0x5045
comma
l_int|0x735a
comma
l_int|0x5062
comma
l_int|0x6d55
comma
l_int|0x4556
comma
l_int|0x6446
comma
l_int|0x6588
comma
l_int|0x776d
comma
l_int|0x817b
comma
l_int|0x8182
comma
l_int|0x604e
comma
l_int|0x978d
comma
l_int|0x7d8c
comma
l_int|0x7396
comma
l_int|0x817e
comma
l_int|0xff7c
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1501
comma
l_int|0x1717
comma
l_int|0x1a1e
comma
l_int|0x3b1e
comma
l_int|0x2121
comma
l_int|0x7c3b
comma
l_int|0x4653
comma
l_int|0x7c53
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0x7c7c
comma
l_int|0xff7c
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables5
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1000
comma
l_int|0x0c0b
comma
l_int|0x0c0e
comma
l_int|0x100a
comma
l_int|0x0d0e
comma
l_int|0x120e
comma
l_int|0x1011
comma
l_int|0x1813
comma
l_int|0x1a28
comma
l_int|0x1618
comma
l_int|0x1816
comma
l_int|0x2331
comma
l_int|0x1d25
comma
l_int|0x3a28
comma
l_int|0x3d33
comma
l_int|0x393c
comma
l_int|0x3833
comma
l_int|0x4037
comma
l_int|0x5c48
comma
l_int|0x404e
comma
l_int|0x5744
comma
l_int|0x3745
comma
l_int|0x5038
comma
l_int|0x516d
comma
l_int|0x5f57
comma
l_int|0x6762
comma
l_int|0x6768
comma
l_int|0x4d3e
comma
l_int|0x7971
comma
l_int|0x6470
comma
l_int|0x5c78
comma
l_int|0x6765
comma
l_int|0xff63
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x1101
comma
l_int|0x1212
comma
l_int|0x1518
comma
l_int|0x2f18
comma
l_int|0x1a1a
comma
l_int|0x632f
comma
l_int|0x3842
comma
l_int|0x6342
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0x6363
comma
l_int|0xff63
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables6
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0d00
comma
l_int|0x0a09
comma
l_int|0x0a0b
comma
l_int|0x0d08
comma
l_int|0x0a0b
comma
l_int|0x0e0b
comma
l_int|0x0d0e
comma
l_int|0x130f
comma
l_int|0x1520
comma
l_int|0x1213
comma
l_int|0x1312
comma
l_int|0x1c27
comma
l_int|0x171e
comma
l_int|0x2e20
comma
l_int|0x3129
comma
l_int|0x2e30
comma
l_int|0x2d29
comma
l_int|0x332c
comma
l_int|0x4a3a
comma
l_int|0x333e
comma
l_int|0x4636
comma
l_int|0x2c37
comma
l_int|0x402d
comma
l_int|0x4157
comma
l_int|0x4c46
comma
l_int|0x524e
comma
l_int|0x5253
comma
l_int|0x3e32
comma
l_int|0x615a
comma
l_int|0x505a
comma
l_int|0x4a60
comma
l_int|0x5251
comma
l_int|0xff4f
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0e01
comma
l_int|0x0e0e
comma
l_int|0x1113
comma
l_int|0x2613
comma
l_int|0x1515
comma
l_int|0x4f26
comma
l_int|0x2d35
comma
l_int|0x4f35
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0x4f4f
comma
l_int|0xff4f
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables7
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0a00
comma
l_int|0x0707
comma
l_int|0x0708
comma
l_int|0x0a06
comma
l_int|0x0808
comma
l_int|0x0b08
comma
l_int|0x0a0a
comma
l_int|0x0e0b
comma
l_int|0x1018
comma
l_int|0x0d0e
comma
l_int|0x0e0d
comma
l_int|0x151d
comma
l_int|0x1116
comma
l_int|0x2318
comma
l_int|0x251f
comma
l_int|0x2224
comma
l_int|0x221f
comma
l_int|0x2621
comma
l_int|0x372b
comma
l_int|0x262f
comma
l_int|0x3429
comma
l_int|0x2129
comma
l_int|0x3022
comma
l_int|0x3141
comma
l_int|0x3934
comma
l_int|0x3e3b
comma
l_int|0x3e3e
comma
l_int|0x2e25
comma
l_int|0x4944
comma
l_int|0x3c43
comma
l_int|0x3748
comma
l_int|0x3e3d
comma
l_int|0xff3b
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0a01
comma
l_int|0x0b0b
comma
l_int|0x0d0e
comma
l_int|0x1c0e
comma
l_int|0x1010
comma
l_int|0x3b1c
comma
l_int|0x2228
comma
l_int|0x3b28
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0x3b3b
comma
l_int|0xff3b
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables8
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0600
comma
l_int|0x0504
comma
l_int|0x0506
comma
l_int|0x0604
comma
l_int|0x0506
comma
l_int|0x0706
comma
l_int|0x0607
comma
l_int|0x0a08
comma
l_int|0x0a10
comma
l_int|0x090a
comma
l_int|0x0a09
comma
l_int|0x0e14
comma
l_int|0x0c0f
comma
l_int|0x1710
comma
l_int|0x1814
comma
l_int|0x1718
comma
l_int|0x1614
comma
l_int|0x1a16
comma
l_int|0x251d
comma
l_int|0x1a1f
comma
l_int|0x231b
comma
l_int|0x161c
comma
l_int|0x2016
comma
l_int|0x202c
comma
l_int|0x2623
comma
l_int|0x2927
comma
l_int|0x292a
comma
l_int|0x1f19
comma
l_int|0x302d
comma
l_int|0x282d
comma
l_int|0x2530
comma
l_int|0x2928
comma
l_int|0xff28
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0701
comma
l_int|0x0707
comma
l_int|0x080a
comma
l_int|0x130a
comma
l_int|0x0a0a
comma
l_int|0x2813
comma
l_int|0x161a
comma
l_int|0x281a
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0x2828
comma
l_int|0xff28
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables9
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0300
comma
l_int|0x0202
comma
l_int|0x0203
comma
l_int|0x0302
comma
l_int|0x0303
comma
l_int|0x0403
comma
l_int|0x0303
comma
l_int|0x0504
comma
l_int|0x0508
comma
l_int|0x0405
comma
l_int|0x0504
comma
l_int|0x070a
comma
l_int|0x0607
comma
l_int|0x0c08
comma
l_int|0x0c0a
comma
l_int|0x0b0c
comma
l_int|0x0b0a
comma
l_int|0x0d0b
comma
l_int|0x120e
comma
l_int|0x0d10
comma
l_int|0x110e
comma
l_int|0x0b0e
comma
l_int|0x100b
comma
l_int|0x1016
comma
l_int|0x1311
comma
l_int|0x1514
comma
l_int|0x1515
comma
l_int|0x0f0c
comma
l_int|0x1817
comma
l_int|0x1416
comma
l_int|0x1218
comma
l_int|0x1514
comma
l_int|0xff14
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0301
comma
l_int|0x0404
comma
l_int|0x0405
comma
l_int|0x0905
comma
l_int|0x0505
comma
l_int|0x1409
comma
l_int|0x0b0d
comma
l_int|0x140d
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0x1414
comma
l_int|0xff14
comma
)brace
suffix:semicolon
r_static
id|u16
id|tables10
(braket
)braket
op_assign
(brace
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0100
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0xff01
comma
l_int|0xdbff
comma
l_int|0x4300
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0xff01
comma
)brace
suffix:semicolon
r_switch
c_cond
(paren
id|quality
)paren
(brace
r_case
l_int|0
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables0
)paren
suffix:semicolon
r_return
id|tables0
suffix:semicolon
r_case
l_int|1
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables1
)paren
suffix:semicolon
r_return
id|tables1
suffix:semicolon
r_case
l_int|2
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables2
)paren
suffix:semicolon
r_return
id|tables2
suffix:semicolon
r_case
l_int|3
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables3
)paren
suffix:semicolon
r_return
id|tables3
suffix:semicolon
r_case
l_int|4
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables4
)paren
suffix:semicolon
r_return
id|tables4
suffix:semicolon
r_case
l_int|5
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables5
)paren
suffix:semicolon
r_return
id|tables5
suffix:semicolon
r_case
l_int|6
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables6
)paren
suffix:semicolon
r_return
id|tables6
suffix:semicolon
r_case
l_int|7
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables7
)paren
suffix:semicolon
r_return
id|tables7
suffix:semicolon
r_case
l_int|8
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables8
)paren
suffix:semicolon
r_return
id|tables8
suffix:semicolon
r_case
l_int|9
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables9
)paren
suffix:semicolon
r_return
id|tables9
suffix:semicolon
r_case
l_int|10
suffix:colon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables10
)paren
suffix:semicolon
r_return
id|tables10
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;meye: invalid quality level %d - using 8&bslash;n&quot;
comma
id|quality
)paren
suffix:semicolon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables8
)paren
suffix:semicolon
r_return
id|tables8
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* return a generic set of huffman tables */
DECL|function|jpeg_huffman_tables
r_static
id|u16
op_star
id|jpeg_huffman_tables
c_func
(paren
r_int
op_star
id|size
)paren
(brace
r_static
id|u16
id|tables
(braket
)braket
op_assign
(brace
l_int|0xC4FF
comma
l_int|0xB500
comma
l_int|0x0010
comma
l_int|0x0102
comma
l_int|0x0303
comma
l_int|0x0402
comma
l_int|0x0503
comma
l_int|0x0405
comma
l_int|0x0004
comma
l_int|0x0100
comma
l_int|0x017D
comma
l_int|0x0302
comma
l_int|0x0400
comma
l_int|0x0511
comma
l_int|0x2112
comma
l_int|0x4131
comma
l_int|0x1306
comma
l_int|0x6151
comma
l_int|0x2207
comma
l_int|0x1471
comma
l_int|0x8132
comma
l_int|0xA191
comma
l_int|0x2308
comma
l_int|0xB142
comma
l_int|0x15C1
comma
l_int|0xD152
comma
l_int|0x24F0
comma
l_int|0x6233
comma
l_int|0x8272
comma
l_int|0x0A09
comma
l_int|0x1716
comma
l_int|0x1918
comma
l_int|0x251A
comma
l_int|0x2726
comma
l_int|0x2928
comma
l_int|0x342A
comma
l_int|0x3635
comma
l_int|0x3837
comma
l_int|0x3A39
comma
l_int|0x4443
comma
l_int|0x4645
comma
l_int|0x4847
comma
l_int|0x4A49
comma
l_int|0x5453
comma
l_int|0x5655
comma
l_int|0x5857
comma
l_int|0x5A59
comma
l_int|0x6463
comma
l_int|0x6665
comma
l_int|0x6867
comma
l_int|0x6A69
comma
l_int|0x7473
comma
l_int|0x7675
comma
l_int|0x7877
comma
l_int|0x7A79
comma
l_int|0x8483
comma
l_int|0x8685
comma
l_int|0x8887
comma
l_int|0x8A89
comma
l_int|0x9392
comma
l_int|0x9594
comma
l_int|0x9796
comma
l_int|0x9998
comma
l_int|0xA29A
comma
l_int|0xA4A3
comma
l_int|0xA6A5
comma
l_int|0xA8A7
comma
l_int|0xAAA9
comma
l_int|0xB3B2
comma
l_int|0xB5B4
comma
l_int|0xB7B6
comma
l_int|0xB9B8
comma
l_int|0xC2BA
comma
l_int|0xC4C3
comma
l_int|0xC6C5
comma
l_int|0xC8C7
comma
l_int|0xCAC9
comma
l_int|0xD3D2
comma
l_int|0xD5D4
comma
l_int|0xD7D6
comma
l_int|0xD9D8
comma
l_int|0xE1DA
comma
l_int|0xE3E2
comma
l_int|0xE5E4
comma
l_int|0xE7E6
comma
l_int|0xE9E8
comma
l_int|0xF1EA
comma
l_int|0xF3F2
comma
l_int|0xF5F4
comma
l_int|0xF7F6
comma
l_int|0xF9F8
comma
l_int|0xFFFA
comma
l_int|0xC4FF
comma
l_int|0xB500
comma
l_int|0x0011
comma
l_int|0x0102
comma
l_int|0x0402
comma
l_int|0x0304
comma
l_int|0x0704
comma
l_int|0x0405
comma
l_int|0x0004
comma
l_int|0x0201
comma
l_int|0x0077
comma
l_int|0x0201
comma
l_int|0x1103
comma
l_int|0x0504
comma
l_int|0x3121
comma
l_int|0x1206
comma
l_int|0x5141
comma
l_int|0x6107
comma
l_int|0x1371
comma
l_int|0x3222
comma
l_int|0x0881
comma
l_int|0x4214
comma
l_int|0xA191
comma
l_int|0xC1B1
comma
l_int|0x2309
comma
l_int|0x5233
comma
l_int|0x15F0
comma
l_int|0x7262
comma
l_int|0x0AD1
comma
l_int|0x2416
comma
l_int|0xE134
comma
l_int|0xF125
comma
l_int|0x1817
comma
l_int|0x1A19
comma
l_int|0x2726
comma
l_int|0x2928
comma
l_int|0x352A
comma
l_int|0x3736
comma
l_int|0x3938
comma
l_int|0x433A
comma
l_int|0x4544
comma
l_int|0x4746
comma
l_int|0x4948
comma
l_int|0x534A
comma
l_int|0x5554
comma
l_int|0x5756
comma
l_int|0x5958
comma
l_int|0x635A
comma
l_int|0x6564
comma
l_int|0x6766
comma
l_int|0x6968
comma
l_int|0x736A
comma
l_int|0x7574
comma
l_int|0x7776
comma
l_int|0x7978
comma
l_int|0x827A
comma
l_int|0x8483
comma
l_int|0x8685
comma
l_int|0x8887
comma
l_int|0x8A89
comma
l_int|0x9392
comma
l_int|0x9594
comma
l_int|0x9796
comma
l_int|0x9998
comma
l_int|0xA29A
comma
l_int|0xA4A3
comma
l_int|0xA6A5
comma
l_int|0xA8A7
comma
l_int|0xAAA9
comma
l_int|0xB3B2
comma
l_int|0xB5B4
comma
l_int|0xB7B6
comma
l_int|0xB9B8
comma
l_int|0xC2BA
comma
l_int|0xC4C3
comma
l_int|0xC6C5
comma
l_int|0xC8C7
comma
l_int|0xCAC9
comma
l_int|0xD3D2
comma
l_int|0xD5D4
comma
l_int|0xD7D6
comma
l_int|0xD9D8
comma
l_int|0xE2DA
comma
l_int|0xE4E3
comma
l_int|0xE6E5
comma
l_int|0xE8E7
comma
l_int|0xEAE9
comma
l_int|0xF3F2
comma
l_int|0xF5F4
comma
l_int|0xF7F6
comma
l_int|0xF9F8
comma
l_int|0xFFFA
comma
l_int|0xC4FF
comma
l_int|0x1F00
comma
l_int|0x0000
comma
l_int|0x0501
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0201
comma
l_int|0x0403
comma
l_int|0x0605
comma
l_int|0x0807
comma
l_int|0x0A09
comma
l_int|0xFF0B
comma
l_int|0xC4FF
comma
l_int|0x1F00
comma
l_int|0x0001
comma
l_int|0x0103
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0101
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0201
comma
l_int|0x0403
comma
l_int|0x0605
comma
l_int|0x0807
comma
l_int|0x0A09
comma
l_int|0xFF0B
)brace
suffix:semicolon
op_star
id|size
op_assign
r_sizeof
(paren
id|tables
)paren
suffix:semicolon
r_return
id|tables
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* MCHIP low-level functions                                                */
multiline_comment|/****************************************************************************/
multiline_comment|/* waits for the specified miliseconds */
DECL|function|wait_ms
r_static
r_inline
r_void
id|wait_ms
c_func
(paren
r_int
r_int
id|ms
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|in_interrupt
c_func
(paren
)paren
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
op_plus
id|ms
op_star
id|HZ
op_div
l_int|1000
)paren
suffix:semicolon
)brace
r_else
id|mdelay
c_func
(paren
id|ms
)paren
suffix:semicolon
)brace
multiline_comment|/* returns the horizontal capture size */
DECL|function|mchip_hsize
r_static
r_inline
r_int
id|mchip_hsize
c_func
(paren
r_void
)paren
(brace
r_return
id|meye.params.subsample
ques
c_cond
l_int|320
suffix:colon
l_int|640
suffix:semicolon
)brace
multiline_comment|/* returns the vertical capture size */
DECL|function|mchip_vsize
r_static
r_inline
r_int
id|mchip_vsize
c_func
(paren
r_void
)paren
(brace
r_return
id|meye.params.subsample
ques
c_cond
l_int|240
suffix:colon
l_int|480
suffix:semicolon
)brace
multiline_comment|/* waits for a register to be available */
DECL|function|mchip_sync
r_static
r_void
id|mchip_sync
c_func
(paren
r_int
id|reg
)paren
(brace
id|u32
id|status
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
id|MCHIP_MM_FIFO_DATA
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MCHIP_REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|readl
c_func
(paren
id|meye.mchip_mmregs
op_plus
id|MCHIP_MM_FIFO_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|MCHIP_MM_FIFO_WAIT
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;meye: fifo not ready&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|MCHIP_MM_FIFO_READY
)paren
r_return
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|reg
OG
l_int|0x80
)paren
(brace
id|u32
id|mask
op_assign
(paren
id|reg
OL
l_int|0x100
)paren
ques
c_cond
id|MCHIP_HIC_STATUS_MCC_RDY
suffix:colon
id|MCHIP_HIC_STATUS_VRJ_RDY
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MCHIP_REG_TIMEOUT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|readl
c_func
(paren
id|meye.mchip_mmregs
op_plus
id|MCHIP_HIC_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|mask
)paren
r_return
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;meye: mchip_sync() timeout on reg 0x%x status=0x%x&bslash;n&quot;
comma
id|reg
comma
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* sets a value into the register */
DECL|function|mchip_set
r_static
r_inline
r_void
id|mchip_set
c_func
(paren
r_int
id|reg
comma
id|u32
id|v
)paren
(brace
id|mchip_sync
c_func
(paren
id|reg
)paren
suffix:semicolon
id|writel
c_func
(paren
id|v
comma
id|meye.mchip_mmregs
op_plus
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/* get the register value */
DECL|function|mchip_read
r_static
r_inline
id|u32
id|mchip_read
c_func
(paren
r_int
id|reg
)paren
(brace
id|mchip_sync
c_func
(paren
id|reg
)paren
suffix:semicolon
r_return
id|readl
c_func
(paren
id|meye.mchip_mmregs
op_plus
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/* wait for a register to become a particular value */
DECL|function|mchip_delay
r_static
r_inline
r_int
id|mchip_delay
c_func
(paren
id|u32
id|reg
comma
id|u32
id|v
)paren
(brace
r_int
id|n
op_assign
l_int|10
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|n
op_logical_and
id|mchip_read
c_func
(paren
id|reg
)paren
op_ne
id|v
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
multiline_comment|/* setup subsampling */
DECL|function|mchip_subsample
r_static
r_void
id|mchip_subsample
c_func
(paren
r_void
)paren
(brace
id|mchip_set
c_func
(paren
id|MCHIP_MCC_R_SAMPLING
comma
id|meye.params.subsample
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MCC_R_XRANGE
comma
id|mchip_hsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MCC_R_YRANGE
comma
id|mchip_vsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MCC_B_XRANGE
comma
id|mchip_hsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MCC_B_YRANGE
comma
id|mchip_vsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
suffix:semicolon
)brace
multiline_comment|/* set the framerate into the mchip */
DECL|function|mchip_set_framerate
r_static
r_void
id|mchip_set_framerate
c_func
(paren
r_void
)paren
(brace
id|mchip_set
c_func
(paren
id|MCHIP_HIC_S_RATE
comma
id|meye.params.framerate
)paren
suffix:semicolon
)brace
multiline_comment|/* load some huffman and quantisation tables into the VRJ chip ready&n;   for JPEG compression */
DECL|function|mchip_load_tables
r_static
r_void
id|mchip_load_tables
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
id|u16
op_star
id|tables
suffix:semicolon
id|tables
op_assign
id|jpeg_huffman_tables
c_func
(paren
op_amp
id|size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|writel
c_func
(paren
id|tables
(braket
id|i
)braket
comma
id|meye.mchip_mmregs
op_plus
id|MCHIP_VRJ_TABLE_DATA
)paren
suffix:semicolon
id|tables
op_assign
id|jpeg_quantisation_tables
c_func
(paren
op_amp
id|size
comma
id|meye.params.quality
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|writel
c_func
(paren
id|tables
(braket
id|i
)braket
comma
id|meye.mchip_mmregs
op_plus
id|MCHIP_VRJ_TABLE_DATA
)paren
suffix:semicolon
)brace
multiline_comment|/* setup the VRJ parameters in the chip */
DECL|function|mchip_vrj_setup
r_static
r_void
id|mchip_vrj_setup
c_func
(paren
id|u8
id|mode
)paren
(brace
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_BUS_MODE
comma
l_int|5
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SIGNAL_ACTIVE_LEVEL
comma
l_int|0x1f
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_PDAT_USE
comma
l_int|1
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_IRQ_FLAG
comma
l_int|0xa0
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_MODE_SPECIFY
comma
id|mode
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_NUM_LINES
comma
id|mchip_vsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_NUM_PIXELS
comma
id|mchip_hsize
c_func
(paren
)paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_NUM_COMPONENTS
comma
l_int|0x1b
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_LIMIT_COMPRESSED_LO
comma
l_int|0xFFFF
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_LIMIT_COMPRESSED_HI
comma
l_int|0xFFFF
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_COMP_DATA_FORMAT
comma
l_int|0xC
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_RESTART_INTERVAL
comma
l_int|0
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOF1
comma
l_int|0x601
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOF2
comma
l_int|0x1502
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOF3
comma
l_int|0x1503
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOF4
comma
l_int|0x1596
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOS
comma
l_int|0x0ed0
)paren
suffix:semicolon
id|mchip_load_tables
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* setup for DMA transfers - also zeros the framebuffer */
DECL|function|mchip_dma_alloc
r_static
r_int
id|mchip_dma_alloc
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|meye.mchip_fbuffer
)paren
(brace
id|meye.mchip_fbuffer
op_assign
id|ptable_alloc
c_func
(paren
id|MCHIP_NB_PAGES
comma
op_amp
id|meye.mchip_ptaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.mchip_fbuffer
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* frees the DMA buffer */
DECL|function|mchip_dma_free
r_static
r_void
id|mchip_dma_free
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|meye.mchip_fbuffer
)paren
(brace
id|ptable_free
c_func
(paren
id|meye.mchip_fbuffer
comma
id|MCHIP_NB_PAGES
)paren
suffix:semicolon
id|meye.mchip_fbuffer
op_assign
l_int|0
suffix:semicolon
id|meye.mchip_ptaddr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* sets the DMA parameters into the chip */
DECL|function|mchip_dma_setup
r_static
r_void
id|mchip_dma_setup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MM_PT_ADDR
comma
id|meye.mchip_ptaddr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|mchip_set
c_func
(paren
id|MCHIP_MM_FIR
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
id|meye.mchip_fnum
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* stop any existing HIC action and wait for any dma to complete then&n;   reset the dma engine */
DECL|function|mchip_hic_stop
r_static
r_void
id|mchip_hic_stop
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|meye.mchip_mode
op_assign
id|MCHIP_HIC_MODE_NOOP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mchip_read
c_func
(paren
id|MCHIP_HIC_STATUS
)paren
op_amp
id|MCHIP_HIC_STATUS_BUSY
)paren
)paren
r_return
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_STOP
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
)paren
(brace
multiline_comment|/*  resetting HIC */
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_STOP
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CTL
comma
id|MCHIP_HIC_CTL_SOFT_RESET
)paren
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|250
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_increment
OG
l_int|20
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: resetting HIC hanged!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|wait_ms
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* MCHIP frame processing functions                                         */
multiline_comment|/****************************************************************************/
multiline_comment|/* get the next ready frame from the dma engine */
DECL|function|mchip_get_frame
r_static
id|u32
id|mchip_get_frame
c_func
(paren
r_void
)paren
(brace
id|u32
id|v
suffix:semicolon
id|v
op_assign
id|mchip_read
c_func
(paren
id|MCHIP_MM_FIR
c_func
(paren
id|meye.mchip_fnum
)paren
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
multiline_comment|/* frees the current frame from the dma engine */
DECL|function|mchip_free_frame
r_static
r_void
id|mchip_free_frame
c_func
(paren
r_void
)paren
(brace
id|mchip_set
c_func
(paren
id|MCHIP_MM_FIR
c_func
(paren
id|meye.mchip_fnum
)paren
comma
l_int|0
)paren
suffix:semicolon
id|meye.mchip_fnum
op_increment
suffix:semicolon
id|meye.mchip_fnum
op_mod_assign
l_int|4
suffix:semicolon
)brace
multiline_comment|/* read one frame from the framebuffer assuming it was captured using&n;   a uncompressed transfer */
DECL|function|mchip_cont_read_frame
r_static
r_void
id|mchip_cont_read_frame
c_func
(paren
id|u32
id|v
comma
id|u8
op_star
id|buf
comma
r_int
id|size
)paren
(brace
r_int
id|pt_id
suffix:semicolon
r_int
id|avail
suffix:semicolon
id|pt_id
op_assign
(paren
id|v
op_rshift
l_int|17
)paren
op_amp
l_int|0x3FF
suffix:semicolon
id|avail
op_assign
id|MCHIP_NB_PAGES
op_minus
id|pt_id
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|avail
op_star
id|PAGE_SIZE
)paren
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|meye.mchip_fbuffer
op_plus
id|pt_id
op_star
id|PAGE_SIZE
comma
id|avail
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
op_plus
id|avail
op_star
id|PAGE_SIZE
comma
id|meye.mchip_fbuffer
comma
id|size
op_minus
id|avail
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|buf
comma
id|meye.mchip_fbuffer
op_plus
id|pt_id
op_star
id|PAGE_SIZE
comma
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/* read a compressed frame from the framebuffer */
DECL|function|mchip_comp_read_frame
r_static
r_int
id|mchip_comp_read_frame
c_func
(paren
id|u32
id|v
comma
id|u8
op_star
id|buf
comma
r_int
id|size
)paren
(brace
r_int
id|pt_start
comma
id|pt_end
comma
id|trailer
suffix:semicolon
r_int
id|fsize
comma
id|fsize2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pt_start
op_assign
(paren
id|v
op_rshift
l_int|19
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|pt_end
op_assign
(paren
id|v
op_rshift
l_int|11
)paren
op_amp
l_int|0xFF
suffix:semicolon
id|trailer
op_assign
(paren
id|v
op_rshift
l_int|1
)paren
op_amp
l_int|0x3FF
suffix:semicolon
r_if
c_cond
(paren
id|pt_end
OL
id|pt_start
)paren
(brace
id|fsize
op_assign
(paren
id|MCHIP_NB_PAGES_MJPEG
op_minus
id|pt_start
)paren
op_star
id|PAGE_SIZE
suffix:semicolon
id|fsize2
op_assign
id|pt_end
op_star
id|PAGE_SIZE
op_plus
id|trailer
op_star
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|fsize
op_plus
id|fsize2
OG
id|size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;meye: oversized compressed frame %d %d&bslash;n&quot;
comma
id|fsize
comma
id|fsize2
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|meye.mchip_fbuffer
op_plus
id|pt_start
op_star
id|PAGE_SIZE
comma
id|fsize
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
op_plus
id|fsize
comma
id|meye.mchip_fbuffer
comma
id|fsize2
)paren
suffix:semicolon
id|fsize
op_add_assign
id|fsize2
suffix:semicolon
)brace
)brace
r_else
(brace
id|fsize
op_assign
(paren
id|pt_end
op_minus
id|pt_start
)paren
op_star
id|PAGE_SIZE
op_plus
id|trailer
op_star
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|fsize
OG
id|size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;meye: oversized compressed frame %d&bslash;n&quot;
comma
id|fsize
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|buf
comma
id|meye.mchip_fbuffer
op_plus
id|pt_start
op_star
id|PAGE_SIZE
comma
id|fsize
)paren
suffix:semicolon
)brace
macro_line|#ifdef MEYE_JPEG_CORRECTION
multiline_comment|/* Some mchip generated jpeg frames are incorrect. In most&n;&t; * (all ?) of those cases, the final EOI (0xff 0xd9) marker &n;&t; * is not present at the end of the frame.&n;&t; *&n;&t; * Since adding the final marker is not enough to restore&n;&t; * the jpeg integrity, we drop the frame.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
id|fsize
op_minus
l_int|1
suffix:semicolon
id|i
OG
l_int|0
op_logical_and
id|buf
(braket
id|i
)braket
op_eq
l_int|0xff
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|2
op_logical_or
id|buf
(braket
id|i
op_minus
l_int|1
)braket
op_ne
l_int|0xff
op_logical_or
id|buf
(braket
id|i
)braket
op_ne
l_int|0xd9
)paren
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_return
id|fsize
suffix:semicolon
)brace
multiline_comment|/* take a picture into SDRAM */
DECL|function|mchip_take_picture
r_static
r_void
id|mchip_take_picture
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
id|mchip_subsample
c_func
(paren
)paren
suffix:semicolon
id|mchip_dma_setup
c_func
(paren
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_STILL_CAP
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
)paren
r_break
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* dma a previously taken picture into a buffer */
DECL|function|mchip_get_picture
r_static
r_void
id|mchip_get_picture
c_func
(paren
id|u8
op_star
id|buf
comma
r_int
id|bufsize
)paren
(brace
id|u32
id|v
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_STILL_OUT
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
)paren
r_break
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
op_increment
id|i
)paren
(brace
id|v
op_assign
id|mchip_get_frame
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_amp
id|MCHIP_MM_FIR_RDY
)paren
(brace
id|mchip_cont_read_frame
c_func
(paren
id|v
comma
id|buf
comma
id|bufsize
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mchip_free_frame
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* start continuous dma capture */
DECL|function|mchip_continuous_start
r_static
r_void
id|mchip_continuous_start
c_func
(paren
r_void
)paren
(brace
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
id|mchip_subsample
c_func
(paren
)paren
suffix:semicolon
id|mchip_set_framerate
c_func
(paren
)paren
suffix:semicolon
id|mchip_dma_setup
c_func
(paren
)paren
suffix:semicolon
id|meye.mchip_mode
op_assign
id|MCHIP_HIC_MODE_CONT_OUT
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_CONT_OUT
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* compress one frame into a buffer */
DECL|function|mchip_compress_frame
r_static
r_int
id|mchip_compress_frame
c_func
(paren
id|u8
op_star
id|buf
comma
r_int
id|bufsize
)paren
(brace
id|u32
id|v
suffix:semicolon
r_int
id|len
op_assign
op_minus
l_int|1
comma
id|i
suffix:semicolon
id|mchip_vrj_setup
c_func
(paren
l_int|0x3f
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_STILL_COMP
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
)paren
r_break
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
op_increment
id|i
)paren
(brace
id|v
op_assign
id|mchip_get_frame
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_amp
id|MCHIP_MM_FIR_RDY
)paren
(brace
id|len
op_assign
id|mchip_comp_read_frame
c_func
(paren
id|v
comma
id|buf
comma
id|bufsize
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mchip_free_frame
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* uncompress one image into a buffer */
r_static
r_int
id|mchip_uncompress_frame
c_func
(paren
id|u8
op_star
id|img
comma
r_int
id|imgsize
comma
id|u8
op_star
id|buf
comma
r_int
id|bufsize
)paren
(brace
id|mchip_vrj_setup
c_func
(paren
l_int|0x3f
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_STILL_DECOMP
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
r_return
id|mchip_comp_read_frame
c_func
(paren
id|buf
comma
id|bufsize
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* start continuous compressed capture */
DECL|function|mchip_cont_compression_start
r_static
r_void
id|mchip_cont_compression_start
c_func
(paren
r_void
)paren
(brace
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
id|mchip_vrj_setup
c_func
(paren
l_int|0x3f
)paren
suffix:semicolon
id|mchip_subsample
c_func
(paren
)paren
suffix:semicolon
id|mchip_set_framerate
c_func
(paren
)paren
suffix:semicolon
id|mchip_dma_setup
c_func
(paren
)paren
suffix:semicolon
id|meye.mchip_mode
op_assign
id|MCHIP_HIC_MODE_CONT_COMP
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_MODE
comma
id|MCHIP_HIC_MODE_CONT_COMP
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_HIC_CMD
comma
id|MCHIP_HIC_CMD_START
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* Interrupt handling                                                       */
multiline_comment|/****************************************************************************/
DECL|function|meye_irq
r_static
r_void
id|meye_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|v
suffix:semicolon
r_int
id|reqnr
suffix:semicolon
id|v
op_assign
id|mchip_read
c_func
(paren
id|MCHIP_MM_INTA
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|v
op_assign
id|mchip_get_frame
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|v
op_amp
id|MCHIP_MM_FIR_RDY
)paren
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|meye.mchip_mode
)paren
(brace
r_case
id|MCHIP_HIC_MODE_CONT_OUT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|meye_emptyq
c_func
(paren
op_amp
id|meye.grabq
comma
l_int|NULL
)paren
)paren
(brace
r_int
id|nr
op_assign
id|meye_pullq
c_func
(paren
op_amp
id|meye.grabq
)paren
suffix:semicolon
id|mchip_cont_read_frame
c_func
(paren
id|v
comma
id|meye.grab_fbuffer
op_plus
id|gbufsize
op_star
id|nr
comma
id|mchip_hsize
c_func
(paren
)paren
op_star
id|mchip_vsize
c_func
(paren
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
id|nr
)braket
dot
id|state
op_assign
id|MEYE_BUF_DONE
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|meye.grabq.proc_list
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MCHIP_HIC_MODE_CONT_COMP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|meye_emptyq
c_func
(paren
op_amp
id|meye.grabq
comma
op_amp
id|reqnr
)paren
)paren
(brace
r_int
id|size
suffix:semicolon
id|size
op_assign
id|mchip_comp_read_frame
c_func
(paren
id|v
comma
id|meye.grab_fbuffer
op_plus
id|gbufsize
op_star
id|reqnr
comma
id|gbufsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
op_minus
l_int|1
)paren
r_break
suffix:semicolon
id|reqnr
op_assign
id|meye_pullq
c_func
(paren
op_amp
id|meye.grabq
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
id|reqnr
)braket
dot
id|size
op_assign
id|size
suffix:semicolon
id|meye.grab_buffer
(braket
id|reqnr
)braket
dot
id|state
op_assign
id|MEYE_BUF_DONE
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|meye.grabq.proc_list
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* do not free frame, since it can be a snap */
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* switch */
id|mchip_free_frame
c_func
(paren
)paren
suffix:semicolon
)brace
id|out
suffix:colon
)brace
multiline_comment|/****************************************************************************/
multiline_comment|/* video4linux integration                                                  */
multiline_comment|/****************************************************************************/
DECL|function|meye_open
r_static
r_int
id|meye_open
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
id|flags
)paren
(brace
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|meye.open_count
)paren
(brace
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|meye.open_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|mchip_dma_alloc
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: mchip framebuffer allocation failed&bslash;n&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
id|meye_initq
c_func
(paren
op_amp
id|meye.grabq
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MEYE_MAX_BUFNBRS
suffix:semicolon
id|i
op_increment
)paren
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
op_assign
id|MEYE_BUF_UNUSED
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|meye_close
r_static
r_void
id|meye_close
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
(brace
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
id|meye.open_count
op_decrement
suffix:semicolon
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
)brace
DECL|function|meye_ioctl
r_static
r_int
id|meye_ioctl
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
id|b
suffix:semicolon
id|strcpy
c_func
(paren
id|b.name
comma
id|meye.video_dev.name
)paren
suffix:semicolon
id|b.type
op_assign
id|VID_TYPE_CAPTURE
suffix:semicolon
id|b.channels
op_assign
l_int|1
suffix:semicolon
id|b.audios
op_assign
l_int|0
suffix:semicolon
id|b.maxwidth
op_assign
l_int|640
suffix:semicolon
id|b.maxheight
op_assign
l_int|480
suffix:semicolon
id|b.minwidth
op_assign
l_int|320
suffix:semicolon
id|b.minheight
op_assign
l_int|240
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|b
comma
r_sizeof
(paren
id|b
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCGCHAN
suffix:colon
(brace
r_struct
id|video_channel
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|v.flags
op_assign
l_int|0
suffix:semicolon
id|v.tuners
op_assign
l_int|0
suffix:semicolon
id|v.type
op_assign
id|VIDEO_TYPE_CAMERA
suffix:semicolon
r_if
c_cond
(paren
id|v.channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|strcpy
c_func
(paren
id|v.name
comma
l_string|&quot;Camera&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCSCHAN
suffix:colon
(brace
r_struct
id|video_channel
id|v
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|arg
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.channel
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCGPICT
suffix:colon
(brace
r_struct
id|video_picture
id|p
op_assign
id|meye.picture
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|p
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCSPICT
suffix:colon
(brace
r_struct
id|video_picture
id|p
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|p
comma
id|arg
comma
r_sizeof
(paren
id|p
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p.depth
op_ne
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|p.palette
op_ne
id|VIDEO_PALETTE_YUV422
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERABRIGHTNESS
comma
id|p.brightness
op_rshift
l_int|10
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAHUE
comma
id|p.hue
op_rshift
l_int|10
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERACOLOR
comma
id|p.colour
op_rshift
l_int|10
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERACONTRAST
comma
id|p.contrast
op_rshift
l_int|10
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|meye.picture
comma
op_amp
id|p
comma
r_sizeof
(paren
id|p
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCSYNC
suffix:colon
(brace
r_int
id|i
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|i
comma
id|arg
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|gbuffers
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
)paren
(brace
r_case
id|MEYE_BUF_UNUSED
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|MEYE_BUF_USING
suffix:colon
id|add_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_while
c_loop
(paren
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
op_eq
id|MEYE_BUF_USING
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|MEYE_BUF_DONE
suffix:colon
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
op_assign
id|MEYE_BUF_UNUSED
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCMCAPTURE
suffix:colon
(brace
r_struct
id|video_mmap
id|vm
suffix:semicolon
r_int
id|restart
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|vm
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|vm
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vm.frame
op_ge
id|gbuffers
op_logical_or
id|vm.frame
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vm.format
op_ne
id|VIDEO_PALETTE_YUV422
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vm.height
op_star
id|vm.width
op_star
l_int|2
OG
id|gbufsize
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|meye.grab_buffer
(braket
id|vm.frame
)braket
dot
id|state
op_ne
id|MEYE_BUF_UNUSED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vm.width
op_eq
l_int|640
op_logical_and
id|vm.height
op_eq
l_int|480
)paren
(brace
r_if
c_cond
(paren
id|meye.params.subsample
)paren
(brace
id|meye.params.subsample
op_assign
l_int|0
suffix:semicolon
id|restart
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|vm.width
op_eq
l_int|320
op_logical_and
id|vm.height
op_eq
l_int|240
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|meye.params.subsample
)paren
(brace
id|meye.params.subsample
op_assign
l_int|1
suffix:semicolon
id|restart
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|restart
op_logical_or
id|meye.mchip_mode
op_ne
id|MCHIP_HIC_MODE_CONT_OUT
)paren
id|mchip_continuous_start
c_func
(paren
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
id|vm.frame
)braket
dot
id|state
op_assign
id|MEYE_BUF_USING
suffix:semicolon
id|meye_pushq
c_func
(paren
op_amp
id|meye.grabq
comma
id|vm.frame
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOCGMBUF
suffix:colon
(brace
r_struct
id|video_mbuf
id|vm
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vm
comma
l_int|0
comma
r_sizeof
(paren
id|vm
)paren
)paren
suffix:semicolon
id|vm.size
op_assign
id|gbufsize
op_star
id|gbuffers
suffix:semicolon
id|vm.frames
op_assign
id|gbuffers
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gbuffers
suffix:semicolon
id|i
op_increment
)paren
id|vm.offsets
(braket
id|i
)braket
op_assign
id|i
op_star
id|gbufsize
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|vm
comma
r_sizeof
(paren
id|vm
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_G_PARAMS
suffix:colon
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|meye.params
comma
r_sizeof
(paren
id|meye.params
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_S_PARAMS
suffix:colon
(brace
r_struct
id|meye_params
id|jp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|jp
comma
id|arg
comma
r_sizeof
(paren
id|jp
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|jp.subsample
OG
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|jp.quality
OG
l_int|10
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|jp.sharpness
OG
l_int|63
op_logical_or
id|jp.agc
OG
l_int|63
op_logical_or
id|jp.picture
OG
l_int|63
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|jp.framerate
OG
l_int|31
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|meye.params.subsample
op_ne
id|jp.subsample
op_logical_or
id|meye.params.quality
op_ne
id|jp.quality
)paren
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* need restart */
id|memcpy
c_func
(paren
op_amp
id|meye.params
comma
op_amp
id|jp
comma
r_sizeof
(paren
id|jp
)paren
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERASHARPNESS
comma
id|meye.params.sharpness
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAAGC
comma
id|meye.params.agc
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAPICTURE
comma
id|meye.params.picture
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_QBUF_CAPT
suffix:colon
(brace
r_int
id|nb
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|nb
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|nb
op_ge
id|gbuffers
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|nb
OL
l_int|0
)paren
(brace
multiline_comment|/* stop capture */
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|meye.grab_buffer
(braket
id|nb
)braket
dot
id|state
op_ne
id|MEYE_BUF_UNUSED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|meye.mchip_mode
op_ne
id|MCHIP_HIC_MODE_CONT_COMP
)paren
id|mchip_cont_compression_start
c_func
(paren
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
id|nb
)braket
dot
id|state
op_assign
id|MEYE_BUF_USING
suffix:semicolon
id|meye_pushq
c_func
(paren
op_amp
id|meye.grabq
comma
id|nb
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_SYNC
suffix:colon
(brace
r_int
id|i
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|i
comma
id|arg
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|gbuffers
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
)paren
(brace
r_case
id|MEYE_BUF_UNUSED
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|MEYE_BUF_USING
suffix:colon
id|add_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_while
c_loop
(paren
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
op_eq
id|MEYE_BUF_USING
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|meye.grabq.proc_list
comma
op_amp
id|wait
)paren
suffix:semicolon
id|current-&gt;state
op_assign
id|TASK_RUNNING
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|MEYE_BUF_DONE
suffix:colon
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|state
op_assign
id|MEYE_BUF_UNUSED
suffix:semicolon
)brace
id|i
op_assign
id|meye.grab_buffer
(braket
id|i
)braket
dot
id|size
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|i
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_STILLCAPT
suffix:colon
(brace
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_ne
id|MEYE_BUF_UNUSED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_assign
id|MEYE_BUF_USING
suffix:semicolon
id|mchip_take_picture
c_func
(paren
)paren
suffix:semicolon
id|mchip_get_picture
c_func
(paren
id|meye.grab_fbuffer
comma
id|mchip_hsize
c_func
(paren
)paren
op_star
id|mchip_vsize
c_func
(paren
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_assign
id|MEYE_BUF_DONE
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|MEYEIOC_STILLJCAPT
suffix:colon
(brace
r_int
id|len
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_ne
id|MEYE_BUF_UNUSED
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_assign
id|MEYE_BUF_USING
suffix:semicolon
r_while
c_loop
(paren
id|len
op_eq
op_minus
l_int|1
)paren
(brace
id|mchip_take_picture
c_func
(paren
)paren
suffix:semicolon
id|len
op_assign
id|mchip_compress_frame
c_func
(paren
id|meye.grab_fbuffer
comma
id|gbufsize
)paren
suffix:semicolon
)brace
id|meye.grab_buffer
(braket
l_int|0
)braket
dot
id|state
op_assign
id|MEYE_BUF_DONE
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
(paren
r_void
op_star
)paren
op_amp
id|len
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
multiline_comment|/* switch */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|meye_mmap
r_static
r_int
id|meye_mmap
c_func
(paren
r_struct
id|video_device
op_star
id|dev
comma
r_const
r_char
op_star
id|adr
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|start
op_assign
(paren
r_int
r_int
)paren
id|adr
suffix:semicolon
r_int
r_int
id|page
comma
id|pos
suffix:semicolon
id|down
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|gbuffers
op_star
id|gbufsize
)paren
(brace
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
(brace
multiline_comment|/* lazy allocation */
id|meye.grab_fbuffer
op_assign
id|rvmalloc
c_func
(paren
id|gbuffers
op_star
id|gbufsize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.grab_fbuffer
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: v4l framebuffer allocation failed&bslash;n&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
id|pos
op_assign
(paren
r_int
r_int
)paren
id|meye.grab_fbuffer
suffix:semicolon
r_while
c_loop
(paren
id|size
OG
l_int|0
)paren
(brace
id|page
op_assign
id|kvirt_to_pa
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remap_page_range
c_func
(paren
id|start
comma
id|page
comma
id|PAGE_SIZE
comma
id|PAGE_SHARED
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|start
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|pos
op_add_assign
id|PAGE_SIZE
suffix:semicolon
id|size
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|meye_template
r_static
r_struct
id|video_device
id|meye_template
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|name
suffix:colon
l_string|&quot;meye&quot;
comma
id|type
suffix:colon
id|VID_TYPE_CAPTURE
comma
id|hardware
suffix:colon
id|VID_HARDWARE_MEYE
comma
id|open
suffix:colon
id|meye_open
comma
id|close
suffix:colon
id|meye_close
comma
id|ioctl
suffix:colon
id|meye_ioctl
comma
id|mmap
suffix:colon
id|meye_mmap
comma
)brace
suffix:semicolon
DECL|function|meye_probe
r_static
r_int
id|__devinit
id|meye_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|mchip_adr
suffix:semicolon
id|u8
id|revision
suffix:semicolon
r_if
c_cond
(paren
id|meye.mchip_dev
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: only one device allowed!&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out1
suffix:semicolon
)brace
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERA
comma
l_int|1
)paren
suffix:semicolon
id|meye.mchip_dev
op_assign
id|pcidev
suffix:semicolon
id|meye.mchip_irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|meye.video_dev
comma
op_amp
id|meye_template
comma
r_sizeof
(paren
id|meye_template
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mchip_dma_alloc
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: mchip framebuffer allocation failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|pci_enable_device
c_func
(paren
id|meye.mchip_dev
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: pci_enable_device failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out3
suffix:semicolon
)brace
id|mchip_adr
op_assign
id|pci_resource_start
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mchip_adr
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: mchip has no device base address&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out4
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
comma
l_string|&quot;meye&quot;
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: request_mem_region failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out4
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|meye.mchip_dev
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|meye.mchip_dev
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|meye.mchip_dev
comma
id|PCI_CACHE_LINE_SIZE
comma
l_int|8
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|meye.mchip_dev
comma
id|PCI_LATENCY_TIMER
comma
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|request_irq
c_func
(paren
id|meye.mchip_irq
comma
id|meye_irq
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;meye&quot;
comma
id|meye_irq
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: request_irq failed (ret=%d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_goto
id|out5
suffix:semicolon
)brace
id|meye.mchip_mmregs
op_assign
id|ioremap
c_func
(paren
id|mchip_adr
comma
id|MCHIP_MM_REGS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|meye.mchip_mmregs
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: ioremap failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out6
suffix:semicolon
)brace
multiline_comment|/* Ask the camera to perform a soft reset. */
id|pci_write_config_word
c_func
(paren
id|meye.mchip_dev
comma
id|MCHIP_PCI_SOFTRESET_SET
comma
l_int|1
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_CMD
comma
l_int|0
)paren
suffix:semicolon
id|mchip_delay
c_func
(paren
id|MCHIP_HIC_STATUS
comma
id|MCHIP_HIC_STATUS_IDLE
)paren
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_VRJ_SOFT_RESET
comma
l_int|1
)paren
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MM_PCI_MODE
comma
l_int|5
)paren
suffix:semicolon
id|wait_ms
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|mchip_set
c_func
(paren
id|MCHIP_MM_INTA
comma
id|MCHIP_MM_INTA_HIC_1_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
op_amp
id|meye.video_dev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;meye: video_register_device failed&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out7
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;meye: Motion Eye Camera Driver v%d.%d.&bslash;n&quot;
comma
id|MEYE_DRIVER_MAJORVERSION
comma
id|MEYE_DRIVER_MINORVERSION
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;meye: mchip KL5A72002 rev. %d, base %lx, irq %d&bslash;n&quot;
comma
id|revision
comma
id|mchip_adr
comma
id|meye.mchip_irq
)paren
suffix:semicolon
multiline_comment|/* init all fields */
id|init_MUTEX
c_func
(paren
op_amp
id|meye.lock
)paren
suffix:semicolon
id|meye.picture.depth
op_assign
l_int|2
suffix:semicolon
id|meye.picture.palette
op_assign
id|VIDEO_PALETTE_YUV422
suffix:semicolon
id|meye.picture.brightness
op_assign
l_int|32
op_lshift
l_int|10
suffix:semicolon
id|meye.picture.hue
op_assign
l_int|32
op_lshift
l_int|10
suffix:semicolon
id|meye.picture.colour
op_assign
l_int|32
op_lshift
l_int|10
suffix:semicolon
id|meye.picture.contrast
op_assign
l_int|32
op_lshift
l_int|10
suffix:semicolon
id|meye.picture.whiteness
op_assign
l_int|0
suffix:semicolon
id|meye.params.subsample
op_assign
l_int|0
suffix:semicolon
id|meye.params.quality
op_assign
l_int|7
suffix:semicolon
id|meye.params.sharpness
op_assign
l_int|32
suffix:semicolon
id|meye.params.agc
op_assign
l_int|48
suffix:semicolon
id|meye.params.picture
op_assign
l_int|0
suffix:semicolon
id|meye.params.framerate
op_assign
l_int|0
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERABRIGHTNESS
comma
l_int|32
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAHUE
comma
l_int|32
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERACOLOR
comma
l_int|32
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERACONTRAST
comma
l_int|32
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERASHARPNESS
comma
l_int|32
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAPICTURE
comma
l_int|0
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERAAGC
comma
l_int|48
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out7
suffix:colon
id|iounmap
c_func
(paren
id|meye.mchip_mmregs
)paren
suffix:semicolon
id|out6
suffix:colon
id|free_irq
c_func
(paren
id|meye.mchip_irq
comma
id|meye_irq
)paren
suffix:semicolon
id|out5
suffix:colon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|out4
suffix:colon
id|pci_disable_device
c_func
(paren
id|meye.mchip_dev
)paren
suffix:semicolon
id|out3
suffix:colon
id|mchip_dma_free
c_func
(paren
)paren
suffix:semicolon
id|out2
suffix:colon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERA
comma
l_int|0
)paren
suffix:semicolon
id|out1
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|meye_remove
r_static
r_void
id|__devexit
id|meye_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
)paren
(brace
id|video_unregister_device
c_func
(paren
op_amp
id|meye.video_dev
)paren
suffix:semicolon
id|mchip_hic_stop
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|mchip_set
c_func
(paren
id|MCHIP_MM_INTA
comma
l_int|0x0
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|meye.mchip_irq
comma
id|meye_irq
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|meye.mchip_mmregs
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|meye.mchip_dev
comma
l_int|0
)paren
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|meye.mchip_dev
)paren
suffix:semicolon
id|mchip_dma_free
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|meye.grab_fbuffer
)paren
id|rvfree
c_func
(paren
id|meye.grab_fbuffer
comma
id|gbuffers
op_star
id|gbufsize
)paren
suffix:semicolon
id|sonypi_camera_command
c_func
(paren
id|SONYPI_COMMAND_SETCAMERA
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;meye: removed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|meye_pci_tbl
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_KAWASAKI
comma
id|PCI_DEVICE_ID_MCHIP_KL5A72002
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|meye_pci_tbl
)paren
suffix:semicolon
DECL|variable|meye_driver
r_static
r_struct
id|pci_driver
id|meye_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;meye&quot;
comma
id|id_table
suffix:colon
id|meye_pci_tbl
comma
id|probe
suffix:colon
id|meye_probe
comma
id|remove
suffix:colon
id|meye_remove
comma
)brace
suffix:semicolon
DECL|function|meye_init_module
r_static
r_int
id|__init
id|meye_init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|gbuffers
OL
l_int|2
)paren
id|gbuffers
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|gbuffers
OG
id|MEYE_MAX_BUFNBRS
)paren
id|gbuffers
op_assign
id|MEYE_MAX_BUFNBRS
suffix:semicolon
r_if
c_cond
(paren
id|gbufsize
template_param
id|MEYE_MAX_BUFSIZE
)paren
id|gbufsize
op_assign
id|MEYE_MAX_BUFSIZE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;meye: using %d buffers with %dk (%dk total) for capture&bslash;n&quot;
comma
id|gbuffers
comma
id|gbufsize
op_div
l_int|1024
comma
id|gbuffers
op_star
id|gbufsize
op_div
l_int|1024
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|meye_driver
)paren
suffix:semicolon
)brace
DECL|function|meye_cleanup_module
r_static
r_void
id|__exit
id|meye_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|meye_driver
)paren
suffix:semicolon
)brace
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Stelian Pop &lt;stelian.pop@fr.alcove.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;video4linux driver for the MotionEye camera&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|gbuffers
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gbuffers
comma
l_string|&quot;number of capture buffers, default is 2 (32 max)&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|gbufsize
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gbufsize
comma
l_string|&quot;size of the capture buffers, default is 614400&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|video_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|video_nr
comma
l_string|&quot;video device to register (0=/dev/video0, etc)&quot;
)paren
suffix:semicolon
multiline_comment|/* Module entry points */
DECL|variable|meye_init_module
id|module_init
c_func
(paren
id|meye_init_module
)paren
suffix:semicolon
DECL|variable|meye_cleanup_module
id|module_exit
c_func
(paren
id|meye_cleanup_module
)paren
suffix:semicolon
eof
