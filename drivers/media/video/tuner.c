multiline_comment|/*&n; * $Id: tuner.c,v 1.31 2004/11/10 11:07:24 kraxel Exp $&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;media/tuner.h&gt;
macro_line|#include &lt;media/audiochip.h&gt;
DECL|macro|UNSET
mdefine_line|#define UNSET (-1U)
multiline_comment|/* standard i2c insmod options */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_i2c_range
r_static
r_int
r_int
id|normal_i2c_range
(braket
)braket
op_assign
(brace
l_int|0x60
comma
l_int|0x6f
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
id|I2C_CLIENT_INSMOD
suffix:semicolon
multiline_comment|/* insmod options used at init time =&gt; read/only */
DECL|variable|type
r_static
r_int
r_int
id|type
op_assign
id|UNSET
suffix:semicolon
DECL|variable|addr
r_static
r_int
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|type
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|addr
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
multiline_comment|/* insmod options used at runtime =&gt; read/write */
DECL|variable|debug
r_static
r_int
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|tv_antenna
r_static
r_int
r_int
id|tv_antenna
op_assign
l_int|1
suffix:semicolon
DECL|variable|radio_antenna
r_static
r_int
r_int
id|radio_antenna
op_assign
l_int|0
suffix:semicolon
DECL|variable|optimize_vco
r_static
r_int
r_int
id|optimize_vco
op_assign
l_int|1
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|tv_antenna
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|radio_antenna
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|optimize_vco
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
DECL|variable|tv_range
r_static
r_int
r_int
id|tv_range
(braket
l_int|2
)braket
op_assign
(brace
l_int|44
comma
l_int|958
)brace
suffix:semicolon
DECL|variable|radio_range
r_static
r_int
r_int
id|radio_range
(braket
l_int|2
)braket
op_assign
(brace
l_int|65
comma
l_int|108
)brace
suffix:semicolon
id|module_param_array
c_func
(paren
id|tv_range
comma
r_int
comma
l_int|NULL
comma
l_int|0644
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|radio_range
comma
r_int
comma
l_int|NULL
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;device driver for various TV and TV+FM radio tuners&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ralph Metzler, Gerd Knorr, Gunther Mayer&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|this_adap
r_static
r_int
id|this_adap
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk     if (debug) printk
DECL|struct|tuner
r_struct
id|tuner
(brace
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
multiline_comment|/* chip type */
DECL|member|freq
r_int
r_int
id|freq
suffix:semicolon
multiline_comment|/* keep track of the current settings */
DECL|member|std
id|v4l2_std_id
id|std
suffix:semicolon
DECL|member|using_v4l2
r_int
id|using_v4l2
suffix:semicolon
DECL|member|radio
r_int
r_int
id|radio
suffix:semicolon
DECL|member|input
r_int
r_int
id|input
suffix:semicolon
singleline_comment|// only for MT2032
DECL|member|xogc
r_int
r_int
id|xogc
suffix:semicolon
DECL|member|radio_if2
r_int
r_int
id|radio_if2
suffix:semicolon
DECL|member|tv_freq
r_void
(paren
op_star
id|tv_freq
)paren
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
suffix:semicolon
DECL|member|radio_freq
r_void
(paren
op_star
id|radio_freq
)paren
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|i2c_driver
id|driver
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
suffix:semicolon
multiline_comment|/* ---------------------------------------------------------------------- */
multiline_comment|/* tv standard selection for Temic 4046 FM5&n;   this value takes the low bits of control byte 2&n;   from datasheet Rev.01, Feb.00&n;     standard     BG      I       L       L2      D&n;     picture IF   38.9    38.9    38.9    33.95   38.9&n;     sound 1      33.4    32.9    32.4    40.45   32.4&n;     sound 2      33.16&n;     NICAM        33.05   32.348  33.05           33.05&n; */
DECL|macro|TEMIC_SET_PAL_I
mdefine_line|#define TEMIC_SET_PAL_I         0x05
DECL|macro|TEMIC_SET_PAL_DK
mdefine_line|#define TEMIC_SET_PAL_DK        0x09
DECL|macro|TEMIC_SET_PAL_L
mdefine_line|#define TEMIC_SET_PAL_L         0x0a 
singleline_comment|// SECAM ?
DECL|macro|TEMIC_SET_PAL_L2
mdefine_line|#define TEMIC_SET_PAL_L2        0x0b 
singleline_comment|// change IF !
DECL|macro|TEMIC_SET_PAL_BG
mdefine_line|#define TEMIC_SET_PAL_BG        0x0c
multiline_comment|/* tv tuner system standard selection for Philips FQ1216ME&n;   this value takes the low bits of control byte 2&n;   from datasheet &quot;1999 Nov 16&quot; (supersedes &quot;1999 Mar 23&quot;)&n;     standard &t;&t;BG&t;DK&t;I&t;L&t;L`&n;     picture carrier&t;38.90&t;38.90&t;38.90&t;38.90&t;33.95&n;     colour&t;&t;34.47&t;34.47&t;34.47&t;34.47&t;38.38&n;     sound 1&t;&t;33.40&t;32.40&t;32.90&t;32.40&t;40.45&n;     sound 2&t;&t;33.16&t;-&t;-&t;-&t;-&n;     NICAM&t;&t;33.05&t;33.05&t;32.35&t;33.05&t;39.80&n; */
DECL|macro|PHILIPS_SET_PAL_I
mdefine_line|#define PHILIPS_SET_PAL_I&t;0x01 /* Bit 2 always zero !*/
DECL|macro|PHILIPS_SET_PAL_BGDK
mdefine_line|#define PHILIPS_SET_PAL_BGDK&t;0x09
DECL|macro|PHILIPS_SET_PAL_L2
mdefine_line|#define PHILIPS_SET_PAL_L2&t;0x0a
DECL|macro|PHILIPS_SET_PAL_L
mdefine_line|#define PHILIPS_SET_PAL_L&t;0x0b
multiline_comment|/* system switching for Philips FI1216MF MK2&n;   from datasheet &quot;1996 Jul 09&quot;,&n;    standard         BG     L      L&squot;&n;    picture carrier  38.90  38.90  33.95&n;    colour&t;     34.47  34.37  38.38&n;    sound 1          33.40  32.40  40.45&n;    sound 2          33.16  -      -&n;    NICAM            33.05  33.05  39.80&n; */
DECL|macro|PHILIPS_MF_SET_BG
mdefine_line|#define PHILIPS_MF_SET_BG&t;0x01 /* Bit 2 must be zero, Bit 3 is system output */
DECL|macro|PHILIPS_MF_SET_PAL_L
mdefine_line|#define PHILIPS_MF_SET_PAL_L&t;0x03 
singleline_comment|// France
DECL|macro|PHILIPS_MF_SET_PAL_L2
mdefine_line|#define PHILIPS_MF_SET_PAL_L2&t;0x02 
singleline_comment|// L&squot;
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|struct|tunertype
r_struct
id|tunertype
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|Vendor
r_int
r_char
id|Vendor
suffix:semicolon
DECL|member|Type
r_int
r_char
id|Type
suffix:semicolon
DECL|member|thresh1
r_int
r_int
id|thresh1
suffix:semicolon
multiline_comment|/*  band switch VHF_LO &lt;=&gt; VHF_HI  */
DECL|member|thresh2
r_int
r_int
id|thresh2
suffix:semicolon
multiline_comment|/*  band switch VHF_HI &lt;=&gt; UHF     */
DECL|member|VHF_L
r_int
r_char
id|VHF_L
suffix:semicolon
DECL|member|VHF_H
r_int
r_char
id|VHF_H
suffix:semicolon
DECL|member|UHF
r_int
r_char
id|UHF
suffix:semicolon
DECL|member|config
r_int
r_char
id|config
suffix:semicolon
DECL|member|IFPCoff
r_int
r_int
id|IFPCoff
suffix:semicolon
multiline_comment|/* 622.4=16*38.90 MHz PAL,&n;&t;&t;&t;&t;   732  =16*45.75 NTSCi,&n;&t;&t;&t;&t;   940  =16*58.75 NTSC-Japan&n;&t;&t;&t;&t;   704  =16*44    ATSC */
)brace
suffix:semicolon
multiline_comment|/*&n; *&t;The floats in the tuner struct are computed at compile time&n; *&t;by gcc and cast back to integers. Thus we don&squot;t violate the&n; *&t;&quot;no float in kernel&quot; rule.&n; */
DECL|variable|tuners
r_static
r_struct
id|tunertype
id|tuners
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;Temic PAL (4002 FH5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|140.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x01
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips PAL_I (FI1246 and compatibles)&quot;
comma
id|Philips
comma
id|PAL_I
comma
l_int|16
op_star
l_float|140.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips NTSC (FI1236,FM1236 and compatibles)&quot;
comma
id|Philips
comma
id|NTSC
comma
l_int|16
op_star
l_float|157.25
comma
l_int|16
op_star
l_float|451.25
comma
l_int|0xA0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Philips (SECAM+PAL_BG) (FI1216MF, FM1216MF, FR1216MF)&quot;
comma
id|Philips
comma
id|SECAM
comma
l_int|16
op_star
l_float|168.25
comma
l_int|16
op_star
l_float|447.25
comma
l_int|0xA7
comma
l_int|0x97
comma
l_int|0x37
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;NoTuner&quot;
comma
id|NoTuner
comma
id|NOTUNER
comma
l_int|0
comma
l_int|0
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(brace
l_string|&quot;Philips PAL_BG (FI1216 and compatibles)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|168.25
comma
l_int|16
op_star
l_float|447.25
comma
l_int|0xA0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic NTSC (4032 FY5)&quot;
comma
id|TEMIC
comma
id|NTSC
comma
l_int|16
op_star
l_float|157.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x01
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Temic PAL_I (4062 FY5)&quot;
comma
id|TEMIC
comma
id|PAL_I
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x01
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic NTSC (4036 FY5)&quot;
comma
id|TEMIC
comma
id|NTSC
comma
l_int|16
op_star
l_float|157.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Alps HSBH1&quot;
comma
id|TEMIC
comma
id|NTSC
comma
l_int|16
op_star
l_float|137.25
comma
l_int|16
op_star
l_float|385.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Alps TSBE1&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|137.25
comma
l_int|16
op_star
l_float|385.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Alps TSBB5&quot;
comma
id|Alps
comma
id|PAL_I
comma
multiline_comment|/* tested (UK UHF) with Modulartech MM205 */
l_int|16
op_star
l_float|133.25
comma
l_int|16
op_star
l_float|351.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|632
)brace
comma
(brace
l_string|&quot;Alps TSBE5&quot;
comma
id|Alps
comma
id|PAL
comma
multiline_comment|/* untested - data sheet guess. Only IF differs. */
l_int|16
op_star
l_float|133.25
comma
l_int|16
op_star
l_float|351.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|622
)brace
comma
(brace
l_string|&quot;Alps TSBC5&quot;
comma
id|Alps
comma
id|PAL
comma
multiline_comment|/* untested - data sheet guess. Only IF differs. */
l_int|16
op_star
l_float|133.25
comma
l_int|16
op_star
l_float|351.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|608
)brace
comma
(brace
l_string|&quot;Temic PAL_BG (4006FH5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Alps TSCH6&quot;
comma
id|Alps
comma
id|NTSC
comma
l_int|16
op_star
l_float|137.25
comma
l_int|16
op_star
l_float|385.25
comma
l_int|0x14
comma
l_int|0x12
comma
l_int|0x11
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Temic PAL_DK (4016 FY5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|168.25
comma
l_int|16
op_star
l_float|456.25
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips NTSC_M (MK2)&quot;
comma
id|Philips
comma
id|NTSC
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Temic PAL_I (4066 FY5)&quot;
comma
id|TEMIC
comma
id|PAL_I
comma
l_int|16
op_star
l_float|169.00
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic PAL* auto (4006 FN5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|169.00
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic PAL_BG (4009 FR5) or PAL_I (4069 FR5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|141.00
comma
l_int|16
op_star
l_float|464.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic NTSC (4039 FR5)&quot;
comma
id|TEMIC
comma
id|NTSC
comma
l_int|16
op_star
l_float|158.00
comma
l_int|16
op_star
l_float|453.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Temic PAL/SECAM multi (4046 FM5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|169.00
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips PAL_DK (FI1256 and compatibles)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips PAL/SECAM multi (FQ1216ME)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;LG PAL_I+FM (TAPC-I001D)&quot;
comma
id|LGINNOTEK
comma
id|PAL_I
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;LG PAL_I (TAPC-I701D)&quot;
comma
id|LGINNOTEK
comma
id|PAL_I
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;LG NTSC+FM (TPI8NSR01F)&quot;
comma
id|LGINNOTEK
comma
id|NTSC
comma
l_int|16
op_star
l_float|210.00
comma
l_int|16
op_star
l_float|497.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;LG PAL_BG+FM (TPI8PSB01D)&quot;
comma
id|LGINNOTEK
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;LG PAL_BG (TPI8PSB11D)&quot;
comma
id|LGINNOTEK
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic PAL* auto + FM (4009 FN5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|141.00
comma
l_int|16
op_star
l_float|464.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;SHARP NTSC_JP (2U5JF5540)&quot;
comma
id|SHARP
comma
id|NTSC
comma
multiline_comment|/* 940=16*58.75 NTSC@Japan */
l_int|16
op_star
l_float|137.25
comma
l_int|16
op_star
l_float|317.25
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|940
)brace
comma
(brace
l_string|&quot;Samsung PAL TCPM9091PD27&quot;
comma
id|Samsung
comma
id|PAL
comma
multiline_comment|/* from sourceforge v3tv */
l_int|16
op_star
l_int|169
comma
l_int|16
op_star
l_int|464
comma
l_int|0xA0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;MT20xx universal&quot;
comma
id|Microtune
comma
id|PAL
op_or
id|NTSC
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_string|&quot;Temic PAL_BG (4106 FH5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|141.00
comma
l_int|16
op_star
l_float|464.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic PAL_DK/SECAM_L (4012 FY5)&quot;
comma
id|TEMIC
comma
id|PAL
comma
l_int|16
op_star
l_float|140.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x01
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Temic NTSC (4136 FY5)&quot;
comma
id|TEMIC
comma
id|NTSC
comma
l_int|16
op_star
l_float|158.00
comma
l_int|16
op_star
l_float|453.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;LG PAL (newer TAPC series)&quot;
comma
id|LGINNOTEK
comma
id|PAL
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips PAL/SECAM multi (FM1216ME MK3)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|442.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;LG NTSC (newer TAPC series)&quot;
comma
id|LGINNOTEK
comma
id|NTSC
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;HITACHI V7-J180AT&quot;
comma
id|HITACHI
comma
id|NTSC
comma
l_int|16
op_star
l_float|170.00
comma
l_int|16
op_star
l_float|450.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|940
)brace
comma
(brace
l_string|&quot;Philips PAL_MK (FI1216 MK)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|140.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0x01
comma
l_int|0xc2
comma
l_int|0xcf
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Philips 1236D ATSC/NTSC daul in&quot;
comma
id|Philips
comma
id|ATSC
comma
l_int|16
op_star
l_float|157.25
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Philips NTSC MK3 (FM1236MK3 or FM1236/F)&quot;
comma
id|Philips
comma
id|NTSC
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|442.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Philips 4 in 1 (ATI TV Wonder Pro/Conexant)&quot;
comma
id|Philips
comma
id|NTSC
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|442.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Microtune 4049 FM5&quot;
comma
id|Microtune
comma
id|PAL
comma
l_int|16
op_star
l_float|141.00
comma
l_int|16
op_star
l_float|464.00
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Panasonic VP27s/ENGE4324D&quot;
comma
id|Panasonic
comma
id|NTSC
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|454.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0xce
comma
l_int|940
)brace
comma
(brace
l_string|&quot;LG NTSC (TAPE series)&quot;
comma
id|LGINNOTEK
comma
id|NTSC
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|442.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Tenna TNF 8831 BGFF)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|161.25
comma
l_int|16
op_star
l_float|463.25
comma
l_int|0xa0
comma
l_int|0x90
comma
l_int|0x30
comma
l_int|0x8e
comma
l_int|623
)brace
comma
(brace
l_string|&quot;Microtune 4042 FI5 ATSC/NTSC dual in&quot;
comma
id|Microtune
comma
id|NTSC
comma
l_int|16
op_star
l_float|162.00
comma
l_int|16
op_star
l_float|457.00
comma
l_int|0xa2
comma
l_int|0x94
comma
l_int|0x31
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;TCL 2002N&quot;
comma
id|TCL
comma
id|NTSC
comma
l_int|16
op_star
l_float|172.00
comma
l_int|16
op_star
l_float|448.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x08
comma
l_int|0x8e
comma
l_int|732
)brace
comma
(brace
l_string|&quot;Philips PAL/SECAM_D (FM 1256 I-H3)&quot;
comma
id|Philips
comma
id|PAL
comma
l_int|16
op_star
l_float|160.00
comma
l_int|16
op_star
l_float|442.00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x8e
comma
l_int|623
)brace
comma
)brace
suffix:semicolon
DECL|macro|TUNERS
mdefine_line|#define TUNERS ARRAY_SIZE(tuners)
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|tuner_getstatus
r_static
r_int
id|tuner_getstatus
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_int
r_char
id|byte
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|TUNER_MT2032
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|i2c_master_recv
c_func
(paren
id|c
comma
op_amp
id|byte
comma
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|byte
suffix:semicolon
)brace
DECL|macro|TUNER_POR
mdefine_line|#define TUNER_POR       0x80
DECL|macro|TUNER_FL
mdefine_line|#define TUNER_FL        0x40
DECL|macro|TUNER_MODE
mdefine_line|#define TUNER_MODE      0x38
DECL|macro|TUNER_AFC
mdefine_line|#define TUNER_AFC       0x07
DECL|macro|TUNER_STEREO
mdefine_line|#define TUNER_STEREO    0x10 /* radio mode */
DECL|macro|TUNER_SIGNAL
mdefine_line|#define TUNER_SIGNAL    0x07 /* radio mode */
DECL|function|tuner_signal
r_static
r_int
id|tuner_signal
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_return
(paren
id|tuner_getstatus
c_func
(paren
id|c
)paren
op_amp
id|TUNER_SIGNAL
)paren
op_lshift
l_int|13
suffix:semicolon
)brace
DECL|function|tuner_stereo
r_static
r_int
id|tuner_stereo
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_return
(paren
id|tuner_getstatus
(paren
id|c
)paren
op_amp
id|TUNER_STEREO
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* unused */
r_static
r_int
id|tuner_islocked
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_return
(paren
id|tuner_getstatus
(paren
id|c
)paren
op_amp
id|TUNER_FL
)paren
suffix:semicolon
)brace
r_static
r_int
id|tuner_afcstatus
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_return
(paren
id|tuner_getstatus
(paren
id|c
)paren
op_amp
id|TUNER_AFC
)paren
op_minus
l_int|2
suffix:semicolon
)brace
r_static
r_int
id|tuner_mode
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_return
(paren
id|tuner_getstatus
(paren
id|c
)paren
op_amp
id|TUNER_MODE
)paren
op_rshift
l_int|3
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|macro|MT2032
mdefine_line|#define MT2032 0x04
DECL|macro|MT2030
mdefine_line|#define MT2030 0x06
DECL|macro|MT2040
mdefine_line|#define MT2040 0x07
DECL|macro|MT2050
mdefine_line|#define MT2050 0x42
DECL|variable|microtune_part
r_static
r_char
op_star
id|microtune_part
(braket
)braket
op_assign
(brace
(braket
id|MT2030
)braket
op_assign
l_string|&quot;MT2030&quot;
comma
(braket
id|MT2032
)braket
op_assign
l_string|&quot;MT2032&quot;
comma
(braket
id|MT2040
)braket
op_assign
l_string|&quot;MT2040&quot;
comma
(braket
id|MT2050
)braket
op_assign
l_string|&quot;MT2050&quot;
comma
)brace
suffix:semicolon
singleline_comment|// IsSpurInBand()?
DECL|function|mt2032_spurcheck
r_static
r_int
id|mt2032_spurcheck
c_func
(paren
r_int
id|f1
comma
r_int
id|f2
comma
r_int
id|spectrum_from
comma
r_int
id|spectrum_to
)paren
(brace
r_int
id|n1
op_assign
l_int|1
comma
id|n2
comma
id|f
suffix:semicolon
id|f1
op_assign
id|f1
op_div
l_int|1000
suffix:semicolon
singleline_comment|//scale to kHz to avoid 32bit overflows
id|f2
op_assign
id|f2
op_div
l_int|1000
suffix:semicolon
id|spectrum_from
op_div_assign
l_int|1000
suffix:semicolon
id|spectrum_to
op_div_assign
l_int|1000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;spurcheck f1=%d f2=%d  from=%d to=%d&bslash;n&quot;
comma
id|f1
comma
id|f2
comma
id|spectrum_from
comma
id|spectrum_to
)paren
suffix:semicolon
r_do
(brace
id|n2
op_assign
op_minus
id|n1
suffix:semicolon
id|f
op_assign
id|n1
op_star
(paren
id|f1
op_minus
id|f2
)paren
suffix:semicolon
r_do
(brace
id|n2
op_decrement
suffix:semicolon
id|f
op_assign
id|f
op_minus
id|f2
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot; spurtest n1=%d n2=%d ftest=%d&bslash;n&quot;
comma
id|n1
comma
id|n2
comma
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|f
OG
id|spectrum_from
)paren
op_logical_and
(paren
id|f
OL
id|spectrum_to
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mt2032 spurcheck triggered: %d&bslash;n&quot;
comma
id|n1
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|f
OG
(paren
id|f2
op_minus
id|spectrum_to
)paren
)paren
op_logical_or
(paren
id|n2
OG
op_minus
l_int|5
)paren
)paren
suffix:semicolon
id|n1
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|n1
OL
l_int|5
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|mt2032_compute_freq
r_static
r_int
id|mt2032_compute_freq
c_func
(paren
r_int
r_int
id|rfin
comma
r_int
r_int
id|if1
comma
r_int
r_int
id|if2
comma
r_int
r_int
id|spectrum_from
comma
r_int
r_int
id|spectrum_to
comma
r_int
r_char
op_star
id|buf
comma
r_int
op_star
id|ret_sel
comma
r_int
r_int
id|xogc
)paren
singleline_comment|//all in Hz
(brace
r_int
r_int
id|fref
comma
id|lo1
comma
id|lo1n
comma
id|lo1a
comma
id|s
comma
id|sel
comma
id|lo1freq
comma
id|desired_lo1
comma
id|desired_lo2
comma
id|lo2
comma
id|lo2n
comma
id|lo2a
comma
id|lo2num
comma
id|lo2freq
suffix:semicolon
id|fref
op_assign
l_int|5250
op_star
l_int|1000
suffix:semicolon
singleline_comment|//5.25MHz
id|desired_lo1
op_assign
id|rfin
op_plus
id|if1
suffix:semicolon
id|lo1
op_assign
(paren
l_int|2
op_star
(paren
id|desired_lo1
op_div
l_int|1000
)paren
op_plus
(paren
id|fref
op_div
l_int|1000
)paren
)paren
op_div
(paren
l_int|2
op_star
id|fref
op_div
l_int|1000
)paren
suffix:semicolon
id|lo1n
op_assign
id|lo1
op_div
l_int|8
suffix:semicolon
id|lo1a
op_assign
id|lo1
op_minus
(paren
id|lo1n
op_star
l_int|8
)paren
suffix:semicolon
id|s
op_assign
id|rfin
op_div
l_int|1000
op_div
l_int|1000
op_plus
l_int|1090
suffix:semicolon
r_if
c_cond
(paren
id|optimize_vco
)paren
(brace
r_if
c_cond
(paren
id|s
OG
l_int|1890
)paren
(brace
id|sel
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1720
)paren
(brace
id|sel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1530
)paren
(brace
id|sel
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1370
)paren
(brace
id|sel
op_assign
l_int|3
suffix:semicolon
)brace
r_else
id|sel
op_assign
l_int|4
suffix:semicolon
singleline_comment|// &gt;1090
)brace
r_else
(brace
r_if
c_cond
(paren
id|s
OG
l_int|1790
)paren
(brace
id|sel
op_assign
l_int|0
suffix:semicolon
)brace
singleline_comment|// &lt;1958
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1617
)paren
(brace
id|sel
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1449
)paren
(brace
id|sel
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
OG
l_int|1291
)paren
(brace
id|sel
op_assign
l_int|3
suffix:semicolon
)brace
r_else
id|sel
op_assign
l_int|4
suffix:semicolon
singleline_comment|// &gt;1090
)brace
op_star
id|ret_sel
op_assign
id|sel
suffix:semicolon
id|lo1freq
op_assign
(paren
id|lo1a
op_plus
l_int|8
op_star
id|lo1n
)paren
op_star
id|fref
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032: rfin=%d lo1=%d lo1n=%d lo1a=%d sel=%d, lo1freq=%d&bslash;n&quot;
comma
id|rfin
comma
id|lo1
comma
id|lo1n
comma
id|lo1a
comma
id|sel
comma
id|lo1freq
)paren
suffix:semicolon
id|desired_lo2
op_assign
id|lo1freq
op_minus
id|rfin
op_minus
id|if2
suffix:semicolon
id|lo2
op_assign
(paren
id|desired_lo2
)paren
op_div
id|fref
suffix:semicolon
id|lo2n
op_assign
id|lo2
op_div
l_int|8
suffix:semicolon
id|lo2a
op_assign
id|lo2
op_minus
(paren
id|lo2n
op_star
l_int|8
)paren
suffix:semicolon
id|lo2num
op_assign
(paren
(paren
id|desired_lo2
op_div
l_int|1000
)paren
op_mod
(paren
id|fref
op_div
l_int|1000
)paren
)paren
op_star
l_int|3780
op_div
(paren
id|fref
op_div
l_int|1000
)paren
suffix:semicolon
singleline_comment|//scale to fit in 32bit arith
id|lo2freq
op_assign
(paren
id|lo2a
op_plus
l_int|8
op_star
id|lo2n
)paren
op_star
id|fref
op_plus
id|lo2num
op_star
(paren
id|fref
op_div
l_int|1000
)paren
op_div
l_int|3780
op_star
l_int|1000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032: rfin=%d lo2=%d lo2n=%d lo2a=%d num=%d lo2freq=%d&bslash;n&quot;
comma
id|rfin
comma
id|lo2
comma
id|lo2n
comma
id|lo2a
comma
id|lo2num
comma
id|lo2freq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lo1a
l_int|7
op_logical_or
id|lo1n
l_int|48
op_logical_or
id|lo2a
l_int|7
op_logical_or
id|lo2n
l_int|30
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mt2032: frequency parameters out of range: %d %d %d %d&bslash;n&quot;
comma
id|lo1a
comma
id|lo1n
comma
id|lo2a
comma
id|lo2n
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|mt2032_spurcheck
c_func
(paren
id|lo1freq
comma
id|desired_lo2
comma
id|spectrum_from
comma
id|spectrum_to
)paren
suffix:semicolon
singleline_comment|// should recalculate lo1 (one step up/down)
singleline_comment|// set up MT2032 register map for transfer over i2c
id|buf
(braket
l_int|0
)braket
op_assign
id|lo1n
op_minus
l_int|1
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|lo1a
op_or
(paren
id|sel
op_lshift
l_int|4
)paren
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x86
suffix:semicolon
singleline_comment|// LOGC
id|buf
(braket
l_int|3
)braket
op_assign
l_int|0x0f
suffix:semicolon
singleline_comment|//reserved
id|buf
(braket
l_int|4
)braket
op_assign
l_int|0x1f
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
(paren
id|lo2n
op_minus
l_int|1
)paren
op_or
(paren
id|lo2a
op_lshift
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfin
OG
l_int|400
op_star
l_int|1000
op_star
l_int|1000
)paren
(brace
id|buf
(braket
l_int|6
)braket
op_assign
l_int|0xe4
suffix:semicolon
)brace
r_else
id|buf
(braket
l_int|6
)braket
op_assign
l_int|0xf4
suffix:semicolon
singleline_comment|// set PKEN per rev 1.2
id|buf
(braket
l_int|7
)braket
op_assign
l_int|8
op_plus
id|xogc
suffix:semicolon
id|buf
(braket
l_int|8
)braket
op_assign
l_int|0xc3
suffix:semicolon
singleline_comment|//reserved
id|buf
(braket
l_int|9
)braket
op_assign
l_int|0x4e
suffix:semicolon
singleline_comment|//reserved
id|buf
(braket
l_int|10
)braket
op_assign
l_int|0xec
suffix:semicolon
singleline_comment|//reserved
id|buf
(braket
l_int|11
)braket
op_assign
(paren
id|lo2num
op_amp
l_int|0xff
)paren
suffix:semicolon
id|buf
(braket
l_int|12
)braket
op_assign
(paren
id|lo2num
op_rshift
l_int|8
)paren
op_or
l_int|0x80
suffix:semicolon
singleline_comment|// Lo2RST
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mt2032_check_lo_lock
r_static
r_int
id|mt2032_check_lo_lock
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_int
r_try
comma
id|lock
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_for
c_loop
(paren
r_try
op_assign
l_int|0
suffix:semicolon
r_try
OL
l_int|10
suffix:semicolon
r_try
op_increment
)paren
(brace
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0e
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032 Reg.E=0x%02x&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|lock
op_assign
id|buf
(braket
l_int|0
)braket
op_amp
l_int|0x06
suffix:semicolon
r_if
c_cond
(paren
id|lock
op_eq
l_int|6
)paren
r_break
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032: pll wait 1ms for lock (0x%2x)&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_return
id|lock
suffix:semicolon
)brace
DECL|function|mt2032_optimize_vco
r_static
r_int
id|mt2032_optimize_vco
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
id|sel
comma
r_int
id|lock
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|tad1
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032 Reg.F=0x%02x&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tad1
op_assign
id|buf
(braket
l_int|0
)braket
op_amp
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|tad1
op_eq
l_int|0
)paren
(brace
r_return
id|lock
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tad1
op_eq
l_int|1
)paren
(brace
r_return
id|lock
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tad1
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|sel
op_eq
l_int|0
)paren
(brace
r_return
id|lock
suffix:semicolon
)brace
r_else
id|sel
op_decrement
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sel
OL
l_int|4
)paren
(brace
id|sel
op_increment
suffix:semicolon
)brace
r_else
r_return
id|lock
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;mt2032 optimize_vco: sel=%d&bslash;n&quot;
comma
id|sel
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|sel
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
id|lock
op_assign
id|mt2032_check_lo_lock
c_func
(paren
id|c
)paren
suffix:semicolon
r_return
id|lock
suffix:semicolon
)brace
DECL|function|mt2032_set_if_freq
r_static
r_void
id|mt2032_set_if_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|rfin
comma
r_int
r_int
id|if1
comma
r_int
r_int
id|if2
comma
r_int
r_int
id|from
comma
r_int
r_int
id|to
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|21
)braket
suffix:semicolon
r_int
id|lint_try
comma
id|ret
comma
id|sel
comma
id|lock
op_assign
l_int|0
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032_set_if_freq rfin=%d if1=%d if2=%d from=%d to=%d&bslash;n&quot;
comma
id|rfin
comma
id|if1
comma
id|if2
comma
id|from
comma
id|to
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|21
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|mt2032_compute_freq
c_func
(paren
id|rfin
comma
id|if1
comma
id|if2
comma
id|from
comma
id|to
comma
op_amp
id|buf
(braket
l_int|1
)braket
comma
op_amp
id|sel
comma
id|t-&gt;xogc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
suffix:semicolon
singleline_comment|// send only the relevant registers per Rev. 1.2
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|4
)paren
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
l_int|5
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
op_plus
l_int|5
comma
l_int|4
)paren
suffix:semicolon
id|buf
(braket
l_int|11
)braket
op_assign
l_int|11
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
op_plus
l_int|11
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|3
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mt2032_set_if_freq failed with %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
singleline_comment|// wait for PLLs to lock (per manual), retry LINT if not.
r_for
c_loop
(paren
id|lint_try
op_assign
l_int|0
suffix:semicolon
id|lint_try
OL
l_int|2
suffix:semicolon
id|lint_try
op_increment
)paren
(brace
id|lock
op_assign
id|mt2032_check_lo_lock
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|optimize_vco
)paren
(brace
id|lock
op_assign
id|mt2032_optimize_vco
c_func
(paren
id|c
comma
id|sel
comma
id|lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lock
op_eq
l_int|6
)paren
(brace
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;mt2032: re-init PLLs by LINT&bslash;n&quot;
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|7
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x80
op_plus
l_int|8
op_plus
id|t-&gt;xogc
suffix:semicolon
singleline_comment|// set LINT to re-init PLLs
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|8
op_plus
id|t-&gt;xogc
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lock
op_ne
l_int|6
)paren
id|printk
c_func
(paren
l_string|&quot;MT2032 Fatal Error: PLLs didn&squot;t lock.&bslash;n&quot;
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|2
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x20
suffix:semicolon
singleline_comment|// LOGC for optimal phase noise
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;mt2032_set_if_freq2 failed with %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
DECL|function|mt2032_set_tv_freq
r_static
r_void
id|mt2032_set_tv_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
id|if2
comma
id|from
comma
id|to
suffix:semicolon
singleline_comment|// signal bandwidth and picture carrier
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_525_60
)paren
(brace
singleline_comment|// NTSC
id|from
op_assign
l_int|40750
op_star
l_int|1000
suffix:semicolon
id|to
op_assign
l_int|46750
op_star
l_int|1000
suffix:semicolon
id|if2
op_assign
l_int|45750
op_star
l_int|1000
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// PAL
id|from
op_assign
l_int|32900
op_star
l_int|1000
suffix:semicolon
id|to
op_assign
l_int|39900
op_star
l_int|1000
suffix:semicolon
id|if2
op_assign
l_int|38900
op_star
l_int|1000
suffix:semicolon
)brace
id|mt2032_set_if_freq
c_func
(paren
id|c
comma
id|freq
op_star
l_int|62500
multiline_comment|/* freq*1000*1000/16 */
comma
l_int|1090
op_star
l_int|1000
op_star
l_int|1000
comma
id|if2
comma
id|from
comma
id|to
)paren
suffix:semicolon
)brace
DECL|function|mt2032_set_radio_freq
r_static
r_void
id|mt2032_set_radio_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
id|if2
op_assign
id|t-&gt;radio_if2
suffix:semicolon
singleline_comment|// per Manual for FM tuning: first if center freq. 1085 MHz
id|mt2032_set_if_freq
c_func
(paren
id|c
comma
id|freq
op_star
l_int|62500
multiline_comment|/* freq*1000*1000/16 */
comma
l_int|1085
op_star
l_int|1000
op_star
l_int|1000
comma
id|if2
comma
id|if2
comma
id|if2
)paren
suffix:semicolon
)brace
singleline_comment|// Initalization as described in &quot;MT203x Programming Procedures&quot;, Rev 1.2, Feb.2001
DECL|function|mt2032_init
r_static
r_int
id|mt2032_init
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|21
)braket
suffix:semicolon
r_int
id|ret
comma
id|xogc
comma
id|xok
op_assign
l_int|0
suffix:semicolon
singleline_comment|// Initialize Registers per spec.
id|buf
(braket
l_int|1
)braket
op_assign
l_int|2
suffix:semicolon
singleline_comment|// Index to register 2
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|buf
(braket
l_int|4
)braket
op_assign
l_int|0x1f
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
op_plus
l_int|1
comma
l_int|4
)paren
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
l_int|6
suffix:semicolon
singleline_comment|// Index register 6
id|buf
(braket
l_int|6
)braket
op_assign
l_int|0xe4
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
l_int|0x8f
suffix:semicolon
id|buf
(braket
l_int|8
)braket
op_assign
l_int|0xc3
suffix:semicolon
id|buf
(braket
l_int|9
)braket
op_assign
l_int|0x4e
suffix:semicolon
id|buf
(braket
l_int|10
)braket
op_assign
l_int|0xec
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
op_plus
l_int|5
comma
l_int|6
)paren
suffix:semicolon
id|buf
(braket
l_int|12
)braket
op_assign
l_int|13
suffix:semicolon
singleline_comment|// Index register 13
id|buf
(braket
l_int|13
)braket
op_assign
l_int|0x32
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
op_plus
l_int|12
comma
l_int|2
)paren
suffix:semicolon
singleline_comment|// Adjust XOGC (register 7), wait for XOK
id|xogc
op_assign
l_int|7
suffix:semicolon
r_do
(brace
id|dprintk
c_func
(paren
l_string|&quot;mt2032: xogc = 0x%02x&bslash;n&quot;
comma
id|xogc
op_amp
l_int|0x07
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0e
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|xok
op_assign
id|buf
(braket
l_int|0
)braket
op_amp
l_int|0x01
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032: xok = 0x%02x&bslash;n&quot;
comma
id|xok
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xok
op_eq
l_int|1
)paren
r_break
suffix:semicolon
id|xogc
op_decrement
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2032: xogc = 0x%02x&bslash;n&quot;
comma
id|xogc
op_amp
l_int|0x07
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xogc
op_eq
l_int|3
)paren
(brace
id|xogc
op_assign
l_int|4
suffix:semicolon
singleline_comment|// min. 4 per spec
r_break
suffix:semicolon
)brace
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x07
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x88
op_plus
id|xogc
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|2
)paren
id|printk
c_func
(paren
l_string|&quot;mt2032_init failed with %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|xok
op_ne
l_int|1
)paren
suffix:semicolon
id|t-&gt;xogc
op_assign
id|xogc
suffix:semicolon
id|t-&gt;tv_freq
op_assign
id|mt2032_set_tv_freq
suffix:semicolon
id|t-&gt;radio_freq
op_assign
id|mt2032_set_radio_freq
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|mt2050_set_antenna
r_static
r_void
id|mt2050_set_antenna
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_char
id|antenna
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|6
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|antenna
ques
c_cond
l_int|0x11
suffix:colon
l_int|0x10
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2050: enabled antenna connector %d&bslash;n&quot;
comma
id|antenna
)paren
suffix:semicolon
)brace
DECL|function|mt2050_set_if_freq
r_static
r_void
id|mt2050_set_if_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
comma
r_int
r_int
id|if2
)paren
(brace
r_int
r_int
id|if1
op_assign
l_int|1218
op_star
l_int|1000
op_star
l_int|1000
suffix:semicolon
r_int
r_int
id|f_lo1
comma
id|f_lo2
comma
id|lo1
comma
id|lo2
comma
id|f_lo1_modulo
comma
id|f_lo2_modulo
comma
id|num1
comma
id|num2
comma
id|div1a
comma
id|div1b
comma
id|div2a
comma
id|div2b
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|6
)braket
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2050_set_if_freq freq=%d&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
id|f_lo1
op_assign
id|freq
op_plus
id|if1
suffix:semicolon
id|f_lo1
op_assign
(paren
id|f_lo1
op_div
l_int|1000000
)paren
op_star
l_int|1000000
suffix:semicolon
id|f_lo2
op_assign
id|f_lo1
op_minus
id|freq
op_minus
id|if2
suffix:semicolon
id|f_lo2
op_assign
(paren
id|f_lo2
op_div
l_int|50000
)paren
op_star
l_int|50000
suffix:semicolon
id|lo1
op_assign
id|f_lo1
op_div
l_int|4000000
suffix:semicolon
id|lo2
op_assign
id|f_lo2
op_div
l_int|4000000
suffix:semicolon
id|f_lo1_modulo
op_assign
id|f_lo1
op_minus
(paren
id|lo1
op_star
l_int|4000000
)paren
suffix:semicolon
id|f_lo2_modulo
op_assign
id|f_lo2
op_minus
(paren
id|lo2
op_star
l_int|4000000
)paren
suffix:semicolon
id|num1
op_assign
l_int|4
op_star
id|f_lo1_modulo
op_div
l_int|4000000
suffix:semicolon
id|num2
op_assign
l_int|4096
op_star
(paren
id|f_lo2_modulo
op_div
l_int|1000
)paren
op_div
l_int|4000
suffix:semicolon
singleline_comment|// todo spurchecks
id|div1a
op_assign
(paren
id|lo1
op_div
l_int|12
)paren
op_minus
l_int|1
suffix:semicolon
id|div1b
op_assign
id|lo1
op_minus
(paren
id|div1a
op_plus
l_int|1
)paren
op_star
l_int|12
suffix:semicolon
id|div2a
op_assign
(paren
id|lo2
op_div
l_int|8
)paren
op_minus
l_int|1
suffix:semicolon
id|div2b
op_assign
id|lo2
op_minus
(paren
id|div2a
op_plus
l_int|1
)paren
op_star
l_int|8
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;lo1 lo2 = %d %d&bslash;n&quot;
comma
id|lo1
comma
id|lo2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;num1 num2 div1a div1b div2a div2b= %x %x %x %x %x %x&bslash;n&quot;
comma
id|num1
comma
id|num2
comma
id|div1a
comma
id|div1b
comma
id|div2a
comma
id|div2b
)paren
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|4
op_star
id|div1b
op_plus
id|num1
suffix:semicolon
r_if
c_cond
(paren
id|freq
OL
l_int|275
op_star
l_int|1000
op_star
l_int|1000
)paren
(brace
id|buf
(braket
l_int|1
)braket
op_assign
id|buf
(braket
l_int|1
)braket
op_or
l_int|0x80
suffix:semicolon
)brace
id|buf
(braket
l_int|2
)braket
op_assign
id|div1a
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
l_int|32
op_star
id|div2b
op_plus
id|num2
op_div
l_int|256
suffix:semicolon
id|buf
(braket
l_int|4
)braket
op_assign
id|num2
op_minus
(paren
id|num2
op_div
l_int|256
)paren
op_star
l_int|256
suffix:semicolon
id|buf
(braket
l_int|5
)braket
op_assign
id|div2a
suffix:semicolon
r_if
c_cond
(paren
id|num2
op_ne
l_int|0
)paren
(brace
id|buf
(braket
l_int|5
)braket
op_assign
id|buf
(braket
l_int|5
)braket
op_or
l_int|0x40
suffix:semicolon
)brace
r_if
c_cond
(paren
id|debug
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;bufs is: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%x &quot;
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|6
)paren
id|printk
c_func
(paren
l_string|&quot;mt2050_set_if_freq failed with %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
DECL|function|mt2050_set_tv_freq
r_static
r_void
id|mt2050_set_tv_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
r_int
id|if2
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_525_60
)paren
(brace
singleline_comment|// NTSC
id|if2
op_assign
l_int|45750
op_star
l_int|1000
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// PAL
id|if2
op_assign
l_int|38900
op_star
l_int|1000
suffix:semicolon
)brace
id|mt2050_set_if_freq
c_func
(paren
id|c
comma
id|freq
op_star
l_int|62500
comma
id|if2
)paren
suffix:semicolon
id|mt2050_set_antenna
c_func
(paren
id|c
comma
id|tv_antenna
)paren
suffix:semicolon
)brace
DECL|function|mt2050_set_radio_freq
r_static
r_void
id|mt2050_set_radio_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
id|if2
op_assign
id|t-&gt;radio_if2
suffix:semicolon
id|mt2050_set_if_freq
c_func
(paren
id|c
comma
id|freq
op_star
l_int|62500
comma
id|if2
)paren
suffix:semicolon
id|mt2050_set_antenna
c_func
(paren
id|c
comma
id|radio_antenna
)paren
suffix:semicolon
)brace
DECL|function|mt2050_init
r_static
r_int
id|mt2050_init
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
l_int|6
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x10
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
singleline_comment|//  power
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0x0f
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|2
)paren
suffix:semicolon
singleline_comment|// m1lo
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x0d
suffix:semicolon
id|ret
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;mt2050: sro is %x&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|t-&gt;tv_freq
op_assign
id|mt2050_set_tv_freq
suffix:semicolon
id|t-&gt;radio_freq
op_assign
id|mt2050_set_radio_freq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|microtune_init
r_static
r_int
id|microtune_init
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
r_char
id|buf
(braket
l_int|21
)braket
suffix:semicolon
r_int
id|company_code
suffix:semicolon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
id|t-&gt;tv_freq
op_assign
l_int|NULL
suffix:semicolon
id|t-&gt;radio_freq
op_assign
l_int|NULL
suffix:semicolon
id|name
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|i2c_master_send
c_func
(paren
id|c
comma
id|buf
comma
l_int|1
)paren
suffix:semicolon
id|i2c_master_recv
c_func
(paren
id|c
comma
id|buf
comma
l_int|21
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debug
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tuner: MT2032 hexdump:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n &quot;
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n &quot;
)paren
suffix:semicolon
)brace
id|company_code
op_assign
id|buf
(braket
l_int|0x11
)braket
op_lshift
l_int|8
op_or
id|buf
(braket
l_int|0x12
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: microtune: companycode=%04x part=%02x rev=%02x&bslash;n&quot;
comma
id|company_code
comma
id|buf
(braket
l_int|0x13
)braket
comma
id|buf
(braket
l_int|0x14
)braket
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* seems to cause more problems than it solves ... */
r_switch
c_cond
(paren
id|company_code
)paren
(brace
r_case
l_int|0x30bf
suffix:colon
r_case
l_int|0x3cbf
suffix:colon
r_case
l_int|0x3dbf
suffix:colon
r_case
l_int|0x4d54
suffix:colon
r_case
l_int|0x8e81
suffix:colon
r_case
l_int|0x8e91
suffix:colon
multiline_comment|/* ok (?) */
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;tuner: microtune: unknown companycode&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|buf
(braket
l_int|0x13
)braket
OL
id|ARRAY_SIZE
c_func
(paren
id|microtune_part
)paren
op_logical_and
l_int|NULL
op_ne
id|microtune_part
(braket
id|buf
(braket
l_int|0x13
)braket
)braket
)paren
id|name
op_assign
id|microtune_part
(braket
id|buf
(braket
l_int|0x13
)braket
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|buf
(braket
l_int|0x13
)braket
)paren
(brace
r_case
id|MT2032
suffix:colon
id|mt2032_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT2050
suffix:colon
id|mt2050_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;tuner: microtune %s found, not (yet?) supported, sorry :-/&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;tuner: microtune %s found, OK&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|default_set_tv_freq
r_static
r_void
id|default_set_tv_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
id|u8
id|config
suffix:semicolon
id|u16
id|div
suffix:semicolon
r_struct
id|tunertype
op_star
id|tun
suffix:semicolon
r_int
r_char
id|buffer
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tun
op_assign
op_amp
id|tuners
(braket
id|t-&gt;type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|freq
OL
id|tun-&gt;thresh1
)paren
(brace
id|config
op_assign
id|tun-&gt;VHF_L
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tv: VHF lowrange&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|freq
OL
id|tun-&gt;thresh2
)paren
(brace
id|config
op_assign
id|tun-&gt;VHF_H
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tv: VHF high range&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|config
op_assign
id|tun-&gt;UHF
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tv: UHF range&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* tv norm specific stuff for multi-norm tuners */
r_switch
c_cond
(paren
id|t-&gt;type
)paren
(brace
r_case
id|TUNER_PHILIPS_SECAM
suffix:colon
singleline_comment|// FI1216MF
multiline_comment|/* 0x01 -&gt; ??? no change ??? */
multiline_comment|/* 0x02 -&gt; PAL BDGHI / SECAM L */
multiline_comment|/* 0x04 -&gt; ??? PAL others / SECAM others ??? */
id|config
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_SECAM
)paren
id|config
op_or_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TUNER_TEMIC_4046FM5
suffix:colon
id|config
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL_BG
)paren
(brace
id|config
op_or_assign
id|TEMIC_SET_PAL_BG
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL_I
)paren
(brace
id|config
op_or_assign
id|TEMIC_SET_PAL_I
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL_DK
)paren
(brace
id|config
op_or_assign
id|TEMIC_SET_PAL_DK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_SECAM_L
)paren
(brace
id|config
op_or_assign
id|TEMIC_SET_PAL_L
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TUNER_PHILIPS_FQ1216ME
suffix:colon
id|config
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;std
op_amp
(paren
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_PAL_DK
)paren
)paren
(brace
id|config
op_or_assign
id|PHILIPS_SET_PAL_BGDK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL_I
)paren
(brace
id|config
op_or_assign
id|PHILIPS_SET_PAL_I
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_SECAM_L
)paren
(brace
id|config
op_or_assign
id|PHILIPS_SET_PAL_L
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TUNER_PHILIPS_ATSC
suffix:colon
multiline_comment|/* 0x00 -&gt; ATSC antenna input 1 */
multiline_comment|/* 0x01 -&gt; ATSC antenna input 2 */
multiline_comment|/* 0x02 -&gt; NTSC antenna input 1 */
multiline_comment|/* 0x03 -&gt; NTSC antenna input 2 */
id|config
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_ATSC
)paren
)paren
id|config
op_or_assign
l_int|2
suffix:semicolon
multiline_comment|/* FIXME: input */
r_break
suffix:semicolon
r_case
id|TUNER_MICROTUNE_4042FI5
suffix:colon
multiline_comment|/* Set the charge pump for fast tuning */
id|tun-&gt;config
op_or_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Philips FI1216MK2 remark from specification :&n;&t; * for channel selection involving band switching, and to ensure&n;&t; * smooth tuning to the desired channel without causing&n;&t; * unnecessary charge pump action, it is recommended to consider&n;&t; * the difference between wanted channel frequency and the&n;&t; * current channel frequency.  Unnecessary charge pump action&n;&t; * will result in very low tuning voltage which may drive the&n;&t; * oscillator to extreme conditions.&n;&t; *&n;&t; * Progfou: specification says to send config data before&n;&t; * frequency in case (wanted frequency &lt; current frequency).&n;&t; */
id|div
op_assign
id|freq
op_plus
id|tun-&gt;IFPCoff
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|TUNER_PHILIPS_SECAM
op_logical_and
id|freq
OL
id|t-&gt;freq
)paren
(brace
id|buffer
(braket
l_int|0
)braket
op_assign
id|tun-&gt;config
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
id|config
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
id|buffer
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
id|tun-&gt;config
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
id|config
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;tuner: tv 0x%02x 0x%02x 0x%02x 0x%02x&bslash;n&quot;
comma
id|buffer
(braket
l_int|0
)braket
comma
id|buffer
(braket
l_int|1
)braket
comma
id|buffer
(braket
l_int|2
)braket
comma
id|buffer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|4
op_ne
(paren
id|rc
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buffer
comma
l_int|4
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;tuner: i2c i/o error: rc == %d (should be 4)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|TUNER_MICROTUNE_4042FI5
)paren
(brace
singleline_comment|// FIXME - this may also work for other tuners
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|msecs_to_jiffies
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|u8
id|status_byte
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Wait until the PLL locks */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|timeout
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
(paren
id|rc
op_assign
id|i2c_master_recv
c_func
(paren
id|c
comma
op_amp
id|status_byte
comma
l_int|1
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;tuner: i2c i/o read error: rc == %d (should be 1)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* bit 6 is PLL locked indicator */
r_if
c_cond
(paren
id|status_byte
op_amp
l_int|0x40
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
multiline_comment|/* Set the charge pump for optimized phase noise figure */
id|tun-&gt;config
op_and_assign
op_complement
l_int|0x40
suffix:semicolon
id|buffer
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
id|tun-&gt;config
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
id|config
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tuner: tv 0x%02x 0x%02x 0x%02x 0x%02x&bslash;n&quot;
comma
id|buffer
(braket
l_int|0
)braket
comma
id|buffer
(braket
l_int|1
)braket
comma
id|buffer
(braket
l_int|2
)braket
comma
id|buffer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|4
op_ne
(paren
id|rc
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buffer
comma
l_int|4
)paren
)paren
)paren
id|dprintk
c_func
(paren
l_string|&quot;tuner: i2c i/o error: rc == %d (should be 4)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
)brace
DECL|function|default_set_radio_freq
r_static
r_void
id|default_set_radio_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tunertype
op_star
id|tun
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_int
r_char
id|buffer
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|div
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tun
op_assign
op_amp
id|tuners
(braket
id|t-&gt;type
)braket
suffix:semicolon
id|div
op_assign
id|freq
op_plus
(paren
r_int
)paren
(paren
l_int|16
op_star
l_float|10.7
)paren
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
id|tun-&gt;config
suffix:semicolon
r_switch
c_cond
(paren
id|t-&gt;type
)paren
(brace
r_case
id|TUNER_PHILIPS_FM1216ME_MK3
suffix:colon
r_case
id|TUNER_PHILIPS_FM1236_MK3
suffix:colon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0x19
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TUNER_PHILIPS_FM1256_IH3
suffix:colon
id|div
op_assign
(paren
l_int|20
op_star
id|freq
)paren
op_div
l_int|16
op_plus
l_int|333
op_star
l_int|2
suffix:semicolon
id|buffer
(braket
l_int|2
)braket
op_assign
l_int|0x80
suffix:semicolon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0x19
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TUNER_LG_PAL_FM
suffix:colon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0xa5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|buffer
(braket
l_int|3
)braket
op_assign
l_int|0xa4
suffix:semicolon
r_break
suffix:semicolon
)brace
id|buffer
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buffer
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tuner: radio 0x%02x 0x%02x 0x%02x 0x%02x&bslash;n&quot;
comma
id|buffer
(braket
l_int|0
)braket
comma
id|buffer
(braket
l_int|1
)braket
comma
id|buffer
(braket
l_int|2
)braket
comma
id|buffer
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|4
op_ne
(paren
id|rc
op_assign
id|i2c_master_send
c_func
(paren
id|c
comma
id|buffer
comma
l_int|4
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;tuner: i2c i/o error: rc == %d (should be 4)&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
singleline_comment|// Set tuner frequency,  freq in Units of 62.5kHz = 1/16MHz
DECL|function|set_tv_freq
r_static
r_void
id|set_tv_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|UNSET
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tuner: tuner type not set&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t-&gt;tv_freq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tuner: Huh? tv_set is NULL?&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freq
template_param
id|tv_range
(braket
l_int|1
)braket
op_star
l_int|16
)paren
(brace
multiline_comment|/* FIXME: better do that chip-specific, but&n;&t;&t;   right now we don&squot;t have that in the config&n;&t;&t;   struct and this way is still better than no&n;&t;&t;   check at all */
id|printk
c_func
(paren
l_string|&quot;tuner: TV freq (%d.%02d) out of range (%d-%d)&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
comma
id|tv_range
(braket
l_int|0
)braket
comma
id|tv_range
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|t
op_member_access_from_pointer
id|tv_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
DECL|function|set_radio_freq
r_static
r_void
id|set_radio_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|UNSET
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tuner: tuner type not set&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t-&gt;radio_freq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tuner: no radio tuning for this one, sorry.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freq
template_param
id|radio_range
(braket
l_int|1
)braket
op_star
l_int|16
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tuner: radio freq (%d.%02d) out of range (%d-%d)&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
comma
id|radio_range
(braket
l_int|0
)braket
comma
id|radio_range
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|t
op_member_access_from_pointer
id|radio_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
DECL|function|set_freq
r_static
r_void
id|set_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;radio
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;tuner: radio freq set to %lu.%02lu&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
)paren
suffix:semicolon
id|set_radio_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;tuner: tv freq set to %lu.%02lu&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
)paren
suffix:semicolon
id|set_tv_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
id|t-&gt;freq
op_assign
id|freq
suffix:semicolon
)brace
DECL|function|set_type
r_static
r_void
id|set_type
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|type
comma
r_char
op_star
id|source
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_ne
id|UNSET
op_logical_and
id|t-&gt;type
op_ne
id|TUNER_ABSENT
)paren
(brace
r_if
c_cond
(paren
id|t-&gt;type
op_ne
id|type
)paren
id|printk
c_func
(paren
l_string|&quot;tuner: type already set to %d, &quot;
l_string|&quot;ignoring request for %d&bslash;n&quot;
comma
id|t-&gt;type
comma
id|type
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_ge
id|TUNERS
)paren
r_return
suffix:semicolon
id|t-&gt;type
op_assign
id|type
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: type set to %d (%s) by %s&bslash;n&quot;
comma
id|t-&gt;type
comma
id|tuners
(braket
id|t-&gt;type
)braket
dot
id|name
comma
id|source
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|c-&gt;name
comma
id|tuners
(braket
id|t-&gt;type
)braket
dot
id|name
comma
r_sizeof
(paren
id|c-&gt;name
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|t-&gt;type
)paren
(brace
r_case
id|TUNER_MT2032
suffix:colon
id|microtune_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|t-&gt;tv_freq
op_assign
id|default_set_tv_freq
suffix:semicolon
id|t-&gt;radio_freq
op_assign
id|default_set_radio_freq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|variable|pal
r_static
r_char
id|pal
(braket
)braket
op_assign
l_string|&quot;-&quot;
suffix:semicolon
id|module_param_string
c_func
(paren
id|pal
comma
id|pal
comma
l_int|0644
comma
r_sizeof
(paren
id|pal
)paren
)paren
suffix:semicolon
DECL|function|tuner_fixup_std
r_static
r_int
id|tuner_fixup_std
c_func
(paren
r_struct
id|tuner
op_star
id|t
)paren
(brace
r_if
c_cond
(paren
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL
)paren
op_eq
id|V4L2_STD_PAL
)paren
(brace
multiline_comment|/* get more precise norm info from insmod option */
r_switch
c_cond
(paren
id|pal
(braket
l_int|0
)braket
)paren
(brace
r_case
l_char|&squot;b&squot;
suffix:colon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;g&squot;
suffix:colon
r_case
l_char|&squot;G&squot;
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-BG&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_BG
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;i&squot;
suffix:colon
r_case
l_char|&squot;I&squot;
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-I&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_I
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_case
l_char|&squot;D&squot;
suffix:colon
r_case
l_char|&squot;k&squot;
suffix:colon
r_case
l_char|&squot;K&squot;
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-DK&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_DK
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|tuner_attach
r_static
r_int
id|tuner_attach
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
id|addr
comma
r_int
id|kind
)paren
(brace
r_struct
id|tuner
op_star
id|t
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_if
c_cond
(paren
id|this_adap
OG
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|this_adap
op_increment
suffix:semicolon
id|client_template.adapter
op_assign
id|adap
suffix:semicolon
id|client_template.addr
op_assign
id|addr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: chip found at addr 0x%x i2c-bus %s&bslash;n&quot;
comma
id|addr
op_lshift
l_int|1
comma
id|adap-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|client
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i2c_client
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|client
comma
op_amp
id|client_template
comma
r_sizeof
(paren
r_struct
id|i2c_client
)paren
)paren
suffix:semicolon
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|tuner
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t
)paren
(brace
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tuner
)paren
)paren
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|client
comma
id|t
)paren
suffix:semicolon
id|t-&gt;type
op_assign
id|UNSET
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|10700
op_star
l_int|1000
suffix:semicolon
singleline_comment|// 10.7MHz - FM radio
id|i2c_attach_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
OL
id|TUNERS
)paren
(brace
id|set_type
c_func
(paren
id|client
comma
id|type
comma
l_string|&quot;insmod option&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: The type=&lt;n&gt; insmod option will go away soon.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: Please use the tuner=&lt;n&gt; option provided by&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;tuner: tv aard core driver (bttv, saa7134, ...) instead.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_probe
r_static
r_int
id|tuner_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|addr
)paren
(brace
id|normal_i2c_range
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
id|normal_i2c_range
(braket
l_int|1
)braket
op_assign
id|addr
suffix:semicolon
)brace
id|this_adap
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef I2C_CLASS_TV_ANALOG
r_if
c_cond
(paren
id|adap
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_TV_ANALOG
)paren
r_return
id|i2c_probe
c_func
(paren
id|adap
comma
op_amp
id|addr_data
comma
id|tuner_attach
)paren
suffix:semicolon
macro_line|#else
r_switch
c_cond
(paren
id|adap-&gt;id
)paren
(brace
r_case
id|I2C_ALGO_BIT
op_or
id|I2C_HW_SMBUS_VOODOO3
suffix:colon
r_case
id|I2C_ALGO_BIT
op_or
id|I2C_HW_B_BT848
suffix:colon
r_case
id|I2C_ALGO_BIT
op_or
id|I2C_HW_B_RIVA
suffix:colon
r_case
id|I2C_ALGO_SAA7134
suffix:colon
r_case
id|I2C_ALGO_SAA7146
suffix:colon
r_return
id|i2c_probe
c_func
(paren
id|adap
comma
op_amp
id|addr_data
comma
id|tuner_attach
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_detach
r_static
r_int
id|tuner_detach
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|SWITCH_V4L2
mdefine_line|#define SWITCH_V4L2&t;if (!t-&gt;using_v4l2 &amp;&amp; debug) &bslash;&n;&t;&t;          printk(&quot;tuner: switching to v4l2&bslash;n&quot;); &bslash;&n;&t;                  t-&gt;using_v4l2 = 1;
DECL|macro|CHECK_V4L2
mdefine_line|#define CHECK_V4L2&t;if (t-&gt;using_v4l2) { if (debug) &bslash;&n;&t;&t;&t;  printk(&quot;tuner: ignore v4l1 call&bslash;n&quot;); &bslash;&n;&t;&t;          return 0; }
r_static
r_int
DECL|function|tuner_command
id|tuner_command
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
op_star
id|iarg
op_assign
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/* --- configuration --- */
r_case
id|TUNER_SET_TYPE
suffix:colon
id|set_type
c_func
(paren
id|client
comma
op_star
id|iarg
comma
id|client-&gt;adapter-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDC_SET_RADIO
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;radio
)paren
(brace
id|set_tv_freq
c_func
(paren
id|client
comma
l_int|400
op_star
l_int|16
)paren
suffix:semicolon
id|t-&gt;radio
op_assign
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AUDC_CONFIG_PINNACLE
suffix:colon
r_switch
c_cond
(paren
op_star
id|iarg
)paren
(brace
r_case
l_int|2
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;tuner: pinnacle pal&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|33300
op_star
l_int|1000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;tuner: pinnacle ntsc&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|41300
op_star
l_int|1000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* --- v4l ioctls --- */
multiline_comment|/* take care: bttv does userspace copying, we&squot;ll get a&n;&t;   kernel pointer here... */
r_case
id|VIDIOCSCHAN
suffix:colon
(brace
r_static
r_const
id|v4l2_std_id
id|map
(braket
)braket
op_assign
(brace
(braket
id|VIDEO_MODE_PAL
)braket
op_assign
id|V4L2_STD_PAL
comma
(braket
id|VIDEO_MODE_NTSC
)braket
op_assign
id|V4L2_STD_NTSC_M
comma
(braket
id|VIDEO_MODE_SECAM
)braket
op_assign
id|V4L2_STD_SECAM
comma
(braket
l_int|4
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_PAL_M
comma
(braket
l_int|5
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_PAL_N
comma
(braket
l_int|6
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_NTSC_M_JP
comma
)brace
suffix:semicolon
r_struct
id|video_channel
op_star
id|vc
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
id|t-&gt;radio
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;norm
OL
id|ARRAY_SIZE
c_func
(paren
id|map
)paren
)paren
id|t-&gt;std
op_assign
id|map
(braket
id|vc-&gt;norm
)braket
suffix:semicolon
id|tuner_fixup_std
c_func
(paren
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_tv_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSFREQ
suffix:colon
(brace
r_int
r_int
op_star
id|v
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
id|set_freq
c_func
(paren
id|client
comma
op_star
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGTUNER
suffix:colon
(brace
r_struct
id|video_tuner
op_star
id|vt
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;radio
)paren
id|vt-&gt;signal
op_assign
id|tuner_signal
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGAUDIO
suffix:colon
(brace
r_struct
id|video_audio
op_star
id|va
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;radio
)paren
id|va-&gt;mode
op_assign
(paren
id|tuner_stereo
c_func
(paren
id|client
)paren
ques
c_cond
id|VIDEO_SOUND_STEREO
suffix:colon
id|VIDEO_SOUND_MONO
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_STD
suffix:colon
(brace
id|v4l2_std_id
op_star
id|id
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
id|t-&gt;radio
op_assign
l_int|0
suffix:semicolon
id|t-&gt;std
op_assign
op_star
id|id
suffix:semicolon
id|tuner_fixup_std
c_func
(paren
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOC_S_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_ANALOG_TV
op_eq
id|f-&gt;type
)paren
(brace
id|t-&gt;radio
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_eq
id|f-&gt;type
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;radio
)paren
(brace
id|set_tv_freq
c_func
(paren
id|client
comma
l_int|400
op_star
l_int|16
)paren
suffix:semicolon
id|t-&gt;radio
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|t-&gt;freq
op_assign
id|f-&gt;frequency
suffix:semicolon
id|set_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOC_G_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|tuner
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;radio
)paren
id|tuner-&gt;signal
op_assign
id|tuner_signal
c_func
(paren
id|client
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/* nothing */
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_suspend
r_static
r_int
id|tuner_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;tuner: suspend&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* FIXME: power down ??? */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_resume
r_static
r_int
id|tuner_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|level
)paren
(brace
r_struct
id|i2c_client
op_star
id|c
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|i2c_client
comma
id|dev
)paren
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;tuner: resume&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_freq
c_func
(paren
id|c
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|driver
r_static
r_struct
id|i2c_driver
id|driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;i2c TV tuner driver&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_TUNER
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|tuner_probe
comma
dot
id|detach_client
op_assign
id|tuner_detach
comma
dot
id|command
op_assign
id|tuner_command
comma
dot
id|driver
op_assign
(brace
dot
id|suspend
op_assign
id|tuner_suspend
comma
dot
id|resume
op_assign
id|tuner_resume
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;(tuner unset)&quot;
)paren
comma
dot
id|flags
op_assign
id|I2C_CLIENT_ALLOW_USE
comma
dot
id|driver
op_assign
op_amp
id|driver
comma
)brace
suffix:semicolon
DECL|function|tuner_init_module
r_static
r_int
id|__init
id|tuner_init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|tuner_cleanup_module
r_static
r_void
id|__exit
id|tuner_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|variable|tuner_init_module
id|module_init
c_func
(paren
id|tuner_init_module
)paren
suffix:semicolon
DECL|variable|tuner_cleanup_module
id|module_exit
c_func
(paren
id|tuner_cleanup_module
)paren
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
