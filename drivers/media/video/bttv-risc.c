multiline_comment|/*&n;    bttv-risc.c  --  interfaces to other kernel modules&n;&n;    bttv risc code handling&n;&t;- memory management&n;&t;- generation&n;&n;    (c) 2000 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n;*/
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__ 1
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/iobuf.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &quot;bttvp.h&quot;
multiline_comment|/* ---------------------------------------------------------- */
multiline_comment|/* allocate/free risc memory                                  */
DECL|function|bttv_riscmem_alloc
r_int
id|bttv_riscmem_alloc
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|bttv_riscmem
op_star
id|risc
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
op_star
id|cpu
suffix:semicolon
id|dma_addr_t
id|dma
suffix:semicolon
id|cpu
op_assign
id|pci_alloc_consistent
c_func
(paren
id|pci
comma
id|size
comma
op_amp
id|dma
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|cpu
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|cpu
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|risc-&gt;cpu
op_logical_and
id|risc-&gt;size
OL
id|size
)paren
(brace
multiline_comment|/* realloc (enlarge buffer) -- copy old stuff */
id|memcpy
c_func
(paren
id|cpu
comma
id|risc-&gt;cpu
comma
id|risc-&gt;size
)paren
suffix:semicolon
id|bttv_riscmem_free
c_func
(paren
id|pci
comma
id|risc
)paren
suffix:semicolon
)brace
id|risc-&gt;cpu
op_assign
id|cpu
suffix:semicolon
id|risc-&gt;dma
op_assign
id|dma
suffix:semicolon
id|risc-&gt;size
op_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bttv_riscmem_free
r_void
id|bttv_riscmem_free
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|bttv_riscmem
op_star
id|risc
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|risc-&gt;cpu
)paren
r_return
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|pci
comma
id|risc-&gt;size
comma
id|risc-&gt;cpu
comma
id|risc-&gt;dma
)paren
suffix:semicolon
id|memset
c_func
(paren
id|risc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|risc
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
multiline_comment|/* risc code generators                                       */
r_int
DECL|function|bttv_risc_packed
id|bttv_risc_packed
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_riscmem
op_star
id|risc
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
id|offset
comma
r_int
id|bpl
comma
r_int
id|padding
comma
r_int
id|lines
)paren
(brace
r_int
id|instructions
comma
id|rc
comma
id|line
comma
id|todo
suffix:semicolon
r_struct
id|scatterlist
op_star
id|sg
suffix:semicolon
r_int
r_int
op_star
id|rp
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is one write per page border +&n;&t;   one write per scan line + sync + jump (all 2 dwords) */
id|instructions
op_assign
(paren
id|bpl
op_star
id|lines
)paren
op_div
id|PAGE_SIZE
op_plus
id|lines
suffix:semicolon
id|instructions
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|bttv_riscmem_alloc
c_func
(paren
id|btv-&gt;dev
comma
id|risc
comma
id|instructions
op_star
l_int|8
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* sync instruction */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* scan lines */
id|sg
op_assign
id|sglist
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|lines
suffix:semicolon
id|line
op_increment
)paren
(brace
r_while
c_loop
(paren
id|offset
op_ge
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
id|offset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bpl
op_le
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
(brace
multiline_comment|/* fits into current chunk */
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_SOL
op_or
id|BT848_RISC_EOL
op_or
id|bpl
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
id|bpl
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* scanline needs to be splitted */
id|todo
op_assign
id|bpl
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_SOL
op_or
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|todo
op_sub_assign
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|sg
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|todo
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_WRITE
op_or
id|BT848_RISC_EOL
op_or
id|todo
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|todo
suffix:semicolon
)brace
id|offset
op_add_assign
id|padding
suffix:semicolon
)brace
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|bttv_risc_planar
id|bttv_risc_planar
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_riscmem
op_star
id|risc
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
id|yoffset
comma
r_int
id|ybpl
comma
r_int
id|ypadding
comma
r_int
id|ylines
comma
r_int
id|uoffset
comma
r_int
id|voffset
comma
r_int
id|hshift
comma
r_int
id|vshift
comma
r_int
id|cpadding
)paren
(brace
r_int
id|instructions
comma
id|rc
comma
id|line
comma
id|todo
comma
id|ylen
comma
id|chroma
suffix:semicolon
r_int
r_int
op_star
id|rp
comma
id|ri
suffix:semicolon
r_struct
id|scatterlist
op_star
id|ysg
suffix:semicolon
r_struct
id|scatterlist
op_star
id|usg
suffix:semicolon
r_struct
id|scatterlist
op_star
id|vsg
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is one write per page border +&n;&t;   one write per scan line (5 dwords)&n;&t;   plus sync + jump (2 dwords) */
id|instructions
op_assign
(paren
id|ybpl
op_star
id|ylines
op_star
l_int|2
)paren
op_div
id|PAGE_SIZE
op_plus
id|ylines
suffix:semicolon
id|instructions
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|bttv_riscmem_alloc
c_func
(paren
id|btv-&gt;dev
comma
id|risc
comma
id|instructions
op_star
l_int|4
op_star
l_int|5
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* sync instruction */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM3
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* scan lines */
id|ysg
op_assign
id|sglist
suffix:semicolon
id|usg
op_assign
id|sglist
suffix:semicolon
id|vsg
op_assign
id|sglist
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|ylines
suffix:semicolon
id|line
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|vshift
)paren
(brace
r_case
l_int|0
suffix:colon
id|chroma
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|chroma
op_assign
op_logical_neg
(paren
id|line
op_amp
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|chroma
op_assign
op_logical_neg
(paren
id|line
op_amp
l_int|3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|chroma
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|todo
op_assign
id|ybpl
suffix:semicolon
id|todo
OG
l_int|0
suffix:semicolon
id|todo
op_sub_assign
id|ylen
)paren
(brace
multiline_comment|/* go to next sg entry if needed */
r_while
c_loop
(paren
id|yoffset
op_ge
id|sg_dma_len
c_func
(paren
id|ysg
)paren
)paren
(brace
id|yoffset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|ysg
)paren
suffix:semicolon
id|ysg
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|uoffset
op_ge
id|sg_dma_len
c_func
(paren
id|usg
)paren
)paren
(brace
id|uoffset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|usg
)paren
suffix:semicolon
id|usg
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|voffset
op_ge
id|sg_dma_len
c_func
(paren
id|vsg
)paren
)paren
(brace
id|voffset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|vsg
)paren
suffix:semicolon
id|vsg
op_increment
suffix:semicolon
)brace
multiline_comment|/* calculate max number of bytes we can write */
id|ylen
op_assign
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|yoffset
op_plus
id|ylen
OG
id|sg_dma_len
c_func
(paren
id|ysg
)paren
)paren
id|ylen
op_assign
id|sg_dma_len
c_func
(paren
id|ysg
)paren
op_minus
id|yoffset
suffix:semicolon
r_if
c_cond
(paren
id|chroma
)paren
(brace
r_if
c_cond
(paren
id|uoffset
op_plus
(paren
id|ylen
op_rshift
id|hshift
)paren
OG
id|sg_dma_len
c_func
(paren
id|usg
)paren
)paren
id|ylen
op_assign
(paren
id|sg_dma_len
c_func
(paren
id|usg
)paren
op_minus
id|uoffset
)paren
op_lshift
id|hshift
suffix:semicolon
r_if
c_cond
(paren
id|voffset
op_plus
(paren
id|ylen
op_rshift
id|hshift
)paren
OG
id|sg_dma_len
c_func
(paren
id|vsg
)paren
)paren
id|ylen
op_assign
(paren
id|sg_dma_len
c_func
(paren
id|vsg
)paren
op_minus
id|voffset
)paren
op_lshift
id|hshift
suffix:semicolon
id|ri
op_assign
id|BT848_RISC_WRITE123
suffix:semicolon
)brace
r_else
(brace
id|ri
op_assign
id|BT848_RISC_WRITE1S23
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ybpl
op_eq
id|todo
)paren
id|ri
op_or_assign
id|BT848_RISC_SOL
suffix:semicolon
r_if
c_cond
(paren
id|ylen
op_eq
id|todo
)paren
id|ri
op_or_assign
id|BT848_RISC_EOL
suffix:semicolon
multiline_comment|/* write risc instruction */
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|ri
op_or
id|ylen
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
(paren
(paren
id|ylen
op_rshift
id|hshift
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|ylen
op_rshift
id|hshift
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|ysg
)paren
op_plus
id|yoffset
)paren
suffix:semicolon
id|yoffset
op_add_assign
id|ylen
suffix:semicolon
r_if
c_cond
(paren
id|chroma
)paren
(brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|usg
)paren
op_plus
id|uoffset
)paren
suffix:semicolon
id|uoffset
op_add_assign
id|ylen
op_rshift
id|hshift
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|vsg
)paren
op_plus
id|voffset
)paren
suffix:semicolon
id|voffset
op_add_assign
id|ylen
op_rshift
id|hshift
suffix:semicolon
)brace
)brace
id|yoffset
op_add_assign
id|ypadding
suffix:semicolon
r_if
c_cond
(paren
id|chroma
)paren
(brace
id|uoffset
op_add_assign
id|cpadding
suffix:semicolon
id|voffset
op_add_assign
id|cpadding
suffix:semicolon
)brace
)brace
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
DECL|struct|SKIPLIST
r_struct
id|SKIPLIST
(brace
DECL|member|start
r_int
id|start
suffix:semicolon
DECL|member|end
r_int
id|end
suffix:semicolon
)brace
suffix:semicolon
r_int
DECL|function|bttv_screen_clips
id|bttv_screen_clips
c_func
(paren
r_struct
id|video_buffer
op_star
id|fbuf
comma
r_int
id|x
comma
r_int
id|y
comma
r_int
id|width
comma
r_int
id|height
comma
r_struct
id|video_clip
op_star
id|clips
comma
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
id|x
OL
l_int|0
)paren
(brace
multiline_comment|/* left */
id|clips
(braket
id|n
)braket
dot
id|x
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|y
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|width
op_assign
op_minus
id|x
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|height
op_assign
id|height
suffix:semicolon
id|n
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_plus
id|width
OG
id|fbuf-&gt;width
)paren
(brace
multiline_comment|/* right */
id|clips
(braket
id|n
)braket
dot
id|x
op_assign
id|fbuf-&gt;width
op_minus
id|x
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|y
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|width
op_assign
id|width
op_minus
id|clips
(braket
id|n
)braket
dot
id|x
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|height
op_assign
id|height
suffix:semicolon
id|n
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|y
OL
l_int|0
)paren
(brace
multiline_comment|/* top */
id|clips
(braket
id|n
)braket
dot
id|x
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|y
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|width
op_assign
id|width
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|height
op_assign
op_minus
id|y
suffix:semicolon
id|n
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|y
op_plus
id|height
OG
id|fbuf-&gt;height
)paren
(brace
multiline_comment|/* bottom */
id|clips
(braket
id|n
)braket
dot
id|x
op_assign
l_int|0
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|y
op_assign
id|fbuf-&gt;height
op_minus
id|y
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|width
op_assign
id|width
suffix:semicolon
id|clips
(braket
id|n
)braket
dot
id|height
op_assign
id|height
op_minus
id|clips
(braket
id|n
)braket
dot
id|y
suffix:semicolon
id|n
op_increment
suffix:semicolon
)brace
r_return
id|n
suffix:semicolon
)brace
r_void
DECL|function|bttv_sort_clips
id|bttv_sort_clips
c_func
(paren
r_struct
id|video_clip
op_star
id|clips
comma
r_int
id|nclips
)paren
(brace
r_struct
id|video_clip
id|swap
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|nclips
op_minus
l_int|2
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
op_le
id|i
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|clips
(braket
id|j
)braket
dot
id|x
OG
id|clips
(braket
id|j
op_plus
l_int|1
)braket
dot
id|x
)paren
(brace
id|swap
op_assign
id|clips
(braket
id|j
)braket
suffix:semicolon
id|clips
(braket
id|j
)braket
op_assign
id|clips
(braket
id|j
op_plus
l_int|1
)braket
suffix:semicolon
id|clips
(braket
id|j
op_plus
l_int|1
)braket
op_assign
id|swap
suffix:semicolon
id|n
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_eq
id|n
)paren
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|calc_skips
id|calc_skips
c_func
(paren
r_int
id|line
comma
r_int
id|width
comma
r_int
op_star
id|maxy
comma
r_struct
id|SKIPLIST
op_star
id|skips
comma
r_int
op_star
id|nskips
comma
r_const
r_struct
id|video_clip
op_star
id|clips
comma
r_int
id|nclips
)paren
(brace
r_int
id|clip
comma
id|skip
comma
id|maxline
comma
id|end
suffix:semicolon
id|skip
op_assign
l_int|0
suffix:semicolon
id|maxline
op_assign
l_int|9999
suffix:semicolon
r_for
c_loop
(paren
id|clip
op_assign
l_int|0
suffix:semicolon
id|clip
OL
id|nclips
suffix:semicolon
id|clip
op_increment
)paren
(brace
multiline_comment|/* sanity checks */
r_if
c_cond
(paren
id|clips
(braket
id|clip
)braket
dot
id|x
op_plus
id|clips
(braket
id|clip
)braket
dot
id|width
op_le
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|clips
(braket
id|clip
)braket
dot
id|x
OG
id|width
)paren
r_break
suffix:semicolon
multiline_comment|/* vertical range */
r_if
c_cond
(paren
id|line
OG
id|clips
(braket
id|clip
)braket
dot
id|y
op_plus
id|clips
(braket
id|clip
)braket
dot
id|height
op_minus
l_int|1
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|line
OL
id|clips
(braket
id|clip
)braket
dot
id|y
)paren
(brace
r_if
c_cond
(paren
id|maxline
OG
id|clips
(braket
id|clip
)braket
dot
id|y
op_minus
l_int|1
)paren
id|maxline
op_assign
id|clips
(braket
id|clip
)braket
dot
id|y
op_minus
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|maxline
OG
id|clips
(braket
id|clip
)braket
dot
id|y
op_plus
id|clips
(braket
id|clip
)braket
dot
id|height
op_minus
l_int|1
)paren
id|maxline
op_assign
id|clips
(braket
id|clip
)braket
dot
id|y
op_plus
id|clips
(braket
id|clip
)braket
dot
id|height
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* horizontal range */
r_if
c_cond
(paren
l_int|0
op_eq
id|skip
op_logical_or
id|clips
(braket
id|clip
)braket
dot
id|x
OG
id|skips
(braket
id|skip
op_minus
l_int|1
)braket
dot
id|end
)paren
(brace
multiline_comment|/* new one */
id|skips
(braket
id|skip
)braket
dot
id|start
op_assign
id|clips
(braket
id|clip
)braket
dot
id|x
suffix:semicolon
r_if
c_cond
(paren
id|skips
(braket
id|skip
)braket
dot
id|start
OL
l_int|0
)paren
id|skips
(braket
id|skip
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|skips
(braket
id|skip
)braket
dot
id|end
op_assign
id|clips
(braket
id|clip
)braket
dot
id|x
op_plus
id|clips
(braket
id|clip
)braket
dot
id|width
suffix:semicolon
r_if
c_cond
(paren
id|skips
(braket
id|skip
)braket
dot
id|end
OG
id|width
)paren
id|skips
(braket
id|skip
)braket
dot
id|end
op_assign
id|width
suffix:semicolon
id|skip
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* overlaps -- expand last one */
id|end
op_assign
id|clips
(braket
id|clip
)braket
dot
id|x
op_plus
id|clips
(braket
id|clip
)braket
dot
id|width
suffix:semicolon
r_if
c_cond
(paren
id|skips
(braket
id|skip
op_minus
l_int|1
)braket
dot
id|end
OL
id|end
)paren
id|skips
(braket
id|skip
op_minus
l_int|1
)braket
dot
id|end
op_assign
id|end
suffix:semicolon
r_if
c_cond
(paren
id|skips
(braket
id|skip
op_minus
l_int|1
)braket
dot
id|end
OG
id|width
)paren
id|skips
(braket
id|skip
op_minus
l_int|1
)braket
dot
id|end
op_assign
id|width
suffix:semicolon
)brace
)brace
op_star
id|nskips
op_assign
id|skip
suffix:semicolon
op_star
id|maxy
op_assign
id|maxline
suffix:semicolon
r_if
c_cond
(paren
id|bttv_debug
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv: skips line %d-%d:&quot;
comma
id|line
comma
id|maxline
)paren
suffix:semicolon
r_for
c_loop
(paren
id|skip
op_assign
l_int|0
suffix:semicolon
id|skip
OL
op_star
id|nskips
suffix:semicolon
id|skip
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %d-%d&quot;
comma
id|skips
(braket
id|skip
)braket
dot
id|start
comma
id|skips
(braket
id|skip
)braket
dot
id|end
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|bttv_risc_overlay
id|bttv_risc_overlay
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_riscmem
op_star
id|risc
comma
r_const
r_struct
id|bttv_format
op_star
id|fmt
comma
r_struct
id|bttv_overlay
op_star
id|ov
comma
r_int
id|fields
)paren
(brace
r_int
id|instructions
comma
id|rc
comma
id|line
comma
id|maxy
comma
id|start
comma
id|end
comma
id|skip
comma
id|nskips
suffix:semicolon
r_struct
id|SKIPLIST
op_star
id|skips
suffix:semicolon
r_int
r_int
op_star
id|rp
comma
id|ri
comma
id|ra
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
multiline_comment|/* skip list for window clipping */
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|skips
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|skips
)paren
op_star
id|ov-&gt;nclips
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is (clip+1) * lines instructions&n;&t;   + sync + jump (all 2 dwords) */
id|instructions
op_assign
(paren
id|ov-&gt;nclips
op_plus
l_int|1
)paren
op_star
(paren
(paren
id|fields
op_amp
id|VBUF_FIELD_INTER
)paren
ques
c_cond
id|ov-&gt;height
op_rshift
l_int|1
suffix:colon
id|ov-&gt;height
)paren
suffix:semicolon
id|instructions
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|bttv_riscmem_alloc
c_func
(paren
id|btv-&gt;dev
comma
id|risc
comma
id|instructions
op_star
l_int|8
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* sync instruction */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_FIFO_STATUS_FM1
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|addr
op_assign
(paren
r_int
r_int
)paren
id|btv-&gt;fbuf.base
suffix:semicolon
id|addr
op_add_assign
id|btv-&gt;fbuf.bytesperline
op_star
id|ov-&gt;y
suffix:semicolon
id|addr
op_add_assign
(paren
(paren
id|btv-&gt;fbuf.depth
op_plus
l_int|7
)paren
op_rshift
l_int|3
)paren
op_star
id|ov-&gt;x
suffix:semicolon
multiline_comment|/* scan lines */
r_for
c_loop
(paren
id|maxy
op_assign
op_minus
l_int|1
comma
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|ov-&gt;height
suffix:semicolon
id|line
op_increment
comma
id|addr
op_add_assign
id|btv-&gt;fbuf.bytesperline
)paren
(brace
r_if
c_cond
(paren
id|fields
op_amp
id|VBUF_FIELD_INTER
)paren
(brace
r_if
c_cond
(paren
(paren
id|line
op_mod
l_int|2
)paren
op_ne
l_int|0
op_logical_and
(paren
id|fields
op_amp
id|VBUF_FIELD_ODD
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|line
op_mod
l_int|2
)paren
op_ne
l_int|1
op_logical_and
(paren
id|fields
op_amp
id|VBUF_FIELD_EVEN
)paren
)paren
r_continue
suffix:semicolon
)brace
multiline_comment|/* calculate clipping */
r_if
c_cond
(paren
id|line
OG
id|maxy
)paren
id|calc_skips
c_func
(paren
id|line
comma
id|ov-&gt;width
comma
op_amp
id|maxy
comma
id|skips
comma
op_amp
id|nskips
comma
id|ov-&gt;clips
comma
id|ov-&gt;nclips
)paren
suffix:semicolon
multiline_comment|/* write out risc code */
r_for
c_loop
(paren
id|start
op_assign
l_int|0
comma
id|skip
op_assign
l_int|0
suffix:semicolon
id|start
OL
id|ov-&gt;width
suffix:semicolon
id|start
op_assign
id|end
)paren
(brace
r_if
c_cond
(paren
id|skip
op_ge
id|nskips
)paren
(brace
id|ri
op_assign
id|BT848_RISC_WRITE
suffix:semicolon
id|end
op_assign
id|ov-&gt;width
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|start
OL
id|skips
(braket
id|skip
)braket
dot
id|start
)paren
(brace
id|ri
op_assign
id|BT848_RISC_WRITE
suffix:semicolon
id|end
op_assign
id|skips
(braket
id|skip
)braket
dot
id|start
suffix:semicolon
)brace
r_else
(brace
id|ri
op_assign
id|BT848_RISC_SKIP
suffix:semicolon
id|end
op_assign
id|skips
(braket
id|skip
)braket
dot
id|end
suffix:semicolon
id|skip
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|BT848_RISC_WRITE
op_eq
id|ri
)paren
id|ra
op_assign
id|addr
op_plus
(paren
id|fmt-&gt;depth
op_rshift
l_int|3
)paren
op_star
id|start
suffix:semicolon
r_else
id|ra
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|start
)paren
id|ri
op_or_assign
id|BT848_RISC_SOL
suffix:semicolon
r_if
c_cond
(paren
id|ov-&gt;width
op_eq
id|end
)paren
id|ri
op_or_assign
id|BT848_RISC_EOL
suffix:semicolon
id|ri
op_or_assign
(paren
id|fmt-&gt;depth
op_rshift
l_int|3
)paren
op_star
(paren
id|end
op_minus
id|start
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|ri
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|ra
)paren
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|ra
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
id|kfree
c_func
(paren
id|skips
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
r_void
DECL|function|bttv_calc_geo
id|bttv_calc_geo
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_geometry
op_star
id|geo
comma
r_int
id|width
comma
r_int
id|height
comma
r_int
id|interleaved
comma
r_int
id|norm
)paren
(brace
r_const
r_struct
id|bttv_tvnorm
op_star
id|tvnorm
suffix:semicolon
id|u32
id|xsf
comma
id|sr
suffix:semicolon
r_int
id|vdelay
suffix:semicolon
id|tvnorm
op_assign
op_amp
id|bttv_tvnorms
(braket
id|norm
)braket
suffix:semicolon
id|vdelay
op_assign
id|tvnorm-&gt;vdelay
suffix:semicolon
r_if
c_cond
(paren
id|vdelay
OL
id|btv-&gt;vbi.lines
op_star
l_int|2
)paren
id|vdelay
op_assign
id|btv-&gt;vbi.lines
op_star
l_int|2
suffix:semicolon
id|xsf
op_assign
(paren
id|width
op_star
id|tvnorm-&gt;scaledtwidth
)paren
op_div
id|tvnorm-&gt;swidth
suffix:semicolon
id|geo-&gt;hscale
op_assign
(paren
(paren
id|tvnorm-&gt;totalwidth
op_star
l_int|4096UL
)paren
op_div
id|xsf
op_minus
l_int|4096
)paren
suffix:semicolon
id|geo-&gt;hdelay
op_assign
id|tvnorm-&gt;hdelayx1
suffix:semicolon
id|geo-&gt;hdelay
op_assign
(paren
id|geo-&gt;hdelay
op_star
id|width
)paren
op_div
id|tvnorm-&gt;swidth
suffix:semicolon
id|geo-&gt;hdelay
op_and_assign
l_int|0x3fe
suffix:semicolon
id|sr
op_assign
(paren
(paren
id|tvnorm-&gt;sheight
op_rshift
(paren
id|interleaved
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
)paren
op_star
l_int|512
)paren
op_div
id|height
op_minus
l_int|512
suffix:semicolon
id|geo-&gt;vscale
op_assign
(paren
l_int|0x10000UL
op_minus
id|sr
)paren
op_amp
l_int|0x1fff
suffix:semicolon
id|geo-&gt;crop
op_assign
(paren
(paren
id|width
op_rshift
l_int|8
)paren
op_amp
l_int|0x03
)paren
op_or
(paren
(paren
id|geo-&gt;hdelay
op_rshift
l_int|6
)paren
op_amp
l_int|0x0c
)paren
op_or
(paren
(paren
id|tvnorm-&gt;sheight
op_rshift
l_int|4
)paren
op_amp
l_int|0x30
)paren
op_or
(paren
(paren
id|vdelay
op_rshift
l_int|2
)paren
op_amp
l_int|0xc0
)paren
suffix:semicolon
id|geo-&gt;vscale
op_or_assign
id|interleaved
ques
c_cond
(paren
id|BT848_VSCALE_INT
op_lshift
l_int|8
)paren
suffix:colon
l_int|0
suffix:semicolon
id|geo-&gt;vdelay
op_assign
id|vdelay
suffix:semicolon
id|geo-&gt;width
op_assign
id|width
suffix:semicolon
id|geo-&gt;sheight
op_assign
id|tvnorm-&gt;sheight
suffix:semicolon
r_if
c_cond
(paren
id|btv-&gt;opt_combfilter
)paren
(brace
id|geo-&gt;vtc
op_assign
(paren
id|width
OL
l_int|193
)paren
ques
c_cond
l_int|2
suffix:colon
(paren
(paren
id|width
OL
l_int|385
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|geo-&gt;comb
op_assign
(paren
id|width
OL
l_int|769
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|geo-&gt;vtc
op_assign
l_int|0
suffix:semicolon
id|geo-&gt;comb
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_void
DECL|function|bttv_apply_geo
id|bttv_apply_geo
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_geometry
op_star
id|geo
comma
r_int
id|odd
)paren
(brace
r_int
id|off
op_assign
id|odd
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|geo-&gt;comb
)paren
id|btor
c_func
(paren
id|BT848_VSCALE_COMB
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
r_else
id|btand
c_func
(paren
op_complement
id|BT848_VSCALE_COMB
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;vtc
comma
id|BT848_E_VTC
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;hscale
op_rshift
l_int|8
comma
id|BT848_E_HSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;hscale
op_amp
l_int|0xff
comma
id|BT848_E_HSCALE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btaor
c_func
(paren
(paren
id|geo-&gt;vscale
op_rshift
l_int|8
)paren
comma
l_int|0xe0
comma
id|BT848_E_VSCALE_HI
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;vscale
op_amp
l_int|0xff
comma
id|BT848_E_VSCALE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;width
op_amp
l_int|0xff
comma
id|BT848_E_HACTIVE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;hdelay
op_amp
l_int|0xff
comma
id|BT848_E_HDELAY_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;sheight
op_amp
l_int|0xff
comma
id|BT848_E_VACTIVE_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;vdelay
op_amp
l_int|0xff
comma
id|BT848_E_VDELAY_LO
op_plus
id|off
)paren
suffix:semicolon
id|btwrite
c_func
(paren
id|geo-&gt;crop
comma
id|BT848_E_CROP
op_plus
id|off
)paren
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
multiline_comment|/* risc group / risc main loop / dma management               */
r_void
DECL|function|bttv_set_dma
id|bttv_set_dma
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|override
comma
r_int
id|irqflags
)paren
(brace
r_int
r_int
id|cmd
suffix:semicolon
r_int
id|capctl
suffix:semicolon
id|btv-&gt;cap_ctl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|btv-&gt;odd
)paren
id|btv-&gt;cap_ctl
op_or_assign
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|btv-&gt;even
)paren
id|btv-&gt;cap_ctl
op_or_assign
l_int|0x01
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|btv-&gt;vcurr
)paren
id|btv-&gt;cap_ctl
op_or_assign
l_int|0x0c
suffix:semicolon
id|capctl
op_assign
l_int|0
suffix:semicolon
id|capctl
op_or_assign
(paren
id|btv-&gt;cap_ctl
op_amp
l_int|0x03
)paren
ques
c_cond
l_int|0x03
suffix:colon
l_int|0x00
suffix:semicolon
multiline_comment|/* capture  */
id|capctl
op_or_assign
(paren
id|btv-&gt;cap_ctl
op_amp
l_int|0x0c
)paren
ques
c_cond
l_int|0x0c
suffix:colon
l_int|0x00
suffix:semicolon
multiline_comment|/* vbi data */
id|capctl
op_or_assign
id|override
suffix:semicolon
id|d2printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: capctl=%x irq=%d odd=%08Lx/%08Lx even=%08Lx/%08Lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|capctl
comma
id|irqflags
comma
id|btv-&gt;vcurr
ques
c_cond
(paren
id|u64
)paren
id|btv-&gt;vcurr-&gt;odd.dma
suffix:colon
l_int|0
comma
id|btv-&gt;odd
ques
c_cond
(paren
id|u64
)paren
id|btv-&gt;odd-&gt;odd.dma
suffix:colon
l_int|0
comma
id|btv-&gt;vcurr
ques
c_cond
(paren
id|u64
)paren
id|btv-&gt;vcurr-&gt;even.dma
suffix:colon
l_int|0
comma
id|btv-&gt;even
ques
c_cond
(paren
id|u64
)paren
id|btv-&gt;even-&gt;even.dma
suffix:colon
l_int|0
)paren
suffix:semicolon
id|cmd
op_assign
id|BT848_RISC_JUMP
suffix:semicolon
r_if
c_cond
(paren
id|irqflags
)paren
(brace
id|cmd
op_or_assign
id|BT848_RISC_IRQ
op_or
(paren
id|irqflags
op_lshift
l_int|16
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|btv-&gt;timeout
comma
id|jiffies
op_plus
id|BTTV_TIMEOUT
)paren
suffix:semicolon
)brace
r_else
(brace
id|del_timer
c_func
(paren
op_amp
id|btv-&gt;timeout
)paren
suffix:semicolon
)brace
id|btv-&gt;main.cpu
(braket
id|RISC_SLOT_LOOP
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|capctl
comma
op_complement
l_int|0x0f
comma
id|BT848_CAP_CTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|capctl
)paren
(brace
r_if
c_cond
(paren
id|btv-&gt;dma_on
)paren
r_return
suffix:semicolon
id|btwrite
c_func
(paren
id|btv-&gt;main.dma
comma
id|BT848_RISC_STRT_ADD
)paren
suffix:semicolon
id|btor
c_func
(paren
l_int|3
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
id|btv-&gt;dma_on
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|btv-&gt;dma_on
)paren
r_return
suffix:semicolon
id|btand
c_func
(paren
op_complement
l_int|3
comma
id|BT848_GPIO_DMA_CTL
)paren
suffix:semicolon
id|btv-&gt;dma_on
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_int
DECL|function|bttv_risc_init_main
id|bttv_risc_init_main
c_func
(paren
r_struct
id|bttv
op_star
id|btv
)paren
(brace
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|bttv_riscmem_alloc
c_func
(paren
id|btv-&gt;dev
comma
op_amp
id|btv-&gt;main
comma
id|PAGE_SIZE
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: risc main @ %08Lx&bslash;n&quot;
comma
id|btv-&gt;nr
comma
(paren
id|u64
)paren
id|btv-&gt;main.dma
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_RISC_RESYNC
op_or
id|BT848_FIFO_STATUS_VRE
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|2
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|3
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|4
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* odd field */
id|btv-&gt;main.cpu
(braket
l_int|4
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|5
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|6
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|6
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|7
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|8
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|8
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_SYNC
op_or
id|BT848_RISC_RESYNC
op_or
id|BT848_FIFO_STATUS_VRO
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|9
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* even field */
id|btv-&gt;main.cpu
(braket
l_int|10
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|11
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|12
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|12
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|13
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|14
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* jump back to odd field */
id|btv-&gt;main.cpu
(braket
l_int|14
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|BT848_RISC_JUMP
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
l_int|15
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|btv-&gt;main.dma
op_plus
(paren
l_int|0
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|bttv_risc_hook
id|bttv_risc_hook
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|slot
comma
r_struct
id|bttv_riscmem
op_star
id|risc
comma
r_int
id|irqflags
)paren
(brace
r_int
r_int
id|cmd
suffix:semicolon
r_int
r_int
id|next
op_assign
id|btv-&gt;main.dma
op_plus
(paren
(paren
id|slot
op_plus
l_int|2
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|risc
)paren
(brace
id|d2printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: risc=%p slot[%d]=NULL&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|risc
comma
id|slot
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
id|slot
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|next
)paren
suffix:semicolon
)brace
r_else
(brace
id|d2printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: risc=%p slot[%d]=%08Lx irq=%d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
id|risc
comma
id|slot
comma
(paren
id|u64
)paren
id|risc-&gt;dma
comma
id|irqflags
)paren
suffix:semicolon
id|cmd
op_assign
id|BT848_RISC_JUMP
suffix:semicolon
r_if
c_cond
(paren
id|irqflags
)paren
id|cmd
op_or_assign
id|BT848_RISC_IRQ
op_or
(paren
id|irqflags
op_lshift
l_int|16
)paren
suffix:semicolon
id|risc-&gt;jmp
(braket
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|risc-&gt;jmp
(braket
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|next
)paren
suffix:semicolon
id|btv-&gt;main.cpu
(braket
id|slot
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|risc-&gt;dma
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|bttv_dma_free
id|bttv_dma_free
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_buffer
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|videobuf_waiton
c_func
(paren
op_amp
id|buf-&gt;vb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|videobuf_dma_pci_unmap
c_func
(paren
id|btv-&gt;dev
comma
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|videobuf_dma_free
c_func
(paren
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|bttv_riscmem_free
c_func
(paren
id|btv-&gt;dev
comma
op_amp
id|buf-&gt;even
)paren
suffix:semicolon
id|bttv_riscmem_free
c_func
(paren
id|btv-&gt;dev
comma
op_amp
id|buf-&gt;odd
)paren
suffix:semicolon
id|buf-&gt;vb.state
op_assign
id|STATE_NEEDS_INIT
suffix:semicolon
)brace
r_int
DECL|function|bttv_buffer_activate
id|bttv_buffer_activate
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_buffer
op_star
id|odd
comma
r_struct
id|bttv_buffer
op_star
id|even
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_ne
id|odd
op_logical_and
l_int|NULL
op_ne
id|even
)paren
(brace
id|odd-&gt;vb.state
op_assign
id|STATE_ACTIVE
suffix:semicolon
id|even-&gt;vb.state
op_assign
id|STATE_ACTIVE
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|odd-&gt;geo
comma
l_int|1
)paren
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|even-&gt;geo
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_O_FIELD
comma
op_amp
id|odd-&gt;odd
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_E_FIELD
comma
op_amp
id|even-&gt;even
comma
l_int|0
)paren
suffix:semicolon
id|btaor
c_func
(paren
(paren
id|odd-&gt;btformat
op_amp
l_int|0xf0
)paren
op_or
(paren
id|even-&gt;btformat
op_amp
l_int|0x0f
)paren
comma
op_complement
l_int|0xff
comma
id|BT848_COLOR_FMT
)paren
suffix:semicolon
id|btaor
c_func
(paren
(paren
id|odd-&gt;btswap
op_amp
l_int|0x0a
)paren
op_or
(paren
id|even-&gt;btswap
op_amp
l_int|0x05
)paren
comma
op_complement
l_int|0x0f
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|NULL
op_ne
id|odd
)paren
(brace
id|odd-&gt;vb.state
op_assign
id|STATE_ACTIVE
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|odd-&gt;geo
comma
l_int|1
)paren
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|odd-&gt;geo
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_O_FIELD
comma
op_amp
id|odd-&gt;odd
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_E_FIELD
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|odd-&gt;btformat
op_amp
l_int|0xff
comma
op_complement
l_int|0xff
comma
id|BT848_COLOR_FMT
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|odd-&gt;btswap
op_amp
l_int|0x0f
comma
op_complement
l_int|0x0f
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|NULL
op_ne
id|even
)paren
(brace
id|even-&gt;vb.state
op_assign
id|STATE_ACTIVE
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|even-&gt;geo
comma
l_int|1
)paren
suffix:semicolon
id|bttv_apply_geo
c_func
(paren
id|btv
comma
op_amp
id|even-&gt;geo
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_O_FIELD
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_E_FIELD
comma
op_amp
id|even-&gt;even
comma
l_int|0
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|even-&gt;btformat
op_amp
l_int|0xff
comma
op_complement
l_int|0xff
comma
id|BT848_COLOR_FMT
)paren
suffix:semicolon
id|btaor
c_func
(paren
id|even-&gt;btswap
op_amp
l_int|0x0f
comma
op_complement
l_int|0x0f
comma
id|BT848_COLOR_CTL
)paren
suffix:semicolon
)brace
r_else
(brace
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_O_FIELD
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|bttv_risc_hook
c_func
(paren
id|btv
comma
id|RISC_SLOT_E_FIELD
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
r_int
DECL|function|bttv_buffer_field
id|bttv_buffer_field
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_int
id|field
comma
r_int
id|def_field
comma
r_int
id|norm
comma
r_int
id|height
)paren
(brace
r_const
r_struct
id|bttv_tvnorm
op_star
id|tvnorm
op_assign
id|bttv_tvnorms
op_plus
id|norm
suffix:semicolon
multiline_comment|/* check interleave, even+odd fields */
r_if
c_cond
(paren
id|height
OG
(paren
id|tvnorm-&gt;sheight
op_rshift
l_int|1
)paren
)paren
(brace
id|field
op_assign
id|VBUF_FIELD_ODD
op_or
id|VBUF_FIELD_EVEN
op_or
id|VBUF_FIELD_INTER
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|field
op_amp
id|def_field
)paren
(brace
id|field
op_assign
id|def_field
suffix:semicolon
)brace
r_else
(brace
id|field
op_assign
(paren
id|def_field
op_amp
id|VBUF_FIELD_EVEN
)paren
ques
c_cond
id|VBUF_FIELD_ODD
suffix:colon
id|VBUF_FIELD_EVEN
suffix:semicolon
)brace
)brace
r_return
id|field
suffix:semicolon
)brace
multiline_comment|/* calculate geometry, build risc code */
r_int
DECL|function|bttv_buffer_risc
id|bttv_buffer_risc
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_buffer
op_star
id|buf
)paren
(brace
r_const
r_struct
id|bttv_tvnorm
op_star
id|tvnorm
op_assign
id|bttv_tvnorms
op_plus
id|buf-&gt;tvnorm
suffix:semicolon
id|buf-&gt;vb.field
op_assign
id|bttv_buffer_field
c_func
(paren
id|btv
comma
id|buf-&gt;vb.field
comma
id|VBUF_FIELD_EVEN
comma
id|buf-&gt;tvnorm
comma
id|buf-&gt;vb.height
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: buffer flags:%s%s%s format: %s size: %dx%d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_INTER
)paren
ques
c_cond
l_string|&quot; interleave&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_ODD
)paren
ques
c_cond
l_string|&quot; odd&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_EVEN
)paren
ques
c_cond
l_string|&quot; even&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|buf-&gt;fmt-&gt;name
comma
id|buf-&gt;vb.width
comma
id|buf-&gt;vb.height
)paren
suffix:semicolon
multiline_comment|/* packed pixel modes */
r_if
c_cond
(paren
id|buf-&gt;fmt-&gt;flags
op_amp
id|FORMAT_FLAGS_PACKED
)paren
(brace
r_int
id|bpl
comma
id|padding
comma
id|lines
suffix:semicolon
id|bpl
op_assign
(paren
id|buf-&gt;fmt-&gt;depth
op_rshift
l_int|3
)paren
op_star
id|buf-&gt;vb.width
suffix:semicolon
multiline_comment|/* calculate geometry */
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_INTER
)paren
(brace
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|buf-&gt;vb.width
comma
id|buf-&gt;vb.height
comma
l_int|1
comma
id|buf-&gt;tvnorm
)paren
suffix:semicolon
id|lines
op_assign
id|buf-&gt;vb.height
op_rshift
l_int|1
suffix:semicolon
id|padding
op_assign
id|bpl
suffix:semicolon
)brace
r_else
(brace
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|buf-&gt;vb.width
comma
id|buf-&gt;vb.height
comma
l_int|0
comma
id|buf-&gt;tvnorm
)paren
suffix:semicolon
id|lines
op_assign
id|buf-&gt;vb.height
suffix:semicolon
id|padding
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* build risc code */
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_ODD
)paren
id|bttv_risc_packed
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;odd
comma
id|buf-&gt;vb.dma.sglist
comma
l_int|0
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_EVEN
)paren
id|bttv_risc_packed
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;even
comma
id|buf-&gt;vb.dma.sglist
comma
id|padding
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
)brace
multiline_comment|/* planar modes */
r_if
c_cond
(paren
id|buf-&gt;fmt-&gt;flags
op_amp
id|FORMAT_FLAGS_PLANAR
)paren
(brace
r_struct
id|bttv_riscmem
op_star
id|risc
suffix:semicolon
r_int
id|uoffset
comma
id|voffset
suffix:semicolon
r_int
id|ypadding
comma
id|cpadding
comma
id|lines
suffix:semicolon
multiline_comment|/* calculate chroma offsets */
id|uoffset
op_assign
id|buf-&gt;vb.width
op_star
id|buf-&gt;vb.height
suffix:semicolon
id|voffset
op_assign
id|buf-&gt;vb.width
op_star
id|buf-&gt;vb.height
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;fmt-&gt;flags
op_amp
id|FORMAT_FLAGS_CrCb
)paren
(brace
multiline_comment|/* Y-Cr-Cb plane order */
id|uoffset
op_rshift_assign
id|buf-&gt;fmt-&gt;hshift
suffix:semicolon
id|uoffset
op_rshift_assign
id|buf-&gt;fmt-&gt;vshift
suffix:semicolon
id|uoffset
op_add_assign
id|voffset
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Y-Cb-Cr plane order */
id|voffset
op_rshift_assign
id|buf-&gt;fmt-&gt;hshift
suffix:semicolon
id|voffset
op_rshift_assign
id|buf-&gt;fmt-&gt;vshift
suffix:semicolon
id|voffset
op_add_assign
id|uoffset
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_INTER
)paren
(brace
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|buf-&gt;vb.width
comma
id|buf-&gt;vb.height
comma
l_int|1
comma
id|buf-&gt;tvnorm
)paren
suffix:semicolon
id|lines
op_assign
id|buf-&gt;vb.height
op_rshift
l_int|1
suffix:semicolon
id|ypadding
op_assign
id|buf-&gt;vb.width
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf-&gt;fmt-&gt;vshift
)paren
(brace
multiline_comment|/* chroma planes are interleaved too */
id|cpadding
op_assign
id|buf-&gt;vb.width
op_rshift
id|buf-&gt;fmt-&gt;hshift
suffix:semicolon
)brace
r_else
(brace
id|cpadding
op_assign
l_int|0
suffix:semicolon
)brace
id|bttv_risc_planar
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;odd
comma
id|buf-&gt;vb.dma.sglist
comma
l_int|0
comma
id|buf-&gt;vb.width
comma
id|ypadding
comma
id|lines
comma
id|uoffset
comma
id|voffset
comma
id|buf-&gt;fmt-&gt;hshift
comma
id|buf-&gt;fmt-&gt;vshift
op_rshift
l_int|1
comma
id|cpadding
)paren
suffix:semicolon
id|bttv_risc_planar
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;even
comma
id|buf-&gt;vb.dma.sglist
comma
id|ypadding
comma
id|buf-&gt;vb.width
comma
id|ypadding
comma
id|lines
comma
id|uoffset
op_plus
id|cpadding
comma
id|voffset
op_plus
id|cpadding
comma
id|buf-&gt;fmt-&gt;hshift
comma
id|cpadding
ques
c_cond
(paren
id|buf-&gt;fmt-&gt;vshift
op_rshift
l_int|1
)paren
suffix:colon
op_minus
l_int|1
comma
id|cpadding
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_ODD
)paren
id|risc
op_assign
op_amp
id|buf-&gt;odd
suffix:semicolon
r_else
id|risc
op_assign
op_amp
id|buf-&gt;even
suffix:semicolon
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|buf-&gt;vb.width
comma
id|buf-&gt;vb.height
comma
l_int|0
comma
id|buf-&gt;tvnorm
)paren
suffix:semicolon
id|bttv_risc_planar
c_func
(paren
id|btv
comma
id|risc
comma
id|buf-&gt;vb.dma.sglist
comma
l_int|0
comma
id|buf-&gt;vb.width
comma
l_int|0
comma
id|buf-&gt;vb.height
comma
id|uoffset
comma
id|voffset
comma
id|buf-&gt;fmt-&gt;hshift
comma
id|buf-&gt;fmt-&gt;vshift
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* raw data */
r_if
c_cond
(paren
id|buf-&gt;fmt-&gt;flags
op_amp
id|FORMAT_FLAGS_RAW
)paren
(brace
multiline_comment|/* build risc code */
id|buf-&gt;vb.field
op_assign
id|VBUF_FIELD_INTER
op_or
id|VBUF_FIELD_ODD
op_or
id|VBUF_FIELD_EVEN
suffix:semicolon
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|tvnorm-&gt;swidth
comma
id|tvnorm-&gt;sheight
comma
l_int|1
comma
id|buf-&gt;tvnorm
)paren
suffix:semicolon
id|bttv_risc_packed
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;odd
comma
id|buf-&gt;vb.dma.sglist
comma
l_int|0
comma
id|RAW_BPL
comma
l_int|0
comma
id|RAW_LINES
)paren
suffix:semicolon
id|bttv_risc_packed
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;even
comma
id|buf-&gt;vb.dma.sglist
comma
id|buf-&gt;vb.size
op_div
l_int|2
comma
id|RAW_BPL
comma
l_int|0
comma
id|RAW_LINES
)paren
suffix:semicolon
)brace
multiline_comment|/* copy format info */
id|buf-&gt;btformat
op_assign
id|buf-&gt;fmt-&gt;btformat
suffix:semicolon
id|buf-&gt;btswap
op_assign
id|buf-&gt;fmt-&gt;btswap
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------- */
multiline_comment|/* calculate geometry, build risc code */
r_int
DECL|function|bttv_overlay_risc
id|bttv_overlay_risc
c_func
(paren
r_struct
id|bttv
op_star
id|btv
comma
r_struct
id|bttv_overlay
op_star
id|ov
comma
r_const
r_struct
id|bttv_format
op_star
id|fmt
comma
r_struct
id|bttv_buffer
op_star
id|buf
)paren
(brace
r_int
id|interleave
suffix:semicolon
multiline_comment|/* check interleave, even+odd fields */
id|buf-&gt;vb.field
op_assign
id|bttv_buffer_field
c_func
(paren
id|btv
comma
l_int|0
comma
id|VBUF_FIELD_ODD
comma
id|ov-&gt;tvnorm
comma
id|ov-&gt;height
)paren
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;bttv%d: overlay flags:%s%s%s format: %s size: %dx%d&bslash;n&quot;
comma
id|btv-&gt;nr
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_INTER
)paren
ques
c_cond
l_string|&quot; interleave&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_ODD
)paren
ques
c_cond
l_string|&quot; odd&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_EVEN
)paren
ques
c_cond
l_string|&quot; even&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|fmt-&gt;name
comma
id|ov-&gt;width
comma
id|ov-&gt;height
)paren
suffix:semicolon
multiline_comment|/* calculate geometry */
id|interleave
op_assign
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_INTER
suffix:semicolon
id|bttv_calc_geo
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;geo
comma
id|ov-&gt;width
comma
id|ov-&gt;height
comma
id|interleave
comma
id|ov-&gt;tvnorm
)paren
suffix:semicolon
multiline_comment|/* build risc code */
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_ODD
)paren
id|bttv_risc_overlay
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;odd
comma
id|fmt
comma
id|ov
comma
id|interleave
op_or
id|VBUF_FIELD_ODD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;vb.field
op_amp
id|VBUF_FIELD_EVEN
)paren
id|bttv_risc_overlay
c_func
(paren
id|btv
comma
op_amp
id|buf-&gt;even
comma
id|fmt
comma
id|ov
comma
id|interleave
op_or
id|VBUF_FIELD_EVEN
)paren
suffix:semicolon
multiline_comment|/* copy format info */
id|buf-&gt;btformat
op_assign
id|fmt-&gt;btformat
suffix:semicolon
id|buf-&gt;btswap
op_assign
id|fmt-&gt;btswap
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
