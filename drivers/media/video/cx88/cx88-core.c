multiline_comment|/*&n; * $Id: cx88-core.c,v 1.15 2004/10/25 11:26:36 kraxel Exp $&n; *&n; * device driver for Conexant 2388x based TV cards&n; * driver core&n; *&n; * (c) 2003 Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &quot;cx88.h&quot;
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;v4l2 driver module for cx2388x based TV cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
DECL|variable|core_debug
r_static
r_int
r_int
id|core_debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|core_debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|core_debug
comma
l_string|&quot;enable debug messages [core]&quot;
)paren
suffix:semicolon
DECL|variable|latency
r_static
r_int
r_int
id|latency
op_assign
id|UNSET
suffix:semicolon
id|module_param
c_func
(paren
id|latency
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|latency
comma
l_string|&quot;pci latency timer&quot;
)paren
suffix:semicolon
DECL|variable|tuner
r_static
r_int
r_int
id|tuner
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|CX88_MAXBOARDS
op_minus
l_int|1
)paren
)braket
op_assign
id|UNSET
)brace
suffix:semicolon
DECL|variable|card
r_static
r_int
r_int
id|card
(braket
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|CX88_MAXBOARDS
op_minus
l_int|1
)paren
)braket
op_assign
id|UNSET
)brace
suffix:semicolon
id|module_param_array
c_func
(paren
id|tuner
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|card
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|tuner
comma
l_string|&quot;tuner type&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|card
comma
l_string|&quot;card type&quot;
)paren
suffix:semicolon
DECL|variable|nicam
r_static
r_int
r_int
id|nicam
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|nicam
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nicam
comma
l_string|&quot;tv audio is nicam&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(level,fmt, arg...)&t;if (core_debug &gt;= level)&t;&bslash;&n;&t;printk(KERN_DEBUG &quot;%s: &quot; fmt, core-&gt;name , ## arg)
DECL|variable|cx88_devcount
r_static
r_int
r_int
id|cx88_devcount
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|cx88_devlist
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|devlist
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* debug help functions                                               */
DECL|variable|v4l1_ioctls
r_static
r_const
r_char
op_star
id|v4l1_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;0&quot;
comma
l_string|&quot;CGAP&quot;
comma
l_string|&quot;GCHAN&quot;
comma
l_string|&quot;SCHAN&quot;
comma
l_string|&quot;GTUNER&quot;
comma
l_string|&quot;STUNER&quot;
comma
l_string|&quot;GPICT&quot;
comma
l_string|&quot;SPICT&quot;
comma
l_string|&quot;CCAPTURE&quot;
comma
l_string|&quot;GWIN&quot;
comma
l_string|&quot;SWIN&quot;
comma
l_string|&quot;GFBUF&quot;
comma
l_string|&quot;SFBUF&quot;
comma
l_string|&quot;KEY&quot;
comma
l_string|&quot;GFREQ&quot;
comma
l_string|&quot;SFREQ&quot;
comma
l_string|&quot;GAUDIO&quot;
comma
l_string|&quot;SAUDIO&quot;
comma
l_string|&quot;SYNC&quot;
comma
l_string|&quot;MCAPTURE&quot;
comma
l_string|&quot;GMBUF&quot;
comma
l_string|&quot;GUNIT&quot;
comma
l_string|&quot;GCAPTURE&quot;
comma
l_string|&quot;SCAPTURE&quot;
comma
l_string|&quot;SPLAYMODE&quot;
comma
l_string|&quot;SWRITEMODE&quot;
comma
l_string|&quot;GPLAYINFO&quot;
comma
l_string|&quot;SMICROCODE&quot;
comma
l_string|&quot;GVBIFMT&quot;
comma
l_string|&quot;SVBIFMT&quot;
)brace
suffix:semicolon
DECL|macro|V4L1_IOCTLS
mdefine_line|#define V4L1_IOCTLS ARRAY_SIZE(v4l1_ioctls)
DECL|variable|v4l2_ioctls
r_static
r_const
r_char
op_star
id|v4l2_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;QUERYCAP&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;ENUM_PIXFMT&quot;
comma
l_string|&quot;ENUM_FBUFFMT&quot;
comma
l_string|&quot;G_FMT&quot;
comma
l_string|&quot;S_FMT&quot;
comma
l_string|&quot;G_COMP&quot;
comma
l_string|&quot;S_COMP&quot;
comma
l_string|&quot;REQBUFS&quot;
comma
l_string|&quot;QUERYBUF&quot;
comma
l_string|&quot;G_FBUF&quot;
comma
l_string|&quot;S_FBUF&quot;
comma
l_string|&quot;G_WIN&quot;
comma
l_string|&quot;S_WIN&quot;
comma
l_string|&quot;PREVIEW&quot;
comma
l_string|&quot;QBUF&quot;
comma
l_string|&quot;16&quot;
comma
l_string|&quot;DQBUF&quot;
comma
l_string|&quot;STREAMON&quot;
comma
l_string|&quot;STREAMOFF&quot;
comma
l_string|&quot;G_PERF&quot;
comma
l_string|&quot;G_PARM&quot;
comma
l_string|&quot;S_PARM&quot;
comma
l_string|&quot;G_STD&quot;
comma
l_string|&quot;S_STD&quot;
comma
l_string|&quot;ENUMSTD&quot;
comma
l_string|&quot;ENUMINPUT&quot;
comma
l_string|&quot;G_CTRL&quot;
comma
l_string|&quot;S_CTRL&quot;
comma
l_string|&quot;G_TUNER&quot;
comma
l_string|&quot;S_TUNER&quot;
comma
l_string|&quot;G_FREQ&quot;
comma
l_string|&quot;S_FREQ&quot;
comma
l_string|&quot;G_AUDIO&quot;
comma
l_string|&quot;S_AUDIO&quot;
comma
l_string|&quot;35&quot;
comma
l_string|&quot;QUERYCTRL&quot;
comma
l_string|&quot;QUERYMENU&quot;
comma
l_string|&quot;G_INPUT&quot;
comma
l_string|&quot;S_INPUT&quot;
comma
l_string|&quot;ENUMCVT&quot;
comma
l_string|&quot;41&quot;
comma
l_string|&quot;42&quot;
comma
l_string|&quot;43&quot;
comma
l_string|&quot;44&quot;
comma
l_string|&quot;45&quot;
comma
l_string|&quot;G_OUTPUT&quot;
comma
l_string|&quot;S_OUTPUT&quot;
comma
l_string|&quot;ENUMOUTPUT&quot;
comma
l_string|&quot;G_AUDOUT&quot;
comma
l_string|&quot;S_AUDOUT&quot;
comma
l_string|&quot;ENUMFX&quot;
comma
l_string|&quot;G_EFFECT&quot;
comma
l_string|&quot;S_EFFECT&quot;
comma
l_string|&quot;G_MODULATOR&quot;
comma
l_string|&quot;S_MODULATOR&quot;
)brace
suffix:semicolon
DECL|macro|V4L2_IOCTLS
mdefine_line|#define V4L2_IOCTLS ARRAY_SIZE(v4l2_ioctls)
DECL|function|cx88_print_ioctl
r_void
id|cx88_print_ioctl
c_func
(paren
r_char
op_star
id|name
comma
r_int
r_int
id|cmd
)paren
(brace
r_char
op_star
id|dir
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|_IOC_NONE
suffix:colon
id|dir
op_assign
l_string|&quot;--&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_READ
suffix:colon
id|dir
op_assign
l_string|&quot;r-&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_WRITE
suffix:colon
id|dir
op_assign
l_string|&quot;-w&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_READ
op_or
id|_IOC_WRITE
suffix:colon
id|dir
op_assign
l_string|&quot;rw&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dir
op_assign
l_string|&quot;??&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
l_char|&squot;v&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (v4l1, %s, VIDIOC%s)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
OL
id|V4L1_IOCTLS
)paren
ques
c_cond
id|v4l1_ioctls
(braket
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;V&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (v4l2, %s, VIDIOC_%s)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
OL
id|V4L2_IOCTLS
)paren
ques
c_cond
id|v4l2_ioctls
(braket
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (???, %s, #%d)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|macro|NO_SYNC_LINE
mdefine_line|#define NO_SYNC_LINE (-1U)
DECL|function|cx88_risc_field
r_static
id|u32
op_star
id|cx88_risc_field
c_func
(paren
id|u32
op_star
id|rp
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
r_int
id|offset
comma
id|u32
id|sync_line
comma
r_int
r_int
id|bpl
comma
r_int
r_int
id|padding
comma
r_int
r_int
id|lines
)paren
(brace
r_struct
id|scatterlist
op_star
id|sg
suffix:semicolon
r_int
r_int
id|line
comma
id|todo
suffix:semicolon
multiline_comment|/* sync instruction */
r_if
c_cond
(paren
id|sync_line
op_ne
id|NO_SYNC_LINE
)paren
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_RESYNC
op_or
id|sync_line
)paren
suffix:semicolon
multiline_comment|/* scan lines */
id|sg
op_assign
id|sglist
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|lines
suffix:semicolon
id|line
op_increment
)paren
(brace
r_while
c_loop
(paren
id|offset
op_logical_and
id|offset
op_ge
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
id|offset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bpl
op_le
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
(brace
multiline_comment|/* fits into current chunk */
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_SOL
op_or
id|RISC_EOL
op_or
id|bpl
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
id|bpl
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* scanline needs to be splitted */
id|todo
op_assign
id|bpl
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_SOL
op_or
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|todo
op_sub_assign
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|sg
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|todo
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_EOL
op_or
id|todo
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|todo
suffix:semicolon
)brace
id|offset
op_add_assign
id|padding
suffix:semicolon
)brace
r_return
id|rp
suffix:semicolon
)brace
DECL|function|cx88_risc_buffer
r_int
id|cx88_risc_buffer
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|btcx_riscmem
op_star
id|risc
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
r_int
id|top_offset
comma
r_int
r_int
id|bottom_offset
comma
r_int
r_int
id|bpl
comma
r_int
r_int
id|padding
comma
r_int
r_int
id|lines
)paren
(brace
id|u32
id|instructions
comma
id|fields
suffix:semicolon
id|u32
op_star
id|rp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|fields
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|top_offset
)paren
id|fields
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|bottom_offset
)paren
id|fields
op_increment
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is one write per page border +&n;&t;   one write per scan line + syncs + jump (all 2 dwords) */
id|instructions
op_assign
(paren
id|bpl
op_star
id|lines
op_star
id|fields
)paren
op_div
id|PAGE_SIZE
op_plus
id|lines
op_star
id|fields
suffix:semicolon
id|instructions
op_add_assign
l_int|3
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|btcx_riscmem_alloc
c_func
(paren
id|pci
comma
id|risc
comma
id|instructions
op_star
l_int|8
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* write risc instructions */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|top_offset
)paren
id|rp
op_assign
id|cx88_risc_field
c_func
(paren
id|rp
comma
id|sglist
comma
id|top_offset
comma
l_int|0
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|bottom_offset
)paren
id|rp
op_assign
id|cx88_risc_field
c_func
(paren
id|rp
comma
id|sglist
comma
id|bottom_offset
comma
l_int|0x200
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|risc-&gt;jmp
op_minus
id|risc-&gt;cpu
op_plus
l_int|2
)paren
op_div
l_int|4
OG
id|risc-&gt;size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx88_risc_databuffer
r_int
id|cx88_risc_databuffer
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|btcx_riscmem
op_star
id|risc
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
r_int
id|bpl
comma
r_int
r_int
id|lines
)paren
(brace
id|u32
id|instructions
suffix:semicolon
id|u32
op_star
id|rp
suffix:semicolon
r_int
id|rc
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is one write per page border +&n;&t;   one write per scan line + syncs + jump (all 2 dwords) */
id|instructions
op_assign
(paren
id|bpl
op_star
id|lines
)paren
op_div
id|PAGE_SIZE
op_plus
id|lines
suffix:semicolon
id|instructions
op_add_assign
l_int|3
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|btcx_riscmem_alloc
c_func
(paren
id|pci
comma
id|risc
comma
id|instructions
op_star
l_int|8
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* write risc instructions */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
id|rp
op_assign
id|cx88_risc_field
c_func
(paren
id|rp
comma
id|sglist
comma
l_int|0
comma
id|NO_SYNC_LINE
comma
id|bpl
comma
l_int|0
comma
id|lines
)paren
suffix:semicolon
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|risc-&gt;jmp
op_minus
id|risc-&gt;cpu
op_plus
l_int|2
)paren
op_div
l_int|4
OG
id|risc-&gt;size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx88_risc_stopper
r_int
id|cx88_risc_stopper
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|btcx_riscmem
op_star
id|risc
comma
id|u32
id|reg
comma
id|u32
id|mask
comma
id|u32
id|value
)paren
(brace
id|u32
op_star
id|rp
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|btcx_riscmem_alloc
c_func
(paren
id|pci
comma
id|risc
comma
l_int|4
op_star
l_int|16
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* write risc instructions */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITECR
op_or
id|RISC_IRQ2
op_or
id|RISC_IMM
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|reg
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|value
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|mask
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|risc-&gt;dma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cx88_free_buffer
id|cx88_free_buffer
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|cx88_buffer
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|videobuf_waiton
c_func
(paren
op_amp
id|buf-&gt;vb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|videobuf_dma_pci_unmap
c_func
(paren
id|pci
comma
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|videobuf_dma_free
c_func
(paren
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|btcx_riscmem_free
c_func
(paren
id|pci
comma
op_amp
id|buf-&gt;risc
)paren
suffix:semicolon
id|buf-&gt;vb.state
op_assign
id|STATE_NEEDS_INIT
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* our SRAM memory layout                                             */
multiline_comment|/* we are going to put all thr risc programs into host memory, so we&n; * can use the whole SDRAM for the DMA fifos.  To simplify things, we&n; * use a static memory layout.  That surely will waste memory in case&n; * we don&squot;t use all DMA channels at the same time (which will be the&n; * case most of the time).  But that still gives us enougth FIFO space&n; * to be able to deal with insane long pci latencies ...&n; *&n; * FIFO space allocations:&n; *    channel  21    (y video)  - 10.0k&n; *    channel  22    (u video)  -  2.0k&n; *    channel  23    (v video)  -  2.0k&n; *    channel  24    (vbi)      -  4.0k&n; *    channels 25+26 (audio)    -  0.5k&n; *    channel  28    (mpeg)     -  4.0k&n; *    TOTAL                     = 25.5k&n; *&n; * Every channel has 160 bytes control data (64 bytes instruction&n; * queue and 6 CDT entries), which is close to 2k total.&n; *&n; * Address layout:&n; *    0x0000 - 0x03ff    CMDs / reserved&n; *    0x0400 - 0x0bff    instruction queues + CDs&n; *    0x0c00 -           FIFOs&n; */
DECL|variable|cx88_sram_channels
r_struct
id|sram_channel
id|cx88_sram_channels
(braket
)braket
op_assign
(brace
(braket
id|SRAM_CH21
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video y / packed&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180040
comma
dot
id|ctrl_start
op_assign
l_int|0x180400
comma
dot
id|cdt
op_assign
l_int|0x180400
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x180c00
comma
dot
id|fifo_size
op_assign
l_int|0x002800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA21_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA21_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA21_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA21_CNT2
comma
)brace
comma
(braket
id|SRAM_CH22
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video u&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180080
comma
dot
id|ctrl_start
op_assign
l_int|0x1804a0
comma
dot
id|cdt
op_assign
l_int|0x1804a0
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x183400
comma
dot
id|fifo_size
op_assign
l_int|0x000800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA22_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA22_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA22_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA22_CNT2
comma
)brace
comma
(braket
id|SRAM_CH23
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video v&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x1800c0
comma
dot
id|ctrl_start
op_assign
l_int|0x180540
comma
dot
id|cdt
op_assign
l_int|0x180540
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x183c00
comma
dot
id|fifo_size
op_assign
l_int|0x000800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA23_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA23_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA23_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA23_CNT2
comma
)brace
comma
(braket
id|SRAM_CH24
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;vbi&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180100
comma
dot
id|ctrl_start
op_assign
l_int|0x1805e0
comma
dot
id|cdt
op_assign
l_int|0x1805e0
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x184400
comma
dot
id|fifo_size
op_assign
l_int|0x001000
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA24_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA24_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA24_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA24_CNT2
comma
)brace
comma
(braket
id|SRAM_CH25
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;audio from&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180140
comma
dot
id|ctrl_start
op_assign
l_int|0x180680
comma
dot
id|cdt
op_assign
l_int|0x180680
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x185400
comma
dot
id|fifo_size
op_assign
l_int|0x000200
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA25_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA25_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA25_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA25_CNT2
comma
)brace
comma
(braket
id|SRAM_CH26
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;audio to&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180180
comma
dot
id|ctrl_start
op_assign
l_int|0x180720
comma
dot
id|cdt
op_assign
l_int|0x180680
op_plus
l_int|64
comma
multiline_comment|/* same as audio IN */
dot
id|fifo_start
op_assign
l_int|0x185400
comma
multiline_comment|/* same as audio IN */
dot
id|fifo_size
op_assign
l_int|0x000200
comma
multiline_comment|/* same as audio IN */
dot
id|ptr1_reg
op_assign
id|MO_DMA26_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA26_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA26_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA26_CNT2
comma
)brace
comma
(braket
id|SRAM_CH28
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mpeg&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180200
comma
dot
id|ctrl_start
op_assign
l_int|0x1807C0
comma
dot
id|cdt
op_assign
l_int|0x1807C0
op_plus
l_int|64
comma
dot
id|fifo_start
op_assign
l_int|0x185600
comma
dot
id|fifo_size
op_assign
l_int|0x001000
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA28_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA28_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA28_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA28_CNT2
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|cx88_sram_channel_setup
r_int
id|cx88_sram_channel_setup
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|sram_channel
op_star
id|ch
comma
r_int
r_int
id|bpl
comma
id|u32
id|risc
)paren
(brace
r_int
r_int
id|i
comma
id|lines
suffix:semicolon
id|u32
id|cdt
suffix:semicolon
id|bpl
op_assign
(paren
id|bpl
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
multiline_comment|/* alignment */
id|cdt
op_assign
id|ch-&gt;cdt
suffix:semicolon
id|lines
op_assign
id|ch-&gt;fifo_size
op_div
id|bpl
suffix:semicolon
r_if
c_cond
(paren
id|lines
OG
l_int|6
)paren
id|lines
op_assign
l_int|6
suffix:semicolon
id|BUG_ON
c_func
(paren
id|lines
OL
l_int|2
)paren
suffix:semicolon
multiline_comment|/* write CDT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lines
suffix:semicolon
id|i
op_increment
)paren
id|cx_write
c_func
(paren
id|cdt
op_plus
l_int|16
op_star
id|i
comma
id|ch-&gt;fifo_start
op_plus
id|bpl
op_star
id|i
)paren
suffix:semicolon
multiline_comment|/* write CMDS */
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|0
comma
id|risc
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
comma
id|cdt
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|8
comma
(paren
id|lines
op_star
l_int|16
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|12
comma
id|ch-&gt;ctrl_start
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|16
comma
l_int|64
op_rshift
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|20
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* fill registers */
id|cx_write
c_func
(paren
id|ch-&gt;ptr1_reg
comma
id|ch-&gt;fifo_start
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;ptr2_reg
comma
id|cdt
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cnt1_reg
comma
(paren
id|bpl
op_rshift
l_int|3
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cnt2_reg
comma
(paren
id|lines
op_star
l_int|16
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;sram setup %s: bpl=%d lines=%d&bslash;n&quot;
comma
id|ch-&gt;name
comma
id|bpl
comma
id|lines
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* debug helper code                                                  */
DECL|function|cx88_risc_decode
r_int
id|cx88_risc_decode
c_func
(paren
id|u32
id|risc
)paren
(brace
r_static
r_char
op_star
id|instr
(braket
l_int|16
)braket
op_assign
(brace
(braket
id|RISC_SYNC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;sync&quot;
comma
(braket
id|RISC_WRITE
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;write&quot;
comma
(braket
id|RISC_WRITEC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writec&quot;
comma
(braket
id|RISC_READ
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;read&quot;
comma
(braket
id|RISC_READC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;readc&quot;
comma
(braket
id|RISC_JUMP
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;jump&quot;
comma
(braket
id|RISC_SKIP
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;skip&quot;
comma
(braket
id|RISC_WRITERM
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writerm&quot;
comma
(braket
id|RISC_WRITECM
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writecm&quot;
comma
(braket
id|RISC_WRITECR
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writecr&quot;
comma
)brace
suffix:semicolon
r_static
r_int
id|incr
(braket
l_int|16
)braket
op_assign
(brace
(braket
id|RISC_WRITE
op_rshift
l_int|28
)braket
op_assign
l_int|2
comma
(braket
id|RISC_JUMP
op_rshift
l_int|28
)braket
op_assign
l_int|2
comma
(braket
id|RISC_WRITERM
op_rshift
l_int|28
)braket
op_assign
l_int|3
comma
(braket
id|RISC_WRITECM
op_rshift
l_int|28
)braket
op_assign
l_int|3
comma
(braket
id|RISC_WRITECR
op_rshift
l_int|28
)braket
op_assign
l_int|4
comma
)brace
suffix:semicolon
r_static
r_char
op_star
id|bits
(braket
)braket
op_assign
(brace
l_string|&quot;12&quot;
comma
l_string|&quot;13&quot;
comma
l_string|&quot;14&quot;
comma
l_string|&quot;resync&quot;
comma
l_string|&quot;cnt0&quot;
comma
l_string|&quot;cnt1&quot;
comma
l_string|&quot;18&quot;
comma
l_string|&quot;19&quot;
comma
l_string|&quot;20&quot;
comma
l_string|&quot;21&quot;
comma
l_string|&quot;22&quot;
comma
l_string|&quot;23&quot;
comma
l_string|&quot;irq1&quot;
comma
l_string|&quot;irq2&quot;
comma
l_string|&quot;eol&quot;
comma
l_string|&quot;sol&quot;
comma
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;0x%08x [ %s&quot;
comma
id|risc
comma
id|instr
(braket
id|risc
op_rshift
l_int|28
)braket
ques
c_cond
id|instr
(braket
id|risc
op_rshift
l_int|28
)braket
suffix:colon
l_string|&quot;INVALID&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ARRAY_SIZE
c_func
(paren
id|bits
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|risc
op_amp
(paren
l_int|1
op_lshift
(paren
id|i
op_plus
l_int|12
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; %s&quot;
comma
id|bits
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; count=%d ]&bslash;n&quot;
comma
id|risc
op_amp
l_int|0xfff
)paren
suffix:semicolon
r_return
id|incr
(braket
id|risc
op_rshift
l_int|28
)braket
ques
c_cond
id|incr
(braket
id|risc
op_rshift
l_int|28
)braket
suffix:colon
l_int|1
suffix:semicolon
)brace
DECL|function|cx88_risc_disasm
r_void
id|cx88_risc_disasm
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|btcx_riscmem
op_star
id|risc
)paren
(brace
r_int
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: risc disasm: %p [dma=0x%08lx]&bslash;n&quot;
comma
id|core-&gt;name
comma
id|risc-&gt;cpu
comma
(paren
r_int
r_int
)paren
id|risc-&gt;dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|risc-&gt;size
op_rshift
l_int|2
)paren
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:   %04d: &quot;
comma
id|core-&gt;name
comma
id|i
)paren
suffix:semicolon
id|n
op_assign
id|cx88_risc_decode
c_func
(paren
id|risc-&gt;cpu
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s:   %04d: 0x%08x [ arg #%d ]&bslash;n&quot;
comma
id|core-&gt;name
comma
id|i
op_plus
id|j
comma
id|risc-&gt;cpu
(braket
id|i
op_plus
id|j
)braket
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|risc-&gt;cpu
(braket
id|i
)braket
op_eq
id|RISC_JUMP
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|cx88_sram_channel_dump
r_void
id|cx88_sram_channel_dump
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|sram_channel
op_star
id|ch
)paren
(brace
r_static
r_char
op_star
id|name
(braket
)braket
op_assign
(brace
l_string|&quot;initial risc&quot;
comma
l_string|&quot;cdt base&quot;
comma
l_string|&quot;cdt size&quot;
comma
l_string|&quot;iq base&quot;
comma
l_string|&quot;iq size&quot;
comma
l_string|&quot;risc pc&quot;
comma
l_string|&quot;iq wr ptr&quot;
comma
l_string|&quot;iq rd ptr&quot;
comma
l_string|&quot;cdt current&quot;
comma
l_string|&quot;pci target&quot;
comma
l_string|&quot;line / byte&quot;
comma
)brace
suffix:semicolon
id|u32
id|risc
suffix:semicolon
r_int
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s - dma channel status dump&bslash;n&quot;
comma
id|core-&gt;name
comma
id|ch-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|name
)paren
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s:   cmds: %-12s: 0x%08x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|name
(braket
id|i
)braket
comma
id|cx_read
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
op_star
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
op_star
(paren
id|i
op_plus
l_int|11
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   risc%d: &quot;
comma
id|core-&gt;name
comma
id|i
)paren
suffix:semicolon
id|cx88_risc_decode
c_func
(paren
id|risc
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;ctrl_start
op_plus
l_int|4
op_star
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   iq %x: &quot;
comma
id|core-&gt;name
comma
id|i
)paren
suffix:semicolon
id|n
op_assign
id|cx88_risc_decode
c_func
(paren
id|risc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;ctrl_start
op_plus
l_int|4
op_star
(paren
id|i
op_plus
id|j
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   iq %x: 0x%08x [ arg #%d ]&bslash;n&quot;
comma
id|core-&gt;name
comma
id|i
op_plus
id|j
comma
id|risc
comma
id|j
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%s: fifo: 0x%08x -&gt; 0x%x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|ch-&gt;fifo_start
comma
id|ch-&gt;fifo_start
op_plus
id|ch-&gt;fifo_size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ctrl: 0x%08x -&gt; 0x%x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|ch-&gt;ctrl_start
comma
id|ch-&gt;ctrl_start
op_plus
l_int|6
op_star
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   ptr1_reg: 0x%08x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;ptr1_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   ptr2_reg: 0x%08x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;ptr2_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   cnt1_reg: 0x%08x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;cnt1_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   cnt2_reg: 0x%08x&bslash;n&quot;
comma
id|core-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;cnt2_reg
)paren
)paren
suffix:semicolon
)brace
DECL|variable|cx88_pci_irqs
r_char
op_star
id|cx88_pci_irqs
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;vid&quot;
comma
l_string|&quot;aud&quot;
comma
l_string|&quot;ts&quot;
comma
l_string|&quot;vip&quot;
comma
l_string|&quot;hst&quot;
comma
l_string|&quot;5&quot;
comma
l_string|&quot;6&quot;
comma
l_string|&quot;tm1&quot;
comma
l_string|&quot;src_dma&quot;
comma
l_string|&quot;dst_dma&quot;
comma
l_string|&quot;risc_rd_err&quot;
comma
l_string|&quot;risc_wr_err&quot;
comma
l_string|&quot;brdg_err&quot;
comma
l_string|&quot;src_dma_err&quot;
comma
l_string|&quot;dst_dma_err&quot;
comma
l_string|&quot;ipb_dma_err&quot;
comma
l_string|&quot;i2c&quot;
comma
l_string|&quot;i2c_rack&quot;
comma
l_string|&quot;ir_smp&quot;
comma
l_string|&quot;gpio0&quot;
comma
l_string|&quot;gpio1&quot;
)brace
suffix:semicolon
DECL|variable|cx88_vid_irqs
r_char
op_star
id|cx88_vid_irqs
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;y_risci1&quot;
comma
l_string|&quot;u_risci1&quot;
comma
l_string|&quot;v_risci1&quot;
comma
l_string|&quot;vbi_risc1&quot;
comma
l_string|&quot;y_risci2&quot;
comma
l_string|&quot;u_risci2&quot;
comma
l_string|&quot;v_risci2&quot;
comma
l_string|&quot;vbi_risc2&quot;
comma
l_string|&quot;y_oflow&quot;
comma
l_string|&quot;u_oflow&quot;
comma
l_string|&quot;v_oflow&quot;
comma
l_string|&quot;vbi_oflow&quot;
comma
l_string|&quot;y_sync&quot;
comma
l_string|&quot;u_sync&quot;
comma
l_string|&quot;v_sync&quot;
comma
l_string|&quot;vbi_sync&quot;
comma
l_string|&quot;opc_err&quot;
comma
l_string|&quot;par_err&quot;
comma
l_string|&quot;rip_err&quot;
comma
l_string|&quot;pci_abort&quot;
comma
)brace
suffix:semicolon
DECL|variable|cx88_mpeg_irqs
r_char
op_star
id|cx88_mpeg_irqs
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;ts_risci1&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;ts_risci2&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;ts_oflow&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;ts_sync&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;opc_err&quot;
comma
l_string|&quot;par_err&quot;
comma
l_string|&quot;rip_err&quot;
comma
l_string|&quot;pci_abort&quot;
comma
l_string|&quot;ts_err?&quot;
comma
)brace
suffix:semicolon
DECL|function|cx88_print_irqbits
r_void
id|cx88_print_irqbits
c_func
(paren
r_char
op_star
id|name
comma
r_char
op_star
id|tag
comma
r_char
op_star
op_star
id|strings
comma
id|u32
id|bits
comma
id|u32
id|mask
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s [0x%x]&quot;
comma
id|name
comma
id|tag
comma
id|bits
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bits
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|strings
(braket
id|i
)braket
)paren
id|printk
c_func
(paren
l_string|&quot; %s&quot;
comma
id|strings
(braket
id|i
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; %d&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;*&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|cx88_irq
r_void
id|cx88_irq
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|status
comma
id|u32
id|mask
)paren
(brace
id|cx88_print_irqbits
c_func
(paren
id|core-&gt;name
comma
l_string|&quot;irq pci&quot;
comma
id|cx88_pci_irqs
comma
id|status
comma
id|mask
)paren
suffix:semicolon
)brace
DECL|function|cx88_wakeup
r_void
id|cx88_wakeup
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|cx88_dmaqueue
op_star
id|q
comma
id|u32
id|count
)paren
(brace
r_struct
id|cx88_buffer
op_star
id|buf
suffix:semicolon
r_int
id|bc
suffix:semicolon
r_for
c_loop
(paren
id|bc
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|bc
op_increment
)paren
(brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|q-&gt;active
)paren
)paren
r_break
suffix:semicolon
id|buf
op_assign
id|list_entry
c_func
(paren
id|q-&gt;active.next
comma
r_struct
id|cx88_buffer
comma
id|vb.queue
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|buf-&gt;count
OG
id|count
)paren
r_break
suffix:semicolon
macro_line|#else
multiline_comment|/* count comes from the hw and is is 16bit wide --&n;&t;&t; * this trick handles wrap-arounds correctly for&n;&t;&t; * up to 32767 buffers in flight... */
r_if
c_cond
(paren
(paren
id|s16
)paren
(paren
id|count
op_minus
id|buf-&gt;count
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
macro_line|#endif
id|do_gettimeofday
c_func
(paren
op_amp
id|buf-&gt;vb.ts
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;[%p/%d] wakeup reg=%d buf=%d&bslash;n&quot;
comma
id|buf
comma
id|buf-&gt;vb.i
comma
id|count
comma
id|buf-&gt;count
)paren
suffix:semicolon
id|buf-&gt;vb.state
op_assign
id|STATE_DONE
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|buf-&gt;vb.queue
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|buf-&gt;vb.done
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|q-&gt;active
)paren
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|q-&gt;timeout
)paren
suffix:semicolon
)brace
r_else
(brace
id|mod_timer
c_func
(paren
op_amp
id|q-&gt;timeout
comma
id|jiffies
op_plus
id|BUFFER_TIMEOUT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bc
op_ne
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s: %d buffers handled (should be 1)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|bc
)paren
suffix:semicolon
)brace
DECL|function|cx88_shutdown
r_void
id|cx88_shutdown
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
)paren
(brace
multiline_comment|/* disable RISC controller + IRQs */
id|cx_write
c_func
(paren
id|MO_DEV_CNTRL2
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* stop dma transfers */
id|cx_write
c_func
(paren
id|MO_VID_DMACNTRL
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_AUD_DMACNTRL
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_TS_DMACNTRL
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VIP_DMACNTRL
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_DMACNTRL
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* stop interrupts */
id|cx_write
c_func
(paren
id|MO_PCI_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VID_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_AUD_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_TS_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VIP_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_INTMSK
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* stop capturing */
id|cx_write
c_func
(paren
id|VID_CAPTURE_CONTROL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cx88_reset
r_int
id|cx88_reset
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|cx88_shutdown
c_func
(paren
id|core
)paren
suffix:semicolon
multiline_comment|/* clear irq status */
id|cx_write
c_func
(paren
id|MO_VID_INTSTAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear PIV int
id|cx_write
c_func
(paren
id|MO_PCI_INTSTAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear PCI int
id|cx_write
c_func
(paren
id|MO_INT1_STAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear RISC int
multiline_comment|/* wait a bit */
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* init sram */
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH21
)braket
comma
l_int|720
op_star
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH22
)braket
comma
l_int|128
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH23
)braket
comma
l_int|128
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH24
)braket
comma
l_int|128
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH25
)braket
comma
l_int|128
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH26
)braket
comma
l_int|128
comma
l_int|0
)paren
suffix:semicolon
id|cx88_sram_channel_setup
c_func
(paren
id|core
comma
op_amp
id|cx88_sram_channels
(braket
id|SRAM_CH28
)braket
comma
l_int|188
op_star
l_int|4
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* misc init ... */
id|cx_write
c_func
(paren
id|MO_INPUT_FORMAT
comma
(paren
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
singleline_comment|// agc enable
(paren
l_int|1
op_lshift
l_int|12
)paren
op_or
singleline_comment|// agc gain
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
singleline_comment|// adaptibe agc
(paren
l_int|0
op_lshift
l_int|10
)paren
op_or
singleline_comment|// chroma agc
(paren
l_int|0
op_lshift
l_int|9
)paren
op_or
singleline_comment|// ckillen
(paren
l_int|7
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* setup image format */
id|cx_andor
c_func
(paren
id|MO_COLOR_CTRL
comma
l_int|0x4000
comma
l_int|0x4000
)paren
suffix:semicolon
multiline_comment|/* setup FIFO Threshholds */
id|cx_write
c_func
(paren
id|MO_PDMA_STHRSH
comma
l_int|0x0807
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_PDMA_DTHRSH
comma
l_int|0x0807
)paren
suffix:semicolon
multiline_comment|/* fixes flashing of image */
id|cx_write
c_func
(paren
id|MO_AGC_SYNC_TIP1
comma
l_int|0x0380000F
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_AGC_BACK_VBI
comma
l_int|0x00E00555
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VID_INTSTAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear PIV int
id|cx_write
c_func
(paren
id|MO_PCI_INTSTAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear PCI int
id|cx_write
c_func
(paren
id|MO_INT1_STAT
comma
l_int|0xFFFFFFFF
)paren
suffix:semicolon
singleline_comment|// Clear RISC int
multiline_comment|/* Reset on-board parts */
id|cx_write
c_func
(paren
id|MO_SRST_IO
comma
l_int|0
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_SRST_IO
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|norm_swidth
r_static
r_int
r_int
r_inline
id|norm_swidth
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
l_int|922
suffix:colon
l_int|754
suffix:semicolon
)brace
DECL|function|norm_hdelay
r_static
r_int
r_int
r_inline
id|norm_hdelay
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
l_int|186
suffix:colon
l_int|135
suffix:semicolon
)brace
DECL|function|norm_vdelay
r_static
r_int
r_int
r_inline
id|norm_vdelay
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
l_int|0x24
suffix:colon
l_int|0x18
suffix:semicolon
)brace
DECL|function|norm_fsc8
r_static
r_int
r_int
r_inline
id|norm_fsc8
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_static
r_const
r_int
r_int
id|ntsc
op_assign
l_int|28636360
suffix:semicolon
r_static
r_const
r_int
r_int
id|pal
op_assign
l_int|35468950
suffix:semicolon
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
id|pal
suffix:colon
id|ntsc
suffix:semicolon
)brace
DECL|function|norm_notchfilter
r_static
r_int
r_int
r_inline
id|norm_notchfilter
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
id|HLNotchFilter135PAL
suffix:colon
id|HLNotchFilter135NTSC
suffix:semicolon
)brace
DECL|function|norm_htotal
r_static
r_int
r_int
r_inline
id|norm_htotal
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
l_int|1135
suffix:colon
l_int|910
suffix:semicolon
)brace
DECL|function|norm_vbipack
r_static
r_int
r_int
r_inline
id|norm_vbipack
c_func
(paren
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
r_return
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_625_50
)paren
ques
c_cond
l_int|511
suffix:colon
l_int|288
suffix:semicolon
)brace
DECL|function|cx88_set_scale
r_int
id|cx88_set_scale
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_int
r_int
id|width
comma
r_int
r_int
id|height
comma
r_enum
id|v4l2_field
id|field
)paren
(brace
r_int
r_int
id|swidth
op_assign
id|norm_swidth
c_func
(paren
id|core-&gt;tvnorm
)paren
suffix:semicolon
r_int
r_int
id|sheight
op_assign
id|norm_maxh
c_func
(paren
id|core-&gt;tvnorm
)paren
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: %dx%d [%s%s,%s]&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|V4L2_FIELD_HAS_TOP
c_func
(paren
id|field
)paren
ques
c_cond
l_string|&quot;T&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|V4L2_FIELD_HAS_BOTTOM
c_func
(paren
id|field
)paren
ques
c_cond
l_string|&quot;B&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|core-&gt;tvnorm-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
id|height
op_mul_assign
l_int|2
suffix:semicolon
singleline_comment|// recalc H delay and scale registers
id|value
op_assign
(paren
id|width
op_star
id|norm_hdelay
c_func
(paren
id|core-&gt;tvnorm
)paren
)paren
op_div
id|swidth
suffix:semicolon
id|value
op_and_assign
l_int|0x3fe
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HDELAY_EVEN
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HDELAY_ODD
comma
id|value
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: hdelay  0x%04x&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
id|value
op_assign
(paren
id|swidth
op_star
l_int|4096
op_div
id|width
)paren
op_minus
l_int|4096
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HSCALE_EVEN
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HSCALE_ODD
comma
id|value
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: hscale  0x%04x&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HACTIVE_EVEN
comma
id|width
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HACTIVE_ODD
comma
id|width
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: hactive 0x%04x&bslash;n&quot;
comma
id|width
)paren
suffix:semicolon
singleline_comment|// recalc V scale Register (delay is constant)
id|cx_write
c_func
(paren
id|MO_VDELAY_EVEN
comma
id|norm_vdelay
c_func
(paren
id|core-&gt;tvnorm
)paren
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VDELAY_ODD
comma
id|norm_vdelay
c_func
(paren
id|core-&gt;tvnorm
)paren
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: vdelay  0x%04x&bslash;n&quot;
comma
id|norm_vdelay
c_func
(paren
id|core-&gt;tvnorm
)paren
)paren
suffix:semicolon
id|value
op_assign
(paren
l_int|0x10000
op_minus
(paren
id|sheight
op_star
l_int|512
op_div
id|height
op_minus
l_int|512
)paren
)paren
op_amp
l_int|0x1fff
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VSCALE_EVEN
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VSCALE_ODD
comma
id|value
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: vscale  0x%04x&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VACTIVE_EVEN
comma
id|sheight
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_VACTIVE_ODD
comma
id|sheight
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: vactive 0x%04x&bslash;n&quot;
comma
id|sheight
)paren
suffix:semicolon
singleline_comment|// setup filters
id|value
op_assign
l_int|0
suffix:semicolon
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|19
)paren
suffix:semicolon
singleline_comment|// CFILT (default)
r_if
c_cond
(paren
id|core-&gt;tvnorm-&gt;id
op_amp
id|V4L2_STD_SECAM
)paren
(brace
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|15
)paren
suffix:semicolon
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|INPUT
c_func
(paren
id|core-&gt;input
)paren
op_member_access_from_pointer
id|type
op_eq
id|CX88_VMUX_SVIDEO
)paren
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_FIELD_INTERLACED
op_eq
id|field
)paren
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
suffix:semicolon
singleline_comment|// VINT (interlaced vertical scaling)
r_if
c_cond
(paren
id|width
OL
l_int|385
)paren
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|0
)paren
suffix:semicolon
singleline_comment|// 3-tap interpolation
r_if
c_cond
(paren
id|width
OL
l_int|193
)paren
id|value
op_or_assign
(paren
l_int|1
op_lshift
l_int|1
)paren
suffix:semicolon
singleline_comment|// 5-tap interpolation
id|cx_write
c_func
(paren
id|MO_FILTER_EVEN
comma
id|value
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_FILTER_ODD
comma
id|value
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_scale: filter  0x%04x&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|xtal
r_static
r_const
id|u32
id|xtal
op_assign
l_int|28636363
suffix:semicolon
DECL|function|set_pll
r_static
r_int
id|set_pll
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_int
id|prescale
comma
id|u32
id|ofreq
)paren
(brace
r_static
id|u32
id|pre
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|3
comma
l_int|2
comma
l_int|1
)brace
suffix:semicolon
id|u64
id|pll
suffix:semicolon
id|u32
id|reg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|prescale
OL
l_int|2
)paren
id|prescale
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|prescale
OG
l_int|5
)paren
id|prescale
op_assign
l_int|5
suffix:semicolon
id|pll
op_assign
id|ofreq
op_star
l_int|8
op_star
id|prescale
op_star
(paren
id|u64
)paren
(paren
l_int|1
op_lshift
l_int|20
)paren
suffix:semicolon
id|do_div
c_func
(paren
id|pll
comma
id|xtal
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|pll
op_amp
l_int|0x3ffffff
)paren
op_or
(paren
id|pre
(braket
id|prescale
)braket
op_lshift
l_int|26
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|reg
op_rshift
l_int|20
)paren
op_amp
l_int|0x3f
)paren
OL
l_int|14
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s/0: pll out of range&bslash;n&quot;
comma
id|core-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_pll:    MO_PLL_REG       0x%08x [old=0x%08x,freq=%d]&bslash;n&quot;
comma
id|reg
comma
id|cx_read
c_func
(paren
id|MO_PLL_REG
)paren
comma
id|ofreq
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_PLL_REG
comma
id|reg
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|reg
op_assign
id|cx_read
c_func
(paren
id|MO_DEVICE_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
(paren
l_int|1
op_lshift
l_int|2
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;pll locked [pre=%d,ofreq=%d]&bslash;n&quot;
comma
id|prescale
comma
id|ofreq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;pll not locked yet, waiting ...&bslash;n&quot;
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;pll NOT locked [pre=%d,ofreq=%d]&bslash;n&quot;
comma
id|prescale
comma
id|ofreq
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|set_tvaudio
r_static
r_int
id|set_tvaudio
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
)paren
(brace
r_struct
id|cx88_tvnorm
op_star
id|norm
op_assign
id|core-&gt;tvnorm
suffix:semicolon
r_if
c_cond
(paren
id|CX88_VMUX_TELEVISION
op_ne
id|INPUT
c_func
(paren
id|core-&gt;input
)paren
op_member_access_from_pointer
id|type
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_STD_PAL_BG
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|nicam
ques
c_cond
id|WW_NICAM_BGDKL
suffix:colon
id|WW_A2_BG
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|V4L2_STD_PAL_DK
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|nicam
ques
c_cond
id|WW_NICAM_BGDKL
suffix:colon
id|WW_A2_DK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|V4L2_STD_PAL_I
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|WW_NICAM_I
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|V4L2_STD_SECAM_L
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|WW_SYSTEM_L_AM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|V4L2_STD_SECAM_DK
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|WW_A2_DK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|V4L2_STD_NTSC_M
op_amp
id|norm-&gt;id
)paren
op_logical_or
(paren
id|V4L2_STD_PAL_M
op_amp
id|norm-&gt;id
)paren
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|WW_BTSC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|V4L2_STD_NTSC_M_JP
op_amp
id|norm-&gt;id
)paren
(brace
id|core-&gt;tvaudio
op_assign
id|WW_EIAJ
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;%s/0: tvaudio support needs work for this tv norm [%s], sorry&bslash;n&quot;
comma
id|core-&gt;name
comma
id|norm-&gt;name
)paren
suffix:semicolon
id|core-&gt;tvaudio
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|cx_andor
c_func
(paren
id|MO_AFECFG_IO
comma
l_int|0x1f
comma
l_int|0x0
)paren
suffix:semicolon
id|cx88_set_tvaudio
c_func
(paren
id|core
)paren
suffix:semicolon
singleline_comment|// cx88_set_stereo(dev,V4L2_TUNER_MODE_STEREO);
id|cx_write
c_func
(paren
id|MO_AUDD_LNGTH
comma
l_int|128
op_div
l_int|8
)paren
suffix:semicolon
multiline_comment|/* fifo size */
id|cx_write
c_func
(paren
id|MO_AUDR_LNGTH
comma
l_int|128
op_div
l_int|8
)paren
suffix:semicolon
multiline_comment|/* fifo size */
id|cx_write
c_func
(paren
id|MO_AUD_DMACNTRL
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* need audio fifo */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx88_set_tvnorm
r_int
id|cx88_set_tvnorm
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|cx88_tvnorm
op_star
id|norm
)paren
(brace
id|u32
id|fsc8
suffix:semicolon
id|u32
id|adc_clock
suffix:semicolon
id|u32
id|vdec_clock
suffix:semicolon
id|u32
id|step_db
comma
id|step_dr
suffix:semicolon
id|u64
id|tmp64
suffix:semicolon
id|u32
id|bdelay
comma
id|agcdelay
comma
id|htotal
suffix:semicolon
id|core-&gt;tvnorm
op_assign
id|norm
suffix:semicolon
id|fsc8
op_assign
id|norm_fsc8
c_func
(paren
id|norm
)paren
suffix:semicolon
id|adc_clock
op_assign
id|xtal
suffix:semicolon
id|vdec_clock
op_assign
id|fsc8
suffix:semicolon
id|step_db
op_assign
id|fsc8
suffix:semicolon
id|step_dr
op_assign
id|fsc8
suffix:semicolon
r_if
c_cond
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_SECAM
)paren
(brace
id|step_db
op_assign
l_int|4250000
op_star
l_int|8
suffix:semicolon
id|step_dr
op_assign
l_int|4406250
op_star
l_int|8
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: &bslash;&quot;%s&bslash;&quot; fsc8=%d adc=%d vdec=%d db/dr=%d/%d&bslash;n&quot;
comma
id|norm-&gt;name
comma
id|fsc8
comma
id|adc_clock
comma
id|vdec_clock
comma
id|step_db
comma
id|step_dr
)paren
suffix:semicolon
id|set_pll
c_func
(paren
id|core
comma
l_int|2
comma
id|vdec_clock
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_INPUT_FORMAT  0x%08x [old=0x%08x]&bslash;n&quot;
comma
id|norm-&gt;cxiformat
comma
id|cx_read
c_func
(paren
id|MO_INPUT_FORMAT
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|cx_andor
c_func
(paren
id|MO_INPUT_FORMAT
comma
l_int|0xf
comma
id|norm-&gt;cxiformat
)paren
suffix:semicolon
macro_line|#if 1
singleline_comment|// FIXME: as-is from DScaler
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_OUTPUT_FORMAT 0x%08x [old=0x%08x]&bslash;n&quot;
comma
id|norm-&gt;cxoformat
comma
id|cx_read
c_func
(paren
id|MO_OUTPUT_FORMAT
)paren
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_OUTPUT_FORMAT
comma
id|norm-&gt;cxoformat
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// MO_SCONV_REG = adc clock / video dec clock * 2^17
id|tmp64
op_assign
id|adc_clock
op_star
(paren
id|u64
)paren
(paren
l_int|1
op_lshift
l_int|17
)paren
suffix:semicolon
id|do_div
c_func
(paren
id|tmp64
comma
id|vdec_clock
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_SCONV_REG     0x%08x [old=0x%08x]&bslash;n&quot;
comma
(paren
id|u32
)paren
id|tmp64
comma
id|cx_read
c_func
(paren
id|MO_SCONV_REG
)paren
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_SCONV_REG
comma
(paren
id|u32
)paren
id|tmp64
)paren
suffix:semicolon
singleline_comment|// MO_SUB_STEP = 8 * fsc / video dec clock * 2^22
id|tmp64
op_assign
id|step_db
op_star
(paren
id|u64
)paren
(paren
l_int|1
op_lshift
l_int|22
)paren
suffix:semicolon
id|do_div
c_func
(paren
id|tmp64
comma
id|vdec_clock
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_SUB_STEP      0x%08x [old=0x%08x]&bslash;n&quot;
comma
(paren
id|u32
)paren
id|tmp64
comma
id|cx_read
c_func
(paren
id|MO_SUB_STEP
)paren
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_SUB_STEP
comma
(paren
id|u32
)paren
id|tmp64
)paren
suffix:semicolon
singleline_comment|// MO_SUB_STEP_DR = 8 * 4406250 / video dec clock * 2^22
id|tmp64
op_assign
id|step_dr
op_star
(paren
id|u64
)paren
(paren
l_int|1
op_lshift
l_int|22
)paren
suffix:semicolon
id|do_div
c_func
(paren
id|tmp64
comma
id|vdec_clock
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_SUB_STEP_DR   0x%08x [old=0x%08x]&bslash;n&quot;
comma
(paren
id|u32
)paren
id|tmp64
comma
id|cx_read
c_func
(paren
id|MO_SUB_STEP_DR
)paren
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_SUB_STEP_DR
comma
(paren
id|u32
)paren
id|tmp64
)paren
suffix:semicolon
singleline_comment|// bdelay + agcdelay
id|bdelay
op_assign
id|vdec_clock
op_star
l_int|65
op_div
l_int|20000000
op_plus
l_int|21
suffix:semicolon
id|agcdelay
op_assign
id|vdec_clock
op_star
l_int|68
op_div
l_int|20000000
op_plus
l_int|15
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_AGC_BURST     0x%08x [old=0x%08x,bdelay=%d,agcdelay=%d]&bslash;n&quot;
comma
(paren
id|bdelay
op_lshift
l_int|8
)paren
op_or
id|agcdelay
comma
id|cx_read
c_func
(paren
id|MO_AGC_BURST
)paren
comma
id|bdelay
comma
id|agcdelay
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_AGC_BURST
comma
(paren
id|bdelay
op_lshift
l_int|8
)paren
op_or
id|agcdelay
)paren
suffix:semicolon
singleline_comment|// htotal
id|tmp64
op_assign
id|norm_htotal
c_func
(paren
id|norm
)paren
op_star
(paren
id|u64
)paren
id|vdec_clock
suffix:semicolon
id|do_div
c_func
(paren
id|tmp64
comma
id|fsc8
)paren
suffix:semicolon
id|htotal
op_assign
(paren
id|u32
)paren
id|tmp64
op_or
(paren
id|norm_notchfilter
c_func
(paren
id|norm
)paren
op_lshift
l_int|11
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;set_tvnorm: MO_HTOTAL        0x%08x [old=0x%08x,htotal=%d]&bslash;n&quot;
comma
id|htotal
comma
id|cx_read
c_func
(paren
id|MO_HTOTAL
)paren
comma
(paren
id|u32
)paren
id|tmp64
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_HTOTAL
comma
id|htotal
)paren
suffix:semicolon
singleline_comment|// vbi stuff
id|cx_write
c_func
(paren
id|MO_VBI_PACKET
comma
(paren
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
multiline_comment|/* (norm_vdelay(norm)   &lt;&lt; 11) | */
id|norm_vbipack
c_func
(paren
id|norm
)paren
)paren
)paren
suffix:semicolon
singleline_comment|// audio
id|set_tvaudio
c_func
(paren
id|core
)paren
suffix:semicolon
singleline_comment|// tell i2c chips
macro_line|#ifdef V4L2_I2C_CLIENTS
id|cx88_call_i2c_clients
c_func
(paren
id|core
comma
id|VIDIOC_S_STD
comma
op_amp
id|norm-&gt;id
)paren
suffix:semicolon
macro_line|#else
(brace
r_struct
id|video_channel
id|c
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|c
comma
l_int|0
comma
r_sizeof
(paren
id|c
)paren
)paren
suffix:semicolon
id|c.channel
op_assign
id|core-&gt;input
suffix:semicolon
id|c.norm
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|norm-&gt;id
op_amp
(paren
id|V4L2_STD_NTSC_M
op_or
id|V4L2_STD_NTSC_M_JP
)paren
)paren
)paren
id|c.norm
op_assign
id|VIDEO_MODE_NTSC
suffix:semicolon
r_if
c_cond
(paren
id|norm-&gt;id
op_amp
id|V4L2_STD_SECAM
)paren
id|c.norm
op_assign
id|VIDEO_MODE_SECAM
suffix:semicolon
id|cx88_call_i2c_clients
c_func
(paren
id|core
comma
id|VIDIOCSCHAN
comma
op_amp
id|c
)paren
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|// done
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|cx88_pci_quirks
r_static
r_int
id|cx88_pci_quirks
c_func
(paren
r_char
op_star
id|name
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_int
r_int
id|lat
op_assign
id|UNSET
suffix:semicolon
id|u8
id|ctrl
op_assign
l_int|0
suffix:semicolon
id|u8
id|value
suffix:semicolon
multiline_comment|/* check pci quirks */
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_TRITON
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_TRITON -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_NATOMA
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_NATOMA -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_VIAETBF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_VIAETBF -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_VSFX
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_VSFX -- set VSFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_VSFX
suffix:semicolon
)brace
macro_line|#ifdef PCIPCI_ALIMAGIK
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_ALIMAGIK
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_ALIMAGIK -- latency fixup&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|lat
op_assign
l_int|0x0A
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* check insmod options */
r_if
c_cond
(paren
id|UNSET
op_ne
id|latency
)paren
id|lat
op_assign
id|latency
suffix:semicolon
multiline_comment|/* apply stuff */
r_if
c_cond
(paren
id|ctrl
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|CX88X_DEVCTRL
comma
op_amp
id|value
)paren
suffix:semicolon
id|value
op_or_assign
id|ctrl
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
id|CX88X_DEVCTRL
comma
id|value
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UNSET
op_ne
id|lat
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: setting pci latency timer to %d&bslash;n&quot;
comma
id|name
comma
id|latency
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
id|PCI_LATENCY_TIMER
comma
id|latency
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|cx88_vdev_init
r_struct
id|video_device
op_star
id|cx88_vdev_init
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|video_device
op_star
r_template
comma
r_char
op_star
id|type
)paren
(brace
r_struct
id|video_device
op_star
id|vfd
suffix:semicolon
id|vfd
op_assign
id|video_device_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|vfd
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|vfd
op_assign
op_star
r_template
suffix:semicolon
id|vfd-&gt;minor
op_assign
op_minus
l_int|1
suffix:semicolon
id|vfd-&gt;dev
op_assign
op_amp
id|pci-&gt;dev
suffix:semicolon
id|vfd-&gt;release
op_assign
id|video_device_release
suffix:semicolon
id|snprintf
c_func
(paren
id|vfd-&gt;name
comma
r_sizeof
(paren
id|vfd-&gt;name
)paren
comma
l_string|&quot;%s %s (%s)&quot;
comma
id|core-&gt;name
comma
id|type
comma
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|name
)paren
suffix:semicolon
r_return
id|vfd
suffix:semicolon
)brace
DECL|function|get_ressources
r_static
r_int
id|get_ressources
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_if
c_cond
(paren
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pci
comma
l_int|0
)paren
comma
id|core-&gt;name
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: can&squot;t get MMIO memory @ 0x%lx&bslash;n&quot;
comma
id|core-&gt;name
comma
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|cx88_core_get
r_struct
id|cx88_core
op_star
id|cx88_core_get
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
suffix:semicolon
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|cx88_devlist
)paren
(brace
id|core
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|cx88_core
comma
id|devlist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci-&gt;bus-&gt;number
op_ne
id|core-&gt;pci_bus
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|pci-&gt;devfn
)paren
op_ne
id|core-&gt;pci_slot
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|get_ressources
c_func
(paren
id|core
comma
id|pci
)paren
)paren
r_goto
id|fail_unlock
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|core-&gt;refcount
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
r_return
id|core
suffix:semicolon
)brace
id|core
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|core
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|core
)paren
r_goto
id|fail_unlock
suffix:semicolon
id|memset
c_func
(paren
id|core
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|core
)paren
)paren
suffix:semicolon
id|core-&gt;pci_bus
op_assign
id|pci-&gt;bus-&gt;number
suffix:semicolon
id|core-&gt;pci_slot
op_assign
id|PCI_SLOT
c_func
(paren
id|pci-&gt;devfn
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|core-&gt;refcount
)paren
suffix:semicolon
id|core-&gt;nr
op_assign
id|cx88_devcount
op_increment
suffix:semicolon
id|sprintf
c_func
(paren
id|core-&gt;name
comma
l_string|&quot;cx88[%d]&quot;
comma
id|core-&gt;nr
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|get_ressources
c_func
(paren
id|core
comma
id|pci
)paren
)paren
(brace
id|cx88_devcount
op_decrement
suffix:semicolon
r_goto
id|fail_free
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|core-&gt;devlist
comma
op_amp
id|cx88_devlist
)paren
suffix:semicolon
multiline_comment|/* PCI stuff */
id|cx88_pci_quirks
c_func
(paren
id|core-&gt;name
comma
id|pci
)paren
suffix:semicolon
id|core-&gt;lmmio
op_assign
id|ioremap
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pci
comma
l_int|0
)paren
)paren
suffix:semicolon
id|core-&gt;bmmio
op_assign
(paren
id|u8
id|__iomem
op_star
)paren
id|core-&gt;lmmio
suffix:semicolon
multiline_comment|/* board config */
id|core-&gt;board
op_assign
id|UNSET
suffix:semicolon
r_if
c_cond
(paren
id|card
(braket
id|core-&gt;nr
)braket
OL
id|cx88_bcount
)paren
id|core-&gt;board
op_assign
id|card
(braket
id|core-&gt;nr
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|UNSET
op_eq
id|core-&gt;board
op_logical_and
id|i
OL
id|cx88_idcount
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pci-&gt;subsystem_vendor
op_eq
id|cx88_subids
(braket
id|i
)braket
dot
id|subvendor
op_logical_and
id|pci-&gt;subsystem_device
op_eq
id|cx88_subids
(braket
id|i
)braket
dot
id|subdevice
)paren
id|core-&gt;board
op_assign
id|cx88_subids
(braket
id|i
)braket
dot
id|card
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_eq
id|core-&gt;board
)paren
(brace
id|core-&gt;board
op_assign
id|CX88_BOARD_UNKNOWN
suffix:semicolon
id|cx88_card_list
c_func
(paren
id|core
comma
id|pci
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: subsystem: %04x:%04x, board: %s [card=%d,%s]&bslash;n&quot;
comma
id|core-&gt;name
comma
id|pci-&gt;subsystem_vendor
comma
id|pci-&gt;subsystem_device
comma
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|name
comma
id|core-&gt;board
comma
id|card
(braket
id|core-&gt;nr
)braket
op_eq
id|core-&gt;board
ques
c_cond
l_string|&quot;insmod option&quot;
suffix:colon
l_string|&quot;autodetected&quot;
)paren
suffix:semicolon
id|core-&gt;tuner_type
op_assign
id|tuner
(braket
id|core-&gt;nr
)braket
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_eq
id|core-&gt;tuner_type
)paren
id|core-&gt;tuner_type
op_assign
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|tuner_type
suffix:semicolon
id|core-&gt;tda9887_conf
op_assign
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|tda9887_conf
suffix:semicolon
multiline_comment|/* init hardware */
id|cx88_reset
c_func
(paren
id|core
)paren
suffix:semicolon
id|cx88_i2c_init
c_func
(paren
id|core
comma
id|pci
)paren
suffix:semicolon
id|cx88_card_setup
c_func
(paren
id|core
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
r_return
id|core
suffix:semicolon
id|fail_free
suffix:colon
id|kfree
c_func
(paren
id|core
)paren
suffix:semicolon
id|fail_unlock
suffix:colon
id|up
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|cx88_core_put
r_void
id|cx88_core_put
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pci
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_test
c_func
(paren
op_amp
id|core-&gt;refcount
)paren
)paren
r_return
suffix:semicolon
id|down
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|core-&gt;i2c_rc
)paren
id|i2c_bit_del_bus
c_func
(paren
op_amp
id|core-&gt;i2c_adap
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|core-&gt;devlist
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|core-&gt;lmmio
)paren
suffix:semicolon
id|cx88_devcount
op_decrement
suffix:semicolon
id|up
c_func
(paren
op_amp
id|devlist
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|core
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|variable|cx88_print_ioctl
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_print_ioctl
)paren
suffix:semicolon
DECL|variable|cx88_pci_irqs
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_pci_irqs
)paren
suffix:semicolon
DECL|variable|cx88_vid_irqs
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_vid_irqs
)paren
suffix:semicolon
DECL|variable|cx88_mpeg_irqs
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_mpeg_irqs
)paren
suffix:semicolon
DECL|variable|cx88_print_irqbits
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_print_irqbits
)paren
suffix:semicolon
DECL|variable|cx88_irq
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_irq
)paren
suffix:semicolon
DECL|variable|cx88_wakeup
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_wakeup
)paren
suffix:semicolon
DECL|variable|cx88_reset
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_reset
)paren
suffix:semicolon
DECL|variable|cx88_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_shutdown
)paren
suffix:semicolon
DECL|variable|cx88_risc_buffer
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_buffer
)paren
suffix:semicolon
DECL|variable|cx88_risc_databuffer
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_databuffer
)paren
suffix:semicolon
DECL|variable|cx88_risc_stopper
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_stopper
)paren
suffix:semicolon
DECL|variable|cx88_free_buffer
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_free_buffer
)paren
suffix:semicolon
DECL|variable|cx88_risc_disasm
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_disasm
)paren
suffix:semicolon
DECL|variable|cx88_sram_channels
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channels
)paren
suffix:semicolon
DECL|variable|cx88_sram_channel_setup
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channel_setup
)paren
suffix:semicolon
DECL|variable|cx88_sram_channel_dump
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channel_dump
)paren
suffix:semicolon
DECL|variable|cx88_set_tvnorm
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_set_tvnorm
)paren
suffix:semicolon
DECL|variable|cx88_set_scale
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_set_scale
)paren
suffix:semicolon
DECL|variable|cx88_vdev_init
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_vdev_init
)paren
suffix:semicolon
DECL|variable|cx88_core_get
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_core_get
)paren
suffix:semicolon
DECL|variable|cx88_core_put
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_core_put
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
