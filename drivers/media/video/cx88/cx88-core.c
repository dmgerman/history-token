multiline_comment|/*&n; * device driver for Conexant 2388x based TV cards&n; * driver core&n; *&n; * (c) 2003 Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &quot;cx88.h&quot;
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;v4l2 driver module for cx2388x based TV cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
macro_line|#if 0
r_static
r_int
r_int
id|gpio_tracking
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|gpio_tracking
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|gpio_tracking
comma
l_string|&quot;enable debug messages [gpio]&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|ts_nr
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|ts_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ts_nr
comma
l_string|&quot;ts device number&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|vbi_nr
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vbi_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|vbi_nr
comma
l_string|&quot;vbi device number&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|radio_nr
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|radio_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|radio_nr
comma
l_string|&quot;radio device number&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|oss
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|oss
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|oss
comma
l_string|&quot;register oss devices (default: no)&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|dsp_nr
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dsp_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dsp_nr
comma
l_string|&quot;oss dsp device number&quot;
)paren
suffix:semicolon
r_static
r_int
r_int
id|mixer_nr
op_assign
op_minus
l_int|1
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|mixer_nr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mixer_nr
comma
l_string|&quot;oss mixer device number&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|core_debug
r_static
r_int
r_int
id|core_debug
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|core_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|core_debug
comma
l_string|&quot;enable debug messages [core]&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(fmt, arg...)&t;if (core_debug) &bslash;&n;&t;printk(KERN_DEBUG &quot;%s/core: &quot; fmt, dev-&gt;name , ## arg)
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* debug help functions                                               */
DECL|variable|v4l1_ioctls
r_static
r_const
r_char
op_star
id|v4l1_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;0&quot;
comma
l_string|&quot;CGAP&quot;
comma
l_string|&quot;GCHAN&quot;
comma
l_string|&quot;SCHAN&quot;
comma
l_string|&quot;GTUNER&quot;
comma
l_string|&quot;STUNER&quot;
comma
l_string|&quot;GPICT&quot;
comma
l_string|&quot;SPICT&quot;
comma
l_string|&quot;CCAPTURE&quot;
comma
l_string|&quot;GWIN&quot;
comma
l_string|&quot;SWIN&quot;
comma
l_string|&quot;GFBUF&quot;
comma
l_string|&quot;SFBUF&quot;
comma
l_string|&quot;KEY&quot;
comma
l_string|&quot;GFREQ&quot;
comma
l_string|&quot;SFREQ&quot;
comma
l_string|&quot;GAUDIO&quot;
comma
l_string|&quot;SAUDIO&quot;
comma
l_string|&quot;SYNC&quot;
comma
l_string|&quot;MCAPTURE&quot;
comma
l_string|&quot;GMBUF&quot;
comma
l_string|&quot;GUNIT&quot;
comma
l_string|&quot;GCAPTURE&quot;
comma
l_string|&quot;SCAPTURE&quot;
comma
l_string|&quot;SPLAYMODE&quot;
comma
l_string|&quot;SWRITEMODE&quot;
comma
l_string|&quot;GPLAYINFO&quot;
comma
l_string|&quot;SMICROCODE&quot;
comma
l_string|&quot;GVBIFMT&quot;
comma
l_string|&quot;SVBIFMT&quot;
)brace
suffix:semicolon
DECL|macro|V4L1_IOCTLS
mdefine_line|#define V4L1_IOCTLS ARRAY_SIZE(v4l1_ioctls)
DECL|variable|v4l2_ioctls
r_static
r_const
r_char
op_star
id|v4l2_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;QUERYCAP&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;ENUM_PIXFMT&quot;
comma
l_string|&quot;ENUM_FBUFFMT&quot;
comma
l_string|&quot;G_FMT&quot;
comma
l_string|&quot;S_FMT&quot;
comma
l_string|&quot;G_COMP&quot;
comma
l_string|&quot;S_COMP&quot;
comma
l_string|&quot;REQBUFS&quot;
comma
l_string|&quot;QUERYBUF&quot;
comma
l_string|&quot;G_FBUF&quot;
comma
l_string|&quot;S_FBUF&quot;
comma
l_string|&quot;G_WIN&quot;
comma
l_string|&quot;S_WIN&quot;
comma
l_string|&quot;PREVIEW&quot;
comma
l_string|&quot;QBUF&quot;
comma
l_string|&quot;16&quot;
comma
l_string|&quot;DQBUF&quot;
comma
l_string|&quot;STREAMON&quot;
comma
l_string|&quot;STREAMOFF&quot;
comma
l_string|&quot;G_PERF&quot;
comma
l_string|&quot;G_PARM&quot;
comma
l_string|&quot;S_PARM&quot;
comma
l_string|&quot;G_STD&quot;
comma
l_string|&quot;S_STD&quot;
comma
l_string|&quot;ENUMSTD&quot;
comma
l_string|&quot;ENUMINPUT&quot;
comma
l_string|&quot;G_CTRL&quot;
comma
l_string|&quot;S_CTRL&quot;
comma
l_string|&quot;G_TUNER&quot;
comma
l_string|&quot;S_TUNER&quot;
comma
l_string|&quot;G_FREQ&quot;
comma
l_string|&quot;S_FREQ&quot;
comma
l_string|&quot;G_AUDIO&quot;
comma
l_string|&quot;S_AUDIO&quot;
comma
l_string|&quot;35&quot;
comma
l_string|&quot;QUERYCTRL&quot;
comma
l_string|&quot;QUERYMENU&quot;
comma
l_string|&quot;G_INPUT&quot;
comma
l_string|&quot;S_INPUT&quot;
comma
l_string|&quot;ENUMCVT&quot;
comma
l_string|&quot;41&quot;
comma
l_string|&quot;42&quot;
comma
l_string|&quot;43&quot;
comma
l_string|&quot;44&quot;
comma
l_string|&quot;45&quot;
comma
l_string|&quot;G_OUTPUT&quot;
comma
l_string|&quot;S_OUTPUT&quot;
comma
l_string|&quot;ENUMOUTPUT&quot;
comma
l_string|&quot;G_AUDOUT&quot;
comma
l_string|&quot;S_AUDOUT&quot;
comma
l_string|&quot;ENUMFX&quot;
comma
l_string|&quot;G_EFFECT&quot;
comma
l_string|&quot;S_EFFECT&quot;
comma
l_string|&quot;G_MODULATOR&quot;
comma
l_string|&quot;S_MODULATOR&quot;
)brace
suffix:semicolon
DECL|macro|V4L2_IOCTLS
mdefine_line|#define V4L2_IOCTLS ARRAY_SIZE(v4l2_ioctls)
DECL|variable|osspcm_ioctls
r_static
r_const
r_char
op_star
id|osspcm_ioctls
(braket
)braket
op_assign
(brace
l_string|&quot;RESET&quot;
comma
l_string|&quot;SYNC&quot;
comma
l_string|&quot;SPEED&quot;
comma
l_string|&quot;STEREO&quot;
comma
l_string|&quot;GETBLKSIZE&quot;
comma
l_string|&quot;SETFMT&quot;
comma
l_string|&quot;CHANNELS&quot;
comma
l_string|&quot;?&quot;
comma
l_string|&quot;POST&quot;
comma
l_string|&quot;SUBDIVIDE&quot;
comma
l_string|&quot;SETFRAGMENT&quot;
comma
l_string|&quot;GETFMTS&quot;
comma
l_string|&quot;GETOSPACE&quot;
comma
l_string|&quot;GETISPACE&quot;
comma
l_string|&quot;NONBLOCK&quot;
comma
l_string|&quot;GETCAPS&quot;
comma
l_string|&quot;GET/SETTRIGGER&quot;
comma
l_string|&quot;GETIPTR&quot;
comma
l_string|&quot;GETOPTR&quot;
comma
l_string|&quot;MAPINBUF&quot;
comma
l_string|&quot;MAPOUTBUF&quot;
comma
l_string|&quot;SETSYNCRO&quot;
comma
l_string|&quot;SETDUPLEX&quot;
comma
l_string|&quot;GETODELAY&quot;
)brace
suffix:semicolon
DECL|macro|OSSPCM_IOCTLS
mdefine_line|#define OSSPCM_IOCTLS ARRAY_SIZE(v4l2_ioctls)
DECL|function|cx88_print_ioctl
r_void
id|cx88_print_ioctl
c_func
(paren
r_char
op_star
id|name
comma
r_int
r_int
id|cmd
)paren
(brace
r_char
op_star
id|dir
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_DIR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|_IOC_NONE
suffix:colon
id|dir
op_assign
l_string|&quot;--&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_READ
suffix:colon
id|dir
op_assign
l_string|&quot;r-&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_WRITE
suffix:colon
id|dir
op_assign
l_string|&quot;-w&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_IOC_READ
op_or
id|_IOC_WRITE
suffix:colon
id|dir
op_assign
l_string|&quot;rw&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dir
op_assign
l_string|&quot;??&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
l_char|&squot;v&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (v4l1, %s, VIDIOC%s)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
OL
id|V4L1_IOCTLS
)paren
ques
c_cond
id|v4l1_ioctls
(braket
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;V&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (v4l2, %s, VIDIOC_%s)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
OL
id|V4L2_IOCTLS
)paren
ques
c_cond
id|v4l2_ioctls
(braket
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;P&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (oss dsp, %s, SNDCTL_DSP_%s)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
OL
id|OSSPCM_IOCTLS
)paren
ques
c_cond
id|osspcm_ioctls
(braket
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (oss mixer, %s, #%d)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: ioctl 0x%08x (???, %s, #%d)&bslash;n&quot;
comma
id|name
comma
id|cmd
comma
id|dir
comma
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|cx88_risc_field
r_static
id|u32
op_star
id|cx88_risc_field
c_func
(paren
id|u32
op_star
id|rp
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
r_int
id|offset
comma
id|u32
id|sync_line
comma
r_int
r_int
id|bpl
comma
r_int
r_int
id|padding
comma
r_int
r_int
id|lines
)paren
(brace
r_struct
id|scatterlist
op_star
id|sg
suffix:semicolon
r_int
r_int
id|line
comma
id|todo
suffix:semicolon
multiline_comment|/* sync instruction */
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_RESYNC
op_or
id|sync_line
)paren
suffix:semicolon
multiline_comment|/* scan lines */
id|sg
op_assign
id|sglist
suffix:semicolon
r_for
c_loop
(paren
id|line
op_assign
l_int|0
suffix:semicolon
id|line
OL
id|lines
suffix:semicolon
id|line
op_increment
)paren
(brace
r_while
c_loop
(paren
id|offset
op_logical_and
id|offset
op_ge
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
id|offset
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bpl
op_le
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
(brace
multiline_comment|/* fits into current chunk */
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_SOL
op_or
id|RISC_EOL
op_or
id|bpl
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
id|bpl
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* scanline needs to be splitted */
id|todo
op_assign
id|bpl
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_SOL
op_or
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|todo
op_sub_assign
(paren
id|sg_dma_len
c_func
(paren
id|sg
)paren
op_minus
id|offset
)paren
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|sg
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
(brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|sg_dma_len
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|todo
op_sub_assign
id|sg_dma_len
c_func
(paren
id|sg
)paren
suffix:semicolon
id|sg
op_increment
suffix:semicolon
)brace
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITE
op_or
id|RISC_EOL
op_or
id|todo
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|sg_dma_address
c_func
(paren
id|sg
)paren
)paren
suffix:semicolon
id|offset
op_add_assign
id|todo
suffix:semicolon
)brace
id|offset
op_add_assign
id|padding
suffix:semicolon
)brace
r_return
id|rp
suffix:semicolon
)brace
DECL|function|cx88_risc_buffer
r_int
id|cx88_risc_buffer
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|btcx_riscmem
op_star
id|risc
comma
r_struct
id|scatterlist
op_star
id|sglist
comma
r_int
r_int
id|top_offset
comma
r_int
r_int
id|bottom_offset
comma
r_int
r_int
id|bpl
comma
r_int
r_int
id|padding
comma
r_int
r_int
id|lines
)paren
(brace
id|u32
id|instructions
comma
id|fields
suffix:semicolon
id|u32
op_star
id|rp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|fields
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|top_offset
)paren
id|fields
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|bottom_offset
)paren
id|fields
op_increment
suffix:semicolon
multiline_comment|/* estimate risc mem: worst case is one write per page border +&n;&t;   one write per scan line + syncs + jump (all 2 dwords) */
id|instructions
op_assign
(paren
id|bpl
op_star
id|lines
op_star
id|fields
)paren
op_div
id|PAGE_SIZE
op_plus
id|lines
op_star
id|fields
suffix:semicolon
id|instructions
op_add_assign
l_int|3
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|btcx_riscmem_alloc
c_func
(paren
id|pci
comma
id|risc
comma
id|instructions
op_star
l_int|8
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* write risc instructions */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|top_offset
)paren
id|rp
op_assign
id|cx88_risc_field
c_func
(paren
id|rp
comma
id|sglist
comma
id|top_offset
comma
l_int|0
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UNSET
op_ne
id|bottom_offset
)paren
id|rp
op_assign
id|cx88_risc_field
c_func
(paren
id|rp
comma
id|sglist
comma
id|bottom_offset
comma
l_int|0x200
comma
id|bpl
comma
id|padding
comma
id|lines
)paren
suffix:semicolon
multiline_comment|/* save pointer to jmp instruction address */
id|risc-&gt;jmp
op_assign
id|rp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx88_risc_stopper
r_int
id|cx88_risc_stopper
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|btcx_riscmem
op_star
id|risc
comma
id|u32
id|reg
comma
id|u32
id|mask
comma
id|u32
id|value
)paren
(brace
id|u32
op_star
id|rp
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|btcx_riscmem_alloc
c_func
(paren
id|pci
comma
id|risc
comma
l_int|4
op_star
l_int|16
)paren
)paren
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* write risc instructions */
id|rp
op_assign
id|risc-&gt;cpu
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_WRITECR
op_or
id|RISC_IRQ2
op_or
id|RISC_IMM
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|reg
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|value
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|mask
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|RISC_JUMP
)paren
suffix:semicolon
op_star
(paren
id|rp
op_increment
)paren
op_assign
id|cpu_to_le32
c_func
(paren
id|risc-&gt;dma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cx88_free_buffer
id|cx88_free_buffer
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|cx88_buffer
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|videobuf_waiton
c_func
(paren
op_amp
id|buf-&gt;vb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|videobuf_dma_pci_unmap
c_func
(paren
id|pci
comma
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|videobuf_dma_free
c_func
(paren
op_amp
id|buf-&gt;vb.dma
)paren
suffix:semicolon
id|btcx_riscmem_free
c_func
(paren
id|pci
comma
op_amp
id|buf-&gt;risc
)paren
suffix:semicolon
id|buf-&gt;vb.state
op_assign
id|STATE_NEEDS_INIT
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* our SRAM memory layout                                             */
multiline_comment|/* we are going to put all thr risc programs into host memory, so we&n; * can use the whole SDRAM for the DMA fifos.  To simplify things, we&n; * use a static memory layout.  That surely will waste memory in case&n; * we don&squot;t use all DMA channels at the same time (which will be the&n; * case most of the time).  But that still gives us enougth FIFO space&n; * to be able to deal with insane long pci latencies ...&n; *&n; * FIFO space allocations:&n; *    channel  21    (y video)  - 10.0k&n; *    channel  24    (vbi)      -  4.0k&n; *    channels 25+26 (audio)    -  0.5k&n; *    everything else           -  2.0k&n; *    TOTAL                     = 29.0k&n; *&n; * Every channel has 160 bytes control data (64 bytes instruction&n; * queue and 6 CDT entries), which is close to 2k total.&n; * &n; * Address layout:&n; *    0x0000 - 0x03ff    CMDs / reserved&n; *    0x0400 - 0x0bff    instruction queues + CDs&n; *    0x0c00 -           FIFOs&n; */
DECL|variable|cx88_sram_channels
r_struct
id|sram_channel
id|cx88_sram_channels
(braket
)braket
op_assign
(brace
(braket
id|SRAM_CH21
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video y / packed&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180040
comma
dot
id|ctrl_start
op_assign
l_int|0x180400
comma
dot
id|fifo_start
op_assign
l_int|0x180c00
comma
dot
id|fifo_size
op_assign
l_int|0x002800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA21_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA21_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA21_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA21_CNT2
comma
)brace
comma
(braket
id|SRAM_CH22
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video u&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180080
comma
dot
id|ctrl_start
op_assign
l_int|0x1804a0
comma
dot
id|fifo_start
op_assign
l_int|0x183400
comma
dot
id|fifo_size
op_assign
l_int|0x000800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA22_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA22_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA22_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA22_CNT2
comma
)brace
comma
(braket
id|SRAM_CH23
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;video v&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x1800c0
comma
dot
id|ctrl_start
op_assign
l_int|0x180540
comma
dot
id|fifo_start
op_assign
l_int|0x183c00
comma
dot
id|fifo_size
op_assign
l_int|0x000800
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA23_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA23_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA23_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA23_CNT2
comma
)brace
comma
(braket
id|SRAM_CH24
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;vbi&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180100
comma
dot
id|ctrl_start
op_assign
l_int|0x1805e0
comma
dot
id|fifo_start
op_assign
l_int|0x184400
comma
dot
id|fifo_size
op_assign
l_int|0x001000
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA24_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA24_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA24_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA24_CNT2
comma
)brace
comma
(braket
id|SRAM_CH25
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;audio from&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180140
comma
dot
id|ctrl_start
op_assign
l_int|0x180680
comma
dot
id|fifo_start
op_assign
l_int|0x185400
comma
dot
id|fifo_size
op_assign
l_int|0x000200
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA25_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA25_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA25_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA25_CNT2
comma
)brace
comma
(braket
id|SRAM_CH26
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;audio to&quot;
comma
dot
id|cmds_start
op_assign
l_int|0x180180
comma
dot
id|ctrl_start
op_assign
l_int|0x180720
comma
dot
id|fifo_start
op_assign
l_int|0x185600
comma
dot
id|fifo_size
op_assign
l_int|0x000200
comma
dot
id|ptr1_reg
op_assign
id|MO_DMA26_PTR1
comma
dot
id|ptr2_reg
op_assign
id|MO_DMA26_PTR2
comma
dot
id|cnt1_reg
op_assign
id|MO_DMA26_CNT1
comma
dot
id|cnt2_reg
op_assign
id|MO_DMA26_CNT2
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|cx88_sram_channel_setup
r_int
id|cx88_sram_channel_setup
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_struct
id|sram_channel
op_star
id|ch
comma
r_int
r_int
id|bpl
comma
id|u32
id|risc
)paren
(brace
r_int
r_int
id|i
comma
id|lines
suffix:semicolon
id|u32
id|cdt
suffix:semicolon
id|bpl
op_assign
(paren
id|bpl
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
suffix:semicolon
multiline_comment|/* alignment */
id|cdt
op_assign
id|ch-&gt;ctrl_start
op_plus
l_int|64
suffix:semicolon
id|lines
op_assign
id|ch-&gt;fifo_size
op_div
id|bpl
suffix:semicolon
r_if
c_cond
(paren
id|lines
OG
l_int|6
)paren
id|lines
op_assign
l_int|6
suffix:semicolon
id|BUG_ON
c_func
(paren
id|lines
OL
l_int|2
)paren
suffix:semicolon
multiline_comment|/* write CDT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|lines
suffix:semicolon
id|i
op_increment
)paren
id|cx_write
c_func
(paren
id|cdt
op_plus
l_int|16
op_star
id|i
comma
id|ch-&gt;fifo_start
op_plus
id|bpl
op_star
id|i
)paren
suffix:semicolon
multiline_comment|/* write CMDS */
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|0
comma
id|risc
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
comma
id|cdt
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|8
comma
(paren
id|lines
op_star
l_int|16
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|12
comma
id|ch-&gt;ctrl_start
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|16
comma
l_int|64
op_rshift
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|20
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|cx_write
c_func
(paren
id|ch-&gt;cmds_start
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* fill registers */
id|cx_write
c_func
(paren
id|ch-&gt;ptr1_reg
comma
id|ch-&gt;fifo_start
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;ptr2_reg
comma
id|cdt
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cnt1_reg
comma
id|bpl
op_rshift
l_int|3
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|ch-&gt;cnt2_reg
comma
(paren
id|lines
op_star
l_int|16
)paren
op_rshift
l_int|3
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;sram setup %s: bpl=%d lines=%d&bslash;n&quot;
comma
id|ch-&gt;name
comma
id|bpl
comma
id|lines
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* debug helper code                                                  */
DECL|function|cx88_risc_decode
r_int
id|cx88_risc_decode
c_func
(paren
id|u32
id|risc
)paren
(brace
r_static
r_char
op_star
id|instr
(braket
l_int|16
)braket
op_assign
(brace
(braket
id|RISC_SYNC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;sync&quot;
comma
(braket
id|RISC_WRITE
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;write&quot;
comma
(braket
id|RISC_WRITEC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writec&quot;
comma
(braket
id|RISC_READ
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;read&quot;
comma
(braket
id|RISC_READC
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;readc&quot;
comma
(braket
id|RISC_JUMP
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;jump&quot;
comma
(braket
id|RISC_SKIP
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;skip&quot;
comma
(braket
id|RISC_WRITERM
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writerm&quot;
comma
(braket
id|RISC_WRITECM
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writecm&quot;
comma
(braket
id|RISC_WRITECR
op_rshift
l_int|28
)braket
op_assign
l_string|&quot;writecr&quot;
comma
)brace
suffix:semicolon
r_static
r_int
id|incr
(braket
l_int|16
)braket
op_assign
(brace
(braket
id|RISC_WRITE
op_rshift
l_int|28
)braket
op_assign
l_int|2
comma
(braket
id|RISC_JUMP
op_rshift
l_int|28
)braket
op_assign
l_int|2
comma
(braket
id|RISC_WRITERM
op_rshift
l_int|28
)braket
op_assign
l_int|3
comma
(braket
id|RISC_WRITECM
op_rshift
l_int|28
)braket
op_assign
l_int|3
comma
(braket
id|RISC_WRITECR
op_rshift
l_int|28
)braket
op_assign
l_int|4
comma
)brace
suffix:semicolon
r_static
r_char
op_star
id|bits
(braket
)braket
op_assign
(brace
l_string|&quot;12&quot;
comma
l_string|&quot;13&quot;
comma
l_string|&quot;14&quot;
comma
l_string|&quot;resync&quot;
comma
l_string|&quot;cnt0&quot;
comma
l_string|&quot;cnt1&quot;
comma
l_string|&quot;18&quot;
comma
l_string|&quot;19&quot;
comma
l_string|&quot;20&quot;
comma
l_string|&quot;21&quot;
comma
l_string|&quot;22&quot;
comma
l_string|&quot;23&quot;
comma
l_string|&quot;irq1&quot;
comma
l_string|&quot;irq2&quot;
comma
l_string|&quot;eol&quot;
comma
l_string|&quot;sol&quot;
comma
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;0x%08x [ %s&quot;
comma
id|risc
comma
id|instr
(braket
id|risc
op_rshift
l_int|28
)braket
ques
c_cond
id|instr
(braket
id|risc
op_rshift
l_int|28
)braket
suffix:colon
l_string|&quot;INVALID&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ARRAY_SIZE
c_func
(paren
id|bits
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|risc
op_amp
(paren
l_int|1
op_lshift
(paren
id|i
op_plus
l_int|12
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot; %s&quot;
comma
id|bits
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; count=%d ]&bslash;n&quot;
comma
id|risc
op_amp
l_int|0xfff
)paren
suffix:semicolon
r_return
id|incr
(braket
id|risc
op_rshift
l_int|28
)braket
ques
c_cond
l_int|1
suffix:colon
id|incr
(braket
id|risc
op_rshift
l_int|28
)braket
suffix:semicolon
)brace
DECL|function|cx88_risc_disasm
r_void
id|cx88_risc_disasm
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_struct
id|btcx_riscmem
op_star
id|risc
)paren
(brace
r_int
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: risc disasm: %p [dma=0x%08lx]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|risc-&gt;cpu
comma
(paren
r_int
r_int
)paren
id|risc-&gt;dma
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|risc-&gt;size
op_rshift
l_int|2
)paren
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:   %04d: &quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
id|n
op_assign
id|cx88_risc_decode
c_func
(paren
id|risc-&gt;cpu
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s:   %04d: 0x%08x [ arg #%d ]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
op_plus
id|j
comma
id|risc-&gt;cpu
(braket
id|i
op_plus
id|j
)braket
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|risc-&gt;cpu
(braket
id|i
)braket
op_eq
id|RISC_JUMP
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|cx88_sram_channel_dump
r_void
id|cx88_sram_channel_dump
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_struct
id|sram_channel
op_star
id|ch
)paren
(brace
r_static
r_char
op_star
id|name
(braket
)braket
op_assign
(brace
l_string|&quot;initial risc&quot;
comma
l_string|&quot;cdt base&quot;
comma
l_string|&quot;cdt size&quot;
comma
l_string|&quot;iq base&quot;
comma
l_string|&quot;iq size&quot;
comma
l_string|&quot;risc pc&quot;
comma
l_string|&quot;iq wr ptr&quot;
comma
l_string|&quot;iq rd ptr&quot;
comma
l_string|&quot;cdt current&quot;
comma
l_string|&quot;pci target&quot;
comma
l_string|&quot;line / byte&quot;
comma
)brace
suffix:semicolon
id|u32
id|risc
suffix:semicolon
r_int
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %s - dma channel status dump&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ch-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|name
)paren
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot;%s:   cmds: %-12s: 0x%08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|name
(braket
id|i
)braket
comma
id|cx_read
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
op_star
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;cmds_start
op_plus
l_int|4
op_star
(paren
id|i
op_plus
l_int|11
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   risc%d: &quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
id|cx88_risc_decode
c_func
(paren
id|risc
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_add_assign
id|n
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;ctrl_start
op_plus
l_int|4
op_star
id|i
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   iq %x: &quot;
comma
id|dev-&gt;name
comma
id|i
)paren
suffix:semicolon
id|n
op_assign
id|cx88_risc_decode
c_func
(paren
id|risc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|1
suffix:semicolon
id|j
OL
id|n
suffix:semicolon
id|j
op_increment
)paren
(brace
id|risc
op_assign
id|cx_read
c_func
(paren
id|ch-&gt;ctrl_start
op_plus
l_int|4
op_star
(paren
id|i
op_plus
id|j
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   iq %x: 0x%08x [ arg #%d ]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i
op_plus
id|j
comma
id|risc
comma
id|j
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%s: fifo: 0x%08x -&gt; 0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ch-&gt;fifo_start
comma
id|ch-&gt;fifo_start
op_plus
id|ch-&gt;fifo_size
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ctrl: 0x%08x -&gt; 0x%x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ch-&gt;ctrl_start
comma
id|ch-&gt;ctrl_start
op_plus
l_int|6
op_star
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   ptr1_reg: 0x%08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;ptr1_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   ptr2_reg: 0x%08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;ptr2_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   cnt1_reg: 0x%08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;cnt1_reg
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s:   cnt2_reg: 0x%08x&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|cx_read
c_func
(paren
id|ch-&gt;cnt2_reg
)paren
)paren
suffix:semicolon
)brace
DECL|variable|cx88_pci_irqs
r_char
op_star
id|cx88_pci_irqs
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;vid&quot;
comma
l_string|&quot;aud&quot;
comma
l_string|&quot;ts&quot;
comma
l_string|&quot;vip&quot;
comma
l_string|&quot;hst&quot;
comma
l_string|&quot;5&quot;
comma
l_string|&quot;6&quot;
comma
l_string|&quot;tm1&quot;
comma
l_string|&quot;src_dma&quot;
comma
l_string|&quot;dst_dma&quot;
comma
l_string|&quot;risc_rd_err&quot;
comma
l_string|&quot;risc_wr_err&quot;
comma
l_string|&quot;brdg_err&quot;
comma
l_string|&quot;src_dma_err&quot;
comma
l_string|&quot;dst_dma_err&quot;
comma
l_string|&quot;ipb_dma_err&quot;
comma
l_string|&quot;i2c&quot;
comma
l_string|&quot;i2c_rack&quot;
comma
l_string|&quot;ir_smp&quot;
comma
l_string|&quot;gpio0&quot;
comma
l_string|&quot;gpio1&quot;
)brace
suffix:semicolon
DECL|variable|cx88_vid_irqs
r_char
op_star
id|cx88_vid_irqs
(braket
l_int|32
)braket
op_assign
(brace
l_string|&quot;y_risci1&quot;
comma
l_string|&quot;u_risci1&quot;
comma
l_string|&quot;v_risci1&quot;
comma
l_string|&quot;vbi_risc1&quot;
comma
l_string|&quot;y_risci2&quot;
comma
l_string|&quot;u_risci2&quot;
comma
l_string|&quot;v_risci2&quot;
comma
l_string|&quot;vbi_risc2&quot;
comma
l_string|&quot;y_oflow&quot;
comma
l_string|&quot;u_oflow&quot;
comma
l_string|&quot;v_oflow&quot;
comma
l_string|&quot;vbi_oflow&quot;
comma
l_string|&quot;y_sync&quot;
comma
l_string|&quot;u_sync&quot;
comma
l_string|&quot;v_sync&quot;
comma
l_string|&quot;vbi_sync&quot;
comma
l_string|&quot;opc_err&quot;
comma
l_string|&quot;par_err&quot;
comma
l_string|&quot;rip_err&quot;
comma
l_string|&quot;pci_abort&quot;
comma
)brace
suffix:semicolon
DECL|function|cx88_print_irqbits
r_void
id|cx88_print_irqbits
c_func
(paren
r_char
op_star
id|name
comma
r_char
op_star
id|tag
comma
r_char
op_star
op_star
id|strings
comma
id|u32
id|bits
comma
id|u32
id|mask
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s [0x%x]&quot;
comma
id|name
comma
id|tag
comma
id|bits
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bits
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %s&quot;
comma
id|strings
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;*&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|cx88_pci_quirks
r_int
id|cx88_pci_quirks
c_func
(paren
r_char
op_star
id|name
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
op_star
id|latency
)paren
(brace
id|u8
id|ctrl
op_assign
l_int|0
suffix:semicolon
id|u8
id|value
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|pci_pci_problems
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_TRITON
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_TRITON -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_NATOMA
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_NATOMA -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_VIAETBF
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_VIAETBF -- set TBFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_TBFX
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_VSFX
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_VSFX -- set VSFX&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|ctrl
op_or_assign
id|CX88X_EN_VSFX
suffix:semicolon
)brace
macro_line|#ifdef PCIPCI_ALIMAGIK
r_if
c_cond
(paren
id|pci_pci_problems
op_amp
id|PCIPCI_ALIMAGIK
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: quirk: PCIPCI_ALIMAGIK -- latency fixup&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
op_star
id|latency
op_assign
l_int|0x0A
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ctrl
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|CX88X_DEVCTRL
comma
op_amp
id|value
)paren
suffix:semicolon
id|value
op_or_assign
id|ctrl
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
id|CX88X_DEVCTRL
comma
id|value
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|variable|cx88_print_ioctl
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_print_ioctl
)paren
suffix:semicolon
DECL|variable|cx88_pci_irqs
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_pci_irqs
)paren
suffix:semicolon
DECL|variable|cx88_vid_irqs
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_vid_irqs
)paren
suffix:semicolon
DECL|variable|cx88_print_irqbits
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_print_irqbits
)paren
suffix:semicolon
DECL|variable|cx88_risc_buffer
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_buffer
)paren
suffix:semicolon
DECL|variable|cx88_risc_stopper
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_stopper
)paren
suffix:semicolon
DECL|variable|cx88_free_buffer
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_free_buffer
)paren
suffix:semicolon
DECL|variable|cx88_risc_disasm
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_risc_disasm
)paren
suffix:semicolon
DECL|variable|cx88_sram_channels
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channels
)paren
suffix:semicolon
DECL|variable|cx88_sram_channel_setup
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channel_setup
)paren
suffix:semicolon
DECL|variable|cx88_sram_channel_dump
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_sram_channel_dump
)paren
suffix:semicolon
DECL|variable|cx88_pci_quirks
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_pci_quirks
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
