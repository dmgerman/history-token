multiline_comment|/*&n;    cx88x-audio.c - Conexant CX23880/23881 audio downstream driver driver&n;&n;     (c) 2001 Michael Eskin, Tom Zakrajsek [Windows version]&n;     (c) 2002 Yurij Sysoev &lt;yurij@naturesoft.net&gt;&n;     (c) 2003 Gerd Knorr &lt;kraxel@bytesex.org&gt;&n;&n;    -----------------------------------------------------------------------&n;&n;    Lot of voodoo here.  Even the data sheet doesn&squot;t help to&n;    understand what is going on here, the documentation for the audio&n;    part of the cx2388x chip is *very* bad.&n;&n;    Some of this comes from party done linux driver sources I got from&n;    [undocumented].&n;&n;    Some comes from the dscaler sources, the dscaler driver guy works&n;    for Conexant ...&n;    &n;    -----------------------------------------------------------------------&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;cx88.h&quot;
DECL|variable|audio_debug
r_static
r_int
r_int
id|audio_debug
op_assign
id|UNSET
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|audio_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|audio_debug
comma
l_string|&quot;enable debug messages [audio]&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(fmt, arg...)&t;if (audio_debug) &bslash;&n;&t;printk(KERN_DEBUG &quot;%s: &quot; fmt, dev-&gt;name , ## arg)
multiline_comment|/* ----------------------------------------------------------- */
DECL|struct|rlist
r_struct
id|rlist
(brace
DECL|member|reg
id|u32
id|reg
suffix:semicolon
DECL|member|val
id|u32
id|val
suffix:semicolon
)brace
suffix:semicolon
DECL|function|set_audio_registers
r_static
r_void
id|set_audio_registers
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_const
r_struct
id|rlist
op_star
id|l
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|l
(braket
id|i
)braket
dot
id|reg
suffix:semicolon
id|i
op_increment
)paren
id|cx_write
c_func
(paren
id|l
(braket
id|i
)braket
dot
id|reg
comma
id|l
(braket
id|i
)braket
dot
id|val
)paren
suffix:semicolon
)brace
DECL|function|set_audio_standard_BTSC
r_static
r_void
id|set_audio_standard_BTSC
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_int
r_int
id|sap
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;set_audio_standard_BTSC() [TODO]&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|set_audio_standard_NICAM
r_static
r_void
id|set_audio_standard_NICAM
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
r_static
r_const
r_struct
id|rlist
id|nicam
(braket
)braket
op_assign
(brace
singleline_comment|//  increase level of input by 12dB
(brace
id|AUD_AFE_12DB_EN
comma
l_int|0x00000001
)brace
comma
singleline_comment|// initialize NICAM                 
(brace
id|AUD_INIT
comma
l_int|0x00000010
)brace
comma
(brace
id|AUD_INIT_LD
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_SOFT_RESET
comma
l_int|0x00000001
)brace
comma
singleline_comment|// WARNING!!!! Stereo mode is FORCED!!!!
(brace
id|AUD_CTL
comma
id|EN_DAC_ENABLE
op_or
id|EN_DMTRX_LR
op_or
id|EN_NICAM_FORCE_STEREO
)brace
comma
(brace
id|AUD_SOFT_RESET
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_RATE_ADJ1
comma
l_int|0x00000010
)brace
comma
(brace
id|AUD_RATE_ADJ2
comma
l_int|0x00000040
)brace
comma
(brace
id|AUD_RATE_ADJ3
comma
l_int|0x00000100
)brace
comma
(brace
id|AUD_RATE_ADJ4
comma
l_int|0x00000400
)brace
comma
(brace
id|AUD_RATE_ADJ5
comma
l_int|0x00001000
)brace
comma
singleline_comment|//&t;&t;{ AUD_DMD_RA_DDS,          0x00c0d5ce },
(brace
multiline_comment|/* end of list */
)brace
comma
)brace
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;set_audio_standard_NICAM()&bslash;n&quot;
)paren
suffix:semicolon
id|set_audio_registers
c_func
(paren
id|dev
comma
id|nicam
)paren
suffix:semicolon
singleline_comment|// setup QAM registers
id|cx_write
c_func
(paren
l_int|0x320d01
comma
l_int|0x06
)paren
suffix:semicolon
id|cx_write
c_func
(paren
l_int|0x320d02
comma
l_int|0x82
)paren
suffix:semicolon
id|cx_write
c_func
(paren
l_int|0x320d03
comma
l_int|0x16
)paren
suffix:semicolon
id|cx_write
c_func
(paren
l_int|0x320d04
comma
l_int|0x05
)paren
suffix:semicolon
id|cx_write
c_func
(paren
l_int|0x320d2a
comma
l_int|0x34
)paren
suffix:semicolon
id|cx_write
c_func
(paren
l_int|0x320d2b
comma
l_int|0x4c
)paren
suffix:semicolon
singleline_comment|// setup Audio PLL
singleline_comment|//cx_write(AUD_PLL_PRESCALE,        0x0002);
singleline_comment|//cx_write(AUD_PLL_INT,             0x001f);
singleline_comment|// de-assert Audio soft reset
id|cx_write
c_func
(paren
id|AUD_SOFT_RESET
comma
l_int|0x00000000
)paren
suffix:semicolon
singleline_comment|// Causes a pop every time
)brace
DECL|function|set_audio_standard_A2
r_static
r_void
id|set_audio_standard_A2
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
r_static
r_const
r_struct
id|rlist
id|a2
(braket
)braket
op_assign
(brace
singleline_comment|//  increase level of input by 12dB
(brace
id|AUD_AFE_12DB_EN
comma
l_int|0x00000001
)brace
comma
singleline_comment|//  initialize A2
(brace
id|AUD_INIT
comma
l_int|0x00000004
)brace
comma
(brace
id|AUD_INIT_LD
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_SOFT_RESET
comma
l_int|0x00000001
)brace
comma
singleline_comment|// ; WARNING!!! A2 STEREO DEMATRIX HAS TO BE
singleline_comment|// ; SET MANUALLY!!!  Value sould be 0x100c
(brace
id|AUD_CTL
comma
id|EN_DAC_ENABLE
op_or
id|EN_DMTRX_SUMR
op_or
id|EN_A2_AUTO_STEREO
)brace
comma
(brace
id|AUD_DN0_FREQ
comma
l_int|0x0000312b
)brace
comma
(brace
id|AUD_POLY0_DDS_CONSTANT
comma
l_int|0x000a62b4
)brace
comma
(brace
id|AUD_IIR1_0_SEL
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR1_1_SEL
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_IIR1_2_SEL
comma
l_int|0x0000001f
)brace
comma
(brace
id|AUD_IIR1_3_SEL
comma
l_int|0x00000020
)brace
comma
(brace
id|AUD_IIR1_4_SEL
comma
l_int|0x00000023
)brace
comma
(brace
id|AUD_IIR1_5_SEL
comma
l_int|0x00000007
)brace
comma
(brace
id|AUD_IIR1_0_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR1_1_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR1_2_SHIFT
comma
l_int|0x00000007
)brace
comma
(brace
id|AUD_IIR1_3_SHIFT
comma
l_int|0x00000007
)brace
comma
(brace
id|AUD_IIR1_4_SHIFT
comma
l_int|0x00000007
)brace
comma
(brace
id|AUD_IIR1_5_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR2_0_SEL
comma
l_int|0x00000002
)brace
comma
(brace
id|AUD_IIR2_1_SEL
comma
l_int|0x00000003
)brace
comma
(brace
id|AUD_IIR2_2_SEL
comma
l_int|0x00000004
)brace
comma
(brace
id|AUD_IIR2_3_SEL
comma
l_int|0x00000005
)brace
comma
(brace
id|AUD_IIR3_0_SEL
comma
l_int|0x00000021
)brace
comma
(brace
id|AUD_IIR3_1_SEL
comma
l_int|0x00000023
)brace
comma
(brace
id|AUD_IIR3_2_SEL
comma
l_int|0x00000016
)brace
comma
(brace
id|AUD_IIR3_0_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR3_1_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR3_2_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR4_0_SEL
comma
l_int|0x0000001d
)brace
comma
(brace
id|AUD_IIR4_1_SEL
comma
l_int|0x00000019
)brace
comma
(brace
id|AUD_IIR4_2_SEL
comma
l_int|0x00000008
)brace
comma
(brace
id|AUD_IIR4_0_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR4_1_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR4_2_SHIFT
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_IIR4_0_CA0
comma
l_int|0x0003e57e
)brace
comma
(brace
id|AUD_IIR4_0_CA1
comma
l_int|0x00005e11
)brace
comma
(brace
id|AUD_IIR4_0_CA2
comma
l_int|0x0003a7cf
)brace
comma
(brace
id|AUD_IIR4_0_CB0
comma
l_int|0x00002368
)brace
comma
(brace
id|AUD_IIR4_0_CB1
comma
l_int|0x0003bf1b
)brace
comma
(brace
id|AUD_IIR4_1_CA0
comma
l_int|0x00006349
)brace
comma
(brace
id|AUD_IIR4_1_CA1
comma
l_int|0x00006f27
)brace
comma
(brace
id|AUD_IIR4_1_CA2
comma
l_int|0x0000e7a3
)brace
comma
(brace
id|AUD_IIR4_1_CB0
comma
l_int|0x00005653
)brace
comma
(brace
id|AUD_IIR4_1_CB1
comma
l_int|0x0000cf97
)brace
comma
(brace
id|AUD_IIR4_2_CA0
comma
l_int|0x00006349
)brace
comma
(brace
id|AUD_IIR4_2_CA1
comma
l_int|0x00006f27
)brace
comma
(brace
id|AUD_IIR4_2_CA2
comma
l_int|0x0000e7a3
)brace
comma
(brace
id|AUD_IIR4_2_CB0
comma
l_int|0x00005653
)brace
comma
(brace
id|AUD_IIR4_2_CB1
comma
l_int|0x0000cf97
)brace
comma
(brace
id|AUD_HP_MD_IIR4_1
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_HP_PROG_IIR4_1
comma
l_int|0x00000017
)brace
comma
(brace
id|AUD_DN1_FREQ
comma
l_int|0x00003618
)brace
comma
(brace
id|AUD_DN1_SRC_SEL
comma
l_int|0x00000017
)brace
comma
(brace
id|AUD_DN1_SHFT
comma
l_int|0x00000007
)brace
comma
(brace
id|AUD_DN1_AFC
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DN1_FREQ_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DN2_SRC_SEL
comma
l_int|0x00000040
)brace
comma
(brace
id|AUD_DN2_SHFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DN2_AFC
comma
l_int|0x00000002
)brace
comma
(brace
id|AUD_DN2_FREQ
comma
l_int|0x0000caaf
)brace
comma
(brace
id|AUD_DN2_FREQ_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_PDET_SRC
comma
l_int|0x00000014
)brace
comma
(brace
id|AUD_PDET_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH0_SRC_SEL
comma
l_int|0x00000011
)brace
comma
(brace
id|AUD_DEEMPH1_SRC_SEL
comma
l_int|0x00000013
)brace
comma
(brace
id|AUD_DEEMPH0_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH1_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH0_G0
comma
l_int|0x000004da
)brace
comma
(brace
id|AUD_DEEMPH0_A0
comma
l_int|0x0000777a
)brace
comma
(brace
id|AUD_DEEMPH0_B0
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH0_A1
comma
l_int|0x0003f062
)brace
comma
(brace
id|AUD_DEEMPH0_B1
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH1_G0
comma
l_int|0x000004da
)brace
comma
(brace
id|AUD_DEEMPH1_A0
comma
l_int|0x0000777a
)brace
comma
(brace
id|AUD_DEEMPH1_B0
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DEEMPH1_A1
comma
l_int|0x0003f062
)brace
comma
(brace
id|AUD_DEEMPH1_B1
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_PLL_EN
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DMD_RA_DDS
comma
l_int|0x002a4efb
)brace
comma
(brace
id|AUD_RATE_ADJ1
comma
l_int|0x00001000
)brace
comma
(brace
id|AUD_RATE_ADJ2
comma
l_int|0x00002000
)brace
comma
(brace
id|AUD_RATE_ADJ3
comma
l_int|0x00003000
)brace
comma
(brace
id|AUD_RATE_ADJ4
comma
l_int|0x00004000
)brace
comma
(brace
id|AUD_RATE_ADJ5
comma
l_int|0x00005000
)brace
comma
(brace
id|AUD_C2_UP_THR
comma
l_int|0x0000ffff
)brace
comma
(brace
id|AUD_C2_LO_THR
comma
l_int|0x0000e800
)brace
comma
(brace
id|AUD_C1_UP_THR
comma
l_int|0x00008c00
)brace
comma
(brace
id|AUD_C1_LO_THR
comma
l_int|0x00006c00
)brace
comma
singleline_comment|//   ; Completely ditch AFC feedback
(brace
id|AUD_DCOC_0_SRC
comma
l_int|0x00000021
)brace
comma
(brace
id|AUD_DCOC_1_SRC
comma
l_int|0x0000001a
)brace
comma
(brace
id|AUD_DCOC1_SHIFT
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DCOC_1_SHIFT_IN0
comma
l_int|0x0000000a
)brace
comma
(brace
id|AUD_DCOC_1_SHIFT_IN1
comma
l_int|0x00000008
)brace
comma
(brace
id|AUD_DCOC_PASS_IN
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_IIR4_0_SEL
comma
l_int|0x00000023
)brace
comma
singleline_comment|//  ; Completely ditc FM-2 AFC feedback
(brace
id|AUD_DN1_AFC
comma
l_int|0x00000000
)brace
comma
(brace
id|AUD_DCOC_2_SRC
comma
l_int|0x0000001b
)brace
comma
(brace
id|AUD_IIR4_1_SEL
comma
l_int|0x00000025
)brace
comma
singleline_comment|// ; WARNING!!! THIS CHANGE WAS NOT EXPECTED!!!
singleline_comment|// ; Swap I &amp; Q inputs into second rotator
singleline_comment|// ; to reverse frequency and therefor invert
singleline_comment|// ; phase from the cordic FM demodulator
singleline_comment|// ; (frequency rotation must also be reversed
(brace
id|AUD_DN2_SRC_SEL
comma
l_int|0x00000001
)brace
comma
(brace
id|AUD_DN2_FREQ
comma
l_int|0x00003551
)brace
comma
singleline_comment|//  setup Audio PLL
(brace
id|AUD_PLL_PRESCALE
comma
l_int|0x00000002
)brace
comma
(brace
id|AUD_PLL_INT
comma
l_int|0x0000001f
)brace
comma
singleline_comment|//  de-assert Audio soft reset
(brace
id|AUD_SOFT_RESET
comma
l_int|0x00000000
)brace
comma
(brace
multiline_comment|/* end of list */
)brace
comma
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;set_audio_standard_A2()&bslash;n&quot;
)paren
suffix:semicolon
id|set_audio_registers
c_func
(paren
id|dev
comma
id|a2
)paren
suffix:semicolon
)brace
DECL|function|set_audio_standard_EIAJ
r_static
r_void
id|set_audio_standard_EIAJ
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;set_audio_standard_EIAJ() [TODO]&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|set_audio_standard_FM
r_static
r_void
id|set_audio_standard_FM
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;set_audio_standard_FM&bslash;n&quot;
)paren
suffix:semicolon
singleline_comment|// initialize FM Radio
id|cx_write
c_func
(paren
id|AUD_INIT
comma
l_int|0x0020
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_INIT_LD
comma
l_int|0x0001
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_SOFT_RESET
comma
l_int|0x0001
)paren
suffix:semicolon
macro_line|#if 0 /* FIXME */
r_switch
c_cond
(paren
id|dev-&gt;audio_properties.FM_deemphasis
)paren
(brace
r_case
id|WW_FM_DEEMPH_50
suffix:colon
singleline_comment|//Set De-emphasis filter coefficients for 50 usec
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_G0
comma
l_int|0x0C45
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_A0
comma
l_int|0x6262
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_B0
comma
l_int|0x1C29
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_A1
comma
l_int|0x3FC66
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_B1
comma
l_int|0x399A
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_G0
comma
l_int|0x0D80
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_A0
comma
l_int|0x6262
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_B0
comma
l_int|0x1C29
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_A1
comma
l_int|0x3FC66
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_B1
comma
l_int|0x399A
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_FM_DEEMPH_75
suffix:colon
singleline_comment|//Set De-emphasis filter coefficients for 75 usec
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_G0
comma
l_int|0x91B
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_A0
comma
l_int|0x6B68
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_B0
comma
l_int|0x11EC
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_A1
comma
l_int|0x3FC66
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH0_B1
comma
l_int|0x399A
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_G0
comma
l_int|0xAA0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_A0
comma
l_int|0x6B68
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_B0
comma
l_int|0x11EC
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_A1
comma
l_int|0x3FC66
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_DEEMPH1_B1
comma
l_int|0x399A
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|// de-assert Audio soft reset
id|cx_write
c_func
(paren
id|AUD_SOFT_RESET
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// AB: 10/2/01: this register is not being reset appropriately on occasion.
id|cx_write
c_func
(paren
id|AUD_POLYPH80SCALEFAC
comma
l_int|3
)paren
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------- */
DECL|function|cx88_set_tvaudio
r_void
id|cx88_set_tvaudio
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
id|cx_write
c_func
(paren
id|AUD_CTL
comma
l_int|0x00
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;tvaudio
)paren
(brace
r_case
id|WW_BTSC
suffix:colon
id|set_audio_standard_BTSC
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_NICAM_I
suffix:colon
r_case
id|WW_NICAM_BGDKL
suffix:colon
id|set_audio_standard_NICAM
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_A2_BG
suffix:colon
r_case
id|WW_A2_DK
suffix:colon
r_case
id|WW_A2_M
suffix:colon
id|set_audio_standard_A2
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_EIAJ
suffix:colon
id|set_audio_standard_EIAJ
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_FM
suffix:colon
id|set_audio_standard_FM
c_func
(paren
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|WW_NONE
suffix:colon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: unknown tv audio mode [%d]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;tvaudio
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// unmute
id|cx_set
c_func
(paren
id|AUD_CTL
comma
id|EN_DAC_ENABLE
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_VOL_CTL
comma
l_int|0x00
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|cx88_get_stereo
r_void
id|cx88_get_stereo
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_struct
id|v4l2_tuner
op_star
id|t
)paren
(brace
r_static
r_char
op_star
id|m
(braket
)braket
op_assign
(brace
l_string|&quot;mono&quot;
comma
l_string|&quot;dual mono&quot;
comma
l_string|&quot;stereo&quot;
comma
l_string|&quot;sap&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
id|p
(braket
)braket
op_assign
(brace
l_string|&quot;no pilot&quot;
comma
l_string|&quot;pilot c1&quot;
comma
l_string|&quot;pilot c2&quot;
comma
l_string|&quot;?&quot;
)brace
suffix:semicolon
id|u32
id|reg
comma
id|mode
comma
id|pilot
suffix:semicolon
id|reg
op_assign
id|cx_read
c_func
(paren
id|AUD_STATUS
)paren
suffix:semicolon
id|mode
op_assign
id|reg
op_amp
l_int|0x03
suffix:semicolon
id|pilot
op_assign
(paren
id|reg
op_rshift
l_int|2
)paren
op_amp
l_int|0x03
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;AUD_STATUS: %s / %s [status=0x%x,ctl=0x%x,vol=0x%x]&bslash;n&quot;
comma
id|m
(braket
id|mode
)braket
comma
id|p
(braket
id|pilot
)braket
comma
id|reg
comma
id|cx_read
c_func
(paren
id|AUD_CTL
)paren
comma
id|cx_read
c_func
(paren
id|AUD_VOL_CTL
)paren
)paren
suffix:semicolon
id|t-&gt;capability
op_assign
id|V4L2_TUNER_CAP_STEREO
op_or
id|V4L2_TUNER_CAP_SAP
op_or
id|V4L2_TUNER_CAP_LANG1
op_or
id|V4L2_TUNER_CAP_LANG2
suffix:semicolon
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_MONO
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;tvaudio
)paren
(brace
r_case
id|WW_A2_BG
suffix:colon
r_if
c_cond
(paren
l_int|2
op_eq
id|pilot
)paren
(brace
multiline_comment|/* stereo */
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
op_or
id|V4L2_TUNER_SUB_STEREO
suffix:semicolon
r_if
c_cond
(paren
l_int|2
op_eq
id|mode
)paren
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_STEREO
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|1
op_eq
id|pilot
)paren
(brace
multiline_comment|/* dual language -- FIXME */
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_LANG1
op_or
id|V4L2_TUNER_SUB_LANG2
suffix:semicolon
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_LANG1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|WW_NICAM_BGDKL
suffix:colon
r_if
c_cond
(paren
l_int|2
op_eq
id|mode
)paren
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_STEREO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_MONO
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|cx88_set_stereo
r_void
id|cx88_set_stereo
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
id|u32
id|mode
)paren
(brace
id|u32
id|ctl
op_assign
id|UNSET
suffix:semicolon
id|u32
id|mask
op_assign
id|UNSET
suffix:semicolon
r_switch
c_cond
(paren
id|dev-&gt;tvaudio
)paren
(brace
r_case
id|WW_A2_BG
suffix:colon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|V4L2_TUNER_MODE_MONO
suffix:colon
r_case
id|V4L2_TUNER_MODE_LANG1
suffix:colon
id|ctl
op_assign
id|EN_A2_FORCE_MONO1
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_LANG2
suffix:colon
id|ctl
op_assign
id|EN_A2_AUTO_MONO2
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_STEREO
suffix:colon
id|ctl
op_assign
id|EN_A2_AUTO_STEREO
op_or
id|EN_DMTRX_SUMR
suffix:semicolon
id|mask
op_assign
l_int|0x8bf
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|WW_NICAM_BGDKL
suffix:colon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|V4L2_TUNER_MODE_MONO
suffix:colon
id|ctl
op_assign
id|EN_NICAM_FORCE_MONO1
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_LANG1
suffix:colon
id|ctl
op_assign
id|EN_NICAM_AUTO_MONO2
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_STEREO
suffix:colon
id|ctl
op_assign
id|EN_NICAM_FORCE_STEREO
op_or
id|EN_DMTRX_LR
suffix:semicolon
id|mask
op_assign
l_int|0x93f
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|WW_FM
suffix:colon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|V4L2_TUNER_MODE_MONO
suffix:colon
id|ctl
op_assign
id|EN_FMRADIO_FORCE_MONO
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_STEREO
suffix:colon
id|ctl
op_assign
id|EN_FMRADIO_AUTO_STEREO
suffix:semicolon
id|mask
op_assign
l_int|0x3f
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|UNSET
op_ne
id|ctl
)paren
(brace
id|cx_write
c_func
(paren
id|AUD_SOFT_RESET
comma
l_int|0x0001
)paren
suffix:semicolon
id|cx_andor
c_func
(paren
id|AUD_CTL
comma
id|mask
comma
id|ctl
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|AUD_SOFT_RESET
comma
l_int|0x0000
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;cx88_set_stereo: mask 0x%x, ctl 0x%x &quot;
l_string|&quot;[status=0x%x,ctl=0x%x,vol=0x%x]&bslash;n&quot;
comma
id|mask
comma
id|ctl
comma
id|cx_read
c_func
(paren
id|AUD_STATUS
)paren
comma
id|cx_read
c_func
(paren
id|AUD_CTL
)paren
comma
id|cx_read
c_func
(paren
id|AUD_VOL_CTL
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
