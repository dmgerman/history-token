multiline_comment|/*&n;    cx88-i2c.c  --  all the i2c code is here&n;&n;    Copyright (C) 1996,97,98 Ralph  Metzler (rjkm@thp.uni-koeln.de)&n;                           &amp; Marcus Metzler (mocm@thp.uni-koeln.de)&n;    (c) 2002 Yurij Sysoev &lt;yurij@naturesoft.net&gt;&n;    (c) 1999-2003 Gerd Knorr &lt;kraxel@bytesex.org&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;    &n;*/
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__ 1
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;cx88.h&quot;
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|function|cx8800_bit_setscl
r_void
id|cx8800_bit_setscl
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|cx8800_dev
op_star
id|dev
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|dev-&gt;i2c_state
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|dev-&gt;i2c_state
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_I2C
comma
id|dev-&gt;i2c_state
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
)brace
DECL|function|cx8800_bit_setsda
r_void
id|cx8800_bit_setsda
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|cx8800_dev
op_star
id|dev
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|dev-&gt;i2c_state
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|dev-&gt;i2c_state
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_I2C
comma
id|dev-&gt;i2c_state
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
)brace
DECL|function|cx8800_bit_getscl
r_static
r_int
id|cx8800_bit_getscl
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|cx8800_dev
op_star
id|dev
op_assign
id|data
suffix:semicolon
id|u32
id|state
suffix:semicolon
id|state
op_assign
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
r_return
id|state
op_amp
l_int|0x02
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|cx8800_bit_getsda
r_static
r_int
id|cx8800_bit_getsda
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|cx8800_dev
op_star
id|dev
op_assign
id|data
suffix:semicolon
id|u32
id|state
suffix:semicolon
id|state
op_assign
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
r_return
id|state
op_amp
l_int|0x01
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
macro_line|#ifndef I2C_PEC
DECL|function|cx8800_inc_use
r_static
r_void
id|cx8800_inc_use
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
)brace
DECL|function|cx8800_dec_use
r_static
r_void
id|cx8800_dec_use
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
macro_line|#endif
DECL|function|attach_inform
r_static
r_int
id|attach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|cx8800_dev
op_star
id|dev
op_assign
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tuner_type
op_ne
id|UNSET
)paren
id|cx8800_call_i2c_clients
c_func
(paren
id|dev
comma
id|TUNER_SET_TYPE
comma
op_amp
id|dev-&gt;tuner_type
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
multiline_comment|/* fixme: debug */
)paren
id|printk
c_func
(paren
l_string|&quot;%s: i2c attach [client=%s]&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|i2c_clientname
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx8800_call_i2c_clients
r_void
id|cx8800_call_i2c_clients
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|dev-&gt;i2c_rc
)paren
r_return
suffix:semicolon
id|i2c_clients_command
c_func
(paren
op_amp
id|dev-&gt;i2c_adap
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|cx8800_i2c_algo_template
r_static
r_struct
id|i2c_algo_bit_data
id|cx8800_i2c_algo_template
op_assign
(brace
dot
id|setsda
op_assign
id|cx8800_bit_setsda
comma
dot
id|setscl
op_assign
id|cx8800_bit_setscl
comma
dot
id|getsda
op_assign
id|cx8800_bit_getsda
comma
dot
id|getscl
op_assign
id|cx8800_bit_getscl
comma
dot
id|udelay
op_assign
l_int|16
comma
dot
id|mdelay
op_assign
l_int|10
comma
dot
id|timeout
op_assign
l_int|200
comma
)brace
suffix:semicolon
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|cx8800_i2c_adap_template
r_static
r_struct
id|i2c_adapter
id|cx8800_i2c_adap_template
op_assign
(brace
macro_line|#ifdef I2C_PEC
dot
id|owner
op_assign
id|THIS_MODULE
comma
macro_line|#else
dot
id|inc_use
op_assign
id|cx8800_inc_use
comma
dot
id|dec_use
op_assign
id|cx8800_dec_use
comma
macro_line|#endif
macro_line|#ifdef I2C_ADAP_CLASS_TV_ANALOG
dot
r_class
op_assign
id|I2C_ADAP_CLASS_TV_ANALOG
comma
macro_line|#endif
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;cx2388x&quot;
)paren
comma
dot
id|id
op_assign
id|I2C_HW_B_BT848
comma
dot
id|client_register
op_assign
id|attach_inform
comma
)brace
suffix:semicolon
DECL|variable|cx8800_i2c_client_template
r_static
r_struct
id|i2c_client
id|cx8800_i2c_client_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;cx88xx internal&quot;
)paren
comma
dot
id|id
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
multiline_comment|/* init + register i2c algo-bit adapter */
DECL|function|cx8800_i2c_init
r_int
id|__devinit
id|cx8800_i2c_init
c_func
(paren
r_struct
id|cx8800_dev
op_star
id|dev
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;i2c_adap
comma
op_amp
id|cx8800_i2c_adap_template
comma
r_sizeof
(paren
id|dev-&gt;i2c_adap
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;i2c_algo
comma
op_amp
id|cx8800_i2c_algo_template
comma
r_sizeof
(paren
id|dev-&gt;i2c_algo
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev-&gt;i2c_client
comma
op_amp
id|cx8800_i2c_client_template
comma
r_sizeof
(paren
id|dev-&gt;i2c_client
)paren
)paren
suffix:semicolon
id|dev-&gt;i2c_adap.dev.parent
op_assign
op_amp
id|dev-&gt;pci-&gt;dev
suffix:semicolon
id|strcpy
c_func
(paren
id|dev-&gt;i2c_adap.name
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|dev-&gt;i2c_algo.data
op_assign
id|dev
suffix:semicolon
id|i2c_set_adapdata
c_func
(paren
op_amp
id|dev-&gt;i2c_adap
comma
id|dev
)paren
suffix:semicolon
id|dev-&gt;i2c_adap.algo_data
op_assign
op_amp
id|dev-&gt;i2c_algo
suffix:semicolon
id|dev-&gt;i2c_client.adapter
op_assign
op_amp
id|dev-&gt;i2c_adap
suffix:semicolon
id|cx8800_bit_setscl
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|cx8800_bit_setsda
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|dev-&gt;i2c_rc
op_assign
id|i2c_bit_add_bus
c_func
(paren
op_amp
id|dev-&gt;i2c_adap
)paren
suffix:semicolon
r_return
id|dev-&gt;i2c_rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
