multiline_comment|/*&n;    $Id: cx88-i2c.c,v 1.18 2004/10/13 10:39:00 kraxel Exp $&n;&n;    cx88-i2c.c  --  all the i2c code is here&n;&n;    Copyright (C) 1996,97,98 Ralph  Metzler (rjkm@thp.uni-koeln.de)&n;                           &amp; Marcus Metzler (mocm@thp.uni-koeln.de)&n;    (c) 2002 Yurij Sysoev &lt;yurij@naturesoft.net&gt;&n;    (c) 1999-2003 Gerd Knorr &lt;kraxel@bytesex.org&gt;&n;&n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n;*/
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;cx88.h&quot;
DECL|variable|i2c_debug
r_static
r_int
r_int
id|i2c_debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|i2c_debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|i2c_debug
comma
l_string|&quot;enable debug messages [i2c]&quot;
)paren
suffix:semicolon
DECL|variable|i2c_scan
r_static
r_int
r_int
id|i2c_scan
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|i2c_scan
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|i2c_scan
comma
l_string|&quot;scan i2c bus at insmod time&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(level,fmt, arg...)&t;if (i2c_debug &gt;= level) &bslash;&n;&t;printk(KERN_DEBUG &quot;%s: &quot; fmt, core-&gt;name , ## arg)
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|function|cx8800_bit_setscl
r_void
id|cx8800_bit_setscl
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|core-&gt;i2c_state
op_or_assign
l_int|0x02
suffix:semicolon
r_else
id|core-&gt;i2c_state
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_I2C
comma
id|core-&gt;i2c_state
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
)brace
DECL|function|cx8800_bit_setsda
r_void
id|cx8800_bit_setsda
c_func
(paren
r_void
op_star
id|data
comma
r_int
id|state
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|core-&gt;i2c_state
op_or_assign
l_int|0x01
suffix:semicolon
r_else
id|core-&gt;i2c_state
op_and_assign
op_complement
l_int|0x01
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_I2C
comma
id|core-&gt;i2c_state
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
)brace
DECL|function|cx8800_bit_getscl
r_static
r_int
id|cx8800_bit_getscl
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|data
suffix:semicolon
id|u32
id|state
suffix:semicolon
id|state
op_assign
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
r_return
id|state
op_amp
l_int|0x02
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|cx8800_bit_getsda
r_static
r_int
id|cx8800_bit_getsda
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|data
suffix:semicolon
id|u32
id|state
suffix:semicolon
id|state
op_assign
id|cx_read
c_func
(paren
id|MO_I2C
)paren
suffix:semicolon
r_return
id|state
op_amp
l_int|0x01
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|function|attach_inform
r_static
r_int
id|attach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;i2c attach [addr=0x%x,client=%s]&bslash;n&quot;
comma
id|client-&gt;addr
comma
id|i2c_clientname
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|client-&gt;driver-&gt;command
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|core-&gt;tuner_type
op_ne
id|UNSET
)paren
id|client-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|client
comma
id|TUNER_SET_TYPE
comma
op_amp
id|core-&gt;tuner_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|core-&gt;tda9887_conf
)paren
id|client-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|client
comma
id|TDA9887_SET_CONFIG
comma
op_amp
id|core-&gt;tda9887_conf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|detach_inform
r_static
r_int
id|detach_inform
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|i2c_get_adapdata
c_func
(paren
id|client-&gt;adapter
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;i2c detach [client=%s]&bslash;n&quot;
comma
id|i2c_clientname
c_func
(paren
id|client
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cx88_call_i2c_clients
r_void
id|cx88_call_i2c_clients
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|core-&gt;i2c_rc
)paren
r_return
suffix:semicolon
id|i2c_clients_command
c_func
(paren
op_amp
id|core-&gt;i2c_adap
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|cx8800_i2c_algo_template
r_static
r_struct
id|i2c_algo_bit_data
id|cx8800_i2c_algo_template
op_assign
(brace
dot
id|setsda
op_assign
id|cx8800_bit_setsda
comma
dot
id|setscl
op_assign
id|cx8800_bit_setscl
comma
dot
id|getsda
op_assign
id|cx8800_bit_getsda
comma
dot
id|getscl
op_assign
id|cx8800_bit_getscl
comma
dot
id|udelay
op_assign
l_int|16
comma
dot
id|mdelay
op_assign
l_int|10
comma
dot
id|timeout
op_assign
l_int|200
comma
)brace
suffix:semicolon
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|cx8800_i2c_adap_template
r_static
r_struct
id|i2c_adapter
id|cx8800_i2c_adap_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;cx2388x&quot;
)paren
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|id
op_assign
id|I2C_HW_B_CX2388x
comma
dot
id|client_register
op_assign
id|attach_inform
comma
dot
id|client_unregister
op_assign
id|detach_inform
comma
)brace
suffix:semicolon
DECL|variable|cx8800_i2c_client_template
r_static
r_struct
id|i2c_client
id|cx8800_i2c_client_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;cx88xx internal&quot;
)paren
comma
dot
id|id
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|i2c_devs
r_static
r_char
op_star
id|i2c_devs
(braket
l_int|128
)braket
op_assign
(brace
(braket
l_int|0x86
op_rshift
l_int|1
)braket
op_assign
l_string|&quot;tda9887/cx22702&quot;
comma
(braket
l_int|0xa0
op_rshift
l_int|1
)braket
op_assign
l_string|&quot;eeprom&quot;
comma
(braket
l_int|0xc0
op_rshift
l_int|1
)braket
op_assign
l_string|&quot;tuner (analog)&quot;
comma
(braket
l_int|0xc2
op_rshift
l_int|1
)braket
op_assign
l_string|&quot;tuner (analog/dvb)&quot;
comma
)brace
suffix:semicolon
DECL|function|do_i2c_scan
r_static
r_void
id|do_i2c_scan
c_func
(paren
r_char
op_star
id|name
comma
r_struct
id|i2c_client
op_star
id|c
)paren
(brace
r_int
r_char
id|buf
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c-&gt;addr
op_assign
id|i
suffix:semicolon
id|rc
op_assign
id|i2c_master_recv
c_func
(paren
id|c
comma
op_amp
id|buf
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: i2c scan: found device @ 0x%x  [%s]&bslash;n&quot;
comma
id|name
comma
id|i
op_lshift
l_int|1
comma
id|i2c_devs
(braket
id|i
)braket
ques
c_cond
id|i2c_devs
(braket
id|i
)braket
suffix:colon
l_string|&quot;???&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* init + register i2c algo-bit adapter */
DECL|function|cx88_i2c_init
r_int
id|cx88_i2c_init
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|core-&gt;i2c_adap
comma
op_amp
id|cx8800_i2c_adap_template
comma
r_sizeof
(paren
id|core-&gt;i2c_adap
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|core-&gt;i2c_algo
comma
op_amp
id|cx8800_i2c_algo_template
comma
r_sizeof
(paren
id|core-&gt;i2c_algo
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|core-&gt;i2c_client
comma
op_amp
id|cx8800_i2c_client_template
comma
r_sizeof
(paren
id|core-&gt;i2c_client
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|core-&gt;tuner_type
op_ne
id|TUNER_ABSENT
)paren
id|core-&gt;i2c_adap
dot
r_class
op_or_assign
id|I2C_CLASS_TV_ANALOG
suffix:semicolon
r_if
c_cond
(paren
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|dvb
)paren
id|core-&gt;i2c_adap
dot
r_class
op_or_assign
id|I2C_CLASS_TV_DIGITAL
suffix:semicolon
id|core-&gt;i2c_adap.dev.parent
op_assign
op_amp
id|pci-&gt;dev
suffix:semicolon
id|strlcpy
c_func
(paren
id|core-&gt;i2c_adap.name
comma
id|core-&gt;name
comma
r_sizeof
(paren
id|core-&gt;i2c_adap.name
)paren
)paren
suffix:semicolon
id|core-&gt;i2c_algo.data
op_assign
id|core
suffix:semicolon
id|i2c_set_adapdata
c_func
(paren
op_amp
id|core-&gt;i2c_adap
comma
id|core
)paren
suffix:semicolon
id|core-&gt;i2c_adap.algo_data
op_assign
op_amp
id|core-&gt;i2c_algo
suffix:semicolon
id|core-&gt;i2c_client.adapter
op_assign
op_amp
id|core-&gt;i2c_adap
suffix:semicolon
id|cx8800_bit_setscl
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
id|cx8800_bit_setsda
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
id|core-&gt;i2c_rc
op_assign
id|i2c_bit_add_bus
c_func
(paren
op_amp
id|core-&gt;i2c_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|core-&gt;i2c_rc
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;i2c register ok&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_scan
)paren
id|do_i2c_scan
c_func
(paren
id|core-&gt;name
comma
op_amp
id|core-&gt;i2c_client
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;%s: i2c register FAILED&bslash;n&quot;
comma
id|core-&gt;name
)paren
suffix:semicolon
r_return
id|core-&gt;i2c_rc
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|cx88_call_i2c_clients
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_call_i2c_clients
)paren
suffix:semicolon
DECL|variable|cx88_i2c_init
id|EXPORT_SYMBOL
c_func
(paren
id|cx88_i2c_init
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
