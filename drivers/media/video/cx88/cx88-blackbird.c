multiline_comment|/*&n; * $Id: cx88-blackbird.c,v 1.17 2004/11/07 13:17:15 kraxel Exp $&n; *&n; *  Support for a cx23416 mpeg encoder via cx2388x host port.&n; *  &quot;blackbird&quot; reference design.&n; *&n; *    (c) 2004 Jelle Foks &lt;jelle@foks.8m.com&gt;&n; *    (c) 2004 Gerd Knorr &lt;kraxel@bytesex.org&gt;&n; *&n; *  Includes parts from the ivtv driver( http://ivtv.sourceforge.net/),&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/firmware.h&gt;
macro_line|#include &quot;cx88.h&quot;
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;driver for cx2388x/cx23416 based mpeg encoder cards&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jelle Foks &lt;jelle@foks.8m.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|mpegbufs
r_static
r_int
r_int
id|mpegbufs
op_assign
l_int|8
suffix:semicolon
id|module_param
c_func
(paren
id|mpegbufs
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mpegbufs
comma
l_string|&quot;number of mpeg buffers, range 2-32&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;enable debug messages [blackbird]&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(level,fmt, arg...)&t;if (debug &gt;= level) &bslash;&n;&t;printk(KERN_DEBUG &quot;%s/2-bb: &quot; fmt, dev-&gt;core-&gt;name , ## arg)
r_static
id|LIST_HEAD
c_func
(paren
id|cx8802_devlist
)paren
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
DECL|macro|BLACKBIRD_FIRM_ENC_FILENAME
mdefine_line|#define BLACKBIRD_FIRM_ENC_FILENAME &quot;blackbird-fw-enc.bin&quot;
DECL|macro|BLACKBIRD_FIRM_IMAGE_SIZE
mdefine_line|#define BLACKBIRD_FIRM_IMAGE_SIZE 256*1024
multiline_comment|/* defines below are from ivtv-driver.h */
DECL|macro|IVTV_CMD_HW_BLOCKS_RST
mdefine_line|#define IVTV_CMD_HW_BLOCKS_RST 0xFFFFFFFF
multiline_comment|/*Firmware API commands*/
DECL|macro|IVTV_API_ENC_PING_FW
mdefine_line|#define IVTV_API_ENC_PING_FW 0x00000080
DECL|macro|IVTV_API_ENC_GETVER
mdefine_line|#define IVTV_API_ENC_GETVER 0x000000C4
DECL|macro|IVTV_API_ENC_HALT_FW
mdefine_line|#define IVTV_API_ENC_HALT_FW 0x000000C3
DECL|macro|IVTV_API_STD_TIMEOUT
mdefine_line|#define IVTV_API_STD_TIMEOUT 0x00010000 /*units??*/
singleline_comment|//#define IVTV_API_ASSIGN_PGM_INDEX_INFO 0x000000c7
DECL|macro|IVTV_API_ASSIGN_STREAM_TYPE
mdefine_line|#define IVTV_API_ASSIGN_STREAM_TYPE 0x000000b9
DECL|macro|IVTV_API_ASSIGN_OUTPUT_PORT
mdefine_line|#define IVTV_API_ASSIGN_OUTPUT_PORT 0x000000bb
DECL|macro|IVTV_API_ASSIGN_FRAMERATE
mdefine_line|#define IVTV_API_ASSIGN_FRAMERATE 0x0000008f
DECL|macro|IVTV_API_ASSIGN_FRAME_SIZE
mdefine_line|#define IVTV_API_ASSIGN_FRAME_SIZE 0x00000091
DECL|macro|IVTV_API_ASSIGN_ASPECT_RATIO
mdefine_line|#define IVTV_API_ASSIGN_ASPECT_RATIO 0x00000099
DECL|macro|IVTV_API_ASSIGN_BITRATES
mdefine_line|#define IVTV_API_ASSIGN_BITRATES 0x00000095
DECL|macro|IVTV_API_ASSIGN_GOP_PROPERTIES
mdefine_line|#define IVTV_API_ASSIGN_GOP_PROPERTIES 0x00000097
DECL|macro|IVTV_API_ASSIGN_3_2_PULLDOWN
mdefine_line|#define IVTV_API_ASSIGN_3_2_PULLDOWN 0x000000b1
DECL|macro|IVTV_API_ASSIGN_GOP_CLOSURE
mdefine_line|#define IVTV_API_ASSIGN_GOP_CLOSURE 0x000000c5
DECL|macro|IVTV_API_ASSIGN_AUDIO_PROPERTIES
mdefine_line|#define IVTV_API_ASSIGN_AUDIO_PROPERTIES 0x000000bd
DECL|macro|IVTV_API_ASSIGN_DNR_FILTER_MODE
mdefine_line|#define IVTV_API_ASSIGN_DNR_FILTER_MODE 0x0000009b
DECL|macro|IVTV_API_ASSIGN_DNR_FILTER_PROPS
mdefine_line|#define IVTV_API_ASSIGN_DNR_FILTER_PROPS 0x0000009d
DECL|macro|IVTV_API_ASSIGN_CORING_LEVELS
mdefine_line|#define IVTV_API_ASSIGN_CORING_LEVELS 0x0000009f
DECL|macro|IVTV_API_ASSIGN_SPATIAL_FILTER_TYPE
mdefine_line|#define IVTV_API_ASSIGN_SPATIAL_FILTER_TYPE 0x000000a1
DECL|macro|IVTV_API_ASSIGN_FRAME_DROP_RATE
mdefine_line|#define IVTV_API_ASSIGN_FRAME_DROP_RATE 0x000000d0
DECL|macro|IVTV_API_ASSIGN_PLACEHOLDER
mdefine_line|#define IVTV_API_ASSIGN_PLACEHOLDER 0x000000d8
DECL|macro|IVTV_API_MUTE_VIDEO
mdefine_line|#define IVTV_API_MUTE_VIDEO 0x000000d9
DECL|macro|IVTV_API_MUTE_AUDIO
mdefine_line|#define IVTV_API_MUTE_AUDIO 0x000000da
DECL|macro|IVTV_API_INITIALIZE_INPUT
mdefine_line|#define IVTV_API_INITIALIZE_INPUT 0x000000cd
DECL|macro|IVTV_API_REFRESH_INPUT
mdefine_line|#define IVTV_API_REFRESH_INPUT 0x000000d3
DECL|macro|IVTV_API_ASSIGN_NUM_VSYNC_LINES
mdefine_line|#define IVTV_API_ASSIGN_NUM_VSYNC_LINES 0x000000d6
DECL|macro|IVTV_API_BEGIN_CAPTURE
mdefine_line|#define IVTV_API_BEGIN_CAPTURE 0x00000081
singleline_comment|//#define IVTV_API_PAUSE_ENCODER 0x000000d2
singleline_comment|//#define IVTV_API_EVENT_NOTIFICATION 0x000000d5
DECL|macro|IVTV_API_END_CAPTURE
mdefine_line|#define IVTV_API_END_CAPTURE 0x00000082
multiline_comment|/* Registers */
DECL|macro|IVTV_REG_ENC_SDRAM_REFRESH
mdefine_line|#define IVTV_REG_ENC_SDRAM_REFRESH (0x07F8 /*| IVTV_REG_OFFSET*/)
DECL|macro|IVTV_REG_ENC_SDRAM_PRECHARGE
mdefine_line|#define IVTV_REG_ENC_SDRAM_PRECHARGE (0x07FC /*| IVTV_REG_OFFSET*/)
DECL|macro|IVTV_REG_SPU
mdefine_line|#define IVTV_REG_SPU (0x9050 /*| IVTV_REG_OFFSET*/)
DECL|macro|IVTV_REG_HW_BLOCKS
mdefine_line|#define IVTV_REG_HW_BLOCKS (0x9054 /*| IVTV_REG_OFFSET*/)
DECL|macro|IVTV_REG_VPU
mdefine_line|#define IVTV_REG_VPU (0x9058 /*| IVTV_REG_OFFSET*/)
DECL|macro|IVTV_REG_APU
mdefine_line|#define IVTV_REG_APU (0xA064 /*| IVTV_REG_OFFSET*/)
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|host_setup
r_static
r_void
id|host_setup
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
)paren
(brace
multiline_comment|/* toggle reset of the host */
id|cx_write
c_func
(paren
id|MO_GPHST_SOFT_RST
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_SOFT_RST
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* host port setup */
id|cx_write
c_func
(paren
id|MO_GPHST_WSC
comma
l_int|0x44444444U
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_XFR
comma
l_int|0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_WDTH
comma
l_int|15
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_HDSHK
comma
l_int|0
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_MUX16
comma
l_int|0x44448888U
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_GPHST_MODE
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|macro|P1_MDATA0
mdefine_line|#define P1_MDATA0 0x390000
DECL|macro|P1_MDATA1
mdefine_line|#define P1_MDATA1 0x390001
DECL|macro|P1_MDATA2
mdefine_line|#define P1_MDATA2 0x390002
DECL|macro|P1_MDATA3
mdefine_line|#define P1_MDATA3 0x390003
DECL|macro|P1_MADDR2
mdefine_line|#define P1_MADDR2 0x390004
DECL|macro|P1_MADDR1
mdefine_line|#define P1_MADDR1 0x390005
DECL|macro|P1_MADDR0
mdefine_line|#define P1_MADDR0 0x390006
DECL|macro|P1_RDATA0
mdefine_line|#define P1_RDATA0 0x390008
DECL|macro|P1_RDATA1
mdefine_line|#define P1_RDATA1 0x390009
DECL|macro|P1_RDATA2
mdefine_line|#define P1_RDATA2 0x39000A
DECL|macro|P1_RDATA3
mdefine_line|#define P1_RDATA3 0x39000B
DECL|macro|P1_RADDR0
mdefine_line|#define P1_RADDR0 0x39000C
DECL|macro|P1_RADDR1
mdefine_line|#define P1_RADDR1 0x39000D
DECL|macro|P1_RRDWR
mdefine_line|#define P1_RRDWR  0x39000E
DECL|function|wait_ready_gpio0_bit1
r_static
r_int
id|wait_ready_gpio0_bit1
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|state
)paren
(brace
r_int
r_int
id|timeout
op_assign
id|jiffies
op_plus
id|msecs_to_jiffies
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|u32
id|gpio0
comma
id|need
suffix:semicolon
id|need
op_assign
id|state
ques
c_cond
l_int|2
suffix:colon
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|gpio0
op_assign
id|cx_read
c_func
(paren
id|MO_GP0_IO
)paren
op_amp
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|need
op_eq
id|gpio0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|timeout
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|memory_write
r_static
r_int
id|memory_write
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|address
comma
id|u32
id|value
)paren
(brace
multiline_comment|/* Warning: address is dword address (4 bytes) */
id|cx_writeb
c_func
(paren
id|P1_MDATA0
comma
(paren
r_int
r_int
)paren
id|value
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA1
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA2
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA3
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|24
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MADDR2
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|16
)paren
op_or
l_int|0x40
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MADDR1
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MADDR0
comma
(paren
r_int
r_int
)paren
id|address
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_MDATA0
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_MADDR0
)paren
suffix:semicolon
r_return
id|wait_ready_gpio0_bit1
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|memory_read
r_static
r_int
id|memory_read
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|address
comma
id|u32
op_star
id|value
)paren
(brace
r_int
id|retval
suffix:semicolon
id|u32
id|val
suffix:semicolon
multiline_comment|/* Warning: address is dword address (4 bytes) */
id|cx_writeb
c_func
(paren
id|P1_MADDR2
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|16
)paren
op_amp
op_complement
l_int|0xC0
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MADDR1
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MADDR0
comma
(paren
r_int
r_int
)paren
id|address
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_MADDR0
)paren
suffix:semicolon
id|retval
op_assign
id|wait_ready_gpio0_bit1
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA3
comma
l_int|0
)paren
suffix:semicolon
id|val
op_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_MDATA3
)paren
op_lshift
l_int|24
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA2
comma
l_int|0
)paren
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_MDATA2
)paren
op_lshift
l_int|16
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA1
comma
l_int|0
)paren
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_MDATA1
)paren
op_lshift
l_int|8
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_MDATA0
comma
l_int|0
)paren
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_MDATA0
)paren
suffix:semicolon
op_star
id|value
op_assign
id|val
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|register_write
r_static
r_int
id|register_write
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|address
comma
id|u32
id|value
)paren
(brace
id|cx_writeb
c_func
(paren
id|P1_RDATA0
comma
(paren
r_int
r_int
)paren
id|value
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RDATA1
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RDATA2
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RDATA3
comma
(paren
r_int
r_int
)paren
(paren
id|value
op_rshift
l_int|24
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RADDR0
comma
(paren
r_int
r_int
)paren
id|address
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RADDR1
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RRDWR
comma
l_int|1
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_RDATA0
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_RADDR0
)paren
suffix:semicolon
r_return
id|wait_ready_gpio0_bit1
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
macro_line|#if 0
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* without this, things don&squot;t go right (subsequent memory_write()&squot;s don&squot;t get through */
multiline_comment|/* ? would this be safe here? set_current_state(TASK_INTERRUPTIBLE); schedule_timeout(1); */
macro_line|#endif
)brace
DECL|function|register_read
r_static
r_int
id|register_read
c_func
(paren
r_struct
id|cx88_core
op_star
id|core
comma
id|u32
id|address
comma
id|u32
op_star
id|value
)paren
(brace
r_int
id|retval
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RADDR0
comma
(paren
r_int
r_int
)paren
id|address
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RADDR1
comma
(paren
r_int
r_int
)paren
(paren
id|address
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|cx_writeb
c_func
(paren
id|P1_RRDWR
comma
l_int|0
)paren
suffix:semicolon
id|cx_read
c_func
(paren
id|P1_RADDR0
)paren
suffix:semicolon
id|retval
op_assign
id|wait_ready_gpio0_bit1
c_func
(paren
id|core
comma
l_int|1
)paren
suffix:semicolon
id|val
op_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_RDATA0
)paren
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_RDATA1
)paren
op_lshift
l_int|8
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_RDATA2
)paren
op_lshift
l_int|16
suffix:semicolon
id|val
op_or_assign
(paren
r_int
r_char
)paren
id|cx_read
c_func
(paren
id|P1_RDATA3
)paren
op_lshift
l_int|24
suffix:semicolon
op_star
id|value
op_assign
id|val
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
multiline_comment|/* We don&squot;t need to call the API often, so using just one mailbox will probably suffice */
DECL|function|blackbird_api_cmd
r_static
r_int
id|blackbird_api_cmd
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
comma
id|u32
id|command
comma
id|u32
id|inputcnt
comma
id|u32
id|outputcnt
comma
dot
dot
dot
)paren
(brace
r_int
r_int
id|timeout
suffix:semicolon
id|u32
id|value
comma
id|flag
comma
id|retval
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_list
id|args
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|outputcnt
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: 0x%X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|command
)paren
suffix:semicolon
multiline_comment|/* this may not be 100% safe if we can&squot;t read any memory location&n;&t;   without side effects */
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_minus
l_int|4
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
l_int|0x12345678
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Firmware and/or mailbox pointer not initialized or corrupted&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
comma
op_amp
id|flag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flag
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Mailbox appears to be in use (%x)&bslash;n&quot;
comma
id|flag
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|flag
op_or_assign
l_int|1
suffix:semicolon
multiline_comment|/* tell &squot;em we&squot;re working on it */
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
comma
id|flag
)paren
suffix:semicolon
multiline_comment|/* write command + args + fill remaining with zeros */
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|1
comma
id|command
)paren
suffix:semicolon
multiline_comment|/* command code */
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|3
comma
id|IVTV_API_STD_TIMEOUT
)paren
suffix:semicolon
multiline_comment|/* timeout */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|inputcnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|va_arg
c_func
(paren
id|args
comma
r_int
)paren
suffix:semicolon
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|4
op_plus
id|i
comma
id|value
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;API Input %d = %d&bslash;n&quot;
comma
id|i
comma
id|value
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|4
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
id|flag
op_or_assign
l_int|3
suffix:semicolon
multiline_comment|/* tell &squot;em we&squot;re done writing */
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
comma
id|flag
)paren
suffix:semicolon
multiline_comment|/* wait for firmware to handle the API command */
id|timeout
op_assign
id|jiffies
op_plus
id|msecs_to_jiffies
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
comma
op_amp
id|flag
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
(paren
id|flag
op_amp
l_int|4
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|timeout
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: API Mailbox timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
multiline_comment|/* read output values */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|outputcnt
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
op_star
id|vptr
op_assign
id|va_arg
c_func
(paren
id|args
comma
r_int
op_star
)paren
suffix:semicolon
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|4
op_plus
id|i
comma
id|vptr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;API Output %d = %d&bslash;n&quot;
comma
id|i
comma
op_star
id|vptr
)paren
suffix:semicolon
)brace
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
op_plus
l_int|2
comma
op_amp
id|retval
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;API result = %d&bslash;n&quot;
comma
id|retval
)paren
suffix:semicolon
id|flag
op_assign
l_int|0
suffix:semicolon
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;mailbox
comma
id|flag
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|blackbird_find_mailbox
r_static
r_int
id|blackbird_find_mailbox
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
id|u32
id|signature
(braket
l_int|4
)braket
op_assign
initialization_block
suffix:semicolon
r_int
id|signaturecnt
op_assign
l_int|0
suffix:semicolon
id|u32
id|value
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|BLACKBIRD_FIRM_IMAGE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|i
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_eq
id|signature
(braket
id|signaturecnt
)braket
)paren
id|signaturecnt
op_increment
suffix:semicolon
r_else
id|signaturecnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|4
op_eq
id|signaturecnt
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;Mailbox signature found&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Mailbox signature values not found!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|blackbird_load_firmware
r_static
r_int
id|blackbird_load_firmware
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
r_static
r_const
r_int
r_char
id|magic
(braket
l_int|8
)braket
op_assign
(brace
l_int|0xa7
comma
l_int|0x0d
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x66
comma
l_int|0xbb
comma
l_int|0x55
comma
l_int|0xaa
)brace
suffix:semicolon
r_const
r_struct
id|firmware
op_star
id|firmware
suffix:semicolon
r_int
id|i
comma
id|retval
op_assign
l_int|0
suffix:semicolon
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
id|u32
id|checksum
op_assign
l_int|0
suffix:semicolon
id|u32
op_star
id|dataptr
suffix:semicolon
id|retval
op_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_VPU
comma
l_int|0xFFFFFFED
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_HW_BLOCKS
comma
id|IVTV_CMD_HW_BLOCKS_RST
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_ENC_SDRAM_REFRESH
comma
l_int|0x80000640
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_ENC_SDRAM_PRECHARGE
comma
l_int|0x1A
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_APU
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Error with register_write&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
id|request_firmware
c_func
(paren
op_amp
id|firmware
comma
id|BLACKBIRD_FIRM_ENC_FILENAME
comma
op_amp
id|dev-&gt;pci-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ne
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Hotplug firmware request failed (%s).&bslash;n&quot;
comma
id|BLACKBIRD_FIRM_ENC_FILENAME
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Please fix your hotplug setup, the board will &quot;
l_string|&quot;not work without firmware loaded!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|firmware-&gt;size
op_ne
id|BLACKBIRD_FIRM_IMAGE_SIZE
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Firmware size mismatch (have %zd, expected %d)&bslash;n&quot;
comma
id|firmware-&gt;size
comma
id|BLACKBIRD_FIRM_IMAGE_SIZE
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|memcmp
c_func
(paren
id|firmware-&gt;data
comma
id|magic
comma
l_int|8
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Firmware magic mismatch, wrong file?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* transfer to the chip */
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;Loading firmware ...&bslash;n&quot;
)paren
suffix:semicolon
id|dataptr
op_assign
(paren
id|u32
op_star
)paren
id|firmware-&gt;data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|firmware-&gt;size
op_rshift
l_int|2
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
op_star
id|dataptr
suffix:semicolon
id|checksum
op_add_assign
op_complement
id|value
suffix:semicolon
id|memory_write
c_func
(paren
id|dev-&gt;core
comma
id|i
comma
id|value
)paren
suffix:semicolon
id|dataptr
op_increment
suffix:semicolon
)brace
multiline_comment|/* read back to verify with the checksum */
r_for
c_loop
(paren
id|i
op_decrement
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|memory_read
c_func
(paren
id|dev-&gt;core
comma
id|i
comma
op_amp
id|value
)paren
suffix:semicolon
id|checksum
op_sub_assign
op_complement
id|value
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checksum
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Firmware load failed (checksum mismatch).&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|release_firmware
c_func
(paren
id|firmware
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Firmware upload successful.&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_HW_BLOCKS
comma
id|IVTV_CMD_HW_BLOCKS_RST
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_read
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_SPU
comma
op_amp
id|value
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_SPU
comma
id|value
op_amp
l_int|0xFFFFFFFE
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_read
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_VPU
comma
op_amp
id|value
)paren
suffix:semicolon
id|retval
op_or_assign
id|register_write
c_func
(paren
id|dev-&gt;core
comma
id|IVTV_REG_VPU
comma
id|value
op_amp
l_int|0xFFFFFFE8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Error with register_write&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|blackbird_codec_settings
r_static
r_void
id|blackbird_codec_settings
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
r_int
id|bitrate_mode
op_assign
l_int|1
suffix:semicolon
r_int
id|bitrate
op_assign
l_int|7500000
suffix:semicolon
r_int
id|bitrate_peak
op_assign
l_int|7500000
suffix:semicolon
multiline_comment|/* assign stream type */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_STREAM_TYPE
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* program stream */
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_STREAM_TYPE, 1, 0, 2); /* MPEG1 stream */
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_STREAM_TYPE, 1, 0, 3); /* PES A/V */
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_STREAM_TYPE, 1, 0, 10); /* DVD stream */
multiline_comment|/* assign output port */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_OUTPUT_PORT
comma
l_int|1
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 1 = Host */
multiline_comment|/* assign framerate */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_FRAMERATE
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* assign frame size */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_FRAME_SIZE
comma
l_int|2
comma
l_int|0
comma
l_int|480
comma
l_int|720
)paren
suffix:semicolon
multiline_comment|/* assign aspect ratio */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_ASPECT_RATIO
comma
l_int|1
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* assign bitrates */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_BITRATES
comma
l_int|5
comma
l_int|0
comma
id|bitrate_mode
comma
multiline_comment|/* mode */
id|bitrate
comma
multiline_comment|/* bps */
id|bitrate_peak
op_div
l_int|400
comma
multiline_comment|/* peak/400 */
l_int|0
comma
l_int|0x70
)paren
suffix:semicolon
multiline_comment|/* encoding buffer, ckennedy */
multiline_comment|/* assign gop properties */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_GOP_PROPERTIES
comma
l_int|2
comma
l_int|0
comma
l_int|15
comma
l_int|3
)paren
suffix:semicolon
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_GOP_PROPERTIES, 2, 0, 2, 1);
multiline_comment|/* assign 3 2 pulldown */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_3_2_PULLDOWN
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* note: it&squot;s not necessary to set the samplerate, the mpeg encoder seems to autodetect/adjust */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_AUDIO_PROPERTIES
comma
l_int|1
comma
l_int|0
comma
(paren
l_int|2
op_lshift
l_int|2
)paren
op_or
(paren
l_int|8
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* assign gop closure */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_GOP_CLOSURE
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* assign audio properties */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_AUDIO_PROPERTIES
comma
l_int|1
comma
l_int|0
comma
l_int|0
op_or
(paren
l_int|2
op_lshift
l_int|2
)paren
op_or
(paren
l_int|14
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* assign dnr filter mode */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_DNR_FILTER_MODE
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* assign dnr filter props*/
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_DNR_FILTER_PROPS
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* assign coring levels (luma_h, luma_l, chroma_h, chroma_l) */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_CORING_LEVELS
comma
l_int|4
comma
l_int|0
comma
l_int|0
comma
l_int|255
comma
l_int|0
comma
l_int|255
)paren
suffix:semicolon
multiline_comment|/* assign spatial filter type: luma_t: 1 = horiz_only, chroma_t: 1 = horiz_only */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_SPATIAL_FILTER_TYPE
comma
l_int|2
comma
l_int|0
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* assign frame drop rate */
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_FRAME_DROP_RATE
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|blackbird_initialize_codec
r_static
r_int
id|blackbird_initialize_codec
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
r_struct
id|cx88_core
op_star
id|core
op_assign
id|dev-&gt;core
suffix:semicolon
r_int
id|version
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;Initialize codec&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ENC_PING_FW
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ping */
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
multiline_comment|/* ping was not successful, reset and upload firmware */
id|cx_write
c_func
(paren
id|MO_SRST_IO
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* SYS_RSTO=0 */
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_SRST_IO
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* SYS_RSTO=1 */
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retval
op_assign
id|blackbird_load_firmware
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_return
id|retval
suffix:semicolon
id|dev-&gt;mailbox
op_assign
id|blackbird_find_mailbox
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mailbox
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|retval
op_assign
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ENC_PING_FW
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ping */
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Firmware ping failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|retval
op_assign
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ENC_GETVER
comma
l_int|0
comma
l_int|1
comma
op_amp
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;ERROR: Firmware get encoder version failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|0
comma
l_string|&quot;Firmware version is 0x%08x&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
)brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cx_write
c_func
(paren
id|MO_PINMUX_IO
comma
l_int|0x88
)paren
suffix:semicolon
multiline_comment|/* 656-8bit IO and enable MPEG parallel IO */
id|cx_clear
c_func
(paren
id|MO_INPUT_FORMAT
comma
l_int|0x100
)paren
suffix:semicolon
multiline_comment|/* chroma subcarrier lock to normal? */
id|cx_write
c_func
(paren
id|MO_VBOS_CONTROL
comma
l_int|0x84A00
)paren
suffix:semicolon
multiline_comment|/* no 656 mode, 8-bit pixels, disable VBI */
id|cx_clear
c_func
(paren
id|MO_OUTPUT_FORMAT
comma
l_int|0x0008
)paren
suffix:semicolon
multiline_comment|/* Normal Y-limits to let the mpeg encoder sync */
macro_line|#if 0 /* FIXME */
id|set_scale
c_func
(paren
id|dev
comma
l_int|720
comma
l_int|480
comma
id|V4L2_FIELD_INTERLACED
)paren
suffix:semicolon
macro_line|#endif
id|blackbird_codec_settings
c_func
(paren
id|dev
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_NUM_VSYNC_LINES, 4, 0, 0xef, 0xef);
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_NUM_VSYNC_LINES
comma
l_int|4
comma
l_int|0
comma
l_int|0xf0
comma
l_int|0xf0
)paren
suffix:semicolon
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_ASSIGN_NUM_VSYNC_LINES, 4, 0, 0x180, 0x180);
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_ASSIGN_PLACEHOLDER
comma
l_int|12
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_INITIALIZE_INPUT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* initialize the video input */
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_MUTE_VIDEO
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_MUTE_AUDIO
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_BEGIN_CAPTURE
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|0x13
)paren
suffix:semicolon
multiline_comment|/* start capturing to the host interface */
singleline_comment|//blackbird_api_cmd(dev, IVTV_API_BEGIN_CAPTURE, 2, 0, 0, 0); /* start capturing to the host interface */
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|dev
comma
id|IVTV_API_REFRESH_INPUT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|bb_buf_setup
r_static
r_int
id|bb_buf_setup
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_int
r_int
op_star
id|count
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|q-&gt;priv_data
suffix:semicolon
id|fh-&gt;dev-&gt;ts_packet_size
op_assign
l_int|512
suffix:semicolon
id|fh-&gt;dev-&gt;ts_packet_count
op_assign
l_int|100
suffix:semicolon
op_star
id|size
op_assign
id|fh-&gt;dev-&gt;ts_packet_size
op_star
id|fh-&gt;dev-&gt;ts_packet_count
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
op_star
id|count
)paren
op_star
id|count
op_assign
id|mpegbufs
suffix:semicolon
r_if
c_cond
(paren
op_star
id|count
OL
l_int|2
)paren
op_star
id|count
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
op_star
id|count
OG
l_int|32
)paren
op_star
id|count
op_assign
l_int|32
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|bb_buf_prepare
id|bb_buf_prepare
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|videobuf_buffer
op_star
id|vb
comma
r_enum
id|v4l2_field
id|field
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|q-&gt;priv_data
suffix:semicolon
r_return
id|cx8802_buf_prepare
c_func
(paren
id|fh-&gt;dev
comma
(paren
r_struct
id|cx88_buffer
op_star
)paren
id|vb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|bb_buf_queue
id|bb_buf_queue
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|videobuf_buffer
op_star
id|vb
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|q-&gt;priv_data
suffix:semicolon
id|cx8802_buf_queue
c_func
(paren
id|fh-&gt;dev
comma
(paren
r_struct
id|cx88_buffer
op_star
)paren
id|vb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|bb_buf_release
id|bb_buf_release
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|videobuf_buffer
op_star
id|vb
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|q-&gt;priv_data
suffix:semicolon
id|cx88_free_buffer
c_func
(paren
id|fh-&gt;dev-&gt;pci
comma
(paren
r_struct
id|cx88_buffer
op_star
)paren
id|vb
)paren
suffix:semicolon
)brace
DECL|variable|blackbird_qops
r_static
r_struct
id|videobuf_queue_ops
id|blackbird_qops
op_assign
(brace
dot
id|buf_setup
op_assign
id|bb_buf_setup
comma
dot
id|buf_prepare
op_assign
id|bb_buf_prepare
comma
dot
id|buf_queue
op_assign
id|bb_buf_queue
comma
dot
id|buf_release
op_assign
id|bb_buf_release
comma
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|mpeg_do_ioctl
r_static
r_int
id|mpeg_do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|cx8802_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|debug
OG
l_int|1
)paren
id|cx88_print_ioctl
c_func
(paren
id|dev-&gt;core-&gt;name
comma
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/* --- capture ioctls ---------------------------------------- */
r_case
id|VIDIOC_ENUM_FMT
suffix:colon
(brace
r_struct
id|v4l2_fmtdesc
op_star
id|f
op_assign
id|arg
suffix:semicolon
r_int
id|index
suffix:semicolon
id|index
op_assign
id|f-&gt;index
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|f-&gt;index
op_assign
id|index
suffix:semicolon
id|strlcpy
c_func
(paren
id|f-&gt;description
comma
l_string|&quot;MPEG TS&quot;
comma
r_sizeof
(paren
id|f-&gt;description
)paren
)paren
suffix:semicolon
id|f-&gt;type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
suffix:semicolon
id|f-&gt;pixelformat
op_assign
id|V4L2_PIX_FMT_MPEG
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_FMT
suffix:colon
r_case
id|VIDIOC_S_FMT
suffix:colon
r_case
id|VIDIOC_TRY_FMT
suffix:colon
(brace
multiline_comment|/* FIXME -- quick&squot;n&squot;dirty for exactly one size ... */
r_struct
id|v4l2_format
op_star
id|f
op_assign
id|arg
suffix:semicolon
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|f-&gt;type
op_assign
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
suffix:semicolon
id|f-&gt;fmt.pix.width
op_assign
l_int|720
suffix:semicolon
id|f-&gt;fmt.pix.height
op_assign
l_int|576
suffix:semicolon
id|f-&gt;fmt.pix.pixelformat
op_assign
id|V4L2_PIX_FMT_MPEG
suffix:semicolon
id|f-&gt;fmt.pix.sizeimage
op_assign
l_int|1024
op_star
l_int|512
multiline_comment|/* FIXME: BUFFER_SIZE */
suffix:semicolon
)brace
multiline_comment|/* --- streaming capture ------------------------------------- */
r_case
id|VIDIOC_REQBUFS
suffix:colon
r_return
id|videobuf_reqbufs
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDIOC_QUERYBUF
suffix:colon
r_return
id|videobuf_querybuf
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDIOC_QBUF
suffix:colon
r_return
id|videobuf_qbuf
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDIOC_DQBUF
suffix:colon
r_return
id|videobuf_dqbuf
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|arg
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
r_case
id|VIDIOC_STREAMON
suffix:colon
r_return
id|videobuf_streamon
c_func
(paren
op_amp
id|fh-&gt;mpegq
)paren
suffix:semicolon
r_case
id|VIDIOC_STREAMOFF
suffix:colon
r_return
id|videobuf_streamoff
c_func
(paren
op_amp
id|fh-&gt;mpegq
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mpeg_ioctl
r_static
r_int
id|mpeg_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|video_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|mpeg_do_ioctl
)paren
suffix:semicolon
)brace
DECL|function|mpeg_open
r_static
r_int
id|mpeg_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|cx8802_dev
op_star
id|h
comma
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|cx8802_fh
op_star
id|fh
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|cx8802_devlist
)paren
(brace
id|h
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|cx8802_dev
comma
id|devlist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;mpeg_dev-&gt;minor
op_eq
id|minor
)paren
id|dev
op_assign
id|h
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|blackbird_initialize_codec
c_func
(paren
id|dev
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;open minor=%d&bslash;n&quot;
comma
id|minor
)paren
suffix:semicolon
multiline_comment|/* allocate + initialize per filehandle data */
id|fh
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|fh
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|fh
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|fh
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fh
)paren
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|fh
suffix:semicolon
id|fh-&gt;dev
op_assign
id|dev
suffix:semicolon
id|videobuf_queue_init
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
op_amp
id|blackbird_qops
comma
id|dev-&gt;pci
comma
op_amp
id|dev-&gt;slock
comma
id|V4L2_BUF_TYPE_VIDEO_CAPTURE
comma
id|V4L2_FIELD_TOP
comma
r_sizeof
(paren
r_struct
id|cx88_buffer
)paren
comma
id|fh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mpeg_release
r_static
r_int
id|mpeg_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|file-&gt;private_data
suffix:semicolon
id|blackbird_api_cmd
c_func
(paren
id|fh-&gt;dev
comma
id|IVTV_API_END_CAPTURE
comma
l_int|3
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0x13
)paren
suffix:semicolon
multiline_comment|/* stop mpeg capture */
r_if
c_cond
(paren
id|fh-&gt;mpegq.streaming
)paren
id|videobuf_streamoff
c_func
(paren
op_amp
id|fh-&gt;mpegq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fh-&gt;mpegq.reading
)paren
id|videobuf_read_stop
c_func
(paren
op_amp
id|fh-&gt;mpegq
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|fh
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|mpeg_read
id|mpeg_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|data
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|file-&gt;private_data
suffix:semicolon
r_return
id|videobuf_read_stream
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|data
comma
id|count
comma
id|ppos
comma
l_int|0
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|mpeg_poll
id|mpeg_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|file-&gt;private_data
suffix:semicolon
r_return
id|videobuf_poll_stream
c_func
(paren
id|file
comma
op_amp
id|fh-&gt;mpegq
comma
id|wait
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|mpeg_mmap
id|mpeg_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|cx8802_fh
op_star
id|fh
op_assign
id|file-&gt;private_data
suffix:semicolon
r_return
id|videobuf_mmap_mapper
c_func
(paren
op_amp
id|fh-&gt;mpegq
comma
id|vma
)paren
suffix:semicolon
)brace
DECL|variable|mpeg_fops
r_static
r_struct
id|file_operations
id|mpeg_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|mpeg_open
comma
dot
id|release
op_assign
id|mpeg_release
comma
dot
id|read
op_assign
id|mpeg_read
comma
dot
id|poll
op_assign
id|mpeg_poll
comma
dot
id|mmap
op_assign
id|mpeg_mmap
comma
dot
id|ioctl
op_assign
id|mpeg_ioctl
comma
dot
id|llseek
op_assign
id|no_llseek
comma
)brace
suffix:semicolon
DECL|variable|cx8802_mpeg_template
r_static
r_struct
id|video_device
id|cx8802_mpeg_template
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;cx8802&quot;
comma
dot
id|type
op_assign
id|VID_TYPE_CAPTURE
op_or
id|VID_TYPE_TUNER
op_or
id|VID_TYPE_SCALES
op_or
id|VID_TYPE_MPEG_ENCODER
comma
dot
id|hardware
op_assign
l_int|0
comma
dot
id|fops
op_assign
op_amp
id|mpeg_fops
comma
dot
id|minor
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
multiline_comment|/* ------------------------------------------------------------------ */
DECL|function|blackbird_unregister_video
r_static
r_void
id|blackbird_unregister_video
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;mpeg_dev
)paren
(brace
r_if
c_cond
(paren
op_minus
l_int|1
op_ne
id|dev-&gt;mpeg_dev-&gt;minor
)paren
id|video_unregister_device
c_func
(paren
id|dev-&gt;mpeg_dev
)paren
suffix:semicolon
r_else
id|video_device_release
c_func
(paren
id|dev-&gt;mpeg_dev
)paren
suffix:semicolon
id|dev-&gt;mpeg_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|blackbird_register_video
r_static
r_int
id|blackbird_register_video
c_func
(paren
r_struct
id|cx8802_dev
op_star
id|dev
)paren
(brace
r_int
id|err
suffix:semicolon
id|dev-&gt;mpeg_dev
op_assign
id|cx88_vdev_init
c_func
(paren
id|dev-&gt;core
comma
id|dev-&gt;pci
comma
op_amp
id|cx8802_mpeg_template
comma
l_string|&quot;mpeg&quot;
)paren
suffix:semicolon
id|err
op_assign
id|video_register_device
c_func
(paren
id|dev-&gt;mpeg_dev
comma
id|VFL_TYPE_GRABBER
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s/2: can&squot;t register mpeg device&bslash;n&quot;
comma
id|dev-&gt;core-&gt;name
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s/2: registered device video%d [mpeg]&bslash;n&quot;
comma
id|dev-&gt;core-&gt;name
comma
id|dev-&gt;mpeg_dev-&gt;minor
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------- */
DECL|function|blackbird_probe
r_static
r_int
id|__devinit
id|blackbird_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_struct
id|cx8802_dev
op_star
id|dev
suffix:semicolon
r_struct
id|cx88_core
op_star
id|core
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* general setup */
id|core
op_assign
id|cx88_core_get
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|core
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cx88_boards
(braket
id|core-&gt;board
)braket
dot
id|blackbird
)paren
r_goto
id|fail_core
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|dev
)paren
r_goto
id|fail_core
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|dev
)paren
)paren
suffix:semicolon
id|dev-&gt;pci
op_assign
id|pci_dev
suffix:semicolon
id|dev-&gt;core
op_assign
id|core
suffix:semicolon
id|err
op_assign
id|cx8802_init_common
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_goto
id|fail_free
suffix:semicolon
multiline_comment|/* blackbird stuff */
id|printk
c_func
(paren
l_string|&quot;%s/2: cx23416 based mpeg encoder (blackbird reference design)&bslash;n&quot;
comma
id|core-&gt;name
)paren
suffix:semicolon
id|host_setup
c_func
(paren
id|dev-&gt;core
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|dev-&gt;devlist
comma
op_amp
id|cx8802_devlist
)paren
suffix:semicolon
id|blackbird_register_video
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail_free
suffix:colon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
id|fail_core
suffix:colon
id|cx88_core_put
c_func
(paren
id|core
comma
id|pci_dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|blackbird_remove
r_static
r_void
id|__devexit
id|blackbird_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|cx8802_dev
op_star
id|dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
multiline_comment|/* blackbird */
id|blackbird_unregister_video
c_func
(paren
id|dev
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|dev-&gt;devlist
)paren
suffix:semicolon
multiline_comment|/* common */
id|cx8802_fini_common
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|variable|cx8802_pci_tbl
r_static
r_struct
id|pci_device_id
id|cx8802_pci_tbl
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
l_int|0x14f1
comma
dot
id|device
op_assign
l_int|0x8802
comma
dot
id|subvendor
op_assign
id|PCI_ANY_ID
comma
dot
id|subdevice
op_assign
id|PCI_ANY_ID
comma
)brace
comma
(brace
multiline_comment|/* --- end of list --- */
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|cx8802_pci_tbl
)paren
suffix:semicolon
DECL|variable|blackbird_pci_driver
r_static
r_struct
id|pci_driver
id|blackbird_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;cx88-blackbird&quot;
comma
dot
id|id_table
op_assign
id|cx8802_pci_tbl
comma
dot
id|probe
op_assign
id|blackbird_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|blackbird_remove
)paren
comma
dot
id|suspend
op_assign
id|cx8802_suspend_common
comma
dot
id|resume
op_assign
id|cx8802_resume_common
comma
)brace
suffix:semicolon
DECL|function|blackbird_init
r_static
r_int
id|blackbird_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cx2388x blackbird driver version %d.%d.%d loaded&bslash;n&quot;
comma
(paren
id|CX88_VERSION_CODE
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
comma
(paren
id|CX88_VERSION_CODE
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|CX88_VERSION_CODE
op_amp
l_int|0xff
)paren
suffix:semicolon
macro_line|#ifdef SNAPSHOT
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cx2388x: snapshot date %04d-%02d-%02d&bslash;n&quot;
comma
id|SNAPSHOT
op_div
l_int|10000
comma
(paren
id|SNAPSHOT
op_div
l_int|100
)paren
op_mod
l_int|100
comma
id|SNAPSHOT
op_mod
l_int|100
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pci_module_init
c_func
(paren
op_amp
id|blackbird_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|blackbird_fini
r_static
r_void
id|blackbird_fini
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|blackbird_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|blackbird_init
id|module_init
c_func
(paren
id|blackbird_init
)paren
suffix:semicolon
DECL|variable|blackbird_fini
id|module_exit
c_func
(paren
id|blackbird_fini
)paren
suffix:semicolon
multiline_comment|/* ----------------------------------------------------------- */
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
