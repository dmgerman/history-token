multiline_comment|/*&n; * Driver for the SAA5246A or SAA5281 Teletext (=Videotext) decoder chips from&n; * Philips.&n; *&n; * Only capturing of Teletext pages is tested. The videotext chips also have a&n; * TV output but my hardware doesn&squot;t use it. For this reason this driver does&n; * not support changing any TV display settings.&n; *&n; * Copyright (C) 2004 Michael Geng &lt;linux@MichaelGeng.de&gt;&n; *&n; * Derived from&n; *&n; * saa5249 driver&n; * Copyright (C) 1998 Richard Guenther&n; * &lt;richard.guenther@student.uni-tuebingen.de&gt;&n; *&n; * with changes by&n; * Alan Cox &lt;Alan.Cox@linux.org&gt;&n; *&n; * and&n; *&n; * vtx.c&n; * Copyright (C) 1994-97 Martin Buck  &lt;martin-2.buck@student.uni-ulm.de&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307,&n; * USA.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/videotext.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &quot;saa5246a.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Michael Geng &lt;linux@MichaelGeng.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Philips SAA5246A, SAA5281 Teletext decoder driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|struct|saa5246a_device
r_struct
id|saa5246a_device
(brace
DECL|member|pgbuf
id|u8
id|pgbuf
(braket
id|NUM_DAUS
)braket
(braket
id|VTX_VIRTUALSIZE
)braket
suffix:semicolon
DECL|member|is_searching
r_int
id|is_searching
(braket
id|NUM_DAUS
)braket
suffix:semicolon
DECL|member|client
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
DECL|member|lock
r_struct
id|semaphore
id|lock
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|saa_template
r_static
r_struct
id|video_device
id|saa_template
suffix:semicolon
multiline_comment|/* Declared near bottom */
multiline_comment|/* Addresses to scan */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
id|I2C_ADDRESS
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_i2c_range
r_static
r_int
r_int
id|normal_i2c_range
(braket
)braket
op_assign
(brace
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|probe
r_static
r_int
r_int
id|probe
(braket
l_int|2
)braket
op_assign
(brace
id|I2C_CLIENT_END
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|probe_range
r_static
r_int
r_int
id|probe_range
(braket
l_int|2
)braket
op_assign
(brace
id|I2C_CLIENT_END
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|ignore
r_static
r_int
r_int
id|ignore
(braket
l_int|2
)braket
op_assign
(brace
id|I2C_CLIENT_END
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|ignore_range
r_static
r_int
r_int
id|ignore_range
(braket
l_int|2
)braket
op_assign
(brace
id|I2C_CLIENT_END
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|force
r_static
r_int
r_int
id|force
(braket
l_int|2
)braket
op_assign
(brace
id|I2C_CLIENT_END
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|addr_data
r_static
r_struct
id|i2c_client_address_data
id|addr_data
op_assign
(brace
id|normal_i2c
comma
id|normal_i2c_range
comma
id|probe
comma
id|probe_range
comma
id|ignore
comma
id|ignore_range
comma
id|force
)brace
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
suffix:semicolon
DECL|function|saa5246a_attach
r_static
r_int
id|saa5246a_attach
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
id|addr
comma
r_int
id|kind
)paren
(brace
r_int
id|pgbuf
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_struct
id|video_device
op_star
id|vd
suffix:semicolon
r_struct
id|saa5246a_device
op_star
id|t
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;saa5246a: teletext chip found.&bslash;n&quot;
)paren
suffix:semicolon
id|client
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|client
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|client
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|client_template.adapter
op_assign
id|adap
suffix:semicolon
id|client_template.addr
op_assign
id|addr
suffix:semicolon
id|memcpy
c_func
(paren
id|client
comma
op_amp
id|client_template
comma
r_sizeof
(paren
op_star
id|client
)paren
)paren
suffix:semicolon
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|t
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|client-&gt;name
comma
id|IF_NAME
comma
id|I2C_NAME_SIZE
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|t-&gt;lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Now create a video4linux device&n;&t; */
id|vd
op_assign
id|video_device_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vd
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|i2c_set_clientdata
c_func
(paren
id|client
comma
id|vd
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|vd
comma
op_amp
id|saa_template
comma
r_sizeof
(paren
op_star
id|vd
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pgbuf
op_assign
l_int|0
suffix:semicolon
id|pgbuf
OL
id|NUM_DAUS
suffix:semicolon
id|pgbuf
op_increment
)paren
(brace
id|memset
c_func
(paren
id|t-&gt;pgbuf
(braket
id|pgbuf
)braket
comma
l_char|&squot; &squot;
comma
r_sizeof
(paren
id|t-&gt;pgbuf
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|t-&gt;is_searching
(braket
id|pgbuf
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
id|vd-&gt;priv
op_assign
id|t
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Register it&n;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|video_register_device
c_func
(paren
id|vd
comma
id|VFL_TYPE_VTX
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
id|video_device_release
c_func
(paren
id|vd
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|t-&gt;client
op_assign
id|client
suffix:semicolon
id|i2c_attach_client
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We do most of the hard work when we become a device on the i2c.&n; */
DECL|function|saa5246a_probe
r_static
r_int
id|saa5246a_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
id|adap
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_TV_ANALOG
)paren
r_return
id|i2c_probe
c_func
(paren
id|adap
comma
op_amp
id|addr_data
comma
id|saa5246a_attach
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|saa5246a_detach
r_static
r_int
id|saa5246a_detach
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|video_device
op_star
id|vd
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|video_unregister_device
c_func
(paren
id|vd
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|vd-&gt;priv
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|saa5246a_command
r_static
r_int
id|saa5246a_command
c_func
(paren
r_struct
id|i2c_client
op_star
id|device
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;I2C interfaces&n; */
DECL|variable|i2c_driver_videotext
r_static
r_struct
id|i2c_driver
id|i2c_driver_videotext
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
id|IF_NAME
comma
multiline_comment|/* name */
dot
id|id
op_assign
id|I2C_DRIVERID_SAA5249
comma
multiline_comment|/* in i2c.h */
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|saa5246a_probe
comma
dot
id|detach_client
op_assign
id|saa5246a_detach
comma
dot
id|command
op_assign
id|saa5246a_command
)brace
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
op_assign
(brace
dot
id|driver
op_assign
op_amp
id|i2c_driver_videotext
comma
dot
id|name
op_assign
l_string|&quot;(unset)&quot;
comma
)brace
suffix:semicolon
DECL|function|i2c_sendbuf
r_static
r_int
id|i2c_sendbuf
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
r_int
id|reg
comma
r_int
id|count
comma
id|u8
op_star
id|data
)paren
(brace
r_char
id|buf
(braket
l_int|64
)braket
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|reg
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
op_plus
l_int|1
comma
id|data
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_master_send
c_func
(paren
id|t-&gt;client
comma
id|buf
comma
id|count
op_plus
l_int|1
)paren
op_eq
id|count
op_plus
l_int|1
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|i2c_senddata
r_static
r_int
id|i2c_senddata
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
dot
dot
dot
)paren
(brace
r_int
r_char
id|buf
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|v
suffix:semicolon
r_int
id|ct
op_assign
l_int|0
suffix:semicolon
id|va_list
id|argp
suffix:semicolon
id|va_start
c_func
(paren
id|argp
comma
id|t
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|v
op_assign
id|va_arg
c_func
(paren
id|argp
comma
r_int
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|buf
(braket
id|ct
op_increment
)braket
op_assign
id|v
suffix:semicolon
)brace
r_return
id|i2c_sendbuf
c_func
(paren
id|t
comma
id|buf
(braket
l_int|0
)braket
comma
id|ct
op_minus
l_int|1
comma
id|buf
op_plus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Get count number of bytes from I&#xfffd;C-device at address adr, store them in buf.&n; * Start &amp; stop handshaking is done by this routine, ack will be sent after the&n; * last byte to inhibit further sending of data. If uaccess is TRUE, data is&n; * written to user-space with put_user. Returns -1 if I&#xfffd;C-device didn&squot;t send&n; * acknowledge, 0 otherwise&n; */
DECL|function|i2c_getdata
r_static
r_int
id|i2c_getdata
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
r_int
id|count
comma
id|u8
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|i2c_master_recv
c_func
(paren
id|t-&gt;client
comma
id|buf
comma
id|count
)paren
op_ne
id|count
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* When a page is found then the not FOUND bit in one of the status registers&n; * of the SAA5264A chip is cleared. Unfortunately this bit is not set&n; * automatically when a new page is requested. Instead this function must be&n; * called after a page has been requested.&n; *&n; * Return value: 0 if successful&n; */
DECL|function|saa5246a_clear_found_bit
r_static
r_int
id|saa5246a_clear_found_bit
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
r_int
r_char
id|dau_no
)paren
(brace
r_int
r_char
id|row_25_column_8
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|dau_no
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|R9_CURSER_ROW_25
comma
id|R10_CURSER_COLUMN_8
comma
id|COMMAND_END
)paren
op_logical_or
id|i2c_getdata
c_func
(paren
id|t
comma
l_int|1
comma
op_amp
id|row_25_column_8
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|row_25_column_8
op_or_assign
id|ROW25_COLUMN8_PAGE_NOT_FOUND
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|dau_no
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|R9_CURSER_ROW_25
comma
id|R10_CURSER_COLUMN_8
comma
id|row_25_column_8
comma
id|COMMAND_END
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Requests one videotext page as described in req. The fields of req are&n; * checked and an error is returned if something is invalid.&n; *&n; * Return value: 0 if successful&n; */
DECL|function|saa5246a_request_page
r_static
r_int
id|saa5246a_request_page
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
id|vtx_pagereq_t
op_star
id|req
)paren
(brace
r_if
c_cond
(paren
id|req-&gt;pagemask
OL
l_int|0
op_logical_or
id|req-&gt;pagemask
op_ge
id|PGMASK_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pagemask
op_amp
id|PGMASK_PAGE
)paren
r_if
c_cond
(paren
id|req-&gt;page
template_param
id|PAGE_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pagemask
op_amp
id|PGMASK_HOUR
)paren
r_if
c_cond
(paren
id|req-&gt;hour
template_param
id|HOUR_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pagemask
op_amp
id|PGMASK_MINUTE
)paren
r_if
c_cond
(paren
id|req-&gt;minute
template_param
id|MINUTE_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pgbuf
OL
l_int|0
op_logical_or
id|req-&gt;pgbuf
op_ge
id|NUM_DAUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R2
comma
id|R2_IN_R3_SELECT_PAGE_HUNDREDS
op_or
id|req-&gt;pgbuf
op_lshift
l_int|4
op_or
id|R2_BANK_0
op_or
id|R2_HAMMING_CHECK_OFF
comma
id|HUNDREDS_OF_PAGE
c_func
(paren
id|req-&gt;page
)paren
op_or
id|R3_HOLD_PAGE
op_or
(paren
id|req-&gt;pagemask
op_amp
id|PG_HUND
ques
c_cond
id|R3_PAGE_HUNDREDS_DO_CARE
suffix:colon
id|R3_PAGE_HUNDREDS_DO_NOT_CARE
)paren
comma
id|TENS_OF_PAGE
c_func
(paren
id|req-&gt;page
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|PG_TEN
ques
c_cond
id|R3_PAGE_TENS_DO_CARE
suffix:colon
id|R3_PAGE_TENS_DO_NOT_CARE
)paren
comma
id|UNITS_OF_PAGE
c_func
(paren
id|req-&gt;page
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|PG_UNIT
ques
c_cond
id|R3_PAGE_UNITS_DO_CARE
suffix:colon
id|R3_PAGE_UNITS_DO_NOT_CARE
)paren
comma
id|TENS_OF_HOUR
c_func
(paren
id|req-&gt;hour
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|HR_TEN
ques
c_cond
id|R3_HOURS_TENS_DO_CARE
suffix:colon
id|R3_HOURS_TENS_DO_NOT_CARE
)paren
comma
id|UNITS_OF_HOUR
c_func
(paren
id|req-&gt;hour
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|HR_UNIT
ques
c_cond
id|R3_HOURS_UNITS_DO_CARE
suffix:colon
id|R3_HOURS_UNITS_DO_NOT_CARE
)paren
comma
id|TENS_OF_MINUTE
c_func
(paren
id|req-&gt;minute
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|MIN_TEN
ques
c_cond
id|R3_MINUTES_TENS_DO_CARE
suffix:colon
id|R3_MINUTES_TENS_DO_NOT_CARE
)paren
comma
id|UNITS_OF_MINUTE
c_func
(paren
id|req-&gt;minute
)paren
op_or
(paren
id|req-&gt;pagemask
op_amp
id|MIN_UNIT
ques
c_cond
id|R3_MINUTES_UNITS_DO_CARE
suffix:colon
id|R3_MINUTES_UNITS_DO_NOT_CARE
)paren
comma
id|COMMAND_END
)paren
op_logical_or
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R2
comma
id|R2_IN_R3_SELECT_PAGE_HUNDREDS
op_or
id|req-&gt;pgbuf
op_lshift
l_int|4
op_or
id|R2_BANK_0
op_or
id|R2_HAMMING_CHECK_OFF
comma
id|HUNDREDS_OF_PAGE
c_func
(paren
id|req-&gt;page
)paren
op_or
id|R3_UPDATE_PAGE
op_or
(paren
id|req-&gt;pagemask
op_amp
id|PG_HUND
ques
c_cond
id|R3_PAGE_HUNDREDS_DO_CARE
suffix:colon
id|R3_PAGE_HUNDREDS_DO_NOT_CARE
)paren
comma
id|COMMAND_END
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|t-&gt;is_searching
(braket
id|req-&gt;pgbuf
)braket
op_assign
id|TRUE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* This routine decodes the page number from the infobits contained in line 25.&n; *&n; * Parameters:&n; * infobits: must be bits 0 to 9 of column 25&n; *&n; * Return value: page number coded in hexadecimal, i. e. page 123 is coded 0x123&n; */
DECL|function|saa5246a_extract_pagenum_from_infobits
r_static
r_inline
r_int
id|saa5246a_extract_pagenum_from_infobits
c_func
(paren
r_int
r_char
id|infobits
(braket
l_int|10
)braket
)paren
(brace
r_int
id|page_hundreds
comma
id|page_tens
comma
id|page_units
suffix:semicolon
id|page_units
op_assign
id|infobits
(braket
l_int|0
)braket
op_amp
id|ROW25_COLUMN0_PAGE_UNITS
suffix:semicolon
id|page_tens
op_assign
id|infobits
(braket
l_int|1
)braket
op_amp
id|ROW25_COLUMN1_PAGE_TENS
suffix:semicolon
id|page_hundreds
op_assign
id|infobits
(braket
l_int|8
)braket
op_amp
id|ROW25_COLUMN8_PAGE_HUNDREDS
suffix:semicolon
multiline_comment|/* page 0x.. means page 8.. */
r_if
c_cond
(paren
id|page_hundreds
op_eq
l_int|0
)paren
id|page_hundreds
op_assign
l_int|8
suffix:semicolon
r_return
(paren
id|page_hundreds
op_lshift
l_int|8
)paren
op_or
(paren
id|page_tens
op_lshift
l_int|4
)paren
op_or
id|page_units
suffix:semicolon
)brace
multiline_comment|/* Decodes the hour from the infobits contained in line 25.&n; *&n; * Parameters:&n; * infobits: must be bits 0 to 9 of column 25&n; *&n; * Return: hour coded in hexadecimal, i. e. 12h is coded 0x12&n; */
DECL|function|saa5246a_extract_hour_from_infobits
r_static
r_inline
r_int
id|saa5246a_extract_hour_from_infobits
c_func
(paren
r_int
r_char
id|infobits
(braket
l_int|10
)braket
)paren
(brace
r_int
id|hour_tens
comma
id|hour_units
suffix:semicolon
id|hour_units
op_assign
id|infobits
(braket
l_int|4
)braket
op_amp
id|ROW25_COLUMN4_HOUR_UNITS
suffix:semicolon
id|hour_tens
op_assign
id|infobits
(braket
l_int|5
)braket
op_amp
id|ROW25_COLUMN5_HOUR_TENS
suffix:semicolon
r_return
(paren
id|hour_tens
op_lshift
l_int|4
)paren
op_or
id|hour_units
suffix:semicolon
)brace
multiline_comment|/* Decodes the minutes from the infobits contained in line 25.&n; *&n; * Parameters:&n; * infobits: must be bits 0 to 9 of column 25&n; *&n; * Return: minutes coded in hexadecimal, i. e. 10min is coded 0x10&n; */
DECL|function|saa5246a_extract_minutes_from_infobits
r_static
r_inline
r_int
id|saa5246a_extract_minutes_from_infobits
c_func
(paren
r_int
r_char
id|infobits
(braket
l_int|10
)braket
)paren
(brace
r_int
id|minutes_tens
comma
id|minutes_units
suffix:semicolon
id|minutes_units
op_assign
id|infobits
(braket
l_int|2
)braket
op_amp
id|ROW25_COLUMN2_MINUTES_UNITS
suffix:semicolon
id|minutes_tens
op_assign
id|infobits
(braket
l_int|3
)braket
op_amp
id|ROW25_COLUMN3_MINUTES_TENS
suffix:semicolon
r_return
(paren
id|minutes_tens
op_lshift
l_int|4
)paren
op_or
id|minutes_units
suffix:semicolon
)brace
multiline_comment|/* Reads the status bits contained in the first 10 columns of the first line&n; * and extracts the information into info.&n; *&n; * Return value: 0 if successful&n; */
DECL|function|saa5246a_get_status
r_static
r_inline
r_int
id|saa5246a_get_status
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
id|vtx_pageinfo_t
op_star
id|info
comma
r_int
r_char
id|dau_no
)paren
(brace
r_int
r_char
id|infobits
(braket
l_int|10
)braket
suffix:semicolon
r_int
id|column
suffix:semicolon
r_if
c_cond
(paren
id|dau_no
op_ge
id|NUM_DAUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|dau_no
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|R9_CURSER_ROW_25
comma
id|R10_CURSER_COLUMN_0
comma
id|COMMAND_END
)paren
op_logical_or
id|i2c_getdata
c_func
(paren
id|t
comma
l_int|10
comma
id|infobits
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|info-&gt;pagenum
op_assign
id|saa5246a_extract_pagenum_from_infobits
c_func
(paren
id|infobits
)paren
suffix:semicolon
id|info-&gt;hour
op_assign
id|saa5246a_extract_hour_from_infobits
c_func
(paren
id|infobits
)paren
suffix:semicolon
id|info-&gt;minute
op_assign
id|saa5246a_extract_minutes_from_infobits
c_func
(paren
id|infobits
)paren
suffix:semicolon
id|info-&gt;charset
op_assign
(paren
(paren
id|infobits
(braket
l_int|7
)braket
op_amp
id|ROW25_COLUMN7_CHARACTER_SET
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
id|info
op_member_access_from_pointer
r_delete
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|3
)braket
op_amp
id|ROW25_COLUMN3_DELETE_PAGE
)paren
suffix:semicolon
id|info-&gt;headline
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|5
)braket
op_amp
id|ROW25_COLUMN5_INSERT_HEADLINE
)paren
suffix:semicolon
id|info-&gt;subtitle
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|5
)braket
op_amp
id|ROW25_COLUMN5_INSERT_SUBTITLE
)paren
suffix:semicolon
id|info-&gt;supp_header
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|6
)braket
op_amp
id|ROW25_COLUMN6_SUPPRESS_HEADER
)paren
suffix:semicolon
id|info-&gt;update
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|6
)braket
op_amp
id|ROW25_COLUMN6_UPDATE_PAGE
)paren
suffix:semicolon
id|info-&gt;inter_seq
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|6
)braket
op_amp
id|ROW25_COLUMN6_INTERRUPTED_SEQUENCE
)paren
suffix:semicolon
id|info-&gt;dis_disp
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|6
)braket
op_amp
id|ROW25_COLUMN6_SUPPRESS_DISPLAY
)paren
suffix:semicolon
id|info-&gt;serial
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|7
)braket
op_amp
id|ROW25_COLUMN7_SERIAL_MODE
)paren
suffix:semicolon
id|info-&gt;notfound
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|8
)braket
op_amp
id|ROW25_COLUMN8_PAGE_NOT_FOUND
)paren
suffix:semicolon
id|info-&gt;pblf
op_assign
op_logical_neg
op_logical_neg
(paren
id|infobits
(braket
l_int|9
)braket
op_amp
id|ROW25_COLUMN9_PAGE_BEING_LOOKED_FOR
)paren
suffix:semicolon
id|info-&gt;hamming
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|column
op_assign
l_int|0
suffix:semicolon
id|column
op_le
l_int|7
suffix:semicolon
id|column
op_increment
)paren
(brace
r_if
c_cond
(paren
id|infobits
(braket
id|column
)braket
op_amp
id|ROW25_COLUMN0_TO_7_HAMMING_ERROR
)paren
(brace
id|info-&gt;hamming
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|info-&gt;hamming
op_logical_and
op_logical_neg
id|info-&gt;notfound
)paren
id|t-&gt;is_searching
(braket
id|dau_no
)braket
op_assign
id|FALSE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Reads 1 videotext page buffer of the SAA5246A.&n; *&n; * req is used both as input and as output. It contains information which part&n; * must be read. The videotext page is copied into req-&gt;buffer.&n; *&n; * Return value: 0 if successful&n; */
DECL|function|saa5246a_get_page
r_static
r_inline
r_int
id|saa5246a_get_page
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
id|vtx_pagereq_t
op_star
id|req
)paren
(brace
r_int
id|start
comma
id|end
comma
id|size
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pgbuf
OL
l_int|0
op_logical_or
id|req-&gt;pgbuf
op_ge
id|NUM_DAUS
op_logical_or
id|req-&gt;start
template_param
id|req-&gt;end
op_logical_or
id|req-&gt;end
op_ge
id|VTX_PAGESIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|VTX_PAGESIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* Read &quot;normal&quot; part of page */
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
id|end
op_assign
id|min
c_func
(paren
id|req-&gt;end
comma
id|VTX_PAGESIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|req-&gt;pgbuf
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|ROW
c_func
(paren
id|req-&gt;start
)paren
comma
id|COLUMN
c_func
(paren
id|req-&gt;start
)paren
comma
id|COMMAND_END
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|i2c_getdata
c_func
(paren
id|t
comma
id|end
op_minus
id|req-&gt;start
op_plus
l_int|1
comma
id|buf
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|req-&gt;buffer
comma
id|buf
comma
id|end
op_minus
id|req-&gt;start
op_plus
l_int|1
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Always get the time from buffer 4, since this stupid SAA5246A only&n;&t; * updates the currently displayed buffer...&n;&t; */
r_if
c_cond
(paren
id|REQ_CONTAINS_TIME
c_func
(paren
id|req
)paren
)paren
(brace
id|start
op_assign
id|max
c_func
(paren
id|req-&gt;start
comma
id|POS_TIME_START
)paren
suffix:semicolon
id|end
op_assign
id|min
c_func
(paren
id|req-&gt;end
comma
id|POS_TIME_END
)paren
suffix:semicolon
id|size
op_assign
id|end
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|R8_ACTIVE_CHAPTER_4
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|R9_CURSER_ROW_0
comma
id|start
comma
id|COMMAND_END
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|i2c_getdata
c_func
(paren
id|t
comma
id|size
comma
id|buf
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|req-&gt;buffer
op_plus
id|start
op_minus
id|req-&gt;start
comma
id|buf
comma
id|size
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Insert the header from buffer 4 only, if acquisition circuit is still searching for a page */
r_if
c_cond
(paren
id|REQ_CONTAINS_HEADER
c_func
(paren
id|req
)paren
op_logical_and
id|t-&gt;is_searching
(braket
id|req-&gt;pgbuf
)braket
)paren
(brace
id|start
op_assign
id|max
c_func
(paren
id|req-&gt;start
comma
id|POS_HEADER_START
)paren
suffix:semicolon
id|end
op_assign
id|min
c_func
(paren
id|req-&gt;end
comma
id|POS_HEADER_END
)paren
suffix:semicolon
id|size
op_assign
id|end
op_minus
id|start
op_plus
l_int|1
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R8
comma
id|R8_ACTIVE_CHAPTER_4
op_or
id|R8_DO_NOT_CLEAR_MEMORY
comma
id|R9_CURSER_ROW_0
comma
id|start
comma
id|COMMAND_END
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|i2c_getdata
c_func
(paren
id|t
comma
id|end
op_minus
id|start
op_plus
l_int|1
comma
id|buf
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|req-&gt;buffer
op_plus
id|start
op_minus
id|req-&gt;start
comma
id|buf
comma
id|size
)paren
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Stops the acquisition circuit given in dau_no. The page buffer associated&n; * with this acquisition circuit will no more be updated. The other daus are&n; * not affected.&n; *&n; * Return value: 0 if successful&n; */
DECL|function|saa5246a_stop_dau
r_static
r_inline
r_int
id|saa5246a_stop_dau
c_func
(paren
r_struct
id|saa5246a_device
op_star
id|t
comma
r_int
r_char
id|dau_no
)paren
(brace
r_if
c_cond
(paren
id|dau_no
op_ge
id|NUM_DAUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R2
comma
id|R2_IN_R3_SELECT_PAGE_HUNDREDS
op_or
id|dau_no
op_lshift
l_int|4
op_or
id|R2_BANK_0
op_or
id|R2_HAMMING_CHECK_OFF
comma
id|R3_PAGE_HUNDREDS_0
op_or
id|R3_HOLD_PAGE
op_or
id|R3_PAGE_HUNDREDS_DO_NOT_CARE
comma
id|COMMAND_END
)paren
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|t-&gt;is_searching
(braket
id|dau_no
)braket
op_assign
id|FALSE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*  Handles ioctls defined in videotext.h&n; *&n; *  Returns 0 if successful&n; */
DECL|function|do_saa5246a_ioctl
r_static
r_int
id|do_saa5246a_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|video_device
op_star
id|vd
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|saa5246a_device
op_star
id|t
op_assign
id|vd-&gt;priv
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VTXIOCGETINFO
suffix:colon
(brace
id|vtx_info_t
op_star
id|info
op_assign
id|arg
suffix:semicolon
id|info-&gt;version_major
op_assign
id|MAJOR_VERSION
suffix:semicolon
id|info-&gt;version_minor
op_assign
id|MINOR_VERSION
suffix:semicolon
id|info-&gt;numpages
op_assign
id|NUM_DAUS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VTXIOCCLRPAGE
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pgbuf
OL
l_int|0
op_logical_or
id|req-&gt;pgbuf
op_ge
id|NUM_DAUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|t-&gt;pgbuf
(braket
id|req-&gt;pgbuf
)braket
comma
l_char|&squot; &squot;
comma
r_sizeof
(paren
id|t-&gt;pgbuf
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VTXIOCCLRFOUND
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;pgbuf
OL
l_int|0
op_logical_or
id|req-&gt;pgbuf
op_ge
id|NUM_DAUS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|saa5246a_clear_found_bit
c_func
(paren
id|t
comma
id|req-&gt;pgbuf
)paren
suffix:semicolon
)brace
r_case
id|VTXIOCPAGEREQ
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
r_return
id|saa5246a_request_page
c_func
(paren
id|t
comma
id|req
)paren
suffix:semicolon
)brace
r_case
id|VTXIOCGETSTAT
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
id|vtx_pageinfo_t
id|info
suffix:semicolon
r_int
id|rval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rval
op_assign
id|saa5246a_get_status
c_func
(paren
id|t
comma
op_amp
id|info
comma
id|req-&gt;pgbuf
)paren
)paren
)paren
r_return
id|rval
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|req-&gt;buffer
comma
op_amp
id|info
comma
r_sizeof
(paren
id|vtx_pageinfo_t
)paren
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VTXIOCGETPAGE
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
r_return
id|saa5246a_get_page
c_func
(paren
id|t
comma
id|req
)paren
suffix:semicolon
)brace
r_case
id|VTXIOCSTOPDAU
suffix:colon
(brace
id|vtx_pagereq_t
op_star
id|req
op_assign
id|arg
suffix:semicolon
r_return
id|saa5246a_stop_dau
c_func
(paren
id|t
comma
id|req-&gt;pgbuf
)paren
suffix:semicolon
)brace
r_case
id|VTXIOCPUTPAGE
suffix:colon
r_case
id|VTXIOCSETDISP
suffix:colon
r_case
id|VTXIOCPUTSTAT
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|VTXIOCCLRCACHE
suffix:colon
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VTXIOCSETVIRT
suffix:colon
(brace
multiline_comment|/* I do not know what &quot;virtual mode&quot; means */
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * Translates old vtx IOCTLs to new ones&n; *&n; * This keeps new kernel versions compatible with old userspace programs.&n; */
DECL|function|vtx_fix_command
r_static
r_inline
r_int
r_int
id|vtx_fix_command
c_func
(paren
r_int
r_int
id|cmd
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VTXIOCGETINFO_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCGETINFO
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCCLRPAGE_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCCLRPAGE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCCLRFOUND_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCCLRFOUND
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCPAGEREQ_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCPAGEREQ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCGETSTAT_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCGETSTAT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCGETPAGE_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCGETPAGE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCSTOPDAU_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCSTOPDAU
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCPUTPAGE_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCPUTPAGE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCSETDISP_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCSETDISP
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCPUTSTAT_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCPUTSTAT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCCLRCACHE_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCCLRCACHE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VTXIOCSETVIRT_OLD
suffix:colon
id|cmd
op_assign
id|VTXIOCSETVIRT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|cmd
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Handle the locking&n; */
DECL|function|saa5246a_ioctl
r_static
r_int
id|saa5246a_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|video_device
op_star
id|vd
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|saa5246a_device
op_star
id|t
op_assign
id|vd-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|cmd
op_assign
id|vtx_fix_command
c_func
(paren
id|cmd
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|t-&gt;lock
)paren
suffix:semicolon
id|err
op_assign
id|video_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|do_saa5246a_ioctl
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|t-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|saa5246a_open
r_static
r_int
id|saa5246a_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|video_device
op_star
id|vd
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|saa5246a_device
op_star
id|t
op_assign
id|vd-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|video_exclusive_open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;client
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R0
comma
id|R0_SELECT_R11
op_or
id|R0_PLL_TIME_CONSTANT_LONG
op_or
id|R0_ENABLE_nODD_EVEN_OUTPUT
op_or
id|R0_ENABLE_HDR_POLL
op_or
id|R0_DO_NOT_FORCE_nODD_EVEN_LOW_IF_PICTURE_DISPLAYED
op_or
id|R0_NO_FREE_RUN_PLL
op_or
id|R0_NO_AUTOMATIC_FASTEXT_PROMPT
comma
id|R1_NON_INTERLACED_312_312_LINES
op_or
id|R1_DEW
op_or
id|R1_EXTENDED_PACKET_DISABLE
op_or
id|R1_DAUS_ALL_ON
op_or
id|R1_8_BITS_NO_PARITY
op_or
id|R1_VCS_TO_SCS
comma
id|COMMAND_END
)paren
op_logical_or
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R4
comma
multiline_comment|/* We do not care much for the TV display but nevertheless we&n;&t;&t; * need the currently displayed page later because only on that&n;&t;&t; * page the time is updated. */
id|R4_DISPLAY_PAGE_4
comma
id|COMMAND_END
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|video_exclusive_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|saa5246a_release
r_static
r_int
id|saa5246a_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|video_device
op_star
id|vd
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|saa5246a_device
op_star
id|t
op_assign
id|vd-&gt;priv
suffix:semicolon
multiline_comment|/* Stop all acquisition circuits. */
id|i2c_senddata
c_func
(paren
id|t
comma
id|SAA5246A_REGISTER_R1
comma
id|R1_INTERLACED_312_AND_HALF_312_AND_HALF_LINES
op_or
id|R1_DEW
op_or
id|R1_EXTENDED_PACKET_DISABLE
op_or
id|R1_DAUS_ALL_OFF
op_or
id|R1_8_BITS_NO_PARITY
op_or
id|R1_VCS_TO_SCS
comma
id|COMMAND_END
)paren
suffix:semicolon
id|video_exclusive_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|init_saa_5246a
r_static
r_int
id|__init
id|init_saa_5246a
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SAA5246A (or compatible) Teletext decoder driver version %d.%d&bslash;n&quot;
comma
id|MAJOR_VERSION
comma
id|MINOR_VERSION
)paren
suffix:semicolon
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|i2c_driver_videotext
)paren
suffix:semicolon
)brace
DECL|function|cleanup_saa_5246a
r_static
r_void
id|__exit
id|cleanup_saa_5246a
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|i2c_driver_videotext
)paren
suffix:semicolon
)brace
DECL|variable|init_saa_5246a
id|module_init
c_func
(paren
id|init_saa_5246a
)paren
suffix:semicolon
DECL|variable|cleanup_saa_5246a
id|module_exit
c_func
(paren
id|cleanup_saa_5246a
)paren
suffix:semicolon
DECL|variable|saa_fops
r_static
r_struct
id|file_operations
id|saa_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|saa5246a_open
comma
dot
id|release
op_assign
id|saa5246a_release
comma
dot
id|ioctl
op_assign
id|saa5246a_ioctl
comma
dot
id|llseek
op_assign
id|no_llseek
comma
)brace
suffix:semicolon
DECL|variable|saa_template
r_static
r_struct
id|video_device
id|saa_template
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
id|IF_NAME
comma
dot
id|type
op_assign
id|VID_TYPE_TELETEXT
comma
dot
id|hardware
op_assign
id|VID_HARDWARE_SAA5249
comma
dot
id|fops
op_assign
op_amp
id|saa_fops
comma
dot
id|release
op_assign
id|video_device_release
comma
dot
id|minor
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
eof
