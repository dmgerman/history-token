multiline_comment|/*&n; * Colour AR M64278(VGA) driver for Video4Linux&n; *&n; * Copyright (C) 2003&t;Takeo Takahashi &lt;takahashi.takeo@renesas.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; *&n; * Some code is taken from AR driver sample program for M3T-M32700UT.&n; *&n; * AR driver sample (M32R SDK):&n; *     Copyright (c) 2003 RENESAS TECHNOROGY CORPORATION&n; *     AND RENESAS SOLUTIONS CORPORATION&n; *     All Rights Reserved.&n; *&n; * 2003-09-01:&t;Support w3cam by Takeo Takahashi&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/m32r.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#if 0
mdefine_line|#define DEBUG(n, args...) printk(args)
mdefine_line|#define CHECK_LOST&t;1
macro_line|#else
DECL|macro|DEBUG
mdefine_line|#define DEBUG(n, args...)
DECL|macro|CHECK_LOST
mdefine_line|#define CHECK_LOST&t;0
macro_line|#endif
multiline_comment|/*&n; * USE_INT is always 0, interrupt mode is not available&n; * on linux due to lack of speed&n; */
DECL|macro|USE_INT
mdefine_line|#define USE_INT&t;&t;0&t;/* Don&squot;t modify */
DECL|macro|VERSION
mdefine_line|#define VERSION&t;&quot;0.03&quot;
DECL|macro|ar_inl
mdefine_line|#define ar_inl(addr) &t;&t;inl((unsigned long)(addr))
DECL|macro|ar_outl
mdefine_line|#define ar_outl(val, addr)&t;outl((unsigned long)(val),(unsigned long)(addr))
r_extern
r_struct
id|cpuinfo_m32r
id|boot_cpu_data
suffix:semicolon
multiline_comment|/*&n; * CCD pixel size&n; *&t;Note that M32700UT does not support CIF mode, but QVGA is&n; *&t;supported by M32700UT hardware using VGA mode of AR LSI.&n; *&n; * &t;Supported: VGA  (Normal mode, Interlace mode)&n; *&t;&t;   QVGA (Always Interlace mode of VGA)&n; *&n; */
DECL|macro|AR_WIDTH_VGA
mdefine_line|#define AR_WIDTH_VGA&t;&t;640
DECL|macro|AR_HEIGHT_VGA
mdefine_line|#define AR_HEIGHT_VGA&t;&t;480
DECL|macro|AR_WIDTH_QVGA
mdefine_line|#define AR_WIDTH_QVGA&t;&t;320
DECL|macro|AR_HEIGHT_QVGA
mdefine_line|#define AR_HEIGHT_QVGA&t;&t;240
DECL|macro|MIN_AR_WIDTH
mdefine_line|#define MIN_AR_WIDTH&t;&t;AR_WIDTH_QVGA
DECL|macro|MIN_AR_HEIGHT
mdefine_line|#define MIN_AR_HEIGHT&t;&t;AR_HEIGHT_QVGA
DECL|macro|MAX_AR_WIDTH
mdefine_line|#define MAX_AR_WIDTH&t;&t;AR_WIDTH_VGA
DECL|macro|MAX_AR_HEIGHT
mdefine_line|#define MAX_AR_HEIGHT&t;&t;AR_HEIGHT_VGA
multiline_comment|/* bits &amp; bytes per pixel */
DECL|macro|AR_BITS_PER_PIXEL
mdefine_line|#define AR_BITS_PER_PIXEL&t;16
DECL|macro|AR_BYTES_PER_PIXEL
mdefine_line|#define AR_BYTES_PER_PIXEL&t;(AR_BITS_PER_PIXEL/8)
multiline_comment|/* line buffer size */
DECL|macro|AR_LINE_BYTES_VGA
mdefine_line|#define AR_LINE_BYTES_VGA&t;(AR_WIDTH_VGA * AR_BYTES_PER_PIXEL)
DECL|macro|AR_LINE_BYTES_QVGA
mdefine_line|#define AR_LINE_BYTES_QVGA&t;(AR_WIDTH_QVGA * AR_BYTES_PER_PIXEL)
DECL|macro|MAX_AR_LINE_BYTES
mdefine_line|#define MAX_AR_LINE_BYTES&t;AR_LINE_BYTES_VGA
multiline_comment|/* frame size &amp; type */
DECL|macro|AR_FRAME_BYTES_VGA
mdefine_line|#define AR_FRAME_BYTES_VGA &bslash;&n;&t;(AR_WIDTH_VGA * AR_HEIGHT_VGA * AR_BYTES_PER_PIXEL)
DECL|macro|AR_FRAME_BYTES_QVGA
mdefine_line|#define AR_FRAME_BYTES_QVGA &bslash;&n;&t;(AR_WIDTH_QVGA * AR_HEIGHT_QVGA * AR_BYTES_PER_PIXEL)
DECL|macro|MAX_AR_FRAME_BYTES
mdefine_line|#define MAX_AR_FRAME_BYTES &bslash;&n;&t;(MAX_AR_WIDTH * MAX_AR_HEIGHT * AR_BYTES_PER_PIXEL)
DECL|macro|AR_MAX_FRAME
mdefine_line|#define AR_MAX_FRAME&t;&t;15
multiline_comment|/* capture size */
DECL|macro|AR_SIZE_VGA
mdefine_line|#define AR_SIZE_VGA&t;&t;0
DECL|macro|AR_SIZE_QVGA
mdefine_line|#define AR_SIZE_QVGA&t;&t;1
multiline_comment|/* capture mode */
DECL|macro|AR_MODE_INTERLACE
mdefine_line|#define AR_MODE_INTERLACE&t;0
DECL|macro|AR_MODE_NORMAL
mdefine_line|#define AR_MODE_NORMAL&t;&t;1
DECL|struct|ar_device
r_struct
id|ar_device
(brace
DECL|member|vdev
r_struct
id|video_device
op_star
id|vdev
suffix:semicolon
DECL|member|start_capture
r_int
r_int
id|start_capture
suffix:semicolon
multiline_comment|/* duaring capture in INT. mode. */
macro_line|#if USE_INT
DECL|member|line_buff
r_int
r_char
op_star
id|line_buff
suffix:semicolon
multiline_comment|/* DMA line buffer */
macro_line|#endif
DECL|member|frame
r_int
r_char
op_star
id|frame
(braket
id|MAX_AR_HEIGHT
)braket
suffix:semicolon
multiline_comment|/* frame data */
DECL|member|size
r_int
id|size
suffix:semicolon
multiline_comment|/* capture size */
DECL|member|mode
r_int
id|mode
suffix:semicolon
multiline_comment|/* capture mode */
DECL|member|width
DECL|member|height
r_int
id|width
comma
id|height
suffix:semicolon
DECL|member|frame_bytes
DECL|member|line_bytes
r_int
id|frame_bytes
comma
id|line_bytes
suffix:semicolon
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|lock
r_struct
id|semaphore
id|lock
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|video_nr
r_static
r_int
id|video_nr
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* video device number (first free) */
DECL|variable|yuv
r_static
r_int
r_char
id|yuv
(braket
id|MAX_AR_FRAME_BYTES
)braket
suffix:semicolon
multiline_comment|/* module parameters */
multiline_comment|/* default frequency */
DECL|macro|DEFAULT_FREQ
mdefine_line|#define DEFAULT_FREQ&t;50&t;/* 50 or 75 (MHz) is available as BCLK */
DECL|variable|freq
r_static
r_int
id|freq
op_assign
id|DEFAULT_FREQ
suffix:semicolon
multiline_comment|/* BCLK: available 50 or 70 (MHz) */
DECL|variable|vga
r_static
r_int
id|vga
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* default mode(0:QVGA mode, other:VGA mode) */
DECL|variable|vga_interlace
r_static
r_int
id|vga_interlace
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0 is normal mode for, else interlace mode */
id|MODULE_PARM
c_func
(paren
id|freq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vga
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|vga_interlace
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
r_static
r_int
id|ar_initialize
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
suffix:semicolon
DECL|function|wait_for_vsync
r_static
r_inline
r_void
id|wait_for_vsync
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|ar_inl
c_func
(paren
id|ARVCR0
)paren
op_amp
id|ARVCR0_VDS
)paren
multiline_comment|/* wait for VSYNC */
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|ar_inl
c_func
(paren
id|ARVCR0
)paren
op_amp
id|ARVCR0_VDS
)paren
)paren
multiline_comment|/* wait for VSYNC */
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|wait_acknowledge
r_static
r_inline
r_void
id|wait_acknowledge
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
suffix:semicolon
id|i
op_increment
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ar_inl
c_func
(paren
id|PLDI2CSTS
)paren
op_amp
id|PLDI2CSTS_NOACK
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************&n; * I2C functions&n; *******************************************************************/
DECL|function|iic
r_void
id|iic
c_func
(paren
r_int
id|n
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|data1
comma
r_int
r_int
id|data2
comma
r_int
r_int
id|data3
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Slave Address */
id|ar_outl
c_func
(paren
id|addr
comma
id|PLDI2CDATA
)paren
suffix:semicolon
id|wait_for_vsync
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Start */
id|ar_outl
c_func
(paren
l_int|1
comma
id|PLDI2CCND
)paren
suffix:semicolon
id|wait_acknowledge
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Transfer data 1 */
id|ar_outl
c_func
(paren
id|data1
comma
id|PLDI2CDATA
)paren
suffix:semicolon
id|wait_for_vsync
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|PLDI2CSTEN_STEN
comma
id|PLDI2CSTEN
)paren
suffix:semicolon
id|wait_acknowledge
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Transfer data 2 */
id|ar_outl
c_func
(paren
id|data2
comma
id|PLDI2CDATA
)paren
suffix:semicolon
id|wait_for_vsync
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|PLDI2CSTEN_STEN
comma
id|PLDI2CSTEN
)paren
suffix:semicolon
id|wait_acknowledge
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
l_int|3
)paren
(brace
multiline_comment|/* Transfer data 3 */
id|ar_outl
c_func
(paren
id|data3
comma
id|PLDI2CDATA
)paren
suffix:semicolon
id|wait_for_vsync
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|PLDI2CSTEN_STEN
comma
id|PLDI2CSTEN
)paren
suffix:semicolon
id|wait_acknowledge
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Stop */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|2
comma
id|PLDI2CCND
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|2
comma
id|PLDI2CCND
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ar_inl
c_func
(paren
id|PLDI2CSTS
)paren
op_amp
id|PLDI2CSTS_BB
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|init_iic
r_void
id|init_iic
c_func
(paren
r_void
)paren
(brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;init_iic:&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ICU Setting (iic)&n;&t; */
multiline_comment|/* I2C Setting */
id|ar_outl
c_func
(paren
l_int|0x0
comma
id|PLDI2CCR
)paren
suffix:semicolon
multiline_comment|/* I2CCR Disable                   */
id|ar_outl
c_func
(paren
l_int|0x0300
comma
id|PLDI2CMOD
)paren
suffix:semicolon
multiline_comment|/* I2CMOD ACK/8b-data/7b-addr/auto */
id|ar_outl
c_func
(paren
l_int|0x1
comma
id|PLDI2CACK
)paren
suffix:semicolon
multiline_comment|/* I2CACK ACK                      */
multiline_comment|/* I2C CLK */
multiline_comment|/* 50MH-100k */
r_if
c_cond
(paren
id|freq
op_eq
l_int|75
)paren
(brace
id|ar_outl
c_func
(paren
l_int|369
comma
id|PLDI2CFREQ
)paren
suffix:semicolon
multiline_comment|/* BCLK = 75MHz */
)brace
r_else
r_if
c_cond
(paren
id|freq
op_eq
l_int|50
)paren
(brace
id|ar_outl
c_func
(paren
l_int|244
comma
id|PLDI2CFREQ
)paren
suffix:semicolon
multiline_comment|/* BCLK = 50MHz */
)brace
r_else
(brace
id|ar_outl
c_func
(paren
l_int|244
comma
id|PLDI2CFREQ
)paren
suffix:semicolon
multiline_comment|/* default: BCLK = 50MHz */
)brace
id|ar_outl
c_func
(paren
l_int|0x1
comma
id|PLDI2CCR
)paren
suffix:semicolon
multiline_comment|/* I2CCR Enable */
)brace
multiline_comment|/**************************************************************************&n; *&n; * Video4Linux Interface functions&n; *&n; **************************************************************************/
DECL|function|disable_dma
r_static
r_inline
r_void
id|disable_dma
c_func
(paren
r_void
)paren
(brace
id|ar_outl
c_func
(paren
l_int|0x8000
comma
id|M32R_DMAEN_PORTL
)paren
suffix:semicolon
multiline_comment|/* disable DMA0 */
)brace
DECL|function|enable_dma
r_static
r_inline
r_void
id|enable_dma
c_func
(paren
r_void
)paren
(brace
id|ar_outl
c_func
(paren
l_int|0x8080
comma
id|M32R_DMAEN_PORTL
)paren
suffix:semicolon
multiline_comment|/* enable DMA0 */
)brace
DECL|function|clear_dma_status
r_static
r_inline
r_void
id|clear_dma_status
c_func
(paren
r_void
)paren
(brace
id|ar_outl
c_func
(paren
l_int|0x8000
comma
id|M32R_DMAEDET_PORTL
)paren
suffix:semicolon
multiline_comment|/* clear status */
)brace
DECL|function|wait_for_vertical_sync
r_static
r_inline
r_void
id|wait_for_vertical_sync
c_func
(paren
r_int
id|exp_line
)paren
(brace
macro_line|#if CHECK_LOST
r_int
id|tmout
op_assign
l_int|10000
suffix:semicolon
multiline_comment|/* FIXME */
r_int
id|l
suffix:semicolon
multiline_comment|/*&n;&t; * check HCOUNT because we cannot check vertical sync.&n; &t; */
r_for
c_loop
(paren
suffix:semicolon
id|tmout
op_ge
l_int|0
suffix:semicolon
id|tmout
op_decrement
)paren
(brace
id|l
op_assign
id|ar_inl
c_func
(paren
id|ARVHCOUNT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
op_eq
id|exp_line
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmout
OL
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;arv: lost %d -&gt; %d&bslash;n&quot;
comma
id|exp_line
comma
id|l
)paren
suffix:semicolon
macro_line|#else
r_while
c_loop
(paren
id|ar_inl
c_func
(paren
id|ARVHCOUNT
)paren
op_ne
id|exp_line
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|ar_read
r_static
id|ssize_t
id|ar_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|video_device
op_star
id|v
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|ar_device
op_star
id|ar
op_assign
id|v-&gt;priv
suffix:semicolon
r_int
id|ret
op_assign
id|ar-&gt;frame_bytes
suffix:semicolon
multiline_comment|/* return read bytes */
r_int
r_int
id|arvcr1
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_int
id|h
comma
id|w
suffix:semicolon
r_int
r_char
op_star
id|py
comma
op_star
id|pu
comma
op_star
id|pv
suffix:semicolon
macro_line|#if ! USE_INT
r_int
id|l
suffix:semicolon
macro_line|#endif
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ar_read()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;size
op_eq
id|AR_SIZE_QVGA
)paren
id|arvcr1
op_or_assign
id|ARVCR1_QVGA
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;mode
op_eq
id|AR_MODE_NORMAL
)paren
id|arvcr1
op_or_assign
id|ARVCR1_NORMAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
macro_line|#if USE_INT
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0xa1871300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0x01000000
comma
id|M32R_DMA0CR1_PORTL
)paren
suffix:semicolon
multiline_comment|/* set AR FIFO address as source(BSEL5) */
id|ar_outl
c_func
(paren
id|ARDATA32
comma
id|M32R_DMA0CSA_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ARDATA32
comma
id|M32R_DMA0RSA_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ar-&gt;line_buff
comma
id|M32R_DMA0CDA_PORTL
)paren
suffix:semicolon
multiline_comment|/* destination addr. */
id|ar_outl
c_func
(paren
id|ar-&gt;line_buff
comma
id|M32R_DMA0RDA_PORTL
)paren
suffix:semicolon
multiline_comment|/* reload address */
id|ar_outl
c_func
(paren
id|ar-&gt;line_bytes
comma
id|M32R_DMA0CBCUT_PORTL
)paren
suffix:semicolon
multiline_comment|/* byte count (bytes) */
id|ar_outl
c_func
(paren
id|ar-&gt;line_bytes
comma
id|M32R_DMA0RBCUT_PORTL
)paren
suffix:semicolon
multiline_comment|/* reload count (bytes) */
multiline_comment|/*&n;&t; * Okey , kicks AR LSI to invoke an interrupt&n;&t; */
id|ar-&gt;start_capture
op_assign
l_int|0
suffix:semicolon
id|ar_outl
c_func
(paren
id|arvcr1
op_or
id|ARVCR1_HIEN
comma
id|ARVCR1
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* .... AR interrupts .... */
id|interruptible_sleep_on
c_func
(paren
op_amp
id|ar-&gt;wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: interrupted while get frame data.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINTR
suffix:semicolon
r_goto
id|out_up
suffix:semicolon
)brace
macro_line|#else&t;/* ! USE_INT */
multiline_comment|/* polling */
id|ar_outl
c_func
(paren
id|arvcr1
comma
id|ARVCR1
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0x8000
comma
id|M32R_DMAEDET_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0xa0861300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0x01000000
comma
id|M32R_DMA0CR1_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ARDATA32
comma
id|M32R_DMA0CSA_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ARDATA32
comma
id|M32R_DMA0RSA_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ar-&gt;line_bytes
comma
id|M32R_DMA0CBCUT_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ar-&gt;line_bytes
comma
id|M32R_DMA0RBCUT_PORTL
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ar_inl
c_func
(paren
id|ARVHCOUNT
)paren
op_ne
l_int|0
)paren
multiline_comment|/* wait for 0 */
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;mode
op_eq
id|AR_MODE_INTERLACE
op_logical_and
id|ar-&gt;size
op_eq
id|AR_SIZE_VGA
)paren
(brace
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|ar-&gt;height
suffix:semicolon
id|h
op_increment
)paren
(brace
id|wait_for_vertical_sync
c_func
(paren
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h
OL
(paren
id|AR_HEIGHT_VGA
op_div
l_int|2
)paren
)paren
id|l
op_assign
id|h
op_lshift
l_int|1
suffix:semicolon
r_else
id|l
op_assign
(paren
(paren
(paren
id|h
op_minus
(paren
id|AR_HEIGHT_VGA
op_div
l_int|2
)paren
)paren
op_lshift
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|virt_to_phys
c_func
(paren
id|ar-&gt;frame
(braket
id|l
)braket
)paren
comma
id|M32R_DMA0CDA_PORTL
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|ar_inl
c_func
(paren
id|M32R_DMAEDET_PORTL
)paren
op_amp
l_int|0x8000
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
id|clear_dma_status
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0xa0861300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|ar-&gt;height
suffix:semicolon
id|h
op_increment
)paren
(brace
id|wait_for_vertical_sync
c_func
(paren
id|h
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|virt_to_phys
c_func
(paren
id|ar-&gt;frame
(braket
id|h
)braket
)paren
comma
id|M32R_DMA0CDA_PORTL
)paren
suffix:semicolon
id|enable_dma
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|ar_inl
c_func
(paren
id|M32R_DMAEDET_PORTL
)paren
op_amp
l_int|0x8000
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
id|clear_dma_status
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0xa0861300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
)brace
)brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#endif&t;/* ! USE_INT */
multiline_comment|/*&n;&t; * convert YUV422 to YUV422P&n;&t; * &t;+--------------------+&n;&t; *&t;|  Y0,Y1,...&t;     |&n;&t; *&t;|  ..............Yn  |&n;&t; *&t;+--------------------+&n;&t; *&t;|  U0,U1,........Un  |&n;&t; *&t;+--------------------+&n;&t; *&t;|  V0,V1,........Vn  |&n;&t; *&t;+--------------------+&n;&t; */
id|py
op_assign
id|yuv
suffix:semicolon
id|pu
op_assign
id|py
op_plus
(paren
id|ar-&gt;frame_bytes
op_div
l_int|2
)paren
suffix:semicolon
id|pv
op_assign
id|pu
op_plus
(paren
id|ar-&gt;frame_bytes
op_div
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|h
op_assign
l_int|0
suffix:semicolon
id|h
OL
id|ar-&gt;height
suffix:semicolon
id|h
op_increment
)paren
(brace
id|p
op_assign
id|ar-&gt;frame
(braket
id|h
)braket
suffix:semicolon
r_for
c_loop
(paren
id|w
op_assign
l_int|0
suffix:semicolon
id|w
OL
id|ar-&gt;line_bytes
suffix:semicolon
id|w
op_add_assign
l_int|4
)paren
(brace
op_star
id|py
op_increment
op_assign
op_star
id|p
op_increment
suffix:semicolon
op_star
id|pu
op_increment
op_assign
op_star
id|p
op_increment
suffix:semicolon
op_star
id|py
op_increment
op_assign
op_star
id|p
op_increment
suffix:semicolon
op_star
id|pv
op_increment
op_assign
op_star
id|p
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|yuv
comma
id|ar-&gt;frame_bytes
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: failed while copy_to_user yuv.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out_up
suffix:semicolon
)brace
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ret = %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
id|out_up
suffix:colon
id|up
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ar_do_ioctl
r_static
r_int
id|ar_do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|video_device
op_star
id|dev
op_assign
id|video_devdata
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|ar_device
op_star
id|ar
op_assign
id|dev-&gt;priv
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ar_ioctl()&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOCGCAP
suffix:colon
(brace
r_struct
id|video_capability
op_star
id|b
op_assign
id|arg
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGCAP:&bslash;n&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|b-&gt;name
comma
id|ar-&gt;vdev-&gt;name
)paren
suffix:semicolon
id|b-&gt;type
op_assign
id|VID_TYPE_CAPTURE
suffix:semicolon
id|b-&gt;channels
op_assign
l_int|0
suffix:semicolon
id|b-&gt;audios
op_assign
l_int|0
suffix:semicolon
id|b-&gt;maxwidth
op_assign
id|MAX_AR_WIDTH
suffix:semicolon
id|b-&gt;maxheight
op_assign
id|MAX_AR_HEIGHT
suffix:semicolon
id|b-&gt;minwidth
op_assign
id|MIN_AR_WIDTH
suffix:semicolon
id|b-&gt;minheight
op_assign
id|MIN_AR_HEIGHT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGCHAN
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGCHAN:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCSCHAN
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSCHAN:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCGTUNER
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGTUNER:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCSTUNER
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSTUNER:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCGPICT
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGPICT:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCSPICT
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSPICT:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCCAPTURE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCCAPTURE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGWIN
suffix:colon
(brace
r_struct
id|video_window
op_star
id|w
op_assign
id|arg
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGWIN:&bslash;n&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|w
comma
l_int|0
comma
r_sizeof
(paren
id|w
)paren
)paren
suffix:semicolon
id|w-&gt;width
op_assign
id|ar-&gt;width
suffix:semicolon
id|w-&gt;height
op_assign
id|ar-&gt;height
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSWIN
suffix:colon
(brace
r_struct
id|video_window
op_star
id|w
op_assign
id|arg
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSWIN:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|w-&gt;width
op_ne
id|AR_WIDTH_VGA
op_logical_or
id|w-&gt;height
op_ne
id|AR_HEIGHT_VGA
)paren
op_logical_and
(paren
id|w-&gt;width
op_ne
id|AR_WIDTH_QVGA
op_logical_or
id|w-&gt;height
op_ne
id|AR_HEIGHT_QVGA
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
id|ar-&gt;width
op_assign
id|w-&gt;width
suffix:semicolon
id|ar-&gt;height
op_assign
id|w-&gt;height
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;width
op_eq
id|AR_WIDTH_VGA
)paren
(brace
id|ar-&gt;size
op_assign
id|AR_SIZE_VGA
suffix:semicolon
id|ar-&gt;frame_bytes
op_assign
id|AR_FRAME_BYTES_VGA
suffix:semicolon
id|ar-&gt;line_bytes
op_assign
id|AR_LINE_BYTES_VGA
suffix:semicolon
r_if
c_cond
(paren
id|vga_interlace
)paren
id|ar-&gt;mode
op_assign
id|AR_MODE_INTERLACE
suffix:semicolon
r_else
id|ar-&gt;mode
op_assign
id|AR_MODE_NORMAL
suffix:semicolon
)brace
r_else
(brace
id|ar-&gt;size
op_assign
id|AR_SIZE_QVGA
suffix:semicolon
id|ar-&gt;frame_bytes
op_assign
id|AR_FRAME_BYTES_QVGA
suffix:semicolon
id|ar-&gt;line_bytes
op_assign
id|AR_LINE_BYTES_QVGA
suffix:semicolon
id|ar-&gt;mode
op_assign
id|AR_MODE_INTERLACE
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGFBUF
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGFBUF:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSFBUF
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSFBUF:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCKEY
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCKEY:&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDIOCGFREQ
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGFREQ:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSFREQ
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSFREQ:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGAUDIO
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGAUDIO:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSAUDIO
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSAUDIO:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSYNC
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSYNC:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCMCAPTURE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCMCAPTURE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGMBUF
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGMBUF:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGUNIT
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGUNIT:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGCAPTURE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGCAPTURE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSCAPTURE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSCAPTURE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSPLAYMODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSPLAYMODE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSWRITEMODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSWRITEMODE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGPLAYINFO
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGPLAYINFO:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSMICROCODE
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSMICROCODE:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCGVBIFMT
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCGVBIFMT:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|VIDIOCSVBIFMT
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOCSVBIFMT:&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_default
suffix:colon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;Unknown ioctl(0x%08x)&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ar_ioctl
r_static
r_int
id|ar_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|video_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|ar_do_ioctl
)paren
suffix:semicolon
)brace
macro_line|#if USE_INT
multiline_comment|/*&n; * Interrupt handler&n; */
DECL|function|ar_interrupt
r_static
r_void
id|ar_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|ar_device
op_star
id|ar
op_assign
id|dev
suffix:semicolon
r_int
r_int
id|line_count
suffix:semicolon
r_int
r_int
id|line_number
suffix:semicolon
r_int
r_int
id|arvcr1
suffix:semicolon
id|line_count
op_assign
id|ar_inl
c_func
(paren
id|ARVHCOUNT
)paren
suffix:semicolon
multiline_comment|/* line number */
r_if
c_cond
(paren
id|ar-&gt;mode
op_eq
id|AR_MODE_INTERLACE
op_logical_and
id|ar-&gt;size
op_eq
id|AR_SIZE_VGA
)paren
(brace
multiline_comment|/* operations for interlace mode */
r_if
c_cond
(paren
id|line_count
OL
(paren
id|AR_HEIGHT_VGA
op_div
l_int|2
)paren
)paren
multiline_comment|/* even line */
id|line_number
op_assign
(paren
id|line_count
op_lshift
l_int|1
)paren
suffix:semicolon
r_else
multiline_comment|/* odd line */
id|line_number
op_assign
(paren
(paren
(paren
id|line_count
op_minus
(paren
id|AR_HEIGHT_VGA
op_div
l_int|2
)paren
)paren
op_lshift
l_int|1
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|line_number
op_assign
id|line_count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line_number
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * It is an interrupt for line 0.&n;&t;&t; * we have to start capture.&n;&t;&t; */
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|ar_outl
c_func
(paren
id|ar-&gt;line_buff
comma
id|M32R_DMA0CDA_PORTL
)paren
suffix:semicolon
multiline_comment|/* needless? */
macro_line|#endif
id|memcpy
c_func
(paren
id|ar-&gt;frame
(braket
l_int|0
)braket
comma
id|ar-&gt;line_buff
comma
id|ar-&gt;line_bytes
)paren
suffix:semicolon
macro_line|#if 0
id|ar_outl
c_func
(paren
l_int|0xa1861300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
macro_line|#endif
id|enable_dma
c_func
(paren
)paren
suffix:semicolon
id|ar-&gt;start_capture
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* during capture */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ar-&gt;start_capture
op_eq
l_int|1
op_logical_and
id|line_number
op_le
(paren
id|ar-&gt;height
op_minus
l_int|1
)paren
)paren
(brace
id|disable_dma
c_func
(paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ar-&gt;frame
(braket
id|line_number
)braket
comma
id|ar-&gt;line_buff
comma
id|ar-&gt;line_bytes
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * if captured all line of a frame, disable AR interrupt&n;&t;&t; * and wake a process up.&n;&t;&t; */
r_if
c_cond
(paren
id|line_number
op_eq
(paren
id|ar-&gt;height
op_minus
l_int|1
)paren
)paren
(brace
multiline_comment|/* end  of line */
id|ar-&gt;start_capture
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disable AR interrupt request */
id|arvcr1
op_assign
id|ar_inl
c_func
(paren
id|ARVCR1
)paren
suffix:semicolon
id|arvcr1
op_and_assign
op_complement
id|ARVCR1_HIEN
suffix:semicolon
multiline_comment|/* clear int. flag */
id|ar_outl
c_func
(paren
id|arvcr1
comma
id|ARVCR1
)paren
suffix:semicolon
multiline_comment|/* disable */
id|wake_up_interruptible
c_func
(paren
op_amp
id|ar-&gt;wait
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#if 0
id|ar_outl
c_func
(paren
id|ar-&gt;line_buff
comma
id|M32R_DMA0CDA_PORTL
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
l_int|0xa1861300
comma
id|M32R_DMA0CR0_PORTL
)paren
suffix:semicolon
macro_line|#endif
id|enable_dma
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * ar_initialize()&n; * &t;ar_initialize() is called by video_register_device() and&n; *&t;initializes AR LSI and peripherals.&n; *&n; *&t;-1 is returned in all failures.&n; *&t;0 is returned in success.&n; *&n; */
DECL|function|ar_initialize
r_static
r_int
id|ar_initialize
c_func
(paren
r_struct
id|video_device
op_star
id|dev
)paren
(brace
r_struct
id|ar_device
op_star
id|ar
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|cr
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|found
op_assign
l_int|0
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ar_initialize:&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * initialize AR LSI&n;&t; */
id|ar_outl
c_func
(paren
l_int|0
comma
id|ARVCR0
)paren
suffix:semicolon
multiline_comment|/* assert reset of AR LSI */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x18
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* wait for over 10 cycles @ 27MHz */
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|ar_outl
c_func
(paren
id|ARVCR0_RST
comma
id|ARVCR0
)paren
suffix:semicolon
multiline_comment|/* negate reset of AR LSI (enable) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x40d
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* wait for over 420 cycles @ 27MHz */
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* AR uses INT3 of CPU as interrupt pin. */
id|ar_outl
c_func
(paren
id|ARINTSEL_INT3
comma
id|ARINTSEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;size
op_eq
id|AR_SIZE_QVGA
)paren
id|cr
op_or_assign
id|ARVCR1_QVGA
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;mode
op_eq
id|AR_MODE_NORMAL
)paren
id|cr
op_or_assign
id|ARVCR1_NORMAL
suffix:semicolon
id|ar_outl
c_func
(paren
id|cr
comma
id|ARVCR1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialize IIC so that CPU can communicate with AR LSI,&n;&t; * and send boot commands to AR LSI.&n;&t; */
id|init_iic
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x100000
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* &gt; 0xa1d10,  56ms */
r_if
c_cond
(paren
(paren
id|ar_inl
c_func
(paren
id|ARVCR0
)paren
op_amp
id|ARVCR0_VDS
)paren
)paren
(brace
multiline_comment|/* VSYNC */
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;arv: Initializing &quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x11
comma
l_int|0x01
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* start */
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x00
comma
l_int|0x06
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x12
comma
l_int|0x30
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x15
comma
l_int|0x58
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x17
comma
l_int|0x30
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x1a
comma
l_int|0x97
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x1b
comma
l_int|0xff
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x1c
comma
l_int|0xff
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x26
comma
l_int|0x10
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x12
comma
l_int|0x27
comma
l_int|0x00
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x34
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x7a
comma
l_int|0x10
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x80
comma
l_int|0x39
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x81
comma
l_int|0xe6
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x8d
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x8e
comma
l_int|0x0c
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x8f
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#if 0
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x90
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* AWB on=1 off=0 */
macro_line|#endif
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x93
comma
l_int|0x01
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x94
comma
l_int|0xcd
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x95
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x96
comma
l_int|0xa0
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x97
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x98
comma
l_int|0x60
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x99
comma
l_int|0x01
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x9a
comma
l_int|0x19
comma
l_int|0x00
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x9b
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x9c
comma
l_int|0xe8
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x9d
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x9e
comma
l_int|0x2e
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0xb8
comma
l_int|0x78
comma
l_int|0x00
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0xba
comma
l_int|0x05
comma
l_int|0x00
)paren
suffix:semicolon
macro_line|#if 0
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x83
comma
l_int|0x8c
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* brightness */
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
multiline_comment|/* color correction */
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x00
comma
l_int|0x95
)paren
suffix:semicolon
multiline_comment|/* a&t;&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x01
comma
l_int|0x96
)paren
suffix:semicolon
multiline_comment|/* b&t;&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x03
comma
l_int|0x85
)paren
suffix:semicolon
multiline_comment|/* c&t;&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x04
comma
l_int|0x97
)paren
suffix:semicolon
multiline_comment|/* d&t;&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x02
comma
l_int|0x7e
)paren
suffix:semicolon
multiline_comment|/* e(Lo)&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x05
comma
l_int|0xa4
)paren
suffix:semicolon
multiline_comment|/* f(Lo)&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x06
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* e(Hi)&t;*/
id|iic
c_func
(paren
l_int|3
comma
l_int|0x78
comma
l_int|0x49
comma
l_int|0x07
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* e(Hi)&t;*/
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x48
comma
l_int|0x01
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* on=1 off=0&t;*/
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|iic
c_func
(paren
l_int|2
comma
l_int|0x78
comma
l_int|0x11
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* end */
id|printk
c_func
(paren
l_string|&quot; done&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ar_release
r_void
id|ar_release
c_func
(paren
r_struct
id|video_device
op_star
id|vfd
)paren
(brace
r_struct
id|ar_device
op_star
id|ar
op_assign
id|vfd-&gt;priv
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
id|video_device_release
c_func
(paren
id|vfd
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * Video4Linux Module functions&n; *&n; ****************************************************************************/
DECL|variable|ar_fops
r_static
r_struct
id|file_operations
id|ar_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|video_exclusive_open
comma
dot
id|release
op_assign
id|video_exclusive_release
comma
dot
id|read
op_assign
id|ar_read
comma
dot
id|ioctl
op_assign
id|ar_ioctl
comma
dot
id|llseek
op_assign
id|no_llseek
comma
)brace
suffix:semicolon
DECL|variable|ar_template
r_static
r_struct
id|video_device
id|ar_template
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;Colour AR VGA&quot;
comma
dot
id|type
op_assign
id|VID_TYPE_CAPTURE
comma
dot
id|hardware
op_assign
id|VID_HARDWARE_ARV
comma
dot
id|fops
op_assign
op_amp
id|ar_fops
comma
dot
id|release
op_assign
id|ar_release
comma
dot
id|minor
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|macro|ALIGN4
mdefine_line|#define ALIGN4(x)&t;((((int)(x)) &amp; 0x3) == 0)
DECL|variable|ardev
r_static
r_struct
id|ar_device
id|ardev
suffix:semicolon
DECL|function|ar_init
r_static
r_int
id|__init
id|ar_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|ar_device
op_star
id|ar
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DEBUG
c_func
(paren
l_int|1
comma
l_string|&quot;ar_init:&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;arv: Colour AR VGA driver %s&bslash;n&quot;
comma
id|VERSION
)paren
suffix:semicolon
id|ar
op_assign
op_amp
id|ardev
suffix:semicolon
id|memset
c_func
(paren
id|ar
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ar_device
)paren
)paren
suffix:semicolon
macro_line|#if USE_INT
multiline_comment|/* allocate a DMA buffer for 1 line.  */
id|ar-&gt;line_buff
op_assign
id|kmalloc
c_func
(paren
id|MAX_AR_LINE_BYTES
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;line_buff
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|ALIGN4
c_func
(paren
id|ar-&gt;line_buff
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: buffer allocation failed for DMA.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_end
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* allocate buffers for a frame */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_AR_HEIGHT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ar-&gt;frame
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
id|MAX_AR_LINE_BYTES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ar-&gt;frame
(braket
id|i
)braket
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|ALIGN4
c_func
(paren
id|ar-&gt;frame
(braket
id|i
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: buffer allocation failed for frame.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_line_buff
suffix:semicolon
)brace
)brace
id|ar-&gt;vdev
op_assign
id|video_device_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ar-&gt;vdev
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;arv: video_device_alloc() failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|ar-&gt;vdev
comma
op_amp
id|ar_template
comma
r_sizeof
(paren
id|ar_template
)paren
)paren
suffix:semicolon
id|ar-&gt;vdev-&gt;priv
op_assign
id|ar
suffix:semicolon
r_if
c_cond
(paren
id|vga
)paren
(brace
id|ar-&gt;width
op_assign
id|AR_WIDTH_VGA
suffix:semicolon
id|ar-&gt;height
op_assign
id|AR_HEIGHT_VGA
suffix:semicolon
id|ar-&gt;size
op_assign
id|AR_SIZE_VGA
suffix:semicolon
id|ar-&gt;frame_bytes
op_assign
id|AR_FRAME_BYTES_VGA
suffix:semicolon
id|ar-&gt;line_bytes
op_assign
id|AR_LINE_BYTES_VGA
suffix:semicolon
r_if
c_cond
(paren
id|vga_interlace
)paren
id|ar-&gt;mode
op_assign
id|AR_MODE_INTERLACE
suffix:semicolon
r_else
id|ar-&gt;mode
op_assign
id|AR_MODE_NORMAL
suffix:semicolon
)brace
r_else
(brace
id|ar-&gt;width
op_assign
id|AR_WIDTH_QVGA
suffix:semicolon
id|ar-&gt;height
op_assign
id|AR_HEIGHT_QVGA
suffix:semicolon
id|ar-&gt;size
op_assign
id|AR_SIZE_QVGA
suffix:semicolon
id|ar-&gt;frame_bytes
op_assign
id|AR_FRAME_BYTES_QVGA
suffix:semicolon
id|ar-&gt;line_bytes
op_assign
id|AR_LINE_BYTES_QVGA
suffix:semicolon
id|ar-&gt;mode
op_assign
id|AR_MODE_INTERLACE
suffix:semicolon
)brace
id|init_MUTEX
c_func
(paren
op_amp
id|ar-&gt;lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|ar-&gt;wait
)paren
suffix:semicolon
macro_line|#if USE_INT
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|M32R_IRQ_INT3
comma
id|ar_interrupt
comma
l_int|0
comma
l_string|&quot;arv&quot;
comma
id|ar
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: request_irq(%d) failed.&bslash;n&quot;
comma
id|M32R_IRQ_INT3
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out_irq
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ar_initialize
c_func
(paren
id|ar-&gt;vdev
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;arv: M64278 not found.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out_dev
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * ok, we can initialize h/w according to parameters,&n;&t; * so register video device as a frame grabber type.&n;&t; * device is named &quot;video[0-64]&quot;.&n;&t; * video_register_device() initializes h/w using ar_initialize().&n; &t; */
r_if
c_cond
(paren
id|video_register_device
c_func
(paren
id|ar-&gt;vdev
comma
id|VFL_TYPE_GRABBER
comma
id|video_nr
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* return -1, -ENFILE(full) or others */
id|printk
c_func
(paren
l_string|&quot;arv: register video (Colour AR) failed.&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out_dev
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;video%d: Found M64278 VGA (IRQ %d, Freq %dMHz).&bslash;n&quot;
comma
id|ar-&gt;vdev-&gt;minor
comma
id|M32R_IRQ_INT3
comma
id|freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_dev
suffix:colon
macro_line|#if USE_INT
id|free_irq
c_func
(paren
id|M32R_IRQ_INT3
comma
id|ar
)paren
suffix:semicolon
id|out_irq
suffix:colon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_AR_HEIGHT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ar-&gt;frame
(braket
id|i
)braket
)paren
id|kfree
c_func
(paren
id|ar-&gt;frame
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|out_line_buff
suffix:colon
macro_line|#if USE_INT
id|kfree
c_func
(paren
id|ar-&gt;line_buff
)paren
suffix:semicolon
id|out_end
suffix:colon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ar_init_module
r_static
r_int
id|__init
id|ar_init_module
c_func
(paren
r_void
)paren
(brace
id|freq
op_assign
(paren
id|boot_cpu_data.bus_clock
op_div
l_int|1000000
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;arv: Bus clock %d&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|freq
op_ne
l_int|50
op_logical_and
id|freq
op_ne
l_int|75
)paren
id|freq
op_assign
id|DEFAULT_FREQ
suffix:semicolon
r_return
id|ar_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ar_cleanup_module
r_static
r_void
id|__exit
id|ar_cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|ar_device
op_star
id|ar
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ar
op_assign
op_amp
id|ardev
suffix:semicolon
id|video_unregister_device
c_func
(paren
id|ar-&gt;vdev
)paren
suffix:semicolon
macro_line|#if USE_INT
id|free_irq
c_func
(paren
id|M32R_IRQ_INT3
comma
id|ar
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_AR_HEIGHT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ar-&gt;frame
(braket
id|i
)braket
)paren
id|kfree
c_func
(paren
id|ar-&gt;frame
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#if USE_INT
id|kfree
c_func
(paren
id|ar-&gt;line_buff
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|ar_init_module
id|module_init
c_func
(paren
id|ar_init_module
)paren
suffix:semicolon
DECL|variable|ar_cleanup_module
id|module_exit
c_func
(paren
id|ar_cleanup_module
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Takeo Takahashi &lt;takahashi.takeo@renesas.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Colour AR M64278(VGA) for Video4Linux&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
