multiline_comment|/*&n; * Zoran ZR36050 basic configuration functions&n; *&n; * Copyright (C) 2001 Wolfgang Scherr &lt;scherr@net4you.at&gt;&n; *&n; * $Id: zr36050.c,v 1.1.2.11 2003/08/03 14:54:53 rbultje Exp $&n; *&n; * ------------------------------------------------------------------------&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * ------------------------------------------------------------------------&n; */
DECL|macro|ZR050_VERSION
mdefine_line|#define ZR050_VERSION &quot;v0.7.1&quot;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
multiline_comment|/* includes for structures and defines regarding video &n;   #include&lt;linux/videodev.h&gt; */
multiline_comment|/* I/O commands, error codes */
macro_line|#include&lt;asm/io.h&gt;
singleline_comment|//#include&lt;errno.h&gt;
multiline_comment|/* headerfile of this module */
macro_line|#include&quot;zr36050.h&quot;
multiline_comment|/* codec io API */
macro_line|#include&quot;videocodec.h&quot;
multiline_comment|/* it doesn&squot;t make sense to have more than 20 or so,&n;  just to prevent some unwanted loops */
DECL|macro|MAX_CODECS
mdefine_line|#define MAX_CODECS 20
multiline_comment|/* amount of chips attached via this driver */
DECL|variable|zr36050_codecs
r_static
r_int
id|zr36050_codecs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* debugging is available via module parameter */
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Debug level (0-4)&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(num, format, args...) &bslash;&n;&t;do { &bslash;&n;&t;&t;if (debug &gt;= num) &bslash;&n;&t;&t;&t;printk(format, ##args); &bslash;&n;&t;} while (0)
multiline_comment|/* =========================================================================&n;   Local hardware I/O functions:&n;&n;   read/write via codec layer (registers are located in the master device)&n;   ========================================================================= */
multiline_comment|/* read and write functions */
r_static
id|u8
DECL|function|zr36050_read
id|zr36050_read
(paren
r_struct
id|zr36050
op_star
id|ptr
comma
id|u16
id|reg
)paren
(brace
id|u8
id|value
op_assign
l_int|0
suffix:semicolon
singleline_comment|// just in case something is wrong...
r_if
c_cond
(paren
id|ptr-&gt;codec-&gt;master_data-&gt;readreg
)paren
id|value
op_assign
(paren
id|ptr-&gt;codec-&gt;master_data
op_member_access_from_pointer
id|readreg
c_func
(paren
id|ptr-&gt;codec
comma
id|reg
)paren
)paren
op_amp
l_int|0xFF
suffix:semicolon
r_else
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: invalid I/O setup, nothing read!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%s: reading from 0x%04x: %02x&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|reg
comma
id|value
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
r_static
r_void
DECL|function|zr36050_write
id|zr36050_write
(paren
r_struct
id|zr36050
op_star
id|ptr
comma
id|u16
id|reg
comma
id|u8
id|value
)paren
(brace
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%s: writing 0x%02x to 0x%04x&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|value
comma
id|reg
)paren
suffix:semicolon
singleline_comment|// just in case something is wrong...
r_if
c_cond
(paren
id|ptr-&gt;codec-&gt;master_data-&gt;writereg
)paren
id|ptr-&gt;codec-&gt;master_data
op_member_access_from_pointer
id|writereg
c_func
(paren
id|ptr-&gt;codec
comma
id|reg
comma
id|value
)paren
suffix:semicolon
r_else
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: invalid I/O setup, nothing written!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Local helper function:&n;&n;   status read&n;   ========================================================================= */
multiline_comment|/* status is kept in datastructure */
r_static
id|u8
DECL|function|zr36050_read_status1
id|zr36050_read_status1
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
id|ptr-&gt;status1
op_assign
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_STATUS_1
)paren
suffix:semicolon
id|zr36050_read
c_func
(paren
id|ptr
comma
l_int|0
)paren
suffix:semicolon
r_return
id|ptr-&gt;status1
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Local helper function:&n;&n;   scale factor read&n;   ========================================================================= */
multiline_comment|/* scale factor is kept in datastructure */
r_static
id|u16
DECL|function|zr36050_read_scalefactor
id|zr36050_read_scalefactor
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
id|ptr-&gt;scalefact
op_assign
(paren
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SF_HI
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SF_LO
)paren
op_amp
l_int|0xFF
)paren
suffix:semicolon
multiline_comment|/* leave 0 selected for an eventually GO from master */
id|zr36050_read
c_func
(paren
id|ptr
comma
l_int|0
)paren
suffix:semicolon
r_return
id|ptr-&gt;scalefact
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Local helper function:&n;&n;   wait if codec is ready to proceed (end of processing) or time is over&n;   ========================================================================= */
r_static
r_void
DECL|function|zr36050_wait_end
id|zr36050_wait_end
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|zr36050_read_status1
c_func
(paren
id|ptr
)paren
op_amp
l_int|0x4
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_increment
OG
l_int|200000
)paren
(brace
singleline_comment|// 200ms, there is for shure something wrong!!!
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: timout at wait_end (last status: 0x%02x)&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|ptr-&gt;status1
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* =========================================================================&n;   Local helper function:&n;&n;   basic test of &quot;connectivity&quot;, writes/reads to/from memory the SOF marker &n;   ========================================================================= */
r_static
r_int
DECL|function|zr36050_basic_test
id|zr36050_basic_test
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
comma
l_int|0x00
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
op_plus
l_int|1
comma
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
)paren
op_or
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
op_plus
l_int|1
)paren
)paren
op_ne
l_int|0x0000
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: attach failed, can&squot;t connect to jpeg processor!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
comma
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
op_plus
l_int|1
comma
l_int|0xc0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
)paren
op_lshift
l_int|8
)paren
op_or
id|zr36050_read
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
op_plus
l_int|1
)paren
)paren
op_ne
l_int|0xffc0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: attach failed, can&squot;t connect to jpeg processor!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|zr36050_wait_end
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status1
op_amp
l_int|0x4
)paren
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: attach failed, jpeg processor failed (end flag)!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/* looks good! */
)brace
multiline_comment|/* =========================================================================&n;   Local helper function:&n;&n;   simple loop for pushing the init datasets&n;   ========================================================================= */
r_static
r_int
DECL|function|zr36050_pushit
id|zr36050_pushit
(paren
r_struct
id|zr36050
op_star
id|ptr
comma
id|u16
id|startreg
comma
id|u16
id|len
comma
r_const
r_char
op_star
id|data
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%s: write data block to 0x%04x (len=%d)&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|startreg
comma
id|len
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|len
)paren
(brace
id|zr36050_write
c_func
(paren
id|ptr
comma
id|startreg
op_increment
comma
id|data
(braket
id|i
op_increment
)braket
)paren
suffix:semicolon
)brace
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Basic datasets:&n;&n;   jpeg baseline setup data (you find it on lots places in internet, or just&n;   extract it from any regular .jpg image...)&n;&n;   Could be variable, but until it&squot;s not needed it they are just fixed to save&n;   memory. Otherwise expand zr36050 structure with arrays, push the values to&n;   it and initalize from there, as e.g. the linux zr36057/60 driver does it.&n;   ========================================================================= */
DECL|variable|zr36050_dqt
r_static
r_const
r_char
id|zr36050_dqt
(braket
l_int|0x86
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xdb
comma
singleline_comment|//Marker: DQT
l_int|0x00
comma
l_int|0x84
comma
singleline_comment|//Length: 2*65+2
l_int|0x00
comma
singleline_comment|//Pq,Tq first table
l_int|0x10
comma
l_int|0x0b
comma
l_int|0x0c
comma
l_int|0x0e
comma
l_int|0x0c
comma
l_int|0x0a
comma
l_int|0x10
comma
l_int|0x0e
comma
l_int|0x0d
comma
l_int|0x0e
comma
l_int|0x12
comma
l_int|0x11
comma
l_int|0x10
comma
l_int|0x13
comma
l_int|0x18
comma
l_int|0x28
comma
l_int|0x1a
comma
l_int|0x18
comma
l_int|0x16
comma
l_int|0x16
comma
l_int|0x18
comma
l_int|0x31
comma
l_int|0x23
comma
l_int|0x25
comma
l_int|0x1d
comma
l_int|0x28
comma
l_int|0x3a
comma
l_int|0x33
comma
l_int|0x3d
comma
l_int|0x3c
comma
l_int|0x39
comma
l_int|0x33
comma
l_int|0x38
comma
l_int|0x37
comma
l_int|0x40
comma
l_int|0x48
comma
l_int|0x5c
comma
l_int|0x4e
comma
l_int|0x40
comma
l_int|0x44
comma
l_int|0x57
comma
l_int|0x45
comma
l_int|0x37
comma
l_int|0x38
comma
l_int|0x50
comma
l_int|0x6d
comma
l_int|0x51
comma
l_int|0x57
comma
l_int|0x5f
comma
l_int|0x62
comma
l_int|0x67
comma
l_int|0x68
comma
l_int|0x67
comma
l_int|0x3e
comma
l_int|0x4d
comma
l_int|0x71
comma
l_int|0x79
comma
l_int|0x70
comma
l_int|0x64
comma
l_int|0x78
comma
l_int|0x5c
comma
l_int|0x65
comma
l_int|0x67
comma
l_int|0x63
comma
l_int|0x01
comma
singleline_comment|//Pq,Tq second table
l_int|0x11
comma
l_int|0x12
comma
l_int|0x12
comma
l_int|0x18
comma
l_int|0x15
comma
l_int|0x18
comma
l_int|0x2f
comma
l_int|0x1a
comma
l_int|0x1a
comma
l_int|0x2f
comma
l_int|0x63
comma
l_int|0x42
comma
l_int|0x38
comma
l_int|0x42
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
comma
l_int|0x63
)brace
suffix:semicolon
DECL|variable|zr36050_dht
r_static
r_const
r_char
id|zr36050_dht
(braket
l_int|0x1a4
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xc4
comma
singleline_comment|//Marker: DHT
l_int|0x01
comma
l_int|0xa2
comma
singleline_comment|//Length: 2*AC, 2*DC
l_int|0x00
comma
singleline_comment|//DC first table
l_int|0x00
comma
l_int|0x01
comma
l_int|0x05
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x01
comma
singleline_comment|//DC second table
l_int|0x00
comma
l_int|0x03
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x06
comma
l_int|0x07
comma
l_int|0x08
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x0B
comma
l_int|0x10
comma
singleline_comment|//AC first table
l_int|0x00
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x03
comma
l_int|0x03
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x05
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x7D
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x11
comma
l_int|0x05
comma
l_int|0x12
comma
l_int|0x21
comma
l_int|0x31
comma
l_int|0x41
comma
l_int|0x06
comma
l_int|0x13
comma
l_int|0x51
comma
l_int|0x61
comma
l_int|0x07
comma
l_int|0x22
comma
l_int|0x71
comma
l_int|0x14
comma
l_int|0x32
comma
l_int|0x81
comma
l_int|0x91
comma
l_int|0xA1
comma
l_int|0x08
comma
l_int|0x23
comma
l_int|0x42
comma
l_int|0xB1
comma
l_int|0xC1
comma
l_int|0x15
comma
l_int|0x52
comma
l_int|0xD1
comma
l_int|0xF0
comma
l_int|0x24
comma
l_int|0x33
comma
l_int|0x62
comma
l_int|0x72
comma
l_int|0x82
comma
l_int|0x09
comma
l_int|0x0A
comma
l_int|0x16
comma
l_int|0x17
comma
l_int|0x18
comma
l_int|0x19
comma
l_int|0x1A
comma
l_int|0x25
comma
l_int|0x26
comma
l_int|0x27
comma
l_int|0x28
comma
l_int|0x29
comma
l_int|0x2A
comma
l_int|0x34
comma
l_int|0x35
comma
l_int|0x36
comma
l_int|0x37
comma
l_int|0x38
comma
l_int|0x39
comma
l_int|0x3A
comma
l_int|0x43
comma
l_int|0x44
comma
l_int|0x45
comma
l_int|0x46
comma
l_int|0x47
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x4A
comma
l_int|0x53
comma
l_int|0x54
comma
l_int|0x55
comma
l_int|0x56
comma
l_int|0x57
comma
l_int|0x58
comma
l_int|0x59
comma
l_int|0x5A
comma
l_int|0x63
comma
l_int|0x64
comma
l_int|0x65
comma
l_int|0x66
comma
l_int|0x67
comma
l_int|0x68
comma
l_int|0x69
comma
l_int|0x6A
comma
l_int|0x73
comma
l_int|0x74
comma
l_int|0x75
comma
l_int|0x76
comma
l_int|0x77
comma
l_int|0x78
comma
l_int|0x79
comma
l_int|0x7A
comma
l_int|0x83
comma
l_int|0x84
comma
l_int|0x85
comma
l_int|0x86
comma
l_int|0x87
comma
l_int|0x88
comma
l_int|0x89
comma
l_int|0x8A
comma
l_int|0x92
comma
l_int|0x93
comma
l_int|0x94
comma
l_int|0x95
comma
l_int|0x96
comma
l_int|0x97
comma
l_int|0x98
comma
l_int|0x99
comma
l_int|0x9A
comma
l_int|0xA2
comma
l_int|0xA3
comma
l_int|0xA4
comma
l_int|0xA5
comma
l_int|0xA6
comma
l_int|0xA7
comma
l_int|0xA8
comma
l_int|0xA9
comma
l_int|0xAA
comma
l_int|0xB2
comma
l_int|0xB3
comma
l_int|0xB4
comma
l_int|0xB5
comma
l_int|0xB6
comma
l_int|0xB7
comma
l_int|0xB8
comma
l_int|0xB9
comma
l_int|0xBA
comma
l_int|0xC2
comma
l_int|0xC3
comma
l_int|0xC4
comma
l_int|0xC5
comma
l_int|0xC6
comma
l_int|0xC7
comma
l_int|0xC8
comma
l_int|0xC9
comma
l_int|0xCA
comma
l_int|0xD2
comma
l_int|0xD3
comma
l_int|0xD4
comma
l_int|0xD5
comma
l_int|0xD6
comma
l_int|0xD7
comma
l_int|0xD8
comma
l_int|0xD9
comma
l_int|0xDA
comma
l_int|0xE1
comma
l_int|0xE2
comma
l_int|0xE3
comma
l_int|0xE4
comma
l_int|0xE5
comma
l_int|0xE6
comma
l_int|0xE7
comma
l_int|0xE8
comma
l_int|0xE9
comma
l_int|0xEA
comma
l_int|0xF1
comma
l_int|0xF2
comma
l_int|0xF3
comma
l_int|0xF4
comma
l_int|0xF5
comma
l_int|0xF6
comma
l_int|0xF7
comma
l_int|0xF8
comma
l_int|0xF9
comma
l_int|0xFA
comma
l_int|0x11
comma
singleline_comment|//AC second table
l_int|0x00
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x03
comma
l_int|0x04
comma
l_int|0x07
comma
l_int|0x05
comma
l_int|0x04
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x77
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x02
comma
l_int|0x03
comma
l_int|0x11
comma
l_int|0x04
comma
l_int|0x05
comma
l_int|0x21
comma
l_int|0x31
comma
l_int|0x06
comma
l_int|0x12
comma
l_int|0x41
comma
l_int|0x51
comma
l_int|0x07
comma
l_int|0x61
comma
l_int|0x71
comma
l_int|0x13
comma
l_int|0x22
comma
l_int|0x32
comma
l_int|0x81
comma
l_int|0x08
comma
l_int|0x14
comma
l_int|0x42
comma
l_int|0x91
comma
l_int|0xA1
comma
l_int|0xB1
comma
l_int|0xC1
comma
l_int|0x09
comma
l_int|0x23
comma
l_int|0x33
comma
l_int|0x52
comma
l_int|0xF0
comma
l_int|0x15
comma
l_int|0x62
comma
l_int|0x72
comma
l_int|0xD1
comma
l_int|0x0A
comma
l_int|0x16
comma
l_int|0x24
comma
l_int|0x34
comma
l_int|0xE1
comma
l_int|0x25
comma
l_int|0xF1
comma
l_int|0x17
comma
l_int|0x18
comma
l_int|0x19
comma
l_int|0x1A
comma
l_int|0x26
comma
l_int|0x27
comma
l_int|0x28
comma
l_int|0x29
comma
l_int|0x2A
comma
l_int|0x35
comma
l_int|0x36
comma
l_int|0x37
comma
l_int|0x38
comma
l_int|0x39
comma
l_int|0x3A
comma
l_int|0x43
comma
l_int|0x44
comma
l_int|0x45
comma
l_int|0x46
comma
l_int|0x47
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x4A
comma
l_int|0x53
comma
l_int|0x54
comma
l_int|0x55
comma
l_int|0x56
comma
l_int|0x57
comma
l_int|0x58
comma
l_int|0x59
comma
l_int|0x5A
comma
l_int|0x63
comma
l_int|0x64
comma
l_int|0x65
comma
l_int|0x66
comma
l_int|0x67
comma
l_int|0x68
comma
l_int|0x69
comma
l_int|0x6A
comma
l_int|0x73
comma
l_int|0x74
comma
l_int|0x75
comma
l_int|0x76
comma
l_int|0x77
comma
l_int|0x78
comma
l_int|0x79
comma
l_int|0x7A
comma
l_int|0x82
comma
l_int|0x83
comma
l_int|0x84
comma
l_int|0x85
comma
l_int|0x86
comma
l_int|0x87
comma
l_int|0x88
comma
l_int|0x89
comma
l_int|0x8A
comma
l_int|0x92
comma
l_int|0x93
comma
l_int|0x94
comma
l_int|0x95
comma
l_int|0x96
comma
l_int|0x97
comma
l_int|0x98
comma
l_int|0x99
comma
l_int|0x9A
comma
l_int|0xA2
comma
l_int|0xA3
comma
l_int|0xA4
comma
l_int|0xA5
comma
l_int|0xA6
comma
l_int|0xA7
comma
l_int|0xA8
comma
l_int|0xA9
comma
l_int|0xAA
comma
l_int|0xB2
comma
l_int|0xB3
comma
l_int|0xB4
comma
l_int|0xB5
comma
l_int|0xB6
comma
l_int|0xB7
comma
l_int|0xB8
comma
l_int|0xB9
comma
l_int|0xBA
comma
l_int|0xC2
comma
l_int|0xC3
comma
l_int|0xC4
comma
l_int|0xC5
comma
l_int|0xC6
comma
l_int|0xC7
comma
l_int|0xC8
comma
l_int|0xC9
comma
l_int|0xCA
comma
l_int|0xD2
comma
l_int|0xD3
comma
l_int|0xD4
comma
l_int|0xD5
comma
l_int|0xD6
comma
l_int|0xD7
comma
l_int|0xD8
comma
l_int|0xD9
comma
l_int|0xDA
comma
l_int|0xE2
comma
l_int|0xE3
comma
l_int|0xE4
comma
l_int|0xE5
comma
l_int|0xE6
comma
l_int|0xE7
comma
l_int|0xE8
comma
l_int|0xE9
comma
l_int|0xEA
comma
l_int|0xF2
comma
l_int|0xF3
comma
l_int|0xF4
comma
l_int|0xF5
comma
l_int|0xF6
comma
l_int|0xF7
comma
l_int|0xF8
comma
l_int|0xF9
comma
l_int|0xFA
)brace
suffix:semicolon
multiline_comment|/* jpeg baseline setup, this is just fixed in this driver (YUV pictures) */
DECL|macro|NO_OF_COMPONENTS
mdefine_line|#define NO_OF_COMPONENTS          0x3&t;
singleline_comment|//Y,U,V
DECL|macro|BASELINE_PRECISION
mdefine_line|#define BASELINE_PRECISION        0x8&t;
singleline_comment|//MCU size (?)
DECL|variable|zr36050_tq
r_static
r_const
r_char
id|zr36050_tq
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
singleline_comment|//table idx&squot;s QT
DECL|variable|zr36050_td
r_static
r_const
r_char
id|zr36050_td
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
singleline_comment|//table idx&squot;s DC
DECL|variable|zr36050_ta
r_static
r_const
r_char
id|zr36050_ta
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
singleline_comment|//table idx&squot;s AC
multiline_comment|/* horizontal 422 decimation setup (maybe we support 411 or so later, too) */
DECL|variable|zr36050_decimation_h
r_static
r_const
r_char
id|zr36050_decimation_h
(braket
l_int|8
)braket
op_assign
(brace
l_int|2
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|zr36050_decimation_v
r_static
r_const
r_char
id|zr36050_decimation_v
(braket
l_int|8
)braket
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* =========================================================================&n;   Local helper functions:&n;&n;   calculation and setup of parameter-dependent JPEG baseline segments&n;   (needed for compression only)&n;   ========================================================================= */
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* SOF (start of frame) segment depends on width, height and sampling ratio&n;                         of each color component */
r_static
r_int
DECL|function|zr36050_set_sof
id|zr36050_set_sof
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
r_char
id|sof_data
(braket
l_int|34
)braket
suffix:semicolon
singleline_comment|// max. size of register set
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: write SOF (%dx%d, %d components)&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|ptr-&gt;width
comma
id|ptr-&gt;height
comma
id|NO_OF_COMPONENTS
)paren
suffix:semicolon
id|sof_data
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|sof_data
(braket
l_int|1
)braket
op_assign
l_int|0xc0
suffix:semicolon
id|sof_data
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|sof_data
(braket
l_int|3
)braket
op_assign
(paren
l_int|3
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|8
suffix:semicolon
id|sof_data
(braket
l_int|4
)braket
op_assign
id|BASELINE_PRECISION
suffix:semicolon
singleline_comment|// only &squot;8&squot; possible with zr36050
id|sof_data
(braket
l_int|5
)braket
op_assign
(paren
id|ptr-&gt;height
)paren
op_rshift
l_int|8
suffix:semicolon
id|sof_data
(braket
l_int|6
)braket
op_assign
(paren
id|ptr-&gt;height
)paren
op_amp
l_int|0xff
suffix:semicolon
id|sof_data
(braket
l_int|7
)braket
op_assign
(paren
id|ptr-&gt;width
)paren
op_rshift
l_int|8
suffix:semicolon
id|sof_data
(braket
l_int|8
)braket
op_assign
(paren
id|ptr-&gt;width
)paren
op_amp
l_int|0xff
suffix:semicolon
id|sof_data
(braket
l_int|9
)braket
op_assign
id|NO_OF_COMPONENTS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_COMPONENTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sof_data
(braket
l_int|10
op_plus
(paren
id|i
op_star
l_int|3
)paren
)braket
op_assign
id|i
suffix:semicolon
singleline_comment|// index identifier
id|sof_data
(braket
l_int|11
op_plus
(paren
id|i
op_star
l_int|3
)paren
)braket
op_assign
(paren
id|ptr-&gt;h_samp_ratio
(braket
id|i
)braket
op_lshift
l_int|4
)paren
op_or
(paren
id|ptr-&gt;v_samp_ratio
(braket
id|i
)braket
)paren
suffix:semicolon
singleline_comment|// sampling ratios
id|sof_data
(braket
l_int|12
op_plus
(paren
id|i
op_star
l_int|3
)paren
)braket
op_assign
id|zr36050_tq
(braket
id|i
)braket
suffix:semicolon
singleline_comment|// Q table selection
)brace
r_return
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_SOF_IDX
comma
(paren
l_int|3
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|10
comma
id|sof_data
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* SOS (start of scan) segment depends on the used scan components &n;                        of each color component */
r_static
r_int
DECL|function|zr36050_set_sos
id|zr36050_set_sos
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
r_char
id|sos_data
(braket
l_int|16
)braket
suffix:semicolon
singleline_comment|// max. size of register set
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: write SOS&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
id|sos_data
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|sos_data
(braket
l_int|1
)braket
op_assign
l_int|0xda
suffix:semicolon
id|sos_data
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|sos_data
(braket
l_int|3
)braket
op_assign
l_int|2
op_plus
l_int|1
op_plus
(paren
l_int|2
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|3
suffix:semicolon
id|sos_data
(braket
l_int|4
)braket
op_assign
id|NO_OF_COMPONENTS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NO_OF_COMPONENTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|sos_data
(braket
l_int|5
op_plus
(paren
id|i
op_star
l_int|2
)paren
)braket
op_assign
id|i
suffix:semicolon
singleline_comment|// index
id|sos_data
(braket
l_int|6
op_plus
(paren
id|i
op_star
l_int|2
)paren
)braket
op_assign
(paren
id|zr36050_td
(braket
id|i
)braket
op_lshift
l_int|4
)paren
op_or
id|zr36050_ta
(braket
id|i
)braket
suffix:semicolon
singleline_comment|// AC/DC tbl.sel.
)brace
id|sos_data
(braket
l_int|2
op_plus
l_int|1
op_plus
(paren
l_int|2
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|2
)braket
op_assign
l_int|00
suffix:semicolon
singleline_comment|// scan start
id|sos_data
(braket
l_int|2
op_plus
l_int|1
op_plus
(paren
l_int|2
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|3
)braket
op_assign
l_int|0x3F
suffix:semicolon
id|sos_data
(braket
l_int|2
op_plus
l_int|1
op_plus
(paren
l_int|2
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|4
)braket
op_assign
l_int|00
suffix:semicolon
r_return
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_SOS1_IDX
comma
l_int|4
op_plus
l_int|1
op_plus
(paren
l_int|2
op_star
id|NO_OF_COMPONENTS
)paren
op_plus
l_int|3
comma
id|sos_data
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------------------------------------------------- */
multiline_comment|/* DRI (define restart interval) */
r_static
r_int
DECL|function|zr36050_set_dri
id|zr36050_set_dri
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
r_char
id|dri_data
(braket
l_int|6
)braket
suffix:semicolon
singleline_comment|// max. size of register set
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: write DRI&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
id|dri_data
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|dri_data
(braket
l_int|1
)braket
op_assign
l_int|0xdd
suffix:semicolon
id|dri_data
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dri_data
(braket
l_int|3
)braket
op_assign
l_int|0x04
suffix:semicolon
id|dri_data
(braket
l_int|4
)braket
op_assign
id|ptr-&gt;dri
op_rshift
l_int|8
suffix:semicolon
id|dri_data
(braket
l_int|5
)braket
op_assign
id|ptr-&gt;dri
op_star
l_int|0xff
suffix:semicolon
r_return
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_DRI_IDX
comma
l_int|6
comma
id|dri_data
)paren
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Setup function:&n;&n;   Setup compression/decompression of Zoran&squot;s JPEG processor&n;   ( see also zoran 36050 manual )&n;&n;   ... sorry for the spaghetti code ...&n;   ========================================================================= */
r_static
r_void
DECL|function|zr36050_init
id|zr36050_init
(paren
r_struct
id|zr36050
op_star
id|ptr
)paren
(brace
r_int
id|sum
op_assign
l_int|0
suffix:semicolon
r_int
id|bitcnt
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|ptr-&gt;mode
op_eq
id|CODEC_DO_COMPRESSION
)paren
(brace
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: COMPRESSION SETUP&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
multiline_comment|/* 050 communicates with 057 in master mode */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_HARDWARE
comma
id|ZR050_HW_MSTR
)paren
suffix:semicolon
multiline_comment|/* encoding table preload for compression */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MODE
comma
id|ZR050_MO_COMP
op_or
id|ZR050_MO_TLM
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_OPTIONS
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable all IRQs */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_INT_REQ_0
comma
l_int|0
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_INT_REQ_1
comma
l_int|3
)paren
suffix:semicolon
singleline_comment|// low 2 bits always 1
multiline_comment|/* volume control settings */
multiline_comment|/*zr36050_write(ptr, ZR050_MBCV, ptr-&gt;max_block_vol);*/
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SF_HI
comma
id|ptr-&gt;scalefact
op_rshift
l_int|8
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_SF_LO
comma
id|ptr-&gt;scalefact
op_amp
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_AF_HI
comma
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_AF_M
comma
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_AF_LO
comma
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* setup the variable jpeg tables */
id|sum
op_add_assign
id|zr36050_set_sof
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_set_sos
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_set_dri
c_func
(paren
id|ptr
)paren
suffix:semicolon
multiline_comment|/* setup the fixed jpeg tables - maybe variable, though -&n;&t;&t; * (see table init section above) */
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: write DQT, DHT, APP&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_DQT_IDX
comma
r_sizeof
(paren
id|zr36050_dqt
)paren
comma
id|zr36050_dqt
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_DHT_IDX
comma
r_sizeof
(paren
id|zr36050_dht
)paren
comma
id|zr36050_dht
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_APP_IDX
comma
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_APP_IDX
op_plus
l_int|1
comma
l_int|0xe0
op_plus
id|ptr-&gt;app.appn
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_APP_IDX
op_plus
l_int|2
comma
l_int|0x00
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_APP_IDX
op_plus
l_int|3
comma
id|ptr-&gt;app.len
op_plus
l_int|2
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_APP_IDX
op_plus
l_int|4
comma
l_int|60
comma
id|ptr-&gt;app.data
)paren
op_plus
l_int|4
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_COM_IDX
comma
l_int|0xff
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_COM_IDX
op_plus
l_int|1
comma
l_int|0xfe
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_COM_IDX
op_plus
l_int|2
comma
l_int|0x00
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_COM_IDX
op_plus
l_int|3
comma
id|ptr-&gt;com.len
op_plus
l_int|2
)paren
suffix:semicolon
id|sum
op_add_assign
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_COM_IDX
op_plus
l_int|4
comma
l_int|60
comma
id|ptr-&gt;com.data
)paren
op_plus
l_int|4
suffix:semicolon
multiline_comment|/* do the internal huffman table preload */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MARKERS_EN
comma
id|ZR050_ME_DHTI
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_GO
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// launch codec
id|zr36050_wait_end
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: Status after table preload: 0x%02x&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|ptr-&gt;status1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status1
op_amp
l_int|0x4
)paren
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: init aborted!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
singleline_comment|// something is wrong, its timed out!!!!
)brace
multiline_comment|/* setup misc. data for compression (target code sizes) */
multiline_comment|/* size of compressed code to reach without header data */
id|sum
op_assign
id|ptr-&gt;real_code_vol
op_minus
id|sum
suffix:semicolon
id|bitcnt
op_assign
id|sum
op_lshift
l_int|3
suffix:semicolon
multiline_comment|/* need the size in bits */
id|tmp
op_assign
id|bitcnt
op_rshift
l_int|16
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: code: csize=%d, tot=%d, bit=%ld, highbits=%ld&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|sum
comma
id|ptr-&gt;real_code_vol
comma
id|bitcnt
comma
id|tmp
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_NET_HI
comma
id|tmp
op_rshift
l_int|8
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_NET_MH
comma
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|tmp
op_assign
id|bitcnt
op_amp
l_int|0xffff
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_NET_ML
comma
id|tmp
op_rshift
l_int|8
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_NET_LO
comma
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|bitcnt
op_sub_assign
id|bitcnt
op_rshift
l_int|7
suffix:semicolon
singleline_comment|// bits without stuffing
id|bitcnt
op_sub_assign
(paren
(paren
id|bitcnt
op_star
l_int|5
)paren
op_rshift
l_int|6
)paren
suffix:semicolon
singleline_comment|// bits without eob
id|tmp
op_assign
id|bitcnt
op_rshift
l_int|16
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: code: nettobit=%ld, highnettobits=%ld&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|bitcnt
comma
id|tmp
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_DATA_HI
comma
id|tmp
op_rshift
l_int|8
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_DATA_MH
comma
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
id|tmp
op_assign
id|bitcnt
op_amp
l_int|0xffff
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_DATA_ML
comma
id|tmp
op_rshift
l_int|8
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_TCV_DATA_LO
comma
id|tmp
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* compression setup with or without bitrate control */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MODE
comma
id|ZR050_MO_COMP
op_or
id|ZR050_MO_PASS2
op_or
(paren
id|ptr-&gt;bitrate_ctrl
ques
c_cond
id|ZR050_MO_BRC
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* this headers seem to deliver &quot;valid AVI&quot; jpeg frames */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MARKERS_EN
comma
id|ZR050_ME_DQT
op_or
id|ZR050_ME_DHT
op_or
(paren
(paren
id|ptr-&gt;app.len
OG
l_int|0
)paren
ques
c_cond
id|ZR050_ME_APP
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|ptr-&gt;com.len
OG
l_int|0
)paren
ques
c_cond
id|ZR050_ME_COM
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: EXPANSION SETUP&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
multiline_comment|/* 050 communicates with 055 in master mode */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_HARDWARE
comma
id|ZR050_HW_MSTR
op_or
id|ZR050_HW_CFIS_2_CLK
)paren
suffix:semicolon
multiline_comment|/* encoding table preload */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MODE
comma
id|ZR050_MO_TLM
)paren
suffix:semicolon
multiline_comment|/* disable all IRQs */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_INT_REQ_0
comma
l_int|0
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_INT_REQ_1
comma
l_int|3
)paren
suffix:semicolon
singleline_comment|// low 2 bits always 1
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;%s: write DHT&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
id|zr36050_pushit
c_func
(paren
id|ptr
comma
id|ZR050_DHT_IDX
comma
r_sizeof
(paren
id|zr36050_dht
)paren
comma
id|zr36050_dht
)paren
suffix:semicolon
multiline_comment|/* do the internal huffman table preload */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MARKERS_EN
comma
id|ZR050_ME_DHTI
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_GO
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// launch codec
id|zr36050_wait_end
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: Status after table preload: 0x%02x&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|ptr-&gt;status1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptr-&gt;status1
op_amp
l_int|0x4
)paren
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;%s: init aborted!&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
singleline_comment|// something is wrong, its timed out!!!!
)brace
multiline_comment|/* setup misc. data for expansion */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MODE
comma
l_int|0
)paren
suffix:semicolon
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MARKERS_EN
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* adr on selected, to allow GO from master */
id|zr36050_read
c_func
(paren
id|ptr
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   CODEC API FUNCTIONS&n;&n;   this functions are accessed by the master via the API structure&n;   ========================================================================= */
multiline_comment|/* set compression/expansion mode and launches codec -&n;   this should be the last call from the master before starting processing */
r_static
r_int
DECL|function|zr36050_set_mode
id|zr36050_set_mode
(paren
r_struct
id|videocodec
op_star
id|codec
comma
r_int
id|mode
)paren
(brace
r_struct
id|zr36050
op_star
id|ptr
op_assign
(paren
r_struct
id|zr36050
op_star
)paren
id|codec-&gt;data
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: set_mode %d call&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mode
op_ne
id|CODEC_DO_EXPANSION
)paren
op_logical_and
(paren
id|mode
op_ne
id|CODEC_DO_COMPRESSION
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr-&gt;mode
op_assign
id|mode
suffix:semicolon
id|zr36050_init
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set picture size (norm is ignored as the codec doesn&squot;t know about it) */
r_static
r_int
DECL|function|zr36050_set_video
id|zr36050_set_video
(paren
r_struct
id|videocodec
op_star
id|codec
comma
r_struct
id|tvnorm
op_star
id|norm
comma
r_struct
id|vfe_settings
op_star
id|cap
comma
r_struct
id|vfe_polarity
op_star
id|pol
)paren
(brace
r_struct
id|zr36050
op_star
id|ptr
op_assign
(paren
r_struct
id|zr36050
op_star
)paren
id|codec-&gt;data
suffix:semicolon
r_int
id|size
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: set_video %d.%d, %d/%d-%dx%d (0x%x) q%d call&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|norm-&gt;HStart
comma
id|norm-&gt;VStart
comma
id|cap-&gt;x
comma
id|cap-&gt;y
comma
id|cap-&gt;width
comma
id|cap-&gt;height
comma
id|cap-&gt;decimation
comma
id|cap-&gt;quality
)paren
suffix:semicolon
multiline_comment|/* if () return -EINVAL;&n;&t; * trust the master driver that it knows what it does - so&n;&t; * we allow invalid startx/y and norm for now ... */
id|ptr-&gt;width
op_assign
id|cap-&gt;width
op_div
(paren
id|cap-&gt;decimation
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ptr-&gt;height
op_assign
id|cap-&gt;height
op_div
(paren
(paren
id|cap-&gt;decimation
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* (KM) JPEG quality */
id|size
op_assign
id|ptr-&gt;width
op_star
id|ptr-&gt;height
suffix:semicolon
id|size
op_mul_assign
l_int|16
suffix:semicolon
multiline_comment|/* size in bits */
multiline_comment|/* apply quality setting */
id|size
op_assign
id|size
op_star
id|cap-&gt;quality
op_div
l_int|200
suffix:semicolon
multiline_comment|/* Minimum: 1kb */
r_if
c_cond
(paren
id|size
OL
l_int|8192
)paren
id|size
op_assign
l_int|8192
suffix:semicolon
multiline_comment|/* Maximum: 7/8 of code buffer */
r_if
c_cond
(paren
id|size
OG
id|ptr-&gt;total_code_vol
op_star
l_int|7
)paren
id|size
op_assign
id|ptr-&gt;total_code_vol
op_star
l_int|7
suffix:semicolon
id|ptr-&gt;real_code_vol
op_assign
id|size
op_rshift
l_int|3
suffix:semicolon
multiline_comment|/* in bytes */
multiline_comment|/* Set max_block_vol here (previously in zr36050_init, moved&n;&t; * here for consistency with zr36060 code */
id|zr36050_write
c_func
(paren
id|ptr
comma
id|ZR050_MBCV
comma
id|ptr-&gt;max_block_vol
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* additional control functions */
r_static
r_int
DECL|function|zr36050_control
id|zr36050_control
(paren
r_struct
id|videocodec
op_star
id|codec
comma
r_int
id|type
comma
r_int
id|size
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|zr36050
op_star
id|ptr
op_assign
(paren
r_struct
id|zr36050
op_star
)paren
id|codec-&gt;data
suffix:semicolon
r_int
op_star
id|ival
op_assign
(paren
r_int
op_star
)paren
id|data
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s: control %d call with %d byte&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|type
comma
id|size
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|CODEC_G_STATUS
suffix:colon
multiline_comment|/* get last status */
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|zr36050_read_status1
c_func
(paren
id|ptr
)paren
suffix:semicolon
op_star
id|ival
op_assign
id|ptr-&gt;status1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_G_CODEC_MODE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|ival
op_assign
id|CODEC_MODE_BJPG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_S_CODEC_MODE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_star
id|ival
op_ne
id|CODEC_MODE_BJPG
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* not needed, do nothing */
r_return
l_int|0
suffix:semicolon
r_case
id|CODEC_G_VFE
suffix:colon
r_case
id|CODEC_S_VFE
suffix:colon
multiline_comment|/* not needed, do nothing */
r_return
l_int|0
suffix:semicolon
r_case
id|CODEC_S_MMAP
suffix:colon
multiline_comment|/* not available, give an error */
r_return
op_minus
id|ENXIO
suffix:semicolon
r_case
id|CODEC_G_JPEG_TDS_BYTE
suffix:colon
multiline_comment|/* get target volume in byte */
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|ival
op_assign
id|ptr-&gt;total_code_vol
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_S_JPEG_TDS_BYTE
suffix:colon
multiline_comment|/* get target volume in byte */
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ptr-&gt;total_code_vol
op_assign
op_star
id|ival
suffix:semicolon
multiline_comment|/* (Kieran Morrissey)&n;&t;&t; * code copied from zr36060.c to ensure proper bitrate */
id|ptr-&gt;real_code_vol
op_assign
(paren
id|ptr-&gt;total_code_vol
op_star
l_int|6
)paren
op_rshift
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_G_JPEG_SCALE
suffix:colon
multiline_comment|/* get scaling factor */
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|ival
op_assign
id|zr36050_read_scalefactor
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_S_JPEG_SCALE
suffix:colon
multiline_comment|/* set scaling factor */
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ptr-&gt;scalefact
op_assign
op_star
id|ival
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODEC_G_JPEG_APP_DATA
suffix:colon
(brace
multiline_comment|/* get appn marker data */
r_struct
id|jpeg_app_marker
op_star
id|app
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_struct
id|jpeg_app_marker
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|app
op_assign
id|ptr-&gt;app
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CODEC_S_JPEG_APP_DATA
suffix:colon
(brace
multiline_comment|/* set appn marker data */
r_struct
id|jpeg_app_marker
op_star
id|app
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_struct
id|jpeg_app_marker
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ptr-&gt;app
op_assign
op_star
id|app
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CODEC_G_JPEG_COM_DATA
suffix:colon
(brace
multiline_comment|/* get comment marker data */
r_struct
id|jpeg_com_marker
op_star
id|com
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_struct
id|jpeg_com_marker
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|com
op_assign
id|ptr-&gt;com
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|CODEC_S_JPEG_COM_DATA
suffix:colon
(brace
multiline_comment|/* set comment marker data */
r_struct
id|jpeg_com_marker
op_star
id|com
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ne
r_sizeof
(paren
r_struct
id|jpeg_com_marker
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ptr-&gt;com
op_assign
op_star
id|com
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Exit and unregister function:&n;&n;   Deinitializes Zoran&squot;s JPEG processor&n;   ========================================================================= */
r_static
r_int
DECL|function|zr36050_unset
id|zr36050_unset
(paren
r_struct
id|videocodec
op_star
id|codec
)paren
(brace
r_struct
id|zr36050
op_star
id|ptr
op_assign
id|codec-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
(brace
multiline_comment|/* do wee need some codec deinit here, too ???? */
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: finished codec #%d&bslash;n&quot;
comma
id|ptr-&gt;name
comma
id|ptr-&gt;num
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|codec-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|zr36050_codecs
op_decrement
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* =========================================================================&n;   Setup and registry function:&n;&n;   Initializes Zoran&squot;s JPEG processor&n;&n;   Also sets pixel size, average code size, mode (compr./decompr.)&n;   (the given size is determined by the processor with the video interface)&n;   ========================================================================= */
r_static
r_int
DECL|function|zr36050_setup
id|zr36050_setup
(paren
r_struct
id|videocodec
op_star
id|codec
)paren
(brace
r_struct
id|zr36050
op_star
id|ptr
suffix:semicolon
r_int
id|res
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;zr36050: initializing MJPEG subsystem #%d.&bslash;n&quot;
comma
id|zr36050_codecs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zr36050_codecs
op_eq
id|MAX_CODECS
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;zr36050: Can&squot;t attach more codecs!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
singleline_comment|//mem structure init
id|codec-&gt;data
op_assign
id|ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|zr36050
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|ptr
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_ERR
l_string|&quot;zr36050: Can&squot;t get enough memory!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zr36050
)paren
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|ptr-&gt;name
comma
r_sizeof
(paren
id|ptr-&gt;name
)paren
comma
l_string|&quot;zr36050[%d]&quot;
comma
id|zr36050_codecs
)paren
suffix:semicolon
id|ptr-&gt;num
op_assign
id|zr36050_codecs
op_increment
suffix:semicolon
id|ptr-&gt;codec
op_assign
id|codec
suffix:semicolon
singleline_comment|//testing
id|res
op_assign
id|zr36050_basic_test
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
id|zr36050_unset
c_func
(paren
id|codec
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
singleline_comment|//final setup
id|memcpy
c_func
(paren
id|ptr-&gt;h_samp_ratio
comma
id|zr36050_decimation_h
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ptr-&gt;v_samp_ratio
comma
id|zr36050_decimation_v
comma
l_int|8
)paren
suffix:semicolon
id|ptr-&gt;bitrate_ctrl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0 or 1 - fixed file size flag&n;&t;&t;&t;&t; * (what is the difference?) */
id|ptr-&gt;mode
op_assign
id|CODEC_DO_COMPRESSION
suffix:semicolon
id|ptr-&gt;width
op_assign
l_int|384
suffix:semicolon
id|ptr-&gt;height
op_assign
l_int|288
suffix:semicolon
id|ptr-&gt;total_code_vol
op_assign
l_int|16000
suffix:semicolon
id|ptr-&gt;max_block_vol
op_assign
l_int|240
suffix:semicolon
id|ptr-&gt;scalefact
op_assign
l_int|0x100
suffix:semicolon
id|ptr-&gt;dri
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* no app/com marker by default */
id|ptr-&gt;app.appn
op_assign
l_int|0
suffix:semicolon
id|ptr-&gt;app.len
op_assign
l_int|0
suffix:semicolon
id|ptr-&gt;com.len
op_assign
l_int|0
suffix:semicolon
id|zr36050_init
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
id|KERN_INFO
l_string|&quot;%s: codec attached and running&bslash;n&quot;
comma
id|ptr-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|zr36050_codec
r_static
r_const
r_struct
id|videocodec
id|zr36050_codec
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;zr36050&quot;
comma
dot
id|magic
op_assign
l_int|0L
comma
singleline_comment|// magic not used
dot
id|flags
op_assign
id|CODEC_FLAG_JPEG
op_or
id|CODEC_FLAG_HARDWARE
op_or
id|CODEC_FLAG_ENCODER
op_or
id|CODEC_FLAG_DECODER
comma
dot
id|type
op_assign
id|CODEC_TYPE_ZR36050
comma
dot
id|setup
op_assign
id|zr36050_setup
comma
singleline_comment|// functionality
dot
id|unset
op_assign
id|zr36050_unset
comma
dot
id|set_mode
op_assign
id|zr36050_set_mode
comma
dot
id|set_video
op_assign
id|zr36050_set_video
comma
dot
id|control
op_assign
id|zr36050_control
comma
singleline_comment|// others are not used
)brace
suffix:semicolon
multiline_comment|/* =========================================================================&n;   HOOK IN DRIVER AS KERNEL MODULE&n;   ========================================================================= */
r_static
r_int
id|__init
DECL|function|zr36050_init_module
id|zr36050_init_module
(paren
r_void
)paren
(brace
singleline_comment|//dprintk(1, &quot;ZR36050 driver %s&bslash;n&quot;,ZR050_VERSION);
id|zr36050_codecs
op_assign
l_int|0
suffix:semicolon
r_return
id|videocodec_register
c_func
(paren
op_amp
id|zr36050_codec
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|zr36050_cleanup_module
id|zr36050_cleanup_module
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|zr36050_codecs
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;zr36050: something&squot;s wrong - %d codecs left somehow.&bslash;n&quot;
comma
id|zr36050_codecs
)paren
suffix:semicolon
)brace
id|videocodec_unregister
c_func
(paren
op_amp
id|zr36050_codec
)paren
suffix:semicolon
)brace
DECL|variable|zr36050_init_module
id|module_init
c_func
(paren
id|zr36050_init_module
)paren
suffix:semicolon
DECL|variable|zr36050_cleanup_module
id|module_exit
c_func
(paren
id|zr36050_cleanup_module
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Wolfgang Scherr &lt;scherr@net4you.at&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Driver module for ZR36050 jpeg processors &quot;
id|ZR050_VERSION
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
