multiline_comment|/*&n; * $Id: video-buf.c,v 1.13 2004/10/13 10:39:00 kraxel Exp $&n; *&n; * generic helper functions for video4linux capture buffers, to handle&n; * memory management and PCI DMA.  Right now bttv + saa7134 use it.&n; *&n; * The functions expect the hardware being able to scatter gatter&n; * (i.e. the buffers are not linear in physical memory, but fragmented&n; * into PAGE_SIZE chunks).  They also assume the driver does not need&n; * to touch the video data (thus it is probably not useful for USB 1.1&n; * as data often must be uncompressed by the drivers).&n; *&n; * (c) 2001-2004 Gerd Knorr &lt;kraxel@bytesex.org&gt; [SUSE Labs]&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;media/video-buf.h&gt;
DECL|macro|MAGIC_DMABUF
mdefine_line|#define MAGIC_DMABUF 0x19721112
DECL|macro|MAGIC_BUFFER
mdefine_line|#define MAGIC_BUFFER 0x20040302
DECL|macro|MAGIC_CHECK
mdefine_line|#define MAGIC_CHECK(is,should)&t;if (unlikely((is) != (should))) &bslash;&n;&t;{ printk(KERN_ERR &quot;magic mismatch: %x (expected %x)&bslash;n&quot;,is,should); BUG(); }
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;helper module to manage video4linux pci dma buffers&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(level, fmt, arg...)&t;if (debug &gt;= level) &bslash;&n;&t;printk(KERN_DEBUG &quot;vbuf: &quot; fmt , ## arg)
r_struct
id|scatterlist
op_star
DECL|function|videobuf_vmalloc_to_sg
id|videobuf_vmalloc_to_sg
c_func
(paren
r_int
r_char
op_star
id|virt
comma
r_int
id|nr_pages
)paren
(brace
r_struct
id|scatterlist
op_star
id|sglist
suffix:semicolon
r_struct
id|page
op_star
id|pg
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sglist
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|scatterlist
)paren
op_star
id|nr_pages
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|sglist
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|sglist
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|scatterlist
)paren
op_star
id|nr_pages
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_pages
suffix:semicolon
id|i
op_increment
comma
id|virt
op_add_assign
id|PAGE_SIZE
)paren
(brace
id|pg
op_assign
id|vmalloc_to_page
c_func
(paren
id|virt
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|pg
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|PageHighMem
c_func
(paren
id|pg
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|sglist
(braket
id|i
)braket
dot
id|page
op_assign
id|pg
suffix:semicolon
id|sglist
(braket
id|i
)braket
dot
id|length
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|sglist
suffix:semicolon
id|err
suffix:colon
id|kfree
c_func
(paren
id|sglist
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_struct
id|scatterlist
op_star
DECL|function|videobuf_pages_to_sg
id|videobuf_pages_to_sg
c_func
(paren
r_struct
id|page
op_star
op_star
id|pages
comma
r_int
id|nr_pages
comma
r_int
id|offset
)paren
(brace
r_struct
id|scatterlist
op_star
id|sglist
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|pages
(braket
l_int|0
)braket
)paren
r_return
l_int|NULL
suffix:semicolon
id|sglist
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sglist
)paren
op_star
id|nr_pages
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|sglist
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|sglist
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sglist
)paren
op_star
id|nr_pages
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|pages
(braket
l_int|0
)braket
)paren
r_goto
id|nopage
suffix:semicolon
r_if
c_cond
(paren
id|PageHighMem
c_func
(paren
id|pages
(braket
l_int|0
)braket
)paren
)paren
multiline_comment|/* DMA to highmem pages might not work */
r_goto
id|highmem
suffix:semicolon
id|sglist
(braket
l_int|0
)braket
dot
id|page
op_assign
id|pages
(braket
l_int|0
)braket
suffix:semicolon
id|sglist
(braket
l_int|0
)braket
dot
id|offset
op_assign
id|offset
suffix:semicolon
id|sglist
(braket
l_int|0
)braket
dot
id|length
op_assign
id|PAGE_SIZE
op_minus
id|offset
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|nr_pages
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|pages
(braket
id|i
)braket
)paren
r_goto
id|nopage
suffix:semicolon
r_if
c_cond
(paren
id|PageHighMem
c_func
(paren
id|pages
(braket
id|i
)braket
)paren
)paren
r_goto
id|highmem
suffix:semicolon
id|sglist
(braket
id|i
)braket
dot
id|page
op_assign
id|pages
(braket
id|i
)braket
suffix:semicolon
id|sglist
(braket
id|i
)braket
dot
id|length
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|sglist
suffix:semicolon
id|nopage
suffix:colon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;sgl: oops - no page&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sglist
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
id|highmem
suffix:colon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;sgl: oops - highmem page&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sglist
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|videobuf_dma_init
r_void
id|videobuf_dma_init
c_func
(paren
r_struct
id|videobuf_dmabuf
op_star
id|dma
)paren
(brace
id|memset
c_func
(paren
id|dma
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|dma
)paren
)paren
suffix:semicolon
id|dma-&gt;magic
op_assign
id|MAGIC_DMABUF
suffix:semicolon
)brace
DECL|function|videobuf_dma_init_user
r_int
id|videobuf_dma_init_user
c_func
(paren
r_struct
id|videobuf_dmabuf
op_star
id|dma
comma
r_int
id|direction
comma
r_int
r_int
id|data
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|first
comma
id|last
suffix:semicolon
r_int
id|err
comma
id|rw
op_assign
l_int|0
suffix:semicolon
id|dma-&gt;direction
op_assign
id|direction
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;direction
)paren
(brace
r_case
id|PCI_DMA_FROMDEVICE
suffix:colon
id|rw
op_assign
id|READ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DMA_TODEVICE
suffix:colon
id|rw
op_assign
id|WRITE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|first
op_assign
(paren
id|data
op_amp
id|PAGE_MASK
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|last
op_assign
(paren
(paren
id|data
op_plus
id|size
op_minus
l_int|1
)paren
op_amp
id|PAGE_MASK
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|dma-&gt;offset
op_assign
id|data
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|dma-&gt;nr_pages
op_assign
id|last
op_minus
id|first
op_plus
l_int|1
suffix:semicolon
id|dma-&gt;pages
op_assign
id|kmalloc
c_func
(paren
id|dma-&gt;nr_pages
op_star
r_sizeof
(paren
r_struct
id|page
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|dma-&gt;pages
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;init user [0x%lx+0x%lx =&gt; %d pages]&bslash;n&quot;
comma
id|data
comma
id|size
comma
id|dma-&gt;nr_pages
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
id|err
op_assign
id|get_user_pages
c_func
(paren
id|current
comma
id|current-&gt;mm
comma
id|data
op_amp
id|PAGE_MASK
comma
id|dma-&gt;nr_pages
comma
id|rw
op_eq
id|READ
comma
l_int|1
comma
multiline_comment|/* force */
id|dma-&gt;pages
comma
l_int|NULL
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|current-&gt;mm-&gt;mmap_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|dma-&gt;nr_pages
)paren
(brace
id|dma-&gt;nr_pages
op_assign
(paren
id|err
op_ge
l_int|0
)paren
ques
c_cond
id|err
suffix:colon
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;get_user_pages: err=%d [%d]&bslash;n&quot;
comma
id|err
comma
id|dma-&gt;nr_pages
)paren
suffix:semicolon
r_return
id|err
OL
l_int|0
ques
c_cond
id|err
suffix:colon
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_init_kernel
r_int
id|videobuf_dma_init_kernel
c_func
(paren
r_struct
id|videobuf_dmabuf
op_star
id|dma
comma
r_int
id|direction
comma
r_int
id|nr_pages
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;init kernel [%d pages]&bslash;n&quot;
comma
id|nr_pages
)paren
suffix:semicolon
id|dma-&gt;direction
op_assign
id|direction
suffix:semicolon
id|dma-&gt;vmalloc
op_assign
id|vmalloc_32
c_func
(paren
id|nr_pages
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|dma-&gt;vmalloc
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;vmalloc_32(%d pages) failed&bslash;n&quot;
comma
id|nr_pages
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dma-&gt;vmalloc
comma
l_int|0
comma
id|nr_pages
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|dma-&gt;nr_pages
op_assign
id|nr_pages
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_init_overlay
r_int
id|videobuf_dma_init_overlay
c_func
(paren
r_struct
id|videobuf_dmabuf
op_star
id|dma
comma
r_int
id|direction
comma
id|dma_addr_t
id|addr
comma
r_int
id|nr_pages
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;init overlay [%d pages @ bus 0x%lx]&bslash;n&quot;
comma
id|nr_pages
comma
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
id|dma-&gt;direction
op_assign
id|direction
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|addr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dma-&gt;bus_addr
op_assign
id|addr
suffix:semicolon
id|dma-&gt;nr_pages
op_assign
id|nr_pages
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_pci_map
r_int
id|videobuf_dma_pci_map
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|videobuf_dmabuf
op_star
id|dma
)paren
(brace
id|MAGIC_CHECK
c_func
(paren
id|dma-&gt;magic
comma
id|MAGIC_DMABUF
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
l_int|0
op_eq
id|dma-&gt;nr_pages
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;pages
)paren
(brace
id|dma-&gt;sglist
op_assign
id|videobuf_pages_to_sg
c_func
(paren
id|dma-&gt;pages
comma
id|dma-&gt;nr_pages
comma
id|dma-&gt;offset
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;vmalloc
)paren
(brace
id|dma-&gt;sglist
op_assign
id|videobuf_vmalloc_to_sg
(paren
id|dma-&gt;vmalloc
comma
id|dma-&gt;nr_pages
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;bus_addr
)paren
(brace
id|dma-&gt;sglist
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|scatterlist
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|dma-&gt;sglist
)paren
(brace
id|dma-&gt;sglen
op_assign
l_int|1
suffix:semicolon
id|sg_dma_address
c_func
(paren
op_amp
id|dma-&gt;sglist
(braket
l_int|0
)braket
)paren
op_assign
id|dma-&gt;bus_addr
op_amp
id|PAGE_MASK
suffix:semicolon
id|dma-&gt;sglist
(braket
l_int|0
)braket
dot
id|offset
op_assign
id|dma-&gt;bus_addr
op_amp
op_complement
id|PAGE_MASK
suffix:semicolon
id|sg_dma_len
c_func
(paren
op_amp
id|dma-&gt;sglist
(braket
l_int|0
)braket
)paren
op_assign
id|dma-&gt;nr_pages
op_star
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|dma-&gt;sglist
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;scatterlist is NULL&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;bus_addr
)paren
id|dma-&gt;sglen
op_assign
id|pci_map_sg
c_func
(paren
id|dev
comma
id|dma-&gt;sglist
comma
id|dma-&gt;nr_pages
comma
id|dma-&gt;direction
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_pci_sync
r_int
id|videobuf_dma_pci_sync
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|videobuf_dmabuf
op_star
id|dma
)paren
(brace
id|MAGIC_CHECK
c_func
(paren
id|dma-&gt;magic
comma
id|MAGIC_DMABUF
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|dma-&gt;sglen
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;bus_addr
)paren
id|pci_dma_sync_sg_for_cpu
c_func
(paren
id|dev
comma
id|dma-&gt;sglist
comma
id|dma-&gt;nr_pages
comma
id|dma-&gt;direction
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_pci_unmap
r_int
id|videobuf_dma_pci_unmap
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_struct
id|videobuf_dmabuf
op_star
id|dma
)paren
(brace
id|MAGIC_CHECK
c_func
(paren
id|dma-&gt;magic
comma
id|MAGIC_DMABUF
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;sglen
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;bus_addr
)paren
id|pci_unmap_sg
c_func
(paren
id|dev
comma
id|dma-&gt;sglist
comma
id|dma-&gt;nr_pages
comma
id|dma-&gt;direction
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dma-&gt;sglist
)paren
suffix:semicolon
id|dma-&gt;sglist
op_assign
l_int|NULL
suffix:semicolon
id|dma-&gt;sglen
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_dma_free
r_int
id|videobuf_dma_free
c_func
(paren
r_struct
id|videobuf_dmabuf
op_star
id|dma
)paren
(brace
id|MAGIC_CHECK
c_func
(paren
id|dma-&gt;magic
comma
id|MAGIC_DMABUF
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|dma-&gt;sglen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;pages
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma-&gt;nr_pages
suffix:semicolon
id|i
op_increment
)paren
id|page_cache_release
c_func
(paren
id|dma-&gt;pages
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dma-&gt;pages
)paren
suffix:semicolon
id|dma-&gt;pages
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;vmalloc
)paren
(brace
id|vfree
c_func
(paren
id|dma-&gt;vmalloc
)paren
suffix:semicolon
id|dma-&gt;vmalloc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;bus_addr
)paren
(brace
id|dma-&gt;bus_addr
op_assign
l_int|0
suffix:semicolon
)brace
id|dma-&gt;direction
op_assign
id|PCI_DMA_NONE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|videobuf_alloc
r_void
op_star
id|videobuf_alloc
c_func
(paren
r_int
r_int
id|size
)paren
(brace
r_struct
id|videobuf_buffer
op_star
id|vb
suffix:semicolon
id|vb
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_ne
id|vb
)paren
(brace
id|memset
c_func
(paren
id|vb
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|videobuf_dma_init
c_func
(paren
op_amp
id|vb-&gt;dma
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|vb-&gt;done
)paren
suffix:semicolon
id|vb-&gt;magic
op_assign
id|MAGIC_BUFFER
suffix:semicolon
)brace
r_return
id|vb
suffix:semicolon
)brace
DECL|function|videobuf_waiton
r_int
id|videobuf_waiton
c_func
(paren
r_struct
id|videobuf_buffer
op_star
id|vb
comma
r_int
id|non_blocking
comma
r_int
id|intr
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|MAGIC_CHECK
c_func
(paren
id|vb-&gt;magic
comma
id|MAGIC_BUFFER
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|vb-&gt;done
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|vb-&gt;state
op_eq
id|STATE_ACTIVE
op_logical_or
id|vb-&gt;state
op_eq
id|STATE_QUEUED
)paren
(brace
r_if
c_cond
(paren
id|non_blocking
)paren
(brace
id|retval
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|intr
ques
c_cond
id|TASK_INTERRUPTIBLE
suffix:colon
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vb-&gt;state
op_eq
id|STATE_ACTIVE
op_logical_or
id|vb-&gt;state
op_eq
id|STATE_QUEUED
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|intr
op_logical_and
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;buffer waiton: -EINTR&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EINTR
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|vb-&gt;done
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|videobuf_iolock
id|videobuf_iolock
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_struct
id|videobuf_buffer
op_star
id|vb
comma
r_struct
id|v4l2_framebuffer
op_star
id|fbuf
)paren
(brace
r_int
id|err
comma
id|pages
suffix:semicolon
id|dma_addr_t
id|bus
suffix:semicolon
id|MAGIC_CHECK
c_func
(paren
id|vb-&gt;magic
comma
id|MAGIC_BUFFER
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vb-&gt;memory
)paren
(brace
r_case
id|V4L2_MEMORY_MMAP
suffix:colon
r_case
id|V4L2_MEMORY_USERPTR
suffix:colon
r_if
c_cond
(paren
l_int|0
op_eq
id|vb-&gt;baddr
)paren
(brace
multiline_comment|/* no userspace addr -- kernel bounce buffer */
id|pages
op_assign
id|PAGE_ALIGN
c_func
(paren
id|vb-&gt;size
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|err
op_assign
id|videobuf_dma_init_kernel
c_func
(paren
op_amp
id|vb-&gt;dma
comma
id|PCI_DMA_FROMDEVICE
comma
id|pages
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* dma directly to userspace */
id|err
op_assign
id|videobuf_dma_init_user
c_func
(paren
op_amp
id|vb-&gt;dma
comma
id|PCI_DMA_FROMDEVICE
comma
id|vb-&gt;baddr
comma
id|vb-&gt;bsize
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_OVERLAY
suffix:colon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|fbuf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: need sanity checks for vb-&gt;boff */
id|bus
op_assign
(paren
id|dma_addr_t
)paren
id|fbuf-&gt;base
op_plus
id|vb-&gt;boff
suffix:semicolon
id|pages
op_assign
id|PAGE_ALIGN
c_func
(paren
id|vb-&gt;size
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|err
op_assign
id|videobuf_dma_init_overlay
c_func
(paren
op_amp
id|vb-&gt;dma
comma
id|PCI_DMA_FROMDEVICE
comma
id|bus
comma
id|pages
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|err
op_assign
id|videobuf_dma_pci_map
c_func
(paren
id|pci
comma
op_amp
id|vb-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
r_void
DECL|function|videobuf_queue_init
id|videobuf_queue_init
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|videobuf_queue_ops
op_star
id|ops
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|spinlock_t
op_star
id|irqlock
comma
r_enum
id|v4l2_buf_type
id|type
comma
r_enum
id|v4l2_field
id|field
comma
r_int
r_int
id|msize
)paren
(brace
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|q
)paren
)paren
suffix:semicolon
id|q-&gt;irqlock
op_assign
id|irqlock
suffix:semicolon
id|q-&gt;pci
op_assign
id|pci
suffix:semicolon
id|q-&gt;type
op_assign
id|type
suffix:semicolon
id|q-&gt;field
op_assign
id|field
suffix:semicolon
id|q-&gt;msize
op_assign
id|msize
suffix:semicolon
id|q-&gt;ops
op_assign
id|ops
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
)brace
r_int
DECL|function|videobuf_queue_is_busy
id|videobuf_queue_is_busy
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: streaming active&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;reading
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: pending read #1&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;read_buf
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: pending read #2&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|map
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: buffer #%d mapped&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
id|STATE_QUEUED
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: buffer #%d queued&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
id|STATE_ACTIVE
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;busy: buffer #%d avtive&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|videobuf_queue_cancel
id|videobuf_queue_cancel
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* remove queued buffers from list */
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_eq
id|STATE_QUEUED
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|queue
)paren
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|STATE_ERROR
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* free all buffers + clear queue */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
r_enum
id|v4l2_field
DECL|function|videobuf_next_field
id|videobuf_next_field
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_enum
id|v4l2_field
id|field
op_assign
id|q-&gt;field
suffix:semicolon
id|BUG_ON
c_func
(paren
id|V4L2_FIELD_ANY
op_eq
id|field
)paren
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_FIELD_ALTERNATE
op_eq
id|field
)paren
(brace
r_if
c_cond
(paren
id|V4L2_FIELD_TOP
op_eq
id|q-&gt;last
)paren
(brace
id|field
op_assign
id|V4L2_FIELD_BOTTOM
suffix:semicolon
id|q-&gt;last
op_assign
id|V4L2_FIELD_BOTTOM
suffix:semicolon
)brace
r_else
(brace
id|field
op_assign
id|V4L2_FIELD_TOP
suffix:semicolon
id|q-&gt;last
op_assign
id|V4L2_FIELD_TOP
suffix:semicolon
)brace
)brace
r_return
id|field
suffix:semicolon
)brace
r_void
DECL|function|videobuf_status
id|videobuf_status
c_func
(paren
r_struct
id|v4l2_buffer
op_star
id|b
comma
r_struct
id|videobuf_buffer
op_star
id|vb
comma
r_enum
id|v4l2_buf_type
id|type
)paren
(brace
id|MAGIC_CHECK
c_func
(paren
id|vb-&gt;magic
comma
id|MAGIC_BUFFER
)paren
suffix:semicolon
id|b-&gt;index
op_assign
id|vb-&gt;i
suffix:semicolon
id|b-&gt;type
op_assign
id|type
suffix:semicolon
id|b-&gt;memory
op_assign
id|vb-&gt;memory
suffix:semicolon
r_switch
c_cond
(paren
id|b-&gt;memory
)paren
(brace
r_case
id|V4L2_MEMORY_MMAP
suffix:colon
id|b-&gt;m.offset
op_assign
id|vb-&gt;boff
suffix:semicolon
id|b-&gt;length
op_assign
id|vb-&gt;bsize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_USERPTR
suffix:colon
id|b-&gt;m.userptr
op_assign
id|vb-&gt;baddr
suffix:semicolon
id|b-&gt;length
op_assign
id|vb-&gt;bsize
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_OVERLAY
suffix:colon
id|b-&gt;m.offset
op_assign
id|vb-&gt;boff
suffix:semicolon
r_break
suffix:semicolon
)brace
id|b-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vb-&gt;map
)paren
id|b-&gt;flags
op_or_assign
id|V4L2_BUF_FLAG_MAPPED
suffix:semicolon
r_switch
c_cond
(paren
id|vb-&gt;state
)paren
(brace
r_case
id|STATE_PREPARED
suffix:colon
r_case
id|STATE_QUEUED
suffix:colon
r_case
id|STATE_ACTIVE
suffix:colon
id|b-&gt;flags
op_or_assign
id|V4L2_BUF_FLAG_QUEUED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATE_DONE
suffix:colon
r_case
id|STATE_ERROR
suffix:colon
id|b-&gt;flags
op_or_assign
id|V4L2_BUF_FLAG_DONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|STATE_NEEDS_INIT
suffix:colon
r_case
id|STATE_IDLE
suffix:colon
multiline_comment|/* nothing */
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vb-&gt;input
op_ne
id|UNSET
)paren
(brace
id|b-&gt;flags
op_or_assign
id|V4L2_BUF_FLAG_INPUT
suffix:semicolon
id|b-&gt;input
op_assign
id|vb-&gt;input
suffix:semicolon
)brace
id|b-&gt;field
op_assign
id|vb-&gt;field
suffix:semicolon
id|b-&gt;timestamp
op_assign
id|vb-&gt;ts
suffix:semicolon
id|b-&gt;bytesused
op_assign
id|vb-&gt;size
suffix:semicolon
id|b-&gt;sequence
op_assign
id|vb-&gt;field_count
op_rshift
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|videobuf_reqbufs
id|videobuf_reqbufs
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|v4l2_requestbuffers
op_star
id|req
)paren
(brace
r_int
r_int
id|size
comma
id|count
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;type
op_ne
id|q-&gt;type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;count
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;memory
op_ne
id|V4L2_MEMORY_MMAP
op_logical_and
id|req-&gt;memory
op_ne
id|V4L2_MEMORY_USERPTR
op_logical_and
id|req-&gt;memory
op_ne
id|V4L2_MEMORY_OVERLAY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|q-&gt;stream
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|count
op_assign
id|req-&gt;count
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|VIDEO_MAX_FRAME
)paren
id|count
op_assign
id|VIDEO_MAX_FRAME
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_setup
c_func
(paren
id|priv
comma
op_amp
id|count
comma
op_amp
id|size
)paren
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;reqbufs: bufs=%d, size=0x%x [%d pages total]&bslash;n&quot;
comma
id|count
comma
id|size
comma
(paren
id|count
op_star
id|size
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|retval
op_assign
id|videobuf_mmap_setup
c_func
(paren
id|priv
comma
id|q
comma
id|count
comma
id|size
comma
id|req-&gt;memory
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|done
suffix:semicolon
id|req-&gt;count
op_assign
id|count
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|videobuf_querybuf
id|videobuf_querybuf
c_func
(paren
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|v4l2_buffer
op_star
id|b
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|b-&gt;type
op_ne
id|q-&gt;type
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|b-&gt;index
OL
l_int|0
op_logical_or
id|b-&gt;index
op_ge
id|VIDEO_MAX_FRAME
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|b-&gt;index
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|videobuf_status
c_func
(paren
id|b
comma
id|q-&gt;bufs
(braket
id|b-&gt;index
)braket
comma
id|q-&gt;type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|videobuf_qbuf
id|videobuf_qbuf
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|v4l2_buffer
op_star
id|b
)paren
(brace
r_struct
id|videobuf_buffer
op_star
id|buf
suffix:semicolon
r_enum
id|v4l2_field
id|field
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;reading
)paren
r_goto
id|done
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;type
op_ne
id|q-&gt;type
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;index
OL
l_int|0
op_logical_or
id|b-&gt;index
op_ge
id|VIDEO_MAX_FRAME
)paren
r_goto
id|done
suffix:semicolon
id|buf
op_assign
id|q-&gt;bufs
(braket
id|b-&gt;index
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|buf
)paren
r_goto
id|done
suffix:semicolon
id|MAGIC_CHECK
c_func
(paren
id|buf-&gt;magic
comma
id|MAGIC_BUFFER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;memory
op_ne
id|b-&gt;memory
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;state
op_eq
id|STATE_QUEUED
op_logical_or
id|buf-&gt;state
op_eq
id|STATE_ACTIVE
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;flags
op_amp
id|V4L2_BUF_FLAG_INPUT
)paren
(brace
r_if
c_cond
(paren
id|b-&gt;input
op_ge
id|q-&gt;inputs
)paren
r_goto
id|done
suffix:semicolon
id|buf-&gt;input
op_assign
id|b-&gt;input
suffix:semicolon
)brace
r_else
(brace
id|buf-&gt;input
op_assign
id|UNSET
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|b-&gt;memory
)paren
(brace
r_case
id|V4L2_MEMORY_MMAP
suffix:colon
r_if
c_cond
(paren
l_int|0
op_eq
id|buf-&gt;baddr
)paren
r_goto
id|done
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_USERPTR
suffix:colon
r_if
c_cond
(paren
id|b-&gt;length
OL
id|buf-&gt;bsize
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|STATE_NEEDS_INIT
op_ne
id|buf-&gt;state
op_logical_and
id|buf-&gt;baddr
op_ne
id|b-&gt;m.userptr
)paren
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|buf
)paren
suffix:semicolon
id|buf-&gt;baddr
op_assign
id|b-&gt;m.userptr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_OVERLAY
suffix:colon
id|buf-&gt;boff
op_assign
id|b-&gt;m.offset
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|done
suffix:semicolon
)brace
id|field
op_assign
id|videobuf_next_field
c_func
(paren
id|q
)paren
suffix:semicolon
id|retval
op_assign
id|q-&gt;ops
op_member_access_from_pointer
id|buf_prepare
c_func
(paren
id|priv
comma
id|buf
comma
id|field
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|retval
)paren
r_goto
id|done
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|buf-&gt;stream
comma
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|buf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|videobuf_dqbuf
id|videobuf_dqbuf
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_struct
id|v4l2_buffer
op_star
id|b
comma
r_int
id|nonblocking
)paren
(brace
r_struct
id|videobuf_buffer
op_star
id|buf
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;reading
)paren
r_goto
id|done
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;type
op_ne
id|q-&gt;type
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|q-&gt;stream
)paren
)paren
r_goto
id|done
suffix:semicolon
id|buf
op_assign
id|list_entry
c_func
(paren
id|q-&gt;stream.next
comma
r_struct
id|videobuf_buffer
comma
id|stream
)paren
suffix:semicolon
id|retval
op_assign
id|videobuf_waiton
c_func
(paren
id|buf
comma
id|nonblocking
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|done
suffix:semicolon
r_switch
c_cond
(paren
id|buf-&gt;state
)paren
(brace
r_case
id|STATE_ERROR
suffix:colon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|STATE_DONE
suffix:colon
id|videobuf_dma_pci_sync
c_func
(paren
id|q-&gt;pci
comma
op_amp
id|buf-&gt;dma
)paren
suffix:semicolon
id|buf-&gt;state
op_assign
id|STATE_IDLE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|buf-&gt;stream
)paren
suffix:semicolon
id|memset
c_func
(paren
id|b
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|b
)paren
)paren
suffix:semicolon
id|videobuf_status
c_func
(paren
id|b
comma
id|buf
comma
id|q-&gt;type
)paren
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|videobuf_streamon
r_int
id|videobuf_streamon
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_struct
id|videobuf_buffer
op_star
id|buf
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;reading
)paren
r_goto
id|done
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
r_goto
id|done
suffix:semicolon
id|q-&gt;streaming
op_assign
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|q-&gt;stream
)paren
(brace
id|buf
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|videobuf_buffer
comma
id|stream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;state
op_eq
id|STATE_PREPARED
)paren
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|buf
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|videobuf_streamoff
r_int
id|videobuf_streamoff
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_int
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;streaming
)paren
r_goto
id|done
suffix:semicolon
id|videobuf_queue_cancel
c_func
(paren
id|priv
comma
id|q
)paren
suffix:semicolon
id|q-&gt;streaming
op_assign
l_int|0
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|videobuf_read_zerocopy
id|videobuf_read_zerocopy
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_char
id|__user
op_star
id|data
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_enum
id|v4l2_field
id|field
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|retval
suffix:semicolon
multiline_comment|/* setup stuff */
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|q-&gt;read_buf
op_assign
id|videobuf_alloc
c_func
(paren
id|q-&gt;msize
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
)paren
r_goto
id|done
suffix:semicolon
id|q-&gt;read_buf-&gt;memory
op_assign
id|V4L2_MEMORY_USERPTR
suffix:semicolon
id|q-&gt;read_buf-&gt;baddr
op_assign
(paren
r_int
r_int
)paren
id|data
suffix:semicolon
id|q-&gt;read_buf-&gt;bsize
op_assign
id|count
suffix:semicolon
id|field
op_assign
id|videobuf_next_field
c_func
(paren
id|q
)paren
suffix:semicolon
id|retval
op_assign
id|q-&gt;ops
op_member_access_from_pointer
id|buf_prepare
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
comma
id|field
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|retval
)paren
r_goto
id|done
suffix:semicolon
multiline_comment|/* start capture &amp; wait */
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|retval
op_assign
id|videobuf_waiton
c_func
(paren
id|q-&gt;read_buf
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|retval
)paren
(brace
id|videobuf_dma_pci_sync
c_func
(paren
id|q-&gt;pci
comma
op_amp
id|q-&gt;read_buf-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|STATE_ERROR
op_eq
id|q-&gt;read_buf-&gt;state
)paren
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_else
id|retval
op_assign
id|q-&gt;read_buf-&gt;size
suffix:semicolon
)brace
id|done
suffix:colon
multiline_comment|/* cleanup */
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q-&gt;read_buf
)paren
suffix:semicolon
id|q-&gt;read_buf
op_assign
l_int|NULL
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|videobuf_read_one
id|ssize_t
id|videobuf_read_one
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_char
id|__user
op_star
id|data
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
comma
r_int
id|nonblocking
)paren
(brace
r_enum
id|v4l2_field
id|field
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|size
comma
id|nbufs
comma
id|bytes
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|nbufs
op_assign
l_int|1
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_setup
c_func
(paren
id|priv
comma
op_amp
id|nbufs
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
op_logical_and
id|count
op_ge
id|size
op_logical_and
op_logical_neg
id|nonblocking
)paren
(brace
id|retval
op_assign
id|videobuf_read_zerocopy
c_func
(paren
id|priv
comma
id|q
comma
id|data
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_ge
l_int|0
op_logical_or
id|retval
op_eq
op_minus
id|EIO
)paren
multiline_comment|/* ok, all done */
r_goto
id|done
suffix:semicolon
multiline_comment|/* fallback to kernel bounce buffer on failures */
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
)paren
(brace
multiline_comment|/* need to capture a new frame */
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|q-&gt;read_buf
op_assign
id|videobuf_alloc
c_func
(paren
id|q-&gt;msize
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
)paren
r_goto
id|done
suffix:semicolon
id|q-&gt;read_buf-&gt;memory
op_assign
id|V4L2_MEMORY_USERPTR
suffix:semicolon
id|field
op_assign
id|videobuf_next_field
c_func
(paren
id|q
)paren
suffix:semicolon
id|retval
op_assign
id|q-&gt;ops
op_member_access_from_pointer
id|buf_prepare
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
comma
id|field
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|retval
)paren
r_goto
id|done
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;read_off
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* wait until capture is done */
id|retval
op_assign
id|videobuf_waiton
c_func
(paren
id|q-&gt;read_buf
comma
id|nonblocking
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|retval
)paren
r_goto
id|done
suffix:semicolon
id|videobuf_dma_pci_sync
c_func
(paren
id|q-&gt;pci
comma
op_amp
id|q-&gt;read_buf-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|STATE_ERROR
op_eq
id|q-&gt;read_buf-&gt;state
)paren
(brace
multiline_comment|/* catch I/O errors */
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q-&gt;read_buf
)paren
suffix:semicolon
id|q-&gt;read_buf
op_assign
l_int|NULL
suffix:semicolon
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* copy to userspace */
id|bytes
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|bytes
OG
id|q-&gt;read_buf-&gt;size
op_minus
id|q-&gt;read_off
)paren
id|bytes
op_assign
id|q-&gt;read_buf-&gt;size
op_minus
id|q-&gt;read_off
suffix:semicolon
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|data
comma
id|q-&gt;read_buf-&gt;dma.vmalloc
op_plus
id|q-&gt;read_off
comma
id|bytes
)paren
)paren
r_goto
id|done
suffix:semicolon
id|retval
op_assign
id|bytes
suffix:semicolon
id|q-&gt;read_off
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;read_off
op_eq
id|q-&gt;read_buf-&gt;size
)paren
(brace
multiline_comment|/* all data copied, cleanup */
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q-&gt;read_buf
)paren
suffix:semicolon
id|q-&gt;read_buf
op_assign
l_int|NULL
suffix:semicolon
)brace
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|videobuf_read_start
r_int
id|videobuf_read_start
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_enum
id|v4l2_field
id|field
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
op_assign
l_int|0
comma
id|size
op_assign
l_int|0
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_setup
c_func
(paren
id|priv
comma
op_amp
id|count
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|2
)paren
id|count
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|VIDEO_MAX_FRAME
)paren
id|count
op_assign
id|VIDEO_MAX_FRAME
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|err
op_assign
id|videobuf_mmap_setup
c_func
(paren
id|priv
comma
id|q
comma
id|count
comma
id|size
comma
id|V4L2_MEMORY_USERPTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|field
op_assign
id|videobuf_next_field
c_func
(paren
id|q
)paren
suffix:semicolon
id|err
op_assign
id|q-&gt;ops
op_member_access_from_pointer
id|buf_prepare
c_func
(paren
id|priv
comma
id|q-&gt;bufs
(braket
id|i
)braket
comma
id|field
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|stream
comma
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;reading
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_read_stop
r_void
id|videobuf_read_stop
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
id|videobuf_queue_cancel
c_func
(paren
id|priv
comma
id|q
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|kfree
c_func
(paren
id|q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|q-&gt;read_buf
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;reading
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_read_stream
id|ssize_t
id|videobuf_read_stream
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_char
id|__user
op_star
id|data
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
comma
r_int
id|vbihack
comma
r_int
id|nonblocking
)paren
(brace
r_int
r_int
op_star
id|fc
comma
id|bytes
suffix:semicolon
r_int
id|err
comma
id|retval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;reading
)paren
(brace
id|retval
op_assign
id|videobuf_read_start
c_func
(paren
id|priv
comma
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_goto
id|done
suffix:semicolon
)brace
id|retval
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
multiline_comment|/* get / wait for data */
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
)paren
(brace
id|q-&gt;read_buf
op_assign
id|list_entry
c_func
(paren
id|q-&gt;stream.next
comma
r_struct
id|videobuf_buffer
comma
id|stream
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|q-&gt;read_buf-&gt;stream
)paren
suffix:semicolon
id|q-&gt;read_off
op_assign
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|videobuf_waiton
c_func
(paren
id|q-&gt;read_buf
comma
id|nonblocking
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_eq
id|retval
)paren
id|retval
op_assign
id|err
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;read_buf-&gt;state
op_eq
id|STATE_DONE
)paren
(brace
r_if
c_cond
(paren
id|vbihack
)paren
(brace
multiline_comment|/* dirty, undocumented hack -- pass the frame counter&n;&t;&t;&t;&t; * within the last four bytes of each vbi data block.&n;&t;&t;&t;&t; * We need that one to maintain backward compatibility&n;&t;&t;&t;&t; * to all vbi decoding software out there ... */
id|fc
op_assign
(paren
r_int
r_int
op_star
)paren
id|q-&gt;read_buf-&gt;dma.vmalloc
suffix:semicolon
id|fc
op_add_assign
(paren
id|q-&gt;read_buf-&gt;size
op_rshift
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
op_star
id|fc
op_assign
id|q-&gt;read_buf-&gt;field_count
op_rshift
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;vbihack: %d&bslash;n&quot;
comma
op_star
id|fc
)paren
suffix:semicolon
)brace
multiline_comment|/* copy stuff */
id|bytes
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|bytes
OG
id|q-&gt;read_buf-&gt;size
op_minus
id|q-&gt;read_off
)paren
id|bytes
op_assign
id|q-&gt;read_buf-&gt;size
op_minus
id|q-&gt;read_off
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|data
op_plus
id|retval
comma
id|q-&gt;read_buf-&gt;dma.vmalloc
op_plus
id|q-&gt;read_off
comma
id|bytes
)paren
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_eq
id|retval
)paren
id|retval
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|count
op_sub_assign
id|bytes
suffix:semicolon
id|retval
op_add_assign
id|bytes
suffix:semicolon
id|q-&gt;read_off
op_add_assign
id|bytes
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* some error */
id|q-&gt;read_off
op_assign
id|q-&gt;read_buf-&gt;size
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|retval
)paren
id|retval
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* requeue buffer when done with copying */
r_if
c_cond
(paren
id|q-&gt;read_off
op_eq
id|q-&gt;read_buf-&gt;size
)paren
(brace
id|list_add_tail
c_func
(paren
op_amp
id|q-&gt;read_buf-&gt;stream
comma
op_amp
id|q-&gt;stream
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_queue
c_func
(paren
id|priv
comma
id|q-&gt;read_buf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|q-&gt;irqlock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;read_buf
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|videobuf_poll_stream
r_int
r_int
id|videobuf_poll_stream
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|videobuf_buffer
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;streaming
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|q-&gt;stream
)paren
)paren
id|buf
op_assign
id|list_entry
c_func
(paren
id|q-&gt;stream.next
comma
r_struct
id|videobuf_buffer
comma
id|stream
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;reading
)paren
id|videobuf_read_start
c_func
(paren
id|priv
comma
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;reading
)paren
(brace
id|rc
op_assign
id|POLLERR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;read_buf
)paren
(brace
id|q-&gt;read_buf
op_assign
id|list_entry
c_func
(paren
id|q-&gt;stream.next
comma
r_struct
id|videobuf_buffer
comma
id|stream
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|q-&gt;read_buf-&gt;stream
)paren
suffix:semicolon
id|q-&gt;read_off
op_assign
l_int|0
suffix:semicolon
)brace
id|buf
op_assign
id|q-&gt;read_buf
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
id|rc
op_assign
id|POLLERR
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|rc
)paren
(brace
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|buf-&gt;done
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;state
op_eq
id|STATE_DONE
op_logical_or
id|buf-&gt;state
op_eq
id|STATE_ERROR
)paren
id|rc
op_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
r_static
r_void
DECL|function|videobuf_vm_open
id|videobuf_vm_open
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|videobuf_mapping
op_star
id|map
op_assign
id|vma-&gt;vm_private_data
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;vm_open %p [count=%d,vma=%08lx-%08lx]&bslash;n&quot;
comma
id|map
comma
id|map-&gt;count
comma
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_end
)paren
suffix:semicolon
id|map-&gt;count
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|videobuf_vm_close
id|videobuf_vm_close
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|videobuf_mapping
op_star
id|map
op_assign
id|vma-&gt;vm_private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;vm_close %p [count=%d,vma=%08lx-%08lx]&bslash;n&quot;
comma
id|map
comma
id|map-&gt;count
comma
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_end
)paren
suffix:semicolon
multiline_comment|/* down(&amp;fh-&gt;lock); FIXME */
id|map-&gt;count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|map-&gt;count
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;munmap %p&bslash;n&quot;
comma
id|map
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|map
op_ne
id|map
)paren
r_continue
suffix:semicolon
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|map
op_assign
l_int|NULL
suffix:semicolon
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|baddr
op_assign
l_int|0
suffix:semicolon
id|map-&gt;q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|vma-&gt;vm_file-&gt;private_data
comma
id|map-&gt;q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|map
)paren
suffix:semicolon
)brace
multiline_comment|/* up(&amp;fh-&gt;lock); FIXME */
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Get a anonymous page for the mapping.  Make sure we can DMA to that&n; * memory location with 32bit PCI devices (i.e. don&squot;t use highmem for&n; * now ...).  Bounce buffers don&squot;t work very well for the data rates&n; * video capture has.&n; */
r_static
r_struct
id|page
op_star
DECL|function|videobuf_vm_nopage
id|videobuf_vm_nopage
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|vaddr
comma
r_int
op_star
id|type
)paren
(brace
r_struct
id|page
op_star
id|page
suffix:semicolon
id|dprintk
c_func
(paren
l_int|3
comma
l_string|&quot;nopage: fault @ %08lx [vma %08lx-%08lx]&bslash;n&quot;
comma
id|vaddr
comma
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vaddr
OG
id|vma-&gt;vm_end
)paren
r_return
id|NOPAGE_SIGBUS
suffix:semicolon
id|page
op_assign
id|alloc_page
c_func
(paren
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
r_return
id|NOPAGE_OOM
suffix:semicolon
id|clear_user_page
c_func
(paren
id|page_address
c_func
(paren
id|page
)paren
comma
id|vaddr
comma
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
)paren
op_star
id|type
op_assign
id|VM_FAULT_MINOR
suffix:semicolon
r_return
id|page
suffix:semicolon
)brace
DECL|variable|videobuf_vm_ops
r_static
r_struct
id|vm_operations_struct
id|videobuf_vm_ops
op_assign
(brace
dot
id|open
op_assign
id|videobuf_vm_open
comma
dot
id|close
op_assign
id|videobuf_vm_close
comma
dot
id|nopage
op_assign
id|videobuf_vm_nopage
comma
)brace
suffix:semicolon
DECL|function|videobuf_mmap_setup
r_int
id|videobuf_mmap_setup
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
comma
r_int
r_int
id|bcount
comma
r_int
r_int
id|bsize
comma
r_enum
id|v4l2_memory
id|memory
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|videobuf_mmap_free
c_func
(paren
id|priv
comma
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|err
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bcount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q-&gt;bufs
(braket
id|i
)braket
op_assign
id|videobuf_alloc
c_func
(paren
id|q-&gt;msize
)paren
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|i
op_assign
id|i
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|input
op_assign
id|UNSET
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|memory
op_assign
id|memory
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|bsize
op_assign
id|bsize
suffix:semicolon
r_switch
c_cond
(paren
id|memory
)paren
(brace
r_case
id|V4L2_MEMORY_MMAP
suffix:colon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|boff
op_assign
id|bsize
op_star
id|i
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_MEMORY_USERPTR
suffix:colon
r_case
id|V4L2_MEMORY_OVERLAY
suffix:colon
multiline_comment|/* nothing */
r_break
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap setup: %d buffers, %d bytes each&bslash;n&quot;
comma
id|bcount
comma
id|bsize
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_mmap_free
r_int
id|videobuf_mmap_free
c_func
(paren
r_void
op_star
id|priv
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|i
)braket
op_logical_and
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|map
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|q-&gt;ops
op_member_access_from_pointer
id|buf_release
c_func
(paren
id|priv
comma
id|q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|videobuf_mmap_mapper
r_int
id|videobuf_mmap_mapper
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_struct
id|videobuf_queue
op_star
id|q
)paren
(brace
r_struct
id|videobuf_mapping
op_star
id|map
suffix:semicolon
r_int
r_int
id|first
comma
id|last
comma
id|size
comma
id|i
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|down
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap app bug: PROT_WRITE please&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_SHARED
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap app bug: MAP_SHARED please&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* look for first buffer to map */
r_for
c_loop
(paren
id|first
op_assign
l_int|0
suffix:semicolon
id|first
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|first
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|first
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_MEMORY_MMAP
op_ne
id|q-&gt;bufs
(braket
id|first
)braket
op_member_access_from_pointer
id|memory
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|first
)braket
op_member_access_from_pointer
id|boff
op_eq
(paren
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|VIDEO_MAX_FRAME
op_eq
id|first
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap app bug: offset invalid [offset=0x%lx]&bslash;n&quot;
comma
(paren
id|vma-&gt;vm_pgoff
op_lshift
id|PAGE_SHIFT
)paren
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* look for last buffer to map */
r_for
c_loop
(paren
id|size
op_assign
l_int|0
comma
id|last
op_assign
id|first
suffix:semicolon
id|last
OL
id|VIDEO_MAX_FRAME
suffix:semicolon
id|last
op_increment
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|q-&gt;bufs
(braket
id|last
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_MEMORY_MMAP
op_ne
id|q-&gt;bufs
(braket
id|last
)braket
op_member_access_from_pointer
id|memory
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;bufs
(braket
id|last
)braket
op_member_access_from_pointer
id|map
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|size
op_add_assign
id|q-&gt;bufs
(braket
id|last
)braket
op_member_access_from_pointer
id|bsize
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|VIDEO_MAX_FRAME
op_eq
id|last
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap app bug: size invalid [size=0x%lx]&bslash;n&quot;
comma
(paren
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
)paren
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* create mapping + update buffer list */
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|map
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|videobuf_mapping
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|map
)paren
r_goto
id|done
suffix:semicolon
r_for
c_loop
(paren
id|size
op_assign
l_int|0
comma
id|i
op_assign
id|first
suffix:semicolon
id|i
op_le
id|last
suffix:semicolon
id|size
op_add_assign
id|q-&gt;bufs
(braket
id|i
op_increment
)braket
op_member_access_from_pointer
id|bsize
)paren
(brace
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|map
op_assign
id|map
suffix:semicolon
id|q-&gt;bufs
(braket
id|i
)braket
op_member_access_from_pointer
id|baddr
op_assign
id|vma-&gt;vm_start
op_plus
id|size
suffix:semicolon
)brace
id|map-&gt;count
op_assign
l_int|1
suffix:semicolon
id|map-&gt;start
op_assign
id|vma-&gt;vm_start
suffix:semicolon
id|map-&gt;end
op_assign
id|vma-&gt;vm_end
suffix:semicolon
id|map-&gt;q
op_assign
id|q
suffix:semicolon
id|vma-&gt;vm_ops
op_assign
op_amp
id|videobuf_vm_ops
suffix:semicolon
id|vma-&gt;vm_flags
op_or_assign
id|VM_DONTEXPAND
op_or
id|VM_RESERVED
suffix:semicolon
id|vma-&gt;vm_flags
op_and_assign
op_complement
id|VM_IO
suffix:semicolon
multiline_comment|/* using shared anonymous pages */
id|vma-&gt;vm_private_data
op_assign
id|map
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;mmap %p: %08lx-%08lx pgoff %08lx bufs %d-%d&bslash;n&quot;
comma
id|map
comma
id|vma-&gt;vm_start
comma
id|vma-&gt;vm_end
comma
id|vma-&gt;vm_pgoff
comma
id|first
comma
id|last
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|done
suffix:colon
id|up
c_func
(paren
op_amp
id|q-&gt;lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|videobuf_vmalloc_to_sg
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_vmalloc_to_sg
)paren
suffix:semicolon
DECL|variable|videobuf_dma_init
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_init
)paren
suffix:semicolon
DECL|variable|videobuf_dma_init_user
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_init_user
)paren
suffix:semicolon
DECL|variable|videobuf_dma_init_kernel
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_init_kernel
)paren
suffix:semicolon
DECL|variable|videobuf_dma_init_overlay
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_init_overlay
)paren
suffix:semicolon
DECL|variable|videobuf_dma_pci_map
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_pci_map
)paren
suffix:semicolon
DECL|variable|videobuf_dma_pci_sync
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_pci_sync
)paren
suffix:semicolon
DECL|variable|videobuf_dma_pci_unmap
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_pci_unmap
)paren
suffix:semicolon
DECL|variable|videobuf_dma_free
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dma_free
)paren
suffix:semicolon
DECL|variable|videobuf_alloc
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_alloc
)paren
suffix:semicolon
DECL|variable|videobuf_waiton
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_waiton
)paren
suffix:semicolon
DECL|variable|videobuf_iolock
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_iolock
)paren
suffix:semicolon
DECL|variable|videobuf_queue_init
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_queue_init
)paren
suffix:semicolon
DECL|variable|videobuf_queue_cancel
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_queue_cancel
)paren
suffix:semicolon
DECL|variable|videobuf_queue_is_busy
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_queue_is_busy
)paren
suffix:semicolon
DECL|variable|videobuf_next_field
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_next_field
)paren
suffix:semicolon
DECL|variable|videobuf_status
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_status
)paren
suffix:semicolon
DECL|variable|videobuf_reqbufs
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_reqbufs
)paren
suffix:semicolon
DECL|variable|videobuf_querybuf
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_querybuf
)paren
suffix:semicolon
DECL|variable|videobuf_qbuf
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_qbuf
)paren
suffix:semicolon
DECL|variable|videobuf_dqbuf
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_dqbuf
)paren
suffix:semicolon
DECL|variable|videobuf_streamon
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_streamon
)paren
suffix:semicolon
DECL|variable|videobuf_streamoff
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_streamoff
)paren
suffix:semicolon
DECL|variable|videobuf_read_start
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_read_start
)paren
suffix:semicolon
DECL|variable|videobuf_read_stop
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_read_stop
)paren
suffix:semicolon
DECL|variable|videobuf_read_stream
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_read_stream
)paren
suffix:semicolon
DECL|variable|videobuf_read_one
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_read_one
)paren
suffix:semicolon
DECL|variable|videobuf_poll_stream
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_poll_stream
)paren
suffix:semicolon
DECL|variable|videobuf_mmap_setup
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_mmap_setup
)paren
suffix:semicolon
DECL|variable|videobuf_mmap_free
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_mmap_free
)paren
suffix:semicolon
DECL|variable|videobuf_mmap_mapper
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|videobuf_mmap_mapper
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
