multiline_comment|/*&n;    mxb.c - v4l2 driver for the Multimedia eXtension Board&n;    &n;    Copyright (C) 1998-2003 Michael Hunold &lt;michael@mihu.de&gt;&n;&n;    Visit http://www.mihu.de/linux/saa7146/mxb/&n;    for further details about this card.&n;    &n;    This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;*/
DECL|macro|DEBUG_VARIABLE
mdefine_line|#define DEBUG_VARIABLE debug
macro_line|#include &lt;media/saa7146_vv.h&gt;
macro_line|#include &lt;media/tuner.h&gt;
macro_line|#include &lt;linux/video_decoder.h&gt;
macro_line|#include &quot;mxb.h&quot;
macro_line|#include &quot;tea6415c.h&quot;
macro_line|#include &quot;tea6420.h&quot;
macro_line|#include &quot;tda9840.h&quot;
DECL|macro|I2C_SAA7111
mdefine_line|#define I2C_SAA7111 0x24
DECL|macro|MXB_BOARD_CAN_DO_VBI
mdefine_line|#define MXB_BOARD_CAN_DO_VBI(dev)   (dev-&gt;revision != 0) 
multiline_comment|/* global variable */
DECL|variable|mxb_num
r_static
r_int
id|mxb_num
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initial frequence the tuner will be tuned to. &n;   in verden (lower saxony, germany) 4148 is a&n;   channel called &quot;phoenix&quot; */
DECL|variable|freq
r_static
r_int
id|freq
op_assign
l_int|4148
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|freq
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|freq
comma
l_string|&quot;initial frequency the tuner will be tuned to while setup&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;debug verbosity&quot;
)paren
suffix:semicolon
DECL|macro|MXB_INPUTS
mdefine_line|#define MXB_INPUTS 4
DECL|enumerator|TUNER
DECL|enumerator|AUX1
DECL|enumerator|AUX3
DECL|enumerator|AUX3_YC
r_enum
(brace
id|TUNER
comma
id|AUX1
comma
id|AUX3
comma
id|AUX3_YC
)brace
suffix:semicolon
DECL|variable|mxb_inputs
r_static
r_struct
id|v4l2_input
id|mxb_inputs
(braket
id|MXB_INPUTS
)braket
op_assign
(brace
(brace
id|TUNER
comma
l_string|&quot;Tuner&quot;
comma
id|V4L2_INPUT_TYPE_TUNER
comma
l_int|1
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
(brace
id|AUX1
comma
l_string|&quot;AUX1&quot;
comma
id|V4L2_INPUT_TYPE_CAMERA
comma
l_int|2
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
(brace
id|AUX3
comma
l_string|&quot;AUX3 Composite&quot;
comma
id|V4L2_INPUT_TYPE_CAMERA
comma
l_int|4
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
(brace
id|AUX3_YC
comma
l_string|&quot;AUX3 S-Video&quot;
comma
id|V4L2_INPUT_TYPE_CAMERA
comma
l_int|4
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* this array holds the information, which port of the saa7146 each&n;   input actually uses. the mxb uses port 0 for every input */
r_static
r_struct
(brace
DECL|member|hps_source
r_int
id|hps_source
suffix:semicolon
DECL|member|hps_sync
r_int
id|hps_sync
suffix:semicolon
DECL|variable|input_port_selection
)brace
id|input_port_selection
(braket
id|MXB_INPUTS
)braket
op_assign
(brace
(brace
id|SAA7146_HPS_SOURCE_PORT_A
comma
id|SAA7146_HPS_SYNC_PORT_A
)brace
comma
(brace
id|SAA7146_HPS_SOURCE_PORT_A
comma
id|SAA7146_HPS_SYNC_PORT_A
)brace
comma
(brace
id|SAA7146_HPS_SOURCE_PORT_A
comma
id|SAA7146_HPS_SYNC_PORT_A
)brace
comma
(brace
id|SAA7146_HPS_SOURCE_PORT_A
comma
id|SAA7146_HPS_SYNC_PORT_A
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* this array holds the information of the audio source (mxb_audios),&n;   which has to be switched corresponding to the video source (mxb_channels) */
DECL|variable|video_audio_connect
r_static
r_int
id|video_audio_connect
(braket
id|MXB_INPUTS
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|3
comma
l_int|3
)brace
suffix:semicolon
multiline_comment|/* these are the necessary input-output-pins for bringing one audio source&n;(see above) to the CD-output */
DECL|variable|TEA6420_cd
r_static
r_struct
id|tea6420_multiplex
id|TEA6420_cd
(braket
id|MXB_AUDIOS
op_plus
l_int|1
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
(brace
l_int|1
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|1
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* Tuner */
(brace
(brace
l_int|5
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* AUX 1 */
(brace
(brace
l_int|4
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* AUX 2 */
(brace
(brace
l_int|3
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* AUX 3 */
(brace
(brace
l_int|1
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|3
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* Radio */
(brace
(brace
l_int|1
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|2
comma
l_int|1
comma
l_int|0
)brace
)brace
comma
multiline_comment|/* CD-Rom */
(brace
(brace
l_int|6
comma
l_int|1
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|1
comma
l_int|0
)brace
)brace
multiline_comment|/* Mute */
)brace
suffix:semicolon
multiline_comment|/* these are the necessary input-output-pins for bringing one audio source&n;(see above) to the line-output */
DECL|variable|TEA6420_line
r_static
r_struct
id|tea6420_multiplex
id|TEA6420_line
(braket
id|MXB_AUDIOS
op_plus
l_int|1
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
(brace
l_int|2
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|1
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|5
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|4
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|3
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|2
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|3
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|2
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|2
comma
l_int|2
comma
l_int|0
)brace
)brace
comma
(brace
(brace
l_int|6
comma
l_int|3
comma
l_int|0
)brace
comma
(brace
l_int|6
comma
l_int|2
comma
l_int|0
)brace
)brace
multiline_comment|/* Mute */
)brace
suffix:semicolon
DECL|macro|MAXCONTROLS
mdefine_line|#define MAXCONTROLS&t;1
DECL|variable|mxb_controls
r_static
r_struct
id|v4l2_queryctrl
id|mxb_controls
(braket
)braket
op_assign
(brace
(brace
id|V4L2_CID_AUDIO_MUTE
comma
id|V4L2_CTRL_TYPE_BOOLEAN
comma
l_string|&quot;Mute&quot;
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|variable|ioctls
r_static
r_struct
id|saa7146_extension_ioctls
id|ioctls
(braket
)braket
op_assign
(brace
(brace
id|VIDIOC_ENUMINPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_QUERYCTRL
comma
id|SAA7146_BEFORE
)brace
comma
(brace
id|VIDIOC_G_CTRL
comma
id|SAA7146_BEFORE
)brace
comma
(brace
id|VIDIOC_S_CTRL
comma
id|SAA7146_BEFORE
)brace
comma
(brace
id|VIDIOC_G_TUNER
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_TUNER
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_FREQUENCY
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_FREQUENCY
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_AUDIO
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_AUDIO
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|MXB_S_AUDIO_CD
comma
id|SAA7146_EXCLUSIVE
)brace
comma
multiline_comment|/* custom control */
(brace
id|MXB_S_AUDIO_LINE
comma
id|SAA7146_EXCLUSIVE
)brace
comma
multiline_comment|/* custom control */
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|struct|mxb
r_struct
id|mxb
(brace
DECL|member|video_dev
r_struct
id|video_device
op_star
id|video_dev
suffix:semicolon
DECL|member|vbi_dev
r_struct
id|video_device
op_star
id|vbi_dev
suffix:semicolon
DECL|member|i2c_adapter
r_struct
id|i2c_adapter
id|i2c_adapter
suffix:semicolon
DECL|member|saa7111a
r_struct
id|i2c_client
op_star
id|saa7111a
suffix:semicolon
DECL|member|tda9840
r_struct
id|i2c_client
op_star
id|tda9840
suffix:semicolon
DECL|member|tea6415c
r_struct
id|i2c_client
op_star
id|tea6415c
suffix:semicolon
DECL|member|tuner
r_struct
id|i2c_client
op_star
id|tuner
suffix:semicolon
DECL|member|tea6420_1
r_struct
id|i2c_client
op_star
id|tea6420_1
suffix:semicolon
DECL|member|tea6420_2
r_struct
id|i2c_client
op_star
id|tea6420_2
suffix:semicolon
DECL|member|cur_mode
r_int
id|cur_mode
suffix:semicolon
multiline_comment|/* current audio mode (mono, stereo, ...) */
DECL|member|cur_input
r_int
id|cur_input
suffix:semicolon
multiline_comment|/* current input */
DECL|member|cur_freq
r_int
id|cur_freq
suffix:semicolon
multiline_comment|/* current frequency the tuner is tuned to */
DECL|member|cur_mute
r_int
id|cur_mute
suffix:semicolon
multiline_comment|/* current mute status */
)brace
suffix:semicolon
DECL|variable|extension
r_static
r_struct
id|saa7146_extension
id|extension
suffix:semicolon
DECL|function|mxb_probe
r_static
r_int
id|mxb_probe
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
)paren
(brace
r_struct
id|mxb
op_star
id|mxb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_struct
id|list_head
op_star
id|item
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
l_string|&quot;saa7111&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: saa7111 i2c module not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
l_string|&quot;tuner&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: tuner i2c module not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
l_string|&quot;tea6420&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: tea6420 i2c module not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
l_string|&quot;tea6415c&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: tea6415c i2c module not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|request_module
c_func
(paren
l_string|&quot;tda9840&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: tda9840 i2c module not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mxb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|mxb
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;not enough kernel memory.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|mxb
comma
l_int|0x0
comma
r_sizeof
(paren
r_struct
id|mxb
)paren
)paren
suffix:semicolon
id|mxb-&gt;i2c_adapter
op_assign
(paren
r_struct
id|i2c_adapter
)paren
(brace
dot
r_class
op_assign
id|I2C_CLASS_TV_ANALOG
comma
dot
id|name
op_assign
l_string|&quot;mxb&quot;
comma
)brace
suffix:semicolon
id|saa7146_i2c_adapter_prepare
c_func
(paren
id|dev
comma
op_amp
id|mxb-&gt;i2c_adapter
comma
id|SAA7146_I2C_BUS_BIT_RATE_480
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_add_adapter
c_func
(paren
op_amp
id|mxb-&gt;i2c_adapter
)paren
OL
l_int|0
)paren
(brace
id|DEB_S
c_func
(paren
(paren
l_string|&quot;cannot register i2c-device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mxb
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* loop through all i2c-devices on the bus and look who is there */
id|list_for_each
c_func
(paren
id|item
comma
op_amp
id|mxb-&gt;i2c_adapter.clients
)paren
(brace
id|client
op_assign
id|list_entry
c_func
(paren
id|item
comma
r_struct
id|i2c_client
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|I2C_TEA6420_1
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;tea6420_1
op_assign
id|client
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I2C_TEA6420_2
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;tea6420_2
op_assign
id|client
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I2C_TEA6415C_2
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;tea6415c
op_assign
id|client
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I2C_TDA9840
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;tda9840
op_assign
id|client
suffix:semicolon
)brace
r_if
c_cond
(paren
id|I2C_SAA7111
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;saa7111a
op_assign
id|client
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0x60
op_eq
id|client-&gt;addr
)paren
(brace
id|mxb-&gt;tuner
op_assign
id|client
suffix:semicolon
)brace
)brace
multiline_comment|/* check if all devices are present */
r_if
c_cond
(paren
l_int|0
op_eq
id|mxb-&gt;tea6420_1
op_logical_or
l_int|0
op_eq
id|mxb-&gt;tea6420_2
op_logical_or
l_int|0
op_eq
id|mxb-&gt;tea6415c
op_logical_or
l_int|0
op_eq
id|mxb-&gt;tda9840
op_logical_or
l_int|0
op_eq
id|mxb-&gt;saa7111a
op_logical_or
l_int|0
op_eq
id|mxb-&gt;tuner
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;mxb: did not find all i2c devices. aborting&bslash;n&quot;
)paren
suffix:semicolon
id|i2c_del_adapter
c_func
(paren
op_amp
id|mxb-&gt;i2c_adapter
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mxb
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* all devices are present, probe was successful */
multiline_comment|/* we store the pointer in our private data field */
id|dev-&gt;ext_priv
op_assign
id|mxb
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* some init data for the saa7740, the so-called &squot;sound arena module&squot;. &n;   there are no specs available, so we simply use some init values */
r_static
r_struct
(brace
DECL|member|length
r_int
id|length
suffix:semicolon
DECL|member|data
r_char
id|data
(braket
l_int|9
)braket
suffix:semicolon
DECL|variable|mxb_saa7740_init
)brace
id|mxb_saa7740_init
(braket
)braket
op_assign
(brace
(brace
l_int|3
comma
(brace
l_int|0x80
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x80
comma
l_int|0x89
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x80
comma
l_int|0xb0
comma
l_int|0x0a
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x49
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4a
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4b
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4c
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4d
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4e
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x4f
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x50
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x51
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x52
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x53
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x54
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x55
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x56
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x57
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x58
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x59
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5a
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5b
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5c
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5d
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5e
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x5f
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x60
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x61
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x62
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x63
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x64
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x65
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x66
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x67
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x68
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x69
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6a
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6b
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6c
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6d
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6e
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x6f
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x70
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x71
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x72
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x73
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x74
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x75
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x76
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x77
comma
l_int|0x00
comma
l_int|0x00
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x41
comma
l_int|0x00
comma
l_int|0x42
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x42
comma
l_int|0x10
comma
l_int|0x42
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x43
comma
l_int|0x20
comma
l_int|0x42
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x44
comma
l_int|0x30
comma
l_int|0x42
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x45
comma
l_int|0x00
comma
l_int|0x01
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x46
comma
l_int|0x00
comma
l_int|0x01
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x47
comma
l_int|0x00
comma
l_int|0x01
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x48
comma
l_int|0x00
comma
l_int|0x01
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x01
comma
l_int|0x03
comma
l_int|0xc5
comma
l_int|0x5c
comma
l_int|0x7a
comma
l_int|0x85
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x54
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x21
comma
l_int|0x03
comma
l_int|0xc5
comma
l_int|0x5c
comma
l_int|0x7a
comma
l_int|0x85
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x54
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x09
comma
l_int|0x0b
comma
l_int|0xb4
comma
l_int|0x6b
comma
l_int|0x74
comma
l_int|0x85
comma
l_int|0x95
comma
l_int|0x00
comma
l_int|0x34
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x29
comma
l_int|0x0b
comma
l_int|0xb4
comma
l_int|0x6b
comma
l_int|0x74
comma
l_int|0x85
comma
l_int|0x95
comma
l_int|0x00
comma
l_int|0x34
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x11
comma
l_int|0x17
comma
l_int|0x43
comma
l_int|0x62
comma
l_int|0x68
comma
l_int|0x89
comma
l_int|0xd1
comma
l_int|0xff
comma
l_int|0xb0
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x31
comma
l_int|0x17
comma
l_int|0x43
comma
l_int|0x62
comma
l_int|0x68
comma
l_int|0x89
comma
l_int|0xd1
comma
l_int|0xff
comma
l_int|0xb0
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x19
comma
l_int|0x20
comma
l_int|0x62
comma
l_int|0x51
comma
l_int|0x5a
comma
l_int|0x95
comma
l_int|0x19
comma
l_int|0x01
comma
l_int|0x50
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x39
comma
l_int|0x20
comma
l_int|0x62
comma
l_int|0x51
comma
l_int|0x5a
comma
l_int|0x95
comma
l_int|0x19
comma
l_int|0x01
comma
l_int|0x50
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x05
comma
l_int|0x3e
comma
l_int|0xd2
comma
l_int|0x69
comma
l_int|0x4e
comma
l_int|0x9a
comma
l_int|0x51
comma
l_int|0x00
comma
l_int|0xf0
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x25
comma
l_int|0x3e
comma
l_int|0xd2
comma
l_int|0x69
comma
l_int|0x4e
comma
l_int|0x9a
comma
l_int|0x51
comma
l_int|0x00
comma
l_int|0xf0
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x0d
comma
l_int|0x3d
comma
l_int|0xa1
comma
l_int|0x40
comma
l_int|0x7d
comma
l_int|0x9f
comma
l_int|0x29
comma
l_int|0xfe
comma
l_int|0x14
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x2d
comma
l_int|0x3d
comma
l_int|0xa1
comma
l_int|0x40
comma
l_int|0x7d
comma
l_int|0x9f
comma
l_int|0x29
comma
l_int|0xfe
comma
l_int|0x14
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x15
comma
l_int|0x73
comma
l_int|0xa1
comma
l_int|0x50
comma
l_int|0x5d
comma
l_int|0xa6
comma
l_int|0xf5
comma
l_int|0xfe
comma
l_int|0x38
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x35
comma
l_int|0x73
comma
l_int|0xa1
comma
l_int|0x50
comma
l_int|0x5d
comma
l_int|0xa6
comma
l_int|0xf5
comma
l_int|0xfe
comma
l_int|0x38
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x1d
comma
l_int|0xed
comma
l_int|0xd0
comma
l_int|0x68
comma
l_int|0x29
comma
l_int|0xb4
comma
l_int|0xe1
comma
l_int|0x00
comma
l_int|0xb8
)brace
)brace
comma
(brace
l_int|9
comma
(brace
l_int|0x3d
comma
l_int|0xed
comma
l_int|0xd0
comma
l_int|0x68
comma
l_int|0x29
comma
l_int|0xb4
comma
l_int|0xe1
comma
l_int|0x00
comma
l_int|0xb8
)brace
)brace
comma
(brace
l_int|3
comma
(brace
l_int|0x80
comma
l_int|0xb3
comma
l_int|0x0a
)brace
)brace
comma
(brace
op_minus
l_int|1
comma
(brace
l_int|0
)brace
)brace
)brace
suffix:semicolon
DECL|variable|mxb_saa7111_init
r_static
r_const
r_int
r_char
id|mxb_saa7111_init
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/* 00 - ID byte */
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* 01 - reserved */
multiline_comment|/*front end */
l_int|0x02
comma
l_int|0xd8
comma
multiline_comment|/* 02 - FUSE=x, GUDL=x, MODE=x */
l_int|0x03
comma
l_int|0x23
comma
multiline_comment|/* 03 - HLNRS=0, VBSL=1, WPOFF=0, HOLDG=0, GAFIX=0, GAI1=256, GAI2=256 */
l_int|0x04
comma
l_int|0x00
comma
multiline_comment|/* 04 - GAI1=256 */
l_int|0x05
comma
l_int|0x00
comma
multiline_comment|/* 05 - GAI2=256 */
multiline_comment|/* decoder */
l_int|0x06
comma
l_int|0xf0
comma
multiline_comment|/* 06 - HSB at  xx(50Hz) /  xx(60Hz) pixels after end of last line */
l_int|0x07
comma
l_int|0x30
comma
multiline_comment|/* 07 - HSS at  xx(50Hz) /  xx(60Hz) pixels after end of last line */
l_int|0x08
comma
l_int|0xa8
comma
multiline_comment|/* 08 - AUFD=x, FSEL=x, EXFIL=x, VTRC=x, HPLL=x, VNOI=x */
l_int|0x09
comma
l_int|0x02
comma
multiline_comment|/* 09 - BYPS=x, PREF=x, BPSS=x, VBLB=x, UPTCV=x, APER=x */
l_int|0x0a
comma
l_int|0x80
comma
multiline_comment|/* 0a - BRIG=128 */
l_int|0x0b
comma
l_int|0x47
comma
multiline_comment|/* 0b - CONT=1.109 */
l_int|0x0c
comma
l_int|0x40
comma
multiline_comment|/* 0c - SATN=1.0 */
l_int|0x0d
comma
l_int|0x00
comma
multiline_comment|/* 0d - HUE=0 */
l_int|0x0e
comma
l_int|0x01
comma
multiline_comment|/* 0e - CDTO=0, CSTD=0, DCCF=0, FCTC=0, CHBW=1 */
l_int|0x0f
comma
l_int|0x00
comma
multiline_comment|/* 0f - reserved */
l_int|0x10
comma
l_int|0xd0
comma
multiline_comment|/* 10 - OFTS=x, HDEL=x, VRLN=x, YDEL=x */
l_int|0x11
comma
l_int|0x8c
comma
multiline_comment|/* 11 - GPSW=x, CM99=x, FECO=x, COMPO=x, OEYC=1, OEHV=1, VIPB=0, COLO=0 */
l_int|0x12
comma
l_int|0x80
comma
multiline_comment|/* 12 - xx output control 2 */
l_int|0x13
comma
l_int|0x30
comma
multiline_comment|/* 13 - xx output control 3 */
l_int|0x14
comma
l_int|0x00
comma
multiline_comment|/* 14 - reserved */
l_int|0x15
comma
l_int|0x15
comma
multiline_comment|/* 15 - VBI */
l_int|0x16
comma
l_int|0x04
comma
multiline_comment|/* 16 - VBI */
l_int|0x17
comma
l_int|0x00
comma
multiline_comment|/* 17 - VBI */
)brace
suffix:semicolon
multiline_comment|/* bring hardware to a sane state. this has to be done, just in case someone&n;   wants to capture from this device before it has been properly initialized.&n;   the capture engine would badly fail, because no valid signal arrives on the&n;   saa7146, thus leading to timeouts and stuff. */
DECL|function|mxb_init_done
r_static
r_int
id|mxb_init_done
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
)paren
(brace
r_struct
id|mxb
op_star
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_struct
id|video_decoder_init
id|init
suffix:semicolon
r_struct
id|i2c_msg
id|msg
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|err
op_assign
l_int|0
suffix:semicolon
r_struct
id|tea6415c_multiplex
id|vm
suffix:semicolon
multiline_comment|/* select video mode in saa7111a */
id|i
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
multiline_comment|/* fixme: currently pointless: gets overwritten by configuration below */
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_NORM
comma
op_amp
id|i
)paren
suffix:semicolon
multiline_comment|/* write configuration to saa7111a */
id|init.data
op_assign
id|mxb_saa7111_init
suffix:semicolon
id|init.len
op_assign
r_sizeof
(paren
id|mxb_saa7111_init
)paren
suffix:semicolon
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_INIT
comma
op_amp
id|init
)paren
suffix:semicolon
multiline_comment|/* select tuner-output on saa7111a */
id|i
op_assign
l_int|0
suffix:semicolon
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_INPUT
comma
op_amp
id|i
)paren
suffix:semicolon
multiline_comment|/* enable vbi bypass */
id|i
op_assign
l_int|1
suffix:semicolon
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_VBI_BYPASS
comma
op_amp
id|i
)paren
suffix:semicolon
multiline_comment|/* select a tuner type */
id|i
op_assign
l_int|5
suffix:semicolon
id|mxb-&gt;tuner-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tuner
comma
id|TUNER_SET_TYPE
comma
op_amp
id|i
)paren
suffix:semicolon
multiline_comment|/* mute audio on tea6420s */
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
l_int|6
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
l_int|6
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_cd
(braket
l_int|6
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_cd
(braket
l_int|6
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* switch to tuner-channel on tea6415c*/
id|vm.out
op_assign
l_int|17
suffix:semicolon
id|vm.in
op_assign
l_int|3
suffix:semicolon
id|mxb-&gt;tea6415c-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6415c
comma
id|TEA6415C_SWITCH
comma
op_amp
id|vm
)paren
suffix:semicolon
multiline_comment|/* select tuner-output on multicable on tea6415c*/
id|vm.in
op_assign
l_int|3
suffix:semicolon
id|vm.out
op_assign
l_int|13
suffix:semicolon
id|mxb-&gt;tea6415c-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6415c
comma
id|TEA6415C_SWITCH
comma
op_amp
id|vm
)paren
suffix:semicolon
multiline_comment|/* tune in some frequency on tuner */
id|mxb-&gt;tuner-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tuner
comma
id|VIDIOCSFREQ
comma
op_amp
id|freq
)paren
suffix:semicolon
multiline_comment|/* the rest for mxb */
id|mxb-&gt;cur_input
op_assign
l_int|0
suffix:semicolon
id|mxb-&gt;cur_freq
op_assign
id|freq
suffix:semicolon
id|mxb-&gt;cur_mute
op_assign
l_int|1
suffix:semicolon
id|mxb-&gt;cur_mode
op_assign
id|V4L2_TUNER_MODE_STEREO
suffix:semicolon
id|mxb-&gt;tda9840-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tda9840
comma
id|TDA9840_SWITCH
comma
op_amp
id|mxb-&gt;cur_mode
)paren
suffix:semicolon
multiline_comment|/* check if the saa7740 (aka &squot;sound arena module&squot;) is present&n;&t;   on the mxb. if so, we must initialize it. due to lack of &n;&t;   informations about the saa7740, the values were reverse&n;&t;   engineered. */
id|msg.addr
op_assign
l_int|0x1b
suffix:semicolon
id|msg.flags
op_assign
l_int|0
suffix:semicolon
id|msg.len
op_assign
id|mxb_saa7740_init
(braket
l_int|0
)braket
dot
id|length
suffix:semicolon
id|msg.buf
op_assign
op_amp
id|mxb_saa7740_init
(braket
l_int|0
)braket
dot
id|data
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
(paren
id|err
op_assign
id|i2c_transfer
c_func
(paren
op_amp
id|mxb-&gt;i2c_adapter
comma
op_amp
id|msg
comma
l_int|1
)paren
)paren
)paren
(brace
multiline_comment|/* the sound arena module is a pos, that&squot;s probably the reason&n;&t;&t;   philips refuses to hand out a datasheet for the saa7740...&n;&t;&t;   it seems to screw up the i2c bus, so we disable fast irq&n;&t;&t;   based i2c transactions here and rely on the slow and safe&n;&t;&t;   polling method ... */
id|extension.flags
op_and_assign
op_complement
id|SAA7146_USE_I2C_IRQ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_minus
l_int|1
op_eq
id|mxb_saa7740_init
(braket
id|i
)braket
dot
id|length
)paren
(brace
r_break
suffix:semicolon
)brace
id|msg.len
op_assign
id|mxb_saa7740_init
(braket
id|i
)braket
dot
id|length
suffix:semicolon
id|msg.buf
op_assign
op_amp
id|mxb_saa7740_init
(braket
id|i
)braket
dot
id|data
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
(paren
id|err
op_assign
id|i2c_transfer
c_func
(paren
op_amp
id|mxb-&gt;i2c_adapter
comma
op_amp
id|msg
comma
l_int|1
)paren
)paren
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;failed to initialize &squot;sound arena module&squot;.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
)brace
id|INFO
c_func
(paren
(paren
l_string|&quot;&squot;sound arena module&squot; detected.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|err
suffix:colon
multiline_comment|/* the rest for saa7146: you should definitely set some basic values&n;&t;   for the input-port handling of the saa7146. */
multiline_comment|/* ext-&gt;saa has been filled by the core driver */
multiline_comment|/* some stuff is done via variables */
id|saa7146_set_hps_source_and_sync
c_func
(paren
id|dev
comma
id|input_port_selection
(braket
id|mxb-&gt;cur_input
)braket
dot
id|hps_source
comma
id|input_port_selection
(braket
id|mxb-&gt;cur_input
)braket
dot
id|hps_sync
)paren
suffix:semicolon
multiline_comment|/* some stuff is done via direct write to the registers */
multiline_comment|/* this is ugly, but because of the fact that this is completely&n;&t;   hardware dependend, it should be done directly... */
id|saa7146_write
c_func
(paren
id|dev
comma
id|DD1_STREAM_B
comma
l_int|0x00000000
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|DD1_INIT
comma
l_int|0x02000200
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_09
op_or
id|MASK_25
op_or
id|MASK_10
op_or
id|MASK_26
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* interrupt-handler. this gets called when irq_mask is != 0.&n;   it must clear the interrupt-bits in irq_mask it has handled */
multiline_comment|/*&n;void mxb_irq_bh(struct saa7146_dev* dev, u32* irq_mask)&n;{&n;&t;struct mxb* mxb = (struct mxb*)dev-&gt;ext_priv;&n;}&n;*/
DECL|variable|vv_data
r_static
r_struct
id|saa7146_ext_vv
id|vv_data
suffix:semicolon
multiline_comment|/* this function only gets called when the probing was successful */
DECL|function|mxb_attach
r_static
r_int
id|mxb_attach
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_pci_extension_data
op_star
id|info
)paren
(brace
r_struct
id|mxb
op_star
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;dev:%p&bslash;n&quot;
comma
id|dev
)paren
)paren
suffix:semicolon
multiline_comment|/* checking for i2c-devices can be omitted here, because we&n;&t;   already did this in &quot;mxb_vl42_probe&quot; */
id|saa7146_vv_init
c_func
(paren
id|dev
comma
op_amp
id|vv_data
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|saa7146_register_device
c_func
(paren
op_amp
id|mxb-&gt;video_dev
comma
id|dev
comma
l_string|&quot;mxb&quot;
comma
id|VFL_TYPE_GRABBER
)paren
)paren
(brace
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot register capture v4l2 device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* initialization stuff (vbi) (only for revision &gt; 0 and for extensions which want it)*/
r_if
c_cond
(paren
l_int|0
op_ne
id|MXB_BOARD_CAN_DO_VBI
c_func
(paren
id|dev
)paren
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|saa7146_register_device
c_func
(paren
op_amp
id|mxb-&gt;vbi_dev
comma
id|dev
comma
l_string|&quot;mxb&quot;
comma
id|VFL_TYPE_VBI
)paren
)paren
(brace
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot register vbi v4l2 device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
)brace
id|i2c_use_client
c_func
(paren
id|mxb-&gt;tea6420_1
)paren
suffix:semicolon
id|i2c_use_client
c_func
(paren
id|mxb-&gt;tea6420_2
)paren
suffix:semicolon
id|i2c_use_client
c_func
(paren
id|mxb-&gt;tea6415c
)paren
suffix:semicolon
id|i2c_use_client
c_func
(paren
id|mxb-&gt;tda9840
)paren
suffix:semicolon
id|i2c_use_client
c_func
(paren
id|mxb-&gt;saa7111a
)paren
suffix:semicolon
id|i2c_use_client
c_func
(paren
id|mxb-&gt;tuner
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mxb: found &squot;Multimedia eXtension Board&squot;-%d.&bslash;n&quot;
comma
id|mxb_num
)paren
suffix:semicolon
id|mxb_num
op_increment
suffix:semicolon
id|mxb_init_done
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mxb_detach
r_static
r_int
id|mxb_detach
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
)paren
(brace
r_struct
id|mxb
op_star
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;dev:%p&bslash;n&quot;
comma
id|dev
)paren
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;tea6420_1
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;tea6420_2
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;tea6415c
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;tda9840
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;saa7111a
)paren
suffix:semicolon
id|i2c_release_client
c_func
(paren
id|mxb-&gt;tuner
)paren
suffix:semicolon
id|saa7146_unregister_device
c_func
(paren
op_amp
id|mxb-&gt;video_dev
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|MXB_BOARD_CAN_DO_VBI
c_func
(paren
id|dev
)paren
)paren
(brace
id|saa7146_unregister_device
c_func
(paren
op_amp
id|mxb-&gt;vbi_dev
comma
id|dev
)paren
suffix:semicolon
)brace
id|saa7146_vv_release
c_func
(paren
id|dev
)paren
suffix:semicolon
id|mxb_num
op_decrement
suffix:semicolon
id|i2c_del_adapter
c_func
(paren
op_amp
id|mxb-&gt;i2c_adapter
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|mxb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mxb_ioctl
r_static
r_int
id|mxb_ioctl
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_struct
id|mxb
op_star
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOC_ENUMINPUT
suffix:colon
(brace
r_struct
id|v4l2_input
op_star
id|i
op_assign
id|arg
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_ENUMINPUT %d.&bslash;n&quot;
comma
id|i-&gt;index
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;index
OL
l_int|0
op_logical_or
id|i-&gt;index
op_ge
id|MXB_INPUTS
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|i
comma
op_amp
id|mxb_inputs
(braket
id|i-&gt;index
)braket
comma
r_sizeof
(paren
r_struct
id|v4l2_input
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* the saa7146 provides some controls (brightness, contrast, saturation)&n;&t;   which gets registered *after* this function. because of this we have&n;&t;   to return with a value != 0 even if the function succeded.. */
r_case
id|VIDIOC_QUERYCTRL
suffix:colon
(brace
r_struct
id|v4l2_queryctrl
op_star
id|qc
op_assign
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|MAXCONTROLS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|mxb_controls
(braket
id|i
)braket
dot
id|id
op_eq
id|qc-&gt;id
)paren
(brace
op_star
id|qc
op_assign
id|mxb_controls
(braket
id|i
)braket
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_QUERYCTRL %d.&bslash;n&quot;
comma
id|qc-&gt;id
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_case
id|VIDIOC_G_CTRL
suffix:colon
(brace
r_struct
id|v4l2_control
op_star
id|vc
op_assign
id|arg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|MAXCONTROLS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|mxb_controls
(braket
id|i
)braket
dot
id|id
op_eq
id|vc-&gt;id
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vc-&gt;id
)paren
(brace
r_case
id|V4L2_CID_AUDIO_MUTE
suffix:colon
(brace
id|vc-&gt;value
op_assign
id|mxb-&gt;cur_mute
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_CTRL V4L2_CID_AUDIO_MUTE:%d.&bslash;n&quot;
comma
id|vc-&gt;value
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_CTRL V4L2_CID_AUDIO_MUTE:%d.&bslash;n&quot;
comma
id|vc-&gt;value
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_CTRL
suffix:colon
(brace
r_struct
id|v4l2_control
op_star
id|vc
op_assign
id|arg
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|MAXCONTROLS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|mxb_controls
(braket
id|i
)braket
dot
id|id
op_eq
id|vc-&gt;id
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vc-&gt;id
)paren
(brace
r_case
id|V4L2_CID_AUDIO_MUTE
suffix:colon
(brace
id|mxb-&gt;cur_mute
op_assign
id|vc-&gt;value
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|vc-&gt;value
)paren
(brace
multiline_comment|/* switch the audio-source */
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|video_audio_connect
(braket
id|mxb-&gt;cur_input
)braket
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|video_audio_connect
(braket
id|mxb-&gt;cur_input
)braket
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
l_int|6
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
l_int|6
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_CTRL, V4L2_CID_AUDIO_MUTE: %d.&bslash;n&quot;
comma
id|vc-&gt;value
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_INPUT
suffix:colon
(brace
r_int
op_star
id|input
op_assign
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
op_star
id|input
op_assign
id|mxb-&gt;cur_input
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_INPUT %d.&bslash;n&quot;
comma
op_star
id|input
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_INPUT
suffix:colon
(brace
r_int
id|input
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|tea6415c_multiplex
id|vm
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_INPUT %d.&bslash;n&quot;
comma
id|input
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input
OL
l_int|0
op_logical_or
id|input
op_ge
id|MXB_INPUTS
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* fixme: locke das setzen des inputs mit hilfe des mutexes&n;&t;&t;down(&amp;dev-&gt;lock);&n;&t;&t;video_mux(dev,*i);&n;&t;&t;up(&amp;dev-&gt;lock);&n;&t;&t;*/
multiline_comment|/* fixme: check if streaming capture&n;&t;&t;if ( 0 != dev-&gt;streaming ) {&n;&t;&t;&t;DEB_D((&quot;VIDIOC_S_INPUT illegal while streaming.&bslash;n&quot;));&n;&t;&t;&t;return -EPERM;&n;&t;&t;}&n;&t;&t;*/
id|mxb-&gt;cur_input
op_assign
id|input
suffix:semicolon
id|saa7146_set_hps_source_and_sync
c_func
(paren
id|dev
comma
id|input_port_selection
(braket
id|input
)braket
dot
id|hps_source
comma
id|input_port_selection
(braket
id|input
)braket
dot
id|hps_sync
)paren
suffix:semicolon
multiline_comment|/* prepare switching of tea6415c and saa7111a;&n;&t;&t;   have a look at the &squot;background&squot;-file for further informations  */
r_switch
c_cond
(paren
id|input
)paren
(brace
r_case
id|TUNER
suffix:colon
(brace
id|i
op_assign
l_int|0
suffix:semicolon
id|vm.in
op_assign
l_int|3
suffix:semicolon
id|vm.out
op_assign
l_int|17
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|mxb-&gt;tea6415c-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6415c
comma
id|TEA6415C_SWITCH
comma
op_amp
id|vm
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;VIDIOC_S_INPUT: could not address tea6415c #1&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* connect tuner-output always to multicable */
id|vm.in
op_assign
l_int|3
suffix:semicolon
id|vm.out
op_assign
l_int|13
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|AUX3_YC
suffix:colon
(brace
multiline_comment|/* nothing to be done here. aux3_yc is&n;&t;&t;&t;&t;   directly connected to the saa711a */
id|i
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|AUX3
suffix:colon
(brace
multiline_comment|/* nothing to be done here. aux3 is&n;&t;&t;&t;&t;   directly connected to the saa711a */
id|i
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|AUX1
suffix:colon
(brace
id|i
op_assign
l_int|0
suffix:semicolon
id|vm.in
op_assign
l_int|1
suffix:semicolon
id|vm.out
op_assign
l_int|17
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* switch video in tea6415c only if necessary */
r_switch
c_cond
(paren
id|input
)paren
(brace
r_case
id|TUNER
suffix:colon
r_case
id|AUX1
suffix:colon
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|mxb-&gt;tea6415c-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6415c
comma
id|TEA6415C_SWITCH
comma
op_amp
id|vm
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;VIDIOC_S_INPUT: could not address tea6415c #3&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* switch video in saa7111a */
r_if
c_cond
(paren
l_int|0
op_ne
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_INPUT
comma
op_amp
id|i
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;VIDIOC_S_INPUT: could not address saa7111a #1.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* switch the audio-source only if necessary */
r_if
c_cond
(paren
l_int|0
op_eq
id|mxb-&gt;cur_mute
)paren
(brace
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|video_audio_connect
(braket
id|input
)braket
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|video_audio_connect
(braket
id|input
)braket
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|t
op_assign
id|arg
suffix:semicolon
r_int
id|byte
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|t-&gt;index
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: channel %d does not have a tuner attached.&bslash;n&quot;
comma
id|t-&gt;index
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: %d&bslash;n&quot;
comma
id|t-&gt;index
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|t
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|t-&gt;name
comma
l_string|&quot;Television&quot;
)paren
suffix:semicolon
id|t-&gt;type
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
id|t-&gt;capability
op_assign
id|V4L2_TUNER_CAP_NORM
op_or
id|V4L2_TUNER_CAP_STEREO
op_or
id|V4L2_TUNER_CAP_LANG1
op_or
id|V4L2_TUNER_CAP_LANG2
op_or
id|V4L2_TUNER_CAP_SAP
suffix:semicolon
id|t-&gt;rangelow
op_assign
l_int|772
suffix:semicolon
multiline_comment|/* 48.25 MHZ / 62.5 kHz = 772, see fi1216mk2-specs, page 2 */
id|t-&gt;rangehigh
op_assign
l_int|13684
suffix:semicolon
multiline_comment|/* 855.25 MHz / 62.5 kHz = 13684 */
multiline_comment|/* FIXME: add the real signal strength here */
id|t-&gt;signal
op_assign
l_int|0xffff
suffix:semicolon
id|t-&gt;afc
op_assign
l_int|0
suffix:semicolon
id|byte
op_assign
id|mxb-&gt;tda9840-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tda9840
comma
id|TDA9840_DETECT
comma
l_int|NULL
)paren
suffix:semicolon
id|t-&gt;audmode
op_assign
id|mxb-&gt;cur_mode
suffix:semicolon
r_if
c_cond
(paren
id|byte
OL
l_int|0
)paren
(brace
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|byte
)paren
(brace
r_case
id|TDA9840_MONO_DETECT
suffix:colon
(brace
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: V4L2_TUNER_MODE_MONO.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|TDA9840_DUAL_DETECT
suffix:colon
(brace
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_LANG1
op_or
id|V4L2_TUNER_SUB_LANG2
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: V4L2_TUNER_MODE_LANG1.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|TDA9840_STEREO_DETECT
suffix:colon
(brace
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_STEREO
op_or
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: V4L2_TUNER_MODE_STEREO.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
multiline_comment|/* TDA9840_INCORRECT_DETECT */
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_MODE_MONO
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_TUNER: TDA9840_INCORRECT_DETECT =&gt; V4L2_TUNER_MODE_MONO&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|t
op_assign
id|arg
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|byte
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|t-&gt;index
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_TUNER: channel %d does not have a tuner attached.&bslash;n&quot;
comma
id|t-&gt;index
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|t-&gt;audmode
)paren
(brace
r_case
id|V4L2_TUNER_MODE_STEREO
suffix:colon
(brace
id|mxb-&gt;cur_mode
op_assign
id|V4L2_TUNER_MODE_STEREO
suffix:semicolon
id|byte
op_assign
id|TDA9840_SET_STEREO
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_STEREO&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|V4L2_TUNER_MODE_LANG1
suffix:colon
(brace
id|mxb-&gt;cur_mode
op_assign
id|V4L2_TUNER_MODE_LANG1
suffix:semicolon
id|byte
op_assign
id|TDA9840_SET_LANG1
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_LANG1&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|V4L2_TUNER_MODE_LANG2
suffix:colon
(brace
id|mxb-&gt;cur_mode
op_assign
id|V4L2_TUNER_MODE_LANG2
suffix:semicolon
id|byte
op_assign
id|TDA9840_SET_LANG2
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_LANG2&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
multiline_comment|/* case V4L2_TUNER_MODE_MONO: {*/
id|mxb-&gt;cur_mode
op_assign
id|V4L2_TUNER_MODE_MONO
suffix:semicolon
id|byte
op_assign
id|TDA9840_SET_MONO
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_TUNER: TDA9840_SET_MONO&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_ne
(paren
id|result
op_assign
id|mxb-&gt;tda9840-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tda9840
comma
id|TDA9840_SWITCH
comma
op_amp
id|byte
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;VIDIOC_S_TUNER error. result:%d, byte:%d&bslash;n&quot;
comma
id|result
comma
id|byte
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|mxb-&gt;cur_input
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_FREQ: channel %d does not have a tuner!&bslash;n&quot;
comma
id|mxb-&gt;cur_input
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|f-&gt;type
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
id|f-&gt;frequency
op_assign
id|mxb-&gt;cur_freq
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_FREQ: freq:0x%08x.&bslash;n&quot;
comma
id|mxb-&gt;cur_freq
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
r_int
id|t_locked
op_assign
l_int|0
suffix:semicolon
r_int
id|v_byte
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|f-&gt;tuner
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_ANALOG_TV
op_ne
id|f-&gt;type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|mxb-&gt;cur_input
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_FREQ: channel %d does not have a tuner!&bslash;n&quot;
comma
id|mxb-&gt;cur_input
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_FREQUENCY: freq:0x%08x.&bslash;n&quot;
comma
id|f-&gt;frequency
)paren
)paren
suffix:semicolon
id|mxb-&gt;cur_freq
op_assign
id|f-&gt;frequency
suffix:semicolon
multiline_comment|/* tune in desired frequency */
id|mxb-&gt;tuner-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tuner
comma
id|VIDIOCSFREQ
comma
op_amp
id|mxb-&gt;cur_freq
)paren
suffix:semicolon
multiline_comment|/* check if pll of tuner &amp; saa7111a is locked */
singleline_comment|//&t;&t;mxb-&gt;tuner-&gt;driver-&gt;command(mxb-&gt;tuner,TUNER_IS_LOCKED, &amp;t_locked);
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_GET_STATUS
comma
op_amp
id|v_byte
)paren
suffix:semicolon
multiline_comment|/* not locked -- anything to do here ? */
r_if
c_cond
(paren
l_int|0
op_eq
id|t_locked
op_logical_or
l_int|0
op_eq
(paren
id|v_byte
op_amp
id|DECODER_STATUS_GOOD
)paren
)paren
(brace
)brace
multiline_comment|/* hack: changing the frequency should invalidate the vbi-counter (=&gt; alevt) */
id|spin_lock
c_func
(paren
op_amp
id|dev-&gt;slock
)paren
suffix:semicolon
id|vv-&gt;vbi_fieldcount
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dev-&gt;slock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|MXB_S_AUDIO_CD
suffix:colon
(brace
r_int
id|i
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|MXB_AUDIOS
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;illegal argument to MXB_S_AUDIO_CD: i:%d.&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;MXB_S_AUDIO_CD: i:%d.&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_cd
(braket
id|i
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_cd
(braket
id|i
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|MXB_S_AUDIO_LINE
suffix:colon
(brace
r_int
id|i
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0
op_logical_or
id|i
op_ge
id|MXB_AUDIOS
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;illegal argument to MXB_S_AUDIO_LINE: i:%d.&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;MXB_S_AUDIO_LINE: i:%d.&bslash;n&quot;
comma
id|i
)paren
)paren
suffix:semicolon
id|mxb-&gt;tea6420_1-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_1
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|i
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mxb-&gt;tea6420_2-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;tea6420_2
comma
id|TEA6420_SWITCH
comma
op_amp
id|TEA6420_line
(braket
id|i
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_AUDIO
suffix:colon
(brace
r_struct
id|v4l2_audio
op_star
id|a
op_assign
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;index
template_param
id|MXB_INPUTS
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_AUDIO %d out of range.&bslash;n&quot;
comma
id|a-&gt;index
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;VIDIOC_G_AUDIO %d.&bslash;n&quot;
comma
id|a-&gt;index
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|a
comma
op_amp
id|mxb_audios
(braket
id|video_audio_connect
(braket
id|mxb-&gt;cur_input
)braket
)braket
comma
r_sizeof
(paren
r_struct
id|v4l2_audio
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_AUDIO
suffix:colon
(brace
r_struct
id|v4l2_audio
op_star
id|a
op_assign
id|arg
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_AUDIO %d.&bslash;n&quot;
comma
id|a-&gt;index
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;DEB2(printk(&quot;does not handle this ioctl.&bslash;n&quot;));&n;*/
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|std_callback
r_static
r_int
id|std_callback
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_standard
op_star
id|std
)paren
(brace
r_struct
id|mxb
op_star
id|mxb
op_assign
(paren
r_struct
id|mxb
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_int
id|zero
op_assign
l_int|0
suffix:semicolon
r_int
id|one
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_STD_PAL_I
op_eq
id|std-&gt;id
)paren
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_STD: setting mxb for PAL_I.&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* set the 7146 gpio register -- I don&squot;t know what this does exactly */
id|saa7146_write
c_func
(paren
id|dev
comma
id|GPIO_CTRL
comma
l_int|0x00404050
)paren
suffix:semicolon
multiline_comment|/* unset the 7111 gpio register -- I don&squot;t know what this does exactly */
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_GPIO
comma
op_amp
id|zero
)paren
suffix:semicolon
)brace
r_else
(brace
id|DEB_D
c_func
(paren
(paren
l_string|&quot;VIDIOC_S_STD: setting mxb for PAL/NTSC/SECAM.&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* set the 7146 gpio register -- I don&squot;t know what this does exactly */
id|saa7146_write
c_func
(paren
id|dev
comma
id|GPIO_CTRL
comma
l_int|0x00404050
)paren
suffix:semicolon
multiline_comment|/* set the 7111 gpio register -- I don&squot;t know what this does exactly */
id|mxb-&gt;saa7111a-&gt;driver
op_member_access_from_pointer
id|command
c_func
(paren
id|mxb-&gt;saa7111a
comma
id|DECODER_SET_GPIO
comma
op_amp
id|one
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|standard
r_static
r_struct
id|saa7146_standard
id|standard
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;PAL-BG&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL_BG
comma
dot
id|v_offset
op_assign
l_int|0x17
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x14
comma
dot
id|h_pixels
op_assign
l_int|680
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;PAL-I&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL_I
comma
dot
id|v_offset
op_assign
l_int|0x17
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x14
comma
dot
id|h_pixels
op_assign
l_int|680
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;NTSC&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_NTSC
comma
dot
id|v_offset
op_assign
l_int|0x16
comma
dot
id|v_field
op_assign
l_int|240
comma
dot
id|h_offset
op_assign
l_int|0x06
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|480
comma
dot
id|h_max_out
op_assign
l_int|640
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;SECAM&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_SECAM
comma
dot
id|v_offset
op_assign
l_int|0x14
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x14
comma
dot
id|h_pixels
op_assign
l_int|720
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
)brace
suffix:semicolon
DECL|variable|mxb
r_static
r_struct
id|saa7146_pci_extension_data
id|mxb
op_assign
(brace
dot
id|ext_priv
op_assign
l_string|&quot;Multimedia eXtension Board&quot;
comma
dot
id|ext
op_assign
op_amp
id|extension
comma
)brace
suffix:semicolon
DECL|variable|pci_tbl
r_static
r_struct
id|pci_device_id
id|pci_tbl
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_PHILIPS
comma
dot
id|device
op_assign
id|PCI_DEVICE_ID_PHILIPS_SAA7146
comma
dot
id|subvendor
op_assign
l_int|0x0000
comma
dot
id|subdevice
op_assign
l_int|0x0000
comma
dot
id|driver_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|mxb
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|pci_tbl
)paren
suffix:semicolon
DECL|variable|vv_data
r_static
r_struct
id|saa7146_ext_vv
id|vv_data
op_assign
(brace
dot
id|inputs
op_assign
id|MXB_INPUTS
comma
dot
id|capabilities
op_assign
id|V4L2_CAP_TUNER
op_or
id|V4L2_CAP_VBI_CAPTURE
comma
dot
id|stds
op_assign
op_amp
id|standard
(braket
l_int|0
)braket
comma
dot
id|num_stds
op_assign
r_sizeof
(paren
id|standard
)paren
op_div
r_sizeof
(paren
r_struct
id|saa7146_standard
)paren
comma
dot
id|std_callback
op_assign
op_amp
id|std_callback
comma
dot
id|ioctls
op_assign
op_amp
id|ioctls
(braket
l_int|0
)braket
comma
dot
id|ioctl
op_assign
id|mxb_ioctl
comma
)brace
suffix:semicolon
DECL|variable|extension
r_static
r_struct
id|saa7146_extension
id|extension
op_assign
(brace
dot
id|name
op_assign
id|MXB_IDENTIFIER
comma
dot
id|flags
op_assign
id|SAA7146_USE_I2C_IRQ
comma
dot
id|pci_tbl
op_assign
op_amp
id|pci_tbl
(braket
l_int|0
)braket
comma
dot
id|module
op_assign
id|THIS_MODULE
comma
dot
id|probe
op_assign
id|mxb_probe
comma
dot
id|attach
op_assign
id|mxb_attach
comma
dot
id|detach
op_assign
id|mxb_detach
comma
dot
id|irq_mask
op_assign
l_int|0
comma
dot
id|irq_func
op_assign
l_int|NULL
comma
)brace
suffix:semicolon
DECL|function|mxb_init_module
r_int
id|__init
id|mxb_init_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|saa7146_register_extension
c_func
(paren
op_amp
id|extension
)paren
)paren
(brace
id|DEB_S
c_func
(paren
(paren
l_string|&quot;failed to register extension.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mxb_cleanup_module
r_void
id|__exit
id|mxb_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|saa7146_unregister_extension
c_func
(paren
op_amp
id|extension
)paren
suffix:semicolon
)brace
DECL|variable|mxb_init_module
id|module_init
c_func
(paren
id|mxb_init_module
)paren
suffix:semicolon
DECL|variable|mxb_cleanup_module
id|module_exit
c_func
(paren
id|mxb_cleanup_module
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;video4linux-2 driver for the Siemens-Nixdorf &squot;Multimedia eXtension board&squot;&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Michael Hunold &lt;michael@mihu.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
