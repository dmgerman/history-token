multiline_comment|/*&n; * $Id: tuner-core.c,v 1.5 2005/02/15 15:59:35 kraxel Exp $&n; *&n; * i2c tv tuner chip device driver&n; * core core, i.e. kernel interfaces, registering and so on&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/videodev.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;media/tuner.h&gt;
macro_line|#include &lt;media/audiochip.h&gt;
DECL|macro|UNSET
mdefine_line|#define UNSET (-1U)
multiline_comment|/* standard i2c insmod options */
DECL|variable|normal_i2c
r_static
r_int
r_int
id|normal_i2c
(braket
)braket
op_assign
(brace
l_int|0x4b
comma
multiline_comment|/* tda8290 */
id|I2C_CLIENT_END
)brace
suffix:semicolon
DECL|variable|normal_i2c_range
r_static
r_int
r_int
id|normal_i2c_range
(braket
)braket
op_assign
(brace
l_int|0x60
comma
l_int|0x6f
comma
id|I2C_CLIENT_END
)brace
suffix:semicolon
id|I2C_CLIENT_INSMOD
suffix:semicolon
multiline_comment|/* insmod options used at init time =&gt; read/only */
DECL|variable|addr
r_static
r_int
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|addr
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
multiline_comment|/* insmod options used at runtime =&gt; read/write */
DECL|variable|tuner_debug
r_int
r_int
id|tuner_debug
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|tuner_debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
DECL|variable|tv_range
r_static
r_int
r_int
id|tv_range
(braket
l_int|2
)braket
op_assign
(brace
l_int|44
comma
l_int|958
)brace
suffix:semicolon
DECL|variable|radio_range
r_static
r_int
r_int
id|radio_range
(braket
l_int|2
)braket
op_assign
(brace
l_int|65
comma
l_int|108
)brace
suffix:semicolon
id|module_param_array
c_func
(paren
id|tv_range
comma
r_int
comma
l_int|NULL
comma
l_int|0644
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|radio_range
comma
r_int
comma
l_int|NULL
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;device driver for various TV and TV+FM radio tuners&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ralph Metzler, Gerd Knorr, Gunther Mayer&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|this_adap
r_static
r_int
id|this_adap
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|i2c_driver
id|driver
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
suffix:semicolon
multiline_comment|/* ---------------------------------------------------------------------- */
singleline_comment|// Set tuner frequency,  freq in Units of 62.5kHz = 1/16MHz
DECL|function|set_tv_freq
r_static
r_void
id|set_tv_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|UNSET
)paren
(brace
id|tuner_info
c_func
(paren
l_string|&quot;tuner type not set&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t-&gt;tv_freq
)paren
(brace
id|tuner_info
c_func
(paren
l_string|&quot;Huh? tv_set is NULL?&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freq
template_param
id|tv_range
(braket
l_int|1
)braket
op_star
l_int|16
)paren
(brace
multiline_comment|/* FIXME: better do that chip-specific, but&n;&t;&t;   right now we don&squot;t have that in the config&n;&t;&t;   struct and this way is still better than no&n;&t;&t;   check at all */
id|tuner_info
c_func
(paren
l_string|&quot;TV freq (%d.%02d) out of range (%d-%d)&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
comma
id|tv_range
(braket
l_int|0
)braket
comma
id|tv_range
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|t
op_member_access_from_pointer
id|tv_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
DECL|function|set_radio_freq
r_static
r_void
id|set_radio_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;type
op_eq
id|UNSET
)paren
(brace
id|tuner_info
c_func
(paren
l_string|&quot;tuner type not set&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t-&gt;radio_freq
)paren
(brace
id|tuner_info
c_func
(paren
l_string|&quot;no radio tuning for this one, sorry.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|freq
template_param
id|radio_range
(braket
l_int|1
)braket
op_star
l_int|16
)paren
(brace
id|tuner_info
c_func
(paren
l_string|&quot;radio freq (%d.%02d) out of range (%d-%d)&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
comma
id|radio_range
(braket
l_int|0
)braket
comma
id|radio_range
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|t
op_member_access_from_pointer
id|radio_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
)brace
DECL|function|set_freq
r_static
r_void
id|set_freq
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|freq
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|t-&gt;mode
)paren
(brace
r_case
id|V4L2_TUNER_RADIO
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;radio freq set to %lu.%02lu&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
)paren
suffix:semicolon
id|set_radio_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_ANALOG_TV
suffix:colon
r_case
id|V4L2_TUNER_DIGITAL_TV
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;tv freq set to %lu.%02lu&bslash;n&quot;
comma
id|freq
op_div
l_int|16
comma
id|freq
op_mod
l_int|16
op_star
l_int|100
op_div
l_int|16
)paren
suffix:semicolon
id|set_tv_freq
c_func
(paren
id|c
comma
id|freq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|t-&gt;freq
op_assign
id|freq
suffix:semicolon
)brace
DECL|function|set_type
r_static
r_void
id|set_type
c_func
(paren
r_struct
id|i2c_client
op_star
id|c
comma
r_int
r_int
id|type
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
multiline_comment|/* sanity check */
r_if
c_cond
(paren
id|type
op_eq
id|UNSET
op_logical_or
id|type
op_eq
id|TUNER_ABSENT
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ge
id|tuner_count
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t-&gt;i2c.dev.driver
)paren
(brace
multiline_comment|/* not registered yet */
id|t-&gt;type
op_assign
id|type
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|t-&gt;initialized
)paren
multiline_comment|/* run only once */
r_return
suffix:semicolon
id|t-&gt;initialized
op_assign
l_int|1
suffix:semicolon
id|t-&gt;type
op_assign
id|type
suffix:semicolon
r_switch
c_cond
(paren
id|t-&gt;type
)paren
(brace
r_case
id|TUNER_MT2032
suffix:colon
id|microtune_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TUNER_PHILIPS_TDA8290
suffix:colon
id|tda8290_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|default_tuner_init
c_func
(paren
id|c
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|variable|pal
r_static
r_char
id|pal
(braket
)braket
op_assign
l_string|&quot;-&quot;
suffix:semicolon
id|module_param_string
c_func
(paren
id|pal
comma
id|pal
comma
l_int|0644
comma
r_sizeof
(paren
id|pal
)paren
)paren
suffix:semicolon
DECL|function|tuner_fixup_std
r_static
r_int
id|tuner_fixup_std
c_func
(paren
r_struct
id|tuner
op_star
id|t
)paren
(brace
r_if
c_cond
(paren
(paren
id|t-&gt;std
op_amp
id|V4L2_STD_PAL
)paren
op_eq
id|V4L2_STD_PAL
)paren
(brace
multiline_comment|/* get more precise norm info from insmod option */
r_switch
c_cond
(paren
id|pal
(braket
l_int|0
)braket
)paren
(brace
r_case
l_char|&squot;b&squot;
suffix:colon
r_case
l_char|&squot;B&squot;
suffix:colon
r_case
l_char|&squot;g&squot;
suffix:colon
r_case
l_char|&squot;G&squot;
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-BG&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_BG
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;i&squot;
suffix:colon
r_case
l_char|&squot;I&squot;
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-I&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_I
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_case
l_char|&squot;D&squot;
suffix:colon
r_case
l_char|&squot;k&squot;
suffix:colon
r_case
l_char|&squot;K&squot;
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;insmod fixup: PAL =&gt; PAL-DK&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;std
op_assign
id|V4L2_STD_PAL_DK
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ---------------------------------------------------------------------- */
DECL|function|tuner_attach
r_static
r_int
id|tuner_attach
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
comma
r_int
id|addr
comma
r_int
id|kind
)paren
(brace
r_struct
id|tuner
op_star
id|t
suffix:semicolon
r_if
c_cond
(paren
id|this_adap
OG
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|this_adap
op_increment
suffix:semicolon
id|client_template.adapter
op_assign
id|adap
suffix:semicolon
id|client_template.addr
op_assign
id|addr
suffix:semicolon
id|t
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|tuner
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|t
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|tuner
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|t-&gt;i2c
comma
op_amp
id|client_template
comma
r_sizeof
(paren
r_struct
id|i2c_client
)paren
)paren
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
op_amp
id|t-&gt;i2c
comma
id|t
)paren
suffix:semicolon
id|t-&gt;type
op_assign
id|UNSET
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|10700
op_star
l_int|1000
suffix:semicolon
singleline_comment|// 10.7MHz - FM radio
id|i2c_attach_client
c_func
(paren
op_amp
id|t-&gt;i2c
)paren
suffix:semicolon
id|tuner_info
c_func
(paren
l_string|&quot;chip found @ 0x%x (%s)&bslash;n&quot;
comma
id|addr
op_lshift
l_int|1
comma
id|adap-&gt;name
)paren
suffix:semicolon
id|set_type
c_func
(paren
op_amp
id|t-&gt;i2c
comma
id|t-&gt;type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_probe
r_static
r_int
id|tuner_probe
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adap
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_ne
id|addr
)paren
(brace
id|normal_i2c
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
id|normal_i2c_range
(braket
l_int|0
)braket
op_assign
id|addr
suffix:semicolon
id|normal_i2c_range
(braket
l_int|1
)braket
op_assign
id|addr
suffix:semicolon
)brace
id|this_adap
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|adap
op_member_access_from_pointer
r_class
op_amp
id|I2C_CLASS_TV_ANALOG
)paren
r_return
id|i2c_probe
c_func
(paren
id|adap
comma
op_amp
id|addr_data
comma
id|tuner_attach
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_detach
r_static
r_int
id|tuner_detach
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|i2c_detach_client
c_func
(paren
op_amp
id|t-&gt;i2c
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|SWITCH_V4L2
mdefine_line|#define SWITCH_V4L2&t;if (!t-&gt;using_v4l2 &amp;&amp; tuner_debug) &bslash;&n;&t;&t;          tuner_info(&quot;switching to v4l2&bslash;n&quot;); &bslash;&n;&t;                  t-&gt;using_v4l2 = 1;
DECL|macro|CHECK_V4L2
mdefine_line|#define CHECK_V4L2&t;if (t-&gt;using_v4l2) { if (tuner_debug) &bslash;&n;&t;&t;&t;  tuner_info(&quot;ignore v4l1 call&bslash;n&quot;); &bslash;&n;&t;&t;          return 0; }
r_static
r_int
DECL|function|tuner_command
id|tuner_command
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
r_int
r_int
op_star
id|iarg
op_assign
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/* --- configuration --- */
r_case
id|TUNER_SET_TYPE
suffix:colon
id|set_type
c_func
(paren
id|client
comma
op_star
id|iarg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDC_SET_RADIO
suffix:colon
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_ne
id|t-&gt;mode
)paren
(brace
id|set_tv_freq
c_func
(paren
id|client
comma
l_int|400
op_star
l_int|16
)paren
suffix:semicolon
id|t-&gt;mode
op_assign
id|V4L2_TUNER_RADIO
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AUDC_CONFIG_PINNACLE
suffix:colon
r_switch
c_cond
(paren
op_star
id|iarg
)paren
(brace
r_case
l_int|2
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;pinnacle pal&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|33300
op_star
l_int|1000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|tuner_dbg
c_func
(paren
l_string|&quot;pinnacle ntsc&bslash;n&quot;
)paren
suffix:semicolon
id|t-&gt;radio_if2
op_assign
l_int|41300
op_star
l_int|1000
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
multiline_comment|/* --- v4l ioctls --- */
multiline_comment|/* take care: bttv does userspace copying, we&squot;ll get a&n;&t;   kernel pointer here... */
r_case
id|VIDIOCSCHAN
suffix:colon
(brace
r_static
r_const
id|v4l2_std_id
id|map
(braket
)braket
op_assign
(brace
(braket
id|VIDEO_MODE_PAL
)braket
op_assign
id|V4L2_STD_PAL
comma
(braket
id|VIDEO_MODE_NTSC
)braket
op_assign
id|V4L2_STD_NTSC_M
comma
(braket
id|VIDEO_MODE_SECAM
)braket
op_assign
id|V4L2_STD_SECAM
comma
(braket
l_int|4
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_PAL_M
comma
(braket
l_int|5
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_PAL_N
comma
(braket
l_int|6
multiline_comment|/* bttv */
)braket
op_assign
id|V4L2_STD_NTSC_M_JP
comma
)brace
suffix:semicolon
r_struct
id|video_channel
op_star
id|vc
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
id|t-&gt;mode
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;norm
OL
id|ARRAY_SIZE
c_func
(paren
id|map
)paren
)paren
id|t-&gt;std
op_assign
id|map
(braket
id|vc-&gt;norm
)braket
suffix:semicolon
id|tuner_fixup_std
c_func
(paren
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_tv_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCSFREQ
suffix:colon
(brace
r_int
r_int
op_star
id|v
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
id|set_freq
c_func
(paren
id|client
comma
op_star
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGTUNER
suffix:colon
(brace
r_struct
id|video_tuner
op_star
id|vt
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_eq
id|t-&gt;mode
op_logical_and
id|t-&gt;has_signal
)paren
id|vt-&gt;signal
op_assign
id|t
op_member_access_from_pointer
id|has_signal
c_func
(paren
id|client
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOCGAUDIO
suffix:colon
(brace
r_struct
id|video_audio
op_star
id|va
op_assign
id|arg
suffix:semicolon
id|CHECK_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_eq
id|t-&gt;mode
op_logical_and
id|t-&gt;is_stereo
)paren
id|va-&gt;mode
op_assign
id|t
op_member_access_from_pointer
id|is_stereo
c_func
(paren
id|client
)paren
ques
c_cond
id|VIDEO_SOUND_STEREO
suffix:colon
id|VIDEO_SOUND_MONO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_STD
suffix:colon
(brace
id|v4l2_std_id
op_star
id|id
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
id|t-&gt;mode
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
id|t-&gt;std
op_assign
op_star
id|id
suffix:semicolon
id|tuner_fixup_std
c_func
(paren
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOC_S_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_eq
id|f-&gt;type
op_logical_and
id|V4L2_TUNER_RADIO
op_ne
id|t-&gt;mode
)paren
id|set_tv_freq
c_func
(paren
id|client
comma
l_int|400
op_star
l_int|16
)paren
suffix:semicolon
id|t-&gt;mode
op_assign
id|f-&gt;type
suffix:semicolon
id|t-&gt;freq
op_assign
id|f-&gt;frequency
suffix:semicolon
id|set_freq
c_func
(paren
id|client
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOC_G_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|tuner
op_assign
id|arg
suffix:semicolon
id|SWITCH_V4L2
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_RADIO
op_eq
id|t-&gt;mode
op_logical_and
id|t-&gt;has_signal
)paren
id|tuner-&gt;signal
op_assign
id|t
op_member_access_from_pointer
id|has_signal
c_func
(paren
id|client
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
multiline_comment|/* nothing */
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_suspend
r_static
r_int
id|tuner_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_struct
id|i2c_client
op_star
id|c
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|i2c_client
comma
id|dev
)paren
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
id|tuner_dbg
c_func
(paren
l_string|&quot;suspend&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* FIXME: power down ??? */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_resume
r_static
r_int
id|tuner_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|level
)paren
(brace
r_struct
id|i2c_client
op_star
id|c
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|i2c_client
comma
id|dev
)paren
suffix:semicolon
r_struct
id|tuner
op_star
id|t
op_assign
id|i2c_get_clientdata
c_func
(paren
id|c
)paren
suffix:semicolon
id|tuner_dbg
c_func
(paren
l_string|&quot;resume&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;freq
)paren
id|set_freq
c_func
(paren
id|c
comma
id|t-&gt;freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ----------------------------------------------------------------------- */
DECL|variable|driver
r_static
r_struct
id|i2c_driver
id|driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;tuner&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_TUNER
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|tuner_probe
comma
dot
id|detach_client
op_assign
id|tuner_detach
comma
dot
id|command
op_assign
id|tuner_command
comma
dot
id|driver
op_assign
(brace
dot
id|suspend
op_assign
id|tuner_suspend
comma
dot
id|resume
op_assign
id|tuner_resume
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
op_assign
(brace
id|I2C_DEVNAME
c_func
(paren
l_string|&quot;(tuner unset)&quot;
)paren
comma
dot
id|flags
op_assign
id|I2C_CLIENT_ALLOW_USE
comma
dot
id|driver
op_assign
op_amp
id|driver
comma
)brace
suffix:semicolon
DECL|function|tuner_init_module
r_static
r_int
id|__init
id|tuner_init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|tuner_cleanup_module
r_static
r_void
id|__exit
id|tuner_cleanup_module
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|variable|tuner_init_module
id|module_init
c_func
(paren
id|tuner_init_module
)paren
suffix:semicolon
DECL|variable|tuner_cleanup_module
id|module_exit
c_func
(paren
id|tuner_cleanup_module
)paren
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
