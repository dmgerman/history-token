multiline_comment|/*&n; * TTUSB DVB driver&n; *&n; * Copyright (c) 2002 Holger Waechtler &lt;holger@convergence.de&gt;&n; * Copyright (c) 2003 Felix Domke &lt;tmbinc@elitedvb.net&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License as&n; *&t;published by the Free Software Foundation; either version 2 of&n; *&t;the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &quot;dmxdev.h&quot;
macro_line|#include &quot;dvb_demux.h&quot;
macro_line|#include &quot;dvb_net.h&quot;
macro_line|#include &lt;linux/dvb/frontend.h&gt;
macro_line|#include &lt;linux/dvb/dmx.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;dvb_functions.h&quot;
multiline_comment|/*&n;  TTUSB_HWSECTIONS:&n;    the DSP supports filtering in hardware, however, since the &quot;muxstream&quot;&n;    is a bit braindead (no matching channel masks or no matching filter mask),&n;    we won&squot;t support this - yet. it doesn&squot;t event support negative filters,&n;    so the best way is maybe to keep TTUSB_HWSECTIONS undef&squot;d and just&n;    parse TS data. USB bandwith will be a problem when having large&n;    datastreams, especially for dvb-net, but hey, that&squot;s not my problem.&n;&t;&n;  TTUSB_DISEQC, TTUSB_TONE:&n;    let the STC do the diseqc/tone stuff. this isn&squot;t supported at least with&n;    my TTUSB, so let it undef&squot;d unless you want to implement another&n;    frontend. never tested.&n;&t;&t;&n;  DEBUG:&n;    define it to &gt; 3 for really hardcore debugging. you probably don&squot;t want&n;    this unless the device doesn&squot;t load at all. &gt; 2 for bandwidth statistics.&n;*/
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(x...) do { if (debug) printk(KERN_DEBUG x); } while (0)
DECL|macro|ISO_BUF_COUNT
mdefine_line|#define ISO_BUF_COUNT      4
DECL|macro|FRAMES_PER_ISO_BUF
mdefine_line|#define FRAMES_PER_ISO_BUF 4
DECL|macro|ISO_FRAME_SIZE
mdefine_line|#define ISO_FRAME_SIZE     912
DECL|macro|TTUSB_MAXCHANNEL
mdefine_line|#define TTUSB_MAXCHANNEL   32
macro_line|#ifdef TTUSB_HWSECTIONS
DECL|macro|TTUSB_MAXFILTER
mdefine_line|#define TTUSB_MAXFILTER    16&t;/* ??? */
macro_line|#endif
DECL|macro|TTUSB_BUDGET_NAME
mdefine_line|#define TTUSB_BUDGET_NAME &quot;ttusb_stc_fw&quot;
multiline_comment|/**&n; *  since we&squot;re casting (struct ttusb*) &lt;-&gt; (struct dvb_demux*) around&n; *  the dvb_demux field must be the first in struct!!&n; */
DECL|struct|ttusb
r_struct
id|ttusb
(brace
DECL|member|dvb_demux
r_struct
id|dvb_demux
id|dvb_demux
suffix:semicolon
DECL|member|dmxdev
r_struct
id|dmxdev
id|dmxdev
suffix:semicolon
DECL|member|dvbnet
r_struct
id|dvb_net
id|dvbnet
suffix:semicolon
multiline_comment|/* our semaphore, for channel allocation/deallocation */
DECL|member|sem
r_struct
id|semaphore
id|sem
suffix:semicolon
multiline_comment|/* and one for USB access. */
DECL|member|semusb
r_struct
id|semaphore
id|semusb
suffix:semicolon
DECL|member|adapter
r_struct
id|dvb_adapter
op_star
id|adapter
suffix:semicolon
DECL|member|dev
r_struct
id|usb_device
op_star
id|dev
suffix:semicolon
DECL|member|disconnecting
r_int
id|disconnecting
suffix:semicolon
DECL|member|iso_streaming
r_int
id|iso_streaming
suffix:semicolon
DECL|member|bulk_out_pipe
r_int
r_int
id|bulk_out_pipe
suffix:semicolon
DECL|member|bulk_in_pipe
r_int
r_int
id|bulk_in_pipe
suffix:semicolon
DECL|member|isoc_in_pipe
r_int
r_int
id|isoc_in_pipe
suffix:semicolon
DECL|member|iso_buffer
r_void
op_star
id|iso_buffer
suffix:semicolon
DECL|member|iso_dma_handle
id|dma_addr_t
id|iso_dma_handle
suffix:semicolon
DECL|member|iso_urb
r_struct
id|urb
op_star
id|iso_urb
(braket
id|ISO_BUF_COUNT
)braket
suffix:semicolon
DECL|member|running_feed_count
r_int
id|running_feed_count
suffix:semicolon
DECL|member|last_channel
r_int
id|last_channel
suffix:semicolon
DECL|member|last_filter
r_int
id|last_filter
suffix:semicolon
DECL|member|c
id|u8
id|c
suffix:semicolon
multiline_comment|/* transaction counter, wraps around...  */
DECL|member|tone
id|fe_sec_tone_mode_t
id|tone
suffix:semicolon
DECL|member|voltage
id|fe_sec_voltage_t
id|voltage
suffix:semicolon
DECL|member|mux_state
r_int
id|mux_state
suffix:semicolon
singleline_comment|// 0..2 - MuxSyncWord, 3 - nMuxPacks,    4 - muxpack
DECL|member|mux_npacks
id|u8
id|mux_npacks
suffix:semicolon
DECL|member|muxpack
id|u8
id|muxpack
(braket
l_int|256
op_plus
l_int|8
)braket
suffix:semicolon
DECL|member|muxpack_ptr
DECL|member|muxpack_len
r_int
id|muxpack_ptr
comma
id|muxpack_len
suffix:semicolon
DECL|member|insync
r_int
id|insync
suffix:semicolon
DECL|member|cc
id|u16
id|cc
suffix:semicolon
multiline_comment|/* MuxCounter - will increment on EVERY MUX PACKET */
multiline_comment|/* (including stuffing. yes. really.) */
DECL|member|last_result
id|u8
id|last_result
(braket
l_int|32
)braket
suffix:semicolon
DECL|struct|ttusb_channel
r_struct
id|ttusb_channel
(brace
DECL|member|ttusb
r_struct
id|ttusb
op_star
id|ttusb
suffix:semicolon
DECL|member|dvbdmxfeed
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
suffix:semicolon
DECL|member|active
r_int
id|active
suffix:semicolon
DECL|member|id
r_int
id|id
suffix:semicolon
DECL|member|pid
r_int
id|pid
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* 1 - TS, 2 - Filter */
macro_line|#ifdef TTUSB_HWSECTIONS
DECL|member|filterstate
r_int
id|filterstate
(braket
id|TTUSB_MAXFILTER
)braket
suffix:semicolon
multiline_comment|/* 0: not busy, 1: busy */
macro_line|#endif
DECL|member|channel
)brace
id|channel
(braket
id|TTUSB_MAXCHANNEL
)braket
suffix:semicolon
macro_line|#if 0
id|devfs_handle_t
id|stc_devfs_handle
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/* ugly workaround ... don&squot;t know why it&squot;s neccessary to read */
multiline_comment|/* all result codes. */
DECL|macro|DEBUG
mdefine_line|#define DEBUG 0
DECL|function|ttusb_cmd
r_static
r_int
id|ttusb_cmd
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_const
id|u8
op_star
id|data
comma
r_int
id|len
comma
r_int
id|needresult
)paren
(brace
r_int
id|actual_len
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#if DEBUG &gt;= 3
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&gt;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|data
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|err
op_assign
id|usb_bulk_msg
c_func
(paren
id|ttusb-&gt;dev
comma
id|ttusb-&gt;bulk_out_pipe
comma
(paren
id|u8
op_star
)paren
id|data
comma
id|len
comma
op_amp
id|actual_len
comma
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: usb_bulk_msg(send) failed, err == %i!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|actual_len
op_ne
id|len
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: only wrote %d of %d bytes&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|actual_len
comma
id|len
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|err
op_assign
id|usb_bulk_msg
c_func
(paren
id|ttusb-&gt;dev
comma
id|ttusb-&gt;bulk_in_pipe
comma
id|ttusb-&gt;last_result
comma
l_int|32
comma
op_amp
id|actual_len
comma
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: failed, receive error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if DEBUG &gt;= 3
id|actual_len
op_assign
id|ttusb-&gt;last_result
(braket
l_int|3
)braket
op_plus
l_int|4
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&lt;&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|actual_len
suffix:semicolon
op_increment
id|i
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|ttusb-&gt;last_result
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|needresult
)paren
id|up
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_result
r_static
r_int
id|ttusb_result
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
id|memcpy
c_func
(paren
id|data
comma
id|ttusb-&gt;last_result
comma
id|len
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;semusb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_i2c_msg
r_static
r_int
id|ttusb_i2c_msg
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|u8
id|addr
comma
id|u8
op_star
id|snd_buf
comma
id|u8
id|snd_len
comma
id|u8
op_star
id|rcv_buf
comma
id|u8
id|rcv_len
)paren
(brace
id|u8
id|b
(braket
l_int|0x28
)braket
suffix:semicolon
id|u8
id|id
op_assign
op_increment
id|ttusb-&gt;c
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|snd_len
OG
l_int|0x28
op_minus
l_int|7
op_logical_or
id|rcv_len
OG
l_int|0x20
op_minus
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|b
(braket
l_int|0
)braket
op_assign
l_int|0xaa
suffix:semicolon
id|b
(braket
l_int|1
)braket
op_assign
id|id
suffix:semicolon
id|b
(braket
l_int|2
)braket
op_assign
l_int|0x31
suffix:semicolon
id|b
(braket
l_int|3
)braket
op_assign
id|snd_len
op_plus
l_int|3
suffix:semicolon
id|b
(braket
l_int|4
)braket
op_assign
id|addr
op_lshift
l_int|1
suffix:semicolon
id|b
(braket
l_int|5
)braket
op_assign
id|snd_len
suffix:semicolon
id|b
(braket
l_int|6
)braket
op_assign
id|rcv_len
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|snd_len
suffix:semicolon
id|i
op_increment
)paren
id|b
(braket
l_int|7
op_plus
id|i
)braket
op_assign
id|snd_buf
(braket
id|i
)braket
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
id|snd_len
op_plus
l_int|7
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
id|err
op_assign
id|ttusb_result
c_func
(paren
id|ttusb
comma
id|b
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* check if the i2c transaction was successful */
r_if
c_cond
(paren
(paren
id|snd_len
op_ne
id|b
(braket
l_int|5
)braket
)paren
op_logical_or
(paren
id|rcv_len
op_ne
id|b
(braket
l_int|6
)braket
)paren
)paren
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
r_if
c_cond
(paren
id|rcv_len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|err
op_logical_or
id|b
(braket
l_int|0
)braket
op_ne
l_int|0x55
op_logical_or
id|b
(braket
l_int|1
)braket
op_ne
id|id
)paren
(brace
id|dprintk
(paren
l_string|&quot;%s: usb_bulk_msg(recv) failed, err == %i, id == %02x, b == &quot;
comma
id|__FUNCTION__
comma
id|err
comma
id|id
)paren
suffix:semicolon
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rcv_len
suffix:semicolon
id|i
op_increment
)paren
id|rcv_buf
(braket
id|i
)braket
op_assign
id|b
(braket
l_int|7
op_plus
id|i
)braket
suffix:semicolon
)brace
r_return
id|rcv_len
suffix:semicolon
)brace
DECL|function|ttusb_i2c_xfer
r_static
r_int
id|ttusb_i2c_xfer
c_func
(paren
r_struct
id|dvb_i2c_bus
op_star
id|i2c
comma
r_const
r_struct
id|i2c_msg
id|msg
(braket
)braket
comma
r_int
id|num
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
id|i2c-&gt;data
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|inc
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|num
)paren
(brace
id|u8
id|addr
comma
id|snd_len
comma
id|rcv_len
comma
op_star
id|snd_buf
comma
op_star
id|rcv_buf
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|num
OG
id|i
op_plus
l_int|1
op_logical_and
(paren
id|msg
(braket
id|i
op_plus
l_int|1
)braket
dot
id|flags
op_amp
id|I2C_M_RD
)paren
)paren
(brace
id|addr
op_assign
id|msg
(braket
id|i
)braket
dot
id|addr
suffix:semicolon
id|snd_buf
op_assign
id|msg
(braket
id|i
)braket
dot
id|buf
suffix:semicolon
id|snd_len
op_assign
id|msg
(braket
id|i
)braket
dot
id|len
suffix:semicolon
id|rcv_buf
op_assign
id|msg
(braket
id|i
op_plus
l_int|1
)braket
dot
id|buf
suffix:semicolon
id|rcv_len
op_assign
id|msg
(braket
id|i
op_plus
l_int|1
)braket
dot
id|len
suffix:semicolon
id|inc
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|addr
op_assign
id|msg
(braket
id|i
)braket
dot
id|addr
suffix:semicolon
id|snd_buf
op_assign
id|msg
(braket
id|i
)braket
dot
id|buf
suffix:semicolon
id|snd_len
op_assign
id|msg
(braket
id|i
)braket
dot
id|len
suffix:semicolon
id|rcv_buf
op_assign
l_int|NULL
suffix:semicolon
id|rcv_len
op_assign
l_int|0
suffix:semicolon
id|inc
op_assign
l_int|1
suffix:semicolon
)brace
id|err
op_assign
id|ttusb_i2c_msg
c_func
(paren
id|ttusb
comma
id|addr
comma
id|snd_buf
comma
id|snd_len
comma
id|rcv_buf
comma
id|rcv_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
id|rcv_len
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: i == %i&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_add_assign
id|inc
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
macro_line|#include &quot;dvb-ttusb-dspbootcode.h&quot;
DECL|function|ttusb_boot_dsp
r_static
r_int
id|ttusb_boot_dsp
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
id|u8
id|b
(braket
l_int|40
)braket
suffix:semicolon
multiline_comment|/* BootBlock */
id|b
(braket
l_int|0
)braket
op_assign
l_int|0xaa
suffix:semicolon
id|b
(braket
l_int|2
)braket
op_assign
l_int|0x13
suffix:semicolon
id|b
(braket
l_int|3
)braket
op_assign
l_int|28
suffix:semicolon
multiline_comment|/* upload dsp code in 32 byte steps (36 didn&squot;t work for me ...) */
multiline_comment|/* 32 is max packet size, no messages should be splitted. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|dsp_bootcode
)paren
suffix:semicolon
id|i
op_add_assign
l_int|28
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|b
(braket
l_int|4
)braket
comma
op_amp
id|dsp_bootcode
(braket
id|i
)braket
comma
l_int|28
)paren
suffix:semicolon
id|b
(braket
l_int|1
)braket
op_assign
op_increment
id|ttusb-&gt;c
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
l_int|32
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* last block ... */
id|b
(braket
l_int|1
)braket
op_assign
op_increment
id|ttusb-&gt;c
suffix:semicolon
id|b
(braket
l_int|2
)braket
op_assign
l_int|0x13
suffix:semicolon
id|b
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|done
suffix:semicolon
multiline_comment|/* BootEnd */
id|b
(braket
l_int|1
)braket
op_assign
op_increment
id|ttusb-&gt;c
suffix:semicolon
id|b
(braket
l_int|2
)braket
op_assign
l_int|0x14
suffix:semicolon
id|b
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|done
suffix:colon
r_if
c_cond
(paren
id|err
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: usb_bulk_msg() failed, return value %i!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|ttusb_set_channel
r_static
r_int
id|ttusb_set_channel
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_int
id|chan_id
comma
r_int
id|filter_type
comma
r_int
id|pid
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* SetChannel */
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x22
comma
l_int|4
comma
id|chan_id
comma
id|filter_type
comma
(paren
id|pid
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|pid
op_amp
l_int|0xff
)brace
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ttusb_del_channel
r_static
r_int
id|ttusb_del_channel
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_int
id|channel_id
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* DelChannel */
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x23
comma
l_int|1
comma
id|channel_id
)brace
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef TTUSB_HWSECTIONS
DECL|function|ttusb_set_filter
r_static
r_int
id|ttusb_set_filter
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_int
id|filter_id
comma
r_int
id|associated_chan
comma
id|u8
id|filter
(braket
l_int|8
)braket
comma
id|u8
id|mask
(braket
l_int|8
)braket
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* SetFilter */
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
l_int|0
comma
l_int|0x24
comma
l_int|0x1a
comma
id|filter_id
comma
id|associated_chan
comma
id|filter
(braket
l_int|0
)braket
comma
id|filter
(braket
l_int|1
)braket
comma
id|filter
(braket
l_int|2
)braket
comma
id|filter
(braket
l_int|3
)braket
comma
id|filter
(braket
l_int|4
)braket
comma
id|filter
(braket
l_int|5
)braket
comma
id|filter
(braket
l_int|6
)braket
comma
id|filter
(braket
l_int|7
)braket
comma
id|filter
(braket
l_int|8
)braket
comma
id|filter
(braket
l_int|9
)braket
comma
id|filter
(braket
l_int|10
)braket
comma
id|filter
(braket
l_int|11
)braket
comma
id|mask
(braket
l_int|0
)braket
comma
id|mask
(braket
l_int|1
)braket
comma
id|mask
(braket
l_int|2
)braket
comma
id|mask
(braket
l_int|3
)braket
comma
id|mask
(braket
l_int|4
)braket
comma
id|mask
(braket
l_int|5
)braket
comma
id|mask
(braket
l_int|6
)braket
comma
id|mask
(braket
l_int|7
)braket
comma
id|mask
(braket
l_int|8
)braket
comma
id|mask
(braket
l_int|9
)braket
comma
id|mask
(braket
l_int|10
)braket
comma
id|mask
(braket
l_int|11
)braket
)brace
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|ttusb_del_filter
r_static
r_int
id|ttusb_del_filter
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_int
id|filter_id
)paren
(brace
r_int
id|err
suffix:semicolon
multiline_comment|/* DelFilter */
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x25
comma
l_int|1
comma
id|filter_id
)brace
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ttusb_init_controller
r_static
r_int
id|ttusb_init_controller
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
id|u8
id|b0
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x15
comma
l_int|1
comma
l_int|0
)brace
suffix:semicolon
id|u8
id|b1
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x15
comma
l_int|1
comma
l_int|1
)brace
suffix:semicolon
id|u8
id|b2
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x32
comma
l_int|1
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* i2c write read: 5 bytes, addr 0x10, 0x02 bytes write, 1 bytes read. */
id|u8
id|b3
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x31
comma
l_int|5
comma
l_int|0x10
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x1e
)brace
suffix:semicolon
id|u8
id|b4
(braket
)braket
op_assign
(brace
l_int|0x55
comma
id|ttusb-&gt;c
comma
l_int|0x31
comma
l_int|4
comma
l_int|0x10
comma
l_int|0x02
comma
l_int|0x01
comma
l_int|0x00
comma
l_int|0x1e
)brace
suffix:semicolon
id|u8
id|get_version
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x17
comma
l_int|5
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|u8
id|get_dsp_version
(braket
l_int|0x20
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x26
comma
l_int|28
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* reset board */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b0
comma
r_sizeof
(paren
id|b0
)paren
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* reset board (again?) */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b1
comma
r_sizeof
(paren
id|b1
)paren
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|ttusb_boot_dsp
c_func
(paren
id|ttusb
)paren
suffix:semicolon
multiline_comment|/* set i2c bit rate */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b2
comma
r_sizeof
(paren
id|b2
)paren
comma
l_int|0
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b3
comma
r_sizeof
(paren
id|b3
)paren
comma
l_int|1
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|ttusb_result
c_func
(paren
id|ttusb
comma
id|b4
comma
r_sizeof
(paren
id|b4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|get_version
comma
r_sizeof
(paren
id|get_version
)paren
comma
l_int|1
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_result
c_func
(paren
id|ttusb
comma
id|get_version
comma
r_sizeof
(paren
id|get_version
)paren
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: stc-version: %c%c%c%c%c&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|get_version
(braket
l_int|4
)braket
comma
id|get_version
(braket
l_int|5
)braket
comma
id|get_version
(braket
l_int|6
)braket
comma
id|get_version
(braket
l_int|7
)braket
comma
id|get_version
(braket
l_int|8
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|get_version
op_plus
l_int|4
comma
l_string|&quot;V 0.0&quot;
comma
l_int|5
)paren
op_logical_and
id|memcmp
c_func
(paren
id|get_version
op_plus
l_int|4
comma
l_string|&quot;V 1.1&quot;
comma
l_int|5
)paren
op_logical_and
id|memcmp
c_func
(paren
id|get_version
op_plus
l_int|4
comma
l_string|&quot;V 2.1&quot;
comma
l_int|5
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;%s: unknown STC version %c%c%c%c%c, please report!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|get_version
(braket
l_int|4
)braket
comma
id|get_version
(braket
l_int|5
)braket
comma
id|get_version
(braket
l_int|6
)braket
comma
id|get_version
(braket
l_int|7
)braket
comma
id|get_version
(braket
l_int|8
)braket
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|get_dsp_version
comma
r_sizeof
(paren
id|get_dsp_version
)paren
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|ttusb_result
c_func
(paren
id|ttusb
comma
id|get_dsp_version
comma
r_sizeof
(paren
id|get_dsp_version
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: dsp-version: %c%c%c&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|get_dsp_version
(braket
l_int|4
)braket
comma
id|get_dsp_version
(braket
l_int|5
)braket
comma
id|get_dsp_version
(braket
l_int|6
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef TTUSB_DISEQC
DECL|function|ttusb_send_diseqc
r_static
r_int
id|ttusb_send_diseqc
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_const
r_struct
id|dvb_diseqc_master_cmd
op_star
id|cmd
)paren
(brace
id|u8
id|b
(braket
l_int|12
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x18
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
id|b
(braket
l_int|3
)braket
op_assign
l_int|4
op_plus
l_int|2
op_plus
id|cmd-&gt;msg_len
suffix:semicolon
id|b
(braket
l_int|4
)braket
op_assign
l_int|0xFF
suffix:semicolon
multiline_comment|/* send diseqc master, not burst */
id|b
(braket
l_int|5
)braket
op_assign
id|cmd-&gt;msg_len
suffix:semicolon
id|memcpy
c_func
(paren
id|b
op_plus
l_int|5
comma
id|cmd-&gt;msg
comma
id|cmd-&gt;msg_len
)paren
suffix:semicolon
multiline_comment|/* Diseqc */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
l_int|4
op_plus
id|b
(braket
l_int|3
)braket
comma
l_int|0
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: usb_bulk_msg() failed, return value %i!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ttusb_update_lnb
r_static
r_int
id|ttusb_update_lnb
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x16
comma
l_int|5
comma
multiline_comment|/*power: */
l_int|1
comma
id|ttusb-&gt;voltage
op_eq
id|SEC_VOLTAGE_18
ques
c_cond
l_int|0
suffix:colon
l_int|1
comma
id|ttusb-&gt;tone
op_eq
id|SEC_TONE_ON
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|1
comma
l_int|1
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* SetLNB */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: usb_bulk_msg() failed, return value %i!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|ttusb_set_voltage
r_static
r_int
id|ttusb_set_voltage
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|fe_sec_voltage_t
id|voltage
)paren
(brace
id|ttusb-&gt;voltage
op_assign
id|voltage
suffix:semicolon
r_return
id|ttusb_update_lnb
c_func
(paren
id|ttusb
)paren
suffix:semicolon
)brace
macro_line|#ifdef TTUSB_TONE
DECL|function|ttusb_set_tone
r_static
r_int
id|ttusb_set_tone
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|fe_sec_tone_mode_t
id|tone
)paren
(brace
id|ttusb-&gt;tone
op_assign
id|tone
suffix:semicolon
r_return
id|ttusb_update_lnb
c_func
(paren
id|ttusb
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ttusb_lnb_ioctl
r_static
r_int
id|ttusb_lnb_ioctl
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
id|fe-&gt;i2c-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_SET_VOLTAGE
suffix:colon
r_return
id|ttusb_set_voltage
c_func
(paren
id|ttusb
comma
(paren
id|fe_sec_voltage_t
)paren
id|arg
)paren
suffix:semicolon
macro_line|#ifdef TTUSB_TONE
r_case
id|FE_SET_TONE
suffix:colon
r_return
id|ttusb_set_tone
c_func
(paren
id|ttusb
comma
(paren
id|fe_sec_tone_mode_t
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef TTUSB_DISEQC
r_case
id|FE_DISEQC_SEND_MASTER_CMD
suffix:colon
r_return
id|ttusb_send_diseqc
c_func
(paren
id|ttusb
comma
(paren
r_struct
id|dvb_diseqc_master_cmd
op_star
)paren
id|arg
)paren
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|ttusb_set_led_freq
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|u8
id|freq
)paren
(brace
id|u8
id|b
(braket
)braket
op_assign
(brace
l_int|0xaa
comma
op_increment
id|ttusb-&gt;c
comma
l_int|0x19
comma
l_int|1
comma
id|freq
)brace
suffix:semicolon
r_int
id|err
comma
id|actual_len
suffix:semicolon
id|err
op_assign
id|ttusb_cmd
c_func
(paren
id|ttusb
comma
id|b
comma
r_sizeof
(paren
id|b
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: usb_bulk_msg() failed, return value %i!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|err
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*****************************************************************************/
macro_line|#ifdef TTUSB_HWSECTIONS
r_static
r_void
id|ttusb_handle_ts_data
c_func
(paren
r_struct
id|ttusb_channel
op_star
id|channel
comma
r_const
id|u8
op_star
id|data
comma
r_int
id|len
)paren
suffix:semicolon
r_static
r_void
id|ttusb_handle_sec_data
c_func
(paren
r_struct
id|ttusb_channel
op_star
id|channel
comma
r_const
id|u8
op_star
id|data
comma
r_int
id|len
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|numpkt
DECL|variable|lastj
DECL|variable|numts
DECL|variable|numstuff
DECL|variable|numsec
DECL|variable|numinvalid
r_int
id|numpkt
op_assign
l_int|0
comma
id|lastj
comma
id|numts
comma
id|numstuff
comma
id|numsec
comma
id|numinvalid
suffix:semicolon
DECL|function|ttusb_process_muxpack
r_static
r_void
id|ttusb_process_muxpack
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
r_const
id|u8
op_star
id|muxpack
comma
r_int
id|len
)paren
(brace
id|u16
id|csum
op_assign
l_int|0
comma
id|cc
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|csum
op_xor_assign
id|le16_to_cpup
c_func
(paren
(paren
id|u16
op_star
)paren
(paren
id|muxpack
op_plus
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csum
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: muxpack with incorrect checksum, ignoring&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|numinvalid
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|cc
op_assign
(paren
id|muxpack
(braket
id|len
op_minus
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|muxpack
(braket
id|len
op_minus
l_int|3
)braket
suffix:semicolon
id|cc
op_and_assign
l_int|0x7FFF
suffix:semicolon
r_if
c_cond
(paren
id|cc
op_ne
id|ttusb-&gt;cc
)paren
id|printk
c_func
(paren
l_string|&quot;%s: cc discontinuity (%d frames missing)&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
id|cc
op_minus
id|ttusb-&gt;cc
)paren
op_amp
l_int|0x7FFF
)paren
suffix:semicolon
id|ttusb-&gt;cc
op_assign
(paren
id|cc
op_plus
l_int|1
)paren
op_amp
l_int|0x7FFF
suffix:semicolon
r_if
c_cond
(paren
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x80
)paren
(brace
macro_line|#ifdef TTUSB_HWSECTIONS
multiline_comment|/* section data */
r_int
id|pusi
op_assign
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x40
suffix:semicolon
r_int
id|channel
op_assign
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x1F
suffix:semicolon
r_int
id|payload
op_assign
id|muxpack
(braket
l_int|1
)braket
suffix:semicolon
r_const
id|u8
op_star
id|data
op_assign
id|muxpack
op_plus
l_int|2
suffix:semicolon
multiline_comment|/* check offset flag */
r_if
c_cond
(paren
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x20
)paren
id|data
op_increment
suffix:semicolon
id|ttusb_handle_sec_data
c_func
(paren
id|ttusb-&gt;channel
op_plus
id|channel
comma
id|data
comma
id|payload
)paren
suffix:semicolon
id|data
op_add_assign
id|payload
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
op_logical_neg
(paren
id|ttusb-&gt;muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x20
)paren
)paren
op_xor
op_logical_neg
op_logical_neg
(paren
id|ttusb-&gt;muxpack
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
)paren
id|data
op_increment
suffix:semicolon
macro_line|#warning TODO: pusi
id|printk
c_func
(paren
l_string|&quot;cc: %04x&bslash;n&quot;
comma
(paren
id|data
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|data
(braket
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#endif
id|numsec
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|muxpack
(braket
l_int|0
)braket
op_eq
l_int|0x47
)paren
(brace
macro_line|#ifdef TTUSB_HWSECTIONS
multiline_comment|/* we have TS data here! */
r_int
id|pid
op_assign
(paren
(paren
id|muxpack
(braket
l_int|1
)braket
op_amp
l_int|0x0F
)paren
op_lshift
l_int|8
)paren
op_or
id|muxpack
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|channel
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|TTUSB_MAXCHANNEL
suffix:semicolon
op_increment
id|channel
)paren
r_if
c_cond
(paren
id|ttusb-&gt;channel
(braket
id|channel
)braket
dot
id|active
op_logical_and
(paren
id|pid
op_eq
id|ttusb-&gt;channel
(braket
id|channel
)braket
dot
id|pid
)paren
)paren
id|ttusb_handle_ts_data
c_func
(paren
id|ttusb-&gt;channel
op_plus
id|channel
comma
id|muxpack
comma
l_int|188
)paren
suffix:semicolon
macro_line|#endif
id|numts
op_increment
suffix:semicolon
id|dvb_dmx_swfilter_packets
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux
comma
id|muxpack
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|muxpack
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
id|numinvalid
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;illegal muxpack type %02x&bslash;n&quot;
comma
id|muxpack
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
id|numstuff
op_increment
suffix:semicolon
)brace
DECL|function|ttusb_process_frame
r_static
r_void
id|ttusb_process_frame
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
comma
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
r_int
id|maxwork
op_assign
l_int|1024
suffix:semicolon
r_while
c_loop
(paren
id|len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|maxwork
op_decrement
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: too much work&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ttusb-&gt;mux_state
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
id|len
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_star
id|data
op_increment
op_eq
l_int|0xAA
)paren
op_increment
id|ttusb-&gt;mux_state
suffix:semicolon
r_else
(brace
id|ttusb-&gt;mux_state
op_assign
l_int|0
suffix:semicolon
macro_line|#if DEBUG &gt; 3
r_if
c_cond
(paren
id|ttusb-&gt;insync
)paren
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|data
(braket
op_minus
l_int|1
)braket
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|ttusb-&gt;insync
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: lost sync.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ttusb-&gt;insync
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
)brace
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ttusb-&gt;insync
op_assign
l_int|1
suffix:semicolon
id|len
op_decrement
suffix:semicolon
id|ttusb-&gt;mux_npacks
op_assign
op_star
id|data
op_increment
suffix:semicolon
op_increment
id|ttusb-&gt;mux_state
suffix:semicolon
id|ttusb-&gt;muxpack_ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* maximum bytes, until we know the length */
id|ttusb-&gt;muxpack_len
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
(brace
r_int
id|avail
suffix:semicolon
id|avail
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|avail
OG
(paren
id|ttusb-&gt;muxpack_len
op_minus
id|ttusb-&gt;muxpack_ptr
)paren
)paren
id|avail
op_assign
id|ttusb-&gt;muxpack_len
op_minus
id|ttusb-&gt;muxpack_ptr
suffix:semicolon
id|memcpy
c_func
(paren
id|ttusb-&gt;muxpack
op_plus
id|ttusb-&gt;muxpack_ptr
comma
id|data
comma
id|avail
)paren
suffix:semicolon
id|ttusb-&gt;muxpack_ptr
op_add_assign
id|avail
suffix:semicolon
r_if
c_cond
(paren
id|ttusb-&gt;muxpack_ptr
OG
l_int|264
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|data
op_add_assign
id|avail
suffix:semicolon
id|len
op_sub_assign
id|avail
suffix:semicolon
multiline_comment|/* determine length */
r_if
c_cond
(paren
id|ttusb-&gt;muxpack_ptr
op_eq
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|ttusb-&gt;muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x80
)paren
(brace
id|ttusb-&gt;muxpack_len
op_assign
id|ttusb-&gt;muxpack
(braket
l_int|1
)braket
op_plus
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|ttusb
op_member_access_from_pointer
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x20
)paren
id|ttusb
op_member_access_from_pointer
id|muxpack_len
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
op_logical_neg
(paren
id|ttusb
op_member_access_from_pointer
id|muxpack
(braket
l_int|0
)braket
op_amp
l_int|0x20
)paren
)paren
op_xor
op_logical_neg
op_logical_neg
(paren
id|ttusb
op_member_access_from_pointer
id|muxpack
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
)paren
id|ttusb
op_member_access_from_pointer
id|muxpack_len
op_increment
suffix:semicolon
id|ttusb-&gt;muxpack_len
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ttusb-&gt;muxpack
(braket
l_int|0
)braket
op_eq
l_int|0x47
)paren
id|ttusb-&gt;muxpack_len
op_assign
l_int|188
op_plus
l_int|4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ttusb-&gt;muxpack
(braket
l_int|0
)braket
op_eq
l_int|0x00
)paren
id|ttusb-&gt;muxpack_len
op_assign
id|ttusb-&gt;muxpack
(braket
l_int|1
)braket
op_plus
l_int|2
op_plus
l_int|4
suffix:semicolon
r_else
(brace
id|dprintk
(paren
l_string|&quot;%s: invalid state: first byte is %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ttusb-&gt;muxpack
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ttusb-&gt;mux_state
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/**&n;&t;&t;&t; * if length is valid and we reached the end:&n;&t;&t;&t; * goto next muxpack&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|ttusb-&gt;muxpack_ptr
op_ge
l_int|2
)paren
op_logical_and
(paren
id|ttusb-&gt;muxpack_ptr
op_eq
id|ttusb-&gt;muxpack_len
)paren
)paren
(brace
id|ttusb_process_muxpack
c_func
(paren
id|ttusb
comma
id|ttusb
op_member_access_from_pointer
id|muxpack
comma
id|ttusb
op_member_access_from_pointer
id|muxpack_ptr
)paren
suffix:semicolon
id|ttusb-&gt;muxpack_ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* maximum bytes, until we know the length */
id|ttusb-&gt;muxpack_len
op_assign
l_int|2
suffix:semicolon
multiline_comment|/**&n;&t;&t;&t;&t; * no muxpacks left?&n;&t;&t;&t;&t; * return to search-sync state&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ttusb-&gt;mux_npacks
op_decrement
)paren
(brace
id|ttusb-&gt;mux_state
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|ttusb_iso_irq
r_static
r_void
id|ttusb_iso_irq
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
id|urb-&gt;context
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ttusb-&gt;iso_streaming
)paren
r_return
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;%s: status %d, errcount == %d, length == %i&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|urb-&gt;status
comma
id|urb-&gt;error_count
comma
id|urb-&gt;actual_length
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|urb-&gt;status
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|urb-&gt;number_of_packets
suffix:semicolon
op_increment
id|i
)paren
(brace
r_struct
id|usb_iso_packet_descriptor
op_star
id|d
suffix:semicolon
id|u8
op_star
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
id|numpkt
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|jiffies
op_minus
id|lastj
)paren
op_ge
id|HZ
)paren
(brace
macro_line|#if DEBUG &gt; 2
id|printk
(paren
l_string|&quot;frames/s: %d (ts: %d, stuff %d, sec: %d, invalid: %d, all: %d)&bslash;n&quot;
comma
id|numpkt
op_star
id|HZ
op_div
(paren
id|jiffies
op_minus
id|lastj
)paren
comma
id|numts
comma
id|numstuff
comma
id|numsec
comma
id|numinvalid
comma
id|numts
op_plus
id|numstuff
op_plus
id|numsec
op_plus
id|numinvalid
)paren
suffix:semicolon
macro_line|#endif
id|numts
op_assign
id|numstuff
op_assign
id|numsec
op_assign
id|numinvalid
op_assign
l_int|0
suffix:semicolon
id|lastj
op_assign
id|jiffies
suffix:semicolon
id|numpkt
op_assign
l_int|0
suffix:semicolon
)brace
id|d
op_assign
op_amp
id|urb-&gt;iso_frame_desc
(braket
id|i
)braket
suffix:semicolon
id|data
op_assign
id|urb-&gt;transfer_buffer
op_plus
id|d-&gt;offset
suffix:semicolon
id|len
op_assign
id|d-&gt;actual_length
suffix:semicolon
id|d-&gt;actual_length
op_assign
l_int|0
suffix:semicolon
id|d-&gt;status
op_assign
l_int|0
suffix:semicolon
id|ttusb_process_frame
c_func
(paren
id|ttusb
comma
id|data
comma
id|len
)paren
suffix:semicolon
)brace
)brace
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
DECL|function|ttusb_free_iso_urbs
r_static
r_void
id|ttusb_free_iso_urbs
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
)paren
id|usb_free_urb
c_func
(paren
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
l_int|NULL
comma
id|ISO_FRAME_SIZE
op_star
id|FRAMES_PER_ISO_BUF
op_star
id|ISO_BUF_COUNT
comma
id|ttusb-&gt;iso_buffer
comma
id|ttusb-&gt;iso_dma_handle
)paren
suffix:semicolon
)brace
DECL|function|ttusb_alloc_iso_urbs
r_static
r_int
id|ttusb_alloc_iso_urbs
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
suffix:semicolon
id|ttusb-&gt;iso_buffer
op_assign
id|pci_alloc_consistent
c_func
(paren
l_int|NULL
comma
id|ISO_FRAME_SIZE
op_star
id|FRAMES_PER_ISO_BUF
op_star
id|ISO_BUF_COUNT
comma
op_amp
id|ttusb-&gt;iso_dma_handle
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ttusb-&gt;iso_buffer
comma
l_int|0
comma
id|ISO_FRAME_SIZE
op_star
id|FRAMES_PER_ISO_BUF
op_star
id|ISO_BUF_COUNT
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|urb
op_star
id|urb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|urb
op_assign
id|usb_alloc_urb
c_func
(paren
id|FRAMES_PER_ISO_BUF
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|ttusb_free_iso_urbs
c_func
(paren
id|ttusb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
op_assign
id|urb
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_stop_iso_xfer
r_static
r_void
id|ttusb_stop_iso_xfer
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
id|usb_unlink_urb
c_func
(paren
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|ttusb-&gt;iso_streaming
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_start_iso_xfer
r_static
r_int
id|ttusb_start_iso_xfer
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
comma
id|j
comma
id|err
comma
id|buffer_offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ttusb-&gt;iso_streaming
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: iso xfer already running!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ttusb-&gt;insync
op_assign
l_int|0
suffix:semicolon
id|ttusb-&gt;mux_state
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|frame_offset
op_assign
l_int|0
suffix:semicolon
r_struct
id|urb
op_star
id|urb
op_assign
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
suffix:semicolon
id|urb-&gt;dev
op_assign
id|ttusb-&gt;dev
suffix:semicolon
id|urb-&gt;context
op_assign
id|ttusb
suffix:semicolon
id|urb-&gt;complete
op_assign
id|ttusb_iso_irq
suffix:semicolon
id|urb-&gt;pipe
op_assign
id|ttusb-&gt;isoc_in_pipe
suffix:semicolon
id|urb-&gt;transfer_flags
op_assign
id|URB_ISO_ASAP
suffix:semicolon
id|urb-&gt;number_of_packets
op_assign
id|FRAMES_PER_ISO_BUF
suffix:semicolon
id|urb-&gt;transfer_buffer_length
op_assign
id|ISO_FRAME_SIZE
op_star
id|FRAMES_PER_ISO_BUF
suffix:semicolon
id|urb-&gt;transfer_buffer
op_assign
id|ttusb-&gt;iso_buffer
op_plus
id|buffer_offset
suffix:semicolon
id|buffer_offset
op_add_assign
id|ISO_FRAME_SIZE
op_star
id|FRAMES_PER_ISO_BUF
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|FRAMES_PER_ISO_BUF
suffix:semicolon
id|j
op_increment
)paren
(brace
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|offset
op_assign
id|frame_offset
suffix:semicolon
id|urb-&gt;iso_frame_desc
(braket
id|j
)braket
dot
id|length
op_assign
id|ISO_FRAME_SIZE
suffix:semicolon
id|frame_offset
op_add_assign
id|ISO_FRAME_SIZE
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_BUF_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|ttusb-&gt;iso_urb
(braket
id|i
)braket
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|ttusb_stop_iso_xfer
c_func
(paren
id|ttusb
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;%s: failed urb submission (%i: err = %i)!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|i
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
id|ttusb-&gt;iso_streaming
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef TTUSB_HWSECTIONS
DECL|function|ttusb_handle_ts_data
r_static
r_void
id|ttusb_handle_ts_data
c_func
(paren
r_struct
id|ttusb_channel
op_star
id|channel
comma
r_const
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
id|channel-&gt;dvbdmxfeed
suffix:semicolon
id|dvbdmxfeed-&gt;cb
dot
id|ts
c_func
(paren
id|data
comma
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|dvbdmxfeed-&gt;feed.ts
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ttusb_handle_sec_data
r_static
r_void
id|ttusb_handle_sec_data
c_func
(paren
r_struct
id|ttusb_channel
op_star
id|channel
comma
r_const
id|u8
op_star
id|data
comma
r_int
id|len
)paren
(brace
singleline_comment|//      struct dvb_demux_feed *dvbdmxfeed = channel-&gt;dvbdmxfeed;
macro_line|#error TODO: handle ugly stuff
singleline_comment|//      dvbdmxfeed-&gt;cb.sec(data, len, 0, 0, &amp;dvbdmxfeed-&gt;feed.sec, 0);
)brace
macro_line|#endif
DECL|function|ttusb_channel_allocate
r_static
r_struct
id|ttusb_channel
op_star
id|ttusb_channel_allocate
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* lock! */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TTUSB_MAXCHANNEL
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ttusb-&gt;channel
(braket
id|i
)braket
dot
id|active
)paren
(brace
id|ttusb-&gt;channel
(braket
id|i
)braket
dot
id|active
op_assign
l_int|1
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
suffix:semicolon
r_return
id|ttusb-&gt;channel
op_plus
id|i
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|ttusb_start_feed
r_static
r_int
id|ttusb_start_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
(paren
r_struct
id|ttusb
op_star
)paren
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|ttusb_channel
op_star
id|channel
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;ttusb_start_feed&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dvbdmxfeed-&gt;type
)paren
(brace
r_case
id|DMX_TYPE_TS
suffix:colon
r_break
suffix:semicolon
r_case
id|DMX_TYPE_SEC
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;type
op_eq
id|DMX_TYPE_TS
)paren
(brace
r_switch
c_cond
(paren
id|dvbdmxfeed-&gt;pes_type
)paren
(brace
r_case
id|DMX_TS_PES_VIDEO
suffix:colon
r_case
id|DMX_TS_PES_AUDIO
suffix:colon
r_case
id|DMX_TS_PES_TELETEXT
suffix:colon
r_case
id|DMX_TS_PES_PCR
suffix:colon
r_case
id|DMX_TS_PES_OTHER
suffix:colon
id|channel
op_assign
id|ttusb_channel_allocate
c_func
(paren
id|ttusb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_else
(brace
id|channel
op_assign
id|ttusb_channel_allocate
c_func
(paren
id|ttusb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|channel
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dvbdmxfeed-&gt;priv
op_assign
id|channel
suffix:semicolon
id|channel-&gt;dvbdmxfeed
op_assign
id|dvbdmxfeed
suffix:semicolon
id|channel-&gt;pid
op_assign
id|dvbdmxfeed-&gt;pid
suffix:semicolon
macro_line|#ifdef TTUSB_HWSECTIONS
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;type
op_eq
id|DMX_TYPE_TS
)paren
(brace
id|channel-&gt;type
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;type
op_eq
id|DMX_TYPE_SEC
)paren
(brace
id|channel-&gt;type
op_assign
l_int|2
suffix:semicolon
macro_line|#error TODO: allocate filters
)brace
macro_line|#else
id|channel-&gt;type
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|ttusb_set_channel
c_func
(paren
id|ttusb
comma
id|channel-&gt;id
comma
id|channel-&gt;type
comma
id|channel-&gt;pid
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|ttusb-&gt;running_feed_count
op_increment
)paren
id|ttusb_start_iso_xfer
c_func
(paren
id|ttusb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_stop_feed
r_static
r_int
id|ttusb_stop_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|ttusb_channel
op_star
id|channel
op_assign
(paren
r_struct
id|ttusb_channel
op_star
)paren
id|dvbdmxfeed-&gt;priv
suffix:semicolon
r_struct
id|ttusb
op_star
id|ttusb
op_assign
(paren
r_struct
id|ttusb
op_star
)paren
id|dvbdmxfeed-&gt;demux
suffix:semicolon
id|ttusb_del_channel
c_func
(paren
id|channel-&gt;ttusb
comma
id|channel-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|ttusb-&gt;running_feed_count
op_eq
l_int|0
)paren
id|ttusb_stop_iso_xfer
c_func
(paren
id|ttusb
)paren
suffix:semicolon
id|channel-&gt;active
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_setup_interfaces
r_static
r_int
id|ttusb_setup_interfaces
c_func
(paren
r_struct
id|ttusb
op_star
id|ttusb
)paren
(brace
id|usb_reset_configuration
c_func
(paren
id|ttusb-&gt;dev
)paren
suffix:semicolon
id|usb_set_interface
c_func
(paren
id|ttusb-&gt;dev
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|ttusb-&gt;bulk_out_pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|ttusb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
id|ttusb-&gt;bulk_in_pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|ttusb-&gt;dev
comma
l_int|1
)paren
suffix:semicolon
id|ttusb-&gt;isoc_in_pipe
op_assign
id|usb_rcvisocpipe
c_func
(paren
id|ttusb-&gt;dev
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
r_static
id|u8
id|stc_firmware
(braket
l_int|8192
)braket
suffix:semicolon
r_static
r_int
id|stc_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
id|file-&gt;private_data
suffix:semicolon
r_int
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|addr
op_assign
l_int|0
suffix:semicolon
id|addr
OL
l_int|8192
suffix:semicolon
id|addr
op_add_assign
l_int|16
)paren
(brace
id|u8
id|snd_buf
(braket
l_int|2
)braket
op_assign
(brace
id|addr
op_rshift
l_int|8
comma
id|addr
op_amp
l_int|0xFF
)brace
suffix:semicolon
id|ttusb_i2c_msg
c_func
(paren
id|ttusb
comma
l_int|0x50
comma
id|snd_buf
comma
l_int|2
comma
id|stc_firmware
op_plus
id|addr
comma
l_int|16
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
id|stc_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|tc
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tc
op_plus
op_star
id|offset
)paren
OG
l_int|8192
)paren
id|tc
op_assign
l_int|8192
op_minus
op_star
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|tc
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|stc_firmware
op_plus
op_star
id|offset
comma
id|tc
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
op_star
id|offset
op_add_assign
id|tc
suffix:semicolon
r_return
id|tc
suffix:semicolon
)brace
r_static
r_int
id|stc_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|file_operations
id|stc_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|read
op_assign
id|stc_read
comma
dot
id|open
op_assign
id|stc_open
comma
dot
id|release
op_assign
id|stc_release
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|ttusb_probe
r_static
r_int
id|ttusb_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_struct
id|usb_device
op_star
id|udev
suffix:semicolon
r_struct
id|ttusb
op_star
id|ttusb
suffix:semicolon
r_int
id|result
comma
id|channel
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: TTUSB DVB connected&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|udev
op_assign
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
suffix:semicolon
multiline_comment|/* Device has already been reset; its configuration was chosen.&n;&t; * If this fault happens, use a hotplug script to choose the&n;&t; * right configuration (write bConfigurationValue in sysfs).&n;&t; */
r_if
c_cond
(paren
id|udev-&gt;actconfig-&gt;desc.bConfigurationValue
op_ne
l_int|1
)paren
(brace
id|dev_err
c_func
(paren
op_amp
id|intf-&gt;dev
comma
l_string|&quot;device config is #%d, need #1&bslash;n&quot;
comma
id|udev-&gt;actconfig-&gt;desc.bConfigurationValue
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ttusb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ttusb
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|ttusb
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ttusb
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|TTUSB_MAXCHANNEL
suffix:semicolon
op_increment
id|channel
)paren
(brace
id|ttusb-&gt;channel
(braket
id|channel
)braket
dot
id|id
op_assign
id|channel
suffix:semicolon
id|ttusb-&gt;channel
(braket
id|channel
)braket
dot
id|ttusb
op_assign
id|ttusb
suffix:semicolon
)brace
id|ttusb-&gt;dev
op_assign
id|udev
suffix:semicolon
id|ttusb-&gt;c
op_assign
l_int|0
suffix:semicolon
id|ttusb-&gt;mux_state
op_assign
l_int|0
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|ttusb-&gt;sem
comma
l_int|0
)paren
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|ttusb-&gt;semusb
comma
l_int|1
)paren
suffix:semicolon
id|ttusb_setup_interfaces
c_func
(paren
id|ttusb
)paren
suffix:semicolon
id|ttusb_alloc_iso_urbs
c_func
(paren
id|ttusb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ttusb_init_controller
c_func
(paren
id|ttusb
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;ttusb_init_controller: error&bslash;n&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ttusb-&gt;sem
)paren
suffix:semicolon
id|dvb_register_adapter
c_func
(paren
op_amp
id|ttusb-&gt;adapter
comma
l_string|&quot;Technotrend/Hauppauge Nova-USB&quot;
)paren
suffix:semicolon
id|dvb_register_i2c_bus
c_func
(paren
id|ttusb_i2c_xfer
comma
id|ttusb
comma
id|ttusb-&gt;adapter
comma
l_int|0
)paren
suffix:semicolon
id|dvb_add_frontend_ioctls
c_func
(paren
id|ttusb-&gt;adapter
comma
id|ttusb_lnb_ioctl
comma
l_int|NULL
comma
id|ttusb
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux
comma
l_int|0
comma
r_sizeof
(paren
id|ttusb-&gt;dvb_demux
)paren
)paren
suffix:semicolon
id|ttusb-&gt;dvb_demux.dmx.capabilities
op_assign
id|DMX_TS_FILTERING
op_or
id|DMX_SECTION_FILTERING
suffix:semicolon
id|ttusb-&gt;dvb_demux.priv
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef TTUSB_HWSECTIONS
id|ttusb-&gt;dvb_demux.filternum
op_assign
id|TTUSB_MAXFILTER
suffix:semicolon
macro_line|#else
id|ttusb-&gt;dvb_demux.filternum
op_assign
l_int|32
suffix:semicolon
macro_line|#endif
id|ttusb-&gt;dvb_demux.feednum
op_assign
id|TTUSB_MAXCHANNEL
suffix:semicolon
id|ttusb-&gt;dvb_demux.start_feed
op_assign
id|ttusb_start_feed
suffix:semicolon
id|ttusb-&gt;dvb_demux.stop_feed
op_assign
id|ttusb_stop_feed
suffix:semicolon
id|ttusb-&gt;dvb_demux.write_to_decoder
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|dvb_dmx_init
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ttusb_dvb: dvb_dmx_init failed (errno = %d)&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
singleline_comment|//FIXME dmxdev (nur WAS?)
id|ttusb-&gt;dmxdev.filternum
op_assign
id|ttusb-&gt;dvb_demux.filternum
suffix:semicolon
id|ttusb-&gt;dmxdev.demux
op_assign
op_amp
id|ttusb-&gt;dvb_demux.dmx
suffix:semicolon
id|ttusb-&gt;dmxdev.capabilities
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|dvb_dmxdev_init
c_func
(paren
op_amp
id|ttusb-&gt;dmxdev
comma
id|ttusb-&gt;adapter
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ttusb_dvb: dvb_dmxdev_init failed (errno = %d)&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
id|dvb_dmx_release
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux
)paren
suffix:semicolon
r_goto
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dvb_net_init
(paren
id|ttusb-&gt;adapter
comma
op_amp
id|ttusb-&gt;dvbnet
comma
op_amp
id|ttusb-&gt;dvb_demux.dmx
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ttusb_dvb: dvb_net_init failed!&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|err
suffix:colon
macro_line|#if 0
id|ttusb-&gt;stc_devfs_handle
op_assign
id|devfs_register
c_func
(paren
id|ttusb-&gt;adapter-&gt;devfs_handle
comma
id|TTUSB_BUDGET_NAME
comma
id|DEVFS_FL_DEFAULT
comma
l_int|0
comma
l_int|192
comma
id|S_IFCHR
op_or
id|S_IRUSR
op_or
id|S_IWUSR
op_or
id|S_IRGRP
op_or
id|S_IWGRP
op_or
id|S_IROTH
op_or
id|S_IWOTH
comma
op_amp
id|stc_fops
comma
id|ttusb
)paren
suffix:semicolon
macro_line|#endif
id|usb_set_intfdata
c_func
(paren
id|intf
comma
(paren
r_void
op_star
)paren
id|ttusb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_disconnect
r_static
r_void
id|ttusb_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
r_struct
id|ttusb
op_star
id|ttusb
op_assign
id|usb_get_intfdata
c_func
(paren
id|intf
)paren
suffix:semicolon
id|usb_set_intfdata
c_func
(paren
id|intf
comma
l_int|NULL
)paren
suffix:semicolon
id|ttusb-&gt;disconnecting
op_assign
l_int|1
suffix:semicolon
id|ttusb_stop_iso_xfer
c_func
(paren
id|ttusb
)paren
suffix:semicolon
macro_line|#if 0
id|devfs_remove
c_func
(paren
id|TTUSB_BUDGET_NAME
)paren
suffix:semicolon
macro_line|#endif
id|ttusb-&gt;dvb_demux.dmx
dot
id|close
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux.dmx
)paren
suffix:semicolon
id|dvb_net_release
c_func
(paren
op_amp
id|ttusb-&gt;dvbnet
)paren
suffix:semicolon
id|dvb_dmxdev_release
c_func
(paren
op_amp
id|ttusb-&gt;dmxdev
)paren
suffix:semicolon
id|dvb_dmx_release
c_func
(paren
op_amp
id|ttusb-&gt;dvb_demux
)paren
suffix:semicolon
id|dvb_unregister_i2c_bus
c_func
(paren
id|ttusb_i2c_xfer
comma
id|ttusb-&gt;adapter
comma
l_int|0
)paren
suffix:semicolon
id|dvb_unregister_adapter
c_func
(paren
id|ttusb-&gt;adapter
)paren
suffix:semicolon
id|ttusb_free_iso_urbs
c_func
(paren
id|ttusb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ttusb
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: TTUSB DVB disconnected&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
DECL|variable|ttusb_table
r_static
r_struct
id|usb_device_id
id|ttusb_table
(braket
)braket
op_assign
(brace
(brace
id|USB_DEVICE
c_func
(paren
l_int|0xb48
comma
l_int|0x1003
)paren
)brace
comma
(brace
id|USB_DEVICE
c_func
(paren
l_int|0xb48
comma
l_int|0x1004
)paren
)brace
comma
multiline_comment|/* to be confirmed ????  */
(brace
id|USB_DEVICE
c_func
(paren
l_int|0xb48
comma
l_int|0x1005
)paren
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|ttusb_table
)paren
suffix:semicolon
DECL|variable|ttusb_driver
r_static
r_struct
id|usb_driver
id|ttusb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Technotrend/Hauppauge USB-Nova&quot;
comma
dot
id|probe
op_assign
id|ttusb_probe
comma
dot
id|disconnect
op_assign
id|ttusb_disconnect
comma
dot
id|id_table
op_assign
id|ttusb_table
comma
)brace
suffix:semicolon
DECL|function|ttusb_init
r_static
r_int
id|__init
id|ttusb_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|ttusb_driver
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: usb_register failed! Error number %d&quot;
comma
id|__FILE__
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ttusb_exit
r_static
r_void
id|__exit
id|ttusb_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|ttusb_driver
)paren
suffix:semicolon
)brace
DECL|variable|ttusb_init
id|module_init
c_func
(paren
id|ttusb_init
)paren
suffix:semicolon
DECL|variable|ttusb_exit
id|module_exit
c_func
(paren
id|ttusb_exit
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Debug or not&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Holger Waechtler &lt;holger@convergence.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;TTUSB DVB Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
