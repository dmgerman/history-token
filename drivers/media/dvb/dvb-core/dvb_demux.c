multiline_comment|/* &n; * dvb_demux.c - DVB kernel demux API&n; *&n; * Copyright (C) 2000-2001 Ralph  Metzler &lt;ralph@convergence.de&gt;&n; *&t;&t;       &amp; Marcus Metzler &lt;marcus@convergence.de&gt;&n; *&t;&t;&t; for convergence integrated media GmbH&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU Lesser General Public License&n; * as published by the Free Software Foundation; either version 2.1&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU Lesser General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; *&n; */
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/crc32.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;dvb_demux.h&quot;
macro_line|#include &quot;dvb_functions.h&quot;
DECL|macro|NOBUFS
mdefine_line|#define NOBUFS  
multiline_comment|/* &n;** #define DVB_DEMUX_SECTION_LOSS_LOG to monitor payload loss in the syslog&n;*/
singleline_comment|// #define DVB_DEMUX_SECTION_LOSS_LOG
DECL|variable|dmx_muxs
id|LIST_HEAD
c_func
(paren
id|dmx_muxs
)paren
suffix:semicolon
DECL|function|dmx_register_demux
r_int
id|dmx_register_demux
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
id|demux-&gt;users
op_assign
l_int|0
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|demux-&gt;reg_list
comma
op_amp
id|dmx_muxs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmx_unregister_demux
r_int
id|dmx_unregister_demux
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|n
comma
op_star
id|head
op_assign
op_amp
id|dmx_muxs
suffix:semicolon
id|list_for_each_safe
(paren
id|pos
comma
id|n
comma
id|head
)paren
(brace
r_if
c_cond
(paren
id|DMX_DIR_ENTRY
c_func
(paren
id|pos
)paren
op_eq
id|demux
)paren
(brace
r_if
c_cond
(paren
id|demux-&gt;users
OG
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|list_del
c_func
(paren
id|pos
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|dmx_get_demuxes
r_struct
id|list_head
op_star
id|dmx_get_demuxes
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|dmx_muxs
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
op_amp
id|dmx_muxs
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * static inlined helper functions&n; ******************************************************************************/
DECL|function|section_length
r_static
r_inline
id|u16
id|section_length
c_func
(paren
r_const
id|u8
op_star
id|buf
)paren
(brace
r_return
l_int|3
op_plus
(paren
(paren
id|buf
(braket
l_int|1
)braket
op_amp
l_int|0x0f
)paren
op_lshift
l_int|8
)paren
op_plus
id|buf
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|ts_pid
r_static
r_inline
id|u16
id|ts_pid
c_func
(paren
r_const
id|u8
op_star
id|buf
)paren
(brace
r_return
(paren
(paren
id|buf
(braket
l_int|1
)braket
op_amp
l_int|0x1f
)paren
op_lshift
l_int|8
)paren
op_plus
id|buf
(braket
l_int|2
)braket
suffix:semicolon
)brace
DECL|function|payload
r_static
r_inline
id|u8
id|payload
c_func
(paren
r_const
id|u8
op_star
id|tsp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|tsp
(braket
l_int|3
)braket
op_amp
l_int|0x10
)paren
)paren
singleline_comment|// no payload?
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tsp
(braket
l_int|3
)braket
op_amp
l_int|0x20
)paren
(brace
singleline_comment|// adaptation field?
r_if
c_cond
(paren
id|tsp
(braket
l_int|4
)braket
OG
l_int|183
)paren
singleline_comment|// corrupted data?
r_return
l_int|0
suffix:semicolon
r_else
r_return
l_int|184
op_minus
l_int|1
op_minus
id|tsp
(braket
l_int|4
)braket
suffix:semicolon
)brace
r_return
l_int|184
suffix:semicolon
)brace
DECL|function|dvb_set_crc32
r_void
id|dvb_set_crc32
c_func
(paren
id|u8
op_star
id|data
comma
r_int
id|length
)paren
(brace
id|u32
id|crc
suffix:semicolon
id|crc
op_assign
id|crc32_be
c_func
(paren
op_complement
l_int|0
comma
id|data
comma
id|length
)paren
suffix:semicolon
id|data
(braket
id|length
)braket
op_assign
(paren
id|crc
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
id|length
op_plus
l_int|1
)braket
op_assign
(paren
id|crc
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
id|length
op_plus
l_int|2
)braket
op_assign
(paren
id|crc
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|data
(braket
id|length
op_plus
l_int|3
)braket
op_assign
(paren
id|crc
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
DECL|function|dvb_dmx_crc32
r_static
id|u32
id|dvb_dmx_crc32
(paren
r_struct
id|dvb_demux_feed
op_star
id|f
comma
r_const
id|u8
op_star
id|src
comma
r_int
id|len
)paren
(brace
r_return
(paren
id|f-&gt;feed.sec.crc_val
op_assign
id|crc32_be
(paren
id|f-&gt;feed.sec.crc_val
comma
id|src
comma
id|len
)paren
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_memcopy
r_static
r_void
id|dvb_dmx_memcopy
(paren
r_struct
id|dvb_demux_feed
op_star
id|f
comma
id|u8
op_star
id|d
comma
r_const
id|u8
op_star
id|s
comma
r_int
id|len
)paren
(brace
id|memcpy
(paren
id|d
comma
id|s
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * Software filter functions&n; ******************************************************************************/
DECL|function|dvb_dmx_swfilter_payload
r_static
r_inline
r_int
id|dvb_dmx_swfilter_payload
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_const
id|u8
op_star
id|buf
)paren
(brace
r_int
id|count
op_assign
id|payload
c_func
(paren
id|buf
)paren
suffix:semicolon
r_int
id|p
suffix:semicolon
singleline_comment|//int ccok;
singleline_comment|//u8 cc;
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|p
op_assign
l_int|188
op_minus
id|count
suffix:semicolon
multiline_comment|/*&n;&t;cc=buf[3]&amp;0x0f;&n;&t;ccok=((dvbdmxfeed-&gt;cc+1)&amp;0x0f)==cc ? 1 : 0;&n;&t;dvbdmxfeed-&gt;cc=cc;&n;&t;if (!ccok)&n;&t;&t;printk(&quot;missed packet!&bslash;n&quot;);&n;&t;*/
r_if
c_cond
(paren
id|buf
(braket
l_int|1
)braket
op_amp
l_int|0x40
)paren
singleline_comment|// PUSI ?
id|feed-&gt;peslen
op_assign
l_int|0xfffa
suffix:semicolon
id|feed-&gt;peslen
op_add_assign
id|count
suffix:semicolon
r_return
id|feed-&gt;cb.ts
(paren
op_amp
id|buf
(braket
id|p
)braket
comma
id|count
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|feed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_sectionfilter
r_static
r_int
id|dvb_dmx_swfilter_sectionfilter
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_struct
id|dvb_demux_filter
op_star
id|f
)paren
(brace
id|u8
id|neq
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DVB_DEMUX_MASK_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u8
op_xor
op_assign
id|f-&gt;filter.filter_value
(braket
id|i
)braket
op_xor
id|feed-&gt;feed.sec.secbuf
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|f-&gt;maskandmode
(braket
id|i
)braket
op_amp
op_xor
)paren
r_return
l_int|0
suffix:semicolon
id|neq
op_or_assign
id|f-&gt;maskandnotmode
(braket
id|i
)braket
op_amp
op_xor
suffix:semicolon
)brace
r_if
c_cond
(paren
id|f-&gt;doneq
op_logical_and
op_logical_neg
id|neq
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|feed-&gt;cb.sec
(paren
id|feed-&gt;feed.sec.secbuf
comma
id|feed-&gt;feed.sec.seclen
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|f-&gt;filter
comma
id|DMX_OK
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_section_feed
r_static
r_inline
r_int
id|dvb_dmx_swfilter_section_feed
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_struct
id|dvb_demux_filter
op_star
id|f
op_assign
id|feed-&gt;filter
suffix:semicolon
r_struct
id|dmx_section_feed
op_star
id|sec
op_assign
op_amp
id|feed-&gt;feed.sec
suffix:semicolon
r_int
id|section_syntax_indicator
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sec-&gt;is_filtering
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sec-&gt;check_crc
)paren
(brace
id|section_syntax_indicator
op_assign
(paren
(paren
id|sec-&gt;secbuf
(braket
l_int|1
)braket
op_amp
l_int|0x80
)paren
op_ne
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|section_syntax_indicator
op_logical_and
id|demux
op_member_access_from_pointer
id|check_crc32
c_func
(paren
id|feed
comma
id|sec-&gt;secbuf
comma
id|sec-&gt;seclen
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
id|dvb_dmx_swfilter_sectionfilter
c_func
(paren
id|feed
comma
id|f
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|f
op_assign
id|f-&gt;next
)paren
op_logical_and
id|sec-&gt;is_filtering
)paren
suffix:semicolon
id|sec-&gt;seclen
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_section_new
r_static
r_void
id|dvb_dmx_swfilter_section_new
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_struct
id|dmx_section_feed
op_star
id|sec
op_assign
op_amp
id|feed-&gt;feed.sec
suffix:semicolon
macro_line|#ifdef DVB_DEMUX_SECTION_LOSS_LOG
r_if
c_cond
(paren
id|sec-&gt;secbufp
OL
id|sec-&gt;tsfeedp
)paren
(brace
r_int
id|i
comma
id|n
op_assign
id|sec-&gt;tsfeedp
op_minus
id|sec-&gt;secbufp
suffix:semicolon
multiline_comment|/* section padding is done with 0xff bytes entirely.&n;&t;&t;** due to speed reasons, we won&squot;t check all of them&n;&t;&t;** but just first and last&n;&t;&t;*/
r_if
c_cond
(paren
id|sec-&gt;secbuf
(braket
l_int|0
)braket
op_ne
l_int|0xff
op_logical_or
id|sec-&gt;secbuf
(braket
id|n
op_minus
l_int|1
)braket
op_ne
l_int|0xff
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb_demux.c section ts padding loss: %d/%d&bslash;n&quot;
comma
id|n
comma
id|sec-&gt;tsfeedp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dvb_demux.c pad data:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|sec-&gt;secbuf
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|sec-&gt;tsfeedp
op_assign
id|sec-&gt;secbufp
op_assign
id|sec-&gt;seclen
op_assign
l_int|0
suffix:semicolon
id|sec-&gt;secbuf
op_assign
id|sec-&gt;secbuf_base
suffix:semicolon
)brace
multiline_comment|/* &n;** Losless Section Demux 1.4 by Emard&n;*/
DECL|function|dvb_dmx_swfilter_section_copy_dump
r_static
r_int
id|dvb_dmx_swfilter_section_copy_dump
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_const
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_struct
id|dmx_section_feed
op_star
id|sec
op_assign
op_amp
id|feed-&gt;feed.sec
suffix:semicolon
id|u16
id|limit
comma
id|seclen
comma
id|n
suffix:semicolon
r_if
c_cond
(paren
id|sec-&gt;tsfeedp
op_ge
id|DMX_MAX_SECFEED_SIZE
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sec-&gt;tsfeedp
op_plus
id|len
OG
id|DMX_MAX_SECFEED_SIZE
)paren
(brace
macro_line|#ifdef DVB_DEMUX_SECTION_LOSS_LOG
id|printk
c_func
(paren
l_string|&quot;dvb_demux.c section buffer full loss: %d/%d&bslash;n&quot;
comma
id|sec-&gt;tsfeedp
op_plus
id|len
op_minus
id|DMX_MAX_SECFEED_SIZE
comma
id|DMX_MAX_SECFEED_SIZE
)paren
suffix:semicolon
macro_line|#endif
id|len
op_assign
id|DMX_MAX_SECFEED_SIZE
op_minus
id|sec-&gt;tsfeedp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|demux
op_member_access_from_pointer
id|memcopy
c_func
(paren
id|feed
comma
id|sec-&gt;secbuf_base
op_plus
id|sec-&gt;tsfeedp
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|sec-&gt;tsfeedp
op_add_assign
id|len
suffix:semicolon
multiline_comment|/* -----------------------------------------------------&n;&t;** Dump all the sections we can find in the data (Emard)&n;&t;*/
id|limit
op_assign
id|sec-&gt;tsfeedp
suffix:semicolon
r_if
c_cond
(paren
id|limit
OG
id|DMX_MAX_SECFEED_SIZE
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* internal error should never happen */
multiline_comment|/* to be sure always set secbuf */
id|sec-&gt;secbuf
op_assign
id|sec-&gt;secbuf_base
op_plus
id|sec-&gt;secbufp
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|sec-&gt;secbufp
op_plus
l_int|2
OL
id|limit
suffix:semicolon
id|n
op_increment
)paren
(brace
id|seclen
op_assign
id|section_length
c_func
(paren
id|sec-&gt;secbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|seclen
op_le
l_int|0
op_logical_or
id|seclen
OG
id|DMX_MAX_SECFEED_SIZE
op_logical_or
id|seclen
op_plus
id|sec-&gt;secbufp
OG
id|limit
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|sec-&gt;seclen
op_assign
id|seclen
suffix:semicolon
id|sec-&gt;crc_val
op_assign
op_complement
l_int|0
suffix:semicolon
multiline_comment|/* dump [secbuf .. secbuf+seclen) */
id|dvb_dmx_swfilter_section_feed
c_func
(paren
id|feed
)paren
suffix:semicolon
id|sec-&gt;secbufp
op_add_assign
id|seclen
suffix:semicolon
multiline_comment|/* secbufp and secbuf moving together is */
id|sec-&gt;secbuf
op_add_assign
id|seclen
suffix:semicolon
multiline_comment|/* redundand but saves pointer arithmetic */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_section_packet
r_static
r_int
id|dvb_dmx_swfilter_section_packet
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_const
id|u8
op_star
id|buf
)paren
(brace
id|u8
id|p
comma
id|count
suffix:semicolon
r_int
id|ccok
suffix:semicolon
id|u8
id|cc
suffix:semicolon
id|count
op_assign
id|payload
c_func
(paren
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
multiline_comment|/* count == 0 if no payload or out of range */
r_return
op_minus
l_int|1
suffix:semicolon
id|p
op_assign
l_int|188
op_minus
id|count
suffix:semicolon
multiline_comment|/* payload start */
id|cc
op_assign
id|buf
(braket
l_int|3
)braket
op_amp
l_int|0x0f
suffix:semicolon
id|ccok
op_assign
(paren
(paren
id|feed-&gt;cc
op_plus
l_int|1
)paren
op_amp
l_int|0x0f
)paren
op_eq
id|cc
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|feed-&gt;cc
op_assign
id|cc
suffix:semicolon
r_if
c_cond
(paren
id|ccok
op_eq
l_int|0
)paren
(brace
macro_line|#ifdef DVB_DEMUX_SECTION_LOSS_LOG
id|printk
c_func
(paren
l_string|&quot;dvb_demux.c discontinuity detected %d bytes lost&bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
multiline_comment|/* those bytes under sume circumstances will again be reported&n;&t;&t;** in the following dvb_dmx_swfilter_section_new&n;&t;&t;*/
macro_line|#endif
id|dvb_dmx_swfilter_section_new
c_func
(paren
id|feed
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf
(braket
l_int|1
)braket
op_amp
l_int|0x40
)paren
(brace
singleline_comment|// PUSI=1 (is set), section boundary is here
r_if
c_cond
(paren
id|count
OG
l_int|1
op_logical_and
id|buf
(braket
id|p
)braket
OL
id|count
)paren
(brace
r_const
id|u8
op_star
id|before
op_assign
id|buf
op_plus
id|p
op_plus
l_int|1
suffix:semicolon
id|u8
id|before_len
op_assign
id|buf
(braket
id|p
)braket
suffix:semicolon
r_const
id|u8
op_star
id|after
op_assign
id|before
op_plus
id|before_len
suffix:semicolon
id|u8
id|after_len
op_assign
id|count
op_minus
l_int|1
op_minus
id|before_len
suffix:semicolon
id|dvb_dmx_swfilter_section_copy_dump
c_func
(paren
id|feed
comma
id|before
comma
id|before_len
)paren
suffix:semicolon
id|dvb_dmx_swfilter_section_new
c_func
(paren
id|feed
)paren
suffix:semicolon
id|dvb_dmx_swfilter_section_copy_dump
c_func
(paren
id|feed
comma
id|after
comma
id|after_len
)paren
suffix:semicolon
)brace
macro_line|#ifdef DVB_DEMUX_SECTION_LOSS_LOG
r_else
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb_demux.c PUSI=1 but %d bytes lost&bslash;n&quot;
comma
id|count
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_else
(brace
singleline_comment|// PUSI=0 (is not set), no section boundary
r_const
id|u8
op_star
id|entire
op_assign
id|buf
op_plus
id|p
suffix:semicolon
id|u8
id|entire_len
op_assign
id|count
suffix:semicolon
id|dvb_dmx_swfilter_section_copy_dump
c_func
(paren
id|feed
comma
id|entire
comma
id|entire_len
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_packet_type
r_static
r_inline
r_void
id|dvb_dmx_swfilter_packet_type
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_const
id|u8
op_star
id|buf
)paren
(brace
r_switch
c_cond
(paren
id|feed-&gt;type
)paren
(brace
r_case
id|DMX_TYPE_TS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|feed-&gt;feed.ts.is_filtering
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;ts_type
op_amp
id|TS_PACKET
)paren
(brace
r_if
c_cond
(paren
id|feed-&gt;ts_type
op_amp
id|TS_PAYLOAD_ONLY
)paren
id|dvb_dmx_swfilter_payload
c_func
(paren
id|feed
comma
id|buf
)paren
suffix:semicolon
r_else
id|feed-&gt;cb
dot
id|ts
c_func
(paren
id|buf
comma
l_int|188
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|feed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|feed-&gt;ts_type
op_amp
id|TS_DECODER
)paren
r_if
c_cond
(paren
id|feed-&gt;demux-&gt;write_to_decoder
)paren
id|feed-&gt;demux
op_member_access_from_pointer
id|write_to_decoder
c_func
(paren
id|feed
comma
id|buf
comma
l_int|188
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_TYPE_SEC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|feed-&gt;feed.sec.is_filtering
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dvb_dmx_swfilter_section_packet
c_func
(paren
id|feed
comma
id|buf
)paren
OL
l_int|0
)paren
id|feed-&gt;feed.sec.seclen
op_assign
id|feed-&gt;feed.sec.secbufp
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|macro|DVR_FEED
mdefine_line|#define DVR_FEED(f)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;(((f)-&gt;type == DMX_TYPE_TS) &amp;&amp;&t;&t;&t;&t;&t;&bslash;&n;&t;((f)-&gt;feed.ts.is_filtering) &amp;&amp;&t;&t;&t;&t;&t;&bslash;&n;&t;(((f)-&gt;ts_type &amp; (TS_PACKET|TS_PAYLOAD_ONLY)) == TS_PACKET))
DECL|function|dvb_dmx_swfilter_packet
r_void
id|dvb_dmx_swfilter_packet
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
comma
r_const
id|u8
op_star
id|buf
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|feed
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|head
op_assign
op_amp
id|demux-&gt;feed_list
suffix:semicolon
id|u16
id|pid
op_assign
id|ts_pid
c_func
(paren
id|buf
)paren
suffix:semicolon
r_int
id|dvr_done
op_assign
l_int|0
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
id|head
)paren
(brace
id|feed
op_assign
id|list_entry
c_func
(paren
id|pos
comma
r_struct
id|dvb_demux_feed
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|feed-&gt;pid
op_ne
id|pid
)paren
op_logical_and
(paren
id|feed-&gt;pid
op_ne
l_int|0x2000
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* copy each packet only once to the dvr device, even&n;&t;&t; * if a PID is in multiple filters (e.g. video + PCR) */
r_if
c_cond
(paren
(paren
id|DVR_FEED
c_func
(paren
id|feed
)paren
)paren
op_logical_and
(paren
id|dvr_done
op_increment
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;pid
op_eq
id|pid
)paren
(brace
id|dvb_dmx_swfilter_packet_type
(paren
id|feed
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DVR_FEED
c_func
(paren
id|feed
)paren
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|feed-&gt;pid
op_eq
l_int|0x2000
)paren
id|feed-&gt;cb
dot
id|ts
c_func
(paren
id|buf
comma
l_int|188
comma
l_int|NULL
comma
l_int|0
comma
op_amp
id|feed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
)brace
)brace
DECL|function|dvb_dmx_swfilter_packets
r_void
id|dvb_dmx_swfilter_packets
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
comma
r_const
id|u8
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
l_int|0
)braket
op_eq
l_int|0x47
)paren
(brace
id|dvb_dmx_swfilter_packet
c_func
(paren
id|demux
comma
id|buf
)paren
suffix:semicolon
)brace
id|buf
op_add_assign
l_int|188
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter
r_void
id|dvb_dmx_swfilter
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
comma
r_const
id|u8
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|p
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|demux-&gt;tsbufp
)paren
)paren
(brace
r_if
c_cond
(paren
id|count
OL
(paren
id|j
op_assign
l_int|188
op_minus
id|i
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|demux-&gt;tsbuf
(braket
id|i
)braket
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|demux-&gt;tsbufp
op_add_assign
id|count
suffix:semicolon
r_goto
id|bailout
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|demux-&gt;tsbuf
(braket
id|i
)braket
comma
id|buf
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
id|demux-&gt;tsbuf
(braket
l_int|0
)braket
op_eq
l_int|0x47
)paren
id|dvb_dmx_swfilter_packet
c_func
(paren
id|demux
comma
id|demux-&gt;tsbuf
)paren
suffix:semicolon
id|demux-&gt;tsbufp
op_assign
l_int|0
suffix:semicolon
id|p
op_add_assign
id|j
suffix:semicolon
)brace
r_while
c_loop
(paren
id|p
OL
id|count
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
id|p
)braket
op_eq
l_int|0x47
)paren
(brace
r_if
c_cond
(paren
id|count
op_minus
id|p
op_ge
l_int|188
)paren
(brace
id|dvb_dmx_swfilter_packet
c_func
(paren
id|demux
comma
id|buf
op_plus
id|p
)paren
suffix:semicolon
id|p
op_add_assign
l_int|188
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
id|count
op_minus
id|p
suffix:semicolon
id|memcpy
c_func
(paren
id|demux-&gt;tsbuf
comma
id|buf
op_plus
id|p
comma
id|i
)paren
suffix:semicolon
id|demux-&gt;tsbufp
op_assign
id|i
suffix:semicolon
r_goto
id|bailout
suffix:semicolon
)brace
)brace
r_else
id|p
op_increment
suffix:semicolon
)brace
id|bailout
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_swfilter_204
r_void
id|dvb_dmx_swfilter_204
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
comma
r_const
id|u8
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|p
op_assign
l_int|0
comma
id|i
comma
id|j
suffix:semicolon
id|u8
id|tmppack
(braket
l_int|188
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_assign
id|demux-&gt;tsbufp
)paren
)paren
(brace
r_if
c_cond
(paren
id|count
OL
(paren
id|j
op_assign
l_int|204
op_minus
id|i
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|demux-&gt;tsbuf
(braket
id|i
)braket
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|demux-&gt;tsbufp
op_add_assign
id|count
suffix:semicolon
r_goto
id|bailout
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|demux-&gt;tsbuf
(braket
id|i
)braket
comma
id|buf
comma
id|j
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|demux-&gt;tsbuf
(braket
l_int|0
)braket
op_eq
l_int|0x47
)paren
op_or
(paren
id|demux-&gt;tsbuf
(braket
l_int|0
)braket
op_eq
l_int|0xB8
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|tmppack
comma
id|demux-&gt;tsbuf
comma
l_int|188
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmppack
(braket
l_int|0
)braket
op_eq
l_int|0xB8
)paren
id|tmppack
(braket
l_int|0
)braket
op_assign
l_int|0x47
suffix:semicolon
id|dvb_dmx_swfilter_packet
c_func
(paren
id|demux
comma
id|tmppack
)paren
suffix:semicolon
)brace
id|demux-&gt;tsbufp
op_assign
l_int|0
suffix:semicolon
id|p
op_add_assign
id|j
suffix:semicolon
)brace
r_while
c_loop
(paren
id|p
OL
id|count
)paren
(brace
r_if
c_cond
(paren
(paren
id|buf
(braket
id|p
)braket
op_eq
l_int|0x47
)paren
op_or
(paren
id|buf
(braket
id|p
)braket
op_eq
l_int|0xB8
)paren
)paren
(brace
r_if
c_cond
(paren
id|count
op_minus
id|p
op_ge
l_int|204
)paren
(brace
id|memcpy
c_func
(paren
id|tmppack
comma
id|buf
op_plus
id|p
comma
l_int|188
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmppack
(braket
l_int|0
)braket
op_eq
l_int|0xB8
)paren
id|tmppack
(braket
l_int|0
)braket
op_assign
l_int|0x47
suffix:semicolon
id|dvb_dmx_swfilter_packet
c_func
(paren
id|demux
comma
id|tmppack
)paren
suffix:semicolon
id|p
op_add_assign
l_int|204
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
id|count
op_minus
id|p
suffix:semicolon
id|memcpy
c_func
(paren
id|demux-&gt;tsbuf
comma
id|buf
op_plus
id|p
comma
id|i
)paren
suffix:semicolon
id|demux-&gt;tsbufp
op_assign
id|i
suffix:semicolon
r_goto
id|bailout
suffix:semicolon
)brace
)brace
r_else
(brace
id|p
op_increment
suffix:semicolon
)brace
)brace
id|bailout
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmx_filter_alloc
r_static
r_struct
id|dvb_demux_filter
op_star
id|dvb_dmx_filter_alloc
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|demux-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|demux-&gt;filter
(braket
id|i
)braket
dot
id|state
op_eq
id|DMX_STATE_FREE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|demux-&gt;filternum
)paren
r_return
l_int|NULL
suffix:semicolon
id|demux-&gt;filter
(braket
id|i
)braket
dot
id|state
op_assign
id|DMX_STATE_ALLOCATED
suffix:semicolon
r_return
op_amp
id|demux-&gt;filter
(braket
id|i
)braket
suffix:semicolon
)brace
DECL|function|dvb_dmx_feed_alloc
r_static
r_struct
id|dvb_demux_feed
op_star
id|dvb_dmx_feed_alloc
c_func
(paren
r_struct
id|dvb_demux
op_star
id|demux
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|demux-&gt;feednum
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|demux-&gt;feed
(braket
id|i
)braket
dot
id|state
op_eq
id|DMX_STATE_FREE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|demux-&gt;feednum
)paren
r_return
l_int|NULL
suffix:semicolon
id|demux-&gt;feed
(braket
id|i
)braket
dot
id|state
op_assign
id|DMX_STATE_ALLOCATED
suffix:semicolon
r_return
op_amp
id|demux-&gt;feed
(braket
id|i
)braket
suffix:semicolon
)brace
DECL|function|dvb_demux_feed_find
r_static
r_int
id|dvb_demux_feed_find
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|entry
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|entry
comma
op_amp
id|feed-&gt;demux-&gt;feed_list
comma
id|list_head
)paren
r_if
c_cond
(paren
id|entry
op_eq
id|feed
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_demux_feed_add
r_static
r_void
id|dvb_demux_feed_add
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_if
c_cond
(paren
id|dvb_demux_feed_find
c_func
(paren
id|feed
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: feed already in list (type=%x state=%x pid=%x)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|feed-&gt;type
comma
id|feed-&gt;state
comma
id|feed-&gt;pid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|feed-&gt;list_head
comma
op_amp
id|feed-&gt;demux-&gt;feed_list
)paren
suffix:semicolon
)brace
DECL|function|dvb_demux_feed_del
r_static
r_void
id|dvb_demux_feed_del
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dvb_demux_feed_find
c_func
(paren
id|feed
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: feed not in list (type=%x state=%x pid=%x)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|feed-&gt;type
comma
id|feed-&gt;state
comma
id|feed-&gt;pid
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|feed-&gt;list_head
)paren
suffix:semicolon
)brace
DECL|function|dmx_ts_feed_set
r_static
r_int
id|dmx_ts_feed_set
(paren
r_struct
id|dmx_ts_feed
op_star
id|ts_feed
comma
id|u16
id|pid
comma
r_int
id|ts_type
comma
r_enum
id|dmx_ts_pes
id|pes_type
comma
r_int
id|callback_length
comma
r_int
id|circular_buffer_size
comma
r_int
id|descramble
comma
r_struct
id|timespec
id|timeout
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|feed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|ts_feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
id|DMX_MAX_PID
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|demux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|ts_type
op_amp
id|TS_DECODER
)paren
(brace
r_if
c_cond
(paren
id|pes_type
op_ge
id|DMX_TS_PES_OTHER
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|demux-&gt;pesfilter
(braket
id|pes_type
)braket
op_logical_and
id|demux-&gt;pesfilter
(braket
id|pes_type
)braket
op_ne
id|feed
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|demux-&gt;pesfilter
(braket
id|pes_type
)braket
op_assign
id|feed
suffix:semicolon
id|demux-&gt;pids
(braket
id|pes_type
)braket
op_assign
id|pid
suffix:semicolon
)brace
id|dvb_demux_feed_add
c_func
(paren
id|feed
)paren
suffix:semicolon
id|feed-&gt;pid
op_assign
id|pid
suffix:semicolon
id|feed-&gt;buffer_size
op_assign
id|circular_buffer_size
suffix:semicolon
id|feed-&gt;descramble
op_assign
id|descramble
suffix:semicolon
id|feed-&gt;timeout
op_assign
id|timeout
suffix:semicolon
id|feed-&gt;cb_length
op_assign
id|callback_length
suffix:semicolon
id|feed-&gt;ts_type
op_assign
id|ts_type
suffix:semicolon
id|feed-&gt;pes_type
op_assign
id|pes_type
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;descramble
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|feed-&gt;buffer_size
)paren
(brace
macro_line|#ifdef NOBUFS
id|feed-&gt;buffer
op_assign
l_int|NULL
suffix:semicolon
macro_line|#else
id|feed-&gt;buffer
op_assign
id|vmalloc
c_func
(paren
id|feed-&gt;buffer_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|feed-&gt;buffer
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif
)brace
id|feed-&gt;state
op_assign
id|DMX_STATE_READY
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmx_ts_feed_start_filtering
r_static
r_int
id|dmx_ts_feed_start_filtering
c_func
(paren
r_struct
id|dmx_ts_feed
op_star
id|ts_feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|feed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|ts_feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|demux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;state
op_ne
id|DMX_STATE_READY
op_logical_or
id|feed-&gt;type
op_ne
id|DMX_TYPE_TS
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|demux-&gt;start_feed
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|demux
op_member_access_from_pointer
id|start_feed
c_func
(paren
id|feed
)paren
)paren
OL
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
id|ts_feed-&gt;is_filtering
op_assign
l_int|1
suffix:semicolon
id|feed-&gt;state
op_assign
id|DMX_STATE_GO
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmx_ts_feed_stop_filtering
r_static
r_int
id|dmx_ts_feed_stop_filtering
c_func
(paren
r_struct
id|dmx_ts_feed
op_star
id|ts_feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|feed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|ts_feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|demux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;state
OL
id|DMX_STATE_GO
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|demux-&gt;stop_feed
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ret
op_assign
id|demux
op_member_access_from_pointer
id|stop_feed
c_func
(paren
id|feed
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
id|ts_feed-&gt;is_filtering
op_assign
l_int|0
suffix:semicolon
id|feed-&gt;state
op_assign
id|DMX_STATE_ALLOCATED
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|demux-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvbdmx_allocate_ts_feed
r_static
r_int
id|dvbdmx_allocate_ts_feed
(paren
r_struct
id|dmx_demux
op_star
id|dmx
comma
r_struct
id|dmx_ts_feed
op_star
op_star
id|ts_feed
comma
id|dmx_ts_cb
id|callback
)paren
(brace
r_struct
id|dvb_demux
op_star
id|demux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|dmx
suffix:semicolon
r_struct
id|dvb_demux_feed
op_star
id|feed
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|demux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|feed
op_assign
id|dvb_dmx_feed_alloc
c_func
(paren
id|demux
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|feed-&gt;type
op_assign
id|DMX_TYPE_TS
suffix:semicolon
id|feed-&gt;cb.ts
op_assign
id|callback
suffix:semicolon
id|feed-&gt;demux
op_assign
id|demux
suffix:semicolon
id|feed-&gt;pid
op_assign
l_int|0xffff
suffix:semicolon
id|feed-&gt;peslen
op_assign
l_int|0xfffa
suffix:semicolon
id|feed-&gt;buffer
op_assign
l_int|NULL
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_assign
op_amp
id|feed-&gt;feed.ts
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|parent
op_assign
id|dmx
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|priv
op_assign
l_int|NULL
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|is_filtering
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|start_filtering
op_assign
id|dmx_ts_feed_start_filtering
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|stop_filtering
op_assign
id|dmx_ts_feed_stop_filtering
suffix:semicolon
(paren
op_star
id|ts_feed
)paren
op_member_access_from_pointer
id|set
op_assign
id|dmx_ts_feed_set
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|feed-&gt;filter
op_assign
id|dvb_dmx_filter_alloc
c_func
(paren
id|demux
)paren
)paren
)paren
(brace
id|feed-&gt;state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|feed-&gt;filter-&gt;type
op_assign
id|DMX_TYPE_TS
suffix:semicolon
id|feed-&gt;filter-&gt;feed
op_assign
id|feed
suffix:semicolon
id|feed-&gt;filter-&gt;state
op_assign
id|DMX_STATE_READY
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_release_ts_feed
r_static
r_int
id|dvbdmx_release_ts_feed
c_func
(paren
r_struct
id|dmx_demux
op_star
id|dmx
comma
r_struct
id|dmx_ts_feed
op_star
id|ts_feed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|demux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|dmx
suffix:semicolon
r_struct
id|dvb_demux_feed
op_star
id|feed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|ts_feed
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|demux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;state
op_eq
id|DMX_STATE_FREE
)paren
(brace
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifndef NOBUFS
r_if
c_cond
(paren
id|feed-&gt;buffer
)paren
(brace
id|vfree
c_func
(paren
id|feed-&gt;buffer
)paren
suffix:semicolon
id|feed-&gt;buffer
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|feed-&gt;state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|feed-&gt;filter-&gt;state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|dvb_demux_feed_del
c_func
(paren
id|feed
)paren
suffix:semicolon
id|feed-&gt;pid
op_assign
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;ts_type
op_amp
id|TS_DECODER
)paren
id|demux-&gt;pesfilter
(braket
id|feed-&gt;pes_type
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|demux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * dmx_section_feed API calls&n; ******************************************************************************/
DECL|function|dmx_section_feed_allocate_filter
r_static
r_int
id|dmx_section_feed_allocate_filter
c_func
(paren
r_struct
id|dmx_section_feed
op_star
id|feed
comma
r_struct
id|dmx_section_filter
op_star
op_star
id|filter
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|dvb_demux_filter
op_star
id|dvbdmxfilter
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|dvbdmxfilter
op_assign
id|dvb_dmx_filter_alloc
c_func
(paren
id|dvbdemux
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdmxfilter
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|dvbdemux-&gt;lock
)paren
suffix:semicolon
op_star
id|filter
op_assign
op_amp
id|dvbdmxfilter-&gt;filter
suffix:semicolon
(paren
op_star
id|filter
)paren
op_member_access_from_pointer
id|parent
op_assign
id|feed
suffix:semicolon
(paren
op_star
id|filter
)paren
op_member_access_from_pointer
id|priv
op_assign
l_int|NULL
suffix:semicolon
id|dvbdmxfilter-&gt;feed
op_assign
id|dvbdmxfeed
suffix:semicolon
id|dvbdmxfilter-&gt;type
op_assign
id|DMX_TYPE_SEC
suffix:semicolon
id|dvbdmxfilter-&gt;state
op_assign
id|DMX_STATE_READY
suffix:semicolon
id|dvbdmxfilter-&gt;next
op_assign
id|dvbdmxfeed-&gt;filter
suffix:semicolon
id|dvbdmxfeed-&gt;filter
op_assign
id|dvbdmxfilter
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dvbdemux-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmx_section_feed_set
r_static
r_int
id|dmx_section_feed_set
c_func
(paren
r_struct
id|dmx_section_feed
op_star
id|feed
comma
id|u16
id|pid
comma
r_int
id|circular_buffer_size
comma
r_int
id|descramble
comma
r_int
id|check_crc
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0x1fff
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|dvb_demux_feed_add
c_func
(paren
id|dvbdmxfeed
)paren
suffix:semicolon
id|dvbdmxfeed-&gt;pid
op_assign
id|pid
suffix:semicolon
id|dvbdmxfeed-&gt;buffer_size
op_assign
id|circular_buffer_size
suffix:semicolon
id|dvbdmxfeed-&gt;descramble
op_assign
id|descramble
suffix:semicolon
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;descramble
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
id|dvbdmxfeed-&gt;feed.sec.check_crc
op_assign
id|check_crc
suffix:semicolon
macro_line|#ifdef NOBUFS
id|dvbdmxfeed-&gt;buffer
op_assign
l_int|NULL
suffix:semicolon
macro_line|#else
id|dvbdmxfeed-&gt;buffer
op_assign
id|vmalloc
c_func
(paren
id|dvbdmxfeed-&gt;buffer_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdmxfeed-&gt;buffer
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif
id|dvbdmxfeed-&gt;state
op_assign
id|DMX_STATE_READY
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prepare_secfilters
r_static
r_void
id|prepare_secfilters
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dvb_demux_filter
op_star
id|f
suffix:semicolon
r_struct
id|dmx_section_filter
op_star
id|sf
suffix:semicolon
id|u8
id|mask
comma
id|mode
comma
id|doneq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|f
op_assign
id|dvbdmxfeed-&gt;filter
)paren
)paren
r_return
suffix:semicolon
r_do
(brace
id|sf
op_assign
op_amp
id|f-&gt;filter
suffix:semicolon
id|doneq
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DVB_DEMUX_MASK_MAX
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mode
op_assign
id|sf-&gt;filter_mode
(braket
id|i
)braket
suffix:semicolon
id|mask
op_assign
id|sf-&gt;filter_mask
(braket
id|i
)braket
suffix:semicolon
id|f-&gt;maskandmode
(braket
id|i
)braket
op_assign
id|mask
op_amp
id|mode
suffix:semicolon
id|doneq
op_or_assign
id|f-&gt;maskandnotmode
(braket
id|i
)braket
op_assign
id|mask
op_amp
op_complement
id|mode
suffix:semicolon
)brace
id|f-&gt;doneq
op_assign
id|doneq
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|f
op_assign
id|f-&gt;next
)paren
)paren
suffix:semicolon
)brace
DECL|function|dmx_section_feed_start_filtering
r_static
r_int
id|dmx_section_feed_start_filtering
c_func
(paren
r_struct
id|dmx_section_feed
op_star
id|feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|feed-&gt;is_filtering
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dvbdmxfeed-&gt;filter
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dvbdmxfeed-&gt;feed.sec.tsfeedp
op_assign
l_int|0
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.secbuf
op_assign
id|dvbdmxfeed-&gt;feed.sec.secbuf_base
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.secbufp
op_assign
l_int|0
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.seclen
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdmx-&gt;start_feed
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|prepare_secfilters
c_func
(paren
id|dvbdmxfeed
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|dvbdmx
op_member_access_from_pointer
id|start_feed
c_func
(paren
id|dvbdmxfeed
)paren
)paren
OL
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|spin_lock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|feed-&gt;is_filtering
op_assign
l_int|1
suffix:semicolon
id|dvbdmxfeed-&gt;state
op_assign
id|DMX_STATE_GO
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dmx_section_feed_stop_filtering
r_static
r_int
id|dmx_section_feed_stop_filtering
c_func
(paren
r_struct
id|dmx_section_feed
op_star
id|feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdmx-&gt;stop_feed
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ret
op_assign
id|dvbdmx
op_member_access_from_pointer
id|stop_feed
c_func
(paren
id|dvbdmxfeed
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|dvbdmxfeed-&gt;state
op_assign
id|DMX_STATE_READY
suffix:semicolon
id|feed-&gt;is_filtering
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dmx_section_feed_release_filter
r_static
r_int
id|dmx_section_feed_release_filter
c_func
(paren
r_struct
id|dmx_section_feed
op_star
id|feed
comma
r_struct
id|dmx_section_filter
op_star
id|filter
)paren
(brace
r_struct
id|dvb_demux_filter
op_star
id|dvbdmxfilter
op_assign
(paren
r_struct
id|dvb_demux_filter
op_star
)paren
id|filter
comma
op_star
id|f
suffix:semicolon
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|dvbdmxfilter-&gt;feed
op_ne
id|dvbdmxfeed
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|feed-&gt;is_filtering
)paren
id|feed
op_member_access_from_pointer
id|stop_filtering
c_func
(paren
id|feed
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|f
op_assign
id|dvbdmxfeed-&gt;filter
suffix:semicolon
r_if
c_cond
(paren
id|f
op_eq
id|dvbdmxfilter
)paren
(brace
id|dvbdmxfeed-&gt;filter
op_assign
id|dvbdmxfilter-&gt;next
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|f-&gt;next
op_ne
id|dvbdmxfilter
)paren
(brace
id|f
op_assign
id|f-&gt;next
suffix:semicolon
)brace
id|f-&gt;next
op_assign
id|f-&gt;next-&gt;next
suffix:semicolon
)brace
id|dvbdmxfilter-&gt;state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dvbdmx-&gt;lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_allocate_section_feed
r_static
r_int
id|dvbdmx_allocate_section_feed
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_struct
id|dmx_section_feed
op_star
op_star
id|feed
comma
id|dmx_section_cb
id|callback
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dvbdmxfeed
op_assign
id|dvb_dmx_feed_alloc
c_func
(paren
id|dvbdmx
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|dvbdmxfeed-&gt;type
op_assign
id|DMX_TYPE_SEC
suffix:semicolon
id|dvbdmxfeed-&gt;cb.sec
op_assign
id|callback
suffix:semicolon
id|dvbdmxfeed-&gt;demux
op_assign
id|dvbdmx
suffix:semicolon
id|dvbdmxfeed-&gt;pid
op_assign
l_int|0xffff
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.secbuf
op_assign
id|dvbdmxfeed-&gt;feed.sec.secbuf_base
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.secbufp
op_assign
id|dvbdmxfeed-&gt;feed.sec.seclen
op_assign
l_int|0
suffix:semicolon
id|dvbdmxfeed-&gt;feed.sec.tsfeedp
op_assign
l_int|0
suffix:semicolon
id|dvbdmxfeed-&gt;filter
op_assign
l_int|NULL
suffix:semicolon
id|dvbdmxfeed-&gt;buffer
op_assign
l_int|NULL
suffix:semicolon
(paren
op_star
id|feed
)paren
op_assign
op_amp
id|dvbdmxfeed-&gt;feed.sec
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|is_filtering
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|parent
op_assign
id|demux
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|priv
op_assign
l_int|NULL
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|set
op_assign
id|dmx_section_feed_set
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|allocate_filter
op_assign
id|dmx_section_feed_allocate_filter
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|start_filtering
op_assign
id|dmx_section_feed_start_filtering
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|stop_filtering
op_assign
id|dmx_section_feed_stop_filtering
suffix:semicolon
(paren
op_star
id|feed
)paren
op_member_access_from_pointer
id|release_filter
op_assign
id|dmx_section_feed_release_filter
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_release_section_feed
r_static
r_int
id|dvbdmx_release_section_feed
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_struct
id|dmx_section_feed
op_star
id|feed
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|feed
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;state
op_eq
id|DMX_STATE_FREE
)paren
(brace
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifndef NOBUFS
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;buffer
)paren
(brace
id|vfree
c_func
(paren
id|dvbdmxfeed-&gt;buffer
)paren
suffix:semicolon
id|dvbdmxfeed-&gt;buffer
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|dvbdmxfeed-&gt;state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|dvb_demux_feed_del
c_func
(paren
id|dvbdmxfeed
)paren
suffix:semicolon
id|dvbdmxfeed-&gt;pid
op_assign
l_int|0xffff
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdmx-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * dvb_demux kernel data API calls&n; ******************************************************************************/
DECL|function|dvbdmx_open
r_static
r_int
id|dvbdmx_open
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|dvbdemux-&gt;users
op_ge
id|MAX_DVB_DEMUX_USERS
)paren
r_return
op_minus
id|EUSERS
suffix:semicolon
id|dvbdemux-&gt;users
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_close
r_static
r_int
id|dvbdmx_close
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|dvbdemux-&gt;users
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dvbdemux-&gt;users
op_decrement
suffix:semicolon
singleline_comment|//FIXME: release any unneeded resources if users==0
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_write
r_static
r_int
id|dvbdmx_write
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|demux-&gt;frontend
)paren
op_logical_or
(paren
id|demux-&gt;frontend-&gt;source
op_ne
id|DMX_MEMORY_FE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|dvb_dmx_swfilter
c_func
(paren
id|dvbdemux
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|dvbdmx_add_frontend
r_static
r_int
id|dvbdmx_add_frontend
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_struct
id|dmx_frontend
op_star
id|frontend
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_struct
id|list_head
op_star
id|head
op_assign
op_amp
id|dvbdemux-&gt;frontend_list
suffix:semicolon
id|list_add
c_func
(paren
op_amp
(paren
id|frontend-&gt;connectivity_list
)paren
comma
id|head
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_remove_frontend
r_static
r_int
id|dvbdmx_remove_frontend
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_struct
id|dmx_frontend
op_star
id|frontend
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
comma
op_star
id|n
comma
op_star
id|head
op_assign
op_amp
id|dvbdemux-&gt;frontend_list
suffix:semicolon
id|list_for_each_safe
(paren
id|pos
comma
id|n
comma
id|head
)paren
(brace
r_if
c_cond
(paren
id|DMX_FE_ENTRY
c_func
(paren
id|pos
)paren
op_eq
id|frontend
)paren
(brace
id|list_del
c_func
(paren
id|pos
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|dvbdmx_get_frontends
r_static
r_struct
id|list_head
op_star
id|dvbdmx_get_frontends
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|dvbdemux-&gt;frontend_list
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
op_amp
id|dvbdemux-&gt;frontend_list
suffix:semicolon
)brace
DECL|function|dvbdmx_connect_frontend
r_int
id|dvbdmx_connect_frontend
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_struct
id|dmx_frontend
op_star
id|frontend
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|demux-&gt;frontend
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|demux-&gt;frontend
op_assign
id|frontend
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_disconnect_frontend
r_int
id|dvbdmx_disconnect_frontend
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|demux-&gt;frontend
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvbdmx_get_pes_pids
r_static
r_int
id|dvbdmx_get_pes_pids
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
id|u16
op_star
id|pids
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdemux
op_assign
(paren
r_struct
id|dvb_demux
op_star
)paren
id|demux
suffix:semicolon
id|memcpy
c_func
(paren
id|pids
comma
id|dvbdemux-&gt;pids
comma
l_int|5
op_star
r_sizeof
(paren
id|u16
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmx_init
r_int
id|dvb_dmx_init
c_func
(paren
r_struct
id|dvb_demux
op_star
id|dvbdemux
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_struct
id|dmx_demux
op_star
id|dmx
op_assign
op_amp
id|dvbdemux-&gt;dmx
suffix:semicolon
id|dvbdemux-&gt;users
op_assign
l_int|0
suffix:semicolon
id|dvbdemux-&gt;filter
op_assign
id|vmalloc
c_func
(paren
id|dvbdemux-&gt;filternum
op_star
r_sizeof
(paren
r_struct
id|dvb_demux_filter
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdemux-&gt;filter
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dvbdemux-&gt;feed
op_assign
id|vmalloc
c_func
(paren
id|dvbdemux-&gt;feednum
op_star
r_sizeof
(paren
r_struct
id|dvb_demux_feed
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdemux-&gt;feed
)paren
(brace
id|vfree
c_func
(paren
id|dvbdemux-&gt;filter
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dvbdemux-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dvbdemux-&gt;filter
(braket
id|i
)braket
dot
id|state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|dvbdemux-&gt;filter
(braket
id|i
)braket
dot
id|index
op_assign
id|i
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dvbdemux-&gt;feednum
suffix:semicolon
id|i
op_increment
)paren
id|dvbdemux-&gt;feed
(braket
id|i
)braket
dot
id|state
op_assign
id|DMX_STATE_FREE
suffix:semicolon
id|dvbdemux-&gt;frontend_list.next
op_assign
id|dvbdemux-&gt;frontend_list.prev
op_assign
op_amp
id|dvbdemux-&gt;frontend_list
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DMX_TS_PES_OTHER
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dvbdemux-&gt;pesfilter
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dvbdemux-&gt;pids
(braket
id|i
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|dvbdemux-&gt;feed_list
)paren
suffix:semicolon
id|dvbdemux-&gt;playing
op_assign
l_int|0
suffix:semicolon
id|dvbdemux-&gt;recording
op_assign
l_int|0
suffix:semicolon
id|dvbdemux-&gt;tsbufp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdemux-&gt;check_crc32
)paren
id|dvbdemux-&gt;check_crc32
op_assign
id|dvb_dmx_crc32
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dvbdemux-&gt;memcopy
)paren
id|dvbdemux-&gt;memcopy
op_assign
id|dvb_dmx_memcopy
suffix:semicolon
id|dmx-&gt;frontend
op_assign
l_int|NULL
suffix:semicolon
id|dmx-&gt;reg_list.prev
op_assign
id|dmx-&gt;reg_list.next
op_assign
op_amp
id|dmx-&gt;reg_list
suffix:semicolon
id|dmx-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|dvbdemux
suffix:semicolon
id|dmx-&gt;open
op_assign
id|dvbdmx_open
suffix:semicolon
id|dmx-&gt;close
op_assign
id|dvbdmx_close
suffix:semicolon
id|dmx-&gt;write
op_assign
id|dvbdmx_write
suffix:semicolon
id|dmx-&gt;allocate_ts_feed
op_assign
id|dvbdmx_allocate_ts_feed
suffix:semicolon
id|dmx-&gt;release_ts_feed
op_assign
id|dvbdmx_release_ts_feed
suffix:semicolon
id|dmx-&gt;allocate_section_feed
op_assign
id|dvbdmx_allocate_section_feed
suffix:semicolon
id|dmx-&gt;release_section_feed
op_assign
id|dvbdmx_release_section_feed
suffix:semicolon
id|dmx-&gt;descramble_mac_address
op_assign
l_int|NULL
suffix:semicolon
id|dmx-&gt;descramble_section_payload
op_assign
l_int|NULL
suffix:semicolon
id|dmx-&gt;add_frontend
op_assign
id|dvbdmx_add_frontend
suffix:semicolon
id|dmx-&gt;remove_frontend
op_assign
id|dvbdmx_remove_frontend
suffix:semicolon
id|dmx-&gt;get_frontends
op_assign
id|dvbdmx_get_frontends
suffix:semicolon
id|dmx-&gt;connect_frontend
op_assign
id|dvbdmx_connect_frontend
suffix:semicolon
id|dmx-&gt;disconnect_frontend
op_assign
id|dvbdmx_disconnect_frontend
suffix:semicolon
id|dmx-&gt;get_pes_pids
op_assign
id|dvbdmx_get_pes_pids
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|dvbdemux-&gt;mutex
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dvbdemux-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dmx_register_demux
c_func
(paren
id|dmx
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmx_release
r_int
id|dvb_dmx_release
c_func
(paren
r_struct
id|dvb_demux
op_star
id|dvbdemux
)paren
(brace
r_struct
id|dmx_demux
op_star
id|dmx
op_assign
op_amp
id|dvbdemux-&gt;dmx
suffix:semicolon
id|dmx_unregister_demux
c_func
(paren
id|dmx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dvbdemux-&gt;filter
)paren
id|vfree
c_func
(paren
id|dvbdemux-&gt;filter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dvbdemux-&gt;feed
)paren
id|vfree
c_func
(paren
id|dvbdemux-&gt;feed
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
