multiline_comment|/* &n; * dmxdev.c - DVB demultiplexer device &n; *&n; * Copyright (C) 2000 Ralph  Metzler &lt;ralph@convergence.de&gt;&n; *&t;&t;  &amp; Marcus Metzler &lt;marcus@convergence.de&gt;&n;&t;&t;      for convergence integrated media GmbH&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU Lesser General Public License&n; * as published by the Free Software Foundation; either version 2.1&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU Lesser General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; *&n; */
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/ioctl.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &quot;dmxdev.h&quot;
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;Turn on/off debugging (default:off).&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk&t;if (debug) printk
r_static
r_inline
r_struct
id|dmxdev_filter
op_star
DECL|function|dvb_dmxdev_file_to_filter
id|dvb_dmxdev_file_to_filter
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
(paren
r_struct
id|dmxdev_filter
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_buffer_init
r_static
r_inline
r_void
id|dvb_dmxdev_buffer_init
c_func
(paren
r_struct
id|dmxdev_buffer
op_star
id|buffer
)paren
(brace
id|buffer-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|buffer-&gt;size
op_assign
l_int|8192
suffix:semicolon
id|buffer-&gt;pread
op_assign
l_int|0
suffix:semicolon
id|buffer-&gt;pwrite
op_assign
l_int|0
suffix:semicolon
id|buffer-&gt;error
op_assign
l_int|0
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|buffer-&gt;queue
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_buffer_write
r_static
r_inline
r_int
id|dvb_dmxdev_buffer_write
c_func
(paren
r_struct
id|dmxdev_buffer
op_star
id|buf
comma
r_const
id|u8
op_star
id|src
comma
r_int
id|len
)paren
(brace
r_int
id|split
suffix:semicolon
r_int
id|free
suffix:semicolon
r_int
id|todo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf-&gt;data
)paren
r_return
l_int|0
suffix:semicolon
id|free
op_assign
id|buf-&gt;pread
op_minus
id|buf-&gt;pwrite
suffix:semicolon
id|split
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|free
op_le
l_int|0
)paren
(brace
id|free
op_add_assign
id|buf-&gt;size
suffix:semicolon
id|split
op_assign
id|buf-&gt;size
op_minus
id|buf-&gt;pwrite
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ge
id|free
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;dmxdev: buffer overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|split
op_ge
id|len
)paren
id|split
op_assign
l_int|0
suffix:semicolon
id|todo
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|split
)paren
(brace
id|memcpy
c_func
(paren
id|buf-&gt;data
op_plus
id|buf-&gt;pwrite
comma
id|src
comma
id|split
)paren
suffix:semicolon
id|todo
op_sub_assign
id|split
suffix:semicolon
id|buf-&gt;pwrite
op_assign
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|buf-&gt;data
op_plus
id|buf-&gt;pwrite
comma
id|src
op_plus
id|split
comma
id|todo
)paren
suffix:semicolon
id|buf-&gt;pwrite
op_assign
(paren
id|buf-&gt;pwrite
op_plus
id|todo
)paren
op_mod
id|buf-&gt;size
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_buffer_read
r_static
id|ssize_t
id|dvb_dmxdev_buffer_read
c_func
(paren
r_struct
id|dmxdev_buffer
op_star
id|src
comma
r_int
id|non_blocking
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
r_int
id|todo
op_assign
id|count
suffix:semicolon
r_int
id|split
comma
id|avail
comma
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src-&gt;data
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|src-&gt;error
)paren
)paren
(brace
id|src-&gt;pwrite
op_assign
id|src-&gt;pread
suffix:semicolon
id|src-&gt;error
op_assign
l_int|0
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|non_blocking
op_logical_and
(paren
id|src-&gt;pwrite
op_eq
id|src-&gt;pread
)paren
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|non_blocking
op_logical_and
(paren
id|src-&gt;pwrite
op_eq
id|src-&gt;pread
)paren
)paren
r_return
(paren
id|count
op_minus
id|todo
)paren
ques
c_cond
(paren
id|count
op_minus
id|todo
)paren
suffix:colon
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|src-&gt;queue
comma
(paren
id|src-&gt;pread
op_ne
id|src-&gt;pwrite
)paren
op_logical_or
(paren
id|src-&gt;error
)paren
)paren
OL
l_int|0
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|src-&gt;error
)paren
)paren
(brace
id|src-&gt;pwrite
op_assign
id|src-&gt;pread
suffix:semicolon
id|src-&gt;error
op_assign
l_int|0
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|split
op_assign
id|src-&gt;size
suffix:semicolon
id|avail
op_assign
id|src-&gt;pwrite
op_minus
id|src-&gt;pread
suffix:semicolon
r_if
c_cond
(paren
id|avail
OL
l_int|0
)paren
(brace
id|avail
op_add_assign
id|src-&gt;size
suffix:semicolon
id|split
op_assign
id|src-&gt;size
op_minus
id|src-&gt;pread
suffix:semicolon
)brace
r_if
c_cond
(paren
id|avail
OG
id|todo
)paren
id|avail
op_assign
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|split
OL
id|avail
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|src-&gt;data
op_plus
id|src-&gt;pread
comma
id|split
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|buf
op_add_assign
id|split
suffix:semicolon
id|src-&gt;pread
op_assign
l_int|0
suffix:semicolon
id|todo
op_sub_assign
id|split
suffix:semicolon
id|avail
op_sub_assign
id|split
suffix:semicolon
)brace
r_if
c_cond
(paren
id|avail
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|src-&gt;data
op_plus
id|src-&gt;pread
comma
id|avail
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|src-&gt;pread
op_assign
(paren
id|src-&gt;pread
op_plus
id|avail
)paren
op_mod
id|src-&gt;size
suffix:semicolon
id|todo
op_sub_assign
id|avail
suffix:semicolon
id|buf
op_add_assign
id|avail
suffix:semicolon
)brace
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|get_fe
r_static
r_struct
id|dmx_frontend
op_star
id|get_fe
c_func
(paren
r_struct
id|dmx_demux
op_star
id|demux
comma
r_int
id|type
)paren
(brace
r_struct
id|list_head
op_star
id|head
comma
op_star
id|pos
suffix:semicolon
id|head
op_assign
id|demux
op_member_access_from_pointer
id|get_frontends
c_func
(paren
id|demux
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|head
)paren
r_return
l_int|NULL
suffix:semicolon
id|list_for_each
c_func
(paren
id|pos
comma
id|head
)paren
r_if
c_cond
(paren
id|DMX_FE_ENTRY
c_func
(paren
id|pos
)paren
op_member_access_from_pointer
id|source
op_eq
id|type
)paren
r_return
id|DMX_FE_ENTRY
c_func
(paren
id|pos
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_dvr_state_set
r_static
r_inline
r_void
id|dvb_dmxdev_dvr_state_set
c_func
(paren
r_struct
id|dmxdev_dvr
op_star
id|dmxdevdvr
comma
r_int
id|state
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdevdvr-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|dmxdevdvr-&gt;state
op_assign
id|state
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdevdvr-&gt;dev-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|dvb_dvr_open
r_static
r_int
id|dvb_dvr_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_struct
id|dmx_frontend
op_star
id|front
suffix:semicolon
id|dprintk
(paren
l_string|&quot;function : %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDWR
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dmxdev-&gt;capabilities
op_amp
id|DMXDEV_CAP_DUPLEX
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
(brace
id|dvb_dmxdev_buffer_init
c_func
(paren
op_amp
id|dmxdev-&gt;dvr_buffer
)paren
suffix:semicolon
id|dmxdev-&gt;dvr_buffer.size
op_assign
id|DVR_BUFFER_SIZE
suffix:semicolon
id|dmxdev-&gt;dvr_buffer.data
op_assign
id|vmalloc
c_func
(paren
id|DVR_BUFFER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;dvr_buffer.data
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_WRONLY
)paren
(brace
id|dmxdev-&gt;dvr_orig_fe
op_assign
id|dmxdev-&gt;demux-&gt;frontend
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;demux-&gt;write
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|front
op_assign
id|get_fe
c_func
(paren
id|dmxdev-&gt;demux
comma
id|DMX_MEMORY_FE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|front
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|disconnect_frontend
c_func
(paren
id|dmxdev-&gt;demux
)paren
suffix:semicolon
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|connect_frontend
c_func
(paren
id|dmxdev-&gt;demux
comma
id|front
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dvr_release
r_static
r_int
id|dvb_dvr_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_WRONLY
)paren
(brace
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|disconnect_frontend
c_func
(paren
id|dmxdev-&gt;demux
)paren
suffix:semicolon
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|connect_frontend
c_func
(paren
id|dmxdev-&gt;demux
comma
id|dmxdev-&gt;dvr_orig_fe
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
(brace
r_if
c_cond
(paren
id|dmxdev-&gt;dvr_buffer.data
)paren
(brace
r_void
op_star
id|mem
op_assign
id|dmxdev-&gt;dvr_buffer.data
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdev-&gt;lock
)paren
suffix:semicolon
id|dmxdev-&gt;dvr_buffer.data
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdev-&gt;lock
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dvr_write
r_static
id|ssize_t
id|dvb_dvr_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;demux-&gt;write
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_WRONLY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|ret
op_assign
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|write
c_func
(paren
id|dmxdev-&gt;demux
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_dvr_read
r_static
id|ssize_t
id|dvb_dvr_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
singleline_comment|//down(&amp;dmxdev-&gt;mutex);
id|ret
op_assign
id|dvb_dmxdev_buffer_read
c_func
(paren
op_amp
id|dmxdev-&gt;dvr_buffer
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
singleline_comment|//up(&amp;dmxdev-&gt;mutex);
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_state_set
r_static
r_inline
r_void
id|dvb_dmxdev_filter_state_set
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
comma
r_int
id|state
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|dmxdevfilter-&gt;state
op_assign
id|state
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_set_buffer_size
r_static
r_int
id|dvb_dmxdev_set_buffer_size
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|dmxdev_buffer
op_star
id|buf
op_assign
op_amp
id|dmxdevfilter-&gt;buffer
suffix:semicolon
r_void
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;size
op_eq
id|size
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
op_ge
id|DMXDEV_STATE_GO
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|mem
op_assign
id|buf-&gt;data
suffix:semicolon
id|buf-&gt;data
op_assign
l_int|NULL
suffix:semicolon
id|buf-&gt;size
op_assign
id|size
suffix:semicolon
id|buf-&gt;pwrite
op_assign
id|buf-&gt;pread
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;size
)paren
(brace
id|mem
op_assign
id|vmalloc
c_func
(paren
id|dmxdevfilter-&gt;buffer.size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|buf-&gt;data
op_assign
id|mem
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_timeout
r_static
r_void
id|dvb_dmxdev_filter_timeout
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
(paren
r_struct
id|dmxdev_filter
op_star
)paren
id|data
suffix:semicolon
id|dmxdevfilter-&gt;buffer.error
op_assign
op_minus
id|ETIMEDOUT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|dmxdevfilter-&gt;state
op_assign
id|DMXDEV_STATE_TIMEDOUT
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer.queue
)paren
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_timer
r_static
r_void
id|dvb_dmxdev_filter_timer
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
)paren
(brace
r_struct
id|dmx_sct_filter_params
op_star
id|para
op_assign
op_amp
id|dmxdevfilter-&gt;params.sec
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|dmxdevfilter-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|para-&gt;timeout
)paren
(brace
id|dmxdevfilter-&gt;timer.function
op_assign
id|dvb_dmxdev_filter_timeout
suffix:semicolon
id|dmxdevfilter-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|dmxdevfilter
suffix:semicolon
id|dmxdevfilter-&gt;timer.expires
op_assign
id|jiffies
op_plus
l_int|1
op_plus
(paren
id|HZ
op_div
l_int|2
op_plus
id|HZ
op_star
id|para-&gt;timeout
)paren
op_div
l_int|1000
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|dmxdevfilter-&gt;timer
)paren
suffix:semicolon
)brace
)brace
DECL|function|dvb_dmxdev_section_callback
r_static
r_int
id|dvb_dmxdev_section_callback
c_func
(paren
r_const
id|u8
op_star
id|buffer1
comma
r_int
id|buffer1_len
comma
r_const
id|u8
op_star
id|buffer2
comma
r_int
id|buffer2_len
comma
r_struct
id|dmx_section_filter
op_star
id|filter
comma
r_enum
id|dmx_success
id|success
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
(paren
r_struct
id|dmxdev_filter
op_star
)paren
id|filter-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;buffer.error
)paren
(brace
id|wake_up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer.queue
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
op_ne
id|DMXDEV_STATE_GO
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|del_timer
c_func
(paren
op_amp
id|dmxdevfilter-&gt;timer
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;dmxdev: section callback %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|buffer1
(braket
l_int|0
)braket
comma
id|buffer1
(braket
l_int|1
)braket
comma
id|buffer1
(braket
l_int|2
)braket
comma
id|buffer1
(braket
l_int|3
)braket
comma
id|buffer1
(braket
l_int|4
)braket
comma
id|buffer1
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|ret
op_assign
id|dvb_dmxdev_buffer_write
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer
comma
id|buffer1
comma
id|buffer1_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|buffer1_len
)paren
(brace
id|ret
op_assign
id|dvb_dmxdev_buffer_write
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer
comma
id|buffer2
comma
id|buffer2_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|dmxdevfilter-&gt;buffer.pwrite
op_assign
id|dmxdevfilter-&gt;buffer.pread
suffix:semicolon
id|dmxdevfilter-&gt;buffer.error
op_assign
op_minus
id|EOVERFLOW
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;params.sec.flags
op_amp
id|DMX_ONESHOT
)paren
id|dmxdevfilter-&gt;state
op_assign
id|DMXDEV_STATE_DONE
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer.queue
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_ts_callback
r_static
r_int
id|dvb_dmxdev_ts_callback
c_func
(paren
r_const
id|u8
op_star
id|buffer1
comma
r_int
id|buffer1_len
comma
r_const
id|u8
op_star
id|buffer2
comma
r_int
id|buffer2_len
comma
r_struct
id|dmx_ts_feed
op_star
id|feed
comma
r_enum
id|dmx_success
id|success
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
(paren
r_struct
id|dmxdev_filter
op_star
)paren
id|feed-&gt;priv
suffix:semicolon
r_struct
id|dmxdev_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;params.pes.output
op_eq
id|DMX_OUT_DECODER
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;params.pes.output
op_eq
id|DMX_OUT_TAP
)paren
id|buffer
op_assign
op_amp
id|dmxdevfilter-&gt;buffer
suffix:semicolon
r_else
id|buffer
op_assign
op_amp
id|dmxdevfilter-&gt;dev-&gt;dvr_buffer
suffix:semicolon
r_if
c_cond
(paren
id|buffer-&gt;error
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|buffer-&gt;queue
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ret
op_assign
id|dvb_dmxdev_buffer_write
c_func
(paren
id|buffer
comma
id|buffer1
comma
id|buffer1_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
id|buffer1_len
)paren
id|ret
op_assign
id|dvb_dmxdev_buffer_write
c_func
(paren
id|buffer
comma
id|buffer2
comma
id|buffer2_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|buffer-&gt;pwrite
op_assign
id|buffer-&gt;pread
suffix:semicolon
id|buffer-&gt;error
op_assign
op_minus
id|EOVERFLOW
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|dmxdevfilter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|buffer-&gt;queue
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* stop feed but only mark the specified filter as stopped (state set) */
DECL|function|dvb_dmxdev_feed_stop
r_static
r_int
id|dvb_dmxdev_feed_stop
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
)paren
(brace
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_SET
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dmxdevfilter-&gt;type
)paren
(brace
r_case
id|DMXDEV_TYPE_SEC
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|dmxdevfilter-&gt;timer
)paren
suffix:semicolon
id|dmxdevfilter-&gt;feed.sec
op_member_access_from_pointer
id|stop_filtering
c_func
(paren
id|dmxdevfilter-&gt;feed.sec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMXDEV_TYPE_PES
suffix:colon
id|dmxdevfilter-&gt;feed.ts
op_member_access_from_pointer
id|stop_filtering
c_func
(paren
id|dmxdevfilter-&gt;feed.ts
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* start feed associated with the specified filter */
DECL|function|dvb_dmxdev_feed_start
r_static
r_int
id|dvb_dmxdev_feed_start
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|filter
)paren
(brace
id|dvb_dmxdev_filter_state_set
(paren
id|filter
comma
id|DMXDEV_STATE_GO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|filter-&gt;type
)paren
(brace
r_case
id|DMXDEV_TYPE_SEC
suffix:colon
r_return
id|filter-&gt;feed.sec
op_member_access_from_pointer
id|start_filtering
c_func
(paren
id|filter-&gt;feed.sec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMXDEV_TYPE_PES
suffix:colon
r_return
id|filter-&gt;feed.ts
op_member_access_from_pointer
id|start_filtering
c_func
(paren
id|filter-&gt;feed.ts
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* restart section feed if it has filters left associated with it, &n;   otherwise release the feed */
DECL|function|dvb_dmxdev_feed_restart
r_static
r_int
id|dvb_dmxdev_feed_restart
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|filter
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
id|filter-&gt;dev
suffix:semicolon
id|u16
id|pid
op_assign
id|filter-&gt;params.sec.pid
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dmxdev-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|state
op_ge
id|DMXDEV_STATE_GO
op_logical_and
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|type
op_eq
id|DMXDEV_TYPE_SEC
op_logical_and
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|pid
op_eq
id|pid
)paren
(brace
id|dvb_dmxdev_feed_start
c_func
(paren
op_amp
id|dmxdev-&gt;filter
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|filter-&gt;dev-&gt;demux
op_member_access_from_pointer
id|release_section_feed
c_func
(paren
id|dmxdev-&gt;demux
comma
id|filter-&gt;feed.sec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_stop
r_static
r_int
id|dvb_dmxdev_filter_stop
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
)paren
(brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
OL
id|DMXDEV_STATE_GO
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dmxdevfilter-&gt;type
)paren
(brace
r_case
id|DMXDEV_TYPE_SEC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|dmxdevfilter-&gt;feed.sec
)paren
r_break
suffix:semicolon
id|dvb_dmxdev_feed_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;filter.sec
)paren
id|dmxdevfilter-&gt;feed.sec
op_member_access_from_pointer
id|release_filter
c_func
(paren
id|dmxdevfilter-&gt;feed.sec
comma
id|dmxdevfilter-&gt;filter.sec
)paren
suffix:semicolon
id|dvb_dmxdev_feed_restart
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|dmxdevfilter-&gt;feed.sec
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMXDEV_TYPE_PES
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|dmxdevfilter-&gt;feed.ts
)paren
r_break
suffix:semicolon
id|dvb_dmxdev_feed_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|dmxdevfilter-&gt;dev-&gt;demux
op_member_access_from_pointer
id|release_ts_feed
c_func
(paren
id|dmxdevfilter-&gt;dev-&gt;demux
comma
id|dmxdevfilter-&gt;feed.ts
)paren
suffix:semicolon
id|dmxdevfilter-&gt;feed.ts
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
op_eq
id|DMXDEV_STATE_ALLOCATED
)paren
r_return
l_int|0
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dmxdevfilter-&gt;buffer.pwrite
op_assign
id|dmxdevfilter-&gt;buffer.pread
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_reset
r_static
r_inline
r_int
id|dvb_dmxdev_filter_reset
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
)paren
(brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
OL
id|DMXDEV_STATE_SET
)paren
r_return
l_int|0
suffix:semicolon
id|dmxdevfilter-&gt;type
op_assign
id|DMXDEV_TYPE_NONE
suffix:semicolon
id|dmxdevfilter-&gt;pid
op_assign
l_int|0xffff
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_ALLOCATED
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_start
r_static
r_int
id|dvb_dmxdev_filter_start
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|filter
)paren
(brace
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
id|filter-&gt;dev
suffix:semicolon
r_void
op_star
id|mem
suffix:semicolon
r_int
id|ret
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|filter-&gt;state
OL
id|DMXDEV_STATE_SET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|filter-&gt;state
op_ge
id|DMXDEV_STATE_GO
)paren
id|dvb_dmxdev_filter_stop
c_func
(paren
id|filter
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mem
op_assign
id|filter-&gt;buffer.data
)paren
)paren
(brace
id|mem
op_assign
id|vmalloc
c_func
(paren
id|filter-&gt;buffer.size
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|filter-&gt;dev-&gt;lock
)paren
suffix:semicolon
id|filter-&gt;buffer.data
op_assign
id|mem
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|filter-&gt;dev-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filter-&gt;buffer.data
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|filter-&gt;buffer.pwrite
op_assign
id|filter-&gt;buffer.pread
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|filter-&gt;type
)paren
(brace
r_case
id|DMXDEV_TYPE_SEC
suffix:colon
(brace
r_struct
id|dmx_sct_filter_params
op_star
id|para
op_assign
op_amp
id|filter-&gt;params.sec
suffix:semicolon
r_struct
id|dmx_section_filter
op_star
op_star
id|secfilter
op_assign
op_amp
id|filter-&gt;filter.sec
suffix:semicolon
r_struct
id|dmx_section_feed
op_star
op_star
id|secfeed
op_assign
op_amp
id|filter-&gt;feed.sec
suffix:semicolon
op_star
id|secfilter
op_assign
l_int|NULL
suffix:semicolon
op_star
id|secfeed
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* find active filter/feed with same PID */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dmxdev-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|state
op_ge
id|DMXDEV_STATE_GO
op_logical_and
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|pid
op_eq
id|para-&gt;pid
op_logical_and
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|type
op_eq
id|DMXDEV_TYPE_SEC
)paren
(brace
op_star
id|secfeed
op_assign
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|feed.sec
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* if no feed found, try to allocate new one */
r_if
c_cond
(paren
op_logical_neg
op_star
id|secfeed
)paren
(brace
id|ret
op_assign
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|allocate_section_feed
c_func
(paren
id|dmxdev-&gt;demux
comma
id|secfeed
comma
id|dvb_dmxdev_section_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;DVB (%s): could not alloc feed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
(paren
op_star
id|secfeed
)paren
op_member_access_from_pointer
id|set
c_func
(paren
op_star
id|secfeed
comma
id|para-&gt;pid
comma
l_int|32768
comma
l_int|0
comma
(paren
id|para-&gt;flags
op_amp
id|DMX_CHECK_CRC
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
(paren
l_string|&quot;DVB (%s): could not set feed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dvb_dmxdev_feed_restart
c_func
(paren
id|filter
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_else
(brace
id|dvb_dmxdev_feed_stop
c_func
(paren
id|filter
)paren
suffix:semicolon
)brace
id|ret
op_assign
(paren
op_star
id|secfeed
)paren
op_member_access_from_pointer
id|allocate_filter
c_func
(paren
op_star
id|secfeed
comma
id|secfilter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|dvb_dmxdev_feed_restart
c_func
(paren
id|filter
)paren
suffix:semicolon
id|filter-&gt;feed.sec
op_member_access_from_pointer
id|start_filtering
c_func
(paren
op_star
id|secfeed
)paren
suffix:semicolon
id|dprintk
(paren
l_string|&quot;could not get filter&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|priv
op_assign
id|filter
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_value
(braket
l_int|3
)braket
)paren
comma
op_amp
(paren
id|para-&gt;filter.filter
(braket
l_int|1
)braket
)paren
comma
id|DMX_FILTER_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mask
(braket
l_int|3
)braket
comma
op_amp
id|para-&gt;filter.mask
(braket
l_int|1
)braket
comma
id|DMX_FILTER_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mode
(braket
l_int|3
)braket
comma
op_amp
id|para-&gt;filter.mode
(braket
l_int|1
)braket
comma
id|DMX_FILTER_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_value
(braket
l_int|0
)braket
op_assign
id|para-&gt;filter.filter
(braket
l_int|0
)braket
suffix:semicolon
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mask
(braket
l_int|0
)braket
op_assign
id|para-&gt;filter.mask
(braket
l_int|0
)braket
suffix:semicolon
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mode
(braket
l_int|0
)braket
op_assign
id|para-&gt;filter.mode
(braket
l_int|0
)braket
suffix:semicolon
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mask
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
(paren
op_star
id|secfilter
)paren
op_member_access_from_pointer
id|filter_mask
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|filter-&gt;todo
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|filter-&gt;feed.sec-&gt;start_filtering
(paren
id|filter-&gt;feed.sec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|dvb_dmxdev_filter_timer
c_func
(paren
id|filter
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|DMXDEV_TYPE_PES
suffix:colon
(brace
r_struct
id|timespec
id|timeout
op_assign
(brace
l_int|0
)brace
suffix:semicolon
r_struct
id|dmx_pes_filter_params
op_star
id|para
op_assign
op_amp
id|filter-&gt;params.pes
suffix:semicolon
id|dmx_output_t
id|otype
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_int
id|ts_type
suffix:semicolon
r_enum
id|dmx_ts_pes
id|ts_pes
suffix:semicolon
r_struct
id|dmx_ts_feed
op_star
op_star
id|tsfeed
op_assign
op_amp
id|filter-&gt;feed.ts
suffix:semicolon
id|filter-&gt;feed.ts
op_assign
l_int|NULL
suffix:semicolon
id|otype
op_assign
id|para-&gt;output
suffix:semicolon
id|ts_pes
op_assign
(paren
r_enum
id|dmx_ts_pes
)paren
id|para-&gt;pes_type
suffix:semicolon
r_if
c_cond
(paren
id|ts_pes
OL
id|DMX_PES_OTHER
)paren
id|ts_type
op_assign
id|TS_DECODER
suffix:semicolon
r_else
id|ts_type
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|otype
op_eq
id|DMX_OUT_TS_TAP
)paren
id|ts_type
op_or_assign
id|TS_PACKET
suffix:semicolon
r_if
c_cond
(paren
id|otype
op_eq
id|DMX_OUT_TAP
)paren
id|ts_type
op_or_assign
id|TS_PAYLOAD_ONLY
op_or
id|TS_PACKET
suffix:semicolon
id|ret
op_assign
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|allocate_ts_feed
c_func
(paren
id|dmxdev-&gt;demux
comma
id|tsfeed
comma
id|dvb_dmxdev_ts_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
(paren
op_star
id|tsfeed
)paren
op_member_access_from_pointer
id|priv
op_assign
(paren
r_void
op_star
)paren
id|filter
suffix:semicolon
id|ret
op_assign
(paren
op_star
id|tsfeed
)paren
op_member_access_from_pointer
id|set
c_func
(paren
op_star
id|tsfeed
comma
id|para-&gt;pid
comma
id|ts_type
comma
id|ts_pes
comma
l_int|188
comma
l_int|32768
comma
l_int|0
comma
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|release_ts_feed
c_func
(paren
id|dmxdev-&gt;demux
comma
op_star
id|tsfeed
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|filter-&gt;feed.ts
op_member_access_from_pointer
id|start_filtering
c_func
(paren
id|filter-&gt;feed.ts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|filter
comma
id|DMXDEV_STATE_GO
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_demux_open
r_static
r_int
id|dvb_demux_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;filter
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dmxdev-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|state
op_eq
id|DMXDEV_STATE_FREE
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|dmxdev-&gt;filternum
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EMFILE
suffix:semicolon
)brace
id|dmxdevfilter
op_assign
op_amp
id|dmxdev-&gt;filter
(braket
id|i
)braket
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
comma
l_int|1
)paren
suffix:semicolon
id|dmxdevfilter-&gt;dvbdev
op_assign
id|dmxdev-&gt;dvbdev
suffix:semicolon
id|file-&gt;private_data
op_assign
id|dmxdevfilter
suffix:semicolon
id|dvb_dmxdev_buffer_init
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer
)paren
suffix:semicolon
id|dmxdevfilter-&gt;type
op_assign
id|DMXDEV_TYPE_NONE
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_ALLOCATED
)paren
suffix:semicolon
id|dmxdevfilter-&gt;feed.ts
op_assign
l_int|NULL
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|dmxdevfilter-&gt;timer
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_free
r_static
r_int
id|dvb_dmxdev_filter_free
c_func
(paren
r_struct
id|dmxdev
op_star
id|dmxdev
comma
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
)paren
(brace
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|dvb_dmxdev_filter_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|dvb_dmxdev_filter_reset
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;buffer.data
)paren
(brace
r_void
op_star
id|mem
op_assign
id|dmxdevfilter-&gt;buffer.data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|dmxdev-&gt;lock
)paren
suffix:semicolon
id|dmxdevfilter-&gt;buffer.data
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|dmxdev-&gt;lock
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|mem
)paren
suffix:semicolon
)brace
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_FREE
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer.queue
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|invert_mode
r_static
r_inline
r_void
id|invert_mode
c_func
(paren
id|dmx_filter_t
op_star
id|filter
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DMX_FILTER_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|filter-&gt;mode
(braket
id|i
)braket
op_xor_assign
l_int|0xff
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_filter_set
r_static
r_int
id|dvb_dmxdev_filter_set
c_func
(paren
r_struct
id|dmxdev
op_star
id|dmxdev
comma
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
comma
r_struct
id|dmx_sct_filter_params
op_star
id|params
)paren
(brace
id|dprintk
(paren
l_string|&quot;function : %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dvb_dmxdev_filter_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|dmxdevfilter-&gt;type
op_assign
id|DMXDEV_TYPE_SEC
suffix:semicolon
id|dmxdevfilter-&gt;pid
op_assign
id|params-&gt;pid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dmxdevfilter-&gt;params.sec
comma
id|params
comma
r_sizeof
(paren
r_struct
id|dmx_sct_filter_params
)paren
)paren
suffix:semicolon
id|invert_mode
c_func
(paren
op_amp
id|dmxdevfilter-&gt;params.sec.filter
)paren
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_SET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;flags
op_amp
id|DMX_IMMEDIATE_START
)paren
r_return
id|dvb_dmxdev_filter_start
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_pes_filter_set
r_static
r_int
id|dvb_dmxdev_pes_filter_set
c_func
(paren
r_struct
id|dmxdev
op_star
id|dmxdev
comma
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
comma
r_struct
id|dmx_pes_filter_params
op_star
id|params
)paren
(brace
id|dvb_dmxdev_filter_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;pes_type
OG
id|DMX_PES_OTHER
op_logical_or
id|params-&gt;pes_type
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dmxdevfilter-&gt;type
op_assign
id|DMXDEV_TYPE_PES
suffix:semicolon
id|dmxdevfilter-&gt;pid
op_assign
id|params-&gt;pid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dmxdevfilter-&gt;params
comma
id|params
comma
r_sizeof
(paren
r_struct
id|dmx_pes_filter_params
)paren
)paren
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
id|dmxdevfilter
comma
id|DMXDEV_STATE_SET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;flags
op_amp
id|DMX_IMMEDIATE_START
)paren
r_return
id|dvb_dmxdev_filter_start
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_dmxdev_read_sec
r_static
id|ssize_t
id|dvb_dmxdev_read_sec
c_func
(paren
r_struct
id|dmxdev_filter
op_star
id|dfil
comma
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|result
comma
id|hcount
suffix:semicolon
r_int
id|done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dfil-&gt;todo
op_le
l_int|0
)paren
(brace
id|hcount
op_assign
l_int|3
op_plus
id|dfil-&gt;todo
suffix:semicolon
r_if
c_cond
(paren
id|hcount
OG
id|count
)paren
id|hcount
op_assign
id|count
suffix:semicolon
id|result
op_assign
id|dvb_dmxdev_buffer_read
c_func
(paren
op_amp
id|dfil-&gt;buffer
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
id|buf
comma
id|hcount
comma
id|ppos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|dfil-&gt;todo
op_assign
l_int|0
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|dfil-&gt;secheader
op_minus
id|dfil-&gt;todo
comma
id|buf
comma
id|result
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|buf
op_add_assign
id|result
suffix:semicolon
id|done
op_assign
id|result
suffix:semicolon
id|count
op_sub_assign
id|result
suffix:semicolon
id|dfil-&gt;todo
op_sub_assign
id|result
suffix:semicolon
r_if
c_cond
(paren
id|dfil-&gt;todo
OG
op_minus
l_int|3
)paren
r_return
id|done
suffix:semicolon
id|dfil-&gt;todo
op_assign
(paren
(paren
id|dfil-&gt;secheader
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|dfil-&gt;secheader
(braket
l_int|2
)braket
)paren
op_amp
l_int|0xfff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_return
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
id|dfil-&gt;todo
)paren
id|count
op_assign
id|dfil-&gt;todo
suffix:semicolon
id|result
op_assign
id|dvb_dmxdev_buffer_read
c_func
(paren
op_amp
id|dfil-&gt;buffer
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_return
id|result
suffix:semicolon
id|dfil-&gt;todo
op_sub_assign
id|result
suffix:semicolon
r_return
(paren
id|result
op_plus
id|done
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|dvb_demux_read
id|dvb_demux_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
id|dvb_dmxdev_file_to_filter
c_func
(paren
id|file
)paren
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;type
op_eq
id|DMXDEV_TYPE_SEC
)paren
id|ret
op_assign
id|dvb_dmxdev_read_sec
c_func
(paren
id|dmxdevfilter
comma
id|file
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|dvb_dmxdev_buffer_read
c_func
(paren
op_amp
id|dmxdevfilter-&gt;buffer
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
id|buf
comma
id|count
comma
id|ppos
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_demux_do_ioctl
r_static
r_int
id|dvb_demux_do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|parg
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
id|dvb_dmxdev_file_to_filter
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
id|dmxdevfilter-&gt;dev
suffix:semicolon
r_int
r_int
id|arg
op_assign
(paren
r_int
r_int
)paren
id|parg
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|DMX_START
suffix:colon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
OL
id|DMXDEV_STATE_SET
)paren
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|ret
op_assign
id|dvb_dmxdev_filter_start
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_STOP
suffix:colon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|ret
op_assign
id|dvb_dmxdev_filter_stop
c_func
(paren
id|dmxdevfilter
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_SET_FILTER
suffix:colon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|ret
op_assign
id|dvb_dmxdev_filter_set
c_func
(paren
id|dmxdev
comma
id|dmxdevfilter
comma
(paren
r_struct
id|dmx_sct_filter_params
op_star
)paren
id|parg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_SET_PES_FILTER
suffix:colon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|ret
op_assign
id|dvb_dmxdev_pes_filter_set
c_func
(paren
id|dmxdev
comma
id|dmxdevfilter
comma
(paren
r_struct
id|dmx_pes_filter_params
op_star
)paren
id|parg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_SET_BUFFER_SIZE
suffix:colon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|ret
op_assign
id|dvb_dmxdev_set_buffer_size
c_func
(paren
id|dmxdevfilter
comma
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|dmxdevfilter-&gt;mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_GET_EVENT
suffix:colon
r_break
suffix:semicolon
r_case
id|DMX_GET_PES_PIDS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;demux-&gt;get_pes_pids
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|get_pes_pids
c_func
(paren
id|dmxdev-&gt;demux
comma
(paren
id|u16
op_star
)paren
id|parg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMX_GET_STC
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;demux-&gt;get_stc
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|ret
op_assign
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|get_stc
c_func
(paren
id|dmxdev-&gt;demux
comma
(paren
(paren
r_struct
id|dmx_stc
op_star
)paren
id|parg
)paren
op_member_access_from_pointer
id|num
comma
op_amp
(paren
(paren
r_struct
id|dmx_stc
op_star
)paren
id|parg
)paren
op_member_access_from_pointer
id|stc
comma
op_amp
(paren
(paren
r_struct
id|dmx_stc
op_star
)paren
id|parg
)paren
op_member_access_from_pointer
id|base
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_demux_ioctl
r_static
r_int
id|dvb_demux_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|dvb_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|dvb_demux_do_ioctl
)paren
suffix:semicolon
)brace
DECL|function|dvb_demux_poll
r_static
r_int
r_int
id|dvb_demux_poll
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
id|dvb_dmxdev_file_to_filter
c_func
(paren
id|file
)paren
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdevfilter
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|dmxdevfilter-&gt;buffer.queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;state
op_ne
id|DMXDEV_STATE_GO
op_logical_and
id|dmxdevfilter-&gt;state
op_ne
id|DMXDEV_STATE_DONE
op_logical_and
id|dmxdevfilter-&gt;state
op_ne
id|DMXDEV_STATE_TIMEDOUT
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;buffer.error
)paren
id|mask
op_or_assign
(paren
id|POLLIN
op_or
id|POLLRDNORM
op_or
id|POLLPRI
op_or
id|POLLERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdevfilter-&gt;buffer.pread
op_ne
id|dmxdevfilter-&gt;buffer.pwrite
)paren
id|mask
op_or_assign
(paren
id|POLLIN
op_or
id|POLLRDNORM
op_or
id|POLLPRI
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|dvb_demux_release
r_static
r_int
id|dvb_demux_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dmxdev_filter
op_star
id|dmxdevfilter
op_assign
id|dvb_dmxdev_file_to_filter
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
id|dmxdevfilter-&gt;dev
suffix:semicolon
r_return
id|dvb_dmxdev_filter_free
c_func
(paren
id|dmxdev
comma
id|dmxdevfilter
)paren
suffix:semicolon
)brace
DECL|variable|dvb_demux_fops
r_static
r_struct
id|file_operations
id|dvb_demux_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|read
op_assign
id|dvb_demux_read
comma
dot
id|ioctl
op_assign
id|dvb_demux_ioctl
comma
dot
id|open
op_assign
id|dvb_demux_open
comma
dot
id|release
op_assign
id|dvb_demux_release
comma
dot
id|poll
op_assign
id|dvb_demux_poll
comma
)brace
suffix:semicolon
DECL|variable|dvbdev_demux
r_static
r_struct
id|dvb_device
id|dvbdev_demux
op_assign
(brace
dot
id|priv
op_assign
l_int|NULL
comma
dot
id|users
op_assign
l_int|1
comma
dot
id|writers
op_assign
l_int|1
comma
dot
id|fops
op_assign
op_amp
id|dvb_demux_fops
)brace
suffix:semicolon
DECL|function|dvb_dvr_do_ioctl
r_static
r_int
id|dvb_dvr_do_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|parg
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|DMX_SET_BUFFER_SIZE
suffix:colon
singleline_comment|// FIXME: implement
id|ret
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_dvr_ioctl
r_static
r_int
id|dvb_dvr_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|dvb_usercopy
c_func
(paren
id|inode
comma
id|file
comma
id|cmd
comma
id|arg
comma
id|dvb_dvr_do_ioctl
)paren
suffix:semicolon
)brace
DECL|function|dvb_dvr_poll
r_static
r_int
r_int
id|dvb_dvr_poll
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmxdev
op_star
id|dmxdev
op_assign
(paren
r_struct
id|dmxdev
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|dprintk
(paren
l_string|&quot;function : %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|dmxdev-&gt;dvr_buffer.queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
(brace
r_if
c_cond
(paren
id|dmxdev-&gt;dvr_buffer.error
)paren
id|mask
op_or_assign
(paren
id|POLLIN
op_or
id|POLLRDNORM
op_or
id|POLLPRI
op_or
id|POLLERR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdev-&gt;dvr_buffer.pread
op_ne
id|dmxdev-&gt;dvr_buffer.pwrite
)paren
id|mask
op_or_assign
(paren
id|POLLIN
op_or
id|POLLRDNORM
op_or
id|POLLPRI
)paren
suffix:semicolon
)brace
r_else
id|mask
op_or_assign
(paren
id|POLLOUT
op_or
id|POLLWRNORM
op_or
id|POLLPRI
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|variable|dvb_dvr_fops
r_static
r_struct
id|file_operations
id|dvb_dvr_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|read
op_assign
id|dvb_dvr_read
comma
dot
id|write
op_assign
id|dvb_dvr_write
comma
dot
id|ioctl
op_assign
id|dvb_dvr_ioctl
comma
dot
id|open
op_assign
id|dvb_dvr_open
comma
dot
id|release
op_assign
id|dvb_dvr_release
comma
dot
id|poll
op_assign
id|dvb_dvr_poll
comma
)brace
suffix:semicolon
DECL|variable|dvbdev_dvr
r_static
r_struct
id|dvb_device
id|dvbdev_dvr
op_assign
(brace
dot
id|priv
op_assign
l_int|NULL
comma
dot
id|users
op_assign
l_int|1
comma
dot
id|writers
op_assign
l_int|1
comma
dot
id|fops
op_assign
op_amp
id|dvb_dvr_fops
)brace
suffix:semicolon
r_int
DECL|function|dvb_dmxdev_init
id|dvb_dmxdev_init
c_func
(paren
r_struct
id|dmxdev
op_star
id|dmxdev
comma
r_struct
id|dvb_adapter
op_star
id|dvb_adapter
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|open
c_func
(paren
id|dmxdev-&gt;demux
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EUSERS
suffix:semicolon
id|dmxdev-&gt;filter
op_assign
id|vmalloc
c_func
(paren
id|dmxdev-&gt;filternum
op_star
r_sizeof
(paren
r_struct
id|dmxdev_filter
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;filter
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dmxdev-&gt;dvr
op_assign
id|vmalloc
c_func
(paren
id|dmxdev-&gt;filternum
op_star
r_sizeof
(paren
r_struct
id|dmxdev_dvr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmxdev-&gt;dvr
)paren
(brace
id|vfree
c_func
(paren
id|dmxdev-&gt;filter
)paren
suffix:semicolon
id|dmxdev-&gt;filter
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|sema_init
c_func
(paren
op_amp
id|dmxdev-&gt;mutex
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dmxdev-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dmxdev-&gt;filternum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|dev
op_assign
id|dmxdev
suffix:semicolon
id|dmxdev-&gt;filter
(braket
id|i
)braket
dot
id|buffer.data
op_assign
l_int|NULL
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
op_amp
id|dmxdev-&gt;filter
(braket
id|i
)braket
comma
id|DMXDEV_STATE_FREE
)paren
suffix:semicolon
id|dmxdev-&gt;dvr
(braket
id|i
)braket
dot
id|dev
op_assign
id|dmxdev
suffix:semicolon
id|dmxdev-&gt;dvr
(braket
id|i
)braket
dot
id|buffer.data
op_assign
l_int|NULL
suffix:semicolon
id|dvb_dmxdev_filter_state_set
c_func
(paren
op_amp
id|dmxdev-&gt;filter
(braket
id|i
)braket
comma
id|DMXDEV_STATE_FREE
)paren
suffix:semicolon
id|dvb_dmxdev_dvr_state_set
c_func
(paren
op_amp
id|dmxdev-&gt;dvr
(braket
id|i
)braket
comma
id|DMXDEV_STATE_FREE
)paren
suffix:semicolon
)brace
id|dvb_register_device
c_func
(paren
id|dvb_adapter
comma
op_amp
id|dmxdev-&gt;dvbdev
comma
op_amp
id|dvbdev_demux
comma
id|dmxdev
comma
id|DVB_DEVICE_DEMUX
)paren
suffix:semicolon
id|dvb_register_device
c_func
(paren
id|dvb_adapter
comma
op_amp
id|dmxdev-&gt;dvr_dvbdev
comma
op_amp
id|dvbdev_dvr
comma
id|dmxdev
comma
id|DVB_DEVICE_DVR
)paren
suffix:semicolon
id|dvb_dmxdev_buffer_init
c_func
(paren
op_amp
id|dmxdev-&gt;dvr_buffer
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dvb_dmxdev_init
id|EXPORT_SYMBOL
c_func
(paren
id|dvb_dmxdev_init
)paren
suffix:semicolon
r_void
DECL|function|dvb_dmxdev_release
id|dvb_dmxdev_release
c_func
(paren
r_struct
id|dmxdev
op_star
id|dmxdev
)paren
(brace
id|dvb_unregister_device
c_func
(paren
id|dmxdev-&gt;dvbdev
)paren
suffix:semicolon
id|dvb_unregister_device
c_func
(paren
id|dmxdev-&gt;dvr_dvbdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dmxdev-&gt;filter
)paren
(brace
id|vfree
c_func
(paren
id|dmxdev-&gt;filter
)paren
suffix:semicolon
id|dmxdev-&gt;filter
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dmxdev-&gt;dvr
)paren
(brace
id|vfree
c_func
(paren
id|dmxdev-&gt;dvr
)paren
suffix:semicolon
id|dmxdev-&gt;dvr
op_assign
l_int|NULL
suffix:semicolon
)brace
id|dmxdev-&gt;demux
op_member_access_from_pointer
id|close
c_func
(paren
id|dmxdev-&gt;demux
)paren
suffix:semicolon
)brace
DECL|variable|dvb_dmxdev_release
id|EXPORT_SYMBOL
c_func
(paren
id|dvb_dmxdev_release
)paren
suffix:semicolon
eof
