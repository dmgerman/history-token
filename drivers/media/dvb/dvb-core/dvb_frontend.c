multiline_comment|/*&n; * dvb-core.c: DVB core driver&n; *&n; * Copyright (C) 1999-2001 Ralph  Metzler&n; *                         Marcus Metzler&n; *                         Holger Waechtler &n; *                                    for convergence integrated media GmbH&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; * Or, point your browser to http://www.gnu.org/copyleft/gpl.html&n; */
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &quot;dvbdev.h&quot;
macro_line|#include &quot;dvb_functions.h&quot;
DECL|variable|dvb_frontend_debug
r_static
r_int
id|dvb_frontend_debug
op_assign
l_int|0
suffix:semicolon
DECL|variable|dvb_shutdown_timeout
r_static
r_int
id|dvb_shutdown_timeout
op_assign
l_int|5
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk if (dvb_frontend_debug) printk
DECL|macro|MAX_EVENT
mdefine_line|#define MAX_EVENT 8
DECL|struct|dvb_fe_events
r_struct
id|dvb_fe_events
(brace
DECL|member|events
r_struct
id|dvb_frontend_event
id|events
(braket
id|MAX_EVENT
)braket
suffix:semicolon
DECL|member|eventw
r_int
id|eventw
suffix:semicolon
DECL|member|eventr
r_int
id|eventr
suffix:semicolon
DECL|member|overflow
r_int
id|overflow
suffix:semicolon
DECL|member|wait_queue
id|wait_queue_head_t
id|wait_queue
suffix:semicolon
DECL|member|sem
r_struct
id|semaphore
id|sem
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|dvb_frontend_data
r_struct
id|dvb_frontend_data
(brace
DECL|member|info
r_struct
id|dvb_frontend_info
op_star
id|info
suffix:semicolon
DECL|member|frontend
r_struct
id|dvb_frontend
id|frontend
suffix:semicolon
DECL|member|dvbdev
r_struct
id|dvb_device
op_star
id|dvbdev
suffix:semicolon
DECL|member|parameters
r_struct
id|dvb_frontend_parameters
id|parameters
suffix:semicolon
DECL|member|events
r_struct
id|dvb_fe_events
id|events
suffix:semicolon
DECL|member|sem
r_struct
id|semaphore
id|sem
suffix:semicolon
DECL|member|list_head
r_struct
id|list_head
id|list_head
suffix:semicolon
DECL|member|wait_queue
id|wait_queue_head_t
id|wait_queue
suffix:semicolon
DECL|member|thread_pid
id|pid_t
id|thread_pid
suffix:semicolon
DECL|member|release_jiffies
r_int
r_int
id|release_jiffies
suffix:semicolon
DECL|member|lost_sync_jiffies
r_int
r_int
id|lost_sync_jiffies
suffix:semicolon
DECL|member|bending
r_int
id|bending
suffix:semicolon
DECL|member|lnb_drift
r_int
id|lnb_drift
suffix:semicolon
DECL|member|timeout_count
r_int
id|timeout_count
suffix:semicolon
DECL|member|lost_sync_count
r_int
id|lost_sync_count
suffix:semicolon
DECL|member|exit
r_int
m_exit
suffix:semicolon
DECL|member|status
id|fe_status_t
id|status
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|dvb_frontend_ioctl_data
r_struct
id|dvb_frontend_ioctl_data
(brace
DECL|member|list_head
r_struct
id|list_head
id|list_head
suffix:semicolon
DECL|member|adapter
r_struct
id|dvb_adapter
op_star
id|adapter
suffix:semicolon
DECL|member|before_ioctl
r_int
(paren
op_star
id|before_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
DECL|member|after_ioctl
r_int
(paren
op_star
id|after_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
suffix:semicolon
DECL|member|before_after_data
r_void
op_star
id|before_after_data
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|dvb_frontend_notifier_data
r_struct
id|dvb_frontend_notifier_data
(brace
DECL|member|list_head
r_struct
id|list_head
id|list_head
suffix:semicolon
DECL|member|adapter
r_struct
id|dvb_adapter
op_star
id|adapter
suffix:semicolon
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
id|fe_status_t
id|s
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|member|data
r_void
op_star
id|data
suffix:semicolon
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|frontend_list
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|frontend_ioctl_list
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|frontend_notifier_list
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|frontend_mutex
)paren
suffix:semicolon
r_static
DECL|function|dvb_frontend_internal_ioctl
r_int
id|dvb_frontend_internal_ioctl
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frontend-&gt;before_ioctl
)paren
id|err
op_assign
id|frontend-&gt;before_ioctl
(paren
id|frontend
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EOPNOTSUPP
)paren
(brace
id|err
op_assign
id|frontend-&gt;ioctl
(paren
id|frontend
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_eq
op_minus
id|EOPNOTSUPP
)paren
op_logical_and
id|frontend-&gt;after_ioctl
)paren
id|err
op_assign
id|frontend-&gt;after_ioctl
(paren
id|frontend
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/**&n; *  if 2 tuners are located side by side you can get interferences when&n; *  they try to tune to the same frequency, so both lose sync.&n; *  We will slightly mistune in this case. The AFC of the demodulator&n; *  should make it still possible to receive the requested transponder &n; *  on both tuners...&n; */
r_static
DECL|function|dvb_bend_frequency
r_void
id|dvb_bend_frequency
(paren
r_struct
id|dvb_frontend_data
op_star
id|this_fe
comma
r_int
id|recursive
)paren
(brace
r_struct
id|list_head
op_star
id|entry
suffix:semicolon
r_int
id|stepsize
op_assign
id|this_fe-&gt;info-&gt;frequency_stepsize
suffix:semicolon
r_int
id|frequency
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stepsize
op_logical_or
id|recursive
OG
l_int|10
)paren
(brace
id|printk
(paren
l_string|&quot;%s: too deep recursion, check frequency_stepsize &quot;
l_string|&quot;in your frontend code!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|recursive
)paren
(brace
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|frontend_mutex
)paren
)paren
r_return
suffix:semicolon
id|this_fe-&gt;bending
op_assign
l_int|0
suffix:semicolon
)brace
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
r_int
id|f
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
id|f
op_assign
id|fe-&gt;parameters.frequency
suffix:semicolon
id|f
op_add_assign
id|fe-&gt;lnb_drift
suffix:semicolon
id|f
op_add_assign
id|fe-&gt;bending
suffix:semicolon
id|frequency
op_assign
id|this_fe-&gt;parameters.frequency
suffix:semicolon
id|frequency
op_add_assign
id|this_fe-&gt;lnb_drift
suffix:semicolon
id|frequency
op_add_assign
id|this_fe-&gt;bending
suffix:semicolon
r_if
c_cond
(paren
id|this_fe
op_ne
id|fe
op_logical_and
id|fe-&gt;lost_sync_count
op_ne
op_minus
l_int|1
op_logical_and
id|frequency
OG
id|f
op_minus
id|stepsize
op_logical_and
id|frequency
OL
id|f
op_plus
id|stepsize
)paren
(brace
r_if
c_cond
(paren
id|recursive
op_mod
l_int|2
)paren
id|this_fe-&gt;bending
op_add_assign
id|stepsize
suffix:semicolon
r_else
id|this_fe-&gt;bending
op_assign
op_minus
id|this_fe-&gt;bending
suffix:semicolon
id|dvb_bend_frequency
(paren
id|this_fe
comma
id|recursive
op_plus
l_int|1
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
)brace
id|done
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|recursive
)paren
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
)brace
r_static
DECL|function|dvb_call_frontend_notifiers
r_void
id|dvb_call_frontend_notifiers
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
comma
id|fe_status_t
id|s
)paren
(brace
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fe-&gt;status
op_amp
id|FE_HAS_LOCK
)paren
op_logical_and
op_logical_neg
(paren
id|s
op_amp
id|FE_HAS_LOCK
)paren
)paren
id|fe-&gt;lost_sync_jiffies
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|s
op_xor
id|fe-&gt;status
)paren
op_amp
id|FE_HAS_LOCK
)paren
op_logical_and
(paren
id|s
op_amp
id|FE_HAS_LOCK
)paren
)paren
id|dvb_delay
(paren
id|fe-&gt;info-&gt;notifier_delay
)paren
suffix:semicolon
id|fe-&gt;status
op_assign
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s
op_amp
id|FE_HAS_LOCK
)paren
op_logical_and
(paren
id|fe-&gt;info-&gt;caps
op_amp
id|FE_CAN_MUTE_TS
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/**&n;&t; *   now tell the Demux about the TS status changes...&n;&t; */
r_if
c_cond
(paren
id|fe-&gt;frontend.notifier_callback
)paren
id|fe-&gt;frontend
dot
id|notifier_callback
c_func
(paren
id|fe-&gt;status
comma
id|fe-&gt;frontend.notifier_data
)paren
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_add_event
r_void
id|dvb_frontend_add_event
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
comma
id|fe_status_t
id|status
)paren
(brace
r_struct
id|dvb_fe_events
op_star
id|events
op_assign
op_amp
id|fe-&gt;events
suffix:semicolon
r_struct
id|dvb_frontend_event
op_star
id|e
suffix:semicolon
r_int
id|wp
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|events-&gt;sem
)paren
)paren
r_return
suffix:semicolon
id|wp
op_assign
(paren
id|events-&gt;eventw
op_plus
l_int|1
)paren
op_mod
id|MAX_EVENT
suffix:semicolon
r_if
c_cond
(paren
id|wp
op_eq
id|events-&gt;eventr
)paren
(brace
id|events-&gt;overflow
op_assign
l_int|1
suffix:semicolon
id|events-&gt;eventr
op_assign
(paren
id|events-&gt;eventr
op_plus
l_int|1
)paren
op_mod
id|MAX_EVENT
suffix:semicolon
)brace
id|e
op_assign
op_amp
id|events-&gt;events
(braket
id|events-&gt;eventw
)braket
suffix:semicolon
id|memcpy
(paren
op_amp
id|e-&gt;parameters
comma
op_amp
id|fe-&gt;parameters
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_parameters
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|FE_HAS_LOCK
)paren
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|FE_GET_FRONTEND
comma
op_amp
id|e-&gt;parameters
)paren
suffix:semicolon
id|events-&gt;eventw
op_assign
id|wp
suffix:semicolon
id|up
(paren
op_amp
id|events-&gt;sem
)paren
suffix:semicolon
id|e-&gt;status
op_assign
id|status
suffix:semicolon
id|dvb_call_frontend_notifiers
(paren
id|fe
comma
id|status
)paren
suffix:semicolon
id|wake_up_interruptible
(paren
op_amp
id|events-&gt;wait_queue
)paren
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_get_event
r_int
id|dvb_frontend_get_event
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
comma
r_struct
id|dvb_frontend_event
op_star
id|event
comma
r_int
id|flags
)paren
(brace
r_struct
id|dvb_fe_events
op_star
id|events
op_assign
op_amp
id|fe-&gt;events
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events-&gt;overflow
)paren
(brace
id|events-&gt;overflow
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EOVERFLOW
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events-&gt;eventw
op_eq
id|events-&gt;eventr
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
id|ret
op_assign
id|wait_event_interruptible
(paren
id|events-&gt;wait_queue
comma
id|events-&gt;eventw
op_ne
id|events-&gt;eventr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|events-&gt;sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|memcpy
(paren
id|event
comma
op_amp
id|events-&gt;events
(braket
id|events-&gt;eventr
)braket
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_event
)paren
)paren
suffix:semicolon
id|events-&gt;eventr
op_assign
(paren
id|events-&gt;eventr
op_plus
l_int|1
)paren
op_mod
id|MAX_EVENT
suffix:semicolon
id|up
(paren
op_amp
id|events-&gt;sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_set_parameters
r_int
id|dvb_frontend_set_parameters
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|param
comma
r_int
id|first_trial
)paren
(brace
r_struct
id|dvb_frontend
op_star
id|frontend
op_assign
op_amp
id|fe-&gt;frontend
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|first_trial
)paren
(brace
id|fe-&gt;timeout_count
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;lost_sync_count
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;lost_sync_jiffies
op_assign
id|jiffies
suffix:semicolon
id|fe-&gt;lnb_drift
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;status
op_amp
op_complement
id|FE_TIMEDOUT
)paren
id|dvb_frontend_add_event
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
id|memcpy
(paren
op_amp
id|fe-&gt;parameters
comma
id|param
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_parameters
)paren
)paren
suffix:semicolon
)brace
id|dvb_bend_frequency
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s: f == %i, drift == %i&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
r_int
)paren
id|param-&gt;frequency
comma
(paren
r_int
)paren
id|fe-&gt;lnb_drift
)paren
suffix:semicolon
id|param-&gt;frequency
op_add_assign
id|fe-&gt;lnb_drift
op_plus
id|fe-&gt;bending
suffix:semicolon
id|err
op_assign
id|dvb_frontend_internal_ioctl
(paren
id|frontend
comma
id|FE_SET_FRONTEND
comma
id|param
)paren
suffix:semicolon
id|param-&gt;frequency
op_sub_assign
id|fe-&gt;lnb_drift
op_plus
id|fe-&gt;bending
suffix:semicolon
id|wake_up_interruptible
(paren
op_amp
id|fe-&gt;wait_queue
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_init
r_void
id|dvb_frontend_init
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
)paren
(brace
r_struct
id|dvb_frontend
op_star
id|frontend
op_assign
op_amp
id|fe-&gt;frontend
suffix:semicolon
id|dprintk
(paren
l_string|&quot;DVB: initialising frontend %i:%i (%s)...&bslash;n&quot;
comma
id|frontend-&gt;i2c-&gt;adapter-&gt;num
comma
id|frontend-&gt;i2c-&gt;id
comma
id|fe-&gt;info-&gt;name
)paren
suffix:semicolon
id|dvb_frontend_internal_ioctl
(paren
id|frontend
comma
id|FE_INIT
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
DECL|function|update_delay
r_void
id|update_delay
(paren
r_int
op_star
id|quality
comma
r_int
op_star
id|delay
comma
r_int
id|locked
)paren
(brace
r_int
id|q2
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|locked
)paren
(paren
op_star
id|quality
)paren
op_assign
(paren
op_star
id|quality
op_star
l_int|220
op_plus
l_int|36
op_star
l_int|256
)paren
op_div
l_int|256
suffix:semicolon
r_else
(paren
op_star
id|quality
)paren
op_assign
(paren
op_star
id|quality
op_star
l_int|220
op_plus
l_int|0
)paren
op_div
l_int|256
suffix:semicolon
id|q2
op_assign
op_star
id|quality
op_minus
l_int|128
suffix:semicolon
id|q2
op_mul_assign
id|q2
suffix:semicolon
op_star
id|delay
op_assign
id|HZ
op_div
l_int|20
op_plus
id|q2
op_star
id|HZ
op_div
(paren
l_int|128
op_star
l_int|128
)paren
suffix:semicolon
)brace
DECL|macro|LNB_DRIFT
mdefine_line|#define LNB_DRIFT 1024  /*  max. tolerated LNB drift, XXX FIXME: adjust! */
DECL|macro|TIMEOUT
mdefine_line|#define TIMEOUT 2*HZ
multiline_comment|/**&n; *  here we only come when we have lost the lock bit, &n; *  let&squot;s try to do something useful...&n; */
r_static
DECL|function|dvb_frontend_recover
r_void
id|dvb_frontend_recover
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
)paren
(brace
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|fe-&gt;timeout_count
OG
l_int|3
)paren
(brace
id|printk
(paren
l_string|&quot;%s: frontend seems dead, reinitializing...&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dvb_call_frontend_notifiers
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|FE_INIT
comma
l_int|NULL
)paren
suffix:semicolon
id|dvb_frontend_set_parameters
(paren
id|fe
comma
op_amp
id|fe-&gt;parameters
comma
l_int|1
)paren
suffix:semicolon
id|dvb_frontend_add_event
(paren
id|fe
comma
id|FE_REINIT
)paren
suffix:semicolon
id|fe-&gt;lost_sync_jiffies
op_assign
id|jiffies
suffix:semicolon
id|fe-&gt;timeout_count
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/**&n;&t; *  let&squot;s start a zigzag scan to compensate LNB drift...&n;&t; */
(brace
r_int
id|j
op_assign
id|fe-&gt;lost_sync_count
suffix:semicolon
r_int
id|stepsize
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;info-&gt;type
op_eq
id|FE_QPSK
)paren
id|stepsize
op_assign
id|fe-&gt;parameters.u.qpsk.symbol_rate
op_div
l_int|16000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fe-&gt;info-&gt;type
op_eq
id|FE_QAM
)paren
id|stepsize
op_assign
l_int|0
suffix:semicolon
r_else
id|stepsize
op_assign
id|fe-&gt;info-&gt;frequency_stepsize
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|j
op_mod
l_int|32
op_eq
l_int|0
)paren
(brace
id|fe-&gt;lnb_drift
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|fe-&gt;lnb_drift
op_assign
op_minus
id|fe-&gt;lnb_drift
suffix:semicolon
r_if
c_cond
(paren
id|j
op_mod
l_int|2
)paren
id|fe-&gt;lnb_drift
op_add_assign
id|stepsize
suffix:semicolon
)brace
id|dvb_frontend_set_parameters
(paren
id|fe
comma
op_amp
id|fe-&gt;parameters
comma
l_int|0
)paren
suffix:semicolon
)brace
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|FE_RESET
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_is_exiting
r_int
id|dvb_frontend_is_exiting
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
)paren
(brace
r_if
c_cond
(paren
id|fe
op_member_access_from_pointer
m_exit
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;dvbdev-&gt;writers
op_eq
l_int|1
)paren
r_if
c_cond
(paren
id|jiffies
op_minus
id|fe-&gt;release_jiffies
OG
id|dvb_shutdown_timeout
op_star
id|HZ
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_thread
r_int
id|dvb_frontend_thread
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
op_assign
(paren
r_struct
id|dvb_frontend_data
op_star
)paren
id|data
suffix:semicolon
r_char
id|name
(braket
l_int|15
)braket
suffix:semicolon
r_int
id|quality
op_assign
l_int|0
comma
id|delay
op_assign
l_int|3
op_star
id|HZ
suffix:semicolon
id|fe_status_t
id|s
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|snprintf
(paren
id|name
comma
r_sizeof
(paren
id|name
)paren
comma
l_string|&quot;kdvb-fe-%i:%i&quot;
comma
id|fe-&gt;frontend.i2c-&gt;adapter-&gt;num
comma
id|fe-&gt;frontend.i2c-&gt;id
)paren
suffix:semicolon
id|dvb_kernel_thread_setup
(paren
id|name
)paren
suffix:semicolon
id|fe-&gt;lost_sync_count
op_assign
op_minus
l_int|1
suffix:semicolon
id|dvb_call_frontend_notifiers
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
id|dvb_frontend_init
(paren
id|fe
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|dvb_frontend_is_exiting
(paren
id|fe
)paren
)paren
(brace
id|up
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
multiline_comment|/* is locked when we enter the thread... */
id|interruptible_sleep_on_timeout
(paren
op_amp
id|fe-&gt;wait_queue
comma
id|delay
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|fe-&gt;sem
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;lost_sync_count
op_eq
op_minus
l_int|1
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dvb_frontend_is_exiting
(paren
id|fe
)paren
)paren
r_break
suffix:semicolon
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|FE_READ_STATUS
comma
op_amp
id|s
)paren
suffix:semicolon
id|update_delay
(paren
op_amp
id|quality
comma
op_amp
id|delay
comma
id|s
op_amp
id|FE_HAS_LOCK
)paren
suffix:semicolon
id|s
op_and_assign
op_complement
id|FE_TIMEDOUT
suffix:semicolon
r_if
c_cond
(paren
id|s
op_amp
id|FE_HAS_LOCK
)paren
(brace
id|fe-&gt;timeout_count
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;lost_sync_count
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|fe-&gt;lost_sync_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fe-&gt;info-&gt;caps
op_amp
id|FE_CAN_RECOVER
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|fe-&gt;info-&gt;caps
op_amp
id|FE_CAN_CLEAN_SETUP
)paren
)paren
(brace
r_if
c_cond
(paren
id|fe-&gt;lost_sync_count
OL
l_int|10
)paren
r_continue
suffix:semicolon
)brace
id|dvb_frontend_recover
(paren
id|fe
)paren
suffix:semicolon
id|delay
op_assign
id|HZ
op_div
l_int|5
suffix:semicolon
)brace
r_if
c_cond
(paren
id|jiffies
op_minus
id|fe-&gt;lost_sync_jiffies
OG
id|TIMEOUT
)paren
(brace
id|s
op_or_assign
id|FE_TIMEDOUT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fe-&gt;status
op_amp
id|FE_TIMEDOUT
)paren
op_eq
l_int|0
)paren
id|fe-&gt;timeout_count
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|s
op_ne
id|fe-&gt;status
)paren
id|dvb_frontend_add_event
(paren
id|fe
comma
id|s
)paren
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|dvb_shutdown_timeout
)paren
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|FE_SLEEP
comma
l_int|NULL
)paren
suffix:semicolon
id|up
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
id|fe-&gt;thread_pid
op_assign
l_int|0
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|wake_up_interruptible
(paren
op_amp
id|fe-&gt;wait_queue
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_stop
r_void
id|dvb_frontend_stop
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
)paren
(brace
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|fe
op_member_access_from_pointer
m_exit
op_assign
l_int|1
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fe-&gt;thread_pid
)paren
r_return
suffix:semicolon
multiline_comment|/* check if the thread is really alive */
r_if
c_cond
(paren
id|kill_proc
c_func
(paren
id|fe-&gt;thread_pid
comma
l_int|0
comma
l_int|1
)paren
op_eq
op_minus
id|ESRCH
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb_frontend_stop: thread PID %d already died&bslash;n&quot;
comma
id|fe-&gt;thread_pid
)paren
suffix:semicolon
multiline_comment|/* make sure the mutex was not held by the thread */
id|init_MUTEX
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|wake_up_interruptible
(paren
op_amp
id|fe-&gt;wait_queue
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|fe-&gt;wait_queue
)paren
suffix:semicolon
multiline_comment|/* paranoia check */
r_if
c_cond
(paren
id|fe-&gt;thread_pid
)paren
id|printk
c_func
(paren
l_string|&quot;dvb_frontend_stop: warning: thread PID %d won&squot;t exit&bslash;n&quot;
comma
id|fe-&gt;thread_pid
)paren
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_start
r_int
id|dvb_frontend_start
(paren
r_struct
id|dvb_frontend_data
op_star
id|fe
)paren
(brace
r_int
id|ret
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;thread_pid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|fe
op_member_access_from_pointer
m_exit
)paren
r_return
l_int|0
suffix:semicolon
r_else
id|dvb_frontend_stop
(paren
id|fe
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|fe-&gt;sem
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
id|fe
op_member_access_from_pointer
m_exit
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;thread_pid
op_assign
l_int|0
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|kernel_thread
(paren
id|dvb_frontend_thread
comma
id|fe
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb_frontend_start: failed to start kernel_thread (%d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|fe-&gt;thread_pid
op_assign
id|ret
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_ioctl
r_int
id|dvb_frontend_ioctl
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|parg
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dvb_frontend_data
op_star
id|fe
op_assign
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fe
op_logical_or
op_logical_neg
id|fe-&gt;frontend.ioctl
op_logical_or
id|fe
op_member_access_from_pointer
m_exit
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|fe-&gt;sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_DISEQC_SEND_MASTER_CMD
suffix:colon
r_case
id|FE_DISEQC_SEND_BURST
suffix:colon
r_case
id|FE_SET_TONE
suffix:colon
r_if
c_cond
(paren
id|fe-&gt;status
)paren
id|dvb_call_frontend_notifiers
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|cmd
comma
id|parg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_SET_FRONTEND
suffix:colon
id|err
op_assign
id|dvb_frontend_set_parameters
(paren
id|fe
comma
id|parg
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_GET_EVENT
suffix:colon
id|err
op_assign
id|dvb_frontend_get_event
(paren
id|fe
comma
id|parg
comma
id|file-&gt;f_flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_GET_FRONTEND
suffix:colon
id|memcpy
(paren
id|parg
comma
op_amp
id|fe-&gt;parameters
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_parameters
)paren
)paren
suffix:semicolon
multiline_comment|/*  fall-through... */
r_default
suffix:colon
id|dvb_frontend_internal_ioctl
(paren
op_amp
id|fe-&gt;frontend
comma
id|cmd
comma
id|parg
)paren
suffix:semicolon
)brace
suffix:semicolon
id|up
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_poll
r_int
r_int
id|dvb_frontend_poll
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dvb_frontend_data
op_star
id|fe
op_assign
id|dvbdev-&gt;priv
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|poll_wait
(paren
id|file
comma
op_amp
id|fe-&gt;events.wait_queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;events.eventw
op_ne
id|fe-&gt;events.eventr
)paren
r_return
(paren
id|POLLIN
op_or
id|POLLRDNORM
op_or
id|POLLPRI
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_open
r_int
id|dvb_frontend_open
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dvb_frontend_data
op_star
id|fe
op_assign
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|dvb_generic_open
(paren
id|inode
comma
id|file
)paren
)paren
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
(brace
id|ret
op_assign
id|dvb_frontend_start
(paren
id|fe
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|dvb_generic_release
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
multiline_comment|/*  empty event queue */
id|fe-&gt;events.eventr
op_assign
id|fe-&gt;events.eventw
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
r_static
DECL|function|dvb_frontend_release
r_int
id|dvb_frontend_release
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dvb_frontend_data
op_star
id|fe
op_assign
id|dvbdev-&gt;priv
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
id|fe-&gt;release_jiffies
op_assign
id|jiffies
suffix:semicolon
r_return
id|dvb_generic_release
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
r_int
DECL|function|dvb_add_frontend_ioctls
id|dvb_add_frontend_ioctls
(paren
r_struct
id|dvb_adapter
op_star
id|adapter
comma
r_int
(paren
op_star
id|before_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
comma
r_int
(paren
op_star
id|after_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
comma
r_void
op_star
id|before_after_data
)paren
(brace
r_struct
id|dvb_frontend_ioctl_data
op_star
id|ioctl
suffix:semicolon
r_struct
id|list_head
op_star
id|entry
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|frontend_mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|ioctl
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|dvb_frontend_ioctl_data
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ioctl
)paren
(brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ioctl-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|ioctl-&gt;before_ioctl
op_assign
id|before_ioctl
suffix:semicolon
id|ioctl-&gt;after_ioctl
op_assign
id|after_ioctl
suffix:semicolon
id|ioctl-&gt;before_after_data
op_assign
id|before_after_data
suffix:semicolon
id|list_add_tail
(paren
op_amp
id|ioctl-&gt;list_head
comma
op_amp
id|frontend_ioctl_list
)paren
suffix:semicolon
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;frontend.i2c-&gt;adapter
op_eq
id|adapter
op_logical_and
id|fe-&gt;frontend.before_ioctl
op_eq
l_int|NULL
op_logical_and
id|fe-&gt;frontend.after_ioctl
op_eq
l_int|NULL
)paren
(brace
id|fe-&gt;frontend.before_ioctl
op_assign
id|before_ioctl
suffix:semicolon
id|fe-&gt;frontend.after_ioctl
op_assign
id|after_ioctl
suffix:semicolon
id|fe-&gt;frontend.before_after_data
op_assign
id|before_after_data
suffix:semicolon
)brace
)brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|dvb_remove_frontend_ioctls
id|dvb_remove_frontend_ioctls
(paren
r_struct
id|dvb_adapter
op_star
id|adapter
comma
r_int
(paren
op_star
id|before_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
comma
r_int
(paren
op_star
id|after_ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
)paren
(brace
r_struct
id|list_head
op_star
id|entry
comma
op_star
id|n
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|down
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;frontend.i2c-&gt;adapter
op_eq
id|adapter
op_logical_and
id|fe-&gt;frontend.before_ioctl
op_eq
id|before_ioctl
op_logical_and
id|fe-&gt;frontend.after_ioctl
op_eq
id|after_ioctl
)paren
(brace
id|fe-&gt;frontend.before_ioctl
op_assign
l_int|NULL
suffix:semicolon
id|fe-&gt;frontend.after_ioctl
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|list_for_each_safe
(paren
id|entry
comma
id|n
comma
op_amp
id|frontend_ioctl_list
)paren
(brace
r_struct
id|dvb_frontend_ioctl_data
op_star
id|ioctl
suffix:semicolon
id|ioctl
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_ioctl_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioctl-&gt;adapter
op_eq
id|adapter
op_logical_and
id|ioctl-&gt;before_ioctl
op_eq
id|before_ioctl
op_logical_and
id|ioctl-&gt;after_ioctl
op_eq
id|after_ioctl
)paren
(brace
id|list_del
(paren
op_amp
id|ioctl-&gt;list_head
)paren
suffix:semicolon
id|kfree
(paren
id|ioctl
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
)brace
r_int
DECL|function|dvb_add_frontend_notifier
id|dvb_add_frontend_notifier
(paren
r_struct
id|dvb_adapter
op_star
id|adapter
comma
r_void
(paren
op_star
id|callback
)paren
(paren
id|fe_status_t
id|s
comma
r_void
op_star
id|data
)paren
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|dvb_frontend_notifier_data
op_star
id|notifier
suffix:semicolon
r_struct
id|list_head
op_star
id|entry
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|frontend_mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|notifier
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|dvb_frontend_notifier_data
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|notifier
)paren
(brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|notifier-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|notifier-&gt;callback
op_assign
id|callback
suffix:semicolon
id|notifier-&gt;data
op_assign
id|data
suffix:semicolon
id|list_add_tail
(paren
op_amp
id|notifier-&gt;list_head
comma
op_amp
id|frontend_notifier_list
)paren
suffix:semicolon
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;frontend.i2c-&gt;adapter
op_eq
id|adapter
op_logical_and
id|fe-&gt;frontend.notifier_callback
op_eq
l_int|NULL
)paren
(brace
id|fe-&gt;frontend.notifier_callback
op_assign
id|callback
suffix:semicolon
id|fe-&gt;frontend.notifier_data
op_assign
id|data
suffix:semicolon
)brace
)brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|dvb_remove_frontend_notifier
id|dvb_remove_frontend_notifier
(paren
r_struct
id|dvb_adapter
op_star
id|adapter
comma
r_void
(paren
op_star
id|callback
)paren
(paren
id|fe_status_t
id|s
comma
r_void
op_star
id|data
)paren
)paren
(brace
r_struct
id|list_head
op_star
id|entry
comma
op_star
id|n
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|down
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;frontend.i2c-&gt;adapter
op_eq
id|adapter
op_logical_and
id|fe-&gt;frontend.notifier_callback
op_eq
id|callback
)paren
(brace
id|fe-&gt;frontend.notifier_callback
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|list_for_each_safe
(paren
id|entry
comma
id|n
comma
op_amp
id|frontend_notifier_list
)paren
(brace
r_struct
id|dvb_frontend_notifier_data
op_star
id|notifier
suffix:semicolon
id|notifier
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_notifier_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notifier-&gt;adapter
op_eq
id|adapter
op_logical_and
id|notifier-&gt;callback
op_eq
id|callback
)paren
(brace
id|list_del
(paren
op_amp
id|notifier-&gt;list_head
)paren
suffix:semicolon
id|kfree
(paren
id|notifier
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
)brace
r_static
DECL|variable|dvb_frontend_fops
r_struct
id|file_operations
id|dvb_frontend_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|ioctl
op_assign
id|dvb_generic_ioctl
comma
dot
id|poll
op_assign
id|dvb_frontend_poll
comma
dot
id|open
op_assign
id|dvb_frontend_open
comma
dot
id|release
op_assign
id|dvb_frontend_release
)brace
suffix:semicolon
r_int
DECL|function|dvb_register_frontend
id|dvb_register_frontend
(paren
r_int
(paren
op_star
id|ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
comma
r_struct
id|dvb_i2c_bus
op_star
id|i2c
comma
r_void
op_star
id|data
comma
r_struct
id|dvb_frontend_info
op_star
id|info
)paren
(brace
r_struct
id|list_head
op_star
id|entry
suffix:semicolon
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
r_static
r_const
r_struct
id|dvb_device
id|dvbdev_template
op_assign
(brace
dot
id|users
op_assign
op_complement
l_int|0
comma
dot
id|writers
op_assign
l_int|1
comma
dot
id|fops
op_assign
op_amp
id|dvb_frontend_fops
comma
dot
id|kernel_ioctl
op_assign
id|dvb_frontend_ioctl
)brace
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
(paren
op_amp
id|frontend_mutex
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fe
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|dvb_frontend_data
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
(paren
id|fe
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_data
)paren
)paren
suffix:semicolon
id|init_MUTEX
(paren
op_amp
id|fe-&gt;sem
)paren
suffix:semicolon
id|init_waitqueue_head
(paren
op_amp
id|fe-&gt;wait_queue
)paren
suffix:semicolon
id|init_waitqueue_head
(paren
op_amp
id|fe-&gt;events.wait_queue
)paren
suffix:semicolon
id|init_MUTEX
(paren
op_amp
id|fe-&gt;events.sem
)paren
suffix:semicolon
id|fe-&gt;events.eventw
op_assign
id|fe-&gt;events.eventr
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;events.overflow
op_assign
l_int|0
suffix:semicolon
id|fe-&gt;frontend.ioctl
op_assign
id|ioctl
suffix:semicolon
id|fe-&gt;frontend.i2c
op_assign
id|i2c
suffix:semicolon
id|fe-&gt;frontend.data
op_assign
id|data
suffix:semicolon
id|fe-&gt;info
op_assign
id|info
suffix:semicolon
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_ioctl_list
)paren
(brace
r_struct
id|dvb_frontend_ioctl_data
op_star
id|ioctl
suffix:semicolon
id|ioctl
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_ioctl_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioctl-&gt;adapter
op_eq
id|i2c-&gt;adapter
)paren
(brace
id|fe-&gt;frontend.before_ioctl
op_assign
id|ioctl-&gt;before_ioctl
suffix:semicolon
id|fe-&gt;frontend.after_ioctl
op_assign
id|ioctl-&gt;after_ioctl
suffix:semicolon
id|fe-&gt;frontend.before_after_data
op_assign
id|ioctl-&gt;before_after_data
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|list_for_each
(paren
id|entry
comma
op_amp
id|frontend_notifier_list
)paren
(brace
r_struct
id|dvb_frontend_notifier_data
op_star
id|notifier
suffix:semicolon
id|notifier
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_notifier_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notifier-&gt;adapter
op_eq
id|i2c-&gt;adapter
)paren
(brace
id|fe-&gt;frontend.notifier_callback
op_assign
id|notifier-&gt;callback
suffix:semicolon
id|fe-&gt;frontend.notifier_data
op_assign
id|notifier-&gt;data
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|list_add_tail
(paren
op_amp
id|fe-&gt;list_head
comma
op_amp
id|frontend_list
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;DVB: registering frontend %i:%i (%s)...&bslash;n&quot;
comma
id|fe-&gt;frontend.i2c-&gt;adapter-&gt;num
comma
id|fe-&gt;frontend.i2c-&gt;id
comma
id|fe-&gt;info-&gt;name
)paren
suffix:semicolon
id|dvb_register_device
(paren
id|i2c-&gt;adapter
comma
op_amp
id|fe-&gt;dvbdev
comma
op_amp
id|dvbdev_template
comma
id|fe
comma
id|DVB_DEVICE_FRONTEND
)paren
suffix:semicolon
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_unregister_frontend
r_int
id|dvb_unregister_frontend
(paren
r_int
(paren
op_star
id|ioctl
)paren
(paren
r_struct
id|dvb_frontend
op_star
id|frontend
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
comma
r_struct
id|dvb_i2c_bus
op_star
id|i2c
)paren
(brace
r_struct
id|list_head
op_star
id|entry
comma
op_star
id|n
suffix:semicolon
id|dprintk
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|down
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
id|list_for_each_safe
(paren
id|entry
comma
id|n
comma
op_amp
id|frontend_list
)paren
(brace
r_struct
id|dvb_frontend_data
op_star
id|fe
suffix:semicolon
id|fe
op_assign
id|list_entry
(paren
id|entry
comma
r_struct
id|dvb_frontend_data
comma
id|list_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fe-&gt;frontend.ioctl
op_eq
id|ioctl
op_logical_and
id|fe-&gt;frontend.i2c
op_eq
id|i2c
)paren
(brace
id|dvb_unregister_device
(paren
id|fe-&gt;dvbdev
)paren
suffix:semicolon
id|list_del
(paren
id|entry
)paren
suffix:semicolon
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
id|dvb_frontend_stop
(paren
id|fe
)paren
suffix:semicolon
id|kfree
(paren
id|fe
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|up
(paren
op_amp
id|frontend_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|MODULE_PARM
c_func
(paren
id|dvb_frontend_debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dvb_shutdown_timeout
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dvb_frontend_debug
comma
l_string|&quot;enable verbose debug messages&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dvb_shutdown_timeout
comma
l_string|&quot;wait &lt;shutdown_timeout&gt; seconds after close() before suspending hardware&quot;
)paren
suffix:semicolon
eof
