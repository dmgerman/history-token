multiline_comment|/*&n; * Frontend driver for mobile DVB-T demodulator DiBcom 3000-MC/P&n; * DiBcom (http://www.dibcom.fr/)&n; *&n; * Copyright (C) 2004-5 Patrick Boettcher (patrick.boettcher@desy.de)&n; *&n; * based on GPL code from DiBCom, which has&n; *&n; * Copyright (C) 2004 Amaury Demol for DiBcom (ademol@dibcom.fr)&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License as&n; *&t;published by the Free Software Foundation, version 2.&n; *&n; * Acknowledgements&n; *&n; *  Amaury Demol (ademol@dibcom.fr) from DiBcom for providing specs and driver&n; *  sources, on which this driver (and the dvb-dibusb) are based.&n; *&n; * see Documentation/dvb/README.dibusb for more information&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;dib3000-common.h&quot;
macro_line|#include &quot;dib3000mc_priv.h&quot;
macro_line|#include &quot;dib3000.h&quot;
multiline_comment|/* Version information */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;0.1&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;DiBcom 3000-MC DVB-T demodulator driver&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Patrick Boettcher, patrick.boettcher@desy.de&quot;
macro_line|#ifdef CONFIG_DVB_DIBCOM_DEBUG
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;set debugging level (1=info,2=xfer,4=setfe,8=getfe,16=stat (|-able)).&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|deb_info
mdefine_line|#define deb_info(args...) dprintk(0x01,args)
DECL|macro|deb_xfer
mdefine_line|#define deb_xfer(args...) dprintk(0x02,args)
DECL|macro|deb_setf
mdefine_line|#define deb_setf(args...) dprintk(0x04,args)
DECL|macro|deb_getf
mdefine_line|#define deb_getf(args...) dprintk(0x08,args)
DECL|macro|deb_stat
mdefine_line|#define deb_stat(args...) dprintk(0x10,args)
r_static
r_int
id|dib3000mc_tuner_pass_ctrl
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
comma
id|u8
id|pll_addr
)paren
suffix:semicolon
DECL|function|dib3000mc_set_impulse_noise
r_static
r_int
id|dib3000mc_set_impulse_noise
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
comma
r_int
id|mode
comma
id|fe_transmit_mode_t
id|transmission_mode
comma
id|fe_bandwidth_t
id|bandwidth
)paren
(brace
r_switch
c_cond
(paren
id|transmission_mode
)paren
(brace
r_case
id|TRANSMISSION_MODE_2K
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_fft
comma
id|dib3000mc_fft_modes
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_8K
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_fft
comma
id|dib3000mc_fft_modes
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bandwidth
)paren
(brace
multiline_comment|/*&t;&t;case BANDWIDTH_5_MHZ:&n;&t;&t;&t;wr_foreach(dib3000mc_reg_impulse_noise,dib3000mc_impluse_noise[0]);&n;&t;&t;&t;break; */
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_impulse_noise
comma
id|dib3000mc_impluse_noise
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_impulse_noise
comma
id|dib3000mc_impluse_noise
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_impulse_noise
comma
id|dib3000mc_impluse_noise
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* no impulse */
multiline_comment|/* fall through */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_imp_noise_ctl
comma
id|dib3000mc_imp_noise_ctl
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* new algo */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_imp_noise_ctl
comma
id|dib3000mc_imp_noise_ctl
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|set_or
c_func
(paren
id|DIB3000MC_REG_IMP_NOISE_55
comma
id|DIB3000MC_IMP_NEW_ALGO
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* gives 1&lt;&lt;10 */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* old algo */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_imp_noise_ctl
comma
id|dib3000mc_imp_noise_ctl
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_set_timing
r_static
r_int
id|dib3000mc_set_timing
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
comma
r_int
id|upd_offset
comma
id|fe_transmit_mode_t
id|fft
comma
id|fe_bandwidth_t
id|bw
)paren
(brace
id|u16
id|timf_msb
comma
id|timf_lsb
suffix:semicolon
id|s32
id|tim_offset
comma
id|tim_sgn
suffix:semicolon
id|u64
id|comp1
comma
id|comp2
comma
id|comp
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|bw
)paren
(brace
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|comp
op_assign
id|DIB3000MC_CLOCK_REF
op_star
l_int|8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|comp
op_assign
id|DIB3000MC_CLOCK_REF
op_star
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|comp
op_assign
id|DIB3000MC_CLOCK_REF
op_star
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unknown bandwidth (%d)&quot;
comma
id|bw
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|timf_msb
op_assign
(paren
id|comp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|timf_lsb
op_assign
(paren
id|comp
op_amp
l_int|0xffff
)paren
suffix:semicolon
singleline_comment|// Update the timing offset ;
r_if
c_cond
(paren
id|upd_offset
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;timing_offset_comp_done
)paren
(brace
id|msleep
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|state-&gt;timing_offset_comp_done
op_assign
l_int|1
suffix:semicolon
)brace
id|tim_offset
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_TIMING_OFFS_MSB
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tim_offset
op_amp
l_int|0x2000
)paren
op_eq
l_int|0x2000
)paren
id|tim_offset
op_or_assign
l_int|0xC000
suffix:semicolon
r_if
c_cond
(paren
id|fft
op_eq
id|TRANSMISSION_MODE_2K
)paren
id|tim_offset
op_lshift_assign
l_int|2
suffix:semicolon
id|state-&gt;timing_offset
op_add_assign
id|tim_offset
suffix:semicolon
)brace
id|tim_offset
op_assign
id|state-&gt;timing_offset
suffix:semicolon
r_if
c_cond
(paren
id|tim_offset
OL
l_int|0
)paren
(brace
id|tim_sgn
op_assign
l_int|1
suffix:semicolon
id|tim_offset
op_assign
op_minus
id|tim_offset
suffix:semicolon
)brace
r_else
id|tim_sgn
op_assign
l_int|0
suffix:semicolon
id|comp1
op_assign
(paren
id|u32
)paren
id|tim_offset
op_star
(paren
id|u32
)paren
id|timf_lsb
suffix:semicolon
id|comp2
op_assign
(paren
id|u32
)paren
id|tim_offset
op_star
(paren
id|u32
)paren
id|timf_msb
suffix:semicolon
id|comp
op_assign
(paren
(paren
id|comp1
op_rshift
l_int|16
)paren
op_plus
id|comp2
)paren
op_rshift
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|tim_sgn
op_eq
l_int|0
)paren
id|comp
op_assign
(paren
id|u32
)paren
(paren
id|timf_msb
op_lshift
l_int|16
)paren
op_plus
(paren
id|u32
)paren
id|timf_lsb
op_plus
id|comp
suffix:semicolon
r_else
id|comp
op_assign
(paren
id|u32
)paren
(paren
id|timf_msb
op_lshift
l_int|16
)paren
op_plus
(paren
id|u32
)paren
id|timf_lsb
op_minus
id|comp
suffix:semicolon
id|timf_msb
op_assign
(paren
id|comp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|timf_lsb
op_assign
id|comp
op_amp
l_int|0xffff
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_TIMING_FREQ_MSB
comma
id|timf_msb
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_TIMING_FREQ_LSB
comma
id|timf_lsb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_init_auto_scan
r_static
r_int
id|dib3000mc_init_auto_scan
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
comma
id|fe_bandwidth_t
id|bw
comma
r_int
id|boost
)paren
(brace
r_if
c_cond
(paren
id|boost
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MC_REG_SCAN_BOOST
comma
id|DIB3000MC_SCAN_BOOST_ON
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MC_REG_SCAN_BOOST
comma
id|DIB3000MC_SCAN_BOOST_OFF
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|bw
)paren
(brace
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth
comma
id|dib3000mc_bandwidth_8mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth
comma
id|dib3000mc_bandwidth_7mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth
comma
id|dib3000mc_bandwidth_6mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/*&t;&t;case BANDWIDTH_5_MHZ:&n;&t;&t;&t;wr_foreach(dib3000mc_reg_bandwidth,dib3000mc_bandwidth_5mhz);&n;&t;&t;&t;break;*/
r_case
id|BANDWIDTH_AUTO
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unknown bandwidth value (%d).&quot;
comma
id|bw
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|boost
)paren
(brace
id|u32
id|timeout
op_assign
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_BW_TIMOUT_MSB
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MC_REG_BW_TIMOUT_LSB
)paren
suffix:semicolon
id|timeout
op_mul_assign
l_int|85
suffix:semicolon
id|timeout
op_rshift_assign
l_int|7
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_BW_TIMOUT_MSB
comma
(paren
id|timeout
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_BW_TIMOUT_LSB
comma
id|timeout
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_set_adp_cfg
r_static
r_int
id|dib3000mc_set_adp_cfg
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
comma
id|fe_modulation_t
id|con
)paren
(brace
r_switch
c_cond
(paren
id|con
)paren
(brace
r_case
id|QAM_64
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_adp_cfg
comma
id|dib3000mc_adp_cfg
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_16
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_adp_cfg
comma
id|dib3000mc_adp_cfg
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QPSK
suffix:colon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_adp_cfg
comma
id|dib3000mc_adp_cfg
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|warn
c_func
(paren
l_string|&quot;unkown constellation.&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_set_general_cfg
r_static
r_int
id|dib3000mc_set_general_cfg
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
comma
r_int
op_star
id|auto_val
)paren
(brace
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
id|fe_cr
op_assign
id|FEC_NONE
suffix:semicolon
id|u8
id|fft
op_assign
l_int|0
comma
id|guard
op_assign
l_int|0
comma
id|qam
op_assign
l_int|0
comma
id|alpha
op_assign
l_int|0
comma
id|sel_hp
op_assign
l_int|0
comma
id|cr
op_assign
l_int|0
comma
id|hrch
op_assign
l_int|0
suffix:semicolon
r_int
id|seq
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;transmission_mode
)paren
(brace
r_case
id|TRANSMISSION_MODE_2K
suffix:colon
id|fft
op_assign
id|DIB3000_TRANSMISSION_MODE_2K
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_8K
suffix:colon
id|fft
op_assign
id|DIB3000_TRANSMISSION_MODE_8K
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ofdm-&gt;guard_interval
)paren
(brace
r_case
id|GUARD_INTERVAL_1_32
suffix:colon
id|guard
op_assign
id|DIB3000_GUARD_TIME_1_32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_16
suffix:colon
id|guard
op_assign
id|DIB3000_GUARD_TIME_1_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_8
suffix:colon
id|guard
op_assign
id|DIB3000_GUARD_TIME_1_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_4
suffix:colon
id|guard
op_assign
id|DIB3000_GUARD_TIME_1_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ofdm-&gt;constellation
)paren
(brace
r_case
id|QPSK
suffix:colon
id|qam
op_assign
id|DIB3000_CONSTELLATION_QPSK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_16
suffix:colon
id|qam
op_assign
id|DIB3000_CONSTELLATION_16QAM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_64
suffix:colon
id|qam
op_assign
id|DIB3000_CONSTELLATION_64QAM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ofdm-&gt;hierarchy_information
)paren
(brace
r_case
id|HIERARCHY_NONE
suffix:colon
multiline_comment|/* fall through */
r_case
id|HIERARCHY_1
suffix:colon
id|alpha
op_assign
id|DIB3000_ALPHA_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_2
suffix:colon
id|alpha
op_assign
id|DIB3000_ALPHA_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_4
suffix:colon
id|alpha
op_assign
id|DIB3000_ALPHA_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_NONE
)paren
(brace
id|hrch
op_assign
id|DIB3000_HRCH_OFF
suffix:semicolon
id|sel_hp
op_assign
id|DIB3000_SELECT_HP
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_HP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_ne
id|HIERARCHY_AUTO
)paren
(brace
id|hrch
op_assign
id|DIB3000_HRCH_ON
suffix:semicolon
id|sel_hp
op_assign
id|DIB3000_SELECT_LP
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_LP
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|fe_cr
)paren
(brace
r_case
id|FEC_1_2
suffix:colon
id|cr
op_assign
id|DIB3000_FEC_1_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_2_3
suffix:colon
id|cr
op_assign
id|DIB3000_FEC_2_3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_3_4
suffix:colon
id|cr
op_assign
id|DIB3000_FEC_3_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_5_6
suffix:colon
id|cr
op_assign
id|DIB3000_FEC_5_6
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_7_8
suffix:colon
id|cr
op_assign
id|DIB3000_FEC_7_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_NONE
suffix:colon
r_break
suffix:semicolon
r_case
id|FEC_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|DIB3000MC_DEMOD_PARM
c_func
(paren
id|alpha
comma
id|qam
comma
id|guard
comma
id|fft
)paren
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_HRCH_PARM
comma
id|DIB3000MC_HRCH_PARM
c_func
(paren
id|sel_hp
comma
id|cr
comma
id|hrch
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fep-&gt;inversion
)paren
(brace
r_case
id|INVERSION_OFF
suffix:colon
id|wr
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_MSB
comma
id|DIB3000MC_DDS_FREQ_MSB_INV_OFF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVERSION_AUTO
suffix:colon
multiline_comment|/* fall through */
r_case
id|INVERSION_ON
suffix:colon
id|wr
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_MSB
comma
id|DIB3000MC_DDS_FREQ_MSB_INV_ON
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|seq
op_assign
id|dib3000_seq
(braket
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_AUTO
)braket
(braket
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_AUTO
)braket
(braket
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
)braket
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;seq? %d&bslash;n&quot;
comma
id|seq
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SEQ_TPS
comma
id|DIB3000MC_SEQ_TPS
c_func
(paren
id|seq
comma
l_int|1
)paren
)paren
suffix:semicolon
op_star
id|auto_val
op_assign
id|ofdm-&gt;constellation
op_eq
id|QAM_AUTO
op_logical_or
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_AUTO
op_logical_or
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_AUTO
op_logical_or
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_AUTO
op_logical_or
id|fe_cr
op_eq
id|FEC_AUTO
op_logical_or
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_get_frontend
r_static
r_int
id|dib3000mc_get_frontend
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
op_star
id|cr
suffix:semicolon
id|u16
id|tps_val
comma
id|cr_val
suffix:semicolon
r_int
id|inv_test1
comma
id|inv_test2
suffix:semicolon
id|u32
id|dds_val
comma
id|threshold
op_assign
l_int|0x1000000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_LOCK_507
)paren
op_amp
id|DIB3000MC_LOCK_507
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|dds_val
op_assign
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_DDS_FREQ_MSB
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MC_REG_DDS_FREQ_LSB
)paren
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;DDS_FREQ: %6x&bslash;n&quot;
comma
id|dds_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
OL
id|threshold
)paren
id|inv_test1
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test1
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test1
op_assign
l_int|2
suffix:semicolon
id|dds_val
op_assign
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_MSB
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_LSB
)paren
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;DDS_SET_FREQ: %6x&bslash;n&quot;
comma
id|dds_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
OL
id|threshold
)paren
id|inv_test2
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test2
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test2
op_assign
l_int|2
suffix:semicolon
id|fep-&gt;inversion
op_assign
(paren
(paren
id|inv_test2
op_eq
l_int|2
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|0
)paren
)paren
op_logical_or
(paren
(paren
id|inv_test2
op_eq
l_int|0
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|2
)paren
)paren
ques
c_cond
id|INVERSION_ON
suffix:colon
id|INVERSION_OFF
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;inversion %d %d, %d&bslash;n&quot;
comma
id|inv_test2
comma
id|inv_test1
comma
id|fep-&gt;inversion
)paren
suffix:semicolon
id|fep-&gt;frequency
op_assign
id|state-&gt;last_tuned_freq
suffix:semicolon
id|fep-&gt;u.ofdm.bandwidth
op_assign
id|state-&gt;last_tuned_bw
suffix:semicolon
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_TUNING_PARM
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|DIB3000MC_TP_QAM
c_func
(paren
id|tps_val
)paren
)paren
(brace
r_case
id|DIB3000_CONSTELLATION_QPSK
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QPSK &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QPSK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_CONSTELLATION_16QAM
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_CONSTELLATION_64QAM
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM64 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_64
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected constellation returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DIB3000MC_TP_HRCH
c_func
(paren
id|tps_val
)paren
)paren
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH ON &quot;
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_LP
suffix:semicolon
id|ofdm-&gt;code_rate_HP
op_assign
id|FEC_NONE
suffix:semicolon
r_switch
c_cond
(paren
id|DIB3000MC_TP_ALPHA
c_func
(paren
id|tps_val
)paren
)paren
(brace
r_case
id|DIB3000_ALPHA_0
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_NONE &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_1
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_1 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_2 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected ALPHA value returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cr_val
op_assign
id|DIB3000MC_TP_FEC_CR_LP
c_func
(paren
id|tps_val
)paren
suffix:semicolon
)brace
r_else
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH OFF &quot;
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_HP
suffix:semicolon
id|ofdm-&gt;code_rate_LP
op_assign
id|FEC_NONE
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
id|cr_val
op_assign
id|DIB3000MC_TP_FEC_CR_HP
c_func
(paren
id|tps_val
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cr_val
)paren
(brace
r_case
id|DIB3000_FEC_1_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_1_2 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_1_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_2_3
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_2_3 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_2_3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_3_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_3_4 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_3_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_5_6
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_5_6 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_4_5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_7_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_7_8 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_7_8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected FEC returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|DIB3000MC_TP_GUARD
c_func
(paren
id|tps_val
)paren
)paren
(brace
r_case
id|DIB3000_GUARD_TIME_1_32
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_32 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_16
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_8 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected Guard Time returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|DIB3000MC_TP_FFT
c_func
(paren
id|tps_val
)paren
)paren
(brace
r_case
id|DIB3000_TRANSMISSION_MODE_2K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_2K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_2K
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_TRANSMISSION_MODE_8K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_8K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_8K
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unexpected transmission mode return by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_set_frontend
r_static
r_int
id|dib3000mc_set_frontend
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
comma
r_int
id|tuner
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
r_int
id|search_state
comma
id|auto_val
suffix:semicolon
id|u16
id|val
suffix:semicolon
r_if
c_cond
(paren
id|tuner
)paren
(brace
multiline_comment|/* initial call from dvb */
id|dib3000mc_tuner_pass_ctrl
c_func
(paren
id|fe
comma
l_int|1
comma
id|state-&gt;config
dot
id|pll_addr
c_func
(paren
id|fe
)paren
)paren
suffix:semicolon
id|state-&gt;config
dot
id|pll_set
c_func
(paren
id|fe
comma
id|fep
comma
l_int|NULL
)paren
suffix:semicolon
id|dib3000mc_tuner_pass_ctrl
c_func
(paren
id|fe
comma
l_int|0
comma
id|state-&gt;config
dot
id|pll_addr
c_func
(paren
id|fe
)paren
)paren
suffix:semicolon
id|state-&gt;last_tuned_freq
op_assign
id|fep-&gt;frequency
suffix:semicolon
singleline_comment|//&t;if (!scanboost) {
id|dib3000mc_set_timing
c_func
(paren
id|state
comma
l_int|0
comma
id|ofdm-&gt;transmission_mode
comma
id|ofdm-&gt;bandwidth
)paren
suffix:semicolon
id|dib3000mc_init_auto_scan
c_func
(paren
id|state
comma
id|ofdm-&gt;bandwidth
comma
l_int|0
)paren
suffix:semicolon
id|state-&gt;last_tuned_bw
op_assign
id|ofdm-&gt;bandwidth
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_agc_bandwidth
comma
id|dib3000mc_agc_bandwidth
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RESTART
comma
id|DIB3000MC_RESTART_AGC
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RESTART
comma
id|DIB3000MC_RESTART_OFF
)paren
suffix:semicolon
multiline_comment|/* Default cfg isi offset adp */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_offset
comma
id|dib3000mc_offset
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_ISI
comma
id|DIB3000MC_ISI_DEFAULT
op_or
id|DIB3000MC_ISI_INHIBIT
)paren
suffix:semicolon
id|dib3000mc_set_adp_cfg
c_func
(paren
id|state
comma
id|ofdm-&gt;constellation
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_133
comma
id|DIB3000MC_UNK_133
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth_general
comma
id|dib3000mc_bandwidth_general
)paren
suffix:semicolon
multiline_comment|/* power smoothing */
r_if
c_cond
(paren
id|ofdm-&gt;bandwidth
op_ne
id|BANDWIDTH_8_MHZ
)paren
(brace
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bw
comma
id|dib3000mc_bw
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bw
comma
id|dib3000mc_bw
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
id|auto_val
op_assign
l_int|0
suffix:semicolon
id|dib3000mc_set_general_cfg
c_func
(paren
id|state
comma
id|fep
comma
op_amp
id|auto_val
)paren
suffix:semicolon
id|dib3000mc_set_impulse_noise
c_func
(paren
id|state
comma
l_int|0
comma
id|ofdm-&gt;constellation
comma
id|ofdm-&gt;bandwidth
)paren
suffix:semicolon
id|val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
op_or
id|DIB3000MC_DEMOD_RST_DEMOD_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
)paren
suffix:semicolon
singleline_comment|//&t;}
id|msleep
c_func
(paren
l_int|70
)paren
suffix:semicolon
multiline_comment|/* something has to be auto searched */
r_if
c_cond
(paren
id|auto_val
)paren
(brace
r_int
id|as_count
op_assign
l_int|0
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;autosearch enabled.&bslash;n&quot;
)paren
suffix:semicolon
id|val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
op_or
id|DIB3000MC_DEMOD_RST_AUTO_SRCH_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|search_state
op_assign
id|dib3000_search_status
c_func
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_AS_IRQ
)paren
comma
l_int|1
)paren
)paren
OL
l_int|0
op_logical_and
id|as_count
op_increment
OL
l_int|100
)paren
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;search_state after autosearch %d after %d checks&bslash;n&quot;
comma
id|search_state
comma
id|as_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|search_state
op_eq
l_int|1
)paren
(brace
r_struct
id|dvb_frontend_parameters
id|feps
suffix:semicolon
r_if
c_cond
(paren
id|dib3000mc_get_frontend
c_func
(paren
id|fe
comma
op_amp
id|feps
)paren
op_eq
l_int|0
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;reading tuning data from frontend succeeded.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mc_set_frontend
c_func
(paren
id|fe
comma
op_amp
id|feps
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|dib3000mc_set_impulse_noise
c_func
(paren
id|state
comma
l_int|0
comma
id|ofdm-&gt;transmission_mode
comma
id|ofdm-&gt;bandwidth
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_ISI
comma
id|DIB3000MC_ISI_DEFAULT
op_or
id|DIB3000MC_ISI_ACTIVATE
)paren
suffix:semicolon
id|dib3000mc_set_adp_cfg
c_func
(paren
id|state
comma
id|ofdm-&gt;constellation
)paren
suffix:semicolon
multiline_comment|/* set_offset_cfg */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_offset
comma
id|dib3000mc_offset
(braket
(paren
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_8K
)paren
op_plus
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* second call, after autosearch (fka: set_WithKnownParams) */
singleline_comment|//&t;&t;dib3000mc_set_timing(state,1,ofdm-&gt;transmission_mode,ofdm-&gt;bandwidth);
id|auto_val
op_assign
l_int|0
suffix:semicolon
id|dib3000mc_set_general_cfg
c_func
(paren
id|state
comma
id|fep
comma
op_amp
id|auto_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|auto_val
)paren
id|deb_info
c_func
(paren
l_string|&quot;auto_val is true, even though an auto search was already performed.&bslash;n&quot;
)paren
suffix:semicolon
id|dib3000mc_set_impulse_noise
c_func
(paren
id|state
comma
l_int|0
comma
id|ofdm-&gt;constellation
comma
id|ofdm-&gt;bandwidth
)paren
suffix:semicolon
id|val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
op_or
id|DIB3000MC_DEMOD_RST_AUTO_SRCH_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DEMOD_PARM
comma
id|val
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|30
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_ISI
comma
id|DIB3000MC_ISI_DEFAULT
op_or
id|DIB3000MC_ISI_ACTIVATE
)paren
suffix:semicolon
id|dib3000mc_set_adp_cfg
c_func
(paren
id|state
comma
id|ofdm-&gt;constellation
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_offset
comma
id|dib3000mc_offset
(braket
(paren
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_8K
)paren
op_plus
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_fe_init
r_static
r_int
id|dib3000mc_fe_init
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|mobile_mode
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;init start&bslash;n&quot;
)paren
suffix:semicolon
id|state
op_assign
id|fe-&gt;demodulator_priv
suffix:semicolon
id|state-&gt;timing_offset
op_assign
l_int|0
suffix:semicolon
id|state-&gt;timing_offset_comp_done
op_assign
l_int|0
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RESTART
comma
id|DIB3000MC_RESTART_CONFIG
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RESTART
comma
id|DIB3000MC_RESTART_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_1
comma
id|DIB3000MC_CLK_CFG_1_POWER_UP
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_2
comma
id|DIB3000MC_CLK_CFG_2_PUP_MOBILE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_3
comma
id|DIB3000MC_CLK_CFG_3_POWER_UP
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_7
comma
id|DIB3000MC_CLK_CFG_7_INIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RST_UNC
comma
id|DIB3000MC_RST_UNC_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_19
comma
id|DIB3000MC_UNK_19
)paren
suffix:semicolon
id|wr
c_func
(paren
l_int|33
comma
l_int|5
)paren
suffix:semicolon
id|wr
c_func
(paren
l_int|36
comma
l_int|81
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_88
comma
id|DIB3000MC_UNK_88
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_99
comma
id|DIB3000MC_UNK_99
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_111
comma
id|DIB3000MC_UNK_111_PH_N_MODE_0
)paren
suffix:semicolon
multiline_comment|/* phase noise algo off */
multiline_comment|/* mobile mode - portable reception */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_mobile_mode
comma
id|dib3000mc_mobile_mode
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* TUNER_PANASONIC_ENV57H12D5: */
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_agc_bandwidth
comma
id|dib3000mc_agc_bandwidth
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_agc_bandwidth_general
comma
id|dib3000mc_agc_bandwidth_general
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_agc
comma
id|dib3000mc_agc_tuner
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_110
comma
id|DIB3000MC_UNK_110
)paren
suffix:semicolon
id|wr
c_func
(paren
l_int|26
comma
l_int|0x6680
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_1
comma
id|DIB3000MC_UNK_1
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_2
comma
id|DIB3000MC_UNK_2
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_3
comma
id|DIB3000MC_UNK_3
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SEQ_TPS
comma
id|DIB3000MC_SEQ_TPS_DEFAULT
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth
comma
id|dib3000mc_bandwidth_8mhz
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mc_reg_bandwidth_general
comma
id|dib3000mc_bandwidth_general
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_4
comma
id|DIB3000MC_UNK_4
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_MSB
comma
id|DIB3000MC_DDS_FREQ_MSB_INV_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SET_DDS_FREQ_LSB
comma
id|DIB3000MC_DDS_FREQ_LSB
)paren
suffix:semicolon
id|dib3000mc_set_timing
c_func
(paren
id|state
comma
l_int|0
comma
id|TRANSMISSION_MODE_8K
comma
id|BANDWIDTH_8_MHZ
)paren
suffix:semicolon
singleline_comment|//&t;wr_foreach(dib3000mc_reg_timing_freq,dib3000mc_timing_freq[3]);
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_120
comma
id|DIB3000MC_UNK_120
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_UNK_134
comma
id|DIB3000MC_UNK_134
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_FEC_CFG
comma
id|DIB3000MC_FEC_CFG
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DIVERSITY3
comma
id|DIB3000MC_DIVERSITY3_IN_OFF
)paren
suffix:semicolon
id|dib3000mc_set_impulse_noise
c_func
(paren
id|state
comma
l_int|0
comma
id|TRANSMISSION_MODE_8K
comma
id|BANDWIDTH_8_MHZ
)paren
suffix:semicolon
multiline_comment|/* output mode control, just the MPEG2_SLAVE */
singleline_comment|//&t;set_or(DIB3000MC_REG_OUTMODE,DIB3000MC_OM_SLAVE);
id|wr
c_func
(paren
id|DIB3000MC_REG_OUTMODE
comma
id|DIB3000MC_OM_SLAVE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
comma
id|DIB3000MC_SMO_MODE_SLAVE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_FIFO_THRESHOLD
comma
id|DIB3000MC_FIFO_THRESHOLD_SLAVE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_ELEC_OUT
comma
id|DIB3000MC_ELEC_OUT_SLAVE
)paren
suffix:semicolon
multiline_comment|/* MPEG2_PARALLEL_CONTINUOUS_CLOCK&n;&t;wr(DIB3000MC_REG_OUTMODE,&n;&t;&t;DIB3000MC_SET_OUTMODE(DIB3000MC_OM_PAR_CONT_CLK,&n;&t;&t;&t;rd(DIB3000MC_REG_OUTMODE)));&n;&n;&t;wr(DIB3000MC_REG_SMO_MODE,&n;&t;&t;&t;DIB3000MC_SMO_MODE_DEFAULT |&n;&t;&t;&t;DIB3000MC_SMO_MODE_188);&n;&n;&t;wr(DIB3000MC_REG_FIFO_THRESHOLD,DIB3000MC_FIFO_THRESHOLD_DEFAULT);&n;&t;wr(DIB3000MC_REG_ELEC_OUT,DIB3000MC_ELEC_OUT_DIV_OUT_ON);&n;*/
multiline_comment|/* diversity */
id|wr
c_func
(paren
id|DIB3000MC_REG_DIVERSITY1
comma
id|DIB3000MC_DIVERSITY1_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_DIVERSITY2
comma
id|DIB3000MC_DIVERSITY2_DEFAULT
)paren
suffix:semicolon
id|set_and
c_func
(paren
id|DIB3000MC_REG_DIVERSITY3
comma
id|DIB3000MC_DIVERSITY3_IN_OFF
)paren
suffix:semicolon
id|set_or
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_7
comma
id|DIB3000MC_CLK_CFG_7_DIV_IN_OFF
)paren
suffix:semicolon
multiline_comment|/*&t;if (state-&gt;config-&gt;pll_init) {&n;&t;&t;dib3000mc_tuner_pass_ctrl(fe,1,state-&gt;config.pll_addr(fe));&n;&t;&t;state-&gt;config-&gt;pll_init(fe,NULL);&n;&t;&t;dib3000mc_tuner_pass_ctrl(fe,0,state-&gt;config.pll_addr(fe));&n;&t;}*/
id|deb_info
c_func
(paren
l_string|&quot;init end&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_read_status
r_static
r_int
id|dib3000mc_read_status
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|fe_status_t
op_star
id|stat
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|u16
id|lock
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_LOCKING
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|DIB3000MC_AGC_LOCK
c_func
(paren
id|lock
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_SIGNAL
suffix:semicolon
r_if
c_cond
(paren
id|DIB3000MC_CARRIER_LOCK
c_func
(paren
id|lock
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_CARRIER
suffix:semicolon
r_if
c_cond
(paren
id|DIB3000MC_TPS_LOCK
c_func
(paren
id|lock
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_VITERBI
suffix:semicolon
r_if
c_cond
(paren
id|DIB3000MC_MPEG_SYNC_LOCK
c_func
(paren
id|lock
)paren
)paren
op_star
id|stat
op_or_assign
(paren
id|FE_HAS_SYNC
op_or
id|FE_HAS_LOCK
)paren
suffix:semicolon
id|deb_stat
c_func
(paren
l_string|&quot;actual status is %2x fifo_level: %x,244: %x, 206: %x, 207: %x, 1040: %x&bslash;n&quot;
comma
op_star
id|stat
comma
id|rd
c_func
(paren
l_int|510
)paren
comma
id|rd
c_func
(paren
l_int|244
)paren
comma
id|rd
c_func
(paren
l_int|206
)paren
comma
id|rd
c_func
(paren
l_int|207
)paren
comma
id|rd
c_func
(paren
l_int|1040
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_read_ber
r_static
r_int
id|dib3000mc_read_ber
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u32
op_star
id|ber
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
op_star
id|ber
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MC_REG_BER_MSB
)paren
op_lshift
l_int|16
)paren
op_or
id|rd
c_func
(paren
id|DIB3000MC_REG_BER_LSB
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_read_unc_blocks
r_static
r_int
id|dib3000mc_read_unc_blocks
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u32
op_star
id|unc
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
op_star
id|unc
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_PACKET_ERROR_COUNT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* see dib3000mb.c for calculation comments */
DECL|function|dib3000mc_read_signal_strength
r_static
r_int
id|dib3000mc_read_signal_strength
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u16
op_star
id|strength
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|u16
id|val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_SIGNAL_NOISE_LSB
)paren
suffix:semicolon
op_star
id|strength
op_assign
(paren
(paren
(paren
id|val
op_rshift
l_int|6
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_plus
(paren
id|val
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|deb_stat
c_func
(paren
l_string|&quot;signal: mantisse = %d, exponent = %d&bslash;n&quot;
comma
(paren
op_star
id|strength
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
op_star
id|strength
op_amp
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* see dib3000mb.c for calculation comments */
DECL|function|dib3000mc_read_snr
r_static
r_int
id|dib3000mc_read_snr
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u16
op_star
id|snr
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|u16
id|val
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_SIGNAL_NOISE_LSB
)paren
comma
id|val2
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_SIGNAL_NOISE_MSB
)paren
suffix:semicolon
id|u16
id|sig
comma
id|noise
suffix:semicolon
id|sig
op_assign
(paren
(paren
(paren
id|val
op_rshift
l_int|6
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_plus
(paren
id|val
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|noise
op_assign
(paren
(paren
(paren
id|val
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_plus
(paren
(paren
id|val
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
op_plus
(paren
(paren
id|val2
op_rshift
l_int|14
)paren
op_amp
l_int|0x3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|noise
op_eq
l_int|0
)paren
op_star
id|snr
op_assign
l_int|0xffff
suffix:semicolon
r_else
op_star
id|snr
op_assign
(paren
id|u16
)paren
id|sig
op_div
id|noise
suffix:semicolon
id|deb_stat
c_func
(paren
l_string|&quot;signal: mantisse = %d, exponent = %d&bslash;n&quot;
comma
(paren
id|sig
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|sig
op_amp
l_int|0xff
)paren
suffix:semicolon
id|deb_stat
c_func
(paren
l_string|&quot;noise:  mantisse = %d, exponent = %d&bslash;n&quot;
comma
(paren
id|noise
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|noise
op_amp
l_int|0xff
)paren
suffix:semicolon
id|deb_stat
c_func
(paren
l_string|&quot;snr: %d&bslash;n&quot;
comma
op_star
id|snr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_sleep
r_static
r_int
id|dib3000mc_sleep
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|set_or
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_7
comma
id|DIB3000MC_CLK_CFG_7_PWR_DOWN
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_1
comma
id|DIB3000MC_CLK_CFG_1_POWER_DOWN
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_2
comma
id|DIB3000MC_CLK_CFG_2_POWER_DOWN
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_CLK_CFG_3
comma
id|DIB3000MC_CLK_CFG_3_POWER_DOWN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_fe_get_tune_settings
r_static
r_int
id|dib3000mc_fe_get_tune_settings
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_tune_settings
op_star
id|tune
)paren
(brace
id|tune-&gt;min_delay_ms
op_assign
l_int|2000
suffix:semicolon
id|tune-&gt;step_size
op_assign
l_int|166667
suffix:semicolon
id|tune-&gt;max_drift
op_assign
l_int|166667
op_star
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_fe_init_nonmobile
r_static
r_int
id|dib3000mc_fe_init_nonmobile
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_return
id|dib3000mc_fe_init
c_func
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|dib3000mc_set_frontend_and_tuner
r_static
r_int
id|dib3000mc_set_frontend_and_tuner
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
(brace
r_return
id|dib3000mc_set_frontend
c_func
(paren
id|fe
comma
id|fep
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dib3000mc_release
r_static
r_void
id|dib3000mc_release
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/* pid filter and transfer stuff */
DECL|function|dib3000mc_pid_control
r_static
r_int
id|dib3000mc_pid_control
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|index
comma
r_int
id|pid
comma
r_int
id|onoff
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
id|fe-&gt;demodulator_priv
suffix:semicolon
id|pid
op_assign
(paren
id|onoff
ques
c_cond
id|pid
op_or
id|DIB3000_ACTIVATE_PID_FILTERING
suffix:colon
l_int|0
)paren
suffix:semicolon
id|wr
c_func
(paren
id|index
op_plus
id|DIB3000MC_REG_FIRST_PID
comma
id|pid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_fifo_control
r_static
r_int
id|dib3000mc_fifo_control
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|u16
id|tmp
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
)paren
suffix:semicolon
id|deb_xfer
c_func
(paren
l_string|&quot;%s fifo&bslash;n&quot;
comma
id|onoff
ques
c_cond
l_string|&quot;enabling&quot;
suffix:colon
l_string|&quot;disabling&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|onoff
)paren
(brace
id|deb_xfer
c_func
(paren
l_string|&quot;%d %x&bslash;n&quot;
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_FIFO_UNFLUSH
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_FIFO_UNFLUSH
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_FIFO_UNFLUSH
)paren
suffix:semicolon
)brace
r_else
(brace
id|deb_xfer
c_func
(paren
l_string|&quot;%d %x&bslash;n&quot;
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_FIFO_FLUSH
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_FIFO_FLUSH
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_FIFO_FLUSH
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_pid_parse
r_static
r_int
id|dib3000mc_pid_parse
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
id|fe-&gt;demodulator_priv
suffix:semicolon
id|u16
id|tmp
op_assign
id|rd
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
)paren
suffix:semicolon
id|deb_xfer
c_func
(paren
l_string|&quot;%s pid parsing&bslash;n&quot;
comma
id|onoff
ques
c_cond
l_string|&quot;enabling&quot;
suffix:colon
l_string|&quot;disabling&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|onoff
)paren
(brace
id|deb_xfer
c_func
(paren
l_string|&quot;%d %x&bslash;n&quot;
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_PID_PARSE
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_PID_PARSE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
comma
id|tmp
op_or
id|DIB3000MC_SMO_MODE_PID_PARSE
)paren
suffix:semicolon
)brace
r_else
(brace
id|deb_xfer
c_func
(paren
l_string|&quot;%d %x&bslash;n&quot;
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_NO_PID_PARSE
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_NO_PID_PARSE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_SMO_MODE
comma
id|tmp
op_amp
id|DIB3000MC_SMO_MODE_NO_PID_PARSE
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_tuner_pass_ctrl
r_static
r_int
id|dib3000mc_tuner_pass_ctrl
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
comma
id|u8
id|pll_addr
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_if
c_cond
(paren
id|onoff
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MC_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_ENABLE
c_func
(paren
id|pll_addr
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MC_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_DISABLE
c_func
(paren
id|pll_addr
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mc_demod_init
r_static
r_int
id|dib3000mc_demod_init
c_func
(paren
r_struct
id|dib3000_state
op_star
id|state
)paren
(brace
id|u16
id|default_addr
op_assign
l_int|0x0a
suffix:semicolon
multiline_comment|/* first init */
r_if
c_cond
(paren
id|state-&gt;config.demod_address
op_ne
id|default_addr
)paren
(brace
id|deb_info
c_func
(paren
l_string|&quot;initializing the demod the first time. Setting demod addr to 0x%x&bslash;n&quot;
comma
id|default_addr
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_ELEC_OUT
comma
id|DIB3000MC_ELEC_OUT_DIV_OUT_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_OUTMODE
comma
id|DIB3000MC_OM_PAR_CONT_CLK
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RST_I2C_ADDR
comma
id|DIB3000MC_DEMOD_ADDR
c_func
(paren
id|default_addr
)paren
op_or
id|DIB3000MC_DEMOD_ADDR_ON
)paren
suffix:semicolon
id|state-&gt;config.demod_address
op_assign
id|default_addr
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MC_REG_RST_I2C_ADDR
comma
id|DIB3000MC_DEMOD_ADDR
c_func
(paren
id|default_addr
)paren
)paren
suffix:semicolon
)brace
r_else
id|deb_info
c_func
(paren
l_string|&quot;demod is already initialized. Demod addr: 0x%x&bslash;n&quot;
comma
id|state-&gt;config.demod_address
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dib3000mc_ops
r_static
r_struct
id|dvb_frontend_ops
id|dib3000mc_ops
suffix:semicolon
DECL|function|dib3000mc_attach
r_struct
id|dvb_frontend
op_star
id|dib3000mc_attach
c_func
(paren
r_const
r_struct
id|dib3000_config
op_star
id|config
comma
r_struct
id|i2c_adapter
op_star
id|i2c
comma
r_struct
id|dib_fe_xfer_ops
op_star
id|xfer_ops
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|devid
suffix:semicolon
multiline_comment|/* allocate memory for the internal state */
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dib3000_state
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* setup the state */
id|state-&gt;i2c
op_assign
id|i2c
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|state-&gt;config
comma
id|config
comma
r_sizeof
(paren
r_struct
id|dib3000_config
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|state-&gt;ops
comma
op_amp
id|dib3000mc_ops
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_ops
)paren
)paren
suffix:semicolon
multiline_comment|/* check for the correct demod */
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000_REG_MANUFACTOR_ID
)paren
op_ne
id|DIB3000_I2C_ID_DIBCOM
)paren
r_goto
id|error
suffix:semicolon
id|devid
op_assign
id|rd
c_func
(paren
id|DIB3000_REG_DEVICE_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|devid
op_ne
id|DIB3000MC_DEVICE_ID
op_logical_and
id|devid
op_ne
id|DIB3000P_DEVICE_ID
)paren
r_goto
id|error
suffix:semicolon
r_switch
c_cond
(paren
id|devid
)paren
(brace
r_case
id|DIB3000MC_DEVICE_ID
suffix:colon
id|info
c_func
(paren
l_string|&quot;Found a DiBcom 3000-MC, interesting...&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000P_DEVICE_ID
suffix:colon
id|info
c_func
(paren
l_string|&quot;Found a DiBcom 3000-P.&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* create dvb_frontend */
id|state-&gt;frontend.ops
op_assign
op_amp
id|state-&gt;ops
suffix:semicolon
id|state-&gt;frontend.demodulator_priv
op_assign
id|state
suffix:semicolon
multiline_comment|/* set the xfer operations */
id|xfer_ops-&gt;pid_parse
op_assign
id|dib3000mc_pid_parse
suffix:semicolon
id|xfer_ops-&gt;fifo_ctrl
op_assign
id|dib3000mc_fifo_control
suffix:semicolon
id|xfer_ops-&gt;pid_ctrl
op_assign
id|dib3000mc_pid_control
suffix:semicolon
id|xfer_ops-&gt;tuner_pass_ctrl
op_assign
id|dib3000mc_tuner_pass_ctrl
suffix:semicolon
id|dib3000mc_demod_init
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
op_amp
id|state-&gt;frontend
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|state
)paren
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|dib3000mc_ops
r_static
r_struct
id|dvb_frontend_ops
id|dib3000mc_ops
op_assign
(brace
dot
id|info
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;DiBcom 3000-MC/P DVB-T&quot;
comma
dot
id|type
op_assign
id|FE_OFDM
comma
dot
id|frequency_min
op_assign
l_int|44250000
comma
dot
id|frequency_max
op_assign
l_int|867250000
comma
dot
id|frequency_stepsize
op_assign
l_int|62500
comma
dot
id|caps
op_assign
id|FE_CAN_INVERSION_AUTO
op_or
id|FE_CAN_FEC_1_2
op_or
id|FE_CAN_FEC_2_3
op_or
id|FE_CAN_FEC_3_4
op_or
id|FE_CAN_FEC_5_6
op_or
id|FE_CAN_FEC_7_8
op_or
id|FE_CAN_FEC_AUTO
op_or
id|FE_CAN_QPSK
op_or
id|FE_CAN_QAM_16
op_or
id|FE_CAN_QAM_64
op_or
id|FE_CAN_QAM_AUTO
op_or
id|FE_CAN_TRANSMISSION_MODE_AUTO
op_or
id|FE_CAN_GUARD_INTERVAL_AUTO
op_or
id|FE_CAN_RECOVER
op_or
id|FE_CAN_HIERARCHY_AUTO
comma
)brace
comma
dot
id|release
op_assign
id|dib3000mc_release
comma
dot
id|init
op_assign
id|dib3000mc_fe_init_nonmobile
comma
dot
id|sleep
op_assign
id|dib3000mc_sleep
comma
dot
id|set_frontend
op_assign
id|dib3000mc_set_frontend_and_tuner
comma
dot
id|get_frontend
op_assign
id|dib3000mc_get_frontend
comma
dot
id|get_tune_settings
op_assign
id|dib3000mc_fe_get_tune_settings
comma
dot
id|read_status
op_assign
id|dib3000mc_read_status
comma
dot
id|read_ber
op_assign
id|dib3000mc_read_ber
comma
dot
id|read_signal_strength
op_assign
id|dib3000mc_read_signal_strength
comma
dot
id|read_snr
op_assign
id|dib3000mc_read_snr
comma
dot
id|read_ucblocks
op_assign
id|dib3000mc_read_unc_blocks
comma
)brace
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|dib3000mc_attach
id|EXPORT_SYMBOL
c_func
(paren
id|dib3000mc_attach
)paren
suffix:semicolon
eof
