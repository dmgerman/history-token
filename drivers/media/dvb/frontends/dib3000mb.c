multiline_comment|/*&n; * Frontend driver for mobile DVB-T demodulator DiBcom 3000-MB&n; * DiBcom (http://www.dibcom.fr/)&n; *&n; * Copyright (C) 2004 Patrick Boettcher (patrick.boettcher@desy.de)&n; *&n; * based on GPL code from DibCom, which has&n; *&n; * Copyright (C) 2004 Amaury Demol for DiBcom (ademol@dibcom.fr)&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License as&n; *&t;published by the Free Software Foundation, version 2.&n; *&n; * Acknowledgements&n; *&n; *  Amaury Demol (ademol@dibcom.fr) from DiBcom for providing specs and driver&n; *  sources, on which this driver (and the dvb-dibusb) are based.&n; *&n; * &n; * &n; * see Documentation/dvb/README.dibusb for more information&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &quot;dib3000mb.h&quot;
multiline_comment|/* debug */
macro_line|#ifdef CONFIG_DVB_DIBCOM_DEBUG
DECL|macro|dprintk
mdefine_line|#define dprintk(level,args...) &bslash;&n;&t;do { if ((debug &amp; level)) { printk(args); } } while (0)
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0x644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;set debugging level (1=info,2=xfer,4=alotmore,8=setfe,16=getfe (|-able)).&quot;
)paren
suffix:semicolon
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(args...) do { } while (0);
macro_line|#endif
DECL|macro|deb_info
mdefine_line|#define deb_info(args...) dprintk(0x01,args)
DECL|macro|deb_xfer
mdefine_line|#define deb_xfer(args...) dprintk(0x02,args)
DECL|macro|deb_alot
mdefine_line|#define deb_alot(args...) dprintk(0x04,args)
DECL|macro|deb_setf
mdefine_line|#define deb_setf(args...) dprintk(0x08,args)
DECL|macro|deb_getf
mdefine_line|#define deb_getf(args...) dprintk(0x10,args)
multiline_comment|/* Version information */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;0.1&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;DiBcom 3000-MB DVB-T frontend&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Patrick Boettcher, patrick.boettcher@desy.de&quot;
DECL|struct|dib3000mb_state
r_struct
id|dib3000mb_state
(brace
DECL|member|i2c
r_struct
id|i2c_client
op_star
id|i2c
suffix:semicolon
DECL|member|dvb
r_struct
id|dvb_adapter
op_star
id|dvb
suffix:semicolon
DECL|member|manufactor_id
id|u16
id|manufactor_id
suffix:semicolon
DECL|member|device_id
id|u16
id|device_id
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|dib3000mb_info
r_static
r_struct
id|dvb_frontend_info
id|dib3000mb_info
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;DiBcom 3000-MB DVB-T&quot;
comma
dot
id|type
op_assign
id|FE_OFDM
comma
dot
id|frequency_min
op_assign
l_int|44250000
comma
dot
id|frequency_max
op_assign
l_int|867250000
comma
dot
id|frequency_stepsize
op_assign
l_int|62500
comma
dot
id|caps
op_assign
id|FE_CAN_INVERSION_AUTO
op_or
id|FE_CAN_FEC_1_2
op_or
id|FE_CAN_FEC_2_3
op_or
id|FE_CAN_FEC_3_4
op_or
id|FE_CAN_FEC_5_6
op_or
id|FE_CAN_FEC_7_8
op_or
id|FE_CAN_FEC_AUTO
op_or
id|FE_CAN_QPSK
op_or
id|FE_CAN_QAM_16
op_or
id|FE_CAN_QAM_64
op_or
id|FE_CAN_QAM_AUTO
op_or
id|FE_CAN_GUARD_INTERVAL_AUTO
op_or
id|FE_CAN_TRANSMISSION_MODE_AUTO
op_or
id|FE_CAN_HIERARCHY_AUTO
comma
)brace
suffix:semicolon
DECL|macro|rd
mdefine_line|#define rd(reg) dib3000mb_read_reg(state-&gt;i2c,reg)
DECL|macro|wr
mdefine_line|#define wr(reg,val) if (dib3000mb_write_reg(state-&gt;i2c,reg,val)) &bslash;&n;&t;{ err(&quot;while sending 0x%04x to 0x%04x.&quot;,val,reg); return -EREMOTEIO; }
DECL|macro|wr_foreach
mdefine_line|#define wr_foreach(a,v) { int i; &bslash;&n;&t;deb_alot(&quot;sizeof: %d %d&bslash;n&quot;,sizeof(a),sizeof(v));&bslash;&n;&t;for (i=0; i &lt; sizeof(a)/sizeof(u16); i++) &bslash;&n;&t;&t;wr(a[i],v[i]); &bslash;&n;}
DECL|function|dib3000mb_read_reg
r_static
id|u16
id|dib3000mb_read_reg
c_func
(paren
r_struct
id|i2c_client
op_star
id|i2c
comma
id|u16
id|reg
)paren
(brace
id|u8
id|wb
(braket
)braket
op_assign
(brace
(paren
(paren
id|reg
op_rshift
l_int|8
)paren
op_or
l_int|0x80
)paren
op_amp
l_int|0xff
comma
id|reg
op_amp
l_int|0xff
)brace
suffix:semicolon
id|u8
id|rb
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
)braket
op_assign
(brace
(brace
dot
id|addr
op_assign
id|i2c-&gt;addr
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|wb
comma
dot
id|len
op_assign
l_int|2
)brace
comma
(brace
dot
id|addr
op_assign
id|i2c-&gt;addr
comma
dot
id|flags
op_assign
id|I2C_M_RD
comma
dot
id|buf
op_assign
id|rb
comma
dot
id|len
op_assign
l_int|2
)brace
comma
)brace
suffix:semicolon
id|deb_alot
c_func
(paren
l_string|&quot;reading from i2c bus (reg: %d)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
id|i2c-&gt;adapter
comma
id|msg
comma
l_int|2
)paren
op_ne
l_int|2
)paren
id|deb_alot
c_func
(paren
l_string|&quot;i2c read error&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|rb
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|rb
(braket
l_int|1
)braket
suffix:semicolon
)brace
DECL|function|dib3000mb_write_reg
r_static
r_int
id|dib3000mb_write_reg
c_func
(paren
r_struct
id|i2c_client
op_star
id|i2c
comma
id|u16
id|reg
comma
id|u16
id|val
)paren
(brace
id|u8
id|b
(braket
)braket
op_assign
(brace
(paren
id|reg
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|reg
op_amp
l_int|0xff
comma
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
id|val
op_amp
l_int|0xff
comma
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
)braket
op_assign
(brace
(brace
dot
id|addr
op_assign
id|i2c-&gt;addr
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|b
comma
dot
id|len
op_assign
l_int|4
)brace
)brace
suffix:semicolon
id|deb_alot
c_func
(paren
l_string|&quot;writing to i2c bus (reg: %d, val: %d)&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_return
id|i2c_transfer
c_func
(paren
id|i2c-&gt;adapter
comma
id|msg
comma
l_int|1
)paren
op_ne
l_int|1
ques
c_cond
op_minus
id|EREMOTEIO
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_tuner_thomson_cable_eu
r_static
r_int
id|dib3000mb_tuner_thomson_cable_eu
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|u32
id|freq
)paren
(brace
id|u32
id|tfreq
op_assign
(paren
id|freq
op_plus
l_int|36125000
)paren
op_div
l_int|62500
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
r_int
id|vu
comma
id|p0
comma
id|p1
comma
id|p2
suffix:semicolon
r_if
c_cond
(paren
id|freq
OG
l_int|403250000
)paren
id|vu
op_assign
l_int|1
comma
id|p2
op_assign
l_int|1
comma
id|p1
op_assign
l_int|0
comma
id|p0
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|freq
OG
l_int|115750000
)paren
id|vu
op_assign
l_int|0
comma
id|p2
op_assign
l_int|1
comma
id|p1
op_assign
l_int|1
comma
id|p0
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|freq
OG
l_int|44250000
)paren
id|vu
op_assign
l_int|0
comma
id|p2
op_assign
l_int|0
comma
id|p1
op_assign
l_int|1
comma
id|p0
op_assign
l_int|1
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* TODO better solution for i2c-&gt;addr handling */
id|addr
op_assign
id|state-&gt;i2c-&gt;addr
suffix:semicolon
id|state-&gt;i2c-&gt;addr
op_assign
id|DIB3000MB_TUNER_ADDR_DEFAULT
suffix:semicolon
id|wr
c_func
(paren
id|tfreq
op_amp
l_int|0x7fff
comma
(paren
l_int|0x8e
op_lshift
l_int|8
)paren
op_plus
(paren
(paren
id|vu
op_lshift
l_int|7
)paren
op_or
(paren
id|p2
op_lshift
l_int|2
)paren
op_or
(paren
id|p1
op_lshift
l_int|1
)paren
op_or
id|p0
)paren
)paren
suffix:semicolon
id|state-&gt;i2c-&gt;addr
op_assign
id|addr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_get_frontend
r_static
r_int
id|dib3000mb_get_frontend
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
(brace
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
op_star
id|cr
suffix:semicolon
id|u16
id|tps_val
suffix:semicolon
r_int
id|inv_test1
comma
id|inv_test2
suffix:semicolon
id|u32
id|dds_val
comma
id|threshold
op_assign
l_int|0x800000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_LOCK
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|dds_val
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_VALUE_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_VALUE_LSB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
op_amp
id|threshold
)paren
id|inv_test1
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test1
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test1
op_assign
l_int|2
suffix:semicolon
id|dds_val
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_LSB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
op_amp
id|threshold
)paren
id|inv_test2
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test2
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test2
op_assign
l_int|2
suffix:semicolon
id|fep-&gt;inversion
op_assign
(paren
(paren
id|inv_test2
op_eq
l_int|2
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|0
)paren
)paren
op_logical_or
(paren
(paren
id|inv_test2
op_eq
l_int|0
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|2
)paren
)paren
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;inversion %d %d, %d&bslash;n&quot;
comma
id|inv_test2
comma
id|inv_test1
comma
id|fep-&gt;inversion
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_QAM
)paren
)paren
)paren
(brace
r_case
id|DIB3000MB_QAM_QPSK
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QPSK &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QPSK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_QAM_QAM16
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_QAM_QAM64
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM64 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_64
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected constellation returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_HRCH
)paren
)paren
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH ON&bslash;n&quot;
)paren
suffix:semicolon
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_LP
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_LP
suffix:semicolon
id|ofdm-&gt;code_rate_HP
op_assign
id|FEC_NONE
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_VIT_ALPHA
)paren
)paren
)paren
(brace
r_case
id|DIB3000MB_VIT_ALPHA_OFF
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_NONE &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_VIT_ALPHA_1
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_1 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_VIT_ALPHA_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_2 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_VIT_ALPHA_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected ALPHA value returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
)brace
r_else
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH OFF&bslash;n&quot;
)paren
suffix:semicolon
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_HP
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_HP
suffix:semicolon
id|ofdm-&gt;code_rate_LP
op_assign
id|FEC_NONE
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tps_val
)paren
(brace
r_case
id|DIB3000MB_FEC_1_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_1_2 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_1_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_FEC_2_3
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_2_3 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_2_3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_FEC_3_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_3_4 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_3_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_FEC_5_6
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_5_6 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_4_5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_FEC_7_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_7_8 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_7_8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected FEC returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_GUARD_TIME
)paren
)paren
)paren
(brace
r_case
id|DIB3000MB_GUARD_TIME_1_32
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_32 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_GUARD_TIME_1_16
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_GUARD_TIME_1_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_8 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_GUARD_TIME_1_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected Guard Time returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_FFT
)paren
)paren
)paren
(brace
r_case
id|DIB3000MB_FFT_2K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_2K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_2K
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000MB_FFT_8K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_8K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_8K
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unexpected transmission mode return by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|dib3000mb_set_frontend
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
comma
r_int
id|tuner
)paren
suffix:semicolon
DECL|function|dib3000mb_fe_read_search_status
r_static
r_int
id|dib3000mb_fe_read_search_status
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
)paren
(brace
id|u16
id|irq
suffix:semicolon
r_struct
id|dvb_frontend_parameters
id|fep
suffix:semicolon
id|irq
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_AS_IRQ_PENDING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_amp
l_int|0x02
)paren
(brace
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_LOCK2_VALUE
)paren
op_amp
l_int|0x01
)paren
(brace
r_if
c_cond
(paren
id|dib3000mb_get_frontend
c_func
(paren
id|state
comma
op_amp
id|fep
)paren
op_eq
l_int|0
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;reading tuning data from frontend succeeded.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_set_frontend
c_func
(paren
id|state
comma
op_amp
id|fep
comma
l_int|0
)paren
op_eq
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|deb_setf
c_func
(paren
l_string|&quot;reading tuning data failed -&gt; tuning failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|deb_setf
c_func
(paren
l_string|&quot;AS IRQ was pending, but LOCK2 was not &amp; 0x01.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|irq
op_amp
l_int|0x01
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;Autosearch failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|dib3000mb_set_frontend
r_static
r_int
id|dib3000mb_set_frontend
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
comma
r_int
id|tuner
)paren
(brace
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
id|fe_cr
op_assign
id|FEC_NONE
suffix:semicolon
r_int
id|search_state
comma
id|seq
suffix:semicolon
r_if
c_cond
(paren
id|tuner
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000MB_ACTIVATE_TUNER_XFER
c_func
(paren
id|DIB3000MB_TUNER_ADDR_DEFAULT
)paren
)paren
suffix:semicolon
id|dib3000mb_tuner_thomson_cable_eu
c_func
(paren
id|state
comma
id|fep-&gt;frequency
)paren
suffix:semicolon
multiline_comment|/* wait for tuner */
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000MB_DEACTIVATE_TUNER_XFER
c_func
(paren
id|DIB3000MB_TUNER_ADDR_DEFAULT
)paren
)paren
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;bandwidth: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;bandwidth
)paren
(brace
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;8 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_8mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;7 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_7mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;6 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_6mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_AUTO
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unkown bandwidth value.&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK1_MASK
comma
id|DIB3000MB_LOCK1_SEARCH_4
)paren
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;transmission mode: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;transmission_mode
)paren
(brace
r_case
id|TRANSMISSION_MODE_2K
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;2k&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FFT
comma
id|DIB3000MB_FFT_2K
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_8K
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;8k&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FFT
comma
id|DIB3000MB_FFT_8K
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FFT
comma
id|DIB3000MB_FFT_AUTO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;guard: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;guard_interval
)paren
(brace
r_case
id|GUARD_INTERVAL_1_32
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_32&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000MB_GUARD_TIME_1_32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_16
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_16&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000MB_GUARD_TIME_1_16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_8
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_8&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000MB_GUARD_TIME_1_8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000MB_GUARD_TIME_1_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000MB_GUARD_TIME_AUTO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;invsersion: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fep-&gt;inversion
)paren
(brace
r_case
id|INVERSION_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVERSION_OFF
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;on&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_INV
comma
id|DIB3000MB_DDS_INV_OFF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVERSION_ON
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;on&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_INV
comma
id|DIB3000MB_DDS_INV_ON
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;constellation: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;constellation
)paren
(brace
r_case
id|QPSK
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qpsk&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000MB_QAM_QPSK
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_16
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qam16&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000MB_QAM_QAM16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_64
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qam64&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000MB_QAM_QAM64
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;hierachy: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;hierarchy_information
)paren
(brace
r_case
id|HIERARCHY_NONE
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;none &quot;
)paren
suffix:semicolon
multiline_comment|/* fall through alpha is 1, even when HIERARCHY is NONE */
r_case
id|HIERARCHY_1
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=1&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000MB_VIT_ALPHA_1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_2
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=2&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000MB_VIT_ALPHA_2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000MB_VIT_ALPHA_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=auto&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000MB_VIT_ALPHA_AUTO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;hierarchy: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_NONE
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HRCH
comma
id|DIB3000MB_VIT_HRCH_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HP
comma
id|DIB3000MB_VIT_HP
)paren
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_HP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_ne
id|HIERARCHY_AUTO
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;on&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HRCH
comma
id|DIB3000MB_VIT_HRCH_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HP
comma
id|DIB3000MB_VIT_LP
)paren
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_LP
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;fec: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fe_cr
)paren
(brace
r_case
id|FEC_1_2
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_2&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_1_2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_2_3
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;2_3&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_2_3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_3_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;3_4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_3_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_5_6
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;5_6&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_5_6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_7_8
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;7_8&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_7_8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_NONE
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;none &quot;
)paren
suffix:semicolon
r_case
id|FEC_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|seq
op_assign
id|dib3000mb_seq
(braket
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_AUTO
)braket
(braket
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_AUTO
)braket
(braket
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
)braket
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;seq? %d&bslash;n&quot;
comma
id|seq
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_SEQ
comma
id|seq
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|seq
ques
c_cond
id|DIB3000MB_ISI_INHIBIT
suffix:colon
id|DIB3000MB_ISI_ACTIVATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_2K
)paren
(brace
r_if
c_cond
(paren
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_1_8
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_SYNC_IMPROVEMENT
comma
id|DIB3000MB_SYNC_IMPROVE_2K_1_8
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_SYNC_IMPROVEMENT
comma
id|DIB3000MB_SYNC_IMPROVE_DEFAULT
)paren
suffix:semicolon
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_121
comma
id|DIB3000MB_UNK_121_2K
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_121
comma
id|DIB3000MB_UNK_121_DEFAULT
)paren
suffix:semicolon
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_ALGO
comma
id|DIB3000MB_MOBILE_ALGO_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE_QAM
comma
id|DIB3000MB_MOBILE_MODE_QAM_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE
comma
id|DIB3000MB_MOBILE_MODE_OFF
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_high
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_ACTIVATE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AGC
op_plus
id|DIB3000MB_RESTART_CTRL
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
multiline_comment|/* wait for AGC lock */
id|msleep
c_func
(paren
l_int|70
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_low
)paren
suffix:semicolon
multiline_comment|/* something has to be auto searched */
r_if
c_cond
(paren
id|ofdm-&gt;constellation
op_eq
id|QAM_AUTO
op_logical_or
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_AUTO
op_logical_or
id|fe_cr
op_eq
id|FEC_AUTO
op_logical_or
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;autosearch enabled.&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AUTO_SEARCH
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|search_state
op_assign
id|dib3000mb_fe_read_search_status
c_func
(paren
id|state
)paren
)paren
OL
l_int|0
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;search_state after autosearch %d&bslash;n&quot;
comma
id|search_state
)paren
suffix:semicolon
r_return
id|search_state
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_CTRL
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|70
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fe_init
r_static
r_int
id|dib3000mb_fe_init
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
r_int
id|mobile_mode
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_POWER_CONTROL
comma
id|DIB3000MB_POWER_UP
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AGC
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESET_DEVICE
comma
id|DIB3000MB_RESET_DEVICE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESET_DEVICE
comma
id|DIB3000MB_RESET_DEVICE_RST
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_CLOCK
comma
id|DIB3000MB_CLOCK_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ELECT_OUT_MODE
comma
id|DIB3000MB_ELECT_OUT_MODE_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000MB_QAM_RESERVED
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000MB_VIT_ALPHA_AUTO
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_MSB
comma
id|DIB3000MB_DDS_FREQ_MSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_LSB
comma
id|DIB3000MB_DDS_FREQ_LSB
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_impulse_noise
comma
id|dib3000mb_impulse_noise_values
(braket
id|DIB3000MB_IMPNOISE_OFF
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_gain
comma
id|dib3000mb_default_agc_gain
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_PHASE_NOISE
comma
id|DIB3000MB_PHASE_NOISE_DEFAULT
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_phase_noise
comma
id|dib3000mb_default_noise_phase
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_lock_duration
comma
id|dib3000mb_default_lock_duration
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_low
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK0_MASK
comma
id|DIB3000MB_LOCK0_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK1_MASK
comma
id|DIB3000MB_LOCK1_SEARCH_4
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK2_MASK
comma
id|DIB3000MB_LOCK2_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_SEQ
comma
id|dib3000mb_seq
(braket
l_int|1
)braket
(braket
l_int|1
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_8mhz
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_68
comma
id|DIB3000MB_UNK_68
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_69
comma
id|DIB3000MB_UNK_69
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_71
comma
id|DIB3000MB_UNK_71
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_77
comma
id|DIB3000MB_UNK_77
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_78
comma
id|DIB3000MB_UNK_78
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_92
comma
id|DIB3000MB_UNK_92
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_96
comma
id|DIB3000MB_UNK_96
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_97
comma
id|DIB3000MB_UNK_97
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_106
comma
id|DIB3000MB_UNK_106
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_107
comma
id|DIB3000MB_UNK_107
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_108
comma
id|DIB3000MB_UNK_108
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_122
comma
id|DIB3000MB_UNK_122
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE_QAM
comma
id|DIB3000MB_MOBILE_MODE_QAM_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000MB_FEC_1_2
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HP
comma
id|DIB3000MB_VIT_HP
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_BERLEN
comma
id|DIB3000MB_BERLEN_DEFAULT
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_filter_coeffs
comma
id|dib3000mb_filter_coeffs
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_ALGO
comma
id|DIB3000MB_MOBILE_ALGO_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MULTI_DEMOD_MSB
comma
id|DIB3000MB_MULTI_DEMOD_MSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MULTI_DEMOD_LSB
comma
id|DIB3000MB_MULTI_DEMOD_LSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_OUTPUT_MODE
comma
id|DIB3000MB_OUTPUT_MODE_SLAVE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_142
comma
id|DIB3000MB_FIFO_142
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MPEG2_OUT_MODE
comma
id|DIB3000MB_MPEG2_OUT_MODE_188
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_144
comma
id|DIB3000MB_FIFO_144
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO
comma
id|DIB3000MB_FIFO_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_146
comma
id|DIB3000MB_FIFO_146
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_147
comma
id|DIB3000MB_FIFO_147
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DATA_IN_DIVERSITY
comma
id|DIB3000MB_DATA_DIVERSITY_IN_OFF
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_status
r_static
r_int
id|dib3000mb_read_status
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|fe_status_t
op_star
id|stat
)paren
(brace
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_AGC_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_SIGNAL
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_CARRIER_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_CARRIER
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_VIT_LCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_VITERBI
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_TS_SYNC_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
(paren
id|FE_HAS_SYNC
op_or
id|FE_HAS_LOCK
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;actual status is %2x&bslash;n&quot;
comma
op_star
id|stat
)paren
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;tps %x %x %x %x %x&bslash;n&quot;
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_1
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_2
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_3
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_4
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_5
)paren
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;autoval: tps: %d, qam: %d, hrch: %d, alpha: %d, hp: %d, lp: %d, guard: %d, fft: %d cell: %d&bslash;n&quot;
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_LOCK
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_QAM
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_HRCH
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_VIT_ALPHA
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_HP
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_LP
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_GUARD_TIME
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_FFT
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CELL_ID
)paren
)paren
suffix:semicolon
singleline_comment|//*stat = FE_HAS_SIGNAL | FE_HAS_CARRIER | FE_HAS_VITERBI | FE_HAS_SYNC | FE_HAS_LOCK;
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_ber
r_static
r_int
id|dib3000mb_read_ber
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|u32
op_star
id|ber
)paren
(brace
op_star
id|ber
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_BER_MSB
)paren
op_lshift
l_int|16
)paren
op_or
id|rd
c_func
(paren
id|DIB3000MB_REG_BER_LSB
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Amaury:&n; * signal strength is measured with dBm (power compared to mW)&n; * the standard range is -90dBm(low power) to -10 dBm (strong power),&n; * but the calibration is done for -100 dBm to 0dBm&n; */
DECL|macro|DIB3000MB_AGC_REF_dBm
mdefine_line|#define DIB3000MB_AGC_REF_dBm&t;&t;-14
DECL|macro|DIB3000MB_GAIN_SLOPE_dBm
mdefine_line|#define DIB3000MB_GAIN_SLOPE_dBm&t;100
DECL|macro|DIB3000MB_GAIN_DELTA_dBm
mdefine_line|#define DIB3000MB_GAIN_DELTA_dBm&t;-2
DECL|function|dib3000mb_read_signal_strength
r_static
r_int
id|dib3000mb_read_signal_strength
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|u16
op_star
id|strength
)paren
(brace
multiline_comment|/* TODO log10 &n;&t;u16 sigpow = rd(DIB3000MB_REG_SIGNAL_POWER), &n;&t;&t;n_agc_power = rd(DIB3000MB_REG_AGC_POWER),&n;&t;&t;rf_power = rd(DIB3000MB_REG_RF_POWER);&n;&t;double rf_power_dBm, ad_power_dBm, minar_power_dBm;&n;&t;&n;&t;if (n_agc_power == 0 )&n;&t;&t;n_agc_power = 1 ;&n;&n;&t;ad_power_dBm    = 10 * log10 ( (float)n_agc_power / (float)(1&lt;&lt;16) );&n;&t;minor_power_dBm = ad_power_dBm - DIB3000MB_AGC_REF_dBm;&n;&t;rf_power_dBm = (-DIB3000MB_GAIN_SLOPE_dBm * (float)rf_power / (float)(1&lt;&lt;16) + &n;&t;&t;&t;DIB3000MB_GAIN_DELTA_dBm) + minor_power_dBm;&n;&t;// relative rf_power &n;&t;*strength = (u16) ((rf_power_dBm + 100) / 100 * 0xffff);&n;*/
op_star
id|strength
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_SIGNAL_POWER
)paren
op_star
l_int|0xffff
op_div
l_int|0x170
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Amaury: &n; * snr is the signal quality measured in dB.&n; * snr = 10*log10(signal power / noise power)&n; * the best quality is near 35dB (cable transmission &amp; good modulator)&n; * the minimum without errors depend of transmission parameters&n; * some indicative values are given in en300744 Annex A&n; * ex : 16QAM 2/3 (Gaussian)  = 11.1 dB&n; *&n; * If SNR is above 20dB, BER should be always 0.&n; * choose 0dB as the minimum&n; */
DECL|function|dib3000mb_read_snr
r_static
r_int
id|dib3000mb_read_snr
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|u16
op_star
id|snr
)paren
(brace
r_int
id|sigpow
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_SIGNAL_POWER
)paren
suffix:semicolon
r_int
id|icipow
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_NOISE_POWER_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_or
id|rd
c_func
(paren
id|DIB3000MB_REG_NOISE_POWER_LSB
)paren
suffix:semicolon
multiline_comment|/*&n;&t;float snr_dBm=0;&n;&n;&t;if (sigpow &gt; 0 &amp;&amp; icipow &gt; 0)&n;&t;&t;snr_dBm = 10.0 * log10( (float) (sigpow&lt;&lt;8) / (float)icipow )  ;&n;&t;else if (sigpow &gt; 0)&n;&t;&t;snr_dBm = 35;&n;&t;&n;&t;*snr = (u16) ((snr_dBm / 35) * 0xffff);&n;*/
op_star
id|snr
op_assign
(paren
id|sigpow
op_lshift
l_int|8
)paren
op_div
(paren
id|icipow
OG
l_int|0
ques
c_cond
id|icipow
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_unc_blocks
r_static
r_int
id|dib3000mb_read_unc_blocks
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
id|u32
op_star
id|unc
)paren
(brace
op_star
id|unc
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_UNC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_sleep
r_static
r_int
id|dib3000mb_sleep
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_POWER_CONTROL
comma
id|DIB3000MB_POWER_DOWN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fe_get_tune_settings
r_static
r_int
id|dib3000mb_fe_get_tune_settings
c_func
(paren
r_struct
id|dib3000mb_state
op_star
id|state
comma
r_struct
id|dvb_frontend_tune_settings
op_star
id|tune
)paren
(brace
id|tune-&gt;min_delay_ms
op_assign
l_int|800
suffix:semicolon
id|tune-&gt;step_size
op_assign
l_int|166667
suffix:semicolon
id|tune-&gt;max_drift
op_assign
l_int|166667
op_star
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_ioctl
r_static
r_int
id|dib3000mb_ioctl
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|dib3000mb_state
op_star
id|state
op_assign
id|fe-&gt;data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_GET_INFO
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_GET_INFO&bslash;n&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|arg
comma
op_amp
id|dib3000mb_info
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_info
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_READ_STATUS
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_READ_STATUS&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_read_status
c_func
(paren
id|state
comma
(paren
id|fe_status_t
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_READ_BER
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_READ_BER&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_read_ber
c_func
(paren
id|state
comma
(paren
id|u32
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_READ_SIGNAL_STRENGTH
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_READ_SIG_STRENGTH&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_read_signal_strength
c_func
(paren
id|state
comma
(paren
id|u16
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_READ_SNR
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_READ_SNR&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_read_snr
c_func
(paren
id|state
comma
(paren
id|u16
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_READ_UNCORRECTED_BLOCKS
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_READ_UNCORRECTED_BLOCKS&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_read_unc_blocks
c_func
(paren
id|state
comma
(paren
id|u32
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_SET_FRONTEND
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_SET_FRONTEND&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_set_frontend
c_func
(paren
id|state
comma
(paren
r_struct
id|dvb_frontend_parameters
op_star
)paren
id|arg
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_GET_FRONTEND
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_GET_FRONTEND&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_get_frontend
c_func
(paren
id|state
comma
(paren
r_struct
id|dvb_frontend_parameters
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_SLEEP
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_SLEEP&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_sleep
c_func
(paren
id|state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_INIT
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;FE_INIT&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_fe_init
c_func
(paren
id|state
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_GET_TUNE_SETTINGS
suffix:colon
id|deb_info
c_func
(paren
l_string|&quot;GET_TUNE_SETTINGS&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_fe_get_tune_settings
c_func
(paren
id|state
comma
(paren
r_struct
id|dvb_frontend_tune_settings
op_star
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_SET_TONE
suffix:colon
r_case
id|FE_SET_VOLTAGE
suffix:colon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
suffix:semicolon
DECL|function|dib3000mb_attach_adapter
r_static
r_int
id|dib3000mb_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_struct
id|i2c_client
op_star
id|client
suffix:semicolon
r_struct
id|dib3000mb_state
op_star
id|state
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;i2c probe with adapter &squot;%s&squot;.&bslash;n&quot;
comma
id|adapter-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|state
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dib3000mb_state
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|client
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|i2c_client
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|i2c_kmalloc_err
suffix:semicolon
id|memcpy
c_func
(paren
id|client
comma
op_amp
id|client_template
comma
r_sizeof
(paren
r_struct
id|i2c_client
)paren
)paren
suffix:semicolon
id|client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|client-&gt;addr
op_assign
l_int|0x10
suffix:semicolon
id|state-&gt;i2c
op_assign
id|client
suffix:semicolon
id|i2c_set_clientdata
c_func
(paren
id|client
comma
id|state
)paren
suffix:semicolon
id|state-&gt;manufactor_id
op_assign
id|dib3000mb_read_reg
c_func
(paren
id|client
comma
id|DIB3000MB_REG_MANUFACTOR_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;manufactor_id
op_ne
l_int|0x01b3
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|probe_err
suffix:semicolon
)brace
id|state-&gt;device_id
op_assign
id|dib3000mb_read_reg
c_func
(paren
id|client
comma
id|DIB3000MB_REG_DEVICE_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;device_id
op_ne
l_int|0x3000
)paren
(brace
id|ret
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|probe_err
suffix:semicolon
)brace
id|info
c_func
(paren
l_string|&quot;found a DiBCom (0x%04x) 3000-MB DVB-T frontend (ver: %x).&quot;
comma
id|state-&gt;manufactor_id
comma
id|state-&gt;device_id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|i2c_attach_client
c_func
(paren
id|client
)paren
)paren
)paren
r_goto
id|i2c_attach_err
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;dvb
op_eq
l_int|NULL
)paren
r_goto
id|i2c_attach_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|dvb_register_frontend
c_func
(paren
id|dib3000mb_ioctl
comma
id|state-&gt;dvb
comma
id|state
comma
op_amp
id|dib3000mb_info
comma
id|THIS_MODULE
)paren
)paren
)paren
r_goto
id|dvb_fe_err
suffix:semicolon
r_goto
id|success
suffix:semicolon
id|dvb_fe_err
suffix:colon
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|i2c_attach_err
suffix:colon
id|probe_err
suffix:colon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
id|i2c_kmalloc_err
suffix:colon
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
id|success
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_detach_client
r_static
r_int
id|dib3000mb_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_struct
id|dib3000mb_state
op_star
id|state
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;i2c detach&bslash;n&quot;
)paren
suffix:semicolon
id|dvb_unregister_frontend
c_func
(paren
id|dib3000mb_ioctl
comma
id|state-&gt;dvb
)paren
suffix:semicolon
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_command
r_static
r_int
id|dib3000mb_command
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|dib3000mb_state
op_star
id|state
op_assign
id|i2c_get_clientdata
c_func
(paren
id|client
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;i2c command.&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_REGISTER
suffix:colon
id|state-&gt;dvb
op_assign
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_UNREGISTER
suffix:colon
id|state-&gt;dvb
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|i2c_driver
id|driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;dib3000mb&quot;
comma
dot
id|id
op_assign
id|I2C_DRIVERID_DVBFE_DIB3000MB
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|dib3000mb_attach_adapter
comma
dot
id|detach_client
op_assign
id|dib3000mb_detach_client
comma
dot
id|command
op_assign
id|dib3000mb_command
comma
)brace
suffix:semicolon
DECL|variable|client_template
r_static
r_struct
id|i2c_client
id|client_template
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dib3000mb&quot;
comma
dot
id|flags
op_assign
id|I2C_CLIENT_ALLOW_USE
comma
dot
id|driver
op_assign
op_amp
id|driver
comma
)brace
suffix:semicolon
multiline_comment|/* module stuff */
DECL|function|dib3000mb_init
r_static
r_int
id|__init
id|dib3000mb_init
c_func
(paren
r_void
)paren
(brace
id|deb_info
c_func
(paren
l_string|&quot;debugging level: %d&bslash;n&quot;
comma
id|debug
)paren
suffix:semicolon
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|dib3000mb_exit
r_static
r_void
id|__exit
id|dib3000mb_exit
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|variable|dib3000mb_init
id|module_init
(paren
id|dib3000mb_init
)paren
suffix:semicolon
DECL|variable|dib3000mb_exit
id|module_exit
(paren
id|dib3000mb_exit
)paren
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
