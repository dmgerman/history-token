multiline_comment|/*&n; * Frontend driver for mobile DVB-T demodulator DiBcom 3000-MB&n; * DiBcom (http://www.dibcom.fr/)&n; *&n; * Copyright (C) 2004 Patrick Boettcher (patrick.boettcher@desy.de)&n; *&n; * based on GPL code from DibCom, which has&n; *&n; * Copyright (C) 2004 Amaury Demol for DiBcom (ademol@dibcom.fr)&n; *&n; *&t;This program is free software; you can redistribute it and/or&n; *&t;modify it under the terms of the GNU General Public License as&n; *&t;published by the Free Software Foundation, version 2.&n; *&n; * Acknowledgements&n; *&n; *  Amaury Demol (ademol@dibcom.fr) from DiBcom for providing specs and driver&n; *  sources, on which this driver (and the dvb-dibusb) are based.&n; *&n; * see Documentation/dvb/README.dibusb for more information&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &quot;dib3000-common.h&quot;
macro_line|#include &quot;dib3000mb_priv.h&quot;
macro_line|#include &quot;dib3000.h&quot;
multiline_comment|/* Version information */
DECL|macro|DRIVER_VERSION
mdefine_line|#define DRIVER_VERSION &quot;0.1&quot;
DECL|macro|DRIVER_DESC
mdefine_line|#define DRIVER_DESC &quot;DiBcom 3000-MB DVB-T demodulator driver&quot;
DECL|macro|DRIVER_AUTHOR
mdefine_line|#define DRIVER_AUTHOR &quot;Patrick Boettcher, patrick.boettcher@desy.de&quot;
macro_line|#ifdef CONFIG_DVB_DIBCOM_DEBUG
DECL|variable|debug
r_static
r_int
id|debug
suffix:semicolon
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0x644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;set debugging level (1=info,2=xfer,4=setfe,8=getfe (|-able)).&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|macro|deb_info
mdefine_line|#define deb_info(args...) dprintk(0x01,args)
DECL|macro|deb_xfer
mdefine_line|#define deb_xfer(args...) dprintk(0x02,args)
DECL|macro|deb_setf
mdefine_line|#define deb_setf(args...) dprintk(0x04,args)
DECL|macro|deb_getf
mdefine_line|#define deb_getf(args...) dprintk(0x08,args)
r_static
r_int
id|dib3000mb_get_frontend
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
suffix:semicolon
DECL|function|dib3000mb_set_frontend
r_static
r_int
id|dib3000mb_set_frontend
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
comma
r_int
id|tuner
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
id|fe_cr
op_assign
id|FEC_NONE
suffix:semicolon
r_int
id|search_state
comma
id|seq
suffix:semicolon
r_if
c_cond
(paren
id|tuner
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_ENABLE
c_func
(paren
id|state-&gt;config.pll_addr
)paren
)paren
suffix:semicolon
id|state-&gt;config
dot
id|pll_set
c_func
(paren
id|fe
comma
id|fep
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_DISABLE
c_func
(paren
id|state-&gt;config.pll_addr
)paren
)paren
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;bandwidth: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;bandwidth
)paren
(brace
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;8 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_8mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;7 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_7mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;6 MHz&bslash;n&quot;
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_6mhz
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_AUTO
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unkown bandwidth value.&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK1_MASK
comma
id|DIB3000MB_LOCK1_SEARCH_4
)paren
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;transmission mode: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;transmission_mode
)paren
(brace
r_case
id|TRANSMISSION_MODE_2K
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;2k&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FFT
comma
id|DIB3000_TRANSMISSION_MODE_2K
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_8K
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;8k&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FFT
comma
id|DIB3000_TRANSMISSION_MODE_8K
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRANSMISSION_MODE_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;guard: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;guard_interval
)paren
(brace
r_case
id|GUARD_INTERVAL_1_32
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_32&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000_GUARD_TIME_1_32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_16
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_16&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000_GUARD_TIME_1_16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_8
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_8&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000_GUARD_TIME_1_8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_1_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_GUARD_TIME
comma
id|DIB3000_GUARD_TIME_1_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GUARD_INTERVAL_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;inversion: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fep-&gt;inversion
)paren
(brace
r_case
id|INVERSION_OFF
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;off&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_INV
comma
id|DIB3000_DDS_INVERSION_OFF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVERSION_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|INVERSION_ON
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;on&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_INV
comma
id|DIB3000_DDS_INVERSION_ON
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;constellation: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;constellation
)paren
(brace
r_case
id|QPSK
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qpsk&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000_CONSTELLATION_QPSK
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_16
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qam16&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000_CONSTELLATION_16QAM
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_64
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;qam64&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_QAM
comma
id|DIB3000_CONSTELLATION_64QAM
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QAM_AUTO
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;hierachy: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ofdm-&gt;hierarchy_information
)paren
(brace
r_case
id|HIERARCHY_NONE
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;none &quot;
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|HIERARCHY_1
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=1&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000_ALPHA_1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_2
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=2&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000_ALPHA_2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_ALPHA
comma
id|DIB3000_ALPHA_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HIERARCHY_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;alpha=auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;hierarchy: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_NONE
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HRCH
comma
id|DIB3000_HRCH_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HP
comma
id|DIB3000_SELECT_HP
)paren
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_HP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ofdm-&gt;hierarchy_information
op_ne
id|HIERARCHY_AUTO
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;on&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HRCH
comma
id|DIB3000_HRCH_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_HP
comma
id|DIB3000_SELECT_LP
)paren
suffix:semicolon
id|fe_cr
op_assign
id|ofdm-&gt;code_rate_LP
suffix:semicolon
)brace
id|deb_setf
c_func
(paren
l_string|&quot;fec: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|fe_cr
)paren
(brace
r_case
id|FEC_1_2
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;1_2&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000_FEC_1_2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_2_3
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;2_3&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000_FEC_2_3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_3_4
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;3_4&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000_FEC_3_4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_5_6
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;5_6&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000_FEC_5_6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_7_8
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;7_8&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_VIT_CODE_RATE
comma
id|DIB3000_FEC_7_8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_NONE
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;none &quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FEC_AUTO
suffix:colon
id|deb_setf
c_func
(paren
l_string|&quot;auto&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|seq
op_assign
id|dib3000_seq
(braket
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_AUTO
)braket
(braket
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_AUTO
)braket
(braket
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
)braket
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;seq? %d&bslash;n&quot;
comma
id|seq
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_SEQ
comma
id|seq
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|seq
ques
c_cond
id|DIB3000MB_ISI_INHIBIT
suffix:colon
id|DIB3000MB_ISI_ACTIVATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ofdm-&gt;transmission_mode
op_eq
id|TRANSMISSION_MODE_2K
)paren
(brace
r_if
c_cond
(paren
id|ofdm-&gt;guard_interval
op_eq
id|GUARD_INTERVAL_1_8
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_SYNC_IMPROVEMENT
comma
id|DIB3000MB_SYNC_IMPROVE_2K_1_8
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_SYNC_IMPROVEMENT
comma
id|DIB3000MB_SYNC_IMPROVE_DEFAULT
)paren
suffix:semicolon
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_121
comma
id|DIB3000MB_UNK_121_2K
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_121
comma
id|DIB3000MB_UNK_121_DEFAULT
)paren
suffix:semicolon
)brace
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_ALGO
comma
id|DIB3000MB_MOBILE_ALGO_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE_QAM
comma
id|DIB3000MB_MOBILE_MODE_QAM_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE
comma
id|DIB3000MB_MOBILE_MODE_OFF
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_high
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_ACTIVATE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AGC
op_plus
id|DIB3000MB_RESTART_CTRL
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
multiline_comment|/* wait for AGC lock */
id|msleep
c_func
(paren
l_int|70
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_low
)paren
suffix:semicolon
multiline_comment|/* something has to be auto searched */
r_if
c_cond
(paren
id|ofdm-&gt;constellation
op_eq
id|QAM_AUTO
op_logical_or
id|ofdm-&gt;hierarchy_information
op_eq
id|HIERARCHY_AUTO
op_logical_or
id|fe_cr
op_eq
id|FEC_AUTO
op_logical_or
id|fep-&gt;inversion
op_eq
id|INVERSION_AUTO
)paren
(brace
r_int
id|as_count
op_assign
l_int|0
suffix:semicolon
id|deb_setf
c_func
(paren
l_string|&quot;autosearch enabled.&bslash;n&quot;
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AUTO_SEARCH
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|search_state
op_assign
id|dib3000_search_status
c_func
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_AS_IRQ_PENDING
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_LOCK2_VALUE
)paren
)paren
)paren
OL
l_int|0
op_logical_and
id|as_count
op_increment
OL
l_int|100
)paren
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;search_state after autosearch %d after %d checks&bslash;n&quot;
comma
id|search_state
comma
id|as_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|search_state
op_eq
l_int|1
)paren
(brace
r_struct
id|dvb_frontend_parameters
id|feps
suffix:semicolon
r_if
c_cond
(paren
id|dib3000mb_get_frontend
c_func
(paren
id|fe
comma
op_amp
id|feps
)paren
op_eq
l_int|0
)paren
(brace
id|deb_setf
c_func
(paren
l_string|&quot;reading tuning data from frontend succeeded.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|dib3000mb_set_frontend
c_func
(paren
id|fe
comma
op_amp
id|feps
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_CTRL
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_OFF
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fe_init
r_static
r_int
id|dib3000mb_fe_init
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|mobile_mode
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_POWER_CONTROL
comma
id|DIB3000MB_POWER_UP
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESTART
comma
id|DIB3000MB_RESTART_AGC
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESET_DEVICE
comma
id|DIB3000MB_RESET_DEVICE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_RESET_DEVICE
comma
id|DIB3000MB_RESET_DEVICE_RST
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_CLOCK
comma
id|DIB3000MB_CLOCK_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ELECT_OUT_MODE
comma
id|DIB3000MB_ELECT_OUT_MODE_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_MSB
comma
id|DIB3000MB_DDS_FREQ_MSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_LSB
comma
id|DIB3000MB_DDS_FREQ_LSB
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_timing_freq
comma
id|dib3000mb_timing_freq
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_impulse_noise
comma
id|dib3000mb_impulse_noise_values
(braket
id|DIB3000MB_IMPNOISE_OFF
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_gain
comma
id|dib3000mb_default_agc_gain
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_PHASE_NOISE
comma
id|DIB3000MB_PHASE_NOISE_DEFAULT
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_phase_noise
comma
id|dib3000mb_default_noise_phase
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_lock_duration
comma
id|dib3000mb_default_lock_duration
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_agc_bandwidth
comma
id|dib3000mb_agc_bandwidth_low
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK0_MASK
comma
id|DIB3000MB_LOCK0_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK1_MASK
comma
id|DIB3000MB_LOCK1_SEARCH_4
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_LOCK2_MASK
comma
id|DIB3000MB_LOCK2_DEFAULT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_SEQ
comma
id|dib3000_seq
(braket
l_int|1
)braket
(braket
l_int|1
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_bandwidth
comma
id|dib3000mb_bandwidth_8mhz
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_68
comma
id|DIB3000MB_UNK_68
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_69
comma
id|DIB3000MB_UNK_69
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_71
comma
id|DIB3000MB_UNK_71
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_77
comma
id|DIB3000MB_UNK_77
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_78
comma
id|DIB3000MB_UNK_78
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_ISI
comma
id|DIB3000MB_ISI_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_92
comma
id|DIB3000MB_UNK_92
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_96
comma
id|DIB3000MB_UNK_96
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_97
comma
id|DIB3000MB_UNK_97
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_106
comma
id|DIB3000MB_UNK_106
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_107
comma
id|DIB3000MB_UNK_107
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_108
comma
id|DIB3000MB_UNK_108
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_UNK_122
comma
id|DIB3000MB_UNK_122
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_MODE_QAM
comma
id|DIB3000MB_MOBILE_MODE_QAM_OFF
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_BERLEN
comma
id|DIB3000MB_BERLEN_DEFAULT
)paren
suffix:semicolon
id|wr_foreach
c_func
(paren
id|dib3000mb_reg_filter_coeffs
comma
id|dib3000mb_filter_coeffs
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MOBILE_ALGO
comma
id|DIB3000MB_MOBILE_ALGO_ON
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MULTI_DEMOD_MSB
comma
id|DIB3000MB_MULTI_DEMOD_MSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MULTI_DEMOD_LSB
comma
id|DIB3000MB_MULTI_DEMOD_LSB
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_OUTPUT_MODE
comma
id|DIB3000MB_OUTPUT_MODE_SLAVE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_142
comma
id|DIB3000MB_FIFO_142
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_MPEG2_OUT_MODE
comma
id|DIB3000MB_MPEG2_OUT_MODE_188
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_PID_PARSE
comma
id|DIB3000MB_PID_PARSE_ACTIVATE
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO
comma
id|DIB3000MB_FIFO_INHIBIT
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_146
comma
id|DIB3000MB_FIFO_146
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO_147
comma
id|DIB3000MB_FIFO_147
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_DATA_IN_DIVERSITY
comma
id|DIB3000MB_DATA_DIVERSITY_IN_OFF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;config.pll_init
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_ENABLE
c_func
(paren
id|state-&gt;config.pll_addr
)paren
)paren
suffix:semicolon
id|state-&gt;config
dot
id|pll_init
c_func
(paren
id|fe
)paren
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_TUNER
comma
id|DIB3000_TUNER_WRITE_DISABLE
c_func
(paren
id|state-&gt;config.pll_addr
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_get_frontend
r_static
r_int
id|dib3000mb_get_frontend
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_struct
id|dvb_ofdm_parameters
op_star
id|ofdm
op_assign
op_amp
id|fep-&gt;u.ofdm
suffix:semicolon
id|fe_code_rate_t
op_star
id|cr
suffix:semicolon
id|u16
id|tps_val
suffix:semicolon
r_int
id|inv_test1
comma
id|inv_test2
suffix:semicolon
id|u32
id|dds_val
comma
id|threshold
op_assign
l_int|0x800000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_LOCK
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|dds_val
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_VALUE_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_VALUE_LSB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
OL
id|threshold
)paren
id|inv_test1
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test1
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test1
op_assign
l_int|2
suffix:semicolon
id|dds_val
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_plus
id|rd
c_func
(paren
id|DIB3000MB_REG_DDS_FREQ_LSB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dds_val
OL
id|threshold
)paren
id|inv_test2
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dds_val
op_eq
id|threshold
)paren
id|inv_test2
op_assign
l_int|1
suffix:semicolon
r_else
id|inv_test2
op_assign
l_int|2
suffix:semicolon
id|fep-&gt;inversion
op_assign
(paren
(paren
id|inv_test2
op_eq
l_int|2
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|0
)paren
)paren
op_logical_or
(paren
(paren
id|inv_test2
op_eq
l_int|0
)paren
op_logical_and
(paren
id|inv_test1
op_eq
l_int|1
op_logical_or
id|inv_test1
op_eq
l_int|2
)paren
)paren
ques
c_cond
id|INVERSION_ON
suffix:colon
id|INVERSION_OFF
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;inversion %d %d, %d&bslash;n&quot;
comma
id|inv_test2
comma
id|inv_test1
comma
id|fep-&gt;inversion
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_QAM
)paren
)paren
)paren
(brace
r_case
id|DIB3000_CONSTELLATION_QPSK
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QPSK &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QPSK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_CONSTELLATION_16QAM
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_CONSTELLATION_64QAM
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;QAM64 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;constellation
op_assign
id|QAM_64
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected constellation returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_HRCH
)paren
)paren
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH ON&bslash;n&quot;
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_LP
suffix:semicolon
id|ofdm-&gt;code_rate_HP
op_assign
id|FEC_NONE
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_VIT_ALPHA
)paren
)paren
)paren
(brace
r_case
id|DIB3000_ALPHA_0
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_NONE &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_1
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_1 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_2 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_ALPHA_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;HIERARCHY_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected ALPHA value returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_LP
)paren
suffix:semicolon
)brace
r_else
(brace
id|deb_getf
c_func
(paren
l_string|&quot;HRCH OFF&bslash;n&quot;
)paren
suffix:semicolon
id|cr
op_assign
op_amp
id|ofdm-&gt;code_rate_HP
suffix:semicolon
id|ofdm-&gt;code_rate_LP
op_assign
id|FEC_NONE
suffix:semicolon
id|ofdm-&gt;hierarchy_information
op_assign
id|HIERARCHY_NONE
suffix:semicolon
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_HP
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tps_val
)paren
(brace
r_case
id|DIB3000_FEC_1_2
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_1_2 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_1_2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_2_3
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_2_3 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_2_3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_3_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_3_4 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_3_4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_5_6
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_5_6 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_4_5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_FEC_7_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;FEC_7_8 &quot;
)paren
suffix:semicolon
op_star
id|cr
op_assign
id|FEC_7_8
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected FEC returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_GUARD_TIME
)paren
)paren
)paren
(brace
r_case
id|DIB3000_GUARD_TIME_1_32
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_32 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_16
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_16 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_8
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_8 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_GUARD_TIME_1_4
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;GUARD_INTERVAL_1_4 &quot;
)paren
suffix:semicolon
id|ofdm-&gt;guard_interval
op_assign
id|GUARD_INTERVAL_1_4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;Unexpected Guard Time returned by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|tps_val
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_FFT
)paren
)paren
)paren
(brace
r_case
id|DIB3000_TRANSMISSION_MODE_2K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_2K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_2K
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DIB3000_TRANSMISSION_MODE_8K
suffix:colon
id|deb_getf
c_func
(paren
l_string|&quot;TRANSMISSION_MODE_8K &quot;
)paren
suffix:semicolon
id|ofdm-&gt;transmission_mode
op_assign
id|TRANSMISSION_MODE_8K
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
c_func
(paren
l_string|&quot;unexpected transmission mode return by TPS (%d)&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|deb_getf
c_func
(paren
l_string|&quot;TPS: %d&bslash;n&quot;
comma
id|tps_val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_status
r_static
r_int
id|dib3000mb_read_status
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|fe_status_t
op_star
id|stat
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_AGC_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_SIGNAL
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_CARRIER_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_CARRIER
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_VIT_LCK
)paren
)paren
op_star
id|stat
op_or_assign
id|FE_HAS_VITERBI
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_TS_SYNC_LOCK
)paren
)paren
op_star
id|stat
op_or_assign
(paren
id|FE_HAS_SYNC
op_or
id|FE_HAS_LOCK
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;actual status is %2x&bslash;n&quot;
comma
op_star
id|stat
)paren
suffix:semicolon
id|deb_getf
c_func
(paren
l_string|&quot;tps %x %x %x %x %x&bslash;n&quot;
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_1
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_2
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_3
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_4
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_5
)paren
)paren
suffix:semicolon
id|deb_info
c_func
(paren
l_string|&quot;autoval: tps: %d, qam: %d, hrch: %d, alpha: %d, hp: %d, lp: %d, guard: %d, fft: %d cell: %d&bslash;n&quot;
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_LOCK
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_QAM
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_HRCH
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_VIT_ALPHA
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_HP
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CODE_RATE_LP
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_GUARD_TIME
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_FFT
)paren
comma
id|rd
c_func
(paren
id|DIB3000MB_REG_TPS_CELL_ID
)paren
)paren
suffix:semicolon
singleline_comment|//*stat = FE_HAS_SIGNAL | FE_HAS_CARRIER | FE_HAS_VITERBI | FE_HAS_SYNC | FE_HAS_LOCK;
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_ber
r_static
r_int
id|dib3000mb_read_ber
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u32
op_star
id|ber
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
op_star
id|ber
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_BER_MSB
)paren
op_lshift
l_int|16
)paren
op_or
id|rd
c_func
(paren
id|DIB3000MB_REG_BER_LSB
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Amaury:&n; * signal strength is measured with dBm (power compared to mW)&n; * the standard range is -90dBm(low power) to -10 dBm (strong power),&n; * but the calibration is done for -100 dBm to 0dBm&n; */
DECL|macro|DIB3000MB_AGC_REF_dBm
mdefine_line|#define DIB3000MB_AGC_REF_dBm&t;&t;-14
DECL|macro|DIB3000MB_GAIN_SLOPE_dBm
mdefine_line|#define DIB3000MB_GAIN_SLOPE_dBm&t;100
DECL|macro|DIB3000MB_GAIN_DELTA_dBm
mdefine_line|#define DIB3000MB_GAIN_DELTA_dBm&t;-2
DECL|function|dib3000mb_read_signal_strength
r_static
r_int
id|dib3000mb_read_signal_strength
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u16
op_star
id|strength
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
multiline_comment|/* TODO log10 &n;&t;u16 sigpow = rd(DIB3000MB_REG_SIGNAL_POWER), &n;&t;&t;n_agc_power = rd(DIB3000MB_REG_AGC_POWER),&n;&t;&t;rf_power = rd(DIB3000MB_REG_RF_POWER);&n;&t;double rf_power_dBm, ad_power_dBm, minar_power_dBm;&n;&t;&n;&t;if (n_agc_power == 0 )&n;&t;&t;n_agc_power = 1 ;&n;&n;&t;ad_power_dBm    = 10 * log10 ( (float)n_agc_power / (float)(1&lt;&lt;16) );&n;&t;minor_power_dBm = ad_power_dBm - DIB3000MB_AGC_REF_dBm;&n;&t;rf_power_dBm = (-DIB3000MB_GAIN_SLOPE_dBm * (float)rf_power / (float)(1&lt;&lt;16) + &n;&t;&t;&t;DIB3000MB_GAIN_DELTA_dBm) + minor_power_dBm;&n;&t;// relative rf_power &n;&t;*strength = (u16) ((rf_power_dBm + 100) / 100 * 0xffff);&n;*/
op_star
id|strength
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_SIGNAL_POWER
)paren
op_star
l_int|0xffff
op_div
l_int|0x170
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Amaury: &n; * snr is the signal quality measured in dB.&n; * snr = 10*log10(signal power / noise power)&n; * the best quality is near 35dB (cable transmission &amp; good modulator)&n; * the minimum without errors depend of transmission parameters&n; * some indicative values are given in en300744 Annex A&n; * ex : 16QAM 2/3 (Gaussian)  = 11.1 dB&n; *&n; * If SNR is above 20dB, BER should be always 0.&n; * choose 0dB as the minimum&n; */
DECL|function|dib3000mb_read_snr
r_static
r_int
id|dib3000mb_read_snr
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u16
op_star
id|snr
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
r_int
id|sigpow
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_SIGNAL_POWER
)paren
suffix:semicolon
r_int
id|icipow
op_assign
(paren
(paren
id|rd
c_func
(paren
id|DIB3000MB_REG_NOISE_POWER_MSB
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_or
id|rd
c_func
(paren
id|DIB3000MB_REG_NOISE_POWER_LSB
)paren
suffix:semicolon
multiline_comment|/*&n;&t;float snr_dBm=0;&n;&n;&t;if (sigpow &gt; 0 &amp;&amp; icipow &gt; 0)&n;&t;&t;snr_dBm = 10.0 * log10( (float) (sigpow&lt;&lt;8) / (float)icipow )  ;&n;&t;else if (sigpow &gt; 0)&n;&t;&t;snr_dBm = 35;&n;&t;&n;&t;*snr = (u16) ((snr_dBm / 35) * 0xffff);&n;*/
op_star
id|snr
op_assign
(paren
id|sigpow
op_lshift
l_int|8
)paren
op_div
(paren
(paren
id|icipow
OG
l_int|0
)paren
ques
c_cond
id|icipow
suffix:colon
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_read_unc_blocks
r_static
r_int
id|dib3000mb_read_unc_blocks
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u32
op_star
id|unc
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
op_star
id|unc
op_assign
id|rd
c_func
(paren
id|DIB3000MB_REG_UNC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_sleep
r_static
r_int
id|dib3000mb_sleep
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|wr
c_func
(paren
id|DIB3000MB_REG_POWER_CONTROL
comma
id|DIB3000MB_POWER_DOWN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fe_get_tune_settings
r_static
r_int
id|dib3000mb_fe_get_tune_settings
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_tune_settings
op_star
id|tune
)paren
(brace
id|tune-&gt;min_delay_ms
op_assign
l_int|800
suffix:semicolon
id|tune-&gt;step_size
op_assign
l_int|166667
suffix:semicolon
id|tune-&gt;max_drift
op_assign
l_int|166667
op_star
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fe_init_nonmobile
r_static
r_int
id|dib3000mb_fe_init_nonmobile
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_return
id|dib3000mb_fe_init
c_func
(paren
id|fe
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|dib3000mb_set_frontend_and_tuner
r_static
r_int
id|dib3000mb_set_frontend_and_tuner
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|fep
)paren
(brace
r_return
id|dib3000mb_set_frontend
c_func
(paren
id|fe
comma
id|fep
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dib3000mb_release
r_static
r_void
id|dib3000mb_release
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/* pid filter and transfer stuff */
DECL|function|dib3000mb_pid_control
r_static
r_int
id|dib3000mb_pid_control
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|pid
comma
r_int
id|onoff
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
id|fe-&gt;demodulator_priv
suffix:semicolon
r_int
id|index
op_assign
id|dib3000_get_pid_index
c_func
(paren
id|state-&gt;pid_list
comma
id|DIB3000MB_NUM_PIDS
comma
id|pid
comma
op_amp
id|state-&gt;pid_list_lock
comma
id|onoff
)paren
suffix:semicolon
id|pid
op_assign
(paren
id|onoff
ques
c_cond
id|pid
op_or
id|DIB3000_ACTIVATE_PID_FILTERING
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
op_ge
l_int|0
)paren
(brace
id|wr
c_func
(paren
id|index
op_plus
id|DIB3000MB_REG_FIRST_PID
comma
id|pid
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
c_func
(paren
l_string|&quot;no more pids for filtering.&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_fifo_control
r_static
r_int
id|dib3000mb_fifo_control
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|fe-&gt;demodulator_priv
suffix:semicolon
id|deb_xfer
c_func
(paren
l_string|&quot;%s fifo&bslash;n&quot;
comma
id|onoff
ques
c_cond
l_string|&quot;enabling&quot;
suffix:colon
l_string|&quot;disabling&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|onoff
)paren
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO
comma
id|DIB3000MB_FIFO_ACTIVATE
)paren
suffix:semicolon
)brace
r_else
(brace
id|wr
c_func
(paren
id|DIB3000MB_REG_FIFO
comma
id|DIB3000MB_FIFO_INHIBIT
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dib3000mb_pid_parse
r_static
r_int
id|dib3000mb_pid_parse
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
id|onoff
)paren
(brace
singleline_comment|//struct dib3000_state *state = fe-&gt;demodulator_priv;
multiline_comment|/* switch it off and on */
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dib3000mb_ops
r_static
r_struct
id|dvb_frontend_ops
id|dib3000mb_ops
suffix:semicolon
DECL|function|dib3000mb_attach
r_struct
id|dvb_frontend
op_star
id|dib3000mb_attach
c_func
(paren
r_const
r_struct
id|dib3000_config
op_star
id|config
comma
r_struct
id|i2c_adapter
op_star
id|i2c
comma
r_struct
id|dib3000_xfer_ops
op_star
id|xfer_ops
)paren
(brace
r_struct
id|dib3000_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* allocate memory for the internal state */
id|state
op_assign
(paren
r_struct
id|dib3000_state
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dib3000_state
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* setup the state */
id|state-&gt;i2c
op_assign
id|i2c
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|state-&gt;config
comma
id|config
comma
r_sizeof
(paren
r_struct
id|dib3000_config
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|state-&gt;ops
comma
op_amp
id|dib3000mb_ops
comma
r_sizeof
(paren
r_struct
id|dvb_frontend_ops
)paren
)paren
suffix:semicolon
multiline_comment|/* check for the correct demod */
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000_REG_MANUFACTOR_ID
)paren
op_ne
id|DIB3000_I2C_ID_DIBCOM
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
id|rd
c_func
(paren
id|DIB3000_REG_DEVICE_ID
)paren
op_ne
id|DIB3000MB_DEVICE_ID
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
id|dib3000_init_pid_list
c_func
(paren
id|state
comma
id|DIB3000MB_NUM_PIDS
)paren
)paren
r_goto
id|error
suffix:semicolon
multiline_comment|/* create dvb_frontend */
id|state-&gt;frontend.ops
op_assign
op_amp
id|state-&gt;ops
suffix:semicolon
id|state-&gt;frontend.demodulator_priv
op_assign
id|state
suffix:semicolon
multiline_comment|/* set the xfer operations */
id|xfer_ops-&gt;pid_parse
op_assign
id|dib3000mb_pid_parse
suffix:semicolon
id|xfer_ops-&gt;fifo_ctrl
op_assign
id|dib3000mb_fifo_control
suffix:semicolon
id|xfer_ops-&gt;pid_ctrl
op_assign
id|dib3000mb_pid_control
suffix:semicolon
r_return
op_amp
id|state-&gt;frontend
suffix:semicolon
id|error
suffix:colon
r_if
c_cond
(paren
id|state
)paren
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|dib3000mb_ops
r_static
r_struct
id|dvb_frontend_ops
id|dib3000mb_ops
op_assign
(brace
dot
id|info
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;DiBcom 3000-MB DVB-T&quot;
comma
dot
id|type
op_assign
id|FE_OFDM
comma
dot
id|frequency_min
op_assign
l_int|44250000
comma
dot
id|frequency_max
op_assign
l_int|867250000
comma
dot
id|frequency_stepsize
op_assign
l_int|62500
comma
dot
id|caps
op_assign
id|FE_CAN_INVERSION_AUTO
op_or
id|FE_CAN_FEC_1_2
op_or
id|FE_CAN_FEC_2_3
op_or
id|FE_CAN_FEC_3_4
op_or
id|FE_CAN_FEC_5_6
op_or
id|FE_CAN_FEC_7_8
op_or
id|FE_CAN_FEC_AUTO
op_or
id|FE_CAN_QPSK
op_or
id|FE_CAN_QAM_16
op_or
id|FE_CAN_QAM_64
op_or
id|FE_CAN_QAM_AUTO
op_or
id|FE_CAN_TRANSMISSION_MODE_AUTO
op_or
id|FE_CAN_GUARD_INTERVAL_AUTO
op_or
id|FE_CAN_HIERARCHY_AUTO
comma
)brace
comma
dot
id|release
op_assign
id|dib3000mb_release
comma
dot
id|init
op_assign
id|dib3000mb_fe_init_nonmobile
comma
dot
id|sleep
op_assign
id|dib3000mb_sleep
comma
dot
id|set_frontend
op_assign
id|dib3000mb_set_frontend_and_tuner
comma
dot
id|get_frontend
op_assign
id|dib3000mb_get_frontend
comma
dot
id|get_tune_settings
op_assign
id|dib3000mb_fe_get_tune_settings
comma
dot
id|read_status
op_assign
id|dib3000mb_read_status
comma
dot
id|read_ber
op_assign
id|dib3000mb_read_ber
comma
dot
id|read_signal_strength
op_assign
id|dib3000mb_read_signal_strength
comma
dot
id|read_snr
op_assign
id|dib3000mb_read_snr
comma
dot
id|read_ucblocks
op_assign
id|dib3000mb_read_unc_blocks
comma
)brace
suffix:semicolon
DECL|variable|DRIVER_AUTHOR
id|MODULE_AUTHOR
c_func
(paren
id|DRIVER_AUTHOR
)paren
suffix:semicolon
DECL|variable|DRIVER_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|DRIVER_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|dib3000mb_attach
id|EXPORT_SYMBOL
c_func
(paren
id|dib3000mb_attach
)paren
suffix:semicolon
eof
