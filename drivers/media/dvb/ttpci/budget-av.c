multiline_comment|/*&n; * budget-av.c: driver for the SAA7146 based Budget DVB cards&n; *              with analog video in &n; *&n; * Compiled from various sources by Michael Hunold &lt;michael@mihu.de&gt; &n; *&n; * CI interface support (c) 2004 Olivier Gournet &lt;ogournet@anevia.com&gt; &amp;&n; *                               Andrew de Quincey &lt;adq_dvb@lidskialf.net&gt;&n; *&n; * Copyright (C) 2002 Ralph Metzler &lt;rjkm@metzlerbros.de&gt;&n; *&n; * Copyright (C) 1999-2002 Ralph  Metzler &n; *                       &amp; Marcus Metzler for convergence integrated media GmbH&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; * &n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; * &n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; * Or, point your browser to http://www.gnu.org/copyleft/gpl.html&n; * &n; *&n; * the project&squot;s page is at http://www.linuxtv.org/dvb/&n; */
macro_line|#include &quot;budget.h&quot;
macro_line|#include &quot;stv0299.h&quot;
macro_line|#include &quot;tda10021.h&quot;
macro_line|#include &quot;tda1004x.h&quot;
macro_line|#include &lt;media/saa7146_vv.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &quot;dvb_ca_en50221.h&quot;
DECL|macro|DEBICICAM
mdefine_line|#define DEBICICAM&t;&t;0x02420000
DECL|struct|budget_av
r_struct
id|budget_av
(brace
DECL|member|budget
r_struct
id|budget
id|budget
suffix:semicolon
DECL|member|vd
r_struct
id|video_device
op_star
id|vd
suffix:semicolon
DECL|member|cur_input
r_int
id|cur_input
suffix:semicolon
DECL|member|has_saa7113
r_int
id|has_saa7113
suffix:semicolon
DECL|member|ciintf_irq_tasklet
r_struct
id|tasklet_struct
id|ciintf_irq_tasklet
suffix:semicolon
DECL|member|slot_status
r_int
id|slot_status
suffix:semicolon
DECL|member|ca
r_struct
id|dvb_ca_en50221
id|ca
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|enable_ci
r_int
id|enable_ci
op_assign
l_int|0
suffix:semicolon
multiline_comment|/****************************************************************************&n; * INITIALIZATION&n; ****************************************************************************/
DECL|function|i2c_readreg
r_static
id|u8
id|i2c_readreg
(paren
r_struct
id|i2c_adapter
op_star
id|i2c
comma
id|u8
id|id
comma
id|u8
id|reg
)paren
(brace
id|u8
id|mm1
(braket
)braket
op_assign
(brace
l_int|0x00
)brace
suffix:semicolon
id|u8
id|mm2
(braket
)braket
op_assign
(brace
l_int|0x00
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|msgs
(braket
l_int|2
)braket
suffix:semicolon
id|msgs
(braket
l_int|0
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
id|msgs
(braket
l_int|1
)braket
dot
id|flags
op_assign
id|I2C_M_RD
suffix:semicolon
id|msgs
(braket
l_int|0
)braket
dot
id|addr
op_assign
id|msgs
(braket
l_int|1
)braket
dot
id|addr
op_assign
id|id
op_div
l_int|2
suffix:semicolon
id|mm1
(braket
l_int|0
)braket
op_assign
id|reg
suffix:semicolon
id|msgs
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|1
suffix:semicolon
id|msgs
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|1
suffix:semicolon
id|msgs
(braket
l_int|0
)braket
dot
id|buf
op_assign
id|mm1
suffix:semicolon
id|msgs
(braket
l_int|1
)braket
dot
id|buf
op_assign
id|mm2
suffix:semicolon
id|i2c_transfer
c_func
(paren
id|i2c
comma
id|msgs
comma
l_int|2
)paren
suffix:semicolon
r_return
id|mm2
(braket
l_int|0
)braket
suffix:semicolon
)brace
DECL|function|i2c_readregs
r_static
r_int
id|i2c_readregs
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|i2c
comma
id|u8
id|id
comma
id|u8
id|reg
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
id|u8
id|mm1
(braket
)braket
op_assign
(brace
id|reg
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|msgs
(braket
l_int|2
)braket
op_assign
(brace
(brace
dot
id|addr
op_assign
id|id
op_div
l_int|2
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|mm1
comma
dot
id|len
op_assign
l_int|1
)brace
comma
(brace
dot
id|addr
op_assign
id|id
op_div
l_int|2
comma
dot
id|flags
op_assign
id|I2C_M_RD
comma
dot
id|buf
op_assign
id|buf
comma
dot
id|len
op_assign
id|len
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
id|i2c
comma
id|msgs
comma
l_int|2
)paren
op_ne
l_int|2
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|i2c_writereg
r_static
r_int
id|i2c_writereg
(paren
r_struct
id|i2c_adapter
op_star
id|i2c
comma
id|u8
id|id
comma
id|u8
id|reg
comma
id|u8
id|val
)paren
(brace
id|u8
id|msg
(braket
l_int|2
)braket
op_assign
initialization_block
suffix:semicolon
r_struct
id|i2c_msg
id|msgs
suffix:semicolon
id|msgs.flags
op_assign
l_int|0
suffix:semicolon
id|msgs.addr
op_assign
id|id
op_div
l_int|2
suffix:semicolon
id|msgs.len
op_assign
l_int|2
suffix:semicolon
id|msgs.buf
op_assign
id|msg
suffix:semicolon
r_return
id|i2c_transfer
c_func
(paren
id|i2c
comma
op_amp
id|msgs
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ciintf_read_attribute_mem
r_static
r_int
id|ciintf_read_attribute_mem
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
comma
r_int
id|address
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|budget_av-&gt;budget.dev
comma
l_int|1
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|result
op_assign
id|ttpci_budget_debiread
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|DEBICICAM
comma
id|address
op_amp
l_int|0xfff
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ciintf_write_attribute_mem
r_static
r_int
id|ciintf_write_attribute_mem
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
comma
r_int
id|address
comma
id|u8
id|value
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|budget_av-&gt;budget.dev
comma
l_int|1
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|result
op_assign
id|ttpci_budget_debiwrite
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|DEBICICAM
comma
id|address
op_amp
l_int|0xfff
comma
l_int|1
comma
id|value
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ciintf_read_cam_control
r_static
r_int
id|ciintf_read_cam_control
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
comma
id|u8
id|address
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|budget_av-&gt;budget.dev
comma
l_int|1
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|result
op_assign
id|ttpci_budget_debiread
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|DEBICICAM
comma
id|address
op_amp
l_int|3
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ciintf_write_cam_control
r_static
r_int
id|ciintf_write_cam_control
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
comma
id|u8
id|address
comma
id|u8
id|value
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|budget_av-&gt;budget.dev
comma
l_int|1
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|result
op_assign
id|ttpci_budget_debiwrite
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|DEBICICAM
comma
id|address
op_amp
l_int|3
comma
l_int|1
comma
id|value
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_eq
op_minus
id|ETIMEDOUT
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ciintf_slot_reset
r_static
r_int
id|ciintf_slot_reset
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;ciintf_slot_reset&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* reset the card */
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|0
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|0
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|2000
)paren
suffix:semicolon
multiline_comment|/* horrendous I know, but its the only way to be absolutely sure without an IRQ line! */
id|ttpci_budget_set_video_port
c_func
(paren
id|saa
comma
id|BUDGET_VIDEO_PORTB
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ciintf_slot_shutdown
r_static
r_int
id|ciintf_slot_shutdown
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;ciintf_slot_shutdown&bslash;n&quot;
)paren
suffix:semicolon
id|ttpci_budget_set_video_port
c_func
(paren
id|saa
comma
id|BUDGET_VIDEO_PORTB
)paren
suffix:semicolon
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ciintf_slot_ts_enable
r_static
r_int
id|ciintf_slot_ts_enable
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;ciintf_slot_ts_enable: %d&bslash;n&quot;
comma
id|budget_av-&gt;slot_status
)paren
suffix:semicolon
id|ttpci_budget_set_video_port
c_func
(paren
id|saa
comma
id|BUDGET_VIDEO_PORTA
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ciintf_poll_slot_status
r_static
r_int
id|ciintf_poll_slot_status
c_func
(paren
r_struct
id|dvb_ca_en50221
op_star
id|ca
comma
r_int
id|slot
comma
r_int
id|open
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|ca-&gt;data
suffix:semicolon
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
r_int
id|cam
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|budget_av-&gt;slot_status
)paren
(brace
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|3
comma
id|SAA7146_GPIO_INPUT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|cam
op_assign
id|saa7146_read
c_func
(paren
id|saa
comma
id|PSR
)paren
op_amp
id|MASK_06
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|3
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cam
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|open
)paren
(brace
id|saa7146_setgpio
c_func
(paren
id|budget_av-&gt;budget.dev
comma
l_int|1
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ttpci_budget_debiread
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|DEBICICAM
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|1
)paren
op_eq
op_minus
id|ETIMEDOUT
)paren
id|budget_av-&gt;slot_status
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|budget_av-&gt;slot_status
op_eq
l_int|1
)paren
r_return
id|DVB_CA_EN50221_POLL_CAM_PRESENT
op_or
id|DVB_CA_EN50221_POLL_CAM_READY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ciintf_init
r_static
r_int
id|ciintf_init
c_func
(paren
r_struct
id|budget_av
op_star
id|budget_av
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
r_int
id|result
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|budget_av-&gt;ca
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|dvb_ca_en50221
)paren
)paren
suffix:semicolon
multiline_comment|/* setup GPIOs */
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|1
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|2
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|3
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
multiline_comment|/* Reset the card */
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|0
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|0
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* Enable DEBI pins */
id|saa7146_write
c_func
(paren
id|saa
comma
id|MC1
comma
id|saa7146_read
c_func
(paren
id|saa
comma
id|MC1
)paren
op_or
(paren
l_int|0x800
op_lshift
l_int|16
)paren
op_or
l_int|0x800
)paren
suffix:semicolon
multiline_comment|/* register CI interface */
id|budget_av-&gt;ca.owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|budget_av-&gt;ca.read_attribute_mem
op_assign
id|ciintf_read_attribute_mem
suffix:semicolon
id|budget_av-&gt;ca.write_attribute_mem
op_assign
id|ciintf_write_attribute_mem
suffix:semicolon
id|budget_av-&gt;ca.read_cam_control
op_assign
id|ciintf_read_cam_control
suffix:semicolon
id|budget_av-&gt;ca.write_cam_control
op_assign
id|ciintf_write_cam_control
suffix:semicolon
id|budget_av-&gt;ca.slot_reset
op_assign
id|ciintf_slot_reset
suffix:semicolon
id|budget_av-&gt;ca.slot_shutdown
op_assign
id|ciintf_slot_shutdown
suffix:semicolon
id|budget_av-&gt;ca.slot_ts_enable
op_assign
id|ciintf_slot_ts_enable
suffix:semicolon
id|budget_av-&gt;ca.poll_slot_status
op_assign
id|ciintf_poll_slot_status
suffix:semicolon
id|budget_av-&gt;ca.data
op_assign
id|budget_av
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|dvb_ca_en50221_init
c_func
(paren
id|budget_av-&gt;budget.dvb_adapter
comma
op_amp
id|budget_av-&gt;ca
comma
l_int|0
comma
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;budget_av: CI interface detected, but initialisation failed.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
singleline_comment|// success!
id|printk
c_func
(paren
l_string|&quot;ciintf_init: CI interface initialised&bslash;n&quot;
)paren
suffix:semicolon
id|budget_av-&gt;budget.ci_present
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|saa7146_write
c_func
(paren
id|saa
comma
id|MC1
comma
id|saa7146_read
c_func
(paren
id|saa
comma
id|MC1
)paren
op_or
(paren
l_int|0x800
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|ciintf_deinit
r_static
r_void
id|ciintf_deinit
c_func
(paren
r_struct
id|budget_av
op_star
id|budget_av
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|saa
op_assign
id|budget_av-&gt;budget.dev
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|0
comma
id|SAA7146_GPIO_INPUT
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|1
comma
id|SAA7146_GPIO_INPUT
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|2
comma
id|SAA7146_GPIO_INPUT
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|saa
comma
l_int|3
comma
id|SAA7146_GPIO_INPUT
)paren
suffix:semicolon
multiline_comment|/* release the CA device */
id|dvb_ca_en50221_release
c_func
(paren
op_amp
id|budget_av-&gt;ca
)paren
suffix:semicolon
multiline_comment|/* disable DEBI pins */
id|saa7146_write
c_func
(paren
id|saa
comma
id|MC1
comma
id|saa7146_read
c_func
(paren
id|saa
comma
id|MC1
)paren
op_or
(paren
l_int|0x800
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
DECL|variable|saa7113_tab
r_static
r_const
id|u8
id|saa7113_tab
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x08
comma
l_int|0x02
comma
l_int|0xc0
comma
l_int|0x03
comma
l_int|0x33
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x05
comma
l_int|0x00
comma
l_int|0x06
comma
l_int|0xeb
comma
l_int|0x07
comma
l_int|0xe0
comma
l_int|0x08
comma
l_int|0x28
comma
l_int|0x09
comma
l_int|0x00
comma
l_int|0x0a
comma
l_int|0x80
comma
l_int|0x0b
comma
l_int|0x47
comma
l_int|0x0c
comma
l_int|0x40
comma
l_int|0x0d
comma
l_int|0x00
comma
l_int|0x0e
comma
l_int|0x01
comma
l_int|0x0f
comma
l_int|0x44
comma
l_int|0x10
comma
l_int|0x08
comma
l_int|0x11
comma
l_int|0x0c
comma
l_int|0x12
comma
l_int|0x7b
comma
l_int|0x13
comma
l_int|0x00
comma
l_int|0x15
comma
l_int|0x00
comma
l_int|0x16
comma
l_int|0x00
comma
l_int|0x17
comma
l_int|0x00
comma
l_int|0x57
comma
l_int|0xff
comma
l_int|0x40
comma
l_int|0x82
comma
l_int|0x58
comma
l_int|0x00
comma
l_int|0x59
comma
l_int|0x54
comma
l_int|0x5a
comma
l_int|0x07
comma
l_int|0x5b
comma
l_int|0x83
comma
l_int|0x5e
comma
l_int|0x00
comma
l_int|0xff
)brace
suffix:semicolon
DECL|function|saa7113_init
r_static
r_int
id|saa7113_init
(paren
r_struct
id|budget_av
op_star
id|budget_av
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
op_amp
id|budget_av-&gt;budget
suffix:semicolon
r_const
id|u8
op_star
id|data
op_assign
id|saa7113_tab
suffix:semicolon
r_if
c_cond
(paren
id|i2c_writereg
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x01
comma
l_int|0x08
)paren
op_ne
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;saa7113 not found on KNC card&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;saa7113 detected and initializing&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|data
op_ne
l_int|0xff
)paren
(brace
id|i2c_writereg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
op_star
id|data
comma
op_star
(paren
id|data
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|data
op_add_assign
l_int|2
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;saa7113  status=%02x&bslash;n&quot;
comma
id|i2c_readreg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x1f
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|saa7113_setinput
r_static
r_int
id|saa7113_setinput
(paren
r_struct
id|budget_av
op_star
id|budget_av
comma
r_int
id|input
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
op_amp
id|budget_av-&gt;budget
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|budget_av-&gt;has_saa7113
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|input
op_eq
l_int|1
)paren
(brace
id|i2c_writereg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x02
comma
l_int|0xc7
)paren
suffix:semicolon
id|i2c_writereg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x09
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|input
op_eq
l_int|0
)paren
(brace
id|i2c_writereg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x02
comma
l_int|0xc0
)paren
suffix:semicolon
id|i2c_writereg
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
l_int|0x4a
comma
l_int|0x09
comma
l_int|0x00
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|budget_av-&gt;cur_input
op_assign
id|input
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|philips_su1278_ty_ci_set_symbol_rate
r_static
r_int
id|philips_su1278_ty_ci_set_symbol_rate
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
id|u32
id|srate
comma
id|u32
id|ratio
)paren
(brace
id|u8
id|aclk
op_assign
l_int|0
suffix:semicolon
id|u8
id|bclk
op_assign
l_int|0
suffix:semicolon
id|u8
id|m1
suffix:semicolon
id|aclk
op_assign
l_int|0xb5
suffix:semicolon
r_if
c_cond
(paren
id|srate
OL
l_int|2000000
)paren
id|bclk
op_assign
l_int|0x86
suffix:semicolon
r_else
r_if
c_cond
(paren
id|srate
OL
l_int|5000000
)paren
id|bclk
op_assign
l_int|0x89
suffix:semicolon
r_else
r_if
c_cond
(paren
id|srate
OL
l_int|15000000
)paren
id|bclk
op_assign
l_int|0x8f
suffix:semicolon
r_else
r_if
c_cond
(paren
id|srate
OL
l_int|45000000
)paren
id|bclk
op_assign
l_int|0x95
suffix:semicolon
id|m1
op_assign
l_int|0x14
suffix:semicolon
r_if
c_cond
(paren
id|srate
OL
l_int|4000000
)paren
id|m1
op_assign
l_int|0x10
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x13
comma
id|aclk
)paren
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x14
comma
id|bclk
)paren
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x1f
comma
(paren
id|ratio
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x20
comma
(paren
id|ratio
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x21
comma
(paren
id|ratio
)paren
op_amp
l_int|0xf0
)paren
suffix:semicolon
id|stv0299_writereg
c_func
(paren
id|fe
comma
l_int|0x0f
comma
l_int|0x80
op_or
id|m1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|philips_su1278_ty_ci_pll_set
r_static
r_int
id|philips_su1278_ty_ci_pll_set
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|params
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|fe-&gt;dvb-&gt;priv
suffix:semicolon
id|u32
id|div
suffix:semicolon
id|u8
id|buf
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|i2c_msg
id|msg
op_assign
(brace
dot
id|addr
op_assign
l_int|0x61
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|buf
comma
dot
id|len
op_assign
r_sizeof
(paren
id|buf
)paren
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|params-&gt;frequency
OL
l_int|950000
)paren
op_logical_or
(paren
id|params-&gt;frequency
OG
l_int|2150000
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|div
op_assign
(paren
id|params-&gt;frequency
op_plus
(paren
l_int|125
op_minus
l_int|1
)paren
)paren
op_div
l_int|125
suffix:semicolon
singleline_comment|// round correctly
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x80
op_or
(paren
(paren
id|div
op_amp
l_int|0x18000
)paren
op_rshift
l_int|10
)paren
op_or
l_int|4
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;u.qpsk.symbol_rate
OL
l_int|4000000
)paren
id|buf
(braket
l_int|3
)braket
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|1250000
)paren
id|buf
(braket
l_int|3
)braket
op_or_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|1550000
)paren
id|buf
(braket
l_int|3
)braket
op_or_assign
l_int|0x40
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|2050000
)paren
id|buf
(braket
l_int|3
)braket
op_or_assign
l_int|0x80
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|2150000
)paren
id|buf
(braket
l_int|3
)braket
op_or_assign
l_int|0xC0
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget_av-&gt;budget.i2c_adap
comma
op_amp
id|msg
comma
l_int|1
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|typhoon_cinergy1200s_inittab
r_static
id|u8
id|typhoon_cinergy1200s_inittab
(braket
)braket
op_assign
(brace
l_int|0x01
comma
l_int|0x15
comma
l_int|0x02
comma
l_int|0x30
comma
l_int|0x03
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x7d
comma
multiline_comment|/* F22FR = 0x7d, F22 = f_VCO / 128 / 0x7d = 22 kHz */
l_int|0x05
comma
l_int|0x35
comma
multiline_comment|/* I2CT = 0, SCLT = 1, SDAT = 1 */
l_int|0x06
comma
l_int|0x40
comma
multiline_comment|/* DAC not used, set to high impendance mode */
l_int|0x07
comma
l_int|0x00
comma
multiline_comment|/* DAC LSB */
l_int|0x08
comma
l_int|0x40
comma
multiline_comment|/* DiSEqC off */
l_int|0x09
comma
l_int|0x00
comma
multiline_comment|/* FIFO */
l_int|0x0c
comma
l_int|0x51
comma
multiline_comment|/* OP1 ctl = Normal, OP1 val = 1 (LNB Power ON) */
l_int|0x0d
comma
l_int|0x82
comma
multiline_comment|/* DC offset compensation = ON, beta_agc1 = 2 */
l_int|0x0e
comma
l_int|0x23
comma
multiline_comment|/* alpha_tmg = 2, beta_tmg = 3 */
l_int|0x10
comma
l_int|0x3f
comma
singleline_comment|// AGC2  0x3d
l_int|0x11
comma
l_int|0x84
comma
l_int|0x12
comma
l_int|0xb5
comma
singleline_comment|// Lock detect: -64  Carrier freq detect:on
l_int|0x15
comma
l_int|0xc9
comma
singleline_comment|// lock detector threshold
l_int|0x16
comma
l_int|0x00
comma
l_int|0x17
comma
l_int|0x00
comma
l_int|0x18
comma
l_int|0x00
comma
l_int|0x19
comma
l_int|0x00
comma
l_int|0x1a
comma
l_int|0x00
comma
l_int|0x1f
comma
l_int|0x50
comma
l_int|0x20
comma
l_int|0x00
comma
l_int|0x21
comma
l_int|0x00
comma
l_int|0x22
comma
l_int|0x00
comma
l_int|0x23
comma
l_int|0x00
comma
l_int|0x28
comma
l_int|0x00
comma
singleline_comment|// out imp: normal  out type: parallel FEC mode:0
l_int|0x29
comma
l_int|0x1e
comma
singleline_comment|// 1/2 threshold
l_int|0x2a
comma
l_int|0x14
comma
singleline_comment|// 2/3 threshold
l_int|0x2b
comma
l_int|0x0f
comma
singleline_comment|// 3/4 threshold
l_int|0x2c
comma
l_int|0x09
comma
singleline_comment|// 5/6 threshold
l_int|0x2d
comma
l_int|0x05
comma
singleline_comment|// 7/8 threshold
l_int|0x2e
comma
l_int|0x01
comma
l_int|0x31
comma
l_int|0x1f
comma
singleline_comment|// test all FECs
l_int|0x32
comma
l_int|0x19
comma
singleline_comment|// viterbi and synchro search
l_int|0x33
comma
l_int|0xfc
comma
singleline_comment|// rs control
l_int|0x34
comma
l_int|0x93
comma
singleline_comment|// error control
l_int|0x0f
comma
l_int|0x92
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|typhoon_config
r_static
r_struct
id|stv0299_config
id|typhoon_config
op_assign
(brace
dot
id|demod_address
op_assign
l_int|0x68
comma
dot
id|inittab
op_assign
id|typhoon_cinergy1200s_inittab
comma
dot
id|mclk
op_assign
l_int|88000000UL
comma
dot
id|invert
op_assign
l_int|0
comma
dot
id|enhanced_tuning
op_assign
l_int|0
comma
dot
id|skip_reinit
op_assign
l_int|0
comma
dot
id|lock_output
op_assign
id|STV0229_LOCKOUTPUT_1
comma
dot
id|volt13_op0_op1
op_assign
id|STV0299_VOLT13_OP0
comma
dot
id|min_delay_ms
op_assign
l_int|100
comma
dot
id|set_symbol_rate
op_assign
id|philips_su1278_ty_ci_set_symbol_rate
comma
dot
id|pll_set
op_assign
id|philips_su1278_ty_ci_pll_set
comma
)brace
suffix:semicolon
DECL|variable|cinergy_1200s_config
r_static
r_struct
id|stv0299_config
id|cinergy_1200s_config
op_assign
(brace
dot
id|demod_address
op_assign
l_int|0x68
comma
dot
id|inittab
op_assign
id|typhoon_cinergy1200s_inittab
comma
dot
id|mclk
op_assign
l_int|88000000UL
comma
dot
id|invert
op_assign
l_int|0
comma
dot
id|enhanced_tuning
op_assign
l_int|0
comma
dot
id|skip_reinit
op_assign
l_int|0
comma
dot
id|lock_output
op_assign
id|STV0229_LOCKOUTPUT_0
comma
dot
id|volt13_op0_op1
op_assign
id|STV0299_VOLT13_OP0
comma
dot
id|min_delay_ms
op_assign
l_int|100
comma
dot
id|set_symbol_rate
op_assign
id|philips_su1278_ty_ci_set_symbol_rate
comma
dot
id|pll_set
op_assign
id|philips_su1278_ty_ci_pll_set
comma
)brace
suffix:semicolon
DECL|function|philips_cu1216_pll_set
r_static
r_int
id|philips_cu1216_pll_set
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|params
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
(paren
r_struct
id|budget
op_star
)paren
id|fe-&gt;dvb-&gt;priv
suffix:semicolon
id|u8
id|buf
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|i2c_msg
id|msg
op_assign
(brace
dot
id|addr
op_assign
l_int|0x60
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|buf
comma
dot
id|len
op_assign
r_sizeof
(paren
id|buf
)paren
)brace
suffix:semicolon
DECL|macro|TUNER_MUL
mdefine_line|#define TUNER_MUL 62500
id|u32
id|div
op_assign
(paren
id|params-&gt;frequency
op_plus
l_int|36125000
op_plus
id|TUNER_MUL
op_div
l_int|2
)paren
op_div
id|TUNER_MUL
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x8e
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
(paren
id|params-&gt;frequency
OL
l_int|174500000
ques
c_cond
l_int|0xa1
suffix:colon
id|params-&gt;frequency
OL
l_int|454000000
ques
c_cond
l_int|0x92
suffix:colon
l_int|0x34
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
op_amp
id|msg
comma
l_int|1
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|philips_cu1216_config
r_static
r_struct
id|tda10021_config
id|philips_cu1216_config
op_assign
(brace
dot
id|demod_address
op_assign
l_int|0x0c
comma
dot
id|pll_set
op_assign
id|philips_cu1216_pll_set
comma
)brace
suffix:semicolon
DECL|function|philips_tu1216_pll_init
r_static
r_int
id|philips_tu1216_pll_init
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
(paren
r_struct
id|budget
op_star
)paren
id|fe-&gt;dvb-&gt;priv
suffix:semicolon
r_static
id|u8
id|tu1216_init
(braket
)braket
op_assign
(brace
l_int|0x0b
comma
l_int|0xf5
comma
l_int|0x85
comma
l_int|0xab
)brace
suffix:semicolon
r_static
id|u8
id|disable_mc44BC374c
(braket
)braket
op_assign
(brace
l_int|0x1d
comma
l_int|0x74
comma
l_int|0xa0
comma
l_int|0x68
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|tuner_msg
op_assign
(brace
dot
id|addr
op_assign
l_int|0x60
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|tu1216_init
comma
dot
id|len
op_assign
r_sizeof
(paren
id|tu1216_init
)paren
)brace
suffix:semicolon
singleline_comment|// setup PLL configuration
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
op_amp
id|tuner_msg
comma
l_int|1
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
singleline_comment|// disable the mc44BC374c (do not check for errors)
id|tuner_msg.addr
op_assign
l_int|0x65
suffix:semicolon
id|tuner_msg.buf
op_assign
id|disable_mc44BC374c
suffix:semicolon
id|tuner_msg.len
op_assign
r_sizeof
(paren
id|disable_mc44BC374c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
op_amp
id|tuner_msg
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|i2c_transfer
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
op_amp
id|tuner_msg
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|philips_tu1216_pll_set
r_static
r_int
id|philips_tu1216_pll_set
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_struct
id|dvb_frontend_parameters
op_star
id|params
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
(paren
r_struct
id|budget
op_star
)paren
id|fe-&gt;dvb-&gt;priv
suffix:semicolon
id|u8
id|tuner_buf
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|i2c_msg
id|tuner_msg
op_assign
(brace
dot
id|addr
op_assign
l_int|0x60
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|tuner_buf
comma
dot
id|len
op_assign
r_sizeof
(paren
id|tuner_buf
)paren
)brace
suffix:semicolon
r_int
id|tuner_frequency
op_assign
l_int|0
suffix:semicolon
id|u8
id|band
comma
id|cp
comma
id|filter
suffix:semicolon
singleline_comment|// determine charge pump
id|tuner_frequency
op_assign
id|params-&gt;frequency
op_plus
l_int|36130000
suffix:semicolon
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|87000000
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|130000000
)paren
id|cp
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|160000000
)paren
id|cp
op_assign
l_int|5
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|200000000
)paren
id|cp
op_assign
l_int|6
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|290000000
)paren
id|cp
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|420000000
)paren
id|cp
op_assign
l_int|5
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|480000000
)paren
id|cp
op_assign
l_int|6
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|620000000
)paren
id|cp
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|830000000
)paren
id|cp
op_assign
l_int|5
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tuner_frequency
OL
l_int|895000000
)paren
id|cp
op_assign
l_int|7
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
singleline_comment|// determine band
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|49000000
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|159000000
)paren
id|band
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|444000000
)paren
id|band
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|params-&gt;frequency
OL
l_int|861000000
)paren
id|band
op_assign
l_int|4
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
singleline_comment|// setup PLL filter
r_switch
c_cond
(paren
id|params-&gt;u.ofdm.bandwidth
)paren
(brace
r_case
id|BANDWIDTH_6_MHZ
suffix:colon
id|tda1004x_write_byte
c_func
(paren
id|fe
comma
l_int|0x0C
comma
l_int|0
)paren
suffix:semicolon
id|filter
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_7_MHZ
suffix:colon
id|tda1004x_write_byte
c_func
(paren
id|fe
comma
l_int|0x0C
comma
l_int|0
)paren
suffix:semicolon
id|filter
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BANDWIDTH_8_MHZ
suffix:colon
id|tda1004x_write_byte
c_func
(paren
id|fe
comma
l_int|0x0C
comma
l_int|0xFF
)paren
suffix:semicolon
id|filter
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
singleline_comment|// calculate divisor
singleline_comment|// ((36130000+((1000000/6)/2)) + Finput)/(1000000/6)
id|tuner_frequency
op_assign
(paren
(paren
(paren
id|params-&gt;frequency
op_div
l_int|1000
)paren
op_star
l_int|6
)paren
op_plus
l_int|217280
)paren
op_div
l_int|1000
suffix:semicolon
singleline_comment|// setup tuner buffer
id|tuner_buf
(braket
l_int|0
)braket
op_assign
id|tuner_frequency
op_rshift
l_int|8
suffix:semicolon
id|tuner_buf
(braket
l_int|1
)braket
op_assign
id|tuner_frequency
op_amp
l_int|0xff
suffix:semicolon
id|tuner_buf
(braket
l_int|2
)braket
op_assign
l_int|0xca
suffix:semicolon
id|tuner_buf
(braket
l_int|3
)braket
op_assign
(paren
id|cp
op_lshift
l_int|5
)paren
op_or
(paren
id|filter
op_lshift
l_int|3
)paren
op_or
id|band
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget-&gt;i2c_adap
comma
op_amp
id|tuner_msg
comma
l_int|1
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|philips_tu1216_request_firmware
r_static
r_int
id|philips_tu1216_request_firmware
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_const
r_struct
id|firmware
op_star
op_star
id|fw
comma
r_char
op_star
id|name
)paren
(brace
r_struct
id|budget
op_star
id|budget
op_assign
(paren
r_struct
id|budget
op_star
)paren
id|fe-&gt;dvb-&gt;priv
suffix:semicolon
r_return
id|request_firmware
c_func
(paren
id|fw
comma
id|name
comma
op_amp
id|budget-&gt;dev-&gt;pci-&gt;dev
)paren
suffix:semicolon
)brace
DECL|variable|philips_tu1216_config
r_struct
id|tda1004x_config
id|philips_tu1216_config
op_assign
(brace
dot
id|demod_address
op_assign
l_int|0x8
comma
dot
id|invert
op_assign
l_int|1
comma
dot
id|pll_init
op_assign
id|philips_tu1216_pll_init
comma
dot
id|pll_set
op_assign
id|philips_tu1216_pll_set
comma
dot
id|request_firmware
op_assign
id|philips_tu1216_request_firmware
comma
)brace
suffix:semicolon
DECL|function|read_pwm
r_static
id|u8
id|read_pwm
c_func
(paren
r_struct
id|budget_av
op_star
id|budget_av
)paren
(brace
id|u8
id|b
op_assign
l_int|0xff
suffix:semicolon
id|u8
id|pwm
suffix:semicolon
r_struct
id|i2c_msg
id|msg
(braket
)braket
op_assign
(brace
(brace
dot
id|addr
op_assign
l_int|0x50
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
op_amp
id|b
comma
dot
id|len
op_assign
l_int|1
)brace
comma
(brace
dot
id|addr
op_assign
l_int|0x50
comma
dot
id|flags
op_assign
id|I2C_M_RD
comma
dot
id|buf
op_assign
op_amp
id|pwm
comma
dot
id|len
op_assign
l_int|1
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|budget_av-&gt;budget.i2c_adap
comma
id|msg
comma
l_int|2
)paren
op_ne
l_int|2
)paren
op_logical_or
(paren
id|pwm
op_eq
l_int|0xff
)paren
)paren
id|pwm
op_assign
l_int|0x48
suffix:semicolon
r_return
id|pwm
suffix:semicolon
)brace
DECL|function|frontend_init
r_static
r_void
id|frontend_init
c_func
(paren
r_struct
id|budget_av
op_star
id|budget_av
)paren
(brace
r_switch
c_cond
(paren
id|budget_av-&gt;budget.dev-&gt;pci-&gt;subsystem_device
)paren
(brace
r_case
l_int|0x4f56
suffix:colon
singleline_comment|// Typhoon/KNC1 DVB-S budget (stv0299/Philips SU1278(tsa5059))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|stv0299_attach
c_func
(paren
op_amp
id|typhoon_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_ne
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x0020
suffix:colon
singleline_comment|// KNC1 DVB-C budget (tda10021/Philips CU1216(tua6034))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|tda10021_attach
c_func
(paren
op_amp
id|philips_cu1216_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
comma
id|read_pwm
c_func
(paren
id|budget_av
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_ne
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x0030
suffix:colon
singleline_comment|// KNC1 DVB-T budget (tda10046/Philips TU1216(tda6651tt))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|tda10046_attach
c_func
(paren
op_amp
id|philips_tu1216_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_ne
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x1154
suffix:colon
singleline_comment|// TerraTec Cinergy 1200 DVB-S (stv0299/Philips SU1278(tsa5059))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|stv0299_attach
c_func
(paren
op_amp
id|cinergy_1200s_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_ne
l_int|NULL
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x1156
suffix:colon
singleline_comment|// Terratec Cinergy 1200 DVB-C (tda10021/Philips CU1216(tua6034))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|tda10021_attach
c_func
(paren
op_amp
id|philips_cu1216_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
comma
id|read_pwm
c_func
(paren
id|budget_av
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x1157
suffix:colon
singleline_comment|// Terratec Cinergy 1200 DVB-T (tda10046/Philips TU1216(tda6651tt))
id|budget_av-&gt;budget.dvb_frontend
op_assign
id|tda10046_attach
c_func
(paren
op_amp
id|philips_tu1216_config
comma
op_amp
id|budget_av-&gt;budget.i2c_adap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
)paren
(brace
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;budget_av: A frontend driver was not found for device %04x/%04x subsystem %04x/%04x&bslash;n&quot;
comma
id|budget_av-&gt;budget.dev-&gt;pci-&gt;vendor
comma
id|budget_av-&gt;budget.dev-&gt;pci-&gt;device
comma
id|budget_av-&gt;budget.dev-&gt;pci-&gt;subsystem_vendor
comma
id|budget_av-&gt;budget.dev-&gt;pci-&gt;subsystem_device
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dvb_register_frontend
(paren
id|budget_av-&gt;budget.dvb_adapter
comma
id|budget_av-&gt;budget.dvb_frontend
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;budget-av: Frontend registration failed!&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend-&gt;ops-&gt;release
)paren
id|budget_av-&gt;budget.dvb_frontend-&gt;ops
op_member_access_from_pointer
id|release
c_func
(paren
id|budget_av-&gt;budget.dvb_frontend
)paren
suffix:semicolon
id|budget_av-&gt;budget.dvb_frontend
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|function|budget_av_irq
r_static
r_void
id|budget_av_irq
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
id|u32
op_star
id|isr
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
id|dprintk
c_func
(paren
l_int|8
comma
l_string|&quot;dev: %p, budget_av: %p&bslash;n&quot;
comma
id|dev
comma
id|budget_av
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|isr
op_amp
id|MASK_10
)paren
id|ttpci_budget_irq10_handler
c_func
(paren
id|dev
comma
id|isr
)paren
suffix:semicolon
)brace
DECL|function|budget_av_detach
r_static
r_int
id|budget_av_detach
(paren
r_struct
id|saa7146_dev
op_star
id|dev
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;dev: %p&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_eq
id|budget_av-&gt;has_saa7113
)paren
(brace
id|saa7146_setgpio
c_func
(paren
id|dev
comma
l_int|0
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|200
)paren
suffix:semicolon
id|saa7146_unregister_device
(paren
op_amp
id|budget_av-&gt;vd
comma
id|dev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|budget_av-&gt;budget.ci_present
)paren
id|ciintf_deinit
c_func
(paren
id|budget_av
)paren
suffix:semicolon
r_if
c_cond
(paren
id|budget_av-&gt;budget.dvb_frontend
op_ne
l_int|NULL
)paren
id|dvb_unregister_frontend
c_func
(paren
id|budget_av-&gt;budget.dvb_frontend
)paren
suffix:semicolon
id|err
op_assign
id|ttpci_budget_deinit
(paren
op_amp
id|budget_av-&gt;budget
)paren
suffix:semicolon
id|kfree
(paren
id|budget_av
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|vv_data
r_static
r_struct
id|saa7146_ext_vv
id|vv_data
suffix:semicolon
DECL|function|budget_av_attach
r_static
r_int
id|budget_av_attach
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_pci_extension_data
op_star
id|info
)paren
(brace
r_struct
id|budget_av
op_star
id|budget_av
suffix:semicolon
id|u8
op_star
id|mac
suffix:semicolon
r_int
id|err
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;dev: %p&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|budget_av
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|budget_av
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|budget_av
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|budget_av
)paren
)paren
suffix:semicolon
id|budget_av-&gt;budget.ci_present
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;ext_priv
op_assign
id|budget_av
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ttpci_budget_init
c_func
(paren
op_amp
id|budget_av-&gt;budget
comma
id|dev
comma
id|info
comma
id|THIS_MODULE
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|budget_av
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* knc1 initialization */
id|saa7146_write
c_func
(paren
id|dev
comma
id|DD1_STREAM_B
comma
l_int|0x04000000
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|DD1_INIT
comma
l_int|0x07000600
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
id|MASK_09
op_or
id|MASK_25
op_or
id|MASK_10
op_or
id|MASK_26
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|dev
comma
l_int|0
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|500
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|saa7113_init
c_func
(paren
id|budget_av
)paren
)paren
(brace
id|budget_av-&gt;has_saa7113
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|saa7146_vv_init
c_func
(paren
id|dev
comma
op_amp
id|vv_data
)paren
)paren
(brace
multiline_comment|/* fixme: proper cleanup here */
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot init vv subsystem.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|saa7146_register_device
c_func
(paren
op_amp
id|budget_av-&gt;vd
comma
id|dev
comma
l_string|&quot;knc1&quot;
comma
id|VFL_TYPE_GRABBER
)paren
)paren
)paren
(brace
multiline_comment|/* fixme: proper cleanup here */
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot register capture v4l2 device.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* beware: this modifies dev-&gt;vv ... */
id|saa7146_set_hps_source_and_sync
c_func
(paren
id|dev
comma
id|SAA7146_HPS_SOURCE_PORT_A
comma
id|SAA7146_HPS_SYNC_PORT_A
)paren
suffix:semicolon
id|saa7113_setinput
(paren
id|budget_av
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|budget_av-&gt;has_saa7113
op_assign
l_int|0
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|dev
comma
l_int|0
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
)brace
multiline_comment|/* fixme: find some sane values here... */
id|saa7146_write
c_func
(paren
id|dev
comma
id|PCI_BT_V1
comma
l_int|0x1c00101f
)paren
suffix:semicolon
id|mac
op_assign
id|budget_av-&gt;budget.dvb_adapter-&gt;proposed_mac
suffix:semicolon
r_if
c_cond
(paren
id|i2c_readregs
c_func
(paren
op_amp
id|budget_av-&gt;budget.i2c_adap
comma
l_int|0xa0
comma
l_int|0x30
comma
id|mac
comma
l_int|6
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;KNC1-%d: Could not read MAC from KNC1 card&bslash;n&quot;
comma
id|budget_av-&gt;budget.dvb_adapter-&gt;num
)paren
suffix:semicolon
id|memset
c_func
(paren
id|mac
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;KNC1-%d: MAC addr = %.2x:%.2x:%.2x:%.2x:%.2x:%.2x&bslash;n&quot;
comma
id|budget_av-&gt;budget.dvb_adapter-&gt;num
comma
id|mac
(braket
l_int|0
)braket
comma
id|mac
(braket
l_int|1
)braket
comma
id|mac
(braket
l_int|2
)braket
comma
id|mac
(braket
l_int|3
)braket
comma
id|mac
(braket
l_int|4
)braket
comma
id|mac
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
id|budget_av-&gt;budget.dvb_adapter-&gt;priv
op_assign
id|budget_av
suffix:semicolon
id|frontend_init
c_func
(paren
id|budget_av
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable_ci
)paren
id|ciintf_init
c_func
(paren
id|budget_av
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|KNC1_INPUTS
mdefine_line|#define KNC1_INPUTS 2
DECL|variable|knc1_inputs
r_static
r_struct
id|v4l2_input
id|knc1_inputs
(braket
id|KNC1_INPUTS
)braket
op_assign
(brace
(brace
l_int|0
comma
l_string|&quot;Composite&quot;
comma
id|V4L2_INPUT_TYPE_TUNER
comma
l_int|1
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
(brace
l_int|1
comma
l_string|&quot;S-Video&quot;
comma
id|V4L2_INPUT_TYPE_CAMERA
comma
l_int|2
comma
l_int|0
comma
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|variable|ioctls
r_static
r_struct
id|saa7146_extension_ioctls
id|ioctls
(braket
)braket
op_assign
(brace
(brace
id|VIDIOC_ENUMINPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|av_ioctl
r_static
r_int
id|av_ioctl
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_struct
id|budget_av
op_star
id|budget_av
op_assign
(paren
r_struct
id|budget_av
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOC_ENUMINPUT
suffix:colon
(brace
r_struct
id|v4l2_input
op_star
id|i
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_ENUMINPUT %d.&bslash;n&quot;
comma
id|i-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;index
OL
l_int|0
op_logical_or
id|i-&gt;index
op_ge
id|KNC1_INPUTS
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|i
comma
op_amp
id|knc1_inputs
(braket
id|i-&gt;index
)braket
comma
r_sizeof
(paren
r_struct
id|v4l2_input
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_INPUT
suffix:colon
(brace
r_int
op_star
id|input
op_assign
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
op_star
id|input
op_assign
id|budget_av-&gt;cur_input
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_G_INPUT %d.&bslash;n&quot;
comma
op_star
id|input
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_INPUT
suffix:colon
(brace
r_int
id|input
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_S_INPUT %d.&bslash;n&quot;
comma
id|input
)paren
suffix:semicolon
r_return
id|saa7113_setinput
(paren
id|budget_av
comma
id|input
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|standard
r_static
r_struct
id|saa7146_standard
id|standard
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;PAL&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL
comma
dot
id|v_offset
op_assign
l_int|0x17
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x14
comma
dot
id|h_pixels
op_assign
l_int|680
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;NTSC&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_NTSC
comma
dot
id|v_offset
op_assign
l_int|0x16
comma
dot
id|v_field
op_assign
l_int|240
comma
dot
id|h_offset
op_assign
l_int|0x06
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|480
comma
dot
id|h_max_out
op_assign
l_int|640
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|vv_data
r_static
r_struct
id|saa7146_ext_vv
id|vv_data
op_assign
(brace
dot
id|inputs
op_assign
l_int|2
comma
dot
id|capabilities
op_assign
l_int|0
comma
singleline_comment|// perhaps later: V4L2_CAP_VBI_CAPTURE, but that need tweaking with the saa7113
dot
id|flags
op_assign
l_int|0
comma
dot
id|stds
op_assign
op_amp
id|standard
(braket
l_int|0
)braket
comma
dot
id|num_stds
op_assign
r_sizeof
(paren
id|standard
)paren
op_div
r_sizeof
(paren
r_struct
id|saa7146_standard
)paren
comma
dot
id|ioctls
op_assign
op_amp
id|ioctls
(braket
l_int|0
)braket
comma
dot
id|ioctl
op_assign
id|av_ioctl
comma
)brace
suffix:semicolon
DECL|variable|budget_extension
r_static
r_struct
id|saa7146_extension
id|budget_extension
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|knc1s
comma
l_string|&quot;KNC1 DVB-S&quot;
comma
id|BUDGET_KNC1S
)paren
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|knc1c
comma
l_string|&quot;KNC1 DVB-C&quot;
comma
id|BUDGET_KNC1C
)paren
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|knc1t
comma
l_string|&quot;KNC1 DVB-T&quot;
comma
id|BUDGET_KNC1T
)paren
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|cin1200s
comma
l_string|&quot;TerraTec Cinergy 1200 DVB-S&quot;
comma
id|BUDGET_CIN1200S
)paren
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|cin1200c
comma
l_string|&quot;Terratec Cinergy 1200 DVB-C&quot;
comma
id|BUDGET_CIN1200C
)paren
suffix:semicolon
id|MAKE_BUDGET_INFO
c_func
(paren
id|cin1200t
comma
l_string|&quot;Terratec Cinergy 1200 DVB-T&quot;
comma
id|BUDGET_CIN1200T
)paren
suffix:semicolon
DECL|variable|pci_tbl
r_static
r_struct
id|pci_device_id
id|pci_tbl
(braket
)braket
op_assign
(brace
id|MAKE_EXTENSION_PCI
c_func
(paren
id|knc1s
comma
l_int|0x1131
comma
l_int|0x4f56
)paren
comma
id|MAKE_EXTENSION_PCI
c_func
(paren
id|knc1c
comma
l_int|0x1894
comma
l_int|0x0020
)paren
comma
id|MAKE_EXTENSION_PCI
c_func
(paren
id|knc1t
comma
l_int|0x1894
comma
l_int|0x0030
)paren
comma
id|MAKE_EXTENSION_PCI
c_func
(paren
id|cin1200s
comma
l_int|0x153b
comma
l_int|0x1154
)paren
comma
id|MAKE_EXTENSION_PCI
c_func
(paren
id|cin1200c
comma
l_int|0x153b
comma
l_int|0x1156
)paren
comma
id|MAKE_EXTENSION_PCI
c_func
(paren
id|cin1200t
comma
l_int|0x153b
comma
l_int|0x1157
)paren
comma
(brace
dot
id|vendor
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|pci_tbl
)paren
suffix:semicolon
DECL|variable|budget_extension
r_static
r_struct
id|saa7146_extension
id|budget_extension
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;budget dvb /w video in&bslash;0&quot;
comma
dot
id|pci_tbl
op_assign
id|pci_tbl
comma
dot
id|module
op_assign
id|THIS_MODULE
comma
dot
id|attach
op_assign
id|budget_av_attach
comma
dot
id|detach
op_assign
id|budget_av_detach
comma
dot
id|irq_mask
op_assign
id|MASK_10
comma
dot
id|irq_func
op_assign
id|budget_av_irq
comma
)brace
suffix:semicolon
DECL|function|budget_av_init
r_static
r_int
id|__init
id|budget_av_init
c_func
(paren
r_void
)paren
(brace
r_return
id|saa7146_register_extension
c_func
(paren
op_amp
id|budget_extension
)paren
suffix:semicolon
)brace
DECL|function|budget_av_exit
r_static
r_void
id|__exit
id|budget_av_exit
c_func
(paren
r_void
)paren
(brace
id|saa7146_unregister_extension
c_func
(paren
op_amp
id|budget_extension
)paren
suffix:semicolon
)brace
DECL|variable|budget_av_init
id|module_init
c_func
(paren
id|budget_av_init
)paren
suffix:semicolon
DECL|variable|budget_av_exit
id|module_exit
c_func
(paren
id|budget_av_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Ralph Metzler, Marcus Metzler, Michael Hunold, others&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;driver for the SAA7146 based so-called &quot;
l_string|&quot;budget PCI DVB w/ analog input and CI-module (e.g. the KNC cards)&quot;
)paren
suffix:semicolon
id|module_param_named
c_func
(paren
id|enable_ci
comma
id|enable_ci
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable_ci
comma
l_string|&quot;Turn on/off CI module (default:off).&quot;
)paren
suffix:semicolon
eof
