multiline_comment|/*&n; * av7110_v4l.c: av7110 video4linux interface for DVB and Siemens DVB-C analog module&n; *&n; * Copyright (C) 1999-2002 Ralph  Metzler&n; *                       &amp; Marcus Metzler for convergence integrated media GmbH&n; *&n; * originally based on code by:&n; * Copyright (C) 1998,1999 Christian Theiss &lt;mistert@rz.fh-augsburg.de&gt;&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; * Or, point your browser to http://www.gnu.org/copyleft/gpl.html&n; *&n; * the project&squot;s page is at http://www.linuxtv.org/dvb/&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/byteorder/swabb.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &quot;av7110.h&quot;
macro_line|#include &quot;av7110_hw.h&quot;
macro_line|#include &quot;av7110_av.h&quot;
DECL|function|msp_writereg
r_int
id|msp_writereg
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|dev
comma
id|u16
id|reg
comma
id|u16
id|val
)paren
(brace
id|u8
id|msg
(braket
l_int|5
)braket
op_assign
(brace
id|dev
comma
id|reg
op_rshift
l_int|8
comma
id|reg
op_amp
l_int|0xff
comma
id|val
op_rshift
l_int|8
comma
id|val
op_amp
l_int|0xff
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|msgs
op_assign
(brace
dot
id|flags
op_assign
l_int|0
comma
dot
id|addr
op_assign
l_int|0x40
comma
dot
id|len
op_assign
l_int|5
comma
dot
id|buf
op_assign
id|msg
)brace
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|av7110-&gt;i2c_adap
comma
op_amp
id|msgs
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;dvb-ttpci: failed @ card %d, %u = %u&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msp_readreg
r_int
id|msp_readreg
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|dev
comma
id|u16
id|reg
comma
id|u16
op_star
id|val
)paren
(brace
id|u8
id|msg1
(braket
l_int|3
)braket
op_assign
(brace
id|dev
comma
id|reg
op_rshift
l_int|8
comma
id|reg
op_amp
l_int|0xff
)brace
suffix:semicolon
id|u8
id|msg2
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|i2c_msg
id|msgs
(braket
l_int|2
)braket
op_assign
(brace
(brace
dot
id|flags
op_assign
l_int|0
comma
dot
id|addr
op_assign
l_int|0x40
comma
dot
id|len
op_assign
l_int|3
comma
dot
id|buf
op_assign
id|msg1
)brace
comma
(brace
dot
id|flags
op_assign
id|I2C_M_RD
comma
dot
id|addr
op_assign
l_int|0x40
comma
dot
id|len
op_assign
l_int|2
comma
dot
id|buf
op_assign
id|msg2
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|i2c_transfer
c_func
(paren
op_amp
id|av7110-&gt;i2c_adap
comma
op_amp
id|msgs
(braket
l_int|0
)braket
comma
l_int|2
)paren
op_ne
l_int|2
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;dvb-ttpci: failed @ card %d, %u&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
comma
id|reg
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
op_star
id|val
op_assign
(paren
id|msg2
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|msg2
(braket
l_int|1
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|inputs
r_static
r_struct
id|v4l2_input
id|inputs
(braket
l_int|2
)braket
op_assign
(brace
(brace
dot
id|index
op_assign
l_int|0
comma
dot
id|name
op_assign
l_string|&quot;DVB&quot;
comma
dot
id|type
op_assign
id|V4L2_INPUT_TYPE_CAMERA
comma
dot
id|audioset
op_assign
l_int|1
comma
dot
id|tuner
op_assign
l_int|0
comma
multiline_comment|/* ignored */
dot
id|std
op_assign
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
dot
id|status
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|index
op_assign
l_int|1
comma
dot
id|name
op_assign
l_string|&quot;Television&quot;
comma
dot
id|type
op_assign
id|V4L2_INPUT_TYPE_TUNER
comma
dot
id|audioset
op_assign
l_int|2
comma
dot
id|tuner
op_assign
l_int|0
comma
dot
id|std
op_assign
id|V4L2_STD_PAL_BG
op_or
id|V4L2_STD_NTSC_M
comma
dot
id|status
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* for Siemens DVB-C analog module: (taken from ves1820.c) */
DECL|function|ves1820_writereg
r_static
r_int
id|ves1820_writereg
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
id|u8
id|reg
comma
id|u8
id|data
)paren
(brace
id|u8
id|addr
op_assign
l_int|0x09
suffix:semicolon
id|u8
id|buf
(braket
)braket
op_assign
(brace
l_int|0x00
comma
id|reg
comma
id|data
)brace
suffix:semicolon
r_struct
id|i2c_msg
id|msg
op_assign
(brace
dot
id|addr
op_assign
id|addr
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|buf
comma
dot
id|len
op_assign
l_int|3
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;dev: %p&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|saa7146_i2c_transfer
c_func
(paren
id|dev
comma
op_amp
id|msg
comma
l_int|1
comma
l_int|1
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tuner_write
r_static
r_int
id|tuner_write
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
id|u8
id|addr
comma
id|u8
id|data
(braket
l_int|4
)braket
)paren
(brace
r_struct
id|i2c_msg
id|msg
op_assign
(brace
dot
id|addr
op_assign
id|addr
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|buf
op_assign
id|data
comma
dot
id|len
op_assign
l_int|4
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;dev: %p&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
op_ne
id|saa7146_i2c_transfer
c_func
(paren
id|dev
comma
op_amp
id|msg
comma
l_int|1
comma
l_int|1
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *   set up the downconverter frequency divisor for a&n; *   reference clock comparision frequency of 62.5 kHz.&n; */
DECL|function|tuner_set_tv_freq
r_static
r_int
id|tuner_set_tv_freq
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
id|u32
id|freq
)paren
(brace
id|u32
id|div
suffix:semicolon
id|u8
id|config
suffix:semicolon
id|u8
id|buf
(braket
l_int|4
)braket
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;freq: 0x%08x&bslash;n&quot;
comma
id|freq
)paren
suffix:semicolon
multiline_comment|/* magic number: 614. tuning with the frequency given by v4l2&n;&t;   is always off by 614*62.5 = 38375 kHz...*/
id|div
op_assign
id|freq
op_plus
l_int|614
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|div
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|div
op_amp
l_int|0xff
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x8e
suffix:semicolon
r_if
c_cond
(paren
id|freq
OL
(paren
id|u32
)paren
(paren
l_int|16
op_star
l_float|168.25
)paren
)paren
id|config
op_assign
l_int|0xa0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|freq
OL
(paren
id|u32
)paren
(paren
l_int|16
op_star
l_float|447.25
)paren
)paren
id|config
op_assign
l_int|0x90
suffix:semicolon
r_else
id|config
op_assign
l_int|0x30
suffix:semicolon
id|config
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
id|config
suffix:semicolon
r_return
id|tuner_write
c_func
(paren
id|dev
comma
l_int|0x61
comma
id|buf
)paren
suffix:semicolon
)brace
DECL|variable|analog_standard
r_static
r_struct
id|saa7146_standard
id|analog_standard
(braket
)braket
suffix:semicolon
DECL|variable|dvb_standard
r_static
r_struct
id|saa7146_standard
id|dvb_standard
(braket
)braket
suffix:semicolon
DECL|variable|standard
r_static
r_struct
id|saa7146_standard
id|standard
(braket
)braket
suffix:semicolon
DECL|variable|msp3400_v4l2_audio
r_static
r_struct
id|v4l2_audio
id|msp3400_v4l2_audio
op_assign
(brace
dot
id|index
op_assign
l_int|0
comma
dot
id|name
op_assign
l_string|&quot;Television&quot;
comma
dot
id|capability
op_assign
id|V4L2_AUDCAP_STEREO
)brace
suffix:semicolon
DECL|function|av7110_dvb_c_switch
r_static
r_int
id|av7110_dvb_c_switch
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
id|u16
id|adswitch
suffix:semicolon
id|u8
id|band
op_assign
l_int|0
suffix:semicolon
r_int
id|source
comma
id|sync
comma
id|err
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vv-&gt;video_status
op_amp
id|STATUS_OVERLAY
)paren
op_ne
l_int|0
)paren
(brace
id|vv-&gt;ov_suspend
op_assign
id|vv-&gt;video_fh
suffix:semicolon
id|err
op_assign
id|saa7146_stop_preview
c_func
(paren
id|vv-&gt;video_fh
)paren
suffix:semicolon
multiline_comment|/* side effect: video_status is now 0, video_fh is NULL */
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;suspending video failed&bslash;n&quot;
)paren
suffix:semicolon
id|vv-&gt;ov_suspend
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|av7110-&gt;current_input
)paren
(brace
id|adswitch
op_assign
l_int|1
suffix:semicolon
id|band
op_assign
l_int|0x60
suffix:semicolon
multiline_comment|/* analog band */
id|source
op_assign
id|SAA7146_HPS_SOURCE_PORT_B
suffix:semicolon
id|sync
op_assign
id|SAA7146_HPS_SYNC_PORT_B
suffix:semicolon
id|memcpy
c_func
(paren
id|standard
comma
id|analog_standard
comma
r_sizeof
(paren
r_struct
id|saa7146_standard
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;switching to analog TV&bslash;n&quot;
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0008
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// loudspeaker source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0009
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// headphone source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000a
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// SCART 1 source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000e
comma
l_int|0x3000
)paren
suffix:semicolon
singleline_comment|// FM matrix, mono
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
l_int|0x4f00
)paren
suffix:semicolon
singleline_comment|// loudspeaker + headphone
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0007
comma
l_int|0x4f00
)paren
suffix:semicolon
singleline_comment|// SCART 1 volume
)brace
r_else
(brace
id|adswitch
op_assign
l_int|0
suffix:semicolon
id|band
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* digital band */
id|source
op_assign
id|SAA7146_HPS_SOURCE_PORT_A
suffix:semicolon
id|sync
op_assign
id|SAA7146_HPS_SYNC_PORT_A
suffix:semicolon
id|memcpy
c_func
(paren
id|standard
comma
id|dvb_standard
comma
r_sizeof
(paren
r_struct
id|saa7146_standard
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;switching DVB mode&bslash;n&quot;
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0008
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// loudspeaker source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0009
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// headphone source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000a
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// SCART 1 source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000e
comma
l_int|0x3000
)paren
suffix:semicolon
singleline_comment|// FM matrix, mono
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
l_int|0x7f00
)paren
suffix:semicolon
singleline_comment|// loudspeaker + headphone
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0007
comma
l_int|0x7f00
)paren
suffix:semicolon
singleline_comment|// SCART 1 volume
)brace
multiline_comment|/* hmm, this does not do anything!? */
r_if
c_cond
(paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_AUDIODAC
comma
id|ADSwitch
comma
l_int|1
comma
id|adswitch
)paren
)paren
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;ADSwitch error&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ves1820_writereg
c_func
(paren
id|dev
comma
l_int|0x0f
comma
id|band
)paren
)paren
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;setting band in demodulator failed.&bslash;n&quot;
)paren
suffix:semicolon
id|saa7146_set_hps_source_and_sync
c_func
(paren
id|dev
comma
id|source
comma
id|sync
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vv-&gt;ov_suspend
op_ne
l_int|NULL
)paren
(brace
id|saa7146_start_preview
c_func
(paren
id|vv-&gt;ov_suspend
)paren
suffix:semicolon
id|vv-&gt;ov_suspend
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_ioctl
r_static
r_int
id|av7110_ioctl
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;saa7146_dev: %p&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDIOC_G_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|t
op_assign
id|arg
suffix:semicolon
id|u16
id|stereo_det
suffix:semicolon
id|s8
id|stereo
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_G_TUNER: %d&bslash;n&quot;
comma
id|t-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;has_analog_tuner
op_logical_or
id|t-&gt;index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|t
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|t
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|t-&gt;name
comma
l_string|&quot;Television&quot;
)paren
suffix:semicolon
id|t-&gt;type
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
id|t-&gt;capability
op_assign
id|V4L2_TUNER_CAP_NORM
op_or
id|V4L2_TUNER_CAP_STEREO
op_or
id|V4L2_TUNER_CAP_LANG1
op_or
id|V4L2_TUNER_CAP_LANG2
op_or
id|V4L2_TUNER_CAP_SAP
suffix:semicolon
id|t-&gt;rangelow
op_assign
l_int|772
suffix:semicolon
multiline_comment|/* 48.25 MHZ / 62.5 kHz = 772, see fi1216mk2-specs, page 2 */
id|t-&gt;rangehigh
op_assign
l_int|13684
suffix:semicolon
multiline_comment|/* 855.25 MHz / 62.5 kHz = 13684 */
multiline_comment|/* FIXME: add the real signal strength here */
id|t-&gt;signal
op_assign
l_int|0xffff
suffix:semicolon
id|t-&gt;afc
op_assign
l_int|0
suffix:semicolon
singleline_comment|// FIXME: standard / stereo detection is still broken
id|msp_readreg
c_func
(paren
id|av7110
comma
id|MSP_RD_DEM
comma
l_int|0x007e
comma
op_amp
id|stereo_det
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_G_TUNER: msp3400 TV standard detection: 0x%04x&bslash;n&quot;
comma
id|stereo_det
)paren
suffix:semicolon
id|msp_readreg
c_func
(paren
id|av7110
comma
id|MSP_RD_DSP
comma
l_int|0x0018
comma
op_amp
id|stereo_det
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;VIDIOC_G_TUNER: msp3400 stereo detection: 0x%04x&bslash;n&quot;
comma
id|stereo_det
)paren
suffix:semicolon
id|stereo
op_assign
(paren
id|s8
)paren
(paren
id|stereo_det
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stereo
OG
l_int|0x10
)paren
(brace
multiline_comment|/* stereo */
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_STEREO
op_or
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_STEREO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stereo
OL
op_minus
l_int|0x10
)paren
(brace
multiline_comment|/* bilingual*/
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_LANG1
op_or
id|V4L2_TUNER_SUB_LANG2
suffix:semicolon
id|t-&gt;audmode
op_assign
id|V4L2_TUNER_MODE_LANG1
suffix:semicolon
)brace
r_else
multiline_comment|/* mono */
id|t-&gt;rxsubchans
op_assign
id|V4L2_TUNER_SUB_MONO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_TUNER
suffix:colon
(brace
r_struct
id|v4l2_tuner
op_star
id|t
op_assign
id|arg
suffix:semicolon
id|u16
id|fm_matrix
comma
id|src
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_TUNER: %d&bslash;n&quot;
comma
id|t-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;has_analog_tuner
op_logical_or
id|av7110-&gt;current_input
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|t-&gt;audmode
)paren
(brace
r_case
id|V4L2_TUNER_MODE_STEREO
suffix:colon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_STEREO&bslash;n&quot;
)paren
suffix:semicolon
id|fm_matrix
op_assign
l_int|0x3001
suffix:semicolon
singleline_comment|// stereo
id|src
op_assign
l_int|0x0020
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_LANG1
suffix:colon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_LANG1&bslash;n&quot;
)paren
suffix:semicolon
id|fm_matrix
op_assign
l_int|0x3000
suffix:semicolon
singleline_comment|// mono
id|src
op_assign
l_int|0x0000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|V4L2_TUNER_MODE_LANG2
suffix:colon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_TUNER: V4L2_TUNER_MODE_LANG2&bslash;n&quot;
)paren
suffix:semicolon
id|fm_matrix
op_assign
l_int|0x3000
suffix:semicolon
singleline_comment|// mono
id|src
op_assign
l_int|0x0010
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* case V4L2_TUNER_MODE_MONO: {*/
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_TUNER: TDA9840_SET_MONO&bslash;n&quot;
)paren
suffix:semicolon
id|fm_matrix
op_assign
l_int|0x3000
suffix:semicolon
singleline_comment|// mono
id|src
op_assign
l_int|0x0030
suffix:semicolon
r_break
suffix:semicolon
)brace
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000e
comma
id|fm_matrix
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0008
comma
id|src
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0009
comma
id|src
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000a
comma
id|src
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_G_FREQ: freq:0x%08x.&bslash;n&quot;
comma
id|f-&gt;frequency
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;has_analog_tuner
op_logical_or
id|av7110-&gt;current_input
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|f-&gt;type
op_assign
id|V4L2_TUNER_ANALOG_TV
suffix:semicolon
id|f-&gt;frequency
op_assign
id|av7110-&gt;current_freq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_FREQUENCY
suffix:colon
(brace
r_struct
id|v4l2_frequency
op_star
id|f
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_FREQUENCY: freq:0x%08x.&bslash;n&quot;
comma
id|f-&gt;frequency
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;has_analog_tuner
op_logical_or
id|av7110-&gt;current_input
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_TUNER_ANALOG_TV
op_ne
id|f-&gt;type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
l_int|0xffe0
)paren
suffix:semicolon
singleline_comment|// fast mute
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0007
comma
l_int|0xffe0
)paren
suffix:semicolon
multiline_comment|/* tune in desired frequency */
id|tuner_set_tv_freq
c_func
(paren
id|dev
comma
id|f-&gt;frequency
)paren
suffix:semicolon
id|av7110-&gt;current_freq
op_assign
id|f-&gt;frequency
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0015
comma
l_int|0x003f
)paren
suffix:semicolon
singleline_comment|// start stereo detection
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0015
comma
l_int|0x0000
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
l_int|0x4f00
)paren
suffix:semicolon
singleline_comment|// loudspeaker + headphone
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0007
comma
l_int|0x4f00
)paren
suffix:semicolon
singleline_comment|// SCART 1 volume
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_ENUMINPUT
suffix:colon
(brace
r_struct
id|v4l2_input
op_star
id|i
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_ENUMINPUT: %d&bslash;n&quot;
comma
id|i-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;has_analog_tuner
)paren
(brace
r_if
c_cond
(paren
id|i-&gt;index
OL
l_int|0
op_logical_or
id|i-&gt;index
op_ge
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i-&gt;index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|i
comma
op_amp
id|inputs
(braket
id|i-&gt;index
)braket
comma
r_sizeof
(paren
r_struct
id|v4l2_input
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_G_INPUT
suffix:colon
(brace
r_int
op_star
id|input
op_assign
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
op_star
id|input
op_assign
id|av7110-&gt;current_input
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_G_INPUT: %d&bslash;n&quot;
comma
op_star
id|input
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDIOC_S_INPUT
suffix:colon
(brace
r_int
id|input
op_assign
op_star
(paren
r_int
op_star
)paren
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_INPUT: %d&bslash;n&quot;
comma
id|input
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;has_analog_tuner
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|input
OL
l_int|0
op_logical_or
id|input
op_ge
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* FIXME: switch inputs here */
id|av7110-&gt;current_input
op_assign
id|input
suffix:semicolon
r_return
id|av7110_dvb_c_switch
c_func
(paren
id|fh
)paren
suffix:semicolon
)brace
r_case
id|VIDIOC_G_AUDIO
suffix:colon
(brace
r_struct
id|v4l2_audio
op_star
id|a
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_G_AUDIO: %d&bslash;n&quot;
comma
id|a-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;index
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
id|a
comma
op_amp
id|msp3400_v4l2_audio
comma
r_sizeof
(paren
r_struct
id|v4l2_audio
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDIOC_S_AUDIO
suffix:colon
(brace
r_struct
id|v4l2_audio
op_star
id|a
op_assign
id|arg
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;VIDIOC_S_AUDIO: %d&bslash;n&quot;
comma
id|a-&gt;index
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;no such ioctl&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * INITIALIZATION&n; ****************************************************************************/
DECL|variable|ioctls
r_static
r_struct
id|saa7146_extension_ioctls
id|ioctls
(braket
)braket
op_assign
(brace
(brace
id|VIDIOC_ENUMINPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_INPUT
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_FREQUENCY
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_FREQUENCY
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_TUNER
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_TUNER
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_G_AUDIO
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
id|VIDIOC_S_AUDIO
comma
id|SAA7146_EXCLUSIVE
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|saa7113_init_regs
r_static
id|u8
id|saa7113_init_regs
(braket
)braket
op_assign
(brace
l_int|0x02
comma
l_int|0xd0
comma
l_int|0x03
comma
l_int|0x23
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x05
comma
l_int|0x00
comma
l_int|0x06
comma
l_int|0xe9
comma
l_int|0x07
comma
l_int|0x0d
comma
l_int|0x08
comma
l_int|0x98
comma
l_int|0x09
comma
l_int|0x02
comma
l_int|0x0a
comma
l_int|0x80
comma
l_int|0x0b
comma
l_int|0x40
comma
l_int|0x0c
comma
l_int|0x40
comma
l_int|0x0d
comma
l_int|0x00
comma
l_int|0x0e
comma
l_int|0x01
comma
l_int|0x0f
comma
l_int|0x7c
comma
l_int|0x10
comma
l_int|0x48
comma
l_int|0x11
comma
l_int|0x0c
comma
l_int|0x12
comma
l_int|0x8b
comma
l_int|0x13
comma
l_int|0x1a
comma
l_int|0x14
comma
l_int|0x00
comma
l_int|0x15
comma
l_int|0x00
comma
l_int|0x16
comma
l_int|0x00
comma
l_int|0x17
comma
l_int|0x00
comma
l_int|0x18
comma
l_int|0x00
comma
l_int|0x19
comma
l_int|0x00
comma
l_int|0x1a
comma
l_int|0x00
comma
l_int|0x1b
comma
l_int|0x00
comma
l_int|0x1c
comma
l_int|0x00
comma
l_int|0x1d
comma
l_int|0x00
comma
l_int|0x1e
comma
l_int|0x00
comma
l_int|0x41
comma
l_int|0x77
comma
l_int|0x42
comma
l_int|0x77
comma
l_int|0x43
comma
l_int|0x77
comma
l_int|0x44
comma
l_int|0x77
comma
l_int|0x45
comma
l_int|0x77
comma
l_int|0x46
comma
l_int|0x77
comma
l_int|0x47
comma
l_int|0x77
comma
l_int|0x48
comma
l_int|0x77
comma
l_int|0x49
comma
l_int|0x77
comma
l_int|0x4a
comma
l_int|0x77
comma
l_int|0x4b
comma
l_int|0x77
comma
l_int|0x4c
comma
l_int|0x77
comma
l_int|0x4d
comma
l_int|0x77
comma
l_int|0x4e
comma
l_int|0x77
comma
l_int|0x4f
comma
l_int|0x77
comma
l_int|0x50
comma
l_int|0x77
comma
l_int|0x51
comma
l_int|0x77
comma
l_int|0x52
comma
l_int|0x77
comma
l_int|0x53
comma
l_int|0x77
comma
l_int|0x54
comma
l_int|0x77
comma
l_int|0x55
comma
l_int|0x77
comma
l_int|0x56
comma
l_int|0x77
comma
l_int|0x57
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
DECL|variable|av7110_vv_data_st
r_static
r_struct
id|saa7146_ext_vv
id|av7110_vv_data_st
suffix:semicolon
DECL|variable|av7110_vv_data_c
r_static
r_struct
id|saa7146_ext_vv
id|av7110_vv_data_c
suffix:semicolon
DECL|function|av7110_init_analog_module
r_int
id|av7110_init_analog_module
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|u16
id|version1
comma
id|version2
suffix:semicolon
r_if
c_cond
(paren
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x80
comma
l_int|0x0
comma
l_int|0x80
)paren
op_ne
l_int|1
op_logical_or
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x80
comma
l_int|0x0
comma
l_int|0
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: DVB-C analog module @ card %d detected, initializing MSP3400&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
)paren
suffix:semicolon
id|av7110-&gt;adac_type
op_assign
id|DVB_ADAC_MSP
suffix:semicolon
id|msleep
c_func
(paren
l_int|100
)paren
suffix:semicolon
singleline_comment|// the probing above resets the msp...
id|msp_readreg
c_func
(paren
id|av7110
comma
id|MSP_RD_DSP
comma
l_int|0x001e
comma
op_amp
id|version1
)paren
suffix:semicolon
id|msp_readreg
c_func
(paren
id|av7110
comma
id|MSP_RD_DSP
comma
l_int|0x001f
comma
op_amp
id|version2
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;dvb-ttpci: @ card %d MSP3400 version 0x%04x 0x%04x&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
comma
id|version1
comma
id|version2
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0013
comma
l_int|0x0c00
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
l_int|0x7f00
)paren
suffix:semicolon
singleline_comment|// loudspeaker + headphone
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0008
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// loudspeaker source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0009
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// headphone source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0004
comma
l_int|0x7f00
)paren
suffix:semicolon
singleline_comment|// loudspeaker volume
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000a
comma
l_int|0x0220
)paren
suffix:semicolon
singleline_comment|// SCART 1 source
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0007
comma
l_int|0x7f00
)paren
suffix:semicolon
singleline_comment|// SCART 1 volume
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x000d
comma
l_int|0x4800
)paren
suffix:semicolon
singleline_comment|// prescale SCART
r_if
c_cond
(paren
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x48
comma
l_int|0x01
comma
l_int|0x00
)paren
op_ne
l_int|1
)paren
(brace
id|INFO
c_func
(paren
(paren
l_string|&quot;saa7113 not accessible.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|u8
op_star
id|i
op_assign
id|saa7113_init_regs
suffix:semicolon
id|av7110-&gt;has_analog_tuner
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* init the saa7113 */
r_while
c_loop
(paren
op_star
id|i
op_ne
l_int|0xff
)paren
(brace
r_if
c_cond
(paren
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x48
comma
id|i
(braket
l_int|0
)braket
comma
id|i
(braket
l_int|1
)braket
)paren
op_ne
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;saa7113 initialization failed @ card %d&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_add_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/* setup msp for analog sound: B/G Dual-FM */
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x00bb
comma
l_int|0x02d0
)paren
suffix:semicolon
singleline_comment|// AD_CV
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|3
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|18
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|27
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|48
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|66
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0001
comma
l_int|72
)paren
suffix:semicolon
singleline_comment|// FIR1
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|4
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|64
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|3
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|18
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|27
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|48
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|66
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0005
comma
l_int|72
)paren
suffix:semicolon
singleline_comment|// FIR2
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0083
comma
l_int|0xa000
)paren
suffix:semicolon
singleline_comment|// MODE_REG
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0093
comma
l_int|0x00aa
)paren
suffix:semicolon
singleline_comment|// DCO1_LO 5.74MHz
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x009b
comma
l_int|0x04fc
)paren
suffix:semicolon
singleline_comment|// DCO1_HI
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x00a3
comma
l_int|0x038e
)paren
suffix:semicolon
singleline_comment|// DCO2_LO 5.5MHz
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x00ab
comma
l_int|0x04c6
)paren
suffix:semicolon
singleline_comment|// DCO2_HI
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DEM
comma
l_int|0x0056
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// LOAD_REG 1/2
)brace
id|memcpy
c_func
(paren
id|standard
comma
id|dvb_standard
comma
r_sizeof
(paren
r_struct
id|saa7146_standard
)paren
op_star
l_int|2
)paren
suffix:semicolon
multiline_comment|/* set dd1 stream a &amp; b */
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|DD1_STREAM_B
comma
l_int|0x00000000
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|DD1_INIT
comma
l_int|0x03000700
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|MC2
comma
(paren
id|MASK_09
op_or
id|MASK_25
op_or
id|MASK_10
op_or
id|MASK_26
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_init_v4l
r_int
id|av7110_init_v4l
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|av7110-&gt;dev
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* special case DVB-C: these cards have an analog tuner&n;&t;   plus need some special handling, so we have separate&n;&t;   saa7146_ext_vv data for these... */
r_if
c_cond
(paren
id|av7110-&gt;has_analog_tuner
)paren
id|ret
op_assign
id|saa7146_vv_init
c_func
(paren
id|dev
comma
op_amp
id|av7110_vv_data_c
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|saa7146_vv_init
c_func
(paren
id|dev
comma
op_amp
id|av7110_vv_data_st
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot init capture device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|saa7146_register_device
c_func
(paren
op_amp
id|av7110-&gt;v4l_dev
comma
id|dev
comma
l_string|&quot;av7110&quot;
comma
id|VFL_TYPE_GRABBER
)paren
)paren
(brace
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot register capture device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|saa7146_vv_release
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|av7110-&gt;has_analog_tuner
)paren
(brace
r_if
c_cond
(paren
id|saa7146_register_device
c_func
(paren
op_amp
id|av7110-&gt;vbi_dev
comma
id|dev
comma
l_string|&quot;av7110&quot;
comma
id|VFL_TYPE_VBI
)paren
)paren
(brace
id|ERR
c_func
(paren
(paren
l_string|&quot;cannot register vbi v4l2 device. skipping.&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* we use this to remember that this dvb-c card can do vbi */
id|av7110-&gt;has_analog_tuner
op_assign
l_int|2
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_exit_v4l
r_int
id|av7110_exit_v4l
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|saa7146_unregister_device
c_func
(paren
op_amp
id|av7110-&gt;v4l_dev
comma
id|av7110-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|2
op_eq
id|av7110-&gt;has_analog_tuner
)paren
id|saa7146_unregister_device
c_func
(paren
op_amp
id|av7110-&gt;vbi_dev
comma
id|av7110-&gt;dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FIXME: these values are experimental values that look better than the&n;   values from the latest &quot;official&quot; driver -- at least for me... (MiHu) */
DECL|variable|standard
r_static
r_struct
id|saa7146_standard
id|standard
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;PAL&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL_BG
comma
dot
id|v_offset
op_assign
l_int|0x15
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x48
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;NTSC&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_NTSC
comma
dot
id|v_offset
op_assign
l_int|0x10
comma
dot
id|v_field
op_assign
l_int|244
comma
dot
id|h_offset
op_assign
l_int|0x40
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|480
comma
dot
id|h_max_out
op_assign
l_int|640
comma
)brace
)brace
suffix:semicolon
DECL|variable|analog_standard
r_static
r_struct
id|saa7146_standard
id|analog_standard
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;PAL&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL_BG
comma
dot
id|v_offset
op_assign
l_int|0x1b
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x08
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;NTSC&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_NTSC
comma
dot
id|v_offset
op_assign
l_int|0x10
comma
dot
id|v_field
op_assign
l_int|244
comma
dot
id|h_offset
op_assign
l_int|0x40
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|480
comma
dot
id|h_max_out
op_assign
l_int|640
comma
)brace
)brace
suffix:semicolon
DECL|variable|dvb_standard
r_static
r_struct
id|saa7146_standard
id|dvb_standard
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;PAL&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_PAL_BG
comma
dot
id|v_offset
op_assign
l_int|0x14
comma
dot
id|v_field
op_assign
l_int|288
comma
dot
id|h_offset
op_assign
l_int|0x48
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|576
comma
dot
id|h_max_out
op_assign
l_int|768
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;NTSC&quot;
comma
dot
id|id
op_assign
id|V4L2_STD_NTSC
comma
dot
id|v_offset
op_assign
l_int|0x10
comma
dot
id|v_field
op_assign
l_int|244
comma
dot
id|h_offset
op_assign
l_int|0x40
comma
dot
id|h_pixels
op_assign
l_int|708
comma
dot
id|v_max_out
op_assign
l_int|480
comma
dot
id|h_max_out
op_assign
l_int|640
comma
)brace
)brace
suffix:semicolon
DECL|function|std_callback
r_static
r_int
id|std_callback
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_standard
op_star
id|std
)paren
(brace
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dev-&gt;ext_priv
suffix:semicolon
r_if
c_cond
(paren
id|std-&gt;id
op_eq
id|V4L2_STD_PAL
)paren
(brace
id|av7110-&gt;vidmode
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
id|av7110_set_vidmode
c_func
(paren
id|av7110
comma
id|av7110-&gt;vidmode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|std-&gt;id
op_eq
id|V4L2_STD_NTSC
)paren
(brace
id|av7110-&gt;vidmode
op_assign
id|VIDEO_MODE_NTSC
suffix:semicolon
id|av7110_set_vidmode
c_func
(paren
id|av7110
comma
id|av7110-&gt;vidmode
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|av7110_vv_data_st
r_static
r_struct
id|saa7146_ext_vv
id|av7110_vv_data_st
op_assign
(brace
dot
id|inputs
op_assign
l_int|1
comma
dot
id|audios
op_assign
l_int|1
comma
dot
id|capabilities
op_assign
l_int|0
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|stds
op_assign
op_amp
id|standard
(braket
l_int|0
)braket
comma
dot
id|num_stds
op_assign
id|ARRAY_SIZE
c_func
(paren
id|standard
)paren
comma
dot
id|std_callback
op_assign
op_amp
id|std_callback
comma
dot
id|ioctls
op_assign
op_amp
id|ioctls
(braket
l_int|0
)braket
comma
dot
id|ioctl
op_assign
id|av7110_ioctl
comma
)brace
suffix:semicolon
DECL|variable|av7110_vv_data_c
r_static
r_struct
id|saa7146_ext_vv
id|av7110_vv_data_c
op_assign
(brace
dot
id|inputs
op_assign
l_int|1
comma
dot
id|audios
op_assign
l_int|1
comma
dot
id|capabilities
op_assign
id|V4L2_CAP_TUNER
op_or
id|V4L2_CAP_VBI_CAPTURE
comma
dot
id|flags
op_assign
id|SAA7146_USE_PORT_B_FOR_VBI
comma
dot
id|stds
op_assign
op_amp
id|standard
(braket
l_int|0
)braket
comma
dot
id|num_stds
op_assign
id|ARRAY_SIZE
c_func
(paren
id|standard
)paren
comma
dot
id|std_callback
op_assign
op_amp
id|std_callback
comma
dot
id|ioctls
op_assign
op_amp
id|ioctls
(braket
l_int|0
)braket
comma
dot
id|ioctl
op_assign
id|av7110_ioctl
comma
)brace
suffix:semicolon
eof
