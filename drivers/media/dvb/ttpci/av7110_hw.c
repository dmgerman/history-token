multiline_comment|/*&n; * av7110_hw.c: av7110 low level hardware access and firmware interface&n; *&n; * Copyright (C) 1999-2002 Ralph  Metzler&n; *                       &amp; Marcus Metzler for convergence integrated media GmbH&n; *&n; * originally based on code by:&n; * Copyright (C) 1998,1999 Christian Theiss &lt;mistert@rz.fh-augsburg.de&gt;&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; * Or, point your browser to http://www.gnu.org/copyleft/gpl.html&n; *&n; * the project&squot;s page is at http://www.linuxtv.org/dvb/&n; */
multiline_comment|/* for debugging ARM communication: */
singleline_comment|//#define COM_DEBUG
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/byteorder/swabb.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &quot;av7110.h&quot;
macro_line|#include &quot;av7110_hw.h&quot;
multiline_comment|/****************************************************************************&n; * DEBI functions&n; ****************************************************************************/
multiline_comment|/* This DEBI code is based on the Stradis driver&n;   by Nathan Laredo &lt;laredo@gnu.org&gt; */
DECL|function|av7110_debiwrite
r_int
id|av7110_debiwrite
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u32
id|config
comma
r_int
id|addr
comma
id|u32
id|val
comma
r_int
id|count
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|av7110-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
op_logical_or
id|count
OG
l_int|32764
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: invalid count %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|count
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|saa7146_wait_for_debi_done
c_func
(paren
id|av7110-&gt;dev
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wait_for_debi_done failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_CONFIG
comma
id|config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|4
)paren
multiline_comment|/* immediate transfer */
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_AD
comma
id|val
)paren
suffix:semicolon
r_else
multiline_comment|/* block transfer */
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_AD
comma
id|av7110-&gt;debi_bus
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_COMMAND
comma
(paren
id|count
op_lshift
l_int|17
)paren
op_or
(paren
id|addr
op_amp
l_int|0xffff
)paren
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
l_int|2
op_lshift
l_int|16
)paren
op_or
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_debiread
id|u32
id|av7110_debiread
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u32
id|config
comma
r_int
id|addr
comma
r_int
id|count
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|av7110-&gt;dev
suffix:semicolon
id|u32
id|result
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|32764
op_logical_or
id|count
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: invalid count %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|saa7146_wait_for_debi_done
c_func
(paren
id|av7110-&gt;dev
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wait_for_debi_done #1 failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_AD
comma
id|av7110-&gt;debi_bus
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_COMMAND
comma
(paren
id|count
op_lshift
l_int|17
)paren
op_or
l_int|0x10000
op_or
(paren
id|addr
op_amp
l_int|0xffff
)paren
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|DEBI_CONFIG
comma
id|config
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
l_int|2
op_lshift
l_int|16
)paren
op_or
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|4
)paren
r_return
id|count
suffix:semicolon
r_if
c_cond
(paren
id|saa7146_wait_for_debi_done
c_func
(paren
id|av7110-&gt;dev
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: wait_for_debi_done #2 failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|result
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|DEBI_AD
)paren
suffix:semicolon
id|result
op_and_assign
(paren
l_int|0xffffffffUL
op_rshift
(paren
(paren
l_int|4
op_minus
id|count
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* av7110 ARM core boot stuff */
DECL|function|av7110_reset_arm
r_void
id|av7110_reset_arm
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|saa7146_setgpio
c_func
(paren
id|av7110-&gt;dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
multiline_comment|/* Disable DEBI and GPIO irq */
id|SAA7146_IER_DISABLE
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_19
op_or
id|MASK_03
)paren
suffix:semicolon
id|SAA7146_ISR_CLEAR
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_19
op_or
id|MASK_03
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|av7110-&gt;dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* the firmware needs some time to initialize */
id|ARM_ResetMailBox
c_func
(paren
id|av7110
)paren
suffix:semicolon
id|SAA7146_ISR_CLEAR
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_19
op_or
id|MASK_03
)paren
suffix:semicolon
id|SAA7146_IER_ENABLE
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_03
)paren
suffix:semicolon
id|av7110-&gt;arm_ready
op_assign
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;reset ARM&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|waitdebi
r_static
r_int
id|waitdebi
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|adr
comma
r_int
id|state
)paren
(brace
r_int
id|k
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|100
suffix:semicolon
id|k
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|adr
comma
l_int|0
comma
l_int|2
)paren
op_eq
id|state
)paren
r_return
l_int|0
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|load_dram
r_static
r_int
id|load_dram
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u32
op_star
id|data
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|blocks
comma
id|rest
suffix:semicolon
id|u32
id|base
comma
id|bootblock
op_assign
id|BOOT_BLOCK
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
id|blocks
op_assign
id|len
op_div
id|BOOT_MAX_SIZE
suffix:semicolon
id|rest
op_assign
id|len
op_mod
id|BOOT_MAX_SIZE
suffix:semicolon
id|base
op_assign
id|DRAM_START_CODE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|blocks
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|waitdebi
c_func
(paren
id|av7110
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_EMPTY
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: load_dram(): timeout at block %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;writing DRAM block %d&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|mwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|bootblock
comma
(paren
(paren
r_char
op_star
)paren
id|data
)paren
op_plus
id|i
op_star
id|BOOT_MAX_SIZE
comma
id|BOOT_MAX_SIZE
)paren
suffix:semicolon
id|bootblock
op_xor_assign
l_int|0x1400
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|BOOT_BASE
comma
id|swab32
c_func
(paren
id|base
)paren
comma
l_int|4
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_SIZE
comma
id|BOOT_MAX_SIZE
comma
l_int|2
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_FULL
comma
l_int|2
)paren
suffix:semicolon
id|base
op_add_assign
id|BOOT_MAX_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rest
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|waitdebi
c_func
(paren
id|av7110
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_EMPTY
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: load_dram(): timeout at last block&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rest
OG
l_int|4
)paren
id|mwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|bootblock
comma
(paren
(paren
r_char
op_star
)paren
id|data
)paren
op_plus
id|i
op_star
id|BOOT_MAX_SIZE
comma
id|rest
)paren
suffix:semicolon
r_else
id|mwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|bootblock
comma
(paren
(paren
r_char
op_star
)paren
id|data
)paren
op_plus
id|i
op_star
id|BOOT_MAX_SIZE
op_minus
l_int|4
comma
id|rest
op_plus
l_int|4
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|BOOT_BASE
comma
id|swab32
c_func
(paren
id|base
)paren
comma
l_int|4
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_SIZE
comma
id|rest
comma
l_int|2
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_FULL
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|waitdebi
c_func
(paren
id|av7110
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_EMPTY
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: load_dram(): timeout after last block&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_SIZE
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_FULL
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitdebi
c_func
(paren
id|av7110
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BOOT_COMPLETE
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: load_dram(): final handshake timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* we cannot write av7110 DRAM directly, so load a bootloader into&n; * the DPRAM which implements a simple boot protocol */
DECL|variable|bootcode
r_static
id|u8
id|bootcode
(braket
)braket
op_assign
(brace
l_int|0xea
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x0e
comma
l_int|0xe1
comma
l_int|0xb0
comma
l_int|0xf0
comma
l_int|0x0e
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x04
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x04
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x08
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x04
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x04
comma
l_int|0xe2
comma
l_int|0x5e
comma
l_int|0xf0
comma
l_int|0x04
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x24
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x0c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x34
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xa5
comma
l_int|0xa5
comma
l_int|0x5a
comma
l_int|0x5a
comma
l_int|0x00
comma
l_int|0x1f
comma
l_int|0x15
comma
l_int|0x55
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x09
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0xd0
comma
l_int|0x7c
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0x40
comma
l_int|0x74
comma
l_int|0xe3
comma
l_int|0xa0
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xe5
comma
l_int|0x84
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xe5
comma
l_int|0x84
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0x10
comma
l_int|0x70
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0x20
comma
l_int|0x70
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0x30
comma
l_int|0x64
comma
l_int|0xe8
comma
l_int|0xb1
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe8
comma
l_int|0xa3
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe1
comma
l_int|0x51
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0xda
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfb
comma
l_int|0xe5
comma
l_int|0x9f
comma
l_int|0xf0
comma
l_int|0x50
comma
l_int|0xe1
comma
l_int|0xd4
comma
l_int|0x10
comma
l_int|0xb0
comma
l_int|0xe3
comma
l_int|0x51
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x0a
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xfc
comma
l_int|0xe1
comma
l_int|0xa0
comma
l_int|0x10
comma
l_int|0x0d
comma
l_int|0xe5
comma
l_int|0x94
comma
l_int|0x30
comma
l_int|0x04
comma
l_int|0xe1
comma
l_int|0xd4
comma
l_int|0x20
comma
l_int|0xb2
comma
l_int|0xe2
comma
l_int|0x82
comma
l_int|0x20
comma
l_int|0x3f
comma
l_int|0xe1
comma
l_int|0xb0
comma
l_int|0x23
comma
l_int|0x22
comma
l_int|0x03
comma
l_int|0xa0
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0xe1
comma
l_int|0xc4
comma
l_int|0x00
comma
l_int|0xb0
comma
l_int|0x0a
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xf4
comma
l_int|0xe8
comma
l_int|0xb1
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe8
comma
l_int|0xa3
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe8
comma
l_int|0xb1
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe8
comma
l_int|0xa3
comma
l_int|0x1f
comma
l_int|0xe0
comma
l_int|0xe2
comma
l_int|0x52
comma
l_int|0x20
comma
l_int|0x01
comma
l_int|0x1a
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xf9
comma
l_int|0xe2
comma
l_int|0x2d
comma
l_int|0xdb
comma
l_int|0x05
comma
l_int|0xea
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xec
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x03
comma
l_int|0xf8
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x9e
comma
l_int|0x00
comma
l_int|0x08
comma
l_int|0x00
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x74
comma
l_int|0x2c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xc0
)brace
suffix:semicolon
DECL|function|av7110_bootarm
r_int
id|av7110_bootarm
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|av7110-&gt;dev
suffix:semicolon
id|u32
id|ret
suffix:semicolon
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
multiline_comment|/* Disable DEBI and GPIO irq */
id|SAA7146_IER_DISABLE
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_03
op_or
id|MASK_19
)paren
suffix:semicolon
id|SAA7146_ISR_CLEAR
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_19
op_or
id|MASK_03
)paren
suffix:semicolon
multiline_comment|/* enable DEBI */
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|MC1
comma
l_int|0x08800880
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|DD1_STREAM_B
comma
l_int|0x00000000
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|av7110-&gt;dev
comma
id|MC2
comma
(paren
id|MASK_09
op_or
id|MASK_25
op_or
id|MASK_10
op_or
id|MASK_26
)paren
)paren
suffix:semicolon
multiline_comment|/* test DEBI */
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAP
comma
id|DPRAM_BASE
comma
l_int|0x76543210
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|irdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|DPRAM_BASE
comma
l_int|0
comma
l_int|4
)paren
)paren
op_ne
l_int|0x10325476
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: debi test in av7110_bootarm() failed: &quot;
l_string|&quot;%08x != %08x (check your BIOS &squot;Plug&amp;Play OS&squot; settings)&bslash;n&quot;
comma
id|ret
comma
l_int|0x10325476
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8192
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAP
comma
id|DPRAM_BASE
op_plus
id|i
comma
l_int|0x00
comma
l_int|4
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|2
comma
l_string|&quot;debi test OK&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* boot */
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;load boot code&bslash;n&quot;
)paren
suffix:semicolon
id|saa7146_setgpio
c_func
(paren
id|dev
comma
id|ARM_IRQ_LINE
comma
id|SAA7146_GPIO_IRQLO
)paren
suffix:semicolon
singleline_comment|//saa7146_setgpio(dev, DEBI_DONE_LINE, SAA7146_GPIO_INPUT);
singleline_comment|//saa7146_setgpio(dev, 3, SAA7146_GPIO_INPUT);
id|mwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|DPRAM_BASE
comma
id|bootcode
comma
r_sizeof
(paren
id|bootcode
)paren
)paren
suffix:semicolon
id|iwdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BOOT_STATE
comma
id|BOOTSTATE_BUFFER_FULL
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saa7146_wait_for_debi_done
c_func
(paren
id|av7110-&gt;dev
comma
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_bootarm(): &quot;
l_string|&quot;saa7146_wait_for_debi_done() timed out&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_setgpio
c_func
(paren
id|dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;load dram code&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|load_dram
c_func
(paren
id|av7110
comma
(paren
id|u32
op_star
)paren
id|av7110-&gt;bin_root
comma
id|av7110-&gt;size_root
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_bootarm(): &quot;
l_string|&quot;load_dram() failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_setgpio
c_func
(paren
id|dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTLO
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;load dpram code&bslash;n&quot;
)paren
suffix:semicolon
id|mwdebi
c_func
(paren
id|av7110
comma
id|DEBISWAB
comma
id|DPRAM_BASE
comma
id|av7110-&gt;bin_dpram
comma
id|av7110-&gt;size_dpram
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saa7146_wait_for_debi_done
c_func
(paren
id|av7110-&gt;dev
comma
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_bootarm(): &quot;
l_string|&quot;saa7146_wait_for_debi_done() timed out after loading DRAM&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_setgpio
c_func
(paren
id|dev
comma
id|RESET_LINE
comma
id|SAA7146_GPIO_OUTHI
)paren
suffix:semicolon
id|msleep
c_func
(paren
l_int|30
)paren
suffix:semicolon
multiline_comment|/* the firmware needs some time to initialize */
singleline_comment|//ARM_ClearIrq(av7110);
id|ARM_ResetMailBox
c_func
(paren
id|av7110
)paren
suffix:semicolon
id|SAA7146_ISR_CLEAR
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_19
op_or
id|MASK_03
)paren
suffix:semicolon
id|SAA7146_IER_ENABLE
c_func
(paren
id|av7110-&gt;dev
comma
id|MASK_03
)paren
suffix:semicolon
id|av7110-&gt;arm_errors
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;arm_ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * DEBI command polling&n; ****************************************************************************/
DECL|function|av7110_wait_msgstate
r_int
id|av7110_wait_msgstate
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
id|flags
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
id|u32
id|stat
suffix:semicolon
r_if
c_cond
(paren
id|FW_VERSION
c_func
(paren
id|av7110-&gt;arm_app
)paren
op_le
l_int|0x261c
)paren
(brace
multiline_comment|/* not supported by old firmware */
id|msleep
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* new firmware */
id|start
op_assign
id|jiffies
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|stat
op_assign
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|MSGSTATE
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|flags
)paren
op_eq
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_FREE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: timeout waiting for MSGSTATE %04x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|stat
op_amp
id|flags
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__av7110_send_fw_cmd
r_int
id|__av7110_send_fw_cmd
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
op_star
id|buf
comma
r_int
id|length
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_char
op_star
id|type
op_assign
l_int|NULL
suffix:semicolon
id|u16
id|flags
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|u32
id|stat
suffix:semicolon
singleline_comment|//&t;dprintk(4, &quot;%p&bslash;n&quot;, av7110);
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;arm_ready
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;arm not ready.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_FREE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): timeout waiting for COMMAND idle&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
)brace
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COM_IF_LOCK
comma
l_int|0xffff
comma
l_int|2
)paren
suffix:semicolon
macro_line|#ifndef _NOHANDSHAKE
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|HANDSHAKE_REG
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_SHAKE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): timeout waiting for HANDSHAKE_REG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
)brace
macro_line|#endif
r_switch
c_cond
(paren
(paren
id|buf
(braket
l_int|0
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
(brace
r_case
id|COMTYPE_PIDFILTER
suffix:colon
r_case
id|COMTYPE_ENCODER
suffix:colon
r_case
id|COMTYPE_REC_PLAY
suffix:colon
r_case
id|COMTYPE_MPEGDECODER
suffix:colon
id|type
op_assign
l_string|&quot;MSG&quot;
suffix:semicolon
id|flags
(braket
l_int|0
)braket
op_assign
id|GPMQOver
suffix:semicolon
id|flags
(braket
l_int|1
)braket
op_assign
id|GPMQFull
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMTYPE_OSD
suffix:colon
id|type
op_assign
l_string|&quot;OSD&quot;
suffix:semicolon
id|flags
(braket
l_int|0
)braket
op_assign
id|OSDQOver
suffix:semicolon
id|flags
(braket
l_int|1
)braket
op_assign
id|OSDQFull
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMTYPE_MISC
suffix:colon
r_if
c_cond
(paren
id|FW_VERSION
c_func
(paren
id|av7110-&gt;arm_app
)paren
op_ge
l_int|0x261d
)paren
(brace
id|type
op_assign
l_string|&quot;MSG&quot;
suffix:semicolon
id|flags
(braket
l_int|0
)braket
op_assign
id|GPMQOver
suffix:semicolon
id|flags
(braket
l_int|1
)braket
op_assign
id|GPMQBusy
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* non-immediate COMMAND type */
id|start
op_assign
id|jiffies
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|stat
op_assign
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|MSGSTATE
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|flags
(braket
l_int|0
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: %s QUEUE overflow&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|type
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|stat
op_amp
id|flags
(braket
l_int|1
)braket
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_FREE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: timeout waiting on busy %s QUEUE&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|type
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
op_plus
l_int|2
op_star
id|i
comma
(paren
id|u32
)paren
id|buf
(braket
id|i
)braket
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
)paren
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
op_plus
l_int|2
comma
(paren
id|u32
)paren
id|buf
(braket
l_int|1
)braket
comma
l_int|2
)paren
suffix:semicolon
r_else
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
op_plus
l_int|2
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
comma
(paren
id|u32
)paren
id|buf
(braket
l_int|0
)braket
comma
l_int|2
)paren
suffix:semicolon
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COM_IF_LOCK
comma
l_int|0x0000
comma
l_int|2
)paren
suffix:semicolon
macro_line|#ifdef COM_DEBUG
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_FREE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): timeout waiting for COMMAND to complete&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ETIMEDOUT
suffix:semicolon
)brace
)brace
id|stat
op_assign
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|MSGSTATE
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|GPMQOver
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): GPMQOver&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_amp
id|OSDQOver
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): OSDQOver&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_send_fw_cmd
r_int
id|av7110_send_fw_cmd
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
op_star
id|buf
comma
r_int
id|length
)paren
(brace
r_int
id|ret
suffix:semicolon
singleline_comment|//&t;dprintk(4, &quot;%p&bslash;n&quot;, av7110);
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;arm_ready
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;arm not ready.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|ret
op_assign
id|__av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|buf
comma
id|length
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): av7110_send_fw_cmd error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|av7110_fw_cmd
r_int
id|av7110_fw_cmd
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|type
comma
r_int
id|com
comma
r_int
id|num
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
id|u16
id|buf
(braket
id|num
op_plus
l_int|2
)braket
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
singleline_comment|//&t;dprintk(4, &quot;%p&bslash;n&quot;, av7110);
id|buf
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|type
op_lshift
l_int|8
)paren
op_or
id|com
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|num
suffix:semicolon
r_if
c_cond
(paren
id|num
)paren
(brace
id|va_start
c_func
(paren
id|args
comma
id|num
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
op_plus
l_int|2
)braket
op_assign
id|va_arg
c_func
(paren
id|args
comma
id|u32
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|buf
comma
id|num
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_fw_cmd error %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|av7110_send_ci_cmd
r_int
id|av7110_send_ci_cmd
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|subcom
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
id|u16
id|cmd
(braket
l_int|18
)braket
op_assign
(brace
(paren
(paren
id|COMTYPE_COMMON_IF
op_lshift
l_int|8
)paren
op_plus
id|subcom
)paren
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
op_logical_and
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|2
op_eq
l_int|0
)paren
(brace
id|cmd
(braket
(paren
id|i
op_div
l_int|2
)paren
op_plus
l_int|2
)braket
op_assign
(paren
id|u16
)paren
(paren
id|buf
(braket
id|i
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
)brace
r_else
id|cmd
(braket
(paren
id|i
op_div
l_int|2
)paren
op_plus
l_int|2
)braket
op_or_assign
id|buf
(braket
id|i
)braket
suffix:semicolon
)brace
id|ret
op_assign
id|av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|cmd
comma
l_int|18
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_send_ci_cmd error %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|av7110_fw_request
r_int
id|av7110_fw_request
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
op_star
id|request_buf
comma
r_int
id|request_buf_len
comma
id|u16
op_star
id|reply_buf
comma
r_int
id|reply_buf_len
)paren
(brace
r_int
id|err
suffix:semicolon
id|s16
id|i
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
macro_line|#ifdef COM_DEBUG
id|u32
id|stat
suffix:semicolon
macro_line|#endif
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;arm_ready
)paren
(brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;arm not ready.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|request_buf
comma
id|request_buf_len
)paren
)paren
OL
l_int|0
)paren
(brace
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_fw_request error %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COMMAND
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
macro_line|#ifdef _NOHANDSHAKE
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_FREE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: timeout waiting for COMMAND to complete&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#ifndef _NOHANDSHAKE
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|HANDSHAKE_REG
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_SHAKE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: timeout waiting for HANDSHAKE_REG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef COM_DEBUG
id|stat
op_assign
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|MSGSTATE
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|GPMQOver
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: GPMQOver&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|stat
op_amp
id|OSDQOver
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: OSDQOver&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|reply_buf_len
suffix:semicolon
id|i
op_increment
)paren
id|reply_buf
(braket
id|i
)braket
op_assign
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|COM_BUFF
op_plus
l_int|2
op_star
id|i
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_fw_query
r_int
id|av7110_fw_query
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
id|tag
comma
id|u16
op_star
id|buf
comma
id|s16
id|length
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|av7110_fw_request
c_func
(paren
id|av7110
comma
op_amp
id|tag
comma
l_int|0
comma
id|buf
comma
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_fw_query error %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; * Firmware commands&n; ****************************************************************************/
multiline_comment|/* get version of the firmware ROM, RTSL, video ucode and ARM application  */
DECL|function|av7110_firmversion
r_int
id|av7110_firmversion
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|u16
id|buf
(braket
l_int|20
)braket
suffix:semicolon
id|u16
id|tag
op_assign
(paren
(paren
id|COMTYPE_REQUEST
op_lshift
l_int|8
)paren
op_plus
id|ReqVersion
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110_fw_query
c_func
(paren
id|av7110
comma
id|tag
comma
id|buf
comma
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: failed to boot firmware @ card %d&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|av7110-&gt;arm_fw
op_assign
(paren
id|buf
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_plus
id|buf
(braket
l_int|1
)braket
suffix:semicolon
id|av7110-&gt;arm_rtsl
op_assign
(paren
id|buf
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_plus
id|buf
(braket
l_int|3
)braket
suffix:semicolon
id|av7110-&gt;arm_vid
op_assign
(paren
id|buf
(braket
l_int|4
)braket
op_lshift
l_int|16
)paren
op_plus
id|buf
(braket
l_int|5
)braket
suffix:semicolon
id|av7110-&gt;arm_app
op_assign
(paren
id|buf
(braket
l_int|6
)braket
op_lshift
l_int|16
)paren
op_plus
id|buf
(braket
l_int|7
)braket
suffix:semicolon
id|av7110-&gt;avtype
op_assign
(paren
id|buf
(braket
l_int|8
)braket
op_lshift
l_int|16
)paren
op_plus
id|buf
(braket
l_int|9
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: info @ card %d: firm %08x, rtsl %08x, vid %08x, app %08x&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
comma
id|av7110-&gt;arm_fw
comma
id|av7110-&gt;arm_rtsl
comma
id|av7110-&gt;arm_vid
comma
id|av7110-&gt;arm_app
)paren
suffix:semicolon
multiline_comment|/* print firmware capabilities */
r_if
c_cond
(paren
id|FW_CI_LL_SUPPORT
c_func
(paren
id|av7110-&gt;arm_app
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: firmware @ card %d supports CI link layer interface&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: no firmware support for CI link layer interface @ card %d&bslash;n&quot;
comma
id|av7110-&gt;dvb_adapter-&gt;num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_diseqc_send
r_int
id|av7110_diseqc_send
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|len
comma
id|u8
op_star
id|msg
comma
r_int
r_int
id|burst
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
id|u16
id|buf
(braket
l_int|18
)braket
op_assign
(brace
(paren
(paren
id|COMTYPE_AUDIODAC
op_lshift
l_int|8
)paren
op_plus
id|SendDiSEqC
)paren
comma
l_int|16
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|10
)paren
id|len
op_assign
l_int|10
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|len
op_plus
l_int|2
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|burst
op_ne
op_minus
l_int|1
)paren
id|buf
(braket
l_int|3
)braket
op_assign
id|burst
ques
c_cond
l_int|0x01
suffix:colon
l_int|0x00
suffix:semicolon
r_else
id|buf
(braket
l_int|3
)braket
op_assign
l_int|0xffff
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
op_plus
l_int|4
)braket
op_assign
id|msg
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|buf
comma
l_int|18
)paren
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: av7110_diseqc_send error %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DVB_AV7110_OSD
DECL|function|SetColorBlend
r_static
r_inline
r_int
id|SetColorBlend
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|SetCBlend
comma
l_int|1
comma
id|windownr
)paren
suffix:semicolon
)brace
DECL|function|SetBlend_
r_static
r_inline
r_int
id|SetBlend_
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
r_enum
id|av7110_osd_palette_type
id|colordepth
comma
id|u16
id|index
comma
id|u8
id|blending
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|SetBlend
comma
l_int|4
comma
id|windownr
comma
id|colordepth
comma
id|index
comma
id|blending
)paren
suffix:semicolon
)brace
DECL|function|SetColor_
r_static
r_inline
r_int
id|SetColor_
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
r_enum
id|av7110_osd_palette_type
id|colordepth
comma
id|u16
id|index
comma
id|u16
id|colorhi
comma
id|u16
id|colorlo
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|SetColor
comma
l_int|5
comma
id|windownr
comma
id|colordepth
comma
id|index
comma
id|colorhi
comma
id|colorlo
)paren
suffix:semicolon
)brace
DECL|function|SetFont
r_static
r_inline
r_int
id|SetFont
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|u8
id|fontsize
comma
id|u16
id|colorfg
comma
id|u16
id|colorbg
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|Set_Font
comma
l_int|4
comma
id|windownr
comma
id|fontsize
comma
id|colorfg
comma
id|colorbg
)paren
suffix:semicolon
)brace
DECL|function|FlushText
r_static
r_int
id|FlushText
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BUFF1_BASE
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_OSD
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s(): timeout waiting for BUFF1_BASE == 0&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|WriteText
r_static
r_int
id|WriteText
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|win
comma
id|u16
id|x
comma
id|u16
id|y
comma
id|u8
op_star
id|buf
)paren
(brace
r_int
id|i
comma
id|ret
suffix:semicolon
r_int
r_int
id|start
suffix:semicolon
r_int
id|length
op_assign
id|strlen
c_func
(paren
id|buf
)paren
op_plus
l_int|1
suffix:semicolon
id|u16
id|cbuf
(braket
l_int|5
)braket
op_assign
(brace
(paren
id|COMTYPE_OSD
op_lshift
l_int|8
)paren
op_plus
id|DText
comma
l_int|3
comma
id|win
comma
id|x
comma
id|y
)brace
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BUFF1_BASE
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_OSD
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s: timeout waiting for BUFF1_BASE == 0&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#ifndef _NOHANDSHAKE
id|start
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|rdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|HANDSHAKE_REG
comma
l_int|0
comma
l_int|2
)paren
)paren
(brace
id|msleep
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_after
c_func
(paren
id|jiffies
comma
id|start
op_plus
id|ARM_WAIT_SHAKE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: %s: timeout waiting for HANDSHAKE_REG&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BUFF1_BASE
op_plus
id|i
op_star
l_int|2
comma
id|swab16
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
(paren
id|buf
op_plus
l_int|2
op_star
id|i
)paren
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
op_amp
l_int|1
)paren
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|BUFF1_BASE
op_plus
id|i
op_star
l_int|2
comma
l_int|0
comma
l_int|2
)paren
suffix:semicolon
id|ret
op_assign
id|__av7110_send_fw_cmd
c_func
(paren
id|av7110
comma
id|cbuf
comma
l_int|5
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|av7110-&gt;dcomlock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dvb-ttpci: WriteText error %d&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|DrawLine
r_static
r_inline
r_int
id|DrawLine
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|u16
id|x
comma
id|u16
id|y
comma
id|u16
id|dx
comma
id|u16
id|dy
comma
id|u16
id|color
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|DLine
comma
l_int|6
comma
id|windownr
comma
id|x
comma
id|y
comma
id|dx
comma
id|dy
comma
id|color
)paren
suffix:semicolon
)brace
DECL|function|DrawBlock
r_static
r_inline
r_int
id|DrawBlock
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|u16
id|x
comma
id|u16
id|y
comma
id|u16
id|dx
comma
id|u16
id|dy
comma
id|u16
id|color
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|DBox
comma
l_int|6
comma
id|windownr
comma
id|x
comma
id|y
comma
id|dx
comma
id|dy
comma
id|color
)paren
suffix:semicolon
)brace
DECL|function|HideWindow
r_static
r_inline
r_int
id|HideWindow
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|WHide
comma
l_int|1
comma
id|windownr
)paren
suffix:semicolon
)brace
DECL|function|MoveWindowRel
r_static
r_inline
r_int
id|MoveWindowRel
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|u16
id|x
comma
id|u16
id|y
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|WMoveD
comma
l_int|3
comma
id|windownr
comma
id|x
comma
id|y
)paren
suffix:semicolon
)brace
DECL|function|MoveWindowAbs
r_static
r_inline
r_int
id|MoveWindowAbs
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|u16
id|x
comma
id|u16
id|y
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|WMoveA
comma
l_int|3
comma
id|windownr
comma
id|x
comma
id|y
)paren
suffix:semicolon
)brace
DECL|function|DestroyOSDWindow
r_static
r_inline
r_int
id|DestroyOSDWindow
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|WDestroy
comma
l_int|1
comma
id|windownr
)paren
suffix:semicolon
)brace
DECL|function|CreateOSDWindow
r_static
r_inline
r_int
id|CreateOSDWindow
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|windownr
comma
id|osd_raw_window_t
id|disptype
comma
id|u16
id|width
comma
id|u16
id|height
)paren
(brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|WCreate
comma
l_int|4
comma
id|windownr
comma
id|disptype
comma
id|width
comma
id|height
)paren
suffix:semicolon
)brace
DECL|variable|bpp2pal
r_static
r_enum
id|av7110_osd_palette_type
id|bpp2pal
(braket
l_int|8
)braket
op_assign
(brace
id|Pal1Bit
comma
id|Pal2Bit
comma
l_int|0
comma
id|Pal4Bit
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|Pal8Bit
)brace
suffix:semicolon
DECL|variable|bpp2bit
r_static
id|osd_raw_window_t
id|bpp2bit
(braket
l_int|8
)braket
op_assign
(brace
id|OSD_BITMAP1
comma
id|OSD_BITMAP2
comma
l_int|0
comma
id|OSD_BITMAP4
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|OSD_BITMAP8
)brace
suffix:semicolon
DECL|function|LoadBitmap
r_static
r_inline
r_int
id|LoadBitmap
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
id|format
comma
id|u16
id|dx
comma
id|u16
id|dy
comma
r_int
id|inc
comma
id|u8
id|__user
op_star
id|data
)paren
(brace
r_int
id|bpp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|d
comma
id|delta
suffix:semicolon
id|u8
id|c
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
id|ret
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|av7110-&gt;bmpq
comma
id|av7110-&gt;bmp_state
op_ne
id|BMP_LOADING
comma
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ERESTARTSYS
op_logical_or
id|ret
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: warning: timeout waiting in LoadBitmap: %d, %d&bslash;n&quot;
comma
id|ret
comma
id|av7110-&gt;bmp_state
)paren
suffix:semicolon
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|BUG_ON
(paren
id|av7110-&gt;bmp_state
op_eq
id|BMP_LOADING
)paren
suffix:semicolon
id|av7110-&gt;bmp_state
op_assign
id|BMP_LOADING
suffix:semicolon
r_if
c_cond
(paren
id|format
op_eq
id|OSD_BITMAP8
)paren
(brace
id|bpp
op_assign
l_int|8
suffix:semicolon
id|delta
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_eq
id|OSD_BITMAP4
)paren
(brace
id|bpp
op_assign
l_int|4
suffix:semicolon
id|delta
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_eq
id|OSD_BITMAP2
)paren
(brace
id|bpp
op_assign
l_int|2
suffix:semicolon
id|delta
op_assign
l_int|4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|format
op_eq
id|OSD_BITMAP1
)paren
(brace
id|bpp
op_assign
l_int|1
suffix:semicolon
id|delta
op_assign
l_int|8
suffix:semicolon
)brace
r_else
(brace
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|av7110-&gt;bmplen
op_assign
(paren
(paren
id|dx
op_star
id|dy
op_star
id|bpp
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|av7110-&gt;bmpp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;bmplen
OG
l_int|32768
)paren
(brace
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dy
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|av7110-&gt;bmpbuf
op_plus
l_int|1024
op_plus
id|i
op_star
id|dx
comma
id|data
op_plus
id|i
op_star
id|inc
comma
id|dx
)paren
)paren
(brace
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|format
op_ne
id|OSD_BITMAP8
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dx
op_star
id|dy
op_div
id|delta
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c
op_assign
(paren
(paren
id|u8
op_star
)paren
id|av7110-&gt;bmpbuf
)paren
(braket
l_int|1024
op_plus
id|i
op_star
id|delta
op_plus
id|delta
op_minus
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|d
op_assign
id|delta
op_minus
l_int|2
suffix:semicolon
id|d
op_ge
l_int|0
suffix:semicolon
id|d
op_decrement
)paren
(brace
id|c
op_or_assign
(paren
(paren
(paren
id|u8
op_star
)paren
id|av7110-&gt;bmpbuf
)paren
(braket
l_int|1024
op_plus
id|i
op_star
id|delta
op_plus
id|d
)braket
op_lshift
(paren
(paren
id|delta
op_minus
id|d
op_minus
l_int|1
)paren
op_star
id|bpp
)paren
)paren
suffix:semicolon
(paren
(paren
id|u8
op_star
)paren
id|av7110-&gt;bmpbuf
)paren
(braket
l_int|1024
op_plus
id|i
)braket
op_assign
id|c
suffix:semicolon
)brace
)brace
)brace
id|av7110-&gt;bmplen
op_add_assign
l_int|1024
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;av7110_fw_cmd: LoadBmp size %d&bslash;n&quot;
comma
id|av7110-&gt;bmplen
)paren
suffix:semicolon
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|LoadBmp
comma
l_int|3
comma
id|format
comma
id|dx
comma
id|dy
)paren
suffix:semicolon
)brace
DECL|function|BlitBitmap
r_static
r_int
id|BlitBitmap
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u16
id|win
comma
id|u16
id|x
comma
id|u16
id|y
comma
id|u16
id|trans
)paren
(brace
r_int
id|ret
suffix:semicolon
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
id|BUG_ON
(paren
id|av7110-&gt;bmp_state
op_eq
id|BMP_NONE
)paren
suffix:semicolon
id|ret
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|av7110-&gt;bmpq
comma
id|av7110-&gt;bmp_state
op_ne
id|BMP_LOADING
comma
l_int|10
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
op_minus
id|ERESTARTSYS
op_logical_or
id|ret
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;dvb-ttpci: warning: timeout waiting in BlitBitmap: %d, %d&bslash;n&quot;
comma
id|ret
comma
id|av7110-&gt;bmp_state
)paren
suffix:semicolon
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
(paren
id|ret
op_eq
l_int|0
)paren
ques
c_cond
op_minus
id|ETIMEDOUT
suffix:colon
id|ret
suffix:semicolon
)brace
id|BUG_ON
(paren
id|av7110-&gt;bmp_state
op_ne
id|BMP_LOADED
)paren
suffix:semicolon
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|BlitBmp
comma
l_int|4
comma
id|win
comma
id|x
comma
id|y
comma
id|trans
)paren
suffix:semicolon
)brace
DECL|function|ReleaseBitmap
r_static
r_inline
r_int
id|ReleaseBitmap
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|dprintk
c_func
(paren
l_int|4
comma
l_string|&quot;%p&bslash;n&quot;
comma
id|av7110
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;bmp_state
op_ne
id|BMP_LOADED
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|av7110-&gt;bmp_state
op_assign
id|BMP_NONE
suffix:semicolon
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|ReleaseBmp
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|RGB2YUV
r_static
id|u32
id|RGB2YUV
c_func
(paren
id|u16
id|R
comma
id|u16
id|G
comma
id|u16
id|B
)paren
(brace
id|u16
id|y
comma
id|u
comma
id|v
suffix:semicolon
id|u16
id|Y
comma
id|Cr
comma
id|Cb
suffix:semicolon
id|y
op_assign
id|R
op_star
l_int|77
op_plus
id|G
op_star
l_int|150
op_plus
id|B
op_star
l_int|29
suffix:semicolon
multiline_comment|/* Luma=0.299R+0.587G+0.114B 0..65535 */
id|u
op_assign
l_int|2048
op_plus
id|B
op_star
l_int|8
op_minus
(paren
id|y
op_rshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Cr 0..4095 */
id|v
op_assign
l_int|2048
op_plus
id|R
op_star
l_int|8
op_minus
(paren
id|y
op_rshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Cb 0..4095 */
id|Y
op_assign
id|y
op_div
l_int|256
suffix:semicolon
id|Cb
op_assign
id|u
op_div
l_int|16
suffix:semicolon
id|Cr
op_assign
id|v
op_div
l_int|16
suffix:semicolon
r_return
id|Cr
op_or
(paren
id|Cb
op_lshift
l_int|16
)paren
op_or
(paren
id|Y
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
DECL|function|OSDSetColor
r_static
r_void
id|OSDSetColor
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
id|color
comma
id|u8
id|r
comma
id|u8
id|g
comma
id|u8
id|b
comma
id|u8
id|blend
)paren
(brace
id|u16
id|ch
comma
id|cl
suffix:semicolon
id|u32
id|yuv
suffix:semicolon
id|yuv
op_assign
id|blend
ques
c_cond
id|RGB2YUV
c_func
(paren
id|r
comma
id|g
comma
id|b
)paren
suffix:colon
l_int|0
suffix:semicolon
id|cl
op_assign
(paren
id|yuv
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|ch
op_assign
(paren
(paren
id|yuv
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|SetColor_
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|bpp2pal
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|color
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|SetBlend_
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|bpp2pal
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|color
comma
(paren
(paren
id|blend
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
)brace
DECL|function|OSDSetPalette
r_static
r_int
id|OSDSetPalette
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u32
id|__user
op_star
id|colors
comma
id|u8
id|first
comma
id|u8
id|last
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|length
op_assign
id|last
op_minus
id|first
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|length
op_star
l_int|4
OG
id|DATA_BUFF3_SIZE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|color
comma
id|blend
comma
id|yuv
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|color
comma
id|colors
op_plus
id|i
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|blend
op_assign
(paren
id|color
op_amp
l_int|0xF0000000
)paren
op_rshift
l_int|4
suffix:semicolon
id|yuv
op_assign
id|blend
ques
c_cond
id|RGB2YUV
c_func
(paren
id|color
op_amp
l_int|0xFF
comma
(paren
id|color
op_rshift
l_int|8
)paren
op_amp
l_int|0xFF
comma
(paren
id|color
op_rshift
l_int|16
)paren
op_amp
l_int|0xFF
)paren
op_or
id|blend
suffix:colon
l_int|0
suffix:semicolon
id|yuv
op_assign
(paren
(paren
id|yuv
op_amp
l_int|0xFFFF0000
)paren
op_rshift
l_int|16
)paren
op_or
(paren
(paren
id|yuv
op_amp
l_int|0x0000FFFF
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|wdebi
c_func
(paren
id|av7110
comma
id|DEBINOSWAP
comma
id|DATA_BUFF3_BASE
op_plus
id|i
op_star
l_int|4
comma
id|yuv
comma
l_int|4
)paren
suffix:semicolon
)brace
r_return
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_OSD
comma
id|Set_Palette
comma
l_int|4
comma
id|av7110-&gt;osdwin
comma
id|bpp2pal
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|first
comma
id|last
)paren
suffix:semicolon
)brace
DECL|function|OSDSetBlock
r_static
r_int
id|OSDSetBlock
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|x0
comma
r_int
id|y0
comma
r_int
id|x1
comma
r_int
id|y1
comma
r_int
id|inc
comma
id|u8
id|__user
op_star
id|data
)paren
(brace
id|uint
id|w
comma
id|h
comma
id|bpp
comma
id|bpl
comma
id|size
comma
id|lpb
comma
id|bnum
comma
id|brest
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|w
op_assign
id|x1
op_minus
id|x0
op_plus
l_int|1
suffix:semicolon
id|h
op_assign
id|y1
op_minus
id|y0
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|inc
op_le
l_int|0
)paren
id|inc
op_assign
id|w
suffix:semicolon
r_if
c_cond
(paren
id|w
op_le
l_int|0
op_logical_or
id|w
OG
l_int|720
op_logical_or
id|h
op_le
l_int|0
op_logical_or
id|h
OG
l_int|576
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|bpp
op_assign
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
op_plus
l_int|1
suffix:semicolon
id|bpl
op_assign
(paren
(paren
id|w
op_star
id|bpp
op_plus
l_int|7
)paren
op_amp
op_complement
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|size
op_assign
id|h
op_star
id|bpl
suffix:semicolon
id|lpb
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
op_div
id|bpl
suffix:semicolon
id|bnum
op_assign
id|size
op_div
(paren
id|lpb
op_star
id|bpl
)paren
suffix:semicolon
id|brest
op_assign
id|size
op_minus
id|bnum
op_star
id|lpb
op_star
id|bpl
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|bnum
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|LoadBitmap
c_func
(paren
id|av7110
comma
id|bpp2bit
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|w
comma
id|lpb
comma
id|inc
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|BlitBitmap
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|x0
comma
id|y0
op_plus
id|i
op_star
id|lpb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|data
op_add_assign
id|lpb
op_star
id|inc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|brest
)paren
(brace
id|rc
op_assign
id|LoadBitmap
c_func
(paren
id|av7110
comma
id|bpp2bit
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|w
comma
id|brest
op_div
id|bpl
comma
id|inc
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|BlitBitmap
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|x0
comma
id|y0
op_plus
id|bnum
op_star
id|lpb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
id|ReleaseBitmap
c_func
(paren
id|av7110
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_osd_cmd
r_int
id|av7110_osd_cmd
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|osd_cmd_t
op_star
id|dc
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|down_interruptible
c_func
(paren
op_amp
id|av7110-&gt;osd_sema
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
multiline_comment|/* stupid, but OSD functions don&squot;t provide a return code anyway */
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dc-&gt;cmd
)paren
(brace
r_case
id|OSD_Close
suffix:colon
id|DestroyOSDWindow
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Open
suffix:colon
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
op_assign
(paren
id|dc-&gt;color
op_minus
l_int|1
)paren
op_amp
l_int|7
suffix:semicolon
id|CreateOSDWindow
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|bpp2bit
(braket
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
)braket
comma
id|dc-&gt;x1
op_minus
id|dc-&gt;x0
op_plus
l_int|1
comma
id|dc-&gt;y1
op_minus
id|dc-&gt;y0
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dc-&gt;data
)paren
(brace
id|MoveWindowAbs
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
)paren
suffix:semicolon
id|SetColorBlend
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
)paren
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Show
suffix:colon
id|MoveWindowRel
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Hide
suffix:colon
id|HideWindow
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Clear
suffix:colon
id|DrawBlock
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
l_int|0
comma
l_int|0
comma
l_int|720
comma
l_int|576
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Fill
suffix:colon
id|DrawBlock
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
l_int|0
comma
l_int|0
comma
l_int|720
comma
l_int|576
comma
id|dc-&gt;color
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_SetColor
suffix:colon
id|OSDSetColor
c_func
(paren
id|av7110
comma
id|dc-&gt;color
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|dc-&gt;x1
comma
id|dc-&gt;y1
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_SetPalette
suffix:colon
(brace
r_if
c_cond
(paren
id|FW_VERSION
c_func
(paren
id|av7110-&gt;arm_app
)paren
op_ge
l_int|0x2618
)paren
(brace
id|ret
op_assign
id|OSDSetPalette
c_func
(paren
id|av7110
comma
id|dc-&gt;data
comma
id|dc-&gt;color
comma
id|dc-&gt;x0
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
comma
id|len
op_assign
id|dc-&gt;x0
op_minus
id|dc-&gt;color
op_plus
l_int|1
suffix:semicolon
id|u8
id|__user
op_star
id|colors
op_assign
(paren
id|u8
op_star
)paren
id|dc-&gt;data
suffix:semicolon
id|u8
id|r
comma
id|g
comma
id|b
comma
id|blend
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|r
comma
id|colors
op_plus
id|i
op_star
l_int|4
)paren
op_logical_or
id|get_user
c_func
(paren
id|g
comma
id|colors
op_plus
id|i
op_star
l_int|4
op_plus
l_int|1
)paren
op_logical_or
id|get_user
c_func
(paren
id|b
comma
id|colors
op_plus
id|i
op_star
l_int|4
op_plus
l_int|2
)paren
op_logical_or
id|get_user
c_func
(paren
id|blend
comma
id|colors
op_plus
id|i
op_star
l_int|4
op_plus
l_int|3
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|OSDSetColor
c_func
(paren
id|av7110
comma
id|dc-&gt;color
op_plus
id|i
comma
id|r
comma
id|g
comma
id|b
comma
id|blend
)paren
suffix:semicolon
)brace
)brace
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_case
id|OSD_SetTrans
suffix:colon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_SetPixel
suffix:colon
id|DrawLine
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
l_int|0
comma
l_int|0
comma
id|dc-&gt;color
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_GetPixel
suffix:colon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_SetRow
suffix:colon
id|dc-&gt;y1
op_assign
id|dc-&gt;y0
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|OSD_SetBlock
suffix:colon
id|ret
op_assign
id|OSDSetBlock
c_func
(paren
id|av7110
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|dc-&gt;x1
comma
id|dc-&gt;y1
comma
id|dc-&gt;color
comma
id|dc-&gt;data
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_FillRow
suffix:colon
id|DrawBlock
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|dc-&gt;x1
op_minus
id|dc-&gt;x0
op_plus
l_int|1
comma
id|dc-&gt;y1
comma
id|dc-&gt;color
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_FillBlock
suffix:colon
id|DrawBlock
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|dc-&gt;x1
op_minus
id|dc-&gt;x0
op_plus
l_int|1
comma
id|dc-&gt;y1
op_minus
id|dc-&gt;y0
op_plus
l_int|1
comma
id|dc-&gt;color
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Line
suffix:colon
id|DrawLine
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|dc-&gt;x1
op_minus
id|dc-&gt;x0
comma
id|dc-&gt;y1
op_minus
id|dc-&gt;y0
comma
id|dc-&gt;color
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Query
suffix:colon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Test
suffix:colon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_Text
suffix:colon
(brace
r_char
id|textbuf
(braket
l_int|240
)braket
suffix:semicolon
r_if
c_cond
(paren
id|strncpy_from_user
c_func
(paren
id|textbuf
comma
id|dc-&gt;data
comma
l_int|240
)paren
OL
l_int|0
)paren
(brace
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|textbuf
(braket
l_int|239
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dc-&gt;x1
OG
l_int|3
)paren
id|dc-&gt;x1
op_assign
l_int|3
suffix:semicolon
id|SetFont
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x1
comma
(paren
id|u16
)paren
(paren
id|dc-&gt;color
op_amp
l_int|0xffff
)paren
comma
(paren
id|u16
)paren
(paren
id|dc-&gt;color
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
id|FlushText
c_func
(paren
id|av7110
)paren
suffix:semicolon
id|WriteText
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
comma
id|textbuf
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_case
id|OSD_SetWindow
suffix:colon
r_if
c_cond
(paren
id|dc-&gt;x0
template_param
l_int|7
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|av7110-&gt;osdwin
op_assign
id|dc-&gt;x0
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_MoveWindow
suffix:colon
id|MoveWindowAbs
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
)paren
suffix:semicolon
id|SetColorBlend
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
r_case
id|OSD_OpenRaw
suffix:colon
r_if
c_cond
(paren
id|dc-&gt;color
template_param
id|OSD_CURSOR
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dc-&gt;color
op_ge
id|OSD_BITMAP1
op_logical_and
id|dc-&gt;color
op_le
id|OSD_BITMAP8HR
)paren
(brace
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
op_assign
(paren
l_int|1
op_lshift
(paren
id|dc-&gt;color
op_amp
l_int|3
)paren
)paren
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|av7110-&gt;osdbpp
(braket
id|av7110-&gt;osdwin
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|CreateOSDWindow
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
(paren
id|osd_raw_window_t
)paren
id|dc-&gt;color
comma
id|dc-&gt;x1
op_minus
id|dc-&gt;x0
op_plus
l_int|1
comma
id|dc-&gt;y1
op_minus
id|dc-&gt;y0
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dc-&gt;data
)paren
(brace
id|MoveWindowAbs
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
comma
id|dc-&gt;x0
comma
id|dc-&gt;y0
)paren
suffix:semicolon
id|SetColorBlend
c_func
(paren
id|av7110
comma
id|av7110-&gt;osdwin
)paren
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|av7110-&gt;osd_sema
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|av7110_osd_capability
r_int
id|av7110_osd_capability
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|osd_cap_t
op_star
id|cap
)paren
(brace
r_switch
c_cond
(paren
id|cap-&gt;cmd
)paren
(brace
r_case
id|OSD_CAP_MEMSIZE
suffix:colon
r_if
c_cond
(paren
id|FW_4M_SDRAM
c_func
(paren
id|av7110-&gt;arm_app
)paren
)paren
id|cap-&gt;val
op_assign
l_int|1000000
suffix:semicolon
r_else
id|cap-&gt;val
op_assign
l_int|92000
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_DVB_AV7110_OSD */
eof
