multiline_comment|/*&n; * av7110_av.c: audio and video MPEG decoder stuff&n; *&n; * Copyright (C) 1999-2002 Ralph  Metzler&n; *                       &amp; Marcus Metzler for convergence integrated media GmbH&n; *&n; * originally based on code by:&n; * Copyright (C) 1998,1999 Christian Theiss &lt;mistert@rz.fh-augsburg.de&gt;&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; * Or, point your browser to http://www.gnu.org/copyleft/gpl.html&n; *&n; *&n; * the project&squot;s page is at http://www.linuxtv.org/dvb/&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/byteorder/swabb.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
DECL|macro|DEBUG_VARIABLE
mdefine_line|#define DEBUG_VARIABLE av7110_debug
r_extern
r_int
id|av7110_debug
suffix:semicolon
macro_line|#include &quot;av7110.h&quot;
macro_line|#include &quot;av7110_hw.h&quot;
macro_line|#include &quot;av7110_av.h&quot;
macro_line|#include &quot;av7110_ipack.h&quot;
macro_line|#include &quot;dvb_functions.h&quot;
multiline_comment|/* MPEG-2 (ISO 13818 / H.222.0) stream types */
DECL|macro|PROG_STREAM_MAP
mdefine_line|#define PROG_STREAM_MAP  0xBC
DECL|macro|PRIVATE_STREAM1
mdefine_line|#define PRIVATE_STREAM1  0xBD
DECL|macro|PADDING_STREAM
mdefine_line|#define PADDING_STREAM&t; 0xBE
DECL|macro|PRIVATE_STREAM2
mdefine_line|#define PRIVATE_STREAM2  0xBF
DECL|macro|AUDIO_STREAM_S
mdefine_line|#define AUDIO_STREAM_S&t; 0xC0
DECL|macro|AUDIO_STREAM_E
mdefine_line|#define AUDIO_STREAM_E&t; 0xDF
DECL|macro|VIDEO_STREAM_S
mdefine_line|#define VIDEO_STREAM_S&t; 0xE0
DECL|macro|VIDEO_STREAM_E
mdefine_line|#define VIDEO_STREAM_E&t; 0xEF
DECL|macro|ECM_STREAM
mdefine_line|#define ECM_STREAM&t; 0xF0
DECL|macro|EMM_STREAM
mdefine_line|#define EMM_STREAM&t; 0xF1
DECL|macro|DSM_CC_STREAM
mdefine_line|#define DSM_CC_STREAM&t; 0xF2
DECL|macro|ISO13522_STREAM
mdefine_line|#define ISO13522_STREAM  0xF3
DECL|macro|PROG_STREAM_DIR
mdefine_line|#define PROG_STREAM_DIR  0xFF
DECL|macro|PTS_DTS_FLAGS
mdefine_line|#define PTS_DTS_FLAGS&t; 0xC0
singleline_comment|//pts_dts flags
DECL|macro|PTS_ONLY
mdefine_line|#define PTS_ONLY&t; 0x80
DECL|macro|PTS_DTS
mdefine_line|#define PTS_DTS&t;&t; 0xC0
DECL|macro|TS_SIZE
mdefine_line|#define TS_SIZE&t;&t; 188
DECL|macro|TRANS_ERROR
mdefine_line|#define TRANS_ERROR&t; 0x80
DECL|macro|PAY_START
mdefine_line|#define PAY_START&t; 0x40
DECL|macro|TRANS_PRIO
mdefine_line|#define TRANS_PRIO&t; 0x20
DECL|macro|PID_MASK_HI
mdefine_line|#define PID_MASK_HI&t; 0x1F
singleline_comment|//flags
DECL|macro|TRANS_SCRMBL1
mdefine_line|#define TRANS_SCRMBL1&t; 0x80
DECL|macro|TRANS_SCRMBL2
mdefine_line|#define TRANS_SCRMBL2&t; 0x40
DECL|macro|ADAPT_FIELD
mdefine_line|#define ADAPT_FIELD&t; 0x20
DECL|macro|PAYLOAD
mdefine_line|#define PAYLOAD&t;&t; 0x10
DECL|macro|COUNT_MASK
mdefine_line|#define COUNT_MASK&t; 0x0F
singleline_comment|// adaptation flags
DECL|macro|DISCON_IND
mdefine_line|#define DISCON_IND&t; 0x80
DECL|macro|RAND_ACC_IND
mdefine_line|#define RAND_ACC_IND&t; 0x40
DECL|macro|ES_PRI_IND
mdefine_line|#define ES_PRI_IND&t; 0x20
DECL|macro|PCR_FLAG
mdefine_line|#define PCR_FLAG&t; 0x10
DECL|macro|OPCR_FLAG
mdefine_line|#define OPCR_FLAG&t; 0x08
DECL|macro|SPLICE_FLAG
mdefine_line|#define SPLICE_FLAG&t; 0x04
DECL|macro|TRANS_PRIV
mdefine_line|#define TRANS_PRIV&t; 0x02
DECL|macro|ADAP_EXT_FLAG
mdefine_line|#define ADAP_EXT_FLAG&t; 0x01
singleline_comment|// adaptation extension flags
DECL|macro|LTW_FLAG
mdefine_line|#define LTW_FLAG&t; 0x80
DECL|macro|PIECE_RATE
mdefine_line|#define PIECE_RATE&t; 0x40
DECL|macro|SEAM_SPLICE
mdefine_line|#define SEAM_SPLICE&t; 0x20
r_static
r_void
id|p_to_t
c_func
(paren
id|u8
r_const
op_star
id|buf
comma
r_int
r_int
id|length
comma
id|u16
id|pid
comma
id|u8
op_star
id|counter
comma
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
suffix:semicolon
DECL|function|av7110_record_cb
r_int
id|av7110_record_cb
c_func
(paren
r_struct
id|dvb_filter_pes2ts
op_star
id|p2t
comma
id|u8
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|p2t-&gt;priv
suffix:semicolon
singleline_comment|//&t;DEB_EE((&quot;struct dvb_filter_pes2ts:%p&bslash;n&quot;, p2t));
r_if
c_cond
(paren
op_logical_neg
(paren
id|dvbdmxfeed-&gt;ts_type
op_amp
id|TS_PACKET
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|3
)braket
op_eq
l_int|0xe0
)paren
singleline_comment|// video PES do not have a length in TS
id|buf
(braket
l_int|4
)braket
op_assign
id|buf
(braket
l_int|5
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dvbdmxfeed-&gt;ts_type
op_amp
id|TS_PAYLOAD_ONLY
)paren
r_return
id|dvbdmxfeed-&gt;cb
dot
id|ts
c_func
(paren
id|buf
comma
id|len
comma
l_int|0
comma
l_int|0
comma
op_amp
id|dvbdmxfeed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
r_else
r_return
id|dvb_filter_pes2ts
c_func
(paren
id|p2t
comma
id|buf
comma
id|len
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dvb_filter_pes2ts_cb
r_static
r_int
id|dvb_filter_pes2ts_cb
c_func
(paren
r_void
op_star
id|priv
comma
r_int
r_char
op_star
id|data
)paren
(brace
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
op_assign
(paren
r_struct
id|dvb_demux_feed
op_star
)paren
id|priv
suffix:semicolon
singleline_comment|//&t;DEB_EE((&quot;dvb_demux_feed:%p&bslash;n&quot;, dvbdmxfeed));
id|dvbdmxfeed-&gt;cb
dot
id|ts
c_func
(paren
id|data
comma
l_int|188
comma
l_int|0
comma
l_int|0
comma
op_amp
id|dvbdmxfeed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_av_start_record
r_int
id|av7110_av_start_record
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|av
comma
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p, dvb_demux_feed:%p&bslash;n&quot;
comma
id|av7110
comma
id|dvbdmxfeed
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_logical_or
(paren
id|av7110-&gt;rec_mode
op_amp
id|av
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Stop
comma
l_int|0
)paren
suffix:semicolon
id|dvbdmx-&gt;recording
op_assign
l_int|1
suffix:semicolon
id|av7110-&gt;rec_mode
op_or_assign
id|av
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;rec_mode
)paren
(brace
r_case
id|RP_AUDIO
suffix:colon
id|dvb_filter_pes2ts_init
c_func
(paren
op_amp
id|av7110-&gt;p2t
(braket
l_int|0
)braket
comma
id|dvbdmx-&gt;pesfilter
(braket
l_int|0
)braket
op_member_access_from_pointer
id|pid
comma
id|dvb_filter_pes2ts_cb
comma
(paren
r_void
op_star
)paren
id|dvbdmx-&gt;pesfilter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Record
comma
l_int|2
comma
id|AudioPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_VIDEO
suffix:colon
id|dvb_filter_pes2ts_init
c_func
(paren
op_amp
id|av7110-&gt;p2t
(braket
l_int|1
)braket
comma
id|dvbdmx-&gt;pesfilter
(braket
l_int|1
)braket
op_member_access_from_pointer
id|pid
comma
id|dvb_filter_pes2ts_cb
comma
(paren
r_void
op_star
)paren
id|dvbdmx-&gt;pesfilter
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Record
comma
l_int|2
comma
id|VideoPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_AV
suffix:colon
id|dvb_filter_pes2ts_init
c_func
(paren
op_amp
id|av7110-&gt;p2t
(braket
l_int|0
)braket
comma
id|dvbdmx-&gt;pesfilter
(braket
l_int|0
)braket
op_member_access_from_pointer
id|pid
comma
id|dvb_filter_pes2ts_cb
comma
(paren
r_void
op_star
)paren
id|dvbdmx-&gt;pesfilter
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|dvb_filter_pes2ts_init
c_func
(paren
op_amp
id|av7110-&gt;p2t
(braket
l_int|1
)braket
comma
id|dvbdmx-&gt;pesfilter
(braket
l_int|1
)braket
op_member_access_from_pointer
id|pid
comma
id|dvb_filter_pes2ts_cb
comma
(paren
r_void
op_star
)paren
id|dvbdmx-&gt;pesfilter
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Record
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_av_start_play
r_int
id|av7110_av_start_play
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|av
)paren
(brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;rec_mode
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_amp
id|av
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Stop
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_eq
id|RP_NONE
)paren
(brace
id|av7110_ipack_reset
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|av7110_ipack_reset
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|av7110-&gt;playing
op_or_assign
id|av
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;playing
)paren
(brace
r_case
id|RP_AUDIO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|AudioPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_VIDEO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|VideoPES
comma
l_int|0
)paren
suffix:semicolon
id|av7110-&gt;sinfo
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_AV
suffix:colon
id|av7110-&gt;sinfo
op_assign
l_int|0
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|av7110-&gt;playing
suffix:semicolon
)brace
DECL|function|av7110_av_stop
r_void
id|av7110_av_stop
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|av
)paren
(brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|av7110-&gt;playing
op_amp
id|av
)paren
op_logical_and
op_logical_neg
(paren
id|av7110-&gt;rec_mode
op_amp
id|av
)paren
)paren
r_return
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Stop
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
)paren
(brace
id|av7110-&gt;playing
op_and_assign
op_complement
id|av
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;playing
)paren
(brace
r_case
id|RP_AUDIO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|AudioPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_VIDEO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|VideoPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_NONE
suffix:colon
id|av7110_set_vidmode
c_func
(paren
id|av7110
comma
id|av7110-&gt;vidmode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|av7110-&gt;rec_mode
op_and_assign
op_complement
id|av
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;rec_mode
)paren
(brace
r_case
id|RP_AUDIO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Record
comma
l_int|2
comma
id|AudioPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_VIDEO
suffix:colon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Record
comma
l_int|2
comma
id|VideoPES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RP_NONE
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|av7110_pes_play
r_int
id|av7110_pes_play
c_func
(paren
r_void
op_star
id|dest
comma
r_struct
id|dvb_ringbuffer
op_star
id|buf
comma
r_int
id|dlen
)paren
(brace
r_int
id|len
suffix:semicolon
id|u32
id|sync
suffix:semicolon
id|u16
id|blen
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;dvb_ring_buffer_t: %p&bslash;n&quot;
comma
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dlen
)paren
(brace
id|wake_up
c_func
(paren
op_amp
id|buf-&gt;queue
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|len
op_assign
id|dvb_ringbuffer_avail
c_func
(paren
id|buf
)paren
)paren
OL
l_int|6
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|sync
op_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|0
)paren
op_lshift
l_int|24
suffix:semicolon
id|sync
op_or_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|1
)paren
op_lshift
l_int|16
suffix:semicolon
id|sync
op_or_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|2
)paren
op_lshift
l_int|8
suffix:semicolon
id|sync
op_or_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|sync
op_amp
op_complement
l_int|0x0f
)paren
op_eq
l_int|0x000001e0
)paren
op_logical_or
(paren
(paren
id|sync
op_amp
op_complement
l_int|0x1f
)paren
op_eq
l_int|0x000001c0
)paren
op_logical_or
(paren
id|sync
op_eq
l_int|0x000001bd
)paren
)paren
r_break
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;resync&bslash;n&quot;
)paren
suffix:semicolon
id|DVB_RINGBUFFER_SKIP
c_func
(paren
id|buf
comma
l_int|1
)paren
suffix:semicolon
)brace
id|blen
op_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|4
)paren
op_lshift
l_int|8
suffix:semicolon
id|blen
op_or_assign
id|DVB_RINGBUFFER_PEEK
c_func
(paren
id|buf
comma
l_int|5
)paren
suffix:semicolon
id|blen
op_add_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|len
template_param
id|dlen
)paren
(brace
singleline_comment|//printk(&quot;buffer empty - avail %d blen %u dlen %d&bslash;n&quot;, len, blen, dlen);
id|wake_up
c_func
(paren
op_amp
id|buf-&gt;queue
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dvb_ringbuffer_read
c_func
(paren
id|buf
comma
id|dest
comma
(paren
r_int
)paren
id|blen
comma
l_int|0
)paren
suffix:semicolon
id|DEB_S
c_func
(paren
(paren
l_string|&quot;pread=0x%08lx, pwrite=0x%08lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|buf-&gt;pread
comma
(paren
r_int
r_int
)paren
id|buf-&gt;pwrite
)paren
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|buf-&gt;queue
)paren
suffix:semicolon
r_return
id|blen
suffix:semicolon
)brace
DECL|function|av7110_set_volume
r_int
id|av7110_set_volume
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|volleft
comma
r_int
id|volright
)paren
(brace
r_int
id|err
comma
id|vol
comma
id|val
comma
id|balance
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;adac_type
)paren
(brace
r_case
id|DVB_ADAC_TI
suffix:colon
id|volleft
op_assign
(paren
id|volleft
op_star
l_int|256
)paren
op_div
l_int|1036
suffix:semicolon
id|volright
op_assign
(paren
id|volright
op_star
l_int|256
)paren
op_div
l_int|1036
suffix:semicolon
r_if
c_cond
(paren
id|volleft
OG
l_int|0x3f
)paren
id|volleft
op_assign
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
id|volright
OG
l_int|0x3f
)paren
id|volright
op_assign
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|SendDAC
c_func
(paren
id|av7110
comma
l_int|3
comma
l_int|0x80
op_plus
id|volleft
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_return
id|SendDAC
c_func
(paren
id|av7110
comma
l_int|4
comma
id|volright
)paren
suffix:semicolon
r_case
id|DVB_ADAC_CRYSTAL
suffix:colon
id|volleft
op_assign
l_int|127
op_minus
id|volleft
op_div
l_int|2
suffix:semicolon
id|volright
op_assign
l_int|127
op_minus
id|volright
op_div
l_int|2
suffix:semicolon
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x20
comma
l_int|0x03
comma
id|volleft
)paren
suffix:semicolon
id|i2c_writereg
c_func
(paren
id|av7110
comma
l_int|0x20
comma
l_int|0x04
comma
id|volright
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|DVB_ADAC_MSP
suffix:colon
id|vol
op_assign
(paren
id|volleft
OG
id|volright
)paren
ques
c_cond
id|volleft
suffix:colon
id|volright
suffix:semicolon
id|val
op_assign
(paren
id|vol
op_star
l_int|0x73
op_div
l_int|255
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|0
)paren
id|balance
op_assign
(paren
(paren
id|volright
op_minus
id|volleft
)paren
op_star
l_int|127
)paren
op_div
id|vol
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0001
comma
id|balance
op_lshift
l_int|8
)paren
suffix:semicolon
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0000
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* loudspeaker */
id|msp_writereg
c_func
(paren
id|av7110
comma
id|MSP_WR_DSP
comma
l_int|0x0006
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* headphonesr */
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_set_vidmode
r_void
id|av7110_set_vidmode
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_int
id|mode
)paren
(brace
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_ENCODER
comma
id|LoadVidCode
comma
l_int|1
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;playing
)paren
(brace
id|ChangePIDs
c_func
(paren
id|av7110
comma
id|av7110-&gt;pids
(braket
id|DMX_PES_VIDEO
)braket
comma
id|av7110-&gt;pids
(braket
id|DMX_PES_AUDIO
)braket
comma
id|av7110-&gt;pids
(braket
id|DMX_PES_TELETEXT
)braket
comma
l_int|0
comma
id|av7110-&gt;pids
(braket
id|DMX_PES_PCR
)braket
)paren
suffix:semicolon
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_PIDFILTER
comma
id|Scan
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|variable|sw2mode
r_static
r_int
id|sw2mode
(braket
l_int|16
)braket
op_assign
(brace
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_NTSC
comma
id|VIDEO_MODE_NTSC
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_NTSC
comma
id|VIDEO_MODE_NTSC
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_NTSC
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
id|VIDEO_MODE_PAL
comma
)brace
suffix:semicolon
DECL|function|get_video_format
r_static
r_void
id|get_video_format
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|hsize
comma
id|vsize
suffix:semicolon
r_int
id|sw
suffix:semicolon
id|u8
op_star
id|p
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;sinfo
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
OL
id|count
op_minus
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p
op_assign
id|buf
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_logical_or
id|p
(braket
l_int|1
)braket
op_logical_or
id|p
(braket
l_int|2
)braket
op_ne
l_int|0x01
op_logical_or
id|p
(braket
l_int|3
)braket
op_ne
l_int|0xb3
)paren
r_continue
suffix:semicolon
id|p
op_add_assign
l_int|4
suffix:semicolon
id|hsize
op_assign
(paren
(paren
id|p
(braket
l_int|1
)braket
op_amp
l_int|0xF0
)paren
op_rshift
l_int|4
)paren
op_or
(paren
id|p
(braket
l_int|0
)braket
op_lshift
l_int|4
)paren
suffix:semicolon
id|vsize
op_assign
(paren
(paren
id|p
(braket
l_int|1
)braket
op_amp
l_int|0x0F
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|p
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|sw
op_assign
(paren
id|p
(braket
l_int|3
)braket
op_amp
l_int|0x0F
)paren
suffix:semicolon
id|av7110_set_vidmode
c_func
(paren
id|av7110
comma
id|sw2mode
(braket
id|sw
)braket
)paren
suffix:semicolon
id|DEB_S
c_func
(paren
(paren
l_string|&quot;dvb: playback %dx%d fr=%d&bslash;n&quot;
comma
id|hsize
comma
id|vsize
comma
id|sw
)paren
)paren
suffix:semicolon
id|av7110-&gt;sinfo
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/****************************************************************************&n; * I/O buffer management and control&n; ****************************************************************************/
DECL|function|aux_ring_buffer_write
r_static
r_inline
r_int
id|aux_ring_buffer_write
c_func
(paren
r_struct
id|dvb_ringbuffer
op_star
id|rbuf
comma
r_const
r_char
op_star
id|buf
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
id|todo
op_assign
id|count
suffix:semicolon
r_int
id|free
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|dvb_ringbuffer_free
c_func
(paren
id|rbuf
)paren
OL
l_int|2048
)paren
(brace
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|rbuf-&gt;queue
comma
(paren
id|dvb_ringbuffer_free
c_func
(paren
id|rbuf
)paren
op_ge
l_int|2048
)paren
)paren
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
id|free
op_assign
id|dvb_ringbuffer_free
c_func
(paren
id|rbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|free
OG
id|todo
)paren
id|free
op_assign
id|todo
suffix:semicolon
id|dvb_ringbuffer_write
c_func
(paren
id|rbuf
comma
id|buf
comma
id|free
comma
l_int|0
)paren
suffix:semicolon
id|todo
op_sub_assign
id|free
suffix:semicolon
id|buf
op_add_assign
id|free
suffix:semicolon
)brace
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
DECL|function|play_video_cb
r_static
r_void
id|play_video_cb
c_func
(paren
id|u8
op_star
id|buf
comma
r_int
id|count
comma
r_void
op_star
id|priv
)paren
(brace
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|3
)braket
op_amp
l_int|0xe0
)paren
op_eq
l_int|0xe0
)paren
(brace
id|get_video_format
c_func
(paren
id|av7110
comma
id|buf
comma
id|count
)paren
suffix:semicolon
id|aux_ring_buffer_write
c_func
(paren
op_amp
id|av7110-&gt;avout
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
r_else
id|aux_ring_buffer_write
c_func
(paren
op_amp
id|av7110-&gt;aout
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|play_audio_cb
r_static
r_void
id|play_audio_cb
c_func
(paren
id|u8
op_star
id|buf
comma
r_int
id|count
comma
r_void
op_star
id|priv
)paren
(brace
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
id|aux_ring_buffer_write
c_func
(paren
op_amp
id|av7110-&gt;aout
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
DECL|macro|FREE_COND
mdefine_line|#define FREE_COND (dvb_ringbuffer_free(&amp;av7110-&gt;avout) &gt;= 20 * 1024 &amp;&amp; &bslash;&n;&t;&t;   dvb_ringbuffer_free(&amp;av7110-&gt;aout) &gt;= 20 * 1024)
DECL|function|dvb_play
r_static
id|ssize_t
id|dvb_play
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_const
id|u8
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
comma
r_int
id|type
comma
r_int
id|umem
)paren
(brace
r_int
r_int
id|todo
op_assign
id|count
comma
id|n
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;kbuf
(braket
id|type
)braket
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
op_logical_and
op_logical_neg
id|FREE_COND
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|FREE_COND
)paren
(brace
r_if
c_cond
(paren
id|nonblock
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|av7110-&gt;avout.queue
comma
id|FREE_COND
)paren
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
id|n
op_assign
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|IPACKS
op_star
l_int|2
)paren
id|n
op_assign
id|IPACKS
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|umem
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|av7110-&gt;kbuf
(braket
id|type
)braket
comma
id|buf
comma
id|n
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|av7110_ipack_instant_repack
c_func
(paren
id|av7110-&gt;kbuf
(braket
id|type
)braket
comma
id|n
comma
op_amp
id|av7110-&gt;ipack
(braket
id|type
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|av7110_ipack_instant_repack
c_func
(paren
id|buf
comma
id|n
comma
op_amp
id|av7110-&gt;ipack
(braket
id|type
)braket
)paren
suffix:semicolon
)brace
id|todo
op_sub_assign
id|n
suffix:semicolon
id|buf
op_add_assign
id|n
suffix:semicolon
)brace
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
DECL|function|dvb_aplay
r_static
id|ssize_t
id|dvb_aplay
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_const
id|u8
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
id|nonblock
comma
r_int
id|type
)paren
(brace
r_int
r_int
id|todo
op_assign
id|count
comma
id|n
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|av7110-&gt;kbuf
(braket
id|type
)braket
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
op_logical_and
id|dvb_ringbuffer_free
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
OL
l_int|20
op_star
l_int|1024
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
r_while
c_loop
(paren
id|todo
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|dvb_ringbuffer_free
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
OL
l_int|20
op_star
l_int|1024
)paren
(brace
r_if
c_cond
(paren
id|nonblock
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|av7110-&gt;aout.queue
comma
(paren
id|dvb_ringbuffer_free
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
op_ge
l_int|20
op_star
l_int|1024
)paren
)paren
)paren
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
id|n
op_assign
id|todo
suffix:semicolon
r_if
c_cond
(paren
id|n
OG
id|IPACKS
op_star
l_int|2
)paren
id|n
op_assign
id|IPACKS
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|av7110-&gt;kbuf
(braket
id|type
)braket
comma
id|buf
comma
id|n
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|av7110_ipack_instant_repack
c_func
(paren
id|av7110-&gt;kbuf
(braket
id|type
)braket
comma
id|n
comma
op_amp
id|av7110-&gt;ipack
(braket
id|type
)braket
)paren
suffix:semicolon
id|todo
op_sub_assign
id|n
suffix:semicolon
id|buf
op_add_assign
id|n
suffix:semicolon
)brace
r_return
id|count
op_minus
id|todo
suffix:semicolon
)brace
DECL|function|av7110_p2t_init
r_void
id|av7110_p2t_init
c_func
(paren
r_struct
id|av7110_p2t
op_star
id|p
comma
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
id|memset
c_func
(paren
id|p-&gt;pes
comma
l_int|0
comma
id|TS_SIZE
)paren
suffix:semicolon
id|p-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|p-&gt;pos
op_assign
l_int|0
suffix:semicolon
id|p-&gt;frags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|feed
)paren
id|p-&gt;feed
op_assign
id|feed
suffix:semicolon
)brace
DECL|function|clear_p2t
r_static
r_void
id|clear_p2t
c_func
(paren
r_struct
id|av7110_p2t
op_star
id|p
)paren
(brace
id|memset
c_func
(paren
id|p-&gt;pes
comma
l_int|0
comma
id|TS_SIZE
)paren
suffix:semicolon
singleline_comment|//&t;p-&gt;counter = 0;
id|p-&gt;pos
op_assign
l_int|0
suffix:semicolon
id|p-&gt;frags
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|find_pes_header
r_static
r_int
id|find_pes_header
c_func
(paren
id|u8
r_const
op_star
id|buf
comma
r_int
r_int
id|length
comma
r_int
op_star
id|frags
)paren
(brace
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
op_star
id|frags
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|c
OL
id|length
op_minus
l_int|3
op_logical_and
op_logical_neg
id|found
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
id|c
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|c
op_plus
l_int|1
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|c
op_plus
l_int|2
)braket
op_eq
l_int|0x01
)paren
(brace
r_switch
c_cond
(paren
id|buf
(braket
id|c
op_plus
l_int|3
)braket
)paren
(brace
r_case
id|PROG_STREAM_MAP
suffix:colon
r_case
id|PRIVATE_STREAM2
suffix:colon
r_case
id|PROG_STREAM_DIR
suffix:colon
r_case
id|ECM_STREAM
suffix:colon
r_case
id|EMM_STREAM
suffix:colon
r_case
id|PADDING_STREAM
suffix:colon
r_case
id|DSM_CC_STREAM
suffix:colon
r_case
id|ISO13522_STREAM
suffix:colon
r_case
id|PRIVATE_STREAM1
suffix:colon
r_case
id|AUDIO_STREAM_S
dot
dot
dot
id|AUDIO_STREAM_E
suffix:colon
r_case
id|VIDEO_STREAM_S
dot
dot
dot
id|VIDEO_STREAM_E
suffix:colon
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|c
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|c
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c
op_eq
id|length
op_minus
l_int|3
op_logical_and
op_logical_neg
id|found
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
id|length
op_minus
l_int|1
)braket
op_eq
l_int|0x00
)paren
op_star
id|frags
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
id|length
op_minus
l_int|2
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|length
op_minus
l_int|1
)braket
op_eq
l_int|0x00
)paren
op_star
id|frags
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
id|length
op_minus
l_int|3
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|length
op_minus
l_int|2
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|length
op_minus
l_int|1
)braket
op_eq
l_int|0x01
)paren
op_star
id|frags
op_assign
l_int|3
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|c
suffix:semicolon
)brace
DECL|function|av7110_p2t_write
r_void
id|av7110_p2t_write
c_func
(paren
id|u8
r_const
op_star
id|buf
comma
r_int
r_int
id|length
comma
id|u16
id|pid
comma
r_struct
id|av7110_p2t
op_star
id|p
)paren
(brace
r_int
id|c
comma
id|c2
comma
id|l
comma
id|add
suffix:semicolon
r_int
id|check
comma
id|rest
suffix:semicolon
id|c
op_assign
l_int|0
suffix:semicolon
id|c2
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;frags
)paren
(brace
id|check
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;frags
)paren
(brace
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|buf
(braket
id|c
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
id|c
op_plus
l_int|1
)braket
op_eq
l_int|0x01
)paren
(brace
id|check
op_assign
l_int|1
suffix:semicolon
id|c
op_add_assign
l_int|2
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|buf
(braket
id|c
)braket
op_eq
l_int|0x01
)paren
(brace
id|check
op_assign
l_int|1
suffix:semicolon
id|c
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|check
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|check
)paren
(brace
r_switch
c_cond
(paren
id|buf
(braket
id|c
)braket
)paren
(brace
r_case
id|PROG_STREAM_MAP
suffix:colon
r_case
id|PRIVATE_STREAM2
suffix:colon
r_case
id|PROG_STREAM_DIR
suffix:colon
r_case
id|ECM_STREAM
suffix:colon
r_case
id|EMM_STREAM
suffix:colon
r_case
id|PADDING_STREAM
suffix:colon
r_case
id|DSM_CC_STREAM
suffix:colon
r_case
id|ISO13522_STREAM
suffix:colon
r_case
id|PRIVATE_STREAM1
suffix:colon
r_case
id|AUDIO_STREAM_S
dot
dot
dot
id|AUDIO_STREAM_E
suffix:colon
r_case
id|VIDEO_STREAM_S
dot
dot
dot
id|VIDEO_STREAM_E
suffix:colon
id|p-&gt;pes
(braket
l_int|0
)braket
op_assign
l_int|0x00
suffix:semicolon
id|p-&gt;pes
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|p-&gt;pes
(braket
l_int|2
)braket
op_assign
l_int|0x01
suffix:semicolon
id|p-&gt;pes
(braket
l_int|3
)braket
op_assign
id|buf
(braket
id|c
)braket
suffix:semicolon
id|p-&gt;pos
op_assign
l_int|4
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;pes
op_plus
id|p-&gt;pos
comma
id|buf
op_plus
id|c
comma
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
op_minus
id|p-&gt;pos
)paren
suffix:semicolon
id|c
op_add_assign
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
op_minus
id|p-&gt;pos
suffix:semicolon
id|p_to_t
c_func
(paren
id|p-&gt;pes
comma
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
comma
id|pid
comma
op_amp
id|p-&gt;counter
comma
id|p-&gt;feed
)paren
suffix:semicolon
id|clear_p2t
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|c
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|p-&gt;frags
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;pos
)paren
(brace
id|c2
op_assign
id|find_pes_header
c_func
(paren
id|buf
op_plus
id|c
comma
id|length
op_minus
id|c
comma
op_amp
id|p-&gt;frags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c2
op_ge
l_int|0
op_logical_and
id|c2
OL
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
op_minus
id|p-&gt;pos
)paren
id|l
op_assign
id|c2
op_plus
id|c
suffix:semicolon
r_else
id|l
op_assign
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
op_minus
id|p-&gt;pos
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;pes
op_plus
id|p-&gt;pos
comma
id|buf
comma
id|l
)paren
suffix:semicolon
id|c
op_add_assign
id|l
suffix:semicolon
id|p-&gt;pos
op_add_assign
id|l
suffix:semicolon
id|p_to_t
c_func
(paren
id|p-&gt;pes
comma
id|p-&gt;pos
comma
id|pid
comma
op_amp
id|p-&gt;counter
comma
id|p-&gt;feed
)paren
suffix:semicolon
id|clear_p2t
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|add
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|c
OL
id|length
)paren
(brace
id|c2
op_assign
id|find_pes_header
c_func
(paren
id|buf
op_plus
id|c
op_plus
id|add
comma
id|length
op_minus
id|c
op_minus
id|add
comma
op_amp
id|p-&gt;frags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c2
op_ge
l_int|0
)paren
(brace
id|c2
op_add_assign
id|c
op_plus
id|add
suffix:semicolon
r_if
c_cond
(paren
id|c2
OG
id|c
)paren
(brace
id|p_to_t
c_func
(paren
id|buf
op_plus
id|c
comma
id|c2
op_minus
id|c
comma
id|pid
comma
op_amp
id|p-&gt;counter
comma
id|p-&gt;feed
)paren
suffix:semicolon
id|c
op_assign
id|c2
suffix:semicolon
id|clear_p2t
c_func
(paren
id|p
)paren
suffix:semicolon
id|add
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|add
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|l
op_assign
id|length
op_minus
id|c
suffix:semicolon
id|rest
op_assign
id|l
op_mod
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
suffix:semicolon
id|l
op_sub_assign
id|rest
suffix:semicolon
id|p_to_t
c_func
(paren
id|buf
op_plus
id|c
comma
id|l
comma
id|pid
comma
op_amp
id|p-&gt;counter
comma
id|p-&gt;feed
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;pes
comma
id|buf
op_plus
id|c
op_plus
id|l
comma
id|rest
)paren
suffix:semicolon
id|p-&gt;pos
op_assign
id|rest
suffix:semicolon
id|c
op_assign
id|length
suffix:semicolon
)brace
)brace
)brace
DECL|function|write_ts_header2
r_int
id|write_ts_header2
c_func
(paren
id|u16
id|pid
comma
id|u8
op_star
id|counter
comma
r_int
id|pes_start
comma
id|u8
op_star
id|buf
comma
id|u8
id|length
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|c
op_assign
l_int|0
suffix:semicolon
r_int
id|fill
suffix:semicolon
id|u8
id|tshead
(braket
l_int|4
)braket
op_assign
(brace
l_int|0x47
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x10
)brace
suffix:semicolon
id|fill
op_assign
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
op_minus
id|length
suffix:semicolon
r_if
c_cond
(paren
id|pes_start
)paren
id|tshead
(braket
l_int|1
)braket
op_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|fill
)paren
id|tshead
(braket
l_int|3
)braket
op_assign
l_int|0x30
suffix:semicolon
id|tshead
(braket
l_int|1
)braket
op_or_assign
(paren
id|u8
)paren
(paren
(paren
id|pid
op_amp
l_int|0x1F00
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
id|tshead
(braket
l_int|2
)braket
op_or_assign
(paren
id|u8
)paren
(paren
id|pid
op_amp
l_int|0x00FF
)paren
suffix:semicolon
id|tshead
(braket
l_int|3
)braket
op_or_assign
(paren
(paren
op_star
id|counter
)paren
op_increment
op_amp
l_int|0x0F
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|tshead
comma
l_int|4
)paren
suffix:semicolon
id|c
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|fill
)paren
(brace
id|buf
(braket
l_int|4
)braket
op_assign
id|fill
op_minus
l_int|1
suffix:semicolon
id|c
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fill
OG
l_int|1
)paren
(brace
id|buf
(braket
l_int|5
)braket
op_assign
l_int|0x00
suffix:semicolon
id|c
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|6
suffix:semicolon
id|i
OL
id|fill
op_plus
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
(braket
id|i
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|c
op_increment
suffix:semicolon
)brace
)brace
r_return
id|c
suffix:semicolon
)brace
DECL|function|p_to_t
r_static
r_void
id|p_to_t
c_func
(paren
id|u8
r_const
op_star
id|buf
comma
r_int
r_int
id|length
comma
id|u16
id|pid
comma
id|u8
op_star
id|counter
comma
r_struct
id|dvb_demux_feed
op_star
id|feed
)paren
(brace
r_int
id|l
comma
id|pes_start
suffix:semicolon
id|u8
id|obuf
(braket
id|TS_SIZE
)braket
suffix:semicolon
r_int
id|c
op_assign
l_int|0
suffix:semicolon
id|pes_start
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|length
OG
l_int|3
op_logical_and
id|buf
(braket
l_int|0
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
l_int|1
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
l_int|2
)braket
op_eq
l_int|0x01
)paren
r_switch
c_cond
(paren
id|buf
(braket
l_int|3
)braket
)paren
(brace
r_case
id|PROG_STREAM_MAP
suffix:colon
r_case
id|PRIVATE_STREAM2
suffix:colon
r_case
id|PROG_STREAM_DIR
suffix:colon
r_case
id|ECM_STREAM
suffix:colon
r_case
id|EMM_STREAM
suffix:colon
r_case
id|PADDING_STREAM
suffix:colon
r_case
id|DSM_CC_STREAM
suffix:colon
r_case
id|ISO13522_STREAM
suffix:colon
r_case
id|PRIVATE_STREAM1
suffix:colon
r_case
id|AUDIO_STREAM_S
dot
dot
dot
id|AUDIO_STREAM_E
suffix:colon
r_case
id|VIDEO_STREAM_S
dot
dot
dot
id|VIDEO_STREAM_E
suffix:colon
id|pes_start
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|c
OL
id|length
)paren
(brace
id|memset
c_func
(paren
id|obuf
comma
l_int|0
comma
id|TS_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
op_minus
id|c
op_ge
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
)paren
(brace
id|l
op_assign
id|write_ts_header2
c_func
(paren
id|pid
comma
id|counter
comma
id|pes_start
comma
id|obuf
comma
(paren
id|TS_SIZE
op_minus
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|obuf
op_plus
id|l
comma
id|buf
op_plus
id|c
comma
id|TS_SIZE
op_minus
id|l
)paren
suffix:semicolon
id|c
op_add_assign
id|TS_SIZE
op_minus
id|l
suffix:semicolon
)brace
r_else
(brace
id|l
op_assign
id|write_ts_header2
c_func
(paren
id|pid
comma
id|counter
comma
id|pes_start
comma
id|obuf
comma
id|length
op_minus
id|c
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|obuf
op_plus
id|l
comma
id|buf
op_plus
id|c
comma
id|TS_SIZE
op_minus
id|l
)paren
suffix:semicolon
id|c
op_assign
id|length
suffix:semicolon
)brace
id|feed-&gt;cb
dot
id|ts
c_func
(paren
id|obuf
comma
l_int|188
comma
l_int|0
comma
l_int|0
comma
op_amp
id|feed-&gt;feed.ts
comma
id|DMX_OK
)paren
suffix:semicolon
id|pes_start
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|av7110_write_to_decoder
r_int
id|av7110_write_to_decoder
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|feed
comma
r_const
id|u8
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_struct
id|dvb_demux
op_star
id|demux
op_assign
id|feed-&gt;demux
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|demux-&gt;priv
suffix:semicolon
r_struct
id|ipack
op_star
id|ipack
op_assign
op_amp
id|av7110-&gt;ipack
(braket
id|feed-&gt;pes_type
)braket
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|feed-&gt;pes_type
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;audiostate.stream_source
op_eq
id|AUDIO_SOURCE_MEMORY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;videostate.stream_source
op_eq
id|VIDEO_SOURCE_MEMORY
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
(braket
l_int|3
)braket
op_amp
l_int|0x10
)paren
)paren
multiline_comment|/* no payload? */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|1
)braket
op_amp
l_int|0x40
)paren
id|av7110_ipack_flush
c_func
(paren
id|ipack
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|3
)braket
op_amp
l_int|0x20
)paren
(brace
multiline_comment|/* adaptation field? */
id|len
op_sub_assign
id|buf
(braket
l_int|4
)braket
op_plus
l_int|1
suffix:semicolon
id|buf
op_add_assign
id|buf
(braket
l_int|4
)braket
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|av7110_ipack_instant_repack
c_func
(paren
id|buf
op_plus
l_int|4
comma
id|len
op_minus
l_int|4
comma
op_amp
id|av7110-&gt;ipack
(braket
id|feed-&gt;pes_type
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * Video MPEG decoder events&n; ******************************************************************************/
DECL|function|dvb_video_add_event
r_void
id|dvb_video_add_event
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_struct
id|video_event
op_star
id|event
)paren
(brace
r_struct
id|dvb_video_events
op_star
id|events
op_assign
op_amp
id|av7110-&gt;video_events
suffix:semicolon
r_int
id|wp
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|events-&gt;lock
)paren
suffix:semicolon
id|wp
op_assign
(paren
id|events-&gt;eventw
op_plus
l_int|1
)paren
op_mod
id|MAX_VIDEO_EVENT
suffix:semicolon
r_if
c_cond
(paren
id|wp
op_eq
id|events-&gt;eventr
)paren
(brace
id|events-&gt;overflow
op_assign
l_int|1
suffix:semicolon
id|events-&gt;eventr
op_assign
(paren
id|events-&gt;eventr
op_plus
l_int|1
)paren
op_mod
id|MAX_VIDEO_EVENT
suffix:semicolon
)brace
singleline_comment|//FIXME: timestamp?
id|memcpy
c_func
(paren
op_amp
id|events-&gt;events
(braket
id|events-&gt;eventw
)braket
comma
id|event
comma
r_sizeof
(paren
r_struct
id|video_event
)paren
)paren
suffix:semicolon
id|events-&gt;eventw
op_assign
id|wp
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|events-&gt;lock
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|events-&gt;wait_queue
)paren
suffix:semicolon
)brace
DECL|function|dvb_video_get_event
r_static
r_int
id|dvb_video_get_event
(paren
r_struct
id|av7110
op_star
id|av7110
comma
r_struct
id|video_event
op_star
id|event
comma
r_int
id|flags
)paren
(brace
r_struct
id|dvb_video_events
op_star
id|events
op_assign
op_amp
id|av7110-&gt;video_events
suffix:semicolon
id|DEB_D
c_func
(paren
(paren
l_string|&quot;&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|events-&gt;overflow
)paren
(brace
id|events-&gt;overflow
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EOVERFLOW
suffix:semicolon
)brace
r_if
c_cond
(paren
id|events-&gt;eventw
op_eq
id|events-&gt;eventr
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_NONBLOCK
)paren
r_return
op_minus
id|EWOULDBLOCK
suffix:semicolon
id|ret
op_assign
id|wait_event_interruptible
c_func
(paren
id|events-&gt;wait_queue
comma
id|events-&gt;eventw
op_ne
id|events-&gt;eventr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|events-&gt;lock
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|event
comma
op_amp
id|events-&gt;events
(braket
id|events-&gt;eventr
)braket
comma
r_sizeof
(paren
r_struct
id|video_event
)paren
)paren
suffix:semicolon
id|events-&gt;eventr
op_assign
(paren
id|events-&gt;eventr
op_plus
l_int|1
)paren
op_mod
id|MAX_VIDEO_EVENT
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|events-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * DVB device file operations&n; ******************************************************************************/
DECL|function|dvb_video_poll
r_static
r_int
r_int
id|dvb_video_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|av7110-&gt;avout.queue
comma
id|wait
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|av7110-&gt;video_events.wait_queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;video_events.eventw
op_ne
id|av7110-&gt;video_events.eventr
)paren
id|mask
op_assign
id|POLLPRI
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
(brace
r_if
c_cond
(paren
id|av7110-&gt;playing
)paren
(brace
r_if
c_cond
(paren
id|FREE_COND
)paren
id|mask
op_or_assign
(paren
id|POLLOUT
op_or
id|POLLWRNORM
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* if not playing: may play if asked for */
id|mask
op_or_assign
(paren
id|POLLOUT
op_or
id|POLLWRNORM
)paren
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
DECL|function|dvb_video_write
r_static
id|ssize_t
id|dvb_video_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;videostate.stream_source
op_ne
id|VIDEO_SOURCE_MEMORY
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_return
id|dvb_play
c_func
(paren
id|av7110
comma
id|buf
comma
id|count
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|dvb_audio_poll
r_static
r_int
r_int
id|dvb_audio_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|av7110-&gt;aout.queue
comma
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
)paren
(brace
r_if
c_cond
(paren
id|dvb_ringbuffer_free
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
op_ge
l_int|20
op_star
l_int|1024
)paren
id|mask
op_or_assign
(paren
id|POLLOUT
op_or
id|POLLWRNORM
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* if not playing: may play if asked for */
id|mask
op_assign
(paren
id|POLLOUT
op_or
id|POLLWRNORM
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|dvb_audio_write
r_static
id|ssize_t
id|dvb_audio_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;audiostate.stream_source
op_ne
id|AUDIO_SOURCE_MEMORY
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;not audio source memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_return
id|dvb_aplay
c_func
(paren
id|av7110
comma
id|buf
comma
id|count
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|iframe_header
id|u8
id|iframe_header
(braket
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0xe0
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|macro|MIN_IFRAME
mdefine_line|#define MIN_IFRAME 400000
DECL|function|play_iframe
r_static
r_int
id|play_iframe
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
comma
id|u8
op_star
id|buf
comma
r_int
r_int
id|len
comma
r_int
id|nonblock
)paren
(brace
r_int
id|i
comma
id|n
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|av7110-&gt;playing
op_amp
id|RP_VIDEO
)paren
)paren
(brace
r_if
c_cond
(paren
id|av7110_av_start_play
c_func
(paren
id|av7110
comma
id|RP_VIDEO
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* setting n always &gt; 1, fixes problems when playing stillframes&n;&t;   consisting of I- and P-Frames */
id|n
op_assign
id|MIN_IFRAME
op_div
id|len
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* FIXME: nonblock? */
id|dvb_play
c_func
(paren
id|av7110
comma
id|iframe_header
comma
r_sizeof
(paren
id|iframe_header
)paren
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
id|dvb_play
c_func
(paren
id|av7110
comma
id|buf
comma
id|len
comma
l_int|0
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|av7110_ipack_flush
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_video_ioctl
r_static
r_int
id|dvb_video_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|parg
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
r_int
id|arg
op_assign
(paren
r_int
r_int
)paren
id|parg
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
(brace
r_if
c_cond
(paren
id|cmd
op_ne
id|VIDEO_GET_STATUS
op_logical_and
id|cmd
op_ne
id|VIDEO_GET_EVENT
op_logical_and
id|cmd
op_ne
id|VIDEO_GET_SIZE
)paren
(brace
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDEO_STOP
suffix:colon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_STOPPED
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;videostate.stream_source
op_eq
id|VIDEO_SOURCE_MEMORY
)paren
id|av7110_av_stop
c_func
(paren
id|av7110
comma
id|RP_VIDEO
)paren
suffix:semicolon
r_else
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000e
comma
id|av7110-&gt;videostate.video_blank
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
id|av7110-&gt;trickmode
op_assign
id|TRICK_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_PLAY
suffix:colon
id|av7110-&gt;trickmode
op_assign
id|TRICK_NONE
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;videostate.play_state
op_eq
id|VIDEO_FREEZED
)paren
(brace
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_PLAYING
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000d
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|av7110-&gt;videostate.stream_source
op_eq
id|VIDEO_SOURCE_MEMORY
)paren
(brace
r_if
c_cond
(paren
id|av7110-&gt;playing
op_eq
id|RP_AV
)paren
(brace
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Stop
comma
l_int|0
)paren
suffix:semicolon
id|av7110-&gt;playing
op_and_assign
op_complement
id|RP_VIDEO
suffix:semicolon
)brace
id|av7110_av_start_play
c_func
(paren
id|av7110
comma
id|RP_VIDEO
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000d
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|//av7110_av_stop(av7110, RP_VIDEO);
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000d
comma
l_int|0
)paren
suffix:semicolon
)brace
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_PLAYING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_FREEZE
suffix:colon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_FREEZED
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_amp
id|RP_VIDEO
)paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Pause
comma
l_int|0
)paren
suffix:semicolon
r_else
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x0102
comma
l_int|1
)paren
suffix:semicolon
id|av7110-&gt;trickmode
op_assign
id|TRICK_FREEZE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_CONTINUE
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_amp
id|RP_VIDEO
)paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Continue
comma
l_int|0
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000d
comma
l_int|0
)paren
suffix:semicolon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_PLAYING
suffix:semicolon
id|av7110-&gt;trickmode
op_assign
id|TRICK_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_SELECT_SOURCE
suffix:colon
id|av7110-&gt;videostate.stream_source
op_assign
(paren
id|video_stream_source_t
)paren
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_SET_BLANK
suffix:colon
id|av7110-&gt;videostate.video_blank
op_assign
(paren
r_int
)paren
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_GET_STATUS
suffix:colon
id|memcpy
c_func
(paren
id|parg
comma
op_amp
id|av7110-&gt;videostate
comma
r_sizeof
(paren
r_struct
id|video_status
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_GET_EVENT
suffix:colon
id|ret
op_assign
id|dvb_video_get_event
c_func
(paren
id|av7110
comma
id|parg
comma
id|file-&gt;f_flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_GET_SIZE
suffix:colon
id|memcpy
c_func
(paren
id|parg
comma
op_amp
id|av7110-&gt;video_size
comma
r_sizeof
(paren
id|video_size_t
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_SET_DISPLAY_FORMAT
suffix:colon
(brace
id|video_displayformat_t
id|format
op_assign
(paren
id|video_displayformat_t
)paren
id|arg
suffix:semicolon
id|u16
id|val
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|VIDEO_PAN_SCAN
suffix:colon
id|val
op_assign
id|VID_PAN_SCAN_PREF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_LETTER_BOX
suffix:colon
id|val
op_assign
id|VID_VC_AND_PS_PREF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_CENTER_CUT_OUT
suffix:colon
id|val
op_assign
id|VID_CENTRE_CUT_PREF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_break
suffix:semicolon
id|av7110-&gt;videostate.video_format
op_assign
id|format
suffix:semicolon
id|ret
op_assign
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_ENCODER
comma
id|SetPanScanType
comma
l_int|1
comma
(paren
id|u16
)paren
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDEO_SET_FORMAT
suffix:colon
r_if
c_cond
(paren
id|arg
OG
l_int|1
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|av7110-&gt;display_ar
op_assign
id|arg
suffix:semicolon
id|ret
op_assign
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_ENCODER
comma
id|SetMonitorType
comma
l_int|1
comma
(paren
id|u16
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_STILLPICTURE
suffix:colon
(brace
r_struct
id|video_still_picture
op_star
id|pic
op_assign
(paren
r_struct
id|video_still_picture
op_star
)paren
id|parg
suffix:semicolon
id|av7110-&gt;videostate.stream_source
op_assign
id|VIDEO_SOURCE_MEMORY
suffix:semicolon
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;avout
)paren
suffix:semicolon
id|ret
op_assign
id|play_iframe
c_func
(paren
id|av7110
comma
id|pic-&gt;iFrame
comma
id|pic-&gt;size
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|VIDEO_FAST_FORWARD
suffix:colon
singleline_comment|//note: arg is ignored by firmware
r_if
c_cond
(paren
id|av7110-&gt;playing
op_amp
id|RP_VIDEO
)paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Scan_I
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_else
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x16
comma
id|arg
)paren
suffix:semicolon
id|av7110-&gt;trickmode
op_assign
id|TRICK_FAST
suffix:semicolon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_PLAYING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_SLOWMOTION
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_amp
id|RP_VIDEO
)paren
(brace
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Slow
comma
l_int|2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x22
comma
id|arg
)paren
suffix:semicolon
)brace
r_else
(brace
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x0d
comma
l_int|0
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x0e
comma
l_int|0
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x22
comma
id|arg
)paren
suffix:semicolon
)brace
id|av7110-&gt;trickmode
op_assign
id|TRICK_SLOW
suffix:semicolon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_PLAYING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_GET_CAPABILITIES
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|parg
op_assign
id|VIDEO_CAP_MPEG1
op_or
id|VIDEO_CAP_MPEG2
op_or
id|VIDEO_CAP_SYS
op_or
id|VIDEO_CAP_PROG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO_CLEAR_BUFFER
suffix:colon
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;avout
)paren
suffix:semicolon
id|av7110_ipack_reset
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_eq
id|RP_AV
)paren
(brace
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;trickmode
op_eq
id|TRICK_FAST
)paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Scan_I
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;trickmode
op_eq
id|TRICK_SLOW
)paren
(brace
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Slow
comma
l_int|2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x22
comma
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|av7110-&gt;trickmode
op_eq
id|TRICK_FREEZE
)paren
id|vidcom
c_func
(paren
id|av7110
comma
l_int|0x000e
comma
l_int|1
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|VIDEO_SET_STREAMTYPE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_audio_ioctl
r_static
r_int
id|dvb_audio_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|parg
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
r_int
id|arg
op_assign
(paren
r_int
r_int
)paren
id|parg
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
op_logical_and
(paren
id|cmd
op_ne
id|AUDIO_GET_STATUS
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|AUDIO_STOP
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;audiostate.stream_source
op_eq
id|AUDIO_SOURCE_MEMORY
)paren
id|av7110_av_stop
c_func
(paren
id|av7110
comma
id|RP_AUDIO
)paren
suffix:semicolon
r_else
id|audcom
c_func
(paren
id|av7110
comma
l_int|1
)paren
suffix:semicolon
id|av7110-&gt;audiostate.play_state
op_assign
id|AUDIO_STOPPED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_PLAY
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;audiostate.stream_source
op_eq
id|AUDIO_SOURCE_MEMORY
)paren
id|av7110_av_start_play
c_func
(paren
id|av7110
comma
id|RP_AUDIO
)paren
suffix:semicolon
id|audcom
c_func
(paren
id|av7110
comma
l_int|2
)paren
suffix:semicolon
id|av7110-&gt;audiostate.play_state
op_assign
id|AUDIO_PLAYING
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_PAUSE
suffix:colon
id|audcom
c_func
(paren
id|av7110
comma
l_int|1
)paren
suffix:semicolon
id|av7110-&gt;audiostate.play_state
op_assign
id|AUDIO_PAUSED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_CONTINUE
suffix:colon
r_if
c_cond
(paren
id|av7110-&gt;audiostate.play_state
op_eq
id|AUDIO_PAUSED
)paren
(brace
id|av7110-&gt;audiostate.play_state
op_assign
id|AUDIO_PLAYING
suffix:semicolon
id|audcom
c_func
(paren
id|av7110
comma
l_int|0x12
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AUDIO_SELECT_SOURCE
suffix:colon
id|av7110-&gt;audiostate.stream_source
op_assign
(paren
id|audio_stream_source_t
)paren
id|arg
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_SET_MUTE
suffix:colon
(brace
id|audcom
c_func
(paren
id|av7110
comma
id|arg
ques
c_cond
l_int|1
suffix:colon
l_int|2
)paren
suffix:semicolon
id|av7110-&gt;audiostate.mute_state
op_assign
(paren
r_int
)paren
id|arg
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|AUDIO_SET_AV_SYNC
suffix:colon
id|av7110-&gt;audiostate.AV_sync_state
op_assign
(paren
r_int
)paren
id|arg
suffix:semicolon
id|audcom
c_func
(paren
id|av7110
comma
id|arg
ques
c_cond
l_int|0x0f
suffix:colon
l_int|0x0e
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_SET_BYPASS_MODE
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_CHANNEL_SELECT
suffix:colon
id|av7110-&gt;audiostate.channel_select
op_assign
(paren
id|audio_channel_select_t
)paren
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|av7110-&gt;audiostate.channel_select
)paren
(brace
r_case
id|AUDIO_STEREO
suffix:colon
id|audcom
c_func
(paren
id|av7110
comma
l_int|0x80
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_MONO_LEFT
suffix:colon
id|audcom
c_func
(paren
id|av7110
comma
l_int|0x100
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_MONO_RIGHT
suffix:colon
id|audcom
c_func
(paren
id|av7110
comma
l_int|0x200
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AUDIO_GET_STATUS
suffix:colon
id|memcpy
c_func
(paren
id|parg
comma
op_amp
id|av7110-&gt;audiostate
comma
r_sizeof
(paren
r_struct
id|audio_status
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_GET_CAPABILITIES
suffix:colon
op_star
(paren
r_int
op_star
)paren
id|parg
op_assign
id|AUDIO_CAP_LPCM
op_or
id|AUDIO_CAP_MP1
op_or
id|AUDIO_CAP_MP2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_CLEAR_BUFFER
suffix:colon
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
suffix:semicolon
id|av7110_ipack_reset
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|av7110-&gt;playing
op_eq
id|RP_AV
)paren
id|av7110_fw_cmd
c_func
(paren
id|av7110
comma
id|COMTYPE_REC_PLAY
comma
id|__Play
comma
l_int|2
comma
id|AV_PES
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUDIO_SET_ID
suffix:colon
r_break
suffix:semicolon
r_case
id|AUDIO_SET_MIXER
suffix:colon
(brace
r_struct
id|audio_mixer
op_star
id|amix
op_assign
(paren
r_struct
id|audio_mixer
op_star
)paren
id|parg
suffix:semicolon
id|av7110_set_volume
c_func
(paren
id|av7110
comma
id|amix-&gt;volume_left
comma
id|amix-&gt;volume_right
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|AUDIO_SET_STREAMTYPE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dvb_video_open
r_static
r_int
id|dvb_video_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|dvb_generic_open
c_func
(paren
id|inode
comma
id|file
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
(brace
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
suffix:semicolon
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;avout
)paren
suffix:semicolon
id|av7110-&gt;video_blank
op_assign
l_int|1
suffix:semicolon
id|av7110-&gt;audiostate.AV_sync_state
op_assign
l_int|1
suffix:semicolon
id|av7110-&gt;videostate.stream_source
op_assign
id|VIDEO_SOURCE_DEMUX
suffix:semicolon
multiline_comment|/*  empty event queue */
id|av7110-&gt;video_events.eventr
op_assign
id|av7110-&gt;video_events.eventw
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_video_release
r_static
r_int
id|dvb_video_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_ne
id|O_RDONLY
)paren
(brace
id|av7110_av_stop
c_func
(paren
id|av7110
comma
id|RP_VIDEO
)paren
suffix:semicolon
)brace
r_return
id|dvb_generic_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|function|dvb_audio_open
r_static
r_int
id|dvb_audio_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
id|dvb_generic_open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|dvb_ringbuffer_flush_spinlock_wakeup
c_func
(paren
op_amp
id|av7110-&gt;aout
)paren
suffix:semicolon
id|av7110-&gt;audiostate.stream_source
op_assign
id|AUDIO_SOURCE_DEMUX
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_audio_release
r_static
r_int
id|dvb_audio_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|dvb_device
op_star
id|dvbdev
op_assign
(paren
r_struct
id|dvb_device
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|av7110
op_star
id|av7110
op_assign
(paren
r_struct
id|av7110
op_star
)paren
id|dvbdev-&gt;priv
suffix:semicolon
id|DEB_EE
c_func
(paren
(paren
l_string|&quot;av7110: %p&bslash;n&quot;
comma
id|av7110
)paren
)paren
suffix:semicolon
id|av7110_av_stop
c_func
(paren
id|av7110
comma
id|RP_AUDIO
)paren
suffix:semicolon
r_return
id|dvb_generic_release
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; * driver registration&n; ******************************************************************************/
DECL|variable|dvb_video_fops
r_static
r_struct
id|file_operations
id|dvb_video_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|write
op_assign
id|dvb_video_write
comma
dot
id|ioctl
op_assign
id|dvb_generic_ioctl
comma
dot
id|open
op_assign
id|dvb_video_open
comma
dot
id|release
op_assign
id|dvb_video_release
comma
dot
id|poll
op_assign
id|dvb_video_poll
comma
)brace
suffix:semicolon
DECL|variable|dvbdev_video
r_static
r_struct
id|dvb_device
id|dvbdev_video
op_assign
(brace
dot
id|priv
op_assign
l_int|0
comma
dot
id|users
op_assign
l_int|6
comma
dot
id|readers
op_assign
l_int|5
comma
multiline_comment|/* arbitrary */
dot
id|writers
op_assign
l_int|1
comma
dot
id|fops
op_assign
op_amp
id|dvb_video_fops
comma
dot
id|kernel_ioctl
op_assign
id|dvb_video_ioctl
comma
)brace
suffix:semicolon
DECL|variable|dvb_audio_fops
r_static
r_struct
id|file_operations
id|dvb_audio_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|write
op_assign
id|dvb_audio_write
comma
dot
id|ioctl
op_assign
id|dvb_generic_ioctl
comma
dot
id|open
op_assign
id|dvb_audio_open
comma
dot
id|release
op_assign
id|dvb_audio_release
comma
dot
id|poll
op_assign
id|dvb_audio_poll
comma
)brace
suffix:semicolon
DECL|variable|dvbdev_audio
r_static
r_struct
id|dvb_device
id|dvbdev_audio
op_assign
(brace
dot
id|priv
op_assign
l_int|0
comma
dot
id|users
op_assign
l_int|1
comma
dot
id|writers
op_assign
l_int|1
comma
dot
id|fops
op_assign
op_amp
id|dvb_audio_fops
comma
dot
id|kernel_ioctl
op_assign
id|dvb_audio_ioctl
comma
)brace
suffix:semicolon
DECL|function|av7110_av_register
r_int
id|av7110_av_register
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|av7110-&gt;audiostate.AV_sync_state
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;audiostate.mute_state
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;audiostate.play_state
op_assign
id|AUDIO_STOPPED
suffix:semicolon
id|av7110-&gt;audiostate.stream_source
op_assign
id|AUDIO_SOURCE_DEMUX
suffix:semicolon
id|av7110-&gt;audiostate.channel_select
op_assign
id|AUDIO_STEREO
suffix:semicolon
id|av7110-&gt;audiostate.bypass_mode
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;videostate.video_blank
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;videostate.play_state
op_assign
id|VIDEO_STOPPED
suffix:semicolon
id|av7110-&gt;videostate.stream_source
op_assign
id|VIDEO_SOURCE_DEMUX
suffix:semicolon
id|av7110-&gt;videostate.video_format
op_assign
id|VIDEO_FORMAT_4_3
suffix:semicolon
id|av7110-&gt;videostate.display_format
op_assign
id|VIDEO_CENTER_CUT_OUT
suffix:semicolon
id|av7110-&gt;display_ar
op_assign
id|VIDEO_FORMAT_4_3
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|av7110-&gt;video_events.wait_queue
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|av7110-&gt;video_events.lock
)paren
suffix:semicolon
id|av7110-&gt;video_events.eventw
op_assign
id|av7110-&gt;video_events.eventr
op_assign
l_int|0
suffix:semicolon
id|av7110-&gt;video_events.overflow
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|av7110-&gt;video_size
comma
l_int|0
comma
r_sizeof
(paren
id|video_size_t
)paren
)paren
suffix:semicolon
id|dvb_register_device
c_func
(paren
id|av7110-&gt;dvb_adapter
comma
op_amp
id|av7110-&gt;video_dev
comma
op_amp
id|dvbdev_video
comma
id|av7110
comma
id|DVB_DEVICE_VIDEO
)paren
suffix:semicolon
id|dvb_register_device
c_func
(paren
id|av7110-&gt;dvb_adapter
comma
op_amp
id|av7110-&gt;audio_dev
comma
op_amp
id|dvbdev_audio
comma
id|av7110
comma
id|DVB_DEVICE_AUDIO
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_av_unregister
r_void
id|av7110_av_unregister
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|dvb_unregister_device
c_func
(paren
id|av7110-&gt;audio_dev
)paren
suffix:semicolon
id|dvb_unregister_device
c_func
(paren
id|av7110-&gt;video_dev
)paren
suffix:semicolon
)brace
DECL|function|av7110_av_init
r_int
id|av7110_av_init
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|av7110-&gt;vidmode
op_assign
id|VIDEO_MODE_PAL
suffix:semicolon
id|av7110_ipack_init
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|0
)braket
comma
id|IPACKS
comma
id|play_audio_cb
)paren
suffix:semicolon
id|av7110-&gt;ipack
(braket
l_int|0
)braket
dot
id|data
op_assign
(paren
r_void
op_star
)paren
id|av7110
suffix:semicolon
id|av7110_ipack_init
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|1
)braket
comma
id|IPACKS
comma
id|play_video_cb
)paren
suffix:semicolon
id|av7110-&gt;ipack
(braket
l_int|1
)braket
dot
id|data
op_assign
(paren
r_void
op_star
)paren
id|av7110
suffix:semicolon
id|dvb_ringbuffer_init
c_func
(paren
op_amp
id|av7110-&gt;avout
comma
id|av7110-&gt;iobuf
comma
id|AVOUTLEN
)paren
suffix:semicolon
id|dvb_ringbuffer_init
c_func
(paren
op_amp
id|av7110-&gt;aout
comma
id|av7110-&gt;iobuf
op_plus
id|AVOUTLEN
comma
id|AOUTLEN
)paren
suffix:semicolon
id|av7110-&gt;kbuf
(braket
l_int|0
)braket
op_assign
(paren
id|u8
op_star
)paren
(paren
id|av7110-&gt;iobuf
op_plus
id|AVOUTLEN
op_plus
id|AOUTLEN
op_plus
id|BMPLEN
)paren
suffix:semicolon
id|av7110-&gt;kbuf
(braket
l_int|1
)braket
op_assign
id|av7110-&gt;kbuf
(braket
l_int|0
)braket
op_plus
l_int|2
op_star
id|IPACKS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|av7110_av_exit
r_int
id|av7110_av_exit
c_func
(paren
r_struct
id|av7110
op_star
id|av7110
)paren
(brace
id|av7110_ipack_free
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|av7110_ipack_free
c_func
(paren
op_amp
id|av7110-&gt;ipack
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
