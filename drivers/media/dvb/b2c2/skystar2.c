multiline_comment|/*&n; * skystar2.c - driver for the Technisat SkyStar2 PCI DVB card&n; *              based on the FlexCopII by B2C2,Inc.&n; *&n; * Copyright (C) 2003  Vadim Catana, skystar@moldova.cc&n; *&n; * FIX: DISEQC Tone Burst in flexcop_diseqc_ioctl()&n; * FIX: FULL soft DiSEqC for skystar2 (FlexCopII rev 130) VP310 equipped &n; *     Vincenzo Di Massa, hawk.it at tiscalinet.it&n; * &t;&n; * Converted to Linux coding style&n; * Misc reorganization, polishing, restyling&n; *     Roberto Ragusa, r.ragusa at libero.it&n; *       &n; * Added hardware filtering support, &n; *     Niklas Peinecke, peinecke at gdv.uni-hannover.de&n; *&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU Lesser General Public License&n; * as published by the Free Software Foundation; either version 2.1&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU Lesser General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;dvb_i2c.h&quot;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &lt;linux/dvb/frontend.h&gt;
macro_line|#include &lt;linux/dvb/dmx.h&gt;
macro_line|#include &quot;dvb_demux.h&quot;
macro_line|#include &quot;dmxdev.h&quot;
macro_line|#include &quot;dvb_filter.h&quot;
macro_line|#include &quot;dvbdev.h&quot;
macro_line|#include &quot;demux.h&quot;
macro_line|#include &quot;dvb_net.h&quot;
macro_line|#include &quot;dvb_functions.h&quot;
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(x...)&t;do { if (debug&gt;=1) printk(x); } while (0)
DECL|macro|ddprintk
mdefine_line|#define ddprintk(x...)&t;do { if (debug&gt;=2) printk(x); } while (0)
DECL|variable|enable_hw_filters
r_static
r_int
id|enable_hw_filters
op_assign
l_int|2
suffix:semicolon
DECL|macro|SIZE_OF_BUF_DMA1
mdefine_line|#define SIZE_OF_BUF_DMA1&t;0x3ac00
DECL|macro|SIZE_OF_BUF_DMA2
mdefine_line|#define SIZE_OF_BUF_DMA2&t;0x758
DECL|macro|MAX_N_HW_FILTERS
mdefine_line|#define MAX_N_HW_FILTERS&t;(6+32)
DECL|macro|N_PID_SLOTS
mdefine_line|#define N_PID_SLOTS&t;&t;256
DECL|struct|dmaq
r_struct
id|dmaq
(brace
DECL|member|bus_addr
id|u32
id|bus_addr
suffix:semicolon
DECL|member|head
id|u32
id|head
suffix:semicolon
DECL|member|tail
id|u32
id|tail
suffix:semicolon
DECL|member|buffer_size
id|u32
id|buffer_size
suffix:semicolon
DECL|member|buffer
id|u8
op_star
id|buffer
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|adapter
r_struct
id|adapter
(brace
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|card_revision
id|u8
id|card_revision
suffix:semicolon
DECL|member|b2c2_revision
id|u32
id|b2c2_revision
suffix:semicolon
DECL|member|pid_filter_max
id|u32
id|pid_filter_max
suffix:semicolon
DECL|member|mac_filter_max
id|u32
id|mac_filter_max
suffix:semicolon
DECL|member|irq
id|u32
id|irq
suffix:semicolon
DECL|member|io_mem
r_int
r_int
id|io_mem
suffix:semicolon
DECL|member|io_port
r_int
r_int
id|io_port
suffix:semicolon
DECL|member|mac_addr
id|u8
id|mac_addr
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|dw_sram_type
id|u32
id|dw_sram_type
suffix:semicolon
DECL|member|dvb_adapter
r_struct
id|dvb_adapter
op_star
id|dvb_adapter
suffix:semicolon
DECL|member|demux
r_struct
id|dvb_demux
id|demux
suffix:semicolon
DECL|member|dmxdev
r_struct
id|dmxdev
id|dmxdev
suffix:semicolon
DECL|member|hw_frontend
r_struct
id|dmx_frontend
id|hw_frontend
suffix:semicolon
DECL|member|mem_frontend
r_struct
id|dmx_frontend
id|mem_frontend
suffix:semicolon
DECL|member|i2c_bus
r_struct
id|dvb_i2c_bus
op_star
id|i2c_bus
suffix:semicolon
DECL|member|dvbnet
r_struct
id|dvb_net
id|dvbnet
suffix:semicolon
DECL|member|i2c_sem
r_struct
id|semaphore
id|i2c_sem
suffix:semicolon
DECL|member|dmaq1
r_struct
id|dmaq
id|dmaq1
suffix:semicolon
DECL|member|dmaq2
r_struct
id|dmaq
id|dmaq2
suffix:semicolon
DECL|member|dma_ctrl
id|u32
id|dma_ctrl
suffix:semicolon
DECL|member|dma_status
id|u32
id|dma_status
suffix:semicolon
DECL|member|capturing
r_int
id|capturing
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|useable_hw_filters
r_int
id|useable_hw_filters
suffix:semicolon
DECL|member|hw_pids
id|u16
id|hw_pids
(braket
id|MAX_N_HW_FILTERS
)braket
suffix:semicolon
DECL|member|pid_list
id|u16
id|pid_list
(braket
id|N_PID_SLOTS
)braket
suffix:semicolon
DECL|member|pid_rc
r_int
id|pid_rc
(braket
id|N_PID_SLOTS
)braket
suffix:semicolon
singleline_comment|// ref counters for the pids
DECL|member|pid_count
r_int
id|pid_count
suffix:semicolon
DECL|member|whole_bandwidth_count
r_int
id|whole_bandwidth_count
suffix:semicolon
DECL|member|mac_filter
id|u32
id|mac_filter
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|write_reg_dw
mdefine_line|#define write_reg_dw(adapter,reg,value) writel(value, adapter-&gt;io_mem + reg)
DECL|macro|read_reg_dw
mdefine_line|#define read_reg_dw(adapter,reg) readl(adapter-&gt;io_mem + reg)
DECL|function|write_reg_bitfield
r_static
r_void
id|write_reg_bitfield
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|reg
comma
id|u32
id|zeromask
comma
id|u32
id|orvalue
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
id|reg
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|tmp
op_amp
op_complement
id|zeromask
)paren
op_or
id|orvalue
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
id|reg
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* i2c functions */
DECL|function|i2c_main_write_for_flex2
r_static
r_int
id|i2c_main_write_for_flex2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|command
comma
id|u8
op_star
id|buf
comma
r_int
id|retries
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x100
comma
l_int|0
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x100
comma
id|command
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|retries
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x100
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x40000000
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x81000000
)paren
op_eq
l_int|0x80000000
)paren
(brace
r_if
c_cond
(paren
id|buf
op_ne
l_int|0
)paren
op_star
id|buf
op_assign
(paren
id|value
op_rshift
l_int|0x10
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x100
comma
l_int|0
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x100
comma
id|command
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* device = 0x10000000 for tuner, 0x20000000 for eeprom */
DECL|function|i2c_main_setup
r_static
r_void
id|i2c_main_setup
c_func
(paren
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u8
id|op
comma
id|u8
id|addr
comma
id|u32
id|value
comma
id|u32
id|len
comma
id|u32
op_star
id|command
)paren
(brace
op_star
id|command
op_assign
id|device
op_or
(paren
(paren
id|len
op_minus
l_int|1
)paren
op_lshift
l_int|26
)paren
op_or
(paren
id|value
op_lshift
l_int|16
)paren
op_or
(paren
id|addr
op_lshift
l_int|8
)paren
op_or
id|chip_addr
suffix:semicolon
r_if
c_cond
(paren
id|op
op_ne
l_int|0
)paren
op_star
id|command
op_assign
op_star
id|command
op_or
l_int|0x03000000
suffix:semicolon
r_else
op_star
id|command
op_assign
op_star
id|command
op_or
l_int|0x01000000
suffix:semicolon
)brace
DECL|function|flex_i2c_read4
r_static
r_int
id|flex_i2c_read4
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u16
id|addr
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
id|u32
id|command
suffix:semicolon
id|u32
id|value
suffix:semicolon
r_int
id|result
comma
id|i
suffix:semicolon
id|i2c_main_setup
c_func
(paren
id|device
comma
id|chip_addr
comma
l_int|1
comma
id|addr
comma
l_int|0
comma
id|len
comma
op_amp
id|command
)paren
suffix:semicolon
id|result
op_assign
id|i2c_main_write_for_flex2
c_func
(paren
id|adapter
comma
id|command
comma
id|buf
comma
l_int|100000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_amp
l_int|0xff
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|len
OG
l_int|1
)paren
(brace
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x104
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
(braket
id|i
)braket
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|value
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
)brace
)brace
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|flex_i2c_write4
r_static
r_int
id|flex_i2c_write4
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
id|u32
id|command
suffix:semicolon
id|u32
id|value
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|1
)paren
(brace
id|value
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|value
op_assign
id|value
op_lshift
l_int|8
suffix:semicolon
id|value
op_assign
id|value
op_or
id|buf
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x104
comma
id|value
)paren
suffix:semicolon
)brace
id|i2c_main_setup
c_func
(paren
id|device
comma
id|chip_addr
comma
l_int|0
comma
id|addr
comma
id|buf
(braket
l_int|0
)braket
comma
id|len
comma
op_amp
id|command
)paren
suffix:semicolon
r_return
id|i2c_main_write_for_flex2
c_func
(paren
id|adapter
comma
id|command
comma
l_int|NULL
comma
l_int|100000
)paren
suffix:semicolon
)brace
DECL|function|fixchipaddr
r_static
r_void
id|fixchipaddr
c_func
(paren
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u32
op_star
id|ret
)paren
(brace
r_if
c_cond
(paren
id|device
op_eq
l_int|0x20000000
)paren
op_star
id|ret
op_assign
id|bus
op_or
(paren
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|3
)paren
suffix:semicolon
op_star
id|ret
op_assign
id|bus
suffix:semicolon
)brace
DECL|function|flex_i2c_read
r_static
id|u32
id|flex_i2c_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|chipaddr
suffix:semicolon
id|u32
id|bytes_to_transfer
suffix:semicolon
id|u8
op_star
id|start
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|start
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|bytes_to_transfer
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|bytes_to_transfer
OG
l_int|4
)paren
id|bytes_to_transfer
op_assign
l_int|4
suffix:semicolon
id|fixchipaddr
c_func
(paren
id|device
comma
id|bus
comma
id|addr
comma
op_amp
id|chipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flex_i2c_read4
c_func
(paren
id|adapter
comma
id|device
comma
id|chipaddr
comma
id|addr
comma
id|buf
comma
id|bytes_to_transfer
)paren
op_eq
l_int|0
)paren
r_return
id|buf
op_minus
id|start
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|bytes_to_transfer
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|bytes_to_transfer
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|bytes_to_transfer
suffix:semicolon
)brace
suffix:semicolon
r_return
id|buf
op_minus
id|start
suffix:semicolon
)brace
DECL|function|flex_i2c_write
r_static
id|u32
id|flex_i2c_write
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|chipaddr
suffix:semicolon
id|u32
id|bytes_to_transfer
suffix:semicolon
id|u8
op_star
id|start
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|start
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|bytes_to_transfer
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|bytes_to_transfer
OG
l_int|4
)paren
id|bytes_to_transfer
op_assign
l_int|4
suffix:semicolon
id|fixchipaddr
c_func
(paren
id|device
comma
id|bus
comma
id|addr
comma
op_amp
id|chipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flex_i2c_write4
c_func
(paren
id|adapter
comma
id|device
comma
id|chipaddr
comma
id|addr
comma
id|buf
comma
id|bytes_to_transfer
)paren
op_eq
l_int|0
)paren
r_return
id|buf
op_minus
id|start
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|bytes_to_transfer
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|bytes_to_transfer
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|bytes_to_transfer
suffix:semicolon
)brace
r_return
id|buf
op_minus
id|start
suffix:semicolon
)brace
DECL|function|master_xfer
r_static
r_int
id|master_xfer
c_func
(paren
r_struct
id|dvb_i2c_bus
op_star
id|i2c
comma
r_const
r_struct
id|i2c_msg
op_star
id|msgs
comma
r_int
id|num
)paren
(brace
r_struct
id|adapter
op_star
id|tmp
op_assign
id|i2c-&gt;data
suffix:semicolon
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: %d messages to transfer&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|num
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ddprintk
c_func
(paren
l_string|&quot;message %d: flags=0x%x, addr=0x%x, buf=0x%x, len=%d &bslash;n&quot;
comma
id|i
comma
id|msgs
(braket
id|i
)braket
dot
id|flags
comma
id|msgs
(braket
id|i
)braket
dot
id|addr
comma
id|msgs
(braket
id|i
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
multiline_comment|/* allow only the mt312 and stv0299 frontends to access the bus */
r_if
c_cond
(paren
(paren
id|msgs
(braket
id|i
)braket
dot
id|addr
op_ne
l_int|0x0e
)paren
op_logical_and
(paren
id|msgs
(braket
id|i
)braket
dot
id|addr
op_ne
l_int|0x68
)paren
op_logical_and
(paren
id|msgs
(braket
id|i
)braket
dot
id|addr
op_ne
l_int|0x61
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
suffix:semicolon
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
)brace
)brace
singleline_comment|// read command
r_if
c_cond
(paren
(paren
id|num
op_eq
l_int|2
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|flags
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|1
)braket
dot
id|flags
op_eq
id|I2C_M_RD
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|buf
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|1
)braket
dot
id|buf
op_ne
l_int|NULL
)paren
)paren
(brace
id|ret
op_assign
id|flex_i2c_read
c_func
(paren
id|tmp
comma
l_int|0x10000000
comma
id|msgs
(braket
l_int|0
)braket
dot
id|addr
comma
id|msgs
(braket
l_int|0
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
l_int|1
)braket
dot
id|buf
comma
id|msgs
(braket
l_int|1
)braket
dot
id|len
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|msgs
(braket
l_int|1
)braket
dot
id|len
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: read error !&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;message %d: flags=0x%x, addr=0x%x, buf=0x%x, len=%d &bslash;n&quot;
comma
id|i
comma
id|msgs
(braket
id|i
)braket
dot
id|flags
comma
id|msgs
(braket
id|i
)braket
dot
id|addr
comma
id|msgs
(braket
id|i
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
)brace
r_return
id|num
suffix:semicolon
)brace
singleline_comment|// write command
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|msgs
(braket
id|i
)braket
dot
id|flags
op_ne
l_int|0
)paren
op_logical_or
(paren
id|msgs
(braket
id|i
)braket
dot
id|buf
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|msgs
(braket
id|i
)braket
dot
id|len
OL
l_int|2
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ret
op_assign
id|flex_i2c_write
c_func
(paren
id|tmp
comma
l_int|0x10000000
comma
id|msgs
(braket
id|i
)braket
dot
id|addr
comma
id|msgs
(braket
id|i
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
op_amp
id|msgs
(braket
id|i
)braket
dot
id|buf
(braket
l_int|1
)braket
comma
id|msgs
(braket
id|i
)braket
dot
id|len
op_minus
l_int|1
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|msgs
(braket
l_int|0
)braket
dot
id|len
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: write error %i !&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ret
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;message %d: flags=0x%x, addr=0x%x, buf[0]=0x%x, len=%d &bslash;n&quot;
comma
id|i
comma
id|msgs
(braket
id|i
)braket
dot
id|flags
comma
id|msgs
(braket
id|i
)braket
dot
id|addr
comma
id|msgs
(braket
id|i
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
)brace
r_return
id|num
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: unknown command format !&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* SRAM (Skystar2 rev2.3 has one &quot;ISSI IS61LV256&quot; chip on board,&n;   but it seems that FlexCopII can work with more than one chip) */
DECL|function|sram_set_net_dest
r_static
r_void
id|sram_set_net_dest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xfffffffc
)paren
op_or
(paren
id|dest
op_amp
l_int|3
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|sram_set_cai_dest
r_static
r_void
id|sram_set_cai_dest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xfffffff3
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|sram_set_cao_dest
r_static
r_void
id|sram_set_cao_dest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xffffffcf
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|sram_set_media_dest
r_static
r_void
id|sram_set_media_dest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xffffff3f
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
multiline_comment|/* SRAM memory is accessed through a buffer register in the FlexCop&n;   chip (0x700). This register has the following structure:&n;    bits 0-14  : address&n;    bit  15    : read/write flag&n;    bits 16-23 : 8-bit word to write&n;    bits 24-27 : = 4&n;    bits 28-29 : memory bank selector&n;    bit  31    : busy flag&n;*/
DECL|function|flex_sram_write
r_static
r_void
id|flex_sram_write
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|bank
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
r_int
id|i
comma
id|retries
suffix:semicolon
id|u32
id|command
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|command
op_assign
id|bank
op_or
id|addr
op_or
l_int|0x04000000
op_or
(paren
op_star
id|buf
op_lshift
l_int|0x10
)paren
suffix:semicolon
id|retries
op_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
comma
id|command
)paren
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|addr
op_increment
suffix:semicolon
)brace
)brace
DECL|function|flex_sram_read
r_static
r_void
id|flex_sram_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|bank
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
r_int
id|i
comma
id|retries
suffix:semicolon
id|u32
id|command
comma
id|value
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|command
op_assign
id|bank
op_or
id|addr
op_or
l_int|0x04008000
suffix:semicolon
id|retries
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
comma
id|command
)paren
suffix:semicolon
id|retries
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_rshift
l_int|0x10
suffix:semicolon
op_star
id|buf
op_assign
(paren
id|value
op_amp
l_int|0xff
)paren
suffix:semicolon
id|addr
op_increment
suffix:semicolon
id|buf
op_increment
suffix:semicolon
)brace
)brace
DECL|function|sram_write_chunk
r_static
r_void
id|sram_write_chunk
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
id|u32
id|bank
suffix:semicolon
id|bank
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x20000
)paren
(brace
id|bank
op_assign
(paren
id|addr
op_amp
l_int|0x18000
)paren
op_lshift
l_int|0x0d
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x00000
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_eq
l_int|0
)paren
id|bank
op_assign
l_int|0x20000000
suffix:semicolon
r_else
id|bank
op_assign
l_int|0x10000000
suffix:semicolon
)brace
id|flex_sram_write
c_func
(paren
id|adapter
comma
id|bank
comma
id|addr
op_amp
l_int|0x7fff
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sram_read_chunk
r_static
r_void
id|sram_read_chunk
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
id|u32
id|bank
suffix:semicolon
id|bank
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x20000
)paren
(brace
id|bank
op_assign
(paren
id|addr
op_amp
l_int|0x18000
)paren
op_lshift
l_int|0x0d
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x00000
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_eq
l_int|0
)paren
id|bank
op_assign
l_int|0x20000000
suffix:semicolon
r_else
id|bank
op_assign
l_int|0x10000000
suffix:semicolon
)brace
id|flex_sram_read
c_func
(paren
id|adapter
comma
id|bank
comma
id|addr
op_amp
l_int|0x7fff
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|sram_read
r_static
r_void
id|sram_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|length
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|length
op_assign
id|len
suffix:semicolon
singleline_comment|// check if the address range belongs to the same 
singleline_comment|// 32K memory chip. If not, the data is read from 
singleline_comment|// one chip at a time.
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_ne
(paren
(paren
id|addr
op_plus
id|len
op_minus
l_int|1
)paren
op_rshift
l_int|0x0f
)paren
)paren
(brace
id|length
op_assign
(paren
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|0x0f
)paren
op_minus
id|addr
suffix:semicolon
)brace
id|sram_read_chunk
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|length
)paren
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|length
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|length
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|length
suffix:semicolon
)brace
)brace
DECL|function|sram_write
r_static
r_void
id|sram_write
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|length
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|length
op_assign
id|len
suffix:semicolon
singleline_comment|// check if the address range belongs to the same 
singleline_comment|// 32K memory chip. If not, the data is written to
singleline_comment|// one chip at a time.
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_ne
(paren
(paren
id|addr
op_plus
id|len
op_minus
l_int|1
)paren
op_rshift
l_int|0x0f
)paren
)paren
(brace
id|length
op_assign
(paren
(paren
(paren
id|addr
op_rshift
l_int|0x0f
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|0x0f
)paren
op_minus
id|addr
suffix:semicolon
)brace
id|sram_write_chunk
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|length
)paren
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|length
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|length
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|length
suffix:semicolon
)brace
)brace
DECL|function|sram_set_size
r_static
r_void
id|sram_set_size
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|mask
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
comma
(paren
id|mask
op_or
(paren
op_complement
l_int|0x30000
op_amp
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
)paren
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|sram_init
r_static
r_void
id|sram_init
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
)paren
op_ne
l_int|0
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
comma
id|tmp
)paren
suffix:semicolon
id|adapter-&gt;dw_sram_type
op_assign
id|tmp
op_amp
l_int|0x30000
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: dw_sram_type = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dw_sram_type
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dw_sram_type
op_assign
l_int|0x10000
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: dw_sram_type = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dw_sram_type
)paren
suffix:semicolon
)brace
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return adapter-&gt;dw_sram_type; */
)brace
DECL|function|sram_test_location
r_static
r_int
id|sram_test_location
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|mask
comma
id|u32
id|addr
)paren
(brace
id|u8
id|tmp1
comma
id|tmp2
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: mask = %x, addr = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|mask
comma
id|addr
)paren
suffix:semicolon
id|sram_set_size
c_func
(paren
id|adapter
comma
id|mask
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0xa5
suffix:semicolon
id|tmp1
op_assign
l_int|0x4f
suffix:semicolon
id|sram_write
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|sram_write
c_func
(paren
id|adapter
comma
id|addr
op_plus
l_int|4
comma
op_amp
id|tmp1
comma
l_int|1
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|sram_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|sram_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: wrote 0xa5, read 0x%2x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp2
op_ne
l_int|0xa5
)paren
r_return
l_int|0
suffix:semicolon
id|tmp2
op_assign
l_int|0x5a
suffix:semicolon
id|tmp1
op_assign
l_int|0xf4
suffix:semicolon
id|sram_write
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|sram_write
c_func
(paren
id|adapter
comma
id|addr
op_plus
l_int|4
comma
op_amp
id|tmp1
comma
l_int|1
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|sram_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|sram_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: wrote 0x5a, read 0x%2x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp2
op_ne
l_int|0x5a
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|sram_length
r_static
id|u32
id|sram_length
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x10000
)paren
r_return
l_int|32768
suffix:semicolon
singleline_comment|//  32K
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x00000
)paren
r_return
l_int|65536
suffix:semicolon
singleline_comment|//  64K        
r_if
c_cond
(paren
id|adapter-&gt;dw_sram_type
op_eq
l_int|0x20000
)paren
r_return
l_int|131072
suffix:semicolon
singleline_comment|// 128K
r_return
l_int|32768
suffix:semicolon
singleline_comment|// 32K
)brace
multiline_comment|/* FlexcopII can work with 32K, 64K or 128K of external SRAM memory.&n;    - for 128K there are 4x32K chips at bank 0,1,2,3.&n;    - for  64K there are 2x32K chips at bank 1,2.&n;    - for  32K there is one 32K chip at bank 0.&n;&n;   FlexCop works only with one bank at a time. The bank is selected&n;   by bits 28-29 of the 0x700 register.&n;  &n;   bank 0 covers addresses 0x00000-0x07fff&n;   bank 1 covers addresses 0x08000-0x0ffff&n;   bank 2 covers addresses 0x10000-0x17fff&n;   bank 3 covers addresses 0x18000-0x1ffff&n;*/
DECL|function|sram_detect_for_flex2
r_static
r_int
id|sram_detect_for_flex2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|u32
id|tmp
comma
id|tmp2
comma
id|tmp3
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|tmp
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0
)paren
suffix:semicolon
id|tmp2
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: tmp2 = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
comma
l_int|1
)paren
suffix:semicolon
id|tmp3
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: tmp3 = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp3
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x71c
comma
id|tmp2
)paren
suffix:semicolon
singleline_comment|// check for internal SRAM ???
id|tmp3
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|tmp3
op_ne
l_int|0
)paren
(brace
id|sram_set_size
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 32K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sram_test_location
c_func
(paren
id|adapter
comma
l_int|0x20000
comma
l_int|0x18000
)paren
op_ne
l_int|0
)paren
(brace
id|sram_set_size
c_func
(paren
id|adapter
comma
l_int|0x20000
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 128K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|128
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sram_test_location
c_func
(paren
id|adapter
comma
l_int|0x00000
comma
l_int|0x10000
)paren
op_ne
l_int|0
)paren
(brace
id|sram_set_size
c_func
(paren
id|adapter
comma
l_int|0x00000
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 64K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|64
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sram_test_location
c_func
(paren
id|adapter
comma
l_int|0x10000
comma
l_int|0x00000
)paren
op_ne
l_int|0
)paren
(brace
id|sram_set_size
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 32K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|32
suffix:semicolon
)brace
id|sram_set_size
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|sram_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: SRAM detection failed. Set to 32K &bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sll_detect_sram_size
r_static
r_void
id|sll_detect_sram_size
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|sram_detect_for_flex2
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
multiline_comment|/* EEPROM (Skystar2 has one &quot;24LC08B&quot; chip on board) */
multiline_comment|/*&n;static int eeprom_write(struct adapter *adapter, u16 addr, u8 *buf, u16 len)&n;{&n;&t;return flex_i2c_write(adapter, 0x20000000, 0x50, addr, buf, len);&n;}&n;*/
DECL|function|eeprom_read
r_static
r_int
id|eeprom_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
r_return
id|flex_i2c_read
c_func
(paren
id|adapter
comma
l_int|0x20000000
comma
l_int|0x50
comma
id|addr
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|calc_lrc
id|u8
id|calc_lrc
c_func
(paren
id|u8
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|sum
suffix:semicolon
id|sum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|sum
op_assign
id|sum
op_xor
id|buf
(braket
id|i
)braket
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
DECL|function|eeprom_lrc_read
r_static
r_int
id|eeprom_lrc_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u32
id|len
comma
id|u8
op_star
id|buf
comma
r_int
id|retries
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|retries
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|eeprom_read
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|len
)paren
op_eq
id|len
)paren
(brace
r_if
c_cond
(paren
id|calc_lrc
c_func
(paren
id|buf
comma
id|len
op_minus
l_int|1
)paren
op_eq
id|buf
(braket
id|len
op_minus
l_int|1
)braket
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;static int eeprom_lrc_write(struct adapter *adapter, u32 addr, u32 len, u8 *wbuf, u8 *rbuf, int retries)&n;{&n;&t;int i;&n;&n;&t;for (i = 0; i &lt; retries; i++) {&n;&t;&t;if (eeprom_write(adapter, addr, wbuf, len) == len) {&n;&t;&t;&t;if (eeprom_lrc_read(adapter, addr, len, rbuf, retries) == 1)&n;&t;&t;&t;&t;return 1;&n;&t;&t;}&n;&t;}&n;&n;&t;return 0;&n;}&n;*/
multiline_comment|/* These functions could be used to unlock SkyStar2 cards. */
multiline_comment|/*&n;static int eeprom_writeKey(struct adapter *adapter, u8 *key, u32 len)&n;{&n;&t;u8 rbuf[20];&n;&t;u8 wbuf[20];&n;&n;&t;if (len != 16)&n;&t;&t;return 0;&n;&n;&t;memcpy(wbuf, key, len);&n;&n;&t;wbuf[16] = 0;&n;&t;wbuf[17] = 0;&n;&t;wbuf[18] = 0;&n;&t;wbuf[19] = calc_lrc(wbuf, 19);&n;&n;&t;return eeprom_lrc_write(adapter, 0x3e4, 20, wbuf, rbuf, 4);&n;}&n;&n;static int eeprom_readKey(struct adapter *adapter, u8 *key, u32 len)&n;{&n;&t;u8 buf[20];&n;&n;&t;if (len != 16)&n;&t;&t;return 0;&n;&n;&t;if (eeprom_lrc_read(adapter, 0x3e4, 20, buf, 4) == 0)&n;&t;&t;return 0;&n;&n;&t;memcpy(key, buf, len);&n;&n;&t;return 1;&n;}&n;*/
DECL|function|eeprom_get_mac_addr
r_static
r_int
id|eeprom_get_mac_addr
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_char
id|type
comma
id|u8
op_star
id|mac
)paren
(brace
id|u8
id|tmp
(braket
l_int|8
)braket
suffix:semicolon
r_if
c_cond
(paren
id|eeprom_lrc_read
c_func
(paren
id|adapter
comma
l_int|0x3f8
comma
l_int|8
comma
id|tmp
comma
l_int|4
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|type
op_ne
l_int|0
)paren
(brace
id|mac
(braket
l_int|0
)braket
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mac
(braket
l_int|2
)braket
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|3
)braket
op_assign
l_int|0xfe
suffix:semicolon
id|mac
(braket
l_int|4
)braket
op_assign
l_int|0xff
suffix:semicolon
id|mac
(braket
l_int|5
)braket
op_assign
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|mac
(braket
l_int|6
)braket
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|mac
(braket
l_int|7
)braket
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
)brace
r_else
(brace
id|mac
(braket
l_int|0
)braket
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mac
(braket
l_int|2
)braket
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|3
)braket
op_assign
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|mac
(braket
l_int|4
)braket
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|mac
(braket
l_int|5
)braket
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|type
op_eq
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|mac
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|mac
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;static char eeprom_set_mac_addr(struct adapter *adapter, char type, u8 *mac)&n;{&n;&t;u8 tmp[8];&n;&n;&t;if (type != 0) {&n;&t;&t;tmp[0] = mac[0];&n;&t;&t;tmp[1] = mac[1];&n;&t;&t;tmp[2] = mac[2];&n;&t;&t;tmp[3] = mac[5];&n;&t;&t;tmp[4] = mac[6];&n;&t;&t;tmp[5] = mac[7];&n;&n;&t;} else {&n;&n;&t;&t;tmp[0] = mac[0];&n;&t;&t;tmp[1] = mac[1];&n;&t;&t;tmp[2] = mac[2];&n;&t;&t;tmp[3] = mac[3];&n;&t;&t;tmp[4] = mac[4];&n;&t;&t;tmp[5] = mac[5];&n;&t;}&n;&n;&t;tmp[6] = 0;&n;&t;tmp[7] = calc_lrc(tmp, 7);&n;&n;&t;if (eeprom_write(adapter, 0x3f8, tmp, 8) == 8)&n;&t;&t;return 1;&n;&n;&t;return 0;&n;}&n;*/
multiline_comment|/* PID filter */
multiline_comment|/* every flexcop has 6 &quot;lower&quot; hw PID filters     */
multiline_comment|/* these are enabled by setting bits 0-5 of 0x208 */
multiline_comment|/* for the 32 additional filters we have to select one */
multiline_comment|/* of them through 0x310 and modify through 0x314 */
multiline_comment|/* op: 0=disable, 1=enable */
DECL|function|filter_enable_hw_filter
r_static
r_void
id|filter_enable_hw_filter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
id|id
comma
id|u8
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: id=%d op=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|id
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_le
l_int|5
)paren
(brace
id|u32
id|mask
op_assign
(paren
l_int|0x00000001
op_lshift
id|id
)paren
suffix:semicolon
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|mask
comma
id|op
ques
c_cond
id|mask
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* select */
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x310
comma
l_int|0x1f
comma
(paren
id|id
op_minus
l_int|6
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
multiline_comment|/* modify */
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x314
comma
l_int|0x00006000
comma
id|op
ques
c_cond
l_int|0x00004000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* this sets the PID that should pass the specified filter */
DECL|function|pid_set_hw_pid
r_static
r_void
id|pid_set_hw_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
id|id
comma
id|u16
id|pid
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: id=%d  pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|id
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_le
l_int|5
)paren
(brace
id|u32
id|adr
op_assign
l_int|0x300
op_plus
(paren
(paren
id|id
op_amp
l_int|6
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|id
op_amp
l_int|1
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: id=%d  addr=%x %c  pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|id
comma
id|adr
comma
(paren
id|id
op_amp
l_int|1
)paren
ques
c_cond
l_char|&squot;h&squot;
suffix:colon
l_char|&squot;l&squot;
comma
id|pid
)paren
suffix:semicolon
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
id|adr
comma
(paren
l_int|0x7fff
)paren
op_lshift
id|shift
comma
(paren
id|pid
op_amp
l_int|0x1fff
)paren
op_lshift
id|shift
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* select */
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x310
comma
l_int|0x1f
comma
(paren
id|id
op_minus
l_int|6
)paren
op_amp
l_int|0x1f
)paren
suffix:semicolon
multiline_comment|/* modify */
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x314
comma
l_int|0x1fff
comma
id|pid
op_amp
l_int|0x1fff
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;static void filter_enable_null_filter(struct adapter *adapter, u32 op)&n;{&n;&t;dprintk(&quot;%s: op=%x&bslash;n&quot;, __FUNCTION__, op);&n;&n;&t;write_reg_bitfield(adapter, 0x208, 0x00000040, op?0x00000040:0);&n;}&n;*/
DECL|function|filter_enable_mask_filter
r_static
r_void
id|filter_enable_mask_filter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x00000080
comma
id|op
ques
c_cond
l_int|0x00000080
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ctrl_enable_mac
r_static
r_void
id|ctrl_enable_mac
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x00004000
comma
id|op
ques
c_cond
l_int|0x00004000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|ca_set_mac_dst_addr_filter
r_static
r_int
id|ca_set_mac_dst_addr_filter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
op_star
id|mac
)paren
(brace
id|u32
id|tmp1
comma
id|tmp2
suffix:semicolon
id|tmp1
op_assign
(paren
id|mac
(braket
l_int|3
)braket
op_lshift
l_int|0x18
)paren
op_or
(paren
id|mac
(braket
l_int|2
)braket
op_lshift
l_int|0x10
)paren
op_or
(paren
id|mac
(braket
l_int|1
)braket
op_lshift
l_int|0x08
)paren
op_or
id|mac
(braket
l_int|0
)braket
suffix:semicolon
id|tmp2
op_assign
(paren
id|mac
(braket
l_int|5
)braket
op_lshift
l_int|0x08
)paren
op_or
id|mac
(braket
l_int|4
)braket
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x418
comma
id|tmp1
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x41c
comma
id|tmp2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;static void set_ignore_mac_filter(struct adapter *adapter, u8 op)&n;{&n;&t;if (op != 0) {&n;&t;&t;write_reg_bitfield(adapter, 0x208, 0x00004000, 0);&n;&t;&t;adapter-&gt;mac_filter = 1;&n;&t;} else {&n;&t;&t;if (adapter-&gt;mac_filter != 0) {&n;&t;&t;&t;adapter-&gt;mac_filter = 0;&n;&t;&t;&t;write_reg_bitfield(adapter, 0x208, 0x00004000, 0x00004000);&n;&t;&t;}&n;&t;}&n;}&n;*/
multiline_comment|/*&n;static void check_null_filter_enable(struct adapter *adapter)&n;{&n;&t;filter_enable_null_filter(adapter, 1);&n;&t;filter_enable_mask_filter(adapter, 1);&n;}&n;*/
DECL|function|pid_set_group_pid
r_static
r_void
id|pid_set_group_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_amp
l_int|0x3fff
)paren
op_or
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x30c
)paren
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x30c
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|pid_set_group_mask
r_static
r_void
id|pid_set_group_mask
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
id|pid
op_amp
l_int|0x3fff
)paren
op_lshift
l_int|0x10
)paren
op_or
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x30c
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x30c
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;static int pid_get_group_pid(struct adapter *adapter)&n;{&n;&t;return read_reg_dw(adapter, 0x30c) &amp; 0x00001fff;&n;}&n;&n;static int pid_get_group_mask(struct adapter *adapter)&n;{&n;&t;return (read_reg_dw(adapter, 0x30c) &gt;&gt; 0x10)&amp; 0x00001fff;&n;}&n;*/
multiline_comment|/*&n;static void reset_hardware_pid_filter(struct adapter *adapter)&n;{&n;&t;pid_set_stream1_pid(adapter, 0x1fff);&n;&n;&t;pid_set_stream2_pid(adapter, 0x1fff);&n;&t;filter_enable_stream2_filter(adapter, 0);&n;&n;&t;pid_set_pcr_pid(adapter, 0x1fff);&n;&t;filter_enable_pcr_filter(adapter, 0);&n;&n;&t;pid_set_pmt_pid(adapter, 0x1fff);&n;&t;filter_enable_pmt_filter(adapter, 0);&n;&n;&t;pid_set_ecm_pid(adapter, 0x1fff);&n;&t;filter_enable_ecm_filter(adapter, 0);&n;&n;&t;pid_set_emm_pid(adapter, 0x1fff);&n;&t;filter_enable_emm_filter(adapter, 0);&n;}&n;*/
DECL|function|init_pids
r_static
r_void
id|init_pids
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_int
id|i
suffix:semicolon
id|adapter-&gt;pid_count
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;whole_bandwidth_count
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapter-&gt;useable_hw_filters
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: setting filter %d to 0x1fff&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|i
)paren
suffix:semicolon
id|adapter-&gt;hw_pids
(braket
id|i
)braket
op_assign
l_int|0x1fff
suffix:semicolon
id|pid_set_hw_pid
c_func
(paren
id|adapter
comma
id|i
comma
l_int|0x1fff
)paren
suffix:semicolon
)brace
id|pid_set_group_pid
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|pid_set_group_mask
c_func
(paren
id|adapter
comma
l_int|0x1fe0
)paren
suffix:semicolon
)brace
DECL|function|open_whole_bandwidth
r_static
r_void
id|open_whole_bandwidth
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|pid_set_group_pid
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|pid_set_group_mask
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;filter_enable_mask_filter(adapter, 1);&n;*/
)brace
DECL|function|close_whole_bandwidth
r_static
r_void
id|close_whole_bandwidth
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|pid_set_group_pid
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|pid_set_group_mask
c_func
(paren
id|adapter
comma
l_int|0x1fe0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;filter_enable_mask_filter(adapter, 1);&n;*/
)brace
DECL|function|whole_bandwidth_inc
r_static
r_void
id|whole_bandwidth_inc
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;whole_bandwidth_count
op_increment
op_eq
l_int|0
)paren
id|open_whole_bandwidth
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
DECL|function|whole_bandwidth_dec
r_static
r_void
id|whole_bandwidth_dec
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|adapter-&gt;whole_bandwidth_count
op_le
l_int|0
)paren
id|close_whole_bandwidth
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
multiline_comment|/* The specified PID has to be let through the&n;   hw filters.&n;   We try to allocate an hardware filter and open whole&n;   bandwidth when allocation is impossible.&n;   All pids&lt;=0x1f pass through the group filter.&n;   Returns 1 on success, -1 on error */
DECL|function|add_hw_pid
r_static
r_int
id|add_hw_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_le
l_int|0x1f
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* we can&squot;t use a filter for 0x2000, so no search */
r_if
c_cond
(paren
id|pid
op_ne
l_int|0x2000
)paren
(brace
multiline_comment|/* find an unused hardware filter */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapter-&gt;useable_hw_filters
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d searching slot=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;hw_pids
(braket
id|i
)braket
op_eq
l_int|0x1fff
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d slot=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
comma
id|i
)paren
suffix:semicolon
id|adapter-&gt;hw_pids
(braket
id|i
)braket
op_assign
id|pid
suffix:semicolon
id|pid_set_hw_pid
c_func
(paren
id|adapter
comma
id|i
comma
id|pid
)paren
suffix:semicolon
id|filter_enable_hw_filter
c_func
(paren
id|adapter
comma
id|i
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* if we have not used a filter, this pid depends on whole bandwidth */
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d whole_bandwidth&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|whole_bandwidth_inc
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* returns -1 if the pid was not present in the filters */
DECL|function|remove_hw_pid
r_static
r_int
id|remove_hw_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_le
l_int|0x1f
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* we can&squot;t use a filter for 0x2000, so no search */
r_if
c_cond
(paren
id|pid
op_ne
l_int|0x2000
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapter-&gt;useable_hw_filters
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d searching slot=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;hw_pids
(braket
id|i
)braket
op_eq
id|pid
)paren
(brace
singleline_comment|// find the pid slot
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d slot=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
comma
id|i
)paren
suffix:semicolon
id|adapter-&gt;hw_pids
(braket
id|i
)braket
op_assign
l_int|0x1fff
suffix:semicolon
id|pid_set_hw_pid
c_func
(paren
id|adapter
comma
id|i
comma
l_int|0x1fff
)paren
suffix:semicolon
id|filter_enable_hw_filter
c_func
(paren
id|adapter
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* if we have not used a filter, this pid depended on whole bandwith */
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d whole_bandwidth&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|whole_bandwidth_dec
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Adds a PID to the filters.&n;   Adding a pid more than once is possible, we keep reference counts.&n;   Whole stream available through pid==0x2000.&n;   Returns 1 on success, -1 on error */
DECL|function|add_pid
r_static
r_int
id|add_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0x1ffe
op_logical_and
id|pid
op_ne
l_int|0x2000
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|// check if the pid is already present
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapter-&gt;pid_count
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|adapter-&gt;pid_list
(braket
id|i
)braket
op_eq
id|pid
)paren
(brace
id|adapter-&gt;pid_rc
(braket
id|i
)braket
op_increment
suffix:semicolon
singleline_comment|// increment ref counter
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;pid_count
op_eq
id|N_PID_SLOTS
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|// no more pids can be added
id|adapter-&gt;pid_list
(braket
id|adapter-&gt;pid_count
)braket
op_assign
id|pid
suffix:semicolon
singleline_comment|// register pid
id|adapter-&gt;pid_rc
(braket
id|adapter-&gt;pid_count
)braket
op_assign
l_int|1
suffix:semicolon
id|adapter-&gt;pid_count
op_increment
suffix:semicolon
singleline_comment|// hardware setting
id|add_hw_pid
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Removes a PID from the filters. */
DECL|function|remove_pid
r_static
r_int
id|remove_pid
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0x1ffe
op_logical_and
id|pid
op_ne
l_int|0x2000
)paren
r_return
op_minus
l_int|1
suffix:semicolon
singleline_comment|// check if the pid is present (it must be!)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|adapter-&gt;pid_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;pid_list
(braket
id|i
)braket
op_eq
id|pid
)paren
(brace
id|adapter-&gt;pid_rc
(braket
id|i
)braket
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;pid_rc
(braket
id|i
)braket
op_le
l_int|0
)paren
(brace
singleline_comment|// remove from the list
id|adapter-&gt;pid_count
op_decrement
suffix:semicolon
id|adapter-&gt;pid_list
(braket
id|i
)braket
op_assign
id|adapter-&gt;pid_list
(braket
id|adapter-&gt;pid_count
)braket
suffix:semicolon
id|adapter-&gt;pid_rc
(braket
id|i
)braket
op_assign
id|adapter-&gt;pid_rc
(braket
id|adapter-&gt;pid_count
)braket
suffix:semicolon
singleline_comment|// hardware setting
id|remove_hw_pid
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* dma &amp; irq */
DECL|function|ctrl_enable_smc
r_static
r_void
id|ctrl_enable_smc
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x00000800
comma
id|op
ques
c_cond
l_int|0x00000800
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|dma_enable_disable_irq
r_static
r_void
id|dma_enable_disable_irq
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|flag1
comma
id|u32
id|flag2
comma
id|u32
id|flag3
)paren
(brace
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
l_int|0x000f0000
suffix:semicolon
r_if
c_cond
(paren
id|flag1
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|flag2
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00010000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00010000
suffix:semicolon
r_if
c_cond
(paren
id|flag3
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00020000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00020000
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|flag2
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00040000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00040000
suffix:semicolon
r_if
c_cond
(paren
id|flag3
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00080000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00080000
suffix:semicolon
)brace
)brace
DECL|function|irq_dma_enable_disable_irq
r_static
r_void
id|irq_dma_enable_disable_irq
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|u32
id|value
suffix:semicolon
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
op_amp
l_int|0xfff0ffff
suffix:semicolon
r_if
c_cond
(paren
id|op
op_ne
l_int|0
)paren
id|value
op_assign
id|value
op_or
(paren
id|adapter-&gt;dma_ctrl
op_amp
l_int|0x000f0000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/* FlexCopII has 2 dma channels. DMA1 is used to transfer TS data to&n;   system memory.&n;&n;   The DMA1 buffer is divided in 2 subbuffers of equal size.&n;   FlexCopII will transfer TS data to one subbuffer, signal an interrupt&n;   when the subbuffer is full and continue fillig the second subbuffer.&n;&n;   For DMA1:&n;       subbuffer size in 32-bit words is stored in the first 24 bits of&n;       register 0x004. The last 8 bits of register 0x004 contain the number&n;       of subbuffers.&n;       &n;       the first 30 bits of register 0x000 contain the address of the first&n;       subbuffer. The last 2 bits contain 0, when dma1 is disabled and 1,&n;       when dma1 is enabled.&n;&n;       the first 30 bits of register 0x00c contain the address of the second&n;       subbuffer. the last 2 bits contain 1.&n;&n;       register 0x008 will contain the address of the subbuffer that was filled&n;       with TS data, when FlexCopII will generate an interrupt.&n;&n;   For DMA2:&n;       subbuffer size in 32-bit words is stored in the first 24 bits of&n;       register 0x014. The last 8 bits of register 0x014 contain the number&n;       of subbuffers.&n;       &n;       the first 30 bits of register 0x010 contain the address of the first&n;       subbuffer.  The last 2 bits contain 0, when dma1 is disabled and 1,&n;       when dma1 is enabled.&n;&n;       the first 30 bits of register 0x01c contain the address of the second&n;       subbuffer. the last 2 bits contain 1.&n;&n;       register 0x018 contains the address of the subbuffer that was filled&n;       with TS data, when FlexCopII generates an interrupt.&n;*/
DECL|function|dma_init_dma
r_static
r_int
id|dma_init_dma
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|dma_channel
)paren
(brace
id|u32
id|subbuffers
comma
id|subbufsize
comma
id|subbuf0
comma
id|subbuf1
suffix:semicolon
r_if
c_cond
(paren
id|dma_channel
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: Initializing DMA1 channel&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|subbuffers
op_assign
l_int|2
suffix:semicolon
id|subbufsize
op_assign
(paren
(paren
(paren
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_div
l_int|4
)paren
op_lshift
l_int|8
)paren
op_or
id|subbuffers
suffix:semicolon
id|subbuf0
op_assign
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xfffffffc
suffix:semicolon
id|subbuf1
op_assign
(paren
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_amp
l_int|0xfffffffc
)paren
op_or
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: first subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|subbuf0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: subbuffer size = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
id|subbufsize
op_rshift
l_int|8
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x004
comma
id|subbufsize
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: second subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x00c
comma
id|subbuf1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: counter = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xfffffffc
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x008
comma
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xfffffffc
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|subbuffers
op_eq
l_int|0
)paren
id|dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_else
id|dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|0
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|irq_dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|sram_set_media_dest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|sram_set_net_dest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|sram_set_cai_dest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|sram_set_cao_dest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_channel
op_eq
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: Initializing DMA2 channel&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|subbuffers
op_assign
l_int|2
suffix:semicolon
id|subbufsize
op_assign
(paren
(paren
(paren
id|adapter-&gt;dmaq2.buffer_size
op_div
l_int|2
)paren
op_div
l_int|4
)paren
op_lshift
l_int|8
)paren
op_or
id|subbuffers
suffix:semicolon
id|subbuf0
op_assign
id|adapter-&gt;dmaq2.bus_addr
op_amp
l_int|0xfffffffc
suffix:semicolon
id|subbuf1
op_assign
(paren
(paren
id|adapter-&gt;dmaq2.bus_addr
op_plus
id|adapter-&gt;dmaq2.buffer_size
op_div
l_int|2
)paren
op_amp
l_int|0xfffffffc
)paren
op_or
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: first subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|subbuf0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: subbuffer size = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
id|subbufsize
op_rshift
l_int|8
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x014
comma
id|subbufsize
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: second buffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x01c
comma
id|subbuf1
)paren
suffix:semicolon
id|sram_set_cai_dest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ctrl_enable_receive_data
r_static
r_void
id|ctrl_enable_receive_data
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x00008000
comma
l_int|0
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000004
suffix:semicolon
)brace
r_else
(brace
id|write_reg_bitfield
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x00008000
comma
l_int|0x00008000
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x00000004
suffix:semicolon
)brace
)brace
multiline_comment|/* bit 0 of dma_mask is set to 1 if dma1 channel has to be enabled/disabled&n;   bit 1 of dma_mask is set to 1 if dma2 channel has to be enabled/disabled&n;*/
DECL|function|dma_start_stop
r_static
r_void
id|dma_start_stop
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|dma_mask
comma
r_int
id|start_stop
)paren
(brace
id|u32
id|dma_enable
comma
id|dma1_enable
comma
id|dma2_enable
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dma_mask=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dma_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start_stop
op_eq
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: starting dma&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dma1_enable
op_assign
l_int|0
suffix:semicolon
id|dma2_enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq1.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|1
suffix:semicolon
id|dma1_enable
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq2.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|2
suffix:semicolon
id|dma2_enable
op_assign
l_int|1
suffix:semicolon
)brace
singleline_comment|// enable dma1 and dma2
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|1
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|1
)paren
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x00c
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// enable dma1
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|1
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|0
)paren
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x00c
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// enable dma2
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|1
)paren
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// start dma
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|0
)paren
)paren
(brace
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: stopping dma&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dma_enable
op_assign
id|adapter-&gt;dma_status
op_amp
l_int|0x00000003
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|dma_enable
op_assign
id|dma_enable
op_amp
l_int|0xfffffffe
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|dma_enable
op_assign
id|dma_enable
op_amp
l_int|0xfffffffd
suffix:semicolon
)brace
singleline_comment|//stop dma
r_if
c_cond
(paren
(paren
id|dma_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|4
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|3000
)paren
suffix:semicolon
)brace
singleline_comment|//disable dma1
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq1.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x00c
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000001
suffix:semicolon
)brace
singleline_comment|//disable dma2
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq2.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000002
suffix:semicolon
)brace
)brace
)brace
DECL|function|open_stream
r_static
r_void
id|open_stream
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
id|u32
id|dma_mask
suffix:semicolon
op_increment
id|adapter-&gt;capturing
suffix:semicolon
id|filter_enable_mask_filter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|add_pid
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: adapter-&gt;dma_status=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dma_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|7
)paren
op_ne
l_int|7
)paren
(brace
id|dma_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x10000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|1
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|adapter-&gt;dmaq1.buffer
comma
l_int|0
comma
id|adapter-&gt;dmaq1.buffer_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x20000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|2
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_mask
op_ne
l_int|0
)paren
(brace
id|irq_dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|dma_start_stop
c_func
(paren
id|adapter
comma
id|dma_mask
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|close_stream
r_static
r_void
id|close_stream
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;capturing
OG
l_int|0
)paren
op_decrement
id|adapter-&gt;capturing
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dma_status=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dma_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;capturing
op_eq
l_int|0
)paren
(brace
id|u32
id|dma_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|0x00000001
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|0x00000002
suffix:semicolon
r_if
c_cond
(paren
id|dma_mask
op_ne
l_int|0
)paren
(brace
id|dma_start_stop
c_func
(paren
id|adapter
comma
id|dma_mask
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|remove_pid
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
)brace
DECL|function|interrupt_service_dma1
r_static
r_void
id|interrupt_service_dma1
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
r_int
id|n_cur_dma_counter
suffix:semicolon
id|u32
id|n_num_bytes_parsed
suffix:semicolon
id|u32
id|n_num_new_bytes_transferred
suffix:semicolon
id|u32
id|dw_default_packet_size
op_assign
l_int|188
suffix:semicolon
id|u8
id|gb_tmp_buffer
(braket
l_int|188
)braket
suffix:semicolon
id|u8
op_star
id|pb_dma_buf_cur_pos
suffix:semicolon
id|n_cur_dma_counter
op_assign
id|readl
c_func
(paren
id|adapter-&gt;io_mem
op_plus
l_int|0x008
)paren
op_minus
id|adapter-&gt;dmaq1.bus_addr
suffix:semicolon
id|n_cur_dma_counter
op_assign
(paren
id|n_cur_dma_counter
op_div
id|dw_default_packet_size
)paren
op_star
id|dw_default_packet_size
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n_cur_dma_counter
OL
l_int|0
)paren
op_logical_or
(paren
id|n_cur_dma_counter
OG
id|adapter-&gt;dmaq1.buffer_size
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: dma counter outside dma buffer&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|adapter-&gt;dmaq1.head
op_assign
id|n_cur_dma_counter
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.tail
op_le
id|n_cur_dma_counter
)paren
(brace
id|n_num_new_bytes_transferred
op_assign
id|n_cur_dma_counter
op_minus
id|adapter-&gt;dmaq1.tail
suffix:semicolon
)brace
r_else
(brace
id|n_num_new_bytes_transferred
op_assign
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
op_plus
id|n_cur_dma_counter
suffix:semicolon
)brace
id|ddprintk
c_func
(paren
l_string|&quot;%s: n_cur_dma_counter = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|n_cur_dma_counter
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: dmaq1.tail        = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dmaq1.tail
)paren
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: bytes_transferred = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|n_num_new_bytes_transferred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n_num_new_bytes_transferred
OL
id|dw_default_packet_size
)paren
r_return
suffix:semicolon
id|n_num_bytes_parsed
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|n_num_bytes_parsed
OL
id|n_num_new_bytes_transferred
)paren
(brace
id|pb_dma_buf_cur_pos
op_assign
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.buffer_size
OL
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
op_plus
l_int|188
)paren
(brace
id|memcpy
c_func
(paren
id|gb_tmp_buffer
comma
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
comma
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|gb_tmp_buffer
op_plus
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
comma
id|adapter-&gt;dmaq1.buffer
comma
(paren
l_int|188
op_minus
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
)paren
)paren
suffix:semicolon
id|pb_dma_buf_cur_pos
op_assign
id|gb_tmp_buffer
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;capturing
op_ne
l_int|0
)paren
(brace
id|dvb_dmx_swfilter_packets
c_func
(paren
id|dvbdmx
comma
id|pb_dma_buf_cur_pos
comma
id|dw_default_packet_size
op_div
l_int|188
)paren
suffix:semicolon
)brace
id|n_num_bytes_parsed
op_assign
id|n_num_bytes_parsed
op_plus
id|dw_default_packet_size
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
id|adapter-&gt;dmaq1.tail
op_plus
id|dw_default_packet_size
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.tail
op_ge
id|adapter-&gt;dmaq1.buffer_size
)paren
id|adapter-&gt;dmaq1.tail
op_assign
id|adapter-&gt;dmaq1.tail
op_minus
id|adapter-&gt;dmaq1.buffer_size
suffix:semicolon
)brace
suffix:semicolon
)brace
DECL|function|interrupt_service_dma2
r_static
r_void
id|interrupt_service_dma2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
DECL|function|isr
r_static
id|irqreturn_t
id|isr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|adapter
op_star
id|tmp
op_assign
id|dev_id
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
(paren
(paren
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|tmp
comma
l_int|0x20c
)paren
)paren
op_amp
l_int|0x0f
)paren
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_while
c_loop
(paren
id|value
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x03
)paren
op_ne
l_int|0
)paren
id|interrupt_service_dma1
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x0c
)paren
op_ne
l_int|0
)paren
id|interrupt_service_dma2
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|value
op_assign
id|read_reg_dw
c_func
(paren
id|tmp
comma
l_int|0x20c
)paren
op_amp
l_int|0x0f
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|init_dma_queue
r_static
r_void
id|init_dma_queue
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dma_addr_t
id|dma_addr
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
r_return
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
l_int|NULL
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SIZE_OF_BUF_DMA1
op_plus
l_int|0x80
comma
op_amp
id|dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|adapter-&gt;dmaq1.buffer
comma
l_int|0
comma
id|SIZE_OF_BUF_DMA1
)paren
suffix:semicolon
id|adapter-&gt;dmaq1.bus_addr
op_assign
id|dma_addr
suffix:semicolon
id|adapter-&gt;dmaq1.buffer_size
op_assign
id|SIZE_OF_BUF_DMA1
suffix:semicolon
id|dma_init_dma
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x10000000
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: allocated dma buffer at 0x%p, length=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dmaq1.buffer
comma
id|SIZE_OF_BUF_DMA1
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x10000000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
r_return
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
l_int|NULL
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SIZE_OF_BUF_DMA2
op_plus
l_int|0x80
comma
op_amp
id|dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|adapter-&gt;dmaq2.buffer
comma
l_int|0
comma
id|SIZE_OF_BUF_DMA2
)paren
suffix:semicolon
id|adapter-&gt;dmaq2.bus_addr
op_assign
id|dma_addr
suffix:semicolon
id|adapter-&gt;dmaq2.buffer_size
op_assign
id|SIZE_OF_BUF_DMA2
suffix:semicolon
id|dma_init_dma
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x20000000
suffix:semicolon
id|ddprintk
c_func
(paren
l_string|&quot;%s: allocated dma buffer at 0x%p, length=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dmaq2.buffer
comma
(paren
r_int
)paren
id|SIZE_OF_BUF_DMA2
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x20000000
suffix:semicolon
)brace
)brace
DECL|function|free_dma_queue
r_static
r_void
id|free_dma_queue
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SIZE_OF_BUF_DMA1
op_plus
l_int|0x80
comma
id|adapter-&gt;dmaq1.buffer
comma
id|adapter-&gt;dmaq1.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dmaq1.bus_addr
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer_size
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SIZE_OF_BUF_DMA2
op_plus
l_int|0x80
comma
id|adapter-&gt;dmaq2.buffer
comma
id|adapter-&gt;dmaq2.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dmaq2.bus_addr
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer_size
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|free_adapter_object
r_static
r_void
id|free_adapter_object
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|close_stream
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;irq
op_ne
l_int|0
)paren
id|free_irq
c_func
(paren
id|adapter-&gt;irq
comma
id|adapter
)paren
suffix:semicolon
id|free_dma_queue
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;io_mem
op_ne
l_int|0
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|adapter-&gt;io_mem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter
op_ne
l_int|0
)paren
id|kfree
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
DECL|variable|skystar2_pci_driver
r_static
r_struct
id|pci_driver
id|skystar2_pci_driver
suffix:semicolon
DECL|function|claim_adapter
r_static
r_int
id|claim_adapter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|adapter-&gt;pdev
suffix:semicolon
id|u16
id|var
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|skystar2_pci_driver.name
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|skystar2_pci_driver.name
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|adapter-&gt;card_revision
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: card revision %x &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;card_revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
l_int|4
comma
op_amp
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var
op_amp
l_int|4
)paren
op_eq
l_int|0
)paren
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|adapter-&gt;io_port
op_assign
id|pdev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
id|adapter-&gt;io_mem
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|pdev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
l_int|0x800
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;io_mem
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: can not map io memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;%s: io memory maped at %lx&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;io_mem
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;static int sll_reset_flexcop(struct adapter *adapter)&n;{&n;&t;write_reg_dw(adapter, 0x208, 0);&n;&t;write_reg_dw(adapter, 0x210, 0xb2ff);&n;&n;&t;return 0;&n;}&n;*/
DECL|function|decide_how_many_hw_filters
r_static
r_void
id|decide_how_many_hw_filters
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_int
id|hw_filters
suffix:semicolon
r_int
id|mod_option_hw_filters
suffix:semicolon
singleline_comment|// FlexCop IIb &amp; III have 6+32 hw filters    
singleline_comment|// FlexCop II has 6 hw filters, every other should have at least 6
r_switch
c_cond
(paren
id|adapter-&gt;b2c2_revision
)paren
(brace
r_case
l_int|0x82
suffix:colon
multiline_comment|/* II */
id|hw_filters
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc3
suffix:colon
multiline_comment|/* IIB */
id|hw_filters
op_assign
l_int|6
op_plus
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc0
suffix:colon
multiline_comment|/* III */
id|hw_filters
op_assign
l_int|6
op_plus
l_int|32
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|hw_filters
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: the chip has %i hardware filters&quot;
comma
id|__FILE__
comma
id|hw_filters
)paren
suffix:semicolon
id|mod_option_hw_filters
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|enable_hw_filters
op_ge
l_int|1
)paren
id|mod_option_hw_filters
op_add_assign
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|enable_hw_filters
op_ge
l_int|2
)paren
id|mod_option_hw_filters
op_add_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|mod_option_hw_filters
op_ge
id|hw_filters
)paren
(brace
id|adapter-&gt;useable_hw_filters
op_assign
id|hw_filters
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;useable_hw_filters
op_assign
id|mod_option_hw_filters
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, but only %d will be used because of module option&quot;
comma
id|mod_option_hw_filters
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: useable_hardware_filters set to %i&bslash;n&quot;
comma
id|__FILE__
comma
id|adapter-&gt;useable_hw_filters
)paren
suffix:semicolon
)brace
DECL|function|driver_initialize
r_static
r_int
id|driver_initialize
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|adapter
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: out of memory!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|adapter
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|adapter
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|adapter
)paren
suffix:semicolon
id|adapter-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|adapter-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
(paren
id|claim_adapter
c_func
(paren
id|adapter
)paren
)paren
op_ne
l_int|1
)paren
(brace
id|free_adapter_object
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|irq_dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pdev-&gt;irq
comma
id|isr
comma
l_int|0x4000000
comma
l_string|&quot;Skystar2&quot;
comma
id|adapter
)paren
op_ne
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: unable to allocate irq=%d !&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pdev-&gt;irq
)paren
suffix:semicolon
id|free_adapter_object
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x210
comma
l_int|0xb2ff
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x40
)paren
suffix:semicolon
id|init_dma_queue
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x30000000
)paren
op_eq
l_int|0
)paren
(brace
id|free_adapter_object
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|adapter-&gt;b2c2_revision
op_assign
(paren
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
op_rshift
l_int|0x18
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|adapter-&gt;b2c2_revision
)paren
(brace
r_case
l_int|0x82
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: FlexCopII(rev.130) chip found&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc3
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: FlexCopIIB(rev.195) chip found&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xc0
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: FlexCopIII(rev.192) chip found&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: The revision of the FlexCop chip on your card is %d&bslash;n&quot;
comma
id|__FILE__
comma
id|adapter-&gt;b2c2_revision
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: This driver works only with FlexCopII(rev.130), FlexCopIIB(rev.195) and FlexCopIII(rev.192).&bslash;n&quot;
comma
id|__FILE__
)paren
suffix:semicolon
id|free_adapter_object
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|decide_how_many_hw_filters
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|init_pids
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|tmp
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tmp
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
suffix:semicolon
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x308
comma
l_int|0x4000
op_or
id|tmp
)paren
suffix:semicolon
id|adapter-&gt;dw_sram_type
op_assign
l_int|0x10000
suffix:semicolon
id|sll_detect_sram_size
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s sram length = %d, sram type= %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|sram_length
c_func
(paren
id|adapter
)paren
comma
id|adapter-&gt;dw_sram_type
)paren
suffix:semicolon
id|sram_set_media_dest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|sram_set_net_dest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|ctrl_enable_smc
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|sram_set_cai_dest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|sram_set_cao_dest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eeprom_get_mac_addr
c_func
(paren
id|adapter
comma
l_int|0
comma
id|adapter-&gt;mac_addr
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s MAC address = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;mac_addr
(braket
l_int|0
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|1
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|2
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|3
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|4
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|5
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|6
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|ca_set_mac_dst_addr_filter
c_func
(paren
id|adapter
comma
id|adapter-&gt;mac_addr
)paren
suffix:semicolon
id|ctrl_enable_mac
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
)brace
id|adapter-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|driver_halt
r_static
r_void
id|driver_halt
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
id|adapter
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|irq_dma_enable_disable_irq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|ctrl_enable_receive_data
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|free_adapter_object
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|dvb_start_feed
r_static
r_int
id|dvb_start_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|adapter
op_star
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|dvbdmx-&gt;priv
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: PID=%d, type=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dvbdmxfeed-&gt;pid
comma
id|dvbdmxfeed-&gt;type
)paren
suffix:semicolon
id|open_stream
c_func
(paren
id|adapter
comma
id|dvbdmxfeed-&gt;pid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_stop_feed
r_static
r_int
id|dvb_stop_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|adapter
op_star
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|dvbdmx-&gt;priv
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: PID=%d, type=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dvbdmxfeed-&gt;pid
comma
id|dvbdmxfeed-&gt;type
)paren
suffix:semicolon
id|close_stream
c_func
(paren
id|adapter
comma
id|dvbdmxfeed-&gt;pid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* lnb control */
DECL|function|set_tuner_tone
r_static
r_void
id|set_tuner_tone
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|tone
)paren
(brace
id|u16
id|wz_half_period_for_45_mhz
(braket
)braket
op_assign
(brace
l_int|0x01ff
comma
l_int|0x0154
comma
l_int|0x00ff
comma
l_int|0x00cc
)brace
suffix:semicolon
id|u16
id|ax
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: %u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tone
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tone
)paren
(brace
r_case
l_int|1
suffix:colon
id|ax
op_assign
id|wz_half_period_for_45_mhz
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ax
op_assign
id|wz_half_period_for_45_mhz
(braket
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ax
op_assign
id|wz_half_period_for_45_mhz
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|ax
op_assign
id|wz_half_period_for_45_mhz
(braket
l_int|3
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ax
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ax
op_ne
l_int|0
)paren
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x200
comma
(paren
(paren
id|ax
op_lshift
l_int|0x0f
)paren
op_plus
(paren
id|ax
op_amp
l_int|0x7fff
)paren
)paren
op_or
l_int|0x40000000
)paren
suffix:semicolon
)brace
r_else
(brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x200
comma
l_int|0x40ff8000
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_tuner_polarity
r_static
r_void
id|set_tuner_polarity
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|polarity
)paren
(brace
id|u32
id|var
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s : polarity = %u &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|polarity
)paren
suffix:semicolon
id|var
op_assign
id|read_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LNB power off&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|var
op_assign
id|var
op_or
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|1
)paren
(brace
id|var
op_assign
id|var
op_amp
op_complement
l_int|1
suffix:semicolon
id|var
op_assign
id|var
op_amp
op_complement
l_int|4
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|2
)paren
(brace
id|var
op_assign
id|var
op_amp
op_complement
l_int|1
suffix:semicolon
id|var
op_assign
id|var
op_or
l_int|4
suffix:semicolon
)brace
id|write_reg_dw
c_func
(paren
id|adapter
comma
l_int|0x204
comma
id|var
)paren
suffix:semicolon
)brace
DECL|function|diseqc_send_bit
r_static
r_void
id|diseqc_send_bit
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
id|data
)paren
(brace
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|data
ques
c_cond
l_int|500
suffix:colon
l_int|1000
)paren
suffix:semicolon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|data
ques
c_cond
l_int|1000
suffix:colon
l_int|500
)paren
suffix:semicolon
)brace
DECL|function|diseqc_send_byte
r_static
r_void
id|diseqc_send_byte
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
id|data
)paren
(brace
r_int
id|i
comma
id|par
op_assign
l_int|1
comma
id|d
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|d
op_assign
(paren
id|data
op_rshift
id|i
)paren
op_amp
l_int|1
suffix:semicolon
id|par
op_xor_assign
id|d
suffix:semicolon
id|diseqc_send_bit
c_func
(paren
id|adapter
comma
id|d
)paren
suffix:semicolon
)brace
id|diseqc_send_bit
c_func
(paren
id|adapter
comma
id|par
)paren
suffix:semicolon
)brace
DECL|function|send_diseqc_msg
r_static
r_int
id|send_diseqc_msg
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
id|len
comma
id|u8
op_star
id|msg
comma
r_int
r_int
id|burst
)paren
(brace
r_int
id|i
suffix:semicolon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|16
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|diseqc_send_byte
c_func
(paren
id|adapter
comma
id|msg
(braket
id|i
)braket
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|burst
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|burst
)paren
id|diseqc_send_byte
c_func
(paren
id|adapter
comma
l_int|0xff
)paren
suffix:semicolon
r_else
(brace
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|12500
)paren
suffix:semicolon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
)brace
id|dvb_delay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|soft_diseqc
r_int
id|soft_diseqc
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_SET_TONE
suffix:colon
r_switch
c_cond
(paren
(paren
id|fe_sec_tone_mode_t
)paren
id|arg
)paren
(brace
r_case
id|SEC_TONE_ON
suffix:colon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEC_TONE_OFF
suffix:colon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FE_DISEQC_SEND_MASTER_CMD
suffix:colon
(brace
r_struct
id|dvb_diseqc_master_cmd
op_star
id|cmd
op_assign
id|arg
suffix:semicolon
id|send_diseqc_msg
c_func
(paren
id|adapter
comma
id|cmd-&gt;msg_len
comma
id|cmd-&gt;msg
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FE_DISEQC_SEND_BURST
suffix:colon
id|send_diseqc_msg
c_func
(paren
id|adapter
comma
l_int|0
comma
l_int|NULL
comma
(paren
r_int
r_int
)paren
id|arg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|flexcop_diseqc_ioctl
r_static
r_int
id|flexcop_diseqc_ioctl
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
op_assign
id|fe-&gt;before_after_data
suffix:semicolon
r_struct
id|dvb_frontend_info
id|info
suffix:semicolon
id|fe
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|fe
comma
id|FE_GET_INFO
comma
op_amp
id|info
)paren
suffix:semicolon
singleline_comment|// we must use different DiSEqC hw
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|info.name
comma
l_string|&quot;Zarlink MT312&quot;
)paren
op_eq
l_int|0
)paren
(brace
singleline_comment|//VP310 using mt312 driver for tuning only: diseqc not wired
singleline_comment|//use FCII instead
r_if
c_cond
(paren
op_logical_neg
id|soft_diseqc
c_func
(paren
id|adapter
comma
id|cmd
comma
id|arg
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_SLEEP
suffix:colon
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: FE_SLEEP&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// return -EOPNOTSUPP, to make DVB core also send &quot;FE_SLEEP&quot; command to frontend.
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_case
id|FE_SET_VOLTAGE
suffix:colon
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: FE_SET_VOLTAGE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|fe_sec_voltage_t
)paren
id|arg
)paren
(brace
r_case
id|SEC_VOLTAGE_13
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;%s: SEC_VOLTAGE_13, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_VOLTAGE_13
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SEC_VOLTAGE_18
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;%s: SEC_VOLTAGE_18, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_VOLTAGE_18
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|skystar2_probe
r_static
r_int
id|skystar2_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|dvb_adapter
op_star
id|dvb_adapter
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdemux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|driver_initialize
c_func
(paren
id|pdev
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dvb_register_adapter
c_func
(paren
op_amp
id|dvb_adapter
comma
id|skystar2_pci_driver.name
comma
id|THIS_MODULE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dvb_adapter
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error registering DVB adapter&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|driver_halt
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|adapter-&gt;dvb_adapter
op_assign
id|dvb_adapter
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adapter-&gt;i2c_sem
)paren
suffix:semicolon
id|adapter-&gt;i2c_bus
op_assign
id|dvb_register_i2c_bus
c_func
(paren
id|master_xfer
comma
id|adapter
comma
id|adapter-&gt;dvb_adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;i2c_bus
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dvb_add_frontend_ioctls
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
id|flexcop_diseqc_ioctl
comma
l_int|NULL
comma
id|adapter
)paren
suffix:semicolon
id|dvbdemux
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
id|dvbdemux-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|adapter
suffix:semicolon
id|dvbdemux-&gt;filternum
op_assign
id|N_PID_SLOTS
suffix:semicolon
id|dvbdemux-&gt;feednum
op_assign
id|N_PID_SLOTS
suffix:semicolon
id|dvbdemux-&gt;start_feed
op_assign
id|dvb_start_feed
suffix:semicolon
id|dvbdemux-&gt;stop_feed
op_assign
id|dvb_stop_feed
suffix:semicolon
id|dvbdemux-&gt;write_to_decoder
op_assign
l_int|NULL
suffix:semicolon
id|dvbdemux-&gt;dmx.capabilities
op_assign
(paren
id|DMX_TS_FILTERING
op_or
id|DMX_SECTION_FILTERING
op_or
id|DMX_MEMORY_BASED_FILTERING
)paren
suffix:semicolon
id|dvb_dmx_init
c_func
(paren
op_amp
id|adapter-&gt;demux
)paren
suffix:semicolon
id|adapter-&gt;hw_frontend.source
op_assign
id|DMX_FRONTEND_0
suffix:semicolon
id|adapter-&gt;dmxdev.filternum
op_assign
id|N_PID_SLOTS
suffix:semicolon
id|adapter-&gt;dmxdev.demux
op_assign
op_amp
id|dvbdemux-&gt;dmx
suffix:semicolon
id|adapter-&gt;dmxdev.capabilities
op_assign
l_int|0
suffix:semicolon
id|dvb_dmxdev_init
c_func
(paren
op_amp
id|adapter-&gt;dmxdev
comma
id|adapter-&gt;dvb_adapter
)paren
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|add_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|adapter-&gt;mem_frontend.source
op_assign
id|DMX_MEMORY_FE
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|add_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;mem_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|connect_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|dvb_net_init
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
op_amp
id|adapter-&gt;dvbnet
comma
op_amp
id|dvbdemux-&gt;dmx
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|skystar2_remove
r_static
r_void
id|skystar2_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdemux
suffix:semicolon
r_if
c_cond
(paren
id|pdev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|adapter
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter
op_ne
l_int|NULL
)paren
(brace
id|dvb_net_release
c_func
(paren
op_amp
id|adapter-&gt;dvbnet
)paren
suffix:semicolon
id|dvbdemux
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|close
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
)paren
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|remove_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|remove_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;mem_frontend
)paren
suffix:semicolon
id|dvb_dmxdev_release
c_func
(paren
op_amp
id|adapter-&gt;dmxdev
)paren
suffix:semicolon
id|dvb_dmx_release
c_func
(paren
op_amp
id|adapter-&gt;demux
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dvb_adapter
op_ne
l_int|NULL
)paren
(brace
id|dvb_remove_frontend_ioctls
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
id|flexcop_diseqc_ioctl
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;i2c_bus
op_ne
l_int|NULL
)paren
id|dvb_unregister_i2c_bus
c_func
(paren
id|master_xfer
comma
id|adapter-&gt;i2c_bus-&gt;adapter
comma
id|adapter-&gt;i2c_bus-&gt;id
)paren
suffix:semicolon
id|dvb_unregister_adapter
c_func
(paren
id|adapter-&gt;dvb_adapter
)paren
suffix:semicolon
)brace
id|driver_halt
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
)brace
DECL|variable|skystar2_pci_tbl
r_static
r_struct
id|pci_device_id
id|skystar2_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x000013d0
comma
l_int|0x00002103
comma
l_int|0xffffffff
comma
l_int|0xffffffff
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0x000013d0
comma
l_int|0x00002200
comma
l_int|0xffffffff
comma
l_int|0xffffffff
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
comma
singleline_comment|//FCIII
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|skystar2_pci_tbl
)paren
suffix:semicolon
DECL|variable|skystar2_pci_driver
r_static
r_struct
id|pci_driver
id|skystar2_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Technisat SkyStar2 driver&quot;
comma
dot
id|id_table
op_assign
id|skystar2_pci_tbl
comma
dot
id|probe
op_assign
id|skystar2_probe
comma
dot
id|remove
op_assign
id|skystar2_remove
comma
)brace
suffix:semicolon
DECL|function|skystar2_init
r_static
r_int
id|skystar2_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|skystar2_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|skystar2_cleanup
r_static
r_void
id|skystar2_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|skystar2_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|skystar2_init
id|module_init
c_func
(paren
id|skystar2_init
)paren
suffix:semicolon
DECL|variable|skystar2_cleanup
id|module_exit
c_func
(paren
id|skystar2_cleanup
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|debug
comma
l_string|&quot;enable verbose debug messages: supported values: 1 and 2&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|enable_hw_filters
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable_hw_filters
comma
l_string|&quot;enable hardware filters: supported values: 0 (none), 1, 2&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Technisat SkyStar2 DVB PCI Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
