multiline_comment|/*&n; * skystar2.c - driver for the Technisat SkyStar2 PCI DVB card&n; *              based on the FlexCopII by B2C2,Inc.&n; *&n; * Copyright (C) 2003  V.C. , skystar@moldova.cc&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU Lesser General Public License&n; * as published by the Free Software Foundation; either version 2.1&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU Lesser General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;dvb_i2c.h&quot;
macro_line|#include &quot;dvb_frontend.h&quot;
macro_line|#include &quot;dvb_functions.h&quot;
macro_line|#include &lt;linux/dvb/frontend.h&gt;
macro_line|#include &lt;linux/dvb/dmx.h&gt;
macro_line|#include &quot;dvb_demux.h&quot;
macro_line|#include &quot;dmxdev.h&quot;
macro_line|#include &quot;dvb_filter.h&quot;
macro_line|#include &quot;dvbdev.h&quot;
macro_line|#include &quot;demux.h&quot;
macro_line|#include &quot;dvb_net.h&quot;
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(x...) do { if (debug) printk(x); } while (0)
DECL|macro|SizeOfBufDMA1
mdefine_line|#define SizeOfBufDMA1&t;0x3AC00
DECL|macro|SizeOfBufDMA2
mdefine_line|#define SizeOfBufDMA2&t;0x758
DECL|struct|dmaq
r_struct
id|dmaq
(brace
DECL|member|bus_addr
id|u32
id|bus_addr
suffix:semicolon
DECL|member|head
id|u32
id|head
suffix:semicolon
DECL|member|tail
id|u32
id|tail
suffix:semicolon
DECL|member|buffer_size
id|u32
id|buffer_size
suffix:semicolon
DECL|member|buffer
id|u8
op_star
id|buffer
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|packet_header
r_struct
id|packet_header
(brace
DECL|member|sync_byte
id|u32
id|sync_byte
suffix:semicolon
DECL|member|transport_error_indicator
id|u32
id|transport_error_indicator
suffix:semicolon
DECL|member|payload_unit_start_indicator
id|u32
id|payload_unit_start_indicator
suffix:semicolon
DECL|member|transport_priority
id|u32
id|transport_priority
suffix:semicolon
DECL|member|pid
id|u32
id|pid
suffix:semicolon
DECL|member|transport_scrambling_control
id|u32
id|transport_scrambling_control
suffix:semicolon
DECL|member|adaptation_field_control
id|u32
id|adaptation_field_control
suffix:semicolon
DECL|member|continuity_counter
id|u32
id|continuity_counter
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|adapter
r_struct
id|adapter
(brace
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
DECL|member|card_revision
id|u8
id|card_revision
suffix:semicolon
DECL|member|b2c2_revision
id|u32
id|b2c2_revision
suffix:semicolon
DECL|member|PidFilterMax
id|u32
id|PidFilterMax
suffix:semicolon
DECL|member|MacFilterMax
id|u32
id|MacFilterMax
suffix:semicolon
DECL|member|irq
id|u32
id|irq
suffix:semicolon
DECL|member|io_mem
id|u32
id|io_mem
suffix:semicolon
DECL|member|io_port
id|u32
id|io_port
suffix:semicolon
DECL|member|mac_addr
id|u8
id|mac_addr
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|dwSramType
id|u32
id|dwSramType
suffix:semicolon
DECL|member|dvb_adapter
r_struct
id|dvb_adapter
op_star
id|dvb_adapter
suffix:semicolon
DECL|member|demux
r_struct
id|dvb_demux
id|demux
suffix:semicolon
DECL|member|dmxdev
r_struct
id|dmxdev
id|dmxdev
suffix:semicolon
DECL|member|hw_frontend
r_struct
id|dmx_frontend
id|hw_frontend
suffix:semicolon
DECL|member|mem_frontend
r_struct
id|dmx_frontend
id|mem_frontend
suffix:semicolon
DECL|member|i2c_bus
r_struct
id|dvb_i2c_bus
op_star
id|i2c_bus
suffix:semicolon
DECL|member|dvbnet
r_struct
id|dvb_net
id|dvbnet
suffix:semicolon
DECL|member|i2c_sem
r_struct
id|semaphore
id|i2c_sem
suffix:semicolon
DECL|member|dmaq1
r_struct
id|dmaq
id|dmaq1
suffix:semicolon
DECL|member|dmaq2
r_struct
id|dmaq
id|dmaq2
suffix:semicolon
DECL|member|dma_ctrl
id|u32
id|dma_ctrl
suffix:semicolon
DECL|member|dma_status
id|u32
id|dma_status
suffix:semicolon
DECL|member|capturing
id|u32
id|capturing
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|pids
id|u16
id|pids
(braket
l_int|0x27
)braket
suffix:semicolon
DECL|member|mac_filter
id|u32
id|mac_filter
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|WriteRegDW
mdefine_line|#define WriteRegDW(adapter,reg,value) writel(value, adapter-&gt;io_mem + reg)
DECL|macro|ReadRegDW
mdefine_line|#define ReadRegDW(adapter,reg) readl(adapter-&gt;io_mem + reg)
DECL|function|WriteRegOp
r_static
r_void
id|WriteRegOp
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|reg
comma
id|u32
id|operation
comma
id|u32
id|andvalue
comma
id|u32
id|orvalue
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|operation
op_eq
l_int|1
)paren
id|tmp
op_assign
id|tmp
op_or
id|orvalue
suffix:semicolon
r_if
c_cond
(paren
id|operation
op_eq
l_int|2
)paren
id|tmp
op_assign
id|tmp
op_amp
id|andvalue
suffix:semicolon
r_if
c_cond
(paren
id|operation
op_eq
l_int|3
)paren
id|tmp
op_assign
(paren
id|tmp
op_amp
id|andvalue
)paren
op_or
id|orvalue
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
id|reg
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/* i2c functions */
DECL|function|i2cMainWriteForFlex2
r_static
r_int
id|i2cMainWriteForFlex2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|command
comma
id|u8
op_star
id|buf
comma
id|u32
id|retries
)paren
(brace
id|u32
id|i
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x100
comma
l_int|0
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x100
comma
id|command
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|retries
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x100
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x40000000
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x81000000
)paren
op_eq
l_int|0x80000000
)paren
(brace
r_if
c_cond
(paren
id|buf
op_ne
l_int|0
)paren
op_star
id|buf
op_assign
(paren
id|value
op_rshift
l_int|0x10
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x100
comma
l_int|0
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x100
comma
id|command
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* device = 0x10000000 for tuner, 0x20000000 for eeprom */
DECL|function|i2cMainSetup
r_static
r_void
id|i2cMainSetup
c_func
(paren
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u8
id|op
comma
id|u8
id|addr
comma
id|u32
id|value
comma
id|u32
id|len
comma
id|u32
op_star
id|command
)paren
(brace
op_star
id|command
op_assign
id|device
op_or
(paren
(paren
id|len
op_minus
l_int|1
)paren
op_lshift
l_int|26
)paren
op_or
(paren
id|value
op_lshift
l_int|16
)paren
op_or
(paren
id|addr
op_lshift
l_int|8
)paren
op_or
id|chip_addr
suffix:semicolon
r_if
c_cond
(paren
id|op
op_ne
l_int|0
)paren
op_star
id|command
op_assign
op_star
id|command
op_or
l_int|0x03000000
suffix:semicolon
r_else
op_star
id|command
op_assign
op_star
id|command
op_or
l_int|0x01000000
suffix:semicolon
)brace
DECL|function|FlexI2cRead4
r_static
r_int
id|FlexI2cRead4
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u16
id|addr
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
id|u32
id|command
suffix:semicolon
id|u32
id|value
suffix:semicolon
r_int
id|result
comma
id|i
suffix:semicolon
id|i2cMainSetup
c_func
(paren
id|device
comma
id|chip_addr
comma
l_int|1
comma
id|addr
comma
l_int|0
comma
id|len
comma
op_amp
id|command
)paren
suffix:semicolon
id|result
op_assign
id|i2cMainWriteForFlex2
c_func
(paren
id|adapter
comma
id|command
comma
id|buf
comma
l_int|100000
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_amp
l_int|0xff
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|len
OG
l_int|1
)paren
(brace
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x104
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|buf
(braket
id|i
)braket
op_assign
id|value
op_amp
l_int|0xff
suffix:semicolon
id|value
op_assign
id|value
op_rshift
l_int|8
suffix:semicolon
)brace
)brace
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|FlexI2cWrite4
r_static
r_int
id|FlexI2cWrite4
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|chip_addr
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u8
id|len
)paren
(brace
id|u32
id|command
suffix:semicolon
id|u32
id|value
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|1
)paren
(brace
id|value
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|len
suffix:semicolon
id|i
OG
l_int|1
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|value
op_assign
id|value
op_lshift
l_int|8
suffix:semicolon
id|value
op_assign
id|value
op_or
id|buf
(braket
id|i
op_minus
l_int|1
)braket
suffix:semicolon
)brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x104
comma
id|value
)paren
suffix:semicolon
)brace
id|i2cMainSetup
c_func
(paren
id|device
comma
id|chip_addr
comma
l_int|0
comma
id|addr
comma
id|buf
(braket
l_int|0
)braket
comma
id|len
comma
op_amp
id|command
)paren
suffix:semicolon
r_return
id|i2cMainWriteForFlex2
c_func
(paren
id|adapter
comma
id|command
comma
l_int|0
comma
l_int|100000
)paren
suffix:semicolon
)brace
DECL|function|fixchipaddr
r_static
r_void
id|fixchipaddr
c_func
(paren
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u32
op_star
id|ret
)paren
(brace
r_if
c_cond
(paren
id|device
op_eq
l_int|0x20000000
)paren
op_star
id|ret
op_assign
id|bus
op_or
(paren
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|3
)paren
suffix:semicolon
op_star
id|ret
op_assign
id|bus
suffix:semicolon
)brace
DECL|function|FLEXI2C_read
r_static
id|u32
id|FLEXI2C_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|chipaddr
suffix:semicolon
id|u32
id|bytes_to_transfer
suffix:semicolon
id|u8
op_star
id|start
suffix:semicolon
singleline_comment|//  dprintk(&quot;%s:&bslash;n&quot;, __FUNCTION__);
id|start
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|bytes_to_transfer
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|bytes_to_transfer
OG
l_int|4
)paren
id|bytes_to_transfer
op_assign
l_int|4
suffix:semicolon
id|fixchipaddr
c_func
(paren
id|device
comma
id|bus
comma
id|addr
comma
op_amp
id|chipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|FlexI2cRead4
c_func
(paren
id|adapter
comma
id|device
comma
id|chipaddr
comma
id|addr
comma
id|buf
comma
id|bytes_to_transfer
)paren
op_eq
l_int|0
)paren
r_return
id|buf
op_minus
id|start
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|bytes_to_transfer
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|bytes_to_transfer
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|bytes_to_transfer
suffix:semicolon
)brace
suffix:semicolon
r_return
id|buf
op_minus
id|start
suffix:semicolon
)brace
DECL|function|FLEXI2C_write
r_static
id|u32
id|FLEXI2C_write
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|device
comma
id|u32
id|bus
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|chipaddr
suffix:semicolon
id|u32
id|bytes_to_transfer
suffix:semicolon
id|u8
op_star
id|start
suffix:semicolon
singleline_comment|//  dprintk(&quot;%s:&bslash;n&quot;, __FUNCTION__);
id|start
op_assign
id|buf
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|bytes_to_transfer
op_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|bytes_to_transfer
OG
l_int|4
)paren
id|bytes_to_transfer
op_assign
l_int|4
suffix:semicolon
id|fixchipaddr
c_func
(paren
id|device
comma
id|bus
comma
id|addr
comma
op_amp
id|chipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|FlexI2cWrite4
c_func
(paren
id|adapter
comma
id|device
comma
id|chipaddr
comma
id|addr
comma
id|buf
comma
id|bytes_to_transfer
)paren
op_eq
l_int|0
)paren
r_return
id|buf
op_minus
id|start
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|bytes_to_transfer
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|bytes_to_transfer
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|bytes_to_transfer
suffix:semicolon
)brace
r_return
id|buf
op_minus
id|start
suffix:semicolon
)brace
DECL|function|master_xfer
r_static
r_int
id|master_xfer
c_func
(paren
r_struct
id|dvb_i2c_bus
op_star
id|i2c
comma
r_const
r_struct
id|i2c_msg
op_star
id|msgs
comma
r_int
id|num
)paren
(brace
r_struct
id|adapter
op_star
id|tmp
op_assign
id|i2c-&gt;data
suffix:semicolon
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|down_interruptible
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;message %d: flags=%x, addr=0x%04x, buf=%x, len=%d &bslash;n&quot;
comma
id|i
comma
id|msgs
(braket
id|i
)braket
dot
id|flags
comma
id|msgs
(braket
id|i
)braket
dot
id|addr
comma
(paren
id|u32
)paren
id|msgs
(braket
id|i
)braket
dot
id|buf
comma
id|msgs
(braket
id|i
)braket
dot
id|len
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* allow only the vp310 frontend to access the bus */
r_if
c_cond
(paren
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|addr
op_ne
l_int|0x0E
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|addr
op_ne
l_int|0x61
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
suffix:semicolon
r_return
op_minus
id|EREMOTEIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|num
op_eq
l_int|1
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|buf
op_ne
l_int|NULL
)paren
)paren
(brace
r_if
c_cond
(paren
id|msgs
(braket
l_int|0
)braket
dot
id|flags
op_eq
id|I2C_M_RD
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// single writes do have the reg addr in buf[0] and data in buf[1] to buf[n]
id|ret
op_assign
id|FLEXI2C_write
c_func
(paren
id|tmp
comma
l_int|0x10000000
comma
id|msgs
(braket
l_int|0
)braket
dot
id|addr
comma
id|msgs
(braket
l_int|0
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
op_amp
id|msgs
(braket
l_int|0
)braket
dot
id|buf
(braket
l_int|1
)braket
comma
id|msgs
(braket
l_int|0
)braket
dot
id|len
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
id|msgs
(braket
l_int|0
)braket
dot
id|len
op_minus
l_int|1
)paren
id|ret
op_assign
op_minus
id|EREMOTEIO
suffix:semicolon
r_else
id|ret
op_assign
id|num
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|num
op_eq
l_int|2
)paren
op_logical_and
(paren
id|msgs
(braket
l_int|1
)braket
dot
id|buf
op_ne
l_int|NULL
)paren
)paren
(brace
singleline_comment|// i2c reads consist of a reg addr _write_ followed by a data read, so msg[1].flags has to be examined
r_if
c_cond
(paren
id|msgs
(braket
l_int|1
)braket
dot
id|flags
op_eq
id|I2C_M_RD
)paren
(brace
id|ret
op_assign
id|FLEXI2C_read
c_func
(paren
id|tmp
comma
l_int|0x10000000
comma
id|msgs
(braket
l_int|0
)braket
dot
id|addr
comma
id|msgs
(braket
l_int|0
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
l_int|1
)braket
dot
id|buf
comma
id|msgs
(braket
l_int|1
)braket
dot
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|ret
op_assign
id|FLEXI2C_write
c_func
(paren
id|tmp
comma
l_int|0x10000000
comma
id|msgs
(braket
l_int|0
)braket
dot
id|addr
comma
id|msgs
(braket
l_int|0
)braket
dot
id|buf
(braket
l_int|0
)braket
comma
id|msgs
(braket
l_int|1
)braket
dot
id|buf
comma
id|msgs
(braket
l_int|1
)braket
dot
id|len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
op_ne
id|msgs
(braket
l_int|1
)braket
dot
id|len
)paren
id|ret
op_assign
op_minus
id|EREMOTEIO
suffix:semicolon
r_else
id|ret
op_assign
id|num
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|tmp-&gt;i2c_sem
)paren
suffix:semicolon
multiline_comment|/* master xfer functions always return the number of successfully&n;&t;   transmitted messages, not the number of transmitted bytes.&n;&t;   return -EREMOTEIO in case of failure. */
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* SRAM (Skystar2 rev2.3 has one &quot;ISSI IS61LV256&quot; chip on board,&n;   but it seems that FlexCopII can work with more than one chip) */
DECL|function|SRAMSetNetDest
r_static
r_void
id|SRAMSetNetDest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xFFFFFFFC
)paren
op_or
(paren
id|dest
op_amp
l_int|3
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|SRAMSetCaiDest
r_static
r_void
id|SRAMSetCaiDest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xFFFFFFF3
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|SRAMSetCaoDest
r_static
r_void
id|SRAMSetCaoDest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xFFFFFFCF
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
DECL|function|SRAMSetMediaDest
r_static
r_void
id|SRAMSetMediaDest
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|dest
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
)paren
op_amp
l_int|0xFFFFFF3F
)paren
op_or
(paren
(paren
id|dest
op_amp
l_int|3
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x714
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return tmp; */
)brace
multiline_comment|/* SRAM memory is accessed through a buffer register in the FlexCop&n;   chip (0x700). This register has the following structure:&n;    bits 0-14  : address&n;    bit  15    : read/write flag&n;    bits 16-23 : 8-bit word to write&n;    bits 24-27 : = 4&n;    bits 28-29 : memory bank selector&n;    bit  31    : busy flag&n;*/
DECL|function|FlexSramWrite
r_static
r_void
id|FlexSramWrite
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|bank
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|i
comma
id|command
comma
id|retries
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|command
op_assign
id|bank
op_or
id|addr
op_or
l_int|0x04000000
op_or
(paren
op_star
id|buf
op_lshift
l_int|0x10
)paren
suffix:semicolon
id|retries
op_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
comma
id|command
)paren
suffix:semicolon
id|buf
op_increment
suffix:semicolon
id|addr
op_increment
suffix:semicolon
)brace
)brace
DECL|function|FlexSramRead
r_static
r_void
id|FlexSramRead
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|bank
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|i
comma
id|command
comma
id|value
comma
id|retries
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|command
op_assign
id|bank
op_or
id|addr
op_or
l_int|0x04008000
suffix:semicolon
id|retries
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
comma
id|command
)paren
suffix:semicolon
id|retries
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|retries
OG
l_int|0
)paren
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|retries
op_decrement
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SRAM timeout&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x700
)paren
op_rshift
l_int|0x10
suffix:semicolon
op_star
id|buf
op_assign
(paren
id|value
op_amp
l_int|0xff
)paren
suffix:semicolon
id|addr
op_increment
suffix:semicolon
id|buf
op_increment
suffix:semicolon
)brace
)brace
DECL|function|SRAM_writeChunk
r_static
r_void
id|SRAM_writeChunk
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
id|u32
id|bank
suffix:semicolon
id|bank
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x20000
)paren
(brace
id|bank
op_assign
(paren
id|addr
op_amp
l_int|0x18000
)paren
op_lshift
l_int|0x0D
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x00000
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_eq
l_int|0
)paren
id|bank
op_assign
l_int|0x20000000
suffix:semicolon
r_else
id|bank
op_assign
l_int|0x10000000
suffix:semicolon
)brace
id|FlexSramWrite
c_func
(paren
id|adapter
comma
id|bank
comma
id|addr
op_amp
l_int|0x7FFF
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|SRAM_readChunk
r_static
r_void
id|SRAM_readChunk
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
id|u32
id|bank
suffix:semicolon
id|bank
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x20000
)paren
(brace
id|bank
op_assign
(paren
id|addr
op_amp
l_int|0x18000
)paren
op_lshift
l_int|0x0D
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x00000
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_eq
l_int|0
)paren
id|bank
op_assign
l_int|0x20000000
suffix:semicolon
r_else
id|bank
op_assign
l_int|0x10000000
suffix:semicolon
)brace
id|FlexSramRead
c_func
(paren
id|adapter
comma
id|bank
comma
id|addr
op_amp
l_int|0x7FFF
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|SRAM_read
r_static
r_void
id|SRAM_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|length
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|length
op_assign
id|len
suffix:semicolon
singleline_comment|// check if the address range belongs to the same 
singleline_comment|// 32K memory chip. If not, the data is read from 
singleline_comment|// one chip at a time.
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_ne
(paren
(paren
id|addr
op_plus
id|len
op_minus
l_int|1
)paren
op_rshift
l_int|0x0F
)paren
)paren
(brace
id|length
op_assign
(paren
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|0x0F
)paren
op_minus
id|addr
suffix:semicolon
)brace
id|SRAM_readChunk
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|length
)paren
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|length
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|length
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|length
suffix:semicolon
)brace
)brace
DECL|function|SRAM_write
r_static
r_void
id|SRAM_write
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|length
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ne
l_int|0
)paren
(brace
id|length
op_assign
id|len
suffix:semicolon
singleline_comment|// check if the address range belongs to the same 
singleline_comment|// 32K memory chip. If not, the data is written to
singleline_comment|// one chip at a time.
r_if
c_cond
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_ne
(paren
(paren
id|addr
op_plus
id|len
op_minus
l_int|1
)paren
op_rshift
l_int|0x0F
)paren
)paren
(brace
id|length
op_assign
(paren
(paren
(paren
id|addr
op_rshift
l_int|0x0F
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|0x0F
)paren
op_minus
id|addr
suffix:semicolon
)brace
id|SRAM_writeChunk
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|length
)paren
suffix:semicolon
id|addr
op_assign
id|addr
op_plus
id|length
suffix:semicolon
id|buf
op_assign
id|buf
op_plus
id|length
suffix:semicolon
id|len
op_assign
id|len
op_minus
id|length
suffix:semicolon
)brace
)brace
DECL|function|SRAM_setSize
r_static
r_void
id|SRAM_setSize
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|mask
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
comma
(paren
id|mask
op_or
(paren
op_complement
l_int|0x30000
op_amp
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
)paren
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|SRAM_init
r_static
r_void
id|SRAM_init
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|tmp
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
)paren
op_ne
l_int|0
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
comma
id|tmp
)paren
suffix:semicolon
id|adapter-&gt;dwSramType
op_assign
id|tmp
op_amp
l_int|0x30000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dwSramType = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dwSramType
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dwSramType
op_assign
l_int|0x10000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dwSramType = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dwSramType
)paren
suffix:semicolon
)brace
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return adapter-&gt;dwSramType; */
)brace
DECL|function|SRAM_testLocation
r_static
r_int
id|SRAM_testLocation
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|mask
comma
id|u32
id|addr
)paren
(brace
id|u8
id|tmp1
comma
id|tmp2
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: mask = %x, addr = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|mask
comma
id|addr
)paren
suffix:semicolon
id|SRAM_setSize
c_func
(paren
id|adapter
comma
id|mask
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0xA5
suffix:semicolon
id|tmp1
op_assign
l_int|0x4F
suffix:semicolon
id|SRAM_write
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|SRAM_write
c_func
(paren
id|adapter
comma
id|addr
op_plus
l_int|4
comma
op_amp
id|tmp1
comma
l_int|1
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|SRAM_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|SRAM_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: wrote 0xA5, read 0x%2x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp2
op_ne
l_int|0xA5
)paren
r_return
l_int|0
suffix:semicolon
id|tmp2
op_assign
l_int|0x5A
suffix:semicolon
id|tmp1
op_assign
l_int|0xF4
suffix:semicolon
id|SRAM_write
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|SRAM_write
c_func
(paren
id|adapter
comma
id|addr
op_plus
l_int|4
comma
op_amp
id|tmp1
comma
l_int|1
)paren
suffix:semicolon
id|tmp2
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|SRAM_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|SRAM_read
c_func
(paren
id|adapter
comma
id|addr
comma
op_amp
id|tmp2
comma
l_int|1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: wrote 0x5A, read 0x%2x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp2
op_ne
l_int|0x5A
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|SRAM_length
r_static
id|u32
id|SRAM_length
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x10000
)paren
r_return
l_int|32768
suffix:semicolon
singleline_comment|//  32K
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x00000
)paren
r_return
l_int|65536
suffix:semicolon
singleline_comment|//  64K        
r_if
c_cond
(paren
id|adapter-&gt;dwSramType
op_eq
l_int|0x20000
)paren
r_return
l_int|131072
suffix:semicolon
singleline_comment|// 128K
r_return
l_int|32768
suffix:semicolon
singleline_comment|// 32K
)brace
multiline_comment|/* FlexcopII can work with 32K, 64K or 128K of external SRAM memory.&n;    - for 128K there are 4x32K chips at bank 0,1,2,3.&n;    - for  64K there are 2x32K chips at bank 1,2.&n;    - for  32K there is one 32K chip at bank 0.&n;&n;   FlexCop works only with one bank at a time. The bank is selected&n;   by bits 28-29 of the 0x700 register.&n;  &n;   bank 0 covers addresses 0x00000-0x07FFF&n;   bank 1 covers addresses 0x08000-0x0FFFF&n;   bank 2 covers addresses 0x10000-0x17FFF&n;   bank 3 covers addresses 0x18000-0x1FFFF&n;*/
DECL|function|SramDetectForFlex2
r_static
r_int
id|SramDetectForFlex2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|u32
id|tmp
comma
id|tmp2
comma
id|tmp3
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|tmp
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0
)paren
suffix:semicolon
id|tmp2
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: tmp2 = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp2
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
comma
l_int|1
)paren
suffix:semicolon
id|tmp3
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: tmp3 = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tmp3
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x71C
comma
id|tmp2
)paren
suffix:semicolon
singleline_comment|// check for internal SRAM ???
id|tmp3
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|tmp3
op_ne
l_int|0
)paren
(brace
id|SRAM_setSize
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 32K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|32
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SRAM_testLocation
c_func
(paren
id|adapter
comma
l_int|0x20000
comma
l_int|0x18000
)paren
op_ne
l_int|0
)paren
(brace
id|SRAM_setSize
c_func
(paren
id|adapter
comma
l_int|0x20000
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 128K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|128
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SRAM_testLocation
c_func
(paren
id|adapter
comma
l_int|0x00000
comma
l_int|0x10000
)paren
op_ne
l_int|0
)paren
(brace
id|SRAM_setSize
c_func
(paren
id|adapter
comma
l_int|0x00000
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 64K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|64
suffix:semicolon
)brace
r_if
c_cond
(paren
id|SRAM_testLocation
c_func
(paren
id|adapter
comma
l_int|0x10000
comma
l_int|0x00000
)paren
op_ne
l_int|0
)paren
(brace
id|SRAM_setSize
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sram size = 32K&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|32
suffix:semicolon
)brace
id|SRAM_setSize
c_func
(paren
id|adapter
comma
l_int|0x10000
)paren
suffix:semicolon
id|SRAM_init
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|tmp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: SRAM detection failed. Set to 32K &bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|SLL_detectSramSize
r_static
r_void
id|SLL_detectSramSize
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|SramDetectForFlex2
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
multiline_comment|/* EEPROM (Skystar2 has one &quot;24LC08B&quot; chip on board) */
multiline_comment|/*&n;static int EEPROM_write(struct adapter *adapter, u16 addr, u8 * buf, u16 len)&n;{&n;&t;return FLEXI2C_write(adapter, 0x20000000, 0x50, addr, buf, len);&n;}&n;*/
DECL|function|EEPROM_read
r_static
r_int
id|EEPROM_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|addr
comma
id|u8
op_star
id|buf
comma
id|u16
id|len
)paren
(brace
r_return
id|FLEXI2C_read
c_func
(paren
id|adapter
comma
l_int|0x20000000
comma
l_int|0x50
comma
id|addr
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
DECL|function|calc_LRC
id|u8
id|calc_LRC
c_func
(paren
id|u8
op_star
id|buf
comma
id|u32
id|len
)paren
(brace
id|u32
id|i
suffix:semicolon
id|u8
id|sum
suffix:semicolon
id|sum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
id|sum
op_assign
id|sum
op_xor
id|buf
(braket
id|i
)braket
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
DECL|function|EEPROM_LRC_read
r_static
r_int
id|EEPROM_LRC_read
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|addr
comma
id|u32
id|len
comma
id|u8
op_star
id|buf
comma
id|u32
id|retries
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|retries
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|EEPROM_read
c_func
(paren
id|adapter
comma
id|addr
comma
id|buf
comma
id|len
)paren
op_eq
id|len
)paren
(brace
r_if
c_cond
(paren
id|calc_LRC
c_func
(paren
id|buf
comma
id|len
op_minus
l_int|1
)paren
op_eq
id|buf
(braket
id|len
op_minus
l_int|1
)braket
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;static int EEPROM_LRC_write(struct adapter *adapter, u32 addr, u32 len, u8 * wbuf, u8 * rbuf, u32 retries)&n;{&n;&t;int i;&n;&n;&t;for (i = 0; i &lt; retries; i++) {&n;&t;&t;if (EEPROM_write(adapter, addr, wbuf, len) == len) {&n;&t;&t;&t;if (EEPROM_LRC_read(adapter, addr, len, rbuf, retries) == 1)&n;&t;&t;&t;&t;return 1;&n;&t;&t;}&n;&t;}&n;&n;&t;return 0;&n;}&n;*/
multiline_comment|/* These functions could be called from the initialization routine &n;   to unlock SkyStar2 cards, locked by &quot;Europe On Line&quot;.&n;        &n;   in cards from &quot;Europe On Line&quot; the key is:&n;&n;       u8 key[20] = {&n; &t;    0xB2, 0x01, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n;       };&n;&n;       LRC = 0xB3;&n;&n;  in unlocked cards the key is:&n;&n;       u8 key[20] = {&n; &t;    0xB2, 0x00, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n; &t;    0x00, 0x00, 0x00, 0x00,&n;       };&n;&n;      LRC = 0xB2;&n;*/
multiline_comment|/*&n;static int EEPROM_writeKey(struct adapter *adapter, u8 * key, u32 len)&n;{&n;&t;u8 rbuf[20];&n;&t;u8 wbuf[20];&n;&n;&t;if (len != 16)&n;&t;&t;return 0;&n;&n;&t;memcpy(wbuf, key, len);&n;&n;&t;wbuf[16] = 0;&n;&t;wbuf[17] = 0;&n;&t;wbuf[18] = 0;&n;&t;wbuf[19] = calc_LRC(wbuf, 19);&n;&n;&t;return EEPROM_LRC_write(adapter, 0x3E4, 20, wbuf, rbuf, 4);&n;}&n;*/
DECL|function|EEPROM_readKey
r_static
r_int
id|EEPROM_readKey
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
op_star
id|key
comma
id|u32
id|len
)paren
(brace
id|u8
id|buf
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
l_int|16
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|EEPROM_LRC_read
c_func
(paren
id|adapter
comma
l_int|0x3E4
comma
l_int|20
comma
id|buf
comma
l_int|4
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|key
comma
id|buf
comma
id|len
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|EEPROM_getMacAddr
r_static
r_int
id|EEPROM_getMacAddr
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
r_char
id|type
comma
id|u8
op_star
id|mac
)paren
(brace
id|u8
id|tmp
(braket
l_int|8
)braket
suffix:semicolon
r_if
c_cond
(paren
id|EEPROM_LRC_read
c_func
(paren
id|adapter
comma
l_int|0x3F8
comma
l_int|8
comma
id|tmp
comma
l_int|4
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|type
op_ne
l_int|0
)paren
(brace
id|mac
(braket
l_int|0
)braket
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mac
(braket
l_int|2
)braket
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|3
)braket
op_assign
l_int|0xFE
suffix:semicolon
id|mac
(braket
l_int|4
)braket
op_assign
l_int|0xFF
suffix:semicolon
id|mac
(braket
l_int|5
)braket
op_assign
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|mac
(braket
l_int|6
)braket
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|mac
(braket
l_int|7
)braket
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
)brace
r_else
(brace
id|mac
(braket
l_int|0
)braket
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|mac
(braket
l_int|1
)braket
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mac
(braket
l_int|2
)braket
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|mac
(braket
l_int|3
)braket
op_assign
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|mac
(braket
l_int|4
)braket
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|mac
(braket
l_int|5
)braket
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|type
op_eq
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|mac
comma
l_int|0
comma
l_int|6
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|mac
comma
l_int|0
comma
l_int|8
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;static char EEPROM_setMacAddr(struct adapter *adapter, char type, u8 * mac)&n;{&n;&t;u8 tmp[8];&n;&n;&t;if (type != 0) {&n;&t;&t;tmp[0] = mac[0];&n;&t;&t;tmp[1] = mac[1];&n;&t;&t;tmp[2] = mac[2];&n;&t;&t;tmp[3] = mac[5];&n;&t;&t;tmp[4] = mac[6];&n;&t;&t;tmp[5] = mac[7];&n;&n;&t;} else {&n;&n;&t;&t;tmp[0] = mac[0];&n;&t;&t;tmp[1] = mac[1];&n;&t;&t;tmp[2] = mac[2];&n;&t;&t;tmp[3] = mac[3];&n;&t;&t;tmp[4] = mac[4];&n;&t;&t;tmp[5] = mac[5];&n;&t;}&n;&n;&t;tmp[6] = 0;&n;&t;tmp[7] = calc_LRC(tmp, 7);&n;&n;&t;if (EEPROM_write(adapter, 0x3F8, tmp, 8) == 8)&n;&t;&t;return 1;&n;&n;&t;return 0;&n;}&n;*/
multiline_comment|/* PID filter */
DECL|function|FilterEnableStream1Filter
r_static
r_void
id|FilterEnableStream1Filter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000001
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000001
)paren
suffix:semicolon
)brace
)brace
DECL|function|FilterEnableStream2Filter
r_static
r_void
id|FilterEnableStream2Filter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000002
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000002
)paren
suffix:semicolon
)brace
)brace
DECL|function|FilterEnablePcrFilter
r_static
r_void
id|FilterEnablePcrFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000004
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000004
)paren
suffix:semicolon
)brace
)brace
DECL|function|FilterEnablePmtFilter
r_static
r_void
id|FilterEnablePmtFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000008
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000008
)paren
suffix:semicolon
)brace
)brace
DECL|function|FilterEnableEmmFilter
r_static
r_void
id|FilterEnableEmmFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000010
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000010
)paren
suffix:semicolon
)brace
)brace
DECL|function|FilterEnableEcmFilter
r_static
r_void
id|FilterEnableEcmFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000020
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000020
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;static void FilterEnableNullFilter(struct adapter *adapter, u32 op)&n;{&n;&t;dprintk(&quot;%s: op=%x&bslash;n&quot;, __FUNCTION__, op);&n;&n;&t;if (op == 0) {&n;&t;&t;WriteRegOp(adapter, 0x208, 2, ~0x00000040, 0);&n;&n;&t;} else {&n;&n;&t;&t;WriteRegOp(adapter, 0x208, 1, 0, 0x00000040);&n;&t;}&n;}&n;*/
DECL|function|FilterEnableMaskFilter
r_static
r_void
id|FilterEnableMaskFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: op=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000080
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000080
)paren
suffix:semicolon
)brace
)brace
DECL|function|CtrlEnableMAC
r_static
r_void
id|CtrlEnableMAC
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00004000
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00004000
)paren
suffix:semicolon
)brace
)brace
DECL|function|CASetMacDstAddrFilter
r_static
r_int
id|CASetMacDstAddrFilter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
op_star
id|mac
)paren
(brace
id|u32
id|tmp1
comma
id|tmp2
suffix:semicolon
id|tmp1
op_assign
(paren
id|mac
(braket
l_int|3
)braket
op_lshift
l_int|0x18
)paren
op_or
(paren
id|mac
(braket
l_int|2
)braket
op_lshift
l_int|0x10
)paren
op_or
(paren
id|mac
(braket
l_int|1
)braket
op_lshift
l_int|0x08
)paren
op_or
id|mac
(braket
l_int|0
)braket
suffix:semicolon
id|tmp2
op_assign
(paren
id|mac
(braket
l_int|5
)braket
op_lshift
l_int|0x08
)paren
op_or
id|mac
(braket
l_int|4
)braket
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x418
comma
id|tmp1
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x41C
comma
id|tmp2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;static void SetIgnoreMACFilter(struct adapter *adapter, u8 op)&n;{&n;&t;if (op != 0) {&n;&t;&t;WriteRegOp(adapter, 0x208, 2, ~0x00004000, 0);&n;&n;&t;&t;adapter-&gt;mac_filter = 1;&n;&n;&t;} else {&n;&n;&t;&t;if (adapter-&gt;mac_filter != 0) {&n;&t;&t;&t;adapter-&gt;mac_filter = 0;&n;&n;&t;&t;&t;WriteRegOp(adapter, 0x208, 1, 0, 0x00004000);&n;&t;&t;}&n;&t;}&n;}&n;*/
multiline_comment|/*&n;static void CheckNullFilterEnable(struct adapter *adapter)&n;{&n;&t;FilterEnableNullFilter(adapter, 1);&n;&t;FilterEnableMaskFilter(adapter, 1);&n;}&n;*/
DECL|function|InitPIDsInfo
r_static
r_void
id|InitPIDsInfo
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x27
suffix:semicolon
id|i
op_increment
)paren
id|adapter-&gt;pids
(braket
id|i
)braket
op_assign
l_int|0x1FFF
suffix:semicolon
)brace
DECL|function|CheckPID
r_static
r_int
id|CheckPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u16
id|pid
)paren
(brace
id|u32
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_eq
l_int|0x1FFF
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x27
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;pids
(braket
id|i
)braket
op_eq
id|pid
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|PidSetGroupPID
r_static
r_void
id|PidSetGroupPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
)paren
op_amp
l_int|0xFFFF0000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetGroupMASK
r_static
r_void
id|PidSetGroupMASK
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_lshift
l_int|0x10
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
)paren
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetStream1PID
r_static
r_void
id|PidSetStream1PID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
)paren
op_amp
l_int|0xFFFFC000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetStream2PID
r_static
r_void
id|PidSetStream2PID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_lshift
l_int|0x10
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
)paren
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetPcrPID
r_static
r_void
id|PidSetPcrPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
)paren
op_amp
l_int|0xFFFFC000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetPmtPID
r_static
r_void
id|PidSetPmtPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
(paren
id|pid
op_amp
l_int|0x3FFF
)paren
op_lshift
l_int|0x10
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
)paren
op_amp
l_int|0x3FFF
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetEmmPID
r_static
r_void
id|PidSetEmmPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
op_amp
l_int|0xFFFF0000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidSetEcmPID
r_static
r_void
id|PidSetEcmPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|value
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
id|value
op_assign
(paren
id|pid
op_lshift
l_int|0x10
)paren
op_or
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
comma
id|value
)paren
suffix:semicolon
multiline_comment|/* return value is never used? */
multiline_comment|/*&t;return value; */
)brace
DECL|function|PidGetStream1PID
r_static
r_int
id|PidGetStream1PID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetStream2PID
r_static
r_int
id|PidGetStream2PID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x300
)paren
op_rshift
l_int|0x10
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetPcrPID
r_static
r_int
id|PidGetPcrPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetPmtPID
r_static
r_int
id|PidGetPmtPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x304
)paren
op_rshift
l_int|0x10
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetEmmPID
r_static
r_int
id|PidGetEmmPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetEcmPID
r_static
r_int
id|PidGetEcmPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
op_rshift
l_int|0x10
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetGroupPID
r_static
r_int
id|PidGetGroupPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
DECL|function|PidGetGroupMASK
r_static
r_int
id|PidGetGroupMASK
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_return
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x30C
)paren
op_rshift
l_int|0x10
)paren
op_amp
l_int|0x00001FFF
suffix:semicolon
)brace
multiline_comment|/*&n;static void ResetHardwarePIDFilter(struct adapter *adapter)&n;{&n;&t;PidSetStream1PID(adapter, 0x1FFF);&n;&n;&t;PidSetStream2PID(adapter, 0x1FFF);&n;&t;FilterEnableStream2Filter(adapter, 0);&n;&n;&t;PidSetPcrPID(adapter, 0x1FFF);&n;&t;FilterEnablePcrFilter(adapter, 0);&n;&n;&t;PidSetPmtPID(adapter, 0x1FFF);&n;&t;FilterEnablePmtFilter(adapter, 0);&n;&n;&t;PidSetEcmPID(adapter, 0x1FFF);&n;&t;FilterEnableEcmFilter(adapter, 0);&n;&n;&t;PidSetEmmPID(adapter, 0x1FFF);&n;&t;FilterEnableEmmFilter(adapter, 0);&n;}&n;*/
DECL|function|OpenWholeBandwidth
r_static
r_void
id|OpenWholeBandwidth
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|PidSetGroupPID
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|PidSetGroupMASK
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|FilterEnableMaskFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|AddHwPID
r_static
r_int
id|AddHwPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_le
l_int|0x1F
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|PidGetGroupMASK
c_func
(paren
id|adapter
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|PidGetGroupPID
c_func
(paren
id|adapter
)paren
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|PidGetStream1PID
c_func
(paren
id|adapter
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetStream1PID
c_func
(paren
id|adapter
comma
id|pid
op_amp
l_int|0xFFFF
)paren
suffix:semicolon
id|FilterEnableStream1Filter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetStream2PID
c_func
(paren
id|adapter
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetStream2PID
c_func
(paren
id|adapter
comma
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|FilterEnableStream2Filter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetPcrPID
c_func
(paren
id|adapter
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetPcrPID
c_func
(paren
id|adapter
comma
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|FilterEnablePcrFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|PidGetPmtPID
c_func
(paren
id|adapter
)paren
op_amp
l_int|0x1FFF
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetPmtPID
c_func
(paren
id|adapter
comma
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|FilterEnablePmtFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|PidGetEmmPID
c_func
(paren
id|adapter
)paren
op_amp
l_int|0x1FFF
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetEmmPID
c_func
(paren
id|adapter
comma
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|FilterEnableEmmFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|PidGetEcmPID
c_func
(paren
id|adapter
)paren
op_amp
l_int|0x1FFF
)paren
op_eq
l_int|0x1FFF
)paren
(brace
id|PidSetEcmPID
c_func
(paren
id|adapter
comma
(paren
id|pid
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|FilterEnableEcmFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|RemoveHwPID
r_static
r_int
id|RemoveHwPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_le
l_int|0x1F
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|PidGetStream1PID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetStream1PID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetStream2PID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetStream2PID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|FilterEnableStream2Filter
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetPcrPID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetPcrPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|FilterEnablePcrFilter
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetPmtPID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetPmtPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|FilterEnablePmtFilter
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetEmmPID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetEmmPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|FilterEnableEmmFilter
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|PidGetEcmPID
c_func
(paren
id|adapter
)paren
op_eq
id|pid
)paren
(brace
id|PidSetEcmPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|FilterEnableEcmFilter
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|AddPID
r_static
r_int
id|AddPID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
r_int
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0x1FFE
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|CheckPID
c_func
(paren
id|adapter
comma
id|pid
)paren
op_eq
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x27
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;pids
(braket
id|i
)braket
op_eq
l_int|0x1FFF
)paren
singleline_comment|// find free pid filter
(brace
id|adapter-&gt;pids
(braket
id|i
)braket
op_assign
id|pid
suffix:semicolon
r_if
c_cond
(paren
id|AddHwPID
c_func
(paren
id|adapter
comma
id|pid
)paren
OL
l_int|0
)paren
id|OpenWholeBandwidth
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|RemovePID
r_static
r_int
id|RemovePID
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|i
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: pid=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0x1FFE
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x27
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;pids
(braket
id|i
)braket
op_eq
id|pid
)paren
(brace
id|adapter-&gt;pids
(braket
id|i
)braket
op_assign
l_int|0x1FFF
suffix:semicolon
id|RemoveHwPID
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* dma &amp; irq */
DECL|function|CtrlEnableSmc
r_static
r_void
id|CtrlEnableSmc
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00000800
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00000800
)paren
suffix:semicolon
)brace
)brace
DECL|function|DmaEnableDisableIrq
r_static
r_void
id|DmaEnableDisableIrq
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|flag1
comma
id|u32
id|flag2
comma
id|u32
id|flag3
)paren
(brace
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
l_int|0x000F0000
suffix:semicolon
r_if
c_cond
(paren
id|flag1
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|flag2
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00010000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00010000
suffix:semicolon
r_if
c_cond
(paren
id|flag3
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00020000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00020000
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|flag2
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00040000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00040000
suffix:semicolon
r_if
c_cond
(paren
id|flag3
op_eq
l_int|0
)paren
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_amp
op_complement
l_int|0x00080000
suffix:semicolon
r_else
id|adapter-&gt;dma_ctrl
op_assign
id|adapter-&gt;dma_ctrl
op_or
l_int|0x00080000
suffix:semicolon
)brace
)brace
DECL|function|IrqDmaEnableDisableIrq
r_static
r_void
id|IrqDmaEnableDisableIrq
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
id|u32
id|value
suffix:semicolon
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
op_amp
l_int|0xFFF0FFFF
suffix:semicolon
r_if
c_cond
(paren
id|op
op_ne
l_int|0
)paren
id|value
op_assign
id|value
op_or
(paren
id|adapter-&gt;dma_ctrl
op_amp
l_int|0x000F0000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/* FlexCopII has 2 dma channels. DMA1 is used to transfer TS data to&n;   system memory.&n;&n;   The DMA1 buffer is divided in 2 subbuffers of equal size.&n;   FlexCopII will transfer TS data to one subbuffer, signal an interrupt&n;   when the subbuffer is full and continue fillig the second subbuffer.&n;&n;   For DMA1:&n;       subbuffer size in 32-bit words is stored in the first 24 bits of&n;       register 0x004. The last 8 bits of register 0x004 contain the number&n;       of subbuffers.&n;       &n;       the first 30 bits of register 0x000 contain the address of the first&n;       subbuffer. The last 2 bits contain 0, when dma1 is disabled and 1,&n;       when dma1 is enabled.&n;&n;       the first 30 bits of register 0x00C contain the address of the second&n;       subbuffer. the last 2 bits contain 1.&n;&n;       register 0x008 will contain the address of the subbuffer that was filled&n;       with TS data, when FlexCopII will generate an interrupt.&n;&n;   For DMA2:&n;       subbuffer size in 32-bit words is stored in the first 24 bits of&n;       register 0x014. The last 8 bits of register 0x014 contain the number&n;       of subbuffers.&n;       &n;       the first 30 bits of register 0x010 contain the address of the first&n;       subbuffer.  The last 2 bits contain 0, when dma1 is disabled and 1,&n;       when dma1 is enabled.&n;&n;       the first 30 bits of register 0x01C contain the address of the second&n;       subbuffer. the last 2 bits contain 1.&n;&n;       register 0x018 contains the address of the subbuffer that was filled&n;       with TS data, when FlexCopII generates an interrupt.&n;*/
DECL|function|DmaInitDMA
r_static
r_int
id|DmaInitDMA
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|dma_channel
)paren
(brace
id|u32
id|subbuffers
comma
id|subbufsize
comma
id|subbuf0
comma
id|subbuf1
suffix:semicolon
r_if
c_cond
(paren
id|dma_channel
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: Initializing DMA1 channel&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|subbuffers
op_assign
l_int|2
suffix:semicolon
id|subbufsize
op_assign
(paren
(paren
(paren
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_div
l_int|4
)paren
op_lshift
l_int|8
)paren
op_or
id|subbuffers
suffix:semicolon
id|subbuf0
op_assign
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xFFFFFFFC
suffix:semicolon
id|subbuf1
op_assign
(paren
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_amp
l_int|0xFFFFFFFC
)paren
op_or
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: first subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|subbuf0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: subbuffer size = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
id|subbufsize
op_rshift
l_int|8
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x004
comma
id|subbufsize
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: second subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x00C
comma
id|subbuf1
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: counter = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xFFFFFFFC
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x008
comma
id|adapter-&gt;dmaq1.bus_addr
op_amp
l_int|0xFFFFFFFC
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|subbuffers
op_eq
l_int|0
)paren
id|DmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_else
id|DmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|0
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|IrqDmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|SRAMSetMediaDest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|SRAMSetNetDest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|SRAMSetCaiDest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|SRAMSetCaoDest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_channel
op_eq
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: Initializing DMA2 channel&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|subbuffers
op_assign
l_int|2
suffix:semicolon
id|subbufsize
op_assign
(paren
(paren
(paren
id|adapter-&gt;dmaq2.buffer_size
op_div
l_int|2
)paren
op_div
l_int|4
)paren
op_lshift
l_int|8
)paren
op_or
id|subbuffers
suffix:semicolon
id|subbuf0
op_assign
id|adapter-&gt;dmaq2.bus_addr
op_amp
l_int|0xFFFFFFFC
suffix:semicolon
id|subbuf1
op_assign
(paren
(paren
id|adapter-&gt;dmaq2.bus_addr
op_plus
id|adapter-&gt;dmaq2.buffer_size
op_div
l_int|2
)paren
op_amp
l_int|0xFFFFFFFC
)paren
op_or
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: first subbuffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|subbuf0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: subbuffer size = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
id|subbufsize
op_rshift
l_int|8
)paren
op_star
l_int|4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x014
comma
id|subbufsize
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: second buffer address = 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|subbuf1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x01C
comma
id|subbuf1
)paren
suffix:semicolon
id|SRAMSetCaiDest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|CtrlEnableReceiveData
r_static
r_void
id|CtrlEnableReceiveData
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|op
)paren
(brace
r_if
c_cond
(paren
id|op
op_eq
l_int|0
)paren
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|2
comma
op_complement
l_int|0x00008000
comma
l_int|0
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000004
suffix:semicolon
)brace
r_else
(brace
id|WriteRegOp
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|1
comma
l_int|0
comma
l_int|0x00008000
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x00000004
suffix:semicolon
)brace
)brace
multiline_comment|/* bit 0 of dma_mask is set to 1 if dma1 channel has to be enabled/disabled&n;   bit 1 of dma_mask is set to 1 if dma2 channel has to be enabled/disabled&n;*/
DECL|function|DmaStartStop0x2102
r_static
r_void
id|DmaStartStop0x2102
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|dma_mask
comma
id|u32
id|start_stop
)paren
(brace
id|u32
id|dma_enable
comma
id|dma1_enable
comma
id|dma2_enable
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dma_mask=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dma_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start_stop
op_eq
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: starting dma&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dma1_enable
op_assign
l_int|0
suffix:semicolon
id|dma2_enable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq1.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|1
suffix:semicolon
id|dma1_enable
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq2.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|2
suffix:semicolon
id|dma2_enable
op_assign
l_int|1
suffix:semicolon
)brace
singleline_comment|// enable dma1 and dma2
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|1
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|1
)paren
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x00C
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// enable dma1
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|1
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|0
)paren
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x00C
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// enable dma2
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|1
)paren
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
op_or
l_int|1
)paren
suffix:semicolon
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|// start dma
r_if
c_cond
(paren
(paren
id|dma1_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
id|dma2_enable
op_eq
l_int|0
)paren
)paren
(brace
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: stoping dma&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|dma_enable
op_assign
id|adapter-&gt;dma_status
op_amp
l_int|0x00000003
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|dma_enable
op_assign
id|dma_enable
op_amp
l_int|0xFFFFFFFE
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|dma_enable
op_assign
id|dma_enable
op_amp
l_int|0xFFFFFFFD
suffix:semicolon
)brace
singleline_comment|//stop dma
r_if
c_cond
(paren
(paren
id|dma_enable
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|4
)paren
op_ne
l_int|0
)paren
)paren
(brace
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|3000
)paren
suffix:semicolon
)brace
singleline_comment|//disable dma1
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq1.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x000
comma
id|adapter-&gt;dmaq1.bus_addr
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x00C
comma
(paren
id|adapter-&gt;dmaq1.bus_addr
op_plus
id|adapter-&gt;dmaq1.buffer_size
op_div
l_int|2
)paren
op_or
l_int|1
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000001
suffix:semicolon
)brace
singleline_comment|//disable dma2
r_if
c_cond
(paren
(paren
(paren
id|dma_mask
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|adapter-&gt;dmaq2.bus_addr
op_ne
l_int|0
)paren
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x010
comma
id|adapter-&gt;dmaq2.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x00000002
suffix:semicolon
)brace
)brace
)brace
DECL|function|OpenStream
r_static
r_void
id|OpenStream
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|dma_mask
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;capturing
op_eq
l_int|0
)paren
id|adapter-&gt;capturing
op_assign
l_int|1
suffix:semicolon
id|FilterEnableMaskFilter
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|AddPID
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: adapter-&gt;dma_status=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dma_status
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|7
)paren
op_ne
l_int|7
)paren
(brace
id|dma_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x10000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|1
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|adapter-&gt;dmaq1.buffer
comma
l_int|0
comma
id|adapter-&gt;dmaq1.buffer_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x20000000
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|2
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_mask
op_ne
l_int|0
)paren
(brace
id|IrqDmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|DmaStartStop0x2102
c_func
(paren
id|adapter
comma
id|dma_mask
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|CloseStream
r_static
r_void
id|CloseStream
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u32
id|pid
)paren
(brace
id|u32
id|dma_mask
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;capturing
op_ne
l_int|0
)paren
id|adapter-&gt;capturing
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: dma_status=%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;dma_status
)paren
suffix:semicolon
id|dma_mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|0x00000001
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|2
)paren
op_ne
l_int|0
)paren
id|dma_mask
op_assign
id|dma_mask
op_or
l_int|0x00000002
suffix:semicolon
r_if
c_cond
(paren
id|dma_mask
op_ne
l_int|0
)paren
(brace
id|DmaStartStop0x2102
c_func
(paren
id|adapter
comma
id|dma_mask
comma
l_int|0
)paren
suffix:semicolon
)brace
id|RemovePID
c_func
(paren
id|adapter
comma
id|pid
)paren
suffix:semicolon
)brace
DECL|function|InterruptServiceDMA1
r_static
r_void
id|InterruptServiceDMA1
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
r_struct
id|packet_header
id|packet_header
suffix:semicolon
r_int
id|nCurDmaCounter
suffix:semicolon
id|u32
id|nNumBytesParsed
suffix:semicolon
id|u32
id|nNumNewBytesTransferred
suffix:semicolon
id|u32
id|dwDefaultPacketSize
op_assign
l_int|188
suffix:semicolon
id|u8
id|gbTmpBuffer
(braket
l_int|188
)braket
suffix:semicolon
id|u8
op_star
id|pbDMABufCurPos
suffix:semicolon
id|nCurDmaCounter
op_assign
id|readl
c_func
(paren
id|adapter-&gt;io_mem
op_plus
l_int|0x008
)paren
op_minus
id|adapter-&gt;dmaq1.bus_addr
suffix:semicolon
id|nCurDmaCounter
op_assign
(paren
id|nCurDmaCounter
op_div
id|dwDefaultPacketSize
)paren
op_star
id|dwDefaultPacketSize
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nCurDmaCounter
OL
l_int|0
)paren
op_logical_or
(paren
id|nCurDmaCounter
OG
id|adapter-&gt;dmaq1.buffer_size
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: dma counter outside dma buffer&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|adapter-&gt;dmaq1.head
op_assign
id|nCurDmaCounter
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.tail
op_le
id|nCurDmaCounter
)paren
(brace
id|nNumNewBytesTransferred
op_assign
id|nCurDmaCounter
op_minus
id|adapter-&gt;dmaq1.tail
suffix:semicolon
)brace
r_else
(brace
id|nNumNewBytesTransferred
op_assign
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
op_plus
id|nCurDmaCounter
suffix:semicolon
)brace
singleline_comment|//  dprintk(&quot;%s: nCurDmaCounter   = %d&bslash;n&quot; , __FUNCTION__, nCurDmaCounter);
singleline_comment|//&t;dprintk(&quot;%s: dmaq1.tail       = %d&bslash;n&quot; , __FUNCTION__, adapter-&gt;dmaq1.tail):
singleline_comment|//  dprintk(&quot;%s: BytesTransferred = %d&bslash;n&quot; , __FUNCTION__, nNumNewBytesTransferred);
r_if
c_cond
(paren
id|nNumNewBytesTransferred
OL
id|dwDefaultPacketSize
)paren
r_return
suffix:semicolon
id|nNumBytesParsed
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|nNumBytesParsed
OL
id|nNumNewBytesTransferred
)paren
(brace
id|pbDMABufCurPos
op_assign
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.buffer_size
OL
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
op_plus
l_int|188
)paren
(brace
id|memcpy
c_func
(paren
id|gbTmpBuffer
comma
id|adapter-&gt;dmaq1.buffer
op_plus
id|adapter-&gt;dmaq1.tail
comma
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|gbTmpBuffer
op_plus
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
comma
id|adapter-&gt;dmaq1.buffer
comma
(paren
l_int|188
op_minus
(paren
id|adapter-&gt;dmaq1.buffer_size
op_minus
id|adapter-&gt;dmaq1.tail
)paren
)paren
)paren
suffix:semicolon
id|pbDMABufCurPos
op_assign
id|gbTmpBuffer
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;capturing
op_ne
l_int|0
)paren
(brace
id|u32
op_star
id|dq
op_assign
(paren
id|u32
op_star
)paren
id|pbDMABufCurPos
suffix:semicolon
id|packet_header.sync_byte
op_assign
op_star
id|dq
op_amp
l_int|0x000000FF
suffix:semicolon
id|packet_header.transport_error_indicator
op_assign
op_star
id|dq
op_amp
l_int|0x00008000
suffix:semicolon
id|packet_header.payload_unit_start_indicator
op_assign
op_star
id|dq
op_amp
l_int|0x00004000
suffix:semicolon
id|packet_header.transport_priority
op_assign
op_star
id|dq
op_amp
l_int|0x00002000
suffix:semicolon
id|packet_header.pid
op_assign
(paren
(paren
op_star
id|dq
op_amp
l_int|0x00FF0000
)paren
op_rshift
l_int|0x10
)paren
op_or
(paren
op_star
id|dq
op_amp
l_int|0x00001F00
)paren
suffix:semicolon
id|packet_header.transport_scrambling_control
op_assign
op_star
id|dq
op_rshift
l_int|0x1E
suffix:semicolon
id|packet_header.adaptation_field_control
op_assign
(paren
op_star
id|dq
op_amp
l_int|0x30000000
)paren
op_rshift
l_int|0x1C
suffix:semicolon
id|packet_header.continuity_counter
op_assign
(paren
op_star
id|dq
op_amp
l_int|0x0F000000
)paren
op_rshift
l_int|0x18
suffix:semicolon
r_if
c_cond
(paren
(paren
id|packet_header.sync_byte
op_eq
l_int|0x47
)paren
op_logical_and
(paren
id|packet_header.transport_error_indicator
op_eq
l_int|0
)paren
op_logical_and
(paren
id|packet_header.pid
op_ne
l_int|0x1FFF
)paren
)paren
(brace
r_if
c_cond
(paren
id|CheckPID
c_func
(paren
id|adapter
comma
id|packet_header.pid
op_amp
l_int|0x0000FFFF
)paren
op_ne
l_int|0
)paren
(brace
id|dvb_dmx_swfilter_packets
c_func
(paren
id|dvbdmx
comma
id|pbDMABufCurPos
comma
id|dwDefaultPacketSize
op_div
l_int|188
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|//                  dprintk(&quot;%s: pid=%x&bslash;n&quot;, __FUNCTION__, packet_header.pid);
)brace
)brace
)brace
id|nNumBytesParsed
op_assign
id|nNumBytesParsed
op_plus
id|dwDefaultPacketSize
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
id|adapter-&gt;dmaq1.tail
op_plus
id|dwDefaultPacketSize
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.tail
op_ge
id|adapter-&gt;dmaq1.buffer_size
)paren
id|adapter-&gt;dmaq1.tail
op_assign
id|adapter-&gt;dmaq1.tail
op_minus
id|adapter-&gt;dmaq1.buffer_size
suffix:semicolon
)brace
suffix:semicolon
)brace
DECL|function|InterruptServiceDMA2
r_static
r_void
id|InterruptServiceDMA2
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
DECL|function|isr
r_static
id|irqreturn_t
id|isr
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|adapter
op_star
id|tmp
op_assign
id|dev_id
suffix:semicolon
id|u32
id|value
suffix:semicolon
singleline_comment|//  dprintk(&quot;%s:&bslash;n&quot;, __FUNCTION__);
id|spin_lock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
(paren
(paren
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|tmp
comma
l_int|0x20C
)paren
)paren
op_amp
l_int|0x0F
)paren
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
r_while
c_loop
(paren
id|value
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x03
)paren
op_ne
l_int|0
)paren
id|InterruptServiceDMA1
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_amp
l_int|0x0C
)paren
op_ne
l_int|0
)paren
id|InterruptServiceDMA2
c_func
(paren
id|tmp
)paren
suffix:semicolon
id|value
op_assign
id|ReadRegDW
c_func
(paren
id|tmp
comma
l_int|0x20C
)paren
op_amp
l_int|0x0F
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|tmp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|Initdmaqueue
r_static
r_void
id|Initdmaqueue
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dma_addr_t
id|dma_addr
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
r_return
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SizeOfBufDMA1
op_plus
l_int|0x80
comma
op_amp
id|dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|adapter-&gt;dmaq1.buffer
comma
l_int|0
comma
id|SizeOfBufDMA1
)paren
suffix:semicolon
id|adapter-&gt;dmaq1.bus_addr
op_assign
id|dma_addr
suffix:semicolon
id|adapter-&gt;dmaq1.buffer_size
op_assign
id|SizeOfBufDMA1
suffix:semicolon
id|DmaInitDMA
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x10000000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: allocated dma buffer at 0x%x, length=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
r_int
)paren
id|adapter-&gt;dmaq1.buffer
comma
id|SizeOfBufDMA1
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x10000000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
r_return
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
id|pci_alloc_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SizeOfBufDMA2
op_plus
l_int|0x80
comma
op_amp
id|dma_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|adapter-&gt;dmaq2.buffer
comma
l_int|0
comma
id|SizeOfBufDMA2
)paren
suffix:semicolon
id|adapter-&gt;dmaq2.bus_addr
op_assign
id|dma_addr
suffix:semicolon
id|adapter-&gt;dmaq2.buffer_size
op_assign
id|SizeOfBufDMA2
suffix:semicolon
id|DmaInitDMA
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_or
l_int|0x20000000
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: allocated dma buffer at 0x%x, length=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
r_int
)paren
id|adapter-&gt;dmaq2.buffer
comma
(paren
r_int
)paren
id|SizeOfBufDMA2
)paren
suffix:semicolon
)brace
r_else
(brace
id|adapter-&gt;dma_status
op_assign
id|adapter-&gt;dma_status
op_amp
op_complement
l_int|0x20000000
suffix:semicolon
)brace
)brace
DECL|function|Freedmaqueue
r_static
r_void
id|Freedmaqueue
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq1.buffer
op_ne
l_int|0
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SizeOfBufDMA1
op_plus
l_int|0x80
comma
id|adapter-&gt;dmaq1.buffer
comma
id|adapter-&gt;dmaq1.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dmaq1.bus_addr
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer_size
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq1.buffer
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|adapter-&gt;dmaq2.buffer
op_ne
l_int|0
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|adapter-&gt;pdev
comma
id|SizeOfBufDMA2
op_plus
l_int|0x80
comma
id|adapter-&gt;dmaq2.buffer
comma
id|adapter-&gt;dmaq2.bus_addr
)paren
suffix:semicolon
id|adapter-&gt;dmaq2.bus_addr
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.head
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.tail
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer_size
op_assign
l_int|0
suffix:semicolon
id|adapter-&gt;dmaq2.buffer
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|FreeAdapterObject
r_static
r_void
id|FreeAdapterObject
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s:&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|CloseStream
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;irq
op_ne
l_int|0
)paren
id|free_irq
c_func
(paren
id|adapter-&gt;irq
comma
id|adapter
)paren
suffix:semicolon
id|Freedmaqueue
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;io_mem
op_ne
l_int|0
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|adapter-&gt;io_mem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter
op_ne
l_int|0
)paren
id|kfree
c_func
(paren
id|adapter
)paren
suffix:semicolon
)brace
DECL|variable|skystar2_pci_driver
r_static
r_struct
id|pci_driver
id|skystar2_pci_driver
suffix:semicolon
DECL|function|ClaimAdapter
r_static
r_int
id|ClaimAdapter
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
op_assign
id|adapter-&gt;pdev
suffix:semicolon
id|u16
id|var
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|skystar2_pci_driver.name
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|skystar2_pci_driver.name
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|adapter-&gt;card_revision
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: card revision %x &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;card_revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pdev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pdev
comma
l_int|4
comma
op_amp
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|var
op_amp
l_int|4
)paren
op_eq
l_int|0
)paren
id|pci_set_master
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|adapter-&gt;io_port
op_assign
id|pdev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
suffix:semicolon
id|adapter-&gt;io_mem
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|pdev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
l_int|0x800
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;io_mem
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: can not map io memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;%s: io memory maped at %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;io_mem
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;static int SLL_reset_FlexCOP(struct adapter *adapter)&n;{&n;&t;WriteRegDW(adapter, 0x208, 0);&n;&t;WriteRegDW(adapter, 0x210, 0xB2FF);&n;&n;&t;return 0;&n;}&n;*/
DECL|function|DriverInitialize
r_static
r_int
id|DriverInitialize
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
id|u32
id|tmp
suffix:semicolon
id|u8
id|key
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|adapter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|adapter
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: out of memory!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|adapter
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|adapter
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
id|adapter
)paren
suffix:semicolon
id|adapter-&gt;pdev
op_assign
id|pdev
suffix:semicolon
id|adapter-&gt;irq
op_assign
id|pdev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ClaimAdapter
c_func
(paren
id|adapter
)paren
)paren
op_ne
l_int|1
)paren
(brace
id|FreeAdapterObject
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|IrqDmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pdev-&gt;irq
comma
id|isr
comma
l_int|0x4000000
comma
l_string|&quot;Skystar2&quot;
comma
id|adapter
)paren
op_ne
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: unable to allocate irq=%d !&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|pdev-&gt;irq
)paren
suffix:semicolon
id|FreeAdapterObject
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x210
comma
l_int|0xB2FF
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x208
comma
l_int|0x40
)paren
suffix:semicolon
id|InitPIDsInfo
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|PidSetGroupPID
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|PidSetGroupMASK
c_func
(paren
id|adapter
comma
l_int|0x1FE0
)paren
suffix:semicolon
id|PidSetStream1PID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|PidSetStream2PID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|PidSetPmtPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|PidSetPcrPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|PidSetEcmPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|PidSetEmmPID
c_func
(paren
id|adapter
comma
l_int|0x1FFF
)paren
suffix:semicolon
id|Initdmaqueue
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;dma_status
op_amp
l_int|0x30000000
)paren
op_eq
l_int|0
)paren
(brace
id|FreeAdapterObject
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|adapter-&gt;b2c2_revision
op_assign
(paren
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
op_rshift
l_int|0x18
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|adapter-&gt;b2c2_revision
op_ne
l_int|0x82
)paren
op_logical_and
(paren
id|adapter-&gt;b2c2_revision
op_ne
l_int|0xC3
)paren
)paren
r_if
c_cond
(paren
id|adapter-&gt;b2c2_revision
op_ne
l_int|0x82
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: The revision of the FlexCopII chip on your card is - %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;b2c2_revision
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: This driver works now only with FlexCopII(rev.130) and FlexCopIIB(rev.195).&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|FreeAdapterObject
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|tmp
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
comma
l_int|0
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
comma
id|tmp
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|tmp
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
)paren
suffix:semicolon
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x308
comma
l_int|0x4000
op_or
id|tmp
)paren
suffix:semicolon
id|adapter-&gt;dwSramType
op_assign
l_int|0x10000
suffix:semicolon
id|SLL_detectSramSize
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s sram length = %d, sram type= %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SRAM_length
c_func
(paren
id|adapter
)paren
comma
id|adapter-&gt;dwSramType
)paren
suffix:semicolon
id|SRAMSetMediaDest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|SRAMSetNetDest
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
id|CtrlEnableSmc
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|SRAMSetCaiDest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|SRAMSetCaoDest
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
id|DmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|EEPROM_getMacAddr
c_func
(paren
id|adapter
comma
l_int|0
comma
id|adapter-&gt;mac_addr
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s MAC address = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|adapter-&gt;mac_addr
(braket
l_int|0
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|1
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|2
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|3
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|4
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|5
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|6
)braket
comma
id|adapter-&gt;mac_addr
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|CASetMacDstAddrFilter
c_func
(paren
id|adapter
comma
id|adapter-&gt;mac_addr
)paren
suffix:semicolon
id|CtrlEnableMAC
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
)brace
id|EEPROM_readKey
c_func
(paren
id|adapter
comma
id|key
comma
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s key = &bslash;n %02x %02x %02x %02x &bslash;n %02x %02x %02x %02x &bslash;n %02x %02x %02x %02x &bslash;n %02x %02x %02x %02x &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|key
(braket
l_int|0
)braket
comma
id|key
(braket
l_int|1
)braket
comma
id|key
(braket
l_int|2
)braket
comma
id|key
(braket
l_int|3
)braket
comma
id|key
(braket
l_int|4
)braket
comma
id|key
(braket
l_int|5
)braket
comma
id|key
(braket
l_int|6
)braket
comma
id|key
(braket
l_int|7
)braket
comma
id|key
(braket
l_int|8
)braket
comma
id|key
(braket
l_int|9
)braket
comma
id|key
(braket
l_int|10
)braket
comma
id|key
(braket
l_int|11
)braket
comma
id|key
(braket
l_int|12
)braket
comma
id|key
(braket
l_int|13
)braket
comma
id|key
(braket
l_int|14
)braket
comma
id|key
(braket
l_int|15
)braket
)paren
suffix:semicolon
id|adapter-&gt;lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|DriverHalt
r_static
r_void
id|DriverHalt
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
id|adapter
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|IrqDmaEnableDisableIrq
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|CtrlEnableReceiveData
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
id|FreeAdapterObject
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pdev
comma
l_int|NULL
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|1
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|1
)paren
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pdev
comma
l_int|0
)paren
comma
id|pci_resource_len
c_func
(paren
id|pdev
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|dvb_start_feed
r_static
r_int
id|dvb_start_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|adapter
op_star
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|dvbdmx-&gt;priv
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: PID=%d, type=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dvbdmxfeed-&gt;pid
comma
id|dvbdmxfeed-&gt;type
)paren
suffix:semicolon
id|OpenStream
c_func
(paren
id|adapter
comma
id|dvbdmxfeed-&gt;pid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dvb_stop_feed
r_static
r_int
id|dvb_stop_feed
c_func
(paren
r_struct
id|dvb_demux_feed
op_star
id|dvbdmxfeed
)paren
(brace
r_struct
id|dvb_demux
op_star
id|dvbdmx
op_assign
id|dvbdmxfeed-&gt;demux
suffix:semicolon
r_struct
id|adapter
op_star
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|dvbdmx-&gt;priv
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: PID=%d, type=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|dvbdmxfeed-&gt;pid
comma
id|dvbdmxfeed-&gt;type
)paren
suffix:semicolon
id|CloseStream
c_func
(paren
id|adapter
comma
id|dvbdmxfeed-&gt;pid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* lnb control */
DECL|function|set_tuner_tone
r_static
r_void
id|set_tuner_tone
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|tone
)paren
(brace
id|u16
id|wzHalfPeriodFor45MHz
(braket
)braket
op_assign
(brace
l_int|0x01FF
comma
l_int|0x0154
comma
l_int|0x00FF
comma
l_int|0x00CC
)brace
suffix:semicolon
id|u16
id|ax
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: %u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|tone
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|tone
)paren
(brace
r_case
l_int|1
suffix:colon
id|ax
op_assign
id|wzHalfPeriodFor45MHz
(braket
l_int|0
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ax
op_assign
id|wzHalfPeriodFor45MHz
(braket
l_int|1
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ax
op_assign
id|wzHalfPeriodFor45MHz
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|ax
op_assign
id|wzHalfPeriodFor45MHz
(braket
l_int|3
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ax
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ax
op_ne
l_int|0
)paren
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x200
comma
(paren
(paren
id|ax
op_lshift
l_int|0x0F
)paren
op_plus
(paren
id|ax
op_amp
l_int|0x7FFF
)paren
)paren
op_or
l_int|0x40000000
)paren
suffix:semicolon
)brace
r_else
(brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x200
comma
l_int|0x40FF8000
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_tuner_polarity
r_static
r_void
id|set_tuner_polarity
c_func
(paren
r_struct
id|adapter
op_star
id|adapter
comma
id|u8
id|polarity
)paren
(brace
id|u32
id|var
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s : polarity = %u &bslash;n&quot;
comma
id|__FUNCTION__
comma
id|polarity
)paren
suffix:semicolon
id|var
op_assign
id|ReadRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
)paren
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|0
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: LNB power off&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|var
op_assign
id|var
op_or
l_int|1
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|1
)paren
(brace
id|var
op_assign
id|var
op_amp
op_complement
l_int|1
suffix:semicolon
id|var
op_assign
id|var
op_amp
op_complement
l_int|4
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|polarity
op_eq
l_int|2
)paren
(brace
id|var
op_assign
id|var
op_amp
op_complement
l_int|1
suffix:semicolon
id|var
op_assign
id|var
op_or
l_int|4
suffix:semicolon
)brace
id|WriteRegDW
c_func
(paren
id|adapter
comma
l_int|0x204
comma
id|var
)paren
suffix:semicolon
)brace
DECL|function|flexcop_diseqc_ioctl
r_static
r_int
id|flexcop_diseqc_ioctl
c_func
(paren
r_struct
id|dvb_frontend
op_star
id|fe
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
op_assign
id|fe-&gt;before_after_data
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FE_SLEEP
suffix:colon
(brace
id|printk
c_func
(paren
l_string|&quot;%s: FE_SLEEP&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// return -EOPNOTSUPP, to make DVB core also send &quot;FE_SLEEP&quot; command to frontend.
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_case
id|FE_SET_VOLTAGE
suffix:colon
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: FE_SET_VOLTAGE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|fe_sec_voltage_t
)paren
id|arg
)paren
(brace
r_case
id|SEC_VOLTAGE_13
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: SEC_VOLTAGE_13, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_VOLTAGE_13
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEC_VOLTAGE_18
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: SEC_VOLTAGE_18, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_VOLTAGE_18
)paren
suffix:semicolon
id|set_tuner_polarity
c_func
(paren
id|adapter
comma
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|FE_SET_TONE
suffix:colon
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: FE_SET_TONE&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|fe_sec_tone_mode_t
)paren
id|arg
)paren
(brace
r_case
id|SEC_TONE_ON
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: SEC_TONE_ON, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_TONE_ON
)paren
suffix:semicolon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SEC_TONE_OFF
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: SEC_TONE_OFF, %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|SEC_TONE_OFF
)paren
suffix:semicolon
id|set_tuner_tone
c_func
(paren
id|adapter
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|skystar2_probe
r_static
r_int
id|skystar2_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ent
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|dvb_adapter
op_star
id|dvb_adapter
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdemux
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|pdev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|DriverInitialize
c_func
(paren
id|pdev
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|dvb_register_adapter
c_func
(paren
op_amp
id|dvb_adapter
comma
id|skystar2_pci_driver.name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dvb_adapter
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error registering DVB adapter&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|DriverHalt
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|adapter
op_assign
(paren
r_struct
id|adapter
op_star
)paren
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
id|adapter-&gt;dvb_adapter
op_assign
id|dvb_adapter
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|adapter-&gt;i2c_sem
)paren
suffix:semicolon
id|adapter-&gt;i2c_bus
op_assign
id|dvb_register_i2c_bus
c_func
(paren
id|master_xfer
comma
id|adapter
comma
id|adapter-&gt;dvb_adapter
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;i2c_bus
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dvb_add_frontend_ioctls
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
id|flexcop_diseqc_ioctl
comma
l_int|NULL
comma
id|adapter
)paren
suffix:semicolon
id|dvbdemux
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
id|dvbdemux-&gt;priv
op_assign
(paren
r_void
op_star
)paren
id|adapter
suffix:semicolon
id|dvbdemux-&gt;filternum
op_assign
l_int|32
suffix:semicolon
id|dvbdemux-&gt;feednum
op_assign
l_int|32
suffix:semicolon
id|dvbdemux-&gt;start_feed
op_assign
id|dvb_start_feed
suffix:semicolon
id|dvbdemux-&gt;stop_feed
op_assign
id|dvb_stop_feed
suffix:semicolon
id|dvbdemux-&gt;write_to_decoder
op_assign
l_int|0
suffix:semicolon
id|dvbdemux-&gt;dmx.capabilities
op_assign
(paren
id|DMX_TS_FILTERING
op_or
id|DMX_SECTION_FILTERING
op_or
id|DMX_MEMORY_BASED_FILTERING
)paren
suffix:semicolon
id|dvb_dmx_init
c_func
(paren
op_amp
id|adapter-&gt;demux
)paren
suffix:semicolon
id|adapter-&gt;hw_frontend.source
op_assign
id|DMX_FRONTEND_0
suffix:semicolon
id|adapter-&gt;dmxdev.filternum
op_assign
l_int|32
suffix:semicolon
id|adapter-&gt;dmxdev.demux
op_assign
op_amp
id|dvbdemux-&gt;dmx
suffix:semicolon
id|adapter-&gt;dmxdev.capabilities
op_assign
l_int|0
suffix:semicolon
id|dvb_dmxdev_init
c_func
(paren
op_amp
id|adapter-&gt;dmxdev
comma
id|adapter-&gt;dvb_adapter
)paren
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|add_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|adapter-&gt;mem_frontend.source
op_assign
id|DMX_MEMORY_FE
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|add_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;mem_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|dvbdemux-&gt;dmx
dot
id|connect_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|dvb_net_init
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
op_amp
id|adapter-&gt;dvbnet
comma
op_amp
id|dvbdemux-&gt;dmx
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|skystar2_remove
r_static
r_void
id|skystar2_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_struct
id|adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|dvb_demux
op_star
id|dvbdemux
suffix:semicolon
r_if
c_cond
(paren
id|pdev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|adapter
op_assign
id|pci_get_drvdata
c_func
(paren
id|pdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter
op_ne
l_int|NULL
)paren
(brace
id|dvb_net_release
c_func
(paren
op_amp
id|adapter-&gt;dvbnet
)paren
suffix:semicolon
id|dvbdemux
op_assign
op_amp
id|adapter-&gt;demux
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|close
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
)paren
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|remove_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;hw_frontend
)paren
suffix:semicolon
id|dvbdemux-&gt;dmx
dot
id|remove_frontend
c_func
(paren
op_amp
id|dvbdemux-&gt;dmx
comma
op_amp
id|adapter-&gt;mem_frontend
)paren
suffix:semicolon
id|dvb_dmxdev_release
c_func
(paren
op_amp
id|adapter-&gt;dmxdev
)paren
suffix:semicolon
id|dvb_dmx_release
c_func
(paren
op_amp
id|adapter-&gt;demux
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;dvb_adapter
op_ne
l_int|NULL
)paren
(brace
id|dvb_remove_frontend_ioctls
c_func
(paren
id|adapter-&gt;dvb_adapter
comma
id|flexcop_diseqc_ioctl
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;i2c_bus
op_ne
l_int|NULL
)paren
id|dvb_unregister_i2c_bus
c_func
(paren
id|master_xfer
comma
id|adapter-&gt;i2c_bus-&gt;adapter
comma
id|adapter-&gt;i2c_bus-&gt;id
)paren
suffix:semicolon
id|dvb_unregister_adapter
c_func
(paren
id|adapter-&gt;dvb_adapter
)paren
suffix:semicolon
)brace
id|DriverHalt
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
)brace
DECL|variable|skystar2_pci_tbl
r_static
r_struct
id|pci_device_id
id|skystar2_pci_tbl
(braket
)braket
op_assign
(brace
(brace
l_int|0x000013D0
comma
l_int|0x00002103
comma
l_int|0xFFFFFFFF
comma
l_int|0xFFFFFFFF
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
l_int|0x00000000
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|skystar2_pci_driver
r_static
r_struct
id|pci_driver
id|skystar2_pci_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Technisat SkyStar2 driver&quot;
comma
dot
id|id_table
op_assign
id|skystar2_pci_tbl
comma
dot
id|probe
op_assign
id|skystar2_probe
comma
dot
id|remove
op_assign
id|skystar2_remove
comma
)brace
suffix:semicolon
DECL|function|skystar2_init
r_static
r_int
id|skystar2_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|skystar2_pci_driver
)paren
suffix:semicolon
)brace
DECL|function|skystar2_cleanup
r_static
r_void
id|skystar2_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|skystar2_pci_driver
)paren
suffix:semicolon
)brace
DECL|variable|skystar2_init
id|module_init
c_func
(paren
id|skystar2_init
)paren
suffix:semicolon
DECL|variable|skystar2_cleanup
id|module_exit
c_func
(paren
id|skystar2_cleanup
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Technisat SkyStar2 DVB PCI Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
