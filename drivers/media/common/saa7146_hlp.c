macro_line|#include &lt;media/saa7146_vv.h&gt;
DECL|macro|my_min
mdefine_line|#define my_min(type,x,y) &bslash;&n;&t;({ type __x = (x), __y = (y); __x &lt; __y ? __x: __y; })
DECL|macro|my_max
mdefine_line|#define my_max(type,x,y) &bslash;&n;&t;({ type __x = (x), __y = (y); __x &gt; __y ? __x: __y; })
DECL|function|calculate_output_format_register
r_static
r_void
id|calculate_output_format_register
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|saa
comma
id|u32
id|palette
comma
id|u32
op_star
id|clip_format
)paren
(brace
multiline_comment|/* clear out the necessary bits */
op_star
id|clip_format
op_and_assign
l_int|0x0000ffff
suffix:semicolon
multiline_comment|/* set these bits new */
op_star
id|clip_format
op_or_assign
(paren
(paren
(paren
(paren
id|palette
op_amp
l_int|0xf00
)paren
op_rshift
l_int|8
)paren
op_lshift
l_int|30
)paren
op_or
(paren
(paren
id|palette
op_amp
l_int|0x00f
)paren
op_lshift
l_int|24
)paren
op_or
(paren
(paren
(paren
id|palette
op_amp
l_int|0x0f0
)paren
op_rshift
l_int|4
)paren
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
DECL|function|calculate_bcs_ctrl_register
r_static
r_void
id|calculate_bcs_ctrl_register
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|brightness
comma
r_int
id|contrast
comma
r_int
id|colour
comma
id|u32
op_star
id|bcs_ctrl
)paren
(brace
op_star
id|bcs_ctrl
op_assign
(paren
(paren
id|brightness
op_lshift
l_int|24
)paren
op_or
(paren
id|contrast
op_lshift
l_int|16
)paren
op_or
(paren
id|colour
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
)brace
DECL|function|calculate_hps_source_and_sync
r_static
r_void
id|calculate_hps_source_and_sync
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|source
comma
r_int
id|sync
comma
id|u32
op_star
id|hps_ctrl
)paren
(brace
op_star
id|hps_ctrl
op_and_assign
op_complement
(paren
id|MASK_30
op_or
id|MASK_31
op_or
id|MASK_28
)paren
suffix:semicolon
op_star
id|hps_ctrl
op_or_assign
(paren
id|source
op_lshift
l_int|30
)paren
op_or
(paren
id|sync
op_lshift
l_int|28
)paren
suffix:semicolon
)brace
DECL|function|calculate_hxo_and_hyo
r_static
r_void
id|calculate_hxo_and_hyo
c_func
(paren
r_struct
id|saa7146_vv
op_star
id|vv
comma
id|u32
op_star
id|hps_h_scale
comma
id|u32
op_star
id|hps_ctrl
)paren
(brace
r_int
id|hyo
op_assign
l_int|0
comma
id|hxo
op_assign
l_int|0
suffix:semicolon
id|hyo
op_assign
id|vv-&gt;standard-&gt;v_offset
suffix:semicolon
id|hxo
op_assign
id|vv-&gt;standard-&gt;h_offset
suffix:semicolon
op_star
id|hps_h_scale
op_and_assign
op_complement
(paren
id|MASK_B0
op_or
l_int|0xf00
)paren
suffix:semicolon
op_star
id|hps_h_scale
op_or_assign
(paren
id|hxo
op_lshift
l_int|0
)paren
suffix:semicolon
op_star
id|hps_ctrl
op_and_assign
op_complement
(paren
id|MASK_W0
op_or
id|MASK_B2
)paren
suffix:semicolon
op_star
id|hps_ctrl
op_or_assign
(paren
id|hyo
op_lshift
l_int|12
)paren
suffix:semicolon
)brace
multiline_comment|/* helper functions for the calculation of the horizontal- and vertical&n;   scaling registers, clip-format-register etc ...&n;   these functions take pointers to the (most-likely read-out&n;   original-values) and manipulate them according to the requested&n;   changes.&n;*/
multiline_comment|/* hps_coeff used for CXY and CXUV; scale 1/1 -&gt; scale 1/64 */
r_static
r_struct
(brace
DECL|member|hps_coeff
id|u16
id|hps_coeff
suffix:semicolon
DECL|member|weight_sum
id|u16
id|weight_sum
suffix:semicolon
DECL|variable|hps_h_coeff_tab
)brace
id|hps_h_coeff_tab
(braket
)braket
op_assign
(brace
(brace
l_int|0x00
comma
l_int|2
)brace
comma
(brace
l_int|0x02
comma
l_int|4
)brace
comma
(brace
l_int|0x00
comma
l_int|4
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x08
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0x1E
comma
l_int|16
)brace
comma
(brace
l_int|0x0E
comma
l_int|8
)brace
comma
(brace
l_int|0x26
comma
l_int|8
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x42
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x80
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|16
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0x7E
comma
l_int|8
)brace
comma
(brace
l_int|0x7E
comma
l_int|8
)brace
comma
(brace
l_int|0x3E
comma
l_int|8
)brace
comma
(brace
l_int|0x3E
comma
l_int|8
)brace
comma
(brace
l_int|0x1E
comma
l_int|8
)brace
comma
(brace
l_int|0x1E
comma
l_int|8
)brace
comma
(brace
l_int|0x0E
comma
l_int|8
)brace
comma
(brace
l_int|0x0E
comma
l_int|8
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|16
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|8
)brace
comma
(brace
l_int|0x7E
comma
l_int|8
)brace
comma
(brace
l_int|0x7E
comma
l_int|8
)brace
comma
(brace
l_int|0x3E
comma
l_int|8
)brace
comma
(brace
l_int|0x3E
comma
l_int|8
)brace
comma
(brace
l_int|0x1E
comma
l_int|8
)brace
comma
(brace
l_int|0x1E
comma
l_int|8
)brace
comma
(brace
l_int|0x0E
comma
l_int|8
)brace
comma
(brace
l_int|0x0E
comma
l_int|8
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x06
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x02
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0x00
comma
l_int|8
)brace
comma
(brace
l_int|0xFE
comma
l_int|16
)brace
)brace
suffix:semicolon
multiline_comment|/* table of attenuation values for horizontal scaling */
DECL|variable|h_attenuation
id|u8
id|h_attenuation
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|16
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* calculate horizontal scale registers */
DECL|function|calculate_h_scale_registers
r_static
r_int
id|calculate_h_scale_registers
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|in_x
comma
r_int
id|out_x
comma
r_int
id|flip_lr
comma
id|u32
op_star
id|hps_ctrl
comma
id|u32
op_star
id|hps_v_gain
comma
id|u32
op_star
id|hps_h_prescale
comma
id|u32
op_star
id|hps_h_scale
)paren
(brace
multiline_comment|/* horizontal prescaler */
id|u32
id|dcgx
op_assign
l_int|0
comma
id|xpsc
op_assign
l_int|0
comma
id|xacm
op_assign
l_int|0
comma
id|cxy
op_assign
l_int|0
comma
id|cxuv
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* horizontal scaler */
id|u32
id|xim
op_assign
l_int|0
comma
id|xp
op_assign
l_int|0
comma
id|xsci
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* vertical scale &amp; gain */
id|u32
id|pfuv
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* helper variables */
id|u32
id|h_atten
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|out_x
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* mask out vanity-bit */
op_star
id|hps_ctrl
op_and_assign
op_complement
id|MASK_29
suffix:semicolon
multiline_comment|/* calculate prescale-(xspc)-value:&t;[n   .. 1/2) : 1&n;&t;&t;&t;&t;    &t;&t;[1/2 .. 1/3) : 2&n;&t;&t;&t;&t;    &t;&t;[1/3 .. 1/4) : 3&n;&t;&t;&t;&t;&t;&t;... &t;&t;*/
r_if
c_cond
(paren
id|in_x
OG
id|out_x
)paren
(brace
id|xpsc
op_assign
id|in_x
op_div
id|out_x
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* zooming */
id|xpsc
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* if flip_lr-bit is set, number of pixels after&n;&t;   horizontal prescaling must be &lt; 384 */
r_if
c_cond
(paren
l_int|0
op_ne
id|flip_lr
)paren
(brace
multiline_comment|/* set vanity bit */
op_star
id|hps_ctrl
op_or_assign
id|MASK_29
suffix:semicolon
r_while
c_loop
(paren
id|in_x
op_div
id|xpsc
op_ge
l_int|384
)paren
id|xpsc
op_increment
suffix:semicolon
)brace
multiline_comment|/* if zooming is wanted, number of pixels after&n;&t;   horizontal prescaling must be &lt; 768 */
r_else
(brace
r_while
c_loop
(paren
id|in_x
op_div
id|xpsc
op_ge
l_int|768
)paren
id|xpsc
op_increment
suffix:semicolon
)brace
multiline_comment|/* maximum prescale is 64 (p.69) */
r_if
c_cond
(paren
id|xpsc
OG
l_int|64
)paren
id|xpsc
op_assign
l_int|64
suffix:semicolon
multiline_comment|/* keep xacm clear*/
id|xacm
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set horizontal filter parameters (CXY = CXUV) */
id|cxy
op_assign
id|hps_h_coeff_tab
(braket
(paren
(paren
id|xpsc
op_minus
l_int|1
)paren
OL
l_int|63
ques
c_cond
(paren
id|xpsc
op_minus
l_int|1
)paren
suffix:colon
l_int|63
)paren
)braket
dot
id|hps_coeff
suffix:semicolon
id|cxuv
op_assign
id|cxy
suffix:semicolon
multiline_comment|/* calculate and set horizontal fine scale (xsci) */
multiline_comment|/* bypass the horizontal scaler ? */
r_if
c_cond
(paren
(paren
id|in_x
op_eq
id|out_x
)paren
op_logical_and
(paren
l_int|1
op_eq
id|xpsc
)paren
)paren
id|xsci
op_assign
l_int|0x400
suffix:semicolon
r_else
id|xsci
op_assign
(paren
(paren
l_int|1024
op_star
id|in_x
)paren
op_div
(paren
id|out_x
op_star
id|xpsc
)paren
)paren
op_plus
id|xpsc
suffix:semicolon
multiline_comment|/* set start phase for horizontal fine scale (xp) to 0 */
id|xp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set xim, if we bypass the horizontal scaler */
r_if
c_cond
(paren
l_int|0x400
op_eq
id|xsci
)paren
id|xim
op_assign
l_int|1
suffix:semicolon
r_else
id|xim
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* if the prescaler is bypassed, enable horizontal&n;&t;   accumulation mode (xacm) and clear dcgx */
r_if
c_cond
(paren
l_int|1
op_eq
id|xpsc
)paren
(brace
id|xacm
op_assign
l_int|1
suffix:semicolon
id|dcgx
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|xacm
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* get best match in the table of attenuations&n;&t;&t;   for horizontal scaling */
id|h_atten
op_assign
id|hps_h_coeff_tab
(braket
(paren
(paren
id|xpsc
op_minus
l_int|1
)paren
OL
l_int|63
ques
c_cond
(paren
id|xpsc
op_minus
l_int|1
)paren
suffix:colon
l_int|63
)paren
)braket
dot
id|weight_sum
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|h_attenuation
(braket
id|i
)braket
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|h_attenuation
(braket
id|i
)braket
op_ge
id|h_atten
)paren
r_break
suffix:semicolon
)brace
id|dcgx
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/* the horizontal scaling increment controls the UV filter&n;&t;   to reduce the bandwith to improve the display quality,&n;&t;   so set it ... */
r_if
c_cond
(paren
id|xsci
op_eq
l_int|0x400
)paren
id|pfuv
op_assign
l_int|0x00
suffix:semicolon
r_else
r_if
c_cond
(paren
id|xsci
OL
l_int|0x600
)paren
id|pfuv
op_assign
l_int|0x01
suffix:semicolon
r_else
r_if
c_cond
(paren
id|xsci
OL
l_int|0x680
)paren
id|pfuv
op_assign
l_int|0x11
suffix:semicolon
r_else
r_if
c_cond
(paren
id|xsci
OL
l_int|0x700
)paren
id|pfuv
op_assign
l_int|0x22
suffix:semicolon
r_else
id|pfuv
op_assign
l_int|0x33
suffix:semicolon
op_star
id|hps_v_gain
op_and_assign
id|MASK_W0
op_or
id|MASK_B2
suffix:semicolon
op_star
id|hps_v_gain
op_or_assign
(paren
id|pfuv
op_lshift
l_int|24
)paren
suffix:semicolon
op_star
id|hps_h_scale
op_and_assign
op_complement
(paren
id|MASK_W1
op_or
l_int|0xf000
)paren
suffix:semicolon
op_star
id|hps_h_scale
op_or_assign
(paren
id|xim
op_lshift
l_int|31
)paren
op_or
(paren
id|xp
op_lshift
l_int|24
)paren
op_or
(paren
id|xsci
op_lshift
l_int|12
)paren
suffix:semicolon
op_star
id|hps_h_prescale
op_or_assign
(paren
id|dcgx
op_lshift
l_int|27
)paren
op_or
(paren
(paren
id|xpsc
op_minus
l_int|1
)paren
op_lshift
l_int|18
)paren
op_or
(paren
id|xacm
op_lshift
l_int|17
)paren
op_or
(paren
id|cxy
op_lshift
l_int|8
)paren
op_or
(paren
id|cxuv
op_lshift
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|hps_coeff
id|u16
id|hps_coeff
suffix:semicolon
DECL|member|weight_sum
id|u16
id|weight_sum
suffix:semicolon
DECL|variable|hps_v_coeff_tab
)brace
id|hps_v_coeff_tab
(braket
)braket
op_assign
(brace
(brace
l_int|0x0100
comma
l_int|2
)brace
comma
(brace
l_int|0x0102
comma
l_int|4
)brace
comma
(brace
l_int|0x0300
comma
l_int|4
)brace
comma
(brace
l_int|0x0106
comma
l_int|8
)brace
comma
(brace
l_int|0x0502
comma
l_int|8
)brace
comma
(brace
l_int|0x0708
comma
l_int|8
)brace
comma
(brace
l_int|0x0F00
comma
l_int|8
)brace
comma
(brace
l_int|0x011E
comma
l_int|16
)brace
comma
(brace
l_int|0x110E
comma
l_int|16
)brace
comma
(brace
l_int|0x1926
comma
l_int|16
)brace
comma
(brace
l_int|0x3906
comma
l_int|16
)brace
comma
(brace
l_int|0x3D42
comma
l_int|16
)brace
comma
(brace
l_int|0x7D02
comma
l_int|16
)brace
comma
(brace
l_int|0x7F80
comma
l_int|16
)brace
comma
(brace
l_int|0xFF00
comma
l_int|16
)brace
comma
(brace
l_int|0x01FE
comma
l_int|32
)brace
comma
(brace
l_int|0x01FE
comma
l_int|32
)brace
comma
(brace
l_int|0x817E
comma
l_int|32
)brace
comma
(brace
l_int|0x817E
comma
l_int|32
)brace
comma
(brace
l_int|0xC13E
comma
l_int|32
)brace
comma
(brace
l_int|0xC13E
comma
l_int|32
)brace
comma
(brace
l_int|0xE11E
comma
l_int|32
)brace
comma
(brace
l_int|0xE11E
comma
l_int|32
)brace
comma
(brace
l_int|0xF10E
comma
l_int|32
)brace
comma
(brace
l_int|0xF10E
comma
l_int|32
)brace
comma
(brace
l_int|0xF906
comma
l_int|32
)brace
comma
(brace
l_int|0xF906
comma
l_int|32
)brace
comma
(brace
l_int|0xFD02
comma
l_int|32
)brace
comma
(brace
l_int|0xFD02
comma
l_int|32
)brace
comma
(brace
l_int|0xFF00
comma
l_int|32
)brace
comma
(brace
l_int|0xFF00
comma
l_int|32
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|64
)brace
comma
(brace
l_int|0x817E
comma
l_int|64
)brace
comma
(brace
l_int|0x817E
comma
l_int|64
)brace
comma
(brace
l_int|0xC13E
comma
l_int|64
)brace
comma
(brace
l_int|0xC13E
comma
l_int|64
)brace
comma
(brace
l_int|0xE11E
comma
l_int|64
)brace
comma
(brace
l_int|0xE11E
comma
l_int|64
)brace
comma
(brace
l_int|0xF10E
comma
l_int|64
)brace
comma
(brace
l_int|0xF10E
comma
l_int|64
)brace
comma
(brace
l_int|0xF906
comma
l_int|64
)brace
comma
(brace
l_int|0xF906
comma
l_int|64
)brace
comma
(brace
l_int|0xFD02
comma
l_int|64
)brace
comma
(brace
l_int|0xFD02
comma
l_int|64
)brace
comma
(brace
l_int|0xFF00
comma
l_int|64
)brace
comma
(brace
l_int|0xFF00
comma
l_int|64
)brace
comma
(brace
l_int|0x01FE
comma
l_int|128
)brace
)brace
suffix:semicolon
multiline_comment|/* table of attenuation values for vertical scaling */
DECL|variable|v_attenuation
id|u16
id|v_attenuation
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|16
comma
l_int|32
comma
l_int|64
comma
l_int|128
comma
l_int|256
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* calculate vertical scale registers */
DECL|function|calculate_v_scale_registers
r_static
r_int
id|calculate_v_scale_registers
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_enum
id|v4l2_field
id|field
comma
r_int
id|in_y
comma
r_int
id|out_y
comma
id|u32
op_star
id|hps_v_scale
comma
id|u32
op_star
id|hps_v_gain
)paren
(brace
r_int
id|lpi
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* vertical scaling */
id|u32
id|yacm
op_assign
l_int|0
comma
id|ysci
op_assign
l_int|0
comma
id|yacl
op_assign
l_int|0
comma
id|ypo
op_assign
l_int|0
comma
id|ype
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* vertical scale &amp; gain */
id|u32
id|dcgy
op_assign
l_int|0
comma
id|cya_cyb
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* helper variables */
id|u32
id|v_atten
op_assign
l_int|0
comma
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* error, if vertical zooming */
r_if
c_cond
(paren
id|in_y
OL
id|out_y
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* linear phase interpolation may be used&n;&t;   if scaling is between 1 and 1/2 (both fields used)&n;&t;   or scaling is between 1/2 and 1/4 (if only one field is used) */
r_if
c_cond
(paren
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
(brace
r_if
c_cond
(paren
l_int|2
op_star
id|out_y
op_ge
id|in_y
)paren
(brace
id|lpi
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_TOP
op_logical_or
id|field
op_eq
id|V4L2_FIELD_ALTERNATE
op_logical_or
id|field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
r_if
c_cond
(paren
l_int|4
op_star
id|out_y
op_ge
id|in_y
)paren
(brace
id|lpi
op_assign
l_int|1
suffix:semicolon
)brace
id|out_y
op_mul_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|lpi
)paren
(brace
id|yacm
op_assign
l_int|0
suffix:semicolon
id|yacl
op_assign
l_int|0
suffix:semicolon
id|cya_cyb
op_assign
l_int|0x00ff
suffix:semicolon
multiline_comment|/* calculate scaling increment */
r_if
c_cond
(paren
id|in_y
OG
id|out_y
)paren
id|ysci
op_assign
(paren
(paren
l_int|1024
op_star
id|in_y
)paren
op_div
(paren
id|out_y
op_plus
l_int|1
)paren
)paren
op_minus
l_int|1024
suffix:semicolon
r_else
id|ysci
op_assign
l_int|0
suffix:semicolon
id|dcgy
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* calculate ype and ypo */
id|ype
op_assign
id|ysci
op_div
l_int|16
suffix:semicolon
id|ypo
op_assign
id|ype
op_plus
(paren
id|ysci
op_div
l_int|64
)paren
suffix:semicolon
)brace
r_else
(brace
id|yacm
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* calculate scaling increment */
id|ysci
op_assign
(paren
(paren
(paren
l_int|10
op_star
l_int|1024
op_star
(paren
id|in_y
op_minus
id|out_y
op_minus
l_int|1
)paren
)paren
op_div
id|in_y
)paren
op_plus
l_int|9
)paren
op_div
l_int|10
suffix:semicolon
multiline_comment|/* calculate ype and ypo */
id|ypo
op_assign
id|ype
op_assign
(paren
(paren
id|ysci
op_plus
l_int|15
)paren
op_div
l_int|16
)paren
suffix:semicolon
multiline_comment|/* the sequence length interval (yacl) has to be set according&n;&t;&t;   to the prescale value, e.g.&t;[n   .. 1/2) : 0&n;&t;&t;   &t;&t;&t;&t;[1/2 .. 1/3) : 1&n;&t;&t;&t;&t;&t;&t;[1/3 .. 1/4) : 2&n;&t;&t;&t;&t;&t;&t;... */
r_if
c_cond
(paren
id|ysci
OL
l_int|512
)paren
(brace
id|yacl
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|yacl
op_assign
(paren
id|ysci
op_div
(paren
l_int|1024
op_minus
id|ysci
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* get filter coefficients for cya, cyb from table hps_v_coeff_tab */
id|cya_cyb
op_assign
id|hps_v_coeff_tab
(braket
(paren
id|yacl
OL
l_int|63
ques
c_cond
id|yacl
suffix:colon
l_int|63
)paren
)braket
dot
id|hps_coeff
suffix:semicolon
multiline_comment|/* get best match in the table of attenuations for vertical scaling */
id|v_atten
op_assign
id|hps_v_coeff_tab
(braket
(paren
id|yacl
OL
l_int|63
ques
c_cond
id|yacl
suffix:colon
l_int|63
)paren
)braket
dot
id|weight_sum
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|v_attenuation
(braket
id|i
)braket
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|v_attenuation
(braket
id|i
)braket
op_ge
id|v_atten
)paren
r_break
suffix:semicolon
)brace
id|dcgy
op_assign
id|i
suffix:semicolon
)brace
multiline_comment|/* ypo and ype swapped in spec ? */
op_star
id|hps_v_scale
op_or_assign
(paren
id|yacm
op_lshift
l_int|31
)paren
op_or
(paren
id|ysci
op_lshift
l_int|21
)paren
op_or
(paren
id|yacl
op_lshift
l_int|15
)paren
op_or
(paren
id|ypo
op_lshift
l_int|8
)paren
op_or
(paren
id|ype
op_lshift
l_int|1
)paren
suffix:semicolon
op_star
id|hps_v_gain
op_and_assign
op_complement
(paren
id|MASK_W0
op_or
id|MASK_B2
)paren
suffix:semicolon
op_star
id|hps_v_gain
op_or_assign
(paren
id|dcgy
op_lshift
l_int|16
)paren
op_or
(paren
id|cya_cyb
op_lshift
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* simple bubble-sort algorithm with duplicate elimination */
DECL|function|sort_and_eliminate
r_static
r_int
id|sort_and_eliminate
c_func
(paren
id|u32
op_star
id|values
comma
r_int
op_star
id|count
)paren
(brace
r_int
id|low
op_assign
l_int|0
comma
id|high
op_assign
l_int|0
comma
id|top
op_assign
l_int|0
comma
id|temp
op_assign
l_int|0
suffix:semicolon
r_int
id|cur
op_assign
l_int|0
comma
id|next
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* sanity checks */
r_if
c_cond
(paren
(paren
l_int|0
OG
op_star
id|count
)paren
op_logical_or
(paren
l_int|NULL
op_eq
id|values
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* bubble sort the first &#xfffd;count&#xfffd; items of the array &#xfffd;values&#xfffd; */
r_for
c_loop
(paren
id|top
op_assign
op_star
id|count
suffix:semicolon
id|top
OG
l_int|0
suffix:semicolon
id|top
op_decrement
)paren
(brace
r_for
c_loop
(paren
id|low
op_assign
l_int|0
comma
id|high
op_assign
l_int|1
suffix:semicolon
id|high
OL
id|top
suffix:semicolon
id|low
op_increment
comma
id|high
op_increment
)paren
(brace
r_if
c_cond
(paren
id|values
(braket
id|low
)braket
OG
id|values
(braket
id|high
)braket
)paren
(brace
id|temp
op_assign
id|values
(braket
id|low
)braket
suffix:semicolon
id|values
(braket
id|low
)braket
op_assign
id|values
(braket
id|high
)braket
suffix:semicolon
id|values
(braket
id|high
)braket
op_assign
id|temp
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* remove duplicate items */
r_for
c_loop
(paren
id|cur
op_assign
l_int|0
comma
id|next
op_assign
l_int|1
suffix:semicolon
id|next
OL
op_star
id|count
suffix:semicolon
id|next
op_increment
)paren
(brace
r_if
c_cond
(paren
id|values
(braket
id|cur
)braket
op_ne
id|values
(braket
id|next
)braket
)paren
(brace
id|values
(braket
op_increment
id|cur
)braket
op_assign
id|values
(braket
id|next
)braket
suffix:semicolon
)brace
)brace
op_star
id|count
op_assign
id|cur
op_plus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|calculate_clipping_registers_rect
r_static
r_void
id|calculate_clipping_registers_rect
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_fh
op_star
id|fh
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma2
comma
id|u32
op_star
id|clip_format
comma
id|u32
op_star
id|arbtr_ctrl
comma
r_enum
id|v4l2_field
id|field
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
id|u32
op_star
id|clipping
op_assign
id|vv-&gt;d_clipping.cpu_addr
suffix:semicolon
r_int
id|width
op_assign
id|fh-&gt;ov.win.w.width
suffix:semicolon
r_int
id|height
op_assign
id|fh-&gt;ov.win.w.height
suffix:semicolon
r_int
id|clipcount
op_assign
id|fh-&gt;ov.nclips
suffix:semicolon
id|u32
id|line_list
(braket
l_int|32
)braket
suffix:semicolon
id|u32
id|pixel_list
(braket
l_int|32
)braket
suffix:semicolon
r_int
id|numdwords
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_int
id|cnt_line
op_assign
l_int|0
comma
id|cnt_pixel
op_assign
l_int|0
suffix:semicolon
r_int
id|x
(braket
l_int|32
)braket
comma
id|y
(braket
l_int|32
)braket
comma
id|w
(braket
l_int|32
)braket
comma
id|h
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* clear out memory */
id|memset
c_func
(paren
op_amp
id|line_list
(braket
l_int|0
)braket
comma
l_int|0x00
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|32
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pixel_list
(braket
l_int|0
)braket
comma
l_int|0x00
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|32
)paren
suffix:semicolon
id|memset
c_func
(paren
id|clipping
comma
l_int|0x00
comma
id|SAA7146_CLIPPING_MEM
)paren
suffix:semicolon
multiline_comment|/* fill the line and pixel-lists */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|clipcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|l
op_assign
l_int|0
comma
id|r
op_assign
l_int|0
comma
id|t
op_assign
l_int|0
comma
id|b
op_assign
l_int|0
suffix:semicolon
id|x
(braket
id|i
)braket
op_assign
id|fh-&gt;ov.clips
(braket
id|i
)braket
dot
id|c.left
suffix:semicolon
id|y
(braket
id|i
)braket
op_assign
id|fh-&gt;ov.clips
(braket
id|i
)braket
dot
id|c.top
suffix:semicolon
id|w
(braket
id|i
)braket
op_assign
id|fh-&gt;ov.clips
(braket
id|i
)braket
dot
id|c.width
suffix:semicolon
id|h
(braket
id|i
)braket
op_assign
id|fh-&gt;ov.clips
(braket
id|i
)braket
dot
id|c.height
suffix:semicolon
r_if
c_cond
(paren
id|w
(braket
id|i
)braket
OL
l_int|0
)paren
(brace
id|x
(braket
id|i
)braket
op_add_assign
id|w
(braket
id|i
)braket
suffix:semicolon
id|w
(braket
id|i
)braket
op_assign
op_minus
id|w
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|h
(braket
id|i
)braket
OL
l_int|0
)paren
(brace
id|y
(braket
id|i
)braket
op_add_assign
id|h
(braket
id|i
)braket
suffix:semicolon
id|h
(braket
id|i
)braket
op_assign
op_minus
id|h
(braket
id|i
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
(braket
id|i
)braket
OL
l_int|0
)paren
(brace
id|w
(braket
id|i
)braket
op_add_assign
id|x
(braket
id|i
)braket
suffix:semicolon
id|x
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|y
(braket
id|i
)braket
OL
l_int|0
)paren
(brace
id|h
(braket
id|i
)braket
op_add_assign
id|y
(braket
id|i
)braket
suffix:semicolon
id|y
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|y
(braket
id|i
)braket
op_assign
id|height
op_minus
id|y
(braket
id|i
)braket
op_minus
id|h
(braket
id|i
)braket
suffix:semicolon
)brace
id|l
op_assign
id|x
(braket
id|i
)braket
suffix:semicolon
id|r
op_assign
id|x
(braket
id|i
)braket
op_plus
id|w
(braket
id|i
)braket
suffix:semicolon
id|t
op_assign
id|y
(braket
id|i
)braket
suffix:semicolon
id|b
op_assign
id|y
(braket
id|i
)braket
op_plus
id|h
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* insert left/right coordinates */
id|pixel_list
(braket
l_int|2
op_star
id|i
)braket
op_assign
id|my_min
c_func
(paren
r_int
comma
id|l
comma
id|width
)paren
suffix:semicolon
id|pixel_list
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
l_int|1
)braket
op_assign
id|my_min
c_func
(paren
r_int
comma
id|r
comma
id|width
)paren
suffix:semicolon
multiline_comment|/* insert top/bottom coordinates */
id|line_list
(braket
l_int|2
op_star
id|i
)braket
op_assign
id|my_min
c_func
(paren
r_int
comma
id|t
comma
id|height
)paren
suffix:semicolon
id|line_list
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
l_int|1
)braket
op_assign
id|my_min
c_func
(paren
r_int
comma
id|b
comma
id|height
)paren
suffix:semicolon
)brace
multiline_comment|/* sort and eliminate lists */
id|cnt_line
op_assign
id|cnt_pixel
op_assign
l_int|2
op_star
id|clipcount
suffix:semicolon
id|sort_and_eliminate
c_func
(paren
op_amp
id|pixel_list
(braket
l_int|0
)braket
comma
op_amp
id|cnt_pixel
)paren
suffix:semicolon
id|sort_and_eliminate
c_func
(paren
op_amp
id|line_list
(braket
l_int|0
)braket
comma
op_amp
id|cnt_line
)paren
suffix:semicolon
multiline_comment|/* calculate the number of used u32s */
id|numdwords
op_assign
id|my_max
c_func
(paren
r_int
comma
(paren
id|cnt_line
op_plus
l_int|1
)paren
comma
(paren
id|cnt_pixel
op_plus
l_int|1
)paren
)paren
op_star
l_int|2
suffix:semicolon
id|numdwords
op_assign
id|my_max
c_func
(paren
r_int
comma
l_int|4
comma
id|numdwords
)paren
suffix:semicolon
id|numdwords
op_assign
id|my_min
c_func
(paren
r_int
comma
l_int|64
comma
id|numdwords
)paren
suffix:semicolon
multiline_comment|/* fill up cliptable */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt_pixel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|clipping
(braket
l_int|2
op_star
id|i
)braket
op_or_assign
(paren
id|pixel_list
(braket
id|i
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt_line
suffix:semicolon
id|i
op_increment
)paren
(brace
id|clipping
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
l_int|1
)braket
op_or_assign
(paren
id|line_list
(braket
id|i
)braket
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/* fill up cliptable with the display infos */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|clipcount
suffix:semicolon
id|j
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt_pixel
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|x
(braket
id|j
)braket
OL
l_int|0
)paren
(brace
id|x
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pixel_list
(braket
id|i
)braket
OL
(paren
id|x
(braket
id|j
)braket
op_plus
id|w
(braket
id|j
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
id|pixel_list
(braket
id|i
)braket
op_ge
id|x
(braket
id|j
)braket
)paren
(brace
id|clipping
(braket
l_int|2
op_star
id|i
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|j
)paren
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt_line
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|y
(braket
id|j
)braket
OL
l_int|0
)paren
(brace
id|y
(braket
id|j
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|line_list
(braket
id|i
)braket
OL
(paren
id|y
(braket
id|j
)braket
op_plus
id|h
(braket
id|j
)braket
)paren
)paren
(brace
r_if
c_cond
(paren
id|line_list
(braket
id|i
)braket
op_ge
id|y
(braket
id|j
)braket
)paren
(brace
id|clipping
(braket
(paren
l_int|2
op_star
id|i
)paren
op_plus
l_int|1
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|j
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* adjust arbitration control register */
op_star
id|arbtr_ctrl
op_and_assign
l_int|0xffff00ff
suffix:semicolon
op_star
id|arbtr_ctrl
op_or_assign
l_int|0x00001c00
suffix:semicolon
id|vdma2-&gt;base_even
op_assign
id|vv-&gt;d_clipping.dma_handle
suffix:semicolon
id|vdma2-&gt;base_odd
op_assign
id|vv-&gt;d_clipping.dma_handle
suffix:semicolon
id|vdma2-&gt;prot_addr
op_assign
id|vv-&gt;d_clipping.dma_handle
op_plus
(paren
(paren
r_sizeof
(paren
id|u32
)paren
)paren
op_star
(paren
id|numdwords
)paren
)paren
suffix:semicolon
id|vdma2-&gt;base_page
op_assign
l_int|0x04
suffix:semicolon
id|vdma2-&gt;pitch
op_assign
l_int|0x00
suffix:semicolon
id|vdma2-&gt;num_line_byte
op_assign
(paren
l_int|0
op_lshift
l_int|16
op_or
(paren
r_sizeof
(paren
id|u32
)paren
)paren
op_star
(paren
id|numdwords
op_minus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* set clipping-mode. this depends on the field(s) used */
op_star
id|clip_format
op_and_assign
l_int|0xfffffff7
suffix:semicolon
r_if
c_cond
(paren
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
(brace
op_star
id|clip_format
op_or_assign
l_int|0x00000008
suffix:semicolon
)brace
r_else
(brace
op_star
id|clip_format
op_or_assign
l_int|0x00000000
suffix:semicolon
)brace
)brace
multiline_comment|/* disable clipping */
DECL|function|saa7146_disable_clipping
r_static
r_void
id|saa7146_disable_clipping
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
)paren
(brace
id|u32
id|clip_format
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
)paren
suffix:semicolon
multiline_comment|/* mask out relevant bits (=lower word)*/
id|clip_format
op_and_assign
id|MASK_W1
suffix:semicolon
multiline_comment|/* upload clipping-registers*/
id|saa7146_write
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
comma
id|clip_format
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_05
op_or
id|MASK_21
)paren
)paren
suffix:semicolon
multiline_comment|/* disable video dma2 */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC1
comma
id|MASK_21
)paren
suffix:semicolon
)brace
DECL|function|saa7146_set_clipping_rect
r_static
r_void
id|saa7146_set_clipping_rect
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_enum
id|v4l2_field
id|field
op_assign
id|fh-&gt;ov.win.field
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma2
suffix:semicolon
id|u32
id|clip_format
suffix:semicolon
id|u32
id|arbtr_ctrl
suffix:semicolon
multiline_comment|/* check clipcount, disable clipping if clipcount == 0*/
r_if
c_cond
(paren
id|fh-&gt;ov.nclips
op_eq
l_int|0
)paren
(brace
id|saa7146_disable_clipping
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|clip_format
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
)paren
suffix:semicolon
id|arbtr_ctrl
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|PCI_BT_V1
)paren
suffix:semicolon
id|calculate_clipping_registers_rect
c_func
(paren
id|dev
comma
id|fh
comma
op_amp
id|vdma2
comma
op_amp
id|clip_format
comma
op_amp
id|arbtr_ctrl
comma
id|field
)paren
suffix:semicolon
multiline_comment|/* set clipping format */
id|clip_format
op_and_assign
l_int|0xffff0008
suffix:semicolon
id|clip_format
op_or_assign
(paren
id|SAA7146_CLIPPING_RECT
op_lshift
l_int|4
)paren
suffix:semicolon
multiline_comment|/* prepare video dma2 */
id|saa7146_write
c_func
(paren
id|dev
comma
id|BASE_EVEN2
comma
id|vdma2.base_even
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|BASE_ODD2
comma
id|vdma2.base_odd
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|PROT_ADDR2
comma
id|vdma2.prot_addr
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|BASE_PAGE2
comma
id|vdma2.base_page
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|PITCH2
comma
id|vdma2.pitch
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|NUM_LINE_BYTE2
comma
id|vdma2.num_line_byte
)paren
suffix:semicolon
multiline_comment|/* prepare the rest */
id|saa7146_write
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
comma
id|clip_format
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|PCI_BT_V1
comma
id|arbtr_ctrl
)paren
suffix:semicolon
multiline_comment|/* upload clip_control-register, clipping-registers, enable video dma2 */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_05
op_or
id|MASK_21
op_or
id|MASK_03
op_or
id|MASK_19
)paren
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC1
comma
(paren
id|MASK_05
op_or
id|MASK_21
)paren
)paren
suffix:semicolon
)brace
DECL|function|saa7146_set_window
r_static
r_void
id|saa7146_set_window
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|width
comma
r_int
id|height
comma
r_enum
id|v4l2_field
id|field
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_int
id|source
op_assign
id|vv-&gt;current_hps_source
suffix:semicolon
r_int
id|sync
op_assign
id|vv-&gt;current_hps_sync
suffix:semicolon
id|u32
id|hps_v_scale
op_assign
l_int|0
comma
id|hps_v_gain
op_assign
l_int|0
comma
id|hps_ctrl
op_assign
l_int|0
comma
id|hps_h_prescale
op_assign
l_int|0
comma
id|hps_h_scale
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set vertical scale */
id|hps_v_scale
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* all bits get set by the function-call */
id|hps_v_gain
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* fixme: saa7146_read(dev, HPS_V_GAIN);*/
id|calculate_v_scale_registers
c_func
(paren
id|dev
comma
id|field
comma
id|vv-&gt;standard-&gt;v_calc
comma
id|height
comma
op_amp
id|hps_v_scale
comma
op_amp
id|hps_v_gain
)paren
suffix:semicolon
multiline_comment|/* set horizontal scale */
id|hps_ctrl
op_assign
l_int|0
suffix:semicolon
id|hps_h_prescale
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* all bits get set in the function */
id|hps_h_scale
op_assign
l_int|0
suffix:semicolon
id|calculate_h_scale_registers
c_func
(paren
id|dev
comma
id|vv-&gt;standard-&gt;h_calc
comma
id|width
comma
id|vv-&gt;hflip
comma
op_amp
id|hps_ctrl
comma
op_amp
id|hps_v_gain
comma
op_amp
id|hps_h_prescale
comma
op_amp
id|hps_h_scale
)paren
suffix:semicolon
multiline_comment|/* set hyo and hxo */
id|calculate_hxo_and_hyo
c_func
(paren
id|vv
comma
op_amp
id|hps_h_scale
comma
op_amp
id|hps_ctrl
)paren
suffix:semicolon
id|calculate_hps_source_and_sync
c_func
(paren
id|dev
comma
id|source
comma
id|sync
comma
op_amp
id|hps_ctrl
)paren
suffix:semicolon
multiline_comment|/* write out new register contents */
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_V_SCALE
comma
id|hps_v_scale
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_V_GAIN
comma
id|hps_v_gain
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_CTRL
comma
id|hps_ctrl
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_H_PRESCALE
comma
id|hps_h_prescale
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_H_SCALE
comma
id|hps_h_scale
)paren
suffix:semicolon
multiline_comment|/* upload shadow-ram registers */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_05
op_or
id|MASK_06
op_or
id|MASK_21
op_or
id|MASK_22
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* calculate the new memory offsets for a desired position */
DECL|function|saa7146_set_position
r_static
r_void
id|saa7146_set_position
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|w_x
comma
r_int
id|w_y
comma
r_int
id|w_height
comma
r_enum
id|v4l2_field
id|field
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_int
id|b_depth
op_assign
id|vv-&gt;ov_fmt-&gt;depth
suffix:semicolon
r_int
id|b_bpl
op_assign
id|vv-&gt;ov_fb.fmt.bytesperline
suffix:semicolon
id|u32
id|base
op_assign
(paren
id|u32
)paren
id|vv-&gt;ov_fb.base
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma1
suffix:semicolon
multiline_comment|/* calculate memory offsets for picture, look if we shall top-down-flip */
id|vdma1.pitch
op_assign
l_int|2
op_star
id|b_bpl
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|vv-&gt;vflip
)paren
(brace
id|vdma1.base_even
op_assign
(paren
id|u32
)paren
id|base
op_plus
(paren
id|w_y
op_star
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
)paren
op_plus
(paren
id|w_x
op_star
(paren
id|b_depth
op_div
l_int|8
)paren
)paren
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_plus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma1.prot_addr
op_assign
id|vdma1.base_even
op_plus
(paren
id|w_height
op_star
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|vdma1.base_even
op_assign
(paren
id|u32
)paren
id|base
op_plus
(paren
(paren
id|w_y
op_plus
id|w_height
)paren
op_star
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
)paren
op_plus
(paren
id|w_x
op_star
(paren
id|b_depth
op_div
l_int|8
)paren
)paren
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_minus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma1.prot_addr
op_assign
id|vdma1.base_odd
op_minus
(paren
id|w_height
op_star
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
(brace
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_ALTERNATE
)paren
(brace
multiline_comment|/* fixme */
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.base_even
suffix:semicolon
id|vdma1.base_even
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma1.pitch
op_mul_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|vdma1.base_page
op_assign
l_int|0
suffix:semicolon
id|vdma1.num_line_byte
op_assign
(paren
id|vv-&gt;standard-&gt;v_field
op_lshift
l_int|16
)paren
op_plus
id|vv-&gt;standard-&gt;h_pixels
suffix:semicolon
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|1
comma
op_amp
id|vdma1
)paren
suffix:semicolon
)brace
DECL|function|saa7146_set_output_format
r_static
r_void
id|saa7146_set_output_format
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
r_int
id|palette
)paren
(brace
id|u32
id|clip_format
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
)paren
suffix:semicolon
multiline_comment|/* call helper function */
id|calculate_output_format_register
c_func
(paren
id|dev
comma
id|palette
comma
op_amp
id|clip_format
)paren
suffix:semicolon
multiline_comment|/* update the hps registers */
id|saa7146_write
c_func
(paren
id|dev
comma
id|CLIP_FORMAT_CTRL
comma
id|clip_format
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_05
op_or
id|MASK_21
)paren
)paren
suffix:semicolon
)brace
DECL|function|saa7146_set_picture_prop
r_void
id|saa7146_set_picture_prop
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|brightness
comma
r_int
id|contrast
comma
r_int
id|colour
)paren
(brace
id|u32
id|bcs_ctrl
op_assign
l_int|0
suffix:semicolon
id|calculate_bcs_ctrl_register
c_func
(paren
id|dev
comma
id|brightness
comma
id|contrast
comma
id|colour
comma
op_amp
id|bcs_ctrl
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|BCS_CTRL
comma
id|bcs_ctrl
)paren
suffix:semicolon
multiline_comment|/* update the bcs register */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_06
op_or
id|MASK_22
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* select input-source */
DECL|function|saa7146_set_hps_source_and_sync
r_void
id|saa7146_set_hps_source_and_sync
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|source
comma
r_int
id|sync
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
id|u32
id|hps_ctrl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* read old state */
id|hps_ctrl
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|HPS_CTRL
)paren
suffix:semicolon
id|hps_ctrl
op_and_assign
op_complement
(paren
id|MASK_31
op_or
id|MASK_30
op_or
id|MASK_28
)paren
suffix:semicolon
id|hps_ctrl
op_or_assign
(paren
id|source
op_lshift
l_int|30
)paren
op_or
(paren
id|sync
op_lshift
l_int|28
)paren
suffix:semicolon
multiline_comment|/* write back &amp; upload register */
id|saa7146_write
c_func
(paren
id|dev
comma
id|HPS_CTRL
comma
id|hps_ctrl
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_05
op_or
id|MASK_21
)paren
)paren
suffix:semicolon
id|vv-&gt;current_hps_source
op_assign
id|source
suffix:semicolon
id|vv-&gt;current_hps_sync
op_assign
id|sync
suffix:semicolon
)brace
DECL|function|saa7146_enable_overlay
r_int
id|saa7146_enable_overlay
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
id|saa7146_set_window
c_func
(paren
id|dev
comma
id|fh-&gt;ov.win.w.width
comma
id|fh-&gt;ov.win.w.height
comma
id|fh-&gt;ov.win.field
)paren
suffix:semicolon
id|saa7146_set_position
c_func
(paren
id|dev
comma
id|fh-&gt;ov.win.w.left
comma
id|fh-&gt;ov.win.w.top
comma
id|fh-&gt;ov.win.w.height
comma
id|fh-&gt;ov.win.field
)paren
suffix:semicolon
id|saa7146_set_output_format
c_func
(paren
id|dev
comma
id|vv-&gt;ov_fmt-&gt;trans
)paren
suffix:semicolon
id|saa7146_set_clipping_rect
c_func
(paren
id|fh
)paren
suffix:semicolon
multiline_comment|/* enable video dma1 */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC1
comma
(paren
id|MASK_06
op_or
id|MASK_22
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|saa7146_disable_overlay
r_void
id|saa7146_disable_overlay
c_func
(paren
r_struct
id|saa7146_fh
op_star
id|fh
)paren
(brace
r_struct
id|saa7146_dev
op_star
id|dev
op_assign
id|fh-&gt;dev
suffix:semicolon
multiline_comment|/* disable clipping + video dma1 */
id|saa7146_disable_clipping
c_func
(paren
id|dev
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC1
comma
id|MASK_22
)paren
suffix:semicolon
)brace
DECL|function|saa7146_write_out_dma
r_void
id|saa7146_write_out_dma
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|which
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma
)paren
(brace
r_int
id|where
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|which
template_param
l_int|3
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/* calculate starting address */
id|where
op_assign
(paren
id|which
op_minus
l_int|1
)paren
op_star
l_int|0x18
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
comma
id|vdma-&gt;base_odd
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
op_plus
l_int|0x04
comma
id|vdma-&gt;base_even
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
op_plus
l_int|0x08
comma
id|vdma-&gt;prot_addr
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
op_plus
l_int|0x0c
comma
id|vdma-&gt;pitch
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
op_plus
l_int|0x10
comma
id|vdma-&gt;base_page
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|where
op_plus
l_int|0x14
comma
id|vdma-&gt;num_line_byte
)paren
suffix:semicolon
multiline_comment|/* upload */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
(paren
id|MASK_02
op_lshift
(paren
id|which
op_minus
l_int|1
)paren
)paren
op_or
(paren
id|MASK_18
op_lshift
(paren
id|which
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&t;&t;&n;&t;printk(&quot;vdma%d.base_even:     0x%08x&bslash;n&quot;, which,vdma-&gt;base_even);&n;&t;printk(&quot;vdma%d.base_odd:      0x%08x&bslash;n&quot;, which,vdma-&gt;base_odd);&n;&t;printk(&quot;vdma%d.prot_addr:     0x%08x&bslash;n&quot;, which,vdma-&gt;prot_addr);&n;&t;printk(&quot;vdma%d.base_page:     0x%08x&bslash;n&quot;, which,vdma-&gt;base_page);&n;&t;printk(&quot;vdma%d.pitch:         0x%08x&bslash;n&quot;, which,vdma-&gt;pitch);&n;&t;printk(&quot;vdma%d.num_line_byte: 0x%08x&bslash;n&quot;, which,vdma-&gt;num_line_byte);&n;*/
)brace
DECL|function|calculate_video_dma_grab_packed
r_static
r_int
id|calculate_video_dma_grab_packed
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_buf
op_star
id|buf
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma1
suffix:semicolon
r_struct
id|saa7146_format
op_star
id|sfmt
op_assign
id|format_by_fourcc
c_func
(paren
id|dev
comma
id|buf-&gt;fmt-&gt;pixelformat
)paren
suffix:semicolon
r_int
id|width
op_assign
id|buf-&gt;fmt-&gt;width
suffix:semicolon
r_int
id|height
op_assign
id|buf-&gt;fmt-&gt;height
suffix:semicolon
r_int
id|bytesperline
op_assign
id|buf-&gt;fmt-&gt;bytesperline
suffix:semicolon
r_enum
id|v4l2_field
id|field
op_assign
id|buf-&gt;fmt-&gt;field
suffix:semicolon
r_int
id|depth
op_assign
id|sfmt-&gt;depth
suffix:semicolon
id|DEB_CAP
c_func
(paren
(paren
l_string|&quot;[size=%dx%d,fields=%s]&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|v4l2_field_names
(braket
id|field
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bytesperline
op_ne
l_int|0
)paren
(brace
id|vdma1.pitch
op_assign
id|bytesperline
op_star
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|vdma1.pitch
op_assign
(paren
id|width
op_star
id|depth
op_star
l_int|2
)paren
op_div
l_int|8
suffix:semicolon
)brace
id|vdma1.num_line_byte
op_assign
(paren
(paren
id|vv-&gt;standard-&gt;v_field
op_lshift
l_int|16
)paren
op_plus
id|vv-&gt;standard-&gt;h_pixels
)paren
suffix:semicolon
id|vdma1.base_page
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|dma
op_or
id|ME1
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma1.prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
id|vdma1.base_even
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
op_plus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
op_star
id|height
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_minus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|vdma1.base_even
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_plus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma1.prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
op_plus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
op_star
id|height
suffix:semicolon
)brace
r_if
c_cond
(paren
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
(brace
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_ALTERNATE
)paren
(brace
multiline_comment|/* fixme */
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.base_even
suffix:semicolon
id|vdma1.base_even
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.base_even
suffix:semicolon
id|vdma1.base_even
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma1.pitch
op_mul_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|1
comma
op_amp
id|vdma1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|calc_planar_422
r_static
r_int
id|calc_planar_422
c_func
(paren
r_struct
id|saa7146_vv
op_star
id|vv
comma
r_struct
id|saa7146_buf
op_star
id|buf
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma2
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma3
)paren
(brace
r_int
id|height
op_assign
id|buf-&gt;fmt-&gt;height
suffix:semicolon
r_int
id|width
op_assign
id|buf-&gt;fmt-&gt;width
suffix:semicolon
id|vdma2-&gt;pitch
op_assign
id|width
suffix:semicolon
id|vdma3-&gt;pitch
op_assign
id|width
suffix:semicolon
multiline_comment|/* fixme: look at bytesperline! */
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma2-&gt;prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_even
op_assign
(paren
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
)paren
op_plus
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_odd
op_assign
id|vdma2-&gt;base_even
op_minus
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma3-&gt;prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_even
op_assign
(paren
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
)paren
op_plus
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_odd
op_assign
id|vdma3-&gt;base_even
op_minus
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|vdma3-&gt;base_even
op_assign
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_odd
op_assign
id|vdma3-&gt;base_even
op_plus
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma3-&gt;prot_addr
op_assign
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
op_plus
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_even
op_assign
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_odd
op_assign
id|vdma2-&gt;base_even
op_plus
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma2-&gt;prot_addr
op_assign
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
op_plus
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|calc_planar_420
r_static
r_int
id|calc_planar_420
c_func
(paren
r_struct
id|saa7146_vv
op_star
id|vv
comma
r_struct
id|saa7146_buf
op_star
id|buf
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma2
comma
r_struct
id|saa7146_video_dma
op_star
id|vdma3
)paren
(brace
r_int
id|height
op_assign
id|buf-&gt;fmt-&gt;height
suffix:semicolon
r_int
id|width
op_assign
id|buf-&gt;fmt-&gt;width
suffix:semicolon
id|vdma2-&gt;pitch
op_assign
id|width
op_div
l_int|2
suffix:semicolon
id|vdma3-&gt;pitch
op_assign
id|width
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma2-&gt;prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_even
op_assign
(paren
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
)paren
op_plus
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_odd
op_assign
id|vdma2-&gt;base_even
op_minus
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma3-&gt;prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_even
op_assign
(paren
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
)paren
op_plus
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_odd
op_assign
id|vdma3-&gt;base_even
op_minus
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|vdma3-&gt;base_even
op_assign
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma3-&gt;base_odd
op_assign
id|vdma3-&gt;base_even
op_plus
(paren
id|vdma3-&gt;pitch
)paren
suffix:semicolon
id|vdma3-&gt;prot_addr
op_assign
(paren
id|vdma3-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
op_plus
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_even
op_assign
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
id|vdma2-&gt;base_odd
op_assign
id|vdma2-&gt;base_even
op_plus
(paren
id|vdma2-&gt;pitch
)paren
suffix:semicolon
id|vdma2-&gt;prot_addr
op_assign
(paren
id|vdma2-&gt;pitch
op_div
l_int|2
)paren
op_star
id|height
op_plus
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|offset
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|calculate_video_dma_grab_planar
r_static
r_int
id|calculate_video_dma_grab_planar
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_buf
op_star
id|buf
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma1
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma2
suffix:semicolon
r_struct
id|saa7146_video_dma
id|vdma3
suffix:semicolon
r_struct
id|saa7146_format
op_star
id|sfmt
op_assign
id|format_by_fourcc
c_func
(paren
id|dev
comma
id|buf-&gt;fmt-&gt;pixelformat
)paren
suffix:semicolon
r_int
id|width
op_assign
id|buf-&gt;fmt-&gt;width
suffix:semicolon
r_int
id|height
op_assign
id|buf-&gt;fmt-&gt;height
suffix:semicolon
r_enum
id|v4l2_field
id|field
op_assign
id|buf-&gt;fmt-&gt;field
suffix:semicolon
id|BUG_ON
c_func
(paren
l_int|0
op_eq
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|dma
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
l_int|0
op_eq
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|dma
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
l_int|0
op_eq
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|dma
)paren
suffix:semicolon
id|DEB_CAP
c_func
(paren
(paren
l_string|&quot;[size=%dx%d,fields=%s]&bslash;n&quot;
comma
id|width
comma
id|height
comma
id|v4l2_field_names
(braket
id|field
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/* fixme: look at bytesperline! */
multiline_comment|/* fixme: what happens for user space buffers here?. The offsets are&n;&t;   most likely wrong, this version here only works for page-aligned&n;&t;   buffers, modifications to the pagetable-functions are necessary...*/
id|vdma1.pitch
op_assign
id|width
op_star
l_int|2
suffix:semicolon
id|vdma1.num_line_byte
op_assign
(paren
(paren
id|vv-&gt;standard-&gt;v_field
op_lshift
l_int|16
)paren
op_plus
id|vv-&gt;standard-&gt;h_pixels
)paren
suffix:semicolon
id|vdma1.base_page
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|dma
op_or
id|ME1
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma1.prot_addr
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
id|vdma1.base_even
op_assign
(paren
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
op_star
id|height
)paren
op_plus
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_minus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|vdma1.base_even
op_assign
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
id|vdma1.base_odd
op_assign
id|vdma1.base_even
op_plus
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
suffix:semicolon
id|vdma1.prot_addr
op_assign
(paren
id|vdma1.pitch
op_div
l_int|2
)paren
op_star
id|height
op_plus
id|buf-&gt;pt
(braket
l_int|0
)braket
dot
id|offset
suffix:semicolon
)brace
id|vdma2.num_line_byte
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* unused */
id|vdma2.base_page
op_assign
id|buf-&gt;pt
(braket
l_int|1
)braket
dot
id|dma
op_or
id|ME1
suffix:semicolon
id|vdma3.num_line_byte
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* unused */
id|vdma3.base_page
op_assign
id|buf-&gt;pt
(braket
l_int|2
)braket
dot
id|dma
op_or
id|ME1
suffix:semicolon
r_switch
c_cond
(paren
id|sfmt-&gt;depth
)paren
(brace
r_case
l_int|12
suffix:colon
(brace
id|calc_planar_420
c_func
(paren
id|vv
comma
id|buf
comma
op_amp
id|vdma2
comma
op_amp
id|vdma3
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
l_int|16
suffix:colon
(brace
id|calc_planar_422
c_func
(paren
id|vv
comma
id|buf
comma
op_amp
id|vdma2
comma
op_amp
id|vdma3
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|V4L2_FIELD_HAS_BOTH
c_func
(paren
id|field
)paren
)paren
(brace
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_ALTERNATE
)paren
(brace
multiline_comment|/* fixme */
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma2.base_odd
op_assign
id|vdma2.prot_addr
suffix:semicolon
id|vdma2.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma3.base_odd
op_assign
id|vdma3.prot_addr
suffix:semicolon
id|vdma3.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma2.base_odd
op_assign
id|vdma2.prot_addr
suffix:semicolon
id|vdma2.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma3.base_odd
op_assign
id|vdma3.prot_addr
suffix:semicolon
id|vdma3.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|vdma1.base_odd
op_assign
id|vdma1.base_even
suffix:semicolon
id|vdma1.base_even
op_assign
id|vdma1.prot_addr
suffix:semicolon
id|vdma1.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma2.base_odd
op_assign
id|vdma2.base_even
suffix:semicolon
id|vdma2.base_even
op_assign
id|vdma2.prot_addr
suffix:semicolon
id|vdma2.pitch
op_div_assign
l_int|2
suffix:semicolon
id|vdma3.base_odd
op_assign
id|vdma3.base_even
suffix:semicolon
id|vdma3.base_even
op_assign
id|vdma3.prot_addr
suffix:semicolon
id|vdma3.pitch
op_div_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|vv-&gt;vflip
)paren
(brace
id|vdma1.pitch
op_mul_assign
op_minus
l_int|1
suffix:semicolon
id|vdma2.pitch
op_mul_assign
op_minus
l_int|1
suffix:semicolon
id|vdma3.pitch
op_mul_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|1
comma
op_amp
id|vdma1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sfmt-&gt;flags
op_amp
id|FORMAT_BYTE_SWAP
)paren
op_ne
l_int|0
)paren
(brace
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|3
comma
op_amp
id|vdma2
)paren
suffix:semicolon
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|2
comma
op_amp
id|vdma3
)paren
suffix:semicolon
)brace
r_else
(brace
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|2
comma
op_amp
id|vdma2
)paren
suffix:semicolon
id|saa7146_write_out_dma
c_func
(paren
id|dev
comma
l_int|3
comma
op_amp
id|vdma3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|program_capture_engine
r_static
r_void
id|program_capture_engine
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_int
id|planar
)paren
(brace
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|e_wait
op_assign
id|vv-&gt;current_hps_sync
op_eq
id|SAA7146_HPS_SYNC_PORT_A
ques
c_cond
id|CMD_E_FID_A
suffix:colon
id|CMD_E_FID_B
suffix:semicolon
r_int
r_int
id|o_wait
op_assign
id|vv-&gt;current_hps_sync
op_eq
id|SAA7146_HPS_SYNC_PORT_A
ques
c_cond
id|CMD_O_FID_A
suffix:colon
id|CMD_O_FID_B
suffix:semicolon
multiline_comment|/* wait for o_fid_a/b / e_fid_a/b toggle only if rps register 0 is not set*/
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|CMD_OAN
op_or
id|CMD_SIG0
op_or
id|o_wait
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|CMD_OAN
op_or
id|CMD_SIG0
op_or
id|e_wait
)paren
suffix:semicolon
multiline_comment|/* set rps register 0 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
id|MC2
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_27
op_or
id|MASK_11
)paren
suffix:semicolon
multiline_comment|/* turn on video-dma1 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_06
op_or
id|MASK_22
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_06
op_or
id|MASK_22
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
r_if
c_cond
(paren
l_int|0
op_ne
id|planar
)paren
(brace
multiline_comment|/* turn on video-dma2 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_05
op_or
id|MASK_21
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_05
op_or
id|MASK_21
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
multiline_comment|/* turn on video-dma3 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_04
op_or
id|MASK_20
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_04
op_or
id|MASK_20
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
)brace
multiline_comment|/* wait for o_fid_a/b / e_fid_a/b toggle */
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_INTERLACED
)paren
(brace
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|o_wait
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|e_wait
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
(paren
id|vv-&gt;current_hps_sync
op_eq
id|SAA7146_HPS_SYNC_PORT_A
ques
c_cond
id|MASK_10
suffix:colon
id|MASK_09
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|o_wait
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
(paren
id|vv-&gt;current_hps_sync
op_eq
id|SAA7146_HPS_SYNC_PORT_A
ques
c_cond
id|MASK_10
suffix:colon
id|MASK_09
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|CMD_PAUSE
op_or
id|e_wait
)paren
suffix:semicolon
)brace
multiline_comment|/* turn off video-dma1 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_22
op_or
id|MASK_06
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_22
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
r_if
c_cond
(paren
l_int|0
op_ne
id|planar
)paren
(brace
multiline_comment|/* turn off video-dma2 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_05
op_or
id|MASK_21
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_21
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
multiline_comment|/* turn off video-dma3 */
id|WRITE_RPS0
c_func
(paren
id|CMD_WR_REG_MASK
op_or
(paren
id|MC1
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|WRITE_RPS0
c_func
(paren
id|MASK_04
op_or
id|MASK_20
)paren
suffix:semicolon
multiline_comment|/* =&gt; mask */
id|WRITE_RPS0
c_func
(paren
id|MASK_20
)paren
suffix:semicolon
multiline_comment|/* =&gt; values */
)brace
multiline_comment|/* generate interrupt */
id|WRITE_RPS0
c_func
(paren
id|CMD_INTERRUPT
)paren
suffix:semicolon
multiline_comment|/* stop */
id|WRITE_RPS0
c_func
(paren
id|CMD_STOP
)paren
suffix:semicolon
)brace
DECL|function|saa7146_set_capture
r_void
id|saa7146_set_capture
c_func
(paren
r_struct
id|saa7146_dev
op_star
id|dev
comma
r_struct
id|saa7146_buf
op_star
id|buf
comma
r_struct
id|saa7146_buf
op_star
id|next
)paren
(brace
r_struct
id|saa7146_format
op_star
id|sfmt
op_assign
id|format_by_fourcc
c_func
(paren
id|dev
comma
id|buf-&gt;fmt-&gt;pixelformat
)paren
suffix:semicolon
r_struct
id|saa7146_vv
op_star
id|vv
op_assign
id|dev-&gt;vv_data
suffix:semicolon
id|u32
id|vdma1_prot_addr
suffix:semicolon
id|DEB_CAP
c_func
(paren
(paren
l_string|&quot;buf:%p, next:%p&bslash;n&quot;
comma
id|buf
comma
id|next
)paren
)paren
suffix:semicolon
id|vdma1_prot_addr
op_assign
id|saa7146_read
c_func
(paren
id|dev
comma
id|PROT_ADDR1
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_eq
id|vdma1_prot_addr
)paren
(brace
multiline_comment|/* clear out beginning of streaming bit (rps register 0)*/
id|DEB_CAP
c_func
(paren
(paren
l_string|&quot;forcing sync to new frame&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC2
comma
id|MASK_27
)paren
suffix:semicolon
)brace
id|saa7146_set_window
c_func
(paren
id|dev
comma
id|buf-&gt;fmt-&gt;width
comma
id|buf-&gt;fmt-&gt;height
comma
id|buf-&gt;fmt-&gt;field
)paren
suffix:semicolon
id|saa7146_set_output_format
c_func
(paren
id|dev
comma
id|sfmt-&gt;trans
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_INTERLACED
)paren
(brace
)brace
r_else
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_TOP
)paren
(brace
id|vv-&gt;last_field
op_assign
id|V4L2_FIELD_BOTTOM
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vv-&gt;last_field
op_eq
id|V4L2_FIELD_BOTTOM
)paren
(brace
id|vv-&gt;last_field
op_assign
id|V4L2_FIELD_TOP
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
op_ne
id|IS_PLANAR
c_func
(paren
id|sfmt-&gt;trans
)paren
)paren
(brace
id|calculate_video_dma_grab_planar
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|program_capture_engine
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|calculate_video_dma_grab_packed
c_func
(paren
id|dev
comma
id|buf
)paren
suffix:semicolon
id|program_capture_engine
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;printk(&quot;vdma%d.base_even:     0x%08x&bslash;n&quot;, 1,saa7146_read(dev,BASE_EVEN1));&n;&t;printk(&quot;vdma%d.base_odd:      0x%08x&bslash;n&quot;, 1,saa7146_read(dev,BASE_ODD1));&n;&t;printk(&quot;vdma%d.prot_addr:     0x%08x&bslash;n&quot;, 1,saa7146_read(dev,PROT_ADDR1));&n;&t;printk(&quot;vdma%d.base_page:     0x%08x&bslash;n&quot;, 1,saa7146_read(dev,BASE_PAGE1));&n;&t;printk(&quot;vdma%d.pitch:         0x%08x&bslash;n&quot;, 1,saa7146_read(dev,PITCH1));&n;&t;printk(&quot;vdma%d.num_line_byte: 0x%08x&bslash;n&quot;, 1,saa7146_read(dev,NUM_LINE_BYTE1));&n;&t;printk(&quot;vdma%d =&gt; vptr      : 0x%08x&bslash;n&quot;, 1,saa7146_read(dev,PCI_VDP1));&n;*/
multiline_comment|/* write the address of the rps-program */
id|saa7146_write
c_func
(paren
id|dev
comma
id|RPS_ADDR0
comma
id|dev-&gt;d_rps0.dma_handle
)paren
suffix:semicolon
multiline_comment|/* turn on rps */
id|saa7146_write
c_func
(paren
id|dev
comma
id|MC1
comma
(paren
id|MASK_12
op_or
id|MASK_28
)paren
)paren
suffix:semicolon
)brace
eof
