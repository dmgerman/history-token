multiline_comment|/*&n; * $Id: ir-common.c,v 1.5 2004/11/07 13:17:15 kraxel Exp $&n; *&n; * some common structs and functions to handle infrared remotes via&n; * input layer ...&n; *&n; * (c) 2003 Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;media/ir-common.h&gt;
multiline_comment|/* -------------------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerd Knorr &lt;kraxel@bytesex.org&gt; [SuSE Labs]&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|repeat
r_static
r_int
id|repeat
op_assign
l_int|1
suffix:semicolon
id|module_param
c_func
(paren
id|repeat
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|repeat
comma
l_string|&quot;auto-repeat for IR keys (default: on)&quot;
)paren
suffix:semicolon
DECL|variable|debug
r_static
r_int
id|debug
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* debug level (0,1,2) */
id|module_param
c_func
(paren
id|debug
comma
r_int
comma
l_int|0644
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(level, fmt, arg...)&t;if (debug &gt;= level) &bslash;&n;&t;printk(KERN_DEBUG fmt , ## arg)
multiline_comment|/* -------------------------------------------------------------------------- */
multiline_comment|/* generic RC5 keytable                                          */
multiline_comment|/* see http://users.pandora.be/nenya/electronics/rc5/codes00.htm */
DECL|variable|ir_codes_rc5_tv
id|IR_KEYTAB_TYPE
id|ir_codes_rc5_tv
(braket
id|IR_KEYTAB_SIZE
)braket
op_assign
(brace
(braket
l_int|0x00
)braket
op_assign
id|KEY_KP0
comma
singleline_comment|// 0
(braket
l_int|0x01
)braket
op_assign
id|KEY_KP1
comma
singleline_comment|// 1
(braket
l_int|0x02
)braket
op_assign
id|KEY_KP2
comma
singleline_comment|// 2
(braket
l_int|0x03
)braket
op_assign
id|KEY_KP3
comma
singleline_comment|// 3
(braket
l_int|0x04
)braket
op_assign
id|KEY_KP4
comma
singleline_comment|// 4
(braket
l_int|0x05
)braket
op_assign
id|KEY_KP5
comma
singleline_comment|// 5
(braket
l_int|0x06
)braket
op_assign
id|KEY_KP6
comma
singleline_comment|// 6
(braket
l_int|0x07
)braket
op_assign
id|KEY_KP7
comma
singleline_comment|// 7
(braket
l_int|0x08
)braket
op_assign
id|KEY_KP8
comma
singleline_comment|// 8
(braket
l_int|0x09
)braket
op_assign
id|KEY_KP9
comma
singleline_comment|// 9
(braket
l_int|0x0b
)braket
op_assign
id|KEY_CHANNEL
comma
singleline_comment|// channel / program (japan: 11)
(braket
l_int|0x0c
)braket
op_assign
id|KEY_POWER
comma
singleline_comment|// standby
(braket
l_int|0x0d
)braket
op_assign
id|KEY_MUTE
comma
singleline_comment|// mute / demute
(braket
l_int|0x0f
)braket
op_assign
id|KEY_TV
comma
singleline_comment|// display
(braket
l_int|0x10
)braket
op_assign
id|KEY_VOLUMEUP
comma
singleline_comment|// volume +
(braket
l_int|0x11
)braket
op_assign
id|KEY_VOLUMEDOWN
comma
singleline_comment|// volume -
(braket
l_int|0x12
)braket
op_assign
id|KEY_BRIGHTNESSUP
comma
singleline_comment|// brightness +
(braket
l_int|0x13
)braket
op_assign
id|KEY_BRIGHTNESSDOWN
comma
singleline_comment|// brightness -
(braket
l_int|0x1e
)braket
op_assign
id|KEY_SEARCH
comma
singleline_comment|// search +
(braket
l_int|0x20
)braket
op_assign
id|KEY_CHANNELUP
comma
singleline_comment|// channel / program +
(braket
l_int|0x21
)braket
op_assign
id|KEY_CHANNELDOWN
comma
singleline_comment|// channel / program -
(braket
l_int|0x22
)braket
op_assign
id|KEY_CHANNEL
comma
singleline_comment|// alt / channel
(braket
l_int|0x23
)braket
op_assign
id|KEY_LANGUAGE
comma
singleline_comment|// 1st / 2nd language
(braket
l_int|0x26
)braket
op_assign
id|KEY_SLEEP
comma
singleline_comment|// sleeptimer
(braket
l_int|0x2e
)braket
op_assign
id|KEY_MENU
comma
singleline_comment|// 2nd controls (USA: menu)
(braket
l_int|0x30
)braket
op_assign
id|KEY_PAUSE
comma
singleline_comment|// pause
(braket
l_int|0x32
)braket
op_assign
id|KEY_REWIND
comma
singleline_comment|// rewind
(braket
l_int|0x33
)braket
op_assign
id|KEY_GOTO
comma
singleline_comment|// go to
(braket
l_int|0x35
)braket
op_assign
id|KEY_PLAY
comma
singleline_comment|// play
(braket
l_int|0x36
)braket
op_assign
id|KEY_STOP
comma
singleline_comment|// stop
(braket
l_int|0x37
)braket
op_assign
id|KEY_RECORD
comma
singleline_comment|// recording
(braket
l_int|0x3c
)braket
op_assign
id|KEY_TEXT
comma
singleline_comment|// teletext submode (Japan: 12)
(braket
l_int|0x3d
)braket
op_assign
id|KEY_SUSPEND
comma
singleline_comment|// system standby
macro_line|#if 0 /* FIXME */
(braket
l_int|0x0a
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// 1/2/3 digits (japan: 10)
(braket
l_int|0x0e
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// P.P. (personal preference)
(braket
l_int|0x14
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// colour saturation +
(braket
l_int|0x15
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// colour saturation -
(braket
l_int|0x16
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// bass +
(braket
l_int|0x17
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// bass -
(braket
l_int|0x18
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// treble +
(braket
l_int|0x19
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// treble -
(braket
l_int|0x1a
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// balance right
(braket
l_int|0x1b
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// balance left
(braket
l_int|0x1c
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// contrast +
(braket
l_int|0x1d
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// contrast -
(braket
l_int|0x1f
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// tint/hue +
(braket
l_int|0x24
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// spacial stereo on/off
(braket
l_int|0x25
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// mono / stereo (USA)
(braket
l_int|0x27
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// tint / hue -
(braket
l_int|0x28
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// RF switch/PIP select
(braket
l_int|0x29
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// vote
(braket
l_int|0x2a
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// timed page/channel clck
(braket
l_int|0x2b
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// increment (USA)
(braket
l_int|0x2c
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// decrement (USA)
(braket
l_int|0x2d
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|//
(braket
l_int|0x2f
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// PIP shift
(braket
l_int|0x31
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// erase
(braket
l_int|0x34
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// wind
(braket
l_int|0x38
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// external 1
(braket
l_int|0x39
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// external 2
(braket
l_int|0x3a
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// PIP display mode
(braket
l_int|0x3b
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// view data mode / advance
(braket
l_int|0x3e
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// crispener on/off
(braket
l_int|0x3f
)braket
op_assign
id|KEY_RESERVED
comma
singleline_comment|// system select
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|ir_codes_rc5_tv
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_codes_rc5_tv
)paren
suffix:semicolon
multiline_comment|/* empty keytable, can be used as placeholder for not-yet created keytables */
DECL|variable|ir_codes_empty
id|IR_KEYTAB_TYPE
id|ir_codes_empty
(braket
id|IR_KEYTAB_SIZE
)braket
op_assign
(brace
(braket
l_int|42
)braket
op_assign
id|KEY_COFFEE
comma
)brace
suffix:semicolon
DECL|variable|ir_codes_empty
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_codes_empty
)paren
suffix:semicolon
multiline_comment|/* -------------------------------------------------------------------------- */
DECL|function|ir_input_key_event
r_static
r_void
id|ir_input_key_event
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_struct
id|ir_input_state
op_star
id|ir
)paren
(brace
r_if
c_cond
(paren
id|KEY_RESERVED
op_eq
id|ir-&gt;keycode
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: unknown key: key=0x%02x raw=0x%02x down=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ir-&gt;ir_key
comma
id|ir-&gt;ir_raw
comma
id|ir-&gt;keypressed
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_int|1
comma
l_string|&quot;%s: key event code=%d down=%d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|ir-&gt;keycode
comma
id|ir-&gt;keypressed
)paren
suffix:semicolon
id|input_report_key
c_func
(paren
id|dev
comma
id|ir-&gt;keycode
comma
id|ir-&gt;keypressed
)paren
suffix:semicolon
id|input_sync
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/* -------------------------------------------------------------------------- */
DECL|function|ir_input_init
r_void
id|ir_input_init
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_struct
id|ir_input_state
op_star
id|ir
comma
r_int
id|ir_type
comma
id|IR_KEYTAB_TYPE
op_star
id|ir_codes
)paren
(brace
r_int
id|i
suffix:semicolon
id|ir-&gt;ir_type
op_assign
id|ir_type
suffix:semicolon
r_if
c_cond
(paren
id|ir_codes
)paren
id|memcpy
c_func
(paren
id|ir-&gt;ir_codes
comma
id|ir_codes
comma
r_sizeof
(paren
id|ir-&gt;ir_codes
)paren
)paren
suffix:semicolon
id|init_input_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;keycode
op_assign
id|ir-&gt;ir_codes
suffix:semicolon
id|dev-&gt;keycodesize
op_assign
r_sizeof
(paren
id|IR_KEYTAB_TYPE
)paren
suffix:semicolon
id|dev-&gt;keycodemax
op_assign
id|IR_KEYTAB_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IR_KEYTAB_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|set_bit
c_func
(paren
id|ir-&gt;ir_codes
(braket
id|i
)braket
comma
id|dev-&gt;keybit
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
l_int|0
comma
id|dev-&gt;keybit
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|EV_KEY
comma
id|dev-&gt;evbit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|repeat
)paren
id|set_bit
c_func
(paren
id|EV_REP
comma
id|dev-&gt;evbit
)paren
suffix:semicolon
)brace
DECL|function|ir_input_nokey
r_void
id|ir_input_nokey
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_struct
id|ir_input_state
op_star
id|ir
)paren
(brace
r_if
c_cond
(paren
id|ir-&gt;keypressed
)paren
(brace
id|ir-&gt;keypressed
op_assign
l_int|0
suffix:semicolon
id|ir_input_key_event
c_func
(paren
id|dev
comma
id|ir
)paren
suffix:semicolon
)brace
)brace
DECL|function|ir_input_keydown
r_void
id|ir_input_keydown
c_func
(paren
r_struct
id|input_dev
op_star
id|dev
comma
r_struct
id|ir_input_state
op_star
id|ir
comma
id|u32
id|ir_key
comma
id|u32
id|ir_raw
)paren
(brace
id|u32
id|keycode
op_assign
id|IR_KEYCODE
c_func
(paren
id|ir-&gt;ir_codes
comma
id|ir_key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ir-&gt;keypressed
op_logical_and
id|ir-&gt;keycode
op_ne
id|keycode
)paren
(brace
id|ir-&gt;keypressed
op_assign
l_int|0
suffix:semicolon
id|ir_input_key_event
c_func
(paren
id|dev
comma
id|ir
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ir-&gt;keypressed
)paren
(brace
id|ir-&gt;ir_key
op_assign
id|ir_key
suffix:semicolon
id|ir-&gt;ir_raw
op_assign
id|ir_raw
suffix:semicolon
id|ir-&gt;keycode
op_assign
id|keycode
suffix:semicolon
id|ir-&gt;keypressed
op_assign
l_int|1
suffix:semicolon
id|ir_input_key_event
c_func
(paren
id|dev
comma
id|ir
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* maybe do something like this ??? */
id|input_event
c_func
(paren
id|a
comma
id|EV_IR
comma
id|ir-&gt;ir_type
comma
id|ir-&gt;ir_raw
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|ir_extract_bits
id|u32
id|ir_extract_bits
c_func
(paren
id|u32
id|data
comma
id|u32
id|mask
)paren
(brace
r_int
id|mbit
comma
id|vbit
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|value
op_assign
l_int|0
suffix:semicolon
id|vbit
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|mbit
op_assign
l_int|0
suffix:semicolon
id|mbit
OL
l_int|32
suffix:semicolon
id|mbit
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mask
op_amp
(paren
(paren
id|u32
)paren
l_int|1
op_lshift
id|mbit
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
(paren
(paren
id|u32
)paren
l_int|1
op_lshift
id|mbit
)paren
)paren
id|value
op_or_assign
(paren
l_int|1
op_lshift
id|vbit
)paren
suffix:semicolon
id|vbit
op_increment
suffix:semicolon
)brace
r_return
id|value
suffix:semicolon
)brace
DECL|variable|ir_input_init
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_input_init
)paren
suffix:semicolon
DECL|variable|ir_input_nokey
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_input_nokey
)paren
suffix:semicolon
DECL|variable|ir_input_keydown
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_input_keydown
)paren
suffix:semicolon
DECL|variable|ir_extract_bits
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ir_extract_bits
)paren
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; * c-basic-offset: 8&n; * End:&n; */
eof
