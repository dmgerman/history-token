multiline_comment|/*&n; * power.c - power management functions for the device tree.&n; * &n; * Copyright (c) 2002 Patrick Mochel&n; *&t;&t; 2002 Open Source Development Lab&n; * &n; *  Kai Germaschewski contributed to the list walking routines.&n; *&n; */
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;base.h&quot;
DECL|macro|to_dev
mdefine_line|#define to_dev(node) container_of(node,struct device,g_list)
multiline_comment|/**&n; * device_suspend - suspend/remove all devices on the device ree&n; * @state:&t;state we&squot;re entering&n; * @level:&t;what stage of the suspend process we&squot;re at&n; *    (emb: it seems that these two arguments are described backwards of what&n; *          they actually mean .. is this correct?)&n; *&n; * The entries in the global device list are inserted such that they&squot;re in a&n; * depth-first ordering.  So, simply interate over the list, and call the &n; * driver&squot;s suspend or remove callback for each device.&n; */
DECL|function|device_suspend
r_int
id|device_suspend
c_func
(paren
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_struct
id|list_head
op_star
id|node
suffix:semicolon
r_struct
id|device
op_star
id|prev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_POWER_DOWN
)paren
(brace
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;Shutting down devices&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;Suspending devices&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|node
comma
op_amp
id|global_device_list
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|get_device_locked
c_func
(paren
id|to_dev
c_func
(paren
id|node
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_POWER_DOWN
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;remove
)paren
(brace
id|dev-&gt;driver
op_member_access_from_pointer
id|remove
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;suspend
)paren
(brace
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|suspend
c_func
(paren
id|dev
comma
id|state
comma
id|level
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|prev
)paren
id|put_device
c_func
(paren
id|prev
)paren
suffix:semicolon
id|prev
op_assign
id|dev
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/**&n; * device_resume - resume all the devices in the system&n; * @level:&t;stage of resume process we&squot;re at &n; * &n; * Similar to device_suspend above, though we want to do a breadth-first&n; * walk of the tree to make sure we wake up parents before children.&n; * So, we iterate over the list backward. &n; */
DECL|function|device_resume
r_void
id|device_resume
c_func
(paren
id|u32
id|level
)paren
(brace
r_struct
id|list_head
op_star
id|node
suffix:semicolon
r_struct
id|device
op_star
id|prev
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
id|list_for_each_prev
c_func
(paren
id|node
comma
op_amp
id|global_device_list
)paren
(brace
r_struct
id|device
op_star
id|dev
op_assign
id|get_device_locked
c_func
(paren
id|to_dev
c_func
(paren
id|node
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver
op_logical_and
id|dev-&gt;driver-&gt;resume
)paren
id|dev-&gt;driver
op_member_access_from_pointer
id|resume
c_func
(paren
id|dev
comma
id|level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev
)paren
id|put_device
c_func
(paren
id|prev
)paren
suffix:semicolon
id|prev
op_assign
id|dev
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|device_lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_EMERG
l_string|&quot;Devices Resumed&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * device_shutdown - call device_suspend with status set to shutdown, to &n; * cause all devices to remove themselves cleanly &n; */
DECL|function|device_shutdown
r_void
id|device_shutdown
c_func
(paren
r_void
)paren
(brace
id|device_suspend
c_func
(paren
l_int|4
comma
id|SUSPEND_POWER_DOWN
)paren
suffix:semicolon
)brace
DECL|variable|device_suspend
id|EXPORT_SYMBOL
c_func
(paren
id|device_suspend
)paren
suffix:semicolon
DECL|variable|device_resume
id|EXPORT_SYMBOL
c_func
(paren
id|device_resume
)paren
suffix:semicolon
DECL|variable|device_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|device_shutdown
)paren
suffix:semicolon
eof
