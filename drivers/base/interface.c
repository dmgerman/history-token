multiline_comment|/*&n; * drivers/base/interface.c - common driverfs interface that&squot;s exported to &n; * &t;the world for all devices.&n; * Copyright (c) 2002 Patrick Mochel&n; *&t;&t; 2002 Open Source Development Lab&n; */
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
multiline_comment|/**&n; * device_read_status - report some device information&n; * @page:&t;page-sized buffer to write into&n; * @count:&t;number of bytes requested&n; * @off:&t;offset into buffer&n; * @data:&t;device-specific data&n; *&n; * Report some human-readable information about the device.&n; * This includes the name, the bus id, and the current power state.&n; */
DECL|function|device_read_status
r_static
id|ssize_t
id|device_read_status
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|page
comma
r_int
id|count
comma
id|loff_t
id|off
)paren
(brace
r_return
id|off
ques
c_cond
l_int|0
suffix:colon
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|dev-&gt;bus_id
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * device_write_status - forward a command to a driver&n; * @buf:&t;encoded command&n; * @count:&t;number of bytes in buffer&n; * @off:&t;offset into buffer to start with&n; * @data:&t;device-specific data&n; *&n; * Send a comamnd to a device driver.&n; * The following actions are supported:&n; * probe - scan slot for device&n; * remove - detach driver from slot&n; * suspend &lt;state&gt; &lt;stage&gt; - perform &lt;stage&gt; for entering &lt;state&gt;&n; * resume &lt;stage&gt; - perform &lt;stage&gt; for waking device up.&n; * (See Documentation/driver-model.txt for the theory of an n-stage&n; * suspend sequence).&n; */
DECL|function|device_write_status
r_static
id|ssize_t
id|device_write_status
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
id|off
)paren
(brace
r_char
id|command
(braket
l_int|20
)braket
suffix:semicolon
r_int
id|num
suffix:semicolon
r_int
id|arg
op_assign
l_int|0
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* everything involves dealing with the driver. */
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;driver
)paren
r_return
l_int|0
suffix:semicolon
id|num
op_assign
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%10s %d&quot;
comma
id|command
comma
op_amp
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|num
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|command
comma
l_string|&quot;probe&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;probe
)paren
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|probe
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|command
comma
l_string|&quot;remove&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;remove
)paren
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|remove
c_func
(paren
id|dev
comma
id|REMOVE_NOTIFY
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_return
id|error
OL
l_int|0
ques
c_cond
id|error
suffix:colon
id|count
suffix:semicolon
)brace
DECL|variable|device_status_entry
r_static
r_struct
id|driver_file_entry
id|device_status_entry
op_assign
(brace
id|name
suffix:colon
l_string|&quot;status&quot;
comma
id|mode
suffix:colon
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show
suffix:colon
id|device_read_status
comma
id|store
suffix:colon
id|device_write_status
comma
)brace
suffix:semicolon
DECL|function|device_read_name
r_static
id|ssize_t
id|device_read_name
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
id|off
)paren
(brace
r_return
id|off
ques
c_cond
l_int|0
suffix:colon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
)brace
DECL|variable|device_name_entry
r_static
r_struct
id|driver_file_entry
id|device_name_entry
op_assign
(brace
id|name
suffix:colon
l_string|&quot;name&quot;
comma
id|mode
suffix:colon
id|S_IRUGO
comma
id|show
suffix:colon
id|device_read_name
comma
)brace
suffix:semicolon
r_static
id|ssize_t
DECL|function|device_read_power
id|device_read_power
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|page
comma
r_int
id|count
comma
id|loff_t
id|off
)paren
(brace
r_return
id|off
ques
c_cond
l_int|0
suffix:colon
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|dev-&gt;current_state
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|device_write_power
id|device_write_power
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
id|off
)paren
(brace
r_char
id|str_command
(braket
l_int|20
)braket
suffix:semicolon
r_char
id|str_stage
(braket
l_int|20
)braket
suffix:semicolon
r_int
id|num_args
suffix:semicolon
id|u32
id|state
suffix:semicolon
id|u32
id|int_stage
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|off
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;driver
)paren
r_goto
id|done
suffix:semicolon
id|num_args
op_assign
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%10s %10s %u&quot;
comma
id|str_command
comma
id|str_stage
comma
op_amp
id|state
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|num_args
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_command
comma
l_string|&quot;suspend&quot;
comma
l_int|7
)paren
)paren
(brace
r_if
c_cond
(paren
id|num_args
op_ne
l_int|3
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;notify&quot;
comma
l_int|6
)paren
)paren
id|int_stage
op_assign
id|SUSPEND_NOTIFY
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;save&quot;
comma
l_int|4
)paren
)paren
id|int_stage
op_assign
id|SUSPEND_SAVE_STATE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;disable&quot;
comma
l_int|7
)paren
)paren
id|int_stage
op_assign
id|SUSPEND_DISABLE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;powerdown&quot;
comma
l_int|8
)paren
)paren
id|int_stage
op_assign
id|SUSPEND_POWER_DOWN
suffix:semicolon
r_else
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;suspend
)paren
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|suspend
c_func
(paren
id|dev
comma
id|state
comma
id|int_stage
)paren
suffix:semicolon
r_else
id|error
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_command
comma
l_string|&quot;resume&quot;
comma
l_int|6
)paren
)paren
(brace
r_if
c_cond
(paren
id|num_args
op_ne
l_int|2
)paren
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;poweron&quot;
comma
l_int|7
)paren
)paren
id|int_stage
op_assign
id|RESUME_POWER_ON
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;restore&quot;
comma
l_int|7
)paren
)paren
id|int_stage
op_assign
id|RESUME_RESTORE_STATE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strnicmp
c_func
(paren
id|str_stage
comma
l_string|&quot;enable&quot;
comma
l_int|6
)paren
)paren
id|int_stage
op_assign
id|RESUME_ENABLE
suffix:semicolon
r_else
r_goto
id|done
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;driver-&gt;resume
)paren
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|resume
c_func
(paren
id|dev
comma
id|int_stage
)paren
suffix:semicolon
r_else
id|error
op_assign
l_int|0
suffix:semicolon
)brace
id|done
suffix:colon
r_return
id|error
OL
l_int|0
ques
c_cond
id|error
suffix:colon
id|count
suffix:semicolon
)brace
DECL|variable|device_power_entry
r_static
r_struct
id|driver_file_entry
id|device_power_entry
op_assign
(brace
id|name
suffix:colon
l_string|&quot;power&quot;
comma
id|mode
suffix:colon
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|show
suffix:colon
id|device_read_power
comma
id|store
suffix:colon
id|device_write_power
comma
)brace
suffix:semicolon
DECL|variable|device_default_files
r_struct
id|driver_file_entry
op_star
id|device_default_files
(braket
)braket
op_assign
(brace
op_amp
id|device_status_entry
comma
op_amp
id|device_name_entry
comma
op_amp
id|device_power_entry
comma
l_int|NULL
comma
)brace
suffix:semicolon
eof
