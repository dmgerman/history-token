multiline_comment|/*&n; * suspend.c - Functions for putting devices to sleep. &n; *&n; * Copyright (c) 2003 Patrick Mochel&n; * Copyright (c) 2003 Open Source Development Labs&n; *&n; * This file is released under the GPLv2&n; *&n; */
macro_line|#include &lt;linux/device.h&gt;
DECL|macro|to_dev
mdefine_line|#define to_dev(node) container_of(node,struct device,kobj.entry)
r_extern
r_struct
id|subsystem
id|devices_subsys
suffix:semicolon
r_extern
r_int
id|sysdev_save
c_func
(paren
id|u32
id|state
)paren
suffix:semicolon
r_extern
r_int
id|sysdev_suspend
c_func
(paren
id|u32
id|state
)paren
suffix:semicolon
multiline_comment|/**&n; * device_suspend - suspend/remove all devices on the device ree&n; * @state:&t;state we&squot;re entering&n; * @level:&t;what stage of the suspend process we&squot;re at&n; *    (emb: it seems that these two arguments are described backwards of what&n; *          they actually mean .. is this correct?)&n; *&n; * The entries in the global device list are inserted such that they&squot;re in a&n; * depth-first ordering.  So, simply interate over the list, and call the &n; * driver&squot;s suspend or remove callback for each device.&n; */
DECL|function|device_suspend
r_int
id|device_suspend
c_func
(paren
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|devices_subsys.rwsem
)paren
suffix:semicolon
id|list_for_each_entry_reverse
c_func
(paren
id|dev
comma
op_amp
id|devices_subsys.kset.list
comma
id|kobj.entry
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver
op_logical_and
id|dev-&gt;driver-&gt;suspend
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;suspending device %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|error
op_assign
id|dev-&gt;driver
op_member_access_from_pointer
id|suspend
c_func
(paren
id|dev
comma
id|state
comma
id|level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: suspend returned %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|error
)paren
suffix:semicolon
)brace
)brace
id|up_write
c_func
(paren
op_amp
id|devices_subsys.rwsem
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure system devices are suspended.&n;&t; */
r_switch
c_cond
(paren
id|level
)paren
(brace
r_case
id|SUSPEND_SAVE_STATE
suffix:colon
id|sysdev_save
c_func
(paren
id|state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SUSPEND_POWER_DOWN
suffix:colon
id|sysdev_suspend
c_func
(paren
id|state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
eof
