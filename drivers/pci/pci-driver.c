multiline_comment|/*&n; * drivers/pci/pci-driver.c&n; *&n; */
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/module.h&gt;
multiline_comment|/*&n; *  Registration of PCI drivers and handling of hot-pluggable devices.&n; */
DECL|variable|pci_drivers
id|LIST_HEAD
c_func
(paren
id|pci_drivers
)paren
suffix:semicolon
multiline_comment|/**&n; * pci_match_device - Tell if a PCI device structure has a matching PCI device id structure&n; * @ids: array of PCI device id structures to search in&n; * @dev: the PCI device structure to match against&n; * &n; * Used by a driver to check whether a PCI device present in the&n; * system is in its list of supported devices.Returns the matching&n; * pci_device_id structure or %NULL if there is no match.&n; */
r_const
r_struct
id|pci_device_id
op_star
DECL|function|pci_match_device
id|pci_match_device
c_func
(paren
r_const
r_struct
id|pci_device_id
op_star
id|ids
comma
r_const
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_while
c_loop
(paren
id|ids-&gt;vendor
op_logical_or
id|ids-&gt;subvendor
op_logical_or
id|ids-&gt;class_mask
)paren
(brace
r_if
c_cond
(paren
(paren
id|ids-&gt;vendor
op_eq
id|PCI_ANY_ID
op_logical_or
id|ids-&gt;vendor
op_eq
id|dev-&gt;vendor
)paren
op_logical_and
(paren
id|ids-&gt;device
op_eq
id|PCI_ANY_ID
op_logical_or
id|ids-&gt;device
op_eq
id|dev-&gt;device
)paren
op_logical_and
(paren
id|ids-&gt;subvendor
op_eq
id|PCI_ANY_ID
op_logical_or
id|ids-&gt;subvendor
op_eq
id|dev-&gt;subsystem_vendor
)paren
op_logical_and
(paren
id|ids-&gt;subdevice
op_eq
id|PCI_ANY_ID
op_logical_or
id|ids-&gt;subdevice
op_eq
id|dev-&gt;subsystem_device
)paren
op_logical_and
op_logical_neg
(paren
(paren
id|ids
op_member_access_from_pointer
r_class
op_xor
id|dev
op_member_access_from_pointer
r_class
)paren
op_amp
id|ids-&gt;class_mask
)paren
)paren
r_return
id|ids
suffix:semicolon
id|ids
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_int
DECL|function|pci_announce_device
id|pci_announce_device
c_func
(paren
r_struct
id|pci_driver
op_star
id|drv
comma
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_const
r_struct
id|pci_device_id
op_star
id|id
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|drv-&gt;id_table
)paren
(brace
id|id
op_assign
id|pci_match_device
c_func
(paren
id|drv-&gt;id_table
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_else
id|id
op_assign
l_int|NULL
suffix:semicolon
id|dev_probe_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drv
op_member_access_from_pointer
id|probe
c_func
(paren
id|dev
comma
id|id
)paren
op_ge
l_int|0
)paren
(brace
id|dev-&gt;driver
op_assign
id|drv
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
id|dev_probe_unlock
c_func
(paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * pci_register_driver - register a new pci driver&n; * @drv: the driver structure to register&n; * &n; * Adds the driver structure to the list of registered drivers&n; * Returns the number of pci devices which were claimed by the driver&n; * during registration.  The driver remains registered even if the&n; * return value is zero.&n; */
r_int
DECL|function|pci_register_driver
id|pci_register_driver
c_func
(paren
r_struct
id|pci_driver
op_star
id|drv
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|drv-&gt;node
comma
op_amp
id|pci_drivers
)paren
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|pci_dev_driver
c_func
(paren
id|dev
)paren
)paren
id|count
op_add_assign
id|pci_announce_device
c_func
(paren
id|drv
comma
id|dev
)paren
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * pci_unregister_driver - unregister a pci driver&n; * @drv: the driver structure to unregister&n; * &n; * Deletes the driver structure from the list of registered PCI drivers,&n; * gives it a chance to clean up by calling its remove() function for&n; * each device it was responsible for, and marks those devices as&n; * driverless.&n; */
r_void
DECL|function|pci_unregister_driver
id|pci_unregister_driver
c_func
(paren
r_struct
id|pci_driver
op_star
id|drv
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|drv-&gt;node
)paren
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver
op_eq
id|drv
)paren
(brace
r_if
c_cond
(paren
id|drv-&gt;remove
)paren
id|drv
op_member_access_from_pointer
id|remove
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;driver
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
)brace
DECL|variable|pci_compat_driver
r_static
r_struct
id|pci_driver
id|pci_compat_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;compat&quot;
)brace
suffix:semicolon
multiline_comment|/**&n; * pci_dev_driver - get the pci_driver of a device&n; * @dev: the device to query&n; *&n; * Returns the appropriate pci_driver structure or %NULL if there is no &n; * registered driver for the device.&n; */
r_struct
id|pci_driver
op_star
DECL|function|pci_dev_driver
id|pci_dev_driver
c_func
(paren
r_const
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;driver
)paren
r_return
id|dev-&gt;driver
suffix:semicolon
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|PCI_ROM_RESOURCE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_BUSY
)paren
r_return
op_amp
id|pci_compat_driver
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|pci_device_suspend
r_static
r_int
id|pci_device_suspend
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|state
comma
id|u32
id|level
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
(paren
r_struct
id|pci_dev
op_star
)paren
id|list_entry
c_func
(paren
id|dev
comma
r_struct
id|pci_dev
comma
id|dev
)paren
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev-&gt;driver
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_SAVE_STATE
op_logical_and
id|pci_dev-&gt;driver-&gt;save_state
)paren
id|error
op_assign
id|pci_dev-&gt;driver
op_member_access_from_pointer
id|save_state
c_func
(paren
id|pci_dev
comma
id|state
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|level
op_eq
id|SUSPEND_POWER_DOWN
op_logical_and
id|pci_dev-&gt;driver-&gt;suspend
)paren
id|error
op_assign
id|pci_dev-&gt;driver
op_member_access_from_pointer
id|suspend
c_func
(paren
id|pci_dev
comma
id|state
)paren
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
DECL|function|pci_device_resume
r_static
r_int
id|pci_device_resume
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|level
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
(paren
r_struct
id|pci_dev
op_star
)paren
id|list_entry
c_func
(paren
id|dev
comma
r_struct
id|pci_dev
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev-&gt;driver
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
id|RESUME_POWER_ON
op_logical_and
id|pci_dev-&gt;driver-&gt;resume
)paren
id|pci_dev-&gt;driver
op_member_access_from_pointer
id|resume
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pci_device_driver
r_struct
id|device_driver
id|pci_device_driver
op_assign
(brace
id|suspend
suffix:colon
id|pci_device_suspend
comma
id|resume
suffix:colon
id|pci_device_resume
comma
)brace
suffix:semicolon
DECL|variable|pci_match_device
id|EXPORT_SYMBOL
c_func
(paren
id|pci_match_device
)paren
suffix:semicolon
DECL|variable|pci_register_driver
id|EXPORT_SYMBOL
c_func
(paren
id|pci_register_driver
)paren
suffix:semicolon
DECL|variable|pci_unregister_driver
id|EXPORT_SYMBOL
c_func
(paren
id|pci_unregister_driver
)paren
suffix:semicolon
DECL|variable|pci_dev_driver
id|EXPORT_SYMBOL
c_func
(paren
id|pci_dev_driver
)paren
suffix:semicolon
eof
