multiline_comment|/*&n; * PCI Hot Plug Controller Driver for RPA-compliant PPC64 platform.&n; * Copyright (C) 2003 Linda Xie &lt;lxie@us.ibm.com&gt;&n; *&n; * All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or (at&n; * your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, GOOD TITLE or&n; * NON INFRINGEMENT.  See the GNU General Public License for more&n; * details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Send feedback to &lt;lxie@us.ibm.com&gt;&n; *&n; */
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;&t;/* for pci_controller */
macro_line|#include &quot;rpaphp.h&quot;
DECL|function|rpaphp_find_pci_dev
r_struct
id|pci_dev
op_star
id|rpaphp_find_pci_dev
c_func
(paren
r_struct
id|device_node
op_star
id|dn
)paren
(brace
r_struct
id|pci_dev
op_star
id|retval_dev
op_assign
l_int|NULL
comma
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|dev
op_assign
id|pci_get_device
c_func
(paren
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
id|dev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;bus
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;devfn
op_ne
id|dn-&gt;devfn
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|dn-&gt;phb-&gt;global_number
op_eq
id|pci_domain_nr
c_func
(paren
id|dev-&gt;bus
)paren
op_logical_and
id|dn-&gt;busno
op_eq
id|dev-&gt;bus-&gt;number
)paren
(brace
id|retval_dev
op_assign
id|dev
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|retval_dev
suffix:semicolon
)brace
DECL|function|rpaphp_claim_resource
r_int
id|rpaphp_claim_resource
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|resource
)paren
(brace
r_struct
id|resource
op_star
id|res
op_assign
op_amp
id|dev-&gt;resource
(braket
id|resource
)braket
suffix:semicolon
r_struct
id|resource
op_star
id|root
op_assign
id|pci_find_parent_resource
c_func
(paren
id|dev
comma
id|res
)paren
suffix:semicolon
r_char
op_star
id|dtype
op_assign
id|resource
OL
id|PCI_BRIDGE_RESOURCES
ques
c_cond
l_string|&quot;device&quot;
suffix:colon
l_string|&quot;bridge&quot;
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|root
op_ne
l_int|NULL
)paren
(brace
id|err
op_assign
id|request_resource
c_func
(paren
id|root
comma
id|res
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|err
c_func
(paren
l_string|&quot;PCI: %s region %d of %s %s [%lx:%lx]&bslash;n&quot;
comma
id|root
ques
c_cond
l_string|&quot;Address space collision on&quot;
suffix:colon
l_string|&quot;No parent found for&quot;
comma
id|resource
comma
id|dtype
comma
id|pci_name
c_func
(paren
id|dev
)paren
comma
id|res-&gt;start
comma
id|res-&gt;end
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|variable|rpaphp_find_pci_dev
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|rpaphp_find_pci_dev
)paren
suffix:semicolon
DECL|variable|rpaphp_claim_resource
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|rpaphp_claim_resource
)paren
suffix:semicolon
eof
