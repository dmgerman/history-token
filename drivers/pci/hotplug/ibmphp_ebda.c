multiline_comment|/*&n; * IBM Hot Plug Controller Driver&n; *&n; * Written By: Tong Yu, IBM Corporation&n; *&n; * Copyright (C) 2001,2003 Greg Kroah-Hartman (greg@kroah.com)&n; * Copyright (C) 2001-2003 IBM Corp.&n; *&n; * All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or (at&n; * your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, GOOD TITLE or&n; * NON INFRINGEMENT.  See the GNU General Public License for more&n; * details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Send feedback to &lt;gregkh@us.ibm.com&gt;&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;ibmphp.h&quot;
multiline_comment|/*&n; * POST builds data blocks(in this data block definition, a char-1&n; * byte, short(or word)-2 byte, long(dword)-4 byte) in the Extended&n; * BIOS Data Area which describe the configuration of the hot-plug&n; * controllers and resources used by the PCI Hot-Plug devices.&n; *&n; * This file walks EBDA, maps data block from physical addr,&n; * reconstruct linked lists about all system resource(MEM, PFM, IO)&n; * already assigned by POST, as well as linked lists about hot plug&n; * controllers (ctlr#, slot#, bus&amp;slot features...)&n; */
multiline_comment|/* Global lists */
DECL|variable|ibmphp_ebda_pci_rsrc_head
id|LIST_HEAD
(paren
id|ibmphp_ebda_pci_rsrc_head
)paren
suffix:semicolon
DECL|variable|ibmphp_slot_head
id|LIST_HEAD
(paren
id|ibmphp_slot_head
)paren
suffix:semicolon
multiline_comment|/* Local variables */
DECL|variable|hpc_list_ptr
r_static
r_struct
id|ebda_hpc_list
op_star
id|hpc_list_ptr
suffix:semicolon
DECL|variable|rsrc_list_ptr
r_static
r_struct
id|ebda_rsrc_list
op_star
id|rsrc_list_ptr
suffix:semicolon
DECL|variable|rio_table_ptr
r_static
r_struct
id|rio_table_hdr
op_star
id|rio_table_ptr
op_assign
l_int|NULL
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|ebda_hpc_head
)paren
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|bus_info_head
)paren
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|rio_vg_head
)paren
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|rio_lo_head
)paren
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|opt_vg_head
)paren
suffix:semicolon
r_static
id|LIST_HEAD
(paren
id|opt_lo_head
)paren
suffix:semicolon
DECL|variable|io_mem
r_static
r_void
op_star
id|io_mem
suffix:semicolon
multiline_comment|/* Local functions */
r_static
r_int
id|ebda_rsrc_controller
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|ebda_rsrc_rsrc
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|ebda_rio_table
(paren
r_void
)paren
suffix:semicolon
DECL|function|alloc_ebda_hpc_list
r_static
r_struct
id|ebda_hpc_list
op_star
id|__init
id|alloc_ebda_hpc_list
(paren
r_void
)paren
(brace
r_struct
id|ebda_hpc_list
op_star
id|list
suffix:semicolon
id|list
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|ebda_hpc_list
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
(paren
id|list
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|list
)paren
)paren
suffix:semicolon
r_return
id|list
suffix:semicolon
)brace
DECL|function|alloc_ebda_hpc
r_static
r_struct
id|controller
op_star
id|alloc_ebda_hpc
(paren
id|u32
id|slot_count
comma
id|u32
id|bus_count
)paren
(brace
r_struct
id|controller
op_star
id|controller
suffix:semicolon
r_struct
id|ebda_hpc_slot
op_star
id|slots
suffix:semicolon
r_struct
id|ebda_hpc_bus
op_star
id|buses
suffix:semicolon
id|controller
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|controller
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|controller
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
(paren
id|controller
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|controller
)paren
)paren
suffix:semicolon
id|slots
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|ebda_hpc_slot
)paren
op_star
id|slot_count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slots
)paren
(brace
id|kfree
(paren
id|controller
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
(paren
id|slots
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|slots
)paren
op_star
id|slot_count
)paren
suffix:semicolon
id|controller-&gt;slots
op_assign
id|slots
suffix:semicolon
id|buses
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|ebda_hpc_bus
)paren
op_star
id|bus_count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buses
)paren
(brace
id|kfree
(paren
id|controller-&gt;slots
)paren
suffix:semicolon
id|kfree
(paren
id|controller
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
(paren
id|buses
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|buses
)paren
op_star
id|bus_count
)paren
suffix:semicolon
id|controller-&gt;buses
op_assign
id|buses
suffix:semicolon
r_return
id|controller
suffix:semicolon
)brace
DECL|function|free_ebda_hpc
r_static
r_void
id|free_ebda_hpc
(paren
r_struct
id|controller
op_star
id|controller
)paren
(brace
id|kfree
(paren
id|controller-&gt;slots
)paren
suffix:semicolon
id|controller-&gt;slots
op_assign
l_int|NULL
suffix:semicolon
id|kfree
(paren
id|controller-&gt;buses
)paren
suffix:semicolon
id|controller-&gt;buses
op_assign
l_int|NULL
suffix:semicolon
id|controller-&gt;ctrl_dev
op_assign
l_int|NULL
suffix:semicolon
id|kfree
(paren
id|controller
)paren
suffix:semicolon
)brace
DECL|function|alloc_ebda_rsrc_list
r_static
r_struct
id|ebda_rsrc_list
op_star
id|__init
id|alloc_ebda_rsrc_list
(paren
r_void
)paren
(brace
r_struct
id|ebda_rsrc_list
op_star
id|list
suffix:semicolon
id|list
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|ebda_rsrc_list
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
(paren
id|list
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|list
)paren
)paren
suffix:semicolon
r_return
id|list
suffix:semicolon
)brace
DECL|function|alloc_ebda_pci_rsrc
r_static
r_struct
id|ebda_pci_rsrc
op_star
id|alloc_ebda_pci_rsrc
(paren
r_void
)paren
(brace
r_struct
id|ebda_pci_rsrc
op_star
id|resource
suffix:semicolon
id|resource
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|ebda_pci_rsrc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resource
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
(paren
id|resource
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|resource
)paren
)paren
suffix:semicolon
r_return
id|resource
suffix:semicolon
)brace
DECL|function|print_bus_info
r_static
r_void
id|__init
id|print_bus_info
(paren
r_void
)paren
(brace
r_struct
id|bus_info
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|bus_info_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|bus_info
comma
id|bus_info_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slot_min = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slot_min
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slot_max = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slot_max
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slot_count = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slot_count
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - bus# = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;busno
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - current_speed = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;current_speed
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - controller_id = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;controller_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slots_at_33_conv = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slots_at_33_conv
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slots_at_66_conv = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slots_at_66_conv
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slots_at_66_pcix = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slots_at_66_pcix
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slots_at_100_pcix = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slots_at_100_pcix
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slots_at_133_pcix = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;slots_at_133_pcix
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_lo_info
r_static
r_void
id|print_lo_info
(paren
r_void
)paren
(brace
r_struct
id|rio_detail
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|debug
(paren
l_string|&quot;print_lo_info ----&bslash;n&quot;
)paren
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|rio_lo_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|rio_detail
comma
id|rio_detail_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rio_node_id = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rio_node_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rio_type = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rio_type
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - owner_id = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;owner_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - first_slot_num = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - wpindex = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;wpindex
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - chassis_num = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;chassis_num
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_vg_info
r_static
r_void
id|print_vg_info
(paren
r_void
)paren
(brace
r_struct
id|rio_detail
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|debug
(paren
l_string|&quot;%s ---&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|rio_vg_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|rio_detail
comma
id|rio_detail_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rio_node_id = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rio_node_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rio_type = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rio_type
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - owner_id = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;owner_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - first_slot_num = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - wpindex = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;wpindex
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - chassis_num = %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;chassis_num
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_ebda_pci_rsrc
r_static
r_void
id|__init
id|print_ebda_pci_rsrc
(paren
r_void
)paren
(brace
r_struct
id|ebda_pci_rsrc
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|ibmphp_ebda_pci_rsrc_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|ebda_pci_rsrc
comma
id|ebda_pci_rsrc_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rsrc type: %x bus#: %x dev_func: %x start addr: %x end addr: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rsrc_type
comma
id|ptr-&gt;bus_num
comma
id|ptr-&gt;dev_fun
comma
id|ptr-&gt;start_addr
comma
id|ptr-&gt;end_addr
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_ibm_slot
r_static
r_void
id|__init
id|print_ibm_slot
(paren
r_void
)paren
(brace
r_struct
id|slot
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|ibmphp_slot_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|slot
comma
id|ibm_slot_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - slot_number: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;number
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_opt_vg
r_static
r_void
id|__init
id|print_opt_vg
(paren
r_void
)paren
(brace
r_struct
id|opt_rio
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|debug
(paren
l_string|&quot;%s ---&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|opt_vg_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|opt_rio
comma
id|opt_rio_list
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - rio_type %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;rio_type
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - chassis_num: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;chassis_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - first_slot_num: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - middle_num: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|ptr-&gt;middle_num
)paren
suffix:semicolon
)brace
)brace
DECL|function|print_ebda_hpc
r_static
r_void
id|__init
id|print_ebda_hpc
(paren
r_void
)paren
(brace
r_struct
id|controller
op_star
id|hpc_ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|u16
id|index
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|ebda_hpc_head
)paren
(brace
id|hpc_ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|controller
comma
id|ebda_hpc_list
)paren
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|hpc_ptr-&gt;slot_count
suffix:semicolon
id|index
op_increment
)paren
(brace
id|debug
(paren
l_string|&quot;%s - physical slot#: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - pci bus# of the slot: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_bus_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - index into ctlr addr: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|ctl_index
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - cap of the slot: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|hpc_ptr-&gt;bus_count
suffix:semicolon
id|index
op_increment
)paren
(brace
id|debug
(paren
l_string|&quot;%s - bus# of each bus controlled by this ctlr: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;buses
(braket
id|index
)braket
dot
id|bus_num
)paren
suffix:semicolon
)brace
id|debug
(paren
l_string|&quot;%s - type of hpc: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;ctlr_type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|hpc_ptr-&gt;ctlr_type
)paren
(brace
r_case
l_int|1
suffix:colon
id|debug
(paren
l_string|&quot;%s - bus: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.pci_ctlr.bus
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - dev_fun: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.pci_ctlr.dev_fun
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - irq: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|debug
(paren
l_string|&quot;%s - io_start: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.isa_ctlr.io_start
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - io_end: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.isa_ctlr.io_end
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - irq: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|4
suffix:colon
id|debug
(paren
l_string|&quot;%s - wpegbbar: %lx&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.wpeg_ctlr.wpegbbar
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - i2c_addr: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;u.wpeg_ctlr.i2c_addr
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;%s - irq: %x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hpc_ptr-&gt;irq
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|ibmphp_access_ebda
r_int
id|__init
id|ibmphp_access_ebda
(paren
r_void
)paren
(brace
id|u8
id|format
comma
id|num_ctlrs
comma
id|rio_complete
comma
id|hs_complete
suffix:semicolon
id|u16
id|ebda_seg
comma
id|num_entries
comma
id|next_offset
comma
id|offset
comma
id|blk_id
comma
id|sub_addr
comma
id|rc
comma
id|re
comma
id|rc_id
comma
id|re_id
comma
id|base
suffix:semicolon
id|rio_complete
op_assign
l_int|0
suffix:semicolon
id|hs_complete
op_assign
l_int|0
suffix:semicolon
id|io_mem
op_assign
id|ioremap
(paren
(paren
l_int|0x40
op_lshift
l_int|4
)paren
op_plus
l_int|0x0e
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|io_mem
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ebda_seg
op_assign
id|readw
(paren
id|io_mem
)paren
suffix:semicolon
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;returned ebda segment: %x&bslash;n&quot;
comma
id|ebda_seg
)paren
suffix:semicolon
id|io_mem
op_assign
id|ioremap
(paren
id|ebda_seg
op_lshift
l_int|4
comma
l_int|65000
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|io_mem
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|next_offset
op_assign
l_int|0x180
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|offset
op_assign
id|next_offset
suffix:semicolon
id|next_offset
op_assign
id|readw
(paren
id|io_mem
op_plus
id|offset
)paren
suffix:semicolon
multiline_comment|/* offset of next blk */
id|offset
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|next_offset
op_eq
l_int|0
)paren
multiline_comment|/* 0 indicate it&squot;s last blk */
r_break
suffix:semicolon
id|blk_id
op_assign
id|readw
(paren
id|io_mem
op_plus
id|offset
)paren
suffix:semicolon
multiline_comment|/* this blk id */
id|offset
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* check if it is hot swap block or rio block */
r_if
c_cond
(paren
id|blk_id
op_ne
l_int|0x4853
op_logical_and
id|blk_id
op_ne
l_int|0x4752
)paren
r_continue
suffix:semicolon
multiline_comment|/* found hs table */
r_if
c_cond
(paren
id|blk_id
op_eq
l_int|0x4853
)paren
(brace
id|debug
(paren
l_string|&quot;now enter hot swap block---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;hot blk id: %x&bslash;n&quot;
comma
id|blk_id
)paren
suffix:semicolon
id|format
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
)paren
suffix:semicolon
id|offset
op_add_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|format
op_ne
l_int|4
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|debug
(paren
l_string|&quot;hot blk format: %x&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
multiline_comment|/* hot swap sub blk */
id|base
op_assign
id|offset
suffix:semicolon
id|sub_addr
op_assign
id|base
suffix:semicolon
id|re
op_assign
id|readw
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
multiline_comment|/* next sub blk */
id|sub_addr
op_add_assign
l_int|2
suffix:semicolon
id|rc_id
op_assign
id|readw
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
multiline_comment|/* sub blk id */
id|sub_addr
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|rc_id
op_ne
l_int|0x5243
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* rc sub blk signature  */
id|num_ctlrs
op_assign
id|readb
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
id|sub_addr
op_add_assign
l_int|1
suffix:semicolon
id|hpc_list_ptr
op_assign
id|alloc_ebda_hpc_list
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hpc_list_ptr
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|hpc_list_ptr-&gt;format
op_assign
id|format
suffix:semicolon
id|hpc_list_ptr-&gt;num_ctlrs
op_assign
id|num_ctlrs
suffix:semicolon
id|hpc_list_ptr-&gt;phys_addr
op_assign
id|sub_addr
suffix:semicolon
multiline_comment|/*  offset of RSRC_CONTROLLER blk */
id|debug
(paren
l_string|&quot;info about hpc descriptor---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;hot blk format: %x&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;num of controller: %x&bslash;n&quot;
comma
id|num_ctlrs
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;offset of hpc data structure enteries: %x&bslash;n &quot;
comma
id|sub_addr
)paren
suffix:semicolon
id|sub_addr
op_assign
id|base
op_plus
id|re
suffix:semicolon
multiline_comment|/* re sub blk */
id|rc
op_assign
id|readw
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
multiline_comment|/* next sub blk */
id|sub_addr
op_add_assign
l_int|2
suffix:semicolon
id|re_id
op_assign
id|readw
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
multiline_comment|/* sub blk id */
id|sub_addr
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|re_id
op_ne
l_int|0x5245
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* signature of re */
id|num_entries
op_assign
id|readw
(paren
id|io_mem
op_plus
id|sub_addr
)paren
suffix:semicolon
id|sub_addr
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* offset of RSRC_ENTRIES blk */
id|rsrc_list_ptr
op_assign
id|alloc_ebda_rsrc_list
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsrc_list_ptr
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|rsrc_list_ptr-&gt;format
op_assign
id|format
suffix:semicolon
id|rsrc_list_ptr-&gt;num_entries
op_assign
id|num_entries
suffix:semicolon
id|rsrc_list_ptr-&gt;phys_addr
op_assign
id|sub_addr
suffix:semicolon
id|debug
(paren
l_string|&quot;info about rsrc descriptor---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;format: %x&bslash;n&quot;
comma
id|format
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;num of rsrc: %x&bslash;n&quot;
comma
id|num_entries
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;offset of rsrc data structure enteries: %x&bslash;n &quot;
comma
id|sub_addr
)paren
suffix:semicolon
id|hs_complete
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* found rio table */
r_else
r_if
c_cond
(paren
id|blk_id
op_eq
l_int|0x4752
)paren
(brace
id|debug
(paren
l_string|&quot;now enter io table ---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;rio blk id: %x&bslash;n&quot;
comma
id|blk_id
)paren
suffix:semicolon
id|rio_table_ptr
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|rio_table_hdr
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rio_table_ptr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
(paren
id|rio_table_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rio_table_hdr
)paren
)paren
suffix:semicolon
id|rio_table_ptr-&gt;ver_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
)paren
suffix:semicolon
id|rio_table_ptr-&gt;scal_count
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|1
)paren
suffix:semicolon
id|rio_table_ptr-&gt;riodev_count
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|2
)paren
suffix:semicolon
id|rio_table_ptr-&gt;offset
op_assign
id|offset
op_plus
l_int|3
suffix:semicolon
id|debug
(paren
l_string|&quot;info about rio table hdr ---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;ver_num: %x&bslash;nscal_count: %x&bslash;nriodev_count: %x&bslash;noffset of rio table: %x&bslash;n &quot;
comma
id|rio_table_ptr-&gt;ver_num
comma
id|rio_table_ptr-&gt;scal_count
comma
id|rio_table_ptr-&gt;riodev_count
comma
id|rio_table_ptr-&gt;offset
)paren
suffix:semicolon
id|rio_complete
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|hs_complete
op_logical_and
op_logical_neg
id|rio_complete
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rio_table_ptr
)paren
(brace
r_if
c_cond
(paren
id|rio_complete
op_eq
l_int|1
op_logical_and
id|rio_table_ptr-&gt;ver_num
op_eq
l_int|3
)paren
(brace
id|rc
op_assign
id|ebda_rio_table
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
)brace
)brace
id|rc
op_assign
id|ebda_rsrc_controller
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|ebda_rsrc_rsrc
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * map info of scalability details and rio details from physical address&n; */
DECL|function|ebda_rio_table
r_static
r_int
id|__init
id|ebda_rio_table
(paren
r_void
)paren
(brace
id|u16
id|offset
suffix:semicolon
id|u8
id|i
suffix:semicolon
r_struct
id|rio_detail
op_star
id|rio_detail_ptr
suffix:semicolon
id|offset
op_assign
id|rio_table_ptr-&gt;offset
suffix:semicolon
id|offset
op_add_assign
l_int|12
op_star
id|rio_table_ptr-&gt;scal_count
suffix:semicolon
singleline_comment|// we do concern about rio details
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rio_table_ptr-&gt;riodev_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rio_detail_ptr
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|rio_detail
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rio_detail_ptr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
(paren
id|rio_detail_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|rio_detail
)paren
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;rio_node_id
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;bbar
op_assign
id|readl
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|1
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;rio_type
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|5
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;owner_id
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|6
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;port0_node_connect
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|7
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;port0_port_connect
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|8
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;port1_node_connect
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|9
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;port1_port_connect
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|10
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;first_slot_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|11
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;status
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|12
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;wpindex
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|13
)paren
suffix:semicolon
id|rio_detail_ptr-&gt;chassis_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|offset
op_plus
l_int|14
)paren
suffix:semicolon
singleline_comment|//&t;&t;debug (&quot;rio_node_id: %x&bslash;nbbar: %x&bslash;nrio_type: %x&bslash;nowner_id: %x&bslash;nport0_node: %x&bslash;nport0_port: %x&bslash;nport1_node: %x&bslash;nport1_port: %x&bslash;nfirst_slot_num: %x&bslash;nstatus: %x&bslash;n&quot;, rio_detail_ptr-&gt;rio_node_id, rio_detail_ptr-&gt;bbar, rio_detail_ptr-&gt;rio_type, rio_detail_ptr-&gt;owner_id, rio_detail_ptr-&gt;port0_node_connect, rio_detail_ptr-&gt;port0_port_connect, rio_detail_ptr-&gt;port1_node_connect, rio_detail_ptr-&gt;port1_port_connect, rio_detail_ptr-&gt;first_slot_num, rio_detail_ptr-&gt;status);
singleline_comment|//create linked list of chassis
r_if
c_cond
(paren
id|rio_detail_ptr-&gt;rio_type
op_eq
l_int|4
op_logical_or
id|rio_detail_ptr-&gt;rio_type
op_eq
l_int|5
)paren
id|list_add
(paren
op_amp
id|rio_detail_ptr-&gt;rio_detail_list
comma
op_amp
id|rio_vg_head
)paren
suffix:semicolon
singleline_comment|//create linked list of expansion box&t;&t;&t;&t;
r_else
r_if
c_cond
(paren
id|rio_detail_ptr-&gt;rio_type
op_eq
l_int|6
op_logical_or
id|rio_detail_ptr-&gt;rio_type
op_eq
l_int|7
)paren
id|list_add
(paren
op_amp
id|rio_detail_ptr-&gt;rio_detail_list
comma
op_amp
id|rio_lo_head
)paren
suffix:semicolon
r_else
singleline_comment|// not in my concern
id|kfree
(paren
id|rio_detail_ptr
)paren
suffix:semicolon
id|offset
op_add_assign
l_int|15
suffix:semicolon
)brace
id|print_lo_info
(paren
)paren
suffix:semicolon
id|print_vg_info
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * reorganizing linked list of chassis&t; &n; */
DECL|function|search_opt_vg
r_static
r_struct
id|opt_rio
op_star
id|search_opt_vg
(paren
id|u8
id|chassis_num
)paren
(brace
r_struct
id|opt_rio
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|opt_vg_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|opt_rio
comma
id|opt_rio_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr-&gt;chassis_num
op_eq
id|chassis_num
)paren
r_return
id|ptr
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|combine_wpg_for_chassis
r_static
r_int
id|__init
id|combine_wpg_for_chassis
(paren
r_void
)paren
(brace
r_struct
id|opt_rio
op_star
id|opt_rio_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rio_detail
op_star
id|rio_detail_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|list_head_ptr
op_assign
l_int|NULL
suffix:semicolon
id|list_for_each
(paren
id|list_head_ptr
comma
op_amp
id|rio_vg_head
)paren
(brace
id|rio_detail_ptr
op_assign
id|list_entry
(paren
id|list_head_ptr
comma
r_struct
id|rio_detail
comma
id|rio_detail_list
)paren
suffix:semicolon
id|opt_rio_ptr
op_assign
id|search_opt_vg
(paren
id|rio_detail_ptr-&gt;chassis_num
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_rio_ptr
)paren
(brace
id|opt_rio_ptr
op_assign
(paren
r_struct
id|opt_rio
op_star
)paren
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|opt_rio
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_rio_ptr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
(paren
id|opt_rio_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|opt_rio
)paren
)paren
suffix:semicolon
id|opt_rio_ptr-&gt;rio_type
op_assign
id|rio_detail_ptr-&gt;rio_type
suffix:semicolon
id|opt_rio_ptr-&gt;chassis_num
op_assign
id|rio_detail_ptr-&gt;chassis_num
suffix:semicolon
id|opt_rio_ptr-&gt;first_slot_num
op_assign
id|rio_detail_ptr-&gt;first_slot_num
suffix:semicolon
id|opt_rio_ptr-&gt;middle_num
op_assign
id|rio_detail_ptr-&gt;first_slot_num
suffix:semicolon
id|list_add
(paren
op_amp
id|opt_rio_ptr-&gt;opt_rio_list
comma
op_amp
id|opt_vg_head
)paren
suffix:semicolon
)brace
r_else
(brace
id|opt_rio_ptr-&gt;first_slot_num
op_assign
id|min
(paren
id|opt_rio_ptr-&gt;first_slot_num
comma
id|rio_detail_ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|opt_rio_ptr-&gt;middle_num
op_assign
id|max
(paren
id|opt_rio_ptr-&gt;middle_num
comma
id|rio_detail_ptr-&gt;first_slot_num
)paren
suffix:semicolon
)brace
)brace
id|print_opt_vg
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * reorgnizing linked list of expansion box&t; &n; */
DECL|function|search_opt_lo
r_static
r_struct
id|opt_rio_lo
op_star
id|search_opt_lo
(paren
id|u8
id|chassis_num
)paren
(brace
r_struct
id|opt_rio_lo
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|opt_lo_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|opt_rio_lo
comma
id|opt_rio_lo_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr-&gt;chassis_num
op_eq
id|chassis_num
)paren
r_return
id|ptr
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|combine_wpg_for_expansion
r_static
r_int
id|combine_wpg_for_expansion
(paren
r_void
)paren
(brace
r_struct
id|opt_rio_lo
op_star
id|opt_rio_lo_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rio_detail
op_star
id|rio_detail_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|list_head_ptr
op_assign
l_int|NULL
suffix:semicolon
id|list_for_each
(paren
id|list_head_ptr
comma
op_amp
id|rio_lo_head
)paren
(brace
id|rio_detail_ptr
op_assign
id|list_entry
(paren
id|list_head_ptr
comma
r_struct
id|rio_detail
comma
id|rio_detail_list
)paren
suffix:semicolon
id|opt_rio_lo_ptr
op_assign
id|search_opt_lo
(paren
id|rio_detail_ptr-&gt;chassis_num
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_rio_lo_ptr
)paren
(brace
id|opt_rio_lo_ptr
op_assign
(paren
r_struct
id|opt_rio_lo
op_star
)paren
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|opt_rio_lo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_rio_lo_ptr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
(paren
id|opt_rio_lo_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|opt_rio_lo
)paren
)paren
suffix:semicolon
id|opt_rio_lo_ptr-&gt;rio_type
op_assign
id|rio_detail_ptr-&gt;rio_type
suffix:semicolon
id|opt_rio_lo_ptr-&gt;chassis_num
op_assign
id|rio_detail_ptr-&gt;chassis_num
suffix:semicolon
id|opt_rio_lo_ptr-&gt;first_slot_num
op_assign
id|rio_detail_ptr-&gt;first_slot_num
suffix:semicolon
id|opt_rio_lo_ptr-&gt;middle_num
op_assign
id|rio_detail_ptr-&gt;first_slot_num
suffix:semicolon
id|opt_rio_lo_ptr-&gt;pack_count
op_assign
l_int|1
suffix:semicolon
id|list_add
(paren
op_amp
id|opt_rio_lo_ptr-&gt;opt_rio_lo_list
comma
op_amp
id|opt_lo_head
)paren
suffix:semicolon
)brace
r_else
(brace
id|opt_rio_lo_ptr-&gt;first_slot_num
op_assign
id|min
(paren
id|opt_rio_lo_ptr-&gt;first_slot_num
comma
id|rio_detail_ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|opt_rio_lo_ptr-&gt;middle_num
op_assign
id|max
(paren
id|opt_rio_lo_ptr-&gt;middle_num
comma
id|rio_detail_ptr-&gt;first_slot_num
)paren
suffix:semicolon
id|opt_rio_lo_ptr-&gt;pack_count
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Since we don&squot;t know the max slot number per each chassis, hence go&n; * through the list of all chassis to find out the range&n; * Arguments: slot_num, 1st slot number of the chassis we think we are on, &n; * var (0 = chassis, 1 = expansion box) &n; */
DECL|function|first_slot_num
r_static
r_int
id|first_slot_num
(paren
id|u8
id|slot_num
comma
id|u8
id|first_slot
comma
id|u8
id|var
)paren
(brace
r_struct
id|opt_rio
op_star
id|opt_vg_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|opt_rio_lo
op_star
id|opt_lo_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|var
)paren
(brace
id|list_for_each
(paren
id|ptr
comma
op_amp
id|opt_vg_head
)paren
(brace
id|opt_vg_ptr
op_assign
id|list_entry
(paren
id|ptr
comma
r_struct
id|opt_rio
comma
id|opt_rio_list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|first_slot
OL
id|opt_vg_ptr-&gt;first_slot_num
)paren
op_logical_and
(paren
id|slot_num
op_ge
id|opt_vg_ptr-&gt;first_slot_num
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
id|list_for_each
(paren
id|ptr
comma
op_amp
id|opt_lo_head
)paren
(brace
id|opt_lo_ptr
op_assign
id|list_entry
(paren
id|ptr
comma
r_struct
id|opt_rio_lo
comma
id|opt_rio_lo_list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|first_slot
OL
id|opt_lo_ptr-&gt;first_slot_num
)paren
op_logical_and
(paren
id|slot_num
op_ge
id|opt_lo_ptr-&gt;first_slot_num
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|find_rxe_num
r_static
r_struct
id|opt_rio_lo
op_star
id|find_rxe_num
(paren
id|u8
id|slot_num
)paren
(brace
r_struct
id|opt_rio_lo
op_star
id|opt_lo_ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
id|list_for_each
(paren
id|ptr
comma
op_amp
id|opt_lo_head
)paren
(brace
id|opt_lo_ptr
op_assign
id|list_entry
(paren
id|ptr
comma
r_struct
id|opt_rio_lo
comma
id|opt_rio_lo_list
)paren
suffix:semicolon
singleline_comment|//check to see if this slot_num belongs to expansion box
r_if
c_cond
(paren
(paren
id|slot_num
op_ge
id|opt_lo_ptr-&gt;first_slot_num
)paren
op_logical_and
(paren
op_logical_neg
id|first_slot_num
(paren
id|slot_num
comma
id|opt_lo_ptr-&gt;first_slot_num
comma
l_int|1
)paren
)paren
)paren
r_return
id|opt_lo_ptr
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|find_chassis_num
r_static
r_struct
id|opt_rio
op_star
id|find_chassis_num
(paren
id|u8
id|slot_num
)paren
(brace
r_struct
id|opt_rio
op_star
id|opt_vg_ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr
suffix:semicolon
id|list_for_each
(paren
id|ptr
comma
op_amp
id|opt_vg_head
)paren
(brace
id|opt_vg_ptr
op_assign
id|list_entry
(paren
id|ptr
comma
r_struct
id|opt_rio
comma
id|opt_rio_list
)paren
suffix:semicolon
singleline_comment|//check to see if this slot_num belongs to chassis 
r_if
c_cond
(paren
(paren
id|slot_num
op_ge
id|opt_vg_ptr-&gt;first_slot_num
)paren
op_logical_and
(paren
op_logical_neg
id|first_slot_num
(paren
id|slot_num
comma
id|opt_vg_ptr-&gt;first_slot_num
comma
l_int|0
)paren
)paren
)paren
r_return
id|opt_vg_ptr
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* This routine will find out how many slots are in the chassis, so that&n; * the slot numbers for rxe100 would start from 1, and not from 7, or 6 etc&n; */
DECL|function|calculate_first_slot
r_static
id|u8
id|calculate_first_slot
(paren
id|u8
id|slot_num
)paren
(brace
id|u8
id|first_slot
op_assign
l_int|1
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|slot
op_star
id|slot_cur
suffix:semicolon
id|list_for_each
(paren
id|list
comma
op_amp
id|ibmphp_slot_head
)paren
(brace
id|slot_cur
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|slot
comma
id|ibm_slot_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot_cur-&gt;ctrl
)paren
(brace
r_if
c_cond
(paren
(paren
id|slot_cur-&gt;ctrl-&gt;ctlr_type
op_ne
l_int|4
)paren
op_logical_and
(paren
id|slot_cur-&gt;ctrl-&gt;ending_slot_num
OG
id|first_slot
)paren
op_logical_and
(paren
id|slot_num
OG
id|slot_cur-&gt;ctrl-&gt;ending_slot_num
)paren
)paren
id|first_slot
op_assign
id|slot_cur-&gt;ctrl-&gt;ending_slot_num
suffix:semicolon
)brace
)brace
r_return
id|first_slot
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|create_file_name
r_static
r_char
op_star
id|create_file_name
(paren
r_struct
id|slot
op_star
id|slot_cur
)paren
(brace
r_struct
id|opt_rio
op_star
id|opt_vg_ptr
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|opt_rio_lo
op_star
id|opt_lo_ptr
op_assign
l_int|NULL
suffix:semicolon
r_static
r_char
id|str
(braket
l_int|30
)braket
suffix:semicolon
r_int
id|which
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* rxe = 1, chassis = 0 */
id|u8
id|number
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* either chassis or rxe # */
id|u8
id|first_slot
op_assign
l_int|1
suffix:semicolon
id|u8
id|slot_num
suffix:semicolon
id|u8
id|flag
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|slot_cur
)paren
(brace
id|err
(paren
l_string|&quot;Structure passed is empty&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|slot_num
op_assign
id|slot_cur-&gt;number
suffix:semicolon
id|memset
(paren
id|str
comma
l_int|0
comma
r_sizeof
(paren
id|str
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rio_table_ptr
)paren
(brace
r_if
c_cond
(paren
id|rio_table_ptr-&gt;ver_num
op_eq
l_int|3
)paren
(brace
id|opt_vg_ptr
op_assign
id|find_chassis_num
(paren
id|slot_num
)paren
suffix:semicolon
id|opt_lo_ptr
op_assign
id|find_rxe_num
(paren
id|slot_num
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|opt_vg_ptr
)paren
(brace
r_if
c_cond
(paren
id|opt_lo_ptr
)paren
(brace
r_if
c_cond
(paren
(paren
id|slot_num
op_minus
id|opt_vg_ptr-&gt;first_slot_num
)paren
OG
(paren
id|slot_num
op_minus
id|opt_lo_ptr-&gt;first_slot_num
)paren
)paren
(brace
id|number
op_assign
id|opt_lo_ptr-&gt;chassis_num
suffix:semicolon
id|first_slot
op_assign
id|opt_lo_ptr-&gt;first_slot_num
suffix:semicolon
id|which
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* it is RXE */
)brace
r_else
(brace
id|first_slot
op_assign
id|opt_vg_ptr-&gt;first_slot_num
suffix:semicolon
id|number
op_assign
id|opt_vg_ptr-&gt;chassis_num
suffix:semicolon
id|which
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|first_slot
op_assign
id|opt_vg_ptr-&gt;first_slot_num
suffix:semicolon
id|number
op_assign
id|opt_vg_ptr-&gt;chassis_num
suffix:semicolon
id|which
op_assign
l_int|0
suffix:semicolon
)brace
op_increment
id|flag
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|opt_lo_ptr
)paren
(brace
id|number
op_assign
id|opt_lo_ptr-&gt;chassis_num
suffix:semicolon
id|first_slot
op_assign
id|opt_lo_ptr-&gt;first_slot_num
suffix:semicolon
id|which
op_assign
l_int|1
suffix:semicolon
op_increment
id|flag
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rio_table_ptr
)paren
(brace
r_if
c_cond
(paren
id|rio_table_ptr-&gt;ver_num
op_eq
l_int|3
)paren
(brace
multiline_comment|/* if both NULL and we DO have correct RIO table in BIOS */
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|flag
)paren
(brace
r_if
c_cond
(paren
id|slot_cur-&gt;ctrl-&gt;ctlr_type
op_eq
l_int|4
)paren
(brace
id|first_slot
op_assign
id|calculate_first_slot
(paren
id|slot_num
)paren
suffix:semicolon
id|which
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|which
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;%s%dslot%d&quot;
comma
id|which
op_eq
l_int|0
ques
c_cond
l_string|&quot;chassis&quot;
suffix:colon
l_string|&quot;rxe&quot;
comma
id|number
comma
id|slot_num
op_minus
id|first_slot
op_plus
l_int|1
)paren
suffix:semicolon
r_return
id|str
suffix:semicolon
)brace
DECL|function|fillslotinfo
r_static
r_int
id|fillslotinfo
c_func
(paren
r_struct
id|hotplug_slot
op_star
id|hotplug_slot
)paren
(brace
r_struct
id|slot
op_star
id|slot
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hotplug_slot
op_logical_or
op_logical_neg
id|hotplug_slot
op_member_access_from_pointer
r_private
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|slot
op_assign
id|hotplug_slot
op_member_access_from_pointer
r_private
suffix:semicolon
id|rc
op_assign
id|ibmphp_hpc_readslot
c_func
(paren
id|slot
comma
id|READ_ALLSTAT
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
singleline_comment|// power - enabled:1  not:0
id|hotplug_slot-&gt;info-&gt;power_status
op_assign
id|SLOT_POWER
c_func
(paren
id|slot-&gt;status
)paren
suffix:semicolon
singleline_comment|// attention - off:0, on:1, blinking:2
id|hotplug_slot-&gt;info-&gt;attention_status
op_assign
id|SLOT_ATTN
c_func
(paren
id|slot-&gt;status
comma
id|slot-&gt;ext_status
)paren
suffix:semicolon
singleline_comment|// latch - open:1 closed:0
id|hotplug_slot-&gt;info-&gt;latch_status
op_assign
id|SLOT_LATCH
c_func
(paren
id|slot-&gt;status
)paren
suffix:semicolon
singleline_comment|// pci board - present:1 not:0
r_if
c_cond
(paren
id|SLOT_PRESENT
(paren
id|slot-&gt;status
)paren
)paren
id|hotplug_slot-&gt;info-&gt;adapter_status
op_assign
l_int|1
suffix:semicolon
r_else
id|hotplug_slot-&gt;info-&gt;adapter_status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;if (slot-&gt;bus_on-&gt;supported_bus_mode&n;&t;&t;&amp;&amp; (slot-&gt;bus_on-&gt;supported_speed == BUS_SPEED_66))&n;&t;&t;hotplug_slot-&gt;info-&gt;max_bus_speed_status = BUS_SPEED_66PCIX;&n;&t;else&n;&t;&t;hotplug_slot-&gt;info-&gt;max_bus_speed_status = slot-&gt;bus_on-&gt;supported_speed;&n;*/
r_return
id|rc
suffix:semicolon
)brace
DECL|function|release_slot
r_static
r_void
id|release_slot
c_func
(paren
r_struct
id|hotplug_slot
op_star
id|hotplug_slot
)paren
(brace
r_struct
id|slot
op_star
id|slot
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hotplug_slot
op_logical_or
op_logical_neg
id|hotplug_slot
op_member_access_from_pointer
r_private
)paren
r_return
suffix:semicolon
id|slot
op_assign
id|hotplug_slot
op_member_access_from_pointer
r_private
suffix:semicolon
id|kfree
c_func
(paren
id|slot-&gt;hotplug_slot-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|slot-&gt;hotplug_slot-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|slot-&gt;hotplug_slot
)paren
suffix:semicolon
id|slot-&gt;ctrl
op_assign
l_int|NULL
suffix:semicolon
id|slot-&gt;bus_on
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* we don&squot;t want to actually remove the resources, since free_resources will do just that */
id|ibmphp_unconfigure_card
c_func
(paren
op_amp
id|slot
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|kfree
(paren
id|slot
)paren
suffix:semicolon
)brace
DECL|variable|ibmphp_driver
r_static
r_struct
id|pci_driver
id|ibmphp_driver
suffix:semicolon
multiline_comment|/*&n; * map info (ctlr-id, slot count, slot#.. bus count, bus#, ctlr type...) of&n; * each hpc from physical address to a list of hot plug controllers based on&n; * hpc descriptors.&n; */
DECL|function|ebda_rsrc_controller
r_static
r_int
id|__init
id|ebda_rsrc_controller
(paren
r_void
)paren
(brace
id|u16
id|addr
comma
id|addr_slot
comma
id|addr_bus
suffix:semicolon
id|u8
id|ctlr_id
comma
id|temp
comma
id|bus_index
suffix:semicolon
id|u16
id|ctlr
comma
id|slot
comma
id|bus
suffix:semicolon
id|u16
id|slot_num
comma
id|bus_num
comma
id|index
suffix:semicolon
r_struct
id|hotplug_slot
op_star
id|hp_slot_ptr
suffix:semicolon
r_struct
id|controller
op_star
id|hpc_ptr
suffix:semicolon
r_struct
id|ebda_hpc_bus
op_star
id|bus_ptr
suffix:semicolon
r_struct
id|ebda_hpc_slot
op_star
id|slot_ptr
suffix:semicolon
r_struct
id|bus_info
op_star
id|bus_info_ptr1
comma
op_star
id|bus_info_ptr2
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_struct
id|slot
op_star
id|tmp_slot
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|addr
op_assign
id|hpc_list_ptr-&gt;phys_addr
suffix:semicolon
r_for
c_loop
(paren
id|ctlr
op_assign
l_int|0
suffix:semicolon
id|ctlr
OL
id|hpc_list_ptr-&gt;num_ctlrs
suffix:semicolon
id|ctlr
op_increment
)paren
(brace
id|bus_index
op_assign
l_int|1
suffix:semicolon
id|ctlr_id
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|1
suffix:semicolon
id|slot_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|1
suffix:semicolon
id|addr_slot
op_assign
id|addr
suffix:semicolon
multiline_comment|/* offset of slot structure */
id|addr
op_add_assign
(paren
id|slot_num
op_star
l_int|4
)paren
suffix:semicolon
id|bus_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|1
suffix:semicolon
id|addr_bus
op_assign
id|addr
suffix:semicolon
multiline_comment|/* offset of bus */
id|addr
op_add_assign
(paren
id|bus_num
op_star
l_int|9
)paren
suffix:semicolon
multiline_comment|/* offset of ctlr_type */
id|temp
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|1
suffix:semicolon
multiline_comment|/* init hpc structure */
id|hpc_ptr
op_assign
id|alloc_ebda_hpc
(paren
id|slot_num
comma
id|bus_num
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hpc_ptr
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_hpc
suffix:semicolon
)brace
id|hpc_ptr-&gt;ctlr_id
op_assign
id|ctlr_id
suffix:semicolon
id|hpc_ptr-&gt;ctlr_relative_id
op_assign
id|ctlr
suffix:semicolon
id|hpc_ptr-&gt;slot_count
op_assign
id|slot_num
suffix:semicolon
id|hpc_ptr-&gt;bus_count
op_assign
id|bus_num
suffix:semicolon
id|debug
(paren
l_string|&quot;now enter ctlr data struture ---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;ctlr id: %x&bslash;n&quot;
comma
id|ctlr_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;ctlr_relative_id: %x&bslash;n&quot;
comma
id|hpc_ptr-&gt;ctlr_relative_id
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;count of slots controlled by this ctlr: %x&bslash;n&quot;
comma
id|slot_num
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;count of buses controlled by this ctlr: %x&bslash;n&quot;
comma
id|bus_num
)paren
suffix:semicolon
multiline_comment|/* init slot structure, fetch slot, bus, cap... */
id|slot_ptr
op_assign
id|hpc_ptr-&gt;slots
suffix:semicolon
r_for
c_loop
(paren
id|slot
op_assign
l_int|0
suffix:semicolon
id|slot
OL
id|slot_num
suffix:semicolon
id|slot
op_increment
)paren
(brace
id|slot_ptr-&gt;slot_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_slot
)paren
suffix:semicolon
id|slot_ptr-&gt;slot_bus_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_slot
op_plus
id|slot_num
)paren
suffix:semicolon
id|slot_ptr-&gt;ctl_index
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_slot
op_plus
l_int|2
op_star
id|slot_num
)paren
suffix:semicolon
id|slot_ptr-&gt;slot_cap
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_slot
op_plus
l_int|3
op_star
id|slot_num
)paren
suffix:semicolon
singleline_comment|// create bus_info lined list --- if only one slot per bus: slot_min = slot_max 
id|bus_info_ptr2
op_assign
id|ibmphp_find_same_bus_num
(paren
id|slot_ptr-&gt;slot_bus_num
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bus_info_ptr2
)paren
(brace
id|bus_info_ptr1
op_assign
(paren
r_struct
id|bus_info
op_star
)paren
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|bus_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bus_info_ptr1
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_hp_slot
suffix:semicolon
)brace
id|memset
(paren
id|bus_info_ptr1
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|bus_info
)paren
)paren
suffix:semicolon
id|bus_info_ptr1-&gt;slot_min
op_assign
id|slot_ptr-&gt;slot_num
suffix:semicolon
id|bus_info_ptr1-&gt;slot_max
op_assign
id|slot_ptr-&gt;slot_num
suffix:semicolon
id|bus_info_ptr1-&gt;slot_count
op_add_assign
l_int|1
suffix:semicolon
id|bus_info_ptr1-&gt;busno
op_assign
id|slot_ptr-&gt;slot_bus_num
suffix:semicolon
id|bus_info_ptr1-&gt;index
op_assign
id|bus_index
op_increment
suffix:semicolon
id|bus_info_ptr1-&gt;current_speed
op_assign
l_int|0xff
suffix:semicolon
id|bus_info_ptr1-&gt;current_bus_mode
op_assign
l_int|0xff
suffix:semicolon
id|bus_info_ptr1-&gt;controller_id
op_assign
id|hpc_ptr-&gt;ctlr_id
suffix:semicolon
id|list_add_tail
(paren
op_amp
id|bus_info_ptr1-&gt;bus_info_list
comma
op_amp
id|bus_info_head
)paren
suffix:semicolon
)brace
r_else
(brace
id|bus_info_ptr2-&gt;slot_min
op_assign
id|min
(paren
id|bus_info_ptr2-&gt;slot_min
comma
id|slot_ptr-&gt;slot_num
)paren
suffix:semicolon
id|bus_info_ptr2-&gt;slot_max
op_assign
id|max
(paren
id|bus_info_ptr2-&gt;slot_max
comma
id|slot_ptr-&gt;slot_num
)paren
suffix:semicolon
id|bus_info_ptr2-&gt;slot_count
op_add_assign
l_int|1
suffix:semicolon
)brace
singleline_comment|// end of creating the bus_info linked list
id|slot_ptr
op_increment
suffix:semicolon
id|addr_slot
op_add_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* init bus structure */
id|bus_ptr
op_assign
id|hpc_ptr-&gt;buses
suffix:semicolon
r_for
c_loop
(paren
id|bus
op_assign
l_int|0
suffix:semicolon
id|bus
OL
id|bus_num
suffix:semicolon
id|bus
op_increment
)paren
(brace
id|bus_ptr-&gt;bus_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus
)paren
suffix:semicolon
id|bus_ptr-&gt;slots_at_33_conv
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus_num
op_plus
l_int|8
op_star
id|bus
)paren
suffix:semicolon
id|bus_ptr-&gt;slots_at_66_conv
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus_num
op_plus
l_int|8
op_star
id|bus
op_plus
l_int|1
)paren
suffix:semicolon
id|bus_ptr-&gt;slots_at_66_pcix
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus_num
op_plus
l_int|8
op_star
id|bus
op_plus
l_int|2
)paren
suffix:semicolon
id|bus_ptr-&gt;slots_at_100_pcix
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus_num
op_plus
l_int|8
op_star
id|bus
op_plus
l_int|3
)paren
suffix:semicolon
id|bus_ptr-&gt;slots_at_133_pcix
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr_bus
op_plus
id|bus_num
op_plus
l_int|8
op_star
id|bus
op_plus
l_int|4
)paren
suffix:semicolon
id|bus_info_ptr2
op_assign
id|ibmphp_find_same_bus_num
(paren
id|bus_ptr-&gt;bus_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bus_info_ptr2
)paren
(brace
id|bus_info_ptr2-&gt;slots_at_33_conv
op_assign
id|bus_ptr-&gt;slots_at_33_conv
suffix:semicolon
id|bus_info_ptr2-&gt;slots_at_66_conv
op_assign
id|bus_ptr-&gt;slots_at_66_conv
suffix:semicolon
id|bus_info_ptr2-&gt;slots_at_66_pcix
op_assign
id|bus_ptr-&gt;slots_at_66_pcix
suffix:semicolon
id|bus_info_ptr2-&gt;slots_at_100_pcix
op_assign
id|bus_ptr-&gt;slots_at_100_pcix
suffix:semicolon
id|bus_info_ptr2-&gt;slots_at_133_pcix
op_assign
id|bus_ptr-&gt;slots_at_133_pcix
suffix:semicolon
)brace
id|bus_ptr
op_increment
suffix:semicolon
)brace
id|hpc_ptr-&gt;ctlr_type
op_assign
id|temp
suffix:semicolon
r_switch
c_cond
(paren
id|hpc_ptr-&gt;ctlr_type
)paren
(brace
r_case
l_int|1
suffix:colon
id|hpc_ptr-&gt;u.pci_ctlr.bus
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|hpc_ptr-&gt;u.pci_ctlr.dev_fun
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|hpc_ptr-&gt;irq
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|3
suffix:semicolon
id|debug
(paren
l_string|&quot;ctrl bus = %x, ctlr devfun = %x, irq = %x&bslash;n&quot;
comma
id|hpc_ptr-&gt;u.pci_ctlr.bus
comma
id|hpc_ptr-&gt;u.pci_ctlr.dev_fun
comma
id|hpc_ptr-&gt;irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
id|hpc_ptr-&gt;u.isa_ctlr.io_start
op_assign
id|readw
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|hpc_ptr-&gt;u.isa_ctlr.io_end
op_assign
id|readw
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
(paren
id|hpc_ptr-&gt;u.isa_ctlr.io_start
comma
(paren
id|hpc_ptr-&gt;u.isa_ctlr.io_end
op_minus
id|hpc_ptr-&gt;u.isa_ctlr.io_start
op_plus
l_int|1
)paren
comma
l_string|&quot;ibmphp&quot;
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error_no_hp_slot
suffix:semicolon
)brace
id|hpc_ptr-&gt;irq
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|4
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|4
suffix:colon
id|hpc_ptr-&gt;u.wpeg_ctlr.wpegbbar
op_assign
id|readl
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|hpc_ptr-&gt;u.wpeg_ctlr.i2c_addr
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|4
)paren
suffix:semicolon
id|hpc_ptr-&gt;irq
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|5
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error_no_hp_slot
suffix:semicolon
)brace
singleline_comment|//reorganize chassis&squot; linked list
id|combine_wpg_for_chassis
(paren
)paren
suffix:semicolon
id|combine_wpg_for_expansion
(paren
)paren
suffix:semicolon
id|hpc_ptr-&gt;revision
op_assign
l_int|0xff
suffix:semicolon
id|hpc_ptr-&gt;options
op_assign
l_int|0xff
suffix:semicolon
id|hpc_ptr-&gt;starting_slot_num
op_assign
id|hpc_ptr-&gt;slots
(braket
l_int|0
)braket
dot
id|slot_num
suffix:semicolon
id|hpc_ptr-&gt;ending_slot_num
op_assign
id|hpc_ptr-&gt;slots
(braket
id|slot_num
op_minus
l_int|1
)braket
dot
id|slot_num
suffix:semicolon
singleline_comment|// register slots with hpc core as well as create linked list of ibm slot
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|hpc_ptr-&gt;slot_count
suffix:semicolon
id|index
op_increment
)paren
(brace
id|hp_slot_ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|hp_slot_ptr
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hp_slot_ptr
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_hp_slot
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hp_slot_ptr
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|hp_slot_ptr
)paren
)paren
suffix:semicolon
id|hp_slot_ptr-&gt;info
op_assign
id|kmalloc
(paren
r_sizeof
(paren
r_struct
id|hotplug_slot_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hp_slot_ptr-&gt;info
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_hp_info
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hp_slot_ptr-&gt;info
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hotplug_slot_info
)paren
)paren
suffix:semicolon
id|hp_slot_ptr-&gt;name
op_assign
id|kmalloc
c_func
(paren
l_int|30
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hp_slot_ptr-&gt;name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_hp_name
suffix:semicolon
)brace
id|tmp_slot
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|tmp_slot
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp_slot
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error_no_slot
suffix:semicolon
)brace
id|memset
c_func
(paren
id|tmp_slot
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|tmp_slot
)paren
)paren
suffix:semicolon
id|tmp_slot-&gt;flag
op_assign
id|TRUE
suffix:semicolon
id|tmp_slot-&gt;capabilities
op_assign
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
op_amp
id|EBDA_SLOT_133_MAX
)paren
op_eq
id|EBDA_SLOT_133_MAX
)paren
id|tmp_slot-&gt;supported_speed
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
op_amp
id|EBDA_SLOT_100_MAX
)paren
op_eq
id|EBDA_SLOT_100_MAX
)paren
id|tmp_slot-&gt;supported_speed
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
op_amp
id|EBDA_SLOT_66_MAX
)paren
op_eq
id|EBDA_SLOT_66_MAX
)paren
id|tmp_slot-&gt;supported_speed
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_cap
op_amp
id|EBDA_SLOT_PCIX_CAP
)paren
op_eq
id|EBDA_SLOT_PCIX_CAP
)paren
id|tmp_slot-&gt;supported_bus_mode
op_assign
l_int|1
suffix:semicolon
r_else
id|tmp_slot-&gt;supported_bus_mode
op_assign
l_int|0
suffix:semicolon
id|tmp_slot-&gt;bus
op_assign
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_bus_num
suffix:semicolon
id|bus_info_ptr1
op_assign
id|ibmphp_find_same_bus_num
(paren
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_bus_num
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bus_info_ptr1
)paren
(brace
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|tmp_slot-&gt;bus_on
op_assign
id|bus_info_ptr1
suffix:semicolon
id|bus_info_ptr1
op_assign
l_int|NULL
suffix:semicolon
id|tmp_slot-&gt;ctrl
op_assign
id|hpc_ptr
suffix:semicolon
id|tmp_slot-&gt;ctlr_index
op_assign
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|ctl_index
suffix:semicolon
id|tmp_slot-&gt;number
op_assign
id|hpc_ptr-&gt;slots
(braket
id|index
)braket
dot
id|slot_num
suffix:semicolon
id|tmp_slot-&gt;hotplug_slot
op_assign
id|hp_slot_ptr
suffix:semicolon
id|hp_slot_ptr
op_member_access_from_pointer
r_private
op_assign
id|tmp_slot
suffix:semicolon
id|hp_slot_ptr-&gt;release
op_assign
id|release_slot
suffix:semicolon
id|rc
op_assign
id|fillslotinfo
c_func
(paren
id|hp_slot_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|error
suffix:semicolon
id|rc
op_assign
id|ibmphp_init_devno
(paren
(paren
r_struct
id|slot
op_star
op_star
)paren
op_amp
id|hp_slot_ptr
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|error
suffix:semicolon
id|hp_slot_ptr-&gt;ops
op_assign
op_amp
id|ibmphp_hotplug_slot_ops
suffix:semicolon
singleline_comment|// end of registering ibm slot with hotplug core
id|list_add
(paren
op_amp
(paren
(paren
r_struct
id|slot
op_star
)paren
(paren
id|hp_slot_ptr
op_member_access_from_pointer
r_private
)paren
)paren
op_member_access_from_pointer
id|ibm_slot_list
comma
op_amp
id|ibmphp_slot_head
)paren
suffix:semicolon
)brace
id|print_bus_info
(paren
)paren
suffix:semicolon
id|list_add
(paren
op_amp
id|hpc_ptr-&gt;ebda_hpc_list
comma
op_amp
id|ebda_hpc_head
)paren
suffix:semicolon
)brace
multiline_comment|/* each hpc  */
id|list_for_each
(paren
id|list
comma
op_amp
id|ibmphp_slot_head
)paren
(brace
id|tmp_slot
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|slot
comma
id|ibm_slot_list
)paren
suffix:semicolon
id|snprintf
(paren
id|tmp_slot-&gt;hotplug_slot-&gt;name
comma
l_int|30
comma
l_string|&quot;%s&quot;
comma
id|create_file_name
(paren
id|tmp_slot
)paren
)paren
suffix:semicolon
id|pci_hp_register
(paren
id|tmp_slot-&gt;hotplug_slot
)paren
suffix:semicolon
)brace
id|print_ebda_hpc
(paren
)paren
suffix:semicolon
id|print_ibm_slot
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error
suffix:colon
id|kfree
(paren
id|hp_slot_ptr
op_member_access_from_pointer
r_private
)paren
suffix:semicolon
id|error_no_slot
suffix:colon
id|kfree
(paren
id|hp_slot_ptr-&gt;name
)paren
suffix:semicolon
id|error_no_hp_name
suffix:colon
id|kfree
(paren
id|hp_slot_ptr-&gt;info
)paren
suffix:semicolon
id|error_no_hp_info
suffix:colon
id|kfree
(paren
id|hp_slot_ptr
)paren
suffix:semicolon
id|error_no_hp_slot
suffix:colon
id|free_ebda_hpc
(paren
id|hpc_ptr
)paren
suffix:semicolon
id|error_no_hpc
suffix:colon
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* &n; * map info (bus, devfun, start addr, end addr..) of i/o, memory,&n; * pfm from the physical addr to a list of resource.&n; */
DECL|function|ebda_rsrc_rsrc
r_static
r_int
id|__init
id|ebda_rsrc_rsrc
(paren
r_void
)paren
(brace
id|u16
id|addr
suffix:semicolon
r_int
id|rsrc
suffix:semicolon
id|u8
id|type
comma
id|rsrc_type
suffix:semicolon
r_struct
id|ebda_pci_rsrc
op_star
id|rsrc_ptr
suffix:semicolon
id|addr
op_assign
id|rsrc_list_ptr-&gt;phys_addr
suffix:semicolon
id|debug
(paren
l_string|&quot;now entering rsrc land&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;offset of rsrc: %x&bslash;n&quot;
comma
id|rsrc_list_ptr-&gt;phys_addr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|rsrc
op_assign
l_int|0
suffix:semicolon
id|rsrc
OL
id|rsrc_list_ptr-&gt;num_entries
suffix:semicolon
id|rsrc
op_increment
)paren
(brace
id|type
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|1
suffix:semicolon
id|rsrc_type
op_assign
id|type
op_amp
id|EBDA_RSRC_TYPE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|rsrc_type
op_eq
id|EBDA_IO_RSRC_TYPE
)paren
(brace
id|rsrc_ptr
op_assign
id|alloc_ebda_pci_rsrc
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsrc_ptr
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|rsrc_ptr-&gt;rsrc_type
op_assign
id|type
suffix:semicolon
id|rsrc_ptr-&gt;bus_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|rsrc_ptr-&gt;dev_fun
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|rsrc_ptr-&gt;start_addr
op_assign
id|readw
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
id|rsrc_ptr-&gt;end_addr
op_assign
id|readw
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|4
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|6
suffix:semicolon
id|debug
(paren
l_string|&quot;rsrc from io type ----&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;rsrc type: %x bus#: %x dev_func: %x start addr: %x end addr: %x&bslash;n&quot;
comma
id|rsrc_ptr-&gt;rsrc_type
comma
id|rsrc_ptr-&gt;bus_num
comma
id|rsrc_ptr-&gt;dev_fun
comma
id|rsrc_ptr-&gt;start_addr
comma
id|rsrc_ptr-&gt;end_addr
)paren
suffix:semicolon
id|list_add
(paren
op_amp
id|rsrc_ptr-&gt;ebda_pci_rsrc_list
comma
op_amp
id|ibmphp_ebda_pci_rsrc_head
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rsrc_type
op_eq
id|EBDA_MEM_RSRC_TYPE
op_logical_or
id|rsrc_type
op_eq
id|EBDA_PFM_RSRC_TYPE
)paren
(brace
id|rsrc_ptr
op_assign
id|alloc_ebda_pci_rsrc
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsrc_ptr
)paren
(brace
id|iounmap
(paren
id|io_mem
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|rsrc_ptr-&gt;rsrc_type
op_assign
id|type
suffix:semicolon
id|rsrc_ptr-&gt;bus_num
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
)paren
suffix:semicolon
id|rsrc_ptr-&gt;dev_fun
op_assign
id|readb
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|rsrc_ptr-&gt;start_addr
op_assign
id|readl
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|2
)paren
suffix:semicolon
id|rsrc_ptr-&gt;end_addr
op_assign
id|readl
(paren
id|io_mem
op_plus
id|addr
op_plus
l_int|6
)paren
suffix:semicolon
id|addr
op_add_assign
l_int|10
suffix:semicolon
id|debug
(paren
l_string|&quot;rsrc from mem or pfm ---&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;rsrc type: %x bus#: %x dev_func: %x start addr: %x end addr: %x&bslash;n&quot;
comma
id|rsrc_ptr-&gt;rsrc_type
comma
id|rsrc_ptr-&gt;bus_num
comma
id|rsrc_ptr-&gt;dev_fun
comma
id|rsrc_ptr-&gt;start_addr
comma
id|rsrc_ptr-&gt;end_addr
)paren
suffix:semicolon
id|list_add
(paren
op_amp
id|rsrc_ptr-&gt;ebda_pci_rsrc_list
comma
op_amp
id|ibmphp_ebda_pci_rsrc_head
)paren
suffix:semicolon
)brace
)brace
id|kfree
(paren
id|rsrc_list_ptr
)paren
suffix:semicolon
id|rsrc_list_ptr
op_assign
l_int|NULL
suffix:semicolon
id|print_ebda_pci_rsrc
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ibmphp_get_total_controllers
id|u16
id|ibmphp_get_total_controllers
(paren
r_void
)paren
(brace
r_return
id|hpc_list_ptr-&gt;num_ctlrs
suffix:semicolon
)brace
DECL|function|ibmphp_get_slot_from_physical_num
r_struct
id|slot
op_star
id|ibmphp_get_slot_from_physical_num
(paren
id|u8
id|physical_num
)paren
(brace
r_struct
id|slot
op_star
id|slot
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list_for_each
(paren
id|list
comma
op_amp
id|ibmphp_slot_head
)paren
(brace
id|slot
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|slot
comma
id|ibm_slot_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slot-&gt;number
op_eq
id|physical_num
)paren
r_return
id|slot
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* To find:&n; *&t;- the smallest slot number&n; *&t;- the largest slot number&n; *&t;- the total number of the slots based on each bus&n; *&t;  (if only one slot per bus slot_min = slot_max )&n; */
DECL|function|ibmphp_find_same_bus_num
r_struct
id|bus_info
op_star
id|ibmphp_find_same_bus_num
(paren
id|u32
id|num
)paren
(brace
r_struct
id|bus_info
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|bus_info_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|bus_info
comma
id|bus_info_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr-&gt;busno
op_eq
id|num
)paren
r_return
id|ptr
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*  Finding relative bus number, in order to map corresponding&n; *  bus register&n; */
DECL|function|ibmphp_get_bus_index
r_int
id|ibmphp_get_bus_index
(paren
id|u8
id|num
)paren
(brace
r_struct
id|bus_info
op_star
id|ptr
suffix:semicolon
r_struct
id|list_head
op_star
id|ptr1
suffix:semicolon
id|list_for_each
(paren
id|ptr1
comma
op_amp
id|bus_info_head
)paren
(brace
id|ptr
op_assign
id|list_entry
(paren
id|ptr1
comma
r_struct
id|bus_info
comma
id|bus_info_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr-&gt;busno
op_eq
id|num
)paren
r_return
id|ptr-&gt;index
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|ibmphp_free_bus_info_queue
r_void
id|ibmphp_free_bus_info_queue
(paren
r_void
)paren
(brace
r_struct
id|bus_info
op_star
id|bus_info
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|list_head
op_star
id|next
suffix:semicolon
id|list_for_each_safe
(paren
id|list
comma
id|next
comma
op_amp
id|bus_info_head
)paren
(brace
id|bus_info
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|bus_info
comma
id|bus_info_list
)paren
suffix:semicolon
id|kfree
(paren
id|bus_info
)paren
suffix:semicolon
)brace
)brace
DECL|function|ibmphp_free_ebda_hpc_queue
r_void
id|ibmphp_free_ebda_hpc_queue
(paren
r_void
)paren
(brace
r_struct
id|controller
op_star
id|controller
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|list_head
op_star
id|next
suffix:semicolon
r_int
id|pci_flag
op_assign
l_int|0
suffix:semicolon
id|list_for_each_safe
(paren
id|list
comma
id|next
comma
op_amp
id|ebda_hpc_head
)paren
(brace
id|controller
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|controller
comma
id|ebda_hpc_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|controller-&gt;ctlr_type
op_eq
l_int|0
)paren
id|release_region
(paren
id|controller-&gt;u.isa_ctlr.io_start
comma
(paren
id|controller-&gt;u.isa_ctlr.io_end
op_minus
id|controller-&gt;u.isa_ctlr.io_start
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|controller-&gt;ctlr_type
op_eq
l_int|1
)paren
op_logical_and
(paren
op_logical_neg
id|pci_flag
)paren
)paren
(brace
op_increment
id|pci_flag
suffix:semicolon
id|pci_unregister_driver
(paren
op_amp
id|ibmphp_driver
)paren
suffix:semicolon
)brace
id|free_ebda_hpc
(paren
id|controller
)paren
suffix:semicolon
)brace
)brace
DECL|function|ibmphp_free_ebda_pci_rsrc_queue
r_void
id|ibmphp_free_ebda_pci_rsrc_queue
(paren
r_void
)paren
(brace
r_struct
id|ebda_pci_rsrc
op_star
id|resource
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|list_head
op_star
id|next
suffix:semicolon
id|list_for_each_safe
(paren
id|list
comma
id|next
comma
op_amp
id|ibmphp_ebda_pci_rsrc_head
)paren
(brace
id|resource
op_assign
id|list_entry
(paren
id|list
comma
r_struct
id|ebda_pci_rsrc
comma
id|ebda_pci_rsrc_list
)paren
suffix:semicolon
id|kfree
(paren
id|resource
)paren
suffix:semicolon
id|resource
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|variable|id_table
r_static
r_struct
id|pci_device_id
id|id_table
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|device
op_assign
id|HPC_DEVICE_ID
comma
dot
id|subvendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|subdevice
op_assign
id|HPC_SUBSYSTEM_ID
comma
dot
r_class
op_assign
(paren
(paren
id|PCI_CLASS_SYSTEM_PCI_HOTPLUG
op_lshift
l_int|8
)paren
op_or
l_int|0x00
)paren
comma
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|id_table
)paren
suffix:semicolon
r_static
r_int
id|ibmphp_probe
(paren
r_struct
id|pci_dev
op_star
comma
r_const
r_struct
id|pci_device_id
op_star
)paren
suffix:semicolon
DECL|variable|ibmphp_driver
r_static
r_struct
id|pci_driver
id|ibmphp_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ibmphp&quot;
comma
dot
id|id_table
op_assign
id|id_table
comma
dot
id|probe
op_assign
id|ibmphp_probe
comma
)brace
suffix:semicolon
DECL|function|ibmphp_register_pci
r_int
id|ibmphp_register_pci
(paren
r_void
)paren
(brace
r_struct
id|controller
op_star
id|ctrl
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|list_for_each
(paren
id|tmp
comma
op_amp
id|ebda_hpc_head
)paren
(brace
id|ctrl
op_assign
id|list_entry
(paren
id|tmp
comma
r_struct
id|controller
comma
id|ebda_hpc_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl-&gt;ctlr_type
op_eq
l_int|1
)paren
(brace
id|rc
op_assign
id|pci_module_init
(paren
op_amp
id|ibmphp_driver
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|ibmphp_probe
r_static
r_int
id|ibmphp_probe
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|ids
)paren
(brace
r_struct
id|controller
op_star
id|ctrl
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
id|debug
(paren
l_string|&quot;inside ibmphp_probe&bslash;n&quot;
)paren
suffix:semicolon
id|list_for_each
(paren
id|tmp
comma
op_amp
id|ebda_hpc_head
)paren
(brace
id|ctrl
op_assign
id|list_entry
(paren
id|tmp
comma
r_struct
id|controller
comma
id|ebda_hpc_list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctrl-&gt;ctlr_type
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;devfn
op_eq
id|ctrl-&gt;u.pci_ctlr.dev_fun
)paren
op_logical_and
(paren
id|dev-&gt;bus-&gt;number
op_eq
id|ctrl-&gt;u.pci_ctlr.bus
)paren
)paren
(brace
id|ctrl-&gt;ctrl_dev
op_assign
id|dev
suffix:semicolon
id|debug
(paren
l_string|&quot;found device!!!&bslash;n&quot;
)paren
suffix:semicolon
id|debug
(paren
l_string|&quot;dev-&gt;device = %x, dev-&gt;subsystem_device = %x&bslash;n&quot;
comma
id|dev-&gt;device
comma
id|dev-&gt;subsystem_device
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
eof
