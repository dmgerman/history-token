multiline_comment|/*&n; * Interface for Dynamic Logical Partitioning of I/O Slots on&n; * RPA-compliant PPC64 platform.&n; *&n; * John Rose &lt;johnrose@austin.ibm.com&gt;&n; * October 2003&n; *&n; * Copyright (C) 2003 IBM.&n; *&n; *      This program is free software; you can redistribute it and/or&n; *      modify it under the terms of the GNU General Public License&n; *      as published by the Free Software Foundation; either version&n; *      2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/kobject.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &quot;pci_hotplug.h&quot;
macro_line|#include &quot;rpadlpar.h&quot;
DECL|macro|DLPAR_KOBJ_NAME
mdefine_line|#define DLPAR_KOBJ_NAME       &quot;control&quot;
DECL|macro|ADD_SLOT_ATTR_NAME
mdefine_line|#define ADD_SLOT_ATTR_NAME    &quot;add_slot&quot;
DECL|macro|REMOVE_SLOT_ATTR_NAME
mdefine_line|#define REMOVE_SLOT_ATTR_NAME &quot;remove_slot&quot;
DECL|macro|MAX_DRC_NAME_LEN
mdefine_line|#define MAX_DRC_NAME_LEN 64
multiline_comment|/* Store return code of dlpar operation in attribute struct */
DECL|struct|dlpar_io_attr
r_struct
id|dlpar_io_attr
(brace
DECL|member|rc
r_int
id|rc
suffix:semicolon
DECL|member|attr
r_struct
id|attribute
id|attr
suffix:semicolon
DECL|member|store
id|ssize_t
(paren
op_star
id|store
)paren
(paren
r_struct
id|dlpar_io_attr
op_star
id|dlpar_attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|nbytes
)paren
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Common show callback for all attrs, display the return code&n; * of the dlpar op */
r_static
id|ssize_t
DECL|function|dlpar_attr_show
id|dlpar_attr_show
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|dlpar_io_attr
op_star
id|dlpar_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|dlpar_io_attr
comma
id|attr
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|dlpar_attr-&gt;rc
)paren
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|dlpar_attr_store
id|dlpar_attr_store
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
comma
r_struct
id|attribute
op_star
id|attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|nbytes
)paren
(brace
r_struct
id|dlpar_io_attr
op_star
id|dlpar_attr
op_assign
id|container_of
c_func
(paren
id|attr
comma
r_struct
id|dlpar_io_attr
comma
id|attr
)paren
suffix:semicolon
r_return
id|dlpar_attr-&gt;store
ques
c_cond
id|dlpar_attr
op_member_access_from_pointer
id|store
c_func
(paren
id|dlpar_attr
comma
id|buf
comma
id|nbytes
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|variable|dlpar_attr_sysfs_ops
r_static
r_struct
id|sysfs_ops
id|dlpar_attr_sysfs_ops
op_assign
(brace
dot
id|show
op_assign
id|dlpar_attr_show
comma
dot
id|store
op_assign
id|dlpar_attr_store
comma
)brace
suffix:semicolon
DECL|function|add_slot_store
r_static
id|ssize_t
id|add_slot_store
c_func
(paren
r_struct
id|dlpar_io_attr
op_star
id|dlpar_attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|nbytes
)paren
(brace
r_char
id|drc_name
(braket
id|MAX_DRC_NAME_LEN
)braket
suffix:semicolon
r_char
op_star
id|end
suffix:semicolon
r_if
c_cond
(paren
id|nbytes
OG
id|MAX_DRC_NAME_LEN
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|drc_name
comma
id|buf
comma
id|nbytes
)paren
suffix:semicolon
id|end
op_assign
id|strchr
c_func
(paren
id|drc_name
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|end
)paren
id|end
op_assign
op_amp
id|drc_name
(braket
id|nbytes
)braket
suffix:semicolon
op_star
id|end
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dlpar_attr-&gt;rc
op_assign
id|dlpar_add_slot
c_func
(paren
id|drc_name
)paren
suffix:semicolon
r_return
id|nbytes
suffix:semicolon
)brace
DECL|function|remove_slot_store
r_static
id|ssize_t
id|remove_slot_store
c_func
(paren
r_struct
id|dlpar_io_attr
op_star
id|dlpar_attr
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|nbytes
)paren
(brace
r_char
id|drc_name
(braket
id|MAX_DRC_NAME_LEN
)braket
suffix:semicolon
r_char
op_star
id|end
suffix:semicolon
r_if
c_cond
(paren
id|nbytes
OG
id|MAX_DRC_NAME_LEN
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|drc_name
comma
id|buf
comma
id|nbytes
)paren
suffix:semicolon
id|end
op_assign
id|strchr
c_func
(paren
id|drc_name
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|end
)paren
id|end
op_assign
op_amp
id|drc_name
(braket
id|nbytes
)braket
suffix:semicolon
op_star
id|end
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dlpar_attr-&gt;rc
op_assign
id|dlpar_remove_slot
c_func
(paren
id|drc_name
)paren
suffix:semicolon
r_return
id|nbytes
suffix:semicolon
)brace
DECL|variable|add_slot_attr
r_static
r_struct
id|dlpar_io_attr
id|add_slot_attr
op_assign
(brace
dot
id|rc
op_assign
l_int|0
comma
dot
id|attr
op_assign
(brace
dot
id|name
op_assign
id|ADD_SLOT_ATTR_NAME
comma
dot
id|mode
op_assign
l_int|0644
comma
)brace
comma
dot
id|store
op_assign
id|add_slot_store
comma
)brace
suffix:semicolon
DECL|variable|remove_slot_attr
r_static
r_struct
id|dlpar_io_attr
id|remove_slot_attr
op_assign
(brace
dot
id|rc
op_assign
l_int|0
comma
dot
id|attr
op_assign
(brace
dot
id|name
op_assign
id|REMOVE_SLOT_ATTR_NAME
comma
dot
id|mode
op_assign
l_int|0644
)brace
comma
dot
id|store
op_assign
id|remove_slot_store
comma
)brace
suffix:semicolon
DECL|variable|default_attrs
r_static
r_struct
id|attribute
op_star
id|default_attrs
(braket
)braket
op_assign
(brace
op_amp
id|add_slot_attr.attr
comma
op_amp
id|remove_slot_attr.attr
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|function|dlpar_io_release
r_static
r_void
id|dlpar_io_release
c_func
(paren
r_struct
id|kobject
op_star
id|kobj
)paren
(brace
multiline_comment|/* noop */
r_return
suffix:semicolon
)brace
DECL|variable|ktype_dlpar_io
r_struct
id|kobj_type
id|ktype_dlpar_io
op_assign
(brace
dot
id|release
op_assign
id|dlpar_io_release
comma
dot
id|sysfs_ops
op_assign
op_amp
id|dlpar_attr_sysfs_ops
comma
dot
id|default_attrs
op_assign
id|default_attrs
comma
)brace
suffix:semicolon
DECL|variable|dlpar_io_kset
r_struct
id|kset
id|dlpar_io_kset
op_assign
(brace
dot
id|subsys
op_assign
op_amp
id|pci_hotplug_slots_subsys
comma
dot
id|kobj
op_assign
(brace
dot
id|name
op_assign
id|DLPAR_KOBJ_NAME
comma
dot
id|ktype
op_assign
op_amp
id|ktype_dlpar_io
comma
)brace
comma
dot
id|ktype
op_assign
op_amp
id|ktype_dlpar_io
comma
)brace
suffix:semicolon
DECL|function|dlpar_sysfs_init
r_int
id|dlpar_sysfs_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kset_register
c_func
(paren
op_amp
id|dlpar_io_kset
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;rpadlpar_io: cannot register kset for %s&bslash;n&quot;
comma
id|dlpar_io_kset.kobj.name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dlpar_sysfs_exit
r_void
id|dlpar_sysfs_exit
c_func
(paren
r_void
)paren
(brace
id|kset_unregister
c_func
(paren
op_amp
id|dlpar_io_kset
)paren
suffix:semicolon
)brace
eof
