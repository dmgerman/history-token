multiline_comment|/*&n; * PCI Express Hot Plug Controller Driver&n; *&n; * Copyright (C) 1995,2001 Compaq Computer Corporation&n; * Copyright (C) 2001 Greg Kroah-Hartman (greg@kroah.com)&n; * Copyright (C) 2001 IBM Corp.&n; * Copyright (C) 2003-2004 Intel Corporation&n; *&n; * All rights reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or (at&n; * your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, GOOD TITLE or&n; * NON INFRINGEMENT.  See the GNU General Public License for more&n; * details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Send feedback to &lt;greg@kroah.com&gt;, &lt;dely.l.sy@intel.com&gt;&n; *&n; */
macro_line|#ifndef _PCIEHP_H
DECL|macro|_PCIEHP_H
mdefine_line|#define _PCIEHP_H
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/io.h&gt;&t;&t;
macro_line|#include &quot;pci_hotplug.h&quot;
DECL|macro|MY_NAME
mdefine_line|#define MY_NAME&t;&quot;pciehp&quot;
r_extern
r_int
id|pciehp_poll_mode
suffix:semicolon
r_extern
r_int
id|pciehp_poll_time
suffix:semicolon
r_extern
r_int
id|pciehp_debug
suffix:semicolon
multiline_comment|/*#define dbg(format, arg...) do { if (pciehp_debug) printk(KERN_DEBUG &quot;%s: &quot; format, MY_NAME , ## arg); } while (0)*/
DECL|macro|dbg
mdefine_line|#define dbg(format, arg...) do { if (pciehp_debug) printk(&quot;%s: &quot; format, MY_NAME , ## arg); } while (0)
DECL|macro|err
mdefine_line|#define err(format, arg...) printk(KERN_ERR &quot;%s: &quot; format, MY_NAME , ## arg)
DECL|macro|info
mdefine_line|#define info(format, arg...) printk(KERN_INFO &quot;%s: &quot; format, MY_NAME , ## arg)
DECL|macro|warn
mdefine_line|#define warn(format, arg...) printk(KERN_WARNING &quot;%s: &quot; format, MY_NAME , ## arg)
DECL|struct|pci_func
r_struct
id|pci_func
(brace
DECL|member|next
r_struct
id|pci_func
op_star
id|next
suffix:semicolon
DECL|member|bus
id|u8
id|bus
suffix:semicolon
DECL|member|device
id|u8
id|device
suffix:semicolon
DECL|member|function
id|u8
id|function
suffix:semicolon
DECL|member|is_a_board
id|u8
id|is_a_board
suffix:semicolon
DECL|member|status
id|u16
id|status
suffix:semicolon
DECL|member|configured
id|u8
id|configured
suffix:semicolon
DECL|member|switch_save
id|u8
id|switch_save
suffix:semicolon
DECL|member|presence_save
id|u8
id|presence_save
suffix:semicolon
DECL|member|base_length
id|u32
id|base_length
(braket
l_int|0x06
)braket
suffix:semicolon
DECL|member|base_type
id|u8
id|base_type
(braket
l_int|0x06
)braket
suffix:semicolon
DECL|member|reserved2
id|u16
id|reserved2
suffix:semicolon
DECL|member|config_space
id|u32
id|config_space
(braket
l_int|0x20
)braket
suffix:semicolon
DECL|member|mem_head
r_struct
id|pci_resource
op_star
id|mem_head
suffix:semicolon
DECL|member|p_mem_head
r_struct
id|pci_resource
op_star
id|p_mem_head
suffix:semicolon
DECL|member|io_head
r_struct
id|pci_resource
op_star
id|io_head
suffix:semicolon
DECL|member|bus_head
r_struct
id|pci_resource
op_star
id|bus_head
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|SLOT_MAGIC
mdefine_line|#define SLOT_MAGIC&t;0x67267321
DECL|struct|slot
r_struct
id|slot
(brace
DECL|member|magic
id|u32
id|magic
suffix:semicolon
DECL|member|next
r_struct
id|slot
op_star
id|next
suffix:semicolon
DECL|member|bus
id|u8
id|bus
suffix:semicolon
DECL|member|device
id|u8
id|device
suffix:semicolon
DECL|member|number
id|u32
id|number
suffix:semicolon
DECL|member|is_a_board
id|u8
id|is_a_board
suffix:semicolon
DECL|member|configured
id|u8
id|configured
suffix:semicolon
DECL|member|state
id|u8
id|state
suffix:semicolon
DECL|member|switch_save
id|u8
id|switch_save
suffix:semicolon
DECL|member|presence_save
id|u8
id|presence_save
suffix:semicolon
DECL|member|capabilities
id|u32
id|capabilities
suffix:semicolon
DECL|member|reserved2
id|u16
id|reserved2
suffix:semicolon
DECL|member|task_event
r_struct
id|timer_list
id|task_event
suffix:semicolon
DECL|member|hp_slot
id|u8
id|hp_slot
suffix:semicolon
DECL|member|ctrl
r_struct
id|controller
op_star
id|ctrl
suffix:semicolon
DECL|member|hpc_ops
r_struct
id|hpc_ops
op_star
id|hpc_ops
suffix:semicolon
DECL|member|hotplug_slot
r_struct
id|hotplug_slot
op_star
id|hotplug_slot
suffix:semicolon
DECL|member|slot_list
r_struct
id|list_head
id|slot_list
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|pci_resource
r_struct
id|pci_resource
(brace
DECL|member|next
r_struct
id|pci_resource
op_star
id|next
suffix:semicolon
DECL|member|base
id|u32
id|base
suffix:semicolon
DECL|member|length
id|u32
id|length
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|event_info
r_struct
id|event_info
(brace
DECL|member|event_type
id|u32
id|event_type
suffix:semicolon
DECL|member|hp_slot
id|u8
id|hp_slot
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|controller
r_struct
id|controller
(brace
DECL|member|next
r_struct
id|controller
op_star
id|next
suffix:semicolon
DECL|member|crit_sect
r_struct
id|semaphore
id|crit_sect
suffix:semicolon
multiline_comment|/* critical section semaphore */
DECL|member|hpc_ctlr_handle
r_void
op_star
id|hpc_ctlr_handle
suffix:semicolon
multiline_comment|/* HPC controller handle */
DECL|member|num_slots
r_int
id|num_slots
suffix:semicolon
multiline_comment|/* Number of slots on ctlr */
DECL|member|slot_num_inc
r_int
id|slot_num_inc
suffix:semicolon
multiline_comment|/* 1 or -1 */
DECL|member|mem_head
r_struct
id|pci_resource
op_star
id|mem_head
suffix:semicolon
DECL|member|p_mem_head
r_struct
id|pci_resource
op_star
id|p_mem_head
suffix:semicolon
DECL|member|io_head
r_struct
id|pci_resource
op_star
id|io_head
suffix:semicolon
DECL|member|bus_head
r_struct
id|pci_resource
op_star
id|bus_head
suffix:semicolon
DECL|member|pci_dev
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
DECL|member|pci_bus
r_struct
id|pci_bus
op_star
id|pci_bus
suffix:semicolon
DECL|member|event_queue
r_struct
id|event_info
id|event_queue
(braket
l_int|10
)braket
suffix:semicolon
DECL|member|slot
r_struct
id|slot
op_star
id|slot
suffix:semicolon
DECL|member|hpc_ops
r_struct
id|hpc_ops
op_star
id|hpc_ops
suffix:semicolon
DECL|member|queue
id|wait_queue_head_t
id|queue
suffix:semicolon
multiline_comment|/* sleep &amp; wake process */
DECL|member|next_event
id|u8
id|next_event
suffix:semicolon
DECL|member|seg
id|u8
id|seg
suffix:semicolon
DECL|member|bus
id|u8
id|bus
suffix:semicolon
DECL|member|device
id|u8
id|device
suffix:semicolon
DECL|member|function
id|u8
id|function
suffix:semicolon
DECL|member|rev
id|u8
id|rev
suffix:semicolon
DECL|member|slot_device_offset
id|u8
id|slot_device_offset
suffix:semicolon
DECL|member|add_support
id|u8
id|add_support
suffix:semicolon
DECL|member|speed
r_enum
id|pci_bus_speed
id|speed
suffix:semicolon
DECL|member|first_slot
id|u32
id|first_slot
suffix:semicolon
multiline_comment|/* First physical slot number */
multiline_comment|/* PCIE only has 1 slot */
DECL|member|slot_bus
id|u8
id|slot_bus
suffix:semicolon
multiline_comment|/* Bus where the slots handled by this controller sit */
DECL|member|push_flag
id|u8
id|push_flag
suffix:semicolon
DECL|member|ctlrcap
id|u16
id|ctlrcap
suffix:semicolon
DECL|member|vendor_id
id|u16
id|vendor_id
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|irq_mapping
r_struct
id|irq_mapping
(brace
DECL|member|barber_pole
id|u8
id|barber_pole
suffix:semicolon
DECL|member|valid_INT
id|u8
id|valid_INT
suffix:semicolon
DECL|member|interrupt
id|u8
id|interrupt
(braket
l_int|4
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|resource_lists
r_struct
id|resource_lists
(brace
DECL|member|mem_head
r_struct
id|pci_resource
op_star
id|mem_head
suffix:semicolon
DECL|member|p_mem_head
r_struct
id|pci_resource
op_star
id|p_mem_head
suffix:semicolon
DECL|member|io_head
r_struct
id|pci_resource
op_star
id|io_head
suffix:semicolon
DECL|member|bus_head
r_struct
id|pci_resource
op_star
id|bus_head
suffix:semicolon
DECL|member|irqs
r_struct
id|irq_mapping
op_star
id|irqs
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|INT_BUTTON_IGNORE
mdefine_line|#define INT_BUTTON_IGNORE&t;&t;0
DECL|macro|INT_PRESENCE_ON
mdefine_line|#define INT_PRESENCE_ON&t;&t;&t;1
DECL|macro|INT_PRESENCE_OFF
mdefine_line|#define INT_PRESENCE_OFF&t;&t;2
DECL|macro|INT_SWITCH_CLOSE
mdefine_line|#define INT_SWITCH_CLOSE&t;&t;3
DECL|macro|INT_SWITCH_OPEN
mdefine_line|#define INT_SWITCH_OPEN&t;&t;&t;4
DECL|macro|INT_POWER_FAULT
mdefine_line|#define INT_POWER_FAULT&t;&t;&t;5
DECL|macro|INT_POWER_FAULT_CLEAR
mdefine_line|#define INT_POWER_FAULT_CLEAR&t;&t;6
DECL|macro|INT_BUTTON_PRESS
mdefine_line|#define INT_BUTTON_PRESS&t;&t;7
DECL|macro|INT_BUTTON_RELEASE
mdefine_line|#define INT_BUTTON_RELEASE&t;&t;8
DECL|macro|INT_BUTTON_CANCEL
mdefine_line|#define INT_BUTTON_CANCEL&t;&t;9
DECL|macro|STATIC_STATE
mdefine_line|#define STATIC_STATE&t;&t;&t;0
DECL|macro|BLINKINGON_STATE
mdefine_line|#define BLINKINGON_STATE&t;&t;1
DECL|macro|BLINKINGOFF_STATE
mdefine_line|#define BLINKINGOFF_STATE&t;&t;2
DECL|macro|POWERON_STATE
mdefine_line|#define POWERON_STATE&t;&t;&t;3
DECL|macro|POWEROFF_STATE
mdefine_line|#define POWEROFF_STATE&t;&t;&t;4
DECL|macro|PCI_TO_PCI_BRIDGE_CLASS
mdefine_line|#define PCI_TO_PCI_BRIDGE_CLASS&t;&t;0x00060400
multiline_comment|/* Error messages */
DECL|macro|INTERLOCK_OPEN
mdefine_line|#define INTERLOCK_OPEN&t;&t;&t;0x00000002
DECL|macro|ADD_NOT_SUPPORTED
mdefine_line|#define ADD_NOT_SUPPORTED&t;&t;0x00000003
DECL|macro|CARD_FUNCTIONING
mdefine_line|#define CARD_FUNCTIONING&t;&t;0x00000005
DECL|macro|ADAPTER_NOT_SAME
mdefine_line|#define ADAPTER_NOT_SAME&t;&t;0x00000006
DECL|macro|NO_ADAPTER_PRESENT
mdefine_line|#define NO_ADAPTER_PRESENT&t;&t;0x00000009
DECL|macro|NOT_ENOUGH_RESOURCES
mdefine_line|#define NOT_ENOUGH_RESOURCES&t;&t;0x0000000B
DECL|macro|DEVICE_TYPE_NOT_SUPPORTED
mdefine_line|#define DEVICE_TYPE_NOT_SUPPORTED&t;0x0000000C
DECL|macro|WRONG_BUS_FREQUENCY
mdefine_line|#define WRONG_BUS_FREQUENCY&t;&t;0x0000000D
DECL|macro|POWER_FAILURE
mdefine_line|#define POWER_FAILURE&t;&t;&t;0x0000000E
DECL|macro|REMOVE_NOT_SUPPORTED
mdefine_line|#define REMOVE_NOT_SUPPORTED&t;&t;0x00000003
DECL|macro|DISABLE_CARD
mdefine_line|#define DISABLE_CARD&t;&t;&t;1
multiline_comment|/*&n; * error Messages&n; */
DECL|macro|msg_initialization_err
mdefine_line|#define msg_initialization_err&t;&quot;Initialization failure, error=%d&bslash;n&quot;
DECL|macro|msg_HPC_rev_error
mdefine_line|#define msg_HPC_rev_error&t;&quot;Unsupported revision of the PCI hot plug controller found.&bslash;n&quot;
DECL|macro|msg_HPC_non_pcie
mdefine_line|#define msg_HPC_non_pcie&t;&quot;The PCI hot plug controller is not supported by this driver.&bslash;n&quot;
DECL|macro|msg_HPC_not_supported
mdefine_line|#define msg_HPC_not_supported&t;&quot;This system is not supported by this version of pciephd mdoule. Upgrade to a newer version of pciehpd&bslash;n&quot;
DECL|macro|msg_unable_to_save
mdefine_line|#define msg_unable_to_save&t;&quot;Unable to store PCI hot plug add resource information. This system must be rebooted before adding any PCI devices.&bslash;n&quot;
DECL|macro|msg_button_on
mdefine_line|#define msg_button_on&t;&t;&quot;PCI slot #%d - powering on due to button press.&bslash;n&quot;
DECL|macro|msg_button_off
mdefine_line|#define msg_button_off&t;&t;&quot;PCI slot #%d - powering off due to button press.&bslash;n&quot;
DECL|macro|msg_button_cancel
mdefine_line|#define msg_button_cancel&t;&quot;PCI slot #%d - action canceled due to button press.&bslash;n&quot;
DECL|macro|msg_button_ignore
mdefine_line|#define msg_button_ignore&t;&quot;PCI slot #%d - button press ignored.  (action in progress...)&bslash;n&quot;
multiline_comment|/* sysfs function for the hotplug controller info */
r_extern
r_void
id|pciehp_create_ctrl_files
(paren
r_struct
id|controller
op_star
id|ctrl
)paren
suffix:semicolon
multiline_comment|/* controller functions */
r_extern
r_void
id|pciehp_pushbutton_thread
(paren
r_int
r_int
id|event_pointer
)paren
suffix:semicolon
r_extern
r_int
id|pciehprm_find_available_resources
(paren
r_struct
id|controller
op_star
id|ctrl
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_event_start_thread
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|pciehp_event_stop_thread
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|pci_func
op_star
id|pciehp_slot_create
(paren
r_int
r_char
id|busnumber
)paren
suffix:semicolon
r_extern
r_struct
id|pci_func
op_star
id|pciehp_slot_find
(paren
r_int
r_char
id|bus
comma
r_int
r_char
id|device
comma
r_int
r_char
id|index
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_enable_slot
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_disable_slot
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
r_extern
id|u8
id|pciehp_handle_attention_button
(paren
id|u8
id|hp_slot
comma
r_void
op_star
id|inst_id
)paren
suffix:semicolon
r_extern
id|u8
id|pciehp_handle_switch_change
(paren
id|u8
id|hp_slot
comma
r_void
op_star
id|inst_id
)paren
suffix:semicolon
r_extern
id|u8
id|pciehp_handle_presence_change
(paren
id|u8
id|hp_slot
comma
r_void
op_star
id|inst_id
)paren
suffix:semicolon
r_extern
id|u8
id|pciehp_handle_power_fault
(paren
id|u8
id|hp_slot
comma
r_void
op_star
id|inst_id
)paren
suffix:semicolon
multiline_comment|/* extern void&t;long_delay (int delay); */
multiline_comment|/* resource functions */
r_extern
r_int
id|pciehp_resource_sort_and_combine
(paren
r_struct
id|pci_resource
op_star
op_star
id|head
)paren
suffix:semicolon
multiline_comment|/* pci functions */
r_extern
r_int
id|pciehp_set_irq
(paren
id|u8
id|bus_num
comma
id|u8
id|dev_num
comma
id|u8
id|int_pin
comma
id|u8
id|irq_num
)paren
suffix:semicolon
multiline_comment|/*extern int&t;pciehp_get_bus_dev&t;&t;(struct controller *ctrl, u8 *bus_num, u8 *dev_num, struct slot *slot);*/
r_extern
r_int
id|pciehp_save_config
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_int
id|busnumber
comma
r_int
id|num_ctlr_slots
comma
r_int
id|first_device_num
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_save_used_resources
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_struct
id|pci_func
op_star
id|func
comma
r_int
id|flag
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_save_slot_config
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_struct
id|pci_func
op_star
id|new_slot
)paren
suffix:semicolon
r_extern
r_void
id|pciehp_destroy_board_resources
(paren
r_struct
id|pci_func
op_star
id|func
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_return_board_resources
(paren
r_struct
id|pci_func
op_star
id|func
comma
r_struct
id|resource_lists
op_star
id|resources
)paren
suffix:semicolon
r_extern
r_void
id|pciehp_destroy_resource_list
(paren
r_struct
id|resource_lists
op_star
id|resources
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_configure_device
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_struct
id|pci_func
op_star
id|func
)paren
suffix:semicolon
r_extern
r_int
id|pciehp_unconfigure_device
(paren
r_struct
id|pci_func
op_star
id|func
)paren
suffix:semicolon
multiline_comment|/* Global variables */
r_extern
r_struct
id|controller
op_star
id|pciehp_ctrl_list
suffix:semicolon
r_extern
r_struct
id|pci_func
op_star
id|pciehp_slot_list
(braket
l_int|256
)braket
suffix:semicolon
multiline_comment|/* Inline functions */
multiline_comment|/* Inline functions to check the sanity of a pointer that is passed to us */
DECL|function|slot_paranoia_check
r_static
r_inline
r_int
id|slot_paranoia_check
(paren
r_struct
id|slot
op_star
id|slot
comma
r_const
r_char
op_star
id|function
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|slot
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - slot == NULL&quot;
comma
id|function
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slot-&gt;magic
op_ne
id|SLOT_MAGIC
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - bad magic number for slot&quot;
comma
id|function
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|slot-&gt;hotplug_slot
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - slot-&gt;hotplug_slot == NULL!&quot;
comma
id|function
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_slot
r_static
r_inline
r_struct
id|slot
op_star
id|get_slot
(paren
r_struct
id|hotplug_slot
op_star
id|hotplug_slot
comma
r_const
r_char
op_star
id|function
)paren
(brace
r_struct
id|slot
op_star
id|slot
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hotplug_slot
)paren
(brace
id|dbg
c_func
(paren
l_string|&quot;%s - hotplug_slot == NULL&bslash;n&quot;
comma
id|function
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|slot
op_assign
(paren
r_struct
id|slot
op_star
)paren
id|hotplug_slot
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|slot_paranoia_check
(paren
id|slot
comma
id|function
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|slot
suffix:semicolon
)brace
DECL|function|pciehp_find_slot
r_static
r_inline
r_struct
id|slot
op_star
id|pciehp_find_slot
(paren
r_struct
id|controller
op_star
id|ctrl
comma
id|u8
id|device
)paren
(brace
r_struct
id|slot
op_star
id|p_slot
comma
op_star
id|tmp_slot
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ctrl
)paren
r_return
l_int|NULL
suffix:semicolon
id|p_slot
op_assign
id|ctrl-&gt;slot
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;p_slot = %p&bslash;n&quot;
comma
id|p_slot
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p_slot
op_logical_and
(paren
id|p_slot-&gt;device
op_ne
id|device
)paren
)paren
(brace
id|tmp_slot
op_assign
id|p_slot
suffix:semicolon
id|p_slot
op_assign
id|p_slot-&gt;next
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;In while loop, p_slot = %p&bslash;n&quot;
comma
id|p_slot
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p_slot
op_eq
l_int|NULL
)paren
(brace
id|err
c_func
(paren
l_string|&quot;ERROR: pciehp_find_slot device=0x%x&bslash;n&quot;
comma
id|device
)paren
suffix:semicolon
id|p_slot
op_assign
id|tmp_slot
suffix:semicolon
)brace
r_return
(paren
id|p_slot
)paren
suffix:semicolon
)brace
DECL|function|wait_for_ctrl_irq
r_static
r_inline
r_int
id|wait_for_ctrl_irq
(paren
r_struct
id|controller
op_star
id|ctrl
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s : start&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|ctrl-&gt;queue
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pciehp_poll_mode
)paren
(brace
multiline_comment|/* Sleep for up to 1 second */
id|schedule_timeout
c_func
(paren
l_int|1
op_star
id|HZ
)paren
suffix:semicolon
)brace
r_else
id|schedule_timeout
c_func
(paren
l_float|2.5
op_star
id|HZ
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|ctrl-&gt;queue
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
id|retval
op_assign
op_minus
id|EINTR
suffix:semicolon
id|dbg
c_func
(paren
l_string|&quot;%s : end&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Puts node back in the resource list pointed to by head */
DECL|function|return_resource
r_static
r_inline
r_void
id|return_resource
c_func
(paren
r_struct
id|pci_resource
op_star
op_star
id|head
comma
r_struct
id|pci_resource
op_star
id|node
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|node
op_logical_or
op_logical_neg
id|head
)paren
r_return
suffix:semicolon
id|node-&gt;next
op_assign
op_star
id|head
suffix:semicolon
op_star
id|head
op_assign
id|node
suffix:semicolon
)brace
DECL|macro|SLOT_NAME_SIZE
mdefine_line|#define SLOT_NAME_SIZE 10
DECL|function|make_slot_name
r_static
r_inline
r_void
id|make_slot_name
c_func
(paren
r_char
op_star
id|buffer
comma
r_int
id|buffer_size
comma
r_struct
id|slot
op_star
id|slot
)paren
(brace
id|snprintf
c_func
(paren
id|buffer
comma
id|buffer_size
comma
l_string|&quot;%d&quot;
comma
id|slot-&gt;number
)paren
suffix:semicolon
)brace
DECL|enum|php_ctlr_type
r_enum
id|php_ctlr_type
(brace
DECL|enumerator|PCI
id|PCI
comma
DECL|enumerator|ISA
id|ISA
comma
DECL|enumerator|ACPI
id|ACPI
)brace
suffix:semicolon
DECL|typedef|php_intr_callback_t
r_typedef
id|u8
c_func
(paren
op_star
id|php_intr_callback_t
)paren
(paren
r_int
r_int
id|change_id
comma
r_void
op_star
id|instance_id
)paren
suffix:semicolon
r_int
id|pcie_init
c_func
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_struct
id|pci_dev
op_star
id|pdev
comma
id|php_intr_callback_t
id|attention_button_callback
comma
id|php_intr_callback_t
id|switch_change_callback
comma
id|php_intr_callback_t
id|presence_change_callback
comma
id|php_intr_callback_t
id|power_fault_callback
)paren
suffix:semicolon
multiline_comment|/* This has no meaning for PCI Express, as there is only 1 slot per port */
r_int
id|pcie_get_ctlr_slot_config
c_func
(paren
r_struct
id|controller
op_star
id|ctrl
comma
r_int
op_star
id|num_ctlr_slots
comma
r_int
op_star
id|first_device_num
comma
r_int
op_star
id|physical_slot_num
comma
r_int
op_star
id|updown
comma
r_int
op_star
id|flags
)paren
suffix:semicolon
DECL|struct|hpc_ops
r_struct
id|hpc_ops
(brace
DECL|member|power_on_slot
r_int
(paren
op_star
id|power_on_slot
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|power_off_slot
r_int
(paren
op_star
id|power_off_slot
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|get_power_status
r_int
(paren
op_star
id|get_power_status
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
id|u8
op_star
id|status
)paren
suffix:semicolon
DECL|member|get_attention_status
r_int
(paren
op_star
id|get_attention_status
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
id|u8
op_star
id|status
)paren
suffix:semicolon
DECL|member|set_attention_status
r_int
(paren
op_star
id|set_attention_status
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
id|u8
id|status
)paren
suffix:semicolon
DECL|member|get_latch_status
r_int
(paren
op_star
id|get_latch_status
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
id|u8
op_star
id|status
)paren
suffix:semicolon
DECL|member|get_adapter_status
r_int
(paren
op_star
id|get_adapter_status
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
id|u8
op_star
id|status
)paren
suffix:semicolon
DECL|member|get_max_bus_speed
r_int
(paren
op_star
id|get_max_bus_speed
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
r_enum
id|pci_bus_speed
op_star
id|speed
)paren
suffix:semicolon
DECL|member|get_cur_bus_speed
r_int
(paren
op_star
id|get_cur_bus_speed
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
r_enum
id|pci_bus_speed
op_star
id|speed
)paren
suffix:semicolon
DECL|member|get_max_lnk_width
r_int
(paren
op_star
id|get_max_lnk_width
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
r_enum
id|pcie_link_width
op_star
id|value
)paren
suffix:semicolon
DECL|member|get_cur_lnk_width
r_int
(paren
op_star
id|get_cur_lnk_width
)paren
(paren
r_struct
id|slot
op_star
id|slot
comma
r_enum
id|pcie_link_width
op_star
id|value
)paren
suffix:semicolon
DECL|member|query_power_fault
r_int
(paren
op_star
id|query_power_fault
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|green_led_on
r_void
(paren
op_star
id|green_led_on
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|green_led_off
r_void
(paren
op_star
id|green_led_off
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|green_led_blink
r_void
(paren
op_star
id|green_led_blink
)paren
(paren
r_struct
id|slot
op_star
id|slot
)paren
suffix:semicolon
DECL|member|release_ctlr
r_void
(paren
op_star
id|release_ctlr
)paren
(paren
r_struct
id|controller
op_star
id|ctrl
)paren
suffix:semicolon
DECL|member|check_lnk_status
r_int
(paren
op_star
id|check_lnk_status
)paren
(paren
r_struct
id|controller
op_star
id|ctrl
)paren
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* _PCIEHP_H */
eof
