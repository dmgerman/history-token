multiline_comment|/*&n; *  IBM/3270 Driver -- Copyright (C) 2000 UTS Global LLC&n; *&n; *  tubttybld.c -- Linemode tty driver screen-building functions&n; *&n; *&n; *&n; *&n; *&n; *  Author:  Richard Hitt&n; */
macro_line|#include &quot;tubio.h&quot;
r_extern
r_int
id|tty3270_io
c_func
(paren
id|tub_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|tty3270_set_status_area
c_func
(paren
id|tub_t
op_star
comma
r_char
op_star
op_star
)paren
suffix:semicolon
r_static
r_int
id|tty3270_next_char
c_func
(paren
id|tub_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|tty3270_update_log_area
c_func
(paren
id|tub_t
op_star
comma
r_char
op_star
op_star
)paren
suffix:semicolon
r_static
r_void
id|tty3270_update_log_area_esc
c_func
(paren
id|tub_t
op_star
comma
r_char
op_star
op_star
)paren
suffix:semicolon
r_static
r_void
id|tty3270_clear_log_area
c_func
(paren
id|tub_t
op_star
comma
r_char
op_star
op_star
)paren
suffix:semicolon
r_static
r_void
id|tty3270_tub_bufadr
c_func
(paren
id|tub_t
op_star
comma
r_int
comma
r_char
op_star
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; * tty3270_clear_log_area(tub_t *tubp, char **cpp)&n; */
r_static
r_void
DECL|function|tty3270_clear_log_area
id|tty3270_clear_log_area
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_LOG
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SF
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TF_LOG
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_RA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_INPUT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|tubp-&gt;tty_oucol
op_assign
id|tubp-&gt;tty_nextlogx
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|tty3270_update_log_area
id|tty3270_update_log_area
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
r_int
id|lastx
op_assign
id|GEOM_INPUT
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|next
comma
id|fill
comma
id|i
suffix:semicolon
r_int
id|sba_needed
op_assign
l_int|1
suffix:semicolon
r_char
op_star
id|overrun
op_assign
op_amp
(paren
op_star
id|tubp-&gt;ttyscreen
)paren
(braket
id|tubp-&gt;ttyscreenl
op_minus
id|TS_LENGTH
)braket
suffix:semicolon
multiline_comment|/* Place characters */
r_while
c_loop
(paren
id|tubp-&gt;tty_bcb.bc_cnt
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tubp-&gt;tty_nextlogx
op_ge
id|lastx
)paren
(brace
r_if
c_cond
(paren
id|sba_needed
op_eq
l_int|0
op_logical_or
id|tubp-&gt;stat
op_eq
id|TBS_RUNNING
)paren
(brace
id|tubp-&gt;stat
op_assign
id|TBS_MORE
suffix:semicolon
id|tty3270_set_status_area
c_func
(paren
id|tubp
comma
id|cpp
)paren
suffix:semicolon
id|tty3270_scl_settimer
c_func
(paren
id|tubp
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* Check for room for another char + possible ESCs */
r_if
c_cond
(paren
op_amp
(paren
op_star
id|cpp
)paren
(braket
id|tubp-&gt;tty_escx
op_plus
l_int|1
)braket
op_ge
id|overrun
)paren
r_break
suffix:semicolon
multiline_comment|/* Fetch a character */
r_if
c_cond
(paren
(paren
id|c
op_assign
id|tty3270_next_char
c_func
(paren
id|tubp
)paren
)paren
op_eq
op_minus
l_int|1
)paren
r_break
suffix:semicolon
multiline_comment|/* Add a Set-Buffer-Address Order if we haven&squot;t */
r_if
c_cond
(paren
id|sba_needed
)paren
(brace
id|sba_needed
op_assign
l_int|0
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|tubp-&gt;tty_nextlogx
comma
id|cpp
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|c
OL
l_char|&squot; &squot;
)paren
multiline_comment|/* Blank it if we don&squot;t know it */
id|c
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tubp-&gt;tty_escx
suffix:semicolon
id|i
op_increment
)paren
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tubp-&gt;tty_esca
(braket
id|i
)braket
suffix:semicolon
id|tubp-&gt;tty_escx
op_assign
l_int|0
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
(paren
r_int
)paren
id|c
)braket
suffix:semicolon
id|tubp-&gt;tty_nextlogx
op_increment
suffix:semicolon
id|tubp-&gt;tty_oucol
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1b
suffix:colon
multiline_comment|/* ESC */
id|tty3270_update_log_area_esc
c_func
(paren
id|tubp
comma
id|cpp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;r&squot;
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* completely ignore 0x0d = CR. */
r_case
l_char|&squot;&bslash;n&squot;
suffix:colon
r_if
c_cond
(paren
id|tubp-&gt;tty_oucol
op_eq
id|GEOM_COLS
)paren
(brace
id|tubp-&gt;tty_oucol
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|next
op_assign
(paren
id|tubp-&gt;tty_nextlogx
op_plus
id|GEOM_COLS
)paren
op_div
id|GEOM_COLS
op_star
id|GEOM_COLS
suffix:semicolon
id|next
op_assign
id|MIN
c_func
(paren
id|next
comma
id|lastx
)paren
suffix:semicolon
id|fill
op_assign
id|next
op_minus
id|tubp-&gt;tty_nextlogx
suffix:semicolon
r_if
c_cond
(paren
id|fill
OL
l_int|5
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fill
suffix:semicolon
id|i
op_increment
)paren
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
l_char|&squot; &squot;
)braket
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_RA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|next
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
l_char|&squot; &squot;
)braket
suffix:semicolon
)brace
id|tubp-&gt;tty_nextlogx
op_assign
id|next
suffix:semicolon
id|tubp-&gt;tty_oucol
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;t&squot;
suffix:colon
id|fill
op_assign
(paren
id|tubp-&gt;tty_nextlogx
op_mod
id|GEOM_COLS
)paren
op_mod
l_int|8
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|fill
OL
l_int|8
suffix:semicolon
id|fill
op_increment
)paren
(brace
r_if
c_cond
(paren
id|tubp-&gt;tty_nextlogx
op_ge
id|lastx
)paren
r_break
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
l_char|&squot; &squot;
)braket
suffix:semicolon
id|tubp-&gt;tty_nextlogx
op_increment
suffix:semicolon
id|tubp-&gt;tty_oucol
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;a&squot;
suffix:colon
id|tubp-&gt;flags
op_or_assign
id|TUB_ALARM
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;&bslash;f&squot;
suffix:colon
id|tty3270_clear_log_area
c_func
(paren
id|tubp
comma
id|cpp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|macro|NUMQUANT
mdefine_line|#define NUMQUANT 8
r_static
r_void
DECL|function|tty3270_update_log_area_esc
id|tty3270_update_log_area_esc
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
r_int
id|lastx
op_assign
id|GEOM_INPUT
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|start
comma
id|next
comma
id|fill
suffix:semicolon
r_int
id|quant
(braket
id|NUMQUANT
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|c
op_assign
id|tty3270_next_char
c_func
(paren
id|tubp
)paren
)paren
op_ne
l_char|&squot;[&squot;
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Parse potentially empty string &quot;nn;nn;nn...&quot;&n;&t; */
id|i
op_assign
op_minus
l_int|1
suffix:semicolon
id|c
op_assign
l_char|&squot;;&squot;
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;;&squot;
)paren
(brace
r_if
c_cond
(paren
op_increment
id|i
op_eq
id|NUMQUANT
)paren
r_break
suffix:semicolon
id|quant
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
template_param
l_char|&squot;9&squot;
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|quant
(braket
id|i
)braket
op_assign
id|quant
(braket
id|i
)braket
op_star
l_int|10
op_plus
id|c
op_minus
l_char|&squot;0&squot;
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|c
op_assign
id|tty3270_next_char
c_func
(paren
id|tubp
)paren
)paren
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
op_minus
l_int|1
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
id|NUMQUANT
)paren
(brace
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
op_minus
l_int|1
suffix:colon
r_return
suffix:semicolon
r_case
l_char|&squot;m&squot;
suffix:colon
multiline_comment|/* Set Attribute */
r_for
c_loop
(paren
id|next
op_assign
l_int|0
suffix:semicolon
id|next
op_le
id|i
suffix:semicolon
id|next
op_increment
)paren
(brace
r_int
id|type
op_assign
op_minus
l_int|1
comma
id|value
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tubp-&gt;tty_escx
op_plus
l_int|3
OG
id|MAX_TTY_ESCA
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
id|quant
(braket
id|next
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* Reset */
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|TO_SA
suffix:semicolon
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|TAT_RESET
suffix:semicolon
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|TAR_RESET
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Bright */
r_case
l_int|2
suffix:colon
multiline_comment|/* Dim */
r_case
l_int|4
suffix:colon
multiline_comment|/* Underscore */
r_case
l_int|5
suffix:colon
multiline_comment|/* Blink */
r_case
l_int|7
suffix:colon
multiline_comment|/* Reverse */
r_case
l_int|8
suffix:colon
multiline_comment|/* Hidden */
r_break
suffix:semicolon
multiline_comment|/* For now ... */
multiline_comment|/* Foreground Colors */
r_case
l_int|30
suffix:colon
multiline_comment|/* Black */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_DEFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|31
suffix:colon
multiline_comment|/* Red */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_RED
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
multiline_comment|/* Green */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_GREEN
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|33
suffix:colon
multiline_comment|/* Yellow */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_YELLOW
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|34
suffix:colon
multiline_comment|/* Blue */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_BLUE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|35
suffix:colon
multiline_comment|/* Magenta */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_PINK
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|36
suffix:colon
multiline_comment|/* Cyan */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_TURQ
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|37
suffix:colon
multiline_comment|/* White */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_WHITE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|39
suffix:colon
multiline_comment|/* Black */
id|type
op_assign
id|TAT_COLOR
suffix:semicolon
id|value
op_assign
id|TAC_DEFAULT
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Background Colors */
r_case
l_int|40
suffix:colon
multiline_comment|/* Black */
r_case
l_int|41
suffix:colon
multiline_comment|/* Red */
r_case
l_int|42
suffix:colon
multiline_comment|/* Green */
r_case
l_int|43
suffix:colon
multiline_comment|/* Yellow */
r_case
l_int|44
suffix:colon
multiline_comment|/* Blue */
r_case
l_int|45
suffix:colon
multiline_comment|/* Magenta */
r_case
l_int|46
suffix:colon
multiline_comment|/* Cyan */
r_case
l_int|47
suffix:colon
multiline_comment|/* White */
r_break
suffix:semicolon
multiline_comment|/* For now ... */
multiline_comment|/* Oops */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_ne
op_minus
l_int|1
)paren
(brace
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|TO_SA
suffix:semicolon
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|type
suffix:semicolon
id|tubp-&gt;tty_esca
(braket
id|tubp-&gt;tty_escx
op_increment
)braket
op_assign
id|value
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;H&squot;
suffix:colon
multiline_comment|/* Cursor Home */
r_case
l_char|&squot;f&squot;
suffix:colon
multiline_comment|/* Force Cursor Position */
r_return
suffix:semicolon
r_case
l_char|&squot;A&squot;
suffix:colon
multiline_comment|/* Cursor Up */
r_return
suffix:semicolon
r_case
l_char|&squot;B&squot;
suffix:colon
multiline_comment|/* Cursor Down */
r_return
suffix:semicolon
r_case
l_char|&squot;C&squot;
suffix:colon
multiline_comment|/* Cursor Forward */
id|next
op_assign
id|tubp-&gt;tty_nextlogx
op_mod
id|GEOM_COLS
suffix:semicolon
id|start
op_assign
id|tubp-&gt;tty_nextlogx
op_minus
id|next
suffix:semicolon
id|next
op_assign
id|start
op_plus
id|MIN
c_func
(paren
id|next
op_plus
id|quant
(braket
id|i
)braket
comma
id|GEOM_COLS
op_minus
l_int|1
)paren
suffix:semicolon
id|next
op_assign
id|MIN
c_func
(paren
id|next
comma
id|lastx
)paren
suffix:semicolon
id|do_fill
suffix:colon
id|fill
op_assign
id|next
op_minus
id|tubp-&gt;tty_nextlogx
suffix:semicolon
r_if
c_cond
(paren
id|fill
OL
l_int|5
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|fill
suffix:semicolon
id|i
op_increment
)paren
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
l_char|&squot; &squot;
)braket
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_RA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|next
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ascebc
(braket
l_char|&squot; &squot;
)braket
suffix:semicolon
)brace
id|tubp-&gt;tty_nextlogx
op_assign
id|next
suffix:semicolon
id|tubp-&gt;tty_oucol
op_assign
id|tubp-&gt;tty_nextlogx
op_mod
id|GEOM_COLS
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
multiline_comment|/* Cursor Backward */
id|next
op_assign
id|MIN
c_func
(paren
id|quant
(braket
id|i
)braket
comma
id|tubp-&gt;tty_nextlogx
op_mod
id|GEOM_COLS
)paren
suffix:semicolon
id|tubp-&gt;tty_nextlogx
op_sub_assign
id|next
suffix:semicolon
id|tubp-&gt;tty_oucol
op_assign
id|tubp-&gt;tty_nextlogx
op_mod
id|GEOM_COLS
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|tubp-&gt;tty_nextlogx
comma
id|cpp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;G&squot;
suffix:colon
id|start
op_assign
id|tubp-&gt;tty_nextlogx
op_div
id|GEOM_COLS
op_star
id|GEOM_COLS
suffix:semicolon
id|next
op_assign
id|MIN
c_func
(paren
id|quant
(braket
id|i
)braket
comma
id|GEOM_COLS
op_minus
l_int|1
)paren
op_plus
id|start
suffix:semicolon
id|next
op_assign
id|MIN
c_func
(paren
id|next
comma
id|lastx
)paren
suffix:semicolon
r_goto
id|do_fill
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|tty3270_next_char
id|tty3270_next_char
c_func
(paren
id|tub_t
op_star
id|tubp
)paren
(brace
r_int
id|c
suffix:semicolon
id|bcb_t
op_star
id|ib
suffix:semicolon
id|ib
op_assign
op_amp
id|tubp-&gt;tty_bcb
suffix:semicolon
r_if
c_cond
(paren
id|ib-&gt;bc_cnt
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|c
op_assign
id|ib-&gt;bc_buf
(braket
id|ib-&gt;bc_rd
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ib-&gt;bc_rd
op_eq
id|ib-&gt;bc_len
)paren
id|ib-&gt;bc_rd
op_assign
l_int|0
suffix:semicolon
id|ib-&gt;bc_cnt
op_decrement
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
r_static
r_void
DECL|function|tty3270_clear_input_area
id|tty3270_clear_input_area
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_INPUT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SF
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tubp-&gt;tty_inattr
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_IC
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_RA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_STAT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_static
r_void
DECL|function|tty3270_update_input_area
id|tty3270_update_input_area
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
r_int
id|len
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_INPUT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SF
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TF_INMDT
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|tubp-&gt;tty_input
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_star
id|cpp
comma
id|tubp-&gt;tty_input
comma
id|len
)paren
suffix:semicolon
op_star
id|cpp
op_add_assign
id|len
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_IC
suffix:semicolon
id|len
op_assign
id|GEOM_INPLEN
op_minus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|4
)paren
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_RA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_STAT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
suffix:semicolon
id|len
OG
l_int|0
suffix:semicolon
id|len
op_decrement
)paren
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * tty3270_set_status_area(tub_t *tubp, char **cpp)&n; */
r_static
r_void
DECL|function|tty3270_set_status_area
id|tty3270_set_status_area
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
r_char
op_star
id|sp
suffix:semicolon
r_if
c_cond
(paren
id|tubp-&gt;stat
op_eq
id|TBS_RUNNING
)paren
id|sp
op_assign
id|TS_RUNNING
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tubp-&gt;stat
op_eq
id|TBS_MORE
)paren
id|sp
op_assign
id|TS_MORE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tubp-&gt;stat
op_eq
id|TBS_HOLD
)paren
id|sp
op_assign
id|TS_HOLD
suffix:semicolon
r_else
id|sp
op_assign
l_string|&quot;Linux Whatstat&quot;
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SBA
suffix:semicolon
id|TUB_BUFADR
c_func
(paren
id|GEOM_STAT
comma
id|cpp
)paren
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TO_SF
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|TF_STAT
suffix:semicolon
id|memcpy
c_func
(paren
op_star
id|cpp
comma
id|sp
comma
r_sizeof
id|TS_RUNNING
)paren
suffix:semicolon
id|TUB_ASCEBC
c_func
(paren
op_star
id|cpp
comma
r_sizeof
id|TS_RUNNING
)paren
suffix:semicolon
op_star
id|cpp
op_add_assign
r_sizeof
id|TS_RUNNING
suffix:semicolon
)brace
multiline_comment|/*&n; * tty3270_build() -- build an output stream&n; */
r_int
DECL|function|tty3270_build
id|tty3270_build
c_func
(paren
id|tub_t
op_star
id|tubp
)paren
(brace
r_char
op_star
id|cp
comma
op_star
id|startcp
suffix:semicolon
r_int
id|chancmd
suffix:semicolon
r_int
id|writecc
op_assign
id|TW_KR
suffix:semicolon
r_int
id|force
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tubp-&gt;mode
op_eq
id|TBM_FS
)paren
r_return
l_int|0
suffix:semicolon
id|cp
op_assign
id|startcp
op_assign
op_star
id|tubp-&gt;ttyscreen
op_plus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|tubp-&gt;cmd
)paren
(brace
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;tty3270_build unknown command %d&bslash;n&quot;
comma
id|tubp-&gt;cmd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|TBC_OPEN
suffix:colon
id|chancmd
op_assign
id|TC_EWRITEA
suffix:semicolon
id|tty3270_clear_input_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_set_status_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_clear_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_UPDLOG
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|writecc
op_assign
id|TW_NONE
suffix:semicolon
id|tty3270_update_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_KRUPDLOG
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|force
op_assign
l_int|1
suffix:semicolon
id|tty3270_update_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_CLRUPDLOG
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|tty3270_set_status_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_clear_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_update_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_UPDATE
suffix:colon
id|chancmd
op_assign
id|TC_EWRITEA
suffix:semicolon
id|tubp-&gt;tty_oucol
op_assign
id|tubp-&gt;tty_nextlogx
op_assign
l_int|0
suffix:semicolon
id|tty3270_clear_input_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_set_status_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
id|tty3270_update_log_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_UPDSTAT
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|tty3270_set_status_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_CLRINPUT
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|tty3270_clear_input_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBC_UPDINPUT
suffix:colon
id|chancmd
op_assign
id|TC_WRITE
suffix:semicolon
id|tty3270_update_input_area
c_func
(paren
id|tubp
comma
op_amp
id|cp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Set Write Control Character and start I/O */
r_if
c_cond
(paren
id|force
op_eq
l_int|0
op_logical_and
id|cp
op_eq
id|startcp
op_logical_and
(paren
id|tubp-&gt;flags
op_amp
id|TUB_ALARM
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tubp-&gt;flags
op_amp
id|TUB_ALARM
)paren
(brace
id|tubp-&gt;flags
op_and_assign
op_complement
id|TUB_ALARM
suffix:semicolon
id|writecc
op_or_assign
id|TW_PLUSALARM
suffix:semicolon
)brace
op_star
op_star
id|tubp-&gt;ttyscreen
op_assign
id|writecc
suffix:semicolon
id|tubp-&gt;ttyccw.cmd_code
op_assign
id|chancmd
suffix:semicolon
id|tubp-&gt;ttyccw.flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|tubp-&gt;ttyccw.cda
op_assign
id|virt_to_phys
c_func
(paren
op_star
id|tubp-&gt;ttyscreen
)paren
suffix:semicolon
id|tubp-&gt;ttyccw.count
op_assign
id|cp
op_minus
op_star
id|tubp-&gt;ttyscreen
suffix:semicolon
id|tty3270_io
c_func
(paren
id|tubp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
DECL|function|tty3270_tub_bufadr
id|tty3270_tub_bufadr
c_func
(paren
id|tub_t
op_star
id|tubp
comma
r_int
id|adr
comma
r_char
op_star
op_star
id|cpp
)paren
(brace
r_if
c_cond
(paren
id|tubp-&gt;tty_14bitadr
)paren
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
(paren
id|adr
op_rshift
l_int|8
)paren
op_amp
l_int|0x3f
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|adr
op_amp
l_int|0xff
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ebcgraf
(braket
(paren
id|adr
op_rshift
l_int|6
)paren
op_amp
l_int|0x3f
)braket
suffix:semicolon
op_star
(paren
op_star
id|cpp
)paren
op_increment
op_assign
id|tub_ebcgraf
(braket
id|adr
op_amp
l_int|0x3f
)braket
suffix:semicolon
)brace
)brace
eof
