multiline_comment|/*&n; *  drivers/s390/char/controlchar.c&n; *  Unified handling of special chars.&n; *&n; *    Copyright (C) 2001 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Fritz Elfert &lt;felfert@millenux.com&gt; &lt;elfert@de.ibm.com&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/sysrq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/cpcmd.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
DECL|variable|ctrlchar_sysrq_key
r_static
r_int
id|ctrlchar_sysrq_key
suffix:semicolon
DECL|variable|ctrlchar_tq
r_static
r_struct
id|tq_struct
id|ctrlchar_tq
suffix:semicolon
r_static
r_void
DECL|function|ctrlchar_handle_sysrq
id|ctrlchar_handle_sysrq
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|handle_sysrq
c_func
(paren
id|ctrlchar_sysrq_key
comma
l_int|NULL
comma
l_int|NULL
comma
id|tty
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ctrlchar_init
r_void
id|ctrlchar_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
r_static
r_int
id|init_done
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|init_done
op_increment
)paren
r_return
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|ctrlchar_tq.list
)paren
suffix:semicolon
id|ctrlchar_tq.sync
op_assign
l_int|0
suffix:semicolon
id|ctrlchar_tq.routine
op_assign
id|ctrlchar_handle_sysrq
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/**&n; * Check for special chars at start of input.&n; *&n; * @param buf Console input buffer.&n; * @param len Length of valid data in buffer.&n; * @param tty The tty struct for this console.&n; * @return NULL, if nothing matched, (char *)-1, if buffer contents&n; *         should be ignored, otherwise pointer to char to be inserted.&n; */
DECL|function|ctrlchar_handle
r_char
op_star
id|ctrlchar_handle
c_func
(paren
r_const
r_char
op_star
id|buf
comma
r_int
id|len
comma
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_static
r_char
id|ret
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
OL
l_int|2
)paren
op_logical_or
(paren
id|len
OG
l_int|3
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* hat is 0xb1 in codepage 037 (US etc.) and thus */
multiline_comment|/* converted to 0x5e in ascii (&squot;^&squot;) */
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|0
)braket
op_ne
l_char|&squot;^&squot;
)paren
op_logical_and
(paren
id|buf
(braket
l_int|0
)braket
op_ne
l_char|&squot;&bslash;252&squot;
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|buf
(braket
l_int|1
)braket
)paren
(brace
macro_line|#ifdef CONFIG_MAGIC_SYSRQ
r_case
l_char|&squot;-&squot;
suffix:colon
r_if
c_cond
(paren
id|len
op_eq
l_int|3
)paren
(brace
id|ctrlchar_sysrq_key
op_assign
id|buf
(braket
l_int|2
)braket
suffix:semicolon
id|ctrlchar_tq.data
op_assign
id|tty
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|ctrlchar_tq
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
r_return
(paren
r_char
op_star
)paren
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_case
l_char|&squot;c&squot;
suffix:colon
r_if
c_cond
(paren
id|len
op_eq
l_int|2
)paren
(brace
id|ret
op_assign
id|INTR_CHAR
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
op_amp
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;d&squot;
suffix:colon
r_if
c_cond
(paren
id|len
op_eq
l_int|2
)paren
(brace
id|ret
op_assign
id|EOF_CHAR
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
op_amp
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;z&squot;
suffix:colon
r_if
c_cond
(paren
id|len
op_eq
l_int|2
)paren
(brace
id|ret
op_assign
id|SUSP_CHAR
c_func
(paren
id|tty
)paren
suffix:semicolon
r_return
op_amp
id|ret
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
eof
