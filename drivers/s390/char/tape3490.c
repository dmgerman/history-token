multiline_comment|/***************************************************************************&n; *&n; *  drivers/s390/char/tape3490.c&n; *    tape device discipline for 3490E tapes.&n; *&n; *  S390 and zSeries version&n; *    Copyright (C) 2001 IBM Corporation&n; *    Author(s): Carsten Otte &lt;cotte@de.ibm.com&gt;&n; *               Tuan Ngo-Anh &lt;ngoanh@de.ibm.com&gt;&n; *&n; ****************************************************************************&n; */
macro_line|#include &quot;tapedefs.h&quot;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/compatmac.h&gt;
macro_line|#include &quot;tape.h&quot;
macro_line|#include &quot;tape34xx.h&quot;
macro_line|#include &quot;tape3490.h&quot;
macro_line|#ifdef CONFIG_S390_TAPE_3490_MODULE 
DECL|variable|disc
r_static
id|tape_discipline_t
op_star
id|disc
suffix:semicolon
r_void
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
id|disc
op_assign
id|tape3490_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disc
op_ne
l_int|NULL
)paren
id|tape_register_discipline
c_func
(paren
id|disc
)paren
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|disc
op_ne
l_int|NULL
)paren
(brace
id|tape_unregister_discipline
c_func
(paren
id|disc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|disc
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_S390_TAPE_3490_MODULE */
r_int
DECL|function|tape3490_setup_device
id|tape3490_setup_device
(paren
id|tape_dev_t
op_star
id|td
)paren
(brace
id|tape3490_disc_data_t
op_star
id|data
op_assign
l_int|NULL
suffix:semicolon
id|tape_sprintf_event
(paren
id|tape_dbf_area
comma
l_int|1
comma
l_string|&quot;3490 dsetup: %x&bslash;n&quot;
comma
id|td-&gt;first_minor
)paren
suffix:semicolon
id|data
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|tape3490_disc_data_t
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data-&gt;modeset_byte
op_assign
l_int|0x00
suffix:semicolon
id|td-&gt;discdata
op_assign
(paren
r_void
op_star
)paren
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|tape3490_cleanup_device
id|tape3490_cleanup_device
c_func
(paren
id|tape_dev_t
op_star
id|td
)paren
(brace
r_if
c_cond
(paren
id|td-&gt;discdata
)paren
(brace
id|kfree
c_func
(paren
id|td-&gt;discdata
)paren
suffix:semicolon
id|td-&gt;discdata
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_void
DECL|function|tape3490_shutdown
id|tape3490_shutdown
(paren
r_void
)paren
(brace
)brace
id|tape_discipline_t
op_star
DECL|function|tape3490_init
id|tape3490_init
(paren
r_void
)paren
(brace
id|tape_discipline_t
op_star
id|disc
suffix:semicolon
id|tape_sprintf_event
(paren
id|tape_dbf_area
comma
l_int|3
comma
l_string|&quot;3490 init&bslash;n&quot;
)paren
suffix:semicolon
id|disc
op_assign
id|kmalloc
(paren
r_sizeof
(paren
id|tape_discipline_t
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|disc
op_eq
l_int|NULL
)paren
(brace
id|tape_sprintf_exception
(paren
id|tape_dbf_area
comma
l_int|3
comma
l_string|&quot;disc:nomem&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|disc
suffix:semicolon
)brace
id|disc-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|disc-&gt;cu_type
op_assign
l_int|0x3490
suffix:semicolon
id|disc-&gt;setup_device
op_assign
id|tape3490_setup_device
suffix:semicolon
id|disc-&gt;cleanup_device
op_assign
id|tape3490_cleanup_device
suffix:semicolon
id|disc-&gt;init_device
op_assign
l_int|NULL
suffix:semicolon
id|disc-&gt;process_eov
op_assign
id|tape34xx_process_eov
suffix:semicolon
id|disc-&gt;irq
op_assign
id|tape34xx_irq
suffix:semicolon
id|disc-&gt;write_block
op_assign
id|tape34xx_write_block
suffix:semicolon
id|disc-&gt;read_block
op_assign
id|tape34xx_read_block
suffix:semicolon
id|disc-&gt;ioctl
op_assign
id|tape34xx_ioctl
suffix:semicolon
id|disc-&gt;shutdown
op_assign
id|tape3490_shutdown
suffix:semicolon
id|disc-&gt;discipline_ioctl_overload
op_assign
id|tape34xx_ioctl_overload
suffix:semicolon
id|disc-&gt;bread
op_assign
id|tape34xx_bread
suffix:semicolon
id|disc-&gt;free_bread
op_assign
id|tape34xx_free_bread
suffix:semicolon
id|disc-&gt;bread_enable_locate
op_assign
id|tape34xx_bread_enable_locate
suffix:semicolon
id|disc-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|tape_sprintf_event
(paren
id|tape_dbf_area
comma
l_int|3
comma
l_string|&quot;3490 regis&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|disc
suffix:semicolon
)brace
eof
