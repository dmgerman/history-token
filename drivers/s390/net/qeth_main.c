multiline_comment|/*&n; *&n; * linux/drivers/s390/net/qeth_main.c ($Revision: 1.170 $)&n; *&n; * Linux on zSeries OSA Express and HiperSockets support&n; *&n; * Copyright 2000,2003 IBM Corporation&n; *&n; *    Author(s): Original Code written by&n; *&t;&t;&t;  Utz Bacher (utz.bacher@de.ibm.com)&n; *&t;&t; Rewritten by&n; *&t;&t;&t;  Frank Pavlic (pavlic@de.ibm.com) and&n; *&t;&t; &t;  Thomas Spatzier &lt;tspat@de.ibm.com&gt;&n; *&n; *    $Revision: 1.170 $&t; $Date: 2004/11/17 09:54:06 $&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&t; See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
multiline_comment|/***&n; * eye catcher; just for debugging purposes&n; */
r_void
r_volatile
DECL|function|qeth_eyecatcher
id|qeth_eyecatcher
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/ebcdic.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/timex.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/workqueue.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/icmp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/route.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/igmp.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;asm/qeth.h&gt;
macro_line|#include &lt;linux/mii.h&gt;
macro_line|#include &lt;linux/rcupdate.h&gt;
macro_line|#include &quot;qeth.h&quot;
macro_line|#include &quot;qeth_mpc.h&quot;
macro_line|#include &quot;qeth_fs.h&quot;
DECL|macro|VERSION_QETH_C
mdefine_line|#define VERSION_QETH_C &quot;$Revision: 1.170 $&quot;
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;qeth S/390 OSA-Express driver&quot;
suffix:semicolon
multiline_comment|/**&n; * Debug Facility Stuff&n; */
DECL|variable|qeth_dbf_setup
r_static
id|debug_info_t
op_star
id|qeth_dbf_setup
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_data
r_static
id|debug_info_t
op_star
id|qeth_dbf_data
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_misc
r_static
id|debug_info_t
op_star
id|qeth_dbf_misc
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_control
r_static
id|debug_info_t
op_star
id|qeth_dbf_control
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_trace
r_static
id|debug_info_t
op_star
id|qeth_dbf_trace
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_sense
r_static
id|debug_info_t
op_star
id|qeth_dbf_sense
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_dbf_qerr
r_static
id|debug_info_t
op_star
id|qeth_dbf_qerr
op_assign
l_int|NULL
suffix:semicolon
id|DEFINE_PER_CPU
c_func
(paren
r_char
(braket
l_int|256
)braket
comma
id|qeth_dbf_txt_buf
)paren
suffix:semicolon
multiline_comment|/**&n; * some more definitions and declarations&n; */
DECL|variable|known_devices
r_static
r_int
r_int
id|known_devices
(braket
)braket
(braket
l_int|10
)braket
op_assign
id|QETH_MODELLIST_ARRAY
suffix:semicolon
multiline_comment|/* list of our cards */
DECL|variable|qeth_card_list
r_struct
id|qeth_card_list_struct
id|qeth_card_list
suffix:semicolon
multiline_comment|/*process list want to be notified*/
DECL|variable|qeth_notify_lock
id|spinlock_t
id|qeth_notify_lock
suffix:semicolon
DECL|variable|qeth_notify_list
r_struct
id|list_head
id|qeth_notify_list
suffix:semicolon
r_static
r_void
id|qeth_send_control_data_cb
c_func
(paren
r_struct
id|qeth_channel
op_star
comma
r_struct
id|qeth_cmd_buffer
op_star
)paren
suffix:semicolon
multiline_comment|/**&n; * here we go with function implementation&n; */
r_static
r_void
id|qeth_init_qdio_info
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
suffix:semicolon
r_static
r_int
id|qeth_init_qdio_queues
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
suffix:semicolon
r_static
r_int
id|qeth_alloc_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
suffix:semicolon
r_static
r_void
id|qeth_free_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_ip_list
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_ipacmd_list
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_int
id|qeth_qdio_clear_card
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_working_pool_list
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_cmd_buffers
c_func
(paren
r_struct
id|qeth_channel
op_star
)paren
suffix:semicolon
r_static
r_int
id|qeth_stop
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_clear_ipato_list
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_int
id|qeth_is_addr_covered_by_ipato
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_ipaddr
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_irq_tasklet
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
id|qeth_set_online
c_func
(paren
r_struct
id|ccwgroup_device
op_star
)paren
suffix:semicolon
r_static
r_struct
id|qeth_ipaddr
op_star
id|qeth_get_addr_buffer
c_func
(paren
r_enum
id|qeth_prot_versions
)paren
suffix:semicolon
r_static
r_void
id|qeth_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
)paren
suffix:semicolon
r_static
r_void
DECL|function|qeth_notify_processes
id|qeth_notify_processes
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*notify all  registered processes */
r_struct
id|qeth_notify_list_struct
op_star
id|n_entry
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;procnoti&quot;
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n_entry
comma
op_amp
id|qeth_notify_list
comma
id|list
)paren
(brace
id|send_sig
c_func
(paren
id|n_entry-&gt;signum
comma
id|n_entry-&gt;task
comma
l_int|1
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
)brace
r_int
DECL|function|qeth_notifier_unregister
id|qeth_notifier_unregister
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
r_struct
id|qeth_notify_list_struct
op_star
id|n_entry
comma
op_star
id|tmp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;notunreg&quot;
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|n_entry
comma
id|tmp
comma
op_amp
id|qeth_notify_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|n_entry-&gt;task
op_eq
id|p
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|n_entry-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|n_entry
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|qeth_notifier_register
id|qeth_notifier_register
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_int
id|signum
)paren
(brace
r_struct
id|qeth_notify_list_struct
op_star
id|n_entry
suffix:semicolon
multiline_comment|/*check first if entry already exists*/
id|spin_lock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|n_entry
comma
op_amp
id|qeth_notify_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|n_entry-&gt;task
op_eq
id|p
)paren
(brace
id|n_entry-&gt;signum
op_assign
id|signum
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|n_entry
op_assign
(paren
r_struct
id|qeth_notify_list_struct
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_notify_list_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n_entry
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|n_entry-&gt;task
op_assign
id|p
suffix:semicolon
id|n_entry-&gt;signum
op_assign
id|signum
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|n_entry-&gt;list
comma
op_amp
id|qeth_notify_list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * free channel command buffers&n; */
r_static
r_void
DECL|function|qeth_clean_channel
id|qeth_clean_channel
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_int
id|cnt
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;freech&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|QETH_CMD_BUFFER_NO
suffix:semicolon
id|cnt
op_increment
)paren
id|kfree
c_func
(paren
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * free card&n; */
r_static
r_void
DECL|function|qeth_free_card
id|qeth_free_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;freecrd&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|qeth_clean_channel
c_func
(paren
op_amp
id|card-&gt;read
)paren
suffix:semicolon
id|qeth_clean_channel
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;dev
)paren
id|free_netdev
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|qeth_clear_ip_list
c_func
(paren
id|card
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|qeth_clear_ipato_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
id|qeth_free_qdio_buffers
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * alloc memory for command buffer per channel&n; */
r_static
r_int
DECL|function|qeth_setup_channel
id|qeth_setup_channel
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_int
id|cnt
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;setupch&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|QETH_CMD_BUFFER_NO
suffix:semicolon
id|cnt
op_increment
)paren
(brace
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|data
op_assign
(paren
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|QETH_BUFSIZE
comma
id|GFP_DMA
op_or
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|data
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|state
op_assign
id|BUF_STATE_FREE
suffix:semicolon
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|channel
op_assign
id|channel
suffix:semicolon
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|callback
op_assign
id|qeth_send_control_data_cb
suffix:semicolon
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
OL
id|QETH_CMD_BUFFER_NO
)paren
(brace
r_while
c_loop
(paren
id|cnt
op_decrement
OG
l_int|0
)paren
id|kfree
c_func
(paren
id|channel-&gt;iob
(braket
id|cnt
)braket
dot
id|data
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|channel-&gt;buf_no
op_assign
l_int|0
suffix:semicolon
id|channel-&gt;io_buf_no
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|channel-&gt;irq_pending
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|channel-&gt;iob_lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|channel-&gt;wait_q
)paren
suffix:semicolon
id|channel-&gt;irq_tasklet.data
op_assign
(paren
r_int
r_int
)paren
id|channel
suffix:semicolon
id|channel-&gt;irq_tasklet.func
op_assign
id|qeth_irq_tasklet
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * alloc memory for card structure&n; */
r_static
r_struct
id|qeth_card
op_star
DECL|function|qeth_alloc_card
id|qeth_alloc_card
c_func
(paren
r_void
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;alloccrd&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_card
)paren
comma
id|GFP_DMA
op_or
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
l_int|NULL
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_card
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_setup_channel
c_func
(paren
op_amp
id|card-&gt;read
)paren
)paren
(brace
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qeth_setup_channel
c_func
(paren
op_amp
id|card-&gt;write
)paren
)paren
(brace
id|qeth_clean_channel
c_func
(paren
op_amp
id|card-&gt;read
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|card
suffix:semicolon
)brace
r_static
r_int
DECL|function|__qeth_check_irb_error
id|__qeth_check_irb_error
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_struct
id|irb
op_star
id|irb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|irb
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|PTR_ERR
c_func
(paren
id|irb
)paren
)paren
(brace
r_case
op_minus
id|EIO
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;i/o-error on device %s&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ckirberr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
op_minus
id|EIO
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|ETIMEDOUT
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;timeout on device %s&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ckirberr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
op_minus
id|ETIMEDOUT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;unknown error %ld on device %s&bslash;n&quot;
comma
id|PTR_ERR
c_func
(paren
id|irb
)paren
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ckirberr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;  rc???&quot;
)paren
suffix:semicolon
)brace
r_return
id|PTR_ERR
c_func
(paren
id|irb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_get_problem
id|qeth_get_problem
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_struct
id|irb
op_star
id|irb
)paren
(brace
r_int
id|dstat
comma
id|cstat
suffix:semicolon
r_char
op_star
id|sense
suffix:semicolon
id|sense
op_assign
(paren
r_char
op_star
)paren
id|irb-&gt;ecw
suffix:semicolon
id|cstat
op_assign
id|irb-&gt;scsw.cstat
suffix:semicolon
id|dstat
op_assign
id|irb-&gt;scsw.dstat
suffix:semicolon
r_if
c_cond
(paren
id|cstat
op_amp
(paren
id|SCHN_STAT_CHN_CTRL_CHK
op_or
id|SCHN_STAT_INTF_CTRL_CHK
op_or
id|SCHN_STAT_CHN_DATA_CHK
op_or
id|SCHN_STAT_CHAIN_CHECK
op_or
id|SCHN_STAT_PROT_CHECK
op_or
id|SCHN_STAT_PROG_CHECK
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;CGENCHK&quot;
)paren
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;check on device %s, dstat=x%x, cstat=x%x &quot;
comma
id|cdev-&gt;dev.bus_id
comma
id|dstat
comma
id|cstat
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;irb: &quot;
comma
id|irb
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;irb: &quot;
comma
(paren
(paren
r_char
op_star
)paren
id|irb
)paren
op_plus
l_int|32
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
(brace
r_if
c_cond
(paren
id|sense
(braket
id|SENSE_RESETTING_EVENT_BYTE
)braket
op_amp
id|SENSE_RESETTING_EVENT_FLAG
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;REVIND&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sense
(braket
id|SENSE_COMMAND_REJECT_BYTE
)braket
op_amp
id|SENSE_COMMAND_REJECT_FLAG
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;CMDREJi&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sense
(braket
l_int|2
)braket
op_eq
l_int|0xaf
)paren
op_logical_and
(paren
id|sense
(braket
l_int|3
)braket
op_eq
l_int|0xfe
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;AFFE&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|sense
(braket
l_int|0
)braket
)paren
op_logical_and
(paren
op_logical_neg
id|sense
(braket
l_int|1
)braket
)paren
op_logical_and
(paren
op_logical_neg
id|sense
(braket
l_int|2
)braket
)paren
op_logical_and
(paren
op_logical_neg
id|sense
(braket
l_int|3
)braket
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ZEROSEN&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;DGENCHK&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|qeth_issue_next_read
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
multiline_comment|/**&n; * interrupt handler&n; */
r_static
r_void
DECL|function|qeth_irq
id|qeth_irq
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
r_int
id|intparm
comma
r_struct
id|irb
op_star
id|irb
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|cstat
comma
id|dstat
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|buffer
suffix:semicolon
r_struct
id|qeth_channel
op_star
id|channel
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;irq&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__qeth_check_irb_error
c_func
(paren
id|cdev
comma
id|irb
)paren
)paren
r_return
suffix:semicolon
id|cstat
op_assign
id|irb-&gt;scsw.cstat
suffix:semicolon
id|dstat
op_assign
id|irb-&gt;scsw.dstat
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;read.ccwdev
op_eq
id|cdev
)paren
(brace
id|channel
op_assign
op_amp
id|card-&gt;read
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;read&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|card-&gt;write.ccwdev
op_eq
id|cdev
)paren
(brace
id|channel
op_assign
op_amp
id|card-&gt;write
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;write&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|channel
op_assign
op_amp
id|card-&gt;data
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;data&quot;
)paren
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|channel-&gt;irq_pending
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irb-&gt;scsw.fctl
op_amp
(paren
id|SCSW_FCTL_CLEAR_FUNC
)paren
)paren
id|channel-&gt;state
op_assign
id|CH_STATE_STOPPED
suffix:semicolon
r_if
c_cond
(paren
id|irb-&gt;scsw.fctl
op_amp
(paren
id|SCSW_FCTL_HALT_FUNC
)paren
)paren
id|channel-&gt;state
op_assign
id|CH_STATE_HALTED
suffix:semicolon
multiline_comment|/*let&squot;s wake up immediately on data channel*/
r_if
c_cond
(paren
(paren
id|channel
op_eq
op_amp
id|card-&gt;data
)paren
op_logical_and
(paren
id|intparm
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|intparm
op_eq
id|QETH_CLEAR_CHANNEL_PARM
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;clrchpar&quot;
)paren
suffix:semicolon
multiline_comment|/* we don&squot;t have to handle this further */
id|intparm
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|intparm
op_eq
id|QETH_HALT_CHANNEL_PARM
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;hltchpar&quot;
)paren
suffix:semicolon
multiline_comment|/* we don&squot;t have to handle this further */
id|intparm
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dstat
op_amp
id|DEV_STAT_UNIT_EXCEP
)paren
op_logical_or
(paren
id|dstat
op_amp
id|DEV_STAT_UNIT_CHECK
)paren
op_logical_or
(paren
id|cstat
)paren
)paren
(brace
r_if
c_cond
(paren
id|irb-&gt;esw.esw0.erw.cons
)paren
(brace
multiline_comment|/* TODO: we should make this s390dbf */
id|PRINT_WARN
c_func
(paren
l_string|&quot;sense data available on channel %s.&bslash;n&quot;
comma
id|CHANNEL_ID
c_func
(paren
id|channel
)paren
)paren
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot; cstat 0x%X&bslash;n dstat 0x%X&bslash;n&quot;
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;irb: &quot;
comma
id|irb
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;sense data: &quot;
comma
id|irb-&gt;ecw
)paren
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_get_problem
c_func
(paren
id|cdev
comma
id|irb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|intparm
)paren
(brace
id|buffer
op_assign
(paren
r_struct
id|qeth_cmd_buffer
op_star
)paren
id|__va
c_func
(paren
(paren
id|addr_t
)paren
id|intparm
)paren
suffix:semicolon
id|buffer-&gt;state
op_assign
id|BUF_STATE_PROCESSED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|channel
op_eq
op_amp
id|card-&gt;data
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_eq
op_amp
id|card-&gt;read
op_logical_and
id|channel-&gt;state
op_eq
id|CH_STATE_UP
)paren
id|qeth_issue_next_read
c_func
(paren
id|card
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|channel-&gt;irq_tasklet
)paren
suffix:semicolon
r_return
suffix:semicolon
id|out
suffix:colon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * tasklet function scheduled from irq handler&n; */
r_static
r_void
DECL|function|qeth_irq_tasklet
id|qeth_irq_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|qeth_channel
op_star
id|channel
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|__u8
id|index
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;irqtlet&quot;
)paren
suffix:semicolon
id|channel
op_assign
(paren
r_struct
id|qeth_channel
op_star
)paren
id|data
suffix:semicolon
id|iob
op_assign
id|channel-&gt;iob
suffix:semicolon
id|index
op_assign
id|channel-&gt;buf_no
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|iob
(braket
id|index
)braket
dot
id|state
op_eq
id|BUF_STATE_PROCESSED
)paren
(brace
r_if
c_cond
(paren
id|iob
(braket
id|index
)braket
dot
id|callback
op_ne
l_int|NULL
)paren
(brace
id|iob
(braket
id|index
)braket
dot
id|callback
c_func
(paren
id|channel
comma
id|iob
op_plus
id|index
)paren
suffix:semicolon
)brace
id|index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_mod
id|QETH_CMD_BUFFER_NO
suffix:semicolon
)brace
id|channel-&gt;buf_no
op_assign
id|index
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_int
id|qeth_stop_card
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_int
DECL|function|qeth_set_offline
id|qeth_set_offline
c_func
(paren
r_struct
id|ccwgroup_device
op_star
id|cgdev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|cgdev-&gt;dev.driver_data
suffix:semicolon
r_enum
id|qeth_card_states
id|recover_flag
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|3
comma
l_string|&quot;setoffl&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|3
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|recover_flag
op_assign
id|card-&gt;state
suffix:semicolon
r_if
c_cond
(paren
id|qeth_stop_card
c_func
(paren
id|card
)paren
op_eq
op_minus
id|ERESTARTSYS
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Stopping card %s interrupted by user!&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|ccw_device_set_offline
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_WDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|recover_flag
op_eq
id|CARD_STATE_UP
)paren
id|card-&gt;state
op_assign
id|CARD_STATE_RECOVER
suffix:semicolon
id|qeth_notify_processes
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_remove_device
id|qeth_remove_device
c_func
(paren
r_struct
id|ccwgroup_device
op_star
id|cgdev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|cgdev-&gt;dev.driver_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|3
comma
l_string|&quot;rmdev&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|3
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|cgdev-&gt;state
op_eq
id|CCWGROUP_ONLINE
)paren
(brace
id|card-&gt;use_hard_stop
op_assign
l_int|1
suffix:semicolon
id|qeth_set_offline
c_func
(paren
id|cgdev
)paren
suffix:semicolon
)brace
multiline_comment|/* remove form our internal list */
id|write_lock_irqsave
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|card-&gt;list
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;dev
)paren
id|unregister_netdev
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|qeth_remove_device_attributes
c_func
(paren
op_amp
id|cgdev-&gt;dev
)paren
suffix:semicolon
id|qeth_free_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|cgdev-&gt;dev.driver_data
op_assign
l_int|NULL
suffix:semicolon
id|put_device
c_func
(paren
op_amp
id|cgdev-&gt;dev
)paren
suffix:semicolon
)brace
r_static
r_int
id|qeth_register_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_ipaddr
op_star
)paren
suffix:semicolon
r_static
r_int
id|qeth_deregister_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_ipaddr
op_star
)paren
suffix:semicolon
multiline_comment|/**&n; * Add/remove address to/from card&squot;s ip list, i.e. try to add or remove&n; * reference to/from an IP address that is already registered on the card.&n; * Returns:&n; * &t;0  address was on card and its reference count has been adjusted,&n; * &t;   but is still &gt; 0, so nothing has to be done&n; * &t;   also returns 0 if card was not on card and the todo was to delete&n; * &t;   the address -&gt; there is also nothing to be done&n; * &t;1  address was not on card and the todo is to add it to the card&squot;s ip&n; * &t;   list&n; * &t;-1 address was on card and its reference count has been decremented&n; * &t;   to &lt;= 0 by the todo -&gt; address must be removed from card&n; */
r_static
r_int
DECL|function|__qeth_ref_ip_on_card
id|__qeth_ref_ip_on_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|todo
comma
r_struct
id|qeth_ipaddr
op_star
op_star
id|__addr
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|addr
comma
op_amp
id|card-&gt;ip_list
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
id|todo-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
id|addr-&gt;type
op_eq
id|todo-&gt;type
)paren
op_logical_and
(paren
id|addr-&gt;u.a4.addr
op_eq
id|todo-&gt;u.a4.addr
)paren
op_logical_and
(paren
id|addr-&gt;u.a4.mask
op_eq
id|todo-&gt;u.a4.mask
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
id|todo-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
id|addr-&gt;type
op_eq
id|todo-&gt;type
)paren
op_logical_and
(paren
id|addr-&gt;u.a6.pfxlen
op_eq
id|todo-&gt;u.a6.pfxlen
)paren
op_logical_and
(paren
id|memcmp
c_func
(paren
op_amp
id|addr-&gt;u.a6.addr
comma
op_amp
id|todo-&gt;u.a6.addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
(brace
id|addr-&gt;users
op_add_assign
id|todo-&gt;users
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;users
op_le
l_int|0
)paren
(brace
op_star
id|__addr
op_assign
id|addr
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* for VIPA and RXIP limit refcount to 1 */
r_if
c_cond
(paren
id|addr-&gt;type
op_ne
id|QETH_IP_TYPE_NORMAL
)paren
id|addr-&gt;users
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|todo-&gt;users
OG
l_int|0
)paren
(brace
multiline_comment|/* for VIPA and RXIP limit refcount to 1 */
r_if
c_cond
(paren
id|todo-&gt;type
op_ne
id|QETH_IP_TYPE_NORMAL
)paren
id|addr-&gt;users
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|__qeth_address_exists_in_list
id|__qeth_address_exists_in_list
c_func
(paren
r_struct
id|list_head
op_star
id|list
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
r_int
id|same_type
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|tmp
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|tmp
comma
id|list
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
(paren
id|tmp-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
(paren
id|same_type
op_logical_and
(paren
id|tmp-&gt;type
op_eq
id|addr-&gt;type
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|same_type
op_logical_and
(paren
id|tmp-&gt;type
op_ne
id|addr-&gt;type
)paren
)paren
)paren
op_logical_and
(paren
id|tmp-&gt;u.a4.addr
op_eq
id|addr-&gt;u.a4.addr
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
(paren
id|same_type
op_logical_and
(paren
id|tmp-&gt;type
op_eq
id|addr-&gt;type
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|same_type
op_logical_and
(paren
id|tmp-&gt;type
op_ne
id|addr-&gt;type
)paren
)paren
)paren
op_logical_and
(paren
id|memcmp
c_func
(paren
op_amp
id|tmp-&gt;u.a6.addr
comma
op_amp
id|addr-&gt;u.a6.addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Add IP to be added to todo list. If there is already an &quot;add todo&quot;&n; * in this list we just incremenent the reference count.&n; * Returns 0 if we  just incremented reference count.&n; */
r_static
r_int
DECL|function|__qeth_insert_ip_todo
id|__qeth_insert_ip_todo
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
r_int
id|add
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|tmp
comma
op_star
id|t
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|tmp
comma
id|t
comma
id|card-&gt;ip_tbd_list
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
(paren
id|addr-&gt;type
op_eq
id|QETH_IP_TYPE_DEL_ALL_MC
)paren
op_logical_and
(paren
id|tmp-&gt;type
op_eq
id|QETH_IP_TYPE_DEL_ALL_MC
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
(paren
id|tmp-&gt;type
op_eq
id|addr-&gt;type
)paren
op_logical_and
(paren
id|tmp-&gt;is_multicast
op_eq
id|addr-&gt;is_multicast
)paren
op_logical_and
(paren
id|tmp-&gt;u.a4.addr
op_eq
id|addr-&gt;u.a4.addr
)paren
op_logical_and
(paren
id|tmp-&gt;u.a4.mask
op_eq
id|addr-&gt;u.a4.mask
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
(paren
id|tmp-&gt;type
op_eq
id|addr-&gt;type
)paren
op_logical_and
(paren
id|tmp-&gt;is_multicast
op_eq
id|addr-&gt;is_multicast
)paren
op_logical_and
(paren
id|tmp-&gt;u.a6.pfxlen
op_eq
id|addr-&gt;u.a6.pfxlen
)paren
op_logical_and
(paren
id|memcmp
c_func
(paren
op_amp
id|tmp-&gt;u.a6.addr
comma
op_amp
id|addr-&gt;u.a6.addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|found
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;users
op_ne
l_int|0
)paren
id|tmp-&gt;users
op_add_assign
id|addr-&gt;users
suffix:semicolon
r_else
id|tmp-&gt;users
op_add_assign
id|add
ques
c_cond
l_int|1
suffix:colon
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tmp-&gt;users
op_eq
l_int|0
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|tmp-&gt;entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|addr-&gt;type
op_eq
id|QETH_IP_TYPE_DEL_ALL_MC
)paren
id|list_add
c_func
(paren
op_amp
id|addr-&gt;entry
comma
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|addr-&gt;users
op_eq
l_int|0
)paren
id|addr-&gt;users
op_add_assign
id|add
ques
c_cond
l_int|1
suffix:colon
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|add
op_logical_and
(paren
id|addr-&gt;type
op_eq
id|QETH_IP_TYPE_NORMAL
)paren
op_logical_and
id|qeth_is_addr_covered_by_ipato
c_func
(paren
id|card
comma
id|addr
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;tkovaddr&quot;
)paren
suffix:semicolon
id|addr-&gt;set_flags
op_or_assign
id|QETH_IPA_SETIP_TAKEOVER_FLAG
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|addr-&gt;entry
comma
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * Remove IP address from list&n; */
r_static
r_int
DECL|function|qeth_delete_ip
id|qeth_delete_ip
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;delip&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
op_amp
id|addr-&gt;u.a4.addr
comma
l_int|4
)paren
suffix:semicolon
r_else
(brace
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
op_amp
id|addr-&gt;u.a6.addr
comma
l_int|8
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|addr-&gt;u.a6.addr
)paren
op_plus
l_int|8
comma
l_int|8
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|__qeth_insert_ip_todo
c_func
(paren
id|card
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_add_ip
id|qeth_add_ip
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;addip&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
op_amp
id|addr-&gt;u.a4.addr
comma
l_int|4
)paren
suffix:semicolon
r_else
(brace
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
op_amp
id|addr-&gt;u.a6.addr
comma
l_int|8
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|4
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|addr-&gt;u.a6.addr
)paren
op_plus
l_int|8
comma
l_int|8
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|__qeth_insert_ip_todo
c_func
(paren
id|card
comma
id|addr
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__qeth_delete_all_mc
id|__qeth_delete_all_mc
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
op_star
id|flags
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
op_star
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|addr
comma
id|tmp
comma
op_amp
id|card-&gt;ip_list
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;is_multicast
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
op_star
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_deregister_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
op_star
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|addr-&gt;entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_void
DECL|function|qeth_set_ip_addr_list
id|qeth_set_ip_addr_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|list_head
op_star
id|tbd_list
suffix:semicolon
r_struct
id|qeth_ipaddr
op_star
id|todo
comma
op_star
id|addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;sdiplist&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|tbd_list
op_assign
id|card-&gt;ip_tbd_list
suffix:semicolon
id|card-&gt;ip_tbd_list
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|list_head
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;ip_tbd_list
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|0
comma
l_string|&quot;silnomem&quot;
)paren
suffix:semicolon
id|card-&gt;ip_tbd_list
op_assign
id|tbd_list
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
id|INIT_LIST_HEAD
c_func
(paren
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
id|tbd_list
)paren
)paren
(brace
id|todo
op_assign
id|list_entry
c_func
(paren
id|tbd_list-&gt;next
comma
r_struct
id|qeth_ipaddr
comma
id|entry
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|todo-&gt;entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|todo-&gt;type
op_eq
id|QETH_IP_TYPE_DEL_ALL_MC
)paren
(brace
id|__qeth_delete_all_mc
c_func
(paren
id|card
comma
op_amp
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|todo
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|rc
op_assign
id|__qeth_ref_ip_on_card
c_func
(paren
id|card
comma
id|todo
comma
op_amp
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
multiline_comment|/* nothing to be done; only adjusted refcount */
id|kfree
c_func
(paren
id|todo
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
op_eq
l_int|1
)paren
(brace
multiline_comment|/* new entry to be added to on-card list */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_register_addr_entry
c_func
(paren
id|card
comma
id|todo
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|list_add_tail
c_func
(paren
op_amp
id|todo-&gt;entry
comma
op_amp
id|card-&gt;ip_list
)paren
suffix:semicolon
r_else
id|kfree
c_func
(paren
id|todo
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* on-card entry to be removed */
id|list_del_init
c_func
(paren
op_amp
id|addr-&gt;entry
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_deregister_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_else
id|list_add_tail
c_func
(paren
op_amp
id|addr-&gt;entry
comma
op_amp
id|card-&gt;ip_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|todo
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tbd_list
)paren
suffix:semicolon
)brace
r_static
r_void
id|qeth_delete_mc_addresses
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
r_static
r_void
id|qeth_add_multicast_ipv4
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_void
id|qeth_add_multicast_ipv6
c_func
(paren
r_struct
id|qeth_card
op_star
)paren
suffix:semicolon
macro_line|#endif
r_static
r_inline
r_int
DECL|function|qeth_set_thread_start_bit
id|qeth_set_thread_start_bit
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;thread_allowed_mask
op_amp
id|thread
)paren
op_logical_or
(paren
id|card-&gt;thread_start_mask
op_amp
id|thread
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|card-&gt;thread_start_mask
op_or_assign
id|thread
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_clear_thread_start_bit
id|qeth_clear_thread_start_bit
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;thread_start_mask
op_and_assign
op_complement
id|thread
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_clear_thread_running_bit
id|qeth_clear_thread_running_bit
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;thread_running_mask
op_and_assign
op_complement
id|thread
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|__qeth_do_run_thread
id|__qeth_do_run_thread
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;thread_start_mask
op_amp
id|thread
)paren
(brace
r_if
c_cond
(paren
(paren
id|card-&gt;thread_allowed_mask
op_amp
id|thread
)paren
op_logical_and
op_logical_neg
(paren
id|card-&gt;thread_running_mask
op_amp
id|thread
)paren
)paren
(brace
id|rc
op_assign
l_int|1
suffix:semicolon
id|card-&gt;thread_start_mask
op_and_assign
op_complement
id|thread
suffix:semicolon
id|card-&gt;thread_running_mask
op_or_assign
id|thread
suffix:semicolon
)brace
r_else
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_do_run_thread
id|qeth_do_run_thread
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|wait_event
c_func
(paren
id|card-&gt;wait_q
comma
(paren
id|rc
op_assign
id|__qeth_do_run_thread
c_func
(paren
id|card
comma
id|thread
)paren
)paren
op_ge
l_int|0
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_register_ip_addresses
id|qeth_register_ip_addresses
c_func
(paren
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|ptr
suffix:semicolon
id|daemonize
c_func
(paren
l_string|&quot;qeth_reg_ip&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;regipth1&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_do_run_thread
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;regipth2&quot;
)paren
suffix:semicolon
id|qeth_set_ip_addr_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_clear_thread_running_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_recover
id|qeth_recover
c_func
(paren
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|ptr
suffix:semicolon
id|daemonize
c_func
(paren
l_string|&quot;qeth_recover&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;recover1&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_do_run_thread
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;recover2&quot;
)paren
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Recovery of device %s started ...&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|card-&gt;use_hard_stop
op_assign
l_int|1
suffix:semicolon
id|qeth_set_offline
c_func
(paren
id|card-&gt;gdev
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_set_online
c_func
(paren
id|card-&gt;gdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|PRINT_INFO
c_func
(paren
l_string|&quot;Device %s successfully recovered!&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_else
id|PRINT_INFO
c_func
(paren
l_string|&quot;Device %s could not be recovered!&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
multiline_comment|/* don&squot;t run another scheduled recovery */
id|qeth_clear_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
)paren
suffix:semicolon
id|qeth_clear_thread_running_bit
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|qeth_schedule_recovery
id|qeth_schedule_recovery
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;startrec&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_do_start_thread
id|qeth_do_start_thread
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|thread
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;  %02x%02x%02x&quot;
comma
(paren
id|u8
)paren
id|card-&gt;thread_start_mask
comma
(paren
id|u8
)paren
id|card-&gt;thread_allowed_mask
comma
(paren
id|u8
)paren
id|card-&gt;thread_running_mask
)paren
suffix:semicolon
id|rc
op_assign
(paren
id|card-&gt;thread_start_mask
op_amp
id|thread
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_start_kernel_thread
id|qeth_start_kernel_thread
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;strthrd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;read.state
op_ne
id|CH_STATE_UP
op_logical_and
id|card-&gt;write.state
op_ne
id|CH_STATE_UP
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|qeth_do_start_thread
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
)paren
id|kernel_thread
c_func
(paren
id|qeth_register_ip_addresses
comma
(paren
r_void
op_star
)paren
id|card
comma
id|SIGCHLD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_do_start_thread
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
)paren
)paren
id|kernel_thread
c_func
(paren
id|qeth_recover
comma
(paren
r_void
op_star
)paren
id|card
comma
id|SIGCHLD
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_set_intial_options
id|qeth_set_intial_options
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|card-&gt;options.route4.type
op_assign
id|NO_ROUTER
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|card-&gt;options.route6.type
op_assign
id|NO_ROUTER
suffix:semicolon
macro_line|#endif /* QETH_IPV6 */
id|card-&gt;options.checksum_type
op_assign
id|QETH_CHECKSUM_DEFAULT
suffix:semicolon
id|card-&gt;options.broadcast_mode
op_assign
id|QETH_TR_BROADCAST_ALLRINGS
suffix:semicolon
id|card-&gt;options.macaddr_mode
op_assign
id|QETH_TR_MACADDR_NONCANONICAL
suffix:semicolon
id|card-&gt;options.fake_broadcast
op_assign
l_int|0
suffix:semicolon
id|card-&gt;options.add_hhlen
op_assign
id|DEFAULT_ADD_HHLEN
suffix:semicolon
id|card-&gt;options.fake_ll
op_assign
l_int|0
suffix:semicolon
id|card-&gt;options.layer2
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * initialize channels ,card and all state machines&n; */
r_static
r_int
DECL|function|qeth_setup_card
id|qeth_setup_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;setupcrd&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|card-&gt;read.state
op_assign
id|CH_STATE_DOWN
suffix:semicolon
id|card-&gt;write.state
op_assign
id|CH_STATE_DOWN
suffix:semicolon
id|card-&gt;data.state
op_assign
id|CH_STATE_DOWN
suffix:semicolon
id|card-&gt;state
op_assign
id|CARD_STATE_DOWN
suffix:semicolon
id|card-&gt;lan_online
op_assign
l_int|0
suffix:semicolon
id|card-&gt;use_hard_stop
op_assign
l_int|0
suffix:semicolon
id|card-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;vlanlock
)paren
suffix:semicolon
id|card-&gt;vlangrp
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;ip_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
)paren
suffix:semicolon
id|card-&gt;thread_start_mask
op_assign
l_int|0
suffix:semicolon
id|card-&gt;thread_allowed_mask
op_assign
l_int|0
suffix:semicolon
id|card-&gt;thread_running_mask
op_assign
l_int|0
suffix:semicolon
id|INIT_WORK
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
comma
(paren
r_void
op_star
)paren
id|qeth_start_kernel_thread
comma
id|card
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;ip_list
)paren
suffix:semicolon
id|card-&gt;ip_tbd_list
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|list_head
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;ip_tbd_list
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|0
comma
l_string|&quot;iptbdnom&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;cmd_waiter_list
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
multiline_comment|/* intial options */
id|qeth_set_intial_options
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* IP address takeover */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;ipato.entries
)paren
suffix:semicolon
id|card-&gt;ipato.enabled
op_assign
l_int|0
suffix:semicolon
id|card-&gt;ipato.invert4
op_assign
l_int|0
suffix:semicolon
id|card-&gt;ipato.invert6
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* init QDIO stuff */
id|qeth_init_qdio_info
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_determine_card_type
id|qeth_determine_card_type
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;detcdtyp&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|known_devices
(braket
id|i
)braket
(braket
l_int|4
)braket
)paren
(brace
r_if
c_cond
(paren
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|id.dev_type
op_eq
id|known_devices
(braket
id|i
)braket
(braket
l_int|2
)braket
)paren
op_logical_and
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|id.dev_model
op_eq
id|known_devices
(braket
id|i
)braket
(braket
l_int|3
)braket
)paren
)paren
(brace
id|card-&gt;info.type
op_assign
id|known_devices
(braket
id|i
)braket
(braket
l_int|4
)braket
suffix:semicolon
id|card-&gt;qdio.no_out_queues
op_assign
id|known_devices
(braket
id|i
)braket
(braket
l_int|8
)braket
suffix:semicolon
id|card-&gt;info.is_multicast_different
op_assign
id|known_devices
(braket
id|i
)braket
(braket
l_int|9
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
id|card-&gt;info.type
op_assign
id|QETH_CARD_TYPE_UNKNOWN
suffix:semicolon
id|PRINT_ERR
c_func
(paren
l_string|&quot;unknown card type on device %s&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_probe_device
id|qeth_probe_device
c_func
(paren
r_struct
id|ccwgroup_device
op_star
id|gdev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;probedev&quot;
)paren
suffix:semicolon
id|dev
op_assign
op_amp
id|gdev-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get_device
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|card
op_assign
id|qeth_alloc_card
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|put_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
op_minus
id|ENOMEM
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_setup_card
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|put_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|qeth_free_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|gdev-&gt;dev.driver_data
op_assign
id|card
suffix:semicolon
id|card-&gt;gdev
op_assign
id|gdev
suffix:semicolon
id|gdev-&gt;cdev
(braket
l_int|0
)braket
op_member_access_from_pointer
id|handler
op_assign
id|qeth_irq
suffix:semicolon
id|gdev-&gt;cdev
(braket
l_int|1
)braket
op_member_access_from_pointer
id|handler
op_assign
id|qeth_irq
suffix:semicolon
id|gdev-&gt;cdev
(braket
l_int|2
)braket
op_member_access_from_pointer
id|handler
op_assign
id|qeth_irq
suffix:semicolon
id|rc
op_assign
id|qeth_create_device_attributes
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|put_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|qeth_free_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|card-&gt;read.ccwdev
op_assign
id|gdev-&gt;cdev
(braket
l_int|0
)braket
suffix:semicolon
id|card-&gt;write.ccwdev
op_assign
id|gdev-&gt;cdev
(braket
l_int|1
)braket
suffix:semicolon
id|card-&gt;data.ccwdev
op_assign
id|gdev-&gt;cdev
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_determine_card_type
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;%s: not a valid card type&bslash;n&quot;
comma
id|__func__
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|put_device
c_func
(paren
id|dev
)paren
suffix:semicolon
id|qeth_free_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* insert into our internal list */
id|write_lock_irqsave
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|card-&gt;list
comma
op_amp
id|qeth_card_list.list
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_get_unitaddr
id|qeth_get_unitaddr
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|length
suffix:semicolon
r_char
op_star
id|prcd
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;getunit&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|read_conf_data
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
(paren
r_void
op_star
op_star
)paren
op_amp
id|prcd
comma
op_amp
id|length
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;read_conf_data for device %s returned %i&bslash;n&quot;
comma
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|card-&gt;info.chpid
op_assign
id|prcd
(braket
l_int|30
)braket
suffix:semicolon
id|card-&gt;info.unit_addr2
op_assign
id|prcd
(braket
l_int|31
)braket
suffix:semicolon
id|card-&gt;info.cula
op_assign
id|prcd
(braket
l_int|63
)braket
suffix:semicolon
id|card-&gt;info.guestlan
op_assign
(paren
(paren
id|prcd
(braket
l_int|0x10
)braket
op_eq
id|_ascebc
(braket
l_char|&squot;V&squot;
)braket
)paren
op_logical_and
(paren
id|prcd
(braket
l_int|0x11
)braket
op_eq
id|_ascebc
(braket
l_char|&squot;M&squot;
)braket
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_init_tokens
id|qeth_init_tokens
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|card-&gt;token.issuer_rm_w
op_assign
l_int|0x00010103UL
suffix:semicolon
id|card-&gt;token.cm_filter_w
op_assign
l_int|0x00010108UL
suffix:semicolon
id|card-&gt;token.cm_connection_w
op_assign
l_int|0x0001010aUL
suffix:semicolon
id|card-&gt;token.ulp_filter_w
op_assign
l_int|0x0001010bUL
suffix:semicolon
id|card-&gt;token.ulp_connection_w
op_assign
l_int|0x0001010dUL
suffix:semicolon
)brace
r_static
r_inline
id|__u16
DECL|function|raw_devno_from_bus_id
id|raw_devno_from_bus_id
c_func
(paren
r_char
op_star
id|id
)paren
(brace
id|id
op_add_assign
(paren
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|4
)paren
suffix:semicolon
r_return
(paren
id|__u16
)paren
id|simple_strtoul
c_func
(paren
id|id
comma
op_amp
id|id
comma
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * setup channel&n; */
r_static
r_void
DECL|function|qeth_setup_ccw
id|qeth_setup_ccw
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_int
r_char
op_star
id|iob
comma
id|__u32
id|len
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;setupccw&quot;
)paren
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_eq
op_amp
id|card-&gt;read
)paren
id|memcpy
c_func
(paren
op_amp
id|channel-&gt;ccw
comma
id|READ_CCW
comma
r_sizeof
(paren
r_struct
id|ccw1
)paren
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|channel-&gt;ccw
comma
id|WRITE_CCW
comma
r_sizeof
(paren
r_struct
id|ccw1
)paren
)paren
suffix:semicolon
id|channel-&gt;ccw.count
op_assign
id|len
suffix:semicolon
id|channel-&gt;ccw.cda
op_assign
(paren
id|__u32
)paren
id|__pa
c_func
(paren
id|iob
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * get free buffer for ccws (IDX activation, lancmds,ipassists...)&n; */
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|__qeth_get_buffer
id|__qeth_get_buffer
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
id|__u8
id|index
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;getbuff&quot;
)paren
suffix:semicolon
id|index
op_assign
id|channel-&gt;io_buf_no
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|channel-&gt;iob
(braket
id|index
)braket
dot
id|state
op_eq
id|BUF_STATE_FREE
)paren
(brace
id|channel-&gt;iob
(braket
id|index
)braket
dot
id|state
op_assign
id|BUF_STATE_LOCKED
suffix:semicolon
id|channel-&gt;io_buf_no
op_assign
(paren
id|channel-&gt;io_buf_no
op_plus
l_int|1
)paren
op_mod
id|QETH_CMD_BUFFER_NO
suffix:semicolon
id|memset
c_func
(paren
id|channel-&gt;iob
(braket
id|index
)braket
dot
id|data
comma
l_int|0
comma
id|QETH_BUFSIZE
)paren
suffix:semicolon
r_return
id|channel-&gt;iob
op_plus
id|index
suffix:semicolon
)brace
id|index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_mod
id|QETH_CMD_BUFFER_NO
suffix:semicolon
)brace
r_while
c_loop
(paren
id|index
op_ne
id|channel-&gt;io_buf_no
)paren
(brace
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/**&n; * release command buffer&n; */
r_static
r_void
DECL|function|qeth_release_buffer
id|qeth_release_buffer
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;relbuff&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|channel-&gt;iob_lock
comma
id|flags
)paren
suffix:semicolon
id|memset
c_func
(paren
id|iob-&gt;data
comma
l_int|0
comma
id|QETH_BUFSIZE
)paren
suffix:semicolon
id|iob-&gt;state
op_assign
id|BUF_STATE_FREE
suffix:semicolon
id|iob-&gt;callback
op_assign
id|qeth_send_control_data_cb
suffix:semicolon
id|iob-&gt;rc
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|channel-&gt;iob_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|qeth_get_buffer
id|qeth_get_buffer
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|buffer
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|channel-&gt;iob_lock
comma
id|flags
)paren
suffix:semicolon
id|buffer
op_assign
id|__qeth_get_buffer
c_func
(paren
id|channel
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|channel-&gt;iob_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|buffer
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|qeth_wait_for_buffer
id|qeth_wait_for_buffer
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|buffer
suffix:semicolon
id|wait_event
c_func
(paren
id|channel-&gt;wait_q
comma
(paren
(paren
id|buffer
op_assign
id|qeth_get_buffer
c_func
(paren
id|channel
)paren
)paren
op_ne
l_int|NULL
)paren
)paren
suffix:semicolon
r_return
id|buffer
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_clear_cmd_buffers
id|qeth_clear_cmd_buffers
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_int
id|cnt
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|QETH_CMD_BUFFER_NO
suffix:semicolon
id|cnt
op_increment
)paren
id|qeth_release_buffer
c_func
(paren
id|channel
comma
op_amp
id|channel-&gt;iob
(braket
id|cnt
)braket
)paren
suffix:semicolon
id|channel-&gt;buf_no
op_assign
l_int|0
suffix:semicolon
id|channel-&gt;io_buf_no
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * start IDX for read and write channel&n; */
r_static
r_int
DECL|function|qeth_idx_activate_get_answer
id|qeth_idx_activate_get_answer
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_void
(paren
op_star
id|idx_reply_cb
)paren
(paren
r_struct
id|qeth_channel
op_star
comma
r_struct
id|qeth_cmd_buffer
op_star
)paren
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;idxanswr&quot;
)paren
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_buffer
c_func
(paren
id|channel
)paren
suffix:semicolon
id|iob-&gt;callback
op_assign
id|idx_reply_cb
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|channel-&gt;ccw
comma
id|READ_CCW
comma
r_sizeof
(paren
r_struct
id|ccw1
)paren
)paren
suffix:semicolon
id|channel-&gt;ccw.count
op_assign
id|QETH_BUFSIZE
suffix:semicolon
id|channel-&gt;ccw.cda
op_assign
(paren
id|__u32
)paren
id|__pa
c_func
(paren
id|iob-&gt;data
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|card-&gt;wait_q
comma
id|atomic_compare_and_swap
c_func
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|channel-&gt;irq_pending
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|6
comma
l_string|&quot;noirqpnd&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_start
c_func
(paren
id|channel-&gt;ccwdev
comma
op_amp
id|channel-&gt;ccw
comma
(paren
id|addr_t
)paren
id|iob
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;qeth: Error2 in activating channel rc=%d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|channel-&gt;irq_pending
comma
l_int|0
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|card-&gt;wait_q
comma
id|channel-&gt;state
op_eq
id|CH_STATE_UP
comma
id|QETH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_ne
id|CH_STATE_UP
)paren
(brace
id|rc
op_assign
op_minus
id|ETIME
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
id|rc
op_assign
l_int|0
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_idx_activate_channel
id|qeth_idx_activate_channel
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_void
(paren
op_star
id|idx_reply_cb
)paren
(paren
r_struct
id|qeth_channel
op_star
comma
r_struct
id|qeth_cmd_buffer
op_star
)paren
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|__u16
id|temp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;idxactch&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_buffer
c_func
(paren
id|channel
)paren
suffix:semicolon
id|iob-&gt;callback
op_assign
id|idx_reply_cb
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|channel-&gt;ccw
comma
id|WRITE_CCW
comma
r_sizeof
(paren
r_struct
id|ccw1
)paren
)paren
suffix:semicolon
id|channel-&gt;ccw.count
op_assign
id|IDX_ACTIVATE_SIZE
suffix:semicolon
id|channel-&gt;ccw.cda
op_assign
(paren
id|__u32
)paren
id|__pa
c_func
(paren
id|iob-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
op_eq
op_amp
id|card-&gt;write
)paren
(brace
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|IDX_ACTIVATE_WRITE
comma
id|IDX_ACTIVATE_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_TRANSPORT_HEADER_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;seqno.trans_hdr
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
id|card-&gt;seqno.trans_hdr
op_increment
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|IDX_ACTIVATE_READ
comma
id|IDX_ACTIVATE_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_TRANSPORT_HEADER_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;seqno.trans_hdr
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|QETH_IDX_ACT_ISSUER_RM_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.issuer_rm_w
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IDX_ACT_FUNC_LEVEL
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;info.func_level
comma
r_sizeof
(paren
id|__u16
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|raw_devno_from_bus_id
c_func
(paren
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IDX_ACT_QDIO_DEV_CUA
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|temp
comma
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|card-&gt;info.cula
op_lshift
l_int|8
)paren
op_plus
id|card-&gt;info.unit_addr2
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IDX_ACT_QDIO_DEV_REALADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|temp
comma
l_int|2
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|card-&gt;wait_q
comma
id|atomic_compare_and_swap
c_func
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|channel-&gt;irq_pending
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|6
comma
l_string|&quot;noirqpnd&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_start
c_func
(paren
id|channel-&gt;ccwdev
comma
op_amp
id|channel-&gt;ccw
comma
(paren
id|addr_t
)paren
id|iob
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;qeth: Error1 in activating channel. rc=%d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|channel-&gt;irq_pending
comma
l_int|0
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|card-&gt;wait_q
comma
id|channel-&gt;state
op_eq
id|CH_STATE_ACTIVATING
comma
id|QETH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_ne
id|CH_STATE_ACTIVATING
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;qeth: IDX activate timed out!&bslash;n&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
op_minus
id|ETIME
)paren
suffix:semicolon
r_return
op_minus
id|ETIME
suffix:semicolon
)brace
r_return
id|qeth_idx_activate_get_answer
c_func
(paren
id|channel
comma
id|idx_reply_cb
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_peer_func_level
id|qeth_peer_func_level
c_func
(paren
r_int
id|level
)paren
(brace
r_if
c_cond
(paren
(paren
id|level
op_amp
l_int|0xff
)paren
op_eq
l_int|8
)paren
r_return
(paren
id|level
op_amp
l_int|0xff
)paren
op_plus
l_int|0x400
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|level
op_rshift
l_int|8
)paren
op_amp
l_int|3
)paren
op_eq
l_int|1
)paren
r_return
(paren
id|level
op_amp
l_int|0xff
)paren
op_plus
l_int|0x200
suffix:semicolon
r_return
id|level
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_idx_write_cb
id|qeth_idx_write_cb
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|__u16
id|temp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;idxwrcb&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_eq
id|CH_STATE_DOWN
)paren
(brace
id|channel-&gt;state
op_assign
id|CH_STATE_ACTIVATING
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|QETH_IS_IDX_ACT_POS_REPLY
c_func
(paren
id|iob-&gt;data
)paren
)paren
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;IDX_ACTIVATE on write channel device %s: negative &quot;
l_string|&quot;reply&bslash;n&quot;
comma
id|CARD_WDEV_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|temp
comma
id|QETH_IDX_ACT_FUNC_LEVEL
c_func
(paren
id|iob-&gt;data
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
op_complement
l_int|0x0100
)paren
op_ne
id|qeth_peer_func_level
c_func
(paren
id|card-&gt;info.func_level
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;IDX_ACTIVATE on write channel device %s: &quot;
l_string|&quot;function level mismatch &quot;
l_string|&quot;(sent: 0x%x, received: 0x%x)&bslash;n&quot;
comma
id|CARD_WDEV_ID
c_func
(paren
id|card
)paren
comma
id|card-&gt;info.func_level
comma
id|temp
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|channel-&gt;state
op_assign
id|CH_STATE_UP
suffix:semicolon
id|out
suffix:colon
id|qeth_release_buffer
c_func
(paren
id|channel
comma
id|iob
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_check_idx_response
id|qeth_check_idx_response
c_func
(paren
r_int
r_char
op_star
id|buffer
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
l_int|0
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|control
comma
l_int|2
comma
id|buffer
comma
id|QETH_DBF_CONTROL_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buffer
(braket
l_int|2
)braket
op_amp
l_int|0xc0
)paren
op_eq
l_int|0xc0
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;received an IDX TERMINATE &quot;
l_string|&quot;with cause code 0x%02x%s&bslash;n&quot;
comma
id|buffer
(braket
l_int|4
)braket
comma
(paren
(paren
id|buffer
(braket
l_int|4
)braket
op_eq
l_int|0x22
)paren
ques
c_cond
l_string|&quot; -- try another portname&quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ckidxres&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot; idxterm&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
op_minus
id|EIO
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_idx_read_cb
id|qeth_idx_read_cb
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|__u16
id|temp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;idxrdcb&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_eq
id|CH_STATE_DOWN
)paren
(brace
id|channel-&gt;state
op_assign
id|CH_STATE_ACTIVATING
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_check_idx_response
c_func
(paren
id|iob-&gt;data
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|QETH_IS_IDX_ACT_POS_REPLY
c_func
(paren
id|iob-&gt;data
)paren
)paren
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;IDX_ACTIVATE on read channel device %s: negative &quot;
l_string|&quot;reply&bslash;n&quot;
comma
id|CARD_RDEV_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/**&n; * temporary fix for microcode bug&n; * to revert it,replace OR by AND&n; */
r_if
c_cond
(paren
(paren
op_logical_neg
id|QETH_IDX_NO_PORTNAME_REQUIRED
c_func
(paren
id|iob-&gt;data
)paren
)paren
op_logical_or
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
)paren
id|card-&gt;info.portname_required
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|temp
comma
id|QETH_IDX_ACT_FUNC_LEVEL
c_func
(paren
id|iob-&gt;data
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
id|qeth_peer_func_level
c_func
(paren
id|card-&gt;info.func_level
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;IDX_ACTIVATE on read channel device %s: function &quot;
l_string|&quot;level mismatch (sent: 0x%x, received: 0x%x)&bslash;n&quot;
comma
id|CARD_RDEV_ID
c_func
(paren
id|card
)paren
comma
id|card-&gt;info.func_level
comma
id|temp
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|card-&gt;token.issuer_rm_r
comma
id|QETH_IDX_ACT_ISSUER_RM_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
comma
id|QETH_IDX_REPLY_LEVEL
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MCL_LENGTH
)paren
suffix:semicolon
id|channel-&gt;state
op_assign
id|CH_STATE_UP
suffix:semicolon
id|out
suffix:colon
id|qeth_release_buffer
c_func
(paren
id|channel
comma
id|iob
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_issue_next_read
id|qeth_issue_next_read
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;issnxrd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;read.state
op_ne
id|CH_STATE_UP
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|iob
op_assign
id|qeth_get_buffer
c_func
(paren
op_amp
id|card-&gt;read
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iob
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;issue_next_read failed: no iob available!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|qeth_setup_ccw
c_func
(paren
op_amp
id|card-&gt;read
comma
id|iob-&gt;data
comma
id|QETH_BUFSIZE
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|card-&gt;wait_q
comma
id|atomic_compare_and_swap
c_func
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|card-&gt;read.irq_pending
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;noirqpnd&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_start
c_func
(paren
id|card-&gt;read.ccwdev
comma
op_amp
id|card-&gt;read.ccw
comma
(paren
id|addr_t
)paren
id|iob
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;Error in starting next read ccw! rc=%i&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|card-&gt;read.irq_pending
comma
l_int|0
)paren
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_struct
id|qeth_reply
op_star
DECL|function|qeth_alloc_reply
id|qeth_alloc_reply
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_reply
op_star
id|reply
suffix:semicolon
id|reply
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_reply
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reply
)paren
(brace
id|memset
c_func
(paren
id|reply
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_reply
)paren
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|reply-&gt;refcnt
comma
l_int|1
)paren
suffix:semicolon
id|reply-&gt;card
op_assign
id|card
suffix:semicolon
)brace
suffix:semicolon
r_return
id|reply
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_get_reply
id|qeth_get_reply
c_func
(paren
r_struct
id|qeth_reply
op_star
id|reply
)paren
(brace
id|WARN_ON
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|reply-&gt;refcnt
)paren
op_le
l_int|0
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|reply-&gt;refcnt
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_put_reply
id|qeth_put_reply
c_func
(paren
r_struct
id|qeth_reply
op_star
id|reply
)paren
(brace
id|WARN_ON
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|reply-&gt;refcnt
)paren
op_le
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|reply-&gt;refcnt
)paren
)paren
id|kfree
c_func
(paren
id|reply
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_cmd_timeout
id|qeth_cmd_timeout
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_reply
op_star
id|reply
comma
op_star
id|list_reply
comma
op_star
id|r
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|reply
op_assign
(paren
r_struct
id|qeth_reply
op_star
)paren
id|data
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|reply-&gt;card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|list_reply
comma
id|r
comma
op_amp
id|reply-&gt;card-&gt;cmd_waiter_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|reply
op_eq
id|list_reply
)paren
(brace
id|qeth_get_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|reply-&gt;list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|reply-&gt;card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|reply-&gt;rc
op_assign
op_minus
id|ETIME
suffix:semicolon
id|reply-&gt;received
op_assign
l_int|1
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|reply-&gt;wait_q
)paren
suffix:semicolon
id|qeth_put_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|reply-&gt;card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_reset_ip_addresses
id|qeth_reset_ip_addresses
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;rstipadd&quot;
)paren
suffix:semicolon
id|qeth_clear_ip_list
c_func
(paren
id|card
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* this function will also schedule the SET_IP_THREAD */
id|qeth_set_multicast_list
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
)brace
r_static
r_struct
id|qeth_ipa_cmd
op_star
DECL|function|qeth_check_ipa_data
id|qeth_check_ipa_data
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
op_assign
l_int|NULL
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;chkipad&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_IPA
c_func
(paren
id|iob-&gt;data
)paren
)paren
(brace
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|PDU_ENCAPSULATION
c_func
(paren
id|iob-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_IPA_REPLY
c_func
(paren
id|cmd
)paren
)paren
r_return
id|cmd
suffix:semicolon
r_else
(brace
r_switch
c_cond
(paren
id|cmd-&gt;hdr.command
)paren
(brace
r_case
id|IPA_CMD_STOPLAN
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Link failure on %s (CHPID 0x%X) - &quot;
l_string|&quot;there is a network problem or &quot;
l_string|&quot;someone pulled the cable or &quot;
l_string|&quot;disabled the port.&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|card-&gt;info.chpid
)paren
suffix:semicolon
id|card-&gt;lan_online
op_assign
l_int|0
suffix:semicolon
id|netif_carrier_off
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
r_case
id|IPA_CMD_STARTLAN
suffix:colon
id|PRINT_INFO
c_func
(paren
l_string|&quot;Link reestablished on %s &quot;
l_string|&quot;(CHPID 0x%X). Scheduling &quot;
l_string|&quot;IP address reset.&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|card-&gt;info.chpid
)paren
suffix:semicolon
id|card-&gt;lan_online
op_assign
l_int|1
suffix:semicolon
id|netif_carrier_on
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|qeth_reset_ip_addresses
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
r_case
id|IPA_CMD_REGISTER_LOCAL_ADDR
suffix:colon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;irla&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPA_CMD_UNREGISTER_LOCAL_ADDR
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;probably problem on %s: &quot;
l_string|&quot;received IPA command 0x%X&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|cmd-&gt;hdr.command
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Received data is IPA &quot;
l_string|&quot;but not a reply!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_return
id|cmd
suffix:semicolon
)brace
multiline_comment|/**&n; * wake all waiting ipa commands&n; */
r_static
r_void
DECL|function|qeth_clear_ipacmd_list
id|qeth_clear_ipacmd_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_reply
op_star
id|reply
comma
op_star
id|r
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;clipalst&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|reply
comma
id|r
comma
op_amp
id|card-&gt;cmd_waiter_list
comma
id|list
)paren
(brace
id|qeth_get_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
id|reply-&gt;rc
op_assign
op_minus
id|EIO
suffix:semicolon
id|reply-&gt;received
op_assign
l_int|1
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|reply-&gt;list
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|reply-&gt;wait_q
)paren
suffix:semicolon
id|qeth_put_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_send_control_data_cb
id|qeth_send_control_data_cb
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|qeth_reply
op_star
id|reply
comma
op_star
id|r
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|keep_reply
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sndctlcb&quot;
)paren
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_check_idx_response
c_func
(paren
id|iob-&gt;data
)paren
)paren
(brace
id|qeth_clear_ipacmd_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|cmd
op_assign
id|qeth_check_ipa_data
c_func
(paren
id|card
comma
id|iob
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmd
op_eq
l_int|NULL
)paren
op_logical_and
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_DOWN
)paren
)paren
r_goto
id|out
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|reply
comma
id|r
comma
op_amp
id|card-&gt;cmd_waiter_list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
(paren
id|reply-&gt;seqno
op_eq
id|QETH_IDX_COMMAND_SEQNO
)paren
op_logical_or
(paren
(paren
id|cmd
)paren
op_logical_and
(paren
id|reply-&gt;seqno
op_eq
id|cmd-&gt;hdr.seqno
)paren
)paren
)paren
(brace
id|qeth_get_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|reply-&gt;list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|keep_reply
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|reply-&gt;callback
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|cmd
)paren
(brace
id|reply-&gt;offset
op_assign
(paren
id|__u16
)paren
(paren
(paren
r_char
op_star
)paren
id|cmd
op_minus
(paren
r_char
op_star
)paren
id|iob-&gt;data
)paren
suffix:semicolon
id|keep_reply
op_assign
id|reply
op_member_access_from_pointer
id|callback
c_func
(paren
id|card
comma
id|reply
comma
(paren
r_int
r_int
)paren
id|cmd
)paren
suffix:semicolon
)brace
r_else
id|keep_reply
op_assign
id|reply
op_member_access_from_pointer
id|callback
c_func
(paren
id|card
comma
id|reply
comma
(paren
r_int
r_int
)paren
id|iob
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
)paren
id|reply-&gt;rc
op_assign
(paren
id|s16
)paren
id|cmd-&gt;hdr.return_code
suffix:semicolon
r_else
r_if
c_cond
(paren
id|iob-&gt;rc
)paren
id|reply-&gt;rc
op_assign
id|iob-&gt;rc
suffix:semicolon
r_if
c_cond
(paren
id|keep_reply
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|reply-&gt;list
comma
op_amp
id|card-&gt;cmd_waiter_list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|reply-&gt;received
op_assign
l_int|1
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|reply-&gt;wait_q
)paren
suffix:semicolon
)brace
id|qeth_put_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;seqno.pdu_hdr_ack
comma
id|QETH_PDU_HEADER_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
id|qeth_release_buffer
c_func
(paren
id|channel
comma
id|iob
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_control_data
id|qeth_send_control_data
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|len
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|qeth_reply
op_star
id|reply
suffix:semicolon
r_struct
id|timer_list
id|timer
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;sendctl&quot;
)paren
suffix:semicolon
id|qeth_setup_ccw
c_func
(paren
op_amp
id|card-&gt;write
comma
id|iob-&gt;data
comma
id|len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_TRANSPORT_HEADER_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;seqno.trans_hdr
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
id|card-&gt;seqno.trans_hdr
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_PDU_HEADER_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;seqno.pdu_hdr
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
id|card-&gt;seqno.pdu_hdr
op_increment
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_PDU_HEADER_ACK_SEQ_NO
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;seqno.pdu_hdr_ack
comma
id|QETH_SEQ_NO_LENGTH
)paren
suffix:semicolon
id|iob-&gt;callback
op_assign
id|qeth_release_buffer
suffix:semicolon
id|reply
op_assign
id|qeth_alloc_reply
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|reply
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could no alloc qeth_reply!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|reply-&gt;callback
op_assign
id|reply_cb
suffix:semicolon
id|reply-&gt;param
op_assign
id|reply_param
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_DOWN
)paren
id|reply-&gt;seqno
op_assign
id|QETH_IDX_COMMAND_SEQNO
suffix:semicolon
r_else
id|reply-&gt;seqno
op_assign
id|card-&gt;seqno.ipa
op_increment
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
id|timer.function
op_assign
id|qeth_cmd_timeout
suffix:semicolon
id|timer.data
op_assign
(paren
r_int
r_int
)paren
id|reply
suffix:semicolon
r_if
c_cond
(paren
id|IS_IPA
c_func
(paren
id|iob-&gt;data
)paren
)paren
id|timer.expires
op_assign
id|jiffies
op_plus
id|QETH_IPA_TIMEOUT
suffix:semicolon
r_else
id|timer.expires
op_assign
id|jiffies
op_plus
id|QETH_TIMEOUT
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|reply-&gt;wait_q
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|reply-&gt;list
comma
op_amp
id|card-&gt;cmd_waiter_list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|control
comma
l_int|2
comma
id|iob-&gt;data
comma
id|QETH_DBF_CONTROL_LEN
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|card-&gt;wait_q
comma
id|atomic_compare_and_swap
c_func
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|card-&gt;write.irq_pending
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;noirqpnd&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|card-&gt;write.ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_start
c_func
(paren
id|card-&gt;write.ccwdev
comma
op_amp
id|card-&gt;write.ccw
comma
(paren
id|addr_t
)paren
id|iob
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|card-&gt;write.ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;qeth_send_control_data: &quot;
l_string|&quot;ccw_device_start rc = %i&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot; err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|reply-&gt;list
)paren
suffix:semicolon
id|qeth_put_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|qeth_release_buffer
c_func
(paren
id|iob-&gt;channel
comma
id|iob
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|card-&gt;write.irq_pending
comma
l_int|0
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|add_timer
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|reply-&gt;wait_q
comma
id|reply-&gt;received
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|timer
)paren
suffix:semicolon
id|rc
op_assign
id|reply-&gt;rc
suffix:semicolon
id|qeth_put_reply
c_func
(paren
id|reply
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_ipa_cmd
id|qeth_send_ipa_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
(brace
r_int
id|rc
suffix:semicolon
r_char
id|prot_type
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sendipa&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|IPA_PDU_HEADER
comma
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|prot_type
op_assign
id|QETH_PROT_LAYER2
suffix:semicolon
r_else
id|prot_type
op_assign
id|QETH_PROT_TCPIP
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_CMD_PROT_TYPE
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|prot_type
comma
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_CMD_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|IPA_CMD_LENGTH
comma
id|iob
comma
id|reply_cb
comma
id|reply_param
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_cm_enable_cb
id|qeth_cm_enable_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;cmenblcb&quot;
)paren
suffix:semicolon
id|iob
op_assign
(paren
r_struct
id|qeth_cmd_buffer
op_star
)paren
id|data
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;token.cm_filter_r
comma
id|QETH_CM_ENABLE_RESP_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
id|iob-&gt;rc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_cm_enable
id|qeth_cm_enable
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;cmenable&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|CM_ENABLE
comma
id|CM_ENABLE_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_CM_ENABLE_ISSUER_RM_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.issuer_rm_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_CM_ENABLE_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_filter_w
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|CM_ENABLE_SIZE
comma
id|iob
comma
id|qeth_cm_enable_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_cm_setup_cb
id|qeth_cm_setup_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;cmsetpcb&quot;
)paren
suffix:semicolon
id|iob
op_assign
(paren
r_struct
id|qeth_cmd_buffer
op_star
)paren
id|data
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;token.cm_connection_r
comma
id|QETH_CM_SETUP_RESP_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
id|iob-&gt;rc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_cm_setup
id|qeth_cm_setup
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;cmsetup&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|CM_SETUP
comma
id|CM_SETUP_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_CM_SETUP_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.issuer_rm_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_CM_SETUP_CONNECTION_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_connection_w
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_CM_SETUP_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_filter_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|CM_SETUP_SIZE
comma
id|iob
comma
id|qeth_cm_setup_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_ulp_enable_cb
id|qeth_ulp_enable_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
id|__u16
id|mtu
comma
id|framesize
suffix:semicolon
id|__u16
id|len
suffix:semicolon
id|__u8
id|link_type
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;ulpenacb&quot;
)paren
suffix:semicolon
id|iob
op_assign
(paren
r_struct
id|qeth_cmd_buffer
op_star
)paren
id|data
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;token.ulp_filter_r
comma
id|QETH_ULP_ENABLE_RESP_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_get_mtu_out_of_mpc
c_func
(paren
id|card-&gt;info.type
)paren
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|framesize
comma
id|QETH_ULP_ENABLE_RESP_MAX_MTU
c_func
(paren
id|iob-&gt;data
)paren
comma
l_int|2
)paren
suffix:semicolon
id|mtu
op_assign
id|qeth_get_mtu_outof_framesize
c_func
(paren
id|framesize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mtu
)paren
(brace
id|iob-&gt;rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
id|iob-&gt;rc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|card-&gt;info.max_mtu
op_assign
id|mtu
suffix:semicolon
id|card-&gt;info.initial_mtu
op_assign
id|mtu
suffix:semicolon
id|card-&gt;qdio.in_buf_size
op_assign
id|mtu
op_plus
l_int|2
op_star
id|PAGE_SIZE
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;info.initial_mtu
op_assign
id|qeth_get_initial_mtu_for_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;info.max_mtu
op_assign
id|qeth_get_max_mtu_for_card
c_func
(paren
id|card-&gt;info.type
)paren
suffix:semicolon
id|card-&gt;qdio.in_buf_size
op_assign
id|QETH_IN_BUF_SIZE_DEFAULT
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|len
comma
id|QETH_ULP_ENABLE_RESP_DIFINFO_LEN
c_func
(paren
id|iob-&gt;data
)paren
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ge
id|QETH_MPC_DIFINFO_LEN_INDICATES_LINK_TYPE
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|link_type
comma
id|QETH_ULP_ENABLE_RESP_LINK_TYPE
c_func
(paren
id|iob-&gt;data
)paren
comma
l_int|1
)paren
suffix:semicolon
id|card-&gt;info.link_type
op_assign
id|link_type
suffix:semicolon
)brace
r_else
id|card-&gt;info.link_type
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
id|iob-&gt;rc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_ulp_enable
id|qeth_ulp_enable
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_char
id|prot_type
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
multiline_comment|/*FIXME: trace view callbacks*/
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;ulpenabl&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|ULP_ENABLE
comma
id|ULP_ENABLE_SIZE
)paren
suffix:semicolon
op_star
(paren
id|QETH_ULP_ENABLE_LINKNUM
c_func
(paren
id|iob-&gt;data
)paren
)paren
op_assign
(paren
id|__u8
)paren
id|card-&gt;info.portno
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|prot_type
op_assign
id|QETH_PROT_LAYER2
suffix:semicolon
r_else
id|prot_type
op_assign
id|QETH_PROT_TCPIP
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_ENABLE_PROT_TYPE
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|prot_type
comma
l_int|1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_ENABLE_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_ENABLE_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_filter_w
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_ENABLE_PORTNAME_AND_LL
c_func
(paren
id|iob-&gt;data
)paren
comma
id|card-&gt;info.portname
comma
l_int|9
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|ULP_ENABLE_SIZE
comma
id|iob
comma
id|qeth_ulp_enable_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
id|__u16
DECL|function|__raw_devno_from_bus_id
id|__raw_devno_from_bus_id
c_func
(paren
r_char
op_star
id|id
)paren
(brace
id|id
op_add_assign
(paren
id|strlen
c_func
(paren
id|id
)paren
op_minus
l_int|4
)paren
suffix:semicolon
r_return
(paren
id|__u16
)paren
id|simple_strtoul
c_func
(paren
id|id
comma
op_amp
id|id
comma
l_int|16
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_ulp_setup_cb
id|qeth_ulp_setup_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;ulpstpcb&quot;
)paren
suffix:semicolon
id|iob
op_assign
(paren
r_struct
id|qeth_cmd_buffer
op_star
)paren
id|data
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|card-&gt;token.ulp_connection_r
comma
id|QETH_ULP_SETUP_RESP_CONNECTION_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;  rc%d&quot;
comma
id|iob-&gt;rc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_ulp_setup
id|qeth_ulp_setup
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|__u16
id|temp
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;ulpsetup&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|ULP_SETUP
comma
id|ULP_SETUP_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_SETUP_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_SETUP_CONNECTION_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_connection_w
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_SETUP_FILTER_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_filter_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|temp
op_assign
id|__raw_devno_from_bus_id
c_func
(paren
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_SETUP_CUA
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|temp
comma
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|card-&gt;info.cula
op_lshift
l_int|8
)paren
op_plus
id|card-&gt;info.unit_addr2
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_ULP_SETUP_REAL_DEVADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|temp
comma
l_int|2
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|ULP_SETUP_SIZE
comma
id|iob
comma
id|qeth_ulp_setup_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_check_for_inbound_error
id|qeth_check_for_inbound_error
c_func
(paren
r_struct
id|qeth_qdio_buffer
op_star
id|buf
comma
r_int
r_int
id|qdio_error
comma
r_int
r_int
id|siga_error
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|qdio_error
op_logical_or
id|siga_error
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;qdinerr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot;qdinerr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot; F15=%02X&quot;
comma
id|buf-&gt;buffer-&gt;element
(braket
l_int|15
)braket
dot
id|flags
op_amp
l_int|0xff
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot; F14=%02X&quot;
comma
id|buf-&gt;buffer-&gt;element
(braket
l_int|14
)braket
dot
id|flags
op_amp
l_int|0xff
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot; qerr=%X&quot;
comma
id|qdio_error
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot; serr=%X&quot;
comma
id|siga_error
)paren
suffix:semicolon
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|sk_buff
op_star
DECL|function|qeth_get_skb
id|qeth_get_skb
c_func
(paren
r_int
r_int
id|length
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
(paren
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|length
op_plus
id|VLAN_HLEN
)paren
)paren
)paren
id|skb_reserve
c_func
(paren
id|skb
comma
id|VLAN_HLEN
)paren
suffix:semicolon
macro_line|#else
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|length
)paren
suffix:semicolon
macro_line|#endif
r_return
id|skb
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|sk_buff
op_star
DECL|function|qeth_get_next_skb
id|qeth_get_next_skb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qdio_buffer
op_star
id|buffer
comma
r_struct
id|qdio_buffer_element
op_star
op_star
id|__element
comma
r_int
op_star
id|__offset
comma
r_struct
id|qeth_hdr
op_star
op_star
id|hdr
)paren
(brace
r_struct
id|qdio_buffer_element
op_star
id|element
op_assign
op_star
id|__element
suffix:semicolon
r_int
id|offset
op_assign
op_star
id|__offset
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_int
id|skb_len
suffix:semicolon
r_void
op_star
id|data_ptr
suffix:semicolon
r_int
id|data_len
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;nextskb&quot;
)paren
suffix:semicolon
multiline_comment|/* qeth_hdr must not cross element boundaries */
r_if
c_cond
(paren
id|element-&gt;length
OL
id|offset
op_plus
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
(brace
r_if
c_cond
(paren
id|qeth_is_last_sbale
c_func
(paren
id|element
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|element
op_increment
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|element-&gt;length
OL
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|hdr
op_assign
id|element-&gt;addr
op_plus
id|offset
suffix:semicolon
id|offset
op_add_assign
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|skb_len
op_assign
(paren
op_star
id|hdr
)paren
op_member_access_from_pointer
id|hdr.l2.pkt_length
suffix:semicolon
r_else
id|skb_len
op_assign
(paren
op_star
id|hdr
)paren
op_member_access_from_pointer
id|hdr.l3.length
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_len
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.fake_ll
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|qeth_get_skb
c_func
(paren
id|skb_len
op_plus
id|QETH_FAKE_LL_LEN
)paren
)paren
)paren
r_goto
id|no_mem
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|QETH_FAKE_LL_LEN
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|skb
op_assign
id|qeth_get_skb
c_func
(paren
id|skb_len
)paren
)paren
)paren
r_goto
id|no_mem
suffix:semicolon
id|data_ptr
op_assign
id|element-&gt;addr
op_plus
id|offset
suffix:semicolon
r_while
c_loop
(paren
id|skb_len
)paren
(brace
id|data_len
op_assign
id|min
c_func
(paren
id|skb_len
comma
(paren
r_int
)paren
(paren
id|element-&gt;length
op_minus
id|offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data_len
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|data_len
)paren
comma
id|data_ptr
comma
id|data_len
)paren
suffix:semicolon
id|skb_len
op_sub_assign
id|data_len
suffix:semicolon
r_if
c_cond
(paren
id|skb_len
)paren
(brace
r_if
c_cond
(paren
id|qeth_is_last_sbale
c_func
(paren
id|element
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;unexeob&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot;unexeob&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|qerr
comma
l_int|2
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|misc
comma
l_int|4
comma
id|buffer
comma
r_sizeof
(paren
op_star
id|buffer
)paren
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|card-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|element
op_increment
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
id|data_ptr
op_assign
id|element-&gt;addr
suffix:semicolon
)brace
r_else
(brace
id|offset
op_add_assign
id|data_len
suffix:semicolon
)brace
)brace
op_star
id|__element
op_assign
id|element
suffix:semicolon
op_star
id|__offset
op_assign
id|offset
suffix:semicolon
r_return
id|skb
suffix:semicolon
id|no_mem
suffix:colon
r_if
c_cond
(paren
id|net_ratelimit
c_func
(paren
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;No memory for packet received on %s.&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;noskbmem&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
)brace
id|card-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|qeth_type_trans
id|qeth_type_trans
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|ethhdr
op_star
id|eth
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;typtrans&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
macro_line|#ifdef CONFIG_TR
r_if
c_cond
(paren
(paren
id|card-&gt;info.link_type
op_eq
id|QETH_LINK_TYPE_HSTR
)paren
op_logical_or
(paren
id|card-&gt;info.link_type
op_eq
id|QETH_LINK_TYPE_LANE_TR
)paren
)paren
r_return
id|tr_type_trans
c_func
(paren
id|skb
comma
id|dev
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_TR */
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|ETH_HLEN
)paren
suffix:semicolon
id|eth
op_assign
id|eth_hdr
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|eth-&gt;h_dest
op_amp
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth-&gt;h_dest
comma
id|dev-&gt;broadcast
comma
id|ETH_ALEN
)paren
op_eq
l_int|0
)paren
id|skb-&gt;pkt_type
op_assign
id|PACKET_BROADCAST
suffix:semicolon
r_else
id|skb-&gt;pkt_type
op_assign
id|PACKET_MULTICAST
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|eth-&gt;h_dest
comma
id|dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
)paren
id|skb-&gt;pkt_type
op_assign
id|PACKET_OTHERHOST
suffix:semicolon
r_if
c_cond
(paren
id|ntohs
c_func
(paren
id|eth-&gt;h_proto
)paren
op_ge
l_int|1536
)paren
r_return
id|eth-&gt;h_proto
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|skb-&gt;data
)paren
op_eq
l_int|0xFFFF
)paren
r_return
id|htons
c_func
(paren
id|ETH_P_802_3
)paren
suffix:semicolon
r_return
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_rebuild_skb_fake_ll
id|qeth_rebuild_skb_fake_ll
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
)paren
(brace
r_struct
id|ethhdr
op_star
id|fake_hdr
suffix:semicolon
r_struct
id|iphdr
op_star
id|ip_hdr
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;skbfake&quot;
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
op_minus
id|QETH_FAKE_LL_LEN
suffix:semicolon
multiline_comment|/* this is a fake ethernet header */
id|fake_hdr
op_assign
(paren
r_struct
id|ethhdr
op_star
)paren
id|skb-&gt;mac.raw
suffix:semicolon
multiline_comment|/* the destination MAC address */
r_switch
c_cond
(paren
id|skb-&gt;pkt_type
)paren
(brace
r_case
id|PACKET_MULTICAST
suffix:colon
r_switch
c_cond
(paren
id|skb-&gt;protocol
)paren
(brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_case
id|__constant_htons
c_func
(paren
id|ETH_P_IPV6
)paren
suffix:colon
id|ndisc_mc_map
c_func
(paren
(paren
r_struct
id|in6_addr
op_star
)paren
id|skb-&gt;data
op_plus
id|QETH_FAKE_LL_V6_ADDR_POS
comma
id|fake_hdr-&gt;h_dest
comma
id|card-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif /* CONFIG_QETH_IPV6 */
r_case
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:colon
id|ip_hdr
op_assign
(paren
r_struct
id|iphdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;dev-&gt;type
op_eq
id|ARPHRD_IEEE802_TR
)paren
id|ip_tr_mc_map
c_func
(paren
id|ip_hdr-&gt;daddr
comma
id|fake_hdr-&gt;h_dest
)paren
suffix:semicolon
r_else
id|ip_eth_mc_map
c_func
(paren
id|ip_hdr-&gt;daddr
comma
id|fake_hdr-&gt;h_dest
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|memcpy
c_func
(paren
id|fake_hdr-&gt;h_dest
comma
id|card-&gt;dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PACKET_BROADCAST
suffix:colon
id|memset
c_func
(paren
id|fake_hdr-&gt;h_dest
comma
l_int|0xff
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|memcpy
c_func
(paren
id|fake_hdr-&gt;h_dest
comma
id|card-&gt;dev-&gt;dev_addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
)brace
multiline_comment|/* the source MAC address */
r_if
c_cond
(paren
id|hdr-&gt;hdr.l3.ext_flags
op_amp
id|QETH_HDR_EXT_SRC_MAC_ADDR
)paren
id|memcpy
c_func
(paren
id|fake_hdr-&gt;h_source
comma
op_amp
id|hdr-&gt;hdr.l3.dest_addr
(braket
l_int|2
)braket
comma
id|ETH_ALEN
)paren
suffix:semicolon
r_else
id|memset
c_func
(paren
id|fake_hdr-&gt;h_source
comma
l_int|0
comma
id|ETH_ALEN
)paren
suffix:semicolon
multiline_comment|/* the protocol */
id|fake_hdr-&gt;h_proto
op_assign
id|skb-&gt;protocol
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_rebuild_skb_vlan
id|qeth_rebuild_skb_vlan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
)paren
(brace
macro_line|#ifdef CONFIG_QETH_VLAN
id|u16
op_star
id|vlan_tag
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;hdr.l3.ext_flags
op_amp
(paren
id|QETH_HDR_EXT_VLAN_FRAME
op_or
id|QETH_HDR_EXT_INCLUDE_VLAN_TAG
)paren
)paren
(brace
id|vlan_tag
op_assign
(paren
id|u16
op_star
)paren
id|skb_push
c_func
(paren
id|skb
comma
id|VLAN_HLEN
)paren
suffix:semicolon
op_star
id|vlan_tag
op_assign
(paren
id|hdr-&gt;hdr.l3.ext_flags
op_amp
id|QETH_HDR_EXT_VLAN_FRAME
)paren
ques
c_cond
id|hdr-&gt;hdr.l3.vlan_id
suffix:colon
op_star
(paren
(paren
id|u16
op_star
)paren
op_amp
id|hdr-&gt;hdr.l3.dest_addr
(braket
l_int|12
)braket
)paren
suffix:semicolon
op_star
(paren
id|vlan_tag
op_plus
l_int|1
)paren
op_assign
id|skb-&gt;protocol
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_VLAN */
)brace
r_static
r_inline
id|__u16
DECL|function|qeth_layer2_rebuild_skb
id|qeth_layer2_rebuild_skb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
)paren
(brace
r_int
r_int
id|vlan_id
op_assign
l_int|0
suffix:semicolon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.checksum_type
op_eq
id|NO_CHECKSUMMING
)paren
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
r_else
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|hdr-&gt;hdr.l2.flags
(braket
l_int|2
)braket
op_amp
(paren
id|QETH_LAYER2_FLAG_VLAN
)paren
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
id|VLAN_HLEN
)paren
suffix:semicolon
id|vlan_id
op_assign
id|hdr-&gt;hdr.l2.vlan_id
suffix:semicolon
)brace
macro_line|#endif
id|skb-&gt;protocol
op_assign
id|qeth_type_trans
c_func
(paren
id|skb
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_return
id|vlan_id
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_rebuild_skb
id|qeth_rebuild_skb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
)paren
(brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_if
c_cond
(paren
id|hdr-&gt;hdr.l3.flags
op_amp
id|QETH_HDR_PASSTHRU
)paren
(brace
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|qeth_type_trans
c_func
(paren
id|skb
comma
id|card-&gt;dev
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_IPV6 */
id|skb-&gt;protocol
op_assign
id|htons
c_func
(paren
(paren
id|hdr-&gt;hdr.l3.flags
op_amp
id|QETH_HDR_IPV6
)paren
ques
c_cond
id|ETH_P_IPV6
suffix:colon
id|ETH_P_IP
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|hdr-&gt;hdr.l3.flags
op_amp
id|QETH_HDR_CAST_MASK
)paren
(brace
r_case
id|QETH_CAST_UNICAST
suffix:colon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QETH_CAST_MULTICAST
suffix:colon
id|skb-&gt;pkt_type
op_assign
id|PACKET_MULTICAST
suffix:semicolon
id|card-&gt;stats.multicast
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QETH_CAST_BROADCAST
suffix:colon
id|skb-&gt;pkt_type
op_assign
id|PACKET_BROADCAST
suffix:semicolon
id|card-&gt;stats.multicast
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QETH_CAST_ANYCAST
suffix:colon
r_case
id|QETH_CAST_NOCAST
suffix:colon
r_default
suffix:colon
id|skb-&gt;pkt_type
op_assign
id|PACKET_HOST
suffix:semicolon
)brace
id|qeth_rebuild_skb_vlan
c_func
(paren
id|card
comma
id|skb
comma
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.fake_ll
)paren
id|qeth_rebuild_skb_fake_ll
c_func
(paren
id|card
comma
id|skb
comma
id|hdr
)paren
suffix:semicolon
r_else
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;ip_summed
op_assign
id|card-&gt;options.checksum_type
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.checksum_type
op_eq
id|HW_CHECKSUMMING
)paren
(brace
r_if
c_cond
(paren
(paren
id|hdr-&gt;hdr.l3.ext_flags
op_amp
(paren
id|QETH_HDR_EXT_CSUM_HDR_REQ
op_or
id|QETH_HDR_EXT_CSUM_TRANSP_REQ
)paren
)paren
op_eq
(paren
id|QETH_HDR_EXT_CSUM_HDR_REQ
op_or
id|QETH_HDR_EXT_CSUM_TRANSP_REQ
)paren
)paren
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
r_else
id|skb-&gt;ip_summed
op_assign
id|SW_CHECKSUMMING
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_process_inbound_buffer
id|qeth_process_inbound_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_buffer
op_star
id|buf
comma
r_int
id|index
)paren
(brace
r_struct
id|qdio_buffer_element
op_star
id|element
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|qeth_hdr
op_star
id|hdr
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
id|rxrc
suffix:semicolon
id|__u16
id|vlan_tag
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* get first element of current buffer */
id|element
op_assign
(paren
r_struct
id|qdio_buffer_element
op_star
)paren
op_amp
id|buf-&gt;buffer-&gt;element
(braket
l_int|0
)braket
suffix:semicolon
id|offset
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.bufs_rec
op_increment
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|qeth_get_next_skb
c_func
(paren
id|card
comma
id|buf-&gt;buffer
comma
op_amp
id|element
comma
op_amp
id|offset
comma
op_amp
id|hdr
)paren
)paren
)paren
(brace
id|skb-&gt;dev
op_assign
id|card-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;hdr.l2.id
op_eq
id|QETH_HEADER_TYPE_LAYER2
)paren
id|vlan_tag
op_assign
id|qeth_layer2_rebuild_skb
c_func
(paren
id|card
comma
id|skb
comma
id|hdr
)paren
suffix:semicolon
r_else
id|qeth_rebuild_skb
c_func
(paren
id|card
comma
id|skb
comma
id|hdr
)paren
suffix:semicolon
multiline_comment|/* is device UP ? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;dev-&gt;flags
op_amp
id|IFF_UP
)paren
)paren
(brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|vlan_tag
)paren
id|vlan_hwaccel_rx
c_func
(paren
id|skb
comma
id|card-&gt;vlangrp
comma
id|vlan_tag
)paren
suffix:semicolon
r_else
macro_line|#endif
id|rxrc
op_assign
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|card-&gt;dev-&gt;last_rx
op_assign
id|jiffies
suffix:semicolon
id|card-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|card-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
)brace
r_static
r_inline
r_struct
id|qeth_buffer_pool_entry
op_star
DECL|function|qeth_get_buffer_pool_entry
id|qeth_get_buffer_pool_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|entry
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;gtbfplen&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|card-&gt;qdio.in_buf_pool.entry_list
)paren
)paren
(brace
id|entry
op_assign
id|list_entry
c_func
(paren
id|card-&gt;qdio.in_buf_pool.entry_list.next
comma
r_struct
id|qeth_buffer_pool_entry
comma
id|list
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|entry-&gt;list
)paren
suffix:semicolon
r_return
id|entry
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_init_input_buffer
id|qeth_init_input_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_buffer
op_star
id|buf
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|pool_entry
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pool_entry
op_assign
id|qeth_get_buffer_pool_entry
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * since the buffer is accessed only from the input_tasklet&n;&t; * there shouldn&squot;t be a need to synchronize; also, since we use&n;&t; * the QETH_IN_BUF_REQUEUE_THRESHOLD we should never run  out off&n;&t; * buffers&n;&t; */
id|BUG_ON
c_func
(paren
op_logical_neg
id|pool_entry
)paren
suffix:semicolon
id|buf-&gt;pool_entry
op_assign
id|pool_entry
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|length
op_assign
id|PAGE_SIZE
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|addr
op_assign
id|pool_entry-&gt;elements
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
op_minus
l_int|1
)paren
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|flags
op_assign
id|SBAL_FLAGS_LAST_ENTRY
suffix:semicolon
r_else
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
id|buf-&gt;state
op_assign
id|QETH_QDIO_BUF_EMPTY
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_clear_output_buffer
id|qeth_clear_output_buffer
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* is PCI flag set on buffer? */
r_if
c_cond
(paren
id|buf-&gt;buffer-&gt;element
(braket
l_int|0
)braket
dot
id|flags
op_amp
l_int|0x40
)paren
id|atomic_dec
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|queue-&gt;card
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|length
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|addr
op_assign
l_int|NULL
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
id|i
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|buf-&gt;skb_list
)paren
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
id|buf-&gt;next_element_to_fill
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_EMPTY
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_queue_input_buffer
id|qeth_queue_input_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|index
)paren
(brace
r_struct
id|qeth_qdio_q
op_star
id|queue
op_assign
id|card-&gt;qdio.in_q
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;queinbuf&quot;
)paren
suffix:semicolon
id|count
op_assign
(paren
id|index
OL
id|queue-&gt;next_buf_to_init
)paren
ques
c_cond
id|card-&gt;qdio.in_buf_pool.buf_count
op_minus
(paren
id|queue-&gt;next_buf_to_init
op_minus
id|index
)paren
suffix:colon
id|card-&gt;qdio.in_buf_pool.buf_count
op_minus
(paren
id|queue-&gt;next_buf_to_init
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
id|index
)paren
suffix:semicolon
multiline_comment|/* only requeue at a certain threshold to avoid SIGAs */
r_if
c_cond
(paren
id|count
op_ge
id|QETH_IN_BUF_REQUEUE_THRESHOLD
c_func
(paren
id|card
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|queue-&gt;next_buf_to_init
suffix:semicolon
id|i
OL
id|queue-&gt;next_buf_to_init
op_plus
id|count
suffix:semicolon
op_increment
id|i
)paren
id|qeth_init_input_buffer
c_func
(paren
id|card
comma
op_amp
id|queue-&gt;bufs
(braket
id|i
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * according to old code it should be avoided to requeue all&n;&t;&t; * 128 buffers in order to benefit from PCI avoidance.&n;&t;&t; * this function keeps at least one buffer (the buffer at&n;&t;&t; * &squot;index&squot;) un-requeued -&gt; this buffer is the first buffer that&n;&t;&t; * will be requeued the next time&n;&t;&t; */
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.inbound_do_qdio_cnt
op_increment
suffix:semicolon
id|card-&gt;perf_stats.inbound_do_qdio_start_time
op_assign
id|qeth_get_micros
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
id|do_QDIO
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
id|QDIO_FLAG_SYNC_INPUT
op_or
id|QDIO_FLAG_UNDER_INTERRUPT
comma
l_int|0
comma
id|queue-&gt;next_buf_to_init
comma
id|count
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.inbound_do_qdio_time
op_add_assign
id|qeth_get_micros
c_func
(paren
)paren
op_minus
id|card-&gt;perf_stats.inbound_do_qdio_start_time
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;qeth_queue_input_buffer&squot;s do_QDIO &quot;
l_string|&quot;return %i (device %s).&bslash;n&quot;
comma
id|rc
comma
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;qinberr&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
)brace
id|queue-&gt;next_buf_to_init
op_assign
(paren
id|queue-&gt;next_buf_to_init
op_plus
id|count
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_put_buffer_pool_entry
id|qeth_put_buffer_pool_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_buffer_pool_entry
op_star
id|entry
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;ptbfplen&quot;
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|entry-&gt;list
comma
op_amp
id|card-&gt;qdio.in_buf_pool.entry_list
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_qdio_input_handler
id|qeth_qdio_input_handler
c_func
(paren
r_struct
id|ccw_device
op_star
id|ccwdev
comma
r_int
r_int
id|status
comma
r_int
r_int
id|qdio_err
comma
r_int
r_int
id|siga_err
comma
r_int
r_int
id|queue
comma
r_int
id|first_element
comma
r_int
id|count
comma
r_int
r_int
id|card_ptr
)paren
(brace
r_struct
id|net_device
op_star
id|net_dev
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_struct
id|qeth_qdio_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|index
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;qdinput&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|card_ptr
suffix:semicolon
id|net_dev
op_assign
id|card-&gt;dev
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.inbound_cnt
op_increment
suffix:semicolon
id|card-&gt;perf_stats.inbound_start_time
op_assign
id|qeth_get_micros
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|status
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|QDIO_STATUS_ACTIVATE_CHECK_CONDITION
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;qdinchk&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%04X%04X&quot;
comma
id|first_element
comma
id|count
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%04X%04X&quot;
comma
id|queue
comma
id|status
)paren
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
id|first_element
suffix:semicolon
id|i
OL
(paren
id|first_element
op_plus
id|count
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|index
op_assign
id|i
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|buffer
op_assign
op_amp
id|card-&gt;qdio.in_q-&gt;bufs
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|status
op_eq
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
op_logical_and
id|qeth_check_for_inbound_error
c_func
(paren
id|buffer
comma
id|qdio_err
comma
id|siga_err
)paren
)paren
)paren
id|qeth_process_inbound_buffer
c_func
(paren
id|card
comma
id|buffer
comma
id|index
)paren
suffix:semicolon
multiline_comment|/* clear buffer and give back to hardware */
id|qeth_put_buffer_pool_entry
c_func
(paren
id|card
comma
id|buffer-&gt;pool_entry
)paren
suffix:semicolon
id|qeth_queue_input_buffer
c_func
(paren
id|card
comma
id|index
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.inbound_time
op_add_assign
id|qeth_get_micros
c_func
(paren
)paren
op_minus
id|card-&gt;perf_stats.inbound_start_time
suffix:semicolon
macro_line|#endif
)brace
r_static
r_inline
r_int
DECL|function|qeth_handle_send_error
id|qeth_handle_send_error
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
comma
r_int
id|qdio_err
comma
r_int
id|siga_err
)paren
(brace
r_int
id|sbalf15
op_assign
id|buffer-&gt;buffer-&gt;element
(braket
l_int|15
)braket
dot
id|flags
op_amp
l_int|0xff
suffix:semicolon
r_int
id|cc
op_assign
id|siga_err
op_amp
l_int|3
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;hdsnderr&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cc
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|qdio_err
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;lnkfail&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%04x %02x&quot;
comma
(paren
id|u16
)paren
id|qdio_err
comma
(paren
id|u8
)paren
id|sbalf15
)paren
suffix:semicolon
r_return
id|QETH_SEND_ERROR_LINK_FAILURE
suffix:semicolon
)brace
r_return
id|QETH_SEND_ERROR_NONE
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|siga_err
op_amp
id|QDIO_SIGA_ERROR_B_BIT_SET
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;SIGAcc2B&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
id|QETH_SEND_ERROR_KICK_IT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sbalf15
op_ge
l_int|15
)paren
op_logical_and
(paren
id|sbalf15
op_le
l_int|31
)paren
)paren
r_return
id|QETH_SEND_ERROR_RETRY
suffix:semicolon
r_return
id|QETH_SEND_ERROR_LINK_FAILURE
suffix:semicolon
multiline_comment|/* look at qdio_error and sbalf 15 */
r_case
l_int|1
suffix:colon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;SIGAcc1&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
id|QETH_SEND_ERROR_LINK_FAILURE
suffix:semicolon
r_case
l_int|3
suffix:colon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;SIGAcc3&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
id|QETH_SEND_ERROR_KICK_IT
suffix:semicolon
)brace
r_return
id|QETH_SEND_ERROR_LINK_FAILURE
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_flush_buffers
id|qeth_flush_buffers
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_int
id|under_int
comma
r_int
id|index
comma
r_int
id|count
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;flushbuf&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|index
suffix:semicolon
id|i
OL
id|index
op_plus
id|count
suffix:semicolon
op_increment
id|i
)paren
(brace
id|buf
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|i
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
)braket
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
id|buf-&gt;next_element_to_fill
op_minus
l_int|1
)braket
dot
id|flags
op_or_assign
id|SBAL_FLAGS_LAST_ENTRY
suffix:semicolon
r_if
c_cond
(paren
id|queue-&gt;card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|queue-&gt;do_pack
)paren
(brace
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;used_buffers
)paren
op_ge
(paren
id|QETH_HIGH_WATERMARK_PACK
op_minus
id|QETH_WATERMARK_PACK_FUZZ
)paren
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
)paren
(brace
multiline_comment|/* it&squot;s likely that we&squot;ll go to packing&n;&t;&t;&t;&t; * mode soon */
id|atomic_inc
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
l_int|0
)braket
dot
id|flags
op_or_assign
l_int|0x40
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * there&squot;s no outstanding PCI any more, so we&n;&t;&t;&t;&t; * have to request a PCI to be sure the the PCI&n;&t;&t;&t;&t; * will wake at some time in the future then we&n;&t;&t;&t;&t; * can flush packed buffers that might still be&n;&t;&t;&t;&t; * hanging around, which can happen if no&n;&t;&t;&t;&t; * further send was requested by the stack&n;&t;&t;&t;&t; */
id|atomic_inc
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
suffix:semicolon
id|buf-&gt;buffer-&gt;element
(braket
l_int|0
)braket
dot
id|flags
op_or_assign
l_int|0x40
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.bufs_sent_pack
op_increment
suffix:semicolon
macro_line|#endif
)brace
)brace
id|queue-&gt;card-&gt;dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.outbound_do_qdio_cnt
op_increment
suffix:semicolon
id|queue-&gt;card-&gt;perf_stats.outbound_do_qdio_start_time
op_assign
id|qeth_get_micros
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|under_int
)paren
id|rc
op_assign
id|do_QDIO
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|queue-&gt;card
)paren
comma
id|QDIO_FLAG_SYNC_OUTPUT
op_or
id|QDIO_FLAG_UNDER_INTERRUPT
comma
id|queue-&gt;queue_no
comma
id|index
comma
id|count
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|rc
op_assign
id|do_QDIO
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|queue-&gt;card
)paren
comma
id|QDIO_FLAG_SYNC_OUTPUT
comma
id|queue-&gt;queue_no
comma
id|index
comma
id|count
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.outbound_do_qdio_time
op_add_assign
id|qeth_get_micros
c_func
(paren
)paren
op_minus
id|queue-&gt;card-&gt;perf_stats.outbound_do_qdio_start_time
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_SPRINTF
c_func
(paren
id|trace
comma
l_int|0
comma
l_string|&quot;qeth_flush_buffers: do_QDIO &quot;
l_string|&quot;returned error (%i) on device %s.&quot;
comma
id|rc
comma
id|CARD_DDEV_ID
c_func
(paren
id|queue-&gt;card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;flushbuf&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot; err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|queue-&gt;card-&gt;stats.tx_errors
op_add_assign
id|count
suffix:semicolon
multiline_comment|/* this must not happen under normal circumstances. if it&n;&t;&t; * happens something is really wrong -&gt; recover */
id|qeth_schedule_recovery
c_func
(paren
id|queue-&gt;card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|atomic_add
c_func
(paren
id|count
comma
op_amp
id|queue-&gt;used_buffers
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.bufs_sent
op_add_assign
id|count
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * Switched to packing state if the number of used buffers on a queue&n; * reaches a certain limit.&n; */
r_static
r_inline
r_void
DECL|function|qeth_switch_to_packing_if_needed
id|qeth_switch_to_packing_if_needed
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|queue-&gt;do_pack
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;used_buffers
)paren
op_ge
id|QETH_HIGH_WATERMARK_PACK
)paren
(brace
multiline_comment|/* switch non-PACKING -&gt; PACKING */
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;np-&gt;pack&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.sc_dp_p
op_increment
suffix:semicolon
macro_line|#endif
id|queue-&gt;do_pack
op_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * Switches from packing to non-packing mode. If there is a packing&n; * buffer on the queue this buffer will be prepared to be flushed.&n; * In that case 1 is returned to inform the caller. If no buffer&n; * has to be flushed, zero is returned.&n; */
r_static
r_inline
r_int
DECL|function|qeth_switch_to_nonpacking_if_needed
id|qeth_switch_to_nonpacking_if_needed
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|flush_count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|queue-&gt;do_pack
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;used_buffers
)paren
op_le
id|QETH_LOW_WATERMARK_PACK
)paren
(brace
multiline_comment|/* switch PACKING -&gt; non-PACKING */
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;pack-&gt;np&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.sc_p_dp
op_increment
suffix:semicolon
macro_line|#endif
id|queue-&gt;do_pack
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* flush packing buffers */
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|queue-&gt;next_buf_to_fill
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_eq
id|QETH_QDIO_BUF_EMPTY
)paren
op_logical_and
(paren
id|buffer-&gt;next_element_to_fill
OG
l_int|0
)paren
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|buffer-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|flush_count
op_increment
suffix:semicolon
id|queue-&gt;next_buf_to_fill
op_assign
(paren
id|queue-&gt;next_buf_to_fill
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
)brace
)brace
)brace
r_return
id|flush_count
suffix:semicolon
)brace
multiline_comment|/*&n; * Called to flush a packing buffer if no more pci flags are on the queue.&n; * Checks if there is a packing buffer and prepares it to be flushed.&n; * In that case returns 1, otherwise zero.&n; */
r_static
r_inline
r_int
DECL|function|qeth_flush_buffers_on_no_pci
id|qeth_flush_buffers_on_no_pci
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
suffix:semicolon
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|queue-&gt;next_buf_to_fill
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_eq
id|QETH_QDIO_BUF_EMPTY
)paren
op_logical_and
(paren
id|buffer-&gt;next_element_to_fill
OG
l_int|0
)paren
)paren
(brace
multiline_comment|/* it&squot;s a packing buffer */
id|atomic_set
c_func
(paren
op_amp
id|buffer-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|queue-&gt;next_buf_to_fill
op_assign
(paren
id|queue-&gt;next_buf_to_fill
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_check_outbound_queue
id|qeth_check_outbound_queue
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
)paren
(brace
r_int
id|index
suffix:semicolon
r_int
id|flush_cnt
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * check if weed have to switch to non-packing mode or if&n;&t; * we have to get a pci flag out on the queue&n;&t; */
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;used_buffers
)paren
op_le
id|QETH_LOW_WATERMARK_PACK
)paren
op_logical_or
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
)paren
(brace
r_if
c_cond
(paren
id|atomic_swap
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_LOCKED_FLUSH
)paren
op_eq
id|QETH_OUT_Q_UNLOCKED
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * If we get in here, there was no action in&n;&t;&t;&t; * do_send_packet. So, we check if there is a&n;&t;&t;&t; * packing buffer to be flushed here.&n;&t;&t;&t; */
multiline_comment|/* TODO: try if we get a performance improvement&n;&t;&t;&t; * by calling netif_stop_queue here */
multiline_comment|/* save start index for flushing */
id|index
op_assign
id|queue-&gt;next_buf_to_fill
suffix:semicolon
id|flush_cnt
op_add_assign
id|qeth_switch_to_nonpacking_if_needed
c_func
(paren
id|queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|flush_cnt
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
)paren
id|flush_cnt
op_add_assign
id|qeth_flush_buffers_on_no_pci
c_func
(paren
id|queue
)paren
suffix:semicolon
multiline_comment|/* were done with updating critical queue members */
id|atomic_set
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
multiline_comment|/* flushing can be done outside the lock */
r_if
c_cond
(paren
id|flush_cnt
)paren
id|qeth_flush_buffers
c_func
(paren
id|queue
comma
l_int|1
comma
id|index
comma
id|flush_cnt
)paren
suffix:semicolon
)brace
)brace
)brace
r_static
r_void
DECL|function|qeth_qdio_output_handler
id|qeth_qdio_output_handler
c_func
(paren
r_struct
id|ccw_device
op_star
id|ccwdev
comma
r_int
r_int
id|status
comma
r_int
r_int
id|qdio_error
comma
r_int
r_int
id|siga_error
comma
r_int
r_int
id|__queue
comma
r_int
id|first_element
comma
r_int
id|count
comma
r_int
r_int
id|card_ptr
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|card_ptr
suffix:semicolon
r_struct
id|qeth_qdio_out_q
op_star
id|queue
op_assign
id|card-&gt;qdio.out_qs
(braket
id|__queue
)braket
suffix:semicolon
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;qdouhdl&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|QDIO_STATUS_ACTIVATE_CHECK_CONDITION
)paren
(brace
id|QETH_DBF_SPRINTF
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;On device %s: &quot;
l_string|&quot;received active check &quot;
l_string|&quot;condition (0x%08x).&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|status
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;chkcond&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;%08x&quot;
comma
id|status
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.outbound_handler_cnt
op_increment
suffix:semicolon
id|card-&gt;perf_stats.outbound_handler_start_time
op_assign
id|qeth_get_micros
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
id|first_element
suffix:semicolon
id|i
OL
(paren
id|first_element
op_plus
id|count
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|i
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
)braket
suffix:semicolon
multiline_comment|/*we only handle the KICK_IT error by doing a recovery */
r_if
c_cond
(paren
id|qeth_handle_send_error
c_func
(paren
id|card
comma
id|buffer
comma
id|qdio_error
comma
id|siga_error
)paren
op_eq
id|QETH_SEND_ERROR_KICK_IT
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|qeth_clear_output_buffer
c_func
(paren
id|queue
comma
id|buffer
)paren
suffix:semicolon
)brace
id|atomic_sub
c_func
(paren
id|count
comma
op_amp
id|queue-&gt;used_buffers
)paren
suffix:semicolon
multiline_comment|/* check if we need to do something on this outbound queue */
r_if
c_cond
(paren
id|card-&gt;info.type
op_ne
id|QETH_CARD_TYPE_IQD
)paren
id|qeth_check_outbound_queue
c_func
(paren
id|queue
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.outbound_handler_time
op_add_assign
id|qeth_get_micros
c_func
(paren
)paren
op_minus
id|card-&gt;perf_stats.outbound_handler_start_time
suffix:semicolon
macro_line|#endif
)brace
r_static
r_char
op_star
DECL|function|qeth_create_qib_param_field
id|qeth_create_qib_param_field
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_char
op_star
id|param_field
suffix:semicolon
id|param_field
op_assign
id|kmalloc
c_func
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_char
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|param_field
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|param_field
comma
l_int|0
comma
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_char
)paren
)paren
suffix:semicolon
id|param_field
(braket
l_int|0
)braket
op_assign
id|_ascebc
(braket
l_char|&squot;P&squot;
)braket
suffix:semicolon
id|param_field
(braket
l_int|1
)braket
op_assign
id|_ascebc
(braket
l_char|&squot;C&squot;
)braket
suffix:semicolon
id|param_field
(braket
l_int|2
)braket
op_assign
id|_ascebc
(braket
l_char|&squot;I&squot;
)braket
suffix:semicolon
id|param_field
(braket
l_int|3
)braket
op_assign
id|_ascebc
(braket
l_char|&squot;T&squot;
)braket
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|param_field
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|QETH_PCI_THRESHOLD_A
c_func
(paren
id|card
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|param_field
(braket
l_int|8
)braket
)paren
)paren
op_assign
id|QETH_PCI_THRESHOLD_B
c_func
(paren
id|card
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|param_field
(braket
l_int|12
)braket
)paren
)paren
op_assign
id|QETH_PCI_TIMER_VALUE
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|param_field
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_initialize_working_pool_list
id|qeth_initialize_working_pool_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|entry
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;inwrklst&quot;
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|entry
comma
op_amp
id|card-&gt;qdio.init_pool.entry_list
comma
id|init_list
)paren
(brace
id|qeth_put_buffer_pool_entry
c_func
(paren
id|card
comma
id|entry
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|qeth_clear_working_pool_list
id|qeth_clear_working_pool_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|pool_entry
comma
op_star
id|tmp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;clwrklst&quot;
)paren
suffix:semicolon
(def_block
id|list_for_each_entry_safe
c_func
(paren
id|pool_entry
comma
id|tmp
comma
op_amp
id|card-&gt;qdio.in_buf_pool.entry_list
comma
id|list
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|pool_entry-&gt;list
)paren
suffix:semicolon
)brace
)def_block
)brace
r_static
r_void
DECL|function|qeth_free_buffer_pool
id|qeth_free_buffer_pool
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|pool_entry
comma
op_star
id|tmp
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;freepool&quot;
)paren
suffix:semicolon
(def_block
id|list_for_each_entry_safe
c_func
(paren
id|pool_entry
comma
id|tmp
comma
op_amp
id|card-&gt;qdio.init_pool.entry_list
comma
id|init_list
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
suffix:semicolon
op_increment
id|i
)paren
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pool_entry-&gt;elements
(braket
id|i
)braket
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|pool_entry-&gt;init_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pool_entry
)paren
suffix:semicolon
)brace
)def_block
)brace
r_static
r_int
DECL|function|qeth_alloc_buffer_pool
id|qeth_alloc_buffer_pool
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_buffer_pool_entry
op_star
id|pool_entry
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;clwkpool&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.init_pool.buf_count
suffix:semicolon
op_increment
id|i
)paren
(brace
id|pool_entry
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|pool_entry
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pool_entry
)paren
(brace
id|qeth_free_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
suffix:semicolon
op_increment
id|j
)paren
(brace
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
(brace
r_while
c_loop
(paren
id|j
OG
l_int|0
)paren
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|pool_entry-&gt;elements
(braket
op_decrement
id|j
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pool_entry
)paren
suffix:semicolon
id|qeth_free_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pool_entry-&gt;elements
(braket
id|j
)braket
op_assign
id|ptr
suffix:semicolon
)brace
id|list_add
c_func
(paren
op_amp
id|pool_entry-&gt;init_list
comma
op_amp
id|card-&gt;qdio.init_pool.entry_list
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|qeth_realloc_buffer_pool
id|qeth_realloc_buffer_pool
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|bufcnt
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;realcbp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_DOWN
)paren
op_logical_and
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_RECOVER
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
multiline_comment|/* TODO: steel/add buffers from/to a running card&squot;s buffer pool (?) */
id|qeth_clear_working_pool_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_free_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;qdio.in_buf_pool.buf_count
op_assign
id|bufcnt
suffix:semicolon
id|card-&gt;qdio.init_pool.buf_count
op_assign
id|bufcnt
suffix:semicolon
r_return
id|qeth_alloc_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_alloc_qdio_buffers
id|qeth_alloc_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;allcqdbf&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;qdio.state
op_eq
id|QETH_QDIO_ALLOCATED
)paren
r_return
l_int|0
suffix:semicolon
id|card-&gt;qdio.in_q
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_qdio_q
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;qdio.in_q
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;inq&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card-&gt;qdio.in_q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|card-&gt;qdio.in_q
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_qdio_q
)paren
)paren
suffix:semicolon
multiline_comment|/* give inbound qeth_qdio_buffers their qdio_buffers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|i
)paren
id|card-&gt;qdio.in_q-&gt;bufs
(braket
id|i
)braket
dot
id|buffer
op_assign
op_amp
id|card-&gt;qdio.in_q-&gt;qdio_bufs
(braket
id|i
)braket
suffix:semicolon
multiline_comment|/* inbound buffer pool */
r_if
c_cond
(paren
id|qeth_alloc_buffer_pool
c_func
(paren
id|card
)paren
)paren
(brace
id|kfree
c_func
(paren
id|card-&gt;qdio.in_q
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* outbound */
id|card-&gt;qdio.out_qs
op_assign
id|kmalloc
c_func
(paren
id|card-&gt;qdio.no_out_queues
op_star
r_sizeof
(paren
r_struct
id|qeth_qdio_out_q
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;qdio.out_qs
)paren
(brace
id|qeth_free_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
(brace
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_qdio_out_q
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
)paren
(brace
r_while
c_loop
(paren
id|i
OG
l_int|0
)paren
id|kfree
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
op_decrement
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;qdio.out_qs
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;outq %i&quot;
comma
id|i
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_qdio_out_q
)paren
)paren
suffix:semicolon
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|queue_no
op_assign
id|i
suffix:semicolon
multiline_comment|/* give inbound qeth_qdio_buffers their qdio_buffers */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
)paren
(brace
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
dot
id|buffer
op_assign
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|qdio_bufs
(braket
id|j
)braket
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
dot
id|skb_list
)paren
suffix:semicolon
)brace
)brace
id|card-&gt;qdio.state
op_assign
id|QETH_QDIO_ALLOCATED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_free_qdio_buffers
id|qeth_free_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;freeqdbf&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;qdio.state
op_eq
id|QETH_QDIO_UNINITIALIZED
)paren
r_return
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;qdio.in_q
)paren
suffix:semicolon
multiline_comment|/* inbound buffer pool */
id|qeth_free_buffer_pool
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* free outbound qdio_qs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
)paren
id|qeth_clear_output_buffer
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
comma
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|card-&gt;qdio.out_qs
)paren
suffix:semicolon
id|card-&gt;qdio.state
op_assign
id|QETH_QDIO_UNINITIALIZED
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_clear_qdio_buffers
id|qeth_clear_qdio_buffers
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;clearqdbf&quot;
)paren
suffix:semicolon
multiline_comment|/* clear outbound buffers to free skbs */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
)paren
id|qeth_clear_output_buffer
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
comma
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|qeth_init_qdio_info
id|qeth_init_qdio_info
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|4
comma
l_string|&quot;intqdinf&quot;
)paren
suffix:semicolon
id|card-&gt;qdio.state
op_assign
id|QETH_QDIO_UNINITIALIZED
suffix:semicolon
multiline_comment|/* inbound */
id|card-&gt;qdio.in_buf_size
op_assign
id|QETH_IN_BUF_SIZE_DEFAULT
suffix:semicolon
id|card-&gt;qdio.init_pool.buf_count
op_assign
id|QETH_IN_BUF_COUNT_DEFAULT
suffix:semicolon
id|card-&gt;qdio.in_buf_pool.buf_count
op_assign
id|card-&gt;qdio.init_pool.buf_count
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;qdio.in_buf_pool.entry_list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;qdio.init_pool.entry_list
)paren
suffix:semicolon
multiline_comment|/* outbound */
id|card-&gt;qdio.do_prio_queueing
op_assign
id|QETH_PRIOQ_DEFAULT
suffix:semicolon
id|card-&gt;qdio.default_out_queue
op_assign
id|QETH_DEFAULT_QUEUE
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_init_qdio_queues
id|qeth_init_qdio_queues
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;initqdqs&quot;
)paren
suffix:semicolon
multiline_comment|/* inbound queue */
id|memset
c_func
(paren
id|card-&gt;qdio.in_q-&gt;qdio_bufs
comma
l_int|0
comma
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_struct
id|qdio_buffer
)paren
)paren
suffix:semicolon
id|qeth_initialize_working_pool_list
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/*give only as many buffers to hardware as we have buffer pool entries*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.in_buf_pool.buf_count
op_minus
l_int|1
suffix:semicolon
op_increment
id|i
)paren
id|qeth_init_input_buffer
c_func
(paren
id|card
comma
op_amp
id|card-&gt;qdio.in_q-&gt;bufs
(braket
id|i
)braket
)paren
suffix:semicolon
id|card-&gt;qdio.in_q-&gt;next_buf_to_init
op_assign
id|card-&gt;qdio.in_buf_pool.buf_count
op_minus
l_int|1
suffix:semicolon
id|rc
op_assign
id|do_QDIO
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
id|QDIO_FLAG_SYNC_INPUT
comma
l_int|0
comma
l_int|0
comma
id|card-&gt;qdio.in_buf_pool.buf_count
op_minus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|qdio_synchronize
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
id|QDIO_FLAG_SYNC_INPUT
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* outbound queue */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
(brace
id|memset
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|qdio_bufs
comma
l_int|0
comma
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_struct
id|qdio_buffer
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
)paren
(brace
id|qeth_clear_output_buffer
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
comma
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
)paren
suffix:semicolon
)brace
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|card
op_assign
id|card
suffix:semicolon
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|next_buf_to_fill
op_assign
l_int|0
suffix:semicolon
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|do_pack
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|used_buffers
comma
l_int|0
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|set_pci_flags_count
comma
l_int|0
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_qdio_establish
id|qeth_qdio_establish
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qdio_initialize
id|init_data
suffix:semicolon
r_char
op_star
id|qib_param_field
suffix:semicolon
r_struct
id|qdio_buffer
op_star
op_star
id|in_sbal_ptrs
suffix:semicolon
r_struct
id|qdio_buffer
op_star
op_star
id|out_sbal_ptrs
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;qdioest&quot;
)paren
suffix:semicolon
id|qib_param_field
op_assign
id|qeth_create_qib_param_field
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qib_param_field
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|in_sbal_ptrs
op_assign
id|kmalloc
c_func
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_void
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_sbal_ptrs
)paren
(brace
id|kfree
c_func
(paren
id|qib_param_field
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|i
)paren
(brace
id|in_sbal_ptrs
(braket
id|i
)braket
op_assign
(paren
r_struct
id|qdio_buffer
op_star
)paren
id|virt_to_phys
c_func
(paren
id|card-&gt;qdio.in_q-&gt;bufs
(braket
id|i
)braket
dot
id|buffer
)paren
suffix:semicolon
)brace
id|out_sbal_ptrs
op_assign
id|kmalloc
c_func
(paren
id|card-&gt;qdio.no_out_queues
op_star
id|QDIO_MAX_BUFFERS_PER_Q
op_star
r_sizeof
(paren
r_void
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|out_sbal_ptrs
)paren
(brace
id|kfree
c_func
(paren
id|in_sbal_ptrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|qib_param_field
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|k
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
comma
op_increment
id|k
)paren
(brace
id|out_sbal_ptrs
(braket
id|k
)braket
op_assign
(paren
r_struct
id|qdio_buffer
op_star
)paren
id|virt_to_phys
c_func
(paren
id|card-&gt;qdio.out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
dot
id|buffer
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|init_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qdio_initialize
)paren
)paren
suffix:semicolon
id|init_data.cdev
op_assign
id|CARD_DDEV
c_func
(paren
id|card
)paren
suffix:semicolon
id|init_data.q_format
op_assign
id|qeth_get_qdio_q_format
c_func
(paren
id|card
)paren
suffix:semicolon
id|init_data.qib_param_field_format
op_assign
l_int|0
suffix:semicolon
id|init_data.qib_param_field
op_assign
id|qib_param_field
suffix:semicolon
id|init_data.min_input_threshold
op_assign
id|QETH_MIN_INPUT_THRESHOLD
suffix:semicolon
id|init_data.max_input_threshold
op_assign
id|QETH_MAX_INPUT_THRESHOLD
suffix:semicolon
id|init_data.min_output_threshold
op_assign
id|QETH_MIN_OUTPUT_THRESHOLD
suffix:semicolon
id|init_data.max_output_threshold
op_assign
id|QETH_MAX_OUTPUT_THRESHOLD
suffix:semicolon
id|init_data.no_input_qs
op_assign
l_int|1
suffix:semicolon
id|init_data.no_output_qs
op_assign
id|card-&gt;qdio.no_out_queues
suffix:semicolon
id|init_data.input_handler
op_assign
(paren
id|qdio_handler_t
op_star
)paren
id|qeth_qdio_input_handler
suffix:semicolon
id|init_data.output_handler
op_assign
(paren
id|qdio_handler_t
op_star
)paren
id|qeth_qdio_output_handler
suffix:semicolon
id|init_data.int_parm
op_assign
(paren
r_int
r_int
)paren
id|card
suffix:semicolon
id|init_data.flags
op_assign
id|QDIO_INBOUND_0COPY_SBALS
op_or
id|QDIO_OUTBOUND_0COPY_SBALS
op_or
id|QDIO_USE_OUTBOUND_PCIS
suffix:semicolon
id|init_data.input_sbal_addr_array
op_assign
(paren
r_void
op_star
op_star
)paren
id|in_sbal_ptrs
suffix:semicolon
id|init_data.output_sbal_addr_array
op_assign
(paren
r_void
op_star
op_star
)paren
id|out_sbal_ptrs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|qdio_initialize
c_func
(paren
op_amp
id|init_data
)paren
)paren
)paren
id|card-&gt;qdio.state
op_assign
id|QETH_QDIO_ESTABLISHED
suffix:semicolon
id|kfree
c_func
(paren
id|out_sbal_ptrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|in_sbal_ptrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|qib_param_field
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_qdio_activate
id|qeth_qdio_activate
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|3
comma
l_string|&quot;qdioact&quot;
)paren
suffix:semicolon
r_return
id|qdio_activate
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_clear_channel
id|qeth_clear_channel
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;clearch&quot;
)paren
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_clear
c_func
(paren
id|channel-&gt;ccwdev
comma
id|QETH_CLEAR_CHANNEL_PARM
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|card-&gt;wait_q
comma
id|channel-&gt;state
op_eq
id|CH_STATE_STOPPED
comma
id|QETH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_ne
id|CH_STATE_STOPPED
)paren
r_return
op_minus
id|ETIME
suffix:semicolon
id|channel-&gt;state
op_assign
id|CH_STATE_DOWN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_halt_channel
id|qeth_halt_channel
c_func
(paren
r_struct
id|qeth_channel
op_star
id|channel
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;haltch&quot;
)paren
suffix:semicolon
id|card
op_assign
id|CARD_FROM_CDEV
c_func
(paren
id|channel-&gt;ccwdev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
id|ccw_device_halt
c_func
(paren
id|channel-&gt;ccwdev
comma
id|QETH_HALT_CHANNEL_PARM
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|channel-&gt;ccwdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|wait_event_interruptible_timeout
c_func
(paren
id|card-&gt;wait_q
comma
id|channel-&gt;state
op_eq
id|CH_STATE_HALTED
comma
id|QETH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|channel-&gt;state
op_ne
id|CH_STATE_HALTED
)paren
r_return
op_minus
id|ETIME
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_halt_channels
id|qeth_halt_channels
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;haltchs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_halt_channel
c_func
(paren
op_amp
id|card-&gt;read
)paren
)paren
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_halt_channel
c_func
(paren
op_amp
id|card-&gt;write
)paren
)paren
)paren
r_return
id|rc
suffix:semicolon
r_return
id|qeth_halt_channel
c_func
(paren
op_amp
id|card-&gt;data
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_clear_channels
id|qeth_clear_channels
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;clearchs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_clear_channel
c_func
(paren
op_amp
id|card-&gt;read
)paren
)paren
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_clear_channel
c_func
(paren
op_amp
id|card-&gt;write
)paren
)paren
)paren
r_return
id|rc
suffix:semicolon
r_return
id|qeth_clear_channel
c_func
(paren
op_amp
id|card-&gt;data
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_clear_halt_card
id|qeth_clear_halt_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|halt
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;clhacrd&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|halt
)paren
id|rc
op_assign
id|qeth_halt_channels
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
id|qeth_clear_channels
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_qdio_clear_card
id|qeth_qdio_clear_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|use_halt
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;qdioclr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;qdio.state
op_eq
id|QETH_QDIO_ESTABLISHED
)paren
(brace
id|qdio_cleanup
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
comma
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
ques
c_cond
id|QDIO_FLAG_CLEANUP_USING_HALT
suffix:colon
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
id|card-&gt;qdio.state
op_assign
id|QETH_QDIO_ALLOCATED
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_clear_halt_card
c_func
(paren
id|card
comma
id|use_halt
)paren
suffix:semicolon
id|card-&gt;state
op_assign
id|CARD_STATE_DOWN
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_dm_act
id|qeth_dm_act
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;dmact&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|DM_ACT
comma
id|DM_ACT_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_DM_ACT_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.cm_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_DM_ACT_CONNECTION_TOKEN
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|DM_ACT_SIZE
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_mpc_initialize
id|qeth_mpc_initialize
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;mpcinit&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_issue_next_read
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_cm_enable
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_cm_setup
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_ulp_enable
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;4err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_ulp_setup
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;5err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_alloc_qdio_buffers
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;5err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_qdio_establish
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;6err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|qeth_free_qdio_buffers
c_func
(paren
id|card
)paren
suffix:semicolon
r_goto
id|out_qdio
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_qdio_activate
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;7err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_qdio
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_dm_act
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;8err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_qdio
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|out_qdio
suffix:colon
id|qeth_qdio_clear_card
c_func
(paren
id|card
comma
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_struct
id|net_device
op_star
DECL|function|qeth_get_netdevice
id|qeth_get_netdevice
c_func
(paren
r_enum
id|qeth_card_types
id|type
comma
r_enum
id|qeth_link_types
id|linktype
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|QETH_CARD_TYPE_OSAE
suffix:colon
r_switch
c_cond
(paren
id|linktype
)paren
(brace
r_case
id|QETH_LINK_TYPE_LANE_TR
suffix:colon
r_case
id|QETH_LINK_TYPE_HSTR
suffix:colon
macro_line|#ifdef CONFIG_TR
id|dev
op_assign
id|alloc_trdev
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_TR */
r_break
suffix:semicolon
r_default
suffix:colon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|QETH_CARD_TYPE_IQD
suffix:colon
id|dev
op_assign
id|alloc_netdev
c_func
(paren
l_int|0
comma
l_string|&quot;hsi%d&quot;
comma
id|ether_setup
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|dev
suffix:semicolon
)brace
r_static
r_inline
r_int
id|qeth_send_packet
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_int
DECL|function|qeth_hard_start_xmit
id|qeth_hard_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;hrdstxmi&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|card-&gt;stats.tx_errors
op_increment
suffix:semicolon
multiline_comment|/* return OK; otherwise ksoftirqd goes to 100% */
r_return
id|NETDEV_TX_OK
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_UP
)paren
op_logical_or
op_logical_neg
id|card-&gt;lan_online
)paren
(brace
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|card-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|card-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* return OK; otherwise ksoftirqd goes to 100% */
r_return
id|NETDEV_TX_OK
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.outbound_cnt
op_increment
suffix:semicolon
id|card-&gt;perf_stats.outbound_start_time
op_assign
id|qeth_get_micros
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * We only call netif_stop_queue in case of errors. Since we&squot;ve&n;&t; * got our own synchronization on queues we can keep the stack&squot;s&n;&t; * queue running.&n;&t; */
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_send_packet
c_func
(paren
id|card
comma
id|skb
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|EBUSY
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rc
op_assign
id|NETDEV_TX_BUSY
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
multiline_comment|/* set to OK; otherwise ksoftirqd goes to 100% */
id|rc
op_assign
id|NETDEV_TX_OK
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|card-&gt;perf_stats.outbound_time
op_add_assign
id|qeth_get_micros
c_func
(paren
)paren
op_minus
id|card-&gt;perf_stats.outbound_start_time
suffix:semicolon
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_verify_vlan_dev
id|qeth_verify_vlan_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_struct
id|vlan_group
op_star
id|vg
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vg
op_assign
id|card-&gt;vlangrp
)paren
)paren
r_return
id|rc
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VLAN_GROUP_ARRAY_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
op_eq
id|dev
)paren
(brace
id|rc
op_assign
id|QETH_VLAN_CARD
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_verify_dev
id|qeth_verify_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|read_lock_irqsave
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
(def_block
id|list_for_each_entry
c_func
(paren
id|card
comma
op_amp
id|qeth_card_list.list
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;dev
op_eq
id|dev
)paren
(brace
id|rc
op_assign
id|QETH_REAL_CARD
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_verify_vlan_dev
c_func
(paren
id|dev
comma
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_break
suffix:semicolon
)brace
)def_block
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_struct
id|qeth_card
op_star
DECL|function|qeth_get_card_from_dev
id|qeth_get_card_from_dev
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
l_int|NULL
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|qeth_verify_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
id|QETH_REAL_CARD
)paren
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rc
op_eq
id|QETH_VLAN_CARD
)paren
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|VLAN_DEV_INFO
c_func
(paren
id|dev
)paren
op_member_access_from_pointer
id|real_dev-&gt;priv
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|card
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_tx_timeout
id|qeth_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|card-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|qeth_schedule_recovery
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_open
id|qeth_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;qethopen&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_SOFTSETUP
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;options.layer2
)paren
op_logical_and
(paren
op_logical_neg
id|card-&gt;info.layer2_mac_registered
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;nomacadr&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|card-&gt;dev-&gt;flags
op_or_assign
id|IFF_UP
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|card-&gt;data.state
op_assign
id|CH_STATE_UP
suffix:semicolon
id|card-&gt;state
op_assign
id|CARD_STATE_UP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;lan_online
)paren
(brace
r_if
c_cond
(paren
id|netif_carrier_ok
c_func
(paren
id|dev
)paren
)paren
id|netif_carrier_off
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_stop
id|qeth_stop
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;qethstop&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|card-&gt;dev-&gt;flags
op_and_assign
op_complement
id|IFF_UP
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_UP
)paren
id|card-&gt;state
op_assign
id|CARD_STATE_SOFTSETUP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_get_cast_type
id|qeth_get_cast_type
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|cast_type
op_assign
id|RTN_UNSPEC
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;dst
op_logical_and
id|skb-&gt;dst-&gt;neighbour
)paren
(brace
id|cast_type
op_assign
id|skb-&gt;dst-&gt;neighbour-&gt;type
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cast_type
op_eq
id|RTN_BROADCAST
)paren
op_logical_or
(paren
id|cast_type
op_eq
id|RTN_MULTICAST
)paren
op_logical_or
(paren
id|cast_type
op_eq
id|RTN_ANYCAST
)paren
)paren
r_return
id|cast_type
suffix:semicolon
r_else
r_return
id|RTN_UNSPEC
suffix:semicolon
)brace
multiline_comment|/* try something else */
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ETH_P_IPV6
)paren
r_return
(paren
id|skb-&gt;nh.raw
(braket
l_int|24
)braket
op_eq
l_int|0xff
)paren
ques
c_cond
id|RTN_MULTICAST
suffix:colon
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
r_return
(paren
(paren
id|skb-&gt;nh.raw
(braket
l_int|16
)braket
op_amp
l_int|0xf0
)paren
op_eq
l_int|0xe0
)paren
ques
c_cond
id|RTN_MULTICAST
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* ... */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|skb-&gt;data
comma
id|skb-&gt;dev-&gt;broadcast
comma
l_int|6
)paren
)paren
r_return
id|RTN_BROADCAST
suffix:semicolon
r_else
(brace
id|u16
id|hdr_mac
suffix:semicolon
id|hdr_mac
op_assign
op_star
(paren
(paren
id|u16
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
multiline_comment|/* tr multicast? */
r_switch
c_cond
(paren
id|card-&gt;info.link_type
)paren
(brace
r_case
id|QETH_LINK_TYPE_HSTR
suffix:colon
r_case
id|QETH_LINK_TYPE_LANE_TR
suffix:colon
r_if
c_cond
(paren
(paren
id|hdr_mac
op_eq
id|QETH_TR_MAC_NC
)paren
op_logical_or
(paren
id|hdr_mac
op_eq
id|QETH_TR_MAC_C
)paren
)paren
r_return
id|RTN_MULTICAST
suffix:semicolon
multiline_comment|/* eth or so multicast? */
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|hdr_mac
op_eq
id|QETH_ETH_MAC_V4
)paren
op_logical_or
(paren
id|hdr_mac
op_eq
id|QETH_ETH_MAC_V6
)paren
)paren
r_return
id|RTN_MULTICAST
suffix:semicolon
)brace
)brace
r_return
id|cast_type
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_get_priority_queue
id|qeth_get_priority_queue
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|ipv
comma
r_int
id|cast_type
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ipv
op_logical_and
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
)paren
r_return
id|card-&gt;qdio.default_out_queue
suffix:semicolon
r_switch
c_cond
(paren
id|card-&gt;qdio.no_out_queues
)paren
(brace
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
id|cast_type
op_logical_and
id|card-&gt;info.is_multicast_different
)paren
r_return
id|card-&gt;info.is_multicast_different
op_amp
(paren
id|card-&gt;qdio.no_out_queues
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;qdio.do_prio_queueing
op_logical_and
(paren
id|ipv
op_eq
l_int|4
)paren
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;qdio.do_prio_queueing
op_eq
id|QETH_PRIO_Q_ING_TOS
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;tos
op_amp
id|IP_TOS_NOTIMPORTANT
)paren
r_return
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;tos
op_amp
id|IP_TOS_HIGHRELIABILITY
)paren
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;tos
op_amp
id|IP_TOS_HIGHTHROUGHPUT
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;nh.iph-&gt;tos
op_amp
id|IP_TOS_LOWDELAY
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;qdio.do_prio_queueing
op_eq
id|QETH_PRIO_Q_ING_PREC
)paren
r_return
l_int|3
op_minus
(paren
id|skb-&gt;nh.iph-&gt;tos
op_rshift
l_int|6
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|card-&gt;qdio.do_prio_queueing
op_logical_and
(paren
id|ipv
op_eq
l_int|6
)paren
)paren
(brace
multiline_comment|/* TODO: IPv6!!! */
)brace
r_return
id|card-&gt;qdio.default_out_queue
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|qeth_get_ip_version
id|qeth_get_ip_version
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_switch
c_cond
(paren
id|skb-&gt;protocol
)paren
(brace
r_case
id|ETH_P_IPV6
suffix:colon
r_return
l_int|6
suffix:semicolon
r_case
id|ETH_P_IP
suffix:colon
r_return
l_int|4
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|qeth_prepare_skb
id|qeth_prepare_skb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
op_star
id|hdr
comma
r_int
id|ipv
)paren
(brace
r_struct
id|sk_buff
op_star
id|new_skb
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
id|u16
op_star
id|tag
suffix:semicolon
macro_line|#endif
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;prepskb&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
op_star
id|skb
)paren
OL
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
(brace
id|new_skb
op_assign
id|skb_realloc_headroom
c_func
(paren
op_star
id|skb
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_skb
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;qeth_prepare_skb: could &quot;
l_string|&quot;not realloc headroom for qeth_hdr &quot;
l_string|&quot;on interface %s&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
op_star
id|skb
op_assign
id|new_skb
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|card-&gt;vlangrp
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
op_star
id|skb
)paren
op_logical_and
(paren
(paren
id|ipv
op_eq
l_int|6
)paren
op_logical_or
id|card-&gt;options.layer2
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Move the mac addresses (6 bytes src, 6 bytes dest)&n;&t;&t; * to the beginning of the new header.  We are using three&n;&t;&t; * memcpys instead of one memmove to save cycles.&n;&t;&t; */
id|skb_push
c_func
(paren
op_star
id|skb
comma
id|VLAN_HLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
comma
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|4
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|4
comma
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|8
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|8
comma
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|12
comma
l_int|4
)paren
suffix:semicolon
id|tag
op_assign
(paren
id|u16
op_star
)paren
(paren
(paren
op_star
id|skb
)paren
op_member_access_from_pointer
id|data
op_plus
l_int|12
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * first two bytes  = ETH_P_8021Q (0x8100)&n;&t;&t; * second two bytes = VLANID&n;&t;&t; */
op_star
id|tag
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
suffix:semicolon
op_star
(paren
id|tag
op_plus
l_int|1
)paren
op_assign
id|htons
c_func
(paren
id|vlan_tx_tag_get
c_func
(paren
op_star
id|skb
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
op_star
id|hdr
op_assign
(paren
r_struct
id|qeth_hdr
op_star
)paren
id|skb_push
c_func
(paren
op_star
id|skb
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * sanity check, the Linux memory allocation scheme should&n;&t; * never present us cases like this one (the 32bytes header plus&n;&t; * the first 40 bytes of the paket cross a 4k boundary)&n;&t; */
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
r_int
)paren
op_star
id|hdr
)paren
op_amp
(paren
op_complement
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
)paren
op_ne
(paren
(paren
(paren
r_int
r_int
)paren
op_star
id|hdr
op_plus
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
op_plus
id|QETH_IP_HEADER_SIZE
)paren
op_amp
(paren
op_complement
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
)paren
)paren
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;qeth_prepare_skb: misaligned &quot;
l_string|&quot;packet on interface %s. Discarded.&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
id|u8
DECL|function|qeth_get_qeth_hdr_flags4
id|qeth_get_qeth_hdr_flags4
c_func
(paren
r_int
id|cast_type
)paren
(brace
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_MULTICAST
)paren
r_return
id|QETH_CAST_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_BROADCAST
)paren
r_return
id|QETH_CAST_BROADCAST
suffix:semicolon
r_return
id|QETH_CAST_UNICAST
suffix:semicolon
)brace
r_static
r_inline
id|u8
DECL|function|qeth_get_qeth_hdr_flags6
id|qeth_get_qeth_hdr_flags6
c_func
(paren
r_int
id|cast_type
)paren
(brace
id|u8
id|ct
op_assign
id|QETH_HDR_PASSTHRU
op_or
id|QETH_HDR_IPV6
suffix:semicolon
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_MULTICAST
)paren
r_return
id|ct
op_or
id|QETH_CAST_MULTICAST
suffix:semicolon
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_ANYCAST
)paren
r_return
id|ct
op_or
id|QETH_CAST_ANYCAST
suffix:semicolon
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_BROADCAST
)paren
r_return
id|ct
op_or
id|QETH_CAST_BROADCAST
suffix:semicolon
r_return
id|ct
op_or
id|QETH_CAST_UNICAST
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_layer2_get_packet_type
id|qeth_layer2_get_packet_type
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_hdr
op_star
id|hdr
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|__u16
id|hdr_mac
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|skb-&gt;data
op_plus
id|QETH_HEADER_SIZE
comma
id|skb-&gt;dev-&gt;broadcast
comma
l_int|6
)paren
)paren
(brace
multiline_comment|/* broadcast? */
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_BROADCAST
op_lshift
l_int|8
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hdr_mac
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
id|skb-&gt;data
)paren
suffix:semicolon
multiline_comment|/* tr multicast? */
r_switch
c_cond
(paren
id|card-&gt;info.link_type
)paren
(brace
r_case
id|QETH_LINK_TYPE_HSTR
suffix:colon
r_case
id|QETH_LINK_TYPE_LANE_TR
suffix:colon
r_if
c_cond
(paren
(paren
id|hdr_mac
op_eq
id|QETH_TR_MAC_NC
)paren
op_logical_or
(paren
id|hdr_mac
op_eq
id|QETH_TR_MAC_C
)paren
)paren
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_MULTICAST
op_lshift
l_int|8
suffix:semicolon
r_else
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_UNICAST
op_lshift
l_int|8
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* eth or so multicast? */
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|hdr_mac
op_eq
id|QETH_ETH_MAC_V4
)paren
op_logical_or
(paren
id|hdr_mac
op_eq
id|QETH_ETH_MAC_V6
)paren
)paren
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_MULTICAST
op_lshift
l_int|8
suffix:semicolon
r_else
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_UNICAST
op_lshift
l_int|8
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_layer2_fill_header
id|qeth_layer2_fill_header
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_hdr
op_star
id|hdr
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|cast_type
)paren
(brace
id|memset
c_func
(paren
id|hdr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
suffix:semicolon
id|hdr-&gt;hdr.l2.id
op_assign
id|QETH_HEADER_TYPE_LAYER2
suffix:semicolon
multiline_comment|/* set byte 0 to &quot;0x02&quot; and byte 3 to casting flags */
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_MULTICAST
)paren
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_MULTICAST
op_lshift
l_int|8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cast_type
op_eq
id|RTN_BROADCAST
)paren
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_BROADCAST
op_lshift
l_int|8
suffix:semicolon
r_else
id|qeth_layer2_get_packet_type
c_func
(paren
id|card
comma
id|hdr
comma
id|skb
)paren
suffix:semicolon
id|hdr-&gt;hdr.l2.pkt_length
op_assign
id|skb-&gt;len
op_minus
id|QETH_HEADER_SIZE
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
multiline_comment|/* VSWITCH relies on the VLAN&n;&t; * information to be present in&n;&t; * the QDIO header */
r_if
c_cond
(paren
(paren
id|card-&gt;vlangrp
op_ne
l_int|NULL
)paren
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
(brace
op_star
(paren
id|__u32
op_star
)paren
id|hdr-&gt;hdr.l2.flags
op_or_assign
id|QETH_LAYER2_FLAG_VLAN
op_lshift
l_int|8
suffix:semicolon
id|hdr-&gt;hdr.l2.vlan_id
op_assign
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_static
r_inline
r_void
DECL|function|qeth_fill_header
id|qeth_fill_header
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_hdr
op_star
id|hdr
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|ipv
comma
r_int
id|cast_type
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;fillhdr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
(brace
id|qeth_layer2_fill_header
c_func
(paren
id|card
comma
id|hdr
comma
id|skb
comma
id|cast_type
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hdr-&gt;hdr.l3.id
op_assign
id|QETH_HEADER_TYPE_LAYER3
suffix:semicolon
id|hdr-&gt;hdr.l3.ext_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
multiline_comment|/*&n;&t; * before we&squot;re going to overwrite this location with next hop ip.&n;&t; * v6 uses passthrough, v4 sets the tag in the QDIO header.&n;&t; */
r_if
c_cond
(paren
id|card-&gt;vlangrp
op_logical_and
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
)paren
(brace
id|hdr-&gt;hdr.l3.ext_flags
op_assign
(paren
id|ipv
op_eq
l_int|4
)paren
ques
c_cond
id|QETH_HDR_EXT_VLAN_FRAME
suffix:colon
id|QETH_HDR_EXT_INCLUDE_VLAN_TAG
suffix:semicolon
id|hdr-&gt;hdr.l3.vlan_id
op_assign
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_VLAN */
id|hdr-&gt;hdr.l3.length
op_assign
id|skb-&gt;len
op_minus
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipv
op_eq
l_int|4
)paren
(brace
multiline_comment|/* IPv4 */
id|hdr-&gt;hdr.l3.flags
op_assign
id|qeth_get_qeth_hdr_flags4
c_func
(paren
id|cast_type
)paren
suffix:semicolon
id|memset
c_func
(paren
id|hdr-&gt;hdr.l3.dest_addr
comma
l_int|0
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb-&gt;dst
)paren
op_logical_and
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
)paren
(brace
op_star
(paren
(paren
id|u32
op_star
)paren
(paren
op_amp
id|hdr-&gt;hdr.l3.dest_addr
(braket
l_int|12
)braket
)paren
)paren
op_assign
op_star
(paren
(paren
id|u32
op_star
)paren
id|skb-&gt;dst-&gt;neighbour-&gt;primary_key
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* fill in destination address used in ip header */
op_star
(paren
(paren
id|u32
op_star
)paren
(paren
op_amp
id|hdr-&gt;hdr.l3.dest_addr
(braket
l_int|12
)braket
)paren
)paren
op_assign
id|skb-&gt;nh.iph-&gt;daddr
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ipv
op_eq
l_int|6
)paren
(brace
multiline_comment|/* IPv6 or passthru */
id|hdr-&gt;hdr.l3.flags
op_assign
id|qeth_get_qeth_hdr_flags6
c_func
(paren
id|cast_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb-&gt;dst
)paren
op_logical_and
(paren
id|skb-&gt;dst-&gt;neighbour
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|hdr-&gt;hdr.l3.dest_addr
comma
id|skb-&gt;dst-&gt;neighbour-&gt;primary_key
comma
l_int|16
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* fill in destination address used in ip header */
id|memcpy
c_func
(paren
id|hdr-&gt;hdr.l3.dest_addr
comma
op_amp
id|skb-&gt;nh.ipv6h-&gt;daddr
comma
l_int|16
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* passthrough */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|skb-&gt;data
op_plus
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
comma
id|skb-&gt;dev-&gt;broadcast
comma
l_int|6
)paren
)paren
(brace
multiline_comment|/* broadcast? */
id|hdr-&gt;hdr.l3.flags
op_assign
id|QETH_CAST_BROADCAST
op_or
id|QETH_HDR_PASSTHRU
suffix:semicolon
)brace
r_else
(brace
id|hdr-&gt;hdr.l3.flags
op_assign
(paren
id|cast_type
op_eq
id|RTN_MULTICAST
)paren
ques
c_cond
id|QETH_CAST_MULTICAST
op_or
id|QETH_HDR_PASSTHRU
suffix:colon
id|QETH_CAST_UNICAST
op_or
id|QETH_HDR_PASSTHRU
suffix:semicolon
)brace
)brace
)brace
r_static
r_inline
r_int
DECL|function|qeth_fill_buffer
id|qeth_fill_buffer
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
comma
r_char
op_star
id|data
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|qdio_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|length
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
id|length_here
suffix:semicolon
r_int
id|element
suffix:semicolon
r_int
id|first_lap
op_assign
l_int|1
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;qdfillbf&quot;
)paren
suffix:semicolon
id|buffer
op_assign
id|buf-&gt;buffer
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|buf-&gt;skb_list
comma
id|skb
)paren
suffix:semicolon
id|element
op_assign
id|buf-&gt;next_element_to_fill
suffix:semicolon
r_while
c_loop
(paren
id|length
OG
l_int|0
)paren
(brace
multiline_comment|/* length_here is the remaining amount of data in this page */
id|length_here
op_assign
id|PAGE_SIZE
op_minus
(paren
(paren
r_int
r_int
)paren
id|data
op_mod
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|length
OL
id|length_here
)paren
id|length_here
op_assign
id|length
suffix:semicolon
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|addr
op_assign
id|data
suffix:semicolon
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|length
op_assign
id|length_here
suffix:semicolon
id|length
op_sub_assign
id|length_here
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|length
)paren
(brace
r_if
c_cond
(paren
id|first_lap
)paren
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
r_else
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|flags
op_assign
id|SBAL_FLAGS_LAST_FRAG
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|first_lap
)paren
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|flags
op_assign
id|SBAL_FLAGS_FIRST_FRAG
suffix:semicolon
r_else
id|buffer-&gt;element
(braket
id|element
)braket
dot
id|flags
op_assign
id|SBAL_FLAGS_MIDDLE_FRAG
suffix:semicolon
)brace
id|data
op_add_assign
id|length_here
suffix:semicolon
id|element
op_increment
suffix:semicolon
id|first_lap
op_assign
l_int|0
suffix:semicolon
)brace
id|buf-&gt;next_element_to_fill
op_assign
id|element
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|queue-&gt;do_pack
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;fillbfnp&quot;
)paren
suffix:semicolon
multiline_comment|/* set state to PRIMED -&gt; will be flushed */
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
)brace
r_else
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;fillbfpa&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.skbs_sent_pack
op_increment
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|buf-&gt;next_element_to_fill
op_ge
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|queue-&gt;card
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * packed buffer if full -&gt; set state PRIMED&n;&t;&t;&t; * -&gt; will be flushed&n;&t;&t;&t; */
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_do_send_packet_fast
id|qeth_do_send_packet_fast
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
comma
r_int
id|elements_needed
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|index
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;dosndpfa&quot;
)paren
suffix:semicolon
multiline_comment|/* spin until we get the queue ... */
r_while
c_loop
(paren
id|atomic_compare_and_swap
c_func
(paren
id|QETH_OUT_Q_UNLOCKED
comma
id|QETH_OUT_Q_LOCKED
comma
op_amp
id|queue-&gt;state
)paren
)paren
suffix:semicolon
multiline_comment|/* ... now we&squot;ve got the queue */
id|index
op_assign
id|queue-&gt;next_buf_to_fill
suffix:semicolon
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|queue-&gt;next_buf_to_fill
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * check if buffer is empty to make sure that we do not &squot;overtake&squot;&n;&t; * ourselves and try to fill a buffer that is already primed&n;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_ne
id|QETH_QDIO_BUF_EMPTY
)paren
(brace
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|queue-&gt;next_buf_to_fill
op_assign
(paren
id|queue-&gt;next_buf_to_fill
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
id|qeth_fill_buffer
c_func
(paren
id|queue
comma
id|buffer
comma
(paren
r_char
op_star
)paren
id|hdr
comma
id|skb
)paren
suffix:semicolon
id|qeth_flush_buffers
c_func
(paren
id|queue
comma
l_int|0
comma
id|index
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_do_send_packet
id|qeth_do_send_packet
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|hdr
comma
r_int
id|elements_needed
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|start_index
suffix:semicolon
r_int
id|flush_count
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;dosndpkt&quot;
)paren
suffix:semicolon
multiline_comment|/* spin until we get the queue ... */
r_while
c_loop
(paren
id|atomic_compare_and_swap
c_func
(paren
id|QETH_OUT_Q_UNLOCKED
comma
id|QETH_OUT_Q_LOCKED
comma
op_amp
id|queue-&gt;state
)paren
)paren
suffix:semicolon
id|start_index
op_assign
id|queue-&gt;next_buf_to_fill
suffix:semicolon
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|queue-&gt;next_buf_to_fill
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * check if buffer is empty to make sure that we do not &squot;overtake&squot;&n;&t; * ourselves and try to fill a buffer that is already primed&n;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_ne
id|QETH_QDIO_BUF_EMPTY
)paren
(brace
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* check if we need to switch packing state of this queue */
id|qeth_switch_to_packing_if_needed
c_func
(paren
id|queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue-&gt;do_pack
)paren
(brace
multiline_comment|/* does packet fit in current buffer? */
r_if
c_cond
(paren
(paren
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
op_minus
id|buffer-&gt;next_element_to_fill
)paren
OL
id|elements_needed
)paren
(brace
multiline_comment|/* ... no -&gt; set state PRIMED */
id|atomic_set
c_func
(paren
op_amp
id|buffer-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|flush_count
op_increment
suffix:semicolon
id|queue-&gt;next_buf_to_fill
op_assign
(paren
id|queue-&gt;next_buf_to_fill
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|buffer
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|queue-&gt;next_buf_to_fill
)braket
suffix:semicolon
multiline_comment|/* we did a step forward, so check buffer state again */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_ne
id|QETH_QDIO_BUF_EMPTY
)paren
(brace
id|card-&gt;stats.tx_dropped
op_increment
suffix:semicolon
multiline_comment|/* return EBUSY because we sent old packet, not&n;&t;&t;&t;&t; * the current one */
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|queue-&gt;state
comma
id|QETH_OUT_Q_UNLOCKED
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
id|qeth_fill_buffer
c_func
(paren
id|queue
comma
id|buffer
comma
(paren
r_char
op_star
)paren
id|hdr
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|buffer-&gt;state
)paren
op_eq
id|QETH_QDIO_BUF_PRIMED
)paren
(brace
multiline_comment|/* next time fill the next buffer */
id|flush_count
op_increment
suffix:semicolon
id|queue-&gt;next_buf_to_fill
op_assign
(paren
id|queue-&gt;next_buf_to_fill
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * queue-&gt;state will go from LOCKED -&gt; UNLOCKED or from&n;&t; * LOCKED_FLUSH -&gt; LOCKED if output_handler wanted to &squot;notify&squot; us&n;&t; * (switch packing state or flush buffer to get another pci flag out).&n;&t; * In that case we will enter this loop&n;&t; */
r_while
c_loop
(paren
id|atomic_dec_return
c_func
(paren
op_amp
id|queue-&gt;state
)paren
)paren
(brace
multiline_comment|/* check if we can go back to non-packing state */
id|flush_count
op_add_assign
id|qeth_switch_to_nonpacking_if_needed
c_func
(paren
id|queue
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * check if we need to flush a packing buffer to get a pci&n;&t;&t; * flag out on the queue&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|flush_count
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;set_pci_flags_count
)paren
)paren
id|flush_count
op_add_assign
id|qeth_flush_buffers_on_no_pci
c_func
(paren
id|queue
)paren
suffix:semicolon
)brace
multiline_comment|/* at this point the queue is UNLOCKED again */
id|out
suffix:colon
r_if
c_cond
(paren
id|flush_count
)paren
id|qeth_flush_buffers
c_func
(paren
id|queue
comma
l_int|0
comma
id|start_index
comma
id|flush_count
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_send_packet
id|qeth_send_packet
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|ipv
op_assign
l_int|0
suffix:semicolon
r_int
id|cast_type
suffix:semicolon
r_struct
id|qeth_qdio_out_q
op_star
id|queue
suffix:semicolon
r_struct
id|qeth_hdr
op_star
id|hdr
suffix:semicolon
r_int
id|elements_needed
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;sendpkt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;options.layer2
)paren
id|ipv
op_assign
id|qeth_get_ip_version
c_func
(paren
id|skb
)paren
suffix:semicolon
id|cast_type
op_assign
id|qeth_get_cast_type
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
id|queue
op_assign
id|card-&gt;qdio.out_qs
(braket
id|qeth_get_priority_queue
c_func
(paren
id|card
comma
id|skb
comma
id|ipv
comma
id|cast_type
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_prepare_skb
c_func
(paren
id|card
comma
op_amp
id|skb
comma
op_amp
id|hdr
comma
id|ipv
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|qeth_fill_header
c_func
(paren
id|card
comma
id|hdr
comma
id|skb
comma
id|ipv
comma
id|cast_type
)paren
suffix:semicolon
id|elements_needed
op_assign
l_int|1
op_plus
(paren
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|hdr
)paren
op_mod
id|PAGE_SIZE
)paren
op_plus
id|skb-&gt;len
)paren
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elements_needed
OG
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;qeth_do_send_packet: invalid size of &quot;
l_string|&quot;IP packet. Discarded.&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;info.type
op_ne
id|QETH_CARD_TYPE_IQD
)paren
id|rc
op_assign
id|qeth_do_send_packet
c_func
(paren
id|card
comma
id|queue
comma
id|skb
comma
id|hdr
comma
id|elements_needed
)paren
suffix:semicolon
r_else
id|rc
op_assign
id|qeth_do_send_packet_fast
c_func
(paren
id|card
comma
id|queue
comma
id|skb
comma
id|hdr
comma
id|elements_needed
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|card-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|card-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_mdio_read
id|qeth_mdio_read
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|regnum
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|regnum
)paren
(brace
r_case
id|MII_BMCR
suffix:colon
multiline_comment|/* Basic mode control register */
id|rc
op_assign
id|BMCR_FULLDPLX
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;info.link_type
op_ne
id|QETH_LINK_TYPE_GBIT_ETH
)paren
op_logical_and
(paren
id|card-&gt;info.link_type
op_ne
id|QETH_LINK_TYPE_10GBIT_ETH
)paren
)paren
id|rc
op_or_assign
id|BMCR_SPEED100
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_BMSR
suffix:colon
multiline_comment|/* Basic mode status register */
id|rc
op_assign
id|BMSR_ERCAP
op_or
id|BMSR_ANEGCOMPLETE
op_or
id|BMSR_LSTATUS
op_or
id|BMSR_10HALF
op_or
id|BMSR_10FULL
op_or
id|BMSR_100HALF
op_or
id|BMSR_100FULL
op_or
id|BMSR_100BASE4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_PHYSID1
suffix:colon
multiline_comment|/* PHYS ID 1 */
id|rc
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
suffix:semicolon
id|rc
op_assign
(paren
id|rc
op_rshift
l_int|5
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_PHYSID2
suffix:colon
multiline_comment|/* PHYS ID 2 */
id|rc
op_assign
(paren
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_lshift
l_int|10
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_ADVERTISE
suffix:colon
multiline_comment|/* Advertisement control reg */
id|rc
op_assign
id|ADVERTISE_ALL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_LPA
suffix:colon
multiline_comment|/* Link partner ability reg */
id|rc
op_assign
id|LPA_10HALF
op_or
id|LPA_10FULL
op_or
id|LPA_100HALF
op_or
id|LPA_100FULL
op_or
id|LPA_100BASE4
op_or
id|LPA_LPACK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_EXPANSION
suffix:colon
multiline_comment|/* Expansion register */
r_break
suffix:semicolon
r_case
id|MII_DCOUNTER
suffix:colon
multiline_comment|/* disconnect counter */
r_break
suffix:semicolon
r_case
id|MII_FCSCOUNTER
suffix:colon
multiline_comment|/* false carrier counter */
r_break
suffix:semicolon
r_case
id|MII_NWAYTEST
suffix:colon
multiline_comment|/* N-way auto-neg test register */
r_break
suffix:semicolon
r_case
id|MII_RERRCOUNTER
suffix:colon
multiline_comment|/* rx error counter */
id|rc
op_assign
id|card-&gt;stats.rx_errors
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MII_SREVISION
suffix:colon
multiline_comment|/* silicon revision */
r_break
suffix:semicolon
r_case
id|MII_RESV1
suffix:colon
multiline_comment|/* reserved 1 */
r_break
suffix:semicolon
r_case
id|MII_LBRERROR
suffix:colon
multiline_comment|/* loopback, rx, bypass error */
r_break
suffix:semicolon
r_case
id|MII_PHYADDR
suffix:colon
multiline_comment|/* physical address */
r_break
suffix:semicolon
r_case
id|MII_RESV2
suffix:colon
multiline_comment|/* reserved 2 */
r_break
suffix:semicolon
r_case
id|MII_TPISTATUS
suffix:colon
multiline_comment|/* TPI status for 10mbps */
r_break
suffix:semicolon
r_case
id|MII_NCONFIG
suffix:colon
multiline_comment|/* network interface config */
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_mdio_write
id|qeth_mdio_write
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|phy_id
comma
r_int
id|regnum
comma
r_int
id|value
)paren
(brace
r_switch
c_cond
(paren
id|regnum
)paren
(brace
r_case
id|MII_BMCR
suffix:colon
multiline_comment|/* Basic mode control register */
r_case
id|MII_BMSR
suffix:colon
multiline_comment|/* Basic mode status register */
r_case
id|MII_PHYSID1
suffix:colon
multiline_comment|/* PHYS ID 1 */
r_case
id|MII_PHYSID2
suffix:colon
multiline_comment|/* PHYS ID 2 */
r_case
id|MII_ADVERTISE
suffix:colon
multiline_comment|/* Advertisement control reg */
r_case
id|MII_LPA
suffix:colon
multiline_comment|/* Link partner ability reg */
r_case
id|MII_EXPANSION
suffix:colon
multiline_comment|/* Expansion register */
r_case
id|MII_DCOUNTER
suffix:colon
multiline_comment|/* disconnect counter */
r_case
id|MII_FCSCOUNTER
suffix:colon
multiline_comment|/* false carrier counter */
r_case
id|MII_NWAYTEST
suffix:colon
multiline_comment|/* N-way auto-neg test register */
r_case
id|MII_RERRCOUNTER
suffix:colon
multiline_comment|/* rx error counter */
r_case
id|MII_SREVISION
suffix:colon
multiline_comment|/* silicon revision */
r_case
id|MII_RESV1
suffix:colon
multiline_comment|/* reserved 1 */
r_case
id|MII_LBRERROR
suffix:colon
multiline_comment|/* loopback, rx, bypass error */
r_case
id|MII_PHYADDR
suffix:colon
multiline_comment|/* physical address */
r_case
id|MII_RESV2
suffix:colon
multiline_comment|/* reserved 2 */
r_case
id|MII_TPISTATUS
suffix:colon
multiline_comment|/* TPI status for 10mbps */
r_case
id|MII_NCONFIG
suffix:colon
multiline_comment|/* network interface config */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
r_static
r_inline
r_const
r_char
op_star
DECL|function|qeth_arp_get_error_cause
id|qeth_arp_get_error_cause
c_func
(paren
r_int
op_star
id|rc
)paren
(brace
r_switch
c_cond
(paren
op_star
id|rc
)paren
(brace
r_case
id|QETH_IPA_ARP_RC_FAILED
suffix:colon
op_star
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_return
l_string|&quot;operation failed&quot;
suffix:semicolon
r_case
id|QETH_IPA_ARP_RC_NOTSUPP
suffix:colon
op_star
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_string|&quot;operation not supported&quot;
suffix:semicolon
r_case
id|QETH_IPA_ARP_RC_OUT_OF_RANGE
suffix:colon
op_star
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
l_string|&quot;argument out of range&quot;
suffix:semicolon
r_case
id|QETH_IPA_ARP_RC_Q_NOTSUPP
suffix:colon
op_star
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_string|&quot;query operation not supported&quot;
suffix:semicolon
r_case
id|QETH_IPA_ARP_RC_Q_NO_DATA
suffix:colon
op_star
id|rc
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_return
l_string|&quot;no query data available&quot;
suffix:semicolon
r_default
suffix:colon
r_return
l_string|&quot;unknown error&quot;
suffix:semicolon
)brace
)brace
r_static
r_int
id|qeth_send_simple_setassparms
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_enum
id|qeth_ipa_funcs
comma
id|__u16
comma
r_int
)paren
suffix:semicolon
r_static
r_int
DECL|function|qeth_arp_set_no_entries
id|qeth_arp_set_no_entries
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|no_entries
)paren
(brace
r_int
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;arpstnoe&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: really not supported by GuestLAN? */
r_if
c_cond
(paren
id|card-&gt;info.guestlan
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_ARP_SET_NO_ENTRIES
comma
id|no_entries
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|tmp
op_assign
id|rc
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not set number of ARP entries on %s: &quot;
l_string|&quot;%s (0x%x/%d)&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|qeth_arp_get_error_cause
c_func
(paren
op_amp
id|rc
)paren
comma
id|tmp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_copy_arp_entries_stripped
id|qeth_copy_arp_entries_stripped
c_func
(paren
r_struct
id|qeth_arp_query_info
op_star
id|qinfo
comma
r_struct
id|qeth_arp_query_data
op_star
id|qdata
comma
r_int
id|entry_size
comma
r_int
id|uentry_size
)paren
(brace
r_char
op_star
id|entry_ptr
suffix:semicolon
r_char
op_star
id|uentry_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|entry_ptr
op_assign
(paren
r_char
op_star
)paren
op_amp
id|qdata-&gt;data
suffix:semicolon
id|uentry_ptr
op_assign
(paren
r_char
op_star
)paren
(paren
id|qinfo-&gt;udata
op_plus
id|qinfo-&gt;udata_offset
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|qdata-&gt;no_entries
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* strip off 32 bytes &quot;media specific information&quot; */
id|memcpy
c_func
(paren
id|uentry_ptr
comma
(paren
id|entry_ptr
op_plus
l_int|32
)paren
comma
id|entry_size
op_minus
l_int|32
)paren
suffix:semicolon
id|entry_ptr
op_add_assign
id|entry_size
suffix:semicolon
id|uentry_ptr
op_add_assign
id|uentry_size
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|qeth_arp_query_cb
id|qeth_arp_query_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_arp_query_data
op_star
id|qdata
suffix:semicolon
r_struct
id|qeth_arp_query_info
op_star
id|qinfo
suffix:semicolon
r_int
id|entry_size
suffix:semicolon
r_int
id|uentry_size
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;arpquecb&quot;
)paren
suffix:semicolon
id|qinfo
op_assign
(paren
r_struct
id|qeth_arp_query_info
op_star
)paren
id|reply-&gt;param
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.return_code
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;qaer1%i&quot;
comma
id|cmd-&gt;hdr.return_code
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;data.setassparms.hdr.return_code
)paren
(brace
id|cmd-&gt;hdr.return_code
op_assign
id|cmd-&gt;data.setassparms.hdr.return_code
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;qaer2%i&quot;
comma
id|cmd-&gt;hdr.return_code
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|qdata
op_assign
op_amp
id|cmd-&gt;data.setassparms.data.query_arp
suffix:semicolon
r_switch
c_cond
(paren
id|qdata-&gt;reply_bits
)paren
(brace
r_case
l_int|5
suffix:colon
id|uentry_size
op_assign
id|entry_size
op_assign
r_sizeof
(paren
r_struct
id|qeth_arp_qi_entry5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qinfo-&gt;mask_bits
op_amp
id|QETH_QARP_STRIP_ENTRIES
)paren
id|uentry_size
op_assign
r_sizeof
(paren
r_struct
id|qeth_arp_qi_entry5_short
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
multiline_comment|/* fall through to default */
r_default
suffix:colon
multiline_comment|/* tr is the same as eth -&gt; entry7 */
id|uentry_size
op_assign
id|entry_size
op_assign
r_sizeof
(paren
r_struct
id|qeth_arp_qi_entry7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qinfo-&gt;mask_bits
op_amp
id|QETH_QARP_STRIP_ENTRIES
)paren
id|uentry_size
op_assign
r_sizeof
(paren
r_struct
id|qeth_arp_qi_entry7_short
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* check if there is enough room in userspace */
r_if
c_cond
(paren
(paren
id|qinfo-&gt;udata_len
op_minus
id|qinfo-&gt;udata_offset
)paren
OL
id|qdata-&gt;no_entries
op_star
id|uentry_size
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;qaer3%i&quot;
comma
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|cmd-&gt;hdr.return_code
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;query ARP user space buffer is too small for &quot;
l_string|&quot;the returned number of ARP entries. &quot;
l_string|&quot;Aborting query!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_error
suffix:semicolon
)brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;anore%i&quot;
comma
id|cmd-&gt;data.setassparms.hdr.number_of_replies
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;aseqn%i&quot;
comma
id|cmd-&gt;data.setassparms.hdr.seq_no
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;anoen%i&quot;
comma
id|qdata-&gt;no_entries
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qinfo-&gt;mask_bits
op_amp
id|QETH_QARP_STRIP_ENTRIES
)paren
(brace
multiline_comment|/* strip off &quot;media specific information&quot; */
id|qeth_copy_arp_entries_stripped
c_func
(paren
id|qinfo
comma
id|qdata
comma
id|entry_size
comma
id|uentry_size
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/*copy entries to user buffer*/
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
op_plus
id|qinfo-&gt;udata_offset
comma
(paren
r_char
op_star
)paren
op_amp
id|qdata-&gt;data
comma
id|qdata-&gt;no_entries
op_star
id|uentry_size
)paren
suffix:semicolon
id|qinfo-&gt;no_entries
op_add_assign
id|qdata-&gt;no_entries
suffix:semicolon
id|qinfo-&gt;udata_offset
op_add_assign
(paren
id|qdata-&gt;no_entries
op_star
id|uentry_size
)paren
suffix:semicolon
multiline_comment|/* check if all replies received ... */
r_if
c_cond
(paren
id|cmd-&gt;data.setassparms.hdr.seq_no
OL
id|cmd-&gt;data.setassparms.hdr.number_of_replies
)paren
r_return
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
comma
op_amp
id|qinfo-&gt;no_entries
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* keep STRIP_ENTRIES flag so the user program can distinguish&n;&t; * stripped entries from normal ones */
r_if
c_cond
(paren
id|qinfo-&gt;mask_bits
op_amp
id|QETH_QARP_STRIP_ENTRIES
)paren
id|qdata-&gt;reply_bits
op_or_assign
id|QETH_QARP_STRIP_ENTRIES
suffix:semicolon
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
op_plus
id|QETH_QARP_MASK_OFFSET
comma
op_amp
id|qdata-&gt;reply_bits
comma
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_error
suffix:colon
id|i
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
comma
op_amp
id|i
comma
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_ipa_arp_cmd
id|qeth_send_ipa_arp_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
comma
r_int
id|len
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sendarp&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|IPA_PDU_HEADER
comma
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_CMD_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
r_return
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|IPA_PDU_HEADER_SIZE
op_plus
id|len
comma
id|iob
comma
id|reply_cb
comma
id|reply_param
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_ipa_snmp_cmd
id|qeth_send_ipa_snmp_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
comma
r_int
id|len
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
(brace
id|u16
id|s1
comma
id|s2
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sendsnmp&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|iob-&gt;data
comma
id|IPA_PDU_HEADER
comma
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_CMD_DEST_ADDR
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|card-&gt;token.ulp_connection_r
comma
id|QETH_MPC_TOKEN_LENGTH
)paren
suffix:semicolon
multiline_comment|/* adjust PDU length fields in IPA_PDU_HEADER */
id|s1
op_assign
(paren
id|u32
)paren
id|IPA_PDU_HEADER_SIZE
op_plus
id|len
suffix:semicolon
id|s2
op_assign
(paren
id|u32
)paren
id|len
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_PDU_LEN_TOTAL
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|s1
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_PDU_LEN_PDU1
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|s2
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_PDU_LEN_PDU2
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|s2
comma
l_int|2
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|QETH_IPA_PDU_LEN_PDU3
c_func
(paren
id|iob-&gt;data
)paren
comma
op_amp
id|s2
comma
l_int|2
)paren
suffix:semicolon
r_return
id|qeth_send_control_data
c_func
(paren
id|card
comma
id|IPA_PDU_HEADER_SIZE
op_plus
id|len
comma
id|iob
comma
id|reply_cb
comma
id|reply_param
)paren
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
id|qeth_get_setassparms_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_enum
id|qeth_ipa_funcs
comma
id|__u16
comma
id|__u16
comma
r_enum
id|qeth_prot_versions
)paren
suffix:semicolon
r_static
r_int
DECL|function|qeth_arp_query
id|qeth_arp_query
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_char
op_star
id|udata
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_arp_query_info
id|qinfo
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;arpquery&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * currently GuestLAN  does only deliver all zeros on query arp,&n;&t; * even though arp processing is supported (according to IPA supp.&n;&t; * funcs flags); since all zeros is no valueable information,&n;&t; * we say EOPNOTSUPP for all ARP functions&n;&t; */
multiline_comment|/*if (card-&gt;info.guestlan)&n;&t;&t;return -EOPNOTSUPP; */
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
multiline_comment|/*IPA_QUERY_ARP_ADDR_INFO*/
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* get size of userspace buffer and mask_bits -&gt; 6 bytes */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|qinfo
comma
id|udata
comma
l_int|6
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|qinfo.udata
op_assign
id|kmalloc
c_func
(paren
id|qinfo.udata_len
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|qinfo.udata
comma
l_int|0
comma
id|qinfo.udata_len
)paren
suffix:semicolon
id|qinfo.udata_offset
op_assign
id|QETH_QARP_ENTRIES_OFFSET
suffix:semicolon
id|iob
op_assign
id|qeth_get_setassparms_cmd
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_ARP_QUERY_INFO
comma
r_sizeof
(paren
r_int
)paren
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_arp_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|QETH_SETASS_BASE_LEN
op_plus
id|QETH_ARP_CMD_LEN
comma
id|qeth_arp_query_cb
comma
(paren
r_void
op_star
)paren
op_amp
id|qinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|tmp
op_assign
id|rc
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error while querying ARP cache on %s: %s &quot;
l_string|&quot;(0x%x/%d)&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|qeth_arp_get_error_cause
c_func
(paren
op_amp
id|rc
)paren
comma
id|tmp
comma
id|tmp
)paren
suffix:semicolon
id|copy_to_user
c_func
(paren
id|udata
comma
id|qinfo.udata
comma
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|copy_to_user
c_func
(paren
id|udata
comma
id|qinfo.udata
comma
id|qinfo.udata_len
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|qinfo.udata
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * SNMP command callback&n; */
r_static
r_int
DECL|function|qeth_snmp_command_cb
id|qeth_snmp_command_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|sdata
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_arp_query_info
op_star
id|qinfo
suffix:semicolon
r_struct
id|qeth_snmp_cmd
op_star
id|snmp
suffix:semicolon
r_int
r_char
op_star
id|data
suffix:semicolon
id|__u16
id|data_len
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;snpcmdcb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|sdata
suffix:semicolon
id|data
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|cmd
op_minus
id|reply-&gt;offset
)paren
suffix:semicolon
id|qinfo
op_assign
(paren
r_struct
id|qeth_arp_query_info
op_star
)paren
id|reply-&gt;param
suffix:semicolon
id|snmp
op_assign
op_amp
id|cmd-&gt;data.setadapterparms.data.snmp
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.return_code
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;scer1%i&quot;
comma
id|cmd-&gt;hdr.return_code
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd-&gt;data.setadapterparms.hdr.return_code
)paren
(brace
id|cmd-&gt;hdr.return_code
op_assign
id|cmd-&gt;data.setadapterparms.hdr.return_code
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;scer2%i&quot;
comma
id|cmd-&gt;hdr.return_code
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|data_len
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
id|QETH_IPA_PDU_LEN_PDU1
c_func
(paren
id|data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;data.setadapterparms.hdr.seq_no
op_eq
l_int|1
)paren
id|data_len
op_sub_assign
(paren
id|__u16
)paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|snmp-&gt;data
op_minus
(paren
r_char
op_star
)paren
id|cmd
)paren
suffix:semicolon
r_else
id|data_len
op_sub_assign
(paren
id|__u16
)paren
(paren
(paren
r_char
op_star
)paren
op_amp
id|snmp-&gt;request
op_minus
(paren
r_char
op_star
)paren
id|cmd
)paren
suffix:semicolon
multiline_comment|/* check if there is enough room in userspace */
r_if
c_cond
(paren
(paren
id|qinfo-&gt;udata_len
op_minus
id|qinfo-&gt;udata_offset
)paren
OL
id|data_len
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;scer3%i&quot;
comma
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|cmd-&gt;hdr.return_code
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;snore%i&quot;
comma
id|cmd-&gt;data.setadapterparms.hdr.used_total
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sseqn%i&quot;
comma
id|cmd-&gt;data.setadapterparms.hdr.seq_no
)paren
suffix:semicolon
multiline_comment|/*copy entries to user buffer*/
r_if
c_cond
(paren
id|cmd-&gt;data.setadapterparms.hdr.seq_no
op_eq
l_int|1
)paren
(brace
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
op_plus
id|qinfo-&gt;udata_offset
comma
(paren
r_char
op_star
)paren
id|snmp
comma
id|data_len
op_plus
m_offsetof
(paren
r_struct
id|qeth_snmp_cmd
comma
id|data
)paren
)paren
suffix:semicolon
id|qinfo-&gt;udata_offset
op_add_assign
m_offsetof
(paren
r_struct
id|qeth_snmp_cmd
comma
id|data
)paren
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|qinfo-&gt;udata
op_plus
id|qinfo-&gt;udata_offset
comma
(paren
r_char
op_star
)paren
op_amp
id|snmp-&gt;request
comma
id|data_len
)paren
suffix:semicolon
)brace
id|qinfo-&gt;udata_offset
op_add_assign
id|data_len
suffix:semicolon
multiline_comment|/* check if all replies received ... */
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;srtot%i&quot;
comma
id|cmd-&gt;data.setadapterparms.hdr.used_total
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;srseq%i&quot;
comma
id|cmd-&gt;data.setadapterparms.hdr.seq_no
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;data.setadapterparms.hdr.seq_no
OL
id|cmd-&gt;data.setadapterparms.hdr.used_total
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
id|qeth_get_ipacmd_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_enum
id|qeth_ipa_cmds
comma
r_enum
id|qeth_prot_versions
)paren
suffix:semicolon
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|qeth_get_adapter_cmd
id|qeth_get_adapter_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
id|__u32
id|command
comma
id|__u32
id|cmdlen
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_SETADAPTERPARMS
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setadapterparms.hdr.cmdlength
op_assign
id|cmdlen
suffix:semicolon
id|cmd-&gt;data.setadapterparms.hdr.command_code
op_assign
id|command
suffix:semicolon
id|cmd-&gt;data.setadapterparms.hdr.used_total
op_assign
l_int|1
suffix:semicolon
id|cmd-&gt;data.setadapterparms.hdr.seq_no
op_assign
l_int|1
suffix:semicolon
r_return
id|iob
suffix:semicolon
)brace
multiline_comment|/**&n; * function to send SNMP commands to OSA-E card&n; */
r_static
r_int
DECL|function|qeth_snmp_command
id|qeth_snmp_command
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_char
op_star
id|udata
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_snmp_ureq
op_star
id|ureq
suffix:semicolon
r_int
id|req_len
suffix:semicolon
r_struct
id|qeth_arp_query_info
id|qinfo
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;snmpcmd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;info.guestlan
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_adp_supported
c_func
(paren
id|card
comma
id|IPA_SETADP_SET_SNMP_CONTROL
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;SNMP Query MIBS not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
multiline_comment|/* skip 4 bytes (data_len struct member) to get req_len */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|req_len
comma
id|udata
op_plus
r_sizeof
(paren
r_int
)paren
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ureq
op_assign
id|kmalloc
c_func
(paren
id|req_len
op_plus
r_sizeof
(paren
r_struct
id|qeth_snmp_ureq_hdr
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ureq
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;snmpnome&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|ureq
comma
id|udata
comma
id|req_len
op_plus
r_sizeof
(paren
r_struct
id|qeth_snmp_ureq_hdr
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|ureq
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|qinfo.udata_len
op_assign
id|ureq-&gt;hdr.data_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|qinfo.udata
op_assign
id|kmalloc
c_func
(paren
id|qinfo.udata_len
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|ureq
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|qinfo.udata
comma
l_int|0
comma
id|qinfo.udata_len
)paren
suffix:semicolon
id|qinfo.udata_offset
op_assign
r_sizeof
(paren
r_struct
id|qeth_snmp_ureq_hdr
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_adapter_cmd
c_func
(paren
id|card
comma
id|IPA_SETADP_SET_SNMP_CONTROL
comma
id|QETH_SNMP_SETADP_CMDLENGTH
op_plus
id|req_len
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setadapterparms.data.snmp
comma
op_amp
id|ureq-&gt;cmd
comma
id|req_len
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_snmp_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|QETH_SETADP_BASE_LEN
op_plus
id|req_len
comma
id|qeth_snmp_command_cb
comma
(paren
r_void
op_star
)paren
op_amp
id|qinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;SNMP command failed on %s: (0x%x)&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_else
id|copy_to_user
c_func
(paren
id|udata
comma
id|qinfo.udata
comma
id|qinfo.udata_len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ureq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|qinfo.udata
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
id|qeth_default_setassparms_cb
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
id|qeth_send_setassparms
c_func
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_cmd_buffer
op_star
comma
id|__u16
comma
r_int
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
suffix:semicolon
r_static
r_int
DECL|function|qeth_arp_add_entry
id|qeth_arp_add_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_arp_cache_entry
op_star
id|entry
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_char
id|buf
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;arpadent&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * currently GuestLAN  does only deliver all zeros on query arp,&n;&t; * even though arp processing is supported (according to IPA supp.&n;&t; * funcs flags); since all zeros is no valueable information,&n;&t; * we say EOPNOTSUPP for all ARP functions&n;&t; */
r_if
c_cond
(paren
id|card-&gt;info.guestlan
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|iob
op_assign
id|qeth_get_setassparms_cmd
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_ARP_ADD_ENTRY
comma
r_sizeof
(paren
r_struct
id|qeth_arp_cache_entry
)paren
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setassparms
c_func
(paren
id|card
comma
id|iob
comma
r_sizeof
(paren
r_struct
id|qeth_arp_cache_entry
)paren
comma
(paren
r_int
r_int
)paren
id|entry
comma
id|qeth_default_setassparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|tmp
op_assign
id|rc
suffix:semicolon
id|qeth_ipaddr4_to_string
c_func
(paren
(paren
id|u8
op_star
)paren
id|entry-&gt;ipaddr
comma
id|buf
)paren
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not add ARP entry for address %s on %s: &quot;
l_string|&quot;%s (0x%x/%d)&bslash;n&quot;
comma
id|buf
comma
id|card-&gt;info.if_name
comma
id|qeth_arp_get_error_cause
c_func
(paren
op_amp
id|rc
)paren
comma
id|tmp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_arp_remove_entry
id|qeth_arp_remove_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_arp_cache_entry
op_star
id|entry
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_char
id|buf
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;arprment&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * currently GuestLAN  does only deliver all zeros on query arp,&n;&t; * even though arp processing is supported (according to IPA supp.&n;&t; * funcs flags); since all zeros is no valueable information,&n;&t; * we say EOPNOTSUPP for all ARP functions&n;&t; */
r_if
c_cond
(paren
id|card-&gt;info.guestlan
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|buf
comma
id|entry
comma
l_int|12
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_setassparms_cmd
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_ARP_REMOVE_ENTRY
comma
l_int|12
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setassparms
c_func
(paren
id|card
comma
id|iob
comma
l_int|12
comma
(paren
r_int
r_int
)paren
id|buf
comma
id|qeth_default_setassparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|tmp
op_assign
id|rc
suffix:semicolon
id|memset
c_func
(paren
id|buf
comma
l_int|0
comma
l_int|16
)paren
suffix:semicolon
id|qeth_ipaddr4_to_string
c_func
(paren
(paren
id|u8
op_star
)paren
id|entry-&gt;ipaddr
comma
id|buf
)paren
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not delete ARP entry for address %s on %s: &quot;
l_string|&quot;%s (0x%x/%d)&bslash;n&quot;
comma
id|buf
comma
id|card-&gt;info.if_name
comma
id|qeth_arp_get_error_cause
c_func
(paren
op_amp
id|rc
)paren
comma
id|tmp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_arp_flush_cache
id|qeth_arp_flush_cache
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;arpflush&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * currently GuestLAN  does only deliver all zeros on query arp,&n;&t; * even though arp processing is supported (according to IPA supp.&n;&t; * funcs flags); since all zeros is no valueable information,&n;&t; * we say EOPNOTSUPP for all ARP functions&n;&t; */
r_if
c_cond
(paren
id|card-&gt;info.guestlan
op_logical_or
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_ARP_FLUSH_CACHE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|tmp
op_assign
id|rc
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not flush ARP cache on %s: %s (0x%x/%d)&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|qeth_arp_get_error_cause
c_func
(paren
op_amp
id|rc
)paren
comma
id|tmp
comma
id|tmp
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_do_ioctl
id|qeth_do_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|rq
comma
r_int
id|cmd
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_struct
id|qeth_arp_cache_entry
id|arp_entry
suffix:semicolon
r_struct
id|mii_ioctl_data
op_star
id|mii_data
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_UP
)paren
op_logical_and
(paren
id|card-&gt;state
op_ne
id|CARD_STATE_SOFTSETUP
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOC_QETH_ARP_SET_NO_ENTRIES
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
op_logical_or
(paren
id|card-&gt;options.layer2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_arp_set_no_entries
c_func
(paren
id|card
comma
id|rq-&gt;ifr_ifru.ifru_ivalue
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_ARP_QUERY_INFO
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
op_logical_or
(paren
id|card-&gt;options.layer2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_arp_query
c_func
(paren
id|card
comma
id|rq-&gt;ifr_ifru.ifru_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_ARP_ADD_ENTRY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
op_logical_or
(paren
id|card-&gt;options.layer2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|arp_entry
comma
id|rq-&gt;ifr_ifru.ifru_data
comma
r_sizeof
(paren
r_struct
id|qeth_arp_cache_entry
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|rc
op_assign
id|qeth_arp_add_entry
c_func
(paren
id|card
comma
op_amp
id|arp_entry
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_ARP_REMOVE_ENTRY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
op_logical_or
(paren
id|card-&gt;options.layer2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|arp_entry
comma
id|rq-&gt;ifr_ifru.ifru_data
comma
r_sizeof
(paren
r_struct
id|qeth_arp_cache_entry
)paren
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|rc
op_assign
id|qeth_arp_remove_entry
c_func
(paren
id|card
comma
op_amp
id|arp_entry
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_ARP_FLUSH_CACHE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
op_logical_or
(paren
id|card-&gt;options.layer2
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_arp_flush_cache
c_func
(paren
id|card
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_ADP_SET_SNMP_CONTROL
suffix:colon
id|rc
op_assign
id|qeth_snmp_command
c_func
(paren
id|card
comma
id|rq-&gt;ifr_ifru.ifru_data
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOC_QETH_GET_CARD_TYPE
suffix:colon
r_if
c_cond
(paren
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
op_logical_and
op_logical_neg
id|card-&gt;info.guestlan
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGMIIPHY
suffix:colon
id|mii_data
op_assign
id|if_mii
c_func
(paren
id|rq
)paren
suffix:semicolon
id|mii_data-&gt;phy_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCGMIIREG
suffix:colon
id|mii_data
op_assign
id|if_mii
c_func
(paren
id|rq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data-&gt;phy_id
op_ne
l_int|0
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|mii_data-&gt;val_out
op_assign
id|qeth_mdio_read
c_func
(paren
id|dev
comma
id|mii_data-&gt;phy_id
comma
id|mii_data-&gt;reg_num
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIOCSMIIREG
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* TODO: remove return if qeth_mdio_write does something */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mii_data
op_assign
id|if_mii
c_func
(paren
id|rq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mii_data-&gt;phy_id
op_ne
l_int|0
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|qeth_mdio_write
c_func
(paren
id|dev
comma
id|mii_data-&gt;phy_id
comma
id|mii_data-&gt;reg_num
comma
id|mii_data-&gt;val_in
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rc
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ioce%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_struct
id|net_device_stats
op_star
DECL|function|qeth_get_stats
id|qeth_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;getstat&quot;
)paren
suffix:semicolon
r_return
op_amp
id|card-&gt;stats
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_change_mtu
id|qeth_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
(paren
id|dev-&gt;priv
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;chgmtu&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%8x&quot;
comma
id|new_mtu
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OL
l_int|64
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OG
l_int|65535
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IP_FRAGMENTATION
)paren
)paren
op_logical_and
(paren
op_logical_neg
id|qeth_mtu_is_valid
c_func
(paren
id|card
comma
id|new_mtu
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_static
r_void
DECL|function|qeth_vlan_rx_register
id|qeth_vlan_rx_register
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|vlan_group
op_star
id|grp
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;vlanreg&quot;
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;vlanlock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;vlangrp
op_assign
id|grp
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;vlanlock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_free_vlan_buffer
id|qeth_free_vlan_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
comma
r_int
r_int
id|vid
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sk_buff_head
id|tmp_list
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|tmp_list
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|buf-&gt;skb_list
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|vlan_tx_tag_present
c_func
(paren
id|skb
)paren
op_logical_and
(paren
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
op_eq
id|vid
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_else
id|skb_queue_tail
c_func
(paren
op_amp
id|tmp_list
comma
id|skb
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|tmp_list
)paren
)paren
)paren
id|skb_queue_tail
c_func
(paren
op_amp
id|buf-&gt;skb_list
comma
id|skb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_free_vlan_skbs
id|qeth_free_vlan_skbs
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|vid
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;frvlskbs&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;qdio.no_out_queues
suffix:semicolon
op_increment
id|i
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
op_increment
id|j
)paren
id|qeth_free_vlan_buffer
c_func
(paren
id|card
comma
op_amp
id|card-&gt;qdio
dot
id|out_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|bufs
(braket
id|j
)braket
comma
id|vid
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|qeth_free_vlan_addresses4
id|qeth_free_vlan_addresses4
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;frvaddr4&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;vlangrp
)paren
r_return
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
id|in_dev
op_assign
id|__in_dev_get
c_func
(paren
id|card-&gt;vlangrp-&gt;vlan_devices
(braket
id|vid
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_goto
id|out
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|in_dev-&gt;ifa_list
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;ifa_next
)paren
(brace
id|addr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
id|addr-&gt;u.a4.addr
op_assign
id|ifa-&gt;ifa_address
suffix:semicolon
id|addr-&gt;u.a4.mask
op_assign
id|ifa-&gt;ifa_mask
suffix:semicolon
id|addr-&gt;type
op_assign
id|QETH_IP_TYPE_NORMAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_free_vlan_addresses6
id|qeth_free_vlan_addresses6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
r_struct
id|inet6_ifaddr
op_star
id|ifa
suffix:semicolon
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;frvaddr6&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;vlangrp
)paren
r_return
suffix:semicolon
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|card-&gt;vlangrp-&gt;vlan_devices
(braket
id|vid
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in6_dev
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|ifa
op_assign
id|in6_dev-&gt;addr_list
suffix:semicolon
id|ifa
suffix:semicolon
id|ifa
op_assign
id|ifa-&gt;lst_next
)paren
(brace
id|addr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|addr-&gt;u.a6.addr
comma
op_amp
id|ifa-&gt;addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|addr-&gt;u.a6.pfxlen
op_assign
id|ifa-&gt;prefix_len
suffix:semicolon
id|addr-&gt;type
op_assign
id|QETH_IP_TYPE_NORMAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)brace
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_layer2_send_setdelvlan
id|qeth_layer2_send_setdelvlan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
id|__u16
id|i
comma
r_enum
id|qeth_ipa_cmds
id|ipacmd
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;L2sdv%x&quot;
comma
id|ipacmd
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|ipacmd
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setdelvlan.vlan_id
op_assign
id|i
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;Error in processing VLAN %i on %s: 0x%x. &quot;
l_string|&quot;Continuing&bslash;n&quot;
comma
id|i
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;L2VL%4x&quot;
comma
id|ipacmd
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;L2%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;err%d&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|qeth_layer2_process_vlans
id|qeth_layer2_process_vlans
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|clear
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;L2prcvln&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;vlangrp
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VLAN_GROUP_ARRAY_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;vlangrp-&gt;vlan_devices
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|clear
)paren
id|qeth_layer2_send_setdelvlan
c_func
(paren
id|card
comma
id|i
comma
id|IPA_CMD_DELVLAN
)paren
suffix:semicolon
r_else
id|qeth_layer2_send_setdelvlan
c_func
(paren
id|card
comma
id|i
comma
id|IPA_CMD_SETVLAN
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*add_vid is layer 2 used only ....*/
r_static
r_void
DECL|function|qeth_vlan_rx_add_vid
id|qeth_vlan_rx_add_vid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;aid:%d&quot;
comma
id|vid
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;options.layer2
)paren
r_return
suffix:semicolon
id|qeth_layer2_send_setdelvlan
c_func
(paren
id|card
comma
id|vid
comma
id|IPA_CMD_SETVLAN
)paren
suffix:semicolon
)brace
multiline_comment|/*... kill_vid used for both modes*/
r_static
r_void
DECL|function|qeth_vlan_rx_kill_vid
id|qeth_vlan_rx_kill_vid
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
r_int
id|vid
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;kid:%d&quot;
comma
id|vid
)paren
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* free all skbs for the vlan device */
id|qeth_free_vlan_skbs
c_func
(paren
id|card
comma
id|vid
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;vlanlock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* unregister IP addresses of vlan device */
id|qeth_free_vlan_addresses4
c_func
(paren
id|card
comma
id|vid
)paren
suffix:semicolon
id|qeth_free_vlan_addresses6
c_func
(paren
id|card
comma
id|vid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;vlangrp
)paren
id|card-&gt;vlangrp-&gt;vlan_devices
(braket
id|vid
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;vlanlock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|qeth_layer2_send_setdelvlan
c_func
(paren
id|card
comma
id|vid
comma
id|IPA_CMD_DELVLAN
)paren
suffix:semicolon
id|qeth_set_multicast_list
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/**&n; * set multicast address on card&n; */
r_static
r_void
DECL|function|qeth_set_multicast_list
id|qeth_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setmulti&quot;
)paren
suffix:semicolon
id|qeth_delete_mc_addresses
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_add_multicast_ipv4
c_func
(paren
id|card
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|qeth_add_multicast_ipv6
c_func
(paren
id|card
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_neigh_setup
id|qeth_neigh_setup
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|neigh_parms
op_star
id|np
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_int
DECL|function|qeth_ipv6_generate_eui64
id|qeth_ipv6_generate_eui64
c_func
(paren
id|u8
op_star
id|eui
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_switch
c_cond
(paren
id|dev-&gt;type
)paren
(brace
r_case
id|ARPHRD_ETHER
suffix:colon
r_case
id|ARPHRD_FDDI
suffix:colon
r_case
id|ARPHRD_IEEE802_TR
suffix:colon
r_if
c_cond
(paren
id|dev-&gt;addr_len
op_ne
id|ETH_ALEN
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|eui
comma
id|dev-&gt;dev_addr
comma
l_int|3
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|eui
op_plus
l_int|5
comma
id|dev-&gt;dev_addr
op_plus
l_int|3
comma
l_int|3
)paren
suffix:semicolon
id|eui
(braket
l_int|3
)braket
op_assign
(paren
id|dev-&gt;dev_id
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|eui
(braket
l_int|4
)braket
op_assign
id|dev-&gt;dev_id
op_amp
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|qeth_get_mac_for_ipm
id|qeth_get_mac_for_ipm
c_func
(paren
id|__u32
id|ipm
comma
r_char
op_star
id|mac
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE802_TR
)paren
id|ip_tr_mc_map
c_func
(paren
id|ipm
comma
id|mac
)paren
suffix:semicolon
r_else
id|ip_eth_mc_map
c_func
(paren
id|ipm
comma
id|mac
)paren
suffix:semicolon
)brace
r_static
r_struct
id|qeth_ipaddr
op_star
DECL|function|qeth_get_addr_buffer
id|qeth_get_addr_buffer
c_func
(paren
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
id|addr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_ipaddr
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Not enough memory to add address&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|addr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_ipaddr
)paren
)paren
suffix:semicolon
id|addr-&gt;type
op_assign
id|QETH_IP_TYPE_NORMAL
suffix:semicolon
id|addr-&gt;proto
op_assign
id|prot
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_delete_mc_addresses
id|qeth_delete_mc_addresses
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|iptodo
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;delmc&quot;
)paren
suffix:semicolon
id|iptodo
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iptodo
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;dmcnomem&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|iptodo-&gt;type
op_assign
id|QETH_IP_TYPE_DEL_ALL_MC
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|__qeth_insert_ip_todo
c_func
(paren
id|card
comma
id|iptodo
comma
l_int|0
)paren
)paren
id|kfree
c_func
(paren
id|iptodo
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_add_mc
id|qeth_add_mc
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|in_device
op_star
id|in4_dev
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipm
suffix:semicolon
r_struct
id|ip_mc_list
op_star
id|im4
suffix:semicolon
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;addmc&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im4
op_assign
id|in4_dev-&gt;mc_list
suffix:semicolon
id|im4
suffix:semicolon
id|im4
op_assign
id|im4-&gt;next
)paren
(brace
id|qeth_get_mac_for_ipm
c_func
(paren
id|im4-&gt;multiaddr
comma
id|buf
comma
id|in4_dev-&gt;dev
)paren
suffix:semicolon
id|ipm
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipm
)paren
r_continue
suffix:semicolon
id|ipm-&gt;u.a4.addr
op_assign
id|im4-&gt;multiaddr
suffix:semicolon
id|memcpy
c_func
(paren
id|ipm-&gt;mac
comma
id|buf
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|ipm-&gt;is_multicast
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|ipm
)paren
)paren
id|kfree
c_func
(paren
id|ipm
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_add_vlan_mc
id|qeth_add_vlan_mc
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|vlan_group
op_star
id|vg
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;addmcvl&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|card-&gt;options.layer2
op_eq
l_int|0
)paren
op_logical_and
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_FULL_VLAN
)paren
)paren
)paren
op_logical_or
(paren
id|card-&gt;vlangrp
op_eq
l_int|NULL
)paren
)paren
r_return
suffix:semicolon
id|vg
op_assign
id|card-&gt;vlangrp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VLAN_GROUP_ARRAY_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
op_eq
l_int|NULL
op_logical_or
op_logical_neg
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
op_member_access_from_pointer
id|flags
op_amp
id|IFF_UP
)paren
)paren
r_continue
suffix:semicolon
id|in_dev
op_assign
id|in_dev_get
c_func
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|qeth_add_mc
c_func
(paren
id|card
comma
id|in_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
r_static
r_void
DECL|function|qeth_add_multicast_ipv4
id|qeth_add_multicast_ipv4
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|in_device
op_star
id|in4_dev
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;chkmcv4&quot;
)paren
suffix:semicolon
id|in4_dev
op_assign
id|in_dev_get
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in4_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in4_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|qeth_add_mc
c_func
(paren
id|card
comma
id|in4_dev
)paren
suffix:semicolon
id|qeth_add_vlan_mc
c_func
(paren
id|card
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in4_dev-&gt;mc_list_lock
)paren
suffix:semicolon
id|in_dev_put
c_func
(paren
id|in4_dev
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_inline
r_void
DECL|function|qeth_add_mc6
id|qeth_add_mc6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|inet6_dev
op_star
id|in6_dev
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipm
suffix:semicolon
r_struct
id|ifmcaddr6
op_star
id|im6
suffix:semicolon
r_char
id|buf
(braket
id|MAX_ADDR_LEN
)braket
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;addmc6&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|im6
op_assign
id|in6_dev-&gt;mc_list
suffix:semicolon
id|im6
op_ne
l_int|NULL
suffix:semicolon
id|im6
op_assign
id|im6-&gt;next
)paren
(brace
id|ndisc_mc_map
c_func
(paren
op_amp
id|im6-&gt;mca_addr
comma
id|buf
comma
id|in6_dev-&gt;dev
comma
l_int|0
)paren
suffix:semicolon
id|ipm
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ipm
)paren
r_continue
suffix:semicolon
id|ipm-&gt;is_multicast
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|ipm-&gt;mac
comma
id|buf
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipm-&gt;u.a6.addr
comma
op_amp
id|im6-&gt;mca_addr.s6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|ipm
)paren
)paren
id|kfree
c_func
(paren
id|ipm
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_add_vlan_mc6
id|qeth_add_vlan_mc6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_struct
id|inet6_dev
op_star
id|in_dev
suffix:semicolon
r_struct
id|vlan_group
op_star
id|vg
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;admc6vl&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|card-&gt;options.layer2
op_eq
l_int|0
)paren
op_logical_and
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_FULL_VLAN
)paren
)paren
)paren
op_logical_or
(paren
id|card-&gt;vlangrp
op_eq
l_int|NULL
)paren
)paren
r_return
suffix:semicolon
id|vg
op_assign
id|card-&gt;vlangrp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VLAN_GROUP_ARRAY_LEN
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
op_eq
l_int|NULL
op_logical_or
op_logical_neg
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
op_member_access_from_pointer
id|flags
op_amp
id|IFF_UP
)paren
)paren
r_continue
suffix:semicolon
id|in_dev
op_assign
id|in6_dev_get
c_func
(paren
id|vg-&gt;vlan_devices
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|in_dev
)paren
r_continue
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|qeth_add_mc6
c_func
(paren
id|card
comma
id|in_dev
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in_dev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in_dev
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_VLAN */
)brace
r_static
r_void
DECL|function|qeth_add_multicast_ipv6
id|qeth_add_multicast_ipv6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|inet6_dev
op_star
id|in6_dev
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;chkmcv6&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IPV6
)paren
)paren
r_return
suffix:semicolon
id|in6_dev
op_assign
id|in6_dev_get
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in6_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|in6_dev-&gt;lock
)paren
suffix:semicolon
id|qeth_add_mc6
c_func
(paren
id|card
comma
id|in6_dev
)paren
suffix:semicolon
id|qeth_add_vlan_mc6
c_func
(paren
id|card
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|in6_dev-&gt;lock
)paren
suffix:semicolon
id|in6_dev_put
c_func
(paren
id|in6_dev
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_IPV6 */
r_static
r_int
DECL|function|qeth_layer2_send_setdelmac
id|qeth_layer2_send_setdelmac
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
id|__u8
op_star
id|mac
comma
r_enum
id|qeth_ipa_cmds
id|ipacmd
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;L2sdmac&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|ipacmd
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setdelmac.mac_length
op_assign
id|OSA_ADDR_LEN
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setdelmac.mac
comma
id|mac
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
r_return
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer2_set_mac_address
id|qeth_layer2_set_mac_address
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|sockaddr
op_star
id|addr
op_assign
id|p
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setmac&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_verify_dev
c_func
(paren
id|dev
)paren
op_ne
id|QETH_REAL_CARD
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setmcINV&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;options.layer2
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Setting MAC address on %s is not supported&quot;
l_string|&quot;in Layer 3 mode.&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setmcLY3&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
id|addr-&gt;sa_data
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;info.layer2_mac_registered
)paren
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
op_amp
id|card-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|IPA_CMD_DELVMAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error in deregistering MAC address on &quot;
"&bslash;"
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|card-&gt;info.layer2_mac_registered
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
id|addr-&gt;sa_data
comma
id|IPA_CMD_SETVMAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error in registering MAC address on &quot;
"&bslash;"
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|card-&gt;info.layer2_mac_registered
op_assign
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr-&gt;sa_data
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|PRINT_INFO
c_func
(paren
l_string|&quot;MAC address %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x &quot;
l_string|&quot;successfully registered on device %s&bslash;n&quot;
comma
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|4
)braket
comma
id|dev-&gt;dev_addr
(braket
l_int|5
)braket
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_fill_ipacmd_header
id|qeth_fill_ipacmd_header
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
comma
id|__u8
id|command
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
id|memset
c_func
(paren
id|cmd
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_ipa_cmd
)paren
)paren
suffix:semicolon
id|cmd-&gt;hdr.command
op_assign
id|command
suffix:semicolon
id|cmd-&gt;hdr.initiator
op_assign
id|IPA_CMD_INITIATOR_HOST
suffix:semicolon
id|cmd-&gt;hdr.seqno
op_assign
id|card-&gt;seqno.ipa
suffix:semicolon
id|cmd-&gt;hdr.adapter_type
op_assign
id|qeth_get_ipa_adp_type
c_func
(paren
id|card-&gt;info.link_type
)paren
suffix:semicolon
id|cmd-&gt;hdr.rel_adapter_no
op_assign
(paren
id|__u8
)paren
id|card-&gt;info.portno
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|cmd-&gt;hdr.prim_version_no
op_assign
l_int|2
suffix:semicolon
r_else
id|cmd-&gt;hdr.prim_version_no
op_assign
l_int|1
suffix:semicolon
id|cmd-&gt;hdr.param_count
op_assign
l_int|1
suffix:semicolon
id|cmd-&gt;hdr.prot_version
op_assign
id|prot
suffix:semicolon
id|cmd-&gt;hdr.ipa_supported
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;hdr.ipa_enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|qeth_get_ipacmd_buffer
id|qeth_get_ipacmd_buffer
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_ipa_cmds
id|ipacmd
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|iob
op_assign
id|qeth_wait_for_buffer
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|qeth_fill_ipacmd_header
c_func
(paren
id|card
comma
id|cmd
comma
id|ipacmd
comma
id|prot
)paren
suffix:semicolon
r_return
id|iob
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_setdelmc
id|qeth_send_setdelmc
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
r_int
id|ipacmd
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;setdelmc&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|ipacmd
comma
id|addr-&gt;proto
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setdelipm.mac
comma
id|addr-&gt;mac
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
id|memcpy
c_func
(paren
id|cmd-&gt;data.setdelipm.ip6
comma
op_amp
id|addr-&gt;u.a6.addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setdelipm.ip4
comma
op_amp
id|addr-&gt;u.a4.addr
comma
l_int|4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_fill_netmask
id|qeth_fill_netmask
c_func
(paren
id|u8
op_star
id|netmask
comma
r_int
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
(paren
id|len
)paren
op_minus
(paren
id|i
op_star
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_ge
l_int|8
)paren
id|netmask
(braket
id|i
)braket
op_assign
l_int|0xff
suffix:semicolon
r_else
r_if
c_cond
(paren
id|j
OG
l_int|0
)paren
id|netmask
(braket
id|i
)braket
op_assign
(paren
id|u8
)paren
(paren
l_int|0xFF00
op_rshift
id|j
)paren
suffix:semicolon
r_else
id|netmask
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|qeth_send_setdelip
id|qeth_send_setdelip
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
r_int
id|ipacmd
comma
r_int
r_int
id|flags
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|__u8
id|netmask
(braket
l_int|16
)braket
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;setdelip&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;flags%02X&quot;
comma
id|flags
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|ipacmd
comma
id|addr-&gt;proto
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|memcpy
c_func
(paren
id|cmd-&gt;data.setdelip6.ip_addr
comma
op_amp
id|addr-&gt;u.a6.addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|qeth_fill_netmask
c_func
(paren
id|netmask
comma
id|addr-&gt;u.a6.pfxlen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd-&gt;data.setdelip6.mask
comma
id|netmask
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|cmd-&gt;data.setdelip6.flags
op_assign
id|flags
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|cmd-&gt;data.setdelip4.ip_addr
comma
op_amp
id|addr-&gt;u.a4.addr
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd-&gt;data.setdelip4.mask
comma
op_amp
id|addr-&gt;u.a4.mask
comma
l_int|4
)paren
suffix:semicolon
id|cmd-&gt;data.setdelip4.flags
op_assign
id|flags
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer2_register_addr_entry
id|qeth_layer2_register_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;is_multicast
)paren
r_return
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;setgmac&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
op_amp
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|IPA_CMD_SETGMAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_ERR
c_func
(paren
l_string|&quot;Could not set group MAC &quot;
"&bslash;"
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x on %s: %x&bslash;n&quot;
comma
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|addr-&gt;mac
(braket
l_int|1
)braket
comma
id|addr-&gt;mac
(braket
l_int|2
)braket
comma
id|addr-&gt;mac
(braket
l_int|3
)braket
comma
id|addr-&gt;mac
(braket
l_int|4
)braket
comma
id|addr-&gt;mac
(braket
l_int|5
)braket
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer2_deregister_addr_entry
id|qeth_layer2_deregister_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;is_multicast
)paren
r_return
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;delgmac&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
op_amp
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|IPA_CMD_DELGMAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_ERR
c_func
(paren
l_string|&quot;Could not delete group MAC &quot;
"&bslash;"
l_string|&quot;%02x:%02x:%02x:%02x:%02x:%02x on %s: %x&bslash;n&quot;
comma
id|addr-&gt;mac
(braket
l_int|0
)braket
comma
id|addr-&gt;mac
(braket
l_int|1
)braket
comma
id|addr-&gt;mac
(braket
l_int|2
)braket
comma
id|addr-&gt;mac
(braket
l_int|3
)braket
comma
id|addr-&gt;mac
(braket
l_int|4
)braket
comma
id|addr-&gt;mac
(braket
l_int|5
)braket
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer3_register_addr_entry
id|qeth_layer3_register_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
singleline_comment|//char buf[50];
r_int
id|rc
suffix:semicolon
r_int
id|cnt
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;setaddr4&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;u.a4.addr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;setaddr6&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;u.a6.addr
comma
l_int|8
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|addr-&gt;u.a6.addr
)paren
op_plus
l_int|8
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;setaddr?&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|qeth_ipaddr
)paren
)paren
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
id|addr-&gt;is_multicast
)paren
id|rc
op_assign
id|qeth_send_setdelmc
c_func
(paren
id|card
comma
id|addr
comma
id|IPA_CMD_SETIPM
)paren
suffix:semicolon
r_else
id|rc
op_assign
id|qeth_send_setdelip
c_func
(paren
id|card
comma
id|addr
comma
id|IPA_CMD_SETIP
comma
id|addr-&gt;set_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;failed&quot;
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
op_decrement
id|cnt
OG
l_int|0
)paren
op_logical_and
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;FAILED&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: re-activate this warning as soon as we have a&n;&t;&t; * clean mirco code&n;&t;&t;qeth_ipaddr_to_string(addr-&gt;proto, (u8 *)&amp;addr-&gt;u, buf);&n;&t;&t;PRINT_WARN(&quot;Could not register IP address %s (rc=%x)&bslash;n&quot;,&n;&t;&t;&t;   buf, rc);&n;&t;&t;*/
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer3_deregister_addr_entry
id|qeth_layer3_deregister_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
singleline_comment|//char buf[50];
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;deladdr4&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;u.a4.addr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;deladdr6&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
op_amp
id|addr-&gt;u.a6.addr
comma
l_int|8
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|addr-&gt;u.a6.addr
)paren
op_plus
l_int|8
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;deladdr?&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|trace
comma
l_int|3
comma
id|addr
comma
r_sizeof
(paren
r_struct
id|qeth_ipaddr
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;is_multicast
)paren
id|rc
op_assign
id|qeth_send_setdelmc
c_func
(paren
id|card
comma
id|addr
comma
id|IPA_CMD_DELIPM
)paren
suffix:semicolon
r_else
id|rc
op_assign
id|qeth_send_setdelip
c_func
(paren
id|card
comma
id|addr
comma
id|IPA_CMD_DELIP
comma
id|addr-&gt;del_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;failed&quot;
)paren
suffix:semicolon
multiline_comment|/* TODO: re-activate this warning as soon as we have a&n;&t;&t; * clean mirco code&n;&t;&t;qeth_ipaddr_to_string(addr-&gt;proto, (u8 *)&amp;addr-&gt;u, buf);&n;&t;&t;PRINT_WARN(&quot;Could not deregister IP address %s (rc=%x)&bslash;n&quot;,&n;&t;&t;&t;   buf, rc);&n;&t;&t;*/
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_register_addr_entry
id|qeth_register_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
r_return
id|qeth_layer2_register_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
r_return
id|qeth_layer3_register_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_deregister_addr_entry
id|qeth_deregister_addr_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
r_return
id|qeth_layer2_deregister_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
r_return
id|qeth_layer3_deregister_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_netdev_init
id|qeth_netdev_init
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;initdev&quot;
)paren
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
op_amp
id|qeth_tx_timeout
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
id|QETH_TX_TIMEOUT
suffix:semicolon
id|dev-&gt;open
op_assign
id|qeth_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|qeth_stop
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|qeth_hard_start_xmit
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|qeth_do_ioctl
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|qeth_get_stats
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|qeth_change_mtu
suffix:semicolon
id|dev-&gt;neigh_setup
op_assign
id|qeth_neigh_setup
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|qeth_set_multicast_list
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
id|dev-&gt;vlan_rx_register
op_assign
id|qeth_vlan_rx_register
suffix:semicolon
id|dev-&gt;vlan_rx_kill_vid
op_assign
id|qeth_vlan_rx_kill_vid
suffix:semicolon
id|dev-&gt;vlan_rx_add_vid
op_assign
id|qeth_vlan_rx_add_vid
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|qeth_get_netdev_flags
c_func
(paren
id|card
)paren
op_amp
id|IFF_NOARP
)paren
(brace
id|dev-&gt;rebuild_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;hard_header
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;header_cache_update
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;hard_header_cache
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
multiline_comment|/*IPv6 address autoconfiguration stuff*/
id|card-&gt;dev-&gt;dev_id
op_assign
id|card-&gt;info.unique_id
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|card-&gt;info.unique_id
op_amp
id|UNIQUE_ID_NOT_BY_CARD
)paren
)paren
id|card-&gt;dev-&gt;generate_eui64
op_assign
id|qeth_ipv6_generate_eui64
suffix:semicolon
macro_line|#endif
id|dev-&gt;hard_header_parse
op_assign
l_int|NULL
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|qeth_layer2_set_mac_address
suffix:semicolon
id|dev-&gt;flags
op_or_assign
id|qeth_get_netdev_flags
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;options.fake_broadcast
)paren
op_logical_or
(paren
id|card-&gt;info.broadcast_capable
)paren
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_BROADCAST
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|qeth_get_hlen
c_func
(paren
id|card-&gt;info.link_type
)paren
op_plus
id|card-&gt;options.add_hhlen
suffix:semicolon
id|dev-&gt;addr_len
op_assign
id|OSA_ADDR_LEN
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|card-&gt;info.initial_mtu
suffix:semicolon
id|SET_MODULE_OWNER
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_init_func_level
id|qeth_init_func_level
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;ipato.enabled
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
id|card-&gt;info.func_level
op_assign
id|QETH_IDX_FUNC_LEVEL_IQD_ENA_IPAT
suffix:semicolon
r_else
id|card-&gt;info.func_level
op_assign
id|QETH_IDX_FUNC_LEVEL_OSAE_ENA_IPAT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
id|card-&gt;info.func_level
op_assign
id|QETH_IDX_FUNC_LEVEL_IQD_DIS_IPAT
suffix:semicolon
r_else
id|card-&gt;info.func_level
op_assign
id|QETH_IDX_FUNC_LEVEL_OSAE_DIS_IPAT
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * hardsetup card, initialize MPC and QDIO stuff&n; */
r_static
r_int
DECL|function|qeth_hardsetup_card
id|qeth_hardsetup_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|retries
op_assign
l_int|3
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;hrdsetup&quot;
)paren
suffix:semicolon
id|retry
suffix:colon
r_if
c_cond
(paren
id|retries
OL
l_int|3
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Retrying to do IDX activates.&bslash;n&quot;
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_WDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_online
c_func
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_online
c_func
(paren
id|CARD_WDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_online
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_qdio_clear_card
c_func
(paren
id|card
comma
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;break1&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|retries
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_else
r_goto
id|retry
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_get_unitaddr
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|qeth_init_tokens
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_init_func_level
c_func
(paren
id|card
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_idx_activate_channel
c_func
(paren
op_amp
id|card-&gt;read
comma
id|qeth_idx_read_cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;break2&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|retries
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_else
r_goto
id|retry
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_idx_activate_channel
c_func
(paren
op_amp
id|card-&gt;write
comma
id|qeth_idx_write_cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERESTARTSYS
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;break3&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;4err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|retries
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_else
r_goto
id|retry
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_mpc_initialize
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;5err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* at first set_online allocate netdev */
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;dev
)paren
(brace
id|card-&gt;dev
op_assign
id|qeth_get_netdevice
c_func
(paren
id|card-&gt;info.type
comma
id|card-&gt;info.link_type
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;dev
)paren
(brace
id|qeth_qdio_clear_card
c_func
(paren
id|card
comma
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;6err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|card-&gt;dev-&gt;priv
op_assign
id|card
suffix:semicolon
id|card-&gt;dev-&gt;type
op_assign
id|qeth_get_arphdr_type
c_func
(paren
id|card-&gt;info.type
comma
id|card-&gt;info.link_type
)paren
suffix:semicolon
id|card-&gt;dev-&gt;init
op_assign
id|qeth_netdev_init
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|PRINT_ERR
c_func
(paren
l_string|&quot;Initialization in hardsetup failed! rc=%d&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_default_setassparms_cb
id|qeth_default_setassparms_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;defadpcb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.return_code
op_eq
l_int|0
)paren
(brace
id|cmd-&gt;hdr.return_code
op_assign
id|cmd-&gt;data.setassparms.hdr.return_code
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.prot_version
op_eq
id|QETH_PROT_IPV4
)paren
id|card-&gt;options.ipa4.enabled_funcs
op_assign
id|cmd-&gt;hdr.ipa_enabled
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_if
c_cond
(paren
id|cmd-&gt;hdr.prot_version
op_eq
id|QETH_PROT_IPV6
)paren
id|card-&gt;options.ipa6.enabled_funcs
op_assign
id|cmd-&gt;hdr.ipa_enabled
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|cmd-&gt;data.setassparms.hdr.assist_no
op_eq
id|IPA_INBOUND_CHECKSUM
op_logical_and
id|cmd-&gt;data.setassparms.hdr.command_code
op_eq
id|IPA_CMD_ASS_START
)paren
(brace
id|card-&gt;info.csum_mask
op_assign
id|cmd-&gt;data.setassparms.data.flags_32bit
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;csum:%d&quot;
comma
id|card-&gt;info.csum_mask
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_default_setadapterparms_cb
id|qeth_default_setadapterparms_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;defadpcb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.return_code
op_eq
l_int|0
)paren
id|cmd-&gt;hdr.return_code
op_assign
id|cmd-&gt;data.setadapterparms.hdr.return_code
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_query_setadapterparms_cb
id|qeth_query_setadapterparms_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;quyadpcb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;data.setadapterparms.data.query_cmds_supp.lan_type
op_amp
l_int|0x7f
)paren
id|card-&gt;info.link_type
op_assign
id|cmd-&gt;data.setadapterparms.data.query_cmds_supp.lan_type
suffix:semicolon
id|card-&gt;options.adp.supported_funcs
op_assign
id|cmd-&gt;data.setadapterparms.data.query_cmds_supp.supported_cmds
suffix:semicolon
r_return
id|qeth_default_setadapterparms_cb
c_func
(paren
id|card
comma
id|reply
comma
(paren
r_int
r_int
)paren
id|cmd
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_query_setadapterparms
id|qeth_query_setadapterparms
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;queryadp&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_adapter_cmd
c_func
(paren
id|card
comma
id|IPA_SETADP_QUERY_COMMANDS_SUPPORTED
comma
r_sizeof
(paren
r_struct
id|qeth_ipacmd_setadpparms
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|qeth_query_setadapterparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_setadpparms_change_macaddr_cb
id|qeth_setadpparms_change_macaddr_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;chgmaccb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
id|memcpy
c_func
(paren
id|card-&gt;dev-&gt;dev_addr
comma
op_amp
id|cmd-&gt;data.setadapterparms.data.change_addr.addr
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|qeth_default_setadapterparms_cb
c_func
(paren
id|card
comma
id|reply
comma
(paren
r_int
r_int
)paren
id|cmd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_setadpparms_change_macaddr
id|qeth_setadpparms_change_macaddr
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;chgmac&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_adapter_cmd
c_func
(paren
id|card
comma
id|IPA_SETADP_ALTER_MAC_ADDRESS
comma
r_sizeof
(paren
r_struct
id|qeth_ipacmd_setadpparms
)paren
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setadapterparms.data.change_addr.cmd
op_assign
id|CHANGE_ADDR_READ_MAC
suffix:semicolon
id|cmd-&gt;data.setadapterparms.data.change_addr.addr_size
op_assign
id|OSA_ADDR_LEN
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setadapterparms.data.change_addr.addr
comma
id|card-&gt;dev-&gt;dev_addr
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|qeth_setadpparms_change_macaddr_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_setadp_mode
id|qeth_send_setadp_mode
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
id|__u32
id|command
comma
id|__u32
id|mode
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;adpmode&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_adapter_cmd
c_func
(paren
id|card
comma
id|command
comma
r_sizeof
(paren
r_struct
id|qeth_ipacmd_setadpparms
)paren
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setadapterparms.data.mode
op_assign
id|mode
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|qeth_default_setadapterparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_setadapter_hstr
id|qeth_setadapter_hstr
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;adphstr&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_adp_supported
c_func
(paren
id|card
comma
id|IPA_SETADP_SET_BROADCAST_MODE
)paren
)paren
(brace
id|rc
op_assign
id|qeth_send_setadp_mode
c_func
(paren
id|card
comma
id|IPA_SETADP_SET_BROADCAST_MODE
comma
id|card-&gt;options.broadcast_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t set broadcast mode on &quot;
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setadp_mode
c_func
(paren
id|card
comma
id|IPA_SETADP_ALTER_MAC_ADDRESS
comma
id|card-&gt;options.macaddr_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t set macaddr mode on &quot;
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;options.broadcast_mode
op_eq
id|QETH_TR_BROADCAST_LOCAL
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;set adapter parameters not available &quot;
l_string|&quot;to set broadcast mode, using ALLRINGS &quot;
l_string|&quot;on device %s:&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.macaddr_mode
op_eq
id|QETH_TR_MACADDR_CANONICAL
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;set adapter parameters not available &quot;
l_string|&quot;to set macaddr mode, using NONCANONICAL &quot;
l_string|&quot;on device %s:&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_setadapter_parms
id|qeth_setadapter_parms
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;setadprm&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_SETADAPTERPARMS
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;set adapter parameters not supported &quot;
l_string|&quot;on device %s.&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot; notsupp&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_query_setadapterparms
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t set adapter parameters on device %s: &quot;
l_string|&quot;x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qeth_adp_supported
c_func
(paren
id|card
comma
id|IPA_SETADP_ALTER_MAC_ADDRESS
)paren
)paren
(brace
id|rc
op_assign
id|qeth_setadpparms_change_macaddr
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t get MAC address on &quot;
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card-&gt;info.link_type
op_eq
id|QETH_LINK_TYPE_HSTR
)paren
op_logical_or
(paren
id|card-&gt;info.link_type
op_eq
id|QETH_LINK_TYPE_LANE_TR
)paren
)paren
id|rc
op_assign
id|qeth_setadapter_hstr
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_layer2_initialize
id|qeth_layer2_initialize
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;doL2init&quot;
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;doL2%s&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_setadpparms_change_macaddr
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t get MAC address on &quot;
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
id|card-&gt;dev-&gt;dev_addr
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
op_amp
id|card-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
comma
id|IPA_CMD_SETVMAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|card-&gt;info.layer2_mac_registered
op_assign
l_int|0
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error in processing MAC address on &quot;
"&bslash;"
l_string|&quot;device %s: x%x&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|rc
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
id|card-&gt;info.layer2_mac_registered
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_startstoplan
id|qeth_send_startstoplan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_ipa_cmds
id|ipacmd
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|ipacmd
comma
id|prot
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_startlan
id|qeth_send_startlan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;strtlan%i&quot;
comma
id|prot
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_startstoplan
c_func
(paren
id|card
comma
id|IPA_CMD_STARTLAN
comma
id|prot
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_stoplan
id|qeth_send_stoplan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * TODO: according to the IPA format document page 14,&n;&t; * TCP/IP (we!) never issue a STOPLAN&n;&t; * is this right ?!?&n;&t; */
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;stoplan&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_startstoplan
c_func
(paren
id|card
comma
id|IPA_CMD_STOPLAN
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_query_ipassists_cb
id|qeth_query_ipassists_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;qipasscb&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.prot_version
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|card-&gt;options.ipa4.supported_funcs
op_assign
id|cmd-&gt;hdr.ipa_supported
suffix:semicolon
id|card-&gt;options.ipa4.enabled_funcs
op_assign
id|cmd-&gt;hdr.ipa_enabled
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef CONFIG_QETH_IPV6
id|card-&gt;options.ipa6.supported_funcs
op_assign
id|cmd-&gt;hdr.ipa_supported
suffix:semicolon
id|card-&gt;options.ipa6.enabled_funcs
op_assign
id|cmd-&gt;hdr.ipa_enabled
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_query_ipassists
id|qeth_query_ipassists
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;qipassi%i&quot;
comma
id|prot
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;noprmly2&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_QIPASSIST
comma
id|prot
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|qeth_query_ipassists_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_struct
id|qeth_cmd_buffer
op_star
DECL|function|qeth_get_setassparms_cmd
id|qeth_get_setassparms_cmd
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_ipa_funcs
id|ipa_func
comma
id|__u16
id|cmd_code
comma
id|__u16
id|len
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;getasscm&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_SETASSPARMS
comma
id|prot
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setassparms.hdr.assist_no
op_assign
id|ipa_func
suffix:semicolon
id|cmd-&gt;data.setassparms.hdr.length
op_assign
l_int|8
op_plus
id|len
suffix:semicolon
id|cmd-&gt;data.setassparms.hdr.command_code
op_assign
id|cmd_code
suffix:semicolon
id|cmd-&gt;data.setassparms.hdr.return_code
op_assign
l_int|0
suffix:semicolon
id|cmd-&gt;data.setassparms.hdr.seq_no
op_assign
l_int|0
suffix:semicolon
r_return
id|iob
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_setassparms
id|qeth_send_setassparms
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_cmd_buffer
op_star
id|iob
comma
id|__u16
id|len
comma
r_int
id|data
comma
r_int
(paren
op_star
id|reply_cb
)paren
(paren
r_struct
id|qeth_card
op_star
comma
r_struct
id|qeth_reply
op_star
comma
r_int
r_int
)paren
comma
r_void
op_star
id|reply_param
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;sendassp&quot;
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
r_sizeof
(paren
id|__u32
)paren
)paren
id|cmd-&gt;data.setassparms.data.flags_32bit
op_assign
(paren
id|__u32
)paren
id|data
suffix:semicolon
r_else
r_if
c_cond
(paren
id|len
OG
r_sizeof
(paren
id|__u32
)paren
)paren
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.setassparms.data
comma
(paren
r_void
op_star
)paren
id|data
comma
id|len
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|reply_cb
comma
id|reply_param
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_int
DECL|function|qeth_send_simple_setassparms_ipv6
id|qeth_send_simple_setassparms_ipv6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_ipa_funcs
id|ipa_func
comma
id|__u16
id|cmd_code
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;simassp6&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_setassparms_cmd
c_func
(paren
id|card
comma
id|ipa_func
comma
id|cmd_code
comma
l_int|0
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setassparms
c_func
(paren
id|card
comma
id|iob
comma
l_int|0
comma
l_int|0
comma
id|qeth_default_setassparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|qeth_send_simple_setassparms
id|qeth_send_simple_setassparms
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_ipa_funcs
id|ipa_func
comma
id|__u16
id|cmd_code
comma
r_int
id|data
)paren
(brace
r_int
id|rc
suffix:semicolon
r_int
id|length
op_assign
l_int|0
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;simassp4&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
id|length
op_assign
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_setassparms_cmd
c_func
(paren
id|card
comma
id|ipa_func
comma
id|cmd_code
comma
id|length
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setassparms
c_func
(paren
id|card
comma
id|iob
comma
id|length
comma
id|data
comma
id|qeth_default_setassparms_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_start_ipa_arp_processing
id|qeth_start_ipa_arp_processing
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;ipaarp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ARP processing not supported &quot;
l_string|&quot;on %s!&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_ARP_PROCESSING
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not start ARP processing &quot;
l_string|&quot;assist on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_ip_fragmentation
id|qeth_start_ipa_ip_fragmentation
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;ipaipfrg&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IP_FRAGMENTATION
)paren
)paren
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Hardware IP fragmentation not supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_IP_FRAGMENTATION
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not start Hardware IP fragmentation &quot;
l_string|&quot;assist on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
id|PRINT_INFO
c_func
(paren
l_string|&quot;Hardware IP fragmentation enabled &bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_source_mac
id|qeth_start_ipa_source_mac
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;stsrcmac&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;options.fake_ll
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_SOURCE_MAC
)paren
)paren
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Inbound source address not &quot;
l_string|&quot;supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_SOURCE_MAC
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not start inbound source &quot;
l_string|&quot;assist on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_vlan
id|qeth_start_ipa_vlan
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;strtvlan&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_FULL_VLAN
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;VLAN not supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_VLAN_PRIO
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not start vlan &quot;
l_string|&quot;assist on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;VLAN enabled &bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_FILTER
op_or
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
)brace
macro_line|#endif /* QETH_VLAN */
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_multicast
id|qeth_start_ipa_multicast
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;stmcast&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_MULTICASTING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Multicast not supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_MULTICASTING
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not start multicast &quot;
l_string|&quot;assist on %s: rc=%i&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;Multicast enabled&bslash;n&quot;
)paren
suffix:semicolon
id|card-&gt;dev-&gt;flags
op_or_assign
id|IFF_MULTICAST
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_int
DECL|function|qeth_softsetup_ipv6
id|qeth_softsetup_ipv6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;softipv6&quot;
)paren
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_startlan
c_func
(paren
id|card
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;IPv6 startlan failed on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|netif_wake_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_query_ipassists
c_func
(paren
id|card
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;IPv6 query ipassist failed on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_IPV6
comma
id|IPA_CMD_ASS_START
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;IPv6 start assist (version 4) failed &quot;
l_string|&quot;on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms_ipv6
c_func
(paren
id|card
comma
id|IPA_IPV6
comma
id|IPA_CMD_ASS_START
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;IPV6 start assist (version 6) failed  &quot;
l_string|&quot;on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms_ipv6
c_func
(paren
id|card
comma
id|IPA_PASSTHRU
comma
id|IPA_CMD_ASS_START
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not enable passthrough &quot;
l_string|&quot;on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;IPV6 enabled &bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|qeth_start_ipa_ipv6
id|qeth_start_ipa_ipv6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;strtipv6&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IPV6
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;IPv6 not supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_softsetup_ipv6
c_func
(paren
id|card
)paren
suffix:semicolon
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_broadcast
id|qeth_start_ipa_broadcast
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;stbrdcst&quot;
)paren
suffix:semicolon
id|card-&gt;info.broadcast_capable
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_FILTERING
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Broadcast not supported on %s&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_FILTERING
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not enable broadcasting filtering &quot;
l_string|&quot;on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_FILTERING
comma
id|IPA_CMD_ASS_CONFIGURE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not set up broadcast filtering on %s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|card-&gt;info.broadcast_capable
op_assign
id|QETH_BROADCAST_WITH_ECHO
suffix:semicolon
id|PRINT_INFO
c_func
(paren
l_string|&quot;Broadcast enabled &bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_FILTERING
comma
id|IPA_CMD_ASS_ENABLE
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Could not set up broadcast echo filtering on &quot;
l_string|&quot;%s: 0x%x&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|card-&gt;info.broadcast_capable
op_assign
id|QETH_BROADCAST_WITHOUT_ECHO
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|card-&gt;info.broadcast_capable
)paren
id|card-&gt;dev-&gt;flags
op_or_assign
id|IFF_BROADCAST
suffix:semicolon
r_else
id|card-&gt;dev-&gt;flags
op_and_assign
op_complement
id|IFF_BROADCAST
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_checksum_command
id|qeth_send_checksum_command
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_INBOUND_CHECKSUM
comma
id|IPA_CMD_ASS_START
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Starting Inbound HW Checksumming failed on %s: &quot;
l_string|&quot;0x%x,&bslash;ncontinuing using Inbound SW Checksumming&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_simple_setassparms
c_func
(paren
id|card
comma
id|IPA_INBOUND_CHECKSUM
comma
id|IPA_CMD_ASS_ENABLE
comma
id|card-&gt;info.csum_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Enabling Inbound HW Checksumming failed on %s: &quot;
l_string|&quot;0x%x,&bslash;ncontinuing using Inbound SW Checksumming&bslash;n&quot;
comma
id|card-&gt;info.if_name
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_start_ipa_checksum
id|qeth_start_ipa_checksum
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;strtcsum&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.checksum_type
op_eq
id|NO_CHECKSUMMING
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Using no checksumming on %s.&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;options.checksum_type
op_eq
id|SW_CHECKSUMMING
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Using SW checksumming on %s.&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_INBOUND_CHECKSUM
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Inbound HW Checksumming not &quot;
l_string|&quot;supported on %s,&bslash;ncontinuing &quot;
l_string|&quot;using Inbound SW Checksumming&bslash;n&quot;
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
id|card-&gt;options.checksum_type
op_assign
id|SW_CHECKSUMMING
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rc
op_assign
id|qeth_send_checksum_command
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|PRINT_INFO
c_func
(paren
l_string|&quot;HW Checksumming (inbound) enabled &bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n;static inline void&n;qeth_print_ipassist_status(struct qeth_card *card)&n;{&n;&t;char buf[255];&n;&t;int offset = 0;&n;&n;&t;offset += sprintf(buf, &quot;IPAssist options of %s: &quot;, card-&gt;info.if_name);&n;&t;if (qeth_is_enabled(card, IPA_ARP_PROCESSING))&n;&t;&t;offset += sprintf(buf+offset, &quot;ARP &quot;);&n;&t;if (qeth_is_enabled(card, IPA_IP_FRAGMENTATION))&n;&t;&t;offset += sprintf(buf+offset, &quot;IP_FRAG&quot;);&n;&t;if (qeth_is_enabled(card, IPA_SOURCE_MAC))&n;&t;&t;offset += sprintf(buf+offset, &quot;SRC_MAC&quot;);&n;&t;if (qeth_is_enabled(card, IPA_FULL_VLAN))&n;&t;&t;offset += sprintf(buf+offset, &quot;VLAN&quot;);&n;&t;if (qeth_is_enabled(card, IPA_VLAN_PRIO))&n;&t;&t;offset += sprintf(buf+offset, &quot;VLAN_PRIO&quot;);&n;}&n;*/
r_static
r_int
DECL|function|qeth_start_ipassists
id|qeth_start_ipassists
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;strtipas&quot;
)paren
suffix:semicolon
id|qeth_start_ipa_arp_processing
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_ip_fragmentation
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_source_mac
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_vlan
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_multicast
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_ipv6
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_broadcast
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
id|qeth_start_ipa_checksum
c_func
(paren
id|card
)paren
suffix:semicolon
multiline_comment|/* go on*/
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_send_setrouting
id|qeth_send_setrouting
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_routing_types
id|type
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_int
id|rc
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;setroutg&quot;
)paren
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_SETRTG
comma
id|prot
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
id|cmd-&gt;data.setrtg.type
op_assign
(paren
id|type
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_correct_routing_type
id|qeth_correct_routing_type
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_routing_types
op_star
id|type
comma
r_enum
id|qeth_prot_versions
id|prot
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
(brace
r_switch
c_cond
(paren
op_star
id|type
)paren
(brace
r_case
id|NO_ROUTER
suffix:colon
r_case
id|PRIMARY_CONNECTOR
suffix:colon
r_case
id|SECONDARY_CONNECTOR
suffix:colon
r_case
id|MULTICAST_ROUTER
suffix:colon
r_return
suffix:semicolon
r_default
suffix:colon
r_goto
id|out_inval
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
op_star
id|type
)paren
(brace
r_case
id|NO_ROUTER
suffix:colon
r_case
id|PRIMARY_ROUTER
suffix:colon
r_case
id|SECONDARY_ROUTER
suffix:colon
r_return
suffix:semicolon
r_case
id|MULTICAST_ROUTER
suffix:colon
r_if
c_cond
(paren
id|qeth_is_ipafunc_supported
c_func
(paren
id|card
comma
id|prot
comma
id|IPA_OSA_MC_ROUTER
)paren
)paren
r_return
suffix:semicolon
r_default
suffix:colon
r_goto
id|out_inval
suffix:semicolon
)brace
)brace
id|out_inval
suffix:colon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Routing type &squot;%s&squot; not supported for interface %s.&bslash;n&quot;
l_string|&quot;Router status set to &squot;no router&squot;.&bslash;n&quot;
comma
(paren
(paren
op_star
id|type
op_eq
id|PRIMARY_ROUTER
)paren
ques
c_cond
l_string|&quot;primary router&quot;
suffix:colon
(paren
op_star
id|type
op_eq
id|SECONDARY_ROUTER
)paren
ques
c_cond
l_string|&quot;secondary router&quot;
suffix:colon
(paren
op_star
id|type
op_eq
id|PRIMARY_CONNECTOR
)paren
ques
c_cond
l_string|&quot;primary connector&quot;
suffix:colon
(paren
op_star
id|type
op_eq
id|SECONDARY_CONNECTOR
)paren
ques
c_cond
l_string|&quot;secondary connector&quot;
suffix:colon
(paren
op_star
id|type
op_eq
id|MULTICAST_ROUTER
)paren
ques
c_cond
l_string|&quot;multicast router&quot;
suffix:colon
l_string|&quot;unknown&quot;
)paren
comma
id|card-&gt;dev-&gt;name
)paren
suffix:semicolon
op_star
id|type
op_assign
id|NO_ROUTER
suffix:semicolon
)brace
r_int
DECL|function|qeth_setrouting_v4
id|qeth_setrouting_v4
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setrtg4&quot;
)paren
suffix:semicolon
id|qeth_correct_routing_type
c_func
(paren
id|card
comma
op_amp
id|card-&gt;options.route4.type
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_setrouting
c_func
(paren
id|card
comma
id|card-&gt;options.route4.type
comma
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|card-&gt;options.route4.type
op_assign
id|NO_ROUTER
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error (0x%04x) while setting routing type on %s. &quot;
l_string|&quot;Type set to &squot;no router&squot;.&bslash;n&quot;
comma
id|rc
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|qeth_setrouting_v6
id|qeth_setrouting_v6
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;setrtg6&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|qeth_correct_routing_type
c_func
(paren
id|card
comma
op_amp
id|card-&gt;options.route6.type
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;options.route6.type
op_eq
id|NO_ROUTER
)paren
op_logical_or
(paren
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_OSAE
)paren
op_logical_and
(paren
id|card-&gt;options.route6.type
op_eq
id|MULTICAST_ROUTER
)paren
op_logical_and
op_logical_neg
id|qeth_is_supported6
c_func
(paren
id|card
comma
id|IPA_OSA_MC_ROUTER
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|rc
op_assign
id|qeth_send_setrouting
c_func
(paren
id|card
comma
id|card-&gt;options.route6.type
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|card-&gt;options.route6.type
op_assign
id|NO_ROUTER
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;Error (0x%04x) while setting routing type on %s. &quot;
l_string|&quot;Type set to &squot;no router&squot;.&bslash;n&quot;
comma
id|rc
comma
id|card-&gt;info.if_name
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * softsetup card: init IPA stuff&n; */
r_static
r_int
DECL|function|qeth_softsetup_card
id|qeth_softsetup_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;softsetp&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_send_startlan
c_func
(paren
id|card
comma
id|QETH_PROT_IPV4
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0xe080
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;LAN on card %s if offline! &quot;
l_string|&quot;Continuing softsetup.&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|card-&gt;lan_online
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
id|rc
suffix:semicolon
)brace
r_else
id|card-&gt;lan_online
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
(brace
id|card-&gt;dev-&gt;features
op_or_assign
id|NETIF_F_HW_VLAN_FILTER
op_or
id|NETIF_F_HW_VLAN_TX
op_or
id|NETIF_F_HW_VLAN_RX
suffix:semicolon
id|card-&gt;dev-&gt;flags
op_or_assign
id|IFF_MULTICAST
op_or
id|IFF_BROADCAST
suffix:semicolon
id|card-&gt;info.broadcast_capable
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_layer2_initialize
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;L2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_VLAN
id|qeth_layer2_process_vlans
c_func
(paren
id|card
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_setadapter_parms
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_start_ipassists
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_setrouting_v4
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;4err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_setrouting_v6
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;5err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|out
suffix:colon
id|netif_stop_queue
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_int
DECL|function|qeth_get_unique_id_cb
id|qeth_get_unique_id_cb
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_reply
op_star
id|reply
comma
r_int
r_int
id|data
)paren
(brace
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
id|cmd-&gt;hdr.return_code
op_eq
l_int|0
)paren
id|card-&gt;info.unique_id
op_assign
op_star
(paren
(paren
id|__u16
op_star
)paren
op_amp
id|cmd-&gt;data.create_destroy_addr.unique_id
(braket
l_int|6
)braket
)paren
suffix:semicolon
r_else
(brace
id|card-&gt;info.unique_id
op_assign
id|UNIQUE_ID_IF_CREATE_ADDR_FAILED
op_or
id|UNIQUE_ID_NOT_BY_CARD
suffix:semicolon
id|PRINT_WARN
c_func
(paren
l_string|&quot;couldn&squot;t get a unique id from the card on device &quot;
l_string|&quot;%s (result=x%x), using default id. ipv6 &quot;
l_string|&quot;autoconfig on other lpars may lead to duplicate &quot;
l_string|&quot;ip addresses. please use manually &quot;
l_string|&quot;configured ones.&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
comma
id|cmd-&gt;hdr.return_code
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|qeth_put_unique_id
id|qeth_put_unique_id
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;puniqeid&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|card-&gt;info.unique_id
op_amp
id|UNIQUE_ID_NOT_BY_CARD
)paren
op_eq
id|UNIQUE_ID_NOT_BY_CARD
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_DESTROY_ADDR
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
op_amp
id|cmd-&gt;data.create_destroy_addr.unique_id
(braket
l_int|6
)braket
)paren
op_assign
id|card-&gt;info.unique_id
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|cmd-&gt;data.create_destroy_addr.unique_id
(braket
l_int|0
)braket
comma
id|card-&gt;dev-&gt;dev_addr
comma
id|OSA_ADDR_LEN
)paren
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|card-&gt;info.unique_id
op_assign
id|UNIQUE_ID_IF_CREATE_ADDR_FAILED
op_or
id|UNIQUE_ID_NOT_BY_CARD
suffix:semicolon
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * Clear IP List&n; */
r_static
r_void
DECL|function|qeth_clear_ip_list
id|qeth_clear_ip_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
id|clean
comma
r_int
id|recover
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|addr
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|4
comma
l_string|&quot;clearip&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* clear todo list */
(def_block
id|list_for_each_entry_safe
c_func
(paren
id|addr
comma
id|tmp
comma
id|card-&gt;ip_tbd_list
comma
id|entry
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|addr-&gt;entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
)brace
)def_block
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|card-&gt;ip_list
)paren
)paren
(brace
id|addr
op_assign
id|list_entry
c_func
(paren
id|card-&gt;ip_list.next
comma
r_struct
id|qeth_ipaddr
comma
id|entry
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|addr-&gt;entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clean
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|qeth_deregister_addr_entry
c_func
(paren
id|card
comma
id|addr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|recover
op_logical_or
id|addr-&gt;is_multicast
)paren
(brace
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|list_add_tail
c_func
(paren
op_amp
id|addr-&gt;entry
comma
id|card-&gt;ip_tbd_list
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_set_allowed_threads
id|qeth_set_allowed_threads
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|threads
comma
r_int
id|clear_start_mask
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;thread_allowed_mask
op_assign
id|threads
suffix:semicolon
r_if
c_cond
(paren
id|clear_start_mask
)paren
id|card-&gt;thread_start_mask
op_and_assign
id|threads
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|card-&gt;wait_q
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_threads_running
id|qeth_threads_running
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|threads
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
id|rc
op_assign
(paren
id|card-&gt;thread_running_mask
op_amp
id|threads
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;thread_mask_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_wait_for_threads
id|qeth_wait_for_threads
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_int
r_int
id|threads
)paren
(brace
r_return
id|wait_event_interruptible
c_func
(paren
id|card-&gt;wait_q
comma
id|qeth_threads_running
c_func
(paren
id|card
comma
id|threads
)paren
op_eq
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_stop_card
id|qeth_stop_card
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;stopcard&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|qeth_set_allowed_threads
c_func
(paren
id|card
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_wait_for_threads
c_func
(paren
id|card
comma
op_complement
id|QETH_RECOVER_THREAD
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;read.state
op_eq
id|CH_STATE_UP
op_logical_and
id|card-&gt;write.state
op_eq
id|CH_STATE_UP
op_logical_and
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_UP
)paren
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev_close
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;use_hard_stop
)paren
(brace
id|__u8
op_star
id|mac
op_assign
op_amp
id|card-&gt;dev-&gt;dev_addr
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_layer2_send_setdelmac
c_func
(paren
id|card
comma
id|mac
comma
id|IPA_CMD_DELVMAC
)paren
)paren
)paren
suffix:semicolon
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;Lerr%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_send_stoplan
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
)brace
id|card-&gt;state
op_assign
id|CARD_STATE_SOFTSETUP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_SOFTSETUP
)paren
(brace
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|qeth_layer2_process_vlans
c_func
(paren
id|card
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|qeth_clear_ip_list
c_func
(paren
id|card
comma
op_logical_neg
id|card-&gt;use_hard_stop
comma
l_int|1
)paren
suffix:semicolon
id|qeth_clear_ipacmd_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;state
op_assign
id|CARD_STATE_HARDSETUP
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_HARDSETUP
)paren
(brace
r_if
c_cond
(paren
(paren
op_logical_neg
id|card-&gt;use_hard_stop
)paren
op_logical_and
(paren
op_logical_neg
id|card-&gt;options.layer2
)paren
)paren
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_put_unique_id
c_func
(paren
id|card
)paren
)paren
)paren
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
id|qeth_qdio_clear_card
c_func
(paren
id|card
comma
l_int|0
)paren
suffix:semicolon
id|qeth_clear_qdio_buffers
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_clear_working_pool_list
c_func
(paren
id|card
)paren
suffix:semicolon
id|card-&gt;state
op_assign
id|CARD_STATE_DOWN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;state
op_eq
id|CARD_STATE_DOWN
)paren
(brace
id|qeth_clear_cmd_buffers
c_func
(paren
op_amp
id|card-&gt;read
)paren
suffix:semicolon
id|qeth_clear_cmd_buffers
c_func
(paren
op_amp
id|card-&gt;write
)paren
suffix:semicolon
)brace
id|card-&gt;use_hard_stop
op_assign
l_int|0
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_get_unique_id
id|qeth_get_unique_id
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_struct
id|qeth_cmd_buffer
op_star
id|iob
suffix:semicolon
r_struct
id|qeth_ipa_cmd
op_star
id|cmd
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;guniqeid&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IPV6
)paren
)paren
(brace
id|card-&gt;info.unique_id
op_assign
id|UNIQUE_ID_IF_CREATE_ADDR_FAILED
op_or
id|UNIQUE_ID_NOT_BY_CARD
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|iob
op_assign
id|qeth_get_ipacmd_buffer
c_func
(paren
id|card
comma
id|IPA_CMD_CREATE_ADDR
comma
id|QETH_PROT_IPV6
)paren
suffix:semicolon
id|cmd
op_assign
(paren
r_struct
id|qeth_ipa_cmd
op_star
)paren
(paren
id|iob-&gt;data
op_plus
id|IPA_PDU_HEADER_SIZE
)paren
suffix:semicolon
op_star
(paren
(paren
id|__u16
op_star
)paren
op_amp
id|cmd-&gt;data.create_destroy_addr.unique_id
(braket
l_int|6
)braket
)paren
op_assign
id|card-&gt;info.unique_id
suffix:semicolon
id|rc
op_assign
id|qeth_send_ipa_cmd
c_func
(paren
id|card
comma
id|iob
comma
id|qeth_get_unique_id_cb
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
id|card-&gt;info.unique_id
op_assign
id|UNIQUE_ID_IF_CREATE_ADDR_FAILED
op_or
id|UNIQUE_ID_NOT_BY_CARD
suffix:semicolon
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_print_status_with_portname
id|qeth_print_status_with_portname
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%s&quot;
comma
id|card-&gt;info.portname
op_plus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|dbf_text
(braket
id|i
)braket
op_assign
(paren
r_char
)paren
id|_ebcasc
(braket
(paren
id|__u8
)paren
id|dbf_text
(braket
id|i
)braket
)braket
suffix:semicolon
id|dbf_text
(braket
l_int|8
)braket
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qeth: Device %s/%s/%s is a%s card%s%s%s&bslash;n&quot;
l_string|&quot;with link type %s (portname: %s)&bslash;n&quot;
comma
id|CARD_RDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_WDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
comma
id|qeth_get_cardname
c_func
(paren
id|card
)paren
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot; (level: &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
id|card-&gt;info.mcl_level
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot;)&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|qeth_get_cardname_short
c_func
(paren
id|card
)paren
comma
id|dbf_text
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_print_status_no_portname
id|qeth_print_status_no_portname
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;info.portname
(braket
l_int|0
)braket
)paren
id|printk
c_func
(paren
l_string|&quot;qeth: Device %s/%s/%s is a%s &quot;
l_string|&quot;card%s%s%s&bslash;nwith link type %s &quot;
l_string|&quot;(no portname needed by interface).&bslash;n&quot;
comma
id|CARD_RDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_WDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
comma
id|qeth_get_cardname
c_func
(paren
id|card
)paren
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot; (level: &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
id|card-&gt;info.mcl_level
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot;)&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|qeth_get_cardname_short
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;qeth: Device %s/%s/%s is a%s &quot;
l_string|&quot;card%s%s%s&bslash;nwith link type %s.&bslash;n&quot;
comma
id|CARD_RDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_WDEV_ID
c_func
(paren
id|card
)paren
comma
id|CARD_DDEV_ID
c_func
(paren
id|card
)paren
comma
id|qeth_get_cardname
c_func
(paren
id|card
)paren
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot; (level: &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
id|card-&gt;info.mcl_level
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
ques
c_cond
l_string|&quot;)&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|qeth_get_cardname_short
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_print_status_message
id|qeth_print_status_message
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_switch
c_cond
(paren
id|card-&gt;info.type
)paren
(brace
r_case
id|QETH_CARD_TYPE_OSAE
suffix:colon
multiline_comment|/* VM will use a non-zero first character&n;&t;&t; * to indicate a HiperSockets like reporting&n;&t;&t; * of the level OSA sets the first character to zero&n;&t;&t; * */
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)paren
(brace
id|sprintf
c_func
(paren
id|card-&gt;info.mcl_level
comma
l_string|&quot;%02x%02x&quot;
comma
id|card-&gt;info.mcl_level
(braket
l_int|2
)braket
comma
id|card-&gt;info.mcl_level
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|card-&gt;info.mcl_level
(braket
id|QETH_MCL_LENGTH
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* fallthrough */
r_case
id|QETH_CARD_TYPE_IQD
suffix:colon
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
op_assign
(paren
r_char
)paren
id|_ebcasc
(braket
(paren
id|__u8
)paren
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
)braket
suffix:semicolon
id|card-&gt;info.mcl_level
(braket
l_int|1
)braket
op_assign
(paren
r_char
)paren
id|_ebcasc
(braket
(paren
id|__u8
)paren
id|card-&gt;info.mcl_level
(braket
l_int|1
)braket
)braket
suffix:semicolon
id|card-&gt;info.mcl_level
(braket
l_int|2
)braket
op_assign
(paren
r_char
)paren
id|_ebcasc
(braket
(paren
id|__u8
)paren
id|card-&gt;info.mcl_level
(braket
l_int|2
)braket
)braket
suffix:semicolon
id|card-&gt;info.mcl_level
(braket
l_int|3
)braket
op_assign
(paren
r_char
)paren
id|_ebcasc
(braket
(paren
id|__u8
)paren
id|card-&gt;info.mcl_level
(braket
l_int|3
)braket
)braket
suffix:semicolon
id|card-&gt;info.mcl_level
(braket
id|QETH_MCL_LENGTH
)braket
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|memset
c_func
(paren
op_amp
id|card-&gt;info.mcl_level
(braket
l_int|0
)braket
comma
l_int|0
comma
id|QETH_MCL_LENGTH
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;info.portname_required
)paren
id|qeth_print_status_with_portname
c_func
(paren
id|card
)paren
suffix:semicolon
r_else
id|qeth_print_status_no_portname
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_register_netdev
id|qeth_register_netdev
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_int
id|rc
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|3
comma
l_string|&quot;regnetd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;dev-&gt;reg_state
op_ne
id|NETREG_UNINITIALIZED
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* sysfs magic */
id|SET_NETDEV_DEV
c_func
(paren
id|card-&gt;dev
comma
op_amp
id|card-&gt;gdev-&gt;dev
)paren
suffix:semicolon
id|rc
op_assign
id|register_netdev
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|strcpy
c_func
(paren
id|card-&gt;info.if_name
comma
id|card-&gt;dev-&gt;name
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_start_again
id|qeth_start_again
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;startag&quot;
)paren
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev_open
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* this also sets saved unicast addresses */
id|qeth_set_multicast_list
c_func
(paren
id|card-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Layer 2 specific stuff */
DECL|macro|IGNORE_PARAM_EQ
mdefine_line|#define IGNORE_PARAM_EQ(option,value,reset_value,msg) &bslash;&n;        if (card-&gt;options.option == value) { &bslash;&n;                PRINT_ERR(&quot;%s not supported with layer 2 &quot; &bslash;&n;                          &quot;functionality, ignoring option on read&quot; &bslash;&n;&t;&t;&t;  &quot;channel device %s .&bslash;n&quot;,msg,CARD_RDEV_ID(card)); &bslash;&n;                card-&gt;options.option = reset_value; &bslash;&n;        }
DECL|macro|IGNORE_PARAM_NEQ
mdefine_line|#define IGNORE_PARAM_NEQ(option,value,reset_value,msg) &bslash;&n;        if (card-&gt;options.option != value) { &bslash;&n;                PRINT_ERR(&quot;%s not supported with layer 2 &quot; &bslash;&n;                          &quot;functionality, ignoring option on read&quot; &bslash;&n;&t;&t;&t;  &quot;channel device %s .&bslash;n&quot;,msg,CARD_RDEV_ID(card)); &bslash;&n;                card-&gt;options.option = reset_value; &bslash;&n;        }
DECL|function|qeth_make_parameters_consistent
r_static
r_void
id|qeth_make_parameters_consistent
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;info.type
op_eq
id|QETH_CARD_TYPE_IQD
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;Device %s does not support &quot;
"&bslash;"
l_string|&quot;layer 2 functionality. &quot;
"&bslash;"
l_string|&quot;Ignoring layer2 option.&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
)brace
id|IGNORE_PARAM_NEQ
c_func
(paren
id|route4.type
comma
id|NO_ROUTER
comma
id|NO_ROUTER
comma
l_string|&quot;Routing options are&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|IGNORE_PARAM_NEQ
c_func
(paren
id|route6.type
comma
id|NO_ROUTER
comma
id|NO_ROUTER
comma
l_string|&quot;Routing options are&quot;
)paren
suffix:semicolon
macro_line|#endif
id|IGNORE_PARAM_EQ
c_func
(paren
id|checksum_type
comma
id|HW_CHECKSUMMING
comma
id|QETH_CHECKSUM_DEFAULT
comma
l_string|&quot;Checksumming options are&quot;
)paren
suffix:semicolon
id|IGNORE_PARAM_NEQ
c_func
(paren
id|broadcast_mode
comma
id|QETH_TR_BROADCAST_ALLRINGS
comma
id|QETH_TR_BROADCAST_ALLRINGS
comma
l_string|&quot;Broadcast mode options are&quot;
)paren
suffix:semicolon
id|IGNORE_PARAM_NEQ
c_func
(paren
id|macaddr_mode
comma
id|QETH_TR_MACADDR_NONCANONICAL
comma
id|QETH_TR_MACADDR_NONCANONICAL
comma
l_string|&quot;Canonical MAC addr options are&quot;
)paren
suffix:semicolon
id|IGNORE_PARAM_NEQ
c_func
(paren
id|fake_broadcast
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Broadcast faking options are&quot;
)paren
suffix:semicolon
id|IGNORE_PARAM_NEQ
c_func
(paren
id|add_hhlen
comma
id|DEFAULT_ADD_HHLEN
comma
id|DEFAULT_ADD_HHLEN
comma
l_string|&quot;Option add_hhlen is&quot;
)paren
suffix:semicolon
id|IGNORE_PARAM_NEQ
c_func
(paren
id|fake_ll
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;Option fake_ll is&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|qeth_set_online
id|qeth_set_online
c_func
(paren
r_struct
id|ccwgroup_device
op_star
id|gdev
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
op_assign
id|gdev-&gt;dev.driver_data
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_enum
id|qeth_card_states
id|recover_flag
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|card
)paren
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;setonlin&quot;
)paren
suffix:semicolon
id|QETH_DBF_HEX
c_func
(paren
id|setup
comma
l_int|2
comma
op_amp
id|card
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|qeth_set_allowed_threads
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_wait_for_threads
c_func
(paren
id|card
comma
op_complement
id|QETH_RECOVER_THREAD
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;set_online of card %s interrupted by user!&bslash;n&quot;
comma
id|CARD_BUS_ID
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
id|recover_flag
op_assign
id|card-&gt;state
suffix:semicolon
r_if
c_cond
(paren
id|ccw_device_set_online
c_func
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
)paren
op_logical_or
id|ccw_device_set_online
c_func
(paren
id|CARD_WDEV
c_func
(paren
id|card
)paren
)paren
op_logical_or
id|ccw_device_set_online
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;1err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|qeth_make_parameters_consistent
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_hardsetup_card
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;2err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_remove
suffix:semicolon
)brace
id|card-&gt;state
op_assign
id|CARD_STATE_HARDSETUP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|rc
op_assign
id|qeth_query_ipassists
c_func
(paren
id|card
comma
id|QETH_PROT_IPV4
)paren
)paren
)paren
id|rc
op_assign
id|qeth_get_unique_id
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_logical_and
id|card-&gt;options.layer2
op_eq
l_int|0
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;3err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_remove
suffix:semicolon
)brace
id|qeth_print_status_message
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_register_netdev
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;4err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_remove
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_softsetup_card
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;5err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_remove
suffix:semicolon
)brace
id|card-&gt;state
op_assign
id|CARD_STATE_SOFTSETUP
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|qeth_init_qdio_queues
c_func
(paren
id|card
)paren
)paren
)paren
(brace
id|QETH_DBF_TEXT_
c_func
(paren
id|setup
comma
l_int|2
comma
l_string|&quot;6err%d&quot;
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out_remove
suffix:semicolon
)brace
multiline_comment|/*maybe it was set offline without ifconfig down&n; * we can also use this state for recovery purposes*/
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
id|qeth_set_allowed_threads
c_func
(paren
id|card
comma
id|QETH_RECOVER_THREAD
comma
l_int|0
)paren
suffix:semicolon
r_else
id|qeth_set_allowed_threads
c_func
(paren
id|card
comma
l_int|0xffffffff
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|recover_flag
op_eq
id|CARD_STATE_RECOVER
)paren
id|qeth_start_again
c_func
(paren
id|card
)paren
suffix:semicolon
id|qeth_notify_processes
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_remove
suffix:colon
id|card-&gt;use_hard_stop
op_assign
l_int|1
suffix:semicolon
id|qeth_stop_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_DDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_WDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
id|ccw_device_set_offline
c_func
(paren
id|CARD_RDEV
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|recover_flag
op_eq
id|CARD_STATE_RECOVER
)paren
id|card-&gt;state
op_assign
id|CARD_STATE_RECOVER
suffix:semicolon
r_else
id|card-&gt;state
op_assign
id|CARD_STATE_DOWN
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|variable|qeth_ids
r_static
r_struct
id|ccw_device_id
id|qeth_ids
(braket
)braket
op_assign
(brace
(brace
id|CCW_DEVICE
c_func
(paren
l_int|0x1731
comma
l_int|0x01
)paren
comma
id|driver_info
suffix:colon
id|QETH_CARD_TYPE_OSAE
)brace
comma
(brace
id|CCW_DEVICE
c_func
(paren
l_int|0x1731
comma
l_int|0x05
)paren
comma
id|driver_info
suffix:colon
id|QETH_CARD_TYPE_IQD
)brace
comma
(brace
)brace
comma
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|ccw
comma
id|qeth_ids
)paren
suffix:semicolon
DECL|variable|qeth_root_dev
r_struct
id|device
op_star
id|qeth_root_dev
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qeth_ccwgroup_driver
r_struct
id|ccwgroup_driver
id|qeth_ccwgroup_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;qeth&quot;
comma
dot
id|driver_id
op_assign
l_int|0xD8C5E3C8
comma
dot
id|probe
op_assign
id|qeth_probe_device
comma
dot
id|remove
op_assign
id|qeth_remove_device
comma
dot
id|set_online
op_assign
id|qeth_set_online
comma
dot
id|set_offline
op_assign
id|qeth_set_offline
comma
)brace
suffix:semicolon
DECL|variable|qeth_ccw_driver
r_struct
id|ccw_driver
id|qeth_ccw_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;qeth&quot;
comma
dot
id|ids
op_assign
id|qeth_ids
comma
dot
id|probe
op_assign
id|ccwgroup_probe_ccwdev
comma
dot
id|remove
op_assign
id|ccwgroup_remove_ccwdev
comma
)brace
suffix:semicolon
r_static
r_void
DECL|function|qeth_unregister_dbf_views
id|qeth_unregister_dbf_views
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|qeth_dbf_setup
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_qerr
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_qerr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_sense
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_sense
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_misc
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_misc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_data
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_control
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_control
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_dbf_trace
)paren
id|debug_unregister
c_func
(paren
id|qeth_dbf_trace
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qeth_register_dbf_views
id|qeth_register_dbf_views
c_func
(paren
r_void
)paren
(brace
id|qeth_dbf_setup
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_SETUP_NAME
comma
id|QETH_DBF_SETUP_INDEX
comma
id|QETH_DBF_SETUP_NR_AREAS
comma
id|QETH_DBF_SETUP_LEN
)paren
suffix:semicolon
id|qeth_dbf_misc
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_MISC_NAME
comma
id|QETH_DBF_MISC_INDEX
comma
id|QETH_DBF_MISC_NR_AREAS
comma
id|QETH_DBF_MISC_LEN
)paren
suffix:semicolon
id|qeth_dbf_data
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_DATA_NAME
comma
id|QETH_DBF_DATA_INDEX
comma
id|QETH_DBF_DATA_NR_AREAS
comma
id|QETH_DBF_DATA_LEN
)paren
suffix:semicolon
id|qeth_dbf_control
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_CONTROL_NAME
comma
id|QETH_DBF_CONTROL_INDEX
comma
id|QETH_DBF_CONTROL_NR_AREAS
comma
id|QETH_DBF_CONTROL_LEN
)paren
suffix:semicolon
id|qeth_dbf_sense
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_SENSE_NAME
comma
id|QETH_DBF_SENSE_INDEX
comma
id|QETH_DBF_SENSE_NR_AREAS
comma
id|QETH_DBF_SENSE_LEN
)paren
suffix:semicolon
id|qeth_dbf_qerr
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_QERR_NAME
comma
id|QETH_DBF_QERR_INDEX
comma
id|QETH_DBF_QERR_NR_AREAS
comma
id|QETH_DBF_QERR_LEN
)paren
suffix:semicolon
id|qeth_dbf_trace
op_assign
id|debug_register
c_func
(paren
id|QETH_DBF_TRACE_NAME
comma
id|QETH_DBF_TRACE_INDEX
comma
id|QETH_DBF_TRACE_NR_AREAS
comma
id|QETH_DBF_TRACE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|qeth_dbf_setup
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_misc
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_data
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_control
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_sense
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_qerr
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|qeth_dbf_trace
op_eq
l_int|NULL
)paren
)paren
(brace
id|qeth_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|qeth_dbf_setup
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_setup
comma
id|QETH_DBF_SETUP_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_misc
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_misc
comma
id|QETH_DBF_MISC_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_data
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_data
comma
id|QETH_DBF_DATA_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_control
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_control
comma
id|QETH_DBF_CONTROL_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_sense
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_sense
comma
id|QETH_DBF_SENSE_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_qerr
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_qerr
comma
id|QETH_DBF_QERR_LEVEL
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qeth_dbf_trace
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qeth_dbf_trace
comma
id|QETH_DBF_TRACE_LEVEL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_extern
r_struct
id|neigh_table
id|arp_tbl
suffix:semicolon
DECL|variable|arp_direct_ops
r_static
r_struct
id|neigh_ops
op_star
id|arp_direct_ops
suffix:semicolon
DECL|variable|qeth_old_arp_constructor
r_static
r_int
(paren
op_star
id|qeth_old_arp_constructor
)paren
(paren
r_struct
id|neighbour
op_star
)paren
suffix:semicolon
DECL|variable|arp_direct_ops_template
r_static
r_struct
id|neigh_ops
id|arp_direct_ops_template
op_assign
(brace
dot
id|family
op_assign
id|AF_INET
comma
dot
id|destructor
op_assign
l_int|NULL
comma
dot
id|solicit
op_assign
l_int|NULL
comma
dot
id|error_report
op_assign
l_int|NULL
comma
dot
id|output
op_assign
id|dev_queue_xmit
comma
dot
id|connected_output
op_assign
id|dev_queue_xmit
comma
dot
id|hh_output
op_assign
id|dev_queue_xmit
comma
dot
id|queue_xmit
op_assign
id|dev_queue_xmit
)brace
suffix:semicolon
r_static
r_int
DECL|function|qeth_arp_constructor
id|qeth_arp_constructor
c_func
(paren
r_struct
id|neighbour
op_star
id|neigh
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|neigh-&gt;dev
suffix:semicolon
r_struct
id|in_device
op_star
id|in_dev
suffix:semicolon
r_struct
id|neigh_parms
op_star
id|parms
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|card
op_assign
id|qeth_get_card_from_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
id|in_dev
op_assign
id|rcu_dereference
c_func
(paren
id|__in_dev_get
c_func
(paren
id|dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_dev
op_eq
l_int|NULL
)paren
(brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|parms
op_assign
id|in_dev-&gt;arp_parms
suffix:semicolon
id|__neigh_parms_put
c_func
(paren
id|neigh-&gt;parms
)paren
suffix:semicolon
id|neigh-&gt;parms
op_assign
id|neigh_parms_clone
c_func
(paren
id|parms
)paren
suffix:semicolon
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
id|neigh-&gt;type
op_assign
id|inet_addr_type
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
id|neigh-&gt;primary_key
)paren
suffix:semicolon
id|neigh-&gt;nud_state
op_assign
id|NUD_NOARP
suffix:semicolon
id|neigh-&gt;ops
op_assign
id|arp_direct_ops
suffix:semicolon
id|neigh-&gt;output
op_assign
id|neigh-&gt;ops-&gt;queue_xmit
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|qeth_old_arp_constructor
c_func
(paren
id|neigh
)paren
suffix:semicolon
)brace
macro_line|#endif  /*CONFIG_QETH_IPV6*/
multiline_comment|/*&n; * IP address takeover related functions&n; */
r_static
r_void
DECL|function|qeth_clear_ipato_list
id|qeth_clear_ipato_list
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
)paren
(brace
r_struct
id|qeth_ipato_entry
op_star
id|ipatoe
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|ipatoe
comma
id|tmp
comma
op_amp
id|card-&gt;ipato.entries
comma
id|entry
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|ipatoe-&gt;entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ipatoe
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_int
DECL|function|qeth_add_ipato_entry
id|qeth_add_ipato_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipato_entry
op_star
r_new
)paren
(brace
r_struct
id|qeth_ipato_entry
op_star
id|ipatoe
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addipato&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
(def_block
id|list_for_each_entry
c_func
(paren
id|ipatoe
comma
op_amp
id|card-&gt;ipato.entries
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
id|ipatoe-&gt;proto
op_ne
r_new
op_member_access_from_pointer
id|proto
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|ipatoe-&gt;addr
comma
r_new
op_member_access_from_pointer
id|addr
comma
(paren
id|ipatoe-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|16
)paren
op_logical_and
(paren
id|ipatoe-&gt;mask_bits
op_eq
r_new
op_member_access_from_pointer
id|mask_bits
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;ipato entry already exists!&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)def_block
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|list_add_tail
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|entry
comma
op_amp
id|card-&gt;ipato.entries
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_void
DECL|function|qeth_del_ipato_entry
id|qeth_del_ipato_entry
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|proto
comma
id|u8
op_star
id|addr
comma
r_int
id|mask_bits
)paren
(brace
r_struct
id|qeth_ipato_entry
op_star
id|ipatoe
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;delipato&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
(def_block
id|list_for_each_entry_safe
c_func
(paren
id|ipatoe
comma
id|tmp
comma
op_amp
id|card-&gt;ipato.entries
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
id|ipatoe-&gt;proto
op_ne
id|proto
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|ipatoe-&gt;addr
comma
id|addr
comma
(paren
id|proto
op_eq
id|QETH_PROT_IPV4
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|16
)paren
op_logical_and
(paren
id|ipatoe-&gt;mask_bits
op_eq
id|mask_bits
)paren
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|ipatoe-&gt;entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ipatoe
)paren
suffix:semicolon
)brace
)brace
)def_block
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_convert_addr_to_bits
id|qeth_convert_addr_to_bits
c_func
(paren
id|u8
op_star
id|addr
comma
id|u8
op_star
id|bits
comma
r_int
id|len
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
id|u8
id|octet
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
op_increment
id|i
)paren
(brace
id|octet
op_assign
id|addr
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|7
suffix:semicolon
id|j
op_ge
l_int|0
suffix:semicolon
op_decrement
id|j
)paren
(brace
id|bits
(braket
id|i
op_star
l_int|8
op_plus
id|j
)braket
op_assign
id|octet
op_amp
l_int|1
suffix:semicolon
id|octet
op_rshift_assign
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_static
r_int
DECL|function|qeth_is_addr_covered_by_ipato
id|qeth_is_addr_covered_by_ipato
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|qeth_ipaddr
op_star
id|addr
)paren
(brace
r_struct
id|qeth_ipato_entry
op_star
id|ipatoe
suffix:semicolon
id|u8
id|addr_bits
(braket
l_int|128
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
id|u8
id|ipatoe_bits
(braket
l_int|128
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;ipato.enabled
)paren
r_return
l_int|0
suffix:semicolon
id|qeth_convert_addr_to_bits
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|addr-&gt;u
comma
id|addr_bits
comma
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|16
)paren
suffix:semicolon
(def_block
id|list_for_each_entry
c_func
(paren
id|ipatoe
comma
op_amp
id|card-&gt;ipato.entries
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;proto
op_ne
id|ipatoe-&gt;proto
)paren
r_continue
suffix:semicolon
id|qeth_convert_addr_to_bits
c_func
(paren
id|ipatoe-&gt;addr
comma
id|ipatoe_bits
comma
(paren
id|ipatoe-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
id|rc
op_assign
op_logical_neg
id|memcmp
c_func
(paren
id|addr_bits
comma
id|ipatoe_bits
comma
id|min
c_func
(paren
l_int|32
comma
id|ipatoe-&gt;mask_bits
)paren
)paren
suffix:semicolon
r_else
id|rc
op_assign
op_logical_neg
id|memcmp
c_func
(paren
id|addr_bits
comma
id|ipatoe_bits
comma
id|min
c_func
(paren
l_int|128
comma
id|ipatoe-&gt;mask_bits
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_break
suffix:semicolon
)brace
)def_block
multiline_comment|/* invert? */
r_if
c_cond
(paren
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV4
)paren
op_logical_and
id|card-&gt;ipato.invert4
)paren
id|rc
op_assign
op_logical_neg
id|rc
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|addr-&gt;proto
op_eq
id|QETH_PROT_IPV6
)paren
op_logical_and
id|card-&gt;ipato.invert6
)paren
id|rc
op_assign
op_logical_neg
id|rc
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * VIPA related functions&n; */
r_int
DECL|function|qeth_add_vipa
id|qeth_add_vipa
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|proto
comma
r_const
id|u8
op_star
id|addr
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipaddr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|ipaddr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipaddr
)paren
(brace
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addvipa4&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a4.addr
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
id|ipaddr-&gt;u.a4.mask
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
)brace
r_else
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addvipa6&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a6.addr
comma
id|addr
comma
l_int|16
)paren
suffix:semicolon
id|ipaddr-&gt;u.a6.pfxlen
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|ipaddr-&gt;type
op_assign
id|QETH_IP_TYPE_VIPA
suffix:semicolon
id|ipaddr-&gt;set_flags
op_assign
id|QETH_IPA_SETIP_VIPA_FLAG
suffix:semicolon
id|ipaddr-&gt;del_flags
op_assign
id|QETH_IPA_DELIP_VIPA_FLAG
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__qeth_address_exists_in_list
c_func
(paren
op_amp
id|card-&gt;ip_list
comma
id|ipaddr
comma
l_int|0
)paren
op_logical_or
id|__qeth_address_exists_in_list
c_func
(paren
id|card-&gt;ip_tbd_list
comma
id|ipaddr
comma
l_int|0
)paren
)paren
id|rc
op_assign
op_minus
id|EEXIST
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Cannot add VIPA. Address already exists!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|ipaddr
)paren
)paren
id|kfree
c_func
(paren
id|ipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_void
DECL|function|qeth_del_vipa
id|qeth_del_vipa
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|proto
comma
r_const
id|u8
op_star
id|addr
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipaddr
suffix:semicolon
id|ipaddr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipaddr
)paren
(brace
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;delvipa4&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a4.addr
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
id|ipaddr-&gt;u.a4.mask
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
)brace
r_else
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;delvipa6&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a6.addr
comma
id|addr
comma
l_int|16
)paren
suffix:semicolon
id|ipaddr-&gt;u.a6.pfxlen
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|ipaddr-&gt;type
op_assign
id|QETH_IP_TYPE_VIPA
suffix:semicolon
)brace
r_else
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|ipaddr
)paren
)paren
id|kfree
c_func
(paren
id|ipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * proxy ARP related functions&n; */
r_int
DECL|function|qeth_add_rxip
id|qeth_add_rxip
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|proto
comma
r_const
id|u8
op_star
id|addr
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipaddr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|ipaddr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipaddr
)paren
(brace
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addrxip4&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a4.addr
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
id|ipaddr-&gt;u.a4.mask
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
)brace
r_else
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addrxip6&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a6.addr
comma
id|addr
comma
l_int|16
)paren
suffix:semicolon
id|ipaddr-&gt;u.a6.pfxlen
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|ipaddr-&gt;type
op_assign
id|QETH_IP_TYPE_RXIP
suffix:semicolon
id|ipaddr-&gt;set_flags
op_assign
id|QETH_IPA_SETIP_TAKEOVER_FLAG
suffix:semicolon
id|ipaddr-&gt;del_flags
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__qeth_address_exists_in_list
c_func
(paren
op_amp
id|card-&gt;ip_list
comma
id|ipaddr
comma
l_int|0
)paren
op_logical_or
id|__qeth_address_exists_in_list
c_func
(paren
id|card-&gt;ip_tbd_list
comma
id|ipaddr
comma
l_int|0
)paren
)paren
id|rc
op_assign
op_minus
id|EEXIST
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;ip_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;Cannot add RXIP. Address already exists!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|ipaddr
)paren
)paren
id|kfree
c_func
(paren
id|ipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|qeth_del_rxip
id|qeth_del_rxip
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_enum
id|qeth_prot_versions
id|proto
comma
r_const
id|u8
op_star
id|addr
)paren
(brace
r_struct
id|qeth_ipaddr
op_star
id|ipaddr
suffix:semicolon
id|ipaddr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|proto
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ipaddr
)paren
(brace
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV4
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addrxip4&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a4.addr
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
id|ipaddr-&gt;u.a4.mask
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
)brace
r_else
r_if
c_cond
(paren
id|proto
op_eq
id|QETH_PROT_IPV6
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;addrxip6&quot;
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ipaddr-&gt;u.a6.addr
comma
id|addr
comma
l_int|16
)paren
suffix:semicolon
id|ipaddr-&gt;u.a6.pfxlen
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
id|ipaddr-&gt;type
op_assign
id|QETH_IP_TYPE_RXIP
suffix:semicolon
)brace
r_else
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|ipaddr
)paren
)paren
id|kfree
c_func
(paren
id|ipaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * IP event handler&n; */
r_static
r_int
DECL|function|qeth_ip_event
id|qeth_ip_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
op_assign
(paren
r_struct
id|in_ifaddr
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|ifa-&gt;ifa_dev-&gt;dev
suffix:semicolon
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;ipevent&quot;
)paren
suffix:semicolon
id|card
op_assign
id|qeth_get_card_from_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;options.layer2
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
id|addr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ne
l_int|NULL
)paren
(brace
id|addr-&gt;u.a4.addr
op_assign
id|ifa-&gt;ifa_address
suffix:semicolon
id|addr-&gt;u.a4.mask
op_assign
id|ifa-&gt;ifa_mask
suffix:semicolon
id|addr-&gt;type
op_assign
id|QETH_IP_TYPE_NORMAL
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|qeth_ip_notifier
r_static
r_struct
id|notifier_block
id|qeth_ip_notifier
op_assign
(brace
id|qeth_ip_event
comma
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
multiline_comment|/**&n; * IPv6 event handler&n; */
r_static
r_int
DECL|function|qeth_ip6_event
id|qeth_ip6_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|inet6_ifaddr
op_star
id|ifa
op_assign
(paren
r_struct
id|inet6_ifaddr
op_star
)paren
id|ptr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|ifa-&gt;idev-&gt;dev
suffix:semicolon
r_struct
id|qeth_ipaddr
op_star
id|addr
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|3
comma
l_string|&quot;ip6event&quot;
)paren
suffix:semicolon
id|card
op_assign
id|qeth_get_card_from_dev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qeth_is_supported
c_func
(paren
id|card
comma
id|IPA_IPV6
)paren
)paren
r_return
id|NOTIFY_DONE
suffix:semicolon
id|addr
op_assign
id|qeth_get_addr_buffer
c_func
(paren
id|QETH_PROT_IPV6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ne
l_int|NULL
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|addr-&gt;u.a6.addr
comma
op_amp
id|ifa-&gt;addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|addr-&gt;u.a6.pfxlen
op_assign
id|ifa-&gt;prefix_len
suffix:semicolon
id|addr-&gt;type
op_assign
id|QETH_IP_TYPE_NORMAL
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|qeth_add_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|qeth_delete_ip
c_func
(paren
id|card
comma
id|addr
)paren
)paren
id|kfree
c_func
(paren
id|addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qeth_set_thread_start_bit
c_func
(paren
id|card
comma
id|QETH_SET_IP_THREAD
)paren
op_eq
l_int|0
)paren
id|schedule_work
c_func
(paren
op_amp
id|card-&gt;kernel_thread_starter
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|qeth_ip6_notifier
r_static
r_struct
id|notifier_block
id|qeth_ip6_notifier
op_assign
(brace
id|qeth_ip6_event
comma
l_int|0
)brace
suffix:semicolon
macro_line|#endif
r_static
r_int
DECL|function|qeth_reboot_event
id|qeth_reboot_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|device
op_star
id|entry
suffix:semicolon
r_struct
id|qeth_card
op_star
id|card
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|qeth_ccwgroup_driver.driver.bus-&gt;subsys.rwsem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|entry
comma
op_amp
id|qeth_ccwgroup_driver.driver.devices
comma
id|driver_list
)paren
(brace
id|card
op_assign
(paren
r_struct
id|qeth_card
op_star
)paren
id|entry-&gt;driver_data
suffix:semicolon
id|qeth_clear_ip_list
c_func
(paren
id|card
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|qeth_qdio_clear_card
c_func
(paren
id|card
comma
l_int|0
)paren
suffix:semicolon
)brace
id|up_read
c_func
(paren
op_amp
id|qeth_ccwgroup_driver.driver.bus-&gt;subsys.rwsem
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|qeth_reboot_notifier
r_static
r_struct
id|notifier_block
id|qeth_reboot_notifier
op_assign
(brace
id|qeth_reboot_event
comma
l_int|0
)brace
suffix:semicolon
r_static
r_int
DECL|function|qeth_register_notifiers
id|qeth_register_notifiers
c_func
(paren
r_void
)paren
(brace
r_int
id|r
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;regnotif&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|register_reboot_notifier
c_func
(paren
op_amp
id|qeth_reboot_notifier
)paren
)paren
)paren
r_return
id|r
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|register_inetaddr_notifier
c_func
(paren
op_amp
id|qeth_ip_notifier
)paren
)paren
)paren
r_goto
id|out_reboot
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_if
c_cond
(paren
(paren
id|r
op_assign
id|register_inet6addr_notifier
c_func
(paren
op_amp
id|qeth_ip6_notifier
)paren
)paren
)paren
r_goto
id|out_ipv4
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|out_ipv4
suffix:colon
id|unregister_inetaddr_notifier
c_func
(paren
op_amp
id|qeth_ip_notifier
)paren
suffix:semicolon
macro_line|#endif
id|out_reboot
suffix:colon
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|qeth_reboot_notifier
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/**&n; * unregister all event notifiers&n; */
r_static
r_void
DECL|function|qeth_unregister_notifiers
id|qeth_unregister_notifiers
c_func
(paren
r_void
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;unregnot&quot;
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|qeth_reboot_notifier
)paren
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|unregister_inetaddr_notifier
c_func
(paren
op_amp
id|qeth_ip_notifier
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|BUG_ON
c_func
(paren
id|unregister_inet6addr_notifier
c_func
(paren
op_amp
id|qeth_ip6_notifier
)paren
)paren
suffix:semicolon
macro_line|#endif /* QETH_IPV6 */
)brace
macro_line|#ifdef CONFIG_QETH_IPV6
r_static
r_int
DECL|function|qeth_ipv6_init
id|qeth_ipv6_init
c_func
(paren
r_void
)paren
(brace
id|qeth_old_arp_constructor
op_assign
id|arp_tbl.constructor
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
id|arp_tbl.constructor
op_assign
id|qeth_arp_constructor
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
id|arp_direct_ops
op_assign
(paren
r_struct
id|neigh_ops
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|neigh_ops
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arp_direct_ops
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|arp_direct_ops
comma
op_amp
id|arp_direct_ops_template
comma
r_sizeof
(paren
r_struct
id|neigh_ops
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_ipv6_uninit
id|qeth_ipv6_uninit
c_func
(paren
r_void
)paren
(brace
id|write_lock
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
id|arp_tbl.constructor
op_assign
id|qeth_old_arp_constructor
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|arp_tbl.lock
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|arp_direct_ops
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_IPV6 */
r_static
r_void
DECL|function|qeth_sysfs_unregister
id|qeth_sysfs_unregister
c_func
(paren
r_void
)paren
(brace
id|qeth_remove_driver_attributes
c_func
(paren
)paren
suffix:semicolon
id|ccw_driver_unregister
c_func
(paren
op_amp
id|qeth_ccw_driver
)paren
suffix:semicolon
id|ccwgroup_driver_unregister
c_func
(paren
op_amp
id|qeth_ccwgroup_driver
)paren
suffix:semicolon
id|s390_root_dev_unregister
c_func
(paren
id|qeth_root_dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * register qeth at sysfs&n; */
r_static
r_int
DECL|function|qeth_sysfs_register
id|qeth_sysfs_register
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|ccwgroup_driver_register
c_func
(paren
op_amp
id|qeth_ccwgroup_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|ccw_driver_register
c_func
(paren
op_amp
id|qeth_ccw_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|qeth_create_driver_attributes
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|qeth_root_dev
op_assign
id|s390_root_dev_register
c_func
(paren
l_string|&quot;qeth&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|qeth_root_dev
)paren
)paren
(brace
id|rc
op_assign
id|PTR_ERR
c_func
(paren
id|qeth_root_dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/***&n; * init function&n; */
r_static
r_int
id|__init
DECL|function|qeth_init
id|qeth_init
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|qeth_eyecatcher
c_func
(paren
)paren
suffix:semicolon
id|PRINT_INFO
c_func
(paren
l_string|&quot;loading %s (%s/%s/%s/%s/%s/%s/%s %s %s)&bslash;n&quot;
comma
id|version
comma
id|VERSION_QETH_C
comma
id|VERSION_QETH_H
comma
id|VERSION_QETH_MPC_H
comma
id|VERSION_QETH_MPC_C
comma
id|VERSION_QETH_FS_H
comma
id|VERSION_QETH_PROC_C
comma
id|VERSION_QETH_SYS_C
comma
id|QETH_VERSION_IPV6
comma
id|QETH_VERSION_VLAN
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|qeth_card_list.list
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|qeth_notify_list
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|qeth_notify_lock
)paren
suffix:semicolon
id|rwlock_init
c_func
(paren
op_amp
id|qeth_card_list.rwlock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qeth_register_dbf_views
c_func
(paren
)paren
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
id|qeth_sysfs_register
c_func
(paren
)paren
)paren
r_goto
id|out_sysfs
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
r_if
c_cond
(paren
id|qeth_ipv6_init
c_func
(paren
)paren
)paren
(brace
id|PRINT_ERR
c_func
(paren
l_string|&quot;Out of memory during ipv6 init.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_sysfs
suffix:semicolon
)brace
macro_line|#endif /* QETH_IPV6 */
r_if
c_cond
(paren
id|qeth_register_notifiers
c_func
(paren
)paren
)paren
r_goto
id|out_ipv6
suffix:semicolon
r_if
c_cond
(paren
id|qeth_create_procfs_entries
c_func
(paren
)paren
)paren
r_goto
id|out_notifiers
suffix:semicolon
r_return
id|rc
suffix:semicolon
id|out_notifiers
suffix:colon
id|qeth_unregister_notifiers
c_func
(paren
)paren
suffix:semicolon
id|out_ipv6
suffix:colon
macro_line|#ifdef CONFIG_QETH_IPV6
id|qeth_ipv6_uninit
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* QETH_IPV6 */
id|out_sysfs
suffix:colon
id|qeth_sysfs_unregister
c_func
(paren
)paren
suffix:semicolon
id|qeth_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
id|out_err
suffix:colon
id|PRINT_ERR
c_func
(paren
l_string|&quot;Initialization failed&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_void
DECL|function|qeth_exit
id|__exit
id|qeth_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|qeth_card
op_star
id|card
comma
op_star
id|tmp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|1
comma
l_string|&quot;cleanup.&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Weed would not need to clean up our devices here, because the&n;&t; * common device layer calls qeth_remove_device for each device&n;&t; * as soon as we unregister our driver (done in qeth_sysfs_unregister).&n;&t; * But we do cleanup here so we can do a &quot;soft&quot; shutdown of our cards.&n;&t; * qeth_remove_device called by the common device layer would otherwise&n;&t; * do a &quot;hard&quot; shutdown (card-&gt;use_hard_stop is set to one in&n;&t; * qeth_remove_device).&n;&t; */
id|again
suffix:colon
id|read_lock_irqsave
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
(def_block
id|list_for_each_entry_safe
c_func
(paren
id|card
comma
id|tmp
comma
op_amp
id|qeth_card_list.list
comma
id|list
)paren
(brace
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
id|qeth_set_offline
c_func
(paren
id|card-&gt;gdev
)paren
suffix:semicolon
id|qeth_remove_device
c_func
(paren
id|card-&gt;gdev
)paren
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
)def_block
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|qeth_card_list.rwlock
comma
id|flags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_IPV6
id|qeth_ipv6_uninit
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|qeth_unregister_notifiers
c_func
(paren
)paren
suffix:semicolon
id|qeth_remove_procfs_entries
c_func
(paren
)paren
suffix:semicolon
id|qeth_sysfs_unregister
c_func
(paren
)paren
suffix:semicolon
id|qeth_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qeth: removed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|qeth_eyecatcher
id|EXPORT_SYMBOL
c_func
(paren
id|qeth_eyecatcher
)paren
suffix:semicolon
DECL|variable|qeth_init
id|module_init
c_func
(paren
id|qeth_init
)paren
suffix:semicolon
DECL|variable|qeth_exit
id|module_exit
c_func
(paren
id|qeth_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Frank Pavlic &lt;pavlic@de.ibm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Linux on zSeries OSA Express and HiperSockets support&bslash;n&quot;
"&bslash;"
l_string|&quot;Copyright 2000,2003 IBM Corporation&bslash;n&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
