multiline_comment|/*&n; * $Id: netiucv.c,v 1.17 2002/02/12 21:52:20 felfert Exp $&n; *&n; * IUCV network driver&n; *&n; * Copyright (C) 2001 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; * Author(s): Fritz Elfert (elfert@de.ibm.com, felfert@millenux.com)&n; *&n; * Documentation used:&n; *  the source of the original IUCV driver by:&n; *    Stefan Hegewald &lt;hegewald@de.ibm.com&gt;&n; *    Hartmut Penner &lt;hpenner@de.ibm.com&gt;&n; *    Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)&n; *    Martin Schwidefsky (schwidefsky@de.ibm.com)&n; *    Alan Altmark (Alan_Altmark@us.ibm.com)  Sept. 2000&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * RELEASE-TAG: IUCV network driver $Revision: 1.17 $&n; *&n; */
"&f;"
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;net/dst.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;iucv.h&quot;
macro_line|#include &quot;fsm.h&quot;
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#ifdef MODULE
id|MODULE_AUTHOR
(paren
l_string|&quot;(C) 2001 IBM Corporation by Fritz Elfert (felfert@millenux.com)&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
(paren
l_string|&quot;Linux for S/390 IUCV network driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM
(paren
id|iucv
comma
l_string|&quot;1s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
(paren
id|iucv
comma
l_string|&quot;Specify the initial remote userids for iucv0 .. iucvn:&bslash;n&quot;
l_string|&quot;iucv=userid0:userid1:...:useridN&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|iucv
r_static
r_char
op_star
id|iucv
op_assign
l_string|&quot;&quot;
suffix:semicolon
DECL|typedef|net_device
r_typedef
r_struct
id|net_device
id|net_device
suffix:semicolon
"&f;"
multiline_comment|/**&n; * Per connection profiling data&n; */
DECL|struct|connection_profile_t
r_typedef
r_struct
id|connection_profile_t
(brace
DECL|member|maxmulti
r_int
r_int
id|maxmulti
suffix:semicolon
DECL|member|maxcqueue
r_int
r_int
id|maxcqueue
suffix:semicolon
DECL|member|doios_single
r_int
r_int
id|doios_single
suffix:semicolon
DECL|member|doios_multi
r_int
r_int
id|doios_multi
suffix:semicolon
DECL|member|txlen
r_int
r_int
id|txlen
suffix:semicolon
DECL|member|tx_time
r_int
r_int
id|tx_time
suffix:semicolon
DECL|member|send_stamp
r_struct
id|timeval
id|send_stamp
suffix:semicolon
DECL|typedef|connection_profile
)brace
id|connection_profile
suffix:semicolon
multiline_comment|/**&n; * Representation of one iucv connection&n; */
DECL|struct|iucv_connection_t
r_typedef
r_struct
id|iucv_connection_t
(brace
DECL|member|next
r_struct
id|iucv_connection_t
op_star
id|next
suffix:semicolon
DECL|member|handle
id|iucv_handle_t
id|handle
suffix:semicolon
DECL|member|pathid
id|__u16
id|pathid
suffix:semicolon
DECL|member|rx_buff
r_struct
id|sk_buff
op_star
id|rx_buff
suffix:semicolon
DECL|member|tx_buff
r_struct
id|sk_buff
op_star
id|tx_buff
suffix:semicolon
DECL|member|collect_queue
r_struct
id|sk_buff_head
id|collect_queue
suffix:semicolon
DECL|member|collect_lock
id|spinlock_t
id|collect_lock
suffix:semicolon
DECL|member|collect_len
r_int
id|collect_len
suffix:semicolon
DECL|member|max_buffsize
r_int
id|max_buffsize
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|timer
id|fsm_timer
id|timer
suffix:semicolon
DECL|member|retry
r_int
id|retry
suffix:semicolon
DECL|member|fsm
id|fsm_instance
op_star
id|fsm
suffix:semicolon
DECL|member|netdev
id|net_device
op_star
id|netdev
suffix:semicolon
DECL|member|prof
id|connection_profile
id|prof
suffix:semicolon
DECL|member|userid
r_char
id|userid
(braket
l_int|9
)braket
suffix:semicolon
DECL|typedef|iucv_connection
)brace
id|iucv_connection
suffix:semicolon
DECL|macro|CONN_FLAGS_BUFSIZE_CHANGED
mdefine_line|#define CONN_FLAGS_BUFSIZE_CHANGED 1
multiline_comment|/**&n; * Linked list of all connection structs.&n; */
DECL|variable|connections
r_static
id|iucv_connection
op_star
id|connections
suffix:semicolon
multiline_comment|/**&n; * Representation of event-data for the&n; * connection state machine.&n; */
DECL|struct|iucv_event_t
r_typedef
r_struct
id|iucv_event_t
(brace
DECL|member|conn
id|iucv_connection
op_star
id|conn
suffix:semicolon
DECL|member|data
r_void
op_star
id|data
suffix:semicolon
DECL|typedef|iucv_event
)brace
id|iucv_event
suffix:semicolon
multiline_comment|/**&n; * Private part of the network device structure&n; */
DECL|struct|netiucv_priv_t
r_typedef
r_struct
id|netiucv_priv_t
(brace
DECL|member|stats
r_struct
id|net_device_stats
id|stats
suffix:semicolon
DECL|member|tbusy
r_int
r_int
id|tbusy
suffix:semicolon
DECL|member|fsm
id|fsm_instance
op_star
id|fsm
suffix:semicolon
DECL|member|conn
id|iucv_connection
op_star
id|conn
suffix:semicolon
DECL|member|proc_dentry
r_struct
id|proc_dir_entry
op_star
id|proc_dentry
suffix:semicolon
DECL|member|proc_stat_entry
r_struct
id|proc_dir_entry
op_star
id|proc_stat_entry
suffix:semicolon
DECL|member|proc_buffer_entry
r_struct
id|proc_dir_entry
op_star
id|proc_buffer_entry
suffix:semicolon
DECL|member|proc_user_entry
r_struct
id|proc_dir_entry
op_star
id|proc_user_entry
suffix:semicolon
DECL|member|proc_registered
r_int
id|proc_registered
suffix:semicolon
DECL|typedef|netiucv_priv
)brace
id|netiucv_priv
suffix:semicolon
multiline_comment|/**&n; * Link level header for a packet.&n; */
DECL|struct|ll_header_t
r_typedef
r_struct
id|ll_header_t
(brace
DECL|member|next
id|__u16
id|next
suffix:semicolon
DECL|typedef|ll_header
)brace
id|ll_header
suffix:semicolon
DECL|macro|NETIUCV_HDRLEN
mdefine_line|#define NETIUCV_HDRLEN           (sizeof(ll_header))
DECL|macro|NETIUCV_BUFSIZE_MAX
mdefine_line|#define NETIUCV_BUFSIZE_MAX      32768
DECL|macro|NETIUCV_BUFSIZE_DEFAULT
mdefine_line|#define NETIUCV_BUFSIZE_DEFAULT  NETIUCV_BUFSIZE_MAX
DECL|macro|NETIUCV_MTU_MAX
mdefine_line|#define NETIUCV_MTU_MAX          (NETIUCV_BUFSIZE_MAX - NETIUCV_HDRLEN)
DECL|macro|NETIUCV_MTU_DEFAULT
mdefine_line|#define NETIUCV_MTU_DEFAULT      9216
DECL|macro|NETIUCV_QUEUELEN_DEFAULT
mdefine_line|#define NETIUCV_QUEUELEN_DEFAULT 50
DECL|macro|NETIUCV_TIMEOUT_5SEC
mdefine_line|#define NETIUCV_TIMEOUT_5SEC     5000
multiline_comment|/**&n; * Compatibility macros for busy handling&n; * of network devices.&n; */
DECL|function|netiucv_clear_busy
r_static
id|__inline__
r_void
id|netiucv_clear_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
)paren
)paren
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|netiucv_test_and_set_busy
r_static
id|__inline__
r_int
id|netiucv_test_and_set_busy
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
(paren
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|tbusy
)paren
suffix:semicolon
)brace
DECL|macro|SET_DEVICE_START
mdefine_line|#define SET_DEVICE_START(device, value)
DECL|variable|iucv_host
r_static
id|__u8
id|iucv_host
(braket
l_int|8
)braket
op_assign
(brace
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
)brace
suffix:semicolon
DECL|variable|iucvMagic
r_static
id|__u8
id|iucvMagic
(braket
l_int|16
)braket
op_assign
(brace
l_int|0xF0
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0xF0
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
comma
l_int|0x40
)brace
suffix:semicolon
multiline_comment|/**&n; * This mask means the 16-byte IUCV &quot;magic&quot; and the origin userid must&n; * match exactly as specified in order to give connection_pending()&n; * control.&n; */
DECL|variable|mask
r_static
id|__u8
id|mask
(braket
)braket
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
multiline_comment|/**&n; * Convert an iucv userId to its printable&n; * form (strip whitespace at end).&n; *&n; * @param An iucv userId&n; *&n; * @returns The printable string (static data!!)&n; */
r_static
id|__inline__
r_char
op_star
DECL|function|netiucv_printname
id|netiucv_printname
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_static
r_char
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
r_char
op_star
id|p
op_assign
id|tmp
suffix:semicolon
id|memcpy
c_func
(paren
id|tmp
comma
id|name
comma
l_int|8
)paren
suffix:semicolon
id|tmp
(braket
l_int|8
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
)paren
id|p
op_increment
suffix:semicolon
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
"&f;"
multiline_comment|/**&n; * States of the interface statemachine.&n; */
DECL|enum|dev_states
r_enum
id|dev_states
(brace
DECL|enumerator|DEV_STATE_STOPPED
id|DEV_STATE_STOPPED
comma
DECL|enumerator|DEV_STATE_STARTWAIT
id|DEV_STATE_STARTWAIT
comma
DECL|enumerator|DEV_STATE_STOPWAIT
id|DEV_STATE_STOPWAIT
comma
DECL|enumerator|DEV_STATE_RUNNING
id|DEV_STATE_RUNNING
comma
multiline_comment|/**&n;&t; * MUST be always the last element!!&n;&t; */
DECL|enumerator|NR_DEV_STATES
id|NR_DEV_STATES
)brace
suffix:semicolon
DECL|variable|dev_state_names
r_static
r_const
r_char
op_star
id|dev_state_names
(braket
)braket
op_assign
(brace
l_string|&quot;Stopped&quot;
comma
l_string|&quot;StartWait&quot;
comma
l_string|&quot;StopWait&quot;
comma
l_string|&quot;Running&quot;
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * Events of the interface statemachine.&n; */
DECL|enum|dev_events
r_enum
id|dev_events
(brace
DECL|enumerator|DEV_EVENT_START
id|DEV_EVENT_START
comma
DECL|enumerator|DEV_EVENT_STOP
id|DEV_EVENT_STOP
comma
DECL|enumerator|DEV_EVENT_CONUP
id|DEV_EVENT_CONUP
comma
DECL|enumerator|DEV_EVENT_CONDOWN
id|DEV_EVENT_CONDOWN
comma
multiline_comment|/**&n;&t; * MUST be always the last element!!&n;&t; */
DECL|enumerator|NR_DEV_EVENTS
id|NR_DEV_EVENTS
)brace
suffix:semicolon
DECL|variable|dev_event_names
r_static
r_const
r_char
op_star
id|dev_event_names
(braket
)braket
op_assign
(brace
l_string|&quot;Start&quot;
comma
l_string|&quot;Stop&quot;
comma
l_string|&quot;Connection up&quot;
comma
l_string|&quot;Connection down&quot;
comma
)brace
suffix:semicolon
"&f;"
multiline_comment|/**&n; * Events of the connection statemachine&n; */
DECL|enum|conn_events
r_enum
id|conn_events
(brace
multiline_comment|/**&n;&t; * Events, representing callbacks from&n;&t; * lowlevel iucv layer)&n;&t; */
DECL|enumerator|CONN_EVENT_CONN_REQ
id|CONN_EVENT_CONN_REQ
comma
DECL|enumerator|CONN_EVENT_CONN_ACK
id|CONN_EVENT_CONN_ACK
comma
DECL|enumerator|CONN_EVENT_CONN_REJ
id|CONN_EVENT_CONN_REJ
comma
DECL|enumerator|CONN_EVENT_CONN_SUS
id|CONN_EVENT_CONN_SUS
comma
DECL|enumerator|CONN_EVENT_CONN_RES
id|CONN_EVENT_CONN_RES
comma
DECL|enumerator|CONN_EVENT_RX
id|CONN_EVENT_RX
comma
DECL|enumerator|CONN_EVENT_TXDONE
id|CONN_EVENT_TXDONE
comma
multiline_comment|/**&n;&t; * Events, representing errors return codes from&n;&t; * calls to lowlevel iucv layer&n;&t; */
multiline_comment|/**&n;&t; * Event, representing timer expiry.&n;&t; */
DECL|enumerator|CONN_EVENT_TIMER
id|CONN_EVENT_TIMER
comma
multiline_comment|/**&n;&t; * Events, representing commands from upper levels.&n;&t; */
DECL|enumerator|CONN_EVENT_START
id|CONN_EVENT_START
comma
DECL|enumerator|CONN_EVENT_STOP
id|CONN_EVENT_STOP
comma
multiline_comment|/**&n;&t; * MUST be always the last element!!&n;&t; */
DECL|enumerator|NR_CONN_EVENTS
id|NR_CONN_EVENTS
comma
)brace
suffix:semicolon
DECL|variable|conn_event_names
r_static
r_const
r_char
op_star
id|conn_event_names
(braket
)braket
op_assign
(brace
l_string|&quot;Remote connection request&quot;
comma
l_string|&quot;Remote connection acknowledge&quot;
comma
l_string|&quot;Remote connection reject&quot;
comma
l_string|&quot;Connection suspended&quot;
comma
l_string|&quot;Connection resumed&quot;
comma
l_string|&quot;Data received&quot;
comma
l_string|&quot;Data sent&quot;
comma
l_string|&quot;Timer&quot;
comma
l_string|&quot;Start&quot;
comma
l_string|&quot;Stop&quot;
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * States of the connection statemachine.&n; */
DECL|enum|conn_states
r_enum
id|conn_states
(brace
multiline_comment|/**&n;&t; * Connection not assigned to any device,&n;&t; * initial state, invalid&n;&t; */
DECL|enumerator|CONN_STATE_INVALID
id|CONN_STATE_INVALID
comma
multiline_comment|/**&n;&t; * Userid assigned but not operating&n;&t; */
DECL|enumerator|CONN_STATE_STOPPED
id|CONN_STATE_STOPPED
comma
multiline_comment|/**&n;&t; * Connection registered,&n;&t; * no connection request sent yet,&n;&t; * no connection request received&n;&t; */
DECL|enumerator|CONN_STATE_STARTWAIT
id|CONN_STATE_STARTWAIT
comma
multiline_comment|/**&n;&t; * Connection registered and connection request sent,&n;&t; * no acknowledge and no connection request received yet.&n;&t; */
DECL|enumerator|CONN_STATE_SETUPWAIT
id|CONN_STATE_SETUPWAIT
comma
multiline_comment|/**&n;&t; * Connection up and running idle&n;&t; */
DECL|enumerator|CONN_STATE_IDLE
id|CONN_STATE_IDLE
comma
multiline_comment|/**&n;&t; * Data sent, awaiting CONN_EVENT_TXDONE&n;&t; */
DECL|enumerator|CONN_STATE_TX
id|CONN_STATE_TX
comma
multiline_comment|/**&n;&t; * Terminating&n;&t; */
DECL|enumerator|CONN_STATE_TERM
id|CONN_STATE_TERM
comma
multiline_comment|/**&n;&t; * Error during registration.&n;&t; */
DECL|enumerator|CONN_STATE_REGERR
id|CONN_STATE_REGERR
comma
multiline_comment|/**&n;&t; * Error during registration.&n;&t; */
DECL|enumerator|CONN_STATE_CONNERR
id|CONN_STATE_CONNERR
comma
multiline_comment|/**&n;&t; * MUST be always the last element!!&n;&t; */
DECL|enumerator|NR_CONN_STATES
id|NR_CONN_STATES
comma
)brace
suffix:semicolon
DECL|variable|conn_state_names
r_static
r_const
r_char
op_star
id|conn_state_names
(braket
)braket
op_assign
(brace
l_string|&quot;Invalid&quot;
comma
l_string|&quot;Stopped&quot;
comma
l_string|&quot;StartWait&quot;
comma
l_string|&quot;SetupWait&quot;
comma
l_string|&quot;Idle&quot;
comma
l_string|&quot;TX&quot;
comma
l_string|&quot;Terminating&quot;
comma
l_string|&quot;Registration error&quot;
comma
l_string|&quot;Connect error&quot;
comma
)brace
suffix:semicolon
"&f;"
multiline_comment|/**&n; * Callback-wrappers, called from lowlevel iucv layer.&n; *****************************************************************************/
r_static
r_void
DECL|function|netiucv_callback_rx
id|netiucv_callback_rx
c_func
(paren
id|iucv_MessagePending
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_RX
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_txdone
id|netiucv_callback_txdone
c_func
(paren
id|iucv_MessageComplete
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_TXDONE
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_connack
id|netiucv_callback_connack
c_func
(paren
id|iucv_ConnectionComplete
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_CONN_ACK
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_connreq
id|netiucv_callback_connreq
c_func
(paren
id|iucv_ConnectionPending
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_CONN_REQ
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_connrej
id|netiucv_callback_connrej
c_func
(paren
id|iucv_ConnectionSevered
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_CONN_REJ
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_connsusp
id|netiucv_callback_connsusp
c_func
(paren
id|iucv_ConnectionQuiesced
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_CONN_SUS
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_callback_connres
id|netiucv_callback_connres
c_func
(paren
id|iucv_ConnectionResumed
op_star
id|eib
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|pgm_data
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
id|ev.conn
op_assign
id|conn
suffix:semicolon
id|ev.data
op_assign
(paren
r_void
op_star
)paren
id|eib
suffix:semicolon
id|fsm_event
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_EVENT_CONN_RES
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
DECL|variable|netiucv_ops
r_static
id|iucv_interrupt_ops_t
id|netiucv_ops
op_assign
(brace
id|ConnectionPending
suffix:colon
id|netiucv_callback_connreq
comma
id|ConnectionComplete
suffix:colon
id|netiucv_callback_connack
comma
id|ConnectionSevered
suffix:colon
id|netiucv_callback_connrej
comma
id|ConnectionQuiesced
suffix:colon
id|netiucv_callback_connsusp
comma
id|ConnectionResumed
suffix:colon
id|netiucv_callback_connres
comma
id|MessagePending
suffix:colon
id|netiucv_callback_rx
comma
id|MessageComplete
suffix:colon
id|netiucv_callback_txdone
)brace
suffix:semicolon
multiline_comment|/**&n; * Dummy NOP action for all statemachines&n; */
r_static
r_void
DECL|function|fsm_action_nop
id|fsm_action_nop
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
)brace
"&f;"
multiline_comment|/**&n; * Actions of the connection statemachine&n; *****************************************************************************/
multiline_comment|/**&n; * Helper function for conn_action_rx()&n; * Unpack a just received skb and hand it over to&n; * upper layers.&n; *&n; * @param conn The connection where this skb has been received.&n; * @param pskb The received skb.&n; */
singleline_comment|//static __inline__ void
r_static
r_void
DECL|function|netiucv_unpack_skb
id|netiucv_unpack_skb
c_func
(paren
id|iucv_connection
op_star
id|conn
comma
r_struct
id|sk_buff
op_star
id|pskb
)paren
(brace
id|net_device
op_star
id|dev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|__u16
id|offset
op_assign
l_int|0
suffix:semicolon
id|skb_put
c_func
(paren
id|pskb
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|pskb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|pskb-&gt;ip_summed
op_assign
id|CHECKSUM_NONE
suffix:semicolon
id|pskb-&gt;protocol
op_assign
id|ntohs
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|ll_header
op_star
id|header
op_assign
(paren
id|ll_header
op_star
)paren
id|pskb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|header-&gt;next
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|skb_pull
c_func
(paren
id|pskb
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|header-&gt;next
op_sub_assign
id|offset
suffix:semicolon
id|offset
op_add_assign
id|header-&gt;next
suffix:semicolon
id|header-&gt;next
op_sub_assign
id|NETIUCV_HDRLEN
suffix:semicolon
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|pskb
)paren
OL
id|header-&gt;next
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Illegal next field in iucv header: %d &gt; %d&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|header-&gt;next
comma
id|skb_tailroom
c_func
(paren
id|pskb
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|pskb
comma
id|header-&gt;next
)paren
suffix:semicolon
id|pskb-&gt;mac.raw
op_assign
id|pskb-&gt;data
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|pskb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s Out of memory in netiucv_unpack_skb&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|privptr-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|pskb-&gt;len
)paren
comma
id|pskb-&gt;data
comma
id|pskb-&gt;len
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|skb-&gt;dev
op_assign
id|pskb-&gt;dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|pskb-&gt;protocol
suffix:semicolon
id|pskb-&gt;ip_summed
op_assign
id|CHECKSUM_UNNECESSARY
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
macro_line|#warning FIXME: [kj] Net drivers should set dev-&gt;last_rx immediately after netif_rx
id|privptr-&gt;stats.rx_packets
op_increment
suffix:semicolon
id|privptr-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|skb_pull
c_func
(paren
id|pskb
comma
id|header-&gt;next
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|pskb
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|conn_action_rx
id|conn_action_rx
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|iucv_MessagePending
op_star
id|eib
op_assign
(paren
id|iucv_MessagePending
op_star
)paren
id|ev-&gt;data
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|conn-&gt;netdev-&gt;priv
suffix:semicolon
id|__u16
id|msglen
op_assign
id|eib-&gt;ln1msg2.ipbfln1f
suffix:semicolon
r_int
id|rc
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|conn-&gt;netdev
)paren
(brace
multiline_comment|/* FRITZ: How to tell iucv LL to drop the msg? */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Received data for unlinked connection&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msglen
OG
id|conn-&gt;max_buffsize
)paren
(brace
multiline_comment|/* FRITZ: How to tell iucv LL to drop the msg? */
id|privptr-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|conn-&gt;rx_buff-&gt;data
op_assign
id|conn-&gt;rx_buff-&gt;tail
op_assign
id|conn-&gt;rx_buff-&gt;head
suffix:semicolon
id|conn-&gt;rx_buff-&gt;len
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|iucv_receive
c_func
(paren
id|conn-&gt;pathid
comma
id|eib-&gt;ipmsgid
comma
id|eib-&gt;iptrgcls
comma
id|conn-&gt;rx_buff-&gt;data
comma
id|msglen
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
op_logical_or
id|msglen
OL
l_int|5
)paren
(brace
id|privptr-&gt;stats.rx_errors
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
id|netiucv_unpack_skb
c_func
(paren
id|conn
comma
id|conn-&gt;rx_buff
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_txdone
id|conn_action_txdone
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|iucv_MessageComplete
op_star
id|eib
op_assign
(paren
id|iucv_MessageComplete
op_star
)paren
id|ev-&gt;data
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Shut up, gcc! skb is always below 2G. */
r_struct
id|sk_buff
op_star
id|skb
op_assign
(paren
r_struct
id|sk_buff
op_star
)paren
(paren
r_int
r_int
)paren
id|eib-&gt;ipmsgtag
suffix:semicolon
id|__u32
id|txbytes
op_assign
l_int|0
suffix:semicolon
id|__u32
id|txpackets
op_assign
l_int|0
suffix:semicolon
id|__u32
id|stat_maxcq
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|saveflags
suffix:semicolon
id|ll_header
id|header
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|fsm_deltimer
c_func
(paren
op_amp
id|conn-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
op_logical_and
id|conn-&gt;netdev
op_logical_and
id|conn-&gt;netdev-&gt;priv
)paren
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|conn-&gt;netdev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
r_if
c_cond
(paren
id|privptr
)paren
(brace
id|privptr-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|privptr-&gt;stats.tx_bytes
op_add_assign
(paren
id|skb-&gt;len
op_minus
id|NETIUCV_HDRLEN
op_minus
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
)brace
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|conn-&gt;tx_buff-&gt;data
op_assign
id|conn-&gt;tx_buff-&gt;tail
op_assign
id|conn-&gt;tx_buff-&gt;head
suffix:semicolon
id|conn-&gt;tx_buff-&gt;len
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|conn-&gt;collect_lock
comma
id|saveflags
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|conn-&gt;collect_queue
)paren
)paren
)paren
(brace
id|header.next
op_assign
id|conn-&gt;tx_buff-&gt;len
op_plus
id|skb-&gt;len
op_plus
id|NETIUCV_HDRLEN
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|conn-&gt;tx_buff
comma
id|NETIUCV_HDRLEN
)paren
comma
op_amp
id|header
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|conn-&gt;tx_buff
comma
id|skb-&gt;len
)paren
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|txbytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|txpackets
op_increment
suffix:semicolon
id|stat_maxcq
op_increment
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|conn-&gt;collect_len
OG
id|conn-&gt;prof.maxmulti
)paren
id|conn-&gt;prof.maxmulti
op_assign
id|conn-&gt;collect_len
suffix:semicolon
id|conn-&gt;collect_len
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|conn-&gt;collect_lock
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;tx_buff-&gt;len
)paren
(brace
r_int
id|rc
suffix:semicolon
id|header.next
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|conn-&gt;tx_buff
comma
id|NETIUCV_HDRLEN
)paren
comma
op_amp
id|header
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|fsm_addtimer
c_func
(paren
op_amp
id|conn-&gt;timer
comma
id|NETIUCV_TIMEOUT_5SEC
comma
id|CONN_EVENT_TIMER
comma
id|conn
)paren
suffix:semicolon
id|conn-&gt;prof.send_stamp
op_assign
id|xtime
suffix:semicolon
id|rc
op_assign
id|iucv_send
c_func
(paren
id|conn-&gt;pathid
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|conn-&gt;tx_buff-&gt;data
comma
id|conn-&gt;tx_buff-&gt;len
)paren
suffix:semicolon
id|conn-&gt;prof.doios_multi
op_increment
suffix:semicolon
id|conn-&gt;prof.txlen
op_add_assign
id|conn-&gt;tx_buff-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|fsm_deltimer
c_func
(paren
op_amp
id|conn-&gt;timer
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_IDLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|privptr
)paren
id|privptr-&gt;stats.tx_errors
op_add_assign
id|txpackets
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|privptr
)paren
(brace
id|privptr-&gt;stats.tx_packets
op_add_assign
id|txpackets
suffix:semicolon
id|privptr-&gt;stats.tx_bytes
op_add_assign
id|txbytes
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat_maxcq
OG
id|conn-&gt;prof.maxcqueue
)paren
id|conn-&gt;prof.maxcqueue
op_assign
id|stat_maxcq
suffix:semicolon
)brace
)brace
r_else
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_IDLE
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_connaccept
id|conn_action_connaccept
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|iucv_ConnectionPending
op_star
id|eib
op_assign
(paren
id|iucv_ConnectionPending
op_star
)paren
id|ev-&gt;data
suffix:semicolon
id|net_device
op_star
id|netdev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|netdev-&gt;priv
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|__u16
id|msglimit
suffix:semicolon
id|__u8
id|udata
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
id|iucv_accept
c_func
(paren
id|eib-&gt;ippathid
comma
id|NETIUCV_QUEUELEN_DEFAULT
comma
id|udata
comma
l_int|0
comma
id|conn-&gt;handle
comma
id|conn
comma
l_int|NULL
comma
op_amp
id|msglimit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: IUCV accept failed with error %d&bslash;n&quot;
comma
id|netdev-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_IDLE
)paren
suffix:semicolon
id|conn-&gt;pathid
op_assign
id|eib-&gt;ippathid
suffix:semicolon
id|netdev-&gt;tx_queue_len
op_assign
id|msglimit
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_EVENT_CONUP
comma
id|netdev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_connreject
id|conn_action_connreject
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
singleline_comment|// iucv_connection *conn = ev-&gt;conn;
id|iucv_ConnectionPending
op_star
id|eib
op_assign
(paren
id|iucv_ConnectionPending
op_star
)paren
id|ev-&gt;data
suffix:semicolon
id|__u8
id|udata
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|iucv_sever
c_func
(paren
id|eib-&gt;ippathid
comma
id|udata
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_connack
id|conn_action_connack
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|iucv_ConnectionComplete
op_star
id|eib
op_assign
(paren
id|iucv_ConnectionComplete
op_star
)paren
id|ev-&gt;data
suffix:semicolon
id|net_device
op_star
id|netdev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|netdev-&gt;priv
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_IDLE
)paren
suffix:semicolon
id|conn-&gt;pathid
op_assign
id|eib-&gt;ippathid
suffix:semicolon
id|netdev-&gt;tx_queue_len
op_assign
id|eib-&gt;ipmsglim
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_EVENT_CONUP
comma
id|netdev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_connsever
id|conn_action_connsever
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
singleline_comment|// iucv_ConnectionSevered *eib = (iucv_ConnectionSevered *)ev-&gt;data;
id|net_device
op_star
id|netdev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|netdev-&gt;priv
suffix:semicolon
r_int
id|state
op_assign
id|fsm_getstate
c_func
(paren
id|fi
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|CONN_STATE_IDLE
suffix:colon
r_case
id|CONN_STATE_TX
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: Remote dropped connection&bslash;n&quot;
comma
id|netdev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;handle
)paren
id|iucv_unregister_program
c_func
(paren
id|conn-&gt;handle
)paren
suffix:semicolon
id|conn-&gt;handle
op_assign
l_int|0
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_STOPPED
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_EVENT_CONDOWN
comma
id|netdev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|conn_action_start
id|conn_action_start
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
r_int
id|rc
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|conn-&gt;handle
op_eq
l_int|0
)paren
(brace
id|conn-&gt;handle
op_assign
id|iucv_register_program
c_func
(paren
id|iucvMagic
comma
id|conn-&gt;userid
comma
id|mask
comma
op_amp
id|netiucv_ops
comma
id|conn
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_STARTWAIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;handle
op_le
l_int|0
)paren
(brace
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_REGERR
)paren
suffix:semicolon
id|conn-&gt;handle
op_assign
l_int|0
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(&squot;%s&squot;): registered successfully&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|conn-&gt;userid
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s(&squot;%s&squot;): connecting ...&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|conn-&gt;userid
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
id|iucv_connect
c_func
(paren
op_amp
(paren
id|conn-&gt;pathid
)paren
comma
id|NETIUCV_QUEUELEN_DEFAULT
comma
id|iucvMagic
comma
id|conn-&gt;userid
comma
id|iucv_host
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
id|conn-&gt;handle
comma
id|conn
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_SETUPWAIT
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rc
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
suffix:semicolon
r_case
l_int|11
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: User %s is currently not available.&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|netiucv_printname
c_func
(paren
id|conn-&gt;userid
)paren
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_STARTWAIT
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|12
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%s: User %s is currently not ready.&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|netiucv_printname
c_func
(paren
id|conn-&gt;userid
)paren
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_STARTWAIT
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_int|13
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Too many IUCV connections.&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_CONNERR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|14
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: User %s has too many IUCV connections.&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|netiucv_printname
c_func
(paren
id|conn-&gt;userid
)paren
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_CONNERR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: No IUCV authorization in CP directory.&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_CONNERR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: iucv_connect returned error %d&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
comma
id|rc
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_CONNERR
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|iucv_unregister_program
c_func
(paren
id|conn-&gt;handle
)paren
suffix:semicolon
id|conn-&gt;handle
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_purge_skb_queue
id|netiucv_purge_skb_queue
c_func
(paren
r_struct
id|sk_buff_head
op_star
id|q
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|conn_action_stop
id|conn_action_stop
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|net_device
op_star
id|netdev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|netdev-&gt;priv
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|fsm_newstate
c_func
(paren
id|fi
comma
id|CONN_STATE_STOPPED
)paren
suffix:semicolon
id|netiucv_purge_skb_queue
c_func
(paren
op_amp
id|conn-&gt;collect_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;handle
)paren
id|iucv_unregister_program
c_func
(paren
id|conn-&gt;handle
)paren
suffix:semicolon
id|conn-&gt;handle
op_assign
l_int|0
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_EVENT_CONDOWN
comma
id|netdev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|conn_action_inval
id|conn_action_inval
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|iucv_event
op_star
id|ev
op_assign
(paren
id|iucv_event
op_star
)paren
id|arg
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
id|ev-&gt;conn
suffix:semicolon
id|net_device
op_star
id|netdev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Cannot connect without username&bslash;n&quot;
comma
id|netdev-&gt;name
)paren
suffix:semicolon
)brace
DECL|variable|conn_fsm
r_static
r_const
id|fsm_node
id|conn_fsm
(braket
)braket
op_assign
(brace
(brace
id|CONN_STATE_INVALID
comma
id|CONN_EVENT_START
comma
id|conn_action_inval
)brace
comma
(brace
id|CONN_STATE_STOPPED
comma
id|CONN_EVENT_START
comma
id|conn_action_start
)brace
comma
(brace
id|CONN_STATE_STARTWAIT
comma
id|CONN_EVENT_START
comma
id|conn_action_start
)brace
comma
(brace
id|CONN_STATE_STARTWAIT
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_SETUPWAIT
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_IDLE
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_TX
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_REGERR
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_CONNERR
comma
id|CONN_EVENT_STOP
comma
id|conn_action_stop
)brace
comma
(brace
id|CONN_STATE_STOPPED
comma
id|CONN_EVENT_CONN_REQ
comma
id|conn_action_connreject
)brace
comma
(brace
id|CONN_STATE_STARTWAIT
comma
id|CONN_EVENT_CONN_REQ
comma
id|conn_action_connaccept
)brace
comma
(brace
id|CONN_STATE_SETUPWAIT
comma
id|CONN_EVENT_CONN_REQ
comma
id|conn_action_connaccept
)brace
comma
(brace
id|CONN_STATE_IDLE
comma
id|CONN_EVENT_CONN_REQ
comma
id|conn_action_connreject
)brace
comma
(brace
id|CONN_STATE_TX
comma
id|CONN_EVENT_CONN_REQ
comma
id|conn_action_connreject
)brace
comma
(brace
id|CONN_STATE_SETUPWAIT
comma
id|CONN_EVENT_CONN_ACK
comma
id|conn_action_connack
)brace
comma
(brace
id|CONN_STATE_SETUPWAIT
comma
id|CONN_EVENT_CONN_REJ
comma
id|conn_action_connsever
)brace
comma
(brace
id|CONN_STATE_IDLE
comma
id|CONN_EVENT_CONN_REJ
comma
id|conn_action_connsever
)brace
comma
(brace
id|CONN_STATE_TX
comma
id|CONN_EVENT_CONN_REJ
comma
id|conn_action_connsever
)brace
comma
(brace
id|CONN_STATE_IDLE
comma
id|CONN_EVENT_RX
comma
id|conn_action_rx
)brace
comma
(brace
id|CONN_STATE_TX
comma
id|CONN_EVENT_RX
comma
id|conn_action_rx
)brace
comma
(brace
id|CONN_STATE_TX
comma
id|CONN_EVENT_TXDONE
comma
id|conn_action_txdone
)brace
comma
)brace
suffix:semicolon
DECL|variable|CONN_FSM_LEN
r_static
r_const
r_int
id|CONN_FSM_LEN
op_assign
r_sizeof
(paren
id|conn_fsm
)paren
op_div
r_sizeof
(paren
id|fsm_node
)paren
suffix:semicolon
"&f;"
multiline_comment|/**&n; * Actions for interface - statemachine.&n; *****************************************************************************/
multiline_comment|/**&n; * Startup connection by sending CONN_EVENT_START to it.&n; *&n; * @param fi    An instance of an interface statemachine.&n; * @param event The event, just happened.&n; * @param arg   Generic pointer, casted from net_device * upon call.&n; */
r_static
r_void
DECL|function|dev_action_start
id|dev_action_start
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|net_device
op_star
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|arg
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|ev.conn
op_assign
id|privptr-&gt;conn
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|DEV_STATE_STARTWAIT
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;conn-&gt;fsm
comma
id|CONN_EVENT_START
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Shutdown connection by sending CONN_EVENT_STOP to it.&n; *&n; * @param fi    An instance of an interface statemachine.&n; * @param event The event, just happened.&n; * @param arg   Generic pointer, casted from net_device * upon call.&n; */
r_static
r_void
DECL|function|dev_action_stop
id|dev_action_stop
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|net_device
op_star
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|arg
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
id|ev.conn
op_assign
id|privptr-&gt;conn
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|DEV_STATE_STOPWAIT
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;conn-&gt;fsm
comma
id|CONN_EVENT_STOP
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Called from connection statemachine&n; * when a connection is up and running.&n; *&n; * @param fi    An instance of an interface statemachine.&n; * @param event The event, just happened.&n; * @param arg   Generic pointer, casted from net_device * upon call.&n; */
r_static
r_void
DECL|function|dev_action_connup
id|dev_action_connup
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|net_device
op_star
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|arg
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|fsm_getstate
c_func
(paren
id|fi
)paren
)paren
(brace
r_case
id|DEV_STATE_STARTWAIT
suffix:colon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|DEV_STATE_RUNNING
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: connected with remote side&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DEV_STATE_STOPWAIT
suffix:colon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: got connection UP event during shutdown!!&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * Called from connection statemachine&n; * when a connection has been shutdown.&n; *&n; * @param fi    An instance of an interface statemachine.&n; * @param event The event, just happened.&n; * @param arg   Generic pointer, casted from net_device * upon call.&n; */
r_static
r_void
DECL|function|dev_action_conndown
id|dev_action_conndown
c_func
(paren
id|fsm_instance
op_star
id|fi
comma
r_int
id|event
comma
r_void
op_star
id|arg
)paren
(brace
id|net_device
op_star
id|dev
op_assign
(paren
id|net_device
op_star
)paren
id|arg
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
id|iucv_event
id|ev
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s() called&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|fsm_getstate
c_func
(paren
id|fi
)paren
)paren
(brace
r_case
id|DEV_STATE_RUNNING
suffix:colon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|DEV_STATE_STARTWAIT
)paren
suffix:semicolon
id|ev.conn
op_assign
id|privptr-&gt;conn
suffix:semicolon
id|fsm_event
c_func
(paren
id|privptr-&gt;conn-&gt;fsm
comma
id|CONN_EVENT_START
comma
op_amp
id|ev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DEV_STATE_STARTWAIT
suffix:colon
r_break
suffix:semicolon
r_case
id|DEV_STATE_STOPWAIT
suffix:colon
id|fsm_newstate
c_func
(paren
id|fi
comma
id|DEV_STATE_STOPPED
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|variable|dev_fsm
r_static
r_const
id|fsm_node
id|dev_fsm
(braket
)braket
op_assign
(brace
(brace
id|DEV_STATE_STOPPED
comma
id|DEV_EVENT_START
comma
id|dev_action_start
)brace
comma
(brace
id|DEV_STATE_STOPWAIT
comma
id|DEV_EVENT_START
comma
id|dev_action_start
)brace
comma
(brace
id|DEV_STATE_STOPWAIT
comma
id|DEV_EVENT_CONDOWN
comma
id|dev_action_conndown
)brace
comma
(brace
id|DEV_STATE_STARTWAIT
comma
id|DEV_EVENT_STOP
comma
id|dev_action_stop
)brace
comma
(brace
id|DEV_STATE_STARTWAIT
comma
id|DEV_EVENT_CONUP
comma
id|dev_action_connup
)brace
comma
(brace
id|DEV_STATE_STARTWAIT
comma
id|DEV_EVENT_CONDOWN
comma
id|dev_action_conndown
)brace
comma
(brace
id|DEV_STATE_RUNNING
comma
id|DEV_EVENT_STOP
comma
id|dev_action_stop
)brace
comma
(brace
id|DEV_STATE_RUNNING
comma
id|DEV_EVENT_CONDOWN
comma
id|dev_action_conndown
)brace
comma
(brace
id|DEV_STATE_RUNNING
comma
id|DEV_EVENT_CONUP
comma
id|fsm_action_nop
)brace
comma
)brace
suffix:semicolon
DECL|variable|DEV_FSM_LEN
r_static
r_const
r_int
id|DEV_FSM_LEN
op_assign
r_sizeof
(paren
id|dev_fsm
)paren
op_div
r_sizeof
(paren
id|fsm_node
)paren
suffix:semicolon
multiline_comment|/**&n; * Transmit a packet.&n; * This is a helper function for netiucv_tx().&n; *&n; * @param conn Connection to be used for sending.&n; * @param skb Pointer to struct sk_buff of packet to send.&n; *            The linklevel header has already been set up&n; *            by netiucv_tx().&n; *&n; * @return 0 on success, -ERRNO on failure. (Never fails.)&n; */
r_static
r_int
DECL|function|netiucv_transmit_skb
id|netiucv_transmit_skb
c_func
(paren
id|iucv_connection
op_star
id|conn
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|saveflags
suffix:semicolon
id|ll_header
id|header
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|fsm_getstate
c_func
(paren
id|conn-&gt;fsm
)paren
op_ne
id|CONN_STATE_IDLE
)paren
(brace
r_int
id|l
op_assign
id|skb-&gt;len
op_plus
id|NETIUCV_HDRLEN
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|conn-&gt;collect_lock
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;collect_len
op_plus
id|l
OG
(paren
id|conn-&gt;max_buffsize
op_minus
id|NETIUCV_HDRLEN
)paren
)paren
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_else
(brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|conn-&gt;collect_queue
comma
id|skb
)paren
suffix:semicolon
id|conn-&gt;collect_len
op_add_assign
id|l
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|conn-&gt;collect_lock
comma
id|saveflags
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|sk_buff
op_star
id|nskb
op_assign
id|skb
suffix:semicolon
multiline_comment|/**&n;&t;&t; * Copy the skb to a new allocated skb in lowmem only if the&n;&t;&t; * data is located above 2G in memory or tailroom is &lt; 2.&n;&t;&t; */
r_int
r_int
id|hi
op_assign
(paren
(paren
r_int
r_int
)paren
(paren
id|skb-&gt;tail
op_plus
id|NETIUCV_HDRLEN
)paren
)paren
op_rshift
l_int|31
suffix:semicolon
r_int
id|copied
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hi
op_logical_or
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
l_int|2
)paren
)paren
(brace
id|nskb
op_assign
id|alloc_skb
c_func
(paren
id|skb-&gt;len
op_plus
id|NETIUCV_HDRLEN
op_plus
id|NETIUCV_HDRLEN
comma
id|GFP_ATOMIC
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nskb
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Could not allocate tx_skb&bslash;n&quot;
comma
id|conn-&gt;netdev-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_else
(brace
id|skb_reserve
c_func
(paren
id|nskb
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|nskb
comma
id|skb-&gt;len
)paren
comma
id|skb-&gt;data
comma
id|skb-&gt;len
)paren
suffix:semicolon
)brace
id|copied
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n;&t;&t; * skb now is below 2G and has enough room. Add headers.&n;&t;&t; */
id|header.next
op_assign
id|nskb-&gt;len
op_plus
id|NETIUCV_HDRLEN
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_push
c_func
(paren
id|nskb
comma
id|NETIUCV_HDRLEN
)paren
comma
op_amp
id|header
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|header.next
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|nskb
comma
id|NETIUCV_HDRLEN
)paren
comma
op_amp
id|header
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|conn-&gt;retry
op_assign
l_int|0
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_STATE_TX
)paren
suffix:semicolon
id|fsm_addtimer
c_func
(paren
op_amp
id|conn-&gt;timer
comma
id|NETIUCV_TIMEOUT_5SEC
comma
id|CONN_EVENT_TIMER
comma
id|conn
)paren
suffix:semicolon
id|conn-&gt;prof.send_stamp
op_assign
id|xtime
suffix:semicolon
id|rc
op_assign
id|iucv_send
c_func
(paren
id|conn-&gt;pathid
comma
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* Shut up, gcc! nskb is always below 2G. */
(paren
id|__u32
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|nskb
)paren
op_amp
l_int|0xffffffff
)paren
comma
l_int|0
comma
id|nskb-&gt;data
comma
id|nskb-&gt;len
)paren
suffix:semicolon
id|conn-&gt;prof.doios_single
op_increment
suffix:semicolon
id|conn-&gt;prof.txlen
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|fsm_deltimer
c_func
(paren
op_amp
id|conn-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copied
)paren
id|dev_kfree_skb
c_func
(paren
id|nskb
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/**&n;&t;&t;&t;&t; * Remove our headers. They get added&n;&t;&t;&t;&t; * again on retransmit.&n;&t;&t;&t;&t; */
id|skb_pull
c_func
(paren
id|skb
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|skb-&gt;len
op_minus
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|copied
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
"&f;"
multiline_comment|/**&n; * Interface API for upper network layers&n; *****************************************************************************/
multiline_comment|/**&n; * Open an interface.&n; * Called from generic network layer when ifconfig up is run.&n; *&n; * @param dev Pointer to interface struct.&n; *&n; * @return 0 on success, -ERRNO on failure. (Never fails.)&n; */
r_static
r_int
DECL|function|netiucv_open
id|netiucv_open
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
id|SET_DEVICE_START
c_func
(paren
id|dev
comma
l_int|1
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
(paren
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|fsm
comma
id|DEV_EVENT_START
comma
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * Close an interface.&n; * Called from generic network layer when ifconfig down is run.&n; *&n; * @param dev Pointer to interface struct.&n; *&n; * @return 0 on success, -ERRNO on failure. (Never fails.)&n; */
r_static
r_int
DECL|function|netiucv_close
id|netiucv_close
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|SET_DEVICE_START
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
id|fsm_event
c_func
(paren
(paren
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|fsm
comma
id|DEV_EVENT_STOP
comma
id|dev
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * Start transmission of a packet.&n; * Called from generic network device layer.&n; *&n; * @param skb Pointer to buffer containing the packet.&n; * @param dev Pointer to interface struct.&n; *&n; * @return 0 if packet consumed, !0 if packet rejected.&n; *         Note: If we return !0, then the packet is free&squot;d by&n; *               the generic network layer.&n; */
DECL|function|netiucv_tx
r_static
r_int
id|netiucv_tx
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|net_device
op_star
id|dev
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/**&n;&t; * Some sanity checks ...&n;&t; */
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NULL sk_buff passed&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|privptr-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb_headroom
c_func
(paren
id|skb
)paren
OL
(paren
id|NETIUCV_HDRLEN
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Got sk_buff with head room &lt; %ld bytes&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|NETIUCV_HDRLEN
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|privptr-&gt;stats.tx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n;&t; * If connection is not running, try to restart it&n;&t; * notify anybody about a link failure and throw&n;&t; * away packet. &n;&t; */
r_if
c_cond
(paren
id|fsm_getstate
c_func
(paren
id|privptr-&gt;fsm
)paren
op_ne
id|DEV_STATE_RUNNING
)paren
(brace
id|fsm_event
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_EVENT_START
comma
id|dev
)paren
suffix:semicolon
id|dst_link_failure
c_func
(paren
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|privptr-&gt;stats.tx_dropped
op_increment
suffix:semicolon
id|privptr-&gt;stats.tx_errors
op_increment
suffix:semicolon
id|privptr-&gt;stats.tx_carrier_errors
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|netiucv_test_and_set_busy
c_func
(paren
id|dev
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|netiucv_transmit_skb
c_func
(paren
id|privptr-&gt;conn
comma
id|skb
)paren
op_ne
l_int|0
)paren
id|rc
op_assign
l_int|1
suffix:semicolon
id|netiucv_clear_busy
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; * Returns interface statistics of a device.&n; *&n; * @param dev Pointer to interface struct.&n; *&n; * @return Pointer to stats struct of this interface.&n; */
r_static
r_struct
id|net_device_stats
op_star
DECL|function|netiucv_stats
id|netiucv_stats
(paren
id|net_device
op_star
id|dev
)paren
(brace
r_return
op_amp
(paren
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
)paren
op_member_access_from_pointer
id|stats
suffix:semicolon
)brace
multiline_comment|/**&n; * Sets MTU of an interface.&n; *&n; * @param dev     Pointer to interface struct.&n; * @param new_mtu The new MTU to use for this interface.&n; *&n; * @return 0 on success, -EINVAL if MTU is out of valid range.&n; *         (valid range is 576 .. NETIUCV_MTU_MAX).&n; */
r_static
r_int
DECL|function|netiucv_change_mtu
id|netiucv_change_mtu
(paren
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_if
c_cond
(paren
(paren
id|new_mtu
OL
l_int|576
)paren
op_logical_or
(paren
id|new_mtu
OG
id|NETIUCV_MTU_MAX
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
"&f;"
multiline_comment|/**&n; * procfs related structures and routines&n; *****************************************************************************/
r_static
id|net_device
op_star
DECL|function|find_netdev_by_ino
id|find_netdev_by_ino
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|pde
)paren
(brace
id|iucv_connection
op_star
id|conn
op_assign
id|connections
suffix:semicolon
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_while
c_loop
(paren
id|conn
)paren
(brace
r_if
c_cond
(paren
id|conn-&gt;netdev
op_ne
id|dev
)paren
(brace
id|dev
op_assign
id|conn-&gt;netdev
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
(paren
id|privptr-&gt;proc_buffer_entry
op_eq
id|pde
)paren
op_logical_or
(paren
id|privptr-&gt;proc_user_entry
op_eq
id|pde
)paren
op_logical_or
(paren
id|privptr-&gt;proc_stat_entry
op_eq
id|pde
)paren
)paren
r_return
id|dev
suffix:semicolon
)brace
id|conn
op_assign
id|conn-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|macro|CTRL_BUFSIZE
mdefine_line|#define CTRL_BUFSIZE 40
r_static
r_int
DECL|function|netiucv_buffer_open
id|netiucv_buffer_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
id|CTRL_BUFSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|netiucv_buffer_close
id|netiucv_buffer_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_buffer_write
id|netiucv_buffer_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_char
op_star
id|e
suffix:semicolon
r_int
id|bs1
suffix:semicolon
r_char
id|tmp
(braket
id|CTRL_BUFSIZE
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
l_int|39
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|tmp
comma
id|buf
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|tmp
(braket
id|count
op_plus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|bs1
op_assign
id|simple_strtoul
c_func
(paren
id|tmp
comma
op_amp
id|e
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bs1
OG
id|NETIUCV_BUFSIZE_MAX
)paren
op_logical_or
(paren
id|e
op_logical_and
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|e
)paren
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;flags
op_amp
id|IFF_RUNNING
)paren
op_logical_and
(paren
id|bs1
OL
(paren
id|dev-&gt;mtu
op_plus
id|NETIUCV_HDRLEN
op_plus
l_int|2
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|bs1
OL
(paren
l_int|576
op_plus
id|NETIUCV_HDRLEN
op_plus
id|NETIUCV_HDRLEN
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|privptr-&gt;conn-&gt;max_buffsize
op_assign
id|bs1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_RUNNING
)paren
)paren
id|dev-&gt;mtu
op_assign
id|bs1
op_minus
id|NETIUCV_HDRLEN
op_minus
id|NETIUCV_HDRLEN
suffix:semicolon
id|privptr-&gt;conn-&gt;flags
op_or_assign
id|CONN_FLAGS_BUFSIZE_CHANGED
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_buffer_read
id|netiucv_buffer_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_char
op_star
id|sbuf
op_assign
(paren
r_char
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
op_assign
id|sbuf
suffix:semicolon
r_int
id|l
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_eq
l_int|0
)paren
id|sprintf
c_func
(paren
id|sbuf
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;max_buffsize
)paren
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|sbuf
)paren
suffix:semicolon
id|p
op_assign
id|sbuf
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
OL
id|l
)paren
(brace
id|p
op_add_assign
id|file-&gt;f_pos
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|count
OG
id|l
)paren
ques
c_cond
id|l
suffix:colon
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|ret
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|netiucv_user_open
id|netiucv_user_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
id|CTRL_BUFSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|netiucv_user_close
id|netiucv_user_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_user_write
id|netiucv_user_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_char
id|tmp
(braket
id|CTRL_BUFSIZE
)braket
suffix:semicolon
r_char
id|user
(braket
l_int|9
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ge
l_int|39
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|tmp
comma
id|buf
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|tmp
(braket
id|count
op_plus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|memset
c_func
(paren
id|user
comma
l_char|&squot; &squot;
comma
r_sizeof
(paren
id|user
)paren
)paren
suffix:semicolon
id|user
(braket
l_int|8
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|tmp
comma
id|i
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_logical_and
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OG
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|user
(braket
id|i
op_increment
)braket
op_assign
op_star
id|p
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|user
comma
id|privptr-&gt;conn-&gt;userid
comma
l_int|8
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/* username changed */
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|privptr-&gt;conn-&gt;userid
comma
id|user
comma
l_int|9
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_user_read
id|netiucv_user_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_char
op_star
id|sbuf
op_assign
(paren
r_char
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
op_assign
id|sbuf
suffix:semicolon
r_int
id|l
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_eq
l_int|0
)paren
id|sprintf
c_func
(paren
id|sbuf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|netiucv_printname
c_func
(paren
id|privptr-&gt;conn-&gt;userid
)paren
)paren
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|sbuf
)paren
suffix:semicolon
id|p
op_assign
id|sbuf
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
OL
id|l
)paren
(brace
id|p
op_add_assign
id|file-&gt;f_pos
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|count
OG
id|l
)paren
ques
c_cond
id|l
suffix:colon
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|ret
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|macro|STATS_BUFSIZE
mdefine_line|#define STATS_BUFSIZE 2048
r_static
r_int
DECL|function|netiucv_stat_open
id|netiucv_stat_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
id|STATS_BUFSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|netiucv_stat_close
id|netiucv_stat_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_stat_write
id|netiucv_stat_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.maxmulti
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.maxcqueue
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.doios_single
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.doios_multi
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.txlen
op_assign
l_int|0
suffix:semicolon
id|privptr-&gt;conn-&gt;prof.tx_time
op_assign
l_int|0
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|ssize_t
DECL|function|netiucv_stat_read
id|netiucv_stat_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|pde
op_assign
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_char
op_star
id|sbuf
op_assign
(paren
r_char
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|net_device
op_star
id|dev
suffix:semicolon
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
id|ssize_t
id|ret
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|p
op_assign
id|sbuf
suffix:semicolon
r_int
id|l
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev
op_assign
id|find_netdev_by_ino
c_func
(paren
id|pde
)paren
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|off
op_ne
op_amp
id|file-&gt;f_pos
)paren
r_return
op_minus
id|ESPIPE
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_eq
l_int|0
)paren
(brace
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Device FSM state: %s&bslash;n&quot;
comma
id|fsm_getstate_str
c_func
(paren
id|privptr-&gt;fsm
)paren
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Connection FSM state: %s&bslash;n&quot;
comma
id|fsm_getstate_str
c_func
(paren
id|privptr-&gt;conn-&gt;fsm
)paren
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Max. TX buffer used: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.maxmulti
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Max. chained SKBs: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.maxcqueue
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;TX single write ops: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.doios_single
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;TX multi write ops: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.doios_multi
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Netto bytes written: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.txlen
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;Max. TX IO-time: %ld&bslash;n&quot;
comma
id|privptr-&gt;conn-&gt;prof.tx_time
)paren
suffix:semicolon
)brace
id|l
op_assign
id|strlen
c_func
(paren
id|sbuf
)paren
suffix:semicolon
id|p
op_assign
id|sbuf
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
OL
id|l
)paren
(brace
id|p
op_add_assign
id|file-&gt;f_pos
suffix:semicolon
id|l
op_assign
id|strlen
c_func
(paren
id|p
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|count
OG
id|l
)paren
ques
c_cond
id|l
suffix:colon
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|p
comma
id|ret
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|file-&gt;f_pos
op_add_assign
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|netiucv_stat_fops
r_static
r_struct
id|file_operations
id|netiucv_stat_fops
op_assign
(brace
id|read
suffix:colon
id|netiucv_stat_read
comma
id|write
suffix:colon
id|netiucv_stat_write
comma
id|open
suffix:colon
id|netiucv_stat_open
comma
id|release
suffix:colon
id|netiucv_stat_close
comma
)brace
suffix:semicolon
DECL|variable|netiucv_buffer_fops
r_static
r_struct
id|file_operations
id|netiucv_buffer_fops
op_assign
(brace
id|read
suffix:colon
id|netiucv_buffer_read
comma
id|write
suffix:colon
id|netiucv_buffer_write
comma
id|open
suffix:colon
id|netiucv_buffer_open
comma
id|release
suffix:colon
id|netiucv_buffer_close
comma
)brace
suffix:semicolon
DECL|variable|netiucv_user_fops
r_static
r_struct
id|file_operations
id|netiucv_user_fops
op_assign
(brace
id|read
suffix:colon
id|netiucv_user_read
comma
id|write
suffix:colon
id|netiucv_user_write
comma
id|open
suffix:colon
id|netiucv_user_open
comma
id|release
suffix:colon
id|netiucv_user_close
comma
)brace
suffix:semicolon
DECL|variable|netiucv_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|netiucv_dir
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|netiucv_template
r_static
r_struct
id|proc_dir_entry
op_star
id|netiucv_template
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/**&n; * Create the driver&squot;s main directory /proc/net/iucv&n; */
r_static
r_void
DECL|function|netiucv_proc_create_main
id|netiucv_proc_create_main
c_func
(paren
r_void
)paren
(brace
multiline_comment|/**&n;&t; * If not registered, register main proc dir-entry now&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|netiucv_dir
)paren
id|netiucv_dir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;iucv&quot;
comma
id|proc_net
)paren
suffix:semicolon
)brace
macro_line|#ifdef MODULE
multiline_comment|/**&n; * Destroy /proc/net/iucv&n; */
r_static
r_void
DECL|function|netiucv_proc_destroy_main
id|netiucv_proc_destroy_main
c_func
(paren
r_void
)paren
(brace
id|remove_proc_entry
c_func
(paren
l_string|&quot;iucv&quot;
comma
id|proc_net
)paren
suffix:semicolon
)brace
macro_line|#endif MODULE
multiline_comment|/**&n; * Create a device specific subdirectory in /proc/net/iucv/ with the&n; * same name like the device. In that directory, create 3 entries&n; * &quot;statistics&quot;, &quot;buffersize&quot; and &quot;username&quot;.&n; *&n; * @param dev The device for which the subdirectory should be created.&n; *&n; */
r_static
r_void
DECL|function|netiucv_proc_create_sub
id|netiucv_proc_create_sub
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|netiucv_priv
op_star
id|privptr
op_assign
id|dev-&gt;priv
suffix:semicolon
id|privptr-&gt;proc_dentry
op_assign
id|proc_mkdir
c_func
(paren
id|dev-&gt;name
comma
id|netiucv_dir
)paren
suffix:semicolon
id|privptr-&gt;proc_stat_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;statistics&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|privptr-&gt;proc_stat_entry-&gt;proc_fops
op_assign
op_amp
id|netiucv_stat_fops
suffix:semicolon
id|privptr-&gt;proc_buffer_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;buffersize&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|privptr-&gt;proc_buffer_entry-&gt;proc_fops
op_assign
op_amp
id|netiucv_buffer_fops
suffix:semicolon
id|privptr-&gt;proc_user_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;username&quot;
comma
id|S_IFREG
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|privptr-&gt;proc_user_entry-&gt;proc_fops
op_assign
op_amp
id|netiucv_user_fops
suffix:semicolon
id|privptr-&gt;proc_registered
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; * Destroy a device specific subdirectory.&n; *&n; * @param privptr Pointer to device private data.&n; */
r_static
r_void
DECL|function|netiucv_proc_destroy_sub
id|netiucv_proc_destroy_sub
c_func
(paren
id|netiucv_priv
op_star
id|privptr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|privptr-&gt;proc_registered
)paren
r_return
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;statistics&quot;
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;buffersize&quot;
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;username&quot;
comma
id|privptr-&gt;proc_dentry
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|privptr-&gt;proc_dentry-&gt;name
comma
id|netiucv_dir
)paren
suffix:semicolon
id|privptr-&gt;proc_registered
op_assign
l_int|0
suffix:semicolon
)brace
"&f;"
multiline_comment|/**&n; * Allocate and initialize a new connection structure.&n; * Add it to the list of connections;&n; */
r_static
id|iucv_connection
op_star
DECL|function|netiucv_new_connection
id|netiucv_new_connection
c_func
(paren
id|net_device
op_star
id|dev
comma
r_char
op_star
id|username
)paren
(brace
id|iucv_connection
op_star
op_star
id|clist
op_assign
op_amp
id|connections
suffix:semicolon
id|iucv_connection
op_star
id|conn
op_assign
(paren
id|iucv_connection
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|iucv_connection
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conn
)paren
(brace
id|memset
c_func
(paren
id|conn
comma
l_int|0
comma
r_sizeof
(paren
id|iucv_connection
)paren
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|conn-&gt;collect_queue
)paren
suffix:semicolon
id|conn-&gt;max_buffsize
op_assign
id|NETIUCV_BUFSIZE_DEFAULT
suffix:semicolon
id|conn-&gt;netdev
op_assign
id|dev
suffix:semicolon
id|conn-&gt;rx_buff
op_assign
id|alloc_skb
c_func
(paren
id|NETIUCV_BUFSIZE_DEFAULT
comma
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conn-&gt;rx_buff
)paren
(brace
id|kfree
c_func
(paren
id|conn
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|conn-&gt;tx_buff
op_assign
id|alloc_skb
c_func
(paren
id|NETIUCV_BUFSIZE_DEFAULT
comma
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conn-&gt;tx_buff
)paren
(brace
id|kfree_skb
c_func
(paren
id|conn-&gt;rx_buff
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|conn
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|conn-&gt;fsm
op_assign
id|init_fsm
c_func
(paren
l_string|&quot;netiucvconn&quot;
comma
id|conn_state_names
comma
id|conn_event_names
comma
id|NR_CONN_STATES
comma
id|NR_CONN_EVENTS
comma
id|conn_fsm
comma
id|CONN_FSM_LEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|conn-&gt;fsm
)paren
(brace
id|kfree_skb
c_func
(paren
id|conn-&gt;tx_buff
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|conn-&gt;rx_buff
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|conn
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|fsm_settimer
c_func
(paren
id|conn-&gt;fsm
comma
op_amp
id|conn-&gt;timer
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_STATE_INVALID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|username
)paren
(brace
id|memcpy
c_func
(paren
id|conn-&gt;userid
comma
id|username
comma
l_int|9
)paren
suffix:semicolon
id|fsm_newstate
c_func
(paren
id|conn-&gt;fsm
comma
id|CONN_STATE_STOPPED
)paren
suffix:semicolon
)brace
id|conn-&gt;next
op_assign
op_star
id|clist
suffix:semicolon
op_star
id|clist
op_assign
id|conn
suffix:semicolon
)brace
r_return
id|conn
suffix:semicolon
)brace
multiline_comment|/**&n; * Release a connection structure and remove it from the&n; * list of connections.&n; */
r_static
r_void
DECL|function|netiucv_remove_connection
id|netiucv_remove_connection
c_func
(paren
id|iucv_connection
op_star
id|conn
)paren
(brace
id|iucv_connection
op_star
op_star
id|clist
op_assign
op_amp
id|connections
suffix:semicolon
r_if
c_cond
(paren
id|conn
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
op_star
id|clist
)paren
(brace
r_if
c_cond
(paren
op_star
id|clist
op_eq
id|conn
)paren
(brace
op_star
id|clist
op_assign
id|conn-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|conn-&gt;handle
op_ne
l_int|0
)paren
(brace
id|iucv_unregister_program
c_func
(paren
id|conn-&gt;handle
)paren
suffix:semicolon
id|conn-&gt;handle
op_assign
l_int|0
suffix:semicolon
)brace
id|fsm_deltimer
c_func
(paren
op_amp
id|conn-&gt;timer
)paren
suffix:semicolon
id|kfree_fsm
c_func
(paren
id|conn-&gt;fsm
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|conn-&gt;rx_buff
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|conn-&gt;tx_buff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|clist
op_assign
op_amp
(paren
(paren
op_star
id|clist
)paren
op_member_access_from_pointer
id|next
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; * Allocate and initialize everything of a net device.&n; */
r_static
id|net_device
op_star
DECL|function|netiucv_init_netdevice
id|netiucv_init_netdevice
c_func
(paren
r_int
id|ifno
comma
r_char
op_star
id|username
)paren
(brace
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_int
id|priv_size
suffix:semicolon
id|net_device
op_star
id|dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|net_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
r_sizeof
(paren
id|net_device
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;iucv%d&quot;
comma
id|ifno
)paren
suffix:semicolon
id|priv_size
op_assign
r_sizeof
(paren
id|netiucv_priv
)paren
suffix:semicolon
id|dev-&gt;priv
op_assign
id|kmalloc
c_func
(paren
id|priv_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;priv
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev-&gt;priv
comma
l_int|0
comma
id|priv_size
)paren
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
id|privptr-&gt;fsm
op_assign
id|init_fsm
c_func
(paren
l_string|&quot;netiucvdev&quot;
comma
id|dev_state_names
comma
id|dev_event_names
comma
id|NR_DEV_STATES
comma
id|NR_DEV_EVENTS
comma
id|dev_fsm
comma
id|DEV_FSM_LEN
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|privptr-&gt;fsm
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|privptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|privptr-&gt;conn
op_assign
id|netiucv_new_connection
c_func
(paren
id|dev
comma
id|username
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|privptr-&gt;conn
)paren
(brace
id|kfree_fsm
c_func
(paren
id|privptr-&gt;fsm
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|privptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|fsm_newstate
c_func
(paren
id|privptr-&gt;fsm
comma
id|DEV_STATE_STOPPED
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|NETIUCV_MTU_DEFAULT
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|netiucv_tx
suffix:semicolon
id|dev-&gt;open
op_assign
id|netiucv_open
suffix:semicolon
id|dev-&gt;stop
op_assign
id|netiucv_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|netiucv_stats
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|netiucv_change_mtu
suffix:semicolon
id|dev-&gt;hard_header_len
op_assign
id|NETIUCV_HDRLEN
suffix:semicolon
id|dev-&gt;addr_len
op_assign
l_int|0
suffix:semicolon
id|dev-&gt;type
op_assign
id|ARPHRD_SLIP
suffix:semicolon
id|dev-&gt;tx_queue_len
op_assign
id|NETIUCV_QUEUELEN_DEFAULT
suffix:semicolon
id|dev_init_buffers
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev-&gt;flags
op_assign
id|IFF_POINTOPOINT
op_or
id|IFF_NOARP
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
multiline_comment|/**&n; * Allocate and initialize everything of a net device.&n; */
r_static
r_void
DECL|function|netiucv_free_netdevice
id|netiucv_free_netdevice
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|netiucv_priv
op_star
id|privptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
suffix:semicolon
id|privptr
op_assign
(paren
id|netiucv_priv
op_star
)paren
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|privptr
)paren
(brace
r_if
c_cond
(paren
id|privptr-&gt;conn
)paren
id|netiucv_remove_connection
c_func
(paren
id|privptr-&gt;conn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|privptr-&gt;fsm
)paren
id|kfree_fsm
c_func
(paren
id|privptr-&gt;fsm
)paren
suffix:semicolon
id|netiucv_proc_destroy_sub
c_func
(paren
id|privptr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|privptr
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|netiucv_banner
id|netiucv_banner
c_func
(paren
r_void
)paren
(brace
r_char
id|vbuf
(braket
)braket
op_assign
l_string|&quot;$Revision: 1.17 $&quot;
suffix:semicolon
r_char
op_star
id|version
op_assign
id|vbuf
suffix:semicolon
r_if
c_cond
(paren
(paren
id|version
op_assign
id|strchr
c_func
(paren
id|version
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
(brace
r_char
op_star
id|p
op_assign
id|strchr
c_func
(paren
id|version
op_plus
l_int|1
comma
l_char|&squot;$&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
op_star
id|p
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
id|version
op_assign
l_string|&quot; ??? &quot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NETIUCV driver Version%s initialized&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
)brace
macro_line|#ifndef MODULE
r_static
r_int
id|__init
DECL|function|iucv_setup
id|iucv_setup
c_func
(paren
r_char
op_star
id|param
)paren
(brace
multiline_comment|/**&n;&t;* We do not parse parameters here because at the time of&n;&t;* calling iucv_setup(), the kernel does not yet have&n;&t;* memory management running. We delay this until probing&n;&t;* is called.&n;&t;*/
id|iucv
op_assign
id|param
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
(paren
l_string|&quot;iucv=&quot;
comma
id|iucv_setup
)paren
suffix:semicolon
macro_line|#else
r_static
r_void
id|__exit
DECL|function|netiucv_exit
id|netiucv_exit
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|connections
)paren
(brace
id|net_device
op_star
id|dev
op_assign
id|connections-&gt;netdev
suffix:semicolon
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|netiucv_free_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|netiucv_proc_destroy_main
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NETIUCV driver unloaded&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|netiucv_exit
id|module_exit
c_func
(paren
id|netiucv_exit
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|__init
DECL|function|netiucv_init
id|netiucv_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|p
op_assign
id|iucv
suffix:semicolon
r_int
id|ifno
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_char
id|username
(braket
l_int|10
)braket
suffix:semicolon
id|netiucv_proc_create_main
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|isalnum
c_func
(paren
op_star
id|p
)paren
)paren
(brace
id|username
(braket
id|i
op_increment
)braket
op_assign
op_star
id|p
op_increment
suffix:semicolon
id|username
(braket
id|i
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|8
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;netiucv: Invalid user name &squot;%s&squot;&bslash;n&quot;
comma
id|username
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;,&squot;
)paren
)paren
id|p
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;,&squot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;netiucv: Invalid delimiter &squot;%c&squot;&bslash;n&quot;
comma
op_star
id|p
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;,&squot;
)paren
)paren
id|p
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|net_device
op_star
id|dev
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
l_int|9
)paren
id|username
(braket
id|i
op_increment
)braket
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|username
(braket
l_int|9
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|dev
op_assign
id|netiucv_init_netdevice
c_func
(paren
id|ifno
comma
id|username
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;netiucv: Could not allocate network device structure for user &squot;%s&squot;&bslash;n&quot;
comma
id|netiucv_printname
c_func
(paren
id|username
)paren
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;netiucv: Could not register &squot;%s&squot;&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|netiucv_free_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s: &squot;%s&squot;&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|netiucv_printname
c_func
(paren
id|username
)paren
)paren
suffix:semicolon
id|netiucv_proc_create_sub
c_func
(paren
id|dev
)paren
suffix:semicolon
id|ifno
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|p
)paren
)paren
r_break
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|p
op_increment
suffix:semicolon
)brace
)brace
)brace
id|netiucv_banner
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|netiucv_init
id|module_init
c_func
(paren
id|netiucv_init
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
