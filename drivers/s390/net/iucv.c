multiline_comment|/*&n; * $Id$&n; *&n; * IUCV network driver&n; *&n; * Copyright (C) 2001 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; * Author(s):&n; *    Original source:&n; *      Alan Altmark (Alan_Altmark@us.ibm.com)  Sept. 2000&n; *      Xenia Tkatschow (xenia@us.ibm.com)&n; *    2Gb awareness and general cleanup:&n; *      Fritz Elfert (elfert@de.ibm.com, felfert@millenux.com)&n; *&n; * Documentation used:&n; *    The original source&n; *    CP Programming Service, IBM document # SC24-5760&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * RELEASE-TAG: IUCV lowlevel driver $Revision$&n; *&n; */
"&f;"
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/tqueue.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &quot;iucv.h&quot;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/s390_ext.h&gt;
macro_line|#include &lt;asm/ebcdic.h&gt;
DECL|macro|DEBUG
macro_line|#undef DEBUG
multiline_comment|/* FLAGS:&n; * All flags are defined in the field IPFLAGS1 of each function&n; * and can be found in CP Programming Services.&n; * IPSRCCLS - Indicates you have specified a source class&n; * IPFGMCL  - Indicates you have specified a target class&n; * IPFGPID  - Indicates you have specified a pathid&n; * IPFGMID  - Indicates you have specified a message ID&n; * IPANSLST - Indicates that you are using an address list for&n; *            reply data&n; * IPBUFLST - Indicates that you are using an address list for&n; *            message data&n; */
DECL|macro|IPSRCCLS
mdefine_line|#define IPSRCCLS &t;0x01
DECL|macro|IPFGMCL
mdefine_line|#define IPFGMCL         0x01
DECL|macro|IPFGPID
mdefine_line|#define IPFGPID         0x02
DECL|macro|IPFGMID
mdefine_line|#define IPFGMID         0x04
DECL|macro|IPANSLST
mdefine_line|#define IPANSLST        0x08
DECL|macro|IPBUFLST
mdefine_line|#define IPBUFLST        0x40
multiline_comment|/* General IUCV interrupt structure */
r_typedef
r_struct
(brace
DECL|member|ippathid
id|__u16
id|ippathid
suffix:semicolon
DECL|member|res1
id|__u8
id|res1
suffix:semicolon
DECL|member|iptype
id|__u8
id|iptype
suffix:semicolon
DECL|member|res2
id|__u32
id|res2
suffix:semicolon
DECL|member|ipvmid
id|__u8
id|ipvmid
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|res3
id|__u8
id|res3
(braket
l_int|24
)braket
suffix:semicolon
DECL|typedef|iucv_GeneralInterrupt
)brace
id|iucv_GeneralInterrupt
suffix:semicolon
DECL|variable|iucv_external_int_buffer
r_static
id|iucv_GeneralInterrupt
op_star
id|iucv_external_int_buffer
suffix:semicolon
multiline_comment|/* Spin Lock declaration */
DECL|variable|iucv_lock
r_static
id|spinlock_t
id|iucv_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/***************INTERRUPT HANDLING ***************/
r_typedef
r_struct
(brace
DECL|member|queue
r_struct
id|list_head
id|queue
suffix:semicolon
DECL|member|data
id|iucv_GeneralInterrupt
id|data
suffix:semicolon
DECL|typedef|iucv_irqdata
)brace
id|iucv_irqdata
suffix:semicolon
DECL|variable|iucv_irq_queue
r_struct
id|list_head
id|iucv_irq_queue
suffix:semicolon
DECL|variable|iucv_irq_queue_lock
r_static
id|spinlock_t
id|iucv_irq_queue_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|iucv_tq
r_struct
id|tq_struct
id|iucv_tq
suffix:semicolon
DECL|variable|iucv_bh_scheduled
r_static
id|atomic_t
id|iucv_bh_scheduled
op_assign
id|ATOMIC_INIT
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n; *Internal function prototypes&n; */
r_static
r_void
id|iucv_bh_handler
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|iucv_irq_handler
c_func
(paren
r_struct
id|pt_regs
op_star
comma
id|__u16
)paren
suffix:semicolon
multiline_comment|/************ FUNCTION ID&squot;S ****************************/
DECL|macro|ACCEPT
mdefine_line|#define ACCEPT          10
DECL|macro|CONNECT
mdefine_line|#define CONNECT         11
DECL|macro|DECLARE_BUFFER
mdefine_line|#define DECLARE_BUFFER  12
DECL|macro|PURGE
mdefine_line|#define PURGE           9
DECL|macro|QUERY
mdefine_line|#define QUERY           0
DECL|macro|QUIESCE
mdefine_line|#define QUIESCE         13
DECL|macro|RECEIVE
mdefine_line|#define RECEIVE         5
DECL|macro|REJECT
mdefine_line|#define REJECT          8
DECL|macro|REPLY
mdefine_line|#define REPLY           6
DECL|macro|RESUME
mdefine_line|#define RESUME          14
DECL|macro|RETRIEVE_BUFFER
mdefine_line|#define RETRIEVE_BUFFER 2
DECL|macro|SEND
mdefine_line|#define SEND            4
DECL|macro|SETMASK
mdefine_line|#define SETMASK         16
DECL|macro|SEVER
mdefine_line|#define SEVER           15
multiline_comment|/**&n; * Structure: handler&n; * members: list - list management.&n; *          structure: id&n; *             userid - 8 char array of machine identification&n; *             user_data - 16 char array for user identification&n; *             mask - 24 char array used to compare the 2 previous&n; *          interrupt_table - vector of interrupt functions.&n; *          pgm_data -  ulong, application data that is passed&n; *                      to the interrupt handlers&n;*/
DECL|struct|handler_t
r_typedef
r_struct
id|handler_t
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
r_struct
(brace
DECL|member|userid
id|__u8
id|userid
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|user_data
id|__u8
id|user_data
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|mask
id|__u8
id|mask
(braket
l_int|24
)braket
suffix:semicolon
DECL|member|id
)brace
id|id
suffix:semicolon
DECL|member|interrupt_table
id|iucv_interrupt_ops_t
op_star
id|interrupt_table
suffix:semicolon
DECL|member|pgm_data
r_void
op_star
id|pgm_data
suffix:semicolon
DECL|typedef|handler
)brace
id|handler
suffix:semicolon
multiline_comment|/**&n; * iucv_handler_table: List of registered handlers.&n; */
DECL|variable|iucv_handler_table
r_static
r_struct
id|list_head
id|iucv_handler_table
suffix:semicolon
multiline_comment|/**&n; * iucv_pathid_table: an array of *handler pointing into&n; *                    iucv_handler_table for fast indexing by pathid;&n; */
DECL|variable|iucv_pathid_table
r_static
id|handler
op_star
op_star
id|iucv_pathid_table
suffix:semicolon
DECL|variable|max_connections
r_static
r_int
r_int
id|max_connections
suffix:semicolon
multiline_comment|/**&n; * declare_flag: is 0 when iucv_declare_buffer has not been called&n; */
DECL|variable|declare_flag
r_static
r_int
id|declare_flag
suffix:semicolon
multiline_comment|/****************FIVE 40-BYTE PARAMETER STRUCTURES******************/
multiline_comment|/* Data struct 1: iparml_control&n; * Used for iucv_accept&n; *          iucv_connect&n; *          iucv_quiesce&n; *          iucv_resume&n; *          iucv_sever&n; *          iucv_retrieve_buffer&n; * Data struct 2: iparml_dpl     (data in parameter list)&n; * Used for iucv_send_prmmsg&n; *          iucv_send2way_prmmsg&n; *          iucv_send2way_prmmsg_array&n; *          iucv_reply_prmmsg&n; * Data struct 3: iparml_db       (data in a buffer)&n; * Used for iucv_receive&n; *          iucv_receive_array&n; *          iucv_reject&n; *          iucv_reply&n; *          iucv_reply_array&n; *          iucv_send&n; *          iucv_send_array&n; *          iucv_send2way&n; *          iucv_send2way_array&n; *          iucv_declare_buffer&n; * Data struct 4: iparml_purge&n; * Used for iucv_purge&n; *          iucv_query&n; * Data struct 5: iparml_set_mask&n; * Used for iucv_set_mask&n; */
r_typedef
r_struct
(brace
DECL|member|ippathid
id|__u16
id|ippathid
suffix:semicolon
DECL|member|ipflags1
id|__u8
id|ipflags1
suffix:semicolon
DECL|member|iprcode
id|__u8
id|iprcode
suffix:semicolon
DECL|member|ipmsglim
id|__u16
id|ipmsglim
suffix:semicolon
DECL|member|res1
id|__u16
id|res1
suffix:semicolon
DECL|member|ipvmid
id|__u8
id|ipvmid
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|ipuser
id|__u8
id|ipuser
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|iptarget
id|__u8
id|iptarget
(braket
l_int|8
)braket
suffix:semicolon
DECL|typedef|iparml_control
)brace
id|iparml_control
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ippathid
id|__u16
id|ippathid
suffix:semicolon
DECL|member|ipflags1
id|__u8
id|ipflags1
suffix:semicolon
DECL|member|iprcode
id|__u8
id|iprcode
suffix:semicolon
DECL|member|ipmsgid
id|__u32
id|ipmsgid
suffix:semicolon
DECL|member|iptrgcls
id|__u32
id|iptrgcls
suffix:semicolon
DECL|member|iprmmsg
id|__u8
id|iprmmsg
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|ipsrccls
id|__u32
id|ipsrccls
suffix:semicolon
DECL|member|ipmsgtag
id|__u32
id|ipmsgtag
suffix:semicolon
DECL|member|ipbfadr2
id|__u32
id|ipbfadr2
suffix:semicolon
DECL|member|ipbfln2f
id|__u32
id|ipbfln2f
suffix:semicolon
DECL|member|res
id|__u32
id|res
suffix:semicolon
DECL|typedef|iparml_dpl
)brace
id|iparml_dpl
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ippathid
id|__u16
id|ippathid
suffix:semicolon
DECL|member|ipflags1
id|__u8
id|ipflags1
suffix:semicolon
DECL|member|iprcode
id|__u8
id|iprcode
suffix:semicolon
DECL|member|ipmsgid
id|__u32
id|ipmsgid
suffix:semicolon
DECL|member|iptrgcls
id|__u32
id|iptrgcls
suffix:semicolon
DECL|member|ipbfadr1
id|__u32
id|ipbfadr1
suffix:semicolon
DECL|member|ipbfln1f
id|__u32
id|ipbfln1f
suffix:semicolon
DECL|member|ipsrccls
id|__u32
id|ipsrccls
suffix:semicolon
DECL|member|ipmsgtag
id|__u32
id|ipmsgtag
suffix:semicolon
DECL|member|ipbfadr2
id|__u32
id|ipbfadr2
suffix:semicolon
DECL|member|ipbfln2f
id|__u32
id|ipbfln2f
suffix:semicolon
DECL|member|res
id|__u32
id|res
suffix:semicolon
DECL|typedef|iparml_db
)brace
id|iparml_db
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ippathid
id|__u16
id|ippathid
suffix:semicolon
DECL|member|ipflags1
id|__u8
id|ipflags1
suffix:semicolon
DECL|member|iprcode
id|__u8
id|iprcode
suffix:semicolon
DECL|member|ipmsgid
id|__u32
id|ipmsgid
suffix:semicolon
DECL|member|ipaudit
id|__u8
id|ipaudit
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|res1
id|__u8
id|res1
(braket
l_int|5
)braket
suffix:semicolon
DECL|member|res2
id|__u32
id|res2
suffix:semicolon
DECL|member|ipsrccls
id|__u32
id|ipsrccls
suffix:semicolon
DECL|member|ipmsgtag
id|__u32
id|ipmsgtag
suffix:semicolon
DECL|member|res3
id|__u32
id|res3
(braket
l_int|3
)braket
suffix:semicolon
DECL|typedef|iparml_purge
)brace
id|iparml_purge
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|ipmask
id|__u8
id|ipmask
suffix:semicolon
DECL|member|res1
id|__u8
id|res1
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|iprcode
id|__u8
id|iprcode
suffix:semicolon
DECL|member|res2
id|__u32
id|res2
(braket
l_int|9
)braket
suffix:semicolon
DECL|typedef|iparml_set_mask
)brace
id|iparml_set_mask
suffix:semicolon
r_typedef
r_struct
(brace
r_union
(brace
DECL|member|p_ctrl
id|iparml_control
id|p_ctrl
suffix:semicolon
DECL|member|p_dpl
id|iparml_dpl
id|p_dpl
suffix:semicolon
DECL|member|p_db
id|iparml_db
id|p_db
suffix:semicolon
DECL|member|p_purge
id|iparml_purge
id|p_purge
suffix:semicolon
DECL|member|p_set_mask
id|iparml_set_mask
id|p_set_mask
suffix:semicolon
DECL|member|param
)brace
id|param
suffix:semicolon
DECL|member|in_use
id|atomic_t
id|in_use
suffix:semicolon
DECL|typedef|iucv_param
)brace
id|__attribute__
(paren
(paren
id|aligned
c_func
(paren
l_int|8
)paren
)paren
)paren
id|iucv_param
suffix:semicolon
DECL|macro|PARAM_POOL_SIZE
mdefine_line|#define PARAM_POOL_SIZE (PAGE_SIZE / sizeof(iucv_param))
DECL|variable|iucv_param_pool
r_static
id|iucv_param
op_star
id|iucv_param_pool
suffix:semicolon
multiline_comment|/*&n; * Debugging stuff&n; *******************************************************************************/
"&f;"
macro_line|#ifdef DEBUG
r_static
r_void
DECL|function|iucv_dumpit
id|iucv_dumpit
c_func
(paren
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
id|__u8
op_star
id|p
op_assign
(paren
id|__u8
op_star
)paren
id|buf
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;  &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
l_int|16
)paren
op_logical_and
id|i
op_ne
l_int|0
)paren
id|printk
(paren
l_string|&quot;&bslash;n  &quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|i
op_mod
l_int|4
)paren
op_logical_and
id|i
op_ne
l_int|0
)paren
id|printk
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;%02X&quot;
comma
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_mod
l_int|16
)paren
id|printk
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|macro|iucv_debug
mdefine_line|#define iucv_debug(fmt, args...) &bslash;&n;printk(KERN_DEBUG __FUNCTION__ &quot;: &quot; fmt &quot;&bslash;n&quot; , ## args);
macro_line|#else
DECL|macro|iucv_debug
mdefine_line|#define iucv_debug(fmt, args...)
DECL|macro|iucv_dumpit
mdefine_line|#define iucv_dumpit(buf, len)
macro_line|#endif
multiline_comment|/*&n; * Internal functions&n; *******************************************************************************/
"&f;"
multiline_comment|/**&n; * iucv_init - Initialization&n; *&n; * Allocates and initializes various data structures.&n; */
r_static
r_int
DECL|function|iucv_init
id|iucv_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|iucv_external_int_buffer
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Note: GFP_DMA used used to get memory below 2G */
id|iucv_external_int_buffer
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|iucv_GeneralInterrupt
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iucv_external_int_buffer
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Could not allocate external interrupt buffer&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|iucv_external_int_buffer
comma
l_int|0
comma
r_sizeof
(paren
id|iucv_GeneralInterrupt
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize parameter pool */
id|iucv_param_pool
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|iucv_param
)paren
op_star
id|PARAM_POOL_SIZE
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iucv_param_pool
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Could not allocate param pool&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|iucv_external_int_buffer
)paren
suffix:semicolon
id|iucv_external_int_buffer
op_assign
l_int|NULL
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|iucv_param_pool
comma
l_int|0
comma
r_sizeof
(paren
id|iucv_param
)paren
op_star
id|PARAM_POOL_SIZE
)paren
suffix:semicolon
multiline_comment|/* Initialize task queue */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|iucv_tq.list
)paren
suffix:semicolon
id|iucv_tq.sync
op_assign
l_int|0
suffix:semicolon
id|iucv_tq.routine
op_assign
(paren
r_void
op_star
)paren
id|iucv_bh_handler
suffix:semicolon
multiline_comment|/* Initialize irq queue */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|iucv_irq_queue
)paren
suffix:semicolon
multiline_comment|/* Initialize handler table */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|iucv_handler_table
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * grab_param: - Get a parameter buffer from the pre-allocated pool.&n; *&n; * This function searches for an unused element in the the pre-allocated pool&n; * of parameter buffers. If one is found, it marks it &quot;in use&quot; and returns&n; * a pointer to it. The calling function is responsible for releasing it&n; * when it has finished its usage.&n; *&n; * Returns: A pointer to iucv_param.&n; */
r_static
id|__inline__
id|iucv_param
op_star
DECL|function|grab_param
id|grab_param
c_func
(paren
r_void
)paren
(brace
id|iucv_param
op_star
id|ret
suffix:semicolon
r_static
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|atomic_compare_and_swap
c_func
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|iucv_param_pool
(braket
id|i
)braket
dot
id|in_use
)paren
)paren
(brace
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|PARAM_POOL_SIZE
)paren
id|i
op_assign
l_int|0
suffix:semicolon
)brace
id|ret
op_assign
op_amp
id|iucv_param_pool
(braket
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ret-&gt;param
comma
l_int|0
comma
r_sizeof
(paren
id|ret-&gt;param
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * release_param - Release a parameter buffer.&n; * @p: A pointer to a struct iucv_param, previously obtained by calling&n; *     grab_param().&n; *&n; * This function marks the specified parameter buffer &quot;unused&quot;.&n; */
r_static
id|__inline__
r_void
DECL|function|release_param
id|release_param
c_func
(paren
r_void
op_star
id|p
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
(paren
(paren
id|iucv_param
op_star
)paren
id|p
)paren
op_member_access_from_pointer
id|in_use
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_add_handler: - Add a new handler&n; * @new_handler: handle that is being entered into chain.&n; *&n; * Places new handle on iucv_handler_table, if identical handler is not&n; * found.&n; *&n; * Returns: 0 on success, !0 on failure (handler already in chain).&n; */
r_static
r_int
DECL|function|iucv_add_handler
id|iucv_add_handler
(paren
id|handler
op_star
r_new
)paren
(brace
id|ulong
id|flags
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
r_new
comma
r_sizeof
(paren
id|handler
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|iucv_handler_table
)paren
)paren
(brace
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
multiline_comment|/**&n;&t;&t; * Search list for handler with identical id. If one&n;&t;&t; * is found, the new handler is _not_ added.&n;&t;&t; */
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|iucv_handler_table
)paren
(brace
id|handler
op_star
id|h
op_assign
id|list_entry
c_func
(paren
id|lh
comma
id|handler
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|id
comma
op_amp
id|h-&gt;id
comma
r_sizeof
(paren
id|h-&gt;id
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|iucv_debug
c_func
(paren
l_string|&quot;ret 1&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/**&n;&t; * If we get here, no handler was found.&n;&t; */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|list
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|list
comma
op_amp
id|iucv_handler_table
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_remove_handler:&n; * @users_handler: handler to be removed&n; *&n; * Remove handler when application unregisters.&n; */
r_static
r_void
DECL|function|iucv_remove_handler
id|iucv_remove_handler
c_func
(paren
id|handler
op_star
id|handler
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|iucv_pathid_table
)paren
op_logical_or
(paren
op_logical_neg
id|handler
)paren
)paren
r_return
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|handler-&gt;list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * b2f0:&n; * @code: identifier of IUCV call to CP.&n; * @parm: pointer to 40 byte iparml area passed to CP&n; *&n; * Calls CP to execute IUCV commands.&n; *&n; * Returns: return code from CP&squot;s IUCV call&n; */
r_static
id|__inline__
id|ulong
DECL|function|b2f0
id|b2f0
c_func
(paren
id|__u32
id|code
comma
r_void
op_star
id|parm
)paren
(brace
id|iucv_debug
c_func
(paren
l_string|&quot;iparml before b2f0 call:&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|parm
comma
r_sizeof
(paren
id|iucv_param.param
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;LRA   1,0(%1)&bslash;n&bslash;t&quot;
l_string|&quot;LR    0,%0&bslash;n&bslash;t&quot;
l_string|&quot;.long 0xb2f01000&quot;
suffix:colon
suffix:colon
l_string|&quot;d&quot;
(paren
id|code
)paren
comma
l_string|&quot;a&quot;
(paren
id|parm
)paren
suffix:colon
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;iparml after b2f0 call:&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|parm
comma
r_sizeof
(paren
id|iucv_param.param
)paren
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
op_star
(paren
(paren
id|__u8
op_star
)paren
(paren
id|parm
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_add_pathid&n; * Purpose: Adds a path id to the system.&n; * Input: pathid -  pathid that is going to be entered into system&n; *        handle -  address of handler that the pathid will be associated&n; *&t;&t;   with.&n; *        pgm_data - token passed in by application.&n; * Output: 0: successful addition of pathid&n; *&t;   - EINVAL - pathid entry is being used by another application&n; *&t;   - ENOMEM - storage allocation for a new pathid table failed&n;*/
r_static
r_int
DECL|function|iucv_add_pathid
id|iucv_add_pathid
c_func
(paren
id|__u16
id|pathid
comma
id|handler
op_star
id|handler
)paren
(brace
id|ulong
id|flags
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;handler is pointing to %p&quot;
comma
id|handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pathid
OG
(paren
id|max_connections
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iucv_pathid_table
(braket
id|pathid
)braket
)paren
(brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid entry is %p&quot;
comma
id|iucv_pathid_table
(braket
id|pathid
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Pathid being used, error.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|iucv_pathid_table
(braket
id|pathid
)braket
op_assign
id|handler
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* end of add_pathid function */
r_static
r_void
DECL|function|iucv_remove_pathid
id|iucv_remove_pathid
c_func
(paren
id|__u16
id|pathid
)paren
(brace
id|ulong
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|pathid
OG
(paren
id|max_connections
op_minus
l_int|1
)paren
)paren
r_return
suffix:semicolon
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_pathid_table
(braket
id|pathid
)braket
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_declare_buffer&n; * Purpose: Specifies the guests real address of an external&n; *          interrupt.&n; * Input: void&n; * Output: iprcode - return code from b2f0 call&n;*/
r_int
DECL|function|iucv_declare_buffer
id|iucv_declare_buffer
(paren
r_void
)paren
(brace
id|ulong
id|b2f0_result
suffix:semicolon
id|iparml_db
op_star
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
id|virt_to_phys
c_func
(paren
id|iucv_external_int_buffer
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|DECLARE_BUFFER
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;Address of EIB = %p&quot;
comma
id|iucv_external_int_buffer
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_retrieve_buffer:&n; *&n; * Terminates all use of IUCV.&n; * Returns: return code from CP&n; */
r_int
DECL|function|iucv_retrieve_buffer
id|iucv_retrieve_buffer
(paren
r_void
)paren
(brace
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iparml_control
op_star
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|RETRIEVE_BUFFER
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b2f0_result
op_eq
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|iucv_pathid_table
)paren
suffix:semicolon
id|iucv_pathid_table
op_assign
l_int|NULL
suffix:semicolon
id|declare_flag
op_assign
l_int|0
suffix:semicolon
)brace
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_register_program:&n; * @pgmname:  user identification&n; * @userid:   machine identification&n; * @pgmmask:  Indicates which bits in the pgmname and userid combined will be&n; *            used to determine who is given control.&n; * @ops:      Address of interrupt handler table.&n; * @pgm_data: Application data to be passed to interrupt handlers.&n; *&n; * Registers an application with IUCV.&n; * Returns:&n; *           The address of handler, or NULL on failure.&n; * NOTE on pgmmask:&n; *   If pgmname, userid and pgmmask are provided, pgmmask is entered into the&n; *   handler as is.&n; *   If pgmmask is NULL, the internal mask is set to all 0xff&squot;s&n; *   When userid is NULL, the first 8 bytes of the internal mask are forced&n; *   to 0x00.&n; *   If pgmmask and userid are NULL, the first 8 bytes of the internal mask&n; *   are forced to 0x00 and the last 16 bytes to 0xff.&n; */
id|iucv_handle_t
DECL|function|iucv_register_program
id|iucv_register_program
(paren
id|__u8
id|pgmname
(braket
l_int|16
)braket
comma
id|__u8
id|userid
(braket
l_int|8
)braket
comma
id|__u8
id|pgmmask
(braket
l_int|24
)braket
comma
id|iucv_interrupt_ops_t
op_star
id|ops
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|ulong
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* return code from function calls */
id|handler
op_star
id|new_handler
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ops
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* interrupt table is not defined */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Interrupt table is not defined, &quot;
l_string|&quot;exiting&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pgmname
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: pgmname not provided&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Allocate handler entry */
id|new_handler
op_assign
(paren
id|handler
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|handler
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_handler
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: storage allocation for new handler &quot;
l_string|&quot;failed.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|iucv_pathid_table
)paren
(brace
r_if
c_cond
(paren
id|iucv_init
c_func
(paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|new_handler
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|max_connections
op_assign
id|iucv_query_maxconn
c_func
(paren
)paren
suffix:semicolon
id|iucv_pathid_table
op_assign
id|kmalloc
c_func
(paren
id|max_connections
op_star
r_sizeof
(paren
id|handler
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iucv_pathid_table
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: iucv_pathid_table storage &quot;
l_string|&quot;allocation failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
(paren
id|iucv_pathid_table
comma
l_int|0
comma
id|max_connections
op_star
r_sizeof
(paren
id|handler
op_star
)paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|new_handler
comma
l_int|0
comma
r_sizeof
(paren
id|handler
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|new_handler-&gt;id.user_data
comma
id|pgmname
comma
r_sizeof
(paren
id|new_handler-&gt;id.user_data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userid
)paren
(brace
id|memcpy
(paren
id|new_handler-&gt;id.userid
comma
id|userid
comma
r_sizeof
(paren
id|new_handler-&gt;id.userid
)paren
)paren
suffix:semicolon
id|ASCEBC
(paren
id|new_handler-&gt;id.userid
comma
r_sizeof
(paren
id|new_handler-&gt;id.userid
)paren
)paren
suffix:semicolon
id|EBC_TOUPPER
(paren
id|new_handler-&gt;id.userid
comma
r_sizeof
(paren
id|new_handler-&gt;id.userid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pgmmask
)paren
(brace
id|memcpy
(paren
id|new_handler-&gt;id.mask
comma
id|pgmmask
comma
r_sizeof
(paren
id|new_handler-&gt;id.mask
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
(paren
id|new_handler-&gt;id.mask
comma
l_int|0xFF
comma
r_sizeof
(paren
id|new_handler-&gt;id.mask
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|pgmmask
)paren
(brace
id|memcpy
(paren
id|new_handler-&gt;id.mask
comma
id|pgmmask
comma
r_sizeof
(paren
id|new_handler-&gt;id.mask
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|memset
(paren
id|new_handler-&gt;id.mask
comma
l_int|0xFF
comma
r_sizeof
(paren
id|new_handler-&gt;id.mask
)paren
)paren
suffix:semicolon
)brace
id|memset
(paren
id|new_handler-&gt;id.mask
comma
l_int|0x00
comma
r_sizeof
(paren
id|new_handler-&gt;id.userid
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* fill in the rest of handler */
id|new_handler-&gt;pgm_data
op_assign
id|pgm_data
suffix:semicolon
id|new_handler-&gt;interrupt_table
op_assign
id|ops
suffix:semicolon
multiline_comment|/*&n;&t; * Check if someone else is registered with same pgmname, userid&n;&t; * and mask. If someone is already registered with same pgmname,&n;&t; * userid and mask, registration will fail and NULL will be returned&n;&t; * to the application.&n;&t; * If identical handler not found, then handler is added to list.&n;&t; */
id|rc
op_assign
id|iucv_add_handler
c_func
(paren
id|new_handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Someone already registered with same &quot;
l_string|&quot;pgmname, userid, pgmmask&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|kfree
(paren
id|new_handler
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|declare_flag
op_eq
l_int|0
)paren
(brace
id|rc
op_assign
id|iucv_declare_buffer
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iucv_remove_handler
c_func
(paren
id|new_handler
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|new_handler
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: iucv_declare_buffer &quot;
l_string|&quot;returned %ld&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|rc
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* request the 0x4000 external interrupt */
id|rc
op_assign
id|register_external_interrupt
(paren
l_int|0x4000
comma
id|iucv_irq_handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iucv_remove_handler
c_func
(paren
id|new_handler
)paren
suffix:semicolon
id|iucv_retrieve_buffer
c_func
(paren
)paren
suffix:semicolon
id|kfree
(paren
id|new_handler
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: &quot;
l_string|&quot;register_external_interrupt returned %ld&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|rc
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|declare_flag
op_assign
l_int|1
suffix:semicolon
)brace
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|new_handler
suffix:semicolon
)brace
multiline_comment|/* end of register function */
multiline_comment|/**&n; * iucv_unregister_program:&n; * @handle: address of handler&n; *&n; * Unregister application with IUCV.&n; * Returns:&n; *   Always 0&n; */
r_int
DECL|function|iucv_unregister_program
id|iucv_unregister_program
(paren
id|iucv_handle_t
id|handle
)paren
(brace
id|handler
op_star
id|h
op_assign
(paren
id|handler
op_star
)paren
id|handle
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;address of handler is %p&quot;
comma
id|h
)paren
suffix:semicolon
multiline_comment|/**&n;&t; * First, walk thru iucv_pathid_table and sever any pathid which is&n;&t; * still pointing to the handler to be removed.&n;&t; */
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max_connections
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|iucv_pathid_table
(braket
id|i
)braket
op_eq
id|h
)paren
(brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_sever
c_func
(paren
id|i
comma
id|h-&gt;id.user_data
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|iucv_remove_handler
c_func
(paren
id|h
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|h
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_accept:&n; * @pathid:             Path identification number&n; * @msglim_reqstd:      The number of outstanding messages requested.&n; * @user_data:          Data specified by the iucv_connect function.&n; * @flags1:             Contains options for this path.&n; *     - IPPRTY (0x20)   Specifies if you want to send priority message.&n; *     - IPRMDATA (0x80) Specifies whether your program can handle a message&n; *                       in the parameter list.&n; *     - IPQUSCE (0x40)  Specifies whether you want to quiesce the path being&n; *&t;&t;         established.&n; * @handle:             Address of handler.&n; * @pgm_data:           Application data passed to interrupt handlers.&n; * @flags1_out:         Pointer to an int. If not NULL, on return the options for&n; *                      the path are stored at the given location:&n; *     - IPPRTY (0x20)  Indicates you may send a priority message.&n; * @msglim:             Pointer to an __u16. If not NULL, on return the maximum&n; *                      number of outstanding messages is stored at the given&n; *                      location.&n; *&n; * This function is issued after the user receives a Connection Pending external&n; * interrupt and now wishes to complete the IUCV communication path.&n; * Returns:&n; *   return code from CP&n; */
r_int
DECL|function|iucv_accept
id|iucv_accept
c_func
(paren
id|__u16
id|pathid
comma
id|__u16
id|msglim_reqstd
comma
id|__u8
id|user_data
(braket
l_int|16
)braket
comma
r_int
id|flags1
comma
id|iucv_handle_t
id|handle
comma
r_void
op_star
id|pgm_data
comma
r_int
op_star
id|flags1_out
comma
id|__u16
op_star
id|msglim
)paren
(brace
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
id|handler
op_star
id|h
op_assign
l_int|NULL
suffix:semicolon
id|iparml_control
op_star
id|parm
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid = %d&quot;
comma
id|pathid
)paren
suffix:semicolon
multiline_comment|/* Checking if handle is valid  */
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|iucv_handler_table
)paren
(brace
r_if
c_cond
(paren
(paren
id|handler
op_star
)paren
id|handle
op_eq
id|list_entry
c_func
(paren
id|lh
comma
id|handler
comma
id|list
)paren
)paren
(brace
id|h
op_assign
(paren
id|handler
op_star
)paren
id|handle
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|h
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NULL handle passed by application &quot;
l_string|&quot;or handler not found in iucv_handler_table&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipmsglim
op_assign
id|msglim_reqstd
suffix:semicolon
r_if
c_cond
(paren
id|user_data
)paren
id|memcpy
c_func
(paren
id|parm-&gt;ipuser
comma
id|user_data
comma
r_sizeof
(paren
id|parm-&gt;ipuser
)paren
)paren
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|__u8
)paren
id|flags1
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|ACCEPT
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b2f0_result
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|pgm_data
)paren
id|h-&gt;pgm_data
op_assign
id|pgm_data
suffix:semicolon
r_if
c_cond
(paren
id|flags1_out
)paren
op_star
id|flags1_out
op_assign
(paren
id|parm-&gt;ipflags1
op_amp
id|IPPRTY
)paren
ques
c_cond
id|IPPRTY
suffix:colon
l_int|0
suffix:semicolon
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_connect:&n; * @pathid:        Path identification number&n; * @msglim_reqstd: Number of outstanding messages requested&n; * @user_data:     16-byte user data&n; * @userid:        8-byte of user identification&n; * @system_name:   8-byte identifying the system name&n; * @flags1:        Specifies options for this path:&n; *     - IPPRTY (0x20)   Specifies if you want to send priority message.&n; *     - IPRMDATA (0x80) Specifies whether your program can handle a message&n; *                       in  the parameter list.&n; *     - IPQUSCE (0x40)  Specifies whether you want to quiesce the path being&n; *                       established.&n; *     - IPLOCAL (0x01)  Allows an application to force the partner to be on the&n; *                       local system. If local is specified then target class&n; *                       cannot be specified.&n; * @flags1_out:    Pointer to an int. If not NULL, on return the options for&n; *                 the path are stored at the given location:&n; *     - IPPRTY (0x20)   Indicates you may send a priority message.&n; * @msglim:        Pointer to an __u16. If not NULL, on return the maximum&n; *                 number of outstanding messages is stored at the given&n; *                 location.&n; * @handle:        Address of handler.&n; * @pgm_data:      Application data to be passed to interrupt handlers.&n; *&n; * This function establishes an IUCV path. Although the connect may complete&n; * successfully, you are not able to use the path until you receive an IUCV&n; * Connection Complete external interrupt.&n; * Returns: return code from CP, or one of the following&n; *     - ENOMEM&n; *     - return code from iucv_declare_buffer&n; *     - EINVAL - invalid handle passed by application&n; *     - EINVAL - pathid address is NULL&n; *     - ENOMEM - pathid table storage allocation failed&n; *     - return code from internal function add_pathid&n; */
r_int
DECL|function|iucv_connect
id|iucv_connect
(paren
id|__u16
op_star
id|pathid
comma
id|__u16
id|msglim_reqstd
comma
id|__u8
id|user_data
(braket
l_int|16
)braket
comma
id|__u8
id|userid
(braket
l_int|8
)braket
comma
id|__u8
id|system_name
(braket
l_int|8
)braket
comma
r_int
id|flags1
comma
r_int
op_star
id|flags1_out
comma
id|__u16
op_star
id|msglim
comma
id|iucv_handle_t
id|handle
comma
r_void
op_star
id|pgm_data
)paren
(brace
id|iparml_control
op_star
id|parm
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
r_int
id|add_pathid_result
op_assign
l_int|0
suffix:semicolon
id|handler
op_star
id|h
op_assign
l_int|NULL
suffix:semicolon
id|__u8
id|no_memory
(braket
l_int|16
)braket
op_assign
l_string|&quot;NO MEMORY&quot;
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
multiline_comment|/* Checking if handle is valid  */
id|spin_lock_irqsave
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|iucv_handler_table
)paren
(brace
r_if
c_cond
(paren
(paren
id|handler
op_star
)paren
id|handle
op_eq
id|list_entry
c_func
(paren
id|lh
comma
id|handler
comma
id|list
)paren
)paren
(brace
id|h
op_assign
(paren
id|handler
op_star
)paren
id|handle
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|h
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NULL handle passed by application &quot;
l_string|&quot;or handler not found in iucv_handler_table&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pathid
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NULL pathid pointer&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipmsglim
op_assign
id|msglim_reqstd
suffix:semicolon
r_if
c_cond
(paren
id|user_data
)paren
id|memcpy
c_func
(paren
id|parm-&gt;ipuser
comma
id|user_data
comma
r_sizeof
(paren
id|parm-&gt;ipuser
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|userid
)paren
(brace
id|memcpy
c_func
(paren
id|parm-&gt;ipvmid
comma
id|userid
comma
r_sizeof
(paren
id|parm-&gt;ipvmid
)paren
)paren
suffix:semicolon
id|ASCEBC
c_func
(paren
id|parm-&gt;ipvmid
comma
r_sizeof
(paren
id|parm-&gt;ipvmid
)paren
)paren
suffix:semicolon
id|EBC_TOUPPER
c_func
(paren
id|parm-&gt;ipvmid
comma
r_sizeof
(paren
id|parm-&gt;ipvmid
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|system_name
)paren
(brace
id|memcpy
c_func
(paren
id|parm-&gt;iptarget
comma
id|system_name
comma
r_sizeof
(paren
id|parm-&gt;iptarget
)paren
)paren
suffix:semicolon
id|ASCEBC
c_func
(paren
id|parm-&gt;iptarget
comma
r_sizeof
(paren
id|parm-&gt;iptarget
)paren
)paren
suffix:semicolon
id|EBC_TOUPPER
c_func
(paren
id|parm-&gt;iptarget
comma
r_sizeof
(paren
id|parm-&gt;iptarget
)paren
)paren
suffix:semicolon
)brace
id|parm-&gt;ipflags1
op_assign
(paren
id|__u8
)paren
id|flags1
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|CONNECT
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b2f0_result
)paren
(brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
id|add_pathid_result
op_assign
id|iucv_add_pathid
c_func
(paren
id|parm-&gt;ippathid
comma
id|h
)paren
suffix:semicolon
op_star
id|pathid
op_assign
id|parm-&gt;ippathid
suffix:semicolon
r_if
c_cond
(paren
id|msglim
)paren
op_star
id|msglim
op_assign
id|parm-&gt;ipmsglim
suffix:semicolon
r_if
c_cond
(paren
id|flags1_out
)paren
op_star
id|flags1_out
op_assign
(paren
id|parm-&gt;ipflags1
op_amp
id|IPPRTY
)paren
ques
c_cond
id|IPPRTY
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|add_pathid_result
)paren
(brace
id|iucv_sever
c_func
(paren
id|parm-&gt;ippathid
comma
id|no_memory
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: add_pathid failed with rc =&quot;
l_string|&quot; %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|add_pathid_result
)paren
suffix:semicolon
r_return
id|add_pathid_result
suffix:semicolon
)brace
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_purge:&n; * @pathid: Path identification number&n; * @msgid:  Message ID of message to purge.&n; * @srccls: Message class of the message to purge.&n; * @audit:  Pointer to an __u32. If not NULL, on return, information about&n; *          asynchronous errors that may have affected the normal completion&n; *          of this message ist stored at the given location.&n; *&n; * Cancels a message you have sent.&n; * Returns: return code from CP&n; */
r_int
DECL|function|iucv_purge
id|iucv_purge
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|srccls
comma
id|__u32
op_star
id|audit
)paren
(brace
id|iparml_purge
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid = %d&quot;
comma
id|pathid
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_purge
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipflags1
op_or_assign
(paren
id|IPSRCCLS
op_or
id|IPFGMID
op_or
id|IPFGPID
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|PURGE
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
id|audit
)paren
(brace
id|memcpy
c_func
(paren
id|audit
comma
id|parm-&gt;ipaudit
comma
r_sizeof
(paren
id|parm-&gt;ipaudit
)paren
)paren
suffix:semicolon
multiline_comment|/* parm-&gt;ipaudit has only 3 bytes */
op_star
id|audit
op_rshift_assign
l_int|8
suffix:semicolon
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;b2f0_result = %ld&quot;
comma
id|b2f0_result
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_query_generic:&n; * @want_maxconn: Flag, describing which value is to be returned.&n; *&n; * Helper function for iucv_query_maxconn() and iucv_query_bufsize().&n; *&n; * Returns: The buffersize, if want_maxconn is 0; the maximum number of&n; *           connections, if want_maxconn is 1 or an error-code &lt; 0 on failure.&n; */
r_static
r_int
DECL|function|iucv_query_generic
id|iucv_query_generic
c_func
(paren
r_int
id|want_maxconn
)paren
(brace
id|iparml_purge
op_star
id|parm
op_assign
(paren
id|iparml_purge
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
r_int
id|bufsize
comma
id|maxconn
suffix:semicolon
r_int
id|ccode
suffix:semicolon
multiline_comment|/**&n;&t; * Call b2f0 and store R0 (max buffer size),&n;&t; * R1 (max connections) and CC.&n;&t; */
id|asm
r_volatile
(paren
l_string|&quot;LRA   1,0(%4)&bslash;n&bslash;t&quot;
l_string|&quot;LR    0,%3&bslash;n&bslash;t&quot;
l_string|&quot;.long 0xb2f01000&bslash;n&bslash;t&quot;
l_string|&quot;IPM   %0&bslash;n&bslash;t&quot;
l_string|&quot;SRL   %0,28&bslash;n&bslash;t&quot;
l_string|&quot;ST    0,%1&bslash;n&bslash;t&quot;
l_string|&quot;ST    1,%2&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|ccode
)paren
comma
l_string|&quot;=m&quot;
(paren
id|bufsize
)paren
comma
l_string|&quot;=m&quot;
(paren
id|maxconn
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
id|QUERY
)paren
comma
l_string|&quot;a&quot;
(paren
id|parm
)paren
suffix:colon
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;cc&quot;
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ccode
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|want_maxconn
)paren
r_return
id|maxconn
suffix:semicolon
r_return
id|bufsize
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_query_maxconn:&n; *&n; * Determines the maximum number of connections thay may be established.&n; *&n; * Returns: Maximum number of connections that can be.&n; */
id|ulong
DECL|function|iucv_query_maxconn
id|iucv_query_maxconn
c_func
(paren
r_void
)paren
(brace
r_return
id|iucv_query_generic
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_query_bufsize:&n; *&n; * Determines the size of the external interrupt buffer.&n; *&n; * Returns: Size of external interrupt buffer.&n; */
id|ulong
DECL|function|iucv_query_bufsize
id|iucv_query_bufsize
(paren
r_void
)paren
(brace
r_return
id|iucv_query_generic
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_quiesce:&n; * @pathid:    Path identification number&n; * @user_data: 16-byte user data&n; *&n; * Temporarily suspends incoming messages on an IUCV path.&n; * You can later reactivate the path by invoking the iucv_resume function.&n; * Returns: return code from CP&n; */
r_int
DECL|function|iucv_quiesce
id|iucv_quiesce
(paren
id|__u16
id|pathid
comma
id|__u8
id|user_data
(braket
l_int|16
)braket
)paren
(brace
id|iparml_control
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid = %d&quot;
comma
id|pathid
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|parm-&gt;ipuser
comma
id|user_data
comma
r_sizeof
(paren
id|parm-&gt;ipuser
)paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|QUIESCE
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;b2f0_result = %ld&quot;
comma
id|b2f0_result
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_receive:&n; * @pathid: Path identification number.&n; * @buffer: Address of buffer to receive. Must be below 2G.&n; * @buflen: Length of buffer to receive.&n; * @msgid:  Specifies the message ID.&n; * @trgcls: Specifies target class.&n; * @flags1_out: Receives options for path on return.&n; *    - IPNORPY (0x10)  Specifies whether a reply is required&n; *    - IPPRTY (0x20)   Specifies if you want to send priority message&n; *    - IPRMDATA (0x80) Specifies the data is contained in the parameter list&n; * @residual_buffer: Receives the address of buffer updated by the number&n; *                   of bytes you have received on return.&n; * @residual_length: On return, receives one of the following values:&n; *    - 0                          If the receive buffer is the same length as&n; *                                 the message.&n; *    - Remaining bytes in buffer  If the receive buffer is longer than the&n; *                                 message.&n; *    - Remaining bytes in message If the receive buffer is shorter than the&n; *                                 message.&n; *&n; * This function receives messages that are being sent to you over established&n; * paths.&n; * Returns: return code from CP IUCV call; If the receive buffer is shorter&n; *   than the message, always 5&n; *   -EINVAL - buffer address is pointing to NULL&n; */
r_int
DECL|function|iucv_receive
id|iucv_receive
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
comma
r_void
op_star
id|buffer
comma
id|ulong
id|buflen
comma
r_int
op_star
id|flags1_out
comma
id|ulong
op_star
id|residual_buffer
comma
id|ulong
op_star
id|residual_length
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
r_int
id|moved
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* number of bytes moved from parmlist to buffer */
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
id|addr_t
)paren
id|buffer
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buflen
)paren
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPFGPID
op_or
id|IPFGMID
op_or
id|IPFGMCL
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|RECEIVE
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b2f0_result
op_eq
l_int|0
op_logical_or
id|b2f0_result
op_eq
l_int|5
)paren
(brace
r_if
c_cond
(paren
id|flags1_out
)paren
(brace
id|iucv_debug
c_func
(paren
l_string|&quot;*flags1_out = %d&quot;
comma
op_star
id|flags1_out
)paren
suffix:semicolon
op_star
id|flags1_out
op_assign
(paren
id|parm-&gt;ipflags1
op_amp
(paren
op_complement
l_int|0x07
)paren
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;*flags1_out = %d&quot;
comma
op_star
id|flags1_out
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|parm-&gt;ipflags1
op_amp
id|IPRMDATA
)paren
)paren
(brace
multiline_comment|/*msg not in parmlist */
r_if
c_cond
(paren
id|residual_length
)paren
op_star
id|residual_length
op_assign
id|parm-&gt;ipbfln1f
suffix:semicolon
r_if
c_cond
(paren
id|residual_buffer
)paren
op_star
id|residual_buffer
op_assign
id|parm-&gt;ipbfadr1
suffix:semicolon
)brace
r_else
(brace
id|moved
op_assign
id|min_t
(paren
r_int
r_int
comma
id|buflen
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
(paren
(paren
r_char
op_star
)paren
id|buffer
comma
(paren
r_char
op_star
)paren
op_amp
id|parm-&gt;ipbfadr1
comma
id|moved
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buflen
OL
l_int|8
)paren
id|b2f0_result
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|residual_length
)paren
op_star
id|residual_length
op_assign
id|abs
(paren
id|buflen
op_minus
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|residual_buffer
)paren
op_star
id|residual_buffer
op_assign
(paren
id|ulong
)paren
(paren
id|buffer
op_plus
id|moved
)paren
suffix:semicolon
)brace
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_receive_array&n; * Purpose: This function receives messages that are being sent to you&n; *          over established paths.&n; * Input: pathid - path identification number&n; *        buffer - address of array of buffers&n; *        buflen - total length of buffers&n; *        msgid - specifies the message ID.&n; *        trgcls - specifies target class&n; * Output:&n; *        flags1_out: Options for path.&n; *          IPNORPY - 0x10 specifies whether a reply is required&n; *          IPPRTY - 0x20 specifies if you want to send priority message&n; *         IPRMDATA - 0x80 specifies the data is contained in the parameter list&n; *       residual_buffer - address points to the current list entry IUCV&n; *                         is working on.&n; *       residual_length -&n; *              Contains one of the following values, if the receive buffer is:&n; *               The same length as the message, this field is zero.&n; *               Longer than the message, this field contains the number of&n; *                bytes remaining in the buffer.&n; *               Shorter than the message, this field contains the residual&n; *                count (that is, the number of bytes remaining in the&n; *                message that does not fit into the buffer. In this case&n; *&t;&t;  b2f0_result = 5.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer address is NULL&n; */
r_int
DECL|function|iucv_receive_array
id|iucv_receive_array
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
comma
id|iucv_array_t
op_star
id|buffer
comma
id|ulong
id|buflen
comma
r_int
op_star
id|flags1_out
comma
id|ulong
op_star
id|residual_buffer
comma
id|ulong
op_star
id|residual_length
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
r_int
id|i
op_assign
l_int|0
comma
id|moved
op_assign
l_int|0
comma
id|need_to_move
op_assign
l_int|8
comma
id|dyn_len
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPBUFLST
op_or
id|IPFGPID
op_or
id|IPFGMID
op_or
id|IPFGMCL
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|RECEIVE
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b2f0_result
op_eq
l_int|0
op_logical_or
id|b2f0_result
op_eq
l_int|5
)paren
(brace
r_if
c_cond
(paren
id|flags1_out
)paren
(brace
id|iucv_debug
c_func
(paren
l_string|&quot;*flags1_out = %d&quot;
comma
op_star
id|flags1_out
)paren
suffix:semicolon
op_star
id|flags1_out
op_assign
(paren
id|parm-&gt;ipflags1
op_amp
(paren
op_complement
l_int|0x07
)paren
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;*flags1_out = %d&quot;
comma
op_star
id|flags1_out
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|parm-&gt;ipflags1
op_amp
id|IPRMDATA
)paren
)paren
(brace
multiline_comment|/*msg not in parmlist */
r_if
c_cond
(paren
id|residual_length
)paren
op_star
id|residual_length
op_assign
id|parm-&gt;ipbfln1f
suffix:semicolon
r_if
c_cond
(paren
id|residual_buffer
)paren
op_star
id|residual_buffer
op_assign
id|parm-&gt;ipbfadr1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* copy msg from parmlist to users array. */
r_while
c_loop
(paren
(paren
id|moved
OL
l_int|8
)paren
op_logical_and
(paren
id|moved
OL
id|buflen
)paren
)paren
(brace
id|dyn_len
op_assign
id|min_t
(paren
r_int
r_int
comma
(paren
id|buffer
op_plus
id|i
)paren
op_member_access_from_pointer
id|length
comma
id|need_to_move
)paren
suffix:semicolon
id|memcpy
(paren
(paren
r_char
op_star
)paren
(paren
(paren
id|ulong
)paren
(paren
(paren
id|buffer
op_plus
id|i
)paren
op_member_access_from_pointer
id|address
)paren
)paren
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|parm-&gt;ipbfadr1
)paren
op_plus
id|moved
comma
id|dyn_len
)paren
suffix:semicolon
id|moved
op_add_assign
id|dyn_len
suffix:semicolon
id|need_to_move
op_sub_assign
id|dyn_len
suffix:semicolon
(paren
id|buffer
op_plus
id|i
)paren
op_member_access_from_pointer
id|address
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
(paren
id|__u8
op_star
)paren
(paren
(paren
id|ulong
)paren
(paren
id|buffer
op_plus
id|i
)paren
op_member_access_from_pointer
id|address
)paren
op_plus
id|dyn_len
)paren
suffix:semicolon
(paren
id|buffer
op_plus
id|i
)paren
op_member_access_from_pointer
id|length
op_sub_assign
id|dyn_len
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|need_to_move
)paren
multiline_comment|/* buflen &lt; 8 bytes */
id|b2f0_result
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|residual_length
)paren
op_star
id|residual_length
op_assign
id|abs
(paren
id|buflen
op_minus
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|residual_buffer
)paren
(brace
r_if
c_cond
(paren
id|moved
op_eq
l_int|0
)paren
op_star
id|residual_buffer
op_assign
(paren
id|ulong
)paren
id|buffer
suffix:semicolon
r_else
op_star
id|residual_buffer
op_assign
(paren
id|ulong
)paren
(paren
id|buffer
op_plus
(paren
id|i
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_reject:&n; * @pathid: Path identification number.&n; * @msgid:  Message ID of the message to reject.&n; * @trgcls: Target class of the message to reject.&n; * Returns: return code from CP&n; *&n; * Refuses a specified message. Between the time you are notified of a&n; * message and the time that you complete the message, the message may&n; * be rejected.&n; */
r_int
DECL|function|iucv_reject
id|iucv_reject
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid = %d&quot;
comma
id|pathid
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPFGMCL
op_or
id|IPFGMID
op_or
id|IPFGPID
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|REJECT
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;b2f0_result = %ld&quot;
comma
id|b2f0_result
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_reply&n; * Purpose: This function responds to the two-way messages that you&n; *          receive. You must identify completely the message to&n; *          which you wish to reply. ie, pathid, msgid, and trgcls.&n; * Input: pathid - path identification number&n; *        msgid - specifies the message ID.&n; *        trgcls - specifies target class&n; *        flags1 - option for path&n; *                 IPPRTY- 0x20 - specifies if you want to send priority message&n; *        buffer - address of reply buffer&n; *        buflen - length of reply buffer&n; * Output: ipbfadr2 - Address of buffer updated by the number&n; *                    of bytes you have moved.&n; *         ipbfln2f - Contains on the the following values&n; *              If the answer buffer is the same length as the reply, this field&n; *               contains zero.&n; *              If the answer buffer is longer than the reply, this field contains&n; *               the number of bytes remaining in the buffer.&n; *              If the answer buffer is shorter than the reply, this field contains&n; *               a residual count (that is, the number of bytes remianing in the&n; *               reply that does not fit into the buffer. In this&n; *                case b2f0_result = 5.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer address is NULL&n; */
r_int
DECL|function|iucv_reply
id|iucv_reply
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
comma
r_int
id|flags1
comma
r_void
op_star
id|buffer
comma
id|ulong
id|buflen
comma
id|ulong
op_star
id|ipbfadr2
comma
id|ulong
op_star
id|ipbfln2f
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|__u8
)paren
id|flags1
suffix:semicolon
multiline_comment|/* priority message */
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|REPLY
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|b2f0_result
op_eq
l_int|5
)paren
)paren
(brace
r_if
c_cond
(paren
id|ipbfadr2
)paren
op_star
id|ipbfadr2
op_assign
id|parm-&gt;ipbfadr2
suffix:semicolon
r_if
c_cond
(paren
id|ipbfln2f
)paren
op_star
id|ipbfln2f
op_assign
id|parm-&gt;ipbfln2f
suffix:semicolon
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_reply_array&n; * Purpose: This function responds to the two-way messages that you&n; *          receive. You must identify completely the message to&n; *          which you wish to reply. ie, pathid, msgid, and trgcls.&n; *          The array identifies a list of addresses and lengths of&n; *          discontiguous buffers that contains the reply data.&n; * Input: pathid - path identification number&n; *        msgid - specifies the message ID.&n; *        trgcls - specifies target class&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        buffer - address of array of reply buffers&n; *        buflen - total length of reply buffers&n; * Output: ipbfadr2 - Address of buffer which IUCV is currently working on.&n; *         ipbfln2f - Contains on the the following values&n; *              If the answer buffer is the same length as the reply, this field&n; *               contains zero.&n; *              If the answer buffer is longer than the reply, this field contains&n; *               the number of bytes remaining in the buffer.&n; *              If the answer buffer is shorter than the reply, this field contains&n; *               a residual count (that is, the number of bytes remianing in the&n; *               reply that does not fit into the buffer. In this&n; *               case b2f0_result = 5.&n; * Return: b2f0_result - return code from CP&n; *             (-EINVAL) - buffer address is NULL&n;*/
r_int
DECL|function|iucv_reply_array
id|iucv_reply_array
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
comma
r_int
id|flags1
comma
id|iucv_array_t
op_star
id|buffer
comma
id|ulong
id|buflen
comma
id|ulong
op_star
id|ipbfadr2
comma
id|ulong
op_star
id|ipbfln2f
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPANSLST
op_or
id|flags1
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|REPLY
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_or
(paren
id|b2f0_result
op_eq
l_int|5
)paren
)paren
(brace
r_if
c_cond
(paren
id|ipbfadr2
)paren
op_star
id|ipbfadr2
op_assign
id|parm-&gt;ipbfadr2
suffix:semicolon
r_if
c_cond
(paren
id|ipbfln2f
)paren
op_star
id|ipbfln2f
op_assign
id|parm-&gt;ipbfln2f
suffix:semicolon
)brace
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_reply_prmmsg&n; * Purpose: This function responds to the two-way messages that you&n; *          receive. You must identify completely the message to&n; *          which you wish to reply. ie, pathid, msgid, and trgcls.&n; *          Prmmsg signifies the data is moved into the&n; *          parameter list.&n; * Input: pathid - path identification number&n; *        msgid - specifies the message ID.&n; *        trgcls - specifies target class&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        prmmsg - 8-bytes of data to be placed into the parameter&n; *                 list.&n; * Output: NA&n; * Return: b2f0_result - return code from CP&n;*/
r_int
DECL|function|iucv_reply_prmmsg
id|iucv_reply_prmmsg
(paren
id|__u16
id|pathid
comma
id|__u32
id|msgid
comma
id|__u32
id|trgcls
comma
r_int
id|flags1
comma
id|__u8
id|prmmsg
(braket
l_int|8
)braket
)paren
(brace
id|iparml_dpl
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_dpl
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;ipmsgid
op_assign
id|msgid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|memcpy
c_func
(paren
id|parm-&gt;iprmmsg
comma
id|prmmsg
comma
r_sizeof
(paren
id|parm-&gt;iprmmsg
)paren
)paren
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPRMDATA
op_or
id|flags1
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|REPLY
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_resume:&n; * @pathid:    Path identification number&n; * @user_data: 16-byte of user data&n; *&n; * This function restores communication over a quiesced path.&n; * Returns: return code from CP&n; */
r_int
DECL|function|iucv_resume
id|iucv_resume
(paren
id|__u16
id|pathid
comma
id|__u8
id|user_data
(braket
l_int|16
)braket
)paren
(brace
id|iparml_control
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;pathid = %d&quot;
comma
id|pathid
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|memcpy
(paren
id|parm-&gt;ipuser
comma
id|user_data
comma
r_sizeof
(paren
op_star
id|user_data
)paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|RESUME
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send&n; * Purpose: sends messages&n; * Input: pathid - ushort, pathid&n; *        msgid  - ulong *, id of message returned to caller&n; *        trgcls - ulong, target message class&n; *        srccls - ulong, source message class&n; *        msgtag - ulong, message tag&n; *&t;  flags1  - Contains options for this path.&n; *&t;&t;IPPRTY - Ox20 - specifies if you want to send a priority message.&n; *        buffer - pointer to buffer&n; *        buflen - ulong, length of buffer&n; * Output: b2f0_result - return code from b2f0 call&n; *         msgid - returns message id&n; */
r_int
DECL|function|iucv_send
id|iucv_send
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
r_void
op_star
id|buffer
comma
id|ulong
id|buflen
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPNORPY
op_or
id|flags1
)paren
suffix:semicolon
multiline_comment|/* one way priority message */
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send_array&n; * Purpose: This function transmits data to another application.&n; *          The contents of buffer is the address of the array of&n; *          addresses and lengths of discontiguous buffers that hold&n; *          the message text. This is a one-way message and the&n; *          receiver will not reply to the message.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - specifies a tag to be associated witht the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        buffer - address of array of send buffers&n; *        buflen - total length of send buffers&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer address is NULL&n; */
r_int
DECL|function|iucv_send_array
id|iucv_send_array
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
id|iucv_array_t
op_star
id|buffer
comma
id|ulong
id|buflen
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPNORPY
op_or
id|IPBUFLST
op_or
id|flags1
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send_prmmsg&n; * Purpose: This function transmits data to another application.&n; *          Prmmsg specifies that the 8-bytes of data are to be moved&n; *          into the parameter list. This is a one-way message and the&n; *          receiver will not reply to the message.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - specifies a tag to be associated with the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        prmmsg - 8-bytes of data to be placed into parameter list&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n;*/
r_int
DECL|function|iucv_send_prmmsg
id|iucv_send_prmmsg
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
id|__u8
id|prmmsg
(braket
l_int|8
)braket
)paren
(brace
id|iparml_dpl
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_dpl
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPRMDATA
op_or
id|IPNORPY
op_or
id|flags1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|parm-&gt;iprmmsg
comma
id|prmmsg
comma
r_sizeof
(paren
id|parm-&gt;iprmmsg
)paren
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send2way&n; * Purpose: This function transmits data to another application.&n; *          Data to be transmitted is in a buffer. The receiver&n; *          of the send is expected to reply to the message and&n; *          a buffer is provided into which IUCV moves the reply&n; *          to this message.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - specifies a tag associated with the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        buffer - address of send buffer&n; *        buflen - length of send buffer&n; *        ansbuf - address of buffer to reply with&n; *        anslen - length of buffer to reply with&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer or ansbuf address is NULL&n; */
r_int
DECL|function|iucv_send2way
id|iucv_send2way
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
r_void
op_star
id|buffer
comma
id|ulong
id|buflen
comma
r_void
op_star
id|ansbuf
comma
id|ulong
id|anslen
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
op_logical_or
op_logical_neg
id|ansbuf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|ansbuf
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
(paren
id|__u32
)paren
id|anslen
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
id|flags1
suffix:semicolon
multiline_comment|/* priority message */
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send2way_array&n; * Purpose: This function transmits data to another application.&n; *          The contents of buffer is the address of the array of&n; *          addresses and lengths of discontiguous buffers that hold&n; *          the message text. The receiver of the send is expected to&n; *          reply to the message and a buffer is provided into which&n; *          IUCV moves the reply to this message.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - spcifies a tag to be associated with the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        buffer - address of array of send buffers&n; *        buflen - total length of send buffers&n; *        ansbuf - address of buffer to reply with&n; *        anslen - length of buffer to reply with&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer address is NULL&n; */
r_int
DECL|function|iucv_send2way_array
id|iucv_send2way_array
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
id|iucv_array_t
op_star
id|buffer
comma
id|ulong
id|buflen
comma
id|iucv_array_t
op_star
id|ansbuf
comma
id|ulong
id|anslen
)paren
(brace
id|iparml_db
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
op_logical_or
op_logical_neg
id|ansbuf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_db
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipbfadr1
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|buffer
)paren
suffix:semicolon
id|parm-&gt;ipbfln1f
op_assign
(paren
id|__u32
)paren
id|buflen
suffix:semicolon
multiline_comment|/* length of message */
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|ansbuf
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
(paren
id|__u32
)paren
id|anslen
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPBUFLST
op_or
id|IPANSLST
op_or
id|flags1
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send2way_prmmsg&n; * Purpose: This function transmits data to another application.&n; *          Prmmsg specifies that the 8-bytes of data are to be moved&n; *          into the parameter list. This is a two-way message and the&n; *          receiver of the message is expected to reply. A buffer&n; *          is provided into which IUCV moves the reply to this&n; *          message.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - specifies a tag to be associated with the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        prmmsg - 8-bytes of data to be placed in parameter list&n; *        ansbuf - address of buffer to reply with&n; *        anslen - length of buffer to reply with&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - buffer address is NULL&n;*/
r_int
DECL|function|iucv_send2way_prmmsg
id|iucv_send2way_prmmsg
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
id|ulong
id|flags1
comma
id|__u8
id|prmmsg
(braket
l_int|8
)braket
comma
r_void
op_star
id|ansbuf
comma
id|ulong
id|anslen
)paren
(brace
id|iparml_dpl
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ansbuf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_dpl
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|ansbuf
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
(paren
id|__u32
)paren
id|anslen
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPRMDATA
op_or
id|flags1
)paren
suffix:semicolon
multiline_comment|/* message in prmlist */
id|memcpy
c_func
(paren
id|parm-&gt;iprmmsg
comma
id|prmmsg
comma
r_sizeof
(paren
id|parm-&gt;iprmmsg
)paren
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_send2way_prmmsg_array&n; * Purpose: This function transmits data to another application.&n; *          Prmmsg specifies that the 8-bytes of data are to be moved&n; *          into the parameter list. This is a two-way message and the&n; *          receiver of the message is expected to reply. A buffer&n; *          is provided into which IUCV moves the reply to this&n; *          message. The contents of ansbuf is the address of the&n; *          array of addresses and lengths of discontiguous buffers&n; *          that contain the reply.&n; * Input: pathid - path identification number&n; *        trgcls - specifies target class&n; *        srccls - specifies the source message class&n; *        msgtag - specifies a tag to be associated with the message&n; *        flags1 - option for path&n; *                 IPPRTY- specifies if you want to send priority message&n; *        prmmsg - 8-bytes of data to be placed into the parameter list&n; *        ansbuf - address of buffer to reply with&n; *        anslen - length of buffer to reply with&n; * Output: msgid - specifies the message ID.&n; * Return: b2f0_result - return code from CP&n; *         (-EINVAL) - ansbuf address is NULL&n; */
r_int
DECL|function|iucv_send2way_prmmsg_array
id|iucv_send2way_prmmsg_array
(paren
id|__u16
id|pathid
comma
id|__u32
op_star
id|msgid
comma
id|__u32
id|trgcls
comma
id|__u32
id|srccls
comma
id|__u32
id|msgtag
comma
r_int
id|flags1
comma
id|__u8
id|prmmsg
(braket
l_int|8
)braket
comma
id|iucv_array_t
op_star
id|ansbuf
comma
id|ulong
id|anslen
)paren
(brace
id|iparml_dpl
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ansbuf
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_dpl
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|parm-&gt;iptrgcls
op_assign
id|trgcls
suffix:semicolon
id|parm-&gt;ipsrccls
op_assign
id|srccls
suffix:semicolon
id|parm-&gt;ipmsgtag
op_assign
id|msgtag
suffix:semicolon
id|parm-&gt;ipbfadr2
op_assign
(paren
id|__u32
)paren
(paren
(paren
id|ulong
)paren
id|ansbuf
)paren
suffix:semicolon
id|parm-&gt;ipbfln2f
op_assign
(paren
id|__u32
)paren
id|anslen
suffix:semicolon
id|parm-&gt;ipflags1
op_assign
(paren
id|IPRMDATA
op_or
id|IPANSLST
op_or
id|flags1
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|parm-&gt;iprmmsg
comma
id|prmmsg
comma
r_sizeof
(paren
id|parm-&gt;iprmmsg
)paren
)paren
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEND
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|b2f0_result
op_eq
l_int|0
)paren
op_logical_and
(paren
id|msgid
)paren
)paren
op_star
id|msgid
op_assign
id|parm-&gt;ipmsgid
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Name: iucv_setmask&n; * Purpose: This function enables or disables the following IUCV&n; *          external interruptions: Nonpriority and priority message&n; *          interrupts, nonpriority and priority reply interrupts.&n; * Input: SetMaskFlag - options for interrupts&n; *           0x80 - Nonpriority_MessagePendingInterruptsFlag&n; *           0x40 - Priority_MessagePendingInterruptsFlag&n; *           0x20 - Nonpriority_MessageCompletionInterruptsFlag&n; *           0x10 - Priority_MessageCompletionInterruptsFlag&n; * Output: NA&n; * Return: b2f0_result - return code from CP&n;*/
r_int
DECL|function|iucv_setmask
id|iucv_setmask
(paren
r_int
id|SetMaskFlag
)paren
(brace
id|iparml_set_mask
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_set_mask
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|parm-&gt;ipmask
op_assign
(paren
id|__u8
)paren
id|SetMaskFlag
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SETMASK
comma
id|parm
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;b2f0_result = %ld&quot;
comma
id|b2f0_result
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_sever:&n; * @pathid:    Path identification number&n; * @user_data: 16-byte of user data&n; *&n; * This function terminates an iucv path.&n; * Returns: return code from CP&n; */
r_int
DECL|function|iucv_sever
id|iucv_sever
c_func
(paren
id|__u16
id|pathid
comma
id|__u8
id|user_data
(braket
l_int|16
)braket
)paren
(brace
id|iparml_control
op_star
id|parm
suffix:semicolon
id|ulong
id|b2f0_result
op_assign
l_int|0
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering&quot;
)paren
suffix:semicolon
id|parm
op_assign
(paren
id|iparml_control
op_star
)paren
id|grab_param
c_func
(paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|parm-&gt;ipuser
comma
id|user_data
comma
r_sizeof
(paren
id|parm-&gt;ipuser
)paren
)paren
suffix:semicolon
id|parm-&gt;ippathid
op_assign
id|pathid
suffix:semicolon
id|b2f0_result
op_assign
id|b2f0
c_func
(paren
id|SEVER
comma
id|parm
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|b2f0_result
)paren
id|iucv_remove_pathid
c_func
(paren
id|pathid
)paren
suffix:semicolon
id|release_param
c_func
(paren
id|parm
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;exiting&quot;
)paren
suffix:semicolon
r_return
id|b2f0_result
suffix:semicolon
)brace
multiline_comment|/*&n; * Interrupt Handlers&n; *******************************************************************************/
multiline_comment|/**&n; * iucv_irq_handler:&n; * @regs: Current registers&n; * @code: irq code&n; *&n; * Handles external interrupts coming in from CP.&n; * Places the interrupt buffer on a queue and schedules iucv_bh_handler().&n; */
r_static
r_void
DECL|function|iucv_irq_handler
id|iucv_irq_handler
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
id|__u16
id|code
)paren
(brace
id|iucv_irqdata
op_star
id|irqdata
suffix:semicolon
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|irq_enter
c_func
(paren
id|cpu
comma
l_int|0x4000
)paren
suffix:semicolon
id|irqdata
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|iucv_irqdata
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irqdata
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: out of memory&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|irq_exit
c_func
(paren
id|cpu
comma
l_int|0x4000
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|irqdata-&gt;data
comma
id|iucv_external_int_buffer
comma
r_sizeof
(paren
id|iucv_GeneralInterrupt
)paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|iucv_irq_queue_lock
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|irqdata-&gt;queue
comma
op_amp
id|iucv_irq_queue
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|iucv_irq_queue_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_compare_and_swap
(paren
l_int|0
comma
l_int|1
comma
op_amp
id|iucv_bh_scheduled
)paren
op_eq
l_int|0
)paren
(brace
id|queue_task
(paren
op_amp
id|iucv_tq
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
id|irq_exit
c_func
(paren
id|cpu
comma
l_int|0x4000
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_do_int:&n; * @int_buf: Pointer to copy of external interrupt buffer&n; *&n; * The workhorse for handling interrupts queued by iucv_irq_handler().&n; * This function is called from the bottom half iucv_bh_handler().&n; */
r_static
r_void
DECL|function|iucv_do_int
id|iucv_do_int
c_func
(paren
id|iucv_GeneralInterrupt
op_star
id|int_buf
)paren
(brace
id|handler
op_star
id|h
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|iucv_interrupt_ops_t
op_star
id|interrupt
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* interrupt addresses */
id|__u8
id|temp_buff1
(braket
l_int|24
)braket
comma
id|temp_buff2
(braket
l_int|24
)braket
suffix:semicolon
multiline_comment|/* masked handler id. */
r_int
id|rc
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|__u8
id|no_listener
(braket
l_int|16
)braket
op_assign
l_string|&quot;NO LISTENER&quot;
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;entering, pathid %d, type %02X&quot;
comma
id|int_buf-&gt;ippathid
comma
id|int_buf-&gt;iptype
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;External Interrupt Buffer:&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|int_buf
comma
r_sizeof
(paren
id|iucv_GeneralInterrupt
)paren
)paren
suffix:semicolon
id|ASCEBC
(paren
id|no_listener
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|int_buf-&gt;iptype
op_ne
l_int|01
)paren
(brace
r_if
c_cond
(paren
(paren
id|int_buf-&gt;ippathid
)paren
OG
(paren
id|max_connections
op_minus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Got interrupt with pathid %d&quot;
l_string|&quot; &gt; max_connections (%ld)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|int_buf-&gt;ippathid
comma
id|max_connections
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|h
op_assign
id|iucv_pathid_table
(braket
id|int_buf-&gt;ippathid
)braket
suffix:semicolon
id|interrupt
op_assign
id|h-&gt;interrupt_table
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;Handler:&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|h
comma
r_sizeof
(paren
id|handler
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end of if statement */
r_switch
c_cond
(paren
id|int_buf-&gt;iptype
)paren
(brace
r_case
l_int|0x01
suffix:colon
multiline_comment|/* connection pending */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|iucv_handler_table
)paren
(brace
id|h
op_assign
id|list_entry
c_func
(paren
id|lh
comma
id|handler
comma
id|list
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|temp_buff1
comma
op_amp
(paren
id|int_buf-&gt;ipvmid
)paren
comma
l_int|24
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|temp_buff2
comma
op_amp
(paren
id|h-&gt;id.userid
)paren
comma
l_int|24
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|24
suffix:semicolon
id|j
op_increment
)paren
(brace
id|temp_buff1
(braket
id|j
)braket
op_and_assign
(paren
id|h-&gt;id.mask
)paren
(braket
id|j
)braket
suffix:semicolon
id|temp_buff2
(braket
id|j
)braket
op_and_assign
(paren
id|h-&gt;id.mask
)paren
(braket
id|j
)braket
suffix:semicolon
)brace
id|iucv_debug
c_func
(paren
l_string|&quot;temp_buff1:&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|temp_buff1
comma
r_sizeof
(paren
id|temp_buff1
)paren
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;temp_buff2&quot;
)paren
suffix:semicolon
id|iucv_dumpit
c_func
(paren
id|temp_buff2
comma
r_sizeof
(paren
id|temp_buff2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
(paren
id|temp_buff1
comma
id|temp_buff2
comma
l_int|24
)paren
op_eq
l_int|0
)paren
(brace
id|iucv_debug
c_func
(paren
l_string|&quot;found a matching handler&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h
)paren
(brace
multiline_comment|/* ADD PATH TO PATHID TABLE */
id|rc
op_assign
id|iucv_add_pathid
c_func
(paren
id|int_buf-&gt;ippathid
comma
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|iucv_sever
(paren
id|int_buf-&gt;ippathid
comma
id|no_listener
)paren
suffix:semicolon
id|iucv_debug
c_func
(paren
l_string|&quot;add_pathid failed, rc = %d&quot;
comma
(paren
r_int
)paren
id|add_pathid_result
)paren
suffix:semicolon
)brace
r_else
(brace
id|interrupt
op_assign
id|h-&gt;interrupt_table
suffix:semicolon
r_if
c_cond
(paren
id|interrupt-&gt;ConnectionPending
)paren
(brace
id|EBCASC
(paren
id|int_buf-&gt;ipvmid
comma
l_int|8
)paren
suffix:semicolon
id|interrupt
op_member_access_from_pointer
id|ConnectionPending
c_func
(paren
(paren
id|iucv_ConnectionPending
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
)brace
r_else
id|iucv_sever
c_func
(paren
id|int_buf-&gt;ippathid
comma
id|no_listener
)paren
suffix:semicolon
)brace
)brace
r_else
id|iucv_sever
c_func
(paren
id|int_buf-&gt;ippathid
comma
id|no_listener
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x02
suffix:colon
multiline_comment|/*connection complete */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;ConnectionComplete
)paren
id|interrupt
op_member_access_from_pointer
id|ConnectionComplete
c_func
(paren
(paren
id|iucv_ConnectionComplete
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_debug
c_func
(paren
l_string|&quot;ConnectionComplete not called&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x03
suffix:colon
multiline_comment|/* connection severed */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;ConnectionSevered
)paren
id|interrupt
op_member_access_from_pointer
id|ConnectionSevered
c_func
(paren
(paren
id|iucv_ConnectionSevered
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_sever
(paren
id|int_buf-&gt;ippathid
comma
id|no_listener
)paren
suffix:semicolon
)brace
r_else
id|iucv_sever
c_func
(paren
id|int_buf-&gt;ippathid
comma
id|no_listener
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x04
suffix:colon
multiline_comment|/* connection quiesced */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;ConnectionQuiesced
)paren
id|interrupt
op_member_access_from_pointer
id|ConnectionQuiesced
c_func
(paren
(paren
id|iucv_ConnectionQuiesced
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_debug
c_func
(paren
l_string|&quot;ConnectionQuiesced not called&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x05
suffix:colon
multiline_comment|/* connection resumed */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;ConnectionResumed
)paren
id|interrupt
op_member_access_from_pointer
id|ConnectionResumed
c_func
(paren
(paren
id|iucv_ConnectionResumed
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_debug
c_func
(paren
l_string|&quot;ConnectionResumed not called&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x06
suffix:colon
multiline_comment|/* priority message complete */
r_case
l_int|0x07
suffix:colon
multiline_comment|/* nonpriority message complete */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;MessageComplete
)paren
id|interrupt
op_member_access_from_pointer
id|MessageComplete
c_func
(paren
(paren
id|iucv_MessageComplete
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_debug
c_func
(paren
l_string|&quot;MessageComplete not called&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|0x08
suffix:colon
multiline_comment|/* priority message pending  */
r_case
l_int|0x09
suffix:colon
multiline_comment|/* nonpriority message pending  */
r_if
c_cond
(paren
id|h
)paren
(brace
r_if
c_cond
(paren
id|interrupt-&gt;MessagePending
)paren
id|interrupt
op_member_access_from_pointer
id|MessagePending
c_func
(paren
(paren
id|iucv_MessagePending
op_star
)paren
id|int_buf
comma
id|h-&gt;pgm_data
)paren
suffix:semicolon
r_else
id|iucv_debug
c_func
(paren
l_string|&quot;MessagePending not called&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* unknown iucv type */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: unknown iucv interrupt&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* end switch */
id|iucv_debug
c_func
(paren
l_string|&quot;exiting pathid %d, type %02X&quot;
comma
id|int_buf-&gt;ippathid
comma
id|int_buf-&gt;iptype
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * iucv_bh_handler:&n; *&n; * This function loops over the queue of irq buffers and runs iucv_do_int()&n; * on every queue element.&n; */
r_static
r_void
DECL|function|iucv_bh_handler
id|iucv_bh_handler
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
id|head
suffix:semicolon
r_struct
id|list_head
op_star
id|next
suffix:semicolon
id|ulong
id|flags
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|iucv_bh_scheduled
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|iucv_irq_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|head
comma
op_amp
id|iucv_irq_queue
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|iucv_irq_queue
)paren
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|iucv_irq_queue_lock
comma
id|flags
)paren
suffix:semicolon
id|next
op_assign
id|head.next
suffix:semicolon
r_while
c_loop
(paren
id|next
op_ne
op_amp
id|head
)paren
(brace
id|iucv_irqdata
op_star
id|p
op_assign
id|list_entry
c_func
(paren
id|next
comma
id|iucv_irqdata
comma
id|queue
)paren
suffix:semicolon
id|next
op_assign
id|next-&gt;next
suffix:semicolon
id|iucv_do_int
c_func
(paren
op_amp
id|p-&gt;data
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * Export all public stuff&n; */
DECL|variable|iucv_accept
id|EXPORT_SYMBOL
(paren
id|iucv_accept
)paren
suffix:semicolon
DECL|variable|iucv_connect
id|EXPORT_SYMBOL
(paren
id|iucv_connect
)paren
suffix:semicolon
DECL|variable|iucv_purge
id|EXPORT_SYMBOL
(paren
id|iucv_purge
)paren
suffix:semicolon
DECL|variable|iucv_query_maxconn
id|EXPORT_SYMBOL
(paren
id|iucv_query_maxconn
)paren
suffix:semicolon
DECL|variable|iucv_query_bufsize
id|EXPORT_SYMBOL
(paren
id|iucv_query_bufsize
)paren
suffix:semicolon
DECL|variable|iucv_quiesce
id|EXPORT_SYMBOL
(paren
id|iucv_quiesce
)paren
suffix:semicolon
DECL|variable|iucv_receive
id|EXPORT_SYMBOL
(paren
id|iucv_receive
)paren
suffix:semicolon
DECL|variable|iucv_receive_array
id|EXPORT_SYMBOL
(paren
id|iucv_receive_array
)paren
suffix:semicolon
DECL|variable|iucv_reject
id|EXPORT_SYMBOL
(paren
id|iucv_reject
)paren
suffix:semicolon
DECL|variable|iucv_reply
id|EXPORT_SYMBOL
(paren
id|iucv_reply
)paren
suffix:semicolon
DECL|variable|iucv_reply_array
id|EXPORT_SYMBOL
(paren
id|iucv_reply_array
)paren
suffix:semicolon
DECL|variable|iucv_reply_prmmsg
id|EXPORT_SYMBOL
(paren
id|iucv_reply_prmmsg
)paren
suffix:semicolon
DECL|variable|iucv_resume
id|EXPORT_SYMBOL
(paren
id|iucv_resume
)paren
suffix:semicolon
DECL|variable|iucv_send
id|EXPORT_SYMBOL
(paren
id|iucv_send
)paren
suffix:semicolon
DECL|variable|iucv_send2way
id|EXPORT_SYMBOL
(paren
id|iucv_send2way
)paren
suffix:semicolon
DECL|variable|iucv_send2way_array
id|EXPORT_SYMBOL
(paren
id|iucv_send2way_array
)paren
suffix:semicolon
DECL|variable|iucv_send_array
id|EXPORT_SYMBOL
(paren
id|iucv_send_array
)paren
suffix:semicolon
DECL|variable|iucv_send2way_prmmsg
id|EXPORT_SYMBOL
(paren
id|iucv_send2way_prmmsg
)paren
suffix:semicolon
DECL|variable|iucv_send2way_prmmsg_array
id|EXPORT_SYMBOL
(paren
id|iucv_send2way_prmmsg_array
)paren
suffix:semicolon
DECL|variable|iucv_send_prmmsg
id|EXPORT_SYMBOL
(paren
id|iucv_send_prmmsg
)paren
suffix:semicolon
DECL|variable|iucv_setmask
id|EXPORT_SYMBOL
(paren
id|iucv_setmask
)paren
suffix:semicolon
DECL|variable|iucv_sever
id|EXPORT_SYMBOL
(paren
id|iucv_sever
)paren
suffix:semicolon
DECL|variable|iucv_register_program
id|EXPORT_SYMBOL
(paren
id|iucv_register_program
)paren
suffix:semicolon
DECL|variable|iucv_unregister_program
id|EXPORT_SYMBOL
(paren
id|iucv_unregister_program
)paren
suffix:semicolon
eof
