multiline_comment|/*&n; *&n; * linux/drivers/s390/net/qeth_eddp.c ($Revision: 1.11 $)&n; *&n; * Enhanced Device Driver Packing (EDDP) support for the qeth driver.&n; *&n; * Copyright 2004 IBM Corporation&n; *&n; *    Author(s): Thomas Spatzier &lt;tspat@de.ibm.com&gt;&n; *&n; *    $Revision: 1.11 $&t; $Date: 2005/03/24 09:04:18 $&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;net/tcp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &quot;qeth.h&quot;
macro_line|#include &quot;qeth_mpc.h&quot;
macro_line|#include &quot;qeth_eddp.h&quot;
r_int
DECL|function|qeth_eddp_check_buffers_for_context
id|qeth_eddp_check_buffers_for_context
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|qeth_eddp_context
op_star
id|ctx
)paren
(brace
r_int
id|index
op_assign
id|queue-&gt;next_buf_to_fill
suffix:semicolon
r_int
id|elements_needed
op_assign
id|ctx-&gt;num_elements
suffix:semicolon
r_int
id|elements_in_buffer
suffix:semicolon
r_int
id|skbs_in_buffer
suffix:semicolon
r_int
id|buffers_needed
op_assign
l_int|0
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcbfc&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|elements_needed
OG
l_int|0
)paren
(brace
id|buffers_needed
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|queue-&gt;bufs
(braket
id|index
)braket
dot
id|state
)paren
op_ne
id|QETH_QDIO_BUF_EMPTY
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|elements_in_buffer
op_assign
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|queue-&gt;card
)paren
op_minus
id|queue-&gt;bufs
(braket
id|index
)braket
dot
id|next_element_to_fill
suffix:semicolon
id|skbs_in_buffer
op_assign
id|elements_in_buffer
op_div
id|ctx-&gt;elements_per_skb
suffix:semicolon
id|elements_needed
op_sub_assign
id|skbs_in_buffer
op_star
id|ctx-&gt;elements_per_skb
suffix:semicolon
id|index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
)brace
r_return
id|buffers_needed
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_free_context
id|qeth_eddp_free_context
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
)paren
(brace
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpfctx&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ctx-&gt;num_pages
suffix:semicolon
op_increment
id|i
)paren
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|ctx-&gt;pages
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ctx-&gt;pages
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;elements
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|ctx-&gt;elements
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_get_context
id|qeth_eddp_get_context
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|ctx-&gt;refcnt
)paren
suffix:semicolon
)brace
r_void
DECL|function|qeth_eddp_put_context
id|qeth_eddp_put_context
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_return
c_func
(paren
op_amp
id|ctx-&gt;refcnt
)paren
op_eq
l_int|0
)paren
id|qeth_eddp_free_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
r_void
DECL|function|qeth_eddp_buf_release_contexts
id|qeth_eddp_buf_release_contexts
c_func
(paren
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
)paren
(brace
r_struct
id|qeth_eddp_context_reference
op_star
id|ref
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;eddprctx&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|buf-&gt;ctx_list
)paren
)paren
(brace
id|ref
op_assign
id|list_entry
c_func
(paren
id|buf-&gt;ctx_list.next
comma
r_struct
id|qeth_eddp_context_reference
comma
id|list
)paren
suffix:semicolon
id|qeth_eddp_put_context
c_func
(paren
id|ref-&gt;ctx
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|ref-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ref
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|qeth_eddp_buf_ref_context
id|qeth_eddp_buf_ref_context
c_func
(paren
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
comma
r_struct
id|qeth_eddp_context
op_star
id|ctx
)paren
(brace
r_struct
id|qeth_eddp_context_reference
op_star
id|ref
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;eddprfcx&quot;
)paren
suffix:semicolon
id|ref
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_eddp_context_reference
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ref
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|qeth_eddp_get_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|ref-&gt;ctx
op_assign
id|ctx
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|ref-&gt;list
comma
op_amp
id|buf-&gt;ctx_list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|qeth_eddp_fill_buffer
id|qeth_eddp_fill_buffer
c_func
(paren
r_struct
id|qeth_qdio_out_q
op_star
id|queue
comma
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_int
id|index
)paren
(brace
r_struct
id|qeth_qdio_out_buffer
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|qdio_buffer
op_star
id|buffer
suffix:semicolon
r_int
id|elements
op_assign
id|ctx-&gt;num_elements
suffix:semicolon
r_int
id|element
op_assign
l_int|0
suffix:semicolon
r_int
id|flush_cnt
op_assign
l_int|0
suffix:semicolon
r_int
id|must_refcnt
op_assign
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpfibu&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|elements
OG
l_int|0
)paren
(brace
id|buf
op_assign
op_amp
id|queue-&gt;bufs
(braket
id|index
)braket
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|buf-&gt;state
)paren
op_ne
id|QETH_QDIO_BUF_EMPTY
)paren
(brace
multiline_comment|/* normally this should not happen since we checked for&n;&t;&t;&t; * available elements in qeth_check_elements_for_context&n;&t;&t;&t; */
r_if
c_cond
(paren
id|element
op_eq
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_else
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;could only partially fill eddp &quot;
l_string|&quot;buffer!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* check if the whole next skb fits into current buffer */
r_if
c_cond
(paren
(paren
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|queue-&gt;card
)paren
op_minus
id|buf-&gt;next_element_to_fill
)paren
OL
id|ctx-&gt;elements_per_skb
)paren
(brace
multiline_comment|/* no -&gt; go to next buffer */
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_mod
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|flush_cnt
op_increment
suffix:semicolon
multiline_comment|/* new buffer, so we have to add ctx to buffer&squot;ctx_list&n;&t;&t;&t; * and increment ctx&squot;s refcnt */
id|must_refcnt
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|must_refcnt
)paren
(brace
id|must_refcnt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|qeth_eddp_buf_ref_context
c_func
(paren
id|buf
comma
id|ctx
)paren
)paren
(brace
id|PRINT_WARN
c_func
(paren
l_string|&quot;no memory to create eddp context &quot;
l_string|&quot;reference&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_check
suffix:semicolon
)brace
)brace
id|buffer
op_assign
id|buf-&gt;buffer
suffix:semicolon
multiline_comment|/* fill one skb into buffer */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ctx-&gt;elements_per_skb
suffix:semicolon
op_increment
id|i
)paren
(brace
id|buffer-&gt;element
(braket
id|buf-&gt;next_element_to_fill
)braket
dot
id|addr
op_assign
id|ctx-&gt;elements
(braket
id|element
)braket
dot
id|addr
suffix:semicolon
id|buffer-&gt;element
(braket
id|buf-&gt;next_element_to_fill
)braket
dot
id|length
op_assign
id|ctx-&gt;elements
(braket
id|element
)braket
dot
id|length
suffix:semicolon
id|buffer-&gt;element
(braket
id|buf-&gt;next_element_to_fill
)braket
dot
id|flags
op_assign
id|ctx-&gt;elements
(braket
id|element
)braket
dot
id|flags
suffix:semicolon
id|buf-&gt;next_element_to_fill
op_increment
suffix:semicolon
id|element
op_increment
suffix:semicolon
id|elements
op_decrement
suffix:semicolon
)brace
)brace
id|out_check
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|queue-&gt;do_pack
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;fillbfnp&quot;
)paren
suffix:semicolon
multiline_comment|/* set state to PRIMED -&gt; will be flushed */
r_if
c_cond
(paren
id|buf-&gt;next_element_to_fill
OG
l_int|0
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|flush_cnt
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
macro_line|#ifdef CONFIG_QETH_PERF_STATS
id|queue-&gt;card-&gt;perf_stats.skbs_sent_pack
op_increment
suffix:semicolon
macro_line|#endif
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|6
comma
l_string|&quot;fillbfpa&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;next_element_to_fill
op_ge
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|queue-&gt;card
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * packed buffer if full -&gt; set state PRIMED&n;&t;&t;&t; * -&gt; will be flushed&n;&t;&t;&t; */
id|atomic_set
c_func
(paren
op_amp
id|buf-&gt;state
comma
id|QETH_QDIO_BUF_PRIMED
)paren
suffix:semicolon
id|flush_cnt
op_increment
suffix:semicolon
)brace
)brace
id|out
suffix:colon
r_return
id|flush_cnt
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qeth_get_skb_data_len
id|qeth_get_skb_data_len
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
op_increment
id|i
)paren
id|len
op_sub_assign
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
dot
id|size
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_create_segment_hdrs
id|qeth_eddp_create_segment_hdrs
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_struct
id|qeth_eddp_data
op_star
id|eddp
)paren
(brace
id|u8
op_star
id|page
suffix:semicolon
r_int
id|page_remainder
suffix:semicolon
r_int
id|page_offset
suffix:semicolon
r_int
id|hdr_len
suffix:semicolon
r_struct
id|qeth_eddp_element
op_star
id|element
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcrsh&quot;
)paren
suffix:semicolon
id|page
op_assign
id|ctx-&gt;pages
(braket
id|ctx-&gt;offset
op_rshift
id|PAGE_SHIFT
)braket
suffix:semicolon
id|page_offset
op_assign
id|ctx-&gt;offset
op_mod
id|PAGE_SIZE
suffix:semicolon
id|element
op_assign
op_amp
id|ctx-&gt;elements
(braket
id|ctx-&gt;num_elements
)braket
suffix:semicolon
id|hdr_len
op_assign
id|eddp-&gt;nhl
op_plus
id|eddp-&gt;thl
suffix:semicolon
multiline_comment|/* FIXME: layer2 and VLAN !!! */
r_if
c_cond
(paren
id|eddp-&gt;qh.hdr.l2.id
op_eq
id|QETH_HEADER_TYPE_LAYER2
)paren
id|hdr_len
op_add_assign
id|ETH_HLEN
suffix:semicolon
r_if
c_cond
(paren
id|eddp-&gt;mac.h_proto
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
)paren
id|hdr_len
op_add_assign
id|VLAN_HLEN
suffix:semicolon
multiline_comment|/* does complete header fit in current page ? */
id|page_remainder
op_assign
id|PAGE_SIZE
op_minus
id|page_offset
suffix:semicolon
r_if
c_cond
(paren
id|page_remainder
OL
(paren
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
op_plus
id|hdr_len
)paren
)paren
(brace
multiline_comment|/* no -&gt; go to start of next page */
id|ctx-&gt;offset
op_add_assign
id|page_remainder
suffix:semicolon
id|page
op_assign
id|ctx-&gt;pages
(braket
id|ctx-&gt;offset
op_rshift
id|PAGE_SHIFT
)braket
suffix:semicolon
id|page_offset
op_assign
l_int|0
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|page
op_plus
id|page_offset
comma
op_amp
id|eddp-&gt;qh
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
suffix:semicolon
id|element-&gt;addr
op_assign
id|page
op_plus
id|page_offset
suffix:semicolon
id|element-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
id|page_offset
op_add_assign
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
multiline_comment|/* add mac header (?) */
r_if
c_cond
(paren
id|eddp-&gt;qh.hdr.l2.id
op_eq
id|QETH_HEADER_TYPE_LAYER2
)paren
(brace
id|memcpy
c_func
(paren
id|page
op_plus
id|page_offset
comma
op_amp
id|eddp-&gt;mac
comma
id|ETH_HLEN
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|ETH_HLEN
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|ETH_HLEN
suffix:semicolon
id|page_offset
op_add_assign
id|ETH_HLEN
suffix:semicolon
)brace
multiline_comment|/* add VLAN tag */
r_if
c_cond
(paren
id|eddp-&gt;mac.h_proto
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
)paren
(brace
id|memcpy
c_func
(paren
id|page
op_plus
id|page_offset
comma
op_amp
id|eddp-&gt;vlan
comma
id|VLAN_HLEN
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|VLAN_HLEN
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|VLAN_HLEN
suffix:semicolon
id|page_offset
op_add_assign
id|VLAN_HLEN
suffix:semicolon
)brace
multiline_comment|/* add network header */
id|memcpy
c_func
(paren
id|page
op_plus
id|page_offset
comma
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;nh
comma
id|eddp-&gt;nhl
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|eddp-&gt;nhl
suffix:semicolon
id|eddp-&gt;nh_in_ctx
op_assign
id|page
op_plus
id|page_offset
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|eddp-&gt;nhl
suffix:semicolon
id|page_offset
op_add_assign
id|eddp-&gt;nhl
suffix:semicolon
multiline_comment|/* add transport header */
id|memcpy
c_func
(paren
id|page
op_plus
id|page_offset
comma
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;th
comma
id|eddp-&gt;thl
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|eddp-&gt;thl
suffix:semicolon
id|eddp-&gt;th_in_ctx
op_assign
id|page
op_plus
id|page_offset
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|eddp-&gt;thl
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_copy_data_tcp
id|qeth_eddp_copy_data_tcp
c_func
(paren
r_char
op_star
id|dst
comma
r_struct
id|qeth_eddp_data
op_star
id|eddp
comma
r_int
id|len
comma
id|u32
op_star
id|hcsum
)paren
(brace
r_struct
id|skb_frag_struct
op_star
id|frag
suffix:semicolon
r_int
id|left_in_frag
suffix:semicolon
r_int
id|copy_len
suffix:semicolon
id|u8
op_star
id|src
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcdtc&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb_shinfo
c_func
(paren
id|eddp-&gt;skb
)paren
op_member_access_from_pointer
id|nr_frags
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|dst
comma
id|eddp-&gt;skb-&gt;data
op_plus
id|eddp-&gt;skb_offset
comma
id|len
)paren
suffix:semicolon
op_star
id|hcsum
op_assign
id|csum_partial
c_func
(paren
id|eddp-&gt;skb-&gt;data
op_plus
id|eddp-&gt;skb_offset
comma
id|len
comma
op_star
id|hcsum
)paren
suffix:semicolon
id|eddp-&gt;skb_offset
op_add_assign
id|len
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|eddp-&gt;frag
OL
l_int|0
)paren
(brace
multiline_comment|/* we&squot;re in skb-&gt;data */
id|left_in_frag
op_assign
id|qeth_get_skb_data_len
c_func
(paren
id|eddp-&gt;skb
)paren
op_minus
id|eddp-&gt;skb_offset
suffix:semicolon
id|src
op_assign
id|eddp-&gt;skb-&gt;data
op_plus
id|eddp-&gt;skb_offset
suffix:semicolon
)brace
r_else
(brace
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|eddp-&gt;skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|eddp-&gt;frag
)braket
suffix:semicolon
id|left_in_frag
op_assign
id|frag-&gt;size
op_minus
id|eddp-&gt;frag_offset
suffix:semicolon
id|src
op_assign
(paren
id|u8
op_star
)paren
(paren
(paren
id|page_to_pfn
c_func
(paren
id|frag-&gt;page
)paren
op_lshift
id|PAGE_SHIFT
)paren
op_plus
id|frag-&gt;page_offset
op_plus
id|eddp-&gt;frag_offset
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|left_in_frag
op_le
l_int|0
)paren
(brace
id|eddp-&gt;frag
op_increment
suffix:semicolon
id|eddp-&gt;frag_offset
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|copy_len
op_assign
id|min
c_func
(paren
id|left_in_frag
comma
id|len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dst
comma
id|src
comma
id|copy_len
)paren
suffix:semicolon
op_star
id|hcsum
op_assign
id|csum_partial
c_func
(paren
id|src
comma
id|copy_len
comma
op_star
id|hcsum
)paren
suffix:semicolon
id|dst
op_add_assign
id|copy_len
suffix:semicolon
id|eddp-&gt;frag_offset
op_add_assign
id|copy_len
suffix:semicolon
id|eddp-&gt;skb_offset
op_add_assign
id|copy_len
suffix:semicolon
id|len
op_sub_assign
id|copy_len
suffix:semicolon
)brace
)brace
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_create_segment_data_tcp
id|qeth_eddp_create_segment_data_tcp
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_struct
id|qeth_eddp_data
op_star
id|eddp
comma
r_int
id|data_len
comma
id|u32
id|hcsum
)paren
(brace
id|u8
op_star
id|page
suffix:semicolon
r_int
id|page_remainder
suffix:semicolon
r_int
id|page_offset
suffix:semicolon
r_struct
id|qeth_eddp_element
op_star
id|element
suffix:semicolon
r_int
id|first_lap
op_assign
l_int|1
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcsdt&quot;
)paren
suffix:semicolon
id|page
op_assign
id|ctx-&gt;pages
(braket
id|ctx-&gt;offset
op_rshift
id|PAGE_SHIFT
)braket
suffix:semicolon
id|page_offset
op_assign
id|ctx-&gt;offset
op_mod
id|PAGE_SIZE
suffix:semicolon
id|element
op_assign
op_amp
id|ctx-&gt;elements
(braket
id|ctx-&gt;num_elements
)braket
suffix:semicolon
r_while
c_loop
(paren
id|data_len
)paren
(brace
id|page_remainder
op_assign
id|PAGE_SIZE
op_minus
id|page_offset
suffix:semicolon
r_if
c_cond
(paren
id|page_remainder
OL
id|data_len
)paren
(brace
id|qeth_eddp_copy_data_tcp
c_func
(paren
id|page
op_plus
id|page_offset
comma
id|eddp
comma
id|page_remainder
comma
op_amp
id|hcsum
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|page_remainder
suffix:semicolon
r_if
c_cond
(paren
id|first_lap
)paren
id|element-&gt;flags
op_assign
id|SBAL_FLAGS_FIRST_FRAG
suffix:semicolon
r_else
id|element-&gt;flags
op_assign
id|SBAL_FLAGS_MIDDLE_FRAG
suffix:semicolon
id|ctx-&gt;num_elements
op_increment
suffix:semicolon
id|element
op_increment
suffix:semicolon
id|data_len
op_sub_assign
id|page_remainder
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|page_remainder
suffix:semicolon
id|page
op_assign
id|ctx-&gt;pages
(braket
id|ctx-&gt;offset
op_rshift
id|PAGE_SHIFT
)braket
suffix:semicolon
id|page_offset
op_assign
l_int|0
suffix:semicolon
id|element-&gt;addr
op_assign
id|page
op_plus
id|page_offset
suffix:semicolon
)brace
r_else
(brace
id|qeth_eddp_copy_data_tcp
c_func
(paren
id|page
op_plus
id|page_offset
comma
id|eddp
comma
id|data_len
comma
op_amp
id|hcsum
)paren
suffix:semicolon
id|element-&gt;length
op_add_assign
id|data_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first_lap
)paren
id|element-&gt;flags
op_assign
id|SBAL_FLAGS_LAST_FRAG
suffix:semicolon
id|ctx-&gt;num_elements
op_increment
suffix:semicolon
id|ctx-&gt;offset
op_add_assign
id|data_len
suffix:semicolon
id|data_len
op_assign
l_int|0
suffix:semicolon
)brace
id|first_lap
op_assign
l_int|0
suffix:semicolon
)brace
(paren
(paren
r_struct
id|tcphdr
op_star
)paren
id|eddp-&gt;th_in_ctx
)paren
op_member_access_from_pointer
id|check
op_assign
id|csum_fold
c_func
(paren
id|hcsum
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
DECL|function|qeth_eddp_check_tcp4_hdr
id|qeth_eddp_check_tcp4_hdr
c_func
(paren
r_struct
id|qeth_eddp_data
op_star
id|eddp
comma
r_int
id|data_len
)paren
(brace
id|u32
id|phcsum
suffix:semicolon
multiline_comment|/* pseudo header checksum */
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpckt4&quot;
)paren
suffix:semicolon
id|eddp-&gt;th.tcp.h.check
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* compute pseudo header checksum */
id|phcsum
op_assign
id|csum_tcpudp_nofold
c_func
(paren
id|eddp-&gt;nh.ip4.h.saddr
comma
id|eddp-&gt;nh.ip4.h.daddr
comma
id|eddp-&gt;thl
op_plus
id|data_len
comma
id|IPPROTO_TCP
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* compute checksum of tcp header */
r_return
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;th
comma
id|eddp-&gt;thl
comma
id|phcsum
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
DECL|function|qeth_eddp_check_tcp6_hdr
id|qeth_eddp_check_tcp6_hdr
c_func
(paren
r_struct
id|qeth_eddp_data
op_star
id|eddp
comma
r_int
id|data_len
)paren
(brace
id|u32
id|proto
suffix:semicolon
id|u32
id|phcsum
suffix:semicolon
multiline_comment|/* pseudo header checksum */
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpckt6&quot;
)paren
suffix:semicolon
id|eddp-&gt;th.tcp.h.check
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* compute pseudo header checksum */
id|phcsum
op_assign
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;nh.ip6.h.saddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
l_int|0
)paren
suffix:semicolon
id|phcsum
op_assign
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;nh.ip6.h.daddr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
comma
id|phcsum
)paren
suffix:semicolon
id|proto
op_assign
id|htonl
c_func
(paren
id|IPPROTO_TCP
)paren
suffix:semicolon
id|phcsum
op_assign
id|csum_partial
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|proto
comma
r_sizeof
(paren
id|u32
)paren
comma
id|phcsum
)paren
suffix:semicolon
r_return
id|phcsum
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|qeth_eddp_data
op_star
DECL|function|qeth_eddp_create_eddp_data
id|qeth_eddp_create_eddp_data
c_func
(paren
r_struct
id|qeth_hdr
op_star
id|qh
comma
id|u8
op_star
id|nh
comma
id|u8
id|nhl
comma
id|u8
op_star
id|th
comma
id|u8
id|thl
)paren
(brace
r_struct
id|qeth_eddp_data
op_star
id|eddp
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcrda&quot;
)paren
suffix:semicolon
id|eddp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_eddp_data
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eddp
)paren
(brace
id|memset
c_func
(paren
id|eddp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_eddp_data
)paren
)paren
suffix:semicolon
id|eddp-&gt;nhl
op_assign
id|nhl
suffix:semicolon
id|eddp-&gt;thl
op_assign
id|thl
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|eddp-&gt;qh
comma
id|qh
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|eddp-&gt;nh
comma
id|nh
comma
id|nhl
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|eddp-&gt;th
comma
id|th
comma
id|thl
)paren
suffix:semicolon
id|eddp-&gt;frag
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* initially we&squot;re in skb-&gt;data */
)brace
r_return
id|eddp
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__qeth_eddp_fill_context_tcp
id|__qeth_eddp_fill_context_tcp
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_struct
id|qeth_eddp_data
op_star
id|eddp
)paren
(brace
r_struct
id|tcphdr
op_star
id|tcph
suffix:semicolon
r_int
id|data_len
suffix:semicolon
id|u32
id|hcsum
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpftcp&quot;
)paren
suffix:semicolon
id|eddp-&gt;skb_offset
op_assign
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
op_plus
id|eddp-&gt;nhl
op_plus
id|eddp-&gt;thl
suffix:semicolon
id|tcph
op_assign
id|eddp-&gt;skb-&gt;h.th
suffix:semicolon
r_while
c_loop
(paren
id|eddp-&gt;skb_offset
OL
id|eddp-&gt;skb-&gt;len
)paren
(brace
id|data_len
op_assign
id|min
c_func
(paren
(paren
r_int
)paren
id|skb_shinfo
c_func
(paren
id|eddp-&gt;skb
)paren
op_member_access_from_pointer
id|tso_size
comma
(paren
r_int
)paren
(paren
id|eddp-&gt;skb-&gt;len
op_minus
id|eddp-&gt;skb_offset
)paren
)paren
suffix:semicolon
multiline_comment|/* prepare qdio hdr */
r_if
c_cond
(paren
id|eddp-&gt;qh.hdr.l2.id
op_eq
id|QETH_HEADER_TYPE_LAYER2
)paren
(brace
id|eddp-&gt;qh.hdr.l2.pkt_length
op_assign
id|data_len
op_plus
id|ETH_HLEN
op_plus
id|eddp-&gt;nhl
op_plus
id|eddp-&gt;thl
op_minus
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|eddp-&gt;mac.h_proto
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
)paren
id|eddp-&gt;qh.hdr.l2.pkt_length
op_add_assign
id|VLAN_HLEN
suffix:semicolon
macro_line|#endif /* CONFIG_QETH_VLAN */
)brace
r_else
id|eddp-&gt;qh.hdr.l3.length
op_assign
id|data_len
op_plus
id|eddp-&gt;nhl
op_plus
id|eddp-&gt;thl
suffix:semicolon
multiline_comment|/* prepare ip hdr */
r_if
c_cond
(paren
id|eddp-&gt;skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
(brace
id|eddp-&gt;nh.ip4.h.tot_len
op_assign
id|data_len
op_plus
id|eddp-&gt;nhl
op_plus
id|eddp-&gt;thl
suffix:semicolon
id|eddp-&gt;nh.ip4.h.check
op_assign
l_int|0
suffix:semicolon
id|eddp-&gt;nh.ip4.h.check
op_assign
id|ip_fast_csum
c_func
(paren
(paren
id|u8
op_star
)paren
op_amp
id|eddp-&gt;nh.ip4.h
comma
id|eddp-&gt;nh.ip4.h.ihl
)paren
suffix:semicolon
)brace
r_else
id|eddp-&gt;nh.ip6.h.payload_len
op_assign
id|data_len
op_plus
id|eddp-&gt;thl
suffix:semicolon
multiline_comment|/* prepare tcp hdr */
r_if
c_cond
(paren
id|data_len
op_eq
(paren
id|eddp-&gt;skb-&gt;len
op_minus
id|eddp-&gt;skb_offset
)paren
)paren
(brace
multiline_comment|/* last segment -&gt; set FIN and PSH flags */
id|eddp-&gt;th.tcp.h.fin
op_assign
id|tcph-&gt;fin
suffix:semicolon
id|eddp-&gt;th.tcp.h.psh
op_assign
id|tcph-&gt;psh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eddp-&gt;skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
id|hcsum
op_assign
id|qeth_eddp_check_tcp4_hdr
c_func
(paren
id|eddp
comma
id|data_len
)paren
suffix:semicolon
r_else
id|hcsum
op_assign
id|qeth_eddp_check_tcp6_hdr
c_func
(paren
id|eddp
comma
id|data_len
)paren
suffix:semicolon
multiline_comment|/* fill the next segment into the context */
id|qeth_eddp_create_segment_hdrs
c_func
(paren
id|ctx
comma
id|eddp
)paren
suffix:semicolon
id|qeth_eddp_create_segment_data_tcp
c_func
(paren
id|ctx
comma
id|eddp
comma
id|data_len
comma
id|hcsum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eddp-&gt;skb_offset
op_ge
id|eddp-&gt;skb-&gt;len
)paren
r_break
suffix:semicolon
multiline_comment|/* prepare headers for next round */
r_if
c_cond
(paren
id|eddp-&gt;skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
id|eddp-&gt;nh.ip4.h.id
op_increment
suffix:semicolon
id|eddp-&gt;th.tcp.h.seq
op_add_assign
id|data_len
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|qeth_eddp_fill_context_tcp
id|qeth_eddp_fill_context_tcp
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|qhdr
)paren
(brace
r_struct
id|qeth_eddp_data
op_star
id|eddp
op_assign
l_int|NULL
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpficx&quot;
)paren
suffix:semicolon
multiline_comment|/* create our segmentation headers and copy original headers */
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
id|eddp
op_assign
id|qeth_eddp_create_eddp_data
c_func
(paren
id|qhdr
comma
(paren
id|u8
op_star
)paren
id|skb-&gt;nh.iph
comma
id|skb-&gt;nh.iph-&gt;ihl
op_star
l_int|4
comma
(paren
id|u8
op_star
)paren
id|skb-&gt;h.th
comma
id|skb-&gt;h.th-&gt;doff
op_star
l_int|4
)paren
suffix:semicolon
r_else
id|eddp
op_assign
id|qeth_eddp_create_eddp_data
c_func
(paren
id|qhdr
comma
(paren
id|u8
op_star
)paren
id|skb-&gt;nh.ipv6h
comma
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
comma
(paren
id|u8
op_star
)paren
id|skb-&gt;h.th
comma
id|skb-&gt;h.th-&gt;doff
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eddp
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;eddpfcnm&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qhdr-&gt;hdr.l2.id
op_eq
id|QETH_HEADER_TYPE_LAYER2
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|eddp-&gt;mac
comma
id|eth_hdr
c_func
(paren
id|skb
)paren
comma
id|ETH_HLEN
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QETH_VLAN
r_if
c_cond
(paren
id|eddp-&gt;mac.h_proto
op_eq
id|__constant_htons
c_func
(paren
id|ETH_P_8021Q
)paren
)paren
(brace
id|eddp-&gt;vlan
(braket
l_int|0
)braket
op_assign
id|__constant_htons
c_func
(paren
id|skb-&gt;protocol
)paren
suffix:semicolon
id|eddp-&gt;vlan
(braket
l_int|1
)braket
op_assign
id|htons
c_func
(paren
id|vlan_tx_tag_get
c_func
(paren
id|skb
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_QETH_VLAN */
)brace
multiline_comment|/* the next flags will only be set on the last segment */
id|eddp-&gt;th.tcp.h.fin
op_assign
l_int|0
suffix:semicolon
id|eddp-&gt;th.tcp.h.psh
op_assign
l_int|0
suffix:semicolon
id|eddp-&gt;skb
op_assign
id|skb
suffix:semicolon
multiline_comment|/* begin segmentation and fill context */
id|__qeth_eddp_fill_context_tcp
c_func
(paren
id|ctx
comma
id|eddp
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|eddp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qeth_eddp_calc_num_pages
id|qeth_eddp_calc_num_pages
c_func
(paren
r_struct
id|qeth_eddp_context
op_star
id|ctx
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|hdr_len
)paren
(brace
r_int
id|skbs_per_page
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;eddpcanp&quot;
)paren
suffix:semicolon
multiline_comment|/* can we put multiple skbs in one page? */
id|skbs_per_page
op_assign
id|PAGE_SIZE
op_div
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|tso_size
op_plus
id|hdr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skbs_per_page
OG
l_int|1
)paren
(brace
id|ctx-&gt;num_pages
op_assign
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|tso_segs
op_plus
l_int|1
)paren
op_div
id|skbs_per_page
op_plus
l_int|1
suffix:semicolon
id|ctx-&gt;elements_per_skb
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* no -&gt; how many elements per skb? */
id|ctx-&gt;elements_per_skb
op_assign
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|tso_size
op_plus
id|hdr_len
op_plus
id|PAGE_SIZE
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|ctx-&gt;num_pages
op_assign
id|ctx-&gt;elements_per_skb
op_star
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|tso_segs
op_plus
l_int|1
)paren
suffix:semicolon
)brace
id|ctx-&gt;num_elements
op_assign
id|ctx-&gt;elements_per_skb
op_star
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|tso_segs
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|qeth_eddp_context
op_star
DECL|function|qeth_eddp_create_context_generic
id|qeth_eddp_create_context_generic
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|hdr_len
)paren
(brace
r_struct
id|qeth_eddp_context
op_star
id|ctx
op_assign
l_int|NULL
suffix:semicolon
id|u8
op_star
id|addr
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;creddpcg&quot;
)paren
suffix:semicolon
multiline_comment|/* create the context and allocate pages */
id|ctx
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qeth_eddp_context
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddpcn1&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ctx
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qeth_eddp_context
)paren
)paren
suffix:semicolon
id|ctx-&gt;type
op_assign
id|QETH_LARGE_SEND_EDDP
suffix:semicolon
id|qeth_eddp_calc_num_pages
c_func
(paren
id|ctx
comma
id|skb
comma
id|hdr_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;elements_per_skb
OG
id|QETH_MAX_BUFFER_ELEMENTS
c_func
(paren
id|card
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddpcis&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ctx-&gt;pages
op_assign
id|kmalloc
c_func
(paren
id|ctx-&gt;num_pages
op_star
r_sizeof
(paren
id|u8
op_star
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;pages
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddpcn2&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ctx-&gt;pages
comma
l_int|0
comma
id|ctx-&gt;num_pages
op_star
r_sizeof
(paren
id|u8
op_star
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ctx-&gt;num_pages
suffix:semicolon
op_increment
id|i
)paren
(brace
id|addr
op_assign
(paren
id|u8
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddpcn3&quot;
)paren
suffix:semicolon
id|ctx-&gt;num_pages
op_assign
id|i
suffix:semicolon
id|qeth_eddp_free_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|addr
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|ctx-&gt;pages
(braket
id|i
)braket
op_assign
id|addr
suffix:semicolon
)brace
id|ctx-&gt;elements
op_assign
id|kmalloc
c_func
(paren
id|ctx-&gt;num_elements
op_star
r_sizeof
(paren
r_struct
id|qeth_eddp_element
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;elements
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddpcn4&quot;
)paren
suffix:semicolon
id|qeth_eddp_free_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ctx-&gt;elements
comma
l_int|0
comma
id|ctx-&gt;num_elements
op_star
r_sizeof
(paren
r_struct
id|qeth_eddp_element
)paren
)paren
suffix:semicolon
multiline_comment|/* reset num_elements; will be incremented again in fill_buffer to&n;&t; * reflect number of actually used elements */
id|ctx-&gt;num_elements
op_assign
l_int|0
suffix:semicolon
r_return
id|ctx
suffix:semicolon
)brace
r_static
r_inline
r_struct
id|qeth_eddp_context
op_star
DECL|function|qeth_eddp_create_context_tcp
id|qeth_eddp_create_context_tcp
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|qhdr
)paren
(brace
r_struct
id|qeth_eddp_context
op_star
id|ctx
op_assign
l_int|NULL
suffix:semicolon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;creddpct&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ETH_P_IP
)paren
id|ctx
op_assign
id|qeth_eddp_create_context_generic
c_func
(paren
id|card
comma
id|skb
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
op_plus
id|skb-&gt;nh.iph-&gt;ihl
op_star
l_int|4
op_plus
id|skb-&gt;h.th-&gt;doff
op_star
l_int|4
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;protocol
op_eq
id|ETH_P_IPV6
)paren
id|ctx
op_assign
id|qeth_eddp_create_context_generic
c_func
(paren
id|card
comma
id|skb
comma
r_sizeof
(paren
r_struct
id|qeth_hdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|ipv6hdr
)paren
op_plus
id|skb-&gt;h.th-&gt;doff
op_star
l_int|4
)paren
suffix:semicolon
r_else
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;cetcpinv&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx
op_eq
l_int|NULL
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;creddpnl&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qeth_eddp_fill_context_tcp
c_func
(paren
id|ctx
comma
id|skb
comma
id|qhdr
)paren
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;ceddptfe&quot;
)paren
suffix:semicolon
id|qeth_eddp_free_context
c_func
(paren
id|ctx
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|ctx-&gt;refcnt
comma
l_int|1
)paren
suffix:semicolon
r_return
id|ctx
suffix:semicolon
)brace
r_struct
id|qeth_eddp_context
op_star
DECL|function|qeth_eddp_create_context
id|qeth_eddp_create_context
c_func
(paren
r_struct
id|qeth_card
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|qeth_hdr
op_star
id|qhdr
)paren
(brace
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|5
comma
l_string|&quot;creddpc&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|skb-&gt;sk-&gt;sk_protocol
)paren
(brace
r_case
id|IPPROTO_TCP
suffix:colon
r_return
id|qeth_eddp_create_context_tcp
c_func
(paren
id|card
comma
id|skb
comma
id|qhdr
)paren
suffix:semicolon
r_default
suffix:colon
id|QETH_DBF_TEXT
c_func
(paren
id|trace
comma
l_int|2
comma
l_string|&quot;eddpinvp&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
eof
