multiline_comment|/*&n; *&n; * linux/drivers/s390/qdio.c&n; *&n; * Linux for S/390 QDIO base support, Hipersocket base support&n; * version 2&n; *&n; * Copyright 2000,2002 IBM Corporation&n; * Author(s): Utz Bacher &lt;utz.bacher@de.ibm.com&gt;&n; *&n; * Restriction: only 63 iqdio subchannels would have its own indicator,&n; * after that, subsequent subchannels share one indicator&n; *&n; *&n; *&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
multiline_comment|/* we want the eyecatcher to be at the top of the code */
DECL|function|qdio_eyecatcher
r_void
r_volatile
id|qdio_eyecatcher
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/debug.h&gt;
macro_line|#include &lt;asm/qdio.h&gt;
DECL|macro|VERSION_QDIO_C
mdefine_line|#define VERSION_QDIO_C &quot;$Revision: 1.122 $&quot;
multiline_comment|/****************** MODULE PARAMETER VARIABLES ********************/
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Utz Bacher &lt;utz.bacher@de.ibm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;QDIO base support version 2, &quot;
"&bslash;"
l_string|&quot;Copyright 2000 IBM Corporation&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/******************** HERE WE GO ***********************************/
DECL|variable|version
r_static
r_const
r_char
op_star
id|version
op_assign
l_string|&quot;QDIO base support version 2 (&quot;
id|VERSION_QDIO_C
l_string|&quot;/&quot;
id|VERSION_QDIO_H
l_string|&quot;)&quot;
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
DECL|variable|proc_perf_file_registration
r_static
r_int
id|proc_perf_file_registration
suffix:semicolon
DECL|variable|i_p_c
DECL|variable|i_p_nc
DECL|variable|o_p_c
DECL|variable|o_p_nc
DECL|variable|ii_p_c
DECL|variable|ii_p_nc
r_static
r_int
r_int
id|i_p_c
op_assign
l_int|0
comma
id|i_p_nc
op_assign
l_int|0
comma
id|o_p_c
op_assign
l_int|0
comma
id|o_p_nc
op_assign
l_int|0
comma
id|ii_p_c
op_assign
l_int|0
comma
id|ii_p_nc
op_assign
l_int|0
suffix:semicolon
r_static
r_struct
(brace
DECL|member|tl_runs
r_int
r_int
id|tl_runs
suffix:semicolon
DECL|member|siga_outs
r_int
r_int
id|siga_outs
suffix:semicolon
DECL|member|siga_ins
r_int
r_int
id|siga_ins
suffix:semicolon
DECL|member|siga_syncs
r_int
r_int
id|siga_syncs
suffix:semicolon
DECL|member|pcis
r_int
r_int
id|pcis
suffix:semicolon
DECL|member|thinints
r_int
r_int
id|thinints
suffix:semicolon
DECL|member|fast_reqs
r_int
r_int
id|fast_reqs
suffix:semicolon
DECL|member|start_time_outbound
id|__u64
id|start_time_outbound
suffix:semicolon
DECL|member|outbound_cnt
r_int
r_int
id|outbound_cnt
suffix:semicolon
DECL|member|outbound_time
r_int
r_int
id|outbound_time
suffix:semicolon
DECL|member|start_time_inbound
id|__u64
id|start_time_inbound
suffix:semicolon
DECL|member|inbound_cnt
r_int
r_int
id|inbound_cnt
suffix:semicolon
DECL|member|inbound_time
r_int
r_int
id|inbound_time
suffix:semicolon
DECL|variable|perf_stats
)brace
id|perf_stats
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
DECL|variable|indicator_used
r_static
r_int
id|indicator_used
(braket
id|INDICATORS_PER_CACHELINE
)braket
suffix:semicolon
DECL|variable|indicators
r_static
id|__u32
op_star
r_volatile
id|indicators
suffix:semicolon
DECL|variable|spare_indicator
r_static
id|__u32
r_volatile
id|spare_indicator
suffix:semicolon
DECL|variable|qdio_dbf_setup
r_static
id|debug_info_t
op_star
id|qdio_dbf_setup
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qdio_dbf_sbal
r_static
id|debug_info_t
op_star
id|qdio_dbf_sbal
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qdio_dbf_trace
r_static
id|debug_info_t
op_star
id|qdio_dbf_trace
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qdio_dbf_sense
r_static
id|debug_info_t
op_star
id|qdio_dbf_sense
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
DECL|variable|qdio_dbf_slsb_out
r_static
id|debug_info_t
op_star
id|qdio_dbf_slsb_out
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|qdio_dbf_slsb_in
r_static
id|debug_info_t
op_star
id|qdio_dbf_slsb_in
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
DECL|variable|first_irq
r_static
id|qdio_irq_t
op_star
id|first_irq
(braket
id|QDIO_IRQ_BUCKETS
)braket
suffix:semicolon
DECL|variable|irq_list_lock
r_static
id|rwlock_t
id|irq_list_lock
(braket
id|QDIO_IRQ_BUCKETS
)braket
op_assign
initialization_block
suffix:semicolon
DECL|variable|init_sema
r_static
r_struct
id|semaphore
id|init_sema
suffix:semicolon
DECL|variable|chsc_area
r_static
id|qdio_chsc_area_t
op_star
id|chsc_area
suffix:semicolon
multiline_comment|/* iQDIO stuff: */
DECL|variable|iq_list
r_static
r_volatile
id|qdio_q_t
op_star
id|iq_list
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* volatile as it could change&n;&t;&t;&t;&t;&t;   during a while loop */
DECL|variable|iq_list_lock
r_static
id|spinlock_t
id|iq_list_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|register_thinint_result
r_static
r_int
id|register_thinint_result
suffix:semicolon
r_static
r_void
id|iqdio_tl
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
id|DECLARE_TASKLET
c_func
(paren
id|iqdio_tasklet
comma
id|iqdio_tl
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|HEXDUMP16
mdefine_line|#define HEXDUMP16(importance,header,ptr) &bslash;&n;QDIO_PRINT_##importance(header &quot;%02x %02x %02x %02x  &quot; &bslash;&n;&t;&t;&t;&quot;%02x %02x %02x %02x  %02x %02x %02x %02x  &quot; &bslash;&n;&t;&t;&t;&quot;%02x %02x %02x %02x&bslash;n&quot;,*(((char*)ptr)), &bslash;&n;&t;&t;&t;*(((char*)ptr)+1),*(((char*)ptr)+2), &bslash;&n;&t;&t;&t;*(((char*)ptr)+3),*(((char*)ptr)+4), &bslash;&n;&t;&t;&t;*(((char*)ptr)+5),*(((char*)ptr)+6), &bslash;&n;&t;&t;&t;*(((char*)ptr)+7),*(((char*)ptr)+8), &bslash;&n;&t;&t;&t;*(((char*)ptr)+9),*(((char*)ptr)+10), &bslash;&n;&t;&t;&t;*(((char*)ptr)+11),*(((char*)ptr)+12), &bslash;&n;&t;&t;&t;*(((char*)ptr)+13),*(((char*)ptr)+14), &bslash;&n;&t;&t;&t;*(((char*)ptr)+15)); &bslash;&n;QDIO_PRINT_##importance(header &quot;%02x %02x %02x %02x  %02x %02x %02x %02x  &quot; &bslash;&n;&t;&t;&t;&quot;%02x %02x %02x %02x  %02x %02x %02x %02x&bslash;n&quot;, &bslash;&n;&t;&t;&t;*(((char*)ptr)+16),*(((char*)ptr)+17), &bslash;&n;&t;&t;&t;*(((char*)ptr)+18),*(((char*)ptr)+19), &bslash;&n;&t;&t;&t;*(((char*)ptr)+20),*(((char*)ptr)+21), &bslash;&n;&t;&t;&t;*(((char*)ptr)+22),*(((char*)ptr)+23), &bslash;&n;&t;&t;&t;*(((char*)ptr)+24),*(((char*)ptr)+25), &bslash;&n;&t;&t;&t;*(((char*)ptr)+26),*(((char*)ptr)+27), &bslash;&n;&t;&t;&t;*(((char*)ptr)+28),*(((char*)ptr)+29), &bslash;&n;&t;&t;&t;*(((char*)ptr)+30),*(((char*)ptr)+31));
DECL|macro|atomic_swap
mdefine_line|#define atomic_swap(a,b) xchg((int*)a.counter,b)
multiline_comment|/* not a macro, as one of the arguments is atomic_read */
DECL|function|qdio_min
r_static
r_inline
r_int
id|qdio_min
c_func
(paren
r_int
id|a
comma
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|a
OL
id|b
)paren
r_return
id|a
suffix:semicolon
r_else
r_return
id|b
suffix:semicolon
)brace
DECL|macro|SYNC_MEMORY
mdefine_line|#define SYNC_MEMORY if (q-&gt;siga_sync) qdio_siga_sync(q)
DECL|macro|NOW
mdefine_line|#define NOW qdio_get_micros()
DECL|macro|SAVE_TIMESTAMP
mdefine_line|#define SAVE_TIMESTAMP(q) q-&gt;timing.last_transfer_time=NOW
DECL|macro|GET_SAVED_TIMESTAMP
mdefine_line|#define GET_SAVED_TIMESTAMP(q) (q-&gt;timing.last_transfer_time)
DECL|macro|SAVE_FRONTIER
mdefine_line|#define SAVE_FRONTIER(q,val) q-&gt;last_move_ftc=val
DECL|macro|GET_SAVED_FRONTIER
mdefine_line|#define GET_SAVED_FRONTIER(q) (q-&gt;last_move_ftc)
DECL|macro|MY_MODULE_STRING
mdefine_line|#define MY_MODULE_STRING(x) #x
macro_line|#ifdef QDIO_DBF_LIKE_HELL
DECL|macro|my_spin_lock
mdefine_line|#define my_spin_lock(x) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;&t;QDIO_DBF_TEXT6(0,trace,&quot;sp_lck&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;spin_lock(x); &bslash;&n;} while (0)
DECL|macro|my_spin_unlock
mdefine_line|#define my_spin_unlock(x) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;&t;QDIO_DBF_TEXT6(0,trace,&quot;sp_unlck&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;spin_unlock(x); &bslash;&n;} while (0)
DECL|macro|my_spin_lock_irqsave
mdefine_line|#define my_spin_lock_irqsave(x,y) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;&t;QDIO_DBF_TEXT6(0,trace,&quot;sp_lck_i&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;spin_lock_irqsave(x,y); &bslash;&n;} while (0)
DECL|macro|my_spin_unlock_irqrestore
mdefine_line|#define my_spin_unlock_irqrestore(x,y) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;        QDIO_DBF_TEXT6(0,trace,&quot;sp_nlk_i&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;spin_unlock_irqrestore(x,y); &bslash;&n;} while (0)
DECL|macro|my_s390irq_spin_lock_irqsave
mdefine_line|#define my_s390irq_spin_lock_irqsave(x,y) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;&t;QDIO_DBF_TEXT6(0,trace,&quot;sp_lck3i&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;s390irq_spin_lock_irqsave(x,y); &bslash;&n;} while (0)
DECL|macro|my_s390irq_spin_unlock_irqrestore
mdefine_line|#define my_s390irq_spin_unlock_irqrestore(x,y) do { &bslash;&n;&t;void *ptr=x; &bslash;&n;        QDIO_DBF_TEXT6(0,trace,&quot;sp_nlk3i&quot;); &bslash;&n;&t;QDIO_DBF_HEX6(0,trace,&amp;ptr,sizeof(void*)); &bslash;&n;&t;s390irq_spin_unlock_irqrestore(x,y); &bslash;&n;} while (0)
macro_line|#else /* QDIO_DBF_LIKE_HELL */
DECL|macro|my_spin_lock
mdefine_line|#define my_spin_lock(x) spin_lock(x)
DECL|macro|my_spin_unlock
mdefine_line|#define my_spin_unlock(x) spin_unlock(x)
DECL|macro|my_spin_lock_irqsave
mdefine_line|#define my_spin_lock_irqsave(x,y) spin_lock_irqsave(x,y)
DECL|macro|my_spin_unlock_irqrestore
mdefine_line|#define my_spin_unlock_irqrestore(x,y) spin_unlock_irqrestore(x,y)
DECL|macro|my_s390irq_spin_lock_irqsave
mdefine_line|#define my_s390irq_spin_lock_irqsave(x,y) s390irq_spin_lock_irqsave(x,y)
DECL|macro|my_s390irq_spin_unlock_irqrestore
mdefine_line|#define my_s390irq_spin_unlock_irqrestore(x,y) s390irq_spin_unlock_irqrestore(x,y)
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_32_BIT
DECL|macro|QDIO_GET_ADDR
mdefine_line|#define QDIO_GET_ADDR(x) ((__u32)(long)x)
macro_line|#else /* QDIO_32_BIT */
DECL|macro|QDIO_GET_ADDR
mdefine_line|#define QDIO_GET_ADDR(x) ((__u32)(unsigned long)x)
macro_line|#endif /* QDIO_32_BIT */
multiline_comment|/***************** SCRUBBER HELPER ROUTINES **********************/
DECL|function|qdio_get_micros
r_static
r_inline
r_volatile
id|__u64
id|qdio_get_micros
c_func
(paren
r_void
)paren
(brace
id|__u64
id|time
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;STCK %0&quot;
suffix:colon
l_string|&quot;=m&quot;
(paren
id|time
)paren
)paren
suffix:semicolon
r_return
id|time
op_rshift
l_int|12
suffix:semicolon
multiline_comment|/* time&gt;&gt;12 is microseconds*/
)brace
DECL|function|qdio_get_millis
r_static
r_inline
r_int
r_int
id|qdio_get_millis
c_func
(paren
r_void
)paren
(brace
r_return
(paren
r_int
r_int
)paren
(paren
id|qdio_get_micros
c_func
(paren
)paren
op_rshift
l_int|12
)paren
suffix:semicolon
)brace
DECL|function|atomic_return_add
r_static
id|__inline__
r_int
id|atomic_return_add
(paren
r_int
id|i
comma
id|atomic_t
op_star
id|v
)paren
(brace
r_int
id|old
comma
r_new
suffix:semicolon
id|__CS_LOOP
c_func
(paren
id|old
comma
r_new
comma
id|v
comma
id|i
comma
l_string|&quot;ar&quot;
)paren
suffix:semicolon
r_return
id|old
suffix:semicolon
)brace
DECL|function|qdio_wait_nonbusy
r_static
r_void
id|qdio_wait_nonbusy
c_func
(paren
r_int
r_int
id|timeout
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;wtnb%4x&quot;
comma
id|timeout
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|start
op_assign
id|qdio_get_millis
c_func
(paren
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_task_state
c_func
(paren
id|current
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_get_millis
c_func
(paren
)paren
op_minus
id|start
OG
id|timeout
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
(paren
id|start
op_plus
id|timeout
op_minus
id|qdio_get_millis
c_func
(paren
)paren
)paren
op_rshift
l_int|10
)paren
op_star
id|HZ
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|set_task_state
c_func
(paren
id|current
comma
id|TASK_RUNNING
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|qdio_wait_for_no_use_count
r_static
r_int
id|qdio_wait_for_no_use_count
c_func
(paren
id|atomic_t
op_star
id|use_count
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;wtnousec&quot;
)paren
suffix:semicolon
id|start
op_assign
id|qdio_get_millis
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|qdio_get_millis
c_func
(paren
)paren
op_minus
id|start
OG
id|QDIO_NO_USE_COUNT_TIMEOUT
)paren
(brace
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;WTNOUSTO&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ETIME
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
id|use_count
)paren
)paren
(brace
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;wtnoused&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|qdio_wait_nonbusy
c_func
(paren
id|QDIO_NO_USE_COUNT_TIME
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* unfortunately, we can&squot;t just xchg the values; in do_QDIO we want to reserve&n; * the q in any case, so that we&squot;ll not be interrupted when we are in&n; * qdio_mark_iq... shouldn&squot;t have a really bad impact, as reserving almost&n; * ever works (last famous words) */
DECL|function|qdio_reserve_q
r_static
r_inline
r_int
id|qdio_reserve_q
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_return
id|atomic_return_add
c_func
(paren
l_int|1
comma
op_amp
id|q-&gt;use_count
)paren
suffix:semicolon
)brace
DECL|function|qdio_release_q
r_static
r_inline
r_void
id|qdio_release_q
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;use_count
)paren
suffix:semicolon
)brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL 
DECL|macro|set_slsb
mdefine_line|#define set_slsb(x,y) &bslash;&n;  if(q-&gt;queue_type==QDIO_TRACE_QTYPE) { &bslash;&n;        if(q-&gt;is_input_q) { &bslash;&n;            QDIO_DBF_HEX2(0,slsb_in,&amp;q-&gt;slsb,QDIO_MAX_BUFFERS_PER_Q); &bslash;&n;        } else { &bslash;&n;            QDIO_DBF_HEX2(0,slsb_out,&amp;q-&gt;slsb,QDIO_MAX_BUFFERS_PER_Q); &bslash;&n;        } &bslash;&n;  } &bslash;&n;  qdio_set_slsb(x,y); &bslash;&n;  if(q-&gt;queue_type==QDIO_TRACE_QTYPE) { &bslash;&n;        if(q-&gt;is_input_q) { &bslash;&n;            QDIO_DBF_HEX2(0,slsb_in,&amp;q-&gt;slsb,QDIO_MAX_BUFFERS_PER_Q); &bslash;&n;        } else { &bslash;&n;            QDIO_DBF_HEX2(0,slsb_out,&amp;q-&gt;slsb,QDIO_MAX_BUFFERS_PER_Q); &bslash;&n;        } &bslash;&n;  }
macro_line|#else /* QDIO_DBF_LIKE_HELL */
DECL|macro|set_slsb
mdefine_line|#define set_slsb(x,y) qdio_set_slsb(x,y)
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
DECL|function|qdio_set_slsb
r_static
r_volatile
r_inline
r_void
id|qdio_set_slsb
c_func
(paren
r_volatile
r_char
op_star
id|slsb
comma
r_int
r_char
id|value
)paren
(brace
id|xchg
c_func
(paren
(paren
r_char
op_star
)paren
id|slsb
comma
id|value
)paren
suffix:semicolon
)brace
DECL|function|qdio_siga_sync
r_static
r_inline
r_int
id|qdio_siga_sync
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
r_int
id|gpr2
comma
id|gpr3
suffix:semicolon
r_int
id|cc
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigasync&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_syncs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
id|q-&gt;is_input_q
)paren
(brace
id|gpr2
op_assign
l_int|0
suffix:semicolon
id|gpr3
op_assign
id|q-&gt;mask
suffix:semicolon
)brace
r_else
(brace
id|gpr2
op_assign
id|q-&gt;mask
suffix:semicolon
id|gpr3
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef QDIO_32_BIT
id|asm
r_volatile
(paren
l_string|&quot;lhi&t;0,2&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;3,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr2
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr3
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#else /* QDIO_32_BIT */
id|asm
r_volatile
(paren
l_string|&quot;lghi&t;0,2&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;3,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr2
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr3
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_32_BIT */
r_if
c_cond
(paren
id|cc
)paren
(brace
macro_line|#ifndef QDIO_DBF_LIKE_HELL
multiline_comment|/* when QDIO_DBF_LIKE_HELL, we put that already out */
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigasync&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
)brace
r_return
id|cc
suffix:semicolon
)brace
multiline_comment|/* returns QDIO_SIGA_ERROR_ACCESS_EXCEPTION as cc, when SIGA returns&n;   an access exception */
DECL|function|qdio_siga_output
r_static
r_inline
r_int
id|qdio_siga_output
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|cc
suffix:semicolon
id|__u32
id|busy_bit
suffix:semicolon
id|__u64
id|start_time
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_outs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigaout&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
macro_line|#ifdef QDIO_32_BIT
id|asm
r_volatile
(paren
l_string|&quot;lhi&t;0,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;1,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;2,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga&t;0&t;&bslash;n&bslash;t&quot;
l_string|&quot;0:&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;0,31&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;%1,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;1:&t;&bslash;n&bslash;t&quot;
l_string|&quot;.section .fixup,&bslash;&quot;ax&bslash;&quot;&bslash;n&bslash;t&quot;
l_string|&quot;2:&t;&bslash;n&bslash;t&quot;
l_string|&quot;lhi&t;%0,%4&t;&bslash;n&bslash;t&quot;
l_string|&quot;bras&t;1,3f&t;&bslash;n&bslash;t&quot;
l_string|&quot;.long 1b&t;&bslash;n&bslash;t&quot;
l_string|&quot;3:&t;&bslash;n&bslash;t&quot;
l_string|&quot;l&t;1,0(1)&t;&bslash;n&bslash;t&quot;
l_string|&quot;br&t;1&t;&bslash;n&bslash;t&quot;
l_string|&quot;.previous&t;&bslash;n&bslash;t&quot;
l_string|&quot;.section __ex_table,&bslash;&quot;a&bslash;&quot;&bslash;n&bslash;t&quot;
l_string|&quot;.align 4&t;&bslash;n&bslash;t&quot;
l_string|&quot;.long&t;0b,2b&t;&bslash;n&bslash;t&quot;
l_string|&quot;.previous&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
comma
l_string|&quot;=d&quot;
(paren
id|busy_bit
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|q-&gt;mask
)paren
comma
l_string|&quot;i&quot;
(paren
id|QDIO_SIGA_ERROR_ACCESS_EXCEPTION
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
macro_line|#else /* QDIO_32_BIT */
id|asm
r_volatile
(paren
l_string|&quot;lghi&t;0,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;1,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;2,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga&t;0&t;&bslash;n&bslash;t&quot;
l_string|&quot;0:&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;0,31&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;%1,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;1:&t;&bslash;n&bslash;t&quot;
l_string|&quot;.section .fixup,&bslash;&quot;ax&bslash;&quot;&bslash;n&bslash;t&quot;
l_string|&quot;lghi&t;%0,%4&t;&bslash;n&bslash;t&quot;
l_string|&quot;jg&t;1b&t;&bslash;n&bslash;t&quot;
l_string|&quot;.previous&bslash;n&bslash;t&quot;
l_string|&quot;.section __ex_table,&bslash;&quot;a&bslash;&quot;&bslash;n&bslash;t&quot;
l_string|&quot;.align 8&t;&bslash;n&bslash;t&quot;
l_string|&quot;.quad&t;0b,1b&t;&bslash;n&bslash;t&quot;
l_string|&quot;.previous&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
comma
l_string|&quot;=d&quot;
(paren
id|busy_bit
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|q-&gt;mask
)paren
comma
l_string|&quot;i&quot;
(paren
id|QDIO_SIGA_ERROR_ACCESS_EXCEPTION
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_32_BIT */
singleline_comment|//QDIO_PRINT_ERR(&quot;cc=%x, busy=%x&bslash;n&quot;,cc,busy_bit);
r_if
c_cond
(paren
(paren
id|cc
op_eq
l_int|2
)paren
op_logical_and
(paren
id|busy_bit
)paren
op_logical_and
(paren
id|q-&gt;is_iqdio_q
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|start_time
)paren
id|start_time
op_assign
id|NOW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NOW
op_minus
id|start_time
)paren
OG
id|QDIO_BUSY_BIT_PATIENCE
)paren
r_break
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cc
op_eq
l_int|2
)paren
op_logical_and
(paren
id|busy_bit
)paren
)paren
id|cc
op_or_assign
id|QDIO_SIGA_ERROR_B_BIT_SET
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
(brace
macro_line|#ifndef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigaout&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
)brace
r_return
id|cc
suffix:semicolon
)brace
DECL|function|qdio_siga_input
r_static
r_inline
r_int
id|qdio_siga_input
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|cc
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigain&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_ins
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
macro_line|#ifdef QDIO_32_BIT
id|asm
r_volatile
(paren
l_string|&quot;lhi&t;0,1&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|q-&gt;mask
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
macro_line|#else /* QDIO_32_BIT */
id|asm
r_volatile
(paren
l_string|&quot;lghi&t;0,1&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|q-&gt;mask
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;memory&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_32_BIT */
r_if
c_cond
(paren
id|cc
)paren
(brace
macro_line|#ifndef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigain&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
)brace
r_return
id|cc
suffix:semicolon
)brace
multiline_comment|/* locked by the locks in qdio_activate and qdio_cleanup */
DECL|function|qdio_get_indicator
r_static
id|__u32
op_star
r_volatile
id|qdio_get_indicator
c_func
(paren
r_void
)paren
(brace
r_int
id|i
op_assign
l_int|1
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|INDICATORS_PER_CACHELINE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|indicator_used
(braket
id|i
)braket
)paren
(brace
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
)paren
r_return
id|indicators
op_plus
id|i
suffix:semicolon
r_else
r_return
(paren
id|__u32
op_star
r_volatile
)paren
op_amp
id|spare_indicator
suffix:semicolon
)brace
multiline_comment|/* locked by the locks in qdio_activate and qdio_cleanup */
DECL|function|qdio_put_indicator
r_static
r_void
id|qdio_put_indicator
c_func
(paren
id|__u32
op_star
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
)paren
op_logical_and
(paren
id|addr
op_ne
op_amp
id|spare_indicator
)paren
)paren
(brace
id|i
op_assign
id|addr
op_minus
id|indicators
suffix:semicolon
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|iqdio_clear_summary_bit
r_static
r_inline
r_volatile
r_void
id|iqdio_clear_summary_bit
c_func
(paren
id|__u32
op_star
id|location
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;clrsummb&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|location
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|xchg
c_func
(paren
id|location
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|iqdio_set_summary_bit
r_static
r_inline
r_volatile
r_void
id|iqdio_set_summary_bit
c_func
(paren
id|__u32
op_star
id|location
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;setsummb&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|location
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|xchg
c_func
(paren
id|location
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|iqdio_sched_tl
r_static
r_inline
r_void
id|iqdio_sched_tl
c_func
(paren
r_void
)paren
(brace
id|tasklet_hi_schedule
c_func
(paren
op_amp
id|iqdio_tasklet
)paren
suffix:semicolon
)brace
DECL|function|qdio_mark_iq
r_static
r_inline
r_void
id|qdio_mark_iq
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;mark iq&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|my_spin_lock_irqsave
c_func
(paren
op_amp
id|iq_list_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;is_input_q
)paren
(brace
r_if
c_cond
(paren
(paren
id|q-&gt;list_prev
)paren
op_logical_or
(paren
id|q-&gt;list_next
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iq_list
)paren
(brace
id|iq_list
op_assign
id|q
suffix:semicolon
id|q-&gt;list_prev
op_assign
id|q
suffix:semicolon
id|q-&gt;list_next
op_assign
id|q
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;list_next
op_assign
id|iq_list
suffix:semicolon
id|q-&gt;list_prev
op_assign
id|iq_list-&gt;list_prev
suffix:semicolon
id|iq_list-&gt;list_prev-&gt;list_next
op_assign
id|q
suffix:semicolon
id|iq_list-&gt;list_prev
op_assign
id|q
suffix:semicolon
)brace
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|iq_list_lock
comma
id|flags
)paren
suffix:semicolon
id|iqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
id|out_unlock
suffix:colon
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|iq_list_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|qdio_mark_q
r_static
r_inline
r_void
id|qdio_mark_q
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;mark q&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
r_return
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|q-&gt;tasklet
)paren
suffix:semicolon
)brace
DECL|function|qdio_stop_polling
r_static
r_inline
r_int
id|qdio_stop_polling
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_int
id|gsf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_swap
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|0
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;stoppoll&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
multiline_comment|/* show the card that we are not polling anymore */
r_if
c_cond
(paren
id|q-&gt;is_input_q
)paren
(brace
id|gsf
op_assign
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
suffix:semicolon
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
(paren
id|gsf
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/* we don&squot;t issue this SYNC_MEMORY, as we trust Rick T and&n;&t;&t; * moreover will not use the PROCESSING state, so q-&gt;polling&n;&t;&t; * was 0&n;&t;&t;SYNC_MEMORY;*/
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|gsf
)braket
op_eq
id|SLSB_P_INPUT_PRIMED
)paren
(brace
multiline_comment|/* set our summary bit again, as otherwise there is a&n;&t;&t;&t; * small window we can miss between resetting it and&n;&t;&t;&t; * checking for PRIMED state */
r_if
c_cond
(paren
id|q-&gt;is_iqdio_q
)paren
id|iqdio_set_summary_bit
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* see the comment in do_QDIO and before qdio_reserve_q about the&n; * sophisticated locking outside of unmark_q, so that we don&squot;t need to&n; * disable the interrupts :-) */
DECL|function|qdio_unmark_q
r_static
r_inline
r_void
id|qdio_unmark_q
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;unmark q&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;list_prev
)paren
op_logical_or
(paren
op_logical_neg
id|q-&gt;list_next
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|q-&gt;is_iqdio_q
)paren
op_logical_and
(paren
id|q-&gt;is_input_q
)paren
)paren
(brace
multiline_comment|/* iQDIO */
id|my_spin_lock_irqsave
c_func
(paren
op_amp
id|iq_list_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;list_next
op_eq
id|q
)paren
(brace
multiline_comment|/* q was the only interesting q */
id|iq_list
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_next
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_prev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;list_next-&gt;list_prev
op_assign
id|q-&gt;list_prev
suffix:semicolon
id|q-&gt;list_prev-&gt;list_next
op_assign
id|q-&gt;list_next
suffix:semicolon
id|iq_list
op_assign
id|q-&gt;list_next
suffix:semicolon
id|q-&gt;list_next
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_prev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|my_spin_unlock_irqrestore
c_func
(paren
op_amp
id|iq_list_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|iqdio_clear_global_summary
r_static
r_inline
r_volatile
r_int
r_int
id|iqdio_clear_global_summary
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;clrglobl&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_32_BIT
id|asm
r_volatile
(paren
l_string|&quot;lhi&t;1,3&t;&bslash;n&bslash;t&quot;
l_string|&quot;.insn&t;rre,0xb2650000,2,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;%0,3&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|time
)paren
suffix:colon
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#else /* QDIO_32_BIT */
id|asm
r_volatile
(paren
l_string|&quot;lghi&t;1,3&t;&bslash;n&bslash;t&quot;
l_string|&quot;.insn&t;rre,0xb2650000,2,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;lgr&t;%0,3&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|time
)paren
suffix:colon
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_32_BIT */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|time
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
id|time
suffix:semicolon
)brace
multiline_comment|/************************* INBOUND ROUTINES *******************************/
DECL|function|qdio_get_inbound_buffer_frontier
r_inline
r_static
r_int
id|qdio_get_inbound_buffer_frontier
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|f
comma
id|f_mod_no
suffix:semicolon
r_volatile
r_char
op_star
id|slsb
suffix:semicolon
r_char
id|slsbyte
suffix:semicolon
r_int
id|first_not_to_check
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;getibfro&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|slsb
op_assign
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_assign
id|q-&gt;first_to_check
suffix:semicolon
multiline_comment|/* we don&squot;t check 128 buffers, as otherwise qdio_has_inbound_q_moved&n;&t; * would return 0 */
id|first_not_to_check
op_assign
id|f
op_plus
id|qdio_min
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
comma
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* we don&squot;t use this one, as a PCI or we after a thin interrupt&n;&t; * will sync the queues&n;&t;SYNC_MEMORY;*/
id|check_next
suffix:colon
id|f_mod_no
op_assign
id|f
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f
op_eq
id|first_not_to_check
)paren
r_goto
id|out
suffix:semicolon
id|slsbyte
op_assign
id|slsb
(braket
id|f_mod_no
)braket
suffix:semicolon
multiline_comment|/* CU_EMPTY means frontier is reached */
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_CU_INPUT_EMPTY
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inptempt&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* P_PRIMED means set slsb to P_PROCESSING and move on */
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_P_INPUT_PRIMED
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inptprim&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
multiline_comment|/* as soon as running under VM, polling the input queues will&n;&t;&t; * kill VM in terms of CP overhead */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_PROCESSING
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#else /* QDIO_USE_PROCESSING_STATE */
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
multiline_comment|/* not needed, as the inbound queue will be synced on the next&n;&t;&t; * siga-r&n;&t;&t;SYNC_MEMORY;*/
id|f
op_increment
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
r_goto
id|check_next
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|slsbyte
op_eq
id|SLSB_P_INPUT_NOT_INIT
)paren
op_logical_or
(paren
id|slsbyte
op_eq
id|SLSB_P_INPUT_PROCESSING
)paren
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inpnipro&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* P_ERROR means frontier is reached, break and report error */
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_P_INPUT_ERROR
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;inperr%2x&quot;
comma
id|f_mod_no
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|sbal
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
comma
l_int|256
)paren
suffix:semicolon
multiline_comment|/* kind of process the buffer */
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;qdio_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_QDIO_ERROR
suffix:semicolon
id|q-&gt;qdio_error
op_assign
id|SLSB_P_INPUT_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
multiline_comment|/* we increment the frontier, as this buffer&n;&t;&t; * was processed obviously */
id|f_mod_no
op_assign
(paren
id|f_mod_no
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* everything else means frontier not changed (HALTED or so) */
id|out
suffix:colon
id|q-&gt;first_to_check
op_assign
id|f_mod_no
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q-&gt;first_to_check
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
id|q-&gt;first_to_check
suffix:semicolon
)brace
DECL|function|qdio_has_inbound_q_moved
r_inline
r_static
r_int
id|qdio_has_inbound_q_moved
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
r_static
r_int
id|old_pcis
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|old_thinints
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_pcis
op_eq
id|perf_stats.pcis
)paren
op_logical_and
(paren
id|old_thinints
op_eq
id|perf_stats.thinints
)paren
)paren
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
r_else
id|old_pcis
op_assign
id|perf_stats.pcis
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|i
op_assign
id|qdio_get_inbound_buffer_frontier
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ne
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
)paren
op_logical_or
(paren
id|q-&gt;error_status_flags
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
)paren
(brace
id|SAVE_FRONTIER
c_func
(paren
id|q
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;siga_sync
)paren
op_logical_and
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
)paren
(brace
id|SAVE_TIMESTAMP
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inhasmvd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inhsntmv&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* means, no more buffers to be filled */
DECL|function|iqdio_is_inbound_q_done
r_inline
r_static
r_int
id|iqdio_is_inbound_q_done
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
multiline_comment|/* propagate the change from 82 to 80 through VM */
id|SYNC_MEMORY
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_if
c_cond
(paren
id|no_used
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;iqisnt%02x&quot;
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iniqisdo&quot;
)paren
suffix:semicolon
)brace
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
op_logical_neg
id|no_used
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|q-&gt;first_to_check
)braket
op_eq
id|SLSB_P_INPUT_PRIMED
)paren
(brace
multiline_comment|/* ok, the next input buffer is primed. that means,&n;&t;&t;&t; * that device state change indicator and adapter&n;&t;&t;&t; * local summary are set, so we will find it next&n;&t;&t;&t; * time.&n;&t;&t;&t; * we will return 0 below, as there is nothing to&n;&t;&t;&t; * do, except of scheduling ourselves for the next&n;&t;&t;&t; * time. */
id|iqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* nothing more to do, if next buffer is not PRIMED.&n;&t;&t;&t; * note that we did a SYNC_MEMORY before, that there&n;&t;&t;&t; * has been a sychnronization.&n;&t;&t;&t; * we will return 0 below, as there is nothing to do&n;&t;&t;&t; * (stop_polling not necessary, as we have not been&n;&t;&t;&t; * using the PROCESSING state */
)brace
)brace
r_else
(brace
multiline_comment|/* we&squot;ll check for more primed buffers&n;&t;&t; * in qeth_stop_polling */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|qdio_is_inbound_q_done
r_inline
r_static
r_int
id|qdio_is_inbound_q_done
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
multiline_comment|/* we need that one for synchronization with Hydra, as Hydra&n;&t; * does a kind of PCI avoidance */
id|SYNC_MEMORY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|no_used
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisdnA&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|q-&gt;first_to_check
)braket
op_eq
id|SLSB_P_INPUT_PRIMED
)paren
(brace
multiline_comment|/* we got something to do */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisntA&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* on VM, we don&squot;t poll, so the q is always done here */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;hydra_gives_outbound_pcis
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* at this point we know, that inbound first_to_check&n;&t;   has (probably) not moved (see qdio_inbound_processing) */
r_if
c_cond
(paren
id|NOW
OG
id|GET_SAVED_TIMESTAMP
c_func
(paren
id|q
)paren
op_plus
id|q-&gt;timing.threshold
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisdon&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;pf%02xcn%02x&quot;
comma
id|q-&gt;first_to_check
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisntd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;pf%02xcn%02x&quot;
comma
id|q-&gt;first_to_check
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|qdio_translate_buffer_back
r_static
r_inline
r_void
id|qdio_translate_buffer_back
c_func
(paren
id|qdio_q_t
op_star
id|q
comma
r_int
id|bufno
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;is_0copy_sbals_q
)paren
id|memcpy
c_func
(paren
id|q-&gt;qdio_buffers
(braket
id|bufno
)braket
comma
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
id|bufno
)braket
comma
id|SBAL_SIZE
)paren
suffix:semicolon
)brace
DECL|function|qdio_kick_inbound_handler
r_inline
r_static
r_void
id|qdio_kick_inbound_handler
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|start
comma
id|end
comma
id|real_end
comma
id|i
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickinh&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|start
op_assign
id|q-&gt;first_element_to_kick
suffix:semicolon
id|real_end
op_assign
id|q-&gt;first_to_check
suffix:semicolon
id|end
op_assign
(paren
id|real_end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_assign
id|start
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|count
op_increment
suffix:semicolon
id|qdio_translate_buffer_back
c_func
(paren
id|q
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|end
)paren
r_break
suffix:semicolon
id|i
op_assign
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;s=%2xc=%2x&quot;
comma
id|start
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|q-&gt;state
op_eq
id|QDIO_IRQ_STATE_ACTIVE
)paren
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;irq
comma
id|QDIO_STATUS_INBOUND_INT
op_or
id|q-&gt;error_status_flags
comma
id|q-&gt;qdio_error
comma
id|q-&gt;siga_error
comma
id|q-&gt;q_no
comma
id|start
comma
id|count
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
multiline_comment|/* for the next time: */
id|q-&gt;first_element_to_kick
op_assign
id|real_end
suffix:semicolon
id|q-&gt;qdio_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;siga_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;error_status_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.inbound_time
op_add_assign
id|NOW
op_minus
id|perf_stats.start_time_inbound
suffix:semicolon
id|perf_stats.inbound_cnt
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
DECL|function|iqdio_inbound_processing
r_static
r_inline
r_void
id|iqdio_inbound_processing
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqinproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
multiline_comment|/* we first want to reserve the q, so that we know, that we don&squot;t&n;&t; * interrupt ourselves and call qdio_unmark_q, as is_in_shutdown might&n;&t; * be set */
r_if
c_cond
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we might just be about to stop polling, we make&n;&t;&t; * sure that we check again at least once more */
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_nc
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
(brace
id|qdio_unmark_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
(paren
id|q-&gt;dev_st_chg_ind
)paren
)paren
(brace
id|iqdio_clear_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;siga_sync_done_on_thinints
)paren
(brace
id|SYNC_MEMORY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qdio_has_inbound_q_moved
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_kick_inbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iqdio_is_inbound_q_done
c_func
(paren
id|q
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
multiline_comment|/* we set the flags to get into&n;&t;&t;&t;&t;&t; * the stuff next time, see also&n;&t;&t;&t;&t;&t; * comment in qdio_stop_polling */
id|iqdio_set_summary_bit
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|out
suffix:colon
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
DECL|function|qdio_inbound_processing
r_static
r_void
id|qdio_inbound_processing
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|q_laps
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qinproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|i_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we&squot;re sissies, we&squot;ll check next time */
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;busy,agn&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
)brace
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|i_p_nc
op_increment
suffix:semicolon
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|again
suffix:colon
r_if
c_cond
(paren
id|qdio_has_inbound_q_moved
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_kick_inbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
id|q_laps
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|q_laps
OL
id|QDIO_Q_LAPS
)paren
r_goto
id|again
suffix:semicolon
)brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_inbound_q_done
c_func
(paren
id|q
)paren
)paren
multiline_comment|/* means poll time is &n;&t;&t;&t;&t;&t;&t;   not yet over */
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
multiline_comment|/************************* OUTBOUND ROUTINES *******************************/
DECL|function|qdio_get_outbound_buffer_frontier
r_inline
r_static
r_int
id|qdio_get_outbound_buffer_frontier
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|f
comma
id|f_mod_no
suffix:semicolon
r_volatile
r_char
op_star
id|slsb
suffix:semicolon
r_int
id|first_not_to_check
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_char
id|slsbyte
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;getobfro&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|slsb
op_assign
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_assign
id|q-&gt;first_to_check
suffix:semicolon
multiline_comment|/* f point to already processed elements, so f+no_used is correct...&n;&t; * ... but: we don&squot;t check 128 buffers, as otherwise&n;&t; * qdio_has_outbound_q_moved would return 0 */
id|first_not_to_check
op_assign
id|f
op_plus
id|qdio_min
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
comma
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;is_iqdio_q
)paren
op_logical_and
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
)paren
(brace
id|SYNC_MEMORY
suffix:semicolon
)brace
id|check_next
suffix:colon
r_if
c_cond
(paren
id|f
op_eq
id|first_not_to_check
)paren
r_goto
id|out
suffix:semicolon
id|slsbyte
op_assign
id|slsb
(braket
id|f_mod_no
)braket
suffix:semicolon
multiline_comment|/* the hydra has not fetched the output yet */
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_CU_OUTPUT_PRIMED
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpprim&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* the hydra got it */
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_P_OUTPUT_EMPTY
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
id|f
op_increment
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpempt&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_goto
id|check_next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|slsbyte
op_eq
id|SLSB_P_OUTPUT_ERROR
)paren
(brace
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outperr&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%x-%x-%x&quot;
comma
id|f_mod_no
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
op_member_access_from_pointer
id|element
(braket
l_int|14
)braket
dot
id|sbalf.value
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
op_member_access_from_pointer
id|element
(braket
l_int|15
)braket
dot
id|sbalf.value
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|sbal
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
comma
l_int|256
)paren
suffix:semicolon
multiline_comment|/* kind of process the buffer */
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_OUTPUT_NOT_INIT
)paren
suffix:semicolon
id|qdio_translate_buffer_back
c_func
(paren
id|q
comma
id|f_mod_no
)paren
suffix:semicolon
multiline_comment|/* we increment the frontier, as this buffer&n;&t;&t; * was processed obviously */
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
id|f_mod_no
op_assign
(paren
id|f_mod_no
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;qdio_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_QDIO_ERROR
suffix:semicolon
id|q-&gt;qdio_error
op_assign
id|SLSB_P_OUTPUT_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* no new buffers */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpni&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_goto
id|out
suffix:semicolon
id|out
suffix:colon
r_return
(paren
id|q-&gt;first_to_check
op_assign
id|f_mod_no
)paren
suffix:semicolon
)brace
multiline_comment|/* all buffers are processed */
DECL|function|qdio_is_outbound_q_done
r_inline
r_static
r_int
id|qdio_is_outbound_q_done
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_if
c_cond
(paren
id|no_used
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;oqisnt%02x&quot;
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqisdone&quot;
)paren
suffix:semicolon
)brace
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
(paren
id|no_used
op_eq
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|qdio_has_outbound_q_moved
r_inline
r_static
r_int
id|qdio_has_outbound_q_moved
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|qdio_get_outbound_buffer_frontier
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ne
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
)paren
op_logical_or
(paren
id|q-&gt;error_status_flags
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
)paren
(brace
id|SAVE_FRONTIER
c_func
(paren
id|q
comma
id|i
)paren
suffix:semicolon
id|SAVE_TIMESTAMP
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqhasmvd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqhsntmv&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|qdio_kick_outbound_q
r_inline
r_static
r_void
id|qdio_kick_outbound_q
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
r_int
id|result
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickoutq&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;siga_out
)paren
r_return
suffix:semicolon
id|result
op_assign
id|qdio_siga_output
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;siga_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_SIGA_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
id|q-&gt;siga_error
op_assign
id|result
suffix:semicolon
)brace
)brace
DECL|function|qdio_kick_outbound_handler
r_inline
r_static
r_void
id|qdio_kick_outbound_handler
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_int
id|start
op_assign
id|q-&gt;first_element_to_kick
suffix:semicolon
multiline_comment|/* last_move_ftc was just updated */
r_int
id|real_end
op_assign
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
suffix:semicolon
r_int
id|end
op_assign
(paren
id|real_end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
r_int
id|count
op_assign
(paren
id|end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
l_int|1
op_minus
id|start
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickouth&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;s=%2xc=%2x&quot;
comma
id|start
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|q-&gt;state
op_eq
id|QDIO_IRQ_STATE_ACTIVE
)paren
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;irq
comma
id|QDIO_STATUS_OUTBOUND_INT
op_or
id|q-&gt;error_status_flags
comma
id|q-&gt;qdio_error
comma
id|q-&gt;siga_error
comma
id|q-&gt;q_no
comma
id|start
comma
id|count
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
multiline_comment|/* for the next time: */
id|q-&gt;first_element_to_kick
op_assign
id|real_end
suffix:semicolon
id|q-&gt;qdio_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;siga_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;error_status_flags
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|qdio_outbound_processing
r_static
r_void
id|qdio_outbound_processing
c_func
(paren
id|qdio_q_t
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qoutproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|o_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we&squot;re sissies, we&squot;ll check next time */
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;busy,agn&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
)brace
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|o_p_nc
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
id|qdio_has_outbound_q_moved
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_kick_outbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;is_iqdio_q
)paren
(brace
multiline_comment|/* for asynchronous queues, we better check, if the fill&n;&t;&t; * level is too high */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
OG
id|IQDIO_FILL_LEVEL_TO_POLL
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_outbound_q_done
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
multiline_comment|/************************* MAIN ROUTINES *******************************/
DECL|function|iqdio_inbound_checks
r_static
r_inline
r_void
id|iqdio_inbound_checks
c_func
(paren
r_void
)paren
(brace
id|qdio_q_t
op_star
id|q
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_int
id|q_laps
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqdinbck&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqlocsum&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
id|again
suffix:colon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
id|q
op_assign
(paren
id|qdio_q_t
op_star
)paren
id|iq_list
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_break
suffix:semicolon
id|iqdio_inbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
(paren
id|qdio_q_t
op_star
)paren
id|q-&gt;list_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|q
op_ne
(paren
id|qdio_q_t
op_star
)paren
id|iq_list
)paren
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
id|q
op_assign
(paren
id|qdio_q_t
op_star
)paren
id|iq_list
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* under VM, we have not used the PROCESSING state, so no&n;&t;&t; * need to stop polling */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
(brace
id|q
op_assign
(paren
id|qdio_q_t
op_star
)paren
id|q-&gt;list_next
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we might just be about to stop polling, we make&n;&t;&t;&t; * sure that we check again at least once more */
multiline_comment|/* sanity -- we&squot;d get here without setting the&n;&t;&t;&t; * dev st chg ind */
id|iqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
id|q_laps
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|q_laps
OL
id|QDIO_Q_LAPS
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* we set the flags to get into the stuff&n;&t;&t;&t;&t; * next time, see also comment in&n;&t;&t;&t;&t; * qdio_stop_polling */
id|iqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|q
op_assign
(paren
id|qdio_q_t
op_star
)paren
id|q-&gt;list_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|q
op_ne
(paren
id|qdio_q_t
op_star
)paren
id|iq_list
)paren
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
)brace
DECL|function|iqdio_check_for_polling
r_static
r_void
id|iqdio_check_for_polling
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|iqdio_tl
r_static
r_void
id|iqdio_tl
c_func
(paren
r_int
r_int
id|data
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqdio_tl&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|iqdio_inbound_checks
c_func
(paren
)paren
suffix:semicolon
id|iqdio_check_for_polling
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/********************* GENERAL HELPER_ROUTINES ***********************/
DECL|function|qdio_get_irq_ptr
r_static
id|qdio_irq_t
op_star
id|qdio_get_irq_ptr
c_func
(paren
r_int
id|irq
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_int
id|bucket
op_assign
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
id|irq_ptr
op_assign
id|first_irq
(braket
id|bucket
)braket
suffix:semicolon
r_while
c_loop
(paren
id|irq_ptr
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;irq
op_eq
id|irq
)paren
r_break
suffix:semicolon
id|irq_ptr
op_assign
id|irq_ptr-&gt;next
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
r_return
id|irq_ptr
suffix:semicolon
)brace
DECL|function|qdio_get_irq_ptr_wolock
r_static
id|qdio_irq_t
op_star
id|qdio_get_irq_ptr_wolock
c_func
(paren
r_int
id|irq
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
op_assign
id|first_irq
(braket
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
)braket
suffix:semicolon
r_while
c_loop
(paren
id|irq_ptr
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;irq
op_eq
id|irq
)paren
r_break
suffix:semicolon
id|irq_ptr
op_assign
id|irq_ptr-&gt;next
suffix:semicolon
)brace
r_return
id|irq_ptr
suffix:semicolon
)brace
multiline_comment|/* irq_ptr-&gt;irq should be set already! */
DECL|function|qdio_insert_irq_ptr
r_static
r_void
id|qdio_insert_irq_ptr
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
)paren
(brace
id|qdio_irq_t
op_star
id|i_p
suffix:semicolon
r_int
id|irq
comma
id|bucket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
suffix:semicolon
id|irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|bucket
op_assign
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr
op_eq
id|qdio_get_irq_ptr_wolock
c_func
(paren
id|irq
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first_irq
(braket
id|bucket
)braket
)paren
(brace
id|first_irq
(braket
id|bucket
)braket
op_assign
id|irq_ptr
suffix:semicolon
)brace
r_else
(brace
id|i_p
op_assign
id|first_irq
(braket
id|bucket
)braket
suffix:semicolon
r_while
c_loop
(paren
id|i_p-&gt;next
)paren
id|i_p
op_assign
id|i_p-&gt;next
suffix:semicolon
id|i_p-&gt;next
op_assign
id|irq_ptr
suffix:semicolon
)brace
id|irq_ptr-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
id|write_unlock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
)brace
DECL|function|qdio_remove_irq_ptr
r_static
r_void
id|qdio_remove_irq_ptr
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
)paren
(brace
id|qdio_irq_t
op_star
id|i_p
suffix:semicolon
r_int
id|irq
comma
id|bucket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
suffix:semicolon
id|irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|bucket
op_assign
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_get_irq_ptr_wolock
c_func
(paren
id|irq
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|first_irq
(braket
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
)braket
op_eq
id|irq_ptr
)paren
(brace
id|first_irq
(braket
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
)braket
op_assign
id|irq_ptr-&gt;next
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i_p
op_assign
id|first_irq
(braket
id|irq
op_amp
(paren
id|QDIO_IRQ_BUCKETS
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|i_p-&gt;next
op_ne
id|irq_ptr
suffix:semicolon
id|i_p
op_assign
id|i_p-&gt;next
)paren
suffix:semicolon
id|i_p-&gt;next
op_assign
id|irq_ptr-&gt;next
suffix:semicolon
)brace
id|irq_ptr-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
id|write_unlock
c_func
(paren
op_amp
id|irq_list_lock
(braket
id|bucket
)braket
)paren
suffix:semicolon
)brace
DECL|function|qdio_release_irq_memory
r_static
r_void
id|qdio_release_irq_memory
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
id|available
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QDIO_MAX_QUEUES_PER_IRQ
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
r_goto
id|next
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_0copy_sbals_q
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|available
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sbal
(braket
id|j
)braket
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|irq_ptr
op_member_access_from_pointer
id|input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|available
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|available
op_sub_assign
r_sizeof
(paren
id|sbal_t
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
id|kfree
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|next
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_0copy_sbals_q
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|available
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sbal
(braket
id|j
)braket
)paren
id|kfree
c_func
(paren
(paren
r_void
op_star
)paren
id|irq_ptr
op_member_access_from_pointer
id|output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|available
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|available
op_sub_assign
r_sizeof
(paren
id|sbal_t
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
id|kfree
c_func
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;qdr
)paren
id|kfree
c_func
(paren
id|irq_ptr-&gt;qdr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;MOD_DEC_&quot;
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|qdio_wakeup
r_static
r_inline
r_void
id|qdio_wakeup
c_func
(paren
id|atomic_t
op_star
id|var
comma
id|qdio_irq_t
op_star
id|irq_ptr
)paren
(brace
id|wait_queue_head_t
op_star
id|wait_q
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qwkp%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|atomic_set
c_func
(paren
id|var
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wait_q
op_assign
op_amp
id|irq_ptr-&gt;wait_q
)paren
)paren
id|wake_up
c_func
(paren
id|wait_q
)paren
suffix:semicolon
)brace
DECL|function|qdio_sleepon
r_static
r_int
id|qdio_sleepon
c_func
(paren
id|atomic_t
op_star
id|var
comma
r_int
id|timeout
comma
id|qdio_irq_t
op_star
id|irq_ptr
)paren
(brace
id|__u64
id|stop
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|DECLARE_WAITQUEUE
(paren
id|current_wait_q
comma
id|current
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qslp%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|add_wait_queue
c_func
(paren
op_amp
id|irq_ptr-&gt;wait_q
comma
op_amp
id|current_wait_q
)paren
suffix:semicolon
id|stop
op_assign
(paren
id|qdio_get_micros
c_func
(paren
)paren
op_rshift
l_int|10
)paren
op_plus
id|timeout
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_task_state
c_func
(paren
id|current
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
id|var
)paren
)paren
(brace
id|atomic_set
c_func
(paren
id|var
comma
l_int|0
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qdio_get_micros
c_func
(paren
)paren
op_rshift
l_int|10
OG
id|stop
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%xtime&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
id|retval
op_assign
op_minus
id|ETIME
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|schedule_timeout
c_func
(paren
(paren
(paren
id|stop
op_minus
(paren
id|qdio_get_micros
c_func
(paren
)paren
op_rshift
l_int|10
)paren
)paren
op_rshift
l_int|10
)paren
op_star
id|HZ
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|set_task_state
c_func
(paren
id|current
comma
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|irq_ptr-&gt;wait_q
comma
op_amp
id|current_wait_q
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|qdio_set_impl_params
r_static
r_void
id|qdio_set_impl_params
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
r_int
id|qib_param_field_format
comma
multiline_comment|/* pointer to 128 bytes or NULL, if no param field */
r_int
r_char
op_star
id|qib_param_field
comma
multiline_comment|/* pointer to no_queues*128 words of data or NULL */
r_int
r_int
id|no_input_qs
comma
r_int
r_int
id|no_output_qs
comma
r_int
r_int
op_star
id|input_slib_elements
comma
r_int
r_int
op_star
id|output_slib_elements
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
suffix:semicolon
id|irq_ptr-&gt;qib.pfmt
op_assign
id|qib_param_field_format
suffix:semicolon
r_if
c_cond
(paren
id|qib_param_field
)paren
id|memcpy
c_func
(paren
id|irq_ptr-&gt;qib.parm
comma
id|qib_param_field
comma
id|QDIO_MAX_BUFFERS_PER_Q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input_slib_elements
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib-&gt;slibe
(braket
id|j
)braket
dot
id|parms
op_assign
id|input_slib_elements
(braket
id|i
op_star
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
id|j
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|output_slib_elements
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib-&gt;slibe
(braket
id|j
)braket
dot
id|parms
op_assign
id|output_slib_elements
(braket
id|i
op_star
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
id|j
)braket
suffix:semicolon
)brace
)brace
DECL|function|qdio_alloc_qs
r_static
r_int
id|qdio_alloc_qs
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
id|no_input_qs
comma
r_int
id|no_output_qs
comma
id|qdio_handler_t
op_star
id|input_handler
comma
id|qdio_handler_t
op_star
id|output_handler
comma
r_int
r_int
id|int_parm
comma
r_int
id|q_format
comma
r_int
r_int
id|flags
comma
r_void
op_star
op_star
id|inbound_sbals_array
comma
r_void
op_star
op_star
id|outbound_sbals_array
)paren
(brace
id|qdio_q_t
op_star
id|q
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|result
op_assign
l_int|0
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* see qdio_initialize */
r_void
op_star
id|ptr
suffix:semicolon
r_int
id|available
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|qdio_q_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of q failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_q_t
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;in-q%4x&quot;
comma
id|i
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|q-&gt;slib
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;slib
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of slib failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q-&gt;slib
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|q-&gt;sl
op_assign
(paren
id|sl_t
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;slib
)paren
op_plus
id|PAGE_SIZE
op_div
l_int|2
)paren
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_INBOUND_0COPY_SBALS
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
op_star
(paren
id|inbound_sbals_array
op_increment
)paren
suffix:semicolon
)brace
)brace
r_else
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|available
)paren
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;sbal
(braket
id|j
)braket
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|available
op_assign
id|PAGE_SIZE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
id|j
)braket
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
(paren
r_volatile
id|sbal_t
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;sbal
(braket
id|j
op_minus
l_int|1
)braket
)paren
op_plus
r_sizeof
(paren
id|sbal_t
)paren
)paren
suffix:semicolon
)brace
id|available
op_sub_assign
r_sizeof
(paren
id|sbal_t
)paren
suffix:semicolon
)brace
id|q-&gt;queue_type
op_assign
id|q_format
suffix:semicolon
id|q-&gt;int_parm
op_assign
id|int_parm
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_assign
id|q
suffix:semicolon
id|q-&gt;irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|q-&gt;mask
op_assign
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|i
)paren
suffix:semicolon
id|q-&gt;q_no
op_assign
id|i
suffix:semicolon
id|q-&gt;is_input_q
op_assign
l_int|1
suffix:semicolon
id|q-&gt;is_0copy_sbals_q
op_assign
id|flags
op_amp
id|QDIO_INBOUND_0COPY_SBALS
suffix:semicolon
id|q-&gt;first_to_check
op_assign
l_int|0
suffix:semicolon
id|q-&gt;last_move_ftc
op_assign
l_int|0
suffix:semicolon
id|q-&gt;handler
op_assign
id|input_handler
suffix:semicolon
id|q-&gt;dev_st_chg_ind
op_assign
id|irq_ptr-&gt;dev_st_chg_ind
suffix:semicolon
id|q-&gt;tasklet.data
op_assign
(paren
r_int
r_int
)paren
id|q
suffix:semicolon
id|q-&gt;tasklet.func
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
(paren
(paren
id|q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
ques
c_cond
op_amp
id|iqdio_inbound_processing
suffix:colon
op_amp
id|qdio_inbound_processing
)paren
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_NUMBER;j++)&n;&t;&t;&t;q-&gt;timing.last_transfer_times[j]=(qdio_get_micros()/&n;&t;&t;&t;&t;&t;&t;&t;  QDIO_STATS_NUMBER)*j;&n;&t;&t;q-&gt;timing.last_transfer_index=QDIO_STATS_NUMBER-1;&n;*/
multiline_comment|/* fill in slib */
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|slib-&gt;nsliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;slib
)paren
suffix:semicolon
id|q-&gt;slib-&gt;sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sl
)paren
suffix:semicolon
id|q-&gt;slib-&gt;slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fill in sl */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sl-&gt;element
(braket
id|j
)braket
dot
id|sbal
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;sl-sb-b0&quot;
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sl
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
op_amp
id|q-&gt;slsb
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
l_int|0
)braket
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* fill in slsb */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|j
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/*&t;&t;&t;q-&gt;sbal[j]-&gt;element[1].sbalf.i1.key=QDIO_STORAGE_KEY;*/
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|qdio_q_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_q_t
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;outq%4x&quot;
comma
id|i
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|q-&gt;slib
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;slib
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of slib failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q-&gt;slib
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|q-&gt;sl
op_assign
(paren
id|sl_t
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;slib
)paren
op_plus
id|PAGE_SIZE
op_div
l_int|2
)paren
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_OUTBOUND_0COPY_SBALS
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
op_star
(paren
id|outbound_sbals_array
op_increment
)paren
suffix:semicolon
)brace
)brace
r_else
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|available
)paren
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;sbal
(braket
id|j
)braket
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|available
op_assign
id|PAGE_SIZE
suffix:semicolon
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
id|j
)braket
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
(paren
r_volatile
id|sbal_t
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;sbal
(braket
id|j
op_minus
l_int|1
)braket
)paren
op_plus
r_sizeof
(paren
id|sbal_t
)paren
)paren
suffix:semicolon
)brace
id|available
op_sub_assign
r_sizeof
(paren
id|sbal_t
)paren
suffix:semicolon
)brace
id|q-&gt;queue_type
op_assign
id|q_format
suffix:semicolon
id|q-&gt;int_parm
op_assign
id|int_parm
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_assign
id|q
suffix:semicolon
id|q-&gt;is_input_q
op_assign
l_int|0
suffix:semicolon
id|q-&gt;is_0copy_sbals_q
op_assign
id|flags
op_amp
id|QDIO_OUTBOUND_0COPY_SBALS
suffix:semicolon
id|q-&gt;irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|q-&gt;mask
op_assign
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|i
)paren
suffix:semicolon
id|q-&gt;q_no
op_assign
id|i
suffix:semicolon
id|q-&gt;first_to_check
op_assign
l_int|0
suffix:semicolon
id|q-&gt;last_move_ftc
op_assign
l_int|0
suffix:semicolon
id|q-&gt;handler
op_assign
id|output_handler
suffix:semicolon
id|q-&gt;tasklet.data
op_assign
(paren
r_int
r_int
)paren
id|q
suffix:semicolon
id|q-&gt;tasklet.func
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
op_amp
id|qdio_outbound_processing
suffix:semicolon
multiline_comment|/* fill in slib */
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|slib-&gt;nsliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;slib
)paren
suffix:semicolon
id|q-&gt;slib-&gt;sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sl
)paren
suffix:semicolon
id|q-&gt;slib-&gt;slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fill in sl */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sl-&gt;element
(braket
id|j
)braket
dot
id|sbal
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;sl-sb-b0&quot;
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sl
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
op_amp
id|q-&gt;slsb
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
l_int|0
)braket
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* fill in slsb */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|j
)braket
comma
id|SLSB_P_OUTPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/*&t;&t;&t;q-&gt;sbal[j]-&gt;element[1].sbalf.i1.key=QDIO_STORAGE_KEY;*/
)brace
)brace
id|result
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
r_return
id|result
suffix:semicolon
)brace
DECL|function|qdio_fill_thresholds
r_static
r_void
id|qdio_fill_thresholds
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
r_int
id|no_input_qs
comma
r_int
r_int
id|no_output_qs
comma
r_int
r_int
id|min_input_threshold
comma
r_int
r_int
id|max_input_threshold
comma
r_int
r_int
id|min_output_threshold
comma
r_int
r_int
id|max_output_threshold
)paren
(brace
r_int
id|i
suffix:semicolon
id|qdio_q_t
op_star
id|q
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
suffix:semicolon
id|q-&gt;timing.threshold
op_assign
id|max_input_threshold
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_CLASSES;j++) {&n;&t;&t;&t;q-&gt;threshold_classes[j].threshold=&n;&t;&t;&t;&t;min_input_threshold+&n;&t;&t;&t;&t;(max_input_threshold-min_input_threshold)/&n;&t;&t;&t;&t;QDIO_STATS_CLASSES;&n;&t;&t;}&n;&t;&t;qdio_use_thresholds(q,QDIO_STATS_CLASSES/2);*/
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
id|q-&gt;timing.threshold
op_assign
id|max_output_threshold
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_CLASSES;j++) {&n;&t;&t;&t;q-&gt;threshold_classes[j].threshold=&n;&t;&t;&t;&t;min_output_threshold+&n;&t;&t;&t;&t;(max_output_threshold-min_output_threshold)/&n;&t;&t;&t;&t;QDIO_STATS_CLASSES;&n;&t;&t;}&n;&t;&t;qdio_use_thresholds(q,QDIO_STATS_CLASSES/2);*/
)brace
)brace
DECL|function|iqdio_thinint_handler
r_static
r_int
id|iqdio_thinint_handler
c_func
(paren
id|__u32
id|intparm
)paren
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;thin_int&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.thinints
op_increment
suffix:semicolon
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* VM will do the SVS for us */
r_if
c_cond
(paren
op_logical_neg
id|MACHINE_IS_VM
)paren
(brace
id|iqdio_clear_global_summary
c_func
(paren
)paren
suffix:semicolon
)brace
id|iqdio_inbound_checks
c_func
(paren
)paren
suffix:semicolon
id|iqdio_check_for_polling
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|qdio_set_state
r_static
r_void
id|qdio_set_state
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
id|state
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;newstate&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%4x%4x&quot;
comma
id|irq_ptr-&gt;irq
comma
id|state
)paren
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|irq_ptr-&gt;state
op_assign
id|state
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|state
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|state
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|qdio_handler
r_static
r_void
id|qdio_handler
c_func
(paren
r_int
id|irq
comma
id|devstat_t
op_star
id|devstat
comma
r_struct
id|pt_regs
op_star
id|p
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
id|qdio_q_t
op_star
id|q
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|cstat
comma
id|dstat
suffix:semicolon
r_int
id|rqparam
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
op_assign
l_string|&quot;qintXXXX&quot;
suffix:semicolon
id|cstat
op_assign
id|devstat-&gt;cstat
suffix:semicolon
id|dstat
op_assign
id|devstat-&gt;dstat
suffix:semicolon
id|rqparam
op_assign
id|devstat-&gt;intparm
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|irq
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rqparam
)paren
(brace
id|QDIO_PRINT_STUPID
c_func
(paren
l_string|&quot;got unsolicited interrupt in qdio &quot;
"&bslash;"
l_string|&quot;handler, irq 0x%x&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;uint%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received interrupt on unused irq 0x%04x!&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devstat-&gt;flag
op_amp
id|DEVSTAT_FLAG_SENSE_AVAIL
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sens%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|sense
comma
op_amp
id|devstat-&gt;ii.irb
comma
id|QDIO_DBF_SENSE_LEN
)paren
suffix:semicolon
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;sense data available on qdio channel.&bslash;n&quot;
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;irb: &quot;
comma
op_amp
id|devstat-&gt;ii.irb
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;sense data: &quot;
comma
op_amp
id|devstat-&gt;ii.sense.data
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
id|irq_ptr-&gt;io_result_cstat
op_assign
id|ioinfo
(braket
id|irq
)braket
op_member_access_from_pointer
id|devstat.cstat
suffix:semicolon
id|irq_ptr-&gt;io_result_dstat
op_assign
id|ioinfo
(braket
id|irq
)braket
op_member_access_from_pointer
id|devstat.dstat
suffix:semicolon
id|irq_ptr-&gt;io_result_flags
op_assign
id|ioinfo
(braket
id|irq
)braket
op_member_access_from_pointer
id|devstat.flag
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_ACTIVATE
)paren
op_logical_and
(paren
id|cstat
op_amp
id|SCHN_STAT_PCI
)paren
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.pcis
op_increment
suffix:semicolon
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;is_input_q
op_amp
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
)paren
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_else
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_decrement
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|qdio_inbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;hydra_gives_outbound_pcis
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_decrement
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_outbound_q_done
c_func
(paren
id|q
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;sync_done_on_outb_pcis
)paren
(brace
id|SYNC_MEMORY
suffix:semicolon
)brace
id|qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_ACTIVATE
)paren
op_logical_and
(paren
op_logical_neg
id|cstat
)paren
op_logical_and
(paren
op_logical_neg
id|dstat
)paren
)paren
(brace
id|rqparam
op_assign
id|QDIO_DOING_CLEANUP
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_ESTABLISH
)paren
op_logical_and
(paren
(paren
id|cstat
)paren
op_logical_or
(paren
id|dstat
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;ick1%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|rqparam
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|dstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received check condition on establish &quot;
"&bslash;"
l_string|&quot;queues on irq 0x%x (cs=x%x, ds=x%x).&bslash;n&quot;
comma
id|irq
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_STOPPED
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_ACTIVATE
)paren
op_logical_and
(paren
id|dstat
op_eq
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
)paren
op_logical_or
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_CLEANUP
)paren
op_logical_or
(paren
op_logical_neg
id|rqparam
)paren
)paren
)paren
(brace
id|qdio_wakeup
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_been_cleaned
comma
id|irq_ptr
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|rqparam
op_eq
id|QDIO_DOING_ACTIVATE
)paren
op_logical_and
(paren
(paren
id|cstat
op_amp
op_complement
id|SCHN_STAT_PCI
)paren
op_logical_or
(paren
id|dstat
)paren
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;ick2%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|rqparam
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|dstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received check condition on activate &quot;
"&bslash;"
l_string|&quot;queues on irq 0x%x (cs=x%x, ds=x%x).&bslash;n&quot;
comma
id|irq
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;no_input_qs
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_ptr-&gt;no_output_qs
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;oops... no queue registered on irq &quot;
"&bslash;"
l_string|&quot;0x%x!?&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_goto
id|omit_handler_call
suffix:semicolon
)brace
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;irq
comma
id|QDIO_STATUS_ACTIVATE_CHECK_CONDITION
op_or
id|QDIO_STATUS_LOOK_FOR_ERROR
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
id|omit_handler_call
suffix:colon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_STOPPED
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|qdio_wakeup
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_arrived
comma
id|irq_ptr
)paren
suffix:semicolon
)brace
multiline_comment|/* this is for mp3 */
DECL|function|qdio_synchronize
r_int
id|qdio_synchronize
c_func
(paren
r_int
id|irq
comma
r_int
r_int
id|flags
comma
r_int
r_int
id|queue_number
)paren
(brace
r_int
r_int
id|gpr2
comma
id|gpr3
suffix:semicolon
r_int
id|cc
suffix:semicolon
id|qdio_q_t
op_star
id|q
suffix:semicolon
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
op_assign
l_string|&quot;SyncXXXX&quot;
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|irq
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|0
)braket
)paren
)paren
op_assign
id|flags
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|queue_number
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|gpr2
op_assign
l_int|0
suffix:semicolon
id|gpr3
op_assign
id|q-&gt;mask
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|gpr2
op_assign
id|q-&gt;mask
suffix:semicolon
id|gpr3
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
macro_line|#ifdef QDIO_32_BIT
id|asm
r_volatile
(paren
l_string|&quot;lhi&t;0,2&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;lr&t;3,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr2
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr3
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#else /* QDIO_32_BIT */
id|asm
r_volatile
(paren
l_string|&quot;lghi&t;0,2&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;1,%1&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;2,%2&t;&bslash;n&bslash;t&quot;
l_string|&quot;llgfr&t;3,%3&t;&bslash;n&bslash;t&quot;
l_string|&quot;siga   0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
l_int|0x10000
op_or
id|q-&gt;irq
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr2
)paren
comma
l_string|&quot;d&quot;
(paren
id|gpr3
)paren
suffix:colon
l_string|&quot;cc&quot;
comma
l_string|&quot;0&quot;
comma
l_string|&quot;1&quot;
comma
l_string|&quot;2&quot;
comma
l_string|&quot;3&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_32_BIT */
id|ptr
op_assign
op_amp
id|cc
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
multiline_comment|/* FIXME: this is never used in the kernel, why? */
DECL|function|qdio_get_slsb_state
r_int
r_char
id|qdio_get_slsb_state
c_func
(paren
r_int
id|irq
comma
r_int
r_int
id|flag
comma
r_int
r_int
id|queue_number
comma
r_int
r_int
id|qidx
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
id|qdio_q_t
op_star
id|q
suffix:semicolon
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
id|SLSB_ERROR_DURING_LOOKUP
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|flag
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
suffix:semicolon
)brace
r_else
r_return
id|SLSB_ERROR_DURING_LOOKUP
suffix:semicolon
r_return
id|q-&gt;slsb.acc.val
(braket
id|qidx
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)braket
suffix:semicolon
)brace
DECL|function|qdio_chsc
r_static
r_int
id|qdio_chsc
c_func
(paren
id|qdio_chsc_area_t
op_star
id|chsc_area
)paren
(brace
r_int
id|cc
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;.insn&t;rre,0xb25f0000,%1,0&t;&bslash;n&bslash;t&quot;
l_string|&quot;ipm&t;%0&t;&bslash;n&bslash;t&quot;
l_string|&quot;srl&t;%0,28&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|cc
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
id|chsc_area
)paren
suffix:colon
l_string|&quot;cc&quot;
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
DECL|function|qdio_check_siga_needs
r_static
r_int
r_char
id|qdio_check_siga_needs
c_func
(paren
r_int
id|sch
)paren
(brace
r_int
id|resp_code
comma
id|result
suffix:semicolon
id|memset
c_func
(paren
id|chsc_area
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
)paren
suffix:semicolon
id|chsc_area-&gt;request_block.command_code1
op_assign
l_int|0x0010
suffix:semicolon
multiline_comment|/* length */
id|chsc_area-&gt;request_block.command_code2
op_assign
l_int|0x0024
suffix:semicolon
multiline_comment|/* op code */
id|chsc_area-&gt;request_block.first_sch
op_assign
id|sch
suffix:semicolon
id|chsc_area-&gt;request_block.last_sch
op_assign
id|sch
suffix:semicolon
id|result
op_assign
id|qdio_chsc
c_func
(paren
id|chsc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;CHSC returned cc %i. Using all &quot;
"&bslash;"
l_string|&quot;SIGAs for sch x%x.&bslash;n&quot;
comma
id|result
comma
id|sch
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* all flags set */
)brace
id|resp_code
op_assign
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.response_code
suffix:semicolon
r_if
c_cond
(paren
id|resp_code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon checking SIGA needs &quot;
"&bslash;"
l_string|&quot;is 0x%x. Using all SIGAs for sch x%x.&bslash;n&quot;
comma
id|resp_code
comma
id|sch
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* all flags set */
)brace
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.flags
op_amp
id|CHSC_FLAG_QDIO_CAPABILITY
)paren
)paren
op_logical_or
(paren
op_logical_neg
(paren
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.flags
op_amp
id|CHSC_FLAG_VALIDITY
)paren
)paren
op_logical_or
(paren
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.sch
op_ne
id|sch
)paren
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;huh? problems checking out sch x%x... &quot;
"&bslash;"
l_string|&quot;using all SIGAs.&bslash;n&quot;
comma
id|sch
)paren
suffix:semicolon
r_return
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
op_or
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
multiline_comment|/* worst case */
)brace
r_return
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.qdioac
suffix:semicolon
)brace
multiline_comment|/* the chsc_area is locked by the lock in qdio_activate */
DECL|function|iqdio_check_chsc_availability
r_static
r_int
r_int
id|iqdio_check_chsc_availability
c_func
(paren
r_void
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|chsc_area
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
)paren
suffix:semicolon
id|chsc_area-&gt;request_block.command_code1
op_assign
l_int|0x0010
suffix:semicolon
id|chsc_area-&gt;request_block.command_code2
op_assign
l_int|0x0010
suffix:semicolon
id|result
op_assign
id|qdio_chsc
c_func
(paren
id|chsc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Was not able to determine &quot;
"&bslash;"
l_string|&quot;available CHSCs, cc=%i.&bslash;n&quot;
comma
id|result
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|result
op_assign
l_int|0
suffix:semicolon
id|i
op_assign
id|chsc_area-&gt;request_block.operation_data_area
dot
id|store_qdio_data_response.response_code
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
l_int|1
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Was not able to determine &quot;
"&bslash;"
l_string|&quot;available CHSCs.&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
multiline_comment|/* 4: request block&n;&t; * 2: general char&n;&t; * 512: chsc char */
r_if
c_cond
(paren
(paren
op_star
(paren
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|chsc_area
)paren
)paren
op_plus
l_int|4
op_plus
l_int|2
op_plus
l_int|1
)paren
op_amp
l_int|0x00800000
)paren
op_ne
l_int|0x00800000
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Adapter interruption facility not &quot;
"&bslash;"
l_string|&quot;installed.&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
op_star
(paren
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|chsc_area
)paren
)paren
op_plus
l_int|4
op_plus
l_int|512
op_plus
l_int|3
)paren
op_amp
l_int|0x00180000
)paren
op_ne
l_int|0x00180000
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Set Chan Subsys. Char. &amp; Fast-CHSCs &quot;
"&bslash;"
l_string|&quot;not available.&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
m_exit
suffix:colon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* the chsc_area is locked by the lock in qdio_activate */
DECL|function|iqdio_set_subchannel_ind
r_static
r_int
r_int
id|iqdio_set_subchannel_ind
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
id|reset_to_zero
)paren
(brace
r_int
r_int
id|real_addr_local_summary_bit
suffix:semicolon
r_int
r_int
id|real_addr_dev_st_chg_ind
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_int
r_int
id|resp_code
suffix:semicolon
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;is_iqdio_irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|reset_to_zero
)paren
(brace
id|real_addr_local_summary_bit
op_assign
l_int|0
suffix:semicolon
id|real_addr_dev_st_chg_ind
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|real_addr_local_summary_bit
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_volatile
r_void
op_star
)paren
id|indicators
)paren
suffix:semicolon
id|real_addr_dev_st_chg_ind
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_volatile
r_void
op_star
)paren
id|irq_ptr-&gt;dev_st_chg_ind
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|chsc_area
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
)paren
suffix:semicolon
id|chsc_area-&gt;request_block.command_code1
op_assign
l_int|0x0fe0
suffix:semicolon
id|chsc_area-&gt;request_block.command_code2
op_assign
l_int|0x0021
suffix:semicolon
id|chsc_area-&gt;request_block.operation_code
op_assign
l_int|0
suffix:semicolon
id|chsc_area-&gt;request_block.image_id
op_assign
l_int|0
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|summary_indicator_addr
op_assign
id|real_addr_local_summary_bit
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|subchannel_indicator_addr
op_assign
id|real_addr_dev_st_chg_ind
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|ks
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|kc
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|isc
op_assign
id|IQDIO_THININT_ISC
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc
dot
id|subsystem_id
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
op_plus
id|irq_ptr-&gt;irq
suffix:semicolon
id|result
op_assign
id|qdio_chsc
c_func
(paren
id|chsc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;could not set indicators on irq x%x, &quot;
"&bslash;"
l_string|&quot;cc=%i.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|resp_code
op_assign
id|chsc_area-&gt;response_block.response_code
suffix:semicolon
r_if
c_cond
(paren
id|resp_code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon setting indicators &quot;
"&bslash;"
l_string|&quot;is 0x%x.&bslash;n&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sidR%4x&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|chsc_area-&gt;response_block
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|setup
comma
op_amp
id|ptr
comma
id|QDIO_DBF_SETUP_LEN
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;setscind&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|real_addr_local_summary_bit
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|real_addr_dev_st_chg_ind
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* chsc_area would have to be locked if called from outside qdio_activate */
DECL|function|iqdio_set_delay_target
r_static
r_int
r_int
id|iqdio_set_delay_target
c_func
(paren
id|qdio_irq_t
op_star
id|irq_ptr
comma
r_int
r_int
id|delay_target
)paren
(brace
r_int
r_int
id|resp_code
suffix:semicolon
r_int
id|result
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;is_iqdio_irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|memset
c_func
(paren
id|chsc_area
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
)paren
suffix:semicolon
id|chsc_area-&gt;request_block.command_code1
op_assign
l_int|0x0fe0
suffix:semicolon
id|chsc_area-&gt;request_block.command_code2
op_assign
l_int|0x1027
suffix:semicolon
id|chsc_area-&gt;request_block.operation_data_area.set_chsc_fast
dot
id|delay_target
op_assign
id|delay_target
op_lshift
l_int|16
suffix:semicolon
id|result
op_assign
id|qdio_chsc
c_func
(paren
id|chsc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;could not set delay target on irq x%x, &quot;
"&bslash;"
l_string|&quot;cc=%i. Continuing.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|resp_code
op_assign
id|chsc_area-&gt;response_block.response_code
suffix:semicolon
r_if
c_cond
(paren
id|resp_code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon setting delay target &quot;
"&bslash;"
l_string|&quot;is 0x%x. Continuing.&bslash;n&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sdtR%4x&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|chsc_area-&gt;response_block
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|trace
comma
op_amp
id|ptr
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
)brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;delytrgt&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|delay_target
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|qdio_cleanup
r_int
id|qdio_cleanup
c_func
(paren
r_int
id|irq
comma
r_int
id|how
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_int
id|i
comma
id|result
suffix:semicolon
r_int
id|do_an_irqrestore
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
op_assign
l_string|&quot;12345678&quot;
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qcln%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|my_spin_lock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
multiline_comment|/* mark all qs as uninteresting */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_in_shutdown
comma
l_int|1
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_in_shutdown
comma
l_int|1
)paren
suffix:semicolon
)brace
id|tasklet_kill
c_func
(paren
op_amp
id|iqdio_tasklet
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|qdio_unmark_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|tasklet_kill
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|tasklet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_wait_for_no_use_count
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
)paren
id|result
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tasklet_kill
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|tasklet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_wait_for_no_use_count
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
)paren
id|result
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_been_cleaned
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* cleanup subchannel */
id|my_s390irq_spin_lock_irqsave
c_func
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|how
op_amp
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
(brace
id|clear_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_DOING_CLEANUP
comma
l_int|0
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_CLEAR_TIMEOUT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|how
op_amp
id|QDIO_FLAG_CLEANUP_USING_HALT
)paren
(brace
id|halt_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_DOING_CLEANUP
comma
l_int|0
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_HALT_TIMEOUT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* default behaviour */
id|halt_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_DOING_CLEANUP
comma
l_int|0
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_HALT_TIMEOUT
suffix:semicolon
)brace
id|my_s390irq_spin_unlock_irqrestore
c_func
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_sleepon
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_been_cleaned
comma
id|timeout
comma
id|irq_ptr
)paren
op_eq
op_minus
id|ETIME
)paren
(brace
id|my_s390irq_spin_lock_irqsave
c_func
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;Did not get interrupt on %s_IO, &quot;
"&bslash;"
l_string|&quot;irq=0x%x.&bslash;n&quot;
comma
(paren
id|how
op_eq
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
ques
c_cond
l_string|&quot;clear&quot;
suffix:colon
l_string|&quot;halt&quot;
comma
id|irq
)paren
suffix:semicolon
id|do_an_irqrestore
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;is_iqdio_irq
)paren
(brace
id|qdio_put_indicator
c_func
(paren
(paren
id|__u32
op_star
)paren
id|irq_ptr-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|iqdio_set_subchannel_ind
c_func
(paren
id|irq_ptr
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset adapter&n;&t;&t;&t;&t;&t;&t;&t;interrupt indicators */
)brace
multiline_comment|/* exchange int handlers, if necessary */
r_if
c_cond
(paren
(paren
r_void
op_star
)paren
id|ioinfo
(braket
id|irq
)braket
op_member_access_from_pointer
id|irq_desc.handler
op_eq
(paren
r_void
op_star
)paren
id|qdio_handler
)paren
(brace
id|ioinfo
(braket
id|irq
)braket
op_member_access_from_pointer
id|irq_desc.handler
op_assign
id|irq_ptr-&gt;original_int_handler
suffix:semicolon
multiline_comment|/*&t;&t;irq_ptr-&gt;original_int_handler=NULL; */
)brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_an_irqrestore
)paren
id|my_s390irq_spin_unlock_irqrestore
c_func
(paren
id|irq
comma
id|flags
)paren
suffix:semicolon
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_remove_irq_ptr
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|qdio_get_characteristics
r_static
r_int
r_int
id|qdio_get_characteristics
c_func
(paren
r_int
id|irq
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_ne
id|QDIO_IRQ_STATE_ACTIVE
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_INACTIVE
)paren
(brace
id|result
op_or_assign
id|QDIO_STATE_INACTIVE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ESTABLISHED
)paren
(brace
id|result
op_or_assign
id|QDIO_STATE_ESTABLISHED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ACTIVE
)paren
(brace
id|result
op_or_assign
id|QDIO_STATE_ACTIVE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_STOPPED
)paren
(brace
id|result
op_or_assign
id|QDIO_STATE_STOPPED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;hydra_gives_outbound_pcis
)paren
id|result
op_or_assign
id|QDIO_STATE_MUST_USE_OUTB_PCI
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|qdio_initialize
r_int
id|qdio_initialize
c_func
(paren
id|qdio_initialize_t
op_star
id|init_data
)paren
(brace
r_int
id|i
comma
id|ciw_cnt
suffix:semicolon
r_int
r_int
id|saveflags
suffix:semicolon
id|qdio_irq_t
op_star
id|irq_ptr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|result
comma
id|result2
suffix:semicolon
r_int
id|found
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* if a printf would print out more than 8 chars */
id|down_interruptible
c_func
(paren
op_amp
id|init_sema
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qini%4x&quot;
comma
id|init_data-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qfmt:%x&quot;
comma
id|init_data-&gt;q_format
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|init_data-&gt;adapter_name
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
id|init_data-&gt;adapter_name
comma
l_int|8
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qpff%4x&quot;
comma
id|init_data-&gt;qib_param_field_format
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;qib_param_field
comma
r_sizeof
(paren
r_char
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_slib_elements
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_slib_elements
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;miit%4x&quot;
comma
id|init_data-&gt;min_input_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;mait%4x&quot;
comma
id|init_data-&gt;min_input_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;miot%4x&quot;
comma
id|init_data-&gt;max_output_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;maot%4x&quot;
comma
id|init_data-&gt;max_output_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;niq:%4x&quot;
comma
id|init_data-&gt;no_input_qs
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;noq:%4x&quot;
comma
id|init_data-&gt;no_output_qs
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_handler
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_handler
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;int_parm
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;flags
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_sbal_addr_array
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_sbal_addr_array
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* sanity checks */
r_if
c_cond
(paren
id|qdio_get_irq_ptr
c_func
(paren
id|init_data-&gt;irq
)paren
)paren
(brace
id|result
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ioinfo
(braket
id|init_data-&gt;irq
)braket
op_eq
id|INVALID_STORAGE_AREA
)paren
(brace
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ioinfo
(braket
id|init_data-&gt;irq
)braket
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;ioinfo[%i] is NULL!&bslash;n&quot;
comma
id|init_data-&gt;irq
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|macro|DEVSTAT_FLAG_IRQ_QDIO
mdefine_line|#define DEVSTAT_FLAG_IRQ_QDIO ~0UL
r_if
c_cond
(paren
op_logical_neg
(paren
id|ioinfo
(braket
id|init_data-&gt;irq
)braket
op_member_access_from_pointer
id|devstat.flag
op_amp
id|DEVSTAT_FLAG_IRQ_QDIO
)paren
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;ioinfo[%i]-&gt;devstat.flag=0x%08x&bslash;n&quot;
comma
id|init_data-&gt;irq
comma
id|ioinfo
(braket
id|init_data-&gt;irq
)braket
op_member_access_from_pointer
id|devstat.flag
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|init_data-&gt;no_input_qs
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
op_logical_or
(paren
id|init_data-&gt;no_output_qs
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
op_logical_or
(paren
(paren
id|init_data-&gt;no_input_qs
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;input_handler
)paren
)paren
op_logical_or
(paren
(paren
id|init_data-&gt;no_output_qs
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;output_handler
)paren
)paren
)paren
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|init_data-&gt;flags
op_amp
id|QDIO_INBOUND_0COPY_SBALS
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;input_sbal_addr_array
)paren
)paren
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|init_data-&gt;flags
op_amp
id|QDIO_OUTBOUND_0COPY_SBALS
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;output_sbal_addr_array
)paren
)paren
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* create irq */
id|irq_ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|qdio_irq_t
)paren
comma
id|GFP_DMA
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;irq_ptr:&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of irq_ptr failed!&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|irq_ptr
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_irq_t
)paren
)paren
suffix:semicolon
multiline_comment|/* wipes qib.ac,&n;&t;&t;&t;&t;&t;&t; required by ar7063 */
id|irq_ptr-&gt;qdr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|qdr_t
)paren
comma
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_ptr-&gt;qdr
)paren
)paren
(brace
id|kfree
c_func
(paren
id|irq_ptr-&gt;qdr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of irq_ptr-&gt;qdr failed!&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|irq_ptr-&gt;qdr
comma
l_int|0
comma
r_sizeof
(paren
id|qdr_t
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;qdr:&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;qdr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|irq_ptr-&gt;wait_q
)paren
suffix:semicolon
id|irq_ptr-&gt;int_parm
op_assign
id|init_data-&gt;int_parm
suffix:semicolon
id|irq_ptr-&gt;irq
op_assign
id|init_data-&gt;irq
suffix:semicolon
id|irq_ptr-&gt;no_input_qs
op_assign
id|init_data-&gt;no_input_qs
suffix:semicolon
id|irq_ptr-&gt;no_output_qs
op_assign
id|init_data-&gt;no_output_qs
suffix:semicolon
id|irq_ptr-&gt;is_iqdio_irq
op_assign
(paren
id|init_data-&gt;q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;is_iqdio_irq
)paren
(brace
id|irq_ptr-&gt;dev_st_chg_ind
op_assign
id|qdio_get_indicator
c_func
(paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX1
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;dev_st_chg_ind
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;dev_st_chg_ind
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;no indicator location available &quot;
"&bslash;"
l_string|&quot;for irq 0x%x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
multiline_comment|/* defaults */
id|irq_ptr-&gt;commands.eq
op_assign
id|DEFAULT_ESTABLISH_QS_CMD
suffix:semicolon
id|irq_ptr-&gt;commands.count_eq
op_assign
id|DEFAULT_ESTABLISH_QS_COUNT
suffix:semicolon
id|irq_ptr-&gt;commands.aq
op_assign
id|DEFAULT_ACTIVATE_QS_CMD
suffix:semicolon
id|irq_ptr-&gt;commands.count_aq
op_assign
id|DEFAULT_ACTIVATE_QS_COUNT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_alloc_qs
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;input_handler
comma
id|init_data-&gt;output_handler
comma
id|init_data-&gt;int_parm
comma
id|init_data-&gt;q_format
comma
id|init_data-&gt;flags
comma
id|init_data-&gt;input_sbal_addr_array
comma
id|init_data-&gt;output_sbal_addr_array
)paren
)paren
(brace
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
id|irq_ptr-&gt;setting_up_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;MOD_INC_&quot;
)paren
suffix:semicolon
id|my_spin_lock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_insert_irq_ptr
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|qdio_fill_thresholds
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;min_input_threshold
comma
id|init_data-&gt;max_input_threshold
comma
id|init_data-&gt;min_output_threshold
comma
id|init_data-&gt;max_output_threshold
)paren
suffix:semicolon
multiline_comment|/* fill in qdr */
id|irq_ptr-&gt;qdr-&gt;qfmt
op_assign
id|init_data-&gt;q_format
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;iqdcnt
op_assign
id|init_data-&gt;no_input_qs
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;oqdcnt
op_assign
id|init_data-&gt;no_output_qs
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;iqdsz
op_assign
r_sizeof
(paren
id|qdesfmt0_t
)paren
op_div
l_int|4
suffix:semicolon
multiline_comment|/* size in words */
id|irq_ptr-&gt;qdr-&gt;oqdsz
op_assign
r_sizeof
(paren
id|qdesfmt0_t
)paren
op_div
l_int|4
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qiba
op_assign
(paren
r_int
r_int
)paren
op_amp
id|irq_ptr-&gt;qib
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
multiline_comment|/* fill in qib */
id|irq_ptr-&gt;qib.qfmt
op_assign
id|init_data-&gt;q_format
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;no_input_qs
)paren
id|irq_ptr-&gt;qib.isliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;no_output_qs
)paren
id|irq_ptr-&gt;qib.osliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|irq_ptr-&gt;qib.ebcnam
comma
id|init_data-&gt;adapter_name
comma
l_int|8
)paren
suffix:semicolon
id|qdio_set_impl_params
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;qib_param_field_format
comma
id|init_data-&gt;qib_param_field
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;input_slib_elements
comma
id|init_data-&gt;output_slib_elements
)paren
suffix:semicolon
multiline_comment|/* first input descriptors, then output descriptors */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_iqdio_q
op_assign
(paren
id|init_data-&gt;q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|sliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sl
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|akey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|bkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|ckey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|dkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_iqdio_q
op_assign
(paren
id|init_data-&gt;q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|sliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sl
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|akey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|bkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|ckey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|init_data-&gt;no_input_qs
)braket
dot
id|dkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
)brace
multiline_comment|/* qdr, qib, sls, slsbs, slibs, sbales filled. */
id|my_s390irq_spin_lock_irqsave
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
multiline_comment|/* keep track of original int handler */
id|irq_ptr-&gt;original_int_handler
op_assign
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|irq_desc.handler
suffix:semicolon
multiline_comment|/* insert qdio int handler */
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|irq_desc.handler
op_assign
(paren
r_void
op_star
)paren
id|qdio_handler
suffix:semicolon
id|my_s390irq_spin_unlock_irqrestore
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
DECL|macro|TAKEOVER_CIW
mdefine_line|#define TAKEOVER_CIW(x) irq_ptr-&gt;commands.##x=ioinfo[irq_ptr-&gt;irq]-&gt;senseid.ciw[ciw_cnt].cmd; irq_ptr-&gt;commands.count_##x=ioinfo[irq_ptr-&gt;irq]-&gt;senseid.ciw[ciw_cnt].count
multiline_comment|/* get qdio commands */
id|found
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|ciw_cnt
op_assign
l_int|0
suffix:semicolon
id|ciw_cnt
OL
id|MAX_CIWS
suffix:semicolon
id|ciw_cnt
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|senseid.ciw
(braket
id|ciw_cnt
)braket
dot
id|ct
)paren
(brace
r_case
id|CIW_TYPE_RCD
suffix:colon
id|TAKEOVER_CIW
c_func
(paren
id|rcd
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CIW_TYPE_SII
suffix:colon
id|TAKEOVER_CIW
c_func
(paren
id|sii
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CIW_TYPE_RNI
suffix:colon
id|TAKEOVER_CIW
c_func
(paren
id|rni
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CIW_TYPE_EQUEUE
suffix:colon
id|TAKEOVER_CIW
c_func
(paren
id|eq
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CIW_TYPE_AQUEUE
suffix:colon
id|TAKEOVER_CIW
c_func
(paren
id|aq
)paren
suffix:semicolon
id|found
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ciw_cnt
OG
l_int|0
)paren
op_logical_and
(paren
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|senseid.ciw
(braket
id|ciw_cnt
)braket
dot
id|ct
op_eq
l_int|0
)paren
op_logical_and
(paren
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|senseid.ciw
(braket
id|ciw_cnt
)braket
dot
id|cmd
op_eq
l_int|0
)paren
op_logical_and
(paren
id|ioinfo
(braket
id|irq_ptr-&gt;irq
)braket
op_member_access_from_pointer
id|senseid.ciw
(braket
id|ciw_cnt
)braket
dot
id|count
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|found
OL
l_int|2
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;no ciws&quot;
)paren
suffix:semicolon
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;No CIWs found for QDIO commands. Trying to &quot;
"&bslash;"
l_string|&quot;use defaults.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* the iqdio CHSC stuff */
r_if
c_cond
(paren
id|irq_ptr-&gt;is_iqdio_irq
)paren
(brace
multiline_comment|/*&t;&t;iqdio_enable_adapter_int_facility(irq_ptr);*/
r_if
c_cond
(paren
id|iqdio_check_chsc_availability
c_func
(paren
)paren
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;Not all CHSCs supported. &quot;
"&bslash;"
l_string|&quot;Continuing.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|result
op_assign
id|iqdio_set_subchannel_ind
c_func
(paren
id|irq_ptr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_cleanup
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
id|iqdio_set_delay_target
c_func
(paren
id|irq_ptr
comma
id|IQDIO_DELAY_TARGET
)paren
suffix:semicolon
)brace
multiline_comment|/* establish q */
id|irq_ptr-&gt;ccw.cmd_code
op_assign
id|irq_ptr-&gt;commands.eq
suffix:semicolon
id|irq_ptr-&gt;ccw.flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|irq_ptr-&gt;ccw.count
op_assign
id|irq_ptr-&gt;commands.count_eq
suffix:semicolon
id|irq_ptr-&gt;ccw.cda
op_assign
id|QDIO_GET_ADDR
c_func
(paren
id|irq_ptr-&gt;qdr
)paren
suffix:semicolon
id|my_s390irq_spin_lock_irqsave
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_arrived
comma
l_int|0
)paren
suffix:semicolon
id|result
op_assign
id|do_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ESTABLISH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|result2
op_assign
id|do_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ESTABLISH
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;eq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;eq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
)brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;establish queues on irq %04x: do_IO &quot;
"&bslash;"
l_string|&quot;returned %i, next try returned %i&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
comma
id|result2
)paren
suffix:semicolon
id|result
op_assign
id|result2
suffix:semicolon
)brace
id|my_s390irq_spin_unlock_irqrestore
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_cleanup
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
id|result
op_assign
id|qdio_sleepon
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_arrived
comma
id|QDIO_ESTABLISH_TIMEOUT
comma
id|irq_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: timed out&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:timeo&quot;
)paren
suffix:semicolon
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_cleanup
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_ptr-&gt;io_result_dstat
op_amp
id|DEV_STAT_DEV_END
)paren
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:no de&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_dstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_dstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_cstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_cstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_flags
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_flags
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: didn&squot;t get &quot;
"&bslash;"
l_string|&quot;device end: dstat=%02x, cstat=%02x, &quot;
"&bslash;"
l_string|&quot;flags=%02x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|irq_ptr-&gt;io_result_dstat
comma
id|irq_ptr-&gt;io_result_cstat
comma
id|irq_ptr-&gt;io_result_flags
)paren
suffix:semicolon
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
id|qdio_cleanup
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;io_result_dstat
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:badio&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_dstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_dstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_cstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_cstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_flags
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_flags
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: got &quot;
"&bslash;"
l_string|&quot;the following devstat: dstat=%02x, &quot;
"&bslash;"
l_string|&quot;cstat=%02x, flags=%02x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|irq_ptr-&gt;io_result_dstat
comma
id|irq_ptr-&gt;io_result_cstat
comma
id|irq_ptr-&gt;io_result_flags
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|MACHINE_IS_VM
)paren
id|irq_ptr-&gt;qdioac
op_assign
id|qdio_check_siga_needs
c_func
(paren
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
r_else
(brace
id|irq_ptr-&gt;qdioac
op_assign
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qdioac%2x&quot;
comma
id|irq_ptr-&gt;qdioac
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qib ac%2x&quot;
comma
id|irq_ptr-&gt;qib.ac
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;flags
op_amp
id|QDIO_USE_OUTBOUND_PCIS
)paren
(brace
id|irq_ptr-&gt;hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;qib.ac
op_amp
id|QIB_AC_OUTBOUND_PCI_SUPPORTED
suffix:semicolon
)brace
r_else
(brace
id|irq_ptr-&gt;hydra_gives_outbound_pcis
op_assign
l_int|0
suffix:semicolon
)brace
id|irq_ptr-&gt;sync_done_on_outb_pcis
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_in
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_out
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_thinints
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;hydra_gives_outbound_pcis
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_in
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_out
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_thinints
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;hydra_gives_outbound_pcis
suffix:semicolon
)brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ESTABLISHED
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|irq_ptr
)paren
(brace
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
)brace
id|out2
suffix:colon
id|up
c_func
(paren
op_amp
id|init_sema
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|qdio_activate
r_int
id|qdio_activate
c_func
(paren
r_int
id|irq
comma
r_int
id|flags
)paren
(brace
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_int
id|i
comma
id|result
op_assign
l_int|0
comma
id|result2
suffix:semicolon
r_int
r_int
id|saveflags
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* see qdio_initialize */
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|my_spin_lock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_INACTIVE
)paren
(brace
id|result
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qact%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
multiline_comment|/* activate q */
id|irq_ptr-&gt;ccw.cmd_code
op_assign
id|irq_ptr-&gt;commands.aq
suffix:semicolon
id|irq_ptr-&gt;ccw.flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|irq_ptr-&gt;ccw.count
op_assign
id|irq_ptr-&gt;commands.count_aq
suffix:semicolon
id|irq_ptr-&gt;ccw.cda
op_assign
id|QDIO_GET_ADDR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|my_s390irq_spin_lock_irqsave
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_arrived
comma
l_int|0
)paren
suffix:semicolon
id|result
op_assign
id|do_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ACTIVATE
comma
l_int|0
comma
id|DOIO_REPORT_ALL
op_or
id|DOIO_DENY_PREFETCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|result2
op_assign
id|do_IO
c_func
(paren
id|irq_ptr-&gt;irq
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ACTIVATE
comma
l_int|0
comma
id|DOIO_REPORT_ALL
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;aq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;aq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
)brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;activate queues on irq %04x: do_IO &quot;
"&bslash;"
l_string|&quot;returned %i, next try returned %i&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
comma
id|result2
)paren
suffix:semicolon
id|result
op_assign
id|result2
suffix:semicolon
)brace
id|my_s390irq_spin_unlock_irqrestore
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|QDIO_FLAG_UNDER_INTERRUPT
)paren
)paren
(brace
id|result
op_assign
id|qdio_sleepon
c_func
(paren
op_amp
id|irq_ptr-&gt;interrupt_has_arrived
comma
id|QDIO_ACTIVATE_TIMEOUT
comma
id|irq_ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
op_minus
id|ETIME
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;aq:badio&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_dstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_dstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_cstat
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_cstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;io_result_flags
comma
r_sizeof
(paren
id|irq_ptr-&gt;io_result_flags
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;activate queues on irq %04x: got &quot;
"&bslash;"
l_string|&quot;the following devstat: dstat=%02x, &quot;
"&bslash;"
l_string|&quot;cstat=%02x, flags=%02x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|irq_ptr-&gt;io_result_dstat
comma
id|irq_ptr-&gt;io_result_cstat
comma
id|irq_ptr-&gt;io_result_flags
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* result is -ETIME, but timeout is ok for us */
id|result
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|result
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;is_iqdio_irq
)paren
(brace
multiline_comment|/* that way we know, that, if we will&n;&t;&t;&t; * get interrupted&n;&t;&t;&t; * by iqdio_inbound_processing,&n;&t;&t;&t; * qdio_unmark_q will&n;&t;&t;&t; * not be called */
id|qdio_reserve_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|qdio_mark_iq
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|qdio_release_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_input_q
op_or_assign
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
suffix:semicolon
)brace
)brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ACTIVE
)paren
suffix:semicolon
id|out
suffix:colon
id|my_spin_unlock
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* buffers filled forwards again to make Rick happy */
DECL|function|qdio_do_qdio_fill_input
r_static
r_void
id|qdio_do_qdio_fill_input
c_func
(paren
id|qdio_q_t
op_star
id|q
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
id|qdio_buffer_t
op_star
id|buffers
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;is_0copy_sbals_q
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
id|qidx
)braket
comma
id|buffers
comma
id|SBAL_SIZE
)paren
suffix:semicolon
id|q-&gt;qdio_buffers
(braket
id|qidx
)braket
op_assign
id|buffers
suffix:semicolon
id|buffers
op_increment
suffix:semicolon
)brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|qidx
)braket
comma
id|SLSB_CU_INPUT_EMPTY
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_break
suffix:semicolon
id|qidx
op_assign
(paren
id|qidx
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* not necessary, as the queues are synced during the SIGA read&n;&t;SYNC_MEMORY;*/
)brace
DECL|function|qdio_do_qdio_fill_output
r_static
r_inline
r_void
id|qdio_do_qdio_fill_output
c_func
(paren
id|qdio_q_t
op_star
id|q
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
id|qdio_buffer_t
op_star
id|buffers
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;is_0copy_sbals_q
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
id|qidx
)braket
comma
id|buffers
comma
id|SBAL_SIZE
)paren
suffix:semicolon
id|q-&gt;qdio_buffers
(braket
id|qidx
)braket
op_assign
id|buffers
suffix:semicolon
id|buffers
op_increment
suffix:semicolon
)brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|qidx
)braket
comma
id|SLSB_CU_OUTPUT_PRIMED
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_break
suffix:semicolon
id|qidx
op_assign
(paren
id|qidx
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* SIGA write will sync the queues&n;&t;SYNC_MEMORY;*/
)brace
multiline_comment|/* count must be 1 in iqdio */
DECL|function|do_QDIO
r_int
id|do_QDIO
c_func
(paren
r_int
id|irq
comma
r_int
r_int
id|callflags
comma
r_int
r_int
id|queue_number
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
id|qdio_buffer_t
op_star
id|buffers
)paren
(brace
id|qdio_q_t
op_star
id|q
suffix:semicolon
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
id|used_elements
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;doQD%04x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
(paren
id|qidx
OG
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_or
(paren
id|count
OG
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_or
(paren
id|queue_number
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|irq_ptr
op_assign
id|qdio_get_irq_ptr
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_else
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;flag%04x&quot;
comma
id|callflags
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qi%02xct%02x&quot;
comma
id|qidx
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
op_logical_and
(paren
op_logical_neg
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
op_member_access_from_pointer
id|is_0copy_sbals_q
)paren
)paren
op_logical_or
(paren
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
op_logical_and
(paren
op_logical_neg
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
op_member_access_from_pointer
id|is_0copy_sbals_q
)paren
)paren
)paren
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|sbal
comma
id|buffers
comma
l_int|256
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_ne
id|QDIO_IRQ_STATE_ACTIVE
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
(brace
multiline_comment|/* This is the inbound handling of queues */
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
suffix:semicolon
id|used_elements
op_assign
id|atomic_return_add
c_func
(paren
id|count
comma
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
id|qdio_do_qdio_fill_input
c_func
(paren
id|q
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|used_elements
op_plus
id|count
op_eq
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_and
(paren
id|callflags
op_amp
id|QDIO_FLAG_UNDER_INTERRUPT
)paren
)paren
id|atomic_swap
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|used_elements
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|callflags
op_amp
id|QDIO_FLAG_DONT_SIGA
)paren
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;siga_in
)paren
(brace
id|result
op_assign
id|qdio_siga_input
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;siga_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_SIGA_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
id|q-&gt;siga_error
op_assign
id|result
suffix:semicolon
)brace
)brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
(brace
multiline_comment|/* This is the outbound handling of queues */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.start_time_outbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
suffix:semicolon
id|qdio_do_qdio_fill_output
c_func
(paren
id|q
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
id|used_elements
op_assign
id|atomic_return_add
c_func
(paren
id|count
comma
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|callflags
op_amp
id|QDIO_FLAG_DONT_SIGA
)paren
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;is_iqdio_q
)paren
(brace
multiline_comment|/* one siga for every sbal */
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|qdio_kick_outbound_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
id|qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* under VM, we do a SIGA sync&n;&t;&t;&t;&t; * unconditionally */
id|SYNC_MEMORY
suffix:semicolon
r_else
(brace
multiline_comment|/* w/o shadow queues (else branch of&n;&t;&t;&t;&t;&t; * SYNC_MEMORY :-/ ), we try to&n;&t;&t;&t;&t;&t; * fast-requeue buffers */
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
(paren
id|qidx
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)braket
op_ne
id|SLSB_CU_OUTPUT_PRIMED
)paren
(brace
id|qdio_kick_outbound_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;fast-req&quot;
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.fast_reqs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
)brace
multiline_comment|/* only marking the q could take&n;&t;&t;&t;&t; * too long, the upper layer&n;&t;&t;&t;&t; * module could do a lot of&n;&t;&t;&t;&t; * traffic in that time */
id|qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.outbound_time
op_add_assign
id|NOW
op_minus
id|perf_stats.start_time_outbound
suffix:semicolon
id|perf_stats.outbound_cnt
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
r_else
(brace
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;doQD:inv&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
DECL|function|qdio_perf_procfile_read
r_static
r_int
id|qdio_perf_procfile_read
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|buffer_location
comma
id|off_t
id|offset
comma
r_int
id|buffer_length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|c
op_assign
l_int|0
suffix:semicolon
id|qdio_irq_t
op_star
id|irq_ptr
suffix:semicolon
multiline_comment|/* we are always called with buffer_length=4k, so we all&n;           deliver on the first read */
r_if
c_cond
(paren
id|offset
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: wtf are you trying to do? this is guaranteed to&n;&t; * fail, you even get a compiler warning! */
id|irq_ptr
op_assign
id|first_irq
suffix:semicolon
DECL|macro|_OUTP_IT
mdefine_line|#define _OUTP_IT(x...) c+=sprintf(buffer+c,x)
id|_OUTP_IT
c_func
(paren
l_string|&quot;i_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|i_p_nc
comma
id|i_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;ii_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|ii_p_nc
comma
id|ii_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;o_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|o_p_nc
comma
id|o_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of tasklet runs (total)                  : %u&bslash;n&quot;
comma
id|perf_stats.tl_runs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA sync&squot;s issued                    : %u&bslash;n&quot;
comma
id|perf_stats.siga_syncs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA in&squot;s issued                      : %u&bslash;n&quot;
comma
id|perf_stats.siga_ins
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA out&squot;s issued                     : %u&bslash;n&quot;
comma
id|perf_stats.siga_outs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of PCI&squot;s caught                          : %u&bslash;n&quot;
comma
id|perf_stats.pcis
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of adapter interrupts caught             : %u&bslash;n&quot;
comma
id|perf_stats.thinints
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of fast requeues (outg. SBALs w/o SIGA)  : %u&bslash;n&quot;
comma
id|perf_stats.fast_reqs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Total time of all inbound actions (us) incl. UL : %u&bslash;n&quot;
comma
id|perf_stats.inbound_time
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of inbound transfers                     : %u&bslash;n&quot;
comma
id|perf_stats.inbound_cnt
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Total time of all outbound do_QDIOs (us)        : %u&bslash;n&quot;
comma
id|perf_stats.outbound_time
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of do_QDIOs outbound                     : %u&bslash;n&quot;
comma
id|perf_stats.outbound_cnt
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|irq_ptr
)paren
(brace
id|_OUTP_IT
c_func
(paren
l_string|&quot;Polling time on irq %4x                        &quot;
"&bslash;"
l_string|&quot;: %u&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|irq_ptr-&gt;input_qs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|timing.threshold
)paren
suffix:semicolon
id|irq_ptr
op_assign
id|irq_ptr-&gt;next
suffix:semicolon
)brace
r_return
id|c
suffix:semicolon
)brace
DECL|variable|qdio_perf_proc_file
r_static
r_struct
id|proc_dir_entry
op_star
id|qdio_perf_proc_file
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
DECL|function|qdio_add_procfs_entry
r_static
r_void
id|qdio_add_procfs_entry
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|proc_perf_file_registration
op_assign
l_int|0
suffix:semicolon
id|qdio_perf_proc_file
op_assign
id|create_proc_entry
c_func
(paren
id|QDIO_PERF
comma
id|S_IFREG
op_or
l_int|0444
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_perf_proc_file
)paren
(brace
id|qdio_perf_proc_file-&gt;read_proc
op_assign
op_amp
id|qdio_perf_procfile_read
suffix:semicolon
)brace
r_else
id|proc_perf_file_registration
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|proc_perf_file_registration
)paren
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;was not able to register perf. &quot;
"&bslash;"
l_string|&quot;proc-file (%i).&bslash;n&quot;
comma
id|proc_perf_file_registration
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
macro_line|#ifdef MODULE
DECL|function|qdio_remove_procfs_entry
r_static
r_void
id|qdio_remove_procfs_entry
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_perf_file_registration
)paren
multiline_comment|/* means if it went ok earlier */
id|remove_proc_entry
c_func
(paren
id|QDIO_PERF
comma
op_amp
id|proc_root
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
macro_line|#endif /* MODULE */
DECL|function|iqdio_register_thinints
r_static
r_void
id|iqdio_register_thinints
c_func
(paren
r_void
)paren
(brace
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|register_thinint_result
op_assign
id|s390_register_adapter_interrupt
c_func
(paren
op_amp
id|iqdio_thinint_handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_thinint_result
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;regthn%x&quot;
comma
(paren
id|register_thinint_result
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;failed to register adapter handler &quot;
"&bslash;"
l_string|&quot;(rc=%i).&bslash;nAdapter interrupts might &quot;
"&bslash;"
l_string|&quot;not work. Continuing.&bslash;n&quot;
comma
id|register_thinint_result
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef MODULE
DECL|function|iqdio_unregister_thinints
r_static
r_void
id|iqdio_unregister_thinints
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|register_thinint_result
)paren
id|s390_unregister_adapter_interrupt
c_func
(paren
op_amp
id|iqdio_thinint_handler
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
DECL|function|qdio_get_qdio_memory
r_static
r_int
id|qdio_get_qdio_memory
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|indicator_used
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|INDICATORS_PER_CACHELINE
suffix:semicolon
id|i
op_increment
)paren
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|indicators
op_assign
(paren
id|__u32
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|__u32
)paren
op_star
(paren
id|INDICATORS_PER_CACHELINE
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|indicators
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|indicators
comma
l_int|0
comma
r_sizeof
(paren
id|__u32
)paren
op_star
(paren
id|INDICATORS_PER_CACHELINE
)paren
)paren
suffix:semicolon
id|chsc_area
op_assign
(paren
id|qdio_chsc_area_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;chscarea&quot;
)paren
suffix:semicolon
"&bslash;"
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|chsc_area
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
"&bslash;"
r_if
c_cond
(paren
op_logical_neg
id|chsc_area
)paren
(brace
multiline_comment|/* ahem... let&squot;s call it data area */
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;not enough memory for data area. Cannot &quot;
"&bslash;"
l_string|&quot;initialize QDIO.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|indicators
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|chsc_area
comma
l_int|0
comma
r_sizeof
(paren
id|qdio_chsc_area_t
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|qdio_release_qdio_memory
r_static
r_void
id|qdio_release_qdio_memory
c_func
(paren
r_void
)paren
(brace
id|kfree
c_func
(paren
id|chsc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|indicators
)paren
id|kfree
c_func
(paren
id|indicators
)paren
suffix:semicolon
)brace
macro_line|#endif /* MODULE */
r_int
id|init_module
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* we want to use it in init_QDIO */
DECL|function|qdio_unregister_dbf_views
r_static
r_void
id|qdio_unregister_dbf_views
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|qdio_dbf_setup
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_sbal
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_sbal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_sense
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_sense
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_trace
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_trace
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
r_if
c_cond
(paren
id|qdio_dbf_slsb_out
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_slsb_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_slsb_in
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_slsb_in
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
)brace
multiline_comment|/* this is not __initfunc, as it is called from init_module */
DECL|function|init_QDIO
r_static
r_int
id|__init
id|init_QDIO
c_func
(paren
r_void
)paren
(brace
r_int
id|res
suffix:semicolon
macro_line|#if defined(MODULE)||defined(QDIO_PERFORMANCE_STATS)
r_void
op_star
id|ptr
suffix:semicolon
macro_line|#endif /* defined(MODULE)||defined(QDIO_PERFORMANCE_STATS) */
id|qdio_eyecatcher
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qdio: loading %s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|res
op_assign
id|qdio_get_qdio_memory
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_return
id|res
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|init_sema
comma
l_int|1
)paren
suffix:semicolon
id|qdio_dbf_setup
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SETUP_NAME
comma
id|QDIO_DBF_SETUP_INDEX
comma
id|QDIO_DBF_SETUP_NR_AREAS
comma
id|QDIO_DBF_SETUP_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_setup
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_setup
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_setup
comma
id|QDIO_DBF_SETUP_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_sbal
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SBAL_NAME
comma
id|QDIO_DBF_SBAL_INDEX
comma
id|QDIO_DBF_SBAL_NR_AREAS
comma
id|QDIO_DBF_SBAL_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_sbal
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_sbal
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_sbal
comma
id|QDIO_DBF_SBAL_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_sense
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SENSE_NAME
comma
id|QDIO_DBF_SENSE_INDEX
comma
id|QDIO_DBF_SENSE_NR_AREAS
comma
id|QDIO_DBF_SENSE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_sense
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_sense
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_sense
comma
id|QDIO_DBF_SENSE_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_trace
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_TRACE_NAME
comma
id|QDIO_DBF_TRACE_INDEX
comma
id|QDIO_DBF_TRACE_NR_AREAS
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_trace
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_trace
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_trace
comma
id|QDIO_DBF_TRACE_LEVEL
)paren
suffix:semicolon
macro_line|#ifdef QDIO_DBF_LIKE_HELL
id|qdio_dbf_slsb_out
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SLSB_OUT_NAME
comma
id|QDIO_DBF_SLSB_OUT_INDEX
comma
id|QDIO_DBF_SLSB_OUT_NR_AREAS
comma
id|QDIO_DBF_SLSB_OUT_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_slsb_out
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_slsb_out
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_slsb_out
comma
id|QDIO_DBF_SLSB_OUT_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_slsb_in
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SLSB_IN_NAME
comma
id|QDIO_DBF_SLSB_IN_INDEX
comma
id|QDIO_DBF_SLSB_IN_NR_AREAS
comma
id|QDIO_DBF_SLSB_IN_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_slsb_in
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_slsb_in
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_slsb_in
comma
id|QDIO_DBF_SLSB_IN_LEVEL
)paren
suffix:semicolon
macro_line|#endif /* QDIO_DBF_LIKE_HELL */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|perf_stats
comma
l_int|0
comma
r_sizeof
(paren
id|perf_stats
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;perfstat&quot;
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|perf_stats
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
macro_line|#ifdef MODULE
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;initmodl&quot;
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|init_module
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
id|qdio_add_procfs_entry
c_func
(paren
)paren
suffix:semicolon
id|iqdio_register_thinints
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|oom
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;not enough memory for dbf.&bslash;n&quot;
)paren
suffix:semicolon
id|qdio_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_return
id|init_QDIO
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
id|iqdio_unregister_thinints
c_func
(paren
)paren
suffix:semicolon
id|qdio_remove_procfs_entry
c_func
(paren
)paren
suffix:semicolon
id|qdio_release_qdio_memory
c_func
(paren
)paren
suffix:semicolon
id|qdio_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qdio: %s: module removed&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
)brace
macro_line|#else /* MODULE */
DECL|function|initcall_QDIO
r_static
r_int
id|__init
id|initcall_QDIO
c_func
(paren
r_void
)paren
(brace
r_return
id|init_QDIO
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|initcall_QDIO
id|__initcall
c_func
(paren
id|initcall_QDIO
)paren
suffix:semicolon
macro_line|#endif /* MODULE */
DECL|variable|qdio_initialize
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_initialize
)paren
suffix:semicolon
DECL|variable|qdio_activate
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_activate
)paren
suffix:semicolon
DECL|variable|do_QDIO
id|EXPORT_SYMBOL
c_func
(paren
id|do_QDIO
)paren
suffix:semicolon
DECL|variable|qdio_cleanup
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_cleanup
)paren
suffix:semicolon
DECL|variable|qdio_eyecatcher
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_eyecatcher
)paren
suffix:semicolon
DECL|variable|qdio_synchronize
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_synchronize
)paren
suffix:semicolon
eof
