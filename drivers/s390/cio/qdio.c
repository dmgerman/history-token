multiline_comment|/*&n; *&n; * linux/drivers/s390/cio/qdio.c&n; *&n; * Linux for S/390 QDIO base support, Hipersocket base support&n; * version 2&n; *&n; * Copyright 2000,2002 IBM Corporation&n; * Author(s):             Utz Bacher &lt;utz.bacher@de.ibm.com&gt;&n; * 2.6 cio integration by Cornelia Huck &lt;cohuck@de.ibm.com&gt;&n; *&n; * Restriction: only 63 iqdio subchannels would have its own indicator,&n; * after that, subsequent subchannels share one indicator&n; *&n; *&n; *&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;asm/ccwdev.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/timex.h&gt;
macro_line|#include &lt;asm/debug.h&gt;
macro_line|#include &lt;asm/qdio.h&gt;
macro_line|#include &quot;cio.h&quot;
macro_line|#include &quot;css.h&quot;
macro_line|#include &quot;device.h&quot;
macro_line|#include &quot;airq.h&quot;
macro_line|#include &quot;qdio.h&quot;
macro_line|#include &quot;ioasm.h&quot;
macro_line|#include &quot;chsc.h&quot;
DECL|macro|VERSION_QDIO_C
mdefine_line|#define VERSION_QDIO_C &quot;$Revision: 1.94 $&quot;
multiline_comment|/****************** MODULE PARAMETER VARIABLES ********************/
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Utz Bacher &lt;utz.bacher@de.ibm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;QDIO base support version 2, &quot;
"&bslash;"
l_string|&quot;Copyright 2000 IBM Corporation&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/******************** HERE WE GO ***********************************/
DECL|variable|version
r_static
r_const
r_char
id|version
(braket
)braket
op_assign
l_string|&quot;QDIO base support version 2 (&quot;
id|VERSION_QDIO_C
l_string|&quot;/&quot;
id|VERSION_QDIO_H
l_string|&quot;/&quot;
id|VERSION_CIO_QDIO_H
l_string|&quot;)&quot;
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
DECL|variable|proc_perf_file_registration
r_static
r_int
id|proc_perf_file_registration
suffix:semicolon
DECL|variable|i_p_c
DECL|variable|i_p_nc
DECL|variable|o_p_c
DECL|variable|o_p_nc
DECL|variable|ii_p_c
DECL|variable|ii_p_nc
r_static
r_int
r_int
id|i_p_c
comma
id|i_p_nc
comma
id|o_p_c
comma
id|o_p_nc
comma
id|ii_p_c
comma
id|ii_p_nc
suffix:semicolon
DECL|variable|perf_stats
r_static
r_struct
id|qdio_perf_stats
id|perf_stats
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
DECL|variable|hydra_thinints
r_static
r_int
id|hydra_thinints
suffix:semicolon
DECL|variable|omit_svs
r_static
r_int
id|omit_svs
suffix:semicolon
DECL|variable|indicator_used
r_static
r_int
id|indicator_used
(braket
id|INDICATORS_PER_CACHELINE
)braket
suffix:semicolon
DECL|variable|indicators
r_static
id|__u32
op_star
r_volatile
id|indicators
suffix:semicolon
DECL|variable|spare_indicator
r_static
id|__u32
r_volatile
id|spare_indicator
suffix:semicolon
DECL|variable|spare_indicator_usecount
r_static
id|atomic_t
id|spare_indicator_usecount
suffix:semicolon
DECL|variable|qdio_dbf_setup
r_static
id|debug_info_t
op_star
id|qdio_dbf_setup
suffix:semicolon
DECL|variable|qdio_dbf_sbal
r_static
id|debug_info_t
op_star
id|qdio_dbf_sbal
suffix:semicolon
DECL|variable|qdio_dbf_trace
r_static
id|debug_info_t
op_star
id|qdio_dbf_trace
suffix:semicolon
DECL|variable|qdio_dbf_sense
r_static
id|debug_info_t
op_star
id|qdio_dbf_sense
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
DECL|variable|qdio_dbf_slsb_out
r_static
id|debug_info_t
op_star
id|qdio_dbf_slsb_out
suffix:semicolon
DECL|variable|qdio_dbf_slsb_in
r_static
id|debug_info_t
op_star
id|qdio_dbf_slsb_in
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
multiline_comment|/* iQDIO stuff: */
DECL|variable|tiq_list
r_static
r_volatile
r_struct
id|qdio_q
op_star
id|tiq_list
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* volatile as it could change&n;&t;&t;&t;&t;&t;&t; during a while loop */
DECL|variable|ttiq_list_lock
r_static
id|spinlock_t
id|ttiq_list_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|register_thinint_result
r_static
r_int
id|register_thinint_result
suffix:semicolon
r_static
r_void
id|tiqdio_tl
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
id|DECLARE_TASKLET
c_func
(paren
id|tiqdio_tasklet
comma
id|tiqdio_tl
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* not a macro, as one of the arguments is atomic_read */
r_static
r_inline
r_int
DECL|function|qdio_min
id|qdio_min
c_func
(paren
r_int
id|a
comma
r_int
id|b
)paren
(brace
r_if
c_cond
(paren
id|a
OL
id|b
)paren
r_return
id|a
suffix:semicolon
r_else
r_return
id|b
suffix:semicolon
)brace
multiline_comment|/***************** SCRUBBER HELPER ROUTINES **********************/
r_static
r_inline
r_volatile
id|__u64
DECL|function|qdio_get_micros
id|qdio_get_micros
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|get_clock
c_func
(paren
)paren
op_rshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* time&gt;&gt;12 is microseconds */
)brace
multiline_comment|/* &n; * unfortunately, we can&squot;t just xchg the values; in do_QDIO we want to reserve&n; * the q in any case, so that we&squot;ll not be interrupted when we are in&n; * qdio_mark_tiq... shouldn&squot;t have a really bad impact, as reserving almost&n; * ever works (last famous words) &n; */
r_static
r_inline
r_int
DECL|function|qdio_reserve_q
id|qdio_reserve_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_return
id|atomic_add_return
c_func
(paren
l_int|1
comma
op_amp
id|q-&gt;use_count
)paren
op_minus
l_int|1
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_release_q
id|qdio_release_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;use_count
)paren
suffix:semicolon
)brace
r_static
r_volatile
r_inline
r_void
DECL|function|qdio_set_slsb
id|qdio_set_slsb
c_func
(paren
r_volatile
r_char
op_star
id|slsb
comma
r_int
r_char
id|value
)paren
(brace
id|xchg
c_func
(paren
(paren
r_char
op_star
)paren
id|slsb
comma
id|value
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qdio_siga_sync
id|qdio_siga_sync
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
r_int
id|gpr2
comma
r_int
r_int
id|gpr3
)paren
(brace
r_int
id|cc
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigasync&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_syncs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|cc
op_assign
id|do_siga_sync
c_func
(paren
id|q-&gt;irq
comma
id|gpr2
comma
id|gpr3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qdio_siga_sync_q
id|qdio_siga_sync_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;is_input_q
)paren
r_return
id|qdio_siga_sync
c_func
(paren
id|q
comma
l_int|0
comma
id|q-&gt;mask
)paren
suffix:semicolon
r_return
id|qdio_siga_sync
c_func
(paren
id|q
comma
id|q-&gt;mask
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * returns QDIO_SIGA_ERROR_ACCESS_EXCEPTION as cc, when SIGA returns&n; * an access exception &n; */
r_static
r_inline
r_int
DECL|function|qdio_siga_output
id|qdio_siga_output
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|cc
suffix:semicolon
id|__u32
id|busy_bit
suffix:semicolon
id|__u64
id|start_time
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_outs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigaout&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|cc
op_assign
id|do_siga_output
c_func
(paren
id|q-&gt;irq
comma
id|q-&gt;mask
comma
op_amp
id|busy_bit
)paren
suffix:semicolon
singleline_comment|//QDIO_PRINT_ERR(&quot;cc=%x, busy=%x&bslash;n&quot;,cc,busy_bit);
r_if
c_cond
(paren
(paren
id|cc
op_eq
l_int|2
)paren
op_logical_and
(paren
id|busy_bit
)paren
op_logical_and
(paren
id|q-&gt;is_iqdio_q
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|start_time
)paren
id|start_time
op_assign
id|NOW
suffix:semicolon
r_if
c_cond
(paren
(paren
id|NOW
op_minus
id|start_time
)paren
OG
id|QDIO_BUSY_BIT_PATIENCE
)paren
r_break
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cc
op_eq
l_int|2
)paren
op_logical_and
(paren
id|busy_bit
)paren
)paren
id|cc
op_or_assign
id|QDIO_SIGA_ERROR_B_BIT_SET
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qdio_siga_input
id|qdio_siga_input
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|cc
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;sigain&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.siga_ins
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|cc
op_assign
id|do_siga_input
c_func
(paren
id|q-&gt;irq
comma
id|q-&gt;mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cc
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
multiline_comment|/* locked by the locks in qdio_activate and qdio_cleanup */
r_static
id|__u32
op_star
r_volatile
DECL|function|qdio_get_indicator
id|qdio_get_indicator
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|INDICATORS_PER_CACHELINE
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|indicator_used
(braket
id|i
)braket
)paren
(brace
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
r_return
id|indicators
op_plus
id|i
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|spare_indicator_usecount
)paren
suffix:semicolon
r_return
(paren
id|__u32
op_star
r_volatile
)paren
op_amp
id|spare_indicator
suffix:semicolon
)brace
multiline_comment|/* locked by the locks in qdio_activate and qdio_cleanup */
r_static
r_void
DECL|function|qdio_put_indicator
id|qdio_put_indicator
c_func
(paren
id|__u32
op_star
id|addr
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
)paren
op_logical_and
(paren
id|addr
op_ne
op_amp
id|spare_indicator
)paren
)paren
(brace
id|i
op_assign
id|addr
op_minus
id|indicators
suffix:semicolon
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr
op_eq
op_amp
id|spare_indicator
)paren
id|atomic_dec
c_func
(paren
op_amp
id|spare_indicator_usecount
)paren
suffix:semicolon
)brace
r_static
r_inline
r_volatile
r_void
DECL|function|tiqdio_clear_summary_bit
id|tiqdio_clear_summary_bit
c_func
(paren
id|__u32
op_star
id|location
)paren
(brace
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;clrsummb&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|location
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|xchg
c_func
(paren
id|location
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_inline
r_volatile
r_void
DECL|function|tiqdio_set_summary_bit
id|tiqdio_set_summary_bit
c_func
(paren
id|__u32
op_star
id|location
)paren
(brace
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;setsummb&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|location
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|xchg
c_func
(paren
id|location
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|tiqdio_sched_tl
id|tiqdio_sched_tl
c_func
(paren
r_void
)paren
(brace
id|tasklet_hi_schedule
c_func
(paren
op_amp
id|tiqdio_tasklet
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_mark_tiq
id|qdio_mark_tiq
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;mark iq&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ttiq_list_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;is_input_q
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|q-&gt;list_prev
)paren
op_logical_or
(paren
id|q-&gt;list_next
)paren
)paren
r_goto
id|out_unlock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tiq_list
)paren
(brace
id|tiq_list
op_assign
id|q
suffix:semicolon
id|q-&gt;list_prev
op_assign
id|q
suffix:semicolon
id|q-&gt;list_next
op_assign
id|q
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;list_next
op_assign
id|tiq_list
suffix:semicolon
id|q-&gt;list_prev
op_assign
id|tiq_list-&gt;list_prev
suffix:semicolon
id|tiq_list-&gt;list_prev-&gt;list_next
op_assign
id|q
suffix:semicolon
id|tiq_list-&gt;list_prev
op_assign
id|q
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ttiq_list_lock
comma
id|flags
)paren
suffix:semicolon
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
id|out_unlock
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ttiq_list_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_mark_q
id|qdio_mark_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;mark q&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
)paren
r_return
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|q-&gt;tasklet
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|qdio_stop_polling
id|qdio_stop_polling
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_int
id|gsf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_swap
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|0
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;stoppoll&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* show the card that we are not polling anymore */
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;is_input_q
)paren
r_return
l_int|1
suffix:semicolon
id|gsf
op_assign
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
suffix:semicolon
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
(paren
id|gsf
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * we don&squot;t issue this SYNC_MEMORY, as we trust Rick T and&n;&t; * moreover will not use the PROCESSING state under VM, so&n;&t; * q-&gt;polling was 0 anyway&n;&t; */
multiline_comment|/*SYNC_MEMORY;*/
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|gsf
)braket
op_ne
id|SLSB_P_INPUT_PRIMED
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* &n;&t; * set our summary bit again, as otherwise there is a&n;&t; * small window we can miss between resetting it and&n;&t; * checking for PRIMED state &n;&t; */
r_if
c_cond
(paren
id|q-&gt;is_thinint_q
)paren
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
macro_line|#else /* QDIO_USE_PROCESSING_STATE */
r_return
l_int|1
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
)brace
multiline_comment|/* &n; * see the comment in do_QDIO and before qdio_reserve_q about the&n; * sophisticated locking outside of unmark_q, so that we don&squot;t need to&n; * disable the interrupts :-) &n;*/
r_static
r_inline
r_void
DECL|function|qdio_unmark_q
id|qdio_unmark_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;unmark q&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;list_prev
)paren
op_logical_or
(paren
op_logical_neg
id|q-&gt;list_next
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|q-&gt;is_thinint_q
)paren
op_logical_and
(paren
id|q-&gt;is_input_q
)paren
)paren
(brace
multiline_comment|/* iQDIO */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ttiq_list_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* in case cleanup has done this already and simultanously&n;&t;&t; * qdio_unmark_q is called from the interrupt handler, we&squot;ve&n;&t;&t; * got to check this in this specific case again */
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;list_prev
)paren
op_logical_or
(paren
op_logical_neg
id|q-&gt;list_next
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;list_next
op_eq
id|q
)paren
(brace
multiline_comment|/* q was the only interesting q */
id|tiq_list
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_next
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_prev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|q-&gt;list_next-&gt;list_prev
op_assign
id|q-&gt;list_prev
suffix:semicolon
id|q-&gt;list_prev-&gt;list_next
op_assign
id|q-&gt;list_next
suffix:semicolon
id|tiq_list
op_assign
id|q-&gt;list_next
suffix:semicolon
id|q-&gt;list_next
op_assign
l_int|NULL
suffix:semicolon
id|q-&gt;list_prev
op_assign
l_int|NULL
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ttiq_list_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
r_int
DECL|function|tiqdio_clear_global_summary
id|tiqdio_clear_global_summary
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|time
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;clrglobl&quot;
)paren
suffix:semicolon
id|time
op_assign
id|do_clear_global_summary
c_func
(paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX5
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|time
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_return
id|time
suffix:semicolon
)brace
multiline_comment|/************************* OUTBOUND ROUTINES *******************************/
r_inline
r_static
r_int
DECL|function|qdio_get_outbound_buffer_frontier
id|qdio_get_outbound_buffer_frontier
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|f
comma
id|f_mod_no
suffix:semicolon
r_volatile
r_char
op_star
id|slsb
suffix:semicolon
r_int
id|first_not_to_check
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;getobfro&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|slsb
op_assign
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_assign
id|q-&gt;first_to_check
suffix:semicolon
multiline_comment|/* &n;&t; * f points to already processed elements, so f+no_used is correct...&n;&t; * ... but: we don&squot;t check 128 buffers, as otherwise&n;&t; * qdio_has_outbound_q_moved would return 0 &n;&t; */
id|first_not_to_check
op_assign
id|f
op_plus
id|qdio_min
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
comma
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;is_iqdio_q
)paren
op_logical_and
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
)paren
id|SYNC_MEMORY
suffix:semicolon
id|check_next
suffix:colon
r_if
c_cond
(paren
id|f
op_eq
id|first_not_to_check
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|slsb
(braket
id|f_mod_no
)braket
)paren
(brace
multiline_comment|/* the adapter has not fetched the output yet */
r_case
id|SLSB_CU_OUTPUT_PRIMED
suffix:colon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpprim&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* the adapter got it */
r_case
id|SLSB_P_OUTPUT_EMPTY
suffix:colon
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
id|f
op_increment
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpempt&quot;
)paren
suffix:semicolon
r_goto
id|check_next
suffix:semicolon
r_case
id|SLSB_P_OUTPUT_ERROR
suffix:colon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outperr&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%x-%x-%x&quot;
comma
id|f_mod_no
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
op_member_access_from_pointer
id|element
(braket
l_int|14
)braket
dot
id|sbalf.value
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
op_member_access_from_pointer
id|element
(braket
l_int|15
)braket
dot
id|sbalf.value
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|sbal
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
comma
l_int|256
)paren
suffix:semicolon
multiline_comment|/* kind of process the buffer */
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_OUTPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/* &n;&t;&t; * we increment the frontier, as this buffer&n;&t;&t; * was processed obviously &n;&t;&t; */
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
id|f_mod_no
op_assign
(paren
id|f_mod_no
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;qdio_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_QDIO_ERROR
suffix:semicolon
id|q-&gt;qdio_error
op_assign
id|SLSB_P_OUTPUT_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* no new buffers */
r_default
suffix:colon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;outpni&quot;
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
(paren
id|q-&gt;first_to_check
op_assign
id|f_mod_no
)paren
suffix:semicolon
)brace
multiline_comment|/* all buffers are processed */
r_inline
r_static
r_int
DECL|function|qdio_is_outbound_q_done
id|qdio_is_outbound_q_done
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_if
c_cond
(paren
id|no_used
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;oqisnt%02x&quot;
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqisdone&quot;
)paren
suffix:semicolon
)brace
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_return
(paren
id|no_used
op_eq
l_int|0
)paren
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|qdio_has_outbound_q_moved
id|qdio_has_outbound_q_moved
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
id|i
op_assign
id|qdio_get_outbound_buffer_frontier
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ne
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
)paren
op_logical_or
(paren
id|q-&gt;error_status_flags
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
)paren
(brace
id|SAVE_FRONTIER
c_func
(paren
id|q
comma
id|i
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqhasmvd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;oqhsntmv&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_inline
r_static
r_void
DECL|function|qdio_kick_outbound_q
id|qdio_kick_outbound_q
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|result
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickoutq&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;siga_out
)paren
r_return
suffix:semicolon
multiline_comment|/* here&squot;s the story with cc=2 and busy bit set (thanks, Rick):&n;&t; * VM&squot;s CP could present us cc=2 and busy bit set on SIGA-write&n;&t; * during reconfiguration of their Guest LAN (only in HIPERS mode,&n;&t; * QDIO mode is asynchronous -- cc=2 and busy bit there will take&n;&t; * the queues down immediately; and not being under VM we have a&n;&t; * problem on cc=2 and busy bit set right away).&n;&t; *&n;&t; * Therefore qdio_siga_output will try for a short time constantly,&n;&t; * if such a condition occurs. If it doesn&squot;t change, it will&n;&t; * increase the busy_siga_counter and save the timestamp, and&n;&t; * schedule the queue for later processing (via mark_q, using the&n;&t; * queue tasklet). __qdio_outbound_processing will check out the&n;&t; * counter. If non-zero, it will call qdio_kick_outbound_q as often&n;&t; * as the value of the counter. This will attempt further SIGA&n;&t; * instructions. For each successful SIGA, the counter is&n;&t; * decreased, for failing SIGAs the counter remains the same, after&n;&t; * all.&n;&t; * After some time of no movement, qdio_kick_outbound_q will&n;&t; * finally fail and reflect corresponding error codes to call&n;&t; * the upper layer module and have it take the queues down.&n;&t; *&n;&t; * Note that this is a change from the original HiperSockets design&n;&t; * (saying cc=2 and busy bit means take the queues down), but in&n;&t; * these days Guest LAN didn&squot;t exist... excessive cc=2 with busy bit&n;&t; * conditions will still take the queues down, but the threshold is&n;&t; * higher due to the Guest LAN environment.&n;&t; */
id|result
op_assign
id|qdio_siga_output
c_func
(paren
id|q
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|result
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* went smooth this time, reset timestamp */
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;cc2reslv&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%4x%2x%2x&quot;
comma
id|q-&gt;irq
comma
id|q-&gt;q_no
comma
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
id|q-&gt;timing.busy_start
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
l_int|2
op_or
id|QDIO_SIGA_ERROR_B_BIT_SET
)paren
suffix:colon
multiline_comment|/* cc=2 and busy bit: */
id|atomic_inc
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
)paren
suffix:semicolon
multiline_comment|/* if the last siga was successful, save&n;&t;&t;&t; * timestamp here */
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;timing.busy_start
)paren
id|q-&gt;timing.busy_start
op_assign
id|NOW
suffix:semicolon
multiline_comment|/* if we&squot;re in time, don&squot;t touch error_status_flags&n;&t;&t;&t; * and siga_error */
r_if
c_cond
(paren
id|NOW
op_minus
id|q-&gt;timing.busy_start
OL
id|QDIO_BUSY_BIT_GIVE_UP
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;cc2REPRT&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%4x%2x%2x&quot;
comma
id|q-&gt;irq
comma
id|q-&gt;q_no
comma
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
multiline_comment|/* else fallthrough and report error */
r_default
suffix:colon
(brace
)brace
multiline_comment|/* for plain cc=1, 2 or 3: */
r_if
c_cond
(paren
id|q-&gt;siga_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_SIGA_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
id|q-&gt;siga_error
op_assign
id|result
suffix:semicolon
)brace
)brace
r_inline
r_static
r_void
DECL|function|qdio_kick_outbound_handler
id|qdio_kick_outbound_handler
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|start
comma
id|end
comma
id|real_end
comma
id|count
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif
id|start
op_assign
id|q-&gt;first_element_to_kick
suffix:semicolon
multiline_comment|/* last_move_ftc was just updated */
id|real_end
op_assign
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
suffix:semicolon
id|end
op_assign
(paren
id|real_end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|count
op_assign
(paren
id|end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
l_int|1
op_minus
id|start
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickouth&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;s=%2xc=%2x&quot;
comma
id|start
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
id|q-&gt;state
op_eq
id|QDIO_IRQ_STATE_ACTIVE
)paren
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;cdev
comma
id|QDIO_STATUS_OUTBOUND_INT
op_or
id|q-&gt;error_status_flags
comma
id|q-&gt;qdio_error
comma
id|q-&gt;siga_error
comma
id|q-&gt;q_no
comma
id|start
comma
id|count
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
multiline_comment|/* for the next time: */
id|q-&gt;first_element_to_kick
op_assign
id|real_end
suffix:semicolon
id|q-&gt;qdio_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;siga_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;error_status_flags
op_assign
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__qdio_outbound_processing
id|__qdio_outbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|siga_attempts
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qoutproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|o_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we&squot;re sissies, we&squot;ll check next time */
r_if
c_cond
(paren
id|likely
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;busy,agn&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|o_p_nc
op_increment
suffix:semicolon
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* see comment in qdio_kick_outbound_q */
id|siga_attempts
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
)paren
suffix:semicolon
r_while
c_loop
(paren
id|siga_attempts
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
)paren
suffix:semicolon
id|qdio_kick_outbound_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|siga_attempts
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qdio_has_outbound_q_moved
c_func
(paren
id|q
)paren
)paren
id|qdio_kick_outbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;is_iqdio_q
)paren
(brace
multiline_comment|/* &n;&t;&t; * for asynchronous queues, we better check, if the fill&n;&t;&t; * level is too high. for synchronous queues, the fill&n;&t;&t; * level will never be that high. &n;&t;&t; */
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
OG
id|IQDIO_FILL_LEVEL_TO_POLL
)paren
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_outbound_q_done
c_func
(paren
id|q
)paren
)paren
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_outbound_processing
id|qdio_outbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
id|__qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
multiline_comment|/************************* INBOUND ROUTINES *******************************/
r_inline
r_static
r_int
DECL|function|qdio_get_inbound_buffer_frontier
id|qdio_get_inbound_buffer_frontier
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|f
comma
id|f_mod_no
suffix:semicolon
r_volatile
r_char
op_star
id|slsb
suffix:semicolon
r_int
id|first_not_to_check
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_int
id|last_position
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;getibfro&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|slsb
op_assign
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
suffix:semicolon
id|f_mod_no
op_assign
id|f
op_assign
id|q-&gt;first_to_check
suffix:semicolon
multiline_comment|/* &n;&t; * we don&squot;t check 128 buffers, as otherwise qdio_has_inbound_q_moved&n;&t; * would return 0 &n;&t; */
id|first_not_to_check
op_assign
id|f
op_plus
id|qdio_min
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
comma
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * we don&squot;t use this one, as a PCI or we after a thin interrupt&n;&t; * will sync the queues&n;&t; */
multiline_comment|/* SYNC_MEMORY;*/
id|check_next
suffix:colon
id|f_mod_no
op_assign
id|f
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f
op_eq
id|first_not_to_check
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|slsb
(braket
id|f_mod_no
)braket
)paren
(brace
multiline_comment|/* CU_EMPTY means frontier is reached */
r_case
id|SLSB_CU_INPUT_EMPTY
suffix:colon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inptempt&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* P_PRIMED means set slsb to P_PROCESSING and move on */
r_case
id|SLSB_P_INPUT_PRIMED
suffix:colon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inptprim&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
multiline_comment|/* &n;&t;&t; * as soon as running under VM, polling the input queues will&n;&t;&t; * kill VM in terms of CP overhead &n;&t;&t; */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* set the previous buffer to NOT_INIT. The current&n;&t;&t;&t; * buffer will be set to PROCESSING at the end of&n;&t;&t;&t; * this function to avoid further interrupts. */
r_if
c_cond
(paren
id|last_position
op_ge
l_int|0
)paren
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|last_position
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|1
)paren
suffix:semicolon
id|last_position
op_assign
id|f_mod_no
suffix:semicolon
)brace
macro_line|#else /* QDIO_USE_PROCESSING_STATE */
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
multiline_comment|/* &n;&t;&t; * not needed, as the inbound queue will be synced on the next&n;&t;&t; * siga-r, resp. tiqdio_is_inbound_q_done will do the siga-s&n;&t;&t; */
multiline_comment|/*SYNC_MEMORY;*/
id|f
op_increment
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
r_goto
id|check_next
suffix:semicolon
r_case
id|SLSB_P_INPUT_NOT_INIT
suffix:colon
r_case
id|SLSB_P_INPUT_PROCESSING
suffix:colon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inpnipro&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* P_ERROR means frontier is reached, break and report error */
r_case
id|SLSB_P_INPUT_ERROR
suffix:colon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;inperr%2x&quot;
comma
id|f_mod_no
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|sbal
comma
id|q-&gt;sbal
(braket
id|f_mod_no
)braket
comma
l_int|256
)paren
suffix:semicolon
multiline_comment|/* kind of process the buffer */
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|f_mod_no
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;qdio_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_QDIO_ERROR
suffix:semicolon
id|q-&gt;qdio_error
op_assign
id|SLSB_P_INPUT_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
multiline_comment|/* we increment the frontier, as this buffer&n;&t;&t; * was processed obviously */
id|f_mod_no
op_assign
(paren
id|f_mod_no
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
id|last_position
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
r_break
suffix:semicolon
multiline_comment|/* everything else means frontier not changed (HALTED or so) */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
id|q-&gt;first_to_check
op_assign
id|f_mod_no
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_if
c_cond
(paren
id|last_position
op_ge
l_int|0
)paren
id|set_slsb
c_func
(paren
op_amp
id|slsb
(braket
id|last_position
)braket
comma
id|SLSB_P_INPUT_PROCESSING
)paren
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q-&gt;first_to_check
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
id|q-&gt;first_to_check
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|qdio_has_inbound_q_moved
id|qdio_has_inbound_q_moved
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
r_static
r_int
id|old_pcis
op_assign
l_int|0
suffix:semicolon
r_static
r_int
id|old_thinints
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|old_pcis
op_eq
id|perf_stats.pcis
)paren
op_logical_and
(paren
id|old_thinints
op_eq
id|perf_stats.thinints
)paren
)paren
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
r_else
id|old_pcis
op_assign
id|perf_stats.pcis
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|i
op_assign
id|qdio_get_inbound_buffer_frontier
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ne
id|GET_SAVED_FRONTIER
c_func
(paren
id|q
)paren
)paren
op_logical_or
(paren
id|q-&gt;error_status_flags
op_amp
id|QDIO_STATUS_LOOK_FOR_ERROR
)paren
)paren
(brace
id|SAVE_FRONTIER
c_func
(paren
id|q
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;siga_sync
)paren
op_logical_and
(paren
op_logical_neg
id|q-&gt;hydra_gives_outbound_pcis
)paren
)paren
id|SAVE_TIMESTAMP
c_func
(paren
id|q
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inhasmvd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inhsntmv&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* means, no more buffers to be filled */
r_inline
r_static
r_int
DECL|function|tiqdio_is_inbound_q_done
id|tiqdio_is_inbound_q_done
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
multiline_comment|/* propagate the change from 82 to 80 through VM */
id|SYNC_MEMORY
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_if
c_cond
(paren
id|no_used
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;iqisnt%02x&quot;
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iniqisdo&quot;
)paren
suffix:semicolon
)brace
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
op_logical_neg
id|no_used
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;siga_sync
)paren
multiline_comment|/* we&squot;ll check for more primed buffers in qeth_stop_polling */
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|q-&gt;first_to_check
)braket
op_ne
id|SLSB_P_INPUT_PRIMED
)paren
multiline_comment|/* &n;&t;&t; * nothing more to do, if next buffer is not PRIMED.&n;&t;&t; * note that we did a SYNC_MEMORY before, that there&n;&t;&t; * has been a sychnronization.&n;&t;&t; * we will return 0 below, as there is nothing to do&n;&t;&t; * (stop_polling not necessary, as we have not been&n;&t;&t; * using the PROCESSING state &n;&t;&t; */
r_return
l_int|0
suffix:semicolon
multiline_comment|/* &n;&t; * ok, the next input buffer is primed. that means, that device state &n;&t; * change indicator and adapter local summary are set, so we will find&n;&t; * it next time.&n;&t; * we will return 0 below, as there is nothing to do, except scheduling&n;&t; * ourselves for the next time. &n;&t; */
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_inline
r_static
r_int
DECL|function|qdio_is_inbound_q_done
id|qdio_is_inbound_q_done
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|no_used
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif
id|no_used
op_assign
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;number_of_buffers_used
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * we need that one for synchronization with the adapter, as it&n;&t; * does a kind of PCI avoidance &n;&t; */
id|SYNC_MEMORY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|no_used
)paren
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisdnA&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
id|q-&gt;first_to_check
)braket
op_eq
id|SLSB_P_INPUT_PRIMED
)paren
(brace
multiline_comment|/* we got something to do */
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisntA&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* on VM, we don&squot;t poll, so the q is always done here */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;hydra_gives_outbound_pcis
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* &n;&t; * at this point we know, that inbound first_to_check&n;&t; * has (probably) not moved (see qdio_inbound_processing) &n;&t; */
r_if
c_cond
(paren
id|NOW
OG
id|GET_SAVED_TIMESTAMP
c_func
(paren
id|q
)paren
op_plus
id|q-&gt;timing.threshold
)paren
(brace
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisdon&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;pf%02xcn%02x&quot;
comma
id|q-&gt;first_to_check
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;inqisntd&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;pf%02xcn%02x&quot;
comma
id|q-&gt;first_to_check
comma
id|no_used
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_inline
r_static
r_void
DECL|function|qdio_kick_inbound_handler
id|qdio_kick_inbound_handler
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|count
comma
id|start
comma
id|end
comma
id|real_end
comma
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#endif
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;kickinh&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|start
op_assign
id|q-&gt;first_element_to_kick
suffix:semicolon
id|real_end
op_assign
id|q-&gt;first_to_check
suffix:semicolon
id|end
op_assign
(paren
id|real_end
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_assign
id|start
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|end
)paren
r_break
suffix:semicolon
id|i
op_assign
(paren
id|i
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;s=%2xc=%2x&quot;
comma
id|start
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
id|likely
c_func
(paren
id|q-&gt;state
op_eq
id|QDIO_IRQ_STATE_ACTIVE
)paren
)paren
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;cdev
comma
id|QDIO_STATUS_INBOUND_INT
op_or
id|q-&gt;error_status_flags
comma
id|q-&gt;qdio_error
comma
id|q-&gt;siga_error
comma
id|q-&gt;q_no
comma
id|start
comma
id|count
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
multiline_comment|/* for the next time: */
id|q-&gt;first_element_to_kick
op_assign
id|real_end
suffix:semicolon
id|q-&gt;qdio_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;siga_error
op_assign
l_int|0
suffix:semicolon
id|q-&gt;error_status_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.inbound_time
op_add_assign
id|NOW
op_minus
id|perf_stats.start_time_inbound
suffix:semicolon
id|perf_stats.inbound_cnt
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
r_static
r_inline
r_void
DECL|function|__tiqdio_inbound_processing
id|__tiqdio_inbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
id|spare_ind_was_set
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_struct
id|qdio_q
op_star
id|oq
suffix:semicolon
r_int
id|i
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqinproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * we first want to reserve the q, so that we know, that we don&squot;t&n;&t; * interrupt ourselves and call qdio_unmark_q, as is_in_shutdown might&n;&t; * be set &n;&t; */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* &n;&t;&t; * as we might just be about to stop polling, we make&n;&t;&t; * sure that we check again at least once more &n;&t;&t; */
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_nc
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
)paren
(brace
id|qdio_unmark_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * we reset spare_ind_was_set, when the queue does not use the&n;&t; * spare indicator&n;&t; */
r_if
c_cond
(paren
id|spare_ind_was_set
)paren
id|spare_ind_was_set
op_assign
(paren
id|q-&gt;dev_st_chg_ind
op_eq
op_amp
id|spare_indicator
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
(paren
id|q-&gt;dev_st_chg_ind
)paren
)paren
op_logical_and
op_logical_neg
id|spare_ind_was_set
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * q-&gt;dev_st_chg_ind is the indicator, be it shared or not.&n;&t; * only clear it, if indicator is non-shared&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|spare_ind_was_set
)paren
id|tiqdio_clear_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;hydra_gives_outbound_pcis
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;siga_sync_done_on_thinints
)paren
(brace
id|SYNC_MEMORY_ALL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
op_logical_neg
id|q-&gt;siga_sync_done_on_outb_tis
)paren
op_logical_and
(paren
id|q-&gt;hydra_gives_outbound_pcis
)paren
)paren
(brace
id|SYNC_MEMORY_ALL_OUTB
suffix:semicolon
)brace
)brace
r_else
(brace
id|SYNC_MEMORY
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * maybe we have to do work on our outbound queues... at least&n;&t; * we have to check the outbound-int-capable thinint-capable&n;&t; * queues&n;&t; */
r_if
c_cond
(paren
id|q-&gt;hydra_gives_outbound_pcis
)paren
(brace
id|irq_ptr
op_assign
(paren
r_struct
id|qdio_irq
op_star
)paren
id|q-&gt;irq_ptr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|oq
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_decrement
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_outbound_q_done
c_func
(paren
id|oq
)paren
)paren
id|__qdio_outbound_processing
c_func
(paren
id|oq
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_has_inbound_q_moved
c_func
(paren
id|q
)paren
)paren
r_goto
id|out
suffix:semicolon
id|qdio_kick_inbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tiqdio_is_inbound_q_done
c_func
(paren
id|q
)paren
)paren
r_if
c_cond
(paren
op_logical_neg
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
multiline_comment|/* &n;&t;&t;&t; * we set the flags to get into the stuff next time,&n;&t;&t;&t; * see also comment in qdio_stop_polling &n;&t;&t;&t; */
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|tiqdio_inbound_processing
id|tiqdio_inbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
id|__tiqdio_inbound_processing
c_func
(paren
id|q
comma
id|atomic_read
c_func
(paren
op_amp
id|spare_indicator_usecount
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|__qdio_inbound_processing
id|__qdio_inbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
r_int
id|q_laps
op_assign
l_int|0
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qinproc&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|i_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* as we&squot;re sissies, we&squot;ll check next time */
r_if
c_cond
(paren
id|likely
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|q-&gt;is_in_shutdown
)paren
)paren
)paren
(brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;busy,agn&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|i_p_nc
op_increment
suffix:semicolon
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|again
suffix:colon
r_if
c_cond
(paren
id|qdio_has_inbound_q_moved
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_kick_inbound_handler
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
id|q_laps
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|q_laps
OL
id|QDIO_Q_LAPS
)paren
r_goto
id|again
suffix:semicolon
)brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|qdio_is_inbound_q_done
c_func
(paren
id|q
)paren
)paren
multiline_comment|/* means poll time is not yet over */
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_inbound_processing
id|qdio_inbound_processing
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
)paren
(brace
id|__qdio_inbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
multiline_comment|/************************* MAIN ROUTINES *******************************/
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_static
r_inline
r_int
DECL|function|tiqdio_reset_processing_state
id|tiqdio_reset_processing_state
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
id|q_laps
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * under VM, we have not used the PROCESSING state, so no&n;&t; * need to stop polling &n;&t; */
r_if
c_cond
(paren
id|q-&gt;siga_sync
)paren
r_return
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|qdio_reserve_q
c_func
(paren
id|q
)paren
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|ii_p_c
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* &n;&t;&t; * as we might just be about to stop polling, we make&n;&t;&t; * sure that we check again at least once more &n;&t;&t; */
multiline_comment|/* &n;&t;&t; * sanity -- we&squot;d get here without setting the&n;&t;&t; * dev st chg ind &n;&t;&t; */
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qdio_stop_polling
c_func
(paren
id|q
)paren
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q_laps
OL
id|QDIO_Q_LAPS
op_minus
l_int|1
)paren
(brace
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_return
l_int|3
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * we set the flags to get into the stuff&n;&t; * next time, see also comment in qdio_stop_polling &n;&t; */
id|tiqdio_set_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
id|q-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_sched_tl
c_func
(paren
)paren
suffix:semicolon
id|qdio_release_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
r_static
r_inline
r_void
DECL|function|tiqdio_inbound_checks
id|tiqdio_inbound_checks
c_func
(paren
r_void
)paren
(brace
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_int
id|spare_ind_was_set
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
r_int
id|q_laps
op_assign
l_int|0
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqdinbck&quot;
)paren
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqlocsum&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
id|again
suffix:colon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
multiline_comment|/* when the spare indicator is used and set, save that and clear it */
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|spare_indicator_usecount
)paren
)paren
op_logical_and
id|spare_indicator
)paren
(brace
id|spare_ind_was_set
op_assign
l_int|1
suffix:semicolon
id|tiqdio_clear_summary_bit
c_func
(paren
(paren
id|__u32
op_star
)paren
op_amp
id|spare_indicator
)paren
suffix:semicolon
)brace
id|q
op_assign
(paren
r_struct
id|qdio_q
op_star
)paren
id|tiq_list
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_break
suffix:semicolon
id|__tiqdio_inbound_processing
c_func
(paren
id|q
comma
id|spare_ind_was_set
)paren
suffix:semicolon
id|q
op_assign
(paren
r_struct
id|qdio_q
op_star
)paren
id|q-&gt;list_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|q
op_ne
(paren
r_struct
id|qdio_q
op_star
)paren
id|tiq_list
)paren
suffix:semicolon
macro_line|#ifdef QDIO_USE_PROCESSING_STATE
id|q
op_assign
(paren
r_struct
id|qdio_q
op_star
)paren
id|tiq_list
suffix:semicolon
r_do
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|tiqdio_reset_processing_state
c_func
(paren
id|q
comma
id|q_laps
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|ret
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
suffix:semicolon
r_case
l_int|1
suffix:colon
id|q_laps
op_increment
suffix:semicolon
r_case
l_int|2
suffix:colon
id|q
op_assign
(paren
r_struct
id|qdio_q
op_star
)paren
id|q-&gt;list_next
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|q_laps
op_increment
suffix:semicolon
r_goto
id|again
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|q
op_ne
(paren
r_struct
id|qdio_q
op_star
)paren
id|tiq_list
)paren
suffix:semicolon
macro_line|#endif /* QDIO_USE_PROCESSING_STATE */
)brace
r_static
r_void
DECL|function|tiqdio_tl
id|tiqdio_tl
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;iqdio_tl&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|tiqdio_inbound_checks
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/********************* GENERAL HELPER_ROUTINES ***********************/
r_static
r_void
DECL|function|qdio_release_irq_memory
id|qdio_release_irq_memory
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|QDIO_MAX_QUEUES_PER_IRQ
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
r_goto
id|next
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
id|kfree
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|next
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
id|kfree
c_func
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|irq_ptr-&gt;qdr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_set_impl_params
id|qdio_set_impl_params
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
r_int
id|qib_param_field_format
comma
multiline_comment|/* pointer to 128 bytes or NULL, if no param field */
r_int
r_char
op_star
id|qib_param_field
comma
multiline_comment|/* pointer to no_queues*128 words of data or NULL */
r_int
r_int
id|no_input_qs
comma
r_int
r_int
id|no_output_qs
comma
r_int
r_int
op_star
id|input_slib_elements
comma
r_int
r_int
op_star
id|output_slib_elements
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
suffix:semicolon
id|irq_ptr-&gt;qib.pfmt
op_assign
id|qib_param_field_format
suffix:semicolon
r_if
c_cond
(paren
id|qib_param_field
)paren
id|memcpy
c_func
(paren
id|irq_ptr-&gt;qib.parm
comma
id|qib_param_field
comma
id|QDIO_MAX_BUFFERS_PER_Q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input_slib_elements
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib-&gt;slibe
(braket
id|j
)braket
dot
id|parms
op_assign
id|input_slib_elements
(braket
id|i
op_star
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
id|j
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|output_slib_elements
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib-&gt;slibe
(braket
id|j
)braket
dot
id|parms
op_assign
id|output_slib_elements
(braket
id|i
op_star
id|QDIO_MAX_BUFFERS_PER_Q
op_plus
id|j
)braket
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|qdio_alloc_qs
id|qdio_alloc_qs
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
id|no_input_qs
comma
r_int
id|no_output_qs
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_int
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qdio_q
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of q failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qdio_q
)paren
)paren
suffix:semicolon
id|q-&gt;slib
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;slib
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of slib failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_assign
id|q
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qdio_q
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qdio_q
)paren
)paren
suffix:semicolon
id|q-&gt;slib
op_assign
id|kmalloc
c_func
(paren
id|PAGE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q-&gt;slib
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of slib failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_assign
id|q
suffix:semicolon
)brace
id|result
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|result
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_fill_qs
id|qdio_fill_qs
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|no_input_qs
comma
r_int
id|no_output_qs
comma
id|qdio_handler_t
op_star
id|input_handler
comma
id|qdio_handler_t
op_star
id|output_handler
comma
r_int
r_int
id|int_parm
comma
r_int
id|q_format
comma
r_int
r_int
id|flags
comma
r_void
op_star
op_star
id|inbound_sbals_array
comma
r_void
op_star
op_star
id|outbound_sbals_array
)paren
(brace
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* see qdio_initialize */
r_void
op_star
id|ptr
suffix:semicolon
r_int
id|available
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qfqs%4x&quot;
comma
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|q-&gt;slib
)paren
op_minus
(paren
(paren
r_char
op_star
)paren
id|q
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;in-q%4x&quot;
comma
id|i
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|q-&gt;slib
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|q-&gt;sl
op_assign
(paren
r_struct
id|sl
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;slib
)paren
op_plus
id|PAGE_SIZE
op_div
l_int|2
)paren
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
op_star
(paren
id|inbound_sbals_array
op_increment
)paren
suffix:semicolon
id|q-&gt;queue_type
op_assign
id|q_format
suffix:semicolon
id|q-&gt;int_parm
op_assign
id|int_parm
suffix:semicolon
id|q-&gt;irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|q-&gt;irq_ptr
op_assign
id|irq_ptr
suffix:semicolon
id|q-&gt;cdev
op_assign
id|cdev
suffix:semicolon
id|q-&gt;mask
op_assign
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|i
)paren
suffix:semicolon
id|q-&gt;q_no
op_assign
id|i
suffix:semicolon
id|q-&gt;is_input_q
op_assign
l_int|1
suffix:semicolon
id|q-&gt;first_to_check
op_assign
l_int|0
suffix:semicolon
id|q-&gt;last_move_ftc
op_assign
l_int|0
suffix:semicolon
id|q-&gt;handler
op_assign
id|input_handler
suffix:semicolon
id|q-&gt;dev_st_chg_ind
op_assign
id|irq_ptr-&gt;dev_st_chg_ind
suffix:semicolon
id|q-&gt;tasklet.data
op_assign
(paren
r_int
r_int
)paren
id|q
suffix:semicolon
multiline_comment|/* q-&gt;is_thinint_q isn&squot;t valid at this time, but&n;&t;&t; * irq_ptr-&gt;is_thinint_irq is */
id|q-&gt;tasklet.func
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
(paren
(paren
id|irq_ptr-&gt;is_thinint_irq
)paren
ques
c_cond
op_amp
id|tiqdio_inbound_processing
suffix:colon
op_amp
id|qdio_inbound_processing
)paren
suffix:semicolon
multiline_comment|/* actually this is not used for inbound queues. yet. */
id|atomic_set
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
comma
l_int|0
)paren
suffix:semicolon
id|q-&gt;timing.busy_start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_NUMBER;j++)&n;&t;&t;&t;q-&gt;timing.last_transfer_times[j]=(qdio_get_micros()/&n;&t;&t;&t;&t;&t;&t;&t;  QDIO_STATS_NUMBER)*j;&n;&t;&t;q-&gt;timing.last_transfer_index=QDIO_STATS_NUMBER-1;&n;*/
multiline_comment|/* fill in slib */
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|slib-&gt;nsliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;slib
)paren
suffix:semicolon
id|q-&gt;slib-&gt;sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sl
)paren
suffix:semicolon
id|q-&gt;slib-&gt;slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fill in sl */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sl-&gt;element
(braket
id|j
)braket
dot
id|sbal
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;sl-sb-b0&quot;
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sl
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
op_amp
id|q-&gt;slsb
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
l_int|0
)braket
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* fill in slsb */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|j
)braket
comma
id|SLSB_P_INPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/*&t;&t;&t;q-&gt;sbal[j]-&gt;element[1].sbalf.i1.key=QDIO_STORAGE_KEY;*/
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
id|memset
c_func
(paren
id|q
comma
l_int|0
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|q-&gt;slib
)paren
op_minus
(paren
(paren
r_char
op_star
)paren
id|q
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;outq%4x&quot;
comma
id|i
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|q
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|q-&gt;slib
comma
l_int|0
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|q-&gt;sl
op_assign
(paren
r_struct
id|sl
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|q-&gt;slib
)paren
op_plus
id|PAGE_SIZE
op_div
l_int|2
)paren
suffix:semicolon
id|available
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sbal
(braket
id|j
)braket
op_assign
op_star
(paren
id|outbound_sbals_array
op_increment
)paren
suffix:semicolon
id|q-&gt;queue_type
op_assign
id|q_format
suffix:semicolon
id|q-&gt;int_parm
op_assign
id|int_parm
suffix:semicolon
id|q-&gt;is_input_q
op_assign
l_int|0
suffix:semicolon
id|q-&gt;irq
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|q-&gt;cdev
op_assign
id|cdev
suffix:semicolon
id|q-&gt;irq_ptr
op_assign
id|irq_ptr
suffix:semicolon
id|q-&gt;mask
op_assign
l_int|1
op_lshift
(paren
l_int|31
op_minus
id|i
)paren
suffix:semicolon
id|q-&gt;q_no
op_assign
id|i
suffix:semicolon
id|q-&gt;first_to_check
op_assign
l_int|0
suffix:semicolon
id|q-&gt;last_move_ftc
op_assign
l_int|0
suffix:semicolon
id|q-&gt;handler
op_assign
id|output_handler
suffix:semicolon
id|q-&gt;tasklet.data
op_assign
(paren
r_int
r_int
)paren
id|q
suffix:semicolon
id|q-&gt;tasklet.func
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_int
r_int
)paren
)paren
op_amp
id|qdio_outbound_processing
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|q-&gt;busy_siga_counter
comma
l_int|0
)paren
suffix:semicolon
id|q-&gt;timing.busy_start
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* fill in slib */
r_if
c_cond
(paren
id|i
OG
l_int|0
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
op_minus
l_int|1
)braket
op_member_access_from_pointer
id|slib-&gt;nsliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;slib
)paren
suffix:semicolon
id|q-&gt;slib-&gt;sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sl
)paren
suffix:semicolon
id|q-&gt;slib-&gt;slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* fill in sl */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
id|q-&gt;sl-&gt;element
(braket
id|j
)braket
dot
id|sbal
op_assign
(paren
r_int
r_int
)paren
(paren
id|q-&gt;sbal
(braket
id|j
)braket
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;sl-sb-b0&quot;
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sl
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
op_amp
id|q-&gt;slsb
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_void
op_star
)paren
id|q-&gt;sbal
(braket
l_int|0
)braket
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
multiline_comment|/* fill in slsb */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|QDIO_MAX_BUFFERS_PER_Q
suffix:semicolon
id|j
op_increment
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|j
)braket
comma
id|SLSB_P_OUTPUT_NOT_INIT
)paren
suffix:semicolon
multiline_comment|/*&t;&t;&t;q-&gt;sbal[j]-&gt;element[1].sbalf.i1.key=QDIO_STORAGE_KEY;*/
)brace
)brace
)brace
r_static
r_void
DECL|function|qdio_fill_thresholds
id|qdio_fill_thresholds
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
r_int
id|no_input_qs
comma
r_int
r_int
id|no_output_qs
comma
r_int
r_int
id|min_input_threshold
comma
r_int
r_int
id|max_input_threshold
comma
r_int
r_int
id|min_output_threshold
comma
r_int
r_int
id|max_output_threshold
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
suffix:semicolon
id|q-&gt;timing.threshold
op_assign
id|max_input_threshold
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_CLASSES;j++) {&n;&t;&t;&t;q-&gt;threshold_classes[j].threshold=&n;&t;&t;&t;&t;min_input_threshold+&n;&t;&t;&t;&t;(max_input_threshold-min_input_threshold)/&n;&t;&t;&t;&t;QDIO_STATS_CLASSES;&n;&t;&t;}&n;&t;&t;qdio_use_thresholds(q,QDIO_STATS_CLASSES/2);*/
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
id|q-&gt;timing.threshold
op_assign
id|max_output_threshold
suffix:semicolon
multiline_comment|/*&t;&t;for (j=0;j&lt;QDIO_STATS_CLASSES;j++) {&n;&t;&t;&t;q-&gt;threshold_classes[j].threshold=&n;&t;&t;&t;&t;min_output_threshold+&n;&t;&t;&t;&t;(max_output_threshold-min_output_threshold)/&n;&t;&t;&t;&t;QDIO_STATS_CLASSES;&n;&t;&t;}&n;&t;&t;qdio_use_thresholds(q,QDIO_STATS_CLASSES/2);*/
)brace
)brace
r_static
r_int
DECL|function|tiqdio_thinint_handler
id|tiqdio_thinint_handler
c_func
(paren
r_void
)paren
(brace
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;thin_int&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.thinints
op_increment
suffix:semicolon
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
multiline_comment|/* SVS only when needed:&n;&t; * issue SVS to benefit from iqdio interrupt avoidance&n;&t; * (SVS clears AISOI)*/
r_if
c_cond
(paren
op_logical_neg
id|omit_svs
)paren
id|tiqdio_clear_global_summary
c_func
(paren
)paren
suffix:semicolon
id|tiqdio_inbound_checks
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_set_state
id|qdio_set_state
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_enum
id|qdio_irq_states
id|state
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;newstate&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%4x%4x&quot;
comma
id|irq_ptr-&gt;irq
comma
id|state
)paren
suffix:semicolon
id|QDIO_DBF_TEXT5
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
id|irq_ptr-&gt;state
op_assign
id|state
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|state
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|state
op_assign
id|state
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_irq_check_sense
id|qdio_irq_check_sense
c_func
(paren
r_int
id|irq
comma
r_struct
id|irb
op_star
id|irb
)paren
(brace
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irb-&gt;esw.esw0.erw.cons
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sens%4x&quot;
comma
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|sense
comma
id|irb
comma
id|QDIO_DBF_SENSE_LEN
)paren
suffix:semicolon
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;sense data available on qdio channel.&bslash;n&quot;
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;irb: &quot;
comma
id|irb
)paren
suffix:semicolon
id|HEXDUMP16
c_func
(paren
id|WARN
comma
l_string|&quot;sense data: &quot;
comma
id|irb-&gt;ecw
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qdio_handle_pci
id|qdio_handle_pci
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.pcis
op_increment
suffix:semicolon
id|perf_stats.start_time_inbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;is_input_q
op_amp
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
)paren
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
r_else
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_decrement
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|__qdio_inbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;hydra_gives_outbound_pcis
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_decrement
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_if
c_cond
(paren
id|qdio_is_outbound_q_done
c_func
(paren
id|q
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;sync_done_on_outb_pcis
)paren
id|SYNC_MEMORY
suffix:semicolon
id|__qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
id|qdio_establish_handle_irq
c_func
(paren
r_struct
id|ccw_device
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_static
r_inline
r_void
DECL|function|qdio_handle_activate_check
id|qdio_handle_activate_check
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
r_int
id|intparm
comma
r_int
id|cstat
comma
r_int
id|dstat
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;ick2&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%s&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|intparm
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|dstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received check condition on activate &quot;
"&bslash;"
l_string|&quot;queues on device %s (cs=x%x, ds=x%x).&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;no_input_qs
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|irq_ptr-&gt;no_output_qs
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;oops... no queue registered for device %s!?&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
r_goto
id|omit_handler_call
suffix:semicolon
)brace
id|q
op_member_access_from_pointer
id|handler
c_func
(paren
id|q-&gt;cdev
comma
id|QDIO_STATUS_ACTIVATE_CHECK_CONDITION
op_or
id|QDIO_STATUS_LOOK_FOR_ERROR
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|q-&gt;int_parm
)paren
suffix:semicolon
id|omit_handler_call
suffix:colon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_STOPPED
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_call_shutdown
id|qdio_call_shutdown
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|ccw_device
op_star
id|cdev
suffix:semicolon
id|cdev
op_assign
(paren
r_struct
id|ccw_device
op_star
)paren
id|data
suffix:semicolon
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
id|put_device
c_func
(paren
op_amp
id|cdev-&gt;dev
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_timeout_handler
id|qdio_timeout_handler
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qtoh&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%s&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;state:%d&quot;
comma
id|irq_ptr-&gt;state
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|irq_ptr-&gt;state
)paren
(brace
r_case
id|QDIO_IRQ_STATE_INACTIVE
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: timed out&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:timeo&quot;
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QDIO_IRQ_STATE_CLEANUP
suffix:colon
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;Did not get interrupt on cleanup, irq=0x%x.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QDIO_IRQ_STATE_ESTABLISHED
suffix:colon
r_case
id|QDIO_IRQ_STATE_ACTIVE
suffix:colon
multiline_comment|/* I/O has been terminated by common I/O layer. */
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;Queues on irq %04x killed by cio.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;cio:term&quot;
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_STOPPED
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_device
c_func
(paren
op_amp
id|cdev-&gt;dev
)paren
)paren
(brace
multiline_comment|/* Can&squot;t call shutdown from interrupt context. */
id|PREPARE_WORK
c_func
(paren
op_amp
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|kick_work
comma
id|qdio_call_shutdown
comma
(paren
r_void
op_star
)paren
id|cdev
)paren
suffix:semicolon
id|queue_work
c_func
(paren
id|ccw_device_work
comma
op_amp
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|kick_work
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_handler
id|qdio_handler
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
r_int
id|intparm
comma
r_struct
id|irb
op_star
id|irb
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_int
id|cstat
comma
id|dstat
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;qint&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%s&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
op_logical_neg
id|intparm
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;got unsolicited interrupt in qdio &quot;
"&bslash;"
l_string|&quot;handler, device %s&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;uint&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;%s&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received interrupt on unused device %s!&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|irb
)paren
)paren
(brace
multiline_comment|/* Currently running i/o is in error. */
r_switch
c_cond
(paren
id|PTR_ERR
c_func
(paren
id|irb
)paren
)paren
(brace
r_case
op_minus
id|EIO
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;i/o error on device %s&bslash;n&quot;
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
op_minus
id|ETIMEDOUT
suffix:colon
id|qdio_timeout_handler
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;unknown error state %ld on device %s&bslash;n&quot;
comma
id|PTR_ERR
c_func
(paren
id|irb
)paren
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|qdio_irq_check_sense
c_func
(paren
id|irq_ptr-&gt;irq
comma
id|irb
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;state:%d&quot;
comma
id|irq_ptr-&gt;state
)paren
suffix:semicolon
id|QDIO_DBF_TEXT4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
id|cstat
op_assign
id|irb-&gt;scsw.cstat
suffix:semicolon
id|dstat
op_assign
id|irb-&gt;scsw.dstat
suffix:semicolon
r_switch
c_cond
(paren
id|irq_ptr-&gt;state
)paren
(brace
r_case
id|QDIO_IRQ_STATE_INACTIVE
suffix:colon
id|qdio_establish_handle_irq
c_func
(paren
id|cdev
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QDIO_IRQ_STATE_CLEANUP
suffix:colon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|QDIO_IRQ_STATE_ESTABLISHED
suffix:colon
r_case
id|QDIO_IRQ_STATE_ACTIVE
suffix:colon
r_if
c_cond
(paren
id|cstat
op_amp
id|SCHN_STAT_PCI
)paren
(brace
id|qdio_handle_pci
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|cstat
op_amp
op_complement
id|SCHN_STAT_PCI
)paren
op_logical_or
id|dstat
)paren
(brace
id|qdio_handle_activate_check
c_func
(paren
id|cdev
comma
id|intparm
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;got interrupt for queues in state %d on &quot;
"&bslash;"
l_string|&quot;device %s?!&bslash;n&quot;
comma
id|irq_ptr-&gt;state
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
)brace
id|wake_up
c_func
(paren
op_amp
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
)paren
suffix:semicolon
)brace
r_int
DECL|function|qdio_synchronize
id|qdio_synchronize
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
r_int
id|flags
comma
r_int
r_int
id|queue_number
)paren
(brace
r_int
id|cc
suffix:semicolon
r_struct
id|qdio_q
op_star
id|q
suffix:semicolon
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|15
)braket
op_assign
l_string|&quot;SyncXXXX&quot;
suffix:semicolon
macro_line|#endif
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|irq_ptr-&gt;irq
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|0
)braket
)paren
)paren
op_assign
id|flags
suffix:semicolon
op_star
(paren
(paren
r_int
op_star
)paren
(paren
op_amp
id|dbf_text
(braket
l_int|4
)braket
)paren
)paren
op_assign
id|queue_number
suffix:semicolon
id|QDIO_DBF_HEX4
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cc
op_assign
id|do_siga_sync
c_func
(paren
id|q-&gt;irq
comma
l_int|0
comma
id|q-&gt;mask
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
(brace
id|q
op_assign
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|q
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|cc
op_assign
id|do_siga_sync
c_func
(paren
id|q-&gt;irq
comma
id|q-&gt;mask
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr
op_assign
op_amp
id|cc
suffix:semicolon
r_if
c_cond
(paren
id|cc
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
id|cc
suffix:semicolon
)brace
r_static
r_int
r_char
DECL|function|qdio_check_siga_needs
id|qdio_check_siga_needs
c_func
(paren
r_int
id|sch
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_char
id|qdioac
suffix:semicolon
r_struct
(brace
r_struct
id|chsc_header
id|request
suffix:semicolon
id|u16
id|reserved1
suffix:semicolon
id|u16
id|first_sch
suffix:semicolon
id|u16
id|reserved2
suffix:semicolon
id|u16
id|last_sch
suffix:semicolon
id|u32
id|reserved3
suffix:semicolon
r_struct
id|chsc_header
id|response
suffix:semicolon
id|u32
id|reserved4
suffix:semicolon
id|u8
id|flags
suffix:semicolon
id|u8
id|reserved5
suffix:semicolon
id|u16
id|sch
suffix:semicolon
id|u8
id|qfmt
suffix:semicolon
id|u8
id|reserved6
suffix:semicolon
id|u8
id|qdioac
suffix:semicolon
id|u8
id|sch_class
suffix:semicolon
id|u8
id|reserved7
suffix:semicolon
id|u8
id|icnt
suffix:semicolon
id|u8
id|reserved8
suffix:semicolon
id|u8
id|ocnt
suffix:semicolon
)brace
op_star
id|ssqd_area
suffix:semicolon
id|ssqd_area
op_assign
(paren
r_void
op_star
)paren
id|get_zeroed_page
c_func
(paren
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ssqd_area
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Could not get memory for chsc. Using all &quot;
"&bslash;"
l_string|&quot;SIGAs for sch x%x.&bslash;n&quot;
comma
id|sch
)paren
suffix:semicolon
r_return
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
multiline_comment|/* all flags set */
)brace
id|ssqd_area-&gt;request
op_assign
(paren
r_struct
id|chsc_header
)paren
(brace
dot
id|length
op_assign
l_int|0x0010
comma
dot
id|code
op_assign
l_int|0x0024
comma
)brace
suffix:semicolon
id|ssqd_area-&gt;first_sch
op_assign
id|sch
suffix:semicolon
id|ssqd_area-&gt;last_sch
op_assign
id|sch
suffix:semicolon
id|result
op_assign
id|chsc
c_func
(paren
id|ssqd_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;CHSC returned cc %i. Using all &quot;
"&bslash;"
l_string|&quot;SIGAs for sch x%x.&bslash;n&quot;
comma
id|result
comma
id|sch
)paren
suffix:semicolon
id|qdioac
op_assign
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
multiline_comment|/* all flags set */
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ssqd_area-&gt;response.code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon checking SIGA needs &quot;
"&bslash;"
l_string|&quot;is 0x%x. Using all SIGAs for sch x%x.&bslash;n&quot;
comma
id|ssqd_area-&gt;response.code
comma
id|sch
)paren
suffix:semicolon
id|qdioac
op_assign
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
op_logical_or
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
multiline_comment|/* all flags set */
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ssqd_area-&gt;flags
op_amp
id|CHSC_FLAG_QDIO_CAPABILITY
)paren
op_logical_or
op_logical_neg
(paren
id|ssqd_area-&gt;flags
op_amp
id|CHSC_FLAG_VALIDITY
)paren
op_logical_or
(paren
id|ssqd_area-&gt;sch
op_ne
id|sch
)paren
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;huh? problems checking out sch x%x... &quot;
"&bslash;"
l_string|&quot;using all SIGAs.&bslash;n&quot;
comma
id|sch
)paren
suffix:semicolon
id|qdioac
op_assign
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
op_or
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
op_or
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
multiline_comment|/* worst case */
r_goto
id|out
suffix:semicolon
)brace
id|qdioac
op_assign
id|ssqd_area-&gt;qdioac
suffix:semicolon
id|out
suffix:colon
id|free_page
(paren
(paren
r_int
r_int
)paren
id|ssqd_area
)paren
suffix:semicolon
r_return
id|qdioac
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|tiqdio_check_chsc_availability
id|tiqdio_check_chsc_availability
c_func
(paren
r_void
)paren
(brace
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|css_characteristics_avail
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* Check for bit 41. */
r_if
c_cond
(paren
op_logical_neg
id|css_general_characteristics.aif
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Adapter interruption facility not &quot;
"&bslash;"
l_string|&quot;installed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
multiline_comment|/* Check for bits 107 and 108. */
r_if
c_cond
(paren
op_logical_neg
id|css_chsc_characteristics.scssc
op_logical_or
op_logical_neg
id|css_chsc_characteristics.scsscf
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;Set Chan Subsys. Char. &amp; Fast-CHSCs &quot;
"&bslash;"
l_string|&quot;not available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
multiline_comment|/* Check for OSA/FCP thin interrupts (bit 67). */
id|hydra_thinints
op_assign
id|css_general_characteristics.aif_osa
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;hydrati%1x&quot;
comma
id|hydra_thinints
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
multiline_comment|/* Check for aif time delay disablement fac (bit 56). If installed,&n;&t; * omit svs even under lpar (good point by rick again) */
id|omit_svs
op_assign
id|css_general_characteristics.aif_tdd
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;omitsvs%1x&quot;
comma
id|omit_svs
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|tiqdio_set_subchannel_ind
id|tiqdio_set_subchannel_ind
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
id|reset_to_zero
)paren
(brace
r_int
r_int
id|real_addr_local_summary_bit
suffix:semicolon
r_int
r_int
id|real_addr_dev_st_chg_ind
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_int
r_int
id|resp_code
suffix:semicolon
r_int
id|result
suffix:semicolon
r_struct
(brace
r_struct
id|chsc_header
id|request
suffix:semicolon
id|u16
id|operation_code
suffix:semicolon
id|u16
id|reserved1
suffix:semicolon
id|u32
id|reserved2
suffix:semicolon
id|u32
id|reserved3
suffix:semicolon
id|u64
id|summary_indicator_addr
suffix:semicolon
id|u64
id|subchannel_indicator_addr
suffix:semicolon
id|u32
id|ks
suffix:colon
l_int|4
suffix:semicolon
id|u32
id|kc
suffix:colon
l_int|4
suffix:semicolon
id|u32
id|reserved4
suffix:colon
l_int|21
suffix:semicolon
id|u32
id|isc
suffix:colon
l_int|3
suffix:semicolon
id|u32
id|word_with_d_bit
suffix:semicolon
multiline_comment|/* set to 0x10000000 to enable&n;&t;&t; * time delay disablement facility */
id|u32
id|reserved5
suffix:semicolon
id|u32
id|subsystem_id
suffix:semicolon
id|u32
id|reserved6
(braket
l_int|1004
)braket
suffix:semicolon
r_struct
id|chsc_header
id|response
suffix:semicolon
id|u32
id|reserved7
suffix:semicolon
)brace
op_star
id|scssc_area
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;is_thinint_irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|reset_to_zero
)paren
(brace
id|real_addr_local_summary_bit
op_assign
l_int|0
suffix:semicolon
id|real_addr_dev_st_chg_ind
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|real_addr_local_summary_bit
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_volatile
r_void
op_star
)paren
id|indicators
)paren
suffix:semicolon
id|real_addr_dev_st_chg_ind
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_volatile
r_void
op_star
)paren
id|irq_ptr-&gt;dev_st_chg_ind
)paren
suffix:semicolon
)brace
id|scssc_area
op_assign
(paren
r_void
op_star
)paren
id|get_zeroed_page
c_func
(paren
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scssc_area
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;No memory for setting indicators on &quot;
"&bslash;"
l_string|&quot;subchannel x%x.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|scssc_area-&gt;request
op_assign
(paren
r_struct
id|chsc_header
)paren
(brace
dot
id|length
op_assign
l_int|0x0fe0
comma
dot
id|code
op_assign
l_int|0x0021
comma
)brace
suffix:semicolon
id|scssc_area-&gt;operation_code
op_assign
l_int|0
suffix:semicolon
id|scssc_area-&gt;summary_indicator_addr
op_assign
id|real_addr_local_summary_bit
suffix:semicolon
id|scssc_area-&gt;subchannel_indicator_addr
op_assign
id|real_addr_dev_st_chg_ind
suffix:semicolon
id|scssc_area-&gt;ks
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|scssc_area-&gt;kc
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|scssc_area-&gt;isc
op_assign
id|TIQDIO_THININT_ISC
suffix:semicolon
id|scssc_area-&gt;subsystem_id
op_assign
(paren
l_int|1
op_lshift
l_int|16
)paren
op_plus
id|irq_ptr-&gt;irq
suffix:semicolon
multiline_comment|/* enables the time delay disablement facility. Don&squot;t care&n;&t; * whether it is really there (i.e. we haven&squot;t checked for&n;&t; * it) */
id|scssc_area-&gt;word_with_d_bit
op_assign
l_int|0x10000000
suffix:semicolon
id|result
op_assign
id|chsc
c_func
(paren
id|scssc_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;could not set indicators on irq x%x, &quot;
"&bslash;"
l_string|&quot;cc=%i.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|resp_code
op_assign
id|scssc_area-&gt;response.code
suffix:semicolon
r_if
c_cond
(paren
id|resp_code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon setting indicators &quot;
"&bslash;"
l_string|&quot;is 0x%x.&bslash;n&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sidR%4x&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|scssc_area-&gt;response
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|setup
comma
op_amp
id|ptr
comma
id|QDIO_DBF_SETUP_LEN
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;setscind&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|real_addr_local_summary_bit
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|real_addr_dev_st_chg_ind
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|free_page
(paren
(paren
r_int
r_int
)paren
id|scssc_area
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|tiqdio_set_delay_target
id|tiqdio_set_delay_target
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
r_int
id|delay_target
)paren
(brace
r_int
r_int
id|resp_code
suffix:semicolon
r_int
id|result
suffix:semicolon
r_void
op_star
id|ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_struct
(brace
r_struct
id|chsc_header
id|request
suffix:semicolon
id|u16
id|operation_code
suffix:semicolon
id|u16
id|reserved1
suffix:semicolon
id|u32
id|reserved2
suffix:semicolon
id|u32
id|reserved3
suffix:semicolon
id|u32
id|reserved4
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|delay_target
suffix:semicolon
id|u32
id|reserved5
(braket
l_int|1009
)braket
suffix:semicolon
r_struct
id|chsc_header
id|response
suffix:semicolon
id|u32
id|reserved6
suffix:semicolon
)brace
op_star
id|scsscf_area
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;is_thinint_irq
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|scsscf_area
op_assign
(paren
r_void
op_star
)paren
id|get_zeroed_page
c_func
(paren
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scsscf_area
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;No memory for setting delay target on &quot;
"&bslash;"
l_string|&quot;subchannel x%x.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|scsscf_area-&gt;request
op_assign
(paren
r_struct
id|chsc_header
)paren
(brace
dot
id|length
op_assign
l_int|0x0fe0
comma
dot
id|code
op_assign
l_int|0x1027
comma
)brace
suffix:semicolon
id|scsscf_area-&gt;delay_target
op_assign
id|delay_target
op_lshift
l_int|16
suffix:semicolon
id|result
op_assign
id|chsc
c_func
(paren
id|scsscf_area
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;could not set delay target on irq x%x, &quot;
"&bslash;"
l_string|&quot;cc=%i. Continuing.&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|resp_code
op_assign
id|scsscf_area-&gt;response.code
suffix:semicolon
r_if
c_cond
(paren
id|resp_code
op_ne
id|QDIO_CHSC_RESPONSE_CODE_OK
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;response upon setting delay target &quot;
"&bslash;"
l_string|&quot;is 0x%x. Continuing.&bslash;n&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;sdtR%4x&quot;
comma
id|resp_code
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|scsscf_area-&gt;response
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|1
comma
id|trace
comma
op_amp
id|ptr
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
)brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;delytrgt&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|delay_target
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* not critical */
id|out
suffix:colon
id|free_page
(paren
(paren
r_int
r_int
)paren
id|scsscf_area
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_int
DECL|function|qdio_cleanup
id|qdio_cleanup
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|how
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qcln%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|rc
op_assign
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|how
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_eq
l_int|0
)paren
op_logical_or
(paren
id|rc
op_eq
op_minus
id|EINPROGRESS
)paren
)paren
id|rc
op_assign
id|qdio_free
c_func
(paren
id|cdev
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|qdio_shutdown
id|qdio_shutdown
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|how
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qsqs%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
multiline_comment|/* mark all qs as uninteresting */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_in_shutdown
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
id|atomic_set
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_in_shutdown
comma
l_int|1
)paren
suffix:semicolon
id|tasklet_kill
c_func
(paren
op_amp
id|tiqdio_tasklet
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|qdio_unmark_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|tasklet_kill
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|tasklet
)paren
suffix:semicolon
id|wait_event_interruptible_timeout
c_func
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
comma
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|irq_ptr
op_member_access_from_pointer
id|input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
comma
id|QDIO_NO_USE_COUNT_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
)paren
id|result
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tasklet_kill
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|tasklet
)paren
suffix:semicolon
id|wait_event_interruptible_timeout
c_func
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
comma
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|irq_ptr
op_member_access_from_pointer
id|output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
comma
id|QDIO_NO_USE_COUNT_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|use_count
)paren
)paren
id|result
op_assign
op_minus
id|EINPROGRESS
suffix:semicolon
)brace
multiline_comment|/* cleanup subchannel */
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|how
op_amp
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
(brace
id|rc
op_assign
id|ccw_device_clear
c_func
(paren
id|cdev
comma
id|QDIO_DOING_CLEANUP
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_CLEAR_TIMEOUT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|how
op_amp
id|QDIO_FLAG_CLEANUP_USING_HALT
)paren
(brace
id|rc
op_assign
id|ccw_device_halt
c_func
(paren
id|cdev
comma
id|QDIO_DOING_CLEANUP
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_HALT_TIMEOUT
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* default behaviour */
id|rc
op_assign
id|ccw_device_halt
c_func
(paren
id|cdev
comma
id|QDIO_DOING_CLEANUP
)paren
suffix:semicolon
id|timeout
op_assign
id|QDIO_CLEANUP_HALT_TIMEOUT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ENODEV
)paren
(brace
multiline_comment|/* No need to wait for device no longer present. */
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
(paren
r_void
op_star
)paren
id|cdev-&gt;handler
op_ne
(paren
r_void
op_star
)paren
id|qdio_handler
)paren
op_logical_and
id|rc
op_eq
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * Whoever put another handler there, has to cope with the&n;&t;&t; * interrupt theirself. Might happen if qdio_shutdown was&n;&t;&t; * called on already shutdown queues, but this shouldn&squot;t have&n;&t;&t; * bad side effects.&n;&t;&t; */
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_CLEANUP
)paren
suffix:semicolon
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
id|timeout
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
comma
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_INACTIVE
op_logical_or
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;ccw_device_{halt,clear} returned %d for &quot;
l_string|&quot;device %s&bslash;n&quot;
comma
id|result
comma
id|cdev-&gt;dev.bus_id
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|rc
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq_ptr-&gt;is_thinint_irq
)paren
(brace
id|qdio_put_indicator
c_func
(paren
(paren
id|__u32
op_star
)paren
id|irq_ptr-&gt;dev_st_chg_ind
)paren
suffix:semicolon
id|tiqdio_set_subchannel_ind
c_func
(paren
id|irq_ptr
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset adapter interrupt indicators */
)brace
multiline_comment|/* exchange int handlers, if necessary */
r_if
c_cond
(paren
(paren
r_void
op_star
)paren
id|cdev-&gt;handler
op_eq
(paren
r_void
op_star
)paren
id|qdio_handler
)paren
id|cdev-&gt;handler
op_assign
id|irq_ptr-&gt;original_int_handler
suffix:semicolon
multiline_comment|/* Ignore errors. */
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_int
DECL|function|qdio_free
id|qdio_free
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|down
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qfqs%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT1
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_allocate_do_dbf
id|qdio_allocate_do_dbf
c_func
(paren
r_struct
id|qdio_initialize
op_star
id|init_data
)paren
(brace
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* if a printf printed out more than 8 chars */
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qfmt:%x&quot;
comma
id|init_data-&gt;q_format
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
id|init_data-&gt;adapter_name
comma
l_int|8
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qpff%4x&quot;
comma
id|init_data-&gt;qib_param_field_format
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;qib_param_field
comma
r_sizeof
(paren
r_char
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_slib_elements
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_slib_elements
comma
r_sizeof
(paren
r_int
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;miit%4x&quot;
comma
id|init_data-&gt;min_input_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;mait%4x&quot;
comma
id|init_data-&gt;max_input_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;miot%4x&quot;
comma
id|init_data-&gt;min_output_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;maot%4x&quot;
comma
id|init_data-&gt;max_output_threshold
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;niq:%4x&quot;
comma
id|init_data-&gt;no_input_qs
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;noq:%4x&quot;
comma
id|init_data-&gt;no_output_qs
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_handler
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_handler
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;int_parm
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;flags
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;input_sbal_addr_array
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|init_data-&gt;output_sbal_addr_array
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_allocate_fill_input_desc
id|qdio_allocate_fill_input_desc
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
id|i
comma
r_int
id|iqfmt
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_iqdio_q
op_assign
id|iqfmt
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_thinint_q
op_assign
id|irq_ptr-&gt;is_thinint_irq
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|sliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sl
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|akey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|bkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|ckey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
)braket
dot
id|dkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_allocate_fill_output_desc
id|qdio_allocate_fill_output_desc
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
comma
r_int
id|i
comma
r_int
id|j
comma
r_int
id|iqfmt
)paren
(brace
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_iqdio_q
op_assign
id|iqfmt
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_thinint_q
op_assign
id|irq_ptr-&gt;is_thinint_irq
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|sliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|sla
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|sl
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|slsba
op_assign
(paren
r_int
r_int
)paren
(paren
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|slsb.acc.val
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|akey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|bkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|ckey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qdf0
(braket
id|i
op_plus
id|j
)braket
dot
id|dkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|qdio_initialize_set_siga_flags_input
id|qdio_initialize_set_siga_flags_input
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_in
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_out
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_thinints
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;hydra_gives_outbound_pcis
suffix:semicolon
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_outb_tis
op_assign
(paren
(paren
id|irq_ptr-&gt;qdioac
op_amp
(paren
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
op_or
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
)paren
)paren
op_eq
(paren
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
op_or
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_void
DECL|function|qdio_initialize_set_siga_flags_output
id|qdio_initialize_set_siga_flags_output
c_func
(paren
r_struct
id|qdio_irq
op_star
id|irq_ptr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_in
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_INPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_out
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_OUTPUT_NECESSARY
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_thinints
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;hydra_gives_outbound_pcis
suffix:semicolon
id|irq_ptr-&gt;output_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|siga_sync_done_on_outb_tis
op_assign
(paren
(paren
id|irq_ptr-&gt;qdioac
op_amp
(paren
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
op_or
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
)paren
)paren
op_eq
(paren
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
op_or
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_THININTS
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_inline
r_int
DECL|function|qdio_establish_irq_check_for_errors
id|qdio_establish_irq_check_for_errors
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|cstat
comma
r_int
id|dstat
)paren
(brace
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
id|cstat
op_logical_or
(paren
id|dstat
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;ick1%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|dstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|cstat
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;received check condition on establish &quot;
"&bslash;"
l_string|&quot;queues on irq 0x%x (cs=x%x, ds=x%x).&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|cstat
comma
id|dstat
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|dstat
op_amp
id|DEV_STAT_DEV_END
)paren
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:no de&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|dstat
comma
r_sizeof
(paren
id|dstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|cstat
comma
r_sizeof
(paren
id|cstat
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: didn&squot;t get &quot;
l_string|&quot;device end: dstat=%02x, cstat=%02x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|dstat
comma
id|cstat
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dstat
op_amp
op_complement
(paren
id|DEV_STAT_CHN_END
op_or
id|DEV_STAT_DEV_END
)paren
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;eq:badio&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|dstat
comma
r_sizeof
(paren
id|dstat
)paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX2
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|cstat
comma
r_sizeof
(paren
id|cstat
)paren
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;establish queues on irq %04x: got &quot;
l_string|&quot;the following devstat: dstat=%02x, &quot;
l_string|&quot;cstat=%02x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|dstat
comma
id|cstat
)paren
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ERR
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_establish_handle_irq
id|qdio_establish_handle_irq
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|cstat
comma
r_int
id|dstat
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qehi%4x&quot;
comma
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_establish_irq_check_for_errors
c_func
(paren
id|cdev
comma
id|cstat
comma
id|dstat
)paren
)paren
(brace
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ESTABLISHED
)paren
suffix:semicolon
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|qdio_initialize
id|qdio_initialize
c_func
(paren
r_struct
id|qdio_initialize
op_star
id|init_data
)paren
(brace
r_int
id|rc
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qini%4x&quot;
comma
id|init_data-&gt;cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|rc
op_assign
id|qdio_allocate
c_func
(paren
id|init_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|rc
op_assign
id|qdio_establish
c_func
(paren
id|init_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|qdio_free
c_func
(paren
id|init_data-&gt;cdev
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|qdio_allocate
id|qdio_allocate
c_func
(paren
r_struct
id|qdio_initialize
op_star
id|init_data
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qalc%4x&quot;
comma
id|init_data-&gt;cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|init_data-&gt;no_input_qs
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
op_logical_or
(paren
id|init_data-&gt;no_output_qs
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
op_logical_or
(paren
(paren
id|init_data-&gt;no_input_qs
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;input_handler
)paren
)paren
op_logical_or
(paren
(paren
id|init_data-&gt;no_output_qs
)paren
op_logical_and
(paren
op_logical_neg
id|init_data-&gt;output_handler
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_data-&gt;input_sbal_addr_array
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_data-&gt;output_sbal_addr_array
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|qdio_allocate_do_dbf
c_func
(paren
id|init_data
)paren
suffix:semicolon
multiline_comment|/* create irq */
id|irq_ptr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qdio_irq
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;irq_ptr:&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
(brace
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of irq_ptr failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|irq_ptr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qdio_irq
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
multiline_comment|/* QDR must be in DMA area since CCW data address is only 32 bit */
id|irq_ptr-&gt;qdr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|qdr
)paren
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_ptr-&gt;qdr
)paren
)paren
(brace
id|kfree
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;kmalloc of irq_ptr-&gt;qdr failed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;qdr:&quot;
)paren
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;qdr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_alloc_qs
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
)paren
)paren
(brace
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_data-&gt;cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
op_assign
id|irq_ptr
suffix:semicolon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_INACTIVE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|qdio_fill_irq
r_int
id|qdio_fill_irq
c_func
(paren
r_struct
id|qdio_initialize
op_star
id|init_data
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|15
)braket
suffix:semicolon
r_struct
id|ciw
op_star
id|ciw
suffix:semicolon
r_int
id|is_iqdio
suffix:semicolon
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
id|irq_ptr
op_assign
id|init_data-&gt;cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
id|memset
c_func
(paren
id|irq_ptr
comma
l_int|0
comma
(paren
(paren
r_char
op_star
)paren
op_amp
id|irq_ptr-&gt;qdr
)paren
op_minus
(paren
(paren
r_char
op_star
)paren
id|irq_ptr
)paren
)paren
suffix:semicolon
multiline_comment|/* wipes qib.ac, required by ar7063 */
id|memset
c_func
(paren
id|irq_ptr-&gt;qdr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|qdr
)paren
)paren
suffix:semicolon
id|irq_ptr-&gt;int_parm
op_assign
id|init_data-&gt;int_parm
suffix:semicolon
id|irq_ptr-&gt;irq
op_assign
id|init_data-&gt;cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
suffix:semicolon
id|irq_ptr-&gt;no_input_qs
op_assign
id|init_data-&gt;no_input_qs
suffix:semicolon
id|irq_ptr-&gt;no_output_qs
op_assign
id|init_data-&gt;no_output_qs
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
(brace
id|irq_ptr-&gt;is_iqdio_irq
op_assign
l_int|1
suffix:semicolon
id|irq_ptr-&gt;is_thinint_irq
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|irq_ptr-&gt;is_iqdio_irq
op_assign
l_int|0
suffix:semicolon
id|irq_ptr-&gt;is_thinint_irq
op_assign
id|hydra_thinints
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;is_i_t%1x%1x&quot;
comma
id|irq_ptr-&gt;is_iqdio_irq
comma
id|irq_ptr-&gt;is_thinint_irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;is_thinint_irq
)paren
(brace
id|irq_ptr-&gt;dev_st_chg_ind
op_assign
id|qdio_get_indicator
c_func
(paren
)paren
suffix:semicolon
id|QDIO_DBF_HEX1
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|irq_ptr-&gt;dev_st_chg_ind
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr-&gt;dev_st_chg_ind
)paren
(brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;no indicator location available &quot;
"&bslash;"
l_string|&quot;for irq 0x%x&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
)brace
multiline_comment|/* defaults */
id|irq_ptr-&gt;equeue.cmd
op_assign
id|DEFAULT_ESTABLISH_QS_CMD
suffix:semicolon
id|irq_ptr-&gt;equeue.count
op_assign
id|DEFAULT_ESTABLISH_QS_COUNT
suffix:semicolon
id|irq_ptr-&gt;aqueue.cmd
op_assign
id|DEFAULT_ACTIVATE_QS_CMD
suffix:semicolon
id|irq_ptr-&gt;aqueue.count
op_assign
id|DEFAULT_ACTIVATE_QS_COUNT
suffix:semicolon
id|qdio_fill_qs
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;cdev
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;input_handler
comma
id|init_data-&gt;output_handler
comma
id|init_data-&gt;int_parm
comma
id|init_data-&gt;q_format
comma
id|init_data-&gt;flags
comma
id|init_data-&gt;input_sbal_addr_array
comma
id|init_data-&gt;output_sbal_addr_array
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|THIS_MODULE
)paren
)paren
(brace
id|QDIO_PRINT_CRIT
c_func
(paren
l_string|&quot;try_module_get() failed!&bslash;n&quot;
)paren
suffix:semicolon
id|qdio_release_irq_memory
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|qdio_fill_thresholds
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;min_input_threshold
comma
id|init_data-&gt;max_input_threshold
comma
id|init_data-&gt;min_output_threshold
comma
id|init_data-&gt;max_output_threshold
)paren
suffix:semicolon
multiline_comment|/* fill in qdr */
id|irq_ptr-&gt;qdr-&gt;qfmt
op_assign
id|init_data-&gt;q_format
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;iqdcnt
op_assign
id|init_data-&gt;no_input_qs
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;oqdcnt
op_assign
id|init_data-&gt;no_output_qs
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;iqdsz
op_assign
r_sizeof
(paren
r_struct
id|qdesfmt0
)paren
op_div
l_int|4
suffix:semicolon
multiline_comment|/* size in words */
id|irq_ptr-&gt;qdr-&gt;oqdsz
op_assign
r_sizeof
(paren
r_struct
id|qdesfmt0
)paren
op_div
l_int|4
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qiba
op_assign
(paren
r_int
r_int
)paren
op_amp
id|irq_ptr-&gt;qib
suffix:semicolon
id|irq_ptr-&gt;qdr-&gt;qkey
op_assign
id|QDIO_STORAGE_KEY
suffix:semicolon
multiline_comment|/* fill in qib */
id|irq_ptr-&gt;qib.qfmt
op_assign
id|init_data-&gt;q_format
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;no_input_qs
)paren
id|irq_ptr-&gt;qib.isliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;input_qs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_data-&gt;no_output_qs
)paren
id|irq_ptr-&gt;qib.osliba
op_assign
(paren
r_int
r_int
)paren
(paren
id|irq_ptr-&gt;output_qs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|slib
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|irq_ptr-&gt;qib.ebcnam
comma
id|init_data-&gt;adapter_name
comma
l_int|8
)paren
suffix:semicolon
id|qdio_set_impl_params
c_func
(paren
id|irq_ptr
comma
id|init_data-&gt;qib_param_field_format
comma
id|init_data-&gt;qib_param_field
comma
id|init_data-&gt;no_input_qs
comma
id|init_data-&gt;no_output_qs
comma
id|init_data-&gt;input_slib_elements
comma
id|init_data-&gt;output_slib_elements
)paren
suffix:semicolon
multiline_comment|/* first input descriptors, then output descriptors */
id|is_iqdio
op_assign
(paren
id|init_data-&gt;q_format
op_eq
id|QDIO_IQDIO_QFMT
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
id|qdio_allocate_fill_input_desc
c_func
(paren
id|irq_ptr
comma
id|i
comma
id|is_iqdio
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|init_data-&gt;no_output_qs
suffix:semicolon
id|i
op_increment
)paren
id|qdio_allocate_fill_output_desc
c_func
(paren
id|irq_ptr
comma
id|i
comma
id|init_data-&gt;no_input_qs
comma
id|is_iqdio
)paren
suffix:semicolon
multiline_comment|/* qdr, qib, sls, slsbs, slibs, sbales filled. */
multiline_comment|/* get qdio commands */
id|ciw
op_assign
id|ccw_device_get_ciw
c_func
(paren
id|init_data-&gt;cdev
comma
id|CIW_TYPE_EQUEUE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ciw
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;no eq&quot;
)paren
suffix:semicolon
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;No equeue CIW found for QDIO commands. &quot;
l_string|&quot;Trying to use default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|irq_ptr-&gt;equeue
op_assign
op_star
id|ciw
suffix:semicolon
id|ciw
op_assign
id|ccw_device_get_ciw
c_func
(paren
id|init_data-&gt;cdev
comma
id|CIW_TYPE_AQUEUE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ciw
)paren
(brace
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
l_string|&quot;no aq&quot;
)paren
suffix:semicolon
id|QDIO_PRINT_INFO
c_func
(paren
l_string|&quot;No aqueue CIW found for QDIO commands. &quot;
l_string|&quot;Trying to use default.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|irq_ptr-&gt;aqueue
op_assign
op_star
id|ciw
suffix:semicolon
multiline_comment|/* Set new interrupt handler. */
id|irq_ptr-&gt;original_int_handler
op_assign
id|init_data-&gt;cdev-&gt;handler
suffix:semicolon
id|init_data-&gt;cdev-&gt;handler
op_assign
id|qdio_handler
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|qdio_establish
id|qdio_establish
c_func
(paren
r_struct
id|qdio_initialize
op_star
id|init_data
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_int
r_int
id|saveflags
suffix:semicolon
r_int
id|result
comma
id|result2
suffix:semicolon
r_struct
id|ccw_device
op_star
id|cdev
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|cdev
op_assign
id|init_data-&gt;cdev
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|state
op_ne
id|DEV_STATE_ONLINE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_fill_irq
c_func
(paren
id|init_data
)paren
suffix:semicolon
multiline_comment|/* the thinint CHSC stuff */
r_if
c_cond
(paren
id|irq_ptr-&gt;is_thinint_irq
)paren
(brace
id|result
op_assign
id|tiqdio_set_subchannel_ind
c_func
(paren
id|irq_ptr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|tiqdio_set_delay_target
c_func
(paren
id|irq_ptr
comma
id|TIQDIO_DELAY_TARGET
)paren
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qest%4x&quot;
comma
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
multiline_comment|/* establish q */
id|irq_ptr-&gt;ccw.cmd_code
op_assign
id|irq_ptr-&gt;equeue.cmd
suffix:semicolon
id|irq_ptr-&gt;ccw.flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|irq_ptr-&gt;ccw.count
op_assign
id|irq_ptr-&gt;equeue.count
suffix:semicolon
id|irq_ptr-&gt;ccw.cda
op_assign
id|QDIO_GET_ADDR
c_func
(paren
id|irq_ptr-&gt;qdr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|saveflags
)paren
suffix:semicolon
id|ccw_device_set_options
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
id|result
op_assign
id|ccw_device_start_timeout
c_func
(paren
id|cdev
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ESTABLISH
comma
l_int|0
comma
l_int|0
comma
id|QDIO_ESTABLISH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|result2
op_assign
id|ccw_device_start_timeout
c_func
(paren
id|cdev
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ESTABLISH
comma
l_int|0
comma
l_int|0
comma
id|QDIO_ESTABLISH_TIMEOUT
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;eq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;eq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
)brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;establish queues on irq %04x: do_IO &quot;
"&bslash;"
l_string|&quot;returned %i, next try returned %i&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
comma
id|result2
)paren
suffix:semicolon
id|result
op_assign
id|result2
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|wait_event_interruptible_timeout
c_func
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
comma
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ESTABLISHED
op_logical_or
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ERR
comma
id|QDIO_ESTABLISH_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ESTABLISHED
)paren
id|result
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|irq_ptr-&gt;qdioac
op_assign
id|qdio_check_siga_needs
c_func
(paren
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* if this gets set once, we&squot;re running under VM and can omit SVSes */
r_if
c_cond
(paren
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_NECESSARY
)paren
id|omit_svs
op_assign
l_int|1
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qdioac%2x&quot;
comma
id|irq_ptr-&gt;qdioac
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qib ac%2x&quot;
comma
id|irq_ptr-&gt;qib.ac
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|irq_ptr-&gt;hydra_gives_outbound_pcis
op_assign
id|irq_ptr-&gt;qib.ac
op_amp
id|QIB_AC_OUTBOUND_PCI_SUPPORTED
suffix:semicolon
id|irq_ptr-&gt;sync_done_on_outb_pcis
op_assign
id|irq_ptr-&gt;qdioac
op_amp
id|CHSC_FLAG_SIGA_SYNC_DONE_ON_OUTB_PCIS
suffix:semicolon
id|qdio_initialize_set_siga_flags_input
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|qdio_initialize_set_siga_flags_output
c_func
(paren
id|irq_ptr
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_int
DECL|function|qdio_activate
id|qdio_activate
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
id|flags
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
r_int
id|i
comma
id|result
op_assign
l_int|0
comma
id|result2
suffix:semicolon
r_int
r_int
id|saveflags
suffix:semicolon
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* see qdio_initialize */
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|state
op_ne
id|DEV_STATE_ONLINE
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_INACTIVE
)paren
(brace
id|result
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qact%4x&quot;
comma
id|irq_ptr-&gt;irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
multiline_comment|/* activate q */
id|irq_ptr-&gt;ccw.cmd_code
op_assign
id|irq_ptr-&gt;aqueue.cmd
suffix:semicolon
id|irq_ptr-&gt;ccw.flags
op_assign
id|CCW_FLAG_SLI
suffix:semicolon
id|irq_ptr-&gt;ccw.count
op_assign
id|irq_ptr-&gt;aqueue.count
suffix:semicolon
id|irq_ptr-&gt;ccw.cda
op_assign
id|QDIO_GET_ADDR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|saveflags
)paren
suffix:semicolon
id|ccw_device_set_timeout
c_func
(paren
id|cdev
comma
l_int|0
)paren
suffix:semicolon
id|ccw_device_set_options
c_func
(paren
id|cdev
comma
id|CCWDEV_REPORT_ALL
)paren
suffix:semicolon
id|result
op_assign
id|ccw_device_start
c_func
(paren
id|cdev
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ACTIVATE
comma
l_int|0
comma
id|DOIO_DENY_PREFETCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
id|result2
op_assign
id|ccw_device_start
c_func
(paren
id|cdev
comma
op_amp
id|irq_ptr-&gt;ccw
comma
id|QDIO_DOING_ACTIVATE
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;aq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result2
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;aq:io%4x&quot;
comma
id|result
)paren
suffix:semicolon
id|QDIO_DBF_TEXT2
c_func
(paren
l_int|1
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
)brace
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;activate queues on irq %04x: do_IO &quot;
"&bslash;"
l_string|&quot;returned %i, next try returned %i&bslash;n&quot;
comma
id|irq_ptr-&gt;irq
comma
id|result
comma
id|result2
)paren
suffix:semicolon
id|result
op_assign
id|result2
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
id|get_ccwdev_lock
c_func
(paren
id|cdev
)paren
comma
id|saveflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_goto
id|out
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq_ptr-&gt;is_thinint_irq
)paren
(brace
multiline_comment|/* &n;&t;&t;&t; * that way we know, that, if we will get interrupted&n;&t;&t;&t; * by tiqdio_inbound_processing, qdio_unmark_q will&n;&t;&t;&t; * not be called &n;&t;&t;&t; */
id|qdio_reserve_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|qdio_mark_tiq
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
id|qdio_release_q
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|irq_ptr-&gt;no_input_qs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_ptr-&gt;input_qs
(braket
id|i
)braket
op_member_access_from_pointer
id|is_input_q
op_or_assign
id|QDIO_FLAG_NO_INPUT_INTERRUPT_CONTEXT
suffix:semicolon
)brace
)brace
id|wait_event_interruptible_timeout
c_func
(paren
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|wait_q
comma
(paren
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_STOPPED
)paren
op_logical_or
(paren
id|irq_ptr-&gt;state
op_eq
id|QDIO_IRQ_STATE_ERR
)paren
)paren
comma
id|QDIO_ACTIVATE_TIMEOUT
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|irq_ptr-&gt;state
)paren
(brace
r_case
id|QDIO_IRQ_STATE_STOPPED
suffix:colon
r_case
id|QDIO_IRQ_STATE_ERR
suffix:colon
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|qdio_shutdown
c_func
(paren
id|cdev
comma
id|QDIO_FLAG_CLEANUP_USING_CLEAR
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|qdio_set_state
c_func
(paren
id|irq_ptr
comma
id|QDIO_IRQ_STATE_ACTIVE
)paren
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
)brace
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|irq_ptr-&gt;setting_up_sema
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* buffers filled forwards again to make Rick happy */
r_static
r_inline
r_void
DECL|function|qdio_do_qdio_fill_input
id|qdio_do_qdio_fill_input
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
r_struct
id|qdio_buffer
op_star
id|buffers
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|qidx
)braket
comma
id|SLSB_CU_INPUT_EMPTY
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_break
suffix:semicolon
id|qidx
op_assign
(paren
id|qidx
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* not necessary, as the queues are synced during the SIGA read */
multiline_comment|/*SYNC_MEMORY;*/
)brace
r_static
r_inline
r_void
DECL|function|qdio_do_qdio_fill_output
id|qdio_do_qdio_fill_output
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
r_struct
id|qdio_buffer
op_star
id|buffers
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_slsb
c_func
(paren
op_amp
id|q-&gt;slsb.acc.val
(braket
id|qidx
)braket
comma
id|SLSB_CU_OUTPUT_PRIMED
)paren
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
r_break
suffix:semicolon
id|qidx
op_assign
(paren
id|qidx
op_plus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* SIGA write will sync the queues */
multiline_comment|/*SYNC_MEMORY;*/
)brace
r_static
r_inline
r_void
DECL|function|do_qdio_handle_inbound
id|do_qdio_handle_inbound
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
r_int
id|callflags
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
r_struct
id|qdio_buffer
op_star
id|buffers
)paren
(brace
r_int
id|used_elements
suffix:semicolon
multiline_comment|/* This is the inbound handling of queues */
id|used_elements
op_assign
id|atomic_add_return
c_func
(paren
id|count
comma
op_amp
id|q-&gt;number_of_buffers_used
)paren
op_minus
id|count
suffix:semicolon
id|qdio_do_qdio_fill_input
c_func
(paren
id|q
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|used_elements
op_plus
id|count
op_eq
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_and
(paren
id|callflags
op_amp
id|QDIO_FLAG_UNDER_INTERRUPT
)paren
)paren
id|atomic_swap
c_func
(paren
op_amp
id|q-&gt;polling
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|used_elements
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_DONT_SIGA
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;siga_in
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|qdio_siga_input
c_func
(paren
id|q
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;siga_error
)paren
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_MORE_THAN_ONE_SIGA_ERROR
suffix:semicolon
id|q-&gt;error_status_flags
op_or_assign
id|QDIO_STATUS_LOOK_FOR_ERROR
suffix:semicolon
id|q-&gt;siga_error
op_assign
id|result
suffix:semicolon
)brace
)brace
id|qdio_mark_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|do_qdio_handle_outbound
id|do_qdio_handle_outbound
c_func
(paren
r_struct
id|qdio_q
op_star
id|q
comma
r_int
r_int
id|callflags
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
r_struct
id|qdio_buffer
op_star
id|buffers
)paren
(brace
r_int
id|used_elements
suffix:semicolon
multiline_comment|/* This is the outbound handling of queues */
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.start_time_outbound
op_assign
id|NOW
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|qdio_do_qdio_fill_output
c_func
(paren
id|q
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
id|used_elements
op_assign
id|atomic_add_return
c_func
(paren
id|count
comma
op_amp
id|q-&gt;number_of_buffers_used
)paren
op_minus
id|count
suffix:semicolon
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_DONT_SIGA
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.outbound_time
op_add_assign
id|NOW
op_minus
id|perf_stats.start_time_outbound
suffix:semicolon
id|perf_stats.outbound_cnt
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|q-&gt;is_iqdio_q
)paren
(brace
multiline_comment|/* one siga for every sbal */
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|qdio_kick_outbound_q
c_func
(paren
id|q
)paren
suffix:semicolon
id|__qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* under VM, we do a SIGA sync unconditionally */
id|SYNC_MEMORY
suffix:semicolon
r_else
(brace
multiline_comment|/* &n;&t;&t;&t; * w/o shadow queues (else branch of&n;&t;&t;&t; * SYNC_MEMORY :-/ ), we try to&n;&t;&t;&t; * fast-requeue buffers &n;&t;&t;&t; */
r_if
c_cond
(paren
id|q-&gt;slsb.acc.val
(braket
(paren
id|qidx
op_plus
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
op_amp
(paren
id|QDIO_MAX_BUFFERS_PER_Q
op_minus
l_int|1
)paren
)braket
op_ne
id|SLSB_CU_OUTPUT_PRIMED
)paren
(brace
id|qdio_kick_outbound_q
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
r_else
(brace
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
l_string|&quot;fast-req&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.fast_reqs
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
)brace
multiline_comment|/* &n;&t;&t; * only marking the q could take too long,&n;&t;&t; * the upper layer module could do a lot of&n;&t;&t; * traffic in that time &n;&t;&t; */
id|__qdio_outbound_processing
c_func
(paren
id|q
)paren
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.outbound_time
op_add_assign
id|NOW
op_minus
id|perf_stats.start_time_outbound
suffix:semicolon
id|perf_stats.outbound_cnt
op_increment
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
multiline_comment|/* count must be 1 in iqdio */
r_int
DECL|function|do_QDIO
id|do_QDIO
c_func
(paren
r_struct
id|ccw_device
op_star
id|cdev
comma
r_int
r_int
id|callflags
comma
r_int
r_int
id|queue_number
comma
r_int
r_int
id|qidx
comma
r_int
r_int
id|count
comma
r_struct
id|qdio_buffer
op_star
id|buffers
)paren
(brace
r_struct
id|qdio_irq
op_star
id|irq_ptr
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;doQD%04x&quot;
comma
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|irq
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
(paren
id|qidx
OG
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_or
(paren
id|count
OG
id|QDIO_MAX_BUFFERS_PER_Q
)paren
op_logical_or
(paren
id|queue_number
OG
id|QDIO_MAX_QUEUES_PER_IRQ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|irq_ptr
op_assign
id|cdev
op_member_access_from_pointer
r_private
op_member_access_from_pointer
id|qdio_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq_ptr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_else
id|QDIO_DBF_HEX3
c_func
(paren
l_int|0
comma
id|trace
comma
op_amp
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;flag%04x&quot;
comma
id|callflags
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;qi%02xct%02x&quot;
comma
id|qidx
comma
id|count
)paren
suffix:semicolon
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|0
comma
id|trace
comma
id|dbf_text
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_if
c_cond
(paren
id|irq_ptr-&gt;state
op_ne
id|QDIO_IRQ_STATE_ACTIVE
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_INPUT
)paren
id|do_qdio_handle_inbound
c_func
(paren
id|irq_ptr-&gt;input_qs
(braket
id|queue_number
)braket
comma
id|callflags
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|callflags
op_amp
id|QDIO_FLAG_SYNC_OUTPUT
)paren
id|do_qdio_handle_outbound
c_func
(paren
id|irq_ptr-&gt;output_qs
(braket
id|queue_number
)braket
comma
id|callflags
comma
id|qidx
comma
id|count
comma
id|buffers
)paren
suffix:semicolon
r_else
(brace
id|QDIO_DBF_TEXT3
c_func
(paren
l_int|1
comma
id|trace
comma
l_string|&quot;doQD:inv&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
r_static
r_int
DECL|function|qdio_perf_procfile_read
id|qdio_perf_procfile_read
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|buffer_location
comma
id|off_t
id|offset
comma
r_int
id|buffer_length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|c
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* we are always called with buffer_length=4k, so we all&n;           deliver on the first read */
r_if
c_cond
(paren
id|offset
OG
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
DECL|macro|_OUTP_IT
mdefine_line|#define _OUTP_IT(x...) c+=sprintf(buffer+c,x)
id|_OUTP_IT
c_func
(paren
l_string|&quot;i_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|i_p_nc
comma
id|i_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;ii_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|ii_p_nc
comma
id|ii_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;o_p_nc/c=%lu/%lu&bslash;n&quot;
comma
id|o_p_nc
comma
id|o_p_c
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of tasklet runs (total)                  : %u&bslash;n&quot;
comma
id|perf_stats.tl_runs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA sync&squot;s issued                    : %u&bslash;n&quot;
comma
id|perf_stats.siga_syncs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA in&squot;s issued                      : %u&bslash;n&quot;
comma
id|perf_stats.siga_ins
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of SIGA out&squot;s issued                     : %u&bslash;n&quot;
comma
id|perf_stats.siga_outs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of PCIs caught                           : %u&bslash;n&quot;
comma
id|perf_stats.pcis
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of adapter interrupts caught             : %u&bslash;n&quot;
comma
id|perf_stats.thinints
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of fast requeues (outg. SBALs w/o SIGA)  : %u&bslash;n&quot;
comma
id|perf_stats.fast_reqs
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Total time of all inbound actions (us) incl. UL : %u&bslash;n&quot;
comma
id|perf_stats.inbound_time
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of inbound transfers                     : %u&bslash;n&quot;
comma
id|perf_stats.inbound_cnt
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Total time of all outbound do_QDIOs (us)        : %u&bslash;n&quot;
comma
id|perf_stats.outbound_time
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;Number of do_QDIOs outbound                     : %u&bslash;n&quot;
comma
id|perf_stats.outbound_cnt
)paren
suffix:semicolon
id|_OUTP_IT
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
DECL|variable|qdio_perf_proc_file
r_static
r_struct
id|proc_dir_entry
op_star
id|qdio_perf_proc_file
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
r_static
r_void
DECL|function|qdio_add_procfs_entry
id|qdio_add_procfs_entry
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|proc_perf_file_registration
op_assign
l_int|0
suffix:semicolon
id|qdio_perf_proc_file
op_assign
id|create_proc_entry
c_func
(paren
id|QDIO_PERF
comma
id|S_IFREG
op_or
l_int|0444
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_perf_proc_file
)paren
(brace
id|qdio_perf_proc_file-&gt;read_proc
op_assign
op_amp
id|qdio_perf_procfile_read
suffix:semicolon
)brace
r_else
id|proc_perf_file_registration
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|proc_perf_file_registration
)paren
id|QDIO_PRINT_WARN
c_func
(paren
l_string|&quot;was not able to register perf. &quot;
"&bslash;"
l_string|&quot;proc-file (%i).&bslash;n&quot;
comma
id|proc_perf_file_registration
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
r_static
r_void
DECL|function|qdio_remove_procfs_entry
id|qdio_remove_procfs_entry
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|perf_stats.tl_runs
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_perf_file_registration
)paren
multiline_comment|/* means if it went ok earlier */
id|remove_proc_entry
c_func
(paren
id|QDIO_PERF
comma
op_amp
id|proc_root
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
)brace
r_static
r_void
DECL|function|tiqdio_register_thinints
id|tiqdio_register_thinints
c_func
(paren
r_void
)paren
(brace
r_char
id|dbf_text
(braket
l_int|20
)braket
suffix:semicolon
id|register_thinint_result
op_assign
id|s390_register_adapter_interrupt
c_func
(paren
op_amp
id|tiqdio_thinint_handler
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_thinint_result
)paren
(brace
id|sprintf
c_func
(paren
id|dbf_text
comma
l_string|&quot;regthn%x&quot;
comma
(paren
id|register_thinint_result
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
id|dbf_text
)paren
suffix:semicolon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;failed to register adapter handler &quot;
"&bslash;"
l_string|&quot;(rc=%i).&bslash;nAdapter interrupts might &quot;
"&bslash;"
l_string|&quot;not work. Continuing.&bslash;n&quot;
comma
id|register_thinint_result
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|tiqdio_unregister_thinints
id|tiqdio_unregister_thinints
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|register_thinint_result
)paren
id|s390_unregister_adapter_interrupt
c_func
(paren
op_amp
id|tiqdio_thinint_handler
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|qdio_get_qdio_memory
id|qdio_get_qdio_memory
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|indicator_used
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|INDICATORS_PER_CACHELINE
suffix:semicolon
id|i
op_increment
)paren
id|indicator_used
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|indicators
op_assign
(paren
id|__u32
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|__u32
)paren
op_star
(paren
id|INDICATORS_PER_CACHELINE
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|indicators
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|indicators
comma
l_int|0
comma
r_sizeof
(paren
id|__u32
)paren
op_star
(paren
id|INDICATORS_PER_CACHELINE
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_release_qdio_memory
id|qdio_release_qdio_memory
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|indicators
)paren
id|kfree
c_func
(paren
id|indicators
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|qdio_unregister_dbf_views
id|qdio_unregister_dbf_views
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|qdio_dbf_setup
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_setup
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_sbal
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_sbal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_sense
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_sense
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_trace
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_trace
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
r_if
c_cond
(paren
id|qdio_dbf_slsb_out
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_slsb_out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qdio_dbf_slsb_in
)paren
id|debug_unregister
c_func
(paren
id|qdio_dbf_slsb_in
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
)brace
r_static
r_int
DECL|function|qdio_register_dbf_views
id|qdio_register_dbf_views
c_func
(paren
r_void
)paren
(brace
id|qdio_dbf_setup
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SETUP_NAME
comma
id|QDIO_DBF_SETUP_INDEX
comma
id|QDIO_DBF_SETUP_NR_AREAS
comma
id|QDIO_DBF_SETUP_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_setup
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_setup
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_setup
comma
id|QDIO_DBF_SETUP_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_sbal
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SBAL_NAME
comma
id|QDIO_DBF_SBAL_INDEX
comma
id|QDIO_DBF_SBAL_NR_AREAS
comma
id|QDIO_DBF_SBAL_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_sbal
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_sbal
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_sbal
comma
id|QDIO_DBF_SBAL_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_sense
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SENSE_NAME
comma
id|QDIO_DBF_SENSE_INDEX
comma
id|QDIO_DBF_SENSE_NR_AREAS
comma
id|QDIO_DBF_SENSE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_sense
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_sense
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_sense
comma
id|QDIO_DBF_SENSE_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_trace
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_TRACE_NAME
comma
id|QDIO_DBF_TRACE_INDEX
comma
id|QDIO_DBF_TRACE_NR_AREAS
comma
id|QDIO_DBF_TRACE_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_trace
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_trace
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_trace
comma
id|QDIO_DBF_TRACE_LEVEL
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_QDIO_DEBUG
id|qdio_dbf_slsb_out
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SLSB_OUT_NAME
comma
id|QDIO_DBF_SLSB_OUT_INDEX
comma
id|QDIO_DBF_SLSB_OUT_NR_AREAS
comma
id|QDIO_DBF_SLSB_OUT_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_slsb_out
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_slsb_out
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_slsb_out
comma
id|QDIO_DBF_SLSB_OUT_LEVEL
)paren
suffix:semicolon
id|qdio_dbf_slsb_in
op_assign
id|debug_register
c_func
(paren
id|QDIO_DBF_SLSB_IN_NAME
comma
id|QDIO_DBF_SLSB_IN_INDEX
comma
id|QDIO_DBF_SLSB_IN_NR_AREAS
comma
id|QDIO_DBF_SLSB_IN_LEN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qdio_dbf_slsb_in
)paren
r_goto
id|oom
suffix:semicolon
id|debug_register_view
c_func
(paren
id|qdio_dbf_slsb_in
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|qdio_dbf_slsb_in
comma
id|QDIO_DBF_SLSB_IN_LEVEL
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_QDIO_DEBUG */
r_return
l_int|0
suffix:semicolon
id|oom
suffix:colon
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;not enough memory for dbf.&bslash;n&quot;
)paren
suffix:semicolon
id|qdio_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|init_QDIO
id|init_QDIO
c_func
(paren
r_void
)paren
(brace
r_int
id|res
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
r_void
op_star
id|ptr
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|printk
c_func
(paren
l_string|&quot;qdio: loading %s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
id|res
op_assign
id|qdio_get_qdio_memory
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_return
id|res
suffix:semicolon
id|res
op_assign
id|qdio_register_dbf_views
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_return
id|res
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;initQDIO&quot;
)paren
suffix:semicolon
macro_line|#ifdef QDIO_PERFORMANCE_STATS
id|memset
c_func
(paren
(paren
r_void
op_star
)paren
op_amp
id|perf_stats
comma
l_int|0
comma
r_sizeof
(paren
id|perf_stats
)paren
)paren
suffix:semicolon
id|QDIO_DBF_TEXT0
c_func
(paren
l_int|0
comma
id|setup
comma
l_string|&quot;perfstat&quot;
)paren
suffix:semicolon
id|ptr
op_assign
op_amp
id|perf_stats
suffix:semicolon
id|QDIO_DBF_HEX0
c_func
(paren
l_int|0
comma
id|setup
comma
op_amp
id|ptr
comma
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
macro_line|#endif /* QDIO_PERFORMANCE_STATS */
id|qdio_add_procfs_entry
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tiqdio_check_chsc_availability
c_func
(paren
)paren
)paren
id|QDIO_PRINT_ERR
c_func
(paren
l_string|&quot;Not all CHSCs supported. Continuing.&bslash;n&quot;
)paren
suffix:semicolon
id|tiqdio_register_thinints
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|cleanup_QDIO
id|cleanup_QDIO
c_func
(paren
r_void
)paren
(brace
id|tiqdio_unregister_thinints
c_func
(paren
)paren
suffix:semicolon
id|qdio_remove_procfs_entry
c_func
(paren
)paren
suffix:semicolon
id|qdio_release_qdio_memory
c_func
(paren
)paren
suffix:semicolon
id|qdio_unregister_dbf_views
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;qdio: %s: module removed&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
)brace
DECL|variable|init_QDIO
id|module_init
c_func
(paren
id|init_QDIO
)paren
suffix:semicolon
DECL|variable|cleanup_QDIO
id|module_exit
c_func
(paren
id|cleanup_QDIO
)paren
suffix:semicolon
DECL|variable|qdio_allocate
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_allocate
)paren
suffix:semicolon
DECL|variable|qdio_establish
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_establish
)paren
suffix:semicolon
DECL|variable|qdio_initialize
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_initialize
)paren
suffix:semicolon
DECL|variable|qdio_activate
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_activate
)paren
suffix:semicolon
DECL|variable|do_QDIO
id|EXPORT_SYMBOL
c_func
(paren
id|do_QDIO
)paren
suffix:semicolon
DECL|variable|qdio_shutdown
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_shutdown
)paren
suffix:semicolon
DECL|variable|qdio_free
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_free
)paren
suffix:semicolon
DECL|variable|qdio_cleanup
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_cleanup
)paren
suffix:semicolon
DECL|variable|qdio_synchronize
id|EXPORT_SYMBOL
c_func
(paren
id|qdio_synchronize
)paren
suffix:semicolon
eof
