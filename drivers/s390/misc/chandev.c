multiline_comment|/*&n; *  drivers/s390/misc/chandev.c&n; *&n; *    Copyright (C) 2000 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)&n; * &n; *  Generic channel device initialisation support. &n; */
DECL|macro|TRUE
mdefine_line|#define TRUE 1
DECL|macro|FALSE
mdefine_line|#define FALSE 0
DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;asm/chandev.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/s390dyn.h&gt;
macro_line|#include &lt;asm/queue.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#ifndef MIN
DECL|macro|MIN
mdefine_line|#define MIN(a,b) ((a&lt;b)?a:b)
macro_line|#endif
macro_line|#ifndef MAX
DECL|macro|MAX
mdefine_line|#define MAX(a,b) ((a&gt;b)?a:b)
macro_line|#endif
DECL|typedef|chandev_model_info
r_typedef
r_struct
id|chandev_model_info
id|chandev_model_info
suffix:semicolon
DECL|struct|chandev_model_info
r_struct
id|chandev_model_info
(brace
DECL|member|next
r_struct
id|chandev_model_info
op_star
id|next
suffix:semicolon
DECL|member|chan_type
id|chandev_type
id|chan_type
suffix:semicolon
DECL|member|cu_type
id|s32
id|cu_type
suffix:semicolon
multiline_comment|/* control unit type  -1 = don&squot;t care */
DECL|member|cu_model
id|s16
id|cu_model
suffix:semicolon
multiline_comment|/* control unit model -1 = don&squot;t care */
DECL|member|dev_type
id|s32
id|dev_type
suffix:semicolon
multiline_comment|/* device type -1 = don&squot;t care */
DECL|member|dev_model
id|s16
id|dev_model
suffix:semicolon
multiline_comment|/* device model -1 = don&squot;t care */
DECL|member|max_port_no
id|u8
id|max_port_no
suffix:semicolon
DECL|member|auto_msck_recovery
r_int
id|auto_msck_recovery
suffix:semicolon
DECL|member|default_checksum_received_ip_pkts
id|u8
id|default_checksum_received_ip_pkts
suffix:semicolon
DECL|member|default_use_hw_stats
id|u8
id|default_use_hw_stats
suffix:semicolon
multiline_comment|/* where available e.g. lcs */
DECL|member|drinfo
id|devreg_t
id|drinfo
suffix:semicolon
)brace
suffix:semicolon
DECL|typedef|chandev
r_typedef
r_struct
id|chandev
id|chandev
suffix:semicolon
DECL|struct|chandev
r_struct
id|chandev
(brace
DECL|member|next
r_struct
id|chandev
op_star
id|next
suffix:semicolon
DECL|member|model_info
id|chandev_model_info
op_star
id|model_info
suffix:semicolon
DECL|member|sch
id|chandev_subchannel_info
id|sch
suffix:semicolon
DECL|member|owned
r_int
id|owned
suffix:semicolon
)brace
suffix:semicolon
DECL|typedef|chandev_noauto_range
r_typedef
r_struct
id|chandev_noauto_range
id|chandev_noauto_range
suffix:semicolon
DECL|struct|chandev_noauto_range
r_struct
id|chandev_noauto_range
(brace
DECL|member|next
r_struct
id|chandev_noauto_range
op_star
id|next
suffix:semicolon
DECL|member|lo_devno
id|u16
id|lo_devno
suffix:semicolon
DECL|member|hi_devno
id|u16
id|hi_devno
suffix:semicolon
)brace
suffix:semicolon
DECL|typedef|chandev_force
r_typedef
r_struct
id|chandev_force
id|chandev_force
suffix:semicolon
DECL|struct|chandev_force
r_struct
id|chandev_force
(brace
DECL|member|next
r_struct
id|chandev_force
op_star
id|next
suffix:semicolon
DECL|member|chan_type
id|chandev_type
id|chan_type
suffix:semicolon
DECL|member|devif_num
id|s32
id|devif_num
suffix:semicolon
multiline_comment|/* -1 don&squot;t care, -2 we are forcing a range e.g. tr0 implies 0 */
DECL|member|read_lo_devno
id|u16
id|read_lo_devno
suffix:semicolon
DECL|member|write_hi_devno
id|u16
id|write_hi_devno
suffix:semicolon
DECL|member|data_devno
id|u16
id|data_devno
suffix:semicolon
multiline_comment|/* only used by gigabit ethernet */
DECL|member|memory_usage_in_k
id|s32
id|memory_usage_in_k
suffix:semicolon
DECL|member|port_protocol_no
id|s16
id|port_protocol_no
suffix:semicolon
multiline_comment|/* where available e.g. lcs,-1 don&squot;t care */
DECL|member|checksum_received_ip_pkts
id|u8
id|checksum_received_ip_pkts
suffix:semicolon
DECL|member|use_hw_stats
id|u8
id|use_hw_stats
suffix:semicolon
multiline_comment|/* where available e.g. lcs */
multiline_comment|/* claw specific stuff */
DECL|member|claw
id|chandev_claw_info
id|claw
suffix:semicolon
)brace
suffix:semicolon
DECL|typedef|chandev_probelist
r_typedef
r_struct
id|chandev_probelist
id|chandev_probelist
suffix:semicolon
DECL|struct|chandev_probelist
r_struct
id|chandev_probelist
(brace
DECL|member|next
r_struct
id|chandev_probelist
op_star
id|next
suffix:semicolon
DECL|member|probefunc
id|chandev_probefunc
id|probefunc
suffix:semicolon
DECL|member|shutdownfunc
id|chandev_shutdownfunc
id|shutdownfunc
suffix:semicolon
DECL|member|msck_notfunc
id|chandev_msck_notification_func
id|msck_notfunc
suffix:semicolon
DECL|member|chan_type
id|chandev_type
id|chan_type
suffix:semicolon
DECL|member|devices_found
r_int
id|devices_found
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|default_msck_bits
mdefine_line|#define default_msck_bits ((1&lt;&lt;(chandev_status_not_oper-1))|(1&lt;&lt;(chandev_status_no_path-1))|(1&lt;&lt;(chandev_status_revalidate-1))|(1&lt;&lt;(chandev_status_gone-1)))
DECL|variable|msck_status_strs
r_static
r_char
op_star
id|msck_status_strs
(braket
)braket
op_assign
(brace
l_string|&quot;good&quot;
comma
l_string|&quot;not_operational&quot;
comma
l_string|&quot;no_path&quot;
comma
l_string|&quot;revalidate&quot;
comma
l_string|&quot;device_gone&quot;
)brace
suffix:semicolon
DECL|typedef|chandev_msck_range
r_typedef
r_struct
id|chandev_msck_range
id|chandev_msck_range
suffix:semicolon
DECL|struct|chandev_msck_range
r_struct
id|chandev_msck_range
(brace
DECL|member|next
r_struct
id|chandev_msck_range
op_star
id|next
suffix:semicolon
DECL|member|lo_devno
id|u16
id|lo_devno
suffix:semicolon
DECL|member|hi_devno
id|u16
id|hi_devno
suffix:semicolon
DECL|member|auto_msck_recovery
r_int
id|auto_msck_recovery
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|chandev_msck_range_head
r_static
id|chandev_msck_range
op_star
id|chandev_msck_range_head
op_assign
l_int|NULL
suffix:semicolon
DECL|typedef|chandev_irqinfo
r_typedef
r_struct
id|chandev_irqinfo
id|chandev_irqinfo
suffix:semicolon
DECL|struct|chandev_irqinfo
r_struct
id|chandev_irqinfo
(brace
DECL|member|next
id|chandev_irqinfo
op_star
id|next
suffix:semicolon
DECL|member|sch
id|chandev_subchannel_info
id|sch
suffix:semicolon
DECL|member|msck_status
id|chandev_msck_status
id|msck_status
suffix:semicolon
DECL|member|handler
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
DECL|member|irqflags
r_int
r_int
id|irqflags
suffix:semicolon
DECL|member|dev_id
r_void
op_star
id|dev_id
suffix:semicolon
DECL|member|devname
r_char
id|devname
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|chandev_irqinfo_head
id|chandev_irqinfo
op_star
id|chandev_irqinfo_head
op_assign
l_int|NULL
suffix:semicolon
DECL|typedef|chandev_parms
r_typedef
r_struct
id|chandev_parms
id|chandev_parms
suffix:semicolon
DECL|struct|chandev_parms
r_struct
id|chandev_parms
(brace
DECL|member|next
id|chandev_parms
op_star
id|next
suffix:semicolon
DECL|member|chan_type
id|chandev_type
id|chan_type
suffix:semicolon
DECL|member|lo_devno
id|u16
id|lo_devno
suffix:semicolon
DECL|member|hi_devno
id|u16
id|hi_devno
suffix:semicolon
DECL|member|parmstr
r_char
id|parmstr
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|chandev_persistent
r_static
id|chandev_type
id|chandev_persistent
op_assign
l_int|0
suffix:semicolon
DECL|variable|chandev_parms_head
id|chandev_parms
op_star
id|chandev_parms_head
op_assign
l_int|NULL
suffix:semicolon
DECL|typedef|chandev_activelist
r_typedef
r_struct
id|chandev_activelist
id|chandev_activelist
suffix:semicolon
DECL|struct|chandev_activelist
r_struct
id|chandev_activelist
(brace
DECL|member|next
r_struct
id|chandev_activelist
op_star
id|next
suffix:semicolon
DECL|member|read_irqinfo
id|chandev_irqinfo
op_star
id|read_irqinfo
suffix:semicolon
DECL|member|write_irqinfo
id|chandev_irqinfo
op_star
id|write_irqinfo
suffix:semicolon
DECL|member|data_irqinfo
id|chandev_irqinfo
op_star
id|data_irqinfo
suffix:semicolon
DECL|member|probefunc
id|chandev_probefunc
id|probefunc
suffix:semicolon
DECL|member|shutdownfunc
id|chandev_shutdownfunc
id|shutdownfunc
suffix:semicolon
DECL|member|msck_notfunc
id|chandev_msck_notification_func
id|msck_notfunc
suffix:semicolon
DECL|member|unreg_dev
id|chandev_unregfunc
id|unreg_dev
suffix:semicolon
DECL|member|chan_type
id|chandev_type
id|chan_type
suffix:semicolon
DECL|member|port_no
id|u8
id|port_no
suffix:semicolon
DECL|member|category
id|chandev_category
id|category
suffix:semicolon
DECL|member|memory_usage_in_k
id|s32
id|memory_usage_in_k
suffix:semicolon
DECL|member|dev_ptr
r_void
op_star
id|dev_ptr
suffix:semicolon
DECL|member|devname
r_char
id|devname
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|chandev_models_head
r_static
id|chandev_model_info
op_star
id|chandev_models_head
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* The only reason chandev_head is a queue is so that net devices */
multiline_comment|/* will be by default named in the order of their irqs */
DECL|variable|chandev_head
r_static
id|qheader
id|chandev_head
op_assign
initialization_block
suffix:semicolon
DECL|variable|chandev_noauto_head
r_static
id|chandev_noauto_range
op_star
id|chandev_noauto_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_force_head
r_static
id|chandev_force
op_star
id|chandev_force_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_probelist_head
r_static
id|chandev_probelist
op_star
id|chandev_probelist_head
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|chandev_activelist_head
r_static
id|chandev_activelist
op_star
id|chandev_activelist_head
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
DECL|variable|chandev_use_devno_names
r_int
id|chandev_use_devno_names
op_assign
id|FALSE
suffix:semicolon
macro_line|#endif
DECL|variable|chandev_cautious_auto_detect
r_static
r_int
id|chandev_cautious_auto_detect
op_assign
id|TRUE
suffix:semicolon
DECL|variable|chandev_conf_read
r_static
id|atomic_t
id|chandev_conf_read
op_assign
id|ATOMIC_INIT
c_func
(paren
id|FALSE
)paren
suffix:semicolon
DECL|variable|chandev_initialised
r_static
id|atomic_t
id|chandev_initialised
op_assign
id|ATOMIC_INIT
c_func
(paren
id|FALSE
)paren
suffix:semicolon
DECL|variable|chandev_last_machine_check
r_static
r_int
r_int
id|chandev_last_machine_check
suffix:semicolon
DECL|variable|chandev_msck_task_tq
r_static
r_struct
id|tq_struct
id|chandev_msck_task_tq
suffix:semicolon
DECL|variable|chandev_msck_thread_lock
r_static
id|atomic_t
id|chandev_msck_thread_lock
suffix:semicolon
DECL|variable|chandev_new_msck
r_static
id|atomic_t
id|chandev_new_msck
suffix:semicolon
DECL|variable|chandev_last_startmsck_list_update
r_static
r_int
r_int
id|chandev_last_startmsck_list_update
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|chandev_start
id|chandev_start
comma
DECL|enumerator|chandev_first_tag
id|chandev_first_tag
op_assign
id|chandev_start
comma
DECL|enumerator|chandev_msck
id|chandev_msck
comma
DECL|enumerator|chandev_num_notify_tags
id|chandev_num_notify_tags
DECL|typedef|chandev_userland_notify_tag
)brace
id|chandev_userland_notify_tag
suffix:semicolon
DECL|variable|userland_notify_strs
r_static
r_char
op_star
id|userland_notify_strs
(braket
)braket
op_assign
(brace
l_string|&quot;start&quot;
comma
l_string|&quot;machine_check&quot;
)brace
suffix:semicolon
DECL|typedef|chandev_userland_notify_list
r_typedef
r_struct
id|chandev_userland_notify_list
id|chandev_userland_notify_list
suffix:semicolon
DECL|struct|chandev_userland_notify_list
r_struct
id|chandev_userland_notify_list
(brace
DECL|member|next
id|chandev_userland_notify_list
op_star
id|next
suffix:semicolon
DECL|member|tag
id|chandev_userland_notify_tag
id|tag
suffix:semicolon
DECL|member|prev_status
id|chandev_msck_status
id|prev_status
suffix:semicolon
DECL|member|curr_status
id|chandev_msck_status
id|curr_status
suffix:semicolon
DECL|member|devname
r_char
id|devname
(braket
l_int|0
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|chandev_userland_notify_head
r_static
id|chandev_userland_notify_list
op_star
id|chandev_userland_notify_head
op_assign
l_int|NULL
suffix:semicolon
r_static
r_void
id|chandev_read_conf_if_necessary
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|chandev_read_conf
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &gt;=KERNEL_VERSION(2,3,0)
DECL|typedef|net_device
r_typedef
r_struct
id|net_device
id|net_device
suffix:semicolon
macro_line|#else
DECL|typedef|net_device
r_typedef
r_struct
id|device
id|net_device
suffix:semicolon
DECL|function|init_waitqueue_head
r_static
r_inline
r_void
id|init_waitqueue_head
c_func
(paren
id|wait_queue_head_t
op_star
id|q
)paren
(brace
op_star
id|q
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE&lt;KERNEL_VERSION(2,3,45)
DECL|function|netif_stop_queue
r_static
id|__inline__
r_void
id|netif_stop_queue
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|netif_start_queue
r_static
id|__inline__
r_void
id|netif_start_queue
c_func
(paren
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;tbusy
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|CHANDEV_INVALID_LOCK_OWNER
mdefine_line|#define CHANDEV_INVALID_LOCK_OWNER            -1
DECL|variable|chandev_lock_owner
r_static
r_int
id|chandev_lock_owner
suffix:semicolon
DECL|variable|chandev_lock_cnt
r_static
r_int
id|chandev_lock_cnt
suffix:semicolon
DECL|variable|chandev_spinlock
r_static
id|spinlock_t
id|chandev_spinlock
suffix:semicolon
DECL|macro|CHANDEV_LOCK_DEBUG
mdefine_line|#define CHANDEV_LOCK_DEBUG 0
macro_line|#if CHANDEV_LOCK_DEBUG &amp;&amp; !defined(CONFIG_ARCH_S390X)
DECL|macro|CHANDEV_BACKTRACE_LOOPCNT
mdefine_line|#define CHANDEV_BACKTRACE_LOOPCNT 10
DECL|variable|chandev_first_lock_addr
r_void
op_star
id|chandev_first_lock_addr
(braket
id|CHANDEV_BACKTRACE_LOOPCNT
)braket
comma
DECL|variable|chandev_last_lock_addr
op_star
id|chandev_last_lock_addr
(braket
id|CHANDEV_BACKTRACE_LOOPCNT
)braket
comma
DECL|variable|chandev_last_unlock_addr
op_star
id|chandev_last_unlock_addr
(braket
id|CHANDEV_BACKTRACE_LOOPCNT
)braket
suffix:semicolon
DECL|macro|CHANDEV_BACKTRACE
mdefine_line|#define CHANDEV_BACKTRACE(variable) &bslash;&n;memset((variable),0,sizeof(void *)*CHANDEV_BACKTRACE_LOOPCNT); &bslash;&n;(variable)[0]=__builtin_return_address(0); &bslash;&n;if(((long)variable[0])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[1]=__builtin_return_address(1); &bslash;&n;if(((long)variable[1])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[2]=__builtin_return_address(2); &bslash;&n;if(((long)variable[2])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[3]=__builtin_return_address(3); &bslash;&n;if(((long)variable[3])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[4]=__builtin_return_address(4); &bslash;&n;if(((long)variable[4])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[5]=__builtin_return_address(5); &bslash;&n;if(((long)variable[5])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[6]=__builtin_return_address(6); &bslash;&n;if(((long)variable[6])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[7]=__builtin_return_address(7); &bslash;&n;if(((long)variable[7])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[8]=__builtin_return_address(8); &bslash;&n;if(((long)variable[8])&amp;0x80000000)         &bslash;&n;{                                          &bslash;&n;(variable)[9]=__builtin_return_address(9); &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;} &bslash;&n;}
macro_line|#else
DECL|macro|CHANDEV_BACKTRACE
mdefine_line|#define CHANDEV_BACKTRACE(variable)
macro_line|#endif
DECL|typedef|chandev_not_oper_struct
r_typedef
r_struct
id|chandev_not_oper_struct
id|chandev_not_oper_struct
suffix:semicolon
DECL|struct|chandev_not_oper_struct
r_struct
id|chandev_not_oper_struct
(brace
DECL|member|next
id|chandev_not_oper_struct
op_star
id|next
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|status
r_int
id|status
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* May as well try to keep machine checks in the order they happen so&n; * we use qheader for chandev_not_oper_head instead of list.&n; */
DECL|variable|chandev_not_oper_head
r_static
id|qheader
id|chandev_not_oper_head
op_assign
initialization_block
suffix:semicolon
DECL|variable|chandev_not_oper_spinlock
r_static
id|spinlock_t
id|chandev_not_oper_spinlock
suffix:semicolon
DECL|macro|chandev_interrupt_check
mdefine_line|#define chandev_interrupt_check() &bslash;&n;if(in_interrupt())                &bslash;&n;     printk(KERN_WARNING __FUNCTION__ &quot; called under interrupt this shouldn&squot;t happen&bslash;n&quot;)
DECL|macro|for_each
mdefine_line|#define for_each(variable,head) &bslash;&n;for((variable)=(head);(variable)!=NULL;(variable)=(variable)-&gt;next)
DECL|macro|for_each_allow_delete
mdefine_line|#define for_each_allow_delete(variable,nextmember,head) &bslash;&n;for((variable)=(head),(nextmember)=((head) ? (head)-&gt;next:NULL); &bslash;&n;(variable)!=NULL; (variable)=(nextmember),(nextmember)=((nextmember) ? (nextmember-&gt;next) : NULL))
DECL|macro|for_each_allow_delete2
mdefine_line|#define for_each_allow_delete2(variable,nextmember,head) &bslash;&n;for((variable)=(head);(variable)!=NULL;(variable)=(nextmember))
DECL|function|chandev_lock
r_static
r_void
id|chandev_lock
c_func
(paren
r_void
)paren
(brace
id|eieio
c_func
(paren
)paren
suffix:semicolon
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chandev_lock_owner
op_ne
(paren
r_int
)paren
id|current
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|spin_trylock
c_func
(paren
op_amp
id|chandev_spinlock
)paren
)paren
(brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
id|chandev_lock_cnt
op_assign
l_int|1
suffix:semicolon
id|chandev_lock_owner
op_assign
(paren
r_int
)paren
id|current
suffix:semicolon
id|CHANDEV_BACKTRACE
c_func
(paren
id|chandev_first_lock_addr
)paren
)brace
r_else
(brace
id|chandev_lock_cnt
op_increment
suffix:semicolon
id|CHANDEV_BACKTRACE
c_func
(paren
id|chandev_last_lock_addr
)paren
)brace
r_if
c_cond
(paren
id|chandev_lock_cnt
l_int|100
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;odd lock_cnt %d lcs_chan_lock&quot;
comma
id|chandev_lock_cnt
)paren
suffix:semicolon
id|chandev_lock_cnt
op_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|chandev_full_unlock
r_static
r_int
id|chandev_full_unlock
c_func
(paren
r_void
)paren
(brace
r_int
id|ret_lock_cnt
op_assign
id|chandev_lock_cnt
suffix:semicolon
id|chandev_lock_cnt
op_assign
l_int|0
suffix:semicolon
id|chandev_lock_owner
op_assign
id|CHANDEV_INVALID_LOCK_OWNER
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chandev_spinlock
)paren
suffix:semicolon
r_return
id|ret_lock_cnt
suffix:semicolon
)brace
DECL|function|chandev_unlock
r_static
r_void
id|chandev_unlock
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|chandev_lock_owner
op_ne
(paren
r_int
)paren
id|current
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_unlock: current=%lx&quot;
l_string|&quot; chandev_lock_owner=%lx chandev_lock_cnt=%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|current
comma
id|chandev_lock_owner
comma
id|chandev_lock_cnt
)paren
suffix:semicolon
)brace
id|CHANDEV_BACKTRACE
c_func
(paren
id|chandev_last_unlock_addr
)paren
r_if
c_cond
(paren
op_decrement
id|chandev_lock_cnt
op_eq
l_int|0
)paren
(brace
id|chandev_lock_owner
op_assign
id|CHANDEV_INVALID_LOCK_OWNER
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chandev_spinlock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chandev_lock_cnt
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;odd lock_cnt=%d in chan_unlock&quot;
comma
id|chandev_lock_cnt
)paren
suffix:semicolon
id|chandev_full_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_alloc
r_void
op_star
id|chandev_alloc
c_func
(paren
r_int
id|size
)paren
(brace
r_void
op_star
id|mem
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mem
)paren
(brace
id|memset
c_func
(paren
id|mem
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
)brace
r_return
id|mem
suffix:semicolon
)brace
DECL|function|chandev_add_to_list
r_static
r_void
id|chandev_add_to_list
c_func
(paren
id|list
op_star
op_star
id|listhead
comma
r_void
op_star
id|member
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|add_to_list
c_func
(paren
id|listhead
comma
id|member
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_queuemember
r_static
r_void
id|chandev_queuemember
c_func
(paren
id|qheader
op_star
id|qhead
comma
r_void
op_star
id|member
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|enqueue_tail
c_func
(paren
id|qhead
comma
(paren
id|queue
op_star
)paren
id|member
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_from_list
r_static
r_int
id|chandev_remove_from_list
c_func
(paren
id|list
op_star
op_star
id|listhead
comma
id|list
op_star
id|member
)paren
(brace
r_int
id|retval
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
id|remove_from_list
c_func
(paren
id|listhead
comma
id|member
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_remove_from_queue
r_static
r_int
id|chandev_remove_from_queue
c_func
(paren
id|qheader
op_star
id|qhead
comma
id|queue
op_star
id|member
)paren
(brace
r_int
id|retval
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|retval
op_assign
id|remove_from_queue
c_func
(paren
id|qhead
comma
id|member
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_free_listmember
r_void
id|chandev_free_listmember
c_func
(paren
id|list
op_star
op_star
id|listhead
comma
id|list
op_star
id|member
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|member
)paren
(brace
r_if
c_cond
(paren
id|chandev_remove_from_list
c_func
(paren
id|listhead
comma
id|member
)paren
)paren
(brace
id|kfree
c_func
(paren
id|member
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;chandev_free_listmember detected nonexistant&quot;
l_string|&quot;listmember listhead=%p member %p&bslash;n&quot;
comma
id|listhead
comma
id|member
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_free_queuemember
r_void
id|chandev_free_queuemember
c_func
(paren
id|qheader
op_star
id|qhead
comma
id|queue
op_star
id|member
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|member
)paren
(brace
r_if
c_cond
(paren
id|chandev_remove_from_queue
c_func
(paren
id|qhead
comma
id|member
)paren
)paren
(brace
id|kfree
c_func
(paren
id|member
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;chandev_free_queuemember detected nonexistant&quot;
l_string|&quot;queuemember qhead=%p member %p&bslash;n&quot;
comma
id|qhead
comma
id|member
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_free_all_list
r_void
id|chandev_free_all_list
c_func
(paren
id|list
op_star
op_star
id|listhead
)paren
(brace
id|list
op_star
id|head
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|head
op_assign
id|remove_listhead
c_func
(paren
id|listhead
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|head
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_free_all_queue
r_void
id|chandev_free_all_queue
c_func
(paren
id|qheader
op_star
id|qhead
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|qhead-&gt;head
)paren
(brace
id|chandev_free_queuemember
c_func
(paren
id|qhead
comma
id|qhead-&gt;head
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_wait_for_root_fs
r_static
r_void
id|chandev_wait_for_root_fs
c_func
(paren
r_void
)paren
(brace
id|wait_queue_head_t
id|wait
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|wait
)paren
suffix:semicolon
multiline_comment|/* We need to wait till there is a root filesystem */
r_while
c_loop
(paren
id|init_task.fs-&gt;root
op_eq
l_int|NULL
)paren
(brace
id|sleep_on_timeout
c_func
(paren
op_amp
id|wait
comma
id|HZ
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* We are now hotplug compliant i.e. */
multiline_comment|/* we typically get called in /sbin/hotplug chandev our parameters */
DECL|function|chandev_exec_start_script
r_static
r_int
id|chandev_exec_start_script
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_char
op_star
op_star
id|argv
comma
op_star
id|tempname
suffix:semicolon
r_int
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_int
id|argc
comma
id|loopcnt
suffix:semicolon
r_int
id|allocsize
suffix:semicolon
id|chandev_userland_notify_list
op_star
id|member
suffix:semicolon
id|wait_queue_head_t
id|wait
suffix:semicolon
r_int
id|have_tag
(braket
id|chandev_num_notify_tags
)braket
op_assign
initialization_block
suffix:semicolon
id|chandev_userland_notify_tag
id|tagidx
suffix:semicolon
r_static
r_char
op_star
id|envp
(braket
)braket
op_assign
(brace
l_string|&quot;HOME=/&quot;
comma
l_string|&quot;TERM=linux&quot;
comma
l_string|&quot;PATH=/sbin:/usr/sbin:/bin:/usr/bin&quot;
comma
l_int|NULL
)brace
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|wait
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|current-&gt;comm
comma
l_string|&quot;chandev_script&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|loopcnt
op_assign
l_int|0
suffix:semicolon
id|loopcnt
OL
l_int|10
op_logical_and
(paren
id|jiffies
op_minus
id|chandev_last_startmsck_list_update
)paren
OL
id|HZ
suffix:semicolon
id|loopcnt
op_increment
)paren
(brace
id|sleep_on_timeout
c_func
(paren
op_amp
id|wait
comma
id|HZ
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|chandev_userland_notify_head
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|argc
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|tagidx
op_assign
id|chandev_first_tag
suffix:semicolon
id|tagidx
OL
id|chandev_num_notify_tags
suffix:semicolon
id|tagidx
op_increment
)paren
(brace
id|for_each
c_func
(paren
id|member
comma
id|chandev_userland_notify_head
)paren
(brace
r_if
c_cond
(paren
id|member-&gt;tag
op_eq
id|tagidx
)paren
(brace
r_switch
c_cond
(paren
id|tagidx
)paren
(brace
r_case
id|chandev_start
suffix:colon
id|argc
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|chandev_msck
suffix:colon
id|argc
op_add_assign
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
)brace
r_if
c_cond
(paren
id|have_tag
(braket
id|tagidx
)braket
op_eq
id|FALSE
)paren
(brace
id|argc
op_increment
suffix:semicolon
)brace
id|have_tag
(braket
id|tagidx
)braket
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
id|allocsize
op_assign
(paren
id|argc
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_char
op_star
)paren
suffix:semicolon
multiline_comment|/* Warning possible stack overflow */
multiline_comment|/* We can&squot;t kmalloc the parameters here as execve will */
multiline_comment|/* not return if successful */
id|argv
op_assign
id|alloca
c_func
(paren
id|allocsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argv
)paren
(brace
id|memset
c_func
(paren
id|argv
comma
l_int|0
comma
id|allocsize
)paren
suffix:semicolon
id|argv
(braket
l_int|0
)braket
op_assign
id|hotplug_path
suffix:semicolon
id|argv
(braket
l_int|1
)braket
op_assign
l_string|&quot;chandev&quot;
suffix:semicolon
id|argc
op_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|tagidx
op_assign
id|chandev_first_tag
suffix:semicolon
id|tagidx
OL
id|chandev_num_notify_tags
suffix:semicolon
id|tagidx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|have_tag
(braket
id|tagidx
)braket
)paren
(brace
id|argv
(braket
id|argc
op_increment
)braket
op_assign
id|userland_notify_strs
(braket
id|tagidx
)braket
suffix:semicolon
id|for_each
c_func
(paren
id|member
comma
id|chandev_userland_notify_head
)paren
(brace
r_if
c_cond
(paren
id|member-&gt;tag
op_eq
id|tagidx
)paren
(brace
id|tempname
op_assign
id|alloca
c_func
(paren
id|strlen
c_func
(paren
id|member-&gt;devname
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tempname
)paren
(brace
id|strcpy
c_func
(paren
id|tempname
comma
id|member-&gt;devname
)paren
suffix:semicolon
id|argv
(braket
id|argc
op_increment
)braket
op_assign
id|tempname
suffix:semicolon
)brace
r_else
r_goto
id|Fail
suffix:semicolon
r_if
c_cond
(paren
id|member-&gt;tag
op_eq
id|chandev_msck
)paren
(brace
id|argv
(braket
id|argc
op_increment
)braket
op_assign
id|msck_status_strs
(braket
id|member-&gt;prev_status
)braket
suffix:semicolon
id|argv
(braket
id|argc
op_increment
)braket
op_assign
id|msck_status_strs
(braket
id|member-&gt;curr_status
)braket
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_userland_notify_head
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|chandev_wait_for_root_fs
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* We are basically execve&squot;ing here there normally is no */
multiline_comment|/* return */
id|retval
op_assign
id|exec_usermodehelper
c_func
(paren
id|hotplug_path
comma
id|argv
comma
id|envp
)paren
suffix:semicolon
r_goto
id|Fail2
suffix:semicolon
)brace
id|Fail
suffix:colon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|Fail2
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_allocstr
r_void
op_star
id|chandev_allocstr
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_int
id|offset
)paren
(brace
r_char
op_star
id|member
suffix:semicolon
r_if
c_cond
(paren
(paren
id|member
op_assign
id|chandev_alloc
c_func
(paren
id|offset
op_plus
id|strlen
c_func
(paren
id|str
)paren
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|strcpy
c_func
(paren
op_amp
id|member
(braket
id|offset
)braket
comma
id|str
)paren
suffix:semicolon
)brace
r_return
(paren
r_void
op_star
)paren
id|member
suffix:semicolon
)brace
DECL|function|chandev_add_to_userland_notify_list
r_static
r_int
id|chandev_add_to_userland_notify_list
c_func
(paren
id|chandev_userland_notify_tag
id|tag
comma
r_char
op_star
id|devname
comma
id|chandev_msck_status
id|prev_status
comma
id|chandev_msck_status
id|curr_status
)paren
(brace
id|chandev_userland_notify_list
op_star
id|member
comma
op_star
id|nextmember
suffix:semicolon
r_int
id|pid
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* remove operations still outstanding for this device */
id|for_each_allow_delete
c_func
(paren
id|member
comma
id|nextmember
comma
id|chandev_userland_notify_head
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|member-&gt;devname
comma
id|devname
)paren
op_eq
l_int|0
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_userland_notify_head
comma
(paren
id|list
op_star
)paren
id|member
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|member
op_assign
id|chandev_allocstr
c_func
(paren
id|devname
comma
m_offsetof
(paren
id|chandev_userland_notify_list
comma
id|devname
)paren
)paren
)paren
)paren
(brace
id|member-&gt;tag
op_assign
id|tag
suffix:semicolon
id|member-&gt;prev_status
op_assign
id|prev_status
suffix:semicolon
id|member-&gt;curr_status
op_assign
id|curr_status
suffix:semicolon
id|add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_userland_notify_head
comma
(paren
id|list
op_star
)paren
id|member
)paren
suffix:semicolon
id|chandev_last_startmsck_list_update
op_assign
id|jiffies
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|pid
op_assign
id|kernel_thread
c_func
(paren
id|chandev_exec_start_script
comma
l_int|NULL
comma
id|SIGCHLD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;error making kernel thread for chandev_exec_start_script&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|pid
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;chandev_add_to_startmscklist memory allocation failed devname=%s&bslash;n&quot;
comma
id|devname
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
DECL|function|chandev_oper_func
r_int
id|chandev_oper_func
c_func
(paren
r_int
id|irq
comma
id|devreg_t
op_star
id|dreg
)paren
(brace
id|chandev_last_machine_check
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|chandev_msck_thread_lock
)paren
)paren
(brace
id|schedule_task
c_func
(paren
op_amp
id|chandev_msck_task_tq
)paren
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|chandev_new_msck
comma
id|TRUE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_not_oper_handler
r_static
r_void
id|chandev_not_oper_handler
c_func
(paren
r_int
id|irq
comma
r_int
id|status
)paren
(brace
id|chandev_not_oper_struct
op_star
id|new_not_oper
suffix:semicolon
id|chandev_last_machine_check
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_not_oper
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|chandev_not_oper_struct
)paren
comma
id|GFP_ATOMIC
)paren
)paren
)paren
(brace
id|new_not_oper-&gt;irq
op_assign
id|irq
suffix:semicolon
id|new_not_oper-&gt;status
op_assign
id|status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chandev_not_oper_spinlock
)paren
suffix:semicolon
id|enqueue_tail
c_func
(paren
op_amp
id|chandev_not_oper_head
comma
(paren
id|queue
op_star
)paren
id|new_not_oper
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chandev_not_oper_spinlock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|chandev_msck_thread_lock
)paren
)paren
(brace
id|schedule_task
c_func
(paren
op_amp
id|chandev_msck_task_tq
)paren
suffix:semicolon
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;chandev_not_oper_handler failed to allocate memory &amp; &quot;
l_string|&quot;lost a not operational interrupt %d %x&quot;
comma
id|irq
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|chandev_get_irqinfo_by_irq
id|chandev_irqinfo
op_star
id|chandev_get_irqinfo_by_irq
c_func
(paren
r_int
id|irq
)paren
(brace
id|chandev_irqinfo
op_star
id|curr_irqinfo
suffix:semicolon
id|for_each
c_func
(paren
id|curr_irqinfo
comma
id|chandev_irqinfo_head
)paren
r_if
c_cond
(paren
id|irq
op_eq
id|curr_irqinfo-&gt;sch.irq
)paren
(brace
r_return
id|curr_irqinfo
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|chandev_get_by_irq
id|chandev
op_star
id|chandev_get_by_irq
c_func
(paren
r_int
id|irq
)paren
(brace
id|chandev
op_star
id|curr_chandev
suffix:semicolon
id|for_each
c_func
(paren
id|curr_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
id|curr_chandev-&gt;sch.irq
op_eq
id|irq
)paren
(brace
r_return
id|curr_chandev
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|chandev_get_activelist_by_irq
id|chandev_activelist
op_star
id|chandev_get_activelist_by_irq
c_func
(paren
r_int
id|irq
)paren
(brace
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;read_irqinfo-&gt;sch.irq
op_eq
id|irq
op_logical_or
id|curr_device-&gt;write_irqinfo-&gt;sch.irq
op_eq
id|irq
op_logical_or
(paren
id|curr_device-&gt;data_irqinfo
op_logical_and
id|curr_device-&gt;data_irqinfo-&gt;sch.irq
op_eq
id|irq
)paren
)paren
(brace
r_return
id|curr_device
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|chandev_remove_irqinfo_by_irq
r_void
id|chandev_remove_irqinfo_by_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|chandev_irqinfo
op_star
id|remove_irqinfo
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* remove any orphan irqinfo left lying around. */
r_if
c_cond
(paren
(paren
id|remove_irqinfo
op_assign
id|chandev_get_irqinfo_by_irq
c_func
(paren
id|irq
)paren
)paren
)paren
(brace
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;read_irqinfo
op_eq
id|remove_irqinfo
)paren
(brace
id|curr_device-&gt;read_irqinfo
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|curr_device-&gt;write_irqinfo
op_eq
id|remove_irqinfo
)paren
(brace
id|curr_device-&gt;write_irqinfo
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|curr_device-&gt;data_irqinfo
op_logical_and
id|curr_device-&gt;data_irqinfo
op_eq
id|remove_irqinfo
)paren
(brace
id|curr_device-&gt;data_irqinfo
op_assign
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_irqinfo_head
comma
(paren
id|list
op_star
)paren
id|remove_irqinfo
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_add_schib_info
r_int
id|chandev_add_schib_info
c_func
(paren
r_int
id|irq
comma
id|chandev_subchannel_info
op_star
id|sch
)paren
(brace
id|schib_t
op_star
id|new_schib
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_schib
op_assign
id|s390_get_schib
c_func
(paren
id|irq
)paren
)paren
)paren
(brace
id|sch-&gt;pim
op_assign
id|new_schib-&gt;pmcw.pim
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sch-&gt;chpid
comma
op_amp
id|new_schib-&gt;pmcw.chpid
comma
r_sizeof
(paren
id|sch-&gt;chpid
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|chandev_request_irq
r_int
id|chandev_request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|irqflags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
id|chandev_irqinfo
op_star
id|new_irqinfo
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|s390_dev_info_t
id|devinfo
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|curr_device
op_assign
id|chandev_get_activelist_by_irq
c_func
(paren
id|irq
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_request_irq failed devname=%s irq=%d &quot;
l_string|&quot;it already belongs to %s shutdown this device first.&bslash;n&quot;
comma
id|devname
comma
id|irq
comma
id|curr_device-&gt;devname
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
multiline_comment|/* remove any orphan irqinfo left lying around. */
id|chandev_remove_irqinfo_by_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_irqinfo
op_assign
id|chandev_allocstr
c_func
(paren
id|devname
comma
m_offsetof
(paren
id|chandev_irqinfo
comma
id|devname
)paren
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|retval
op_assign
id|get_dev_info_by_irq
c_func
(paren
id|irq
comma
op_amp
id|devinfo
)paren
)paren
op_logical_or
(paren
id|retval
op_assign
id|s390_request_irq_special
c_func
(paren
id|irq
comma
id|handler
comma
id|chandev_not_oper_handler
comma
id|irqflags
comma
id|devname
comma
id|dev_id
)paren
)paren
)paren
(brace
id|kfree
c_func
(paren
id|new_irqinfo
)paren
suffix:semicolon
)brace
r_else
(brace
id|new_irqinfo-&gt;msck_status
op_assign
id|chandev_status_good
suffix:semicolon
id|new_irqinfo-&gt;sch.devno
op_assign
id|devinfo.devno
suffix:semicolon
id|new_irqinfo-&gt;sch.irq
op_assign
id|irq
suffix:semicolon
id|new_irqinfo-&gt;sch.cu_type
op_assign
id|devinfo.sid_data.cu_type
suffix:semicolon
multiline_comment|/* control unit type */
id|new_irqinfo-&gt;sch.cu_model
op_assign
id|devinfo.sid_data.cu_model
suffix:semicolon
multiline_comment|/* control unit model */
id|new_irqinfo-&gt;sch.dev_type
op_assign
id|devinfo.sid_data.dev_type
suffix:semicolon
multiline_comment|/* device type */
id|new_irqinfo-&gt;sch.dev_model
op_assign
id|devinfo.sid_data.dev_model
suffix:semicolon
multiline_comment|/* device model */
id|chandev_add_schib_info
c_func
(paren
id|irq
comma
op_amp
id|new_irqinfo-&gt;sch
)paren
suffix:semicolon
id|new_irqinfo-&gt;handler
op_assign
id|handler
suffix:semicolon
id|new_irqinfo-&gt;dev_id
op_assign
id|dev_id
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_irqinfo_head
comma
id|new_irqinfo
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_request_irq memory allocation failed devname=%s irq=%d&bslash;n&quot;
comma
id|devname
comma
id|irq
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* This should be safe to call even multiple times. */
DECL|function|chandev_free_irq
r_void
id|chandev_free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
(brace
id|s390_dev_info_t
id|devinfo
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* remove any orphan irqinfo left lying around. */
id|chandev_remove_irqinfo_by_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|get_dev_info_by_irq
c_func
(paren
id|irq
comma
op_amp
id|devinfo
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_free_irq get_dev_info_by_irq reported err=%X on irq %d&bslash;n&quot;
l_string|&quot;should not happen&bslash;n&quot;
comma
id|err
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|devinfo.status
op_amp
id|DEVSTAT_DEVICE_OWNED
)paren
(brace
id|free_irq
c_func
(paren
id|irq
comma
id|dev_id
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* This should be safe even if chandev_free_irq is already called by the device */
DECL|function|chandev_free_irq_by_irqinfo
r_void
id|chandev_free_irq_by_irqinfo
c_func
(paren
id|chandev_irqinfo
op_star
id|irqinfo
)paren
(brace
r_if
c_cond
(paren
id|irqinfo
)paren
(brace
id|chandev_free_irq
c_func
(paren
id|irqinfo-&gt;sch.irq
comma
id|irqinfo-&gt;dev_id
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_sprint_type_model
r_void
id|chandev_sprint_type_model
c_func
(paren
r_char
op_star
id|buff
comma
id|s32
id|type
comma
id|s16
id|model
)paren
(brace
r_if
c_cond
(paren
id|type
op_eq
op_minus
l_int|1
)paren
(brace
id|strcpy
c_func
(paren
id|buff
comma
l_string|&quot;    *    &quot;
)paren
suffix:semicolon
)brace
r_else
id|sprintf
c_func
(paren
id|buff
comma
l_string|&quot; 0x%04x  &quot;
comma
(paren
r_int
)paren
id|type
)paren
suffix:semicolon
id|buff
op_add_assign
id|strlen
c_func
(paren
id|buff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|model
op_eq
op_minus
l_int|1
)paren
(brace
id|strcpy
c_func
(paren
id|buff
comma
l_string|&quot;    *   &quot;
)paren
suffix:semicolon
)brace
r_else
id|sprintf
c_func
(paren
id|buff
comma
l_string|&quot; 0x%02x  &quot;
comma
(paren
r_int
)paren
id|model
)paren
suffix:semicolon
)brace
DECL|function|chandev_sprint_devinfo
r_void
id|chandev_sprint_devinfo
c_func
(paren
r_char
op_star
id|buff
comma
id|s32
id|cu_type
comma
id|s16
id|cu_model
comma
id|s32
id|dev_type
comma
id|s16
id|dev_model
)paren
(brace
id|chandev_sprint_type_model
c_func
(paren
id|buff
comma
id|cu_type
comma
id|cu_model
)paren
suffix:semicolon
id|chandev_sprint_type_model
c_func
(paren
op_amp
id|buff
(braket
id|strlen
c_func
(paren
id|buff
)paren
)braket
comma
id|dev_type
comma
id|dev_model
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_parms
r_void
id|chandev_remove_parms
c_func
(paren
id|chandev_type
id|chan_type
comma
r_int
id|exact_match
comma
r_int
id|lo_devno
)paren
(brace
id|chandev_parms
op_star
id|curr_parms
comma
op_star
id|next_parms
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_parms
comma
id|next_parms
comma
id|chandev_parms_head
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|chan_type
op_amp
(paren
id|curr_parms-&gt;chan_type
)paren
op_logical_and
op_logical_neg
id|exact_match
)paren
op_logical_or
(paren
id|chan_type
op_eq
(paren
id|curr_parms-&gt;chan_type
)paren
op_logical_and
id|exact_match
)paren
)paren
op_logical_and
(paren
id|lo_devno
op_eq
op_minus
l_int|1
op_logical_or
id|lo_devno
op_eq
id|curr_parms-&gt;lo_devno
)paren
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_parms_head
comma
(paren
id|list
op_star
)paren
id|curr_parms
)paren
suffix:semicolon
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_add_parms
r_void
id|chandev_add_parms
c_func
(paren
id|chandev_type
id|chan_type
comma
id|u16
id|lo_devno
comma
id|u16
id|hi_devno
comma
r_char
op_star
id|parmstr
)paren
(brace
id|chandev_parms
op_star
id|parms
suffix:semicolon
r_if
c_cond
(paren
id|lo_devno
OG
id|hi_devno
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_add_parms detected bad device range lo_devno=0x%04x  hi_devno=0x%04x&bslash;n,&quot;
comma
(paren
r_int
)paren
id|lo_devno
comma
(paren
r_int
)paren
id|hi_devno
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|parms
comma
id|chandev_parms_head
)paren
(brace
r_if
c_cond
(paren
id|chan_type
op_amp
(paren
id|parms-&gt;chan_type
)paren
)paren
(brace
id|u16
id|lomax
op_assign
id|MAX
c_func
(paren
id|parms-&gt;lo_devno
comma
id|lo_devno
)paren
comma
id|himin
op_assign
id|MIN
c_func
(paren
id|parms-&gt;hi_devno
comma
id|lo_devno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lomax
op_le
id|himin
)paren
(brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;chandev_add_parms detected overlapping &quot;
l_string|&quot;parameter definitions for chan_type=0x%02x&quot;
l_string|&quot; lo_devno=0x%04x  hi_devno=0x%04x&bslash;n,&quot;
l_string|&quot; do a del_parms.&quot;
comma
id|chan_type
comma
(paren
r_int
)paren
id|lo_devno
comma
(paren
r_int
)paren
id|hi_devno
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|parms
op_assign
id|chandev_allocstr
c_func
(paren
id|parmstr
comma
m_offsetof
(paren
id|chandev_parms
comma
id|parmstr
)paren
)paren
)paren
)paren
(brace
id|parms-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|parms-&gt;lo_devno
op_assign
id|lo_devno
suffix:semicolon
id|parms-&gt;hi_devno
op_assign
id|hi_devno
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_parms_head
comma
(paren
r_void
op_star
)paren
id|parms
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;chandev_add_parms memory request failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|chandev_add_model
r_void
id|chandev_add_model
c_func
(paren
id|chandev_type
id|chan_type
comma
id|s32
id|cu_type
comma
id|s16
id|cu_model
comma
id|s32
id|dev_type
comma
id|s16
id|dev_model
comma
id|u8
id|max_port_no
comma
r_int
id|auto_msck_recovery
comma
id|u8
id|default_checksum_received_ip_pkts
comma
id|u8
id|default_use_hw_stats
)paren
(brace
id|chandev_model_info
op_star
id|newmodel
suffix:semicolon
r_int
id|err
suffix:semicolon
r_char
id|buff
(braket
l_int|40
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|newmodel
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev_model_info
)paren
)paren
)paren
)paren
(brace
id|devreg_t
op_star
id|drinfo
op_assign
op_amp
id|newmodel-&gt;drinfo
suffix:semicolon
id|newmodel-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|newmodel-&gt;cu_type
op_assign
id|cu_type
suffix:semicolon
id|newmodel-&gt;cu_model
op_assign
id|cu_model
suffix:semicolon
id|newmodel-&gt;dev_type
op_assign
id|dev_type
suffix:semicolon
id|newmodel-&gt;dev_model
op_assign
id|dev_model
suffix:semicolon
id|newmodel-&gt;max_port_no
op_assign
id|max_port_no
suffix:semicolon
id|newmodel-&gt;auto_msck_recovery
op_assign
id|auto_msck_recovery
suffix:semicolon
id|newmodel-&gt;default_checksum_received_ip_pkts
op_assign
id|default_checksum_received_ip_pkts
suffix:semicolon
id|newmodel-&gt;default_use_hw_stats
op_assign
id|default_use_hw_stats
suffix:semicolon
multiline_comment|/* where available e.g. lcs */
r_if
c_cond
(paren
id|cu_type
op_eq
op_minus
l_int|1
op_logical_and
id|dev_type
op_eq
op_minus
l_int|1
)paren
(brace
id|chandev_sprint_devinfo
c_func
(paren
id|buff
comma
id|newmodel-&gt;cu_type
comma
id|newmodel-&gt;cu_model
comma
id|newmodel-&gt;dev_type
comma
id|newmodel-&gt;dev_model
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;can&squot;t call s390_device_register for this device chan_type/chan_model/dev_type/dev_model %s&bslash;n&quot;
comma
id|buff
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|newmodel
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|drinfo-&gt;flag
op_assign
id|DEVREG_TYPE_DEVCHARS
suffix:semicolon
r_if
c_cond
(paren
id|cu_type
op_ne
op_minus
l_int|1
)paren
(brace
id|drinfo-&gt;flag
op_or_assign
id|DEVREG_MATCH_CU_TYPE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cu_model
op_ne
op_minus
l_int|1
)paren
(brace
id|drinfo-&gt;flag
op_or_assign
id|DEVREG_MATCH_CU_MODEL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_type
op_ne
op_minus
l_int|1
)paren
(brace
id|drinfo-&gt;flag
op_or_assign
id|DEVREG_MATCH_DEV_TYPE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_model
op_ne
op_minus
l_int|1
)paren
(brace
id|drinfo-&gt;flag
op_or_assign
id|DEVREG_MATCH_DEV_MODEL
suffix:semicolon
)brace
id|drinfo-&gt;ci.hc.ctype
op_assign
id|cu_type
suffix:semicolon
id|drinfo-&gt;ci.hc.cmode
op_assign
id|cu_model
suffix:semicolon
id|drinfo-&gt;ci.hc.dtype
op_assign
id|dev_type
suffix:semicolon
id|drinfo-&gt;ci.hc.dmode
op_assign
id|dev_model
suffix:semicolon
id|drinfo-&gt;oper_func
op_assign
id|chandev_oper_func
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|s390_device_register
c_func
(paren
op_amp
id|newmodel-&gt;drinfo
)paren
)paren
)paren
(brace
id|chandev_sprint_devinfo
c_func
(paren
id|buff
comma
id|newmodel-&gt;cu_type
comma
id|newmodel-&gt;cu_model
comma
id|newmodel-&gt;dev_type
comma
id|newmodel-&gt;dev_model
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;s390_device_register failed in chandev_add_model&quot;
l_string|&quot; this is nothing to worry about chan_type/chan_model/dev_type/dev_model %s&bslash;n&quot;
comma
id|buff
)paren
suffix:semicolon
id|drinfo-&gt;oper_func
op_assign
l_int|NULL
suffix:semicolon
)brace
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_models_head
comma
id|newmodel
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_remove
r_void
id|chandev_remove
c_func
(paren
id|chandev
op_star
id|member
)paren
(brace
id|chandev_free_queuemember
c_func
(paren
op_amp
id|chandev_head
comma
(paren
id|queue
op_star
)paren
id|member
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_all
r_void
id|chandev_remove_all
c_func
(paren
r_void
)paren
(brace
id|chandev_free_all_queue
c_func
(paren
op_amp
id|chandev_head
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_model
r_void
id|chandev_remove_model
c_func
(paren
id|chandev_model_info
op_star
id|model
)paren
(brace
id|chandev
op_star
id|curr_chandev
comma
op_star
id|next_chandev
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_chandev
comma
id|next_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
id|curr_chandev-&gt;model_info
op_eq
id|model
)paren
(brace
id|chandev_remove
c_func
(paren
id|curr_chandev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|model-&gt;drinfo.oper_func
)paren
(brace
id|s390_device_unregister
c_func
(paren
op_amp
id|model-&gt;drinfo
)paren
suffix:semicolon
)brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_models_head
comma
(paren
id|list
op_star
)paren
id|model
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_remove_all_models
r_void
id|chandev_remove_all_models
c_func
(paren
r_void
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|chandev_models_head
)paren
(brace
id|chandev_remove_model
c_func
(paren
id|chandev_models_head
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_del_model
r_void
id|chandev_del_model
c_func
(paren
id|s32
id|cu_type
comma
id|s16
id|cu_model
comma
id|s32
id|dev_type
comma
id|s16
id|dev_model
)paren
(brace
id|chandev_model_info
op_star
id|curr_model
comma
op_star
id|next_model
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_model
comma
id|next_model
comma
id|chandev_models_head
)paren
r_if
c_cond
(paren
(paren
id|curr_model-&gt;cu_type
op_eq
id|cu_type
op_logical_or
id|cu_type
op_eq
op_minus
l_int|1
)paren
op_logical_and
(paren
id|curr_model-&gt;cu_model
op_eq
id|cu_model
op_logical_or
id|cu_model
op_eq
op_minus
l_int|1
)paren
op_logical_and
(paren
id|curr_model-&gt;dev_type
op_eq
id|dev_type
op_logical_or
id|dev_type
op_eq
op_minus
l_int|1
)paren
op_logical_and
(paren
id|curr_model-&gt;dev_model
op_eq
id|dev_model
op_logical_or
id|dev_model
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|chandev_remove_model
c_func
(paren
id|curr_model
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_init_default_models
r_static
r_void
id|chandev_init_default_models
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Usually P390/Planter 3172 emulation assume maximum 16 to be safe. */
id|chandev_add_model
c_func
(paren
id|chandev_type_lcs
comma
l_int|0x3088
comma
l_int|0x1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|15
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* 3172/2216 Paralell the 2216 allows 16 ports per card the */
multiline_comment|/* the original 3172 only allows 4 we will assume the max of 16 */
id|chandev_add_model
c_func
(paren
id|chandev_type_lcs
op_or
id|chandev_type_ctc
comma
l_int|0x3088
comma
l_int|0x8
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|15
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* 3172/2216 Escon serial the 2216 allows 16 ports per card the */
multiline_comment|/* the original 3172 only allows 4 we will assume the max of 16 */
id|chandev_add_model
c_func
(paren
id|chandev_type_lcs
op_or
id|chandev_type_escon
comma
l_int|0x3088
comma
l_int|0x1F
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|15
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* Only 2 ports allowed on OSA2 cards model 0x60 */
id|chandev_add_model
c_func
(paren
id|chandev_type_lcs
comma
l_int|0x3088
comma
l_int|0x60
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|1
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* qeth gigabit ethernet */
id|chandev_add_model
c_func
(paren
id|chandev_type_qeth
comma
l_int|0x1731
comma
l_int|0x1
comma
l_int|0x1732
comma
l_int|0x1
comma
l_int|0
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
id|chandev_add_model
c_func
(paren
id|chandev_type_qeth
comma
l_int|0x1731
comma
l_int|0x5
comma
l_int|0x1732
comma
l_int|0x5
comma
l_int|0
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* Osa-D we currently aren&squot;t too emotionally involved with this */
id|chandev_add_model
c_func
(paren
id|chandev_type_osad
comma
l_int|0x3088
comma
l_int|0x62
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
multiline_comment|/* claw */
id|chandev_add_model
c_func
(paren
id|chandev_type_claw
comma
l_int|0x3088
comma
l_int|0x61
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
id|default_msck_bits
comma
id|FALSE
comma
id|FALSE
)paren
suffix:semicolon
)brace
DECL|function|chandev_del_noauto
r_void
id|chandev_del_noauto
c_func
(paren
id|u16
id|devno
)paren
(brace
id|chandev_noauto_range
op_star
id|curr_noauto
comma
op_star
id|next_noauto
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_noauto
comma
id|next_noauto
comma
id|chandev_noauto_head
)paren
r_if
c_cond
(paren
id|curr_noauto-&gt;lo_devno
op_le
id|devno
op_logical_and
id|curr_noauto-&gt;hi_devno
op_ge
id|devno
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
comma
(paren
id|list
op_star
)paren
id|curr_noauto
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_del_msck
r_void
id|chandev_del_msck
c_func
(paren
id|u16
id|devno
)paren
(brace
id|chandev_msck_range
op_star
id|curr_msck_range
comma
op_star
id|next_msck_range
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_msck_range
comma
id|next_msck_range
comma
id|chandev_msck_range_head
)paren
r_if
c_cond
(paren
id|curr_msck_range-&gt;lo_devno
op_le
id|devno
op_logical_and
id|curr_msck_range-&gt;hi_devno
op_ge
id|devno
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_msck_range_head
comma
(paren
id|list
op_star
)paren
id|curr_msck_range
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_add
r_void
id|chandev_add
c_func
(paren
id|s390_dev_info_t
op_star
id|newdevinfo
comma
id|chandev_model_info
op_star
id|newmodelinfo
)paren
(brace
id|chandev
op_star
id|new_chandev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_chandev
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev
)paren
)paren
)paren
)paren
(brace
id|new_chandev-&gt;model_info
op_assign
id|newmodelinfo
suffix:semicolon
id|new_chandev-&gt;sch.devno
op_assign
id|newdevinfo-&gt;devno
suffix:semicolon
id|new_chandev-&gt;sch.irq
op_assign
id|newdevinfo-&gt;irq
suffix:semicolon
id|new_chandev-&gt;sch.cu_type
op_assign
id|newdevinfo-&gt;sid_data.cu_type
suffix:semicolon
multiline_comment|/* control unit type */
id|new_chandev-&gt;sch.cu_model
op_assign
id|newdevinfo-&gt;sid_data.cu_model
suffix:semicolon
multiline_comment|/* control unit model */
id|new_chandev-&gt;sch.dev_type
op_assign
id|newdevinfo-&gt;sid_data.dev_type
suffix:semicolon
multiline_comment|/* device type */
id|new_chandev-&gt;sch.dev_model
op_assign
id|newdevinfo-&gt;sid_data.dev_model
suffix:semicolon
multiline_comment|/* device model */
id|chandev_add_schib_info
c_func
(paren
id|newdevinfo-&gt;irq
comma
op_amp
id|new_chandev-&gt;sch
)paren
suffix:semicolon
id|new_chandev-&gt;owned
op_assign
(paren
id|newdevinfo-&gt;status
op_amp
id|DEVSTAT_DEVICE_OWNED
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
)paren
suffix:semicolon
id|chandev_queuemember
c_func
(paren
op_amp
id|chandev_head
comma
id|new_chandev
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_unregister_probe
r_void
id|chandev_unregister_probe
c_func
(paren
id|chandev_probefunc
id|probefunc
)paren
(brace
id|chandev_probelist
op_star
id|curr_probe
comma
op_star
id|next_probe
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_probe
comma
id|next_probe
comma
id|chandev_probelist_head
)paren
r_if
c_cond
(paren
id|curr_probe-&gt;probefunc
op_eq
id|probefunc
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
(paren
id|list
op_star
)paren
id|curr_probe
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_unregister_probe_by_chan_type
r_void
id|chandev_unregister_probe_by_chan_type
c_func
(paren
id|chandev_type
id|chan_type
)paren
(brace
id|chandev_probelist
op_star
id|curr_probe
comma
op_star
id|next_probe
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_probe
comma
id|next_probe
comma
id|chandev_probelist_head
)paren
r_if
c_cond
(paren
id|curr_probe-&gt;chan_type
op_eq
id|chan_type
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
(paren
id|list
op_star
)paren
id|curr_probe
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_reset
r_void
id|chandev_reset
c_func
(paren
r_void
)paren
(brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|chandev_remove_all_models
c_func
(paren
)paren
suffix:semicolon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
)paren
suffix:semicolon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_msck_range_head
)paren
suffix:semicolon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_force_head
)paren
suffix:semicolon
id|chandev_remove_parms
c_func
(paren
op_minus
l_int|1
comma
id|FALSE
comma
op_minus
l_int|1
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
id|chandev_use_devno_names
op_assign
id|FALSE
suffix:semicolon
macro_line|#endif
id|chandev_persistent
op_assign
l_int|0
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_is_chandev
r_int
id|chandev_is_chandev
c_func
(paren
r_int
id|irq
comma
id|s390_dev_info_t
op_star
id|devinfo
comma
id|chandev_force
op_star
op_star
id|forceinfo
comma
id|chandev_model_info
op_star
op_star
id|ret_model
)paren
(brace
id|chandev_force
op_star
id|curr_force
suffix:semicolon
id|chandev_model_info
op_star
id|curr_model
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|retval
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
id|forceinfo
)paren
(brace
op_star
id|forceinfo
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret_model
)paren
(brace
op_star
id|ret_model
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|get_dev_info_by_irq
c_func
(paren
id|irq
comma
id|devinfo
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_is_chandev get_dev_info_by_irq reported err=%X on irq %d&bslash;n&quot;
l_string|&quot;should not happen&bslash;n&quot;
comma
id|err
comma
id|irq
)paren
suffix:semicolon
r_return
id|FALSE
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_model
comma
id|chandev_models_head
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|curr_model-&gt;cu_type
op_eq
id|devinfo-&gt;sid_data.cu_type
)paren
op_logical_or
(paren
id|curr_model-&gt;cu_type
op_eq
op_minus
l_int|1
)paren
)paren
op_logical_and
(paren
(paren
id|curr_model-&gt;cu_model
op_eq
id|devinfo-&gt;sid_data.cu_model
)paren
op_logical_or
(paren
id|curr_model-&gt;cu_model
op_eq
op_minus
l_int|1
)paren
)paren
op_logical_and
(paren
(paren
id|curr_model-&gt;dev_type
op_eq
id|devinfo-&gt;sid_data.dev_type
)paren
op_logical_or
(paren
id|curr_model-&gt;dev_type
op_eq
op_minus
l_int|1
)paren
)paren
op_logical_and
(paren
(paren
id|curr_model-&gt;dev_model
op_eq
id|devinfo-&gt;sid_data.dev_model
)paren
op_logical_or
(paren
id|curr_model-&gt;dev_model
op_eq
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|retval
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|ret_model
)paren
(brace
op_star
id|ret_model
op_assign
id|curr_model
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|for_each
c_func
(paren
id|curr_force
comma
id|chandev_force_head
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|curr_force-&gt;read_lo_devno
op_eq
id|devinfo-&gt;devno
)paren
op_logical_and
(paren
id|curr_force-&gt;write_hi_devno
op_eq
id|devinfo-&gt;devno
)paren
op_logical_and
(paren
id|curr_force-&gt;devif_num
op_ne
op_minus
l_int|2
)paren
)paren
op_logical_or
(paren
(paren
id|curr_force-&gt;read_lo_devno
op_ge
id|devinfo-&gt;devno
)paren
op_logical_and
(paren
id|curr_force-&gt;write_hi_devno
op_le
id|devinfo-&gt;devno
)paren
op_logical_and
(paren
id|curr_force-&gt;devif_num
op_eq
op_minus
l_int|2
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|forceinfo
)paren
(brace
op_star
id|forceinfo
op_assign
id|curr_force
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_collect_devices
r_void
id|chandev_collect_devices
c_func
(paren
r_void
)paren
(brace
r_int
id|curr_irq
comma
id|loopcnt
op_assign
l_int|0
suffix:semicolon
id|s390_dev_info_t
id|curr_devinfo
suffix:semicolon
id|chandev_model_info
op_star
id|curr_model
suffix:semicolon
r_for
c_loop
(paren
id|curr_irq
op_assign
id|get_irq_first
c_func
(paren
)paren
suffix:semicolon
id|curr_irq
op_ge
l_int|0
suffix:semicolon
id|curr_irq
op_assign
id|get_irq_next
c_func
(paren
id|curr_irq
)paren
)paren
(brace
multiline_comment|/* check read chandev&n;&t;&t; * we had to do the cu_model check also because ctc devices&n;&t;&t; * have the same cutype &amp; after asking some people&n;&t;&t; * the model numbers are given out pseudo randomly so&n;&t;&t; * we can&squot;t just take a range of them also the dev_type &amp; models are 0&n;&t;&t; */
id|loopcnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|loopcnt
OG
l_int|0x10000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;chandev_collect_devices detected infinite loop bug in get_irq_next&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chandev_is_chandev
c_func
(paren
id|curr_irq
comma
op_amp
id|curr_devinfo
comma
l_int|NULL
comma
op_amp
id|curr_model
)paren
)paren
(brace
id|chandev_add
c_func
(paren
op_amp
id|curr_devinfo
comma
id|curr_model
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_add_force
r_int
id|chandev_add_force
c_func
(paren
id|chandev_type
id|chan_type
comma
id|s32
id|devif_num
comma
id|u16
id|read_lo_devno
comma
id|u16
id|write_hi_devno
comma
id|u16
id|data_devno
comma
id|s32
id|memory_usage_in_k
comma
id|s16
id|port_protocol_no
comma
id|u8
id|checksum_received_ip_pkts
comma
id|u8
id|use_hw_stats
comma
r_char
op_star
id|host_name
comma
r_char
op_star
id|adapter_name
comma
r_char
op_star
id|api_type
)paren
(brace
id|chandev_force
op_star
id|new_chandev_force
suffix:semicolon
r_if
c_cond
(paren
id|devif_num
op_eq
op_minus
l_int|2
op_logical_and
id|read_lo_devno
OG
id|write_hi_devno
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_add_force detected bad device range lo_devno=0x%04x  hi_devno=0x%04x&bslash;n,&quot;
comma
(paren
r_int
)paren
id|read_lo_devno
comma
(paren
r_int
)paren
id|write_hi_devno
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memory_usage_in_k
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_add_force memory_usage_in_k is bad&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chan_type
op_eq
id|chandev_type_claw
)paren
(brace
r_int
id|host_name_len
op_assign
id|strlen
c_func
(paren
id|host_name
)paren
comma
id|adapter_name_len
op_assign
id|strlen
c_func
(paren
id|adapter_name
)paren
comma
id|api_type_len
op_assign
id|strlen
c_func
(paren
id|api_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|host_name_len
op_ge
id|CLAW_NAMELEN
op_logical_or
id|host_name_len
op_eq
l_int|0
op_logical_or
id|adapter_name_len
op_ge
id|CLAW_NAMELEN
op_logical_or
id|adapter_name_len
op_eq
l_int|0
op_logical_or
id|api_type_len
op_ge
id|CLAW_NAMELEN
op_logical_or
id|api_type_len
op_eq
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|new_chandev_force
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev_force
)paren
)paren
)paren
)paren
(brace
id|new_chandev_force-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|new_chandev_force-&gt;devif_num
op_assign
id|devif_num
suffix:semicolon
id|new_chandev_force-&gt;read_lo_devno
op_assign
id|read_lo_devno
suffix:semicolon
id|new_chandev_force-&gt;write_hi_devno
op_assign
id|write_hi_devno
suffix:semicolon
id|new_chandev_force-&gt;data_devno
op_assign
id|data_devno
suffix:semicolon
id|new_chandev_force-&gt;memory_usage_in_k
op_assign
id|memory_usage_in_k
suffix:semicolon
id|new_chandev_force-&gt;port_protocol_no
op_assign
id|port_protocol_no
suffix:semicolon
id|new_chandev_force-&gt;checksum_received_ip_pkts
op_assign
id|checksum_received_ip_pkts
suffix:semicolon
id|new_chandev_force-&gt;use_hw_stats
op_assign
id|use_hw_stats
suffix:semicolon
r_if
c_cond
(paren
id|chan_type
op_eq
id|chandev_type_claw
)paren
(brace
id|strcpy
c_func
(paren
id|new_chandev_force-&gt;claw.host_name
comma
id|host_name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|new_chandev_force-&gt;claw.adapter_name
comma
id|adapter_name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|new_chandev_force-&gt;claw.api_type
comma
id|api_type
)paren
suffix:semicolon
)brace
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_force_head
comma
id|new_chandev_force
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_del_force
r_void
id|chandev_del_force
c_func
(paren
r_int
id|read_lo_devno
)paren
(brace
id|chandev_force
op_star
id|curr_force
comma
op_star
id|next_force
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each_allow_delete
c_func
(paren
id|curr_force
comma
id|next_force
comma
id|chandev_force_head
)paren
(brace
r_if
c_cond
(paren
id|curr_force-&gt;read_lo_devno
op_eq
id|read_lo_devno
op_logical_or
id|read_lo_devno
op_eq
op_minus
l_int|1
)paren
(brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_force_head
comma
(paren
id|list
op_star
)paren
id|curr_force
)paren
suffix:semicolon
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_shutdown
r_void
id|chandev_shutdown
c_func
(paren
id|chandev_activelist
op_star
id|curr_device
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* unregister_netdev calls the dev-&gt;close so we shouldn&squot;t do this */
multiline_comment|/* this otherwise we crash */
r_if
c_cond
(paren
id|curr_device-&gt;unreg_dev
)paren
(brace
id|curr_device
op_member_access_from_pointer
id|unreg_dev
c_func
(paren
id|curr_device-&gt;dev_ptr
)paren
suffix:semicolon
id|curr_device-&gt;unreg_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|curr_device-&gt;shutdownfunc
)paren
(brace
id|err
op_assign
id|curr_device
op_member_access_from_pointer
id|shutdownfunc
c_func
(paren
id|curr_device-&gt;dev_ptr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_shutdown unable to fully shutdown &amp; unload %s err=%d&bslash;n&quot;
l_string|&quot;probably some upper layer still requires the device to exist&bslash;n&quot;
comma
id|curr_device-&gt;devname
comma
id|err
)paren
suffix:semicolon
)brace
r_else
(brace
id|chandev_free_irq_by_irqinfo
c_func
(paren
id|curr_device-&gt;read_irqinfo
)paren
suffix:semicolon
id|chandev_free_irq_by_irqinfo
c_func
(paren
id|curr_device-&gt;write_irqinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_device-&gt;data_irqinfo
)paren
(brace
id|chandev_free_irq_by_irqinfo
c_func
(paren
id|curr_device-&gt;data_irqinfo
)paren
suffix:semicolon
)brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_activelist_head
comma
(paren
id|list
op_star
)paren
id|curr_device
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_shutdown_all
r_void
id|chandev_shutdown_all
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|chandev_activelist_head
)paren
(brace
id|chandev_shutdown
c_func
(paren
id|chandev_activelist_head
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_shutdown_by_name
r_void
id|chandev_shutdown_by_name
c_func
(paren
r_char
op_star
id|devname
)paren
(brace
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|devname
comma
id|curr_device-&gt;devname
)paren
op_eq
l_int|0
)paren
(brace
id|chandev_shutdown
c_func
(paren
id|curr_device
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_active
r_static
id|chandev_activelist
op_star
id|chandev_active
c_func
(paren
id|u16
id|devno
)paren
(brace
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
r_if
c_cond
(paren
id|curr_device-&gt;read_irqinfo-&gt;sch.devno
op_eq
id|devno
op_logical_or
id|curr_device-&gt;write_irqinfo-&gt;sch.devno
op_eq
id|devno
op_logical_or
(paren
id|curr_device-&gt;data_irqinfo
op_logical_and
id|curr_device-&gt;data_irqinfo-&gt;sch.devno
op_eq
id|devno
)paren
)paren
(brace
r_return
id|curr_device
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|chandev_shutdown_by_devno
r_void
id|chandev_shutdown_by_devno
c_func
(paren
id|u16
id|devno
)paren
(brace
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|curr_device
op_assign
id|chandev_active
c_func
(paren
id|devno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_device
)paren
(brace
id|chandev_shutdown
c_func
(paren
id|curr_device
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_pack_args
r_int
id|chandev_pack_args
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|newstr
op_assign
id|str
comma
op_star
id|next
suffix:semicolon
r_int
id|strcnt
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
op_star
id|str
)paren
(brace
id|next
op_assign
id|str
op_plus
l_int|1
suffix:semicolon
multiline_comment|/*remove dead spaces */
r_if
c_cond
(paren
id|isspace
c_func
(paren
op_star
id|str
)paren
op_logical_and
id|isspace
c_func
(paren
op_star
id|next
)paren
)paren
(brace
id|str
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isspace
c_func
(paren
op_star
id|str
)paren
)paren
(brace
op_star
id|str
op_assign
l_char|&squot;,&squot;
suffix:semicolon
r_goto
id|pack_dn
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
op_star
id|str
)paren
op_eq
l_char|&squot;;&squot;
)paren
op_logical_and
(paren
op_star
id|next
)paren
)paren
(brace
id|strcnt
op_increment
suffix:semicolon
op_star
id|str
op_assign
l_int|0
suffix:semicolon
)brace
id|pack_dn
suffix:colon
op_star
id|newstr
op_increment
op_assign
op_star
id|str
op_increment
suffix:semicolon
)brace
op_star
id|newstr
op_assign
l_int|0
suffix:semicolon
r_return
id|strcnt
suffix:semicolon
)brace
r_typedef
r_enum
(brace
DECL|enumerator|isnull
id|isnull
op_assign
l_int|0
comma
DECL|enumerator|isstr
id|isstr
op_assign
l_int|1
comma
DECL|enumerator|isnum
id|isnum
op_assign
l_int|2
comma
DECL|enumerator|iscomma
id|iscomma
op_assign
l_int|4
comma
DECL|typedef|chandev_strval
)brace
id|chandev_strval
suffix:semicolon
DECL|function|chandev_strcmp
id|chandev_strval
id|chandev_strcmp
c_func
(paren
r_char
op_star
id|teststr
comma
r_char
op_star
op_star
id|str
comma
r_int
op_star
id|endlong
)paren
(brace
r_char
op_star
id|cur
suffix:semicolon
id|chandev_strval
id|retval
op_assign
id|isnull
suffix:semicolon
r_int
id|len
op_assign
id|strlen
c_func
(paren
id|teststr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|teststr
comma
op_star
id|str
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
op_star
id|str
op_add_assign
id|len
suffix:semicolon
id|retval
op_assign
id|isstr
suffix:semicolon
id|cur
op_assign
op_star
id|str
suffix:semicolon
op_star
id|endlong
op_assign
id|simple_strtol
c_func
(paren
id|cur
comma
id|str
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur
op_ne
op_star
id|str
)paren
(brace
id|retval
op_or_assign
id|isnum
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
op_star
id|str
op_eq
l_char|&squot;,&squot;
)paren
(brace
id|retval
op_or_assign
id|iscomma
suffix:semicolon
op_star
id|str
op_add_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
op_star
id|str
op_ne
l_int|0
)paren
(brace
id|retval
op_assign
id|isnull
suffix:semicolon
)brace
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_initdevice
r_int
id|chandev_initdevice
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
r_void
op_star
id|dev_ptr
comma
id|u8
id|port_no
comma
r_char
op_star
id|devname
comma
id|chandev_category
id|category
comma
id|chandev_unregfunc
id|unreg_dev
)paren
(brace
id|chandev_activelist
op_star
id|newdevice
comma
op_star
id|curr_device
suffix:semicolon
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|probeinfo-&gt;newdevice
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;probeinfo-&gt;newdevice!=NULL in chandev_initdevice for %s&quot;
comma
id|devname
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|curr_device-&gt;devname
comma
id|devname
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_initdevice detected duplicate devicename %s&bslash;n&quot;
comma
id|devname
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|newdevice
op_assign
id|chandev_allocstr
c_func
(paren
id|devname
comma
m_offsetof
(paren
id|chandev_activelist
comma
id|devname
)paren
)paren
)paren
)paren
(brace
id|newdevice-&gt;read_irqinfo
op_assign
id|chandev_get_irqinfo_by_irq
c_func
(paren
id|probeinfo-&gt;read.irq
)paren
suffix:semicolon
id|newdevice-&gt;write_irqinfo
op_assign
id|chandev_get_irqinfo_by_irq
c_func
(paren
id|probeinfo-&gt;write.irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|probeinfo-&gt;data_exists
)paren
(brace
id|newdevice-&gt;data_irqinfo
op_assign
id|chandev_get_irqinfo_by_irq
c_func
(paren
id|probeinfo-&gt;data.irq
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newdevice-&gt;read_irqinfo
op_eq
l_int|NULL
op_logical_or
id|newdevice-&gt;write_irqinfo
op_eq
l_int|NULL
op_logical_or
(paren
id|probeinfo-&gt;data_exists
op_logical_and
id|newdevice-&gt;data_irqinfo
op_eq
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_initdevice, it appears that chandev_request_irq was not &quot;
l_string|&quot;called for devname=%s read_irq=%d write_irq=%d data_irq=%d&bslash;n&quot;
comma
id|devname
comma
id|probeinfo-&gt;read.irq
comma
id|probeinfo-&gt;write.irq
comma
id|probeinfo-&gt;data.irq
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|newdevice
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|newdevice-&gt;chan_type
op_assign
id|probeinfo-&gt;chan_type
suffix:semicolon
id|newdevice-&gt;dev_ptr
op_assign
id|dev_ptr
suffix:semicolon
id|newdevice-&gt;port_no
op_assign
id|port_no
suffix:semicolon
id|newdevice-&gt;memory_usage_in_k
op_assign
id|probeinfo-&gt;memory_usage_in_k
suffix:semicolon
id|newdevice-&gt;category
op_assign
id|category
suffix:semicolon
id|newdevice-&gt;unreg_dev
op_assign
id|unreg_dev
suffix:semicolon
id|probeinfo-&gt;newdevice
op_assign
id|newdevice
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|chandev_build_device_name
r_char
op_star
id|chandev_build_device_name
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
r_char
op_star
id|destnamebuff
comma
r_char
op_star
id|basename
comma
r_int
id|buildfullname
)paren
(brace
r_if
c_cond
(paren
id|chandev_use_devno_names
op_logical_and
(paren
op_logical_neg
id|probeinfo-&gt;device_forced
op_logical_or
id|probeinfo-&gt;devif_num
op_eq
op_minus
l_int|1
)paren
)paren
id|sprintf
c_func
(paren
id|destnamebuff
comma
l_string|&quot;%s%04x&quot;
comma
id|basename
comma
(paren
r_int
)paren
id|probeinfo-&gt;read.devno
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|probeinfo-&gt;devif_num
op_eq
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|buildfullname
)paren
(brace
r_int
id|idx
comma
id|len
op_assign
id|strlen
c_func
(paren
id|basename
)paren
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|0xffff
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|curr_device-&gt;devname
comma
id|basename
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
r_char
id|numbuff
(braket
l_int|10
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|numbuff
comma
l_string|&quot;%d&quot;
comma
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
op_amp
id|curr_device-&gt;devname
(braket
id|len
)braket
comma
id|numbuff
)paren
op_eq
l_int|0
)paren
(brace
r_goto
id|next_idx
suffix:semicolon
)brace
)brace
)brace
id|sprintf
c_func
(paren
id|destnamebuff
comma
l_string|&quot;%s%d&quot;
comma
id|basename
comma
id|idx
)paren
suffix:semicolon
r_return
id|destnamebuff
suffix:semicolon
id|next_idx
suffix:colon
)brace
id|printk
c_func
(paren
l_string|&quot;chandev_build_device_name was usable to build a unique name for %s&bslash;n&quot;
comma
id|basename
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
id|sprintf
c_func
(paren
id|destnamebuff
comma
l_string|&quot;%s%%d&quot;
comma
id|basename
)paren
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|destnamebuff
comma
l_string|&quot;%s%d&quot;
comma
id|basename
comma
(paren
r_int
)paren
id|probeinfo-&gt;devif_num
)paren
suffix:semicolon
)brace
)brace
r_return
id|destnamebuff
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
DECL|function|chandev_init_netdev
r_struct
id|net_device
op_star
id|chandev_init_netdev
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
r_char
op_star
id|basename
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|sizeof_priv
comma
r_struct
id|net_device
op_star
(paren
op_star
id|init_netdevfunc
)paren
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|sizeof_priv
)paren
)paren
macro_line|#else
r_struct
id|device
op_star
id|chandev_init_netdev
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
r_char
op_star
id|basename
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|sizeof_priv
comma
r_struct
id|device
op_star
(paren
op_star
id|init_netdevfunc
)paren
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|sizeof_priv
)paren
)paren
macro_line|#endif
(brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
r_struct
id|net_device
op_star
id|retdevice
op_assign
l_int|NULL
suffix:semicolon
r_int
id|new_device
op_assign
id|FALSE
suffix:semicolon
macro_line|#else
r_struct
id|device
op_star
id|retdevice
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|init_netdevfunc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;init_netdevfunc=NULL in chandev_init_netdev, it should not be valid.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
multiline_comment|/* Allocate a device if one is not provided. */
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* ensure 32-byte alignment of the private area */
r_int
id|alloc_size
op_assign
r_sizeof
(paren
op_star
id|dev
)paren
op_plus
id|sizeof_priv
op_plus
l_int|31
suffix:semicolon
id|dev
op_assign
(paren
r_struct
id|net_device
op_star
)paren
id|kmalloc
(paren
id|alloc_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;chandev_initnetdevice: Unable to allocate device memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|dev
comma
l_int|0
comma
id|alloc_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sizeof_priv
)paren
id|dev-&gt;priv
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
)paren
(paren
id|dev
op_plus
l_int|1
)paren
op_plus
l_int|31
)paren
op_amp
op_complement
l_int|31
)paren
suffix:semicolon
id|new_device
op_assign
id|TRUE
suffix:semicolon
)brace
id|chandev_build_device_name
c_func
(paren
id|probeinfo
comma
id|dev-&gt;name
comma
id|basename
comma
id|FALSE
)paren
suffix:semicolon
macro_line|#endif
id|retdevice
op_assign
id|init_netdevfunc
c_func
(paren
id|dev
comma
id|sizeof_priv
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
multiline_comment|/* Register device if necessary */
multiline_comment|/* we need to do this as init_netdev doesn&squot;t call register_netdevice */
multiline_comment|/* for already allocated devices */
r_if
c_cond
(paren
id|retdevice
op_logical_and
id|new_device
)paren
id|register_netdev
c_func
(paren
id|retdevice
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
multiline_comment|/* We allocated it, so we should free it on error */
r_if
c_cond
(paren
op_logical_neg
id|retdevice
op_logical_and
id|new_device
)paren
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
macro_line|#endif
r_return
id|retdevice
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
DECL|function|chandev_initnetdevice
r_struct
id|net_device
op_star
id|chandev_initnetdevice
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
id|u8
id|port_no
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|sizeof_priv
comma
r_char
op_star
id|basename
comma
r_struct
id|net_device
op_star
(paren
op_star
id|init_netdevfunc
)paren
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|sizeof_priv
)paren
comma
r_void
(paren
op_star
id|unreg_netdevfunc
)paren
(paren
r_struct
id|net_device
op_star
id|dev
)paren
)paren
macro_line|#else
r_struct
id|device
op_star
id|chandev_initnetdevice
c_func
(paren
id|chandev_probeinfo
op_star
id|probeinfo
comma
id|u8
id|port_no
comma
r_struct
id|device
op_star
id|dev
comma
r_int
id|sizeof_priv
comma
r_char
op_star
id|basename
comma
r_struct
id|device
op_star
(paren
op_star
id|init_netdevfunc
)paren
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|sizeof_priv
)paren
comma
r_void
(paren
op_star
id|unreg_netdevfunc
)paren
(paren
r_struct
id|device
op_star
id|dev
)paren
)paren
macro_line|#endif
(brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
r_struct
id|net_device
op_star
id|retdevice
op_assign
l_int|NULL
suffix:semicolon
r_int
id|new_device
op_assign
(paren
id|dev
op_eq
l_int|NULL
)paren
suffix:semicolon
macro_line|#else
r_struct
id|device
op_star
id|retdevice
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|unreg_netdevfunc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;unreg_netdevfunc=NULL in chandev_initnetdevice, it should not be valid.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
id|retdevice
op_assign
id|chandev_init_netdev
c_func
(paren
id|probeinfo
comma
id|basename
comma
id|dev
comma
id|sizeof_priv
comma
id|init_netdevfunc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retdevice
)paren
(brace
r_if
c_cond
(paren
id|chandev_initdevice
c_func
(paren
id|probeinfo
comma
id|retdevice
comma
id|port_no
comma
id|retdevice-&gt;name
comma
id|chandev_category_network_device
comma
(paren
id|chandev_unregfunc
)paren
id|unreg_netdevfunc
)paren
)paren
(brace
id|unreg_netdevfunc
c_func
(paren
id|retdevice
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
multiline_comment|/* We allocated it, so we should free it on error */
r_if
c_cond
(paren
id|new_device
)paren
(brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
macro_line|#endif
id|retdevice
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|retdevice
suffix:semicolon
)brace
DECL|function|chandev_compare_chpid_info
r_int
id|chandev_compare_chpid_info
c_func
(paren
id|chandev_subchannel_info
op_star
id|chan1
comma
id|chandev_subchannel_info
op_star
id|chan2
)paren
(brace
r_return
(paren
id|chan1-&gt;pim
op_ne
id|chan2-&gt;pim
op_logical_or
op_star
id|chan1-&gt;chpid
op_ne
op_star
id|chan2-&gt;chpid
)paren
suffix:semicolon
)brace
DECL|function|chandev_compare_cu_dev_info
r_int
id|chandev_compare_cu_dev_info
c_func
(paren
id|chandev_subchannel_info
op_star
id|chan1
comma
id|chandev_subchannel_info
op_star
id|chan2
)paren
(brace
r_return
(paren
(paren
id|chan1-&gt;cu_type
op_ne
id|chan2-&gt;cu_type
)paren
op_logical_or
(paren
id|chan1-&gt;cu_model
op_ne
id|chan2-&gt;cu_model
)paren
op_logical_or
(paren
id|chan1-&gt;dev_type
op_ne
id|chan2-&gt;dev_type
)paren
op_logical_or
(paren
id|chan1-&gt;dev_model
op_ne
id|chan2-&gt;dev_model
)paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_compare_subchannel_info
r_int
id|chandev_compare_subchannel_info
c_func
(paren
id|chandev_subchannel_info
op_star
id|chan1
comma
id|chandev_subchannel_info
op_star
id|chan2
)paren
(brace
r_return
(paren
id|chan1-&gt;devno
op_eq
id|chan2-&gt;devno
)paren
op_logical_and
(paren
id|chan1-&gt;cu_type
op_eq
id|chan2-&gt;cu_type
)paren
op_logical_and
(paren
id|chan1-&gt;cu_model
op_eq
id|chan2-&gt;cu_model
)paren
op_logical_and
(paren
id|chan1-&gt;dev_type
op_eq
id|chan2-&gt;dev_type
)paren
op_logical_and
(paren
id|chan1-&gt;dev_model
op_eq
id|chan2-&gt;dev_model
)paren
op_logical_and
(paren
id|chan1-&gt;pim
op_eq
id|chan2-&gt;pim
)paren
op_logical_and
(paren
op_star
id|chan1-&gt;chpid
op_eq
op_star
id|chan2-&gt;chpid
)paren
suffix:semicolon
)brace
DECL|function|chandev_doprobe
r_int
id|chandev_doprobe
c_func
(paren
id|chandev_force
op_star
id|force
comma
id|chandev
op_star
id|read
comma
id|chandev
op_star
id|write
comma
id|chandev
op_star
id|data
)paren
(brace
id|chandev_probelist
op_star
id|probe
suffix:semicolon
id|chandev_model_info
op_star
id|model_info
suffix:semicolon
id|chandev_probeinfo
id|probeinfo
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
comma
id|hint
op_assign
op_minus
l_int|1
suffix:semicolon
id|chandev_activelist
op_star
id|newdevice
suffix:semicolon
id|chandev_probefunc
id|probefunc
suffix:semicolon
id|chandev_parms
op_star
id|curr_parms
suffix:semicolon
id|chandev_model_info
id|dummy_model_info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|probeinfo
comma
l_int|0
comma
r_sizeof
(paren
id|probeinfo
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|dummy_model_info
comma
l_int|0
comma
r_sizeof
(paren
id|dummy_model_info
)paren
)paren
suffix:semicolon
id|probeinfo.device_forced
op_assign
(paren
id|force
op_ne
l_int|NULL
)paren
suffix:semicolon
id|probeinfo.chpid_info_inconsistent
op_assign
id|chandev_compare_chpid_info
c_func
(paren
op_amp
id|read-&gt;sch
comma
op_amp
id|write-&gt;sch
)paren
op_logical_or
(paren
id|data
op_logical_and
id|chandev_compare_chpid_info
c_func
(paren
op_amp
id|read-&gt;sch
comma
op_amp
id|data-&gt;sch
)paren
)paren
suffix:semicolon
id|probeinfo.cu_dev_info_inconsistent
op_assign
id|chandev_compare_cu_dev_info
c_func
(paren
op_amp
id|read-&gt;sch
comma
op_amp
id|write-&gt;sch
)paren
op_logical_or
(paren
id|data
op_logical_and
id|chandev_compare_cu_dev_info
c_func
(paren
op_amp
id|read-&gt;sch
comma
op_amp
id|data-&gt;sch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read-&gt;model_info
)paren
(brace
id|model_info
op_assign
id|read-&gt;model_info
suffix:semicolon
)brace
r_else
(brace
id|dummy_model_info.chan_type
op_assign
id|chandev_type_none
suffix:semicolon
id|dummy_model_info.max_port_no
op_assign
l_int|16
suffix:semicolon
id|model_info
op_assign
op_amp
id|dummy_model_info
suffix:semicolon
)brace
id|for_each
c_func
(paren
id|probe
comma
id|chandev_probelist_head
)paren
(brace
r_if
c_cond
(paren
id|force
)paren
(brace
id|probeinfo.chan_type
op_assign
(paren
id|probe-&gt;chan_type
op_amp
id|force-&gt;chan_type
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|chandev_cautious_auto_detect
)paren
(brace
id|probeinfo.chan_type
op_assign
(paren
id|probe-&gt;chan_type
op_eq
id|model_info-&gt;chan_type
ques
c_cond
id|probe-&gt;chan_type
suffix:colon
id|chandev_type_none
)paren
suffix:semicolon
)brace
r_else
id|probeinfo.chan_type
op_assign
(paren
id|probe-&gt;chan_type
op_amp
id|model_info-&gt;chan_type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|probeinfo.chan_type
op_logical_and
(paren
id|force
op_logical_or
(paren
op_logical_neg
id|probeinfo.cu_dev_info_inconsistent
op_logical_and
(paren
(paren
id|probe-&gt;chan_type
op_amp
(paren
id|chandev_type_ctc
op_or
id|chandev_type_escon
)paren
)paren
op_logical_or
op_logical_neg
id|probeinfo.chpid_info_inconsistent
)paren
)paren
)paren
)paren
(brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
r_if
c_cond
(paren
id|chandev_use_devno_names
)paren
(brace
id|probeinfo.devif_num
op_assign
id|read-&gt;sch.devno
suffix:semicolon
)brace
r_else
macro_line|#endif
id|probeinfo.devif_num
op_assign
op_minus
l_int|1
suffix:semicolon
id|probeinfo.read
op_assign
id|read-&gt;sch
suffix:semicolon
id|probeinfo.write
op_assign
id|write-&gt;sch
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
(brace
id|probeinfo.data
op_assign
id|data-&gt;sch
suffix:semicolon
id|probeinfo.data_exists
op_assign
id|TRUE
suffix:semicolon
)brace
id|probeinfo.max_port_no
op_assign
(paren
id|force
op_logical_and
(paren
id|force-&gt;port_protocol_no
op_ne
op_minus
l_int|1
)paren
ques
c_cond
id|force-&gt;port_protocol_no
suffix:colon
id|model_info-&gt;max_port_no
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_parms
comma
id|chandev_parms_head
)paren
(brace
r_if
c_cond
(paren
id|probe-&gt;chan_type
op_eq
id|curr_parms-&gt;chan_type
op_logical_and
id|read-&gt;sch.devno
op_ge
id|curr_parms-&gt;lo_devno
op_logical_and
id|read-&gt;sch.devno
op_le
id|curr_parms-&gt;hi_devno
)paren
(brace
id|probeinfo.parmstr
op_assign
id|curr_parms-&gt;parmstr
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|force
)paren
(brace
r_if
c_cond
(paren
id|force-&gt;chan_type
op_eq
id|chandev_type_claw
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|probeinfo.claw
comma
op_amp
id|force-&gt;claw
comma
r_sizeof
(paren
id|chandev_claw_info
)paren
)paren
suffix:semicolon
)brace
id|probeinfo.port_protocol_no
op_assign
id|force-&gt;port_protocol_no
suffix:semicolon
r_if
c_cond
(paren
id|force-&gt;devif_num
op_eq
op_minus
l_int|1
op_logical_and
id|force-&gt;devif_num
op_eq
op_minus
l_int|2
)paren
(brace
id|probeinfo.devif_num
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|probeinfo.devif_num
op_assign
id|force-&gt;devif_num
suffix:semicolon
id|probeinfo.memory_usage_in_k
op_assign
id|force-&gt;memory_usage_in_k
suffix:semicolon
id|probeinfo.checksum_received_ip_pkts
op_assign
id|force-&gt;checksum_received_ip_pkts
suffix:semicolon
id|probeinfo.use_hw_stats
op_assign
id|force-&gt;use_hw_stats
suffix:semicolon
)brace
r_else
(brace
id|probeinfo.port_protocol_no
op_assign
l_int|0
suffix:semicolon
id|probeinfo.checksum_received_ip_pkts
op_assign
id|model_info-&gt;default_checksum_received_ip_pkts
suffix:semicolon
id|probeinfo.use_hw_stats
op_assign
id|model_info-&gt;default_use_hw_stats
suffix:semicolon
id|probeinfo.memory_usage_in_k
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|probe-&gt;chan_type
op_amp
id|chandev_type_lcs
)paren
(brace
id|hint
op_assign
(paren
id|read-&gt;sch.devno
op_amp
l_int|0xFF
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|hint
OG
id|model_info-&gt;max_port_no
)paren
(brace
multiline_comment|/* The card is possibly emulated e.g P/390 */
multiline_comment|/* or possibly configured to use a shared */
multiline_comment|/* port configured by osa-sf. */
id|hint
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
id|probeinfo.hint_port_no
op_assign
id|hint
suffix:semicolon
id|probefunc
op_assign
id|probe-&gt;probefunc
suffix:semicolon
id|rc
op_assign
id|probefunc
c_func
(paren
op_amp
id|probeinfo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|newdevice
op_assign
id|probeinfo.newdevice
suffix:semicolon
r_if
c_cond
(paren
id|newdevice
)paren
(brace
id|newdevice-&gt;probefunc
op_assign
id|probe-&gt;probefunc
suffix:semicolon
id|newdevice-&gt;shutdownfunc
op_assign
id|probe-&gt;shutdownfunc
suffix:semicolon
id|newdevice-&gt;msck_notfunc
op_assign
id|probe-&gt;msck_notfunc
suffix:semicolon
id|probe-&gt;devices_found
op_increment
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_activelist_head
comma
id|newdevice
)paren
suffix:semicolon
id|chandev_add_to_userland_notify_list
c_func
(paren
id|chandev_start
comma
id|newdevice-&gt;devname
comma
id|chandev_status_good
comma
id|chandev_status_good
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_initdevice either failed or wasn&squot;t called for device read_irq=0x%04x&bslash;n&quot;
comma
id|probeinfo.read.irq
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
id|chandev_remove
c_func
(paren
id|read
)paren
suffix:semicolon
id|chandev_remove
c_func
(paren
id|write
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
(brace
id|chandev_remove
c_func
(paren
id|data
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|chandev_request_irq_from_irqinfo
r_int
id|chandev_request_irq_from_irqinfo
c_func
(paren
id|chandev_irqinfo
op_star
id|irqinfo
comma
id|chandev
op_star
id|this_chandev
)paren
(brace
r_int
id|retval
op_assign
id|s390_request_irq_special
c_func
(paren
id|irqinfo-&gt;sch.irq
comma
id|irqinfo-&gt;handler
comma
id|chandev_not_oper_handler
comma
id|irqinfo-&gt;irqflags
comma
id|irqinfo-&gt;devname
comma
id|irqinfo-&gt;dev_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
(brace
id|irqinfo-&gt;msck_status
op_assign
id|chandev_status_good
suffix:semicolon
id|this_chandev-&gt;owned
op_assign
id|TRUE
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|function|chandev_irqallocerr
r_void
id|chandev_irqallocerr
c_func
(paren
id|chandev_irqinfo
op_star
id|irqinfo
comma
r_int
id|err
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_probe failed to realloc irq=%d for %s err=%d&bslash;n&quot;
comma
id|irqinfo-&gt;sch.irq
comma
id|irqinfo-&gt;devname
comma
id|err
)paren
suffix:semicolon
)brace
DECL|function|chandev_call_notification_func
r_void
id|chandev_call_notification_func
c_func
(paren
id|chandev_activelist
op_star
id|curr_device
comma
id|chandev_irqinfo
op_star
id|curr_irqinfo
comma
id|chandev_msck_status
id|prevstatus
)paren
(brace
r_if
c_cond
(paren
id|curr_irqinfo-&gt;msck_status
op_ne
id|prevstatus
)paren
(brace
id|chandev_msck_status
id|new_msck_status
op_assign
id|curr_irqinfo-&gt;msck_status
suffix:semicolon
r_if
c_cond
(paren
id|curr_irqinfo-&gt;msck_status
op_eq
id|chandev_status_good
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;read_irqinfo-&gt;msck_status
op_eq
id|chandev_status_good
op_logical_and
id|curr_device-&gt;write_irqinfo-&gt;msck_status
op_eq
id|chandev_status_good
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;data_irqinfo
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;data_irqinfo-&gt;msck_status
op_eq
id|chandev_status_good
)paren
(brace
id|new_msck_status
op_assign
id|chandev_status_all_chans_good
suffix:semicolon
)brace
)brace
r_else
id|new_msck_status
op_assign
id|chandev_status_all_chans_good
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|curr_device-&gt;msck_notfunc
)paren
(brace
id|curr_device
op_member_access_from_pointer
id|msck_notfunc
c_func
(paren
id|curr_device-&gt;dev_ptr
comma
id|curr_irqinfo-&gt;sch.irq
comma
id|prevstatus
comma
id|new_msck_status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|new_msck_status
op_ne
id|chandev_status_good
)paren
(brace
multiline_comment|/* No point in sending a machine check if only one channel is good */
id|chandev_add_to_userland_notify_list
c_func
(paren
id|chandev_msck
comma
id|curr_device-&gt;devname
comma
id|prevstatus
comma
id|curr_irqinfo-&gt;msck_status
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|chandev_find_eligible_channels
r_int
id|chandev_find_eligible_channels
c_func
(paren
id|chandev
op_star
id|first_chandev_to_check
comma
id|chandev
op_star
op_star
id|read
comma
id|chandev
op_star
op_star
id|write
comma
id|chandev
op_star
op_star
id|data
comma
id|chandev
op_star
op_star
id|next
comma
id|chandev_type
id|chan_type
)paren
(brace
id|chandev
op_star
id|curr_chandev
suffix:semicolon
r_int
id|eligible_found
op_assign
id|FALSE
comma
id|changed
suffix:semicolon
op_star
id|next
op_assign
id|first_chandev_to_check-&gt;next
suffix:semicolon
op_star
id|read
op_assign
op_star
id|write
op_assign
op_star
id|data
op_assign
l_int|NULL
suffix:semicolon
id|for_each
c_func
(paren
id|curr_chandev
comma
id|first_chandev_to_check
)paren
r_if
c_cond
(paren
(paren
id|curr_chandev-&gt;sch.devno
op_amp
l_int|1
)paren
op_eq
l_int|0
op_logical_and
id|curr_chandev-&gt;model_info-&gt;chan_type
op_ne
id|chandev_type_claw
)paren
(brace
op_star
id|read
op_assign
id|curr_chandev
suffix:semicolon
r_if
c_cond
(paren
id|chan_type
op_eq
id|chandev_type_none
)paren
(brace
id|chan_type
op_assign
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|model_info-&gt;chan_type
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|read
)paren
(brace
id|for_each
c_func
(paren
id|curr_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
(paren
(paren
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|sch.devno
op_or
l_int|1
)paren
op_eq
id|curr_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
id|chandev_compare_cu_dev_info
c_func
(paren
op_amp
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|sch
comma
op_amp
id|curr_chandev-&gt;sch
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
id|chan_type
op_amp
(paren
id|chandev_type_ctc
op_or
id|chandev_type_escon
)paren
)paren
op_logical_or
id|chandev_compare_chpid_info
c_func
(paren
op_amp
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|sch
comma
op_amp
id|curr_chandev-&gt;sch
)paren
op_eq
l_int|0
)paren
)paren
(brace
op_star
id|write
op_assign
id|curr_chandev
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|chan_type
op_amp
id|chandev_type_qeth
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|write
)paren
(brace
id|for_each
c_func
(paren
id|curr_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
(paren
id|curr_chandev
op_ne
op_star
id|read
op_logical_and
id|curr_chandev
op_ne
op_star
id|write
)paren
op_logical_and
(paren
id|chandev_compare_cu_dev_info
c_func
(paren
op_amp
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|sch
comma
op_amp
id|curr_chandev-&gt;sch
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|chandev_compare_chpid_info
c_func
(paren
op_amp
(paren
op_star
id|read
)paren
op_member_access_from_pointer
id|sch
comma
op_amp
id|curr_chandev-&gt;sch
)paren
op_eq
l_int|0
)paren
)paren
(brace
op_star
id|data
op_assign
id|curr_chandev
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|data
)paren
(brace
id|eligible_found
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
op_star
id|write
)paren
(brace
id|eligible_found
op_assign
id|TRUE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eligible_found
)paren
(brace
r_do
(brace
id|changed
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
op_star
id|next
op_logical_and
(paren
(paren
op_star
id|read
op_logical_and
(paren
op_star
id|read
op_eq
op_star
id|next
)paren
)paren
op_logical_or
(paren
op_star
id|write
op_logical_and
(paren
op_star
id|write
op_eq
op_star
id|next
)paren
)paren
op_logical_or
(paren
op_star
id|data
op_logical_and
(paren
op_star
id|data
op_eq
op_star
id|next
)paren
)paren
)paren
)paren
(brace
op_star
id|next
op_assign
(paren
op_star
id|next
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
id|changed
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|changed
op_eq
id|TRUE
)paren
(brace
suffix:semicolon
)brace
)brace
r_return
id|eligible_found
suffix:semicolon
)brace
DECL|function|chandev_get_free_chandev_by_devno
id|chandev
op_star
id|chandev_get_free_chandev_by_devno
c_func
(paren
r_int
id|devno
)paren
(brace
id|chandev
op_star
id|curr_chandev
suffix:semicolon
r_if
c_cond
(paren
id|devno
op_eq
op_minus
l_int|1
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|for_each
c_func
(paren
id|curr_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
id|curr_chandev-&gt;sch.devno
op_eq
id|devno
)paren
(brace
r_if
c_cond
(paren
id|chandev_active
c_func
(paren
id|devno
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
r_return
id|curr_chandev
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|chandev_probe
r_void
id|chandev_probe
c_func
(paren
r_void
)paren
(brace
id|chandev
op_star
id|read_chandev
comma
op_star
id|write_chandev
comma
op_star
id|data_chandev
comma
op_star
id|curr_chandev
comma
op_star
id|next_chandev
suffix:semicolon
id|chandev_force
op_star
id|curr_force
suffix:semicolon
id|chandev_noauto_range
op_star
id|curr_noauto
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_irqinfo
op_star
id|curr_irqinfo
suffix:semicolon
id|s390_dev_info_t
id|curr_devinfo
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|auto_msck_recovery
suffix:semicolon
id|chandev_msck_status
id|prevstatus
suffix:semicolon
id|chandev_msck_range
op_star
id|curr_msck_range
suffix:semicolon
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
id|chandev_read_conf_if_necessary
c_func
(paren
)paren
suffix:semicolon
id|chandev_collect_devices
c_func
(paren
)paren
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_irqinfo
comma
id|chandev_irqinfo_head
)paren
(brace
r_if
c_cond
(paren
(paren
id|curr_device
op_assign
id|chandev_get_activelist_by_irq
c_func
(paren
id|curr_irqinfo-&gt;sch.irq
)paren
)paren
)paren
(brace
id|prevstatus
op_assign
id|curr_irqinfo-&gt;msck_status
suffix:semicolon
r_if
c_cond
(paren
id|curr_irqinfo-&gt;msck_status
op_ne
id|chandev_status_good
)paren
(brace
id|curr_chandev
op_assign
id|chandev_get_by_irq
c_func
(paren
id|curr_irqinfo-&gt;sch.irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_chandev
)paren
(brace
id|auto_msck_recovery
op_assign
id|curr_chandev-&gt;model_info
op_member_access_from_pointer
id|auto_msck_recovery
suffix:semicolon
)brace
r_else
r_goto
id|remove
suffix:semicolon
id|for_each
c_func
(paren
id|curr_msck_range
comma
id|chandev_msck_range_head
)paren
(brace
r_if
c_cond
(paren
id|curr_msck_range-&gt;lo_devno
op_le
id|curr_irqinfo-&gt;sch.devno
op_logical_and
id|curr_msck_range-&gt;hi_devno
op_ge
id|curr_irqinfo-&gt;sch.devno
)paren
(brace
id|auto_msck_recovery
op_assign
id|curr_msck_range
op_member_access_from_pointer
id|auto_msck_recovery
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
(paren
id|curr_irqinfo-&gt;msck_status
op_minus
l_int|1
)paren
)paren
op_amp
id|auto_msck_recovery
)paren
(brace
r_if
c_cond
(paren
id|curr_irqinfo-&gt;msck_status
op_eq
id|chandev_status_revalidate
)paren
(brace
r_if
c_cond
(paren
(paren
id|get_dev_info_by_irq
c_func
(paren
id|curr_irqinfo-&gt;sch.irq
comma
op_amp
id|curr_devinfo
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|curr_irqinfo-&gt;sch.devno
op_assign
id|curr_devinfo.devno
suffix:semicolon
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_good
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|curr_chandev
)paren
(brace
multiline_comment|/* Has the device reappeared */
r_if
c_cond
(paren
id|chandev_compare_subchannel_info
c_func
(paren
op_amp
id|curr_chandev-&gt;sch
comma
op_amp
id|curr_device-&gt;read_irqinfo-&gt;sch
)paren
op_logical_or
id|chandev_compare_subchannel_info
c_func
(paren
op_amp
id|curr_chandev-&gt;sch
comma
op_amp
id|curr_device-&gt;write_irqinfo-&gt;sch
)paren
op_logical_or
(paren
id|curr_device-&gt;data_irqinfo
op_logical_and
id|chandev_compare_subchannel_info
c_func
(paren
op_amp
id|curr_chandev-&gt;sch
comma
op_amp
id|curr_device-&gt;data_irqinfo-&gt;sch
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|chandev_request_irq_from_irqinfo
c_func
(paren
id|curr_irqinfo
comma
id|curr_chandev
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_good
suffix:semicolon
)brace
r_else
id|chandev_irqallocerr
c_func
(paren
id|curr_irqinfo
comma
id|err
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|chandev_call_notification_func
c_func
(paren
id|curr_device
comma
id|curr_irqinfo
comma
id|prevstatus
)paren
suffix:semicolon
)brace
multiline_comment|/* This is required because the device can go &amp; come back */
multiline_comment|/* even before we realize it is gone owing to the waits in our kernel threads */
multiline_comment|/* &amp; the device will be marked as not owned but its status will be good */
multiline_comment|/* &amp; an attempt to accidentally reprobe it may be done. */
id|remove
suffix:colon
id|chandev_remove
c_func
(paren
id|chandev_get_by_irq
c_func
(paren
id|curr_irqinfo-&gt;sch.irq
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* extra sanity */
id|for_each_allow_delete
c_func
(paren
id|curr_chandev
comma
id|next_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
r_if
c_cond
(paren
id|curr_chandev-&gt;owned
)paren
(brace
id|chandev_remove
c_func
(paren
id|curr_chandev
)paren
suffix:semicolon
)brace
id|for_each
c_func
(paren
id|curr_force
comma
id|chandev_force_head
)paren
(brace
r_if
c_cond
(paren
id|curr_force-&gt;devif_num
op_eq
op_minus
l_int|2
)paren
(brace
id|for_each_allow_delete2
c_func
(paren
id|curr_chandev
comma
id|next_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
(brace
r_if
c_cond
(paren
id|chandev_find_eligible_channels
c_func
(paren
id|curr_chandev
comma
op_amp
id|read_chandev
comma
op_amp
id|write_chandev
comma
op_amp
id|data_chandev
comma
op_amp
id|next_chandev
comma
id|curr_force-&gt;chan_type
)paren
)paren
(brace
suffix:semicolon
)brace
(brace
r_if
c_cond
(paren
(paren
id|curr_force-&gt;read_lo_devno
op_ge
id|read_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
id|curr_force-&gt;write_hi_devno
op_le
id|read_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
id|curr_force-&gt;read_lo_devno
op_ge
id|write_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
id|curr_force-&gt;write_hi_devno
op_le
id|write_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
op_logical_neg
id|data_chandev
op_logical_or
(paren
id|data_chandev
op_logical_and
(paren
id|curr_force-&gt;read_lo_devno
op_ge
id|data_chandev-&gt;sch.devno
)paren
op_logical_and
(paren
id|curr_force-&gt;write_hi_devno
op_le
id|data_chandev-&gt;sch.devno
)paren
)paren
)paren
)paren
(brace
id|chandev_doprobe
c_func
(paren
id|curr_force
comma
id|read_chandev
comma
id|write_chandev
comma
id|data_chandev
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
id|read_chandev
op_assign
id|chandev_get_free_chandev_by_devno
c_func
(paren
id|curr_force-&gt;read_lo_devno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_chandev
)paren
(brace
id|write_chandev
op_assign
id|chandev_get_free_chandev_by_devno
c_func
(paren
id|curr_force-&gt;write_hi_devno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_chandev
)paren
(brace
r_if
c_cond
(paren
id|curr_force-&gt;chan_type
op_eq
id|chandev_type_qeth
)paren
(brace
id|data_chandev
op_assign
id|chandev_get_free_chandev_by_devno
c_func
(paren
id|curr_force-&gt;data_devno
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data_chandev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_probe unable to force gigabit_ethernet driver invalid device  no 0x%04x given&bslash;n&quot;
comma
id|curr_force-&gt;data_devno
)paren
suffix:semicolon
)brace
)brace
r_else
id|data_chandev
op_assign
l_int|NULL
suffix:semicolon
id|chandev_doprobe
c_func
(paren
id|curr_force
comma
id|read_chandev
comma
id|write_chandev
comma
id|data_chandev
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|for_each_allow_delete
c_func
(paren
id|curr_chandev
comma
id|next_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
(brace
id|for_each
c_func
(paren
id|curr_noauto
comma
id|chandev_noauto_head
)paren
(brace
r_if
c_cond
(paren
id|curr_chandev-&gt;sch.devno
op_ge
id|curr_noauto-&gt;lo_devno
op_logical_and
id|curr_chandev-&gt;sch.devno
op_le
id|curr_noauto-&gt;hi_devno
)paren
(brace
id|chandev_remove
c_func
(paren
id|curr_chandev
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
id|for_each_allow_delete2
c_func
(paren
id|curr_chandev
comma
id|next_chandev
comma
(paren
id|chandev
op_star
)paren
id|chandev_head.head
)paren
(brace
r_if
c_cond
(paren
id|chandev_find_eligible_channels
c_func
(paren
id|curr_chandev
comma
op_amp
id|read_chandev
comma
op_amp
id|write_chandev
comma
op_amp
id|data_chandev
comma
op_amp
id|next_chandev
comma
id|chandev_type_none
)paren
)paren
(brace
id|chandev_doprobe
c_func
(paren
l_int|NULL
comma
id|read_chandev
comma
id|write_chandev
comma
id|data_chandev
)paren
suffix:semicolon
)brace
)brace
id|chandev_remove_all
c_func
(paren
)paren
suffix:semicolon
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_not_oper_func
r_static
r_void
id|chandev_not_oper_func
c_func
(paren
r_int
id|irq
comma
r_int
id|status
)paren
(brace
id|chandev_irqinfo
op_star
id|curr_irqinfo
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_irqinfo
comma
id|chandev_irqinfo_head
)paren
r_if
c_cond
(paren
id|curr_irqinfo-&gt;sch.irq
op_eq
id|irq
)paren
(brace
id|chandev_msck_status
id|prevstatus
op_assign
id|curr_irqinfo-&gt;msck_status
suffix:semicolon
r_switch
c_cond
(paren
id|status
)paren
(brace
multiline_comment|/* Currently defined but not used in kernel */
multiline_comment|/* Despite being in specs */
r_case
id|DEVSTAT_NOT_OPER
suffix:colon
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_not_oper
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef DEVSTAT_NO_PATH
multiline_comment|/* Kernel hasn&squot;t this defined currently. */
multiline_comment|/* Despite being in specs */
r_case
id|DEVSTAT_NO_PATH
suffix:colon
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_no_path
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|DEVSTAT_REVALIDATE
suffix:colon
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_revalidate
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DEVSTAT_DEVICE_GONE
suffix:colon
id|curr_irqinfo-&gt;msck_status
op_assign
id|chandev_status_gone
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|curr_device
op_assign
id|chandev_get_activelist_by_irq
c_func
(paren
id|irq
)paren
)paren
)paren
(brace
id|chandev_call_notification_func
c_func
(paren
id|curr_device
comma
id|curr_irqinfo
comma
id|prevstatus
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;chandev_not_oper_func received channel check for unowned irq %d&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_msck_thread
r_static
r_int
id|chandev_msck_thread
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_int
id|loopcnt
comma
id|not_oper_probe_required
op_assign
id|FALSE
suffix:semicolon
id|wait_queue_head_t
id|wait
suffix:semicolon
id|chandev_not_oper_struct
op_star
id|new_not_oper
suffix:semicolon
multiline_comment|/* This loop exists because machine checks tend to come in groups &amp; we have&n;           to wait for the other devnos to appear also */
id|init_waitqueue_head
c_func
(paren
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
id|loopcnt
op_assign
l_int|0
suffix:semicolon
id|loopcnt
OL
l_int|10
op_logical_or
(paren
id|jiffies
op_minus
id|chandev_last_machine_check
)paren
OL
id|HZ
suffix:semicolon
id|loopcnt
op_increment
)paren
(brace
id|sleep_on_timeout
c_func
(paren
op_amp
id|wait
comma
id|HZ
)paren
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|chandev_msck_thread_lock
comma
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|atomic_compare_and_swap
c_func
(paren
id|TRUE
comma
id|FALSE
comma
op_amp
id|chandev_new_msck
)paren
)paren
(brace
suffix:semicolon
)brace
(brace
id|chandev_probe
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|TRUE
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chandev_not_oper_spinlock
comma
id|flags
)paren
suffix:semicolon
id|new_not_oper
op_assign
(paren
id|chandev_not_oper_struct
op_star
)paren
id|dequeue_head
c_func
(paren
op_amp
id|chandev_not_oper_head
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chandev_not_oper_spinlock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_not_oper
)paren
(brace
id|chandev_not_oper_func
c_func
(paren
id|new_not_oper-&gt;irq
comma
id|new_not_oper-&gt;status
)paren
suffix:semicolon
id|not_oper_probe_required
op_assign
id|TRUE
suffix:semicolon
id|kfree
c_func
(paren
id|new_not_oper
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|not_oper_probe_required
)paren
(brace
id|chandev_probe
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_msck_task
r_static
r_void
id|chandev_msck_task
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_if
c_cond
(paren
id|kernel_thread
c_func
(paren
id|chandev_msck_thread
comma
l_int|NULL
comma
id|SIGCHLD
)paren
OL
l_int|0
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|chandev_msck_thread_lock
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;error making chandev_msck_thread kernel thread&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|variable|argstrs
r_static
r_char
op_star
id|argstrs
(braket
)braket
op_assign
(brace
l_string|&quot;noauto&quot;
comma
l_string|&quot;del_noauto&quot;
comma
l_string|&quot;ctc&quot;
comma
l_string|&quot;escon&quot;
comma
l_string|&quot;lcs&quot;
comma
l_string|&quot;osad&quot;
comma
l_string|&quot;qeth&quot;
comma
l_string|&quot;claw&quot;
comma
l_string|&quot;add_parms&quot;
comma
l_string|&quot;del_parms&quot;
comma
l_string|&quot;del_force&quot;
comma
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
l_string|&quot;use_devno_names&quot;
comma
l_string|&quot;dont_use_devno_names&quot;
comma
macro_line|#endif
l_string|&quot;cautious_auto_detect&quot;
comma
l_string|&quot;non_cautious_auto_detect&quot;
comma
l_string|&quot;add_model&quot;
comma
l_string|&quot;del_model&quot;
comma
l_string|&quot;auto_msck&quot;
comma
l_string|&quot;del_auto_msck&quot;
comma
l_string|&quot;del_all_models&quot;
comma
l_string|&quot;reset_conf_clean&quot;
comma
l_string|&quot;reset_conf&quot;
comma
l_string|&quot;shutdown&quot;
comma
l_string|&quot;reprobe&quot;
comma
l_string|&quot;unregister_probe&quot;
comma
l_string|&quot;unregister_probe_by_chan_type&quot;
comma
l_string|&quot;read_conf&quot;
comma
l_string|&quot;dont_read_conf&quot;
comma
l_string|&quot;persist&quot;
)brace
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|stridx_mult
id|stridx_mult
op_assign
l_int|256
comma
DECL|enumerator|first_stridx
id|first_stridx
op_assign
l_int|0
comma
DECL|enumerator|noauto_stridx
id|noauto_stridx
op_assign
id|first_stridx
comma
DECL|enumerator|del_noauto_stridx
id|del_noauto_stridx
comma
DECL|enumerator|ctc_stridx
id|ctc_stridx
comma
DECL|enumerator|escon_stridx
id|escon_stridx
comma
DECL|enumerator|lcs_stridx
id|lcs_stridx
comma
DECL|enumerator|osad_stridx
id|osad_stridx
comma
DECL|enumerator|qeth_stridx
id|qeth_stridx
comma
DECL|enumerator|claw_stridx
id|claw_stridx
comma
DECL|enumerator|add_parms_stridx
id|add_parms_stridx
comma
DECL|enumerator|del_parms_stridx
id|del_parms_stridx
comma
DECL|enumerator|del_force_stridx
id|del_force_stridx
comma
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
DECL|enumerator|use_devno_names_stridx
id|use_devno_names_stridx
comma
DECL|enumerator|dont_use_devno_names_stridx
id|dont_use_devno_names_stridx
comma
macro_line|#endif
DECL|enumerator|cautious_auto_detect_stridx
id|cautious_auto_detect_stridx
comma
DECL|enumerator|non_cautious_auto_detect_stridx
id|non_cautious_auto_detect_stridx
comma
DECL|enumerator|add_model_stridx
id|add_model_stridx
comma
DECL|enumerator|del_model_stridx
id|del_model_stridx
comma
DECL|enumerator|auto_msck_stridx
id|auto_msck_stridx
comma
DECL|enumerator|del_auto_msck_stridx
id|del_auto_msck_stridx
comma
DECL|enumerator|del_all_models_stridx
id|del_all_models_stridx
comma
DECL|enumerator|reset_conf_clean_stridx
id|reset_conf_clean_stridx
comma
DECL|enumerator|reset_conf_stridx
id|reset_conf_stridx
comma
DECL|enumerator|shutdown_stridx
id|shutdown_stridx
comma
DECL|enumerator|reprobe_stridx
id|reprobe_stridx
comma
DECL|enumerator|unregister_probe_stridx
id|unregister_probe_stridx
comma
DECL|enumerator|unregister_probe_by_chan_type_stridx
id|unregister_probe_by_chan_type_stridx
comma
DECL|enumerator|read_conf_stridx
id|read_conf_stridx
comma
DECL|enumerator|dont_read_conf_stridx
id|dont_read_conf_stridx
comma
DECL|enumerator|persist_stridx
id|persist_stridx
comma
DECL|enumerator|last_stridx
id|last_stridx
comma
DECL|typedef|chandev_str_enum
)brace
id|chandev_str_enum
suffix:semicolon
DECL|function|chandev_add_noauto
r_void
id|chandev_add_noauto
c_func
(paren
id|u16
id|lo_devno
comma
id|u16
id|hi_devno
)paren
(brace
id|chandev_noauto_range
op_star
id|new_range
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_range
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev_noauto_range
)paren
)paren
)paren
)paren
(brace
id|new_range-&gt;lo_devno
op_assign
id|lo_devno
suffix:semicolon
id|new_range-&gt;hi_devno
op_assign
id|hi_devno
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
comma
id|new_range
)paren
suffix:semicolon
)brace
)brace
DECL|function|chandev_add_msck_range
r_void
id|chandev_add_msck_range
c_func
(paren
id|u16
id|lo_devno
comma
id|u16
id|hi_devno
comma
r_int
id|auto_msck_recovery
)paren
(brace
id|chandev_msck_range
op_star
id|new_range
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_range
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev_msck_range
)paren
)paren
)paren
)paren
(brace
id|new_range-&gt;lo_devno
op_assign
id|lo_devno
suffix:semicolon
id|new_range-&gt;hi_devno
op_assign
id|hi_devno
suffix:semicolon
id|new_range-&gt;auto_msck_recovery
op_assign
id|auto_msck_recovery
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_msck_range_head
comma
id|new_range
)paren
suffix:semicolon
)brace
)brace
DECL|variable|chandev_keydescript
r_static
r_char
id|chandev_keydescript
(braket
)braket
op_assign
l_string|&quot;&bslash;nchan_type key bitfield ctc=0x1,escon=0x2,lcs=0x4,osad=0x8,qeth=0x10,claw=0x20&bslash;n&quot;
suffix:semicolon
macro_line|#if  CONFIG_ARCH_S390X
multiline_comment|/* We need this as we sometimes use this to evaluate pointers */
DECL|typedef|chandev_int
r_typedef
r_int
id|chandev_int
suffix:semicolon
macro_line|#else
DECL|typedef|chandev_int
r_typedef
r_int
id|chandev_int
suffix:semicolon
macro_line|#endif
macro_line|#if (LINUX_VERSION_CODE&lt;KERNEL_VERSION(2,3,0)) || (CONFIG_ARCH_S390X)
multiline_comment|/*&n; * Read an int from an option string; if available accept a subsequent&n; * comma as well.&n; *&n; * Return values:&n; * 0 : no int in string&n; * 1 : int found, no subsequent comma&n; * 2 : int found including a subsequent comma&n; */
DECL|function|chandev_get_option
r_static
id|chandev_int
id|chandev_get_option
c_func
(paren
r_char
op_star
op_star
id|str
comma
id|chandev_int
op_star
id|pint
)paren
(brace
r_char
op_star
id|cur
op_assign
op_star
id|str
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cur
op_logical_or
op_logical_neg
(paren
op_star
id|cur
)paren
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|pint
op_assign
id|simple_strtol
c_func
(paren
id|cur
comma
id|str
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cur
op_eq
op_star
id|str
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
op_star
id|str
op_eq
l_char|&squot;,&squot;
)paren
(brace
(paren
op_star
id|str
)paren
op_increment
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|chandev_get_options
r_static
r_char
op_star
id|chandev_get_options
c_func
(paren
r_char
op_star
id|str
comma
r_int
id|nints
comma
id|chandev_int
op_star
id|ints
)paren
(brace
r_int
id|res
comma
id|i
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|nints
)paren
(brace
id|res
op_assign
id|chandev_get_option
c_func
(paren
op_amp
id|str
comma
id|ints
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|1
)paren
r_break
suffix:semicolon
)brace
id|ints
(braket
l_int|0
)braket
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
r_return
id|str
suffix:semicolon
)brace
macro_line|#else
DECL|macro|chandev_get_option
mdefine_line|#define chandev_get_option get_option
DECL|macro|chandev_get_options
mdefine_line|#define chandev_get_options get_options
macro_line|#endif
multiline_comment|/*&n; * Read an string from an option string; if available accept a subsequent&n; * comma as well &amp; set this comma to a null character when returning the string.&n; *&n; * Return values:&n; * 0 : no string found&n; * 1 : string found, no subsequent comma&n; * 2 : string found including a subsequent comma&n; */
DECL|function|chandev_get_string
r_static
r_int
id|chandev_get_string
c_func
(paren
r_char
op_star
op_star
id|instr
comma
r_char
op_star
op_star
id|outstr
)paren
(brace
r_char
op_star
id|cur
op_assign
op_star
id|instr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cur
op_logical_or
op_star
id|cur
op_eq
l_int|0
)paren
(brace
op_star
id|outstr
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|outstr
op_assign
op_star
id|instr
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
op_star
(paren
op_increment
id|cur
)paren
op_eq
l_char|&squot;,&squot;
)paren
(brace
op_star
id|cur
op_assign
l_int|0
suffix:semicolon
op_star
id|instr
op_assign
id|cur
op_plus
l_int|1
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|cur
op_eq
l_int|0
)paren
(brace
op_star
id|instr
op_assign
id|cur
op_plus
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
DECL|function|chandev_setup
r_static
r_int
id|chandev_setup
c_func
(paren
r_int
id|in_read_conf
comma
r_char
op_star
id|instr
comma
r_char
op_star
id|errstr
comma
r_int
id|lineno
)paren
(brace
id|chandev_strval
id|val
op_assign
id|isnull
suffix:semicolon
id|chandev_str_enum
id|stridx
suffix:semicolon
r_int
id|endlong
suffix:semicolon
id|chandev_type
id|chan_type
suffix:semicolon
r_char
op_star
id|str
comma
op_star
id|currstr
comma
op_star
id|interpretstr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|cnt
comma
id|strcnt
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
DECL|macro|CHANDEV_MAX_EXTRA_INTS
mdefine_line|#define CHANDEV_MAX_EXTRA_INTS 12
id|chandev_int
id|ints
(braket
id|CHANDEV_MAX_EXTRA_INTS
op_plus
l_int|1
)braket
suffix:semicolon
id|currstr
op_assign
id|alloca
c_func
(paren
id|strlen
c_func
(paren
id|instr
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|currstr
comma
id|instr
)paren
suffix:semicolon
id|strcnt
op_assign
id|chandev_pack_args
c_func
(paren
id|currstr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|1
suffix:semicolon
id|cnt
op_le
id|strcnt
suffix:semicolon
id|cnt
op_increment
)paren
(brace
id|interpretstr
op_assign
id|currstr
suffix:semicolon
id|memset
c_func
(paren
id|ints
comma
l_int|0
comma
r_sizeof
(paren
id|ints
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|stridx
op_assign
id|first_stridx
suffix:semicolon
id|stridx
OL
id|last_stridx
suffix:semicolon
id|stridx
op_increment
)paren
(brace
id|str
op_assign
id|currstr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|chandev_strcmp
c_func
(paren
id|argstrs
(braket
id|stridx
)braket
comma
op_amp
id|str
comma
op_amp
id|endlong
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|currstr
op_assign
id|str
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
id|val
op_assign
(paren
(paren
(paren
id|chandev_strval
)paren
id|stridx
)paren
op_star
id|stridx_mult
)paren
op_plus
(paren
id|val
op_amp
op_complement
id|isstr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
(paren
id|add_parms_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
id|currstr
op_assign
id|chandev_get_options
c_func
(paren
id|currstr
comma
l_int|4
comma
id|ints
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|currstr
op_logical_and
id|ints
(braket
l_int|0
)braket
op_ge
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|1
)paren
(brace
id|ints
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|ints
(braket
l_int|3
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|2
)paren
(brace
id|ints
(braket
l_int|3
)braket
op_assign
id|ints
(braket
l_int|2
)braket
suffix:semicolon
)brace
id|chandev_add_parms
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|currstr
)paren
suffix:semicolon
r_goto
id|NextOption
suffix:semicolon
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|claw_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|claw_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
id|currstr
op_assign
id|chandev_get_options
c_func
(paren
id|str
comma
l_int|6
comma
id|ints
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|val
op_amp
id|iscomma
)paren
(brace
id|currstr
op_assign
id|chandev_get_options
c_func
(paren
id|str
comma
id|CHANDEV_MAX_EXTRA_INTS
comma
id|ints
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|noauto_stridx
op_star
id|stridx_mult
suffix:colon
r_case
(paren
id|noauto_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
)paren
suffix:semicolon
id|chandev_add_noauto
c_func
(paren
l_int|0
comma
l_int|0xffff
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ints
(braket
l_int|2
)braket
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
r_case
l_int|2
suffix:colon
id|chandev_add_noauto
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
(paren
id|auto_msck_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_msck_range_head
)paren
suffix:semicolon
id|chandev_add_msck_range
c_func
(paren
l_int|0
comma
l_int|0xffff
comma
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|chandev_add_msck_range
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|chandev_add_msck_range
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
r_case
id|del_auto_msck_stridx
op_star
id|stridx_mult
suffix:colon
r_case
(paren
id|del_auto_msck_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_msck_range_head
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|chandev_del_msck
c_func
(paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
r_case
id|del_noauto_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_noauto_head
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_noauto_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|1
)paren
(brace
id|chandev_del_noauto
c_func
(paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|qeth_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
template_param
l_int|7
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_add_force
c_func
(paren
id|chandev_type_qeth
comma
id|endlong
comma
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
comma
id|ints
(braket
l_int|5
)braket
comma
id|ints
(braket
l_int|6
)braket
comma
id|ints
(braket
l_int|7
)braket
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|ctc_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|escon_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|lcs_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|osad_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|ctc_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_case
(paren
id|escon_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_case
(paren
id|lcs_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_case
(paren
id|osad_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|val
op_amp
op_complement
(paren
id|isnum
op_or
id|iscomma
)paren
)paren
(brace
r_case
(paren
id|ctc_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chan_type
op_assign
id|chandev_type_ctc
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|escon_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chan_type
op_assign
id|chandev_type_escon
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|lcs_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chan_type
op_assign
id|chandev_type_lcs
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|osad_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chan_type
op_assign
id|chandev_type_osad
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|qeth_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chan_type
op_assign
id|chandev_type_qeth
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_amp
id|isnum
)paren
op_eq
l_int|0
)paren
(brace
id|endlong
op_assign
op_minus
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
template_param
l_int|6
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_add_force
c_func
(paren
id|chan_type
comma
id|endlong
comma
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
l_int|0
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
comma
id|ints
(braket
l_int|5
)braket
comma
id|ints
(braket
l_int|6
)braket
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|claw_stridx
op_star
id|stridx_mult
)paren
op_or
id|isnum
op_or
id|iscomma
suffix:colon
r_case
(paren
id|claw_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ge
l_int|2
op_logical_and
id|ints
(braket
l_int|0
)braket
op_le
l_int|5
)paren
(brace
r_char
op_star
id|host_name
comma
op_star
id|adapter_name
comma
op_star
id|api_type
suffix:semicolon
r_char
op_star
id|clawstr
op_assign
id|alloca
c_func
(paren
id|strlen
c_func
(paren
id|currstr
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|clawstr
comma
id|currstr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chandev_get_string
c_func
(paren
op_amp
id|clawstr
comma
op_amp
id|host_name
)paren
op_eq
l_int|2
op_logical_and
id|chandev_get_string
c_func
(paren
op_amp
id|clawstr
comma
op_amp
id|adapter_name
)paren
op_eq
l_int|2
op_logical_and
id|chandev_get_string
c_func
(paren
op_amp
id|clawstr
comma
op_amp
id|api_type
)paren
op_eq
l_int|1
op_logical_and
id|chandev_add_force
c_func
(paren
id|chandev_type_claw
comma
id|endlong
comma
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
l_int|0
comma
id|ints
(braket
l_int|3
)braket
comma
l_int|0
comma
id|ints
(braket
l_int|4
)braket
comma
id|ints
(braket
l_int|5
)braket
comma
id|host_name
comma
id|adapter_name
comma
id|api_type
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_parms_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|ints
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
r_case
(paren
id|del_parms_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
id|ints
(braket
l_int|1
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|1
)paren
(brace
id|ints
(braket
l_int|2
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|2
)paren
(brace
id|ints
(braket
l_int|3
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
OG
l_int|3
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_remove_parms
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_force_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|1
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_del_force
c_func
(paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_force_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chandev_del_force
c_func
(paren
op_minus
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
r_case
(paren
id|use_devno_names_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chandev_use_devno_names
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|dont_use_devno_names_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chandev_use_devno_names
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
(paren
id|cautious_auto_detect_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chandev_cautious_auto_detect
op_assign
id|TRUE
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|non_cautious_auto_detect_stridx
op_star
id|stridx_mult
)paren
suffix:colon
id|chandev_cautious_auto_detect
op_assign
id|FALSE
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|add_model_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
OL
l_int|3
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|3
)paren
(brace
id|ints
(braket
l_int|4
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|4
)paren
(brace
id|ints
(braket
l_int|5
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|5
)paren
(brace
id|ints
(braket
l_int|6
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|6
)paren
(brace
id|ints
(braket
l_int|7
)braket
op_assign
id|default_msck_bits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|7
)paren
(brace
id|ints
(braket
l_int|8
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_le
l_int|8
)paren
(brace
id|ints
(braket
l_int|9
)braket
op_assign
id|FALSE
suffix:semicolon
)brace
id|ints
(braket
l_int|0
)braket
op_assign
l_int|7
suffix:semicolon
id|chandev_add_model
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
comma
id|ints
(braket
l_int|5
)braket
comma
id|ints
(braket
l_int|6
)braket
comma
id|ints
(braket
l_int|7
)braket
comma
id|ints
(braket
l_int|8
)braket
comma
id|ints
(braket
l_int|9
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|del_model_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
template_param
l_int|4
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
OL
l_int|3
)paren
(brace
id|ints
(braket
l_int|3
)braket
op_assign
op_minus
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
OL
l_int|4
)paren
(brace
id|ints
(braket
l_int|4
)braket
op_assign
op_minus
l_int|2
suffix:semicolon
)brace
id|ints
(braket
l_int|0
)braket
op_assign
l_int|4
suffix:semicolon
id|chandev_del_model
c_func
(paren
id|ints
(braket
l_int|1
)braket
comma
id|ints
(braket
l_int|2
)braket
comma
id|ints
(braket
l_int|3
)braket
comma
id|ints
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|del_all_models_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_remove_all_models
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|reset_conf_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_reset
c_func
(paren
)paren
suffix:semicolon
id|chandev_init_default_models
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|reset_conf_clean_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_reset
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|shutdown_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_shutdown_all
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|shutdown_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_switch
c_cond
(paren
id|ints
(braket
l_int|0
)braket
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|str
)paren
)paren
(brace
id|chandev_shutdown_by_name
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|chandev_shutdown_by_devno
c_func
(paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|reprobe_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_probe
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|unregister_probe_stridx
op_star
id|stridx_mult
suffix:colon
id|chandev_free_all_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|unregister_probe_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|1
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_unregister_probe
c_func
(paren
(paren
id|chandev_probefunc
)paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|unregister_probe_by_chan_type_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_ne
l_int|1
)paren
(brace
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_unregister_probe_by_chan_type
c_func
(paren
(paren
id|chandev_type
)paren
id|ints
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|read_conf_stridx
op_star
id|stridx_mult
suffix:colon
r_if
c_cond
(paren
id|in_read_conf
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;attempt to recursively call read_conf&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|BadArgs
suffix:semicolon
)brace
id|chandev_read_conf
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|dont_read_conf_stridx
op_star
id|stridx_mult
suffix:colon
id|atomic_set
c_func
(paren
op_amp
id|chandev_conf_read
comma
id|TRUE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
(paren
id|persist_stridx
op_star
id|stridx_mult
)paren
op_or
id|iscomma
suffix:colon
r_if
c_cond
(paren
id|ints
(braket
l_int|0
)braket
op_eq
l_int|1
)paren
(brace
id|chandev_persistent
op_assign
id|ints
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|BadArgs
suffix:semicolon
)brace
)brace
r_else
r_goto
id|BadArgs
suffix:semicolon
id|NextOption
suffix:colon
r_if
c_cond
(paren
id|cnt
OL
id|strcnt
)paren
(brace
multiline_comment|/* eat up stuff till next string */
r_while
c_loop
(paren
op_star
(paren
id|currstr
op_increment
)paren
)paren
(brace
suffix:semicolon
)brace
)brace
)brace
id|retval
op_assign
l_int|1
suffix:semicolon
id|BadArgs
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;chandev_setup %s %s&quot;
comma
(paren
id|val
op_eq
l_int|0
ques
c_cond
l_string|&quot;unknown verb&quot;
suffix:colon
l_string|&quot;bad argument&quot;
)paren
comma
id|instr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|errstr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s %d interpreted as %s&quot;
comma
id|errstr
comma
id|lineno
comma
id|interpretstr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcnt
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|cnt
op_eq
id|strcnt
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; after the last semicolon&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot; before semicolon no %d&quot;
comma
id|cnt
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;.&bslash;n Type man chandev for more info.&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|macro|CHANDEV_KEYWORD
mdefine_line|#define CHANDEV_KEYWORD &quot;chandev=&quot;
DECL|function|chandev_setup_bootargs
r_static
r_int
id|chandev_setup_bootargs
c_func
(paren
r_char
op_star
id|str
comma
r_int
id|paramno
)paren
(brace
r_int
id|len
suffix:semicolon
r_char
op_star
id|copystr
suffix:semicolon
r_for
c_loop
(paren
id|len
op_assign
l_int|0
suffix:semicolon
id|str
(braket
id|len
)braket
op_ne
l_int|0
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
id|str
(braket
id|len
)braket
)paren
suffix:semicolon
id|len
op_increment
)paren
(brace
suffix:semicolon
)brace
id|copystr
op_assign
id|alloca
c_func
(paren
id|len
op_plus
l_int|1
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|copystr
comma
id|str
comma
id|len
)paren
suffix:semicolon
id|copystr
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chandev_setup
c_func
(paren
id|FALSE
comma
id|copystr
comma
l_string|&quot;at &quot;
id|CHANDEV_KEYWORD
l_string|&quot; bootparam no&quot;
comma
id|paramno
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n;  We can&squot;t parse using a __setup function as kmalloc isn&squot;t available&n;  at this time.&n; */
DECL|function|chandev_parse_args
r_static
r_void
id|__init
id|chandev_parse_args
c_func
(paren
r_void
)paren
(brace
DECL|macro|CHANDEV_KEYWORD
mdefine_line|#define CHANDEV_KEYWORD &quot;chandev=&quot;
r_extern
r_char
id|saved_command_line
(braket
)braket
suffix:semicolon
r_int
id|cnt
comma
id|len
comma
id|paramno
op_assign
l_int|1
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|saved_command_line
)paren
op_minus
r_sizeof
(paren
id|CHANDEV_KEYWORD
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
id|len
suffix:semicolon
id|cnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
op_amp
id|saved_command_line
(braket
id|cnt
)braket
comma
id|CHANDEV_KEYWORD
comma
r_sizeof
(paren
id|CHANDEV_KEYWORD
)paren
op_minus
l_int|1
)paren
op_eq
l_int|0
)paren
(brace
id|cnt
op_add_assign
(paren
r_sizeof
(paren
id|CHANDEV_KEYWORD
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|cnt
op_add_assign
id|chandev_setup_bootargs
c_func
(paren
op_amp
id|saved_command_line
(braket
id|cnt
)braket
comma
id|paramno
)paren
suffix:semicolon
id|paramno
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|chandev_do_setup
r_int
id|chandev_do_setup
c_func
(paren
r_int
id|in_read_conf
comma
r_char
op_star
id|buff
comma
r_int
id|size
)paren
(brace
r_int
id|curr
comma
id|comment
op_assign
id|FALSE
comma
id|newline
op_assign
id|FALSE
comma
id|oldnewline
op_assign
id|TRUE
suffix:semicolon
r_char
op_star
id|startline
op_assign
l_int|NULL
comma
op_star
id|endbuff
op_assign
op_amp
id|buff
(braket
id|size
)braket
suffix:semicolon
r_int
id|lineno
op_assign
l_int|0
suffix:semicolon
op_star
id|endbuff
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|buff
op_le
id|endbuff
suffix:semicolon
id|curr
op_increment
comma
id|buff
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|buff
op_eq
l_int|0xa
op_logical_or
op_star
id|buff
op_eq
l_int|0xc
op_logical_or
op_star
id|buff
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_star
id|buff
op_eq
l_int|0xa
op_logical_or
op_star
id|buff
op_eq
l_int|0
)paren
(brace
id|lineno
op_increment
suffix:semicolon
)brace
op_star
id|buff
op_assign
l_int|0
suffix:semicolon
id|newline
op_assign
id|TRUE
suffix:semicolon
)brace
r_else
(brace
id|newline
op_assign
id|FALSE
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buff
op_eq
l_char|&squot;#&squot;
)paren
(brace
id|comment
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|comment
op_eq
id|TRUE
)paren
(brace
op_star
id|buff
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|startline
op_eq
l_int|NULL
op_logical_and
id|isalpha
c_func
(paren
op_star
id|buff
)paren
)paren
(brace
id|startline
op_assign
id|buff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|startline
op_logical_and
(paren
id|buff
OG
id|startline
)paren
op_logical_and
(paren
id|oldnewline
op_eq
id|FALSE
)paren
op_logical_and
(paren
id|newline
op_eq
id|TRUE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|chandev_setup
c_func
(paren
id|in_read_conf
comma
id|startline
comma
l_string|&quot; on line no&quot;
comma
id|lineno
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|startline
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|newline
)paren
(brace
id|comment
op_assign
id|FALSE
suffix:semicolon
)brace
id|oldnewline
op_assign
id|newline
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_read_conf
r_static
r_void
id|chandev_read_conf
c_func
(paren
r_void
)paren
(brace
DECL|macro|CHANDEV_FILE
mdefine_line|#define CHANDEV_FILE &quot;/etc/chandev.conf&quot;
r_struct
id|stat
id|statbuf
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
r_int
id|curr
comma
id|left
comma
id|len
comma
id|fd
suffix:semicolon
multiline_comment|/* if called from chandev_register_and_probe &amp; &n;&t;   the driver is compiled into the kernel the&n;&t;   parameters will need to be passed in from&n;&t;   the kernel boot parameter line as the root&n;&t;   fs is not mounted yet, we can&squot;t wait here.&n;&t;*/
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
op_logical_or
id|current-&gt;fs-&gt;root
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|chandev_conf_read
comma
id|TRUE
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
c_func
(paren
id|CHANDEV_FILE
comma
op_amp
id|statbuf
)paren
op_eq
l_int|0
)paren
(brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
id|buff
op_assign
id|vmalloc
c_func
(paren
id|statbuf.st_size
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
)paren
(brace
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fd
op_assign
id|open
c_func
(paren
id|CHANDEV_FILE
comma
id|O_RDONLY
comma
l_int|0
)paren
)paren
op_ne
op_minus
l_int|1
)paren
(brace
id|curr
op_assign
l_int|0
suffix:semicolon
id|left
op_assign
id|statbuf.st_size
suffix:semicolon
r_while
c_loop
(paren
(paren
id|len
op_assign
id|read
c_func
(paren
id|fd
comma
op_amp
id|buff
(braket
id|curr
)braket
comma
id|left
)paren
)paren
OG
l_int|0
)paren
(brace
id|curr
op_add_assign
id|len
suffix:semicolon
id|left
op_sub_assign
id|len
suffix:semicolon
)brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
id|chandev_do_setup
c_func
(paren
id|TRUE
comma
id|buff
comma
id|statbuf.st_size
)paren
suffix:semicolon
id|vfree
c_func
(paren
id|buff
)paren
suffix:semicolon
)brace
)brace
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
)brace
DECL|function|chandev_read_conf_if_necessary
r_static
r_void
id|chandev_read_conf_if_necessary
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|in_interrupt
c_func
(paren
)paren
op_logical_or
id|current-&gt;fs-&gt;root
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atomic_compare_and_swap
c_func
(paren
id|FALSE
comma
id|TRUE
comma
op_amp
id|chandev_conf_read
)paren
)paren
(brace
id|chandev_read_conf
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|chandev_printf
mdefine_line|#define chandev_printf(exitchan,args...)     &bslash;&n;splen=sprintf(spbuff,##args);                &bslash;&n;spoffset+=splen;                             &bslash;&n;if(spoffset&gt;offset) {                        &bslash;&n;       spbuff+=splen;                        &bslash;&n;       currlen+=splen;                       &bslash;&n;}                                            &bslash;&n;if(currlen&gt;=length)                          &bslash;&n;       goto exitchan;
DECL|function|sprintf_msck
r_void
id|sprintf_msck
c_func
(paren
r_char
op_star
id|buff
comma
r_int
id|auto_msck_recovery
)paren
(brace
id|chandev_msck_status
id|idx
suffix:semicolon
r_int
id|first_time
op_assign
id|TRUE
suffix:semicolon
id|buff
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
id|chandev_status_first_msck
suffix:semicolon
id|idx
OL
id|chandev_status_last_msck
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
(paren
id|idx
op_minus
l_int|1
)paren
)paren
op_amp
id|auto_msck_recovery
)paren
(brace
id|buff
op_add_assign
id|sprintf
c_func
(paren
id|buff
comma
l_string|&quot;%s%s&quot;
comma
(paren
id|first_time
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;,&quot;
)paren
comma
id|msck_status_strs
(braket
id|idx
)braket
)paren
suffix:semicolon
id|first_time
op_assign
id|FALSE
suffix:semicolon
)brace
)brace
)brace
DECL|function|chandev_read_proc
r_static
r_int
id|chandev_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_char
op_star
id|spbuff
op_assign
op_star
id|start
op_assign
id|page
suffix:semicolon
r_int
id|currlen
op_assign
l_int|0
comma
id|splen
op_assign
l_int|0
suffix:semicolon
id|off_t
id|spoffset
op_assign
l_int|0
suffix:semicolon
id|chandev_model_info
op_star
id|curr_model
suffix:semicolon
id|chandev_noauto_range
op_star
id|curr_noauto
suffix:semicolon
id|chandev_force
op_star
id|curr_force
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
suffix:semicolon
id|chandev_probelist
op_star
id|curr_probe
suffix:semicolon
id|chandev_msck_range
op_star
id|curr_msck_range
suffix:semicolon
id|s390_dev_info_t
id|curr_devinfo
suffix:semicolon
r_int
id|pass
comma
id|chandevs_detected
comma
id|curr_irq
comma
id|loopcnt
suffix:semicolon
id|chandev_irqinfo
op_star
id|read_irqinfo
comma
op_star
id|write_irqinfo
comma
op_star
id|data_irqinfo
suffix:semicolon
r_char
id|buff
(braket
l_int|3
)braket
(braket
l_int|80
)braket
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;n%s&bslash;n&quot;
l_string|&quot;*&squot;s for cu/dev type/models indicate don&squot;t cares&bslash;n&quot;
comma
id|chandev_keydescript
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;ncautious_auto_detect: %s&bslash;n&quot;
comma
id|chandev_cautious_auto_detect
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;npersist = 0x%02x&bslash;n&quot;
comma
id|chandev_persistent
)paren
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nuse_devno_names: %s&bslash;n&bslash;n&quot;
comma
id|chandev_use_devno_names
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chandev_models_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;Channels enabled for detection&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  chan     cu      cu     dev   dev    max     checksum  use hw  auto recovery&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  type    type    model  type  model  port_no. received   stats      type&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;==============================================================================&bslash;n&quot;
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_model
comma
id|chandev_models_head
)paren
(brace
id|chandev_sprint_devinfo
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
id|curr_model-&gt;cu_type
comma
id|curr_model-&gt;cu_model
comma
id|curr_model-&gt;dev_type
comma
id|curr_model-&gt;dev_model
)paren
suffix:semicolon
id|sprintf_msck
c_func
(paren
id|buff
(braket
l_int|1
)braket
comma
id|curr_model-&gt;auto_msck_recovery
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  0x%02x  %s%3d %s     %s     %s&bslash;n&quot;
comma
id|curr_model-&gt;chan_type
comma
id|buff
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|curr_model-&gt;max_port_no
comma
id|curr_model-&gt;default_checksum_received_ip_pkts
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no &quot;
comma
id|curr_model-&gt;default_use_hw_stats
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no &quot;
comma
id|buff
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chandev_noauto_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nNo auto devno ranges&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;   From        To   &bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;====================&bslash;n&quot;
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_noauto
comma
id|chandev_noauto_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  0x%04x     0x%04x&bslash;n&quot;
comma
id|curr_noauto-&gt;lo_devno
comma
id|curr_noauto-&gt;hi_devno
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chandev_msck_range_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nAutomatic machine check recovery devno ranges&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;   From        To   automatic recovery type&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;===========================================&bslash;n&quot;
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_msck_range
comma
id|chandev_msck_range_head
)paren
(brace
id|sprintf_msck
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
id|curr_msck_range-&gt;auto_msck_recovery
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  0x%04x     0x%04x %s&bslash;n&quot;
comma
id|curr_msck_range-&gt;lo_devno
comma
id|curr_msck_range-&gt;hi_devno
comma
id|buff
(braket
l_int|0
)braket
)paren
)brace
)brace
r_if
c_cond
(paren
id|chandev_force_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nForced devices&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  chan defif read   write  data   memory      port         ip    hw   host       adapter   api&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  type  num  devno  devno  devno  usage(k) protocol no.  chksum stats name        name     name&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;===============================================================================================&bslash;n&quot;
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_force
comma
id|chandev_force_head
)paren
(brace
r_if
c_cond
(paren
id|curr_force-&gt;memory_usage_in_k
op_eq
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
l_string|&quot;default&quot;
)paren
suffix:semicolon
)brace
r_else
id|sprintf
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
l_string|&quot;%6d&quot;
comma
id|curr_force-&gt;memory_usage_in_k
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  0x%02x  %3d  0x%04x 0x%04x 0x%04x %7s       %3d       %1d    %1d%s&quot;
comma
(paren
r_int
)paren
id|curr_force-&gt;chan_type
comma
(paren
r_int
)paren
id|curr_force-&gt;devif_num
comma
(paren
r_int
)paren
id|curr_force-&gt;read_lo_devno
comma
(paren
r_int
)paren
id|curr_force-&gt;write_hi_devno
comma
(paren
r_int
)paren
id|curr_force-&gt;data_devno
comma
id|buff
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|curr_force-&gt;port_protocol_no
comma
(paren
r_int
)paren
id|curr_force-&gt;checksum_received_ip_pkts
comma
(paren
r_int
)paren
id|curr_force-&gt;use_hw_stats
comma
id|curr_force-&gt;chan_type
op_eq
id|chandev_type_claw
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_force-&gt;chan_type
op_eq
id|chandev_type_claw
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot; %9s %9s %9s&bslash;n&quot;
comma
id|curr_force-&gt;claw.host_name
comma
id|curr_force-&gt;claw.adapter_name
comma
id|curr_force-&gt;claw.api_type
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|chandev_probelist_head
)paren
(brace
macro_line|#if CONFIG_ARCH_S390X
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nRegistered probe functions&bslash;n&quot;
l_string|&quot;probefunc            shutdownfunc        msck_notfunc        chan  devices devices&bslash;n&quot;
l_string|&quot;                                                             type   found  active&bslash;n&quot;
l_string|&quot;==================================================================================&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nRegistered probe functions&bslash;n&quot;
l_string|&quot;probefunc   shutdownfunc   msck_notfunc   chan  devices devices&bslash;n&quot;
l_string|&quot;                                          type   found  active&bslash;n&quot;
l_string|&quot;===============================================================&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|for_each
c_func
(paren
id|curr_probe
comma
id|chandev_probelist_head
)paren
(brace
r_int
id|devices_active
op_assign
l_int|0
suffix:semicolon
id|for_each
c_func
(paren
id|curr_device
comma
id|chandev_activelist_head
)paren
(brace
r_if
c_cond
(paren
id|curr_device-&gt;probefunc
op_eq
id|curr_probe-&gt;probefunc
)paren
(brace
id|devices_active
op_increment
suffix:semicolon
)brace
)brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%p   0x%p   0x%p       0x%02x     %d      %d&bslash;n&quot;
comma
id|curr_probe-&gt;probefunc
comma
id|curr_probe-&gt;shutdownfunc
comma
id|curr_probe-&gt;msck_notfunc
comma
id|curr_probe-&gt;chan_type
comma
id|curr_probe-&gt;devices_found
comma
id|devices_active
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chandev_activelist_head
)paren
(brace
r_int
r_int
r_int
id|total_memory_usage_in_k
op_assign
l_int|0
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nInitialised Devices&bslash;n&quot;
l_string|&quot; read   write  data  read   write  data  chan port  dev     dev         memory   read msck    write msck    data msck&bslash;n&quot;
l_string|&quot; irq     irq    irq  devno  devno  devno type no.   ptr     name        usage(k)  status       status        status&bslash;n&quot;
l_string|&quot;=====================================================================================================================&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* We print this list backwards for cosmetic reasons */
r_for
c_loop
(paren
id|curr_device
op_assign
id|chandev_activelist_head
suffix:semicolon
id|curr_device-&gt;next
op_ne
l_int|NULL
suffix:semicolon
id|curr_device
op_assign
id|curr_device-&gt;next
)paren
(brace
suffix:semicolon
)brace
r_while
c_loop
(paren
id|curr_device
)paren
(brace
id|read_irqinfo
op_assign
id|curr_device-&gt;read_irqinfo
suffix:semicolon
id|write_irqinfo
op_assign
id|curr_device-&gt;write_irqinfo
suffix:semicolon
id|data_irqinfo
op_assign
id|curr_device-&gt;data_irqinfo
suffix:semicolon
r_if
c_cond
(paren
id|data_irqinfo
)paren
(brace
id|sprintf
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
l_string|&quot;0x%04x&quot;
comma
id|data_irqinfo-&gt;sch.irq
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|buff
(braket
l_int|1
)braket
comma
l_string|&quot;0x%04x&quot;
comma
(paren
r_int
)paren
id|data_irqinfo-&gt;sch.devno
)paren
suffix:semicolon
)brace
r_else
(brace
id|strcpy
c_func
(paren
id|buff
(braket
l_int|0
)braket
comma
l_string|&quot;  n/a &quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|buff
(braket
l_int|1
)braket
comma
l_string|&quot;  n/a &quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|curr_device-&gt;memory_usage_in_k
OL
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|buff
(braket
l_int|2
)braket
comma
l_string|&quot;%d&quot;
comma
(paren
r_int
)paren
op_minus
id|curr_device-&gt;memory_usage_in_k
)paren
suffix:semicolon
id|total_memory_usage_in_k
op_sub_assign
id|curr_device-&gt;memory_usage_in_k
suffix:semicolon
)brace
r_else
id|strcpy
c_func
(paren
id|buff
(braket
l_int|2
)braket
comma
l_string|&quot;  n/a &quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%04x 0x%04x %s 0x%04x 0x%04x %s 0x%02x %2d 0x%p %-10s  %6s   %-12s %-12s %-12s&bslash;n&quot;
comma
id|read_irqinfo-&gt;sch.irq
comma
id|write_irqinfo-&gt;sch.irq
comma
id|buff
(braket
l_int|0
)braket
comma
(paren
r_int
)paren
id|read_irqinfo-&gt;sch.devno
comma
(paren
r_int
)paren
id|write_irqinfo-&gt;sch.devno
comma
id|buff
(braket
l_int|1
)braket
comma
id|curr_device-&gt;chan_type
comma
(paren
r_int
)paren
id|curr_device-&gt;port_no
comma
id|curr_device-&gt;dev_ptr
comma
id|curr_device-&gt;devname
comma
id|buff
(braket
l_int|2
)braket
comma
id|msck_status_strs
(braket
id|read_irqinfo-&gt;msck_status
)braket
comma
id|msck_status_strs
(braket
id|write_irqinfo-&gt;msck_status
)braket
comma
id|data_irqinfo
ques
c_cond
id|msck_status_strs
(braket
id|data_irqinfo-&gt;msck_status
)braket
suffix:colon
l_string|&quot;not applicable&quot;
)paren
suffix:semicolon
id|get_prev
c_func
(paren
(paren
id|list
op_star
)paren
id|chandev_activelist_head
comma
(paren
id|list
op_star
)paren
id|curr_device
comma
(paren
id|list
op_star
op_star
)paren
op_amp
id|curr_device
)paren
suffix:semicolon
)brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nTotal device memory usage %Luk.&bslash;n&quot;
comma
id|total_memory_usage_in_k
)paren
suffix:semicolon
)brace
id|chandevs_detected
op_assign
id|FALSE
suffix:semicolon
r_for
c_loop
(paren
id|pass
op_assign
id|FALSE
suffix:semicolon
id|pass
op_le
id|TRUE
suffix:semicolon
id|pass
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pass
op_logical_and
id|chandevs_detected
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;nchannels detected&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;              chan    cu    cu   dev    dev                          in chandev&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;  irq  devno  type   type  model type  model pim      chpids         use  reg.&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;===============================================================================&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|curr_irq
op_assign
id|get_irq_first
c_func
(paren
)paren
comma
id|loopcnt
op_assign
l_int|0
suffix:semicolon
id|curr_irq
op_ge
l_int|0
suffix:semicolon
id|curr_irq
op_assign
id|get_irq_next
c_func
(paren
id|curr_irq
)paren
comma
id|loopcnt
op_increment
)paren
(brace
r_if
c_cond
(paren
id|loopcnt
OG
l_int|0x10000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;chandev_read_proc detected infinite loop bug in get_irq_next&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|chan_error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chandev_is_chandev
c_func
(paren
id|curr_irq
comma
op_amp
id|curr_devinfo
comma
op_amp
id|curr_force
comma
op_amp
id|curr_model
)paren
)paren
(brace
id|schib_t
op_star
id|curr_schib
suffix:semicolon
id|curr_schib
op_assign
id|s390_get_schib
c_func
(paren
id|curr_irq
)paren
suffix:semicolon
id|chandevs_detected
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|pass
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%04x 0x%04x 0x%02x  0x%04x 0x%02x  0x%04x 0x%02x 0x%02x 0x%016Lx  %-5s %-5s&bslash;n&quot;
comma
id|curr_irq
comma
id|curr_devinfo.devno
comma
(paren
id|curr_force
ques
c_cond
id|curr_force-&gt;chan_type
suffix:colon
(paren
id|curr_model
ques
c_cond
id|curr_model-&gt;chan_type
suffix:colon
id|chandev_type_none
)paren
)paren
comma
(paren
r_int
)paren
id|curr_devinfo.sid_data.cu_type
comma
(paren
r_int
)paren
id|curr_devinfo.sid_data.cu_model
comma
(paren
r_int
)paren
id|curr_devinfo.sid_data.dev_type
comma
(paren
r_int
)paren
id|curr_devinfo.sid_data.dev_model
comma
(paren
r_int
)paren
(paren
id|curr_schib
ques
c_cond
id|curr_schib-&gt;pmcw.pim
suffix:colon
l_int|0
)paren
comma
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|curr_schib
ques
c_cond
op_amp
id|curr_schib-&gt;pmcw.chpid
(braket
l_int|0
)braket
suffix:colon
l_int|0
)paren
comma
(paren
id|curr_devinfo.status
op_amp
id|DEVSTAT_DEVICE_OWNED
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no &quot;
comma
(paren
id|chandev_get_irqinfo_by_irq
c_func
(paren
id|curr_irq
)paren
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no &quot;
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|chandev_parms_head
)paren
(brace
id|chandev_parms
op_star
id|curr_parms
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;&bslash;n driver specific parameters&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;chan    lo    hi      driver&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;type  devno  devno  parameters&bslash;n&quot;
)paren
suffix:semicolon
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;=============================================================================&bslash;n&quot;
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_parms
comma
id|chandev_parms_head
)paren
(brace
id|chandev_printf
c_func
(paren
id|chan_exit
comma
l_string|&quot;0x%02x 0x%04x 0x%04x  %s&bslash;n&quot;
comma
id|curr_parms-&gt;chan_type
comma
(paren
r_int
)paren
id|curr_parms-&gt;lo_devno
comma
(paren
r_int
)paren
id|curr_parms-&gt;hi_devno
comma
id|curr_parms-&gt;parmstr
)paren
suffix:semicolon
)brace
)brace
id|chan_error
suffix:colon
op_star
id|eof
op_assign
id|TRUE
suffix:semicolon
id|chan_exit
suffix:colon
r_if
c_cond
(paren
id|currlen
OG
id|length
)paren
(brace
multiline_comment|/* rewind to previous printf so that we are correctly&n;&t;&t; * aligned if we get called to print another page.&n;                 */
id|currlen
op_sub_assign
id|splen
suffix:semicolon
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_return
id|currlen
suffix:semicolon
)brace
DECL|function|chandev_write_proc
r_static
r_int
id|chandev_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|rc
suffix:semicolon
r_char
op_star
id|buff
suffix:semicolon
id|buff
op_assign
id|vmalloc
c_func
(paren
id|count
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buff
)paren
(brace
id|rc
op_assign
id|copy_from_user
c_func
(paren
id|buff
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|chandev_write_exit
suffix:semicolon
id|chandev_do_setup
c_func
(paren
id|FALSE
comma
id|buff
comma
id|count
)paren
suffix:semicolon
id|rc
op_assign
id|count
suffix:semicolon
id|chandev_write_exit
suffix:colon
id|vfree
c_func
(paren
id|buff
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_else
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|chandev_create_proc
r_static
r_void
id|__init
id|chandev_create_proc
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|dir_entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;chandev&quot;
comma
l_int|0644
comma
op_amp
id|proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dir_entry
)paren
(brace
id|dir_entry-&gt;read_proc
op_assign
op_amp
id|chandev_read_proc
suffix:semicolon
id|dir_entry-&gt;write_proc
op_assign
op_amp
id|chandev_write_proc
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
r_static
macro_line|#endif
DECL|function|chandev_init
r_int
id|__init
id|chandev_init
c_func
(paren
r_void
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|chandev_initialised
comma
id|TRUE
)paren
suffix:semicolon
id|chandev_parse_args
c_func
(paren
)paren
suffix:semicolon
id|chandev_init_default_models
c_func
(paren
)paren
suffix:semicolon
macro_line|#if CONFIG_PROC_FS
id|chandev_create_proc
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|chandev_msck_task_tq.routine
op_assign
id|chandev_msck_task
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|chandev_msck_task_tq.list
)paren
suffix:semicolon
id|chandev_msck_task_tq.sync
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|chandev_msck_task_tq.data
op_assign
l_int|NULL
suffix:semicolon
id|chandev_last_startmsck_list_update
op_assign
id|chandev_last_machine_check
op_assign
id|jiffies
op_minus
id|HZ
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|chandev_msck_thread_lock
comma
l_int|1
)paren
suffix:semicolon
id|chandev_lock_owner
op_assign
id|CHANDEV_INVALID_LOCK_OWNER
suffix:semicolon
id|chandev_lock_cnt
op_assign
l_int|0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chandev_spinlock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chandev_not_oper_spinlock
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|chandev_new_msck
comma
id|FALSE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if LINUX_VERSION_CODE&gt;=KERNEL_VERSION(2,3,0)
DECL|variable|chandev_init
id|__initcall
c_func
(paren
id|chandev_init
)paren
suffix:semicolon
macro_line|#endif
DECL|function|chandev_register_and_probe
r_int
id|chandev_register_and_probe
c_func
(paren
id|chandev_probefunc
id|probefunc
comma
id|chandev_shutdownfunc
id|shutdownfunc
comma
id|chandev_msck_notification_func
id|msck_notfunc
comma
id|chandev_type
id|chan_type
)paren
(brace
id|chandev_probelist
op_star
id|new_probe
comma
op_star
id|curr_probe
suffix:semicolon
multiline_comment|/* Avoid chicked &amp; egg situations where we may be called before we */
multiline_comment|/* are initialised. */
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_compare_and_swap
c_func
(paren
id|FALSE
comma
id|TRUE
comma
op_amp
id|chandev_initialised
)paren
)paren
(brace
id|chandev_init
c_func
(paren
)paren
suffix:semicolon
)brace
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_probe
comma
id|chandev_probelist_head
)paren
(brace
r_if
c_cond
(paren
id|curr_probe-&gt;probefunc
op_eq
id|probefunc
)paren
(brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;chandev_register_and_probe detected duplicate probefunc %p&quot;
l_string|&quot; for chan_type  0x%02x &bslash;n&quot;
comma
id|probefunc
comma
id|chan_type
)paren
suffix:semicolon
r_return
(paren
op_minus
id|EPERM
)paren
suffix:semicolon
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|new_probe
op_assign
id|chandev_alloc
c_func
(paren
r_sizeof
(paren
id|chandev_probelist
)paren
)paren
)paren
)paren
(brace
id|new_probe-&gt;probefunc
op_assign
id|probefunc
suffix:semicolon
id|new_probe-&gt;shutdownfunc
op_assign
id|shutdownfunc
suffix:semicolon
id|new_probe-&gt;msck_notfunc
op_assign
id|msck_notfunc
suffix:semicolon
id|new_probe-&gt;chan_type
op_assign
id|chan_type
suffix:semicolon
id|new_probe-&gt;devices_found
op_assign
l_int|0
suffix:semicolon
id|chandev_add_to_list
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
id|new_probe
)paren
suffix:semicolon
id|chandev_probe
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|new_probe
ques
c_cond
id|new_probe-&gt;devices_found
suffix:colon
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|chandev_unregister
r_void
id|chandev_unregister
c_func
(paren
id|chandev_probefunc
id|probefunc
comma
r_int
id|call_shutdown
)paren
(brace
id|chandev_probelist
op_star
id|curr_probe
suffix:semicolon
id|chandev_activelist
op_star
id|curr_device
comma
op_star
id|next_device
suffix:semicolon
id|chandev_interrupt_check
c_func
(paren
)paren
suffix:semicolon
id|chandev_lock
c_func
(paren
)paren
suffix:semicolon
id|for_each
c_func
(paren
id|curr_probe
comma
id|chandev_probelist_head
)paren
(brace
r_if
c_cond
(paren
id|curr_probe-&gt;probefunc
op_eq
id|probefunc
)paren
(brace
id|for_each_allow_delete
c_func
(paren
id|curr_device
comma
id|next_device
comma
id|chandev_activelist_head
)paren
r_if
c_cond
(paren
id|curr_device-&gt;probefunc
op_eq
id|probefunc
op_logical_and
id|call_shutdown
)paren
(brace
id|chandev_shutdown
c_func
(paren
id|curr_device
)paren
suffix:semicolon
)brace
id|chandev_free_listmember
c_func
(paren
(paren
id|list
op_star
op_star
)paren
op_amp
id|chandev_probelist_head
comma
(paren
id|list
op_star
)paren
id|curr_probe
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|chandev_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|chandev_persist
r_int
id|chandev_persist
c_func
(paren
id|chandev_type
id|chan_type
)paren
(brace
r_return
(paren
id|chandev_persistent
op_amp
id|chan_type
)paren
ques
c_cond
id|TRUE
suffix:colon
id|FALSE
suffix:semicolon
)brace
DECL|variable|chandev_register_and_probe
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_register_and_probe
)paren
suffix:semicolon
DECL|variable|chandev_request_irq
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_request_irq
)paren
suffix:semicolon
DECL|variable|chandev_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_unregister
)paren
suffix:semicolon
DECL|variable|chandev_initdevice
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_initdevice
)paren
suffix:semicolon
DECL|variable|chandev_build_device_name
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_build_device_name
)paren
suffix:semicolon
DECL|variable|chandev_initnetdevice
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_initnetdevice
)paren
suffix:semicolon
DECL|variable|chandev_init_netdev
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_init_netdev
)paren
suffix:semicolon
DECL|variable|chandev_use_devno_names
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_use_devno_names
)paren
suffix:semicolon
DECL|variable|chandev_free_irq
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_free_irq
)paren
suffix:semicolon
DECL|variable|chandev_add_model
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_add_model
)paren
suffix:semicolon
DECL|variable|chandev_del_model
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_del_model
)paren
suffix:semicolon
DECL|variable|chandev_persist
id|EXPORT_SYMBOL
c_func
(paren
id|chandev_persist
)paren
suffix:semicolon
eof
