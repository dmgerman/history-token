multiline_comment|/*&n; *&n; * linux/drivers/s390/scsi/zfcp_aux.c&n; *&n; * FCP adapter driver for IBM eServer zSeries&n; *&n; * Copyright 2002 IBM Corporation&n; * Author(s): Martin Peschke &lt;mpeschke@de.ibm.com&gt;&n; *            Raimund Schroeder &lt;raimund.schroeder@de.ibm.com&gt;&n; *            Aron Zeh &lt;arzeh@de.ibm.com&gt;&n; *            Wolfgang Taphorn &lt;taphorn@de.ibm.com&gt;&n; *            Stefan Bader &lt;stefan.bader@de.ibm.com&gt;&n; *            Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
multiline_comment|/* this drivers version (do not edit !!! generated and updated by cvs) */
DECL|macro|ZFCP_AUX_REVISION
mdefine_line|#define ZFCP_AUX_REVISION &quot;$Revision: 1.79 $&quot;
multiline_comment|/********************** INCLUDES *********************************************/
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/workqueue.h&gt;
macro_line|#include &quot;zfcp_ext.h&quot;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/ebcdic.h&gt;
macro_line|#include &lt;asm/cpcmd.h&gt;&t;&t;/* Debugging only */
macro_line|#include &lt;asm/processor.h&gt;&t;/* Debugging only */
multiline_comment|/* accumulated log level (module parameter) */
DECL|variable|loglevel
r_static
id|u32
id|loglevel
op_assign
id|ZFCP_LOG_LEVEL_DEFAULTS
suffix:semicolon
multiline_comment|/*********************** FUNCTION PROTOTYPES *********************************/
multiline_comment|/* written against the module interface */
r_static
r_int
id|__init
id|zfcp_module_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|__exit
id|zfcp_module_exit
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|zfcp_reboot_handler
c_func
(paren
r_struct
id|notifier_block
op_star
comma
r_int
r_int
comma
r_void
op_star
)paren
suffix:semicolon
multiline_comment|/* FCP related */
r_static
r_void
id|zfcp_nameserver_request_handler
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
)paren
suffix:semicolon
multiline_comment|/* miscellaneous */
macro_line|#ifdef ZFCP_STAT_REQSIZES
r_static
r_int
id|zfcp_statistics_init_all
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|zfcp_statistics_clear_all
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|zfcp_statistics_clear
c_func
(paren
r_struct
id|list_head
op_star
)paren
suffix:semicolon
r_static
r_int
id|zfcp_statistics_new
c_func
(paren
r_struct
id|list_head
op_star
comma
id|u32
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*********************** KERNEL/MODULE PARAMETERS  ***************************/
multiline_comment|/* declare driver module init/cleanup functions */
DECL|variable|zfcp_module_init
id|module_init
c_func
(paren
id|zfcp_module_init
)paren
suffix:semicolon
DECL|variable|zfcp_module_exit
id|module_exit
c_func
(paren
id|zfcp_module_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;, &quot;
l_string|&quot;Martin Peschke &lt;mpeschke@de.ibm.com&gt;, &quot;
l_string|&quot;Raimund Schroeder &lt;raimund.schroeder@de.ibm.com&gt;, &quot;
l_string|&quot;Wolfgang Taphorn &lt;taphorn@de.ibm.com&gt;, &quot;
l_string|&quot;Aron Zeh &lt;arzeh@de.ibm.com&gt;, &quot;
l_string|&quot;IBM Deutschland Entwicklung GmbH&quot;
)paren
suffix:semicolon
multiline_comment|/* what this driver module is about */
id|MODULE_DESCRIPTION
(paren
l_string|&quot;FCP (SCSI over Fibre Channel) HBA driver for IBM eServer zSeries&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
multiline_comment|/* log level may be provided as a module parameter */
id|module_param
c_func
(paren
id|loglevel
comma
id|uint
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* short explaination of the previous module parameter */
id|MODULE_PARM_DESC
c_func
(paren
id|loglevel
comma
l_string|&quot;log levels, 8 nibbles: &quot;
l_string|&quot;(unassigned) ERP QDIO DIO Config FSF SCSI Other, &quot;
l_string|&quot;levels: 0=none 1=normal 2=devel 3=trace&quot;
)paren
suffix:semicolon
macro_line|#ifdef ZFCP_PRINT_FLAGS
DECL|variable|flags_dump
id|u32
id|flags_dump
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|flags_dump
comma
id|uint
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/****************************************************************/
multiline_comment|/************** Functions without logging ***********************/
multiline_comment|/****************************************************************/
r_void
DECL|function|_zfcp_hex_dump
id|_zfcp_hex_dump
c_func
(paren
r_char
op_star
id|addr
comma
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%02x&quot;
comma
id|addr
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|4
)paren
op_eq
l_int|3
)paren
id|printk
c_func
(paren
l_string|&quot; &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|32
)paren
op_eq
l_int|31
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|32
)paren
op_ne
l_int|31
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************/
multiline_comment|/************** Uncategorised Functions *************************/
multiline_comment|/****************************************************************/
DECL|macro|ZFCP_LOG_AREA
mdefine_line|#define ZFCP_LOG_AREA&t;&t;&t;ZFCP_LOG_AREA_OTHER
DECL|macro|ZFCP_LOG_AREA_PREFIX
mdefine_line|#define ZFCP_LOG_AREA_PREFIX&t;&t;ZFCP_LOG_AREA_PREFIX_OTHER
macro_line|#ifdef ZFCP_STAT_REQSIZES
r_static
r_int
DECL|function|zfcp_statistics_clear
id|zfcp_statistics_clear
c_func
(paren
r_struct
id|list_head
op_star
id|head
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|zfcp_statistics
op_star
id|stat
comma
op_star
id|tmp
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.stat_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|stat
comma
id|tmp
comma
id|head
comma
id|list
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|stat-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|stat
)paren
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.stat_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* Add new statistics entry */
r_static
r_int
DECL|function|zfcp_statistics_new
id|zfcp_statistics_new
c_func
(paren
r_struct
id|list_head
op_star
id|head
comma
id|u32
id|num
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_struct
id|zfcp_statistics
op_star
id|stat
suffix:semicolon
id|stat
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|zfcp_statistics
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
)paren
(brace
id|memset
c_func
(paren
id|stat
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zfcp_statistics
)paren
)paren
suffix:semicolon
id|stat-&gt;num
op_assign
id|num
suffix:semicolon
id|stat-&gt;occurrence
op_assign
l_int|1
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|stat-&gt;list
comma
id|head
)paren
suffix:semicolon
)brace
r_else
id|zfcp_data.stat_errors
op_increment
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_int
DECL|function|zfcp_statistics_inc
id|zfcp_statistics_inc
c_func
(paren
r_struct
id|list_head
op_star
id|head
comma
id|u32
id|num
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|zfcp_statistics
op_star
id|stat
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.stat_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|stat
comma
id|head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|stat-&gt;num
op_eq
id|num
)paren
(brace
id|stat-&gt;occurrence
op_increment
suffix:semicolon
r_goto
id|unlock
suffix:semicolon
)brace
)brace
multiline_comment|/* occurrence must be initialized to 1 */
id|zfcp_statistics_new
c_func
(paren
id|head
comma
id|num
)paren
suffix:semicolon
id|unlock
suffix:colon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.stat_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|zfcp_statistics_init_all
id|zfcp_statistics_init_all
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|rwlock_init
c_func
(paren
op_amp
id|zfcp_data.stat_lock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.read_req_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.write_req_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.read_sg_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.write_sg_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.read_sguse_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.write_sguse_head
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
DECL|function|zfcp_statistics_clear_all
id|zfcp_statistics_clear_all
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.read_req_head
)paren
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.write_req_head
)paren
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.read_sg_head
)paren
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.write_sg_head
)paren
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.read_sguse_head
)paren
suffix:semicolon
id|zfcp_statistics_clear
c_func
(paren
op_amp
id|zfcp_data.write_sguse_head
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#endif /* ZFCP_STAT_REQSIZES */
r_static
r_inline
r_int
DECL|function|zfcp_fsf_req_is_scsi_cmnd
id|zfcp_fsf_req_is_scsi_cmnd
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
)paren
(brace
r_return
(paren
(paren
id|fsf_req-&gt;fsf_command
op_eq
id|FSF_QTCB_FCP_CMND
)paren
op_logical_and
op_logical_neg
(paren
id|fsf_req-&gt;status
op_amp
id|ZFCP_STATUS_FSFREQ_TASK_MANAGEMENT
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|zfcp_cmd_dbf_event_fsf
id|zfcp_cmd_dbf_event_fsf
c_func
(paren
r_const
r_char
op_star
id|text
comma
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
comma
r_void
op_star
id|add_data
comma
r_int
id|add_length
)paren
(brace
macro_line|#ifdef ZFCP_DEBUG_COMMANDS
r_struct
id|zfcp_adapter
op_star
id|adapter
op_assign
id|fsf_req-&gt;adapter
suffix:semicolon
id|Scsi_Cmnd
op_star
id|scsi_cmnd
suffix:semicolon
r_int
id|level
op_assign
l_int|3
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|adapter-&gt;cmd_dbf_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zfcp_fsf_req_is_scsi_cmnd
c_func
(paren
id|fsf_req
)paren
)paren
(brace
id|scsi_cmnd
op_assign
id|fsf_req-&gt;data.send_fcp_command_task.scsi_cmnd
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
l_string|&quot;fsferror&quot;
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
id|text
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|fsf_req
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|fsf_req-&gt;seq_no
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|scsi_cmnd
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|add_length
suffix:semicolon
id|i
op_add_assign
id|ZFCP_CMD_DBF_LENGTH
)paren
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
(paren
r_char
op_star
)paren
id|add_data
op_plus
id|i
comma
id|min
c_func
(paren
id|ZFCP_CMD_DBF_LENGTH
comma
id|add_length
op_minus
id|i
)paren
)paren
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|adapter-&gt;cmd_dbf_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|zfcp_cmd_dbf_event_scsi
id|zfcp_cmd_dbf_event_scsi
c_func
(paren
r_const
r_char
op_star
id|text
comma
id|Scsi_Cmnd
op_star
id|scsi_cmnd
)paren
(brace
macro_line|#ifdef ZFCP_DEBUG_COMMANDS
r_struct
id|zfcp_adapter
op_star
id|adapter
suffix:semicolon
r_union
id|zfcp_req_data
op_star
id|req_data
suffix:semicolon
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
suffix:semicolon
r_int
id|level
op_assign
(paren
(paren
id|host_byte
c_func
(paren
id|scsi_cmnd-&gt;result
)paren
op_ne
l_int|0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|5
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|adapter
op_assign
(paren
r_struct
id|zfcp_adapter
op_star
)paren
id|scsi_cmnd-&gt;device-&gt;host-&gt;hostdata
(braket
l_int|0
)braket
suffix:semicolon
id|req_data
op_assign
(paren
r_union
id|zfcp_req_data
op_star
)paren
id|scsi_cmnd-&gt;host_scribble
suffix:semicolon
id|fsf_req
op_assign
(paren
id|req_data
ques
c_cond
id|req_data-&gt;send_fcp_command_task.fsf_req
suffix:colon
l_int|NULL
)paren
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|adapter-&gt;cmd_dbf_lock
comma
id|flags
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
l_string|&quot;hostbyte&quot;
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
id|text
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|scsi_cmnd-&gt;result
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|scsi_cmnd
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|fsf_req
)paren
)paren
(brace
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|fsf_req
comma
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
op_amp
id|fsf_req-&gt;seq_no
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|level
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|adapter-&gt;cmd_dbf_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
r_void
DECL|function|zfcp_in_els_dbf_event
id|zfcp_in_els_dbf_event
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
r_const
r_char
op_star
id|text
comma
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
comma
r_int
id|length
)paren
(brace
macro_line|#ifdef ZFCP_DEBUG_INCOMING_ELS
r_int
id|level
op_assign
l_int|1
suffix:semicolon
r_int
id|i
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;in_els_dbf
comma
id|level
comma
id|text
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;in_els_dbf
comma
id|level
comma
op_amp
id|status_buffer-&gt;d_id
comma
l_int|8
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_add_assign
id|ZFCP_IN_ELS_DBF_LENGTH
)paren
id|debug_event
c_func
(paren
id|adapter-&gt;in_els_dbf
comma
id|level
comma
(paren
r_char
op_star
)paren
id|status_buffer-&gt;payload
op_plus
id|i
comma
id|min
c_func
(paren
id|ZFCP_IN_ELS_DBF_LENGTH
comma
id|length
op_minus
id|i
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifndef MODULE
multiline_comment|/**&n; * zfcp_device_setup - setup function&n; * @str: pointer to parameter string&n; *&n; * Parse the kernel parameter string &quot;zfcp_device=...&quot;&n; */
r_static
r_int
id|__init
DECL|function|zfcp_device_setup
id|zfcp_device_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
id|tmp
op_assign
id|strchr
c_func
(paren
id|str
comma
l_char|&squot;,&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
r_goto
id|err_out
suffix:semicolon
op_star
id|tmp
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strncpy
c_func
(paren
id|zfcp_data.init_busid
comma
id|str
comma
id|BUS_ID_SIZE
)paren
suffix:semicolon
id|zfcp_data.init_busid
(braket
id|BUS_ID_SIZE
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|zfcp_data.init_wwpn
op_assign
id|simple_strtoull
c_func
(paren
id|tmp
comma
op_amp
id|tmp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|tmp
op_increment
op_ne
l_char|&squot;,&squot;
)paren
r_goto
id|err_out
suffix:semicolon
r_if
c_cond
(paren
op_star
id|tmp
op_eq
l_char|&squot;&bslash;0&squot;
)paren
r_goto
id|err_out
suffix:semicolon
id|zfcp_data.init_fcp_lun
op_assign
id|simple_strtoull
c_func
(paren
id|tmp
comma
op_amp
id|tmp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|tmp
op_ne
l_char|&squot;&bslash;0&squot;
)paren
r_goto
id|err_out
suffix:semicolon
id|zfcp_data.init_is_valid
op_assign
l_int|1
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|err_out
suffix:colon
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;Parse error for parameter string %s&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;zfcp_device=&quot;
comma
id|zfcp_device_setup
)paren
suffix:semicolon
r_static
r_void
id|__init
DECL|function|zfcp_init_device_configure
id|zfcp_init_device_configure
c_func
(paren
r_void
)paren
(brace
r_int
id|found
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|zfcp_adapter
op_star
id|adapter
suffix:semicolon
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
r_struct
id|zfcp_unit
op_star
id|unit
suffix:semicolon
id|down
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
id|read_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|adapter
comma
op_amp
id|zfcp_data.adapter_list_head
comma
id|list
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|zfcp_data.init_busid
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|zfcp_adapter_get
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
r_goto
id|out_adapter
suffix:semicolon
id|port
op_assign
id|zfcp_port_enqueue
c_func
(paren
id|adapter
comma
id|zfcp_data.init_wwpn
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_goto
id|out_port
suffix:semicolon
id|unit
op_assign
id|zfcp_unit_enqueue
c_func
(paren
id|port
comma
id|zfcp_data.init_fcp_lun
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|unit
)paren
r_goto
id|out_unit
suffix:semicolon
id|up
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
id|ccw_device_set_online
c_func
(paren
id|adapter-&gt;ccw_device
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
id|wait_event
c_func
(paren
id|unit-&gt;scsi_add_wq
comma
id|atomic_read
c_func
(paren
op_amp
id|unit-&gt;scsi_add_work
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|zfcp_unit_put
c_func
(paren
id|unit
)paren
suffix:semicolon
id|out_unit
suffix:colon
id|zfcp_port_put
c_func
(paren
id|port
)paren
suffix:semicolon
id|out_port
suffix:colon
id|zfcp_adapter_put
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|out_adapter
suffix:colon
id|up
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif  /* #ifndef MODULE */
r_static
r_int
id|__init
DECL|function|zfcp_module_init
id|zfcp_module_init
c_func
(paren
r_void
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|zfcp_data.loglevel
comma
id|loglevel
)paren
suffix:semicolon
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|ZFCP_LOG_TRACE
c_func
(paren
l_string|&quot;Start Address of module: 0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
op_amp
id|zfcp_module_init
)paren
suffix:semicolon
multiline_comment|/* initialize adapter list */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.adapter_list_head
)paren
suffix:semicolon
multiline_comment|/* initialize adapters to be removed list head */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|zfcp_data.adapter_remove_lh
)paren
suffix:semicolon
macro_line|#ifdef ZFCP_STAT_REQSIZES
id|zfcp_statistics_init_all
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Initialise proc semaphores */
id|sema_init
c_func
(paren
op_amp
id|zfcp_data.config_sema
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* initialise configuration rw lock */
id|rwlock_init
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|zfcp_data.reboot_notifier.notifier_call
op_assign
id|zfcp_reboot_handler
suffix:semicolon
id|register_reboot_notifier
c_func
(paren
op_amp
id|zfcp_data.reboot_notifier
)paren
suffix:semicolon
multiline_comment|/* save address of data structure managing the driver module */
id|zfcp_data.scsi_host_template.module
op_assign
id|THIS_MODULE
suffix:semicolon
multiline_comment|/* setup dynamic I/O */
id|retval
op_assign
id|zfcp_ccw_register
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;Registering with common I/O layer failed.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out_ccw_register
suffix:semicolon
)brace
macro_line|#ifndef MODULE
r_if
c_cond
(paren
id|zfcp_data.init_is_valid
)paren
id|zfcp_init_device_configure
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|out
suffix:semicolon
id|out_ccw_register
suffix:colon
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|zfcp_data.reboot_notifier
)paren
suffix:semicolon
macro_line|#ifdef ZFCP_STAT_REQSIZES
id|zfcp_statistics_clear_all
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|zfcp_module_exit
id|zfcp_module_exit
c_func
(paren
r_void
)paren
(brace
id|unregister_reboot_notifier
c_func
(paren
op_amp
id|zfcp_data.reboot_notifier
)paren
suffix:semicolon
id|zfcp_ccw_unregister
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef ZFCP_STAT_REQSIZES
id|zfcp_statistics_clear_all
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This function is called automatically by the kernel whenever a reboot or a &n; * shut-down is initiated and zfcp is still loaded&n; *&n; * locks:       zfcp_data.config_sema is taken prior to shutting down the module&n; *              and removing all structures&n; * returns:     NOTIFY_DONE in all cases&n; */
r_int
DECL|function|zfcp_reboot_handler
id|zfcp_reboot_handler
c_func
(paren
r_struct
id|notifier_block
op_star
id|notifier
comma
r_int
r_int
id|code
comma
r_void
op_star
id|ptr
)paren
(brace
id|zfcp_ccw_unregister
c_func
(paren
)paren
suffix:semicolon
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|macro|ZFCP_LOG_AREA
macro_line|#undef ZFCP_LOG_AREA
DECL|macro|ZFCP_LOG_AREA_PREFIX
macro_line|#undef ZFCP_LOG_AREA_PREFIX
multiline_comment|/****************************************************************/
multiline_comment|/****** Functions for configuration/set-up of structures ********/
multiline_comment|/****************************************************************/
DECL|macro|ZFCP_LOG_AREA
mdefine_line|#define ZFCP_LOG_AREA&t;&t;&t;ZFCP_LOG_AREA_CONFIG
DECL|macro|ZFCP_LOG_AREA_PREFIX
mdefine_line|#define ZFCP_LOG_AREA_PREFIX&t;&t;ZFCP_LOG_AREA_PREFIX_CONFIG
macro_line|#ifndef MODULE
multiline_comment|/* zfcp_loglevel boot_parameter */
r_static
r_int
id|__init
DECL|function|zfcp_loglevel_setup
id|zfcp_loglevel_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|loglevel
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|ZFCP_LOG_TRACE
c_func
(paren
l_string|&quot;loglevel is 0x%x&bslash;n&quot;
comma
id|loglevel
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* why just 1? */
)brace
id|__setup
c_func
(paren
l_string|&quot;zfcp_loglevel=&quot;
comma
id|zfcp_loglevel_setup
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* not MODULE */
multiline_comment|/**&n; * zfcp_get_unit_by_lun - find unit in unit list of port by fcp lun&n; * @port: pointer to port to search for unit&n; * @fcp_lun: lun to search for&n; * Traverses list of all units of a port and returns pointer to a unit&n; * if lun of a unit matches.&n; */
r_struct
id|zfcp_unit
op_star
DECL|function|zfcp_get_unit_by_lun
id|zfcp_get_unit_by_lun
c_func
(paren
r_struct
id|zfcp_port
op_star
id|port
comma
id|fcp_lun_t
id|fcp_lun
)paren
(brace
r_struct
id|zfcp_unit
op_star
id|unit
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|unit
comma
op_amp
id|port-&gt;unit_list_head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
(paren
id|unit-&gt;fcp_lun
op_eq
id|fcp_lun
)paren
op_logical_and
op_logical_neg
id|atomic_test_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|unit-&gt;status
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|found
ques
c_cond
id|unit
suffix:colon
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/**&n; * zfcp_get_port_by_wwpn - find unit in unit list of port by fcp lun&n; * @adapter: pointer to adapter to search for port&n; * @wwpn: wwpn to search for&n; * Traverses list of all ports of an adapter and returns a pointer to a port&n; * if wwpn of a port matches.&n; */
r_struct
id|zfcp_port
op_star
DECL|function|zfcp_get_port_by_wwpn
id|zfcp_get_port_by_wwpn
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
id|wwn_t
id|wwpn
)paren
(brace
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
r_int
id|found
op_assign
l_int|0
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|port
comma
op_amp
id|adapter-&gt;port_list_head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
(paren
id|port-&gt;wwpn
op_eq
id|wwpn
)paren
op_logical_and
op_logical_neg
id|atomic_test_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|port-&gt;status
)paren
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|found
ques
c_cond
id|port
suffix:colon
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Enqueues a logical unit at the end of the unit list associated with the &n; * specified port. Also sets up some unit internal structures.&n; *&n; * returns:&t;pointer to unit with a usecount of 1 if a new unit was&n; *              successfully enqueued&n; *              NULL otherwise&n; * locks:&t;config_sema must be held to serialise changes to the unit list&n; */
r_struct
id|zfcp_unit
op_star
DECL|function|zfcp_unit_enqueue
id|zfcp_unit_enqueue
c_func
(paren
r_struct
id|zfcp_port
op_star
id|port
comma
id|fcp_lun_t
id|fcp_lun
)paren
(brace
r_struct
id|zfcp_unit
op_star
id|unit
suffix:semicolon
multiline_comment|/*&n;&t; * check that there is no unit with this FCP_LUN already in list&n;&t; * and enqueue it.&n;&t; * Note: Unlike for the adapter and the port, this is an error&n;&t; */
id|read_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|unit
op_assign
id|zfcp_get_unit_by_lun
c_func
(paren
id|port
comma
id|fcp_lun
)paren
suffix:semicolon
id|read_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unit
)paren
r_return
l_int|NULL
suffix:semicolon
id|unit
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|zfcp_unit
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|unit
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|unit
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zfcp_unit
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|unit-&gt;scsi_add_wq
)paren
suffix:semicolon
multiline_comment|/* initialise reference count stuff */
id|atomic_set
c_func
(paren
op_amp
id|unit-&gt;refcount
comma
l_int|0
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|unit-&gt;remove_wq
)paren
suffix:semicolon
id|unit-&gt;port
op_assign
id|port
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME: reuse of scsi_luns!&n;&t; */
id|unit-&gt;scsi_lun
op_assign
id|port-&gt;max_scsi_lun
op_plus
l_int|1
suffix:semicolon
id|unit-&gt;fcp_lun
op_assign
id|fcp_lun
suffix:semicolon
id|unit-&gt;common_magic
op_assign
id|ZFCP_MAGIC
suffix:semicolon
id|unit-&gt;specific_magic
op_assign
id|ZFCP_MAGIC_UNIT
suffix:semicolon
multiline_comment|/* setup for sysfs registration */
id|snprintf
c_func
(paren
id|unit-&gt;sysfs_device.bus_id
comma
id|BUS_ID_SIZE
comma
l_string|&quot;0x%016llx&quot;
comma
id|fcp_lun
)paren
suffix:semicolon
id|unit-&gt;sysfs_device.parent
op_assign
op_amp
id|port-&gt;sysfs_device
suffix:semicolon
id|unit-&gt;sysfs_device.release
op_assign
id|zfcp_sysfs_unit_release
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
op_amp
id|unit-&gt;sysfs_device
comma
id|unit
)paren
suffix:semicolon
multiline_comment|/* mark unit unusable as long as sysfs registration is not complete */
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|unit-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device_register
c_func
(paren
op_amp
id|unit-&gt;sysfs_device
)paren
)paren
(brace
id|kfree
c_func
(paren
id|unit
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zfcp_sysfs_unit_create_files
c_func
(paren
op_amp
id|unit-&gt;sysfs_device
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * failed to create all sysfs attributes, therefore the unit&n;&t;&t; * must be put on the unit_remove listhead of the port where&n;&t;&t; * the release function expects it.&n;&t;&t; */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|unit-&gt;list
comma
op_amp
id|port-&gt;unit_remove_lh
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|unit-&gt;sysfs_device
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * update max SCSI LUN of logical units attached to parent remote port&n;&t; */
id|port-&gt;max_scsi_lun
op_increment
suffix:semicolon
multiline_comment|/*&n;&t; * update max SCSI LUN of logical units attached to parent adapter&n;&t; */
r_if
c_cond
(paren
id|port-&gt;adapter-&gt;max_scsi_lun
OL
id|port-&gt;max_scsi_lun
)paren
id|port-&gt;adapter-&gt;max_scsi_lun
op_assign
id|port-&gt;max_scsi_lun
suffix:semicolon
multiline_comment|/*&n;&t; * update max SCSI LUN of logical units attached to host (SCSI stack)&n;&t; */
r_if
c_cond
(paren
id|port-&gt;adapter-&gt;scsi_host
op_logical_and
(paren
id|port-&gt;adapter-&gt;scsi_host-&gt;max_lun
OL
id|port-&gt;max_scsi_lun
)paren
)paren
id|port-&gt;adapter-&gt;scsi_host-&gt;max_lun
op_assign
id|port-&gt;max_scsi_lun
op_plus
l_int|1
suffix:semicolon
id|zfcp_unit_get
c_func
(paren
id|unit
)paren
suffix:semicolon
multiline_comment|/* unit is new and needs to be added to list */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|atomic_clear_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|unit-&gt;status
)paren
suffix:semicolon
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_RUNNING
comma
op_amp
id|unit-&gt;status
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|unit-&gt;list
comma
op_amp
id|port-&gt;unit_list_head
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|port-&gt;units
op_increment
suffix:semicolon
id|zfcp_port_get
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
id|unit
suffix:semicolon
)brace
multiline_comment|/* locks:  config_sema must be held */
r_void
DECL|function|zfcp_unit_dequeue
id|zfcp_unit_dequeue
c_func
(paren
r_struct
id|zfcp_unit
op_star
id|unit
)paren
(brace
multiline_comment|/* remove specified unit data structure from list */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|unit-&gt;list
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|unit-&gt;port-&gt;units
op_decrement
suffix:semicolon
id|zfcp_port_put
c_func
(paren
id|unit-&gt;port
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|unit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
op_star
DECL|function|zfcp_mempool_alloc
id|zfcp_mempool_alloc
c_func
(paren
r_int
id|gfp_mask
comma
r_void
op_star
id|size
)paren
(brace
r_return
id|kmalloc
c_func
(paren
(paren
r_int
)paren
id|size
comma
id|gfp_mask
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|zfcp_mempool_free
id|zfcp_mempool_free
c_func
(paren
r_void
op_star
id|element
comma
r_void
op_star
id|size
)paren
(brace
id|kfree
c_func
(paren
id|element
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocates a combined QTCB/fsf_req buffer for erp actions and fcp/SCSI&n; * commands.&n; * It also genrates fcp-nameserver request/response buffer and unsolicited &n; * status read fsf_req buffers.&n; *&n; * locks:       must only be called with zfcp_data.config_sema taken&n; */
r_static
r_int
DECL|function|zfcp_allocate_low_mem_buffers
id|zfcp_allocate_low_mem_buffers
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
)paren
(brace
id|adapter-&gt;pool.erp_fsf
op_assign
id|mempool_create
c_func
(paren
l_int|1
comma
id|zfcp_mempool_alloc
comma
id|zfcp_mempool_free
comma
(paren
r_void
op_star
)paren
id|ZFCP_QTCB_AND_REQ_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;pool.erp_fsf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: FCP command buffer pool allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|adapter-&gt;pool.nameserver
op_assign
id|mempool_create
c_func
(paren
l_int|1
comma
id|zfcp_mempool_alloc
comma
id|zfcp_mempool_free
comma
(paren
r_void
op_star
)paren
(paren
l_int|2
op_star
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;pool.nameserver
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Nameserver buffer pool allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|adapter-&gt;pool.status_read_fsf
op_assign
id|mempool_create
c_func
(paren
id|ZFCP_STATUS_READS_RECOM
comma
id|zfcp_mempool_alloc
comma
id|zfcp_mempool_free
comma
(paren
r_void
op_star
)paren
r_sizeof
(paren
r_struct
id|zfcp_fsf_req
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;pool.status_read_fsf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Status read request pool allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|adapter-&gt;pool.status_read_buf
op_assign
id|mempool_create
c_func
(paren
id|ZFCP_STATUS_READS_RECOM
comma
id|zfcp_mempool_alloc
comma
id|zfcp_mempool_free
comma
(paren
r_void
op_star
)paren
r_sizeof
(paren
r_struct
id|fsf_status_read_buffer
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;pool.status_read_buf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Status read buffer pool allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|adapter-&gt;pool.fcp_command_fsf
op_assign
id|mempool_create
c_func
(paren
l_int|1
comma
id|zfcp_mempool_alloc
comma
id|zfcp_mempool_free
comma
(paren
r_void
op_star
)paren
id|ZFCP_QTCB_AND_REQ_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;pool.fcp_command_fsf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: FCP command buffer pool allocation failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|adapter-&gt;pool.fcp_command_fsf_timer
)paren
suffix:semicolon
id|adapter-&gt;pool.fcp_command_fsf_timer.function
op_assign
id|zfcp_erp_scsi_low_mem_buffer_timeout_handler
suffix:semicolon
id|adapter-&gt;pool.fcp_command_fsf_timer.data
op_assign
(paren
r_int
r_int
)paren
id|adapter
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* locks:       must only be called with zfcp_data.config_sema taken */
r_static
r_void
DECL|function|zfcp_free_low_mem_buffers
id|zfcp_free_low_mem_buffers
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
id|adapter-&gt;pool.status_read_fsf
)paren
id|mempool_destroy
c_func
(paren
id|adapter-&gt;pool.status_read_fsf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;pool.status_read_buf
)paren
id|mempool_destroy
c_func
(paren
id|adapter-&gt;pool.status_read_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;pool.nameserver
)paren
id|mempool_destroy
c_func
(paren
id|adapter-&gt;pool.nameserver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;pool.erp_fsf
)paren
id|mempool_destroy
c_func
(paren
id|adapter-&gt;pool.erp_fsf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|adapter-&gt;pool.fcp_command_fsf
)paren
id|mempool_destroy
c_func
(paren
id|adapter-&gt;pool.fcp_command_fsf
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enqueues an adapter at the end of the adapter list in the driver data.&n; * All adapter internal structures are set up.&n; * Proc-fs entries are also created.&n; *&n; * returns:&t;0             if a new adapter was successfully enqueued&n; *              ZFCP_KNOWN    if an adapter with this devno was already present&n; *&t;&t;-ENOMEM       if alloc failed&n; * locks:&t;config_sema must be held to serialise changes to the adapter list&n; */
r_struct
id|zfcp_adapter
op_star
DECL|function|zfcp_adapter_enqueue
id|zfcp_adapter_enqueue
c_func
(paren
r_struct
id|ccw_device
op_star
id|ccw_device
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_struct
id|zfcp_adapter
op_star
id|adapter
suffix:semicolon
r_char
id|dbf_name
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * Note: It is safe to release the list_lock, as any list changes &n;&t; * are protected by the config_sema, which must be held to get here&n;&t; */
multiline_comment|/* try to allocate new adapter data structure (zeroed) */
id|adapter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|zfcp_adapter
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Allocation of base adapter &quot;
l_string|&quot;structure failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|adapter
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zfcp_adapter
)paren
)paren
suffix:semicolon
id|ccw_device-&gt;handler
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* save ccw_device pointer */
id|adapter-&gt;ccw_device
op_assign
id|ccw_device
suffix:semicolon
id|retval
op_assign
id|zfcp_qdio_allocate_queues
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|queues_alloc_failed
suffix:semicolon
id|retval
op_assign
id|zfcp_qdio_allocate
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|qdio_allocate_failed
suffix:semicolon
id|retval
op_assign
id|zfcp_allocate_low_mem_buffers
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
r_goto
id|failed_low_mem_buffers
suffix:semicolon
multiline_comment|/* set magics */
id|adapter-&gt;common_magic
op_assign
id|ZFCP_MAGIC
suffix:semicolon
id|adapter-&gt;specific_magic
op_assign
id|ZFCP_MAGIC_ADAPTER
suffix:semicolon
multiline_comment|/* initialise reference count stuff */
id|atomic_set
c_func
(paren
op_amp
id|adapter-&gt;refcount
comma
l_int|0
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|adapter-&gt;remove_wq
)paren
suffix:semicolon
multiline_comment|/* initialise list of ports */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|adapter-&gt;port_list_head
)paren
suffix:semicolon
multiline_comment|/* initialise list of ports to be removed */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|adapter-&gt;port_remove_lh
)paren
suffix:semicolon
multiline_comment|/* initialize list of fsf requests */
id|rwlock_init
c_func
(paren
op_amp
id|adapter-&gt;fsf_req_list_lock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|adapter-&gt;fsf_req_list_head
)paren
suffix:semicolon
multiline_comment|/* initialize abort lock */
id|rwlock_init
c_func
(paren
op_amp
id|adapter-&gt;abort_lock
)paren
suffix:semicolon
multiline_comment|/* initialise some erp stuff */
id|init_waitqueue_head
c_func
(paren
op_amp
id|adapter-&gt;erp_thread_wqh
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|adapter-&gt;erp_done_wqh
)paren
suffix:semicolon
multiline_comment|/* initialize lock of associated request queue */
id|rwlock_init
c_func
(paren
op_amp
id|adapter-&gt;request_queue.queue_lock
)paren
suffix:semicolon
multiline_comment|/* intitialise SCSI ER timer */
id|init_timer
c_func
(paren
op_amp
id|adapter-&gt;scsi_er_timer
)paren
suffix:semicolon
multiline_comment|/* set FC service class used per default */
id|adapter-&gt;fc_service_class
op_assign
id|ZFCP_FC_SERVICE_CLASS_DEFAULT
suffix:semicolon
id|sprintf
c_func
(paren
id|adapter-&gt;name
comma
l_string|&quot;%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|ASCEBC
c_func
(paren
id|adapter-&gt;name
comma
id|strlen
c_func
(paren
id|adapter-&gt;name
)paren
)paren
suffix:semicolon
multiline_comment|/* mark adapter unusable as long as sysfs registration is not complete */
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|adapter-&gt;status
)paren
suffix:semicolon
id|adapter-&gt;ccw_device
op_assign
id|ccw_device
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
op_amp
id|ccw_device-&gt;dev
comma
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|zfcp_sysfs_adapter_create_files
c_func
(paren
op_amp
id|ccw_device-&gt;dev
)paren
)paren
r_goto
id|sysfs_failed
suffix:semicolon
macro_line|#ifdef ZFCP_DEBUG_REQUESTS
multiline_comment|/* debug feature area which records fsf request sequence numbers */
id|sprintf
c_func
(paren
id|dbf_name
comma
id|ZFCP_REQ_DBF_NAME
l_string|&quot;0x%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|adapter-&gt;req_dbf
op_assign
id|debug_register
c_func
(paren
id|dbf_name
comma
id|ZFCP_REQ_DBF_INDEX
comma
id|ZFCP_REQ_DBF_AREAS
comma
id|ZFCP_REQ_DBF_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;req_dbf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Out of resources. Request debug feature for &quot;
l_string|&quot;adapter %s could not be generated.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed_req_dbf
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|adapter-&gt;req_dbf
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|adapter-&gt;req_dbf
comma
id|ZFCP_REQ_DBF_LEVEL
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;req_dbf
comma
l_int|1
comma
l_string|&quot;zzz&quot;
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* ZFCP_DEBUG_REQUESTS */
macro_line|#ifdef ZFCP_DEBUG_COMMANDS
multiline_comment|/* debug feature area which records SCSI command failures (hostbyte) */
id|rwlock_init
c_func
(paren
op_amp
id|adapter-&gt;cmd_dbf_lock
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|dbf_name
comma
id|ZFCP_CMD_DBF_NAME
l_string|&quot;%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|adapter-&gt;cmd_dbf
op_assign
id|debug_register
c_func
(paren
id|dbf_name
comma
id|ZFCP_CMD_DBF_INDEX
comma
id|ZFCP_CMD_DBF_AREAS
comma
id|ZFCP_CMD_DBF_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;cmd_dbf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Out of resources. Command debug feature for &quot;
l_string|&quot;adapter %s could not be generated.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed_cmd_dbf
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|adapter-&gt;cmd_dbf
comma
id|ZFCP_CMD_DBF_LEVEL
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* ZFCP_DEBUG_COMMANDS */
macro_line|#ifdef ZFCP_DEBUG_ABORTS
multiline_comment|/* debug feature area which records SCSI command aborts */
id|sprintf
c_func
(paren
id|dbf_name
comma
id|ZFCP_ABORT_DBF_NAME
l_string|&quot;%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|adapter-&gt;abort_dbf
op_assign
id|debug_register
c_func
(paren
id|dbf_name
comma
id|ZFCP_ABORT_DBF_INDEX
comma
id|ZFCP_ABORT_DBF_AREAS
comma
id|ZFCP_ABORT_DBF_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;abort_dbf
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;error: Out of resources. Abort debug feature for &quot;
l_string|&quot;adapter %s could not be generated.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed_abort_dbf
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|adapter-&gt;abort_dbf
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|adapter-&gt;abort_dbf
comma
id|ZFCP_ABORT_DBF_LEVEL
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* ZFCP_DEBUG_ABORTS */
macro_line|#ifdef ZFCP_DEBUG_INCOMING_ELS
multiline_comment|/* debug feature area which records SCSI command aborts */
id|sprintf
c_func
(paren
id|dbf_name
comma
id|ZFCP_IN_ELS_DBF_NAME
l_string|&quot;%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|adapter-&gt;in_els_dbf
op_assign
id|debug_register
c_func
(paren
id|dbf_name
comma
id|ZFCP_IN_ELS_DBF_INDEX
comma
id|ZFCP_IN_ELS_DBF_AREAS
comma
id|ZFCP_IN_ELS_DBF_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;in_els_dbf
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Out of resources. ELS debug feature for &quot;
l_string|&quot;adapter %s could not be generated.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed_in_els_dbf
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|adapter-&gt;in_els_dbf
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|adapter-&gt;in_els_dbf
comma
id|ZFCP_IN_ELS_DBF_LEVEL
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* ZFCP_DEBUG_INCOMING_ELS */
id|sprintf
c_func
(paren
id|dbf_name
comma
id|ZFCP_ERP_DBF_NAME
l_string|&quot;%s&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|adapter-&gt;erp_dbf
op_assign
id|debug_register
c_func
(paren
id|dbf_name
comma
id|ZFCP_ERP_DBF_INDEX
comma
id|ZFCP_ERP_DBF_AREAS
comma
id|ZFCP_ERP_DBF_LENGTH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adapter-&gt;erp_dbf
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Out of resources. ERP debug feature for &quot;
l_string|&quot;adapter %s could not be generated.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|failed_erp_dbf
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|adapter-&gt;erp_dbf
comma
op_amp
id|debug_hex_ascii_view
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|adapter-&gt;erp_dbf
comma
id|ZFCP_ERP_DBF_LEVEL
)paren
suffix:semicolon
id|retval
op_assign
id|zfcp_erp_thread_setup
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: out of resources. &quot;
l_string|&quot;error recovery thread for the adapter %s &quot;
l_string|&quot;could not be started&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
r_goto
id|thread_failed
suffix:semicolon
)brace
multiline_comment|/* put allocated adapter at list tail */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|atomic_clear_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|adapter-&gt;status
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|adapter-&gt;list
comma
op_amp
id|zfcp_data.adapter_list_head
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|zfcp_data.adapters
op_increment
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|thread_failed
suffix:colon
r_if
c_cond
(paren
id|qdio_free
c_func
(paren
id|adapter-&gt;ccw_device
)paren
op_ne
l_int|0
)paren
id|ZFCP_LOG_NORMAL
(paren
l_string|&quot;bug: could not free memory used by data transfer &quot;
l_string|&quot;mechanism for adapter %s&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|debug_unregister
c_func
(paren
id|adapter-&gt;erp_dbf
)paren
suffix:semicolon
id|failed_erp_dbf
suffix:colon
macro_line|#ifdef ZFCP_DEBUG_INCOMING_ELS
id|debug_unregister
c_func
(paren
id|adapter-&gt;in_els_dbf
)paren
suffix:semicolon
id|failed_in_els_dbf
suffix:colon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_ABORTS
id|debug_unregister
c_func
(paren
id|adapter-&gt;abort_dbf
)paren
suffix:semicolon
id|failed_abort_dbf
suffix:colon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_COMMANDS
id|debug_unregister
c_func
(paren
id|adapter-&gt;cmd_dbf
)paren
suffix:semicolon
id|failed_cmd_dbf
suffix:colon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_REQUESTS
id|debug_unregister
c_func
(paren
id|adapter-&gt;req_dbf
)paren
suffix:semicolon
id|failed_req_dbf
suffix:colon
macro_line|#endif
id|zfcp_sysfs_adapter_remove_files
c_func
(paren
op_amp
id|ccw_device-&gt;dev
)paren
suffix:semicolon
id|sysfs_failed
suffix:colon
id|dev_set_drvdata
c_func
(paren
op_amp
id|ccw_device-&gt;dev
comma
l_int|NULL
)paren
suffix:semicolon
id|failed_low_mem_buffers
suffix:colon
id|zfcp_free_low_mem_buffers
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|qdio_free
c_func
(paren
id|ccw_device
)paren
suffix:semicolon
id|qdio_allocate_failed
suffix:colon
id|zfcp_qdio_free_queues
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|queues_alloc_failed
suffix:colon
id|kfree
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|adapter
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
r_return
id|adapter
suffix:semicolon
)brace
multiline_comment|/*&n; * returns:&t;0 - struct zfcp_adapter  data structure successfully removed&n; *&t;&t;!0 - struct zfcp_adapter  data structure could not be removed&n; *&t;&t;&t;(e.g. still used)&n; * locks:&t;adapter list write lock is assumed to be held by caller&n; *              adapter-&gt;fsf_req_list_lock is taken and released within this &n; *              function and must not be held on entry&n; */
r_void
DECL|function|zfcp_adapter_dequeue
id|zfcp_adapter_dequeue
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|zfcp_sysfs_adapter_remove_files
c_func
(paren
op_amp
id|adapter-&gt;ccw_device-&gt;dev
)paren
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
op_amp
id|adapter-&gt;ccw_device-&gt;dev
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* sanity check: no pending FSF requests */
id|read_lock_irqsave
c_func
(paren
op_amp
id|adapter-&gt;fsf_req_list_lock
comma
id|flags
)paren
suffix:semicolon
id|retval
op_assign
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|adapter-&gt;fsf_req_list_head
)paren
suffix:semicolon
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|adapter-&gt;fsf_req_list_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;bug: Adapter %s is still in use, &quot;
l_string|&quot;%i requests are still outstanding &quot;
l_string|&quot;(debug info 0x%lx)&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|adapter-&gt;fsf_reqs_active
)paren
comma
(paren
r_int
r_int
)paren
id|adapter
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* remove specified adapter data structure from list */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|adapter-&gt;list
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
multiline_comment|/* decrease number of adapters in list */
id|zfcp_data.adapters
op_decrement
suffix:semicolon
id|ZFCP_LOG_TRACE
c_func
(paren
l_string|&quot;adapter 0x%lx removed from list, &quot;
l_string|&quot;%i adapters still in list&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|adapter
comma
id|zfcp_data.adapters
)paren
suffix:semicolon
id|retval
op_assign
id|zfcp_erp_thread_kill
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|retval
op_or_assign
id|qdio_free
c_func
(paren
id|adapter-&gt;ccw_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
id|ZFCP_LOG_NORMAL
(paren
l_string|&quot;bug: could not free memory used by data transfer &quot;
l_string|&quot;mechanism for adapter %s&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|debug_unregister
c_func
(paren
id|adapter-&gt;erp_dbf
)paren
suffix:semicolon
macro_line|#ifdef ZFCP_DEBUG_REQUESTS
id|debug_unregister
c_func
(paren
id|adapter-&gt;req_dbf
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_COMMANDS
id|debug_unregister
c_func
(paren
id|adapter-&gt;cmd_dbf
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_ABORTS
id|debug_unregister
c_func
(paren
id|adapter-&gt;abort_dbf
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef ZFCP_DEBUG_INCOMING_ELS
id|debug_unregister
c_func
(paren
id|adapter-&gt;in_els_dbf
)paren
suffix:semicolon
macro_line|#endif
id|zfcp_free_low_mem_buffers
c_func
(paren
id|adapter
)paren
suffix:semicolon
multiline_comment|/* free memory of adapter data structure and queues */
id|zfcp_qdio_free_queues
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|ZFCP_LOG_TRACE
c_func
(paren
l_string|&quot;Freeing adapter structure.&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|adapter
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Enqueues a remote port at the end of the port list.&n; * All port internal structures are set-up and the proc-fs entry is also &n; * allocated. Some SCSI-stack structures are modified for the port.&n; *&n; * returns:&t;0            if a new port was successfully enqueued&n; *              ZFCP_KNOWN   if a port with the requested wwpn already exists&n; *              -ENOMEM      if allocation failed&n; *              -EINVAL      if at least one of the specified parameters was wrong&n; * locks:       config_sema must be held to serialise changes to the port list&n; *              within this function (must not be held on entry)&n; */
r_struct
id|zfcp_port
op_star
DECL|function|zfcp_port_enqueue
id|zfcp_port_enqueue
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
id|wwn_t
id|wwpn
comma
id|u32
id|status
)paren
(brace
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
r_int
id|check_scsi_id
suffix:semicolon
r_int
id|check_wwpn
suffix:semicolon
id|check_scsi_id
op_assign
op_logical_neg
(paren
id|status
op_amp
id|ZFCP_STATUS_PORT_NO_SCSI_ID
)paren
suffix:semicolon
id|check_wwpn
op_assign
op_logical_neg
(paren
id|status
op_amp
id|ZFCP_STATUS_PORT_NO_WWPN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * check that there is no port with this WWPN already in list&n;&t; */
r_if
c_cond
(paren
id|check_wwpn
)paren
(brace
id|read_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|port
op_assign
id|zfcp_get_port_by_wwpn
c_func
(paren
id|adapter
comma
id|wwpn
)paren
suffix:semicolon
id|read_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
id|port
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|zfcp_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|port
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|zfcp_port
)paren
)paren
suffix:semicolon
multiline_comment|/* initialise reference count stuff */
id|atomic_set
c_func
(paren
op_amp
id|port-&gt;refcount
comma
l_int|0
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|port-&gt;remove_wq
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|port-&gt;unit_list_head
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|port-&gt;unit_remove_lh
)paren
suffix:semicolon
id|port-&gt;adapter
op_assign
id|adapter
suffix:semicolon
r_if
c_cond
(paren
id|check_scsi_id
)paren
id|port-&gt;scsi_id
op_assign
id|adapter-&gt;max_scsi_id
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|check_wwpn
)paren
id|port-&gt;wwpn
op_assign
id|wwpn
suffix:semicolon
id|atomic_set_mask
c_func
(paren
id|status
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
id|port-&gt;common_magic
op_assign
id|ZFCP_MAGIC
suffix:semicolon
id|port-&gt;specific_magic
op_assign
id|ZFCP_MAGIC_PORT
suffix:semicolon
multiline_comment|/* setup for sysfs registration */
r_if
c_cond
(paren
id|status
op_amp
id|ZFCP_STATUS_PORT_NAMESERVER
)paren
id|snprintf
c_func
(paren
id|port-&gt;sysfs_device.bus_id
comma
id|BUS_ID_SIZE
comma
l_string|&quot;nameserver&quot;
)paren
suffix:semicolon
r_else
id|snprintf
c_func
(paren
id|port-&gt;sysfs_device.bus_id
comma
id|BUS_ID_SIZE
comma
l_string|&quot;0x%016llx&quot;
comma
id|wwpn
)paren
suffix:semicolon
id|port-&gt;sysfs_device.parent
op_assign
op_amp
id|adapter-&gt;ccw_device-&gt;dev
suffix:semicolon
id|port-&gt;sysfs_device.release
op_assign
id|zfcp_sysfs_port_release
suffix:semicolon
id|dev_set_drvdata
c_func
(paren
op_amp
id|port-&gt;sysfs_device
comma
id|port
)paren
suffix:semicolon
multiline_comment|/* mark port unusable as long as sysfs registration is not complete */
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device_register
c_func
(paren
op_amp
id|port-&gt;sysfs_device
)paren
)paren
(brace
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|zfcp_sysfs_port_create_files
c_func
(paren
op_amp
id|port-&gt;sysfs_device
comma
id|status
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * failed to create all sysfs attributes, therefore the port&n;&t;&t; * must be put on the port_remove listhead of the adapter&n;&t;&t; * where the release function expects it.&n;&t;&t; */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|port-&gt;list
comma
op_amp
id|adapter-&gt;port_remove_lh
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
op_amp
id|port-&gt;sysfs_device
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|check_scsi_id
)paren
(brace
multiline_comment|/*&n;&t;&t; * update max. SCSI ID of remote ports attached to&n;&t;&t; * &quot;parent&quot; adapter if necessary&n;&t;&t; * (do not care about the adapters own SCSI ID)&n;&t;&t; */
id|adapter-&gt;max_scsi_id
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; * update max. SCSI ID of remote ports attached to&n;&t;&t; * &quot;parent&quot; host (SCSI stack) if necessary&n;&t;&t; */
r_if
c_cond
(paren
id|adapter-&gt;scsi_host
op_logical_and
(paren
id|adapter-&gt;scsi_host-&gt;max_id
OL
id|adapter-&gt;max_scsi_id
op_plus
l_int|1
)paren
)paren
id|adapter-&gt;scsi_host-&gt;max_id
op_assign
id|adapter-&gt;max_scsi_id
op_plus
l_int|1
suffix:semicolon
)brace
id|zfcp_port_get
c_func
(paren
id|port
)paren
suffix:semicolon
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|atomic_clear_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_RUNNING
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|port-&gt;list
comma
op_amp
id|adapter-&gt;port_list_head
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|adapter-&gt;ports
op_increment
suffix:semicolon
id|zfcp_adapter_get
c_func
(paren
id|adapter
)paren
suffix:semicolon
r_return
id|port
suffix:semicolon
)brace
multiline_comment|/*&n; * returns:&t;0 - struct zfcp_port data structure successfully removed&n; *&t;&t;!0 - struct zfcp_port data structure could not be removed&n; *&t;&t;&t;(e.g. still used)&n; * locks :&t;port list write lock is assumed to be held by caller&n; */
r_void
DECL|function|zfcp_port_dequeue
id|zfcp_port_dequeue
c_func
(paren
r_struct
id|zfcp_port
op_star
id|port
)paren
(brace
multiline_comment|/* remove specified port from list */
id|write_lock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|port-&gt;list
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|zfcp_data.config_lock
)paren
suffix:semicolon
id|port-&gt;adapter-&gt;ports
op_decrement
suffix:semicolon
id|zfcp_adapter_put
c_func
(paren
id|port-&gt;adapter
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Enqueues a nameserver port */
r_int
DECL|function|zfcp_nameserver_enqueue
id|zfcp_nameserver_enqueue
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
)paren
(brace
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
multiline_comment|/* generate port structure */
id|port
op_assign
id|zfcp_port_enqueue
c_func
(paren
id|adapter
comma
l_int|0
comma
id|ZFCP_STATUS_PORT_NAMESERVER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Could not establish a connection to the &quot;
l_string|&quot;fabric name server connected to the &quot;
l_string|&quot;adapter %s&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/* set special D_ID */
id|port-&gt;d_id
op_assign
id|ZFCP_DID_NAMESERVER
suffix:semicolon
id|adapter-&gt;nameserver_port
op_assign
id|port
suffix:semicolon
id|zfcp_port_put
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|ZFCP_LOG_AREA
macro_line|#undef ZFCP_LOG_AREA
DECL|macro|ZFCP_LOG_AREA_PREFIX
macro_line|#undef ZFCP_LOG_AREA_PREFIX
multiline_comment|/****************************************************************/
multiline_comment|/******* Fibre Channel Standard related Functions  **************/
multiline_comment|/****************************************************************/
DECL|macro|ZFCP_LOG_AREA
mdefine_line|#define ZFCP_LOG_AREA                   ZFCP_LOG_AREA_FC
DECL|macro|ZFCP_LOG_AREA_PREFIX
mdefine_line|#define ZFCP_LOG_AREA_PREFIX            ZFCP_LOG_AREA_PREFIX_FC
r_void
DECL|function|zfcp_fsf_incoming_els_rscn
id|zfcp_fsf_incoming_els_rscn
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
)paren
(brace
r_struct
id|fcp_rscn_head
op_star
id|fcp_rscn_head
suffix:semicolon
r_struct
id|fcp_rscn_element
op_star
id|fcp_rscn_element
suffix:semicolon
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
id|u16
id|i
suffix:semicolon
id|u16
id|no_entries
suffix:semicolon
id|u32
id|range_mask
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|fcp_rscn_head
op_assign
(paren
r_struct
id|fcp_rscn_head
op_star
)paren
id|status_buffer-&gt;payload
suffix:semicolon
id|fcp_rscn_element
op_assign
(paren
r_struct
id|fcp_rscn_element
op_star
)paren
id|status_buffer-&gt;payload
suffix:semicolon
multiline_comment|/* see FC-FS */
id|no_entries
op_assign
(paren
id|fcp_rscn_head-&gt;payload_len
op_div
l_int|4
)paren
suffix:semicolon
id|zfcp_in_els_dbf_event
c_func
(paren
id|adapter
comma
l_string|&quot;##rscn&quot;
comma
id|status_buffer
comma
id|fcp_rscn_head-&gt;payload_len
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
l_string|&quot;unsol_els_rscn:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|no_entries
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* skip head and start with 1st element */
id|fcp_rscn_element
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|fcp_rscn_element-&gt;addr_format
)paren
(brace
r_case
id|ZFCP_PORT_ADDRESS
suffix:colon
id|ZFCP_LOG_FLAGS
c_func
(paren
l_int|1
comma
l_string|&quot;ZFCP_PORT_ADDRESS&bslash;n&quot;
)paren
suffix:semicolon
id|range_mask
op_assign
id|ZFCP_PORTS_RANGE_PORT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ZFCP_AREA_ADDRESS
suffix:colon
id|ZFCP_LOG_FLAGS
c_func
(paren
l_int|1
comma
l_string|&quot;ZFCP_AREA_ADDRESS&bslash;n&quot;
)paren
suffix:semicolon
id|range_mask
op_assign
id|ZFCP_PORTS_RANGE_AREA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ZFCP_DOMAIN_ADDRESS
suffix:colon
id|ZFCP_LOG_FLAGS
c_func
(paren
l_int|1
comma
l_string|&quot;ZFCP_DOMAIN_ADDRESS&bslash;n&quot;
)paren
suffix:semicolon
id|range_mask
op_assign
id|ZFCP_PORTS_RANGE_DOMAIN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ZFCP_FABRIC_ADDRESS
suffix:colon
id|ZFCP_LOG_FLAGS
c_func
(paren
l_int|1
comma
l_string|&quot;ZFCP_FABRIC_ADDRESS&bslash;n&quot;
)paren
suffix:semicolon
id|range_mask
op_assign
id|ZFCP_PORTS_RANGE_FABRIC
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;Received RSCN with unknown &quot;
l_string|&quot;address format.&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|read_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|port
comma
op_amp
id|adapter-&gt;port_list_head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|atomic_test_mask
(paren
id|ZFCP_STATUS_PORT_NAMESERVER
comma
op_amp
id|port-&gt;status
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* Do we know this port? If not skip it. */
r_if
c_cond
(paren
op_logical_neg
id|atomic_test_mask
(paren
id|ZFCP_STATUS_PORT_DID_DID
comma
op_amp
id|port-&gt;status
)paren
)paren
(brace
id|ZFCP_LOG_INFO
(paren
l_string|&quot;Received state change notification.&quot;
l_string|&quot;Trying to open the port with wwpn &quot;
l_string|&quot;0x%Lx. Hope it&squot;s there now.&bslash;n&quot;
comma
id|port-&gt;wwpn
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
l_string|&quot;unsol_els_rscnu:&quot;
)paren
suffix:semicolon
id|zfcp_erp_port_reopen
c_func
(paren
id|port
comma
id|ZFCP_STATUS_COMMON_ERP_FAILED
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * FIXME: race: d_id might being invalidated&n;&t;&t;&t; * (...DID_DID reset)&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|port-&gt;d_id
op_amp
id|range_mask
)paren
op_eq
(paren
id|fcp_rscn_element-&gt;nport_did
op_amp
id|range_mask
)paren
)paren
(brace
id|ZFCP_LOG_TRACE
c_func
(paren
l_string|&quot;reopen did 0x%x&bslash;n&quot;
comma
id|fcp_rscn_element-&gt;nport_did
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * Unfortunately, an RSCN does not specify the&n;&t;&t;&t;&t; * type of change a target underwent. We assume&n;&t;&t;&t;&t; * that it makes sense to reopen the link.&n;&t;&t;&t;&t; * FIXME: Shall we try to find out more about&n;&t;&t;&t;&t; * the target and link state before closing it?&n;&t;&t;&t;&t; * How to accomplish this? (nameserver?)&n;&t;&t;&t;&t; * Where would such code be put in?&n;&t;&t;&t;&t; * (inside or outside erp)&n;&t;&t;&t;&t; */
id|ZFCP_LOG_INFO
(paren
l_string|&quot;Received state change notification.&quot;
l_string|&quot;Trying to reopen the port with wwpn &quot;
l_string|&quot;0x%Lx.&bslash;n&quot;
comma
id|port-&gt;wwpn
)paren
suffix:semicolon
id|debug_text_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
l_string|&quot;unsol_els_rscnk:&quot;
)paren
suffix:semicolon
id|zfcp_erp_port_reopen
c_func
(paren
id|port
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|zfcp_fsf_incoming_els_plogi
id|zfcp_fsf_incoming_els_plogi
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
)paren
(brace
id|logi
op_star
id|els_logi
op_assign
(paren
id|logi
op_star
)paren
id|status_buffer-&gt;payload
suffix:semicolon
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|zfcp_in_els_dbf_event
c_func
(paren
id|adapter
comma
l_string|&quot;##plogi&quot;
comma
id|status_buffer
comma
l_int|28
)paren
suffix:semicolon
id|read_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|port
comma
op_amp
id|adapter-&gt;port_list_head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;wwpn
op_eq
(paren
op_star
(paren
id|wwn_t
op_star
)paren
op_amp
id|els_logi-&gt;nport_wwn
)paren
)paren
r_break
suffix:semicolon
)brace
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
op_logical_or
(paren
id|port-&gt;wwpn
op_ne
(paren
op_star
(paren
id|wwn_t
op_star
)paren
op_amp
id|els_logi-&gt;nport_wwn
)paren
)paren
)paren
(brace
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;Re-open port indication received &quot;
l_string|&quot;for the non-existing port with D_ID &quot;
l_string|&quot;0x%3.3x, on the adapter &quot;
l_string|&quot;%s. Ignored.&bslash;n&quot;
comma
id|status_buffer-&gt;d_id
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|debug_text_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
l_string|&quot;unsol_els_plogi:&quot;
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
op_amp
id|els_logi-&gt;nport_wwn
comma
l_int|8
)paren
suffix:semicolon
id|zfcp_erp_port_forced_reopen
c_func
(paren
id|port
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|zfcp_fsf_incoming_els_logo
id|zfcp_fsf_incoming_els_logo
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
)paren
(brace
r_struct
id|fcp_logo
op_star
id|els_logo
op_assign
(paren
r_struct
id|fcp_logo
op_star
)paren
id|status_buffer-&gt;payload
suffix:semicolon
r_struct
id|zfcp_port
op_star
id|port
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|zfcp_in_els_dbf_event
c_func
(paren
id|adapter
comma
l_string|&quot;##logo&quot;
comma
id|status_buffer
comma
l_int|16
)paren
suffix:semicolon
id|read_lock_irqsave
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|port
comma
op_amp
id|adapter-&gt;port_list_head
comma
id|list
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;wwpn
op_eq
id|els_logo-&gt;nport_wwpn
)paren
r_break
suffix:semicolon
)brace
id|read_unlock_irqrestore
c_func
(paren
op_amp
id|zfcp_data.config_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
op_logical_or
(paren
id|port-&gt;wwpn
op_ne
id|els_logo-&gt;nport_wwpn
)paren
)paren
(brace
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;Re-open port indication received &quot;
l_string|&quot;for the non-existing port with D_ID &quot;
l_string|&quot;0x%3.3x, on the adapter &quot;
l_string|&quot;%s. Ignored.&bslash;n&quot;
comma
id|status_buffer-&gt;d_id
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|debug_text_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
l_string|&quot;unsol_els_logo:&quot;
)paren
suffix:semicolon
id|debug_event
c_func
(paren
id|adapter-&gt;erp_dbf
comma
l_int|1
comma
op_amp
id|els_logo-&gt;nport_wwpn
comma
l_int|8
)paren
suffix:semicolon
id|zfcp_erp_port_forced_reopen
c_func
(paren
id|port
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|zfcp_fsf_incoming_els_unknown
id|zfcp_fsf_incoming_els_unknown
c_func
(paren
r_struct
id|zfcp_adapter
op_star
id|adapter
comma
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
)paren
(brace
id|zfcp_in_els_dbf_event
c_func
(paren
id|adapter
comma
l_string|&quot;##undef&quot;
comma
id|status_buffer
comma
l_int|24
)paren
suffix:semicolon
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;warning: Unknown incoming ELS (0x%x) received &quot;
l_string|&quot;for the adapter %s&bslash;n&quot;
comma
op_star
(paren
id|u32
op_star
)paren
(paren
id|status_buffer-&gt;payload
)paren
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|zfcp_fsf_incoming_els
id|zfcp_fsf_incoming_els
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
)paren
(brace
r_struct
id|fsf_status_read_buffer
op_star
id|status_buffer
suffix:semicolon
id|u32
id|els_type
suffix:semicolon
r_struct
id|zfcp_adapter
op_star
id|adapter
suffix:semicolon
id|status_buffer
op_assign
id|fsf_req-&gt;data.status_read.buffer
suffix:semicolon
id|els_type
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|status_buffer-&gt;payload
)paren
suffix:semicolon
id|adapter
op_assign
id|fsf_req-&gt;adapter
suffix:semicolon
r_if
c_cond
(paren
id|els_type
op_eq
id|LS_PLOGI
)paren
id|zfcp_fsf_incoming_els_plogi
c_func
(paren
id|adapter
comma
id|status_buffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|els_type
op_eq
id|LS_LOGO
)paren
id|zfcp_fsf_incoming_els_logo
c_func
(paren
id|adapter
comma
id|status_buffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|els_type
op_amp
l_int|0xffff0000
)paren
op_eq
id|LS_RSCN
)paren
multiline_comment|/* we are only concerned with the command, not the length */
id|zfcp_fsf_incoming_els_rscn
c_func
(paren
id|adapter
comma
id|status_buffer
)paren
suffix:semicolon
r_else
id|zfcp_fsf_incoming_els_unknown
c_func
(paren
id|adapter
comma
id|status_buffer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * function:&t;zfcp_release_nameserver_buffers&n; *&n; * purpose:&t;&n; *&n; * returns:&n; */
r_static
r_void
DECL|function|zfcp_release_nameserver_buffers
id|zfcp_release_nameserver_buffers
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
)paren
(brace
r_struct
id|zfcp_adapter
op_star
id|adapter
op_assign
id|fsf_req-&gt;adapter
suffix:semicolon
r_void
op_star
id|buffer
op_assign
id|fsf_req-&gt;data.send_generic.outbuf
suffix:semicolon
multiline_comment|/* FIXME: not sure about appeal of this new flag (martin) */
r_if
c_cond
(paren
id|fsf_req-&gt;status
op_amp
id|ZFCP_STATUS_FSFREQ_POOLBUF
)paren
id|mempool_free
c_func
(paren
id|buffer
comma
id|adapter-&gt;pool.nameserver
)paren
suffix:semicolon
r_else
id|kfree
c_func
(paren
id|buffer
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * function:&t;zfcp_get_nameserver_buffers&n; *&n; * purpose:&t;&n; *&n; * returns:&n; *&n; * locks:       fsf_request_list_lock is held when doing buffer pool &n; *              operations&n; */
r_static
r_int
DECL|function|zfcp_get_nameserver_buffers
id|zfcp_get_nameserver_buffers
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
)paren
(brace
r_struct
id|zfcp_send_generic
op_star
id|data
op_assign
op_amp
id|fsf_req-&gt;data.send_generic
suffix:semicolon
r_struct
id|zfcp_adapter
op_star
id|adapter
op_assign
id|fsf_req-&gt;adapter
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|data-&gt;outbuf
op_assign
id|kmalloc
c_func
(paren
l_int|2
op_star
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;outbuf
)paren
(brace
id|memset
c_func
(paren
id|data-&gt;outbuf
comma
l_int|0
comma
l_int|2
op_star
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;Out of memory. Could not allocate at &quot;
l_string|&quot;least one of the buffers &quot;
l_string|&quot;required for a name-server request on the&quot;
l_string|&quot;adapter %s directly.. trying emergency pool&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|data-&gt;outbuf
op_assign
id|mempool_alloc
c_func
(paren
id|adapter-&gt;pool.nameserver
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;outbuf
)paren
(brace
id|ZFCP_LOG_DEBUG
(paren
l_string|&quot;Out of memory. Could not get emergency &quot;
l_string|&quot;buffer required for a name-server request &quot;
l_string|&quot;on the adapter %s. All buffers are in &quot;
l_string|&quot;use.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|adapter
)paren
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|data-&gt;outbuf
comma
l_int|0
comma
l_int|2
op_star
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
suffix:semicolon
id|fsf_req-&gt;status
op_or_assign
id|ZFCP_STATUS_FSFREQ_POOLBUF
suffix:semicolon
)brace
id|data-&gt;outbuf_length
op_assign
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
suffix:semicolon
id|data-&gt;inbuf_length
op_assign
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
suffix:semicolon
id|data-&gt;inbuf
op_assign
(paren
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|data-&gt;outbuf
op_plus
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * function:&t;zfcp_nameserver_request&n; *&n; * purpose:&t;&n; *&n; * returns:&n; */
r_int
DECL|function|zfcp_nameserver_request
id|zfcp_nameserver_request
c_func
(paren
r_struct
id|zfcp_erp_action
op_star
id|erp_action
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_struct
id|fc_ct_iu
op_star
id|fc_ct_iu
suffix:semicolon
r_int
r_int
id|lock_flags
suffix:semicolon
multiline_comment|/* setup new FSF request */
id|retval
op_assign
id|zfcp_fsf_req_create
c_func
(paren
id|erp_action-&gt;adapter
comma
id|FSF_QTCB_SEND_GENERIC
comma
op_amp
id|lock_flags
comma
id|ZFCP_WAIT_FOR_SBAL
op_or
id|ZFCP_REQ_AUTO_CLEANUP
comma
op_amp
(paren
id|erp_action-&gt;fsf_req
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Out of resources. Could not create a &quot;
l_string|&quot;nameserver registration request for &quot;
l_string|&quot;adapter %s.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|erp_action-&gt;adapter
)paren
)paren
suffix:semicolon
r_goto
id|failed_req
suffix:semicolon
)brace
id|retval
op_assign
id|zfcp_get_nameserver_buffers
c_func
(paren
id|erp_action-&gt;fsf_req
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
OL
l_int|0
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Out of memory. Could not allocate one of &quot;
l_string|&quot;the buffers required for a nameserver request &quot;
l_string|&quot;on adapter %s.&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|erp_action-&gt;adapter
)paren
)paren
suffix:semicolon
r_goto
id|failed_buffers
suffix:semicolon
)brace
multiline_comment|/* setup name-server request in first page */
id|fc_ct_iu
op_assign
(paren
r_struct
id|fc_ct_iu
op_star
)paren
id|erp_action-&gt;fsf_req-&gt;data.send_generic.outbuf
suffix:semicolon
id|fc_ct_iu-&gt;revision
op_assign
id|ZFCP_CT_REVISION
suffix:semicolon
id|fc_ct_iu-&gt;gs_type
op_assign
id|ZFCP_CT_DIRECTORY_SERVICE
suffix:semicolon
id|fc_ct_iu-&gt;gs_subtype
op_assign
id|ZFCP_CT_NAME_SERVER
suffix:semicolon
id|fc_ct_iu-&gt;options
op_assign
id|ZFCP_CT_SYNCHRONOUS
suffix:semicolon
id|fc_ct_iu-&gt;cmd_rsp_code
op_assign
id|ZFCP_CT_GID_PN
suffix:semicolon
id|fc_ct_iu-&gt;max_res_size
op_assign
id|ZFCP_CT_MAX_SIZE
suffix:semicolon
id|fc_ct_iu-&gt;data.wwpn
op_assign
id|erp_action-&gt;port-&gt;wwpn
suffix:semicolon
id|erp_action-&gt;fsf_req-&gt;data.send_generic.handler
op_assign
id|zfcp_nameserver_request_handler
suffix:semicolon
id|erp_action-&gt;fsf_req-&gt;data.send_generic.handler_data
op_assign
(paren
r_int
r_int
)paren
id|erp_action-&gt;port
suffix:semicolon
id|erp_action-&gt;fsf_req-&gt;data.send_generic.port
op_assign
id|erp_action-&gt;adapter-&gt;nameserver_port
suffix:semicolon
id|erp_action-&gt;fsf_req-&gt;erp_action
op_assign
id|erp_action
suffix:semicolon
multiline_comment|/* send this one */
id|retval
op_assign
id|zfcp_fsf_send_generic
c_func
(paren
id|erp_action-&gt;fsf_req
comma
id|ZFCP_NAMESERVER_TIMEOUT
comma
op_amp
id|lock_flags
comma
op_amp
id|erp_action-&gt;timer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
)paren
(brace
id|ZFCP_LOG_INFO
c_func
(paren
l_string|&quot;error: Could not send a&quot;
l_string|&quot;nameserver request command to adapter %s&bslash;n&quot;
comma
id|zfcp_get_busid_by_adapter
c_func
(paren
id|erp_action-&gt;adapter
)paren
)paren
suffix:semicolon
r_goto
id|failed_send
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
id|failed_send
suffix:colon
id|zfcp_release_nameserver_buffers
c_func
(paren
id|erp_action-&gt;fsf_req
)paren
suffix:semicolon
id|failed_buffers
suffix:colon
id|zfcp_fsf_req_free
c_func
(paren
id|erp_action-&gt;fsf_req
)paren
suffix:semicolon
id|erp_action-&gt;fsf_req
op_assign
l_int|NULL
suffix:semicolon
id|failed_req
suffix:colon
id|out
suffix:colon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|erp_action-&gt;adapter-&gt;request_queue.queue_lock
comma
id|lock_flags
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/*&n; * function:&t;zfcp_nameserver_request_handler&n; *&n; * purpose:&t;&n; *&n; * returns:&n; */
r_static
r_void
DECL|function|zfcp_nameserver_request_handler
id|zfcp_nameserver_request_handler
c_func
(paren
r_struct
id|zfcp_fsf_req
op_star
id|fsf_req
)paren
(brace
r_struct
id|fc_ct_iu
op_star
id|fc_ct_iu_resp
op_assign
(paren
r_struct
id|fc_ct_iu
op_star
)paren
(paren
id|fsf_req-&gt;data.send_generic.inbuf
)paren
suffix:semicolon
r_struct
id|fc_ct_iu
op_star
id|fc_ct_iu_req
op_assign
(paren
r_struct
id|fc_ct_iu
op_star
)paren
(paren
id|fsf_req-&gt;data.send_generic.outbuf
)paren
suffix:semicolon
r_struct
id|zfcp_port
op_star
id|port
op_assign
(paren
r_struct
id|zfcp_port
op_star
)paren
id|fsf_req-&gt;data.send_generic.handler_data
suffix:semicolon
r_if
c_cond
(paren
id|fc_ct_iu_resp-&gt;revision
op_ne
id|ZFCP_CT_REVISION
)paren
r_goto
id|failed
suffix:semicolon
r_if
c_cond
(paren
id|fc_ct_iu_resp-&gt;gs_type
op_ne
id|ZFCP_CT_DIRECTORY_SERVICE
)paren
r_goto
id|failed
suffix:semicolon
r_if
c_cond
(paren
id|fc_ct_iu_resp-&gt;gs_subtype
op_ne
id|ZFCP_CT_NAME_SERVER
)paren
r_goto
id|failed
suffix:semicolon
r_if
c_cond
(paren
id|fc_ct_iu_resp-&gt;options
op_ne
id|ZFCP_CT_SYNCHRONOUS
)paren
r_goto
id|failed
suffix:semicolon
r_if
c_cond
(paren
id|fc_ct_iu_resp-&gt;cmd_rsp_code
op_ne
id|ZFCP_CT_ACCEPT
)paren
(brace
multiline_comment|/* FIXME: do we need some specific erp entry points */
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_PORT_INVALID_WWPN
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* paranoia */
r_if
c_cond
(paren
id|fc_ct_iu_req-&gt;data.wwpn
op_ne
id|port-&gt;wwpn
)paren
(brace
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;bug: Port WWPN returned by nameserver lookup &quot;
l_string|&quot;does not correspond to &quot;
l_string|&quot;the expected value on the adapter %s. &quot;
l_string|&quot;(debug info 0x%Lx, 0x%Lx)&bslash;n&quot;
comma
id|zfcp_get_busid_by_port
c_func
(paren
id|port
)paren
comma
id|port-&gt;wwpn
comma
id|fc_ct_iu_req-&gt;data.wwpn
)paren
suffix:semicolon
r_goto
id|failed
suffix:semicolon
)brace
multiline_comment|/* looks like a valid d_id */
id|port-&gt;d_id
op_assign
id|ZFCP_DID_MASK
op_amp
id|fc_ct_iu_resp-&gt;data.d_id
suffix:semicolon
id|atomic_set_mask
c_func
(paren
id|ZFCP_STATUS_PORT_DID_DID
comma
op_amp
id|port-&gt;status
)paren
suffix:semicolon
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;busid %s:  WWPN=0x%Lx ---&gt; D_ID=0x%6.6x&bslash;n&quot;
comma
id|zfcp_get_busid_by_port
c_func
(paren
id|port
)paren
comma
id|port-&gt;wwpn
comma
(paren
r_int
r_int
)paren
id|port-&gt;d_id
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|failed
suffix:colon
id|ZFCP_LOG_NORMAL
c_func
(paren
l_string|&quot;warning: WWPN 0x%Lx not found by nameserver lookup &quot;
l_string|&quot;using the adapter %s&bslash;n&quot;
comma
id|port-&gt;wwpn
comma
id|zfcp_get_busid_by_port
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
id|ZFCP_LOG_DEBUG
c_func
(paren
l_string|&quot;CT IUs do not match:&bslash;n&quot;
)paren
suffix:semicolon
id|ZFCP_HEX_DUMP
c_func
(paren
id|ZFCP_LOG_LEVEL_DEBUG
comma
(paren
r_char
op_star
)paren
id|fc_ct_iu_req
comma
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
suffix:semicolon
id|ZFCP_HEX_DUMP
c_func
(paren
id|ZFCP_LOG_LEVEL_DEBUG
comma
(paren
r_char
op_star
)paren
id|fc_ct_iu_resp
comma
r_sizeof
(paren
r_struct
id|fc_ct_iu
)paren
)paren
suffix:semicolon
id|out
suffix:colon
id|zfcp_release_nameserver_buffers
c_func
(paren
id|fsf_req
)paren
suffix:semicolon
)brace
DECL|macro|ZFCP_LOG_AREA
macro_line|#undef ZFCP_LOG_AREA
DECL|macro|ZFCP_LOG_AREA_PREFIX
macro_line|#undef ZFCP_LOG_AREA_PREFIX
eof
