multiline_comment|/*&n; * linux/drivers/s390/scsi/zfcp_sysfs_unit.c&n; *&n; * FCP adapter driver for IBM eServer zSeries&n; *&n; * sysfs unit related routines&n; *&n; * (C) Copyright IBM Corp. 2003, 2004&n; *&n; * Authors:&n; *      Martin Peschke &lt;mpeschke@de.ibm.com&gt;&n; *&t;Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;&n; *      Andreas Herrmann &lt;aherrman@de.ibm.com&gt;&n; *      Volker Sameske &lt;sameske@de.ibm.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
DECL|macro|ZFCP_SYSFS_UNIT_C_REVISION
mdefine_line|#define ZFCP_SYSFS_UNIT_C_REVISION &quot;$Revision: 1.30 $&quot;
macro_line|#include &quot;zfcp_ext.h&quot;
DECL|macro|ZFCP_LOG_AREA
mdefine_line|#define ZFCP_LOG_AREA                   ZFCP_LOG_AREA_CONFIG
multiline_comment|/**&n; * zfcp_sysfs_unit_release - gets called when a struct device unit is released&n; * @dev: pointer to belonging device&n; */
r_void
DECL|function|zfcp_sysfs_unit_release
id|zfcp_sysfs_unit_release
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * ZFCP_DEFINE_UNIT_ATTR&n; * @_name:   name of show attribute&n; * @_format: format string&n; * @_value:  value to print&n; *&n; * Generates attribute for a unit.&n; */
DECL|macro|ZFCP_DEFINE_UNIT_ATTR
mdefine_line|#define ZFCP_DEFINE_UNIT_ATTR(_name, _format, _value)                    &bslash;&n;static ssize_t zfcp_sysfs_unit_##_name##_show(struct device *dev,        &bslash;&n;                                              char *buf)                 &bslash;&n;{                                                                        &bslash;&n;        struct zfcp_unit *unit;                                          &bslash;&n;                                                                         &bslash;&n;        unit = dev_get_drvdata(dev);                                     &bslash;&n;        return sprintf(buf, _format, _value);                            &bslash;&n;}                                                                        &bslash;&n;                                                                         &bslash;&n;static DEVICE_ATTR(_name, S_IRUGO, zfcp_sysfs_unit_##_name##_show, NULL);
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|status
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|unit-&gt;status
)paren
)paren
suffix:semicolon
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|scsi_lun
comma
l_string|&quot;0x%x&bslash;n&quot;
comma
id|unit-&gt;scsi_lun
)paren
suffix:semicolon
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|in_recovery
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|atomic_test_mask
(paren
id|ZFCP_STATUS_COMMON_ERP_INUSE
comma
op_amp
id|unit-&gt;status
)paren
)paren
suffix:semicolon
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|access_denied
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|atomic_test_mask
(paren
id|ZFCP_STATUS_COMMON_ACCESS_DENIED
comma
op_amp
id|unit-&gt;status
)paren
)paren
suffix:semicolon
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|access_shared
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|atomic_test_mask
(paren
id|ZFCP_STATUS_UNIT_SHARED
comma
op_amp
id|unit-&gt;status
)paren
)paren
suffix:semicolon
id|ZFCP_DEFINE_UNIT_ATTR
c_func
(paren
id|access_readonly
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|atomic_test_mask
(paren
id|ZFCP_STATUS_UNIT_READONLY
comma
op_amp
id|unit-&gt;status
)paren
)paren
suffix:semicolon
multiline_comment|/**&n; * zfcp_sysfs_unit_failed_store - failed state of unit&n; * @dev: pointer to belonging device&n; * @buf: pointer to input buffer&n; * @count: number of bytes in buffer&n; *&n; * Store function of the &quot;failed&quot; attribute of a unit.&n; * If a &quot;0&quot; gets written to &quot;failed&quot;, error recovery will be&n; * started for the belonging unit.&n; */
r_static
id|ssize_t
DECL|function|zfcp_sysfs_unit_failed_store
id|zfcp_sysfs_unit_failed_store
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|zfcp_unit
op_star
id|unit
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_char
op_star
id|endp
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
id|unit
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_test_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_REMOVE
comma
op_amp
id|unit-&gt;status
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|val
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
op_amp
id|endp
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|endp
op_plus
l_int|1
)paren
OL
(paren
id|buf
op_plus
id|count
)paren
)paren
op_logical_or
(paren
id|val
op_ne
l_int|0
)paren
)paren
(brace
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|zfcp_erp_modify_unit_status
c_func
(paren
id|unit
comma
id|ZFCP_STATUS_COMMON_RUNNING
comma
id|ZFCP_SET
)paren
suffix:semicolon
id|zfcp_erp_unit_reopen
c_func
(paren
id|unit
comma
id|ZFCP_STATUS_COMMON_ERP_FAILED
)paren
suffix:semicolon
id|zfcp_erp_wait
c_func
(paren
id|unit-&gt;port-&gt;adapter
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|zfcp_data.config_sema
)paren
suffix:semicolon
r_return
id|retval
ques
c_cond
id|retval
suffix:colon
(paren
id|ssize_t
)paren
id|count
suffix:semicolon
)brace
multiline_comment|/**&n; * zfcp_sysfs_unit_failed_show - failed state of unit&n; * @dev: pointer to belonging device&n; * @buf: pointer to input buffer&n; *&n; * Show function of &quot;failed&quot; attribute of unit. Will be&n; * &quot;0&quot; if unit is working, otherwise &quot;1&quot;.&n; */
r_static
id|ssize_t
DECL|function|zfcp_sysfs_unit_failed_show
id|zfcp_sysfs_unit_failed_show
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|zfcp_unit
op_star
id|unit
suffix:semicolon
id|unit
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_test_mask
c_func
(paren
id|ZFCP_STATUS_COMMON_ERP_FAILED
comma
op_amp
id|unit-&gt;status
)paren
)paren
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;1&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
id|DEVICE_ATTR
c_func
(paren
id|failed
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
id|zfcp_sysfs_unit_failed_show
comma
id|zfcp_sysfs_unit_failed_store
)paren
suffix:semicolon
DECL|variable|zfcp_unit_attrs
r_static
r_struct
id|attribute
op_star
id|zfcp_unit_attrs
(braket
)braket
op_assign
(brace
op_amp
id|dev_attr_scsi_lun.attr
comma
op_amp
id|dev_attr_failed.attr
comma
op_amp
id|dev_attr_in_recovery.attr
comma
op_amp
id|dev_attr_status.attr
comma
op_amp
id|dev_attr_access_denied.attr
comma
op_amp
id|dev_attr_access_shared.attr
comma
op_amp
id|dev_attr_access_readonly.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|zfcp_unit_attr_group
r_static
r_struct
id|attribute_group
id|zfcp_unit_attr_group
op_assign
(brace
dot
id|attrs
op_assign
id|zfcp_unit_attrs
comma
)brace
suffix:semicolon
multiline_comment|/** &n; * zfcp_sysfs_create_unit_files - create sysfs unit files&n; * @dev: pointer to belonging device&n; *&n; * Create all attributes of the sysfs representation of a unit.&n; */
r_int
DECL|function|zfcp_sysfs_unit_create_files
id|zfcp_sysfs_unit_create_files
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_return
id|sysfs_create_group
c_func
(paren
op_amp
id|dev-&gt;kobj
comma
op_amp
id|zfcp_unit_attr_group
)paren
suffix:semicolon
)brace
multiline_comment|/** &n; * zfcp_sysfs_remove_unit_files - remove sysfs unit files&n; * @dev: pointer to belonging device&n; *&n; * Remove all attributes of the sysfs representation of a unit.&n; */
r_void
DECL|function|zfcp_sysfs_unit_remove_files
id|zfcp_sysfs_unit_remove_files
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
id|sysfs_remove_group
c_func
(paren
op_amp
id|dev-&gt;kobj
comma
op_amp
id|zfcp_unit_attr_group
)paren
suffix:semicolon
)brace
DECL|macro|ZFCP_LOG_AREA
macro_line|#undef ZFCP_LOG_AREA
eof
