multiline_comment|/*&n; * linux/drivers/s390/scsi/zfcp_sysfs_driver.c&n; *&n; * FCP adapter driver for IBM eServer zSeries&n; *&n; * sysfs driver related routines&n; *&n; * (C) Copyright IBM Corp. 2003, 2004&n; *&n; * Authors:&n; *      Martin Peschke &lt;mpeschke@de.ibm.com&gt;&n; *&t;Heiko Carstens &lt;heiko.carstens@de.ibm.com&gt;&n; *      Andreas Herrmann &lt;aherrman@de.ibm.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
DECL|macro|ZFCP_SYSFS_DRIVER_C_REVISION
mdefine_line|#define ZFCP_SYSFS_DRIVER_C_REVISION &quot;$Revision: 1.17 $&quot;
macro_line|#include &quot;zfcp_ext.h&quot;
DECL|macro|ZFCP_LOG_AREA
mdefine_line|#define ZFCP_LOG_AREA                   ZFCP_LOG_AREA_CONFIG
multiline_comment|/**&n; * ZFCP_DEFINE_DRIVER_ATTR - define for all loglevels sysfs attributes&n; * @_name:       name of attribute&n; * @_define:     name of ZFCP loglevel define&n; *&n; * Generates store function for a sysfs loglevel attribute of zfcp driver.&n; */
DECL|macro|ZFCP_DEFINE_DRIVER_ATTR
mdefine_line|#define ZFCP_DEFINE_DRIVER_ATTR(_name, _define)                               &bslash;&n;static ssize_t zfcp_sysfs_loglevel_##_name##_store(struct device_driver *drv, &bslash;&n;&t;&t;&t;&t;&t;&t;   const char *buf,           &bslash;&n;&t;&t;&t;&t;&t;&t;   size_t count)              &bslash;&n;{                                                                             &bslash;&n;&t;unsigned int loglevel;                                                &bslash;&n;&t;unsigned int new_loglevel;                                            &bslash;&n;&t;char *endp;                                                           &bslash;&n;                                                                              &bslash;&n;&t;new_loglevel = simple_strtoul(buf, &amp;endp, 0);                         &bslash;&n;&t;if ((endp + 1) &lt; (buf + count))                                       &bslash;&n;&t;&t;return -EINVAL;                                               &bslash;&n;&t;if (new_loglevel &gt; 3)                                                 &bslash;&n;&t;&t;return -EINVAL;                                               &bslash;&n;&t;down(&amp;zfcp_data.config_sema);                                         &bslash;&n;&t;loglevel = atomic_read(&amp;zfcp_data.loglevel);                          &bslash;&n;&t;loglevel &amp;= ~((unsigned int) 0xf &lt;&lt; (ZFCP_LOG_AREA_##_define &lt;&lt; 2));  &bslash;&n;&t;loglevel |= new_loglevel &lt;&lt; (ZFCP_LOG_AREA_##_define &lt;&lt; 2);           &bslash;&n;&t;atomic_set(&amp;zfcp_data.loglevel, loglevel);                            &bslash;&n;&t;up(&amp;zfcp_data.config_sema);                                           &bslash;&n;&t;return count;                                                         &bslash;&n;}                                                                             &bslash;&n;                                                                              &bslash;&n;static ssize_t zfcp_sysfs_loglevel_##_name##_show(struct device_driver *dev,  &bslash;&n;&t;&t;&t;&t;&t;&t;  char *buf)                  &bslash;&n;{                                                                             &bslash;&n;&t;return sprintf(buf,&quot;%d&bslash;n&quot;, (unsigned int)                             &bslash;&n;&t;&t;       ZFCP_GET_LOG_VALUE(ZFCP_LOG_AREA_##_define));          &bslash;&n;}                                                                             &bslash;&n;                                                                              &bslash;&n;static DRIVER_ATTR(loglevel_##_name, S_IWUSR | S_IRUGO,                       &bslash;&n;&t;&t;   zfcp_sysfs_loglevel_##_name##_show,                        &bslash;&n;&t;&t;   zfcp_sysfs_loglevel_##_name##_store);
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|other
comma
id|OTHER
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|scsi
comma
id|SCSI
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|fsf
comma
id|FSF
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|config
comma
id|CONFIG
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|cio
comma
id|CIO
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|qdio
comma
id|QDIO
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|erp
comma
id|ERP
)paren
suffix:semicolon
id|ZFCP_DEFINE_DRIVER_ATTR
c_func
(paren
id|fc
comma
id|FC
)paren
suffix:semicolon
DECL|function|zfcp_sysfs_version_show
r_static
id|ssize_t
id|zfcp_sysfs_version_show
c_func
(paren
r_struct
id|device_driver
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|zfcp_data.driver_version
)paren
suffix:semicolon
)brace
r_static
id|DRIVER_ATTR
c_func
(paren
id|version
comma
id|S_IRUGO
comma
id|zfcp_sysfs_version_show
comma
l_int|NULL
)paren
suffix:semicolon
DECL|variable|zfcp_driver_attrs
r_static
r_struct
id|attribute
op_star
id|zfcp_driver_attrs
(braket
)braket
op_assign
(brace
op_amp
id|driver_attr_loglevel_other.attr
comma
op_amp
id|driver_attr_loglevel_scsi.attr
comma
op_amp
id|driver_attr_loglevel_fsf.attr
comma
op_amp
id|driver_attr_loglevel_config.attr
comma
op_amp
id|driver_attr_loglevel_cio.attr
comma
op_amp
id|driver_attr_loglevel_qdio.attr
comma
op_amp
id|driver_attr_loglevel_erp.attr
comma
op_amp
id|driver_attr_loglevel_fc.attr
comma
op_amp
id|driver_attr_version.attr
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|zfcp_driver_attr_group
r_static
r_struct
id|attribute_group
id|zfcp_driver_attr_group
op_assign
(brace
dot
id|attrs
op_assign
id|zfcp_driver_attrs
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * zfcp_sysfs_create_driver_files - create sysfs driver files&n; * @dev: pointer to belonging device&n; *&n; * Create all sysfs attributes of the zfcp device driver&n; */
r_int
DECL|function|zfcp_sysfs_driver_create_files
id|zfcp_sysfs_driver_create_files
c_func
(paren
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
r_return
id|sysfs_create_group
c_func
(paren
op_amp
id|drv-&gt;kobj
comma
op_amp
id|zfcp_driver_attr_group
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * zfcp_sysfs_remove_driver_files - remove sysfs driver files&n; * @dev: pointer to belonging device&n; *&n; * Remove all sysfs attributes of the zfcp device driver&n; */
r_void
DECL|function|zfcp_sysfs_driver_remove_files
id|zfcp_sysfs_driver_remove_files
c_func
(paren
r_struct
id|device_driver
op_star
id|drv
)paren
(brace
id|sysfs_remove_group
c_func
(paren
op_amp
id|drv-&gt;kobj
comma
op_amp
id|zfcp_driver_attr_group
)paren
suffix:semicolon
)brace
DECL|macro|ZFCP_LOG_AREA
macro_line|#undef ZFCP_LOG_AREA
eof
