multiline_comment|/*&n; * linux/drivers/s390/block/dasd_cmb.c ($Revision: 1.6 $)&n; *&n; * Linux on zSeries Channel Measurement Facility support&n; *  (dasd device driver interface)&n; *&n; * Copyright 2000,2003 IBM Corporation&n; *&n; * Author: Arnd Bergmann &lt;arndb@de.ibm.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2, or (at your option)&n; * any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioctl32.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/ccwdev.h&gt;
macro_line|#include &lt;asm/cmb.h&gt;
macro_line|#include &quot;dasd_int.h&quot;
r_static
r_int
DECL|function|dasd_ioctl_cmf_enable
id|dasd_ioctl_cmf_enable
c_func
(paren
r_struct
id|block_device
op_star
id|bdev
comma
r_int
id|no
comma
r_int
id|args
)paren
(brace
r_struct
id|dasd_device
op_star
id|device
suffix:semicolon
id|device
op_assign
id|bdev-&gt;bd_disk-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|enable_cmf
c_func
(paren
id|device-&gt;cdev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|dasd_ioctl_cmf_disable
id|dasd_ioctl_cmf_disable
c_func
(paren
r_struct
id|block_device
op_star
id|bdev
comma
r_int
id|no
comma
r_int
id|args
)paren
(brace
r_struct
id|dasd_device
op_star
id|device
suffix:semicolon
id|device
op_assign
id|bdev-&gt;bd_disk-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|disable_cmf
c_func
(paren
id|device-&gt;cdev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|dasd_ioctl_readall_cmb
id|dasd_ioctl_readall_cmb
c_func
(paren
r_struct
id|block_device
op_star
id|bdev
comma
r_int
id|no
comma
r_int
id|args
)paren
(brace
r_struct
id|dasd_device
op_star
id|device
suffix:semicolon
r_struct
id|cmbdata
op_star
id|__user
id|udata
suffix:semicolon
r_struct
id|cmbdata
id|data
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|device
op_assign
id|bdev-&gt;bd_disk-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|udata
op_assign
(paren
r_void
op_star
)paren
id|args
suffix:semicolon
id|size
op_assign
id|_IOC_SIZE
c_func
(paren
id|no
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|udata
comma
id|size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
id|cmf_readall
c_func
(paren
id|device-&gt;cdev
comma
op_amp
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|udata
comma
op_amp
id|data
comma
id|min
c_func
(paren
id|size
comma
r_sizeof
(paren
op_star
id|udata
)paren
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* module initialization below here. dasd already provides a mechanism&n; * to dynamically register ioctl functions, so we simply use this. */
r_static
r_inline
r_int
DECL|function|ioctl_reg
id|ioctl_reg
c_func
(paren
r_int
r_int
id|no
comma
id|dasd_ioctl_fn_t
id|handler
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|dasd_ioctl_no_register
c_func
(paren
id|THIS_MODULE
comma
id|no
comma
id|handler
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_COMPAT
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|ret
op_assign
id|register_ioctl32_conversion
c_func
(paren
id|no
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|dasd_ioctl_no_unregister
c_func
(paren
id|THIS_MODULE
comma
id|no
comma
id|handler
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|ioctl_unreg
id|ioctl_unreg
c_func
(paren
r_int
r_int
id|no
comma
id|dasd_ioctl_fn_t
id|handler
)paren
(brace
id|dasd_ioctl_no_unregister
c_func
(paren
id|THIS_MODULE
comma
id|no
comma
id|handler
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_COMPAT
id|unregister_ioctl32_conversion
c_func
(paren
id|no
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
r_void
DECL|function|dasd_cmf_exit
id|dasd_cmf_exit
c_func
(paren
r_void
)paren
(brace
id|ioctl_unreg
c_func
(paren
id|BIODASDCMFENABLE
comma
id|dasd_ioctl_cmf_enable
)paren
suffix:semicolon
id|ioctl_unreg
c_func
(paren
id|BIODASDCMFDISABLE
comma
id|dasd_ioctl_cmf_disable
)paren
suffix:semicolon
id|ioctl_unreg
c_func
(paren
id|BIODASDREADALLCMB
comma
id|dasd_ioctl_readall_cmb
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|dasd_cmf_init
id|dasd_cmf_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|ioctl_reg
(paren
id|BIODASDCMFENABLE
comma
id|dasd_ioctl_cmf_enable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err
suffix:semicolon
id|ret
op_assign
id|ioctl_reg
(paren
id|BIODASDCMFDISABLE
comma
id|dasd_ioctl_cmf_disable
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err
suffix:semicolon
id|ret
op_assign
id|ioctl_reg
(paren
id|BIODASDREADALLCMB
comma
id|dasd_ioctl_readall_cmb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err
suffix:colon
id|dasd_cmf_exit
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|dasd_cmf_init
id|module_init
c_func
(paren
id|dasd_cmf_init
)paren
suffix:semicolon
DECL|variable|dasd_cmf_exit
id|module_exit
c_func
(paren
id|dasd_cmf_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Arnd Bergmann &lt;arndb@de.ibm.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;channel measurement facility interface for dasd&bslash;n&quot;
l_string|&quot;Copyright 2003 IBM Corporation&bslash;n&quot;
)paren
suffix:semicolon
eof
