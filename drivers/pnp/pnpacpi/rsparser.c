multiline_comment|/*&n; * pnpacpi -- PnP ACPI driver&n; *&n; * Copyright (c) 2004 Matthieu Castet &lt;castet.matthieu@free.fr&gt;&n; * Copyright (c) 2004 Li Shaohua &lt;shaohua.li@intel.com&gt;&n; * &n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2, or (at your option) any&n; * later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;pnpacpi.h&quot;
macro_line|#ifdef CONFIG_IA64
DECL|macro|valid_IRQ
mdefine_line|#define valid_IRQ(i) (1)
macro_line|#else
DECL|macro|valid_IRQ
mdefine_line|#define valid_IRQ(i) (((i) != 0) &amp;&amp; ((i) != 2))
macro_line|#endif
multiline_comment|/*&n; * Allocated Resources&n; */
DECL|function|irq_flags
r_static
r_int
id|irq_flags
c_func
(paren
r_int
id|edge_level
comma
r_int
id|active_high_low
)paren
(brace
r_int
id|flag
suffix:semicolon
r_if
c_cond
(paren
id|edge_level
op_eq
id|ACPI_LEVEL_SENSITIVE
)paren
(brace
r_if
c_cond
(paren
id|active_high_low
op_eq
id|ACPI_ACTIVE_LOW
)paren
(brace
id|flag
op_assign
id|IORESOURCE_IRQ_LOWLEVEL
suffix:semicolon
)brace
r_else
id|flag
op_assign
id|IORESOURCE_IRQ_HIGHLEVEL
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|active_high_low
op_eq
id|ACPI_ACTIVE_LOW
)paren
(brace
id|flag
op_assign
id|IORESOURCE_IRQ_LOWEDGE
suffix:semicolon
)brace
r_else
id|flag
op_assign
id|IORESOURCE_IRQ_HIGHEDGE
suffix:semicolon
)brace
r_return
id|flag
suffix:semicolon
)brace
DECL|function|decode_irq_flags
r_static
r_void
id|decode_irq_flags
c_func
(paren
r_int
id|flag
comma
r_int
op_star
id|edge_level
comma
r_int
op_star
id|active_high_low
)paren
(brace
r_switch
c_cond
(paren
id|flag
)paren
(brace
r_case
id|IORESOURCE_IRQ_LOWLEVEL
suffix:colon
op_star
id|edge_level
op_assign
id|ACPI_LEVEL_SENSITIVE
suffix:semicolon
op_star
id|active_high_low
op_assign
id|ACPI_ACTIVE_LOW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IORESOURCE_IRQ_HIGHLEVEL
suffix:colon
op_star
id|edge_level
op_assign
id|ACPI_LEVEL_SENSITIVE
suffix:semicolon
op_star
id|active_high_low
op_assign
id|ACPI_ACTIVE_HIGH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IORESOURCE_IRQ_LOWEDGE
suffix:colon
op_star
id|edge_level
op_assign
id|ACPI_EDGE_SENSITIVE
suffix:semicolon
op_star
id|active_high_low
op_assign
id|ACPI_ACTIVE_LOW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IORESOURCE_IRQ_HIGHEDGE
suffix:colon
op_star
id|edge_level
op_assign
id|ACPI_EDGE_SENSITIVE
suffix:semicolon
op_star
id|active_high_low
op_assign
id|ACPI_ACTIVE_HIGH
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpacpi_parse_allocated_irqresource
id|pnpacpi_parse_allocated_irqresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|irq
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_IRQ
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_IRQ
)paren
(brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_IRQ
suffix:semicolon
singleline_comment|//Also clears _UNSET flag
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|irq
suffix:semicolon
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
id|irq
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpacpi_parse_allocated_dmaresource
id|pnpacpi_parse_allocated_dmaresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|dma
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_DMA
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_DMA
)paren
(brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_DMA
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|dma
op_eq
op_minus
l_int|1
)paren
(brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|dma
suffix:semicolon
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
id|dma
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpacpi_parse_allocated_ioresource
id|pnpacpi_parse_allocated_ioresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|io
comma
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_PORT
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_PORT
)paren
(brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|len
op_le
l_int|0
op_logical_or
(paren
id|io
op_plus
id|len
op_minus
l_int|1
)paren
op_ge
l_int|0x10003
)paren
(brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|io
suffix:semicolon
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
(paren
id|io
op_plus
id|len
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpacpi_parse_allocated_memresource
id|pnpacpi_parse_allocated_memresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|mem
comma
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
(paren
id|i
OL
id|PNP_MAX_MEM
)paren
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_MEM
)paren
(brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
(brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
(paren
id|mem
op_plus
id|len
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|pnpacpi_allocated_resource
r_static
id|acpi_status
id|pnpacpi_allocated_resource
c_func
(paren
r_struct
id|acpi_resource
op_star
id|res
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|pnp_resource_table
op_star
id|res_table
op_assign
(paren
r_struct
id|pnp_resource_table
op_star
)paren
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|res-&gt;id
)paren
(brace
r_case
id|ACPI_RSTYPE_IRQ
suffix:colon
r_if
c_cond
(paren
(paren
id|res-&gt;data.irq.number_of_interrupts
OG
l_int|0
)paren
op_logical_and
id|valid_IRQ
c_func
(paren
id|res-&gt;data.irq.interrupts
(braket
l_int|0
)braket
)paren
)paren
(brace
id|pnpacpi_parse_allocated_irqresource
c_func
(paren
id|res_table
comma
id|acpi_register_gsi
c_func
(paren
id|res-&gt;data.irq.interrupts
(braket
l_int|0
)braket
comma
id|res-&gt;data.irq.edge_level
comma
id|res-&gt;data.irq.active_high_low
)paren
)paren
suffix:semicolon
id|pcibios_penalize_isa_irq
c_func
(paren
id|res-&gt;data.irq.interrupts
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_EXT_IRQ
suffix:colon
r_if
c_cond
(paren
(paren
id|res-&gt;data.extended_irq.number_of_interrupts
OG
l_int|0
)paren
op_logical_and
id|valid_IRQ
c_func
(paren
id|res-&gt;data.extended_irq.interrupts
(braket
l_int|0
)braket
)paren
)paren
(brace
id|pnpacpi_parse_allocated_irqresource
c_func
(paren
id|res_table
comma
id|acpi_register_gsi
c_func
(paren
id|res-&gt;data.extended_irq.interrupts
(braket
l_int|0
)braket
comma
id|res-&gt;data.extended_irq.edge_level
comma
id|res-&gt;data.extended_irq.active_high_low
)paren
)paren
suffix:semicolon
id|pcibios_penalize_isa_irq
c_func
(paren
id|res-&gt;data.extended_irq.interrupts
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_DMA
suffix:colon
r_if
c_cond
(paren
id|res-&gt;data.dma.number_of_channels
OG
l_int|0
)paren
id|pnpacpi_parse_allocated_dmaresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.dma.channels
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_IO
suffix:colon
id|pnpacpi_parse_allocated_ioresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.io.min_base_address
comma
id|res-&gt;data.io.range_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_IO
suffix:colon
id|pnpacpi_parse_allocated_ioresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.fixed_io.base_address
comma
id|res-&gt;data.fixed_io.range_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM24
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.memory24.min_base_address
comma
id|res-&gt;data.memory24.range_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM32
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.memory32.min_base_address
comma
id|res-&gt;data.memory32.range_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_MEM32
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.fixed_memory32.range_base_address
comma
id|res-&gt;data.fixed_memory32.range_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_ADDRESS16
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.address16.min_address_range
comma
id|res-&gt;data.address16.address_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_ADDRESS32
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.address32.min_address_range
comma
id|res-&gt;data.address32.address_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_ADDRESS64
suffix:colon
id|pnpacpi_parse_allocated_memresource
c_func
(paren
id|res_table
comma
id|res-&gt;data.address64.min_address_range
comma
id|res-&gt;data.address64.address_length
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|pnp_warn
c_func
(paren
l_string|&quot;PnPACPI: Alloc type : %d not handle&quot;
comma
id|res-&gt;id
)paren
suffix:semicolon
r_return
id|AE_ERROR
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
DECL|function|pnpacpi_parse_allocated_resource
id|acpi_status
id|pnpacpi_parse_allocated_resource
c_func
(paren
id|acpi_handle
id|handle
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
multiline_comment|/* Blank the resource table values */
id|pnp_init_resource_table
c_func
(paren
id|res
)paren
suffix:semicolon
r_return
id|acpi_walk_resources
c_func
(paren
id|handle
comma
id|METHOD_NAME__CRS
comma
id|pnpacpi_allocated_resource
comma
id|res
)paren
suffix:semicolon
)brace
DECL|function|pnpacpi_parse_dma_option
r_static
r_void
id|pnpacpi_parse_dma_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_dma
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pnp_dma
op_star
id|dma
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;number_of_channels
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|dma
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_dma
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;number_of_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dma-&gt;map
op_or_assign
l_int|1
op_lshift
id|p-&gt;channels
(braket
id|i
)braket
suffix:semicolon
)brace
id|dma-&gt;flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;bus_master
)paren
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_MASTER
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;type
)paren
(brace
r_case
id|ACPI_COMPATIBILITY
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_COMPATIBLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_A
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_TYPEA
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_B
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_TYPEB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_F
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_TYPEF
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Set a default value ? */
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_COMPATIBLE
suffix:semicolon
id|pnp_err
c_func
(paren
l_string|&quot;Invalid DMA type&quot;
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|p-&gt;transfer
)paren
(brace
r_case
id|ACPI_TRANSFER_8
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_8BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TRANSFER_8_16
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_8AND16BIT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TRANSFER_16
suffix:colon
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_16BIT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Set a default value ? */
id|dma-&gt;flags
op_or_assign
id|IORESOURCE_DMA_8AND16BIT
suffix:semicolon
id|pnp_err
c_func
(paren
l_string|&quot;Invalid DMA transfer type&quot;
)paren
suffix:semicolon
)brace
id|pnp_register_dma_resource
c_func
(paren
id|option
comma
id|dma
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpacpi_parse_irq_option
r_static
r_void
id|pnpacpi_parse_irq_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_irq
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;number_of_interrupts
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|irq
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_irq
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;number_of_interrupts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__set_bit
c_func
(paren
id|p-&gt;interrupts
(braket
id|i
)braket
comma
id|irq-&gt;map
)paren
suffix:semicolon
)brace
id|irq-&gt;flags
op_assign
id|irq_flags
c_func
(paren
id|p-&gt;edge_level
comma
id|p-&gt;active_high_low
)paren
suffix:semicolon
id|pnp_register_irq_resource
c_func
(paren
id|option
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpacpi_parse_ext_irq_option
r_static
r_void
id|pnpacpi_parse_ext_irq_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_ext_irq
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;number_of_interrupts
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|irq
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_irq
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;number_of_interrupts
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__set_bit
c_func
(paren
id|p-&gt;interrupts
(braket
id|i
)braket
comma
id|irq-&gt;map
)paren
suffix:semicolon
)brace
id|irq-&gt;flags
op_assign
id|irq_flags
c_func
(paren
id|p-&gt;edge_level
comma
id|p-&gt;active_high_low
)paren
suffix:semicolon
id|pnp_register_irq_resource
c_func
(paren
id|option
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpacpi_parse_port_option
id|pnpacpi_parse_port_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_io
op_star
id|io
)paren
(brace
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;range_length
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|port
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
id|io-&gt;min_base_address
suffix:semicolon
id|port-&gt;max
op_assign
id|io-&gt;max_base_address
suffix:semicolon
id|port-&gt;align
op_assign
id|io-&gt;alignment
suffix:semicolon
id|port-&gt;size
op_assign
id|io-&gt;range_length
suffix:semicolon
id|port-&gt;flags
op_assign
id|ACPI_DECODE_16
op_eq
id|io-&gt;io_decode
ques
c_cond
id|PNP_PORT_FLAG_16BITADDR
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpacpi_parse_fixed_port_option
id|pnpacpi_parse_fixed_port_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_fixed_io
op_star
id|io
)paren
(brace
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;range_length
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|port
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
id|port-&gt;max
op_assign
id|io-&gt;base_address
suffix:semicolon
id|port-&gt;size
op_assign
id|io-&gt;range_length
suffix:semicolon
id|port-&gt;align
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_assign
id|PNP_PORT_FLAG_FIXED
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpacpi_parse_mem24_option
id|pnpacpi_parse_mem24_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_mem24
op_star
id|p
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;range_length
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mem
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
id|p-&gt;min_base_address
suffix:semicolon
id|mem-&gt;max
op_assign
id|p-&gt;max_base_address
suffix:semicolon
id|mem-&gt;align
op_assign
id|p-&gt;alignment
suffix:semicolon
id|mem-&gt;size
op_assign
id|p-&gt;range_length
suffix:semicolon
id|mem-&gt;flags
op_assign
(paren
id|ACPI_READ_WRITE_MEMORY
op_eq
id|p-&gt;read_write_attribute
)paren
ques
c_cond
id|IORESOURCE_MEM_WRITEABLE
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpacpi_parse_mem32_option
id|pnpacpi_parse_mem32_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_mem32
op_star
id|p
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;range_length
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mem
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
id|p-&gt;min_base_address
suffix:semicolon
id|mem-&gt;max
op_assign
id|p-&gt;max_base_address
suffix:semicolon
id|mem-&gt;align
op_assign
id|p-&gt;alignment
suffix:semicolon
id|mem-&gt;size
op_assign
id|p-&gt;range_length
suffix:semicolon
id|mem-&gt;flags
op_assign
(paren
id|ACPI_READ_WRITE_MEMORY
op_eq
id|p-&gt;read_write_attribute
)paren
ques
c_cond
id|IORESOURCE_MEM_WRITEABLE
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpacpi_parse_fixed_mem32_option
id|pnpacpi_parse_fixed_mem32_option
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_struct
id|acpi_resource_fixed_mem32
op_star
id|p
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;range_length
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|mem
op_assign
id|pnpacpi_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
id|mem-&gt;max
op_assign
id|p-&gt;range_base_address
suffix:semicolon
id|mem-&gt;size
op_assign
id|p-&gt;range_length
suffix:semicolon
id|mem-&gt;align
op_assign
l_int|0
suffix:semicolon
id|mem-&gt;flags
op_assign
(paren
id|ACPI_READ_WRITE_MEMORY
op_eq
id|p-&gt;read_write_attribute
)paren
ques
c_cond
id|IORESOURCE_MEM_WRITEABLE
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|struct|acpipnp_parse_option_s
r_struct
id|acpipnp_parse_option_s
(brace
DECL|member|option
r_struct
id|pnp_option
op_star
id|option
suffix:semicolon
DECL|member|dev
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
)brace
suffix:semicolon
DECL|function|pnpacpi_option_resource
r_static
id|acpi_status
id|pnpacpi_option_resource
c_func
(paren
r_struct
id|acpi_resource
op_star
id|res
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|priority
op_assign
l_int|0
suffix:semicolon
r_struct
id|acpipnp_parse_option_s
op_star
id|parse_data
op_assign
(paren
r_struct
id|acpipnp_parse_option_s
op_star
)paren
id|data
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
op_assign
id|parse_data-&gt;dev
suffix:semicolon
r_struct
id|pnp_option
op_star
id|option
op_assign
id|parse_data-&gt;option
suffix:semicolon
r_switch
c_cond
(paren
id|res-&gt;id
)paren
(brace
r_case
id|ACPI_RSTYPE_IRQ
suffix:colon
id|pnpacpi_parse_irq_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_EXT_IRQ
suffix:colon
id|pnpacpi_parse_ext_irq_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.extended_irq
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_DMA
suffix:colon
id|pnpacpi_parse_dma_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.dma
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_IO
suffix:colon
id|pnpacpi_parse_port_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.io
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_IO
suffix:colon
id|pnpacpi_parse_fixed_port_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.fixed_io
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM24
suffix:colon
id|pnpacpi_parse_mem24_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.memory24
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM32
suffix:colon
id|pnpacpi_parse_mem32_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.memory32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_MEM32
suffix:colon
id|pnpacpi_parse_fixed_mem32_option
c_func
(paren
id|option
comma
op_amp
id|res-&gt;data.fixed_memory32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_START_DPF
suffix:colon
r_switch
c_cond
(paren
id|res-&gt;data.start_dpf.compatibility_priority
)paren
(brace
r_case
id|ACPI_GOOD_CONFIGURATION
suffix:colon
id|priority
op_assign
id|PNP_RES_PRIORITY_PREFERRED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_ACCEPTABLE_CONFIGURATION
suffix:colon
id|priority
op_assign
id|PNP_RES_PRIORITY_ACCEPTABLE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_SUB_OPTIMAL_CONFIGURATION
suffix:colon
id|priority
op_assign
id|PNP_RES_PRIORITY_FUNCTIONAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|priority
op_assign
id|PNP_RES_PRIORITY_INVALID
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* TBD: Considering performace/robustness bits */
id|option
op_assign
id|pnp_register_dependent_option
c_func
(paren
id|dev
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
r_return
id|AE_ERROR
suffix:semicolon
id|parse_data-&gt;option
op_assign
id|option
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_END_DPF
suffix:colon
r_return
id|AE_CTRL_TERMINATE
suffix:semicolon
r_default
suffix:colon
id|pnp_warn
c_func
(paren
l_string|&quot;PnPACPI:Option type: %d not handle&quot;
comma
id|res-&gt;id
)paren
suffix:semicolon
r_return
id|AE_ERROR
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
DECL|function|pnpacpi_parse_resource_option_data
id|acpi_status
id|pnpacpi_parse_resource_option_data
c_func
(paren
id|acpi_handle
id|handle
comma
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_struct
id|acpipnp_parse_option_s
id|parse_data
suffix:semicolon
id|parse_data.option
op_assign
id|pnp_register_independent_option
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parse_data.option
)paren
r_return
id|AE_ERROR
suffix:semicolon
id|parse_data.dev
op_assign
id|dev
suffix:semicolon
id|status
op_assign
id|acpi_walk_resources
c_func
(paren
id|handle
comma
id|METHOD_NAME__PRS
comma
id|pnpacpi_option_resource
comma
op_amp
id|parse_data
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Set resource&n; */
DECL|function|pnpacpi_count_resources
r_static
id|acpi_status
id|pnpacpi_count_resources
c_func
(paren
r_struct
id|acpi_resource
op_star
id|res
comma
r_void
op_star
id|data
)paren
(brace
r_int
op_star
id|res_cnt
op_assign
(paren
r_int
op_star
)paren
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|res-&gt;id
)paren
(brace
r_case
id|ACPI_RSTYPE_IRQ
suffix:colon
r_case
id|ACPI_RSTYPE_EXT_IRQ
suffix:colon
r_case
id|ACPI_RSTYPE_DMA
suffix:colon
r_case
id|ACPI_RSTYPE_IO
suffix:colon
r_case
id|ACPI_RSTYPE_FIXED_IO
suffix:colon
r_case
id|ACPI_RSTYPE_MEM24
suffix:colon
r_case
id|ACPI_RSTYPE_MEM32
suffix:colon
r_case
id|ACPI_RSTYPE_FIXED_MEM32
suffix:colon
macro_line|#if 0
r_case
id|ACPI_RSTYPE_ADDRESS16
suffix:colon
r_case
id|ACPI_RSTYPE_ADDRESS32
suffix:colon
r_case
id|ACPI_RSTYPE_ADDRESS64
suffix:colon
macro_line|#endif
(paren
op_star
id|res_cnt
)paren
op_increment
suffix:semicolon
r_default
suffix:colon
r_return
id|AE_OK
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
DECL|function|pnpacpi_type_resources
r_static
id|acpi_status
id|pnpacpi_type_resources
c_func
(paren
r_struct
id|acpi_resource
op_star
id|res
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|acpi_resource
op_star
op_star
id|resource
op_assign
(paren
r_struct
id|acpi_resource
op_star
op_star
)paren
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|res-&gt;id
)paren
(brace
r_case
id|ACPI_RSTYPE_IRQ
suffix:colon
r_case
id|ACPI_RSTYPE_EXT_IRQ
suffix:colon
r_case
id|ACPI_RSTYPE_DMA
suffix:colon
r_case
id|ACPI_RSTYPE_IO
suffix:colon
r_case
id|ACPI_RSTYPE_FIXED_IO
suffix:colon
r_case
id|ACPI_RSTYPE_MEM24
suffix:colon
r_case
id|ACPI_RSTYPE_MEM32
suffix:colon
r_case
id|ACPI_RSTYPE_FIXED_MEM32
suffix:colon
macro_line|#if 0
r_case
id|ACPI_RSTYPE_ADDRESS16
suffix:colon
r_case
id|ACPI_RSTYPE_ADDRESS32
suffix:colon
r_case
id|ACPI_RSTYPE_ADDRESS64
suffix:colon
macro_line|#endif
(paren
op_star
id|resource
)paren
op_member_access_from_pointer
id|id
op_assign
id|res-&gt;id
suffix:semicolon
(paren
op_star
id|resource
)paren
op_increment
suffix:semicolon
r_default
suffix:colon
r_return
id|AE_OK
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
DECL|function|pnpacpi_build_resource_template
r_int
id|pnpacpi_build_resource_template
c_func
(paren
id|acpi_handle
id|handle
comma
r_struct
id|acpi_buffer
op_star
id|buffer
)paren
(brace
r_struct
id|acpi_resource
op_star
id|resource
suffix:semicolon
r_int
id|res_cnt
op_assign
l_int|0
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|status
op_assign
id|acpi_walk_resources
c_func
(paren
id|handle
comma
id|METHOD_NAME__CRS
comma
id|pnpacpi_count_resources
comma
op_amp
id|res_cnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|pnp_err
c_func
(paren
l_string|&quot;Evaluate _CRS failed&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|res_cnt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|buffer-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
op_star
(paren
id|res_cnt
op_plus
l_int|1
)paren
op_plus
l_int|1
suffix:semicolon
id|buffer-&gt;pointer
op_assign
id|pnpacpi_kmalloc
c_func
(paren
id|buffer-&gt;length
op_minus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer-&gt;pointer
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pnp_dbg
c_func
(paren
l_string|&quot;Res cnt %d&quot;
comma
id|res_cnt
)paren
suffix:semicolon
id|resource
op_assign
(paren
r_struct
id|acpi_resource
op_star
)paren
id|buffer-&gt;pointer
suffix:semicolon
id|status
op_assign
id|acpi_walk_resources
c_func
(paren
id|handle
comma
id|METHOD_NAME__CRS
comma
id|pnpacpi_type_resources
comma
op_amp
id|resource
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|kfree
c_func
(paren
id|buffer-&gt;pointer
)paren
suffix:semicolon
id|pnp_err
c_func
(paren
l_string|&quot;Evaluate _CRS failed&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* resource will pointer the end resource now */
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_END_TAG
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_irq
r_static
r_void
id|pnpacpi_encode_irq
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
r_int
id|edge_level
comma
id|active_high_low
suffix:semicolon
id|decode_irq_flags
c_func
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_BITS
comma
op_amp
id|edge_level
comma
op_amp
id|active_high_low
)paren
suffix:semicolon
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_IRQ
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
id|resource-&gt;data.irq.edge_level
op_assign
id|edge_level
suffix:semicolon
id|resource-&gt;data.irq.active_high_low
op_assign
id|active_high_low
suffix:semicolon
r_if
c_cond
(paren
id|edge_level
op_eq
id|ACPI_EDGE_SENSITIVE
)paren
id|resource-&gt;data.irq.shared_exclusive
op_assign
id|ACPI_EXCLUSIVE
suffix:semicolon
r_else
id|resource-&gt;data.irq.shared_exclusive
op_assign
id|ACPI_SHARED
suffix:semicolon
id|resource-&gt;data.irq.number_of_interrupts
op_assign
l_int|1
suffix:semicolon
id|resource-&gt;data.irq.interrupts
(braket
l_int|0
)braket
op_assign
id|p-&gt;start
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_ext_irq
r_static
r_void
id|pnpacpi_encode_ext_irq
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
r_int
id|edge_level
comma
id|active_high_low
suffix:semicolon
id|decode_irq_flags
c_func
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_BITS
comma
op_amp
id|edge_level
comma
op_amp
id|active_high_low
)paren
suffix:semicolon
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_EXT_IRQ
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
id|resource-&gt;data.extended_irq.producer_consumer
op_assign
id|ACPI_CONSUMER
suffix:semicolon
id|resource-&gt;data.extended_irq.edge_level
op_assign
id|edge_level
suffix:semicolon
id|resource-&gt;data.extended_irq.active_high_low
op_assign
id|active_high_low
suffix:semicolon
r_if
c_cond
(paren
id|edge_level
op_eq
id|ACPI_EDGE_SENSITIVE
)paren
id|resource-&gt;data.irq.shared_exclusive
op_assign
id|ACPI_EXCLUSIVE
suffix:semicolon
r_else
id|resource-&gt;data.irq.shared_exclusive
op_assign
id|ACPI_SHARED
suffix:semicolon
id|resource-&gt;data.extended_irq.number_of_interrupts
op_assign
l_int|1
suffix:semicolon
id|resource-&gt;data.extended_irq.interrupts
(braket
l_int|0
)braket
op_assign
id|p-&gt;start
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_dma
r_static
r_void
id|pnpacpi_encode_dma
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_DMA
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
multiline_comment|/* Note: pnp_assign_dma will copy pnp_dma-&gt;flags into p-&gt;flags */
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_COMPATIBLE
)paren
id|resource-&gt;data.dma.type
op_assign
id|ACPI_COMPATIBILITY
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_TYPEA
)paren
id|resource-&gt;data.dma.type
op_assign
id|ACPI_TYPE_A
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_TYPEB
)paren
id|resource-&gt;data.dma.type
op_assign
id|ACPI_TYPE_B
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_TYPEF
)paren
id|resource-&gt;data.dma.type
op_assign
id|ACPI_TYPE_F
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_8BIT
)paren
id|resource-&gt;data.dma.transfer
op_assign
id|ACPI_TRANSFER_8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_8AND16BIT
)paren
id|resource-&gt;data.dma.transfer
op_assign
id|ACPI_TRANSFER_8_16
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_16BIT
)paren
id|resource-&gt;data.dma.transfer
op_assign
id|ACPI_TRANSFER_16
suffix:semicolon
id|resource-&gt;data.dma.bus_master
op_assign
id|p-&gt;flags
op_amp
id|IORESOURCE_DMA_MASTER
suffix:semicolon
id|resource-&gt;data.dma.number_of_channels
op_assign
l_int|1
suffix:semicolon
id|resource-&gt;data.dma.channels
(braket
l_int|0
)braket
op_assign
id|p-&gt;start
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_io
r_static
r_void
id|pnpacpi_encode_io
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_IO
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
multiline_comment|/* Note: pnp_assign_port will copy pnp_port-&gt;flags into p-&gt;flags */
id|resource-&gt;data.io.io_decode
op_assign
(paren
id|p-&gt;flags
op_amp
id|PNP_PORT_FLAG_16BITADDR
)paren
ques
c_cond
id|ACPI_DECODE_16
suffix:colon
id|ACPI_DECODE_10
suffix:semicolon
id|resource-&gt;data.io.min_base_address
op_assign
id|p-&gt;start
suffix:semicolon
id|resource-&gt;data.io.max_base_address
op_assign
id|p-&gt;end
suffix:semicolon
id|resource-&gt;data.io.alignment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Correct? */
id|resource-&gt;data.io.range_length
op_assign
id|p-&gt;end
op_minus
id|p-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_fixed_io
r_static
r_void
id|pnpacpi_encode_fixed_io
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_FIXED_IO
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
id|resource-&gt;data.fixed_io.base_address
op_assign
id|p-&gt;start
suffix:semicolon
id|resource-&gt;data.fixed_io.range_length
op_assign
id|p-&gt;end
op_minus
id|p-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_mem24
r_static
r_void
id|pnpacpi_encode_mem24
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_MEM24
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
multiline_comment|/* Note: pnp_assign_mem will copy pnp_mem-&gt;flags into p-&gt;flags */
id|resource-&gt;data.memory24.read_write_attribute
op_assign
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_MEM_WRITEABLE
)paren
ques
c_cond
id|ACPI_READ_WRITE_MEMORY
suffix:colon
id|ACPI_READ_ONLY_MEMORY
suffix:semicolon
id|resource-&gt;data.memory24.min_base_address
op_assign
id|p-&gt;start
suffix:semicolon
id|resource-&gt;data.memory24.max_base_address
op_assign
id|p-&gt;end
suffix:semicolon
id|resource-&gt;data.memory24.alignment
op_assign
l_int|0
suffix:semicolon
id|resource-&gt;data.memory24.range_length
op_assign
id|p-&gt;end
op_minus
id|p-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_mem32
r_static
r_void
id|pnpacpi_encode_mem32
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_MEM32
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
id|resource-&gt;data.memory32.read_write_attribute
op_assign
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_MEM_WRITEABLE
)paren
ques
c_cond
id|ACPI_READ_WRITE_MEMORY
suffix:colon
id|ACPI_READ_ONLY_MEMORY
suffix:semicolon
id|resource-&gt;data.memory32.min_base_address
op_assign
id|p-&gt;start
suffix:semicolon
id|resource-&gt;data.memory32.max_base_address
op_assign
id|p-&gt;end
suffix:semicolon
id|resource-&gt;data.memory32.alignment
op_assign
l_int|0
suffix:semicolon
id|resource-&gt;data.memory32.range_length
op_assign
id|p-&gt;end
op_minus
id|p-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_fixed_mem32
r_static
r_void
id|pnpacpi_encode_fixed_mem32
c_func
(paren
r_struct
id|acpi_resource
op_star
id|resource
comma
r_struct
id|resource
op_star
id|p
)paren
(brace
id|resource-&gt;id
op_assign
id|ACPI_RSTYPE_FIXED_MEM32
suffix:semicolon
id|resource-&gt;length
op_assign
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
suffix:semicolon
id|resource-&gt;data.fixed_memory32.read_write_attribute
op_assign
(paren
id|p-&gt;flags
op_amp
id|IORESOURCE_MEM_WRITEABLE
)paren
ques
c_cond
id|ACPI_READ_WRITE_MEMORY
suffix:colon
id|ACPI_READ_ONLY_MEMORY
suffix:semicolon
id|resource-&gt;data.fixed_memory32.range_base_address
op_assign
id|p-&gt;start
suffix:semicolon
id|resource-&gt;data.fixed_memory32.range_length
op_assign
id|p-&gt;end
op_minus
id|p-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|pnpacpi_encode_resources
r_int
id|pnpacpi_encode_resources
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res_table
comma
r_struct
id|acpi_buffer
op_star
id|buffer
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* pnpacpi_build_resource_template allocates extra mem */
r_int
id|res_cnt
op_assign
(paren
id|buffer-&gt;length
op_minus
l_int|1
)paren
op_div
r_sizeof
(paren
r_struct
id|acpi_resource
)paren
op_minus
l_int|1
suffix:semicolon
r_struct
id|acpi_resource
op_star
id|resource
op_assign
(paren
r_struct
id|acpi_resource
op_star
)paren
id|buffer-&gt;pointer
suffix:semicolon
r_int
id|port
op_assign
l_int|0
comma
id|irq
op_assign
l_int|0
comma
id|dma
op_assign
l_int|0
comma
id|mem
op_assign
l_int|0
suffix:semicolon
id|pnp_dbg
c_func
(paren
l_string|&quot;res cnt %d&quot;
comma
id|res_cnt
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|res_cnt
)paren
(brace
r_switch
c_cond
(paren
id|resource-&gt;id
)paren
(brace
r_case
id|ACPI_RSTYPE_IRQ
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode irq&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_irq
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;irq_resource
(braket
id|irq
)braket
)paren
suffix:semicolon
id|irq
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_EXT_IRQ
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode ext irq&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_ext_irq
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;irq_resource
(braket
id|irq
)braket
)paren
suffix:semicolon
id|irq
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_DMA
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode dma&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_dma
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;dma_resource
(braket
id|dma
)braket
)paren
suffix:semicolon
id|dma
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_IO
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode io&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_io
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;port_resource
(braket
id|port
)braket
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_IO
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode fixed io&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_fixed_io
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;port_resource
(braket
id|port
)braket
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM24
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode mem24&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_mem24
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_MEM32
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode mem32&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_mem32
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_RSTYPE_FIXED_MEM32
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;Encode fixed mem32&quot;
)paren
suffix:semicolon
id|pnpacpi_encode_fixed_mem32
c_func
(paren
id|resource
comma
op_amp
id|res_table-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* other type */
id|pnp_warn
c_func
(paren
l_string|&quot;Invalid type&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|resource
op_increment
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
