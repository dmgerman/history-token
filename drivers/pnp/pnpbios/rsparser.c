multiline_comment|/*&n; * rsparser.c - parses and encodes pnpbios resource data streams&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/pnp.h&gt;
macro_line|#include &lt;linux/pnpbios.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &quot;pnpbios.h&quot;
multiline_comment|/* standard resource tags */
DECL|macro|SMALL_TAG_PNPVERNO
mdefine_line|#define SMALL_TAG_PNPVERNO&t;&t;0x01
DECL|macro|SMALL_TAG_LOGDEVID
mdefine_line|#define SMALL_TAG_LOGDEVID&t;&t;0x02
DECL|macro|SMALL_TAG_COMPATDEVID
mdefine_line|#define SMALL_TAG_COMPATDEVID&t;&t;0x03
DECL|macro|SMALL_TAG_IRQ
mdefine_line|#define SMALL_TAG_IRQ&t;&t;&t;0x04
DECL|macro|SMALL_TAG_DMA
mdefine_line|#define SMALL_TAG_DMA&t;&t;&t;0x05
DECL|macro|SMALL_TAG_STARTDEP
mdefine_line|#define SMALL_TAG_STARTDEP&t;&t;0x06
DECL|macro|SMALL_TAG_ENDDEP
mdefine_line|#define SMALL_TAG_ENDDEP&t;&t;0x07
DECL|macro|SMALL_TAG_PORT
mdefine_line|#define SMALL_TAG_PORT&t;&t;&t;0x08
DECL|macro|SMALL_TAG_FIXEDPORT
mdefine_line|#define SMALL_TAG_FIXEDPORT&t;&t;0x09
DECL|macro|SMALL_TAG_VENDOR
mdefine_line|#define SMALL_TAG_VENDOR&t;&t;0x0e
DECL|macro|SMALL_TAG_END
mdefine_line|#define SMALL_TAG_END&t;&t;&t;0x0f
DECL|macro|LARGE_TAG
mdefine_line|#define LARGE_TAG&t;&t;&t;0x80
DECL|macro|LARGE_TAG_MEM
mdefine_line|#define LARGE_TAG_MEM&t;&t;&t;0x81
DECL|macro|LARGE_TAG_ANSISTR
mdefine_line|#define LARGE_TAG_ANSISTR&t;&t;0x82
DECL|macro|LARGE_TAG_UNICODESTR
mdefine_line|#define LARGE_TAG_UNICODESTR&t;&t;0x83
DECL|macro|LARGE_TAG_VENDOR
mdefine_line|#define LARGE_TAG_VENDOR&t;&t;0x84
DECL|macro|LARGE_TAG_MEM32
mdefine_line|#define LARGE_TAG_MEM32&t;&t;&t;0x85
DECL|macro|LARGE_TAG_FIXEDMEM32
mdefine_line|#define LARGE_TAG_FIXEDMEM32&t;&t;0x86
multiline_comment|/*&n; * Resource Data Stream Format:&n; *&n; * Allocated Resources (required)&n; * end tag -&gt;&n; * Resource Configuration Options (optional)&n; * end tag -&gt;&n; * Compitable Device IDs (optional)&n; * final end tag -&gt;&n; */
multiline_comment|/*&n; * Allocated Resources&n; */
r_static
r_void
DECL|function|pnpbios_parse_allocated_irqresource
id|pnpbios_parse_allocated_irqresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|irq
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_IRQ
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_IRQ
)paren
(brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_IRQ
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|irq
op_eq
op_minus
l_int|1
)paren
(brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|start
op_assign
id|res-&gt;irq_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
id|irq
suffix:semicolon
id|pcibios_penalize_isa_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpbios_parse_allocated_dmaresource
id|pnpbios_parse_allocated_dmaresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|dma
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_DMA
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_DMA
)paren
(brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_DMA
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|dma
op_eq
op_minus
l_int|1
)paren
(brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|start
op_assign
id|res-&gt;dma_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
id|dma
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpbios_parse_allocated_ioresource
id|pnpbios_parse_allocated_ioresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|io
comma
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_PORT
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_PORT
)paren
(brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|len
op_le
l_int|0
op_logical_or
(paren
id|io
op_plus
id|len
op_minus
l_int|1
)paren
op_ge
l_int|0x10003
)paren
(brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|io
suffix:semicolon
id|res-&gt;port_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
(paren
id|io
op_plus
id|len
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|pnpbios_parse_allocated_memresource
id|pnpbios_parse_allocated_memresource
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_int
id|mem
comma
r_int
id|len
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_UNSET
)paren
op_logical_and
id|i
OL
id|PNP_MAX_MEM
)paren
id|i
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|PNP_MAX_MEM
)paren
(brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
singleline_comment|// Also clears _UNSET flag
r_if
c_cond
(paren
id|len
op_le
l_int|0
)paren
(brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|flags
op_or_assign
id|IORESOURCE_DISABLED
suffix:semicolon
r_return
suffix:semicolon
)brace
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|start
op_assign
(paren
r_int
r_int
)paren
id|mem
suffix:semicolon
id|res-&gt;mem_resource
(braket
id|i
)braket
dot
id|end
op_assign
(paren
r_int
r_int
)paren
(paren
id|mem
op_plus
id|len
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
r_char
op_star
DECL|function|pnpbios_parse_allocated_resource_data
id|pnpbios_parse_allocated_resource_data
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
r_char
op_star
id|end
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
r_int
r_int
id|len
comma
id|tag
suffix:semicolon
r_int
id|io
comma
id|size
comma
id|mask
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Blank the resource table values */
id|pnp_init_resource_table
c_func
(paren
id|res
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
r_char
op_star
)paren
id|p
OL
(paren
r_char
op_star
)paren
id|end
)paren
(brace
multiline_comment|/* determine the type of tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
(brace
multiline_comment|/* large tag */
id|len
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|tag
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* small tag */
id|len
op_assign
id|p
(braket
l_int|0
)braket
op_amp
l_int|0x07
suffix:semicolon
id|tag
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tag
)paren
(brace
r_case
id|LARGE_TAG_MEM
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|size
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|10
)braket
suffix:semicolon
id|pnpbios_parse_allocated_memresource
c_func
(paren
id|res
comma
id|io
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_ANSISTR
suffix:colon
multiline_comment|/* ignore this for now */
r_break
suffix:semicolon
r_case
id|LARGE_TAG_VENDOR
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
r_case
id|LARGE_TAG_MEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|17
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|size
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|16
)braket
suffix:semicolon
id|pnpbios_parse_allocated_memresource
c_func
(paren
id|res
comma
id|io
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_FIXEDMEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|size
op_assign
op_star
(paren
r_int
op_star
)paren
op_amp
id|p
(braket
l_int|8
)braket
suffix:semicolon
id|pnpbios_parse_allocated_memresource
c_func
(paren
id|res
comma
id|io
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_IRQ
suffix:colon
r_if
c_cond
(paren
id|len
template_param
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
op_minus
l_int|1
suffix:semicolon
id|mask
op_assign
id|p
(braket
l_int|1
)braket
op_plus
id|p
(braket
l_int|2
)braket
op_star
l_int|256
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
comma
id|mask
op_assign
id|mask
op_rshift
l_int|1
)paren
r_if
c_cond
(paren
id|mask
op_amp
l_int|0x01
)paren
(brace
id|io
op_assign
id|i
suffix:semicolon
)brace
id|pnpbios_parse_allocated_irqresource
c_func
(paren
id|res
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_DMA
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|2
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
op_minus
l_int|1
suffix:semicolon
id|mask
op_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
id|mask
op_assign
id|mask
op_rshift
l_int|1
)paren
r_if
c_cond
(paren
id|mask
op_amp
l_int|0x01
)paren
(brace
id|io
op_assign
id|i
suffix:semicolon
)brace
id|pnpbios_parse_allocated_dmaresource
c_func
(paren
id|res
comma
id|io
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_PORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|7
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
id|p
(braket
l_int|2
)braket
op_plus
id|p
(braket
l_int|3
)braket
op_star
l_int|256
suffix:semicolon
id|size
op_assign
id|p
(braket
l_int|7
)braket
suffix:semicolon
id|pnpbios_parse_allocated_ioresource
c_func
(paren
id|res
comma
id|io
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_VENDOR
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
r_case
id|SMALL_TAG_FIXEDPORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|io
op_assign
id|p
(braket
l_int|1
)braket
op_plus
id|p
(braket
l_int|2
)braket
op_star
l_int|256
suffix:semicolon
id|size
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|pnpbios_parse_allocated_ioresource
c_func
(paren
id|res
comma
id|io
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_END
suffix:colon
id|p
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
r_return
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* an unkown tag */
id|len_err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Unknown tag &squot;0x%x&squot;, length &squot;%d&squot;.&bslash;n&quot;
comma
id|tag
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* continue to the next tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
id|p
op_add_assign
id|len
op_plus
l_int|3
suffix:semicolon
r_else
id|p
op_add_assign
id|len
op_plus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Resource structure does not contain an end tag.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Resource Configuration Options&n; */
r_static
r_void
DECL|function|pnpbios_parse_mem_option
id|pnpbios_parse_mem_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|mem
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
(paren
(paren
id|p
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|4
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;max
op_assign
(paren
(paren
id|p
(braket
l_int|7
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|6
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;align
op_assign
(paren
id|p
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|8
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
(paren
id|p
(braket
l_int|11
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|10
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;flags
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_mem32_option
id|pnpbios_parse_mem32_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|mem
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
(paren
id|p
(braket
l_int|7
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|6
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|mem-&gt;max
op_assign
(paren
id|p
(braket
l_int|11
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|10
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|8
)braket
suffix:semicolon
id|mem-&gt;align
op_assign
(paren
id|p
(braket
l_int|15
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|14
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|13
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|12
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
id|p
(braket
l_int|19
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|18
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|17
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|16
)braket
suffix:semicolon
id|mem-&gt;flags
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_fixed_mem32_option
id|pnpbios_parse_fixed_mem32_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|mem
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
id|mem-&gt;max
op_assign
(paren
id|p
(braket
l_int|7
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|6
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
id|p
(braket
l_int|11
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|p
(braket
l_int|10
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|p
(braket
l_int|9
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|8
)braket
suffix:semicolon
id|mem-&gt;align
op_assign
l_int|0
suffix:semicolon
id|mem-&gt;flags
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_irq_option
id|pnpbios_parse_irq_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_int
r_int
id|bits
suffix:semicolon
id|irq
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_irq
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
suffix:semicolon
id|bits
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|bitmap_copy
c_func
(paren
id|irq-&gt;map
comma
op_amp
id|bits
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|2
)paren
id|irq-&gt;flags
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
r_else
id|irq-&gt;flags
op_assign
id|IORESOURCE_IRQ_HIGHEDGE
suffix:semicolon
id|pnp_register_irq_resource
c_func
(paren
id|option
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_dma_option
id|pnpbios_parse_dma_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_dma
op_star
id|dma
suffix:semicolon
id|dma
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_dma
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
suffix:semicolon
id|dma-&gt;map
op_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|dma-&gt;flags
op_assign
id|p
(braket
l_int|2
)braket
suffix:semicolon
id|pnp_register_dma_resource
c_func
(paren
id|option
comma
id|dma
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_port_option
id|pnpbios_parse_port_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
id|port
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
(paren
id|p
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|2
)braket
suffix:semicolon
id|port-&gt;max
op_assign
(paren
id|p
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|4
)braket
suffix:semicolon
id|port-&gt;align
op_assign
id|p
(braket
l_int|6
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|p
(braket
l_int|7
)braket
suffix:semicolon
id|port-&gt;flags
op_assign
id|p
(braket
l_int|1
)braket
ques
c_cond
id|PNP_PORT_FLAG_16BITADDR
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|pnpbios_parse_fixed_port_option
id|pnpbios_parse_fixed_port_option
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
id|size
comma
r_struct
id|pnp_option
op_star
id|option
)paren
(brace
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
id|port
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
id|port-&gt;max
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|p
(braket
l_int|3
)braket
suffix:semicolon
id|port-&gt;align
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_assign
id|PNP_PORT_FLAG_FIXED
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
r_char
op_star
DECL|function|pnpbios_parse_resource_option_data
id|pnpbios_parse_resource_option_data
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
r_char
op_star
id|end
comma
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_int
r_int
id|len
comma
id|tag
suffix:semicolon
r_int
id|priority
op_assign
l_int|0
suffix:semicolon
r_struct
id|pnp_option
op_star
id|option
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
id|option
op_assign
id|pnp_register_independent_option
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
r_return
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
r_char
op_star
)paren
id|p
OL
(paren
r_char
op_star
)paren
id|end
)paren
(brace
multiline_comment|/* determine the type of tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
(brace
multiline_comment|/* large tag */
id|len
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|tag
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* small tag */
id|len
op_assign
id|p
(braket
l_int|0
)braket
op_amp
l_int|0x07
suffix:semicolon
id|tag
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tag
)paren
(brace
r_case
id|LARGE_TAG_MEM
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_mem_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_MEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|17
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_mem32_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_FIXEDMEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_fixed_mem32_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_IRQ
suffix:colon
r_if
c_cond
(paren
id|len
template_param
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_irq_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_DMA
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|2
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_dma_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_PORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|7
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_port_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_VENDOR
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
r_case
id|SMALL_TAG_FIXEDPORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_parse_fixed_port_option
c_func
(paren
id|p
comma
id|len
comma
id|option
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_STARTDEP
suffix:colon
r_if
c_cond
(paren
id|len
OG
l_int|1
)paren
r_goto
id|len_err
suffix:semicolon
id|priority
op_assign
l_int|0x100
op_or
id|PNP_RES_PRIORITY_ACCEPTABLE
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
id|priority
op_assign
l_int|0x100
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|option
op_assign
id|pnp_register_dependent_option
c_func
(paren
id|dev
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
r_return
l_int|NULL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_ENDDEP
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|0
)paren
r_goto
id|len_err
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_END
suffix:colon
id|p
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
r_return
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* an unkown tag */
id|len_err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Unknown tag &squot;0x%x&squot;, length &squot;%d&squot;.&bslash;n&quot;
comma
id|tag
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* continue to the next tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
id|p
op_add_assign
id|len
op_plus
l_int|3
suffix:semicolon
r_else
id|p
op_add_assign
id|len
op_plus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Resource structure does not contain an end tag.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Compatible Device IDs&n; */
DECL|macro|HEX
mdefine_line|#define HEX(id,a) hex[((id)&gt;&gt;a) &amp; 15]
DECL|macro|CHAR
mdefine_line|#define CHAR(id,a) (0x40 + (((id)&gt;&gt;a) &amp; 31))
singleline_comment|//
DECL|function|pnpid32_to_pnpid
r_void
id|pnpid32_to_pnpid
c_func
(paren
id|u32
id|id
comma
r_char
op_star
id|str
)paren
(brace
r_const
r_char
op_star
id|hex
op_assign
l_string|&quot;0123456789abcdef&quot;
suffix:semicolon
id|id
op_assign
id|be32_to_cpu
c_func
(paren
id|id
)paren
suffix:semicolon
id|str
(braket
l_int|0
)braket
op_assign
id|CHAR
c_func
(paren
id|id
comma
l_int|26
)paren
suffix:semicolon
id|str
(braket
l_int|1
)braket
op_assign
id|CHAR
c_func
(paren
id|id
comma
l_int|21
)paren
suffix:semicolon
id|str
(braket
l_int|2
)braket
op_assign
id|CHAR
c_func
(paren
id|id
comma
l_int|16
)paren
suffix:semicolon
id|str
(braket
l_int|3
)braket
op_assign
id|HEX
c_func
(paren
id|id
comma
l_int|12
)paren
suffix:semicolon
id|str
(braket
l_int|4
)braket
op_assign
id|HEX
c_func
(paren
id|id
comma
l_int|8
)paren
suffix:semicolon
id|str
(braket
l_int|5
)braket
op_assign
id|HEX
c_func
(paren
id|id
comma
l_int|4
)paren
suffix:semicolon
id|str
(braket
l_int|6
)braket
op_assign
id|HEX
c_func
(paren
id|id
comma
l_int|0
)paren
suffix:semicolon
id|str
(braket
l_int|7
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|//
DECL|macro|CHAR
macro_line|#undef CHAR
DECL|macro|HEX
macro_line|#undef HEX
r_static
r_int
r_char
op_star
DECL|function|pnpbios_parse_compatible_ids
id|pnpbios_parse_compatible_ids
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
r_char
op_star
id|end
comma
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_int
id|len
comma
id|tag
suffix:semicolon
r_char
id|id
(braket
l_int|8
)braket
suffix:semicolon
r_struct
id|pnp_id
op_star
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
r_char
op_star
)paren
id|p
OL
(paren
r_char
op_star
)paren
id|end
)paren
(brace
multiline_comment|/* determine the type of tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
(brace
multiline_comment|/* large tag */
id|len
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|tag
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* small tag */
id|len
op_assign
id|p
(braket
l_int|0
)braket
op_amp
l_int|0x07
suffix:semicolon
id|tag
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tag
)paren
(brace
r_case
id|LARGE_TAG_ANSISTR
suffix:colon
id|strncpy
c_func
(paren
id|dev-&gt;name
comma
id|p
op_plus
l_int|3
comma
id|len
op_ge
id|PNP_NAME_LEN
ques
c_cond
id|PNP_NAME_LEN
op_minus
l_int|2
suffix:colon
id|len
)paren
suffix:semicolon
id|dev-&gt;name
(braket
id|len
op_ge
id|PNP_NAME_LEN
ques
c_cond
id|PNP_NAME_LEN
op_minus
l_int|1
suffix:colon
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_COMPATDEVID
suffix:colon
multiline_comment|/* compatible ID */
r_if
c_cond
(paren
id|len
op_ne
l_int|4
)paren
r_goto
id|len_err
suffix:semicolon
id|dev_id
op_assign
id|pnpbios_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_id
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_id
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|dev_id
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|pnp_id
)paren
)paren
suffix:semicolon
id|pnpid32_to_pnpid
c_func
(paren
id|p
(braket
l_int|1
)braket
op_or
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
op_or
id|p
(braket
l_int|3
)braket
op_lshift
l_int|16
op_or
id|p
(braket
l_int|4
)braket
op_lshift
l_int|24
comma
id|id
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|dev_id-&gt;id
comma
id|id
comma
l_int|7
)paren
suffix:semicolon
id|pnp_add_id
c_func
(paren
id|dev_id
comma
id|dev
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_END
suffix:colon
id|p
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
r_return
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* an unkown tag */
id|len_err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Unknown tag &squot;0x%x&squot;, length &squot;%d&squot;.&bslash;n&quot;
comma
id|tag
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* continue to the next tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
id|p
op_add_assign
id|len
op_plus
l_int|3
suffix:semicolon
r_else
id|p
op_add_assign
id|len
op_plus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Resource structure does not contain an end tag.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Allocated Resource Encoding&n; */
DECL|function|pnpbios_encode_mem
r_static
r_void
id|pnpbios_encode_mem
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|base
op_assign
id|res-&gt;start
suffix:semicolon
r_int
r_int
id|len
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
id|p
(braket
l_int|4
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|5
)braket
op_assign
(paren
(paren
id|base
op_rshift
l_int|8
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|6
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|7
)braket
op_assign
(paren
(paren
id|base
op_rshift
l_int|8
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|10
)braket
op_assign
(paren
id|len
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|11
)braket
op_assign
(paren
(paren
id|len
op_rshift
l_int|8
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_mem32
r_static
r_void
id|pnpbios_encode_mem32
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|base
op_assign
id|res-&gt;start
suffix:semicolon
r_int
r_int
id|len
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
id|p
(braket
l_int|4
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|5
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|6
)braket
op_assign
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|7
)braket
op_assign
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|8
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|9
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|10
)braket
op_assign
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|11
)braket
op_assign
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|16
)braket
op_assign
id|len
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|17
)braket
op_assign
(paren
id|len
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|18
)braket
op_assign
(paren
id|len
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|19
)braket
op_assign
(paren
id|len
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_fixed_mem32
r_static
r_void
id|pnpbios_encode_fixed_mem32
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|base
op_assign
id|res-&gt;start
suffix:semicolon
r_int
r_int
id|len
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
id|p
(braket
l_int|4
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|5
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|6
)braket
op_assign
(paren
id|base
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|7
)braket
op_assign
(paren
id|base
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|8
)braket
op_assign
id|len
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|9
)braket
op_assign
(paren
id|len
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|10
)braket
op_assign
(paren
id|len
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|11
)braket
op_assign
(paren
id|len
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_irq
r_static
r_void
id|pnpbios_encode_irq
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|map
op_assign
l_int|0
suffix:semicolon
id|map
op_assign
l_int|1
op_lshift
id|res-&gt;start
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|map
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
(paren
id|map
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_dma
r_static
r_void
id|pnpbios_encode_dma
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|map
op_assign
l_int|0
suffix:semicolon
id|map
op_assign
l_int|1
op_lshift
id|res-&gt;start
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|map
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_port
r_static
r_void
id|pnpbios_encode_port
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|base
op_assign
id|res-&gt;start
suffix:semicolon
r_int
r_int
id|len
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|4
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|5
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|7
)braket
op_assign
id|len
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnpbios_encode_fixed_port
r_static
r_void
id|pnpbios_encode_fixed_port
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_struct
id|resource
op_star
id|res
)paren
(brace
r_int
r_int
id|base
op_assign
id|res-&gt;start
suffix:semicolon
r_int
r_int
id|len
op_assign
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|base
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
(paren
id|base
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
id|len
op_amp
l_int|0xff
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
r_char
op_star
DECL|function|pnpbios_encode_allocated_resource_data
id|pnpbios_encode_allocated_resource_data
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
r_char
op_star
id|end
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
r_int
r_int
id|len
comma
id|tag
suffix:semicolon
r_int
id|port
op_assign
l_int|0
comma
id|irq
op_assign
l_int|0
comma
id|dma
op_assign
l_int|0
comma
id|mem
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
r_char
op_star
)paren
id|p
OL
(paren
r_char
op_star
)paren
id|end
)paren
(brace
multiline_comment|/* determine the type of tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
(brace
multiline_comment|/* large tag */
id|len
op_assign
(paren
id|p
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|p
(braket
l_int|1
)braket
suffix:semicolon
id|tag
op_assign
id|p
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* small tag */
id|len
op_assign
id|p
(braket
l_int|0
)braket
op_amp
l_int|0x07
suffix:semicolon
id|tag
op_assign
(paren
(paren
id|p
(braket
l_int|0
)braket
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|tag
)paren
(brace
r_case
id|LARGE_TAG_MEM
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_mem
c_func
(paren
id|p
comma
op_amp
id|res-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_MEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|17
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_mem32
c_func
(paren
id|p
comma
op_amp
id|res-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LARGE_TAG_FIXEDMEM32
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|9
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_fixed_mem32
c_func
(paren
id|p
comma
op_amp
id|res-&gt;mem_resource
(braket
id|mem
)braket
)paren
suffix:semicolon
id|mem
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_IRQ
suffix:colon
r_if
c_cond
(paren
id|len
template_param
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_irq
c_func
(paren
id|p
comma
op_amp
id|res-&gt;irq_resource
(braket
id|irq
)braket
)paren
suffix:semicolon
id|irq
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_DMA
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|2
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_dma
c_func
(paren
id|p
comma
op_amp
id|res-&gt;dma_resource
(braket
id|dma
)braket
)paren
suffix:semicolon
id|dma
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_PORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|7
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_port
c_func
(paren
id|p
comma
op_amp
id|res-&gt;port_resource
(braket
id|port
)braket
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_VENDOR
suffix:colon
multiline_comment|/* do nothing */
r_break
suffix:semicolon
r_case
id|SMALL_TAG_FIXEDPORT
suffix:colon
r_if
c_cond
(paren
id|len
op_ne
l_int|3
)paren
r_goto
id|len_err
suffix:semicolon
id|pnpbios_encode_fixed_port
c_func
(paren
id|p
comma
op_amp
id|res-&gt;port_resource
(braket
id|port
)braket
)paren
suffix:semicolon
id|port
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SMALL_TAG_END
suffix:colon
id|p
op_assign
id|p
op_plus
l_int|2
suffix:semicolon
r_return
(paren
r_int
r_char
op_star
)paren
id|p
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* an unkown tag */
id|len_err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Unknown tag &squot;0x%x&squot;, length &squot;%d&squot;.&bslash;n&quot;
comma
id|tag
comma
id|len
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* continue to the next tag */
r_if
c_cond
(paren
id|p
(braket
l_int|0
)braket
op_amp
id|LARGE_TAG
)paren
id|p
op_add_assign
id|len
op_plus
l_int|3
suffix:semicolon
r_else
id|p
op_add_assign
id|len
op_plus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;PnPBIOS: Resource structure does not contain an end tag.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Core Parsing Functions&n; */
r_int
DECL|function|pnpbios_parse_data_stream
id|pnpbios_parse_data_stream
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_bios_node
op_star
id|node
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|node-&gt;data
suffix:semicolon
r_int
r_char
op_star
id|end
op_assign
(paren
r_char
op_star
)paren
(paren
id|node-&gt;data
op_plus
id|node-&gt;size
)paren
suffix:semicolon
id|p
op_assign
id|pnpbios_parse_allocated_resource_data
c_func
(paren
id|p
comma
id|end
comma
op_amp
id|dev-&gt;res
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|p
op_assign
id|pnpbios_parse_resource_option_data
c_func
(paren
id|p
comma
id|end
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|p
op_assign
id|pnpbios_parse_compatible_ids
c_func
(paren
id|p
comma
id|end
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|pnpbios_read_resources_from_node
id|pnpbios_read_resources_from_node
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_struct
id|pnp_bios_node
op_star
id|node
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|node-&gt;data
suffix:semicolon
r_int
r_char
op_star
id|end
op_assign
(paren
r_char
op_star
)paren
(paren
id|node-&gt;data
op_plus
id|node-&gt;size
)paren
suffix:semicolon
id|p
op_assign
id|pnpbios_parse_allocated_resource_data
c_func
(paren
id|p
comma
id|end
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|pnpbios_write_resources_to_node
id|pnpbios_write_resources_to_node
c_func
(paren
r_struct
id|pnp_resource_table
op_star
id|res
comma
r_struct
id|pnp_bios_node
op_star
id|node
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|node-&gt;data
suffix:semicolon
r_int
r_char
op_star
id|end
op_assign
(paren
r_char
op_star
)paren
(paren
id|node-&gt;data
op_plus
id|node-&gt;size
)paren
suffix:semicolon
id|p
op_assign
id|pnpbios_encode_allocated_resource_data
c_func
(paren
id|p
comma
id|end
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
