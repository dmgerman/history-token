multiline_comment|/*&n; *  ISA Plug &amp; Play support&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Changelog:&n; *  2000-01-01&t;Added quirks handling for buggy hardware&n; *&t;&t;Peter Denison &lt;peterd@pnd-pc.demon.co.uk&gt;&n; *  2000-06-14&t;Added isapnp_probe_devs() and isapnp_activate_dev()&n; *&t;&t;Christoph Hellwig &lt;hch@infradead.org&gt;&n; *  2001-06-03  Added release_region calls to correspond with&n; *&t;&t;request_region calls when a failure occurs.  Also&n; *&t;&t;added KERN_* constants to printk() calls.&n; *  2001-11-07  Added isapnp_{,un}register_driver calls along the lines&n; *              of the pci driver interface&n; *              Kai Germaschewski &lt;kai.germaschewski@gmx.de&gt;&n; *  2002-06-06  Made the use of dma channel 0 configurable&n; *              Gerald Teschl &lt;gerald.teschl@univie.ac.at&gt;&n; *  2002-10-06  Ported to PnP Layer - Adam Belay &lt;ambx1@neo.rr.com&gt;&n; *  2003-08-11&t;Resource Management Updates - Adam Belay &lt;ambx1@neo.rr.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#if 0
mdefine_line|#define ISAPNP_REGION_OK
macro_line|#endif
macro_line|#if 0
mdefine_line|#define ISAPNP_DEBUG
macro_line|#endif
DECL|variable|isapnp_disable
r_int
id|isapnp_disable
suffix:semicolon
multiline_comment|/* Disable ISA PnP */
DECL|variable|isapnp_rdp
r_int
id|isapnp_rdp
suffix:semicolon
multiline_comment|/* Read Data Port */
DECL|variable|isapnp_reset
r_int
id|isapnp_reset
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* reset all PnP cards (deactivate) */
DECL|variable|isapnp_verbose
r_int
id|isapnp_verbose
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* verbose mode */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Generic ISA Plug &amp; Play support&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|isapnp_disable
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_disable
comma
l_string|&quot;ISA Plug &amp; Play disable&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|isapnp_rdp
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_rdp
comma
l_string|&quot;ISA Plug &amp; Play read data port&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|isapnp_reset
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_reset
comma
l_string|&quot;ISA Plug &amp; Play reset all cards&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|isapnp_verbose
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|isapnp_verbose
comma
l_string|&quot;ISA Plug &amp; Play verbose mode&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|_PIDXR
mdefine_line|#define _PIDXR&t;&t;0x279
DECL|macro|_PNPWRP
mdefine_line|#define _PNPWRP&t;&t;0xa79
multiline_comment|/* short tags */
DECL|macro|_STAG_PNPVERNO
mdefine_line|#define _STAG_PNPVERNO&t;&t;0x01
DECL|macro|_STAG_LOGDEVID
mdefine_line|#define _STAG_LOGDEVID&t;&t;0x02
DECL|macro|_STAG_COMPATDEVID
mdefine_line|#define _STAG_COMPATDEVID&t;0x03
DECL|macro|_STAG_IRQ
mdefine_line|#define _STAG_IRQ&t;&t;0x04
DECL|macro|_STAG_DMA
mdefine_line|#define _STAG_DMA&t;&t;0x05
DECL|macro|_STAG_STARTDEP
mdefine_line|#define _STAG_STARTDEP&t;&t;0x06
DECL|macro|_STAG_ENDDEP
mdefine_line|#define _STAG_ENDDEP&t;&t;0x07
DECL|macro|_STAG_IOPORT
mdefine_line|#define _STAG_IOPORT&t;&t;0x08
DECL|macro|_STAG_FIXEDIO
mdefine_line|#define _STAG_FIXEDIO&t;&t;0x09
DECL|macro|_STAG_VENDOR
mdefine_line|#define _STAG_VENDOR&t;&t;0x0e
DECL|macro|_STAG_END
mdefine_line|#define _STAG_END&t;&t;0x0f
multiline_comment|/* long tags */
DECL|macro|_LTAG_MEMRANGE
mdefine_line|#define _LTAG_MEMRANGE&t;&t;0x81
DECL|macro|_LTAG_ANSISTR
mdefine_line|#define _LTAG_ANSISTR&t;&t;0x82
DECL|macro|_LTAG_UNICODESTR
mdefine_line|#define _LTAG_UNICODESTR&t;0x83
DECL|macro|_LTAG_VENDOR
mdefine_line|#define _LTAG_VENDOR&t;&t;0x84
DECL|macro|_LTAG_MEM32RANGE
mdefine_line|#define _LTAG_MEM32RANGE&t;0x85
DECL|macro|_LTAG_FIXEDMEM32RANGE
mdefine_line|#define _LTAG_FIXEDMEM32RANGE&t;0x86
DECL|variable|isapnp_checksum_value
r_static
r_int
r_char
id|isapnp_checksum_value
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|isapnp_cfg_mutex
)paren
suffix:semicolon
DECL|variable|isapnp_detected
r_static
r_int
id|isapnp_detected
suffix:semicolon
DECL|variable|isapnp_csn_count
r_static
r_int
id|isapnp_csn_count
suffix:semicolon
multiline_comment|/* some prototypes */
DECL|function|write_data
r_static
r_inline
r_void
id|write_data
c_func
(paren
r_int
r_char
id|x
)paren
(brace
id|outb
c_func
(paren
id|x
comma
id|_PNPWRP
)paren
suffix:semicolon
)brace
DECL|function|write_address
r_static
r_inline
r_void
id|write_address
c_func
(paren
r_int
r_char
id|x
)paren
(brace
id|outb
c_func
(paren
id|x
comma
id|_PIDXR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
)brace
DECL|function|read_data
r_static
r_inline
r_int
r_char
id|read_data
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|val
op_assign
id|inb
c_func
(paren
id|isapnp_rdp
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_read_byte
r_int
r_char
id|isapnp_read_byte
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
id|write_address
c_func
(paren
id|idx
)paren
suffix:semicolon
r_return
id|read_data
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|isapnp_read_word
r_int
r_int
id|isapnp_read_word
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|isapnp_read_byte
c_func
(paren
id|idx
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|1
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_read_dword
r_int
r_int
id|isapnp_read_dword
c_func
(paren
r_int
r_char
id|idx
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|isapnp_read_byte
c_func
(paren
id|idx
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|1
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|2
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_lshift
l_int|8
)paren
op_plus
id|isapnp_read_byte
c_func
(paren
id|idx
op_plus
l_int|3
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|isapnp_write_byte
r_void
id|isapnp_write_byte
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_char
id|val
)paren
(brace
id|write_address
c_func
(paren
id|idx
)paren
suffix:semicolon
id|write_data
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_write_word
r_void
id|isapnp_write_word
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_int
id|val
)paren
(brace
id|isapnp_write_byte
c_func
(paren
id|idx
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|1
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_write_dword
r_void
id|isapnp_write_dword
c_func
(paren
r_int
r_char
id|idx
comma
r_int
r_int
id|val
)paren
(brace
id|isapnp_write_byte
c_func
(paren
id|idx
comma
id|val
op_rshift
l_int|24
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|1
comma
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|2
comma
id|val
op_rshift
l_int|8
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|idx
op_plus
l_int|3
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|isapnp_alloc
r_void
op_star
id|isapnp_alloc
c_func
(paren
r_int
id|size
)paren
(brace
r_void
op_star
id|result
suffix:semicolon
id|result
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|result
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|result
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|isapnp_key
r_static
r_void
id|isapnp_key
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|code
op_assign
l_int|0x6a
comma
id|msb
suffix:semicolon
r_int
id|i
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|write_address
c_func
(paren
id|code
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|msb
op_assign
(paren
(paren
id|code
op_amp
l_int|0x01
)paren
op_xor
(paren
(paren
id|code
op_amp
l_int|0x02
)paren
op_rshift
l_int|1
)paren
)paren
op_lshift
l_int|7
suffix:semicolon
id|code
op_assign
(paren
id|code
op_rshift
l_int|1
)paren
op_or
id|msb
suffix:semicolon
id|write_address
c_func
(paren
id|code
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* place all pnp cards in wait-for-key state */
DECL|function|isapnp_wait
r_static
r_void
id|isapnp_wait
c_func
(paren
r_void
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x02
comma
l_int|0x02
)paren
suffix:semicolon
)brace
DECL|function|isapnp_wake
r_void
id|isapnp_wake
c_func
(paren
r_int
r_char
id|csn
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x03
comma
id|csn
)paren
suffix:semicolon
)brace
DECL|function|isapnp_device
r_void
id|isapnp_device
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x07
comma
id|logdev
)paren
suffix:semicolon
)brace
DECL|function|isapnp_activate
r_void
id|isapnp_activate
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_ACTIVATE
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
DECL|function|isapnp_deactivate
r_void
id|isapnp_deactivate
c_func
(paren
r_int
r_char
id|logdev
)paren
(brace
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_ACTIVATE
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
)brace
DECL|function|isapnp_peek
r_static
r_void
id|__init
id|isapnp_peek
c_func
(paren
r_int
r_char
op_star
id|data
comma
r_int
id|bytes
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|d
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|bytes
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|20
suffix:semicolon
id|j
op_increment
)paren
(brace
id|d
op_assign
id|isapnp_read_byte
c_func
(paren
l_int|0x05
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_amp
l_int|1
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d
op_amp
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
op_star
id|data
op_increment
op_assign
l_int|0xff
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|d
op_assign
id|isapnp_read_byte
c_func
(paren
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* PRESDI */
id|isapnp_checksum_value
op_add_assign
id|d
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ne
l_int|NULL
)paren
op_star
id|data
op_increment
op_assign
id|d
suffix:semicolon
)brace
)brace
DECL|macro|RDP_STEP
mdefine_line|#define RDP_STEP&t;32&t;/* minimum is 4 */
DECL|function|isapnp_next_rdp
r_static
r_int
id|isapnp_next_rdp
c_func
(paren
r_void
)paren
(brace
r_int
id|rdp
op_assign
id|isapnp_rdp
suffix:semicolon
r_static
r_int
id|old_rdp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|old_rdp
)paren
(brace
id|release_region
c_func
(paren
id|old_rdp
comma
l_int|1
)paren
suffix:semicolon
id|old_rdp
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rdp
op_le
l_int|0x3ff
)paren
(brace
multiline_comment|/*&n;&t;&t; *&t;We cannot use NE2000 probe spaces for ISAPnP or we&n;&t;&t; *&t;will lock up machines.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|rdp
template_param
l_int|0x380
)paren
op_logical_and
id|request_region
c_func
(paren
id|rdp
comma
l_int|1
comma
l_string|&quot;ISAPnP&quot;
)paren
)paren
(brace
id|isapnp_rdp
op_assign
id|rdp
suffix:semicolon
id|old_rdp
op_assign
id|rdp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rdp
op_add_assign
id|RDP_STEP
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Set read port address */
DECL|function|isapnp_set_rdp
r_static
r_inline
r_void
id|isapnp_set_rdp
c_func
(paren
r_void
)paren
(brace
id|isapnp_write_byte
c_func
(paren
l_int|0x00
comma
id|isapnp_rdp
op_rshift
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Perform an isolation. The port selection code now tries to avoid&n; *&t;&quot;dangerous to read&quot; ports.&n; */
DECL|function|isapnp_isolate_rdp_select
r_static
r_int
id|__init
id|isapnp_isolate_rdp_select
c_func
(paren
r_void
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Control: reset CSN and conditionally everything else too */
id|isapnp_write_byte
c_func
(paren
l_int|0x02
comma
id|isapnp_reset
ques
c_cond
l_int|0x05
suffix:colon
l_int|0x04
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
id|isapnp_wake
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_next_rdp
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Isolate (assign uniqued CSN) to all ISA PnP devices.&n; */
DECL|function|isapnp_isolate
r_static
r_int
id|__init
id|isapnp_isolate
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|checksum
op_assign
l_int|0x6a
suffix:semicolon
r_int
r_char
id|chksum
op_assign
l_int|0x00
suffix:semicolon
r_int
r_char
id|bit
op_assign
l_int|0x00
suffix:semicolon
r_int
id|data
suffix:semicolon
r_int
id|csn
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|iteration
op_assign
l_int|1
suffix:semicolon
id|isapnp_rdp
op_assign
l_int|0x213
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_isolate_rdp_select
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_assign
id|read_data
c_func
(paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|data
op_assign
id|data
op_or
id|read_data
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|0x55aa
)paren
id|bit
op_assign
l_int|0x01
suffix:semicolon
id|checksum
op_assign
(paren
(paren
(paren
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|1
)paren
)paren
op_amp
l_int|0x01
)paren
op_xor
id|bit
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|checksum
op_rshift
l_int|1
)paren
suffix:semicolon
id|bit
op_assign
l_int|0x00
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|65
suffix:semicolon
id|i
op_le
l_int|72
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_assign
id|read_data
c_func
(paren
)paren
op_lshift
l_int|8
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|data
op_assign
id|data
op_or
id|read_data
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|0x55aa
)paren
id|chksum
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|i
op_minus
l_int|65
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|checksum
op_ne
l_int|0x00
op_logical_and
id|checksum
op_eq
id|chksum
)paren
(brace
id|csn
op_increment
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
l_int|0x06
comma
id|csn
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|iteration
op_increment
suffix:semicolon
id|isapnp_wake
c_func
(paren
l_int|0x00
)paren
suffix:semicolon
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|write_address
c_func
(paren
l_int|0x01
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
r_goto
id|__next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iteration
op_eq
l_int|1
)paren
(brace
id|isapnp_rdp
op_add_assign
id|RDP_STEP
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_isolate_rdp_select
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|iteration
OG
l_int|1
)paren
(brace
r_break
suffix:semicolon
)brace
id|__next
suffix:colon
r_if
c_cond
(paren
id|csn
op_eq
l_int|255
)paren
r_break
suffix:semicolon
id|checksum
op_assign
l_int|0x6a
suffix:semicolon
id|chksum
op_assign
l_int|0x00
suffix:semicolon
id|bit
op_assign
l_int|0x00
suffix:semicolon
)brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_csn_count
op_assign
id|csn
suffix:semicolon
r_return
id|csn
suffix:semicolon
)brace
multiline_comment|/*&n; *  Read one tag from stream.&n; */
DECL|function|isapnp_read_tag
r_static
r_int
id|__init
id|isapnp_read_tag
c_func
(paren
r_int
r_char
op_star
id|type
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_int
r_char
id|tag
comma
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|isapnp_peek
c_func
(paren
op_amp
id|tag
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tag
op_eq
l_int|0
)paren
multiline_comment|/* invalid tag */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tag
op_amp
l_int|0x80
)paren
(brace
multiline_comment|/* large item */
op_star
id|type
op_assign
id|tag
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|2
)paren
suffix:semicolon
op_star
id|size
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
op_star
id|type
op_assign
(paren
id|tag
op_rshift
l_int|3
)paren
op_amp
l_int|0x0f
suffix:semicolon
op_star
id|size
op_assign
id|tag
op_amp
l_int|0x07
suffix:semicolon
)brace
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;tag = 0x%x, type = 0x%x, size = %i&bslash;n&quot;
comma
id|tag
comma
op_star
id|type
comma
op_star
id|size
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|type
op_eq
l_int|0
)paren
multiline_comment|/* wrong type */
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|type
op_eq
l_int|0xff
op_logical_and
op_star
id|size
op_eq
l_int|0xffff
)paren
multiline_comment|/* probably invalid data */
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Skip specified number of bytes from stream.&n; */
DECL|function|isapnp_skip_bytes
r_static
r_void
id|__init
id|isapnp_skip_bytes
c_func
(paren
r_int
id|count
)paren
(brace
id|isapnp_peek
c_func
(paren
l_int|NULL
comma
id|count
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse EISA id.&n; */
DECL|function|isapnp_parse_id
r_static
r_void
id|isapnp_parse_id
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
)paren
(brace
r_struct
id|pnp_id
op_star
id|id
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
suffix:semicolon
id|id
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_id
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
r_return
suffix:semicolon
id|sprintf
c_func
(paren
id|id-&gt;id
comma
l_string|&quot;%c%c%c%x%x%x%x&quot;
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
(paren
id|vendor
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|vendor
op_rshift
l_int|13
)paren
op_amp
l_int|7
)paren
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|8
)paren
op_amp
l_int|0x1f
)paren
op_minus
l_int|1
comma
(paren
id|device
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
comma
id|device
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|pnp_add_id
c_func
(paren
id|id
comma
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse logical device tag.&n; */
DECL|function|isapnp_parse_device
r_static
r_struct
id|pnp_dev
op_star
id|__init
id|isapnp_parse_device
c_func
(paren
r_struct
id|pnp_card
op_star
id|card
comma
r_int
id|size
comma
r_int
id|number
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|6
)braket
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|dev
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_dev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|dev-&gt;number
op_assign
id|number
suffix:semicolon
id|isapnp_parse_id
c_func
(paren
id|dev
comma
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
comma
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|dev-&gt;regs
op_assign
id|tmp
(braket
l_int|4
)braket
suffix:semicolon
id|dev-&gt;card
op_assign
id|card
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|5
)paren
id|dev-&gt;regs
op_or_assign
id|tmp
(braket
l_int|5
)braket
op_lshift
l_int|8
suffix:semicolon
id|dev-&gt;protocol
op_assign
op_amp
id|isapnp_protocol
suffix:semicolon
id|dev-&gt;capabilities
op_or_assign
id|PNP_CONFIGURABLE
suffix:semicolon
id|dev-&gt;capabilities
op_or_assign
id|PNP_READ
suffix:semicolon
id|dev-&gt;capabilities
op_or_assign
id|PNP_WRITE
suffix:semicolon
id|dev-&gt;capabilities
op_or_assign
id|PNP_DISABLE
suffix:semicolon
id|pnp_init_resource_table
c_func
(paren
op_amp
id|dev-&gt;res
)paren
suffix:semicolon
r_return
id|dev
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add IRQ resource to resources list.&n; */
DECL|function|isapnp_parse_irq_resource
r_static
r_void
id|__init
id|isapnp_parse_irq_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_int
r_int
id|bits
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|irq
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_irq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
suffix:semicolon
id|bits
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|bitmap_copy
c_func
(paren
id|irq-&gt;map
comma
op_amp
id|bits
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|2
)paren
id|irq-&gt;flags
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
r_else
id|irq-&gt;flags
op_assign
id|IORESOURCE_IRQ_HIGHEDGE
suffix:semicolon
id|pnp_register_irq_resource
c_func
(paren
id|option
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add DMA resource to resources list.&n; */
DECL|function|isapnp_parse_dma_resource
r_static
r_void
id|__init
id|isapnp_parse_dma_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|pnp_dma
op_star
id|dma
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|dma
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_dma
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
suffix:semicolon
id|dma-&gt;map
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|dma-&gt;flags
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|pnp_register_dma_resource
c_func
(paren
id|option
comma
id|dma
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add port resource to resources list.&n; */
DECL|function|isapnp_parse_port_resource
r_static
r_void
id|__init
id|isapnp_parse_port_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|port
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|port-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
id|port-&gt;align
op_assign
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|tmp
(braket
l_int|6
)braket
suffix:semicolon
id|port-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
ques
c_cond
id|PNP_PORT_FLAG_16BITADDR
suffix:colon
l_int|0
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add fixed port resource to resources list.&n; */
DECL|function|isapnp_parse_fixed_port_resource
r_static
r_void
id|__init
id|isapnp_parse_fixed_port_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|port
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_port
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
suffix:semicolon
id|port-&gt;min
op_assign
id|port-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|port-&gt;size
op_assign
id|tmp
(braket
l_int|2
)braket
suffix:semicolon
id|port-&gt;align
op_assign
l_int|0
suffix:semicolon
id|port-&gt;flags
op_assign
id|PNP_PORT_FLAG_FIXED
suffix:semicolon
id|pnp_register_port_resource
c_func
(paren
id|option
comma
id|port
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add memory resource to resources list.&n; */
DECL|function|isapnp_parse_mem_resource
r_static
r_void
id|__init
id|isapnp_parse_mem_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
(paren
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;max
op_assign
(paren
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|3
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;align
op_assign
(paren
id|tmp
(braket
l_int|6
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
(paren
id|tmp
(braket
l_int|8
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|7
)braket
)paren
op_lshift
l_int|8
suffix:semicolon
id|mem-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add 32-bit memory resource to resources list.&n; */
DECL|function|isapnp_parse_mem32_resource
r_static
r_void
id|__init
id|isapnp_parse_mem32_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mem-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|8
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|6
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|mem-&gt;align
op_assign
(paren
id|tmp
(braket
l_int|12
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|11
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|10
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
id|tmp
(braket
l_int|16
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|15
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|14
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|13
)braket
suffix:semicolon
id|mem-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add 32-bit fixed memory resource to resources list.&n; */
DECL|function|isapnp_parse_fixed_mem32_resource
r_static
r_void
id|__init
id|isapnp_parse_fixed_mem32_resource
c_func
(paren
r_struct
id|pnp_option
op_star
id|option
comma
r_int
id|size
)paren
(brace
r_int
r_char
id|tmp
(braket
l_int|9
)braket
suffix:semicolon
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|mem
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_mem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
suffix:semicolon
id|mem-&gt;min
op_assign
id|mem-&gt;max
op_assign
(paren
id|tmp
(braket
l_int|4
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|mem-&gt;size
op_assign
(paren
id|tmp
(braket
l_int|8
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|tmp
(braket
l_int|7
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|tmp
(braket
l_int|6
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|5
)braket
suffix:semicolon
id|mem-&gt;align
op_assign
l_int|0
suffix:semicolon
id|mem-&gt;flags
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|pnp_register_mem_resource
c_func
(paren
id|option
comma
id|mem
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse card name for ISA PnP device.&n; */
r_static
r_void
id|__init
DECL|function|isapnp_parse_name
id|isapnp_parse_name
c_func
(paren
r_char
op_star
id|name
comma
r_int
r_int
id|name_max
comma
r_int
r_int
op_star
id|size
)paren
(brace
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_int
r_int
id|size1
op_assign
op_star
id|size
op_ge
id|name_max
ques
c_cond
(paren
id|name_max
op_minus
l_int|1
)paren
suffix:colon
op_star
id|size
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|name
comma
id|size1
)paren
suffix:semicolon
id|name
(braket
id|size1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
op_star
id|size
op_sub_assign
id|size1
suffix:semicolon
multiline_comment|/* clean whitespace from end of string */
r_while
c_loop
(paren
id|size1
OG
l_int|0
op_logical_and
id|name
(braket
op_decrement
id|size1
)braket
op_eq
l_char|&squot; &squot;
)paren
id|name
(braket
id|size1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Parse resource map for logical device.&n; */
DECL|function|isapnp_create_device
r_static
r_int
id|__init
id|isapnp_create_device
c_func
(paren
r_struct
id|pnp_card
op_star
id|card
comma
r_int
r_int
id|size
)paren
(brace
r_int
id|number
op_assign
l_int|0
comma
id|skip
op_assign
l_int|0
comma
id|priority
op_assign
l_int|0
comma
id|compat
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|type
comma
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_struct
id|pnp_option
op_star
id|option
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|isapnp_parse_device
c_func
(paren
id|card
comma
id|size
comma
id|number
op_increment
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|option
op_assign
id|pnp_register_independent_option
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
(brace
id|kfree
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|pnp_add_card_device
c_func
(paren
id|card
comma
id|dev
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|isapnp_read_tag
c_func
(paren
op_amp
id|type
comma
op_amp
id|size
)paren
OL
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|skip
op_logical_and
id|type
op_ne
id|_STAG_LOGDEVID
op_logical_and
id|type
op_ne
id|_STAG_END
)paren
r_goto
id|__skip
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|_STAG_LOGDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_ge
l_int|5
op_logical_and
id|size
op_le
l_int|6
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|isapnp_parse_device
c_func
(paren
id|card
comma
id|size
comma
id|number
op_increment
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
l_int|1
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
id|skip
op_assign
l_int|0
suffix:semicolon
id|option
op_assign
id|pnp_register_independent_option
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
r_return
l_int|1
suffix:semicolon
id|pnp_add_card_device
c_func
(paren
id|card
comma
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|skip
op_assign
l_int|1
suffix:semicolon
)brace
id|priority
op_assign
l_int|0
suffix:semicolon
id|compat
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_COMPATDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_eq
l_int|4
op_logical_and
id|compat
OL
id|DEVICE_COUNT_COMPATIBLE
)paren
(brace
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|4
)paren
suffix:semicolon
id|isapnp_parse_id
c_func
(paren
id|dev
comma
(paren
id|tmp
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|0
)braket
comma
(paren
id|tmp
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|tmp
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|compat
op_increment
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_STAG_IRQ
suffix:colon
r_if
c_cond
(paren
id|size
template_param
l_int|3
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_irq_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_DMA
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|2
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_dma_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_STARTDEP
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|1
)paren
r_goto
id|__skip
suffix:semicolon
id|priority
op_assign
l_int|0x100
op_or
id|PNP_RES_PRIORITY_ACCEPTABLE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
id|isapnp_peek
c_func
(paren
id|tmp
comma
id|size
)paren
suffix:semicolon
id|priority
op_assign
l_int|0x100
op_or
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
id|option
op_assign
id|pnp_register_dependent_option
c_func
(paren
id|dev
comma
id|priority
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|option
)paren
r_return
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_ENDDEP
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|0
)paren
r_goto
id|__skip
suffix:semicolon
id|priority
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_IOPORT
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|7
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_port_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_FIXEDIO
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|3
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_fixed_port_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_MEMRANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|9
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_mem_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_ANSISTR
suffix:colon
id|isapnp_parse_name
c_func
(paren
id|dev-&gt;name
comma
r_sizeof
(paren
id|dev-&gt;name
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_UNICODESTR
suffix:colon
multiline_comment|/* silently ignore */
multiline_comment|/* who use unicode for hardware identification? */
r_break
suffix:semicolon
r_case
id|_LTAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_MEM32RANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|17
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_mem32_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_FIXEDMEM32RANGE
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|9
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_parse_fixed_mem32_resource
c_func
(paren
id|option
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_END
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: unexpected or unknown tag type 0x%x for logical device %i (device %i), ignored&bslash;n&quot;
comma
id|type
comma
id|dev-&gt;number
comma
id|card-&gt;number
)paren
suffix:semicolon
)brace
id|__skip
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse resource map for ISA PnP card.&n; */
DECL|function|isapnp_parse_resource_map
r_static
r_void
id|__init
id|isapnp_parse_resource_map
c_func
(paren
r_struct
id|pnp_card
op_star
id|card
)paren
(brace
r_int
r_char
id|type
comma
id|tmp
(braket
l_int|17
)braket
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|isapnp_read_tag
c_func
(paren
op_amp
id|type
comma
op_amp
id|size
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|_STAG_PNPVERNO
suffix:colon
r_if
c_cond
(paren
id|size
op_ne
l_int|2
)paren
r_goto
id|__skip
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|tmp
comma
l_int|2
)paren
suffix:semicolon
id|card-&gt;pnpver
op_assign
id|tmp
(braket
l_int|0
)braket
suffix:semicolon
id|card-&gt;productver
op_assign
id|tmp
(braket
l_int|1
)braket
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_STAG_LOGDEVID
suffix:colon
r_if
c_cond
(paren
id|size
op_ge
l_int|5
op_logical_and
id|size
op_le
l_int|6
)paren
(brace
r_if
c_cond
(paren
id|isapnp_create_device
c_func
(paren
id|card
comma
id|size
)paren
op_eq
l_int|1
)paren
r_return
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|_STAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_LTAG_ANSISTR
suffix:colon
id|isapnp_parse_name
c_func
(paren
id|card-&gt;name
comma
r_sizeof
(paren
id|card-&gt;name
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_LTAG_UNICODESTR
suffix:colon
multiline_comment|/* silently ignore */
multiline_comment|/* who use unicode for hardware identification? */
r_break
suffix:semicolon
r_case
id|_LTAG_VENDOR
suffix:colon
r_break
suffix:semicolon
r_case
id|_STAG_END
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: unexpected or unknown tag type 0x%x for device %i, ignored&bslash;n&quot;
comma
id|type
comma
id|card-&gt;number
)paren
suffix:semicolon
)brace
id|__skip
suffix:colon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
id|isapnp_skip_bytes
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Compute ISA PnP checksum for first eight bytes.&n; */
DECL|function|isapnp_checksum
r_static
r_int
r_char
id|__init
id|isapnp_checksum
c_func
(paren
r_int
r_char
op_star
id|data
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_char
id|checksum
op_assign
l_int|0x6a
comma
id|bit
comma
id|b
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|b
op_assign
id|data
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|bit
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|b
op_amp
(paren
l_int|1
op_lshift
id|j
)paren
)paren
id|bit
op_assign
l_int|1
suffix:semicolon
id|checksum
op_assign
(paren
(paren
(paren
(paren
id|checksum
op_xor
(paren
id|checksum
op_rshift
l_int|1
)paren
)paren
op_amp
l_int|0x01
)paren
op_xor
id|bit
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|checksum
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_return
id|checksum
suffix:semicolon
)brace
multiline_comment|/*&n; *  Parse EISA id for ISA PnP card.&n; */
DECL|function|isapnp_parse_card_id
r_static
r_void
id|isapnp_parse_card_id
c_func
(paren
r_struct
id|pnp_card
op_star
id|card
comma
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
)paren
(brace
r_struct
id|pnp_id
op_star
id|id
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_id
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
r_return
suffix:semicolon
id|sprintf
c_func
(paren
id|id-&gt;id
comma
l_string|&quot;%c%c%c%x%x%x%x&quot;
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
(paren
id|vendor
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|vendor
op_rshift
l_int|13
)paren
op_amp
l_int|7
)paren
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|8
)paren
op_amp
l_int|0x1f
)paren
op_minus
l_int|1
comma
(paren
id|device
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
comma
id|device
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|pnp_add_card_id
c_func
(paren
id|id
comma
id|card
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Build device list for all present ISA PnP devices.&n; */
DECL|function|isapnp_build_device_list
r_static
r_int
id|__init
id|isapnp_build_device_list
c_func
(paren
r_void
)paren
(brace
r_int
id|csn
suffix:semicolon
r_int
r_char
id|header
(braket
l_int|9
)braket
comma
id|checksum
suffix:semicolon
r_struct
id|pnp_card
op_star
id|card
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|csn
op_assign
l_int|1
suffix:semicolon
id|csn
op_le
id|isapnp_csn_count
suffix:semicolon
id|csn
op_increment
)paren
(brace
id|isapnp_wake
c_func
(paren
id|csn
)paren
suffix:semicolon
id|isapnp_peek
c_func
(paren
id|header
comma
l_int|9
)paren
suffix:semicolon
id|checksum
op_assign
id|isapnp_checksum
c_func
(paren
id|header
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vendor: %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|header
(braket
l_int|0
)braket
comma
id|header
(braket
l_int|1
)braket
comma
id|header
(braket
l_int|2
)braket
comma
id|header
(braket
l_int|3
)braket
comma
id|header
(braket
l_int|4
)braket
comma
id|header
(braket
l_int|5
)braket
comma
id|header
(braket
l_int|6
)braket
comma
id|header
(braket
l_int|7
)braket
comma
id|header
(braket
l_int|8
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;checksum = 0x%x&bslash;n&quot;
comma
id|checksum
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|card
op_assign
id|isapnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_card
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|card-&gt;number
op_assign
id|csn
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|card-&gt;devices
)paren
suffix:semicolon
id|isapnp_parse_card_id
c_func
(paren
id|card
comma
(paren
id|header
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|0
)braket
comma
(paren
id|header
(braket
l_int|3
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|card-&gt;serial
op_assign
(paren
id|header
(braket
l_int|7
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|header
(braket
l_int|6
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|header
(braket
l_int|5
)braket
op_lshift
l_int|8
)paren
op_or
id|header
(braket
l_int|4
)braket
suffix:semicolon
id|isapnp_checksum_value
op_assign
l_int|0x00
suffix:semicolon
id|isapnp_parse_resource_map
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_checksum_value
op_ne
l_int|0x00
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: checksum for device %i is not valid (0x%x)&bslash;n&quot;
comma
id|csn
comma
id|isapnp_checksum_value
)paren
suffix:semicolon
id|card-&gt;checksum
op_assign
id|isapnp_checksum_value
suffix:semicolon
id|card-&gt;protocol
op_assign
op_amp
id|isapnp_protocol
suffix:semicolon
id|pnp_add_card
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Basic configuration routines.&n; */
DECL|function|isapnp_present
r_int
id|isapnp_present
c_func
(paren
r_void
)paren
(brace
r_struct
id|pnp_card
op_star
id|card
suffix:semicolon
id|pnp_for_each_card
c_func
(paren
id|card
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;protocol
op_eq
op_amp
id|isapnp_protocol
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_cfg_begin
r_int
id|isapnp_cfg_begin
c_func
(paren
r_int
id|csn
comma
r_int
id|logdev
)paren
(brace
r_if
c_cond
(paren
id|csn
template_param
id|isapnp_csn_count
op_logical_or
id|logdev
OG
l_int|10
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|isapnp_cfg_mutex
)paren
suffix:semicolon
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|isapnp_key
c_func
(paren
)paren
suffix:semicolon
id|isapnp_wake
c_func
(paren
id|csn
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* to avoid malfunction when the isapnptools package is used */
multiline_comment|/* we must set RDP to our value again */
multiline_comment|/* it is possible to set RDP only in the isolation phase */
multiline_comment|/*   Jens Thoms Toerring &lt;Jens.Toerring@physik.fu-berlin.de&gt; */
id|isapnp_write_byte
c_func
(paren
l_int|0x02
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* clear CSN of card */
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
multiline_comment|/* is this necessary? */
id|isapnp_wake
c_func
(paren
id|csn
)paren
suffix:semicolon
multiline_comment|/* bring card into sleep state */
id|isapnp_wake
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* bring card into isolation state */
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* reset the RDP port */
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* delay 1000us */
id|isapnp_write_byte
c_func
(paren
l_int|0x06
comma
id|csn
)paren
suffix:semicolon
multiline_comment|/* reset CSN to previous value */
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
multiline_comment|/* is this necessary? */
macro_line|#endif
r_if
c_cond
(paren
id|logdev
op_ge
l_int|0
)paren
id|isapnp_device
c_func
(paren
id|logdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_cfg_end
r_int
id|isapnp_cfg_end
c_func
(paren
r_void
)paren
(brace
id|isapnp_wait
c_func
(paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|isapnp_cfg_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Inititialization.&n; */
DECL|variable|isapnp_protocol
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_protocol
)paren
suffix:semicolon
DECL|variable|isapnp_present
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_present
)paren
suffix:semicolon
DECL|variable|isapnp_cfg_begin
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_cfg_begin
)paren
suffix:semicolon
DECL|variable|isapnp_cfg_end
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_cfg_end
)paren
suffix:semicolon
DECL|variable|isapnp_read_byte
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_byte
)paren
suffix:semicolon
DECL|variable|isapnp_read_word
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_word
)paren
suffix:semicolon
DECL|variable|isapnp_read_dword
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_read_dword
)paren
suffix:semicolon
DECL|variable|isapnp_write_byte
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_byte
)paren
suffix:semicolon
DECL|variable|isapnp_write_word
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_word
)paren
suffix:semicolon
DECL|variable|isapnp_write_dword
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_write_dword
)paren
suffix:semicolon
DECL|variable|isapnp_wake
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_wake
)paren
suffix:semicolon
DECL|variable|isapnp_device
id|EXPORT_SYMBOL
c_func
(paren
id|isapnp_device
)paren
suffix:semicolon
DECL|function|isapnp_read_resources
r_static
r_int
id|isapnp_read_resources
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
r_int
id|tmp
comma
id|ret
suffix:semicolon
id|dev-&gt;active
op_assign
id|isapnp_read_byte
c_func
(paren
id|ISAPNP_CFG_ACTIVATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_PORT
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|ret
op_assign
id|isapnp_read_word
c_func
(paren
id|ISAPNP_CFG_PORT
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
r_continue
suffix:semicolon
id|res-&gt;port_resource
(braket
id|tmp
)braket
dot
id|start
op_assign
id|ret
suffix:semicolon
id|res-&gt;port_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_MEM
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|ret
op_assign
id|isapnp_read_word
c_func
(paren
id|ISAPNP_CFG_MEM
op_plus
(paren
id|tmp
op_lshift
l_int|3
)paren
)paren
op_lshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
r_continue
suffix:semicolon
id|res-&gt;mem_resource
(braket
id|tmp
)braket
dot
id|start
op_assign
id|ret
suffix:semicolon
id|res-&gt;mem_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_IRQ
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|ret
op_assign
(paren
id|isapnp_read_word
c_func
(paren
id|ISAPNP_CFG_IRQ
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
r_continue
suffix:semicolon
id|res-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|start
op_assign
id|res-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|end
op_assign
id|ret
suffix:semicolon
id|res-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|IORESOURCE_IRQ
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_DMA
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|ret
op_assign
id|isapnp_read_byte
c_func
(paren
id|ISAPNP_CFG_DMA
op_plus
id|tmp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|4
)paren
r_continue
suffix:semicolon
id|res-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|start
op_assign
id|res-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|end
op_assign
id|ret
suffix:semicolon
id|res-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_assign
id|IORESOURCE_DMA
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_get_resources
r_static
r_int
id|isapnp_get_resources
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
r_int
id|ret
suffix:semicolon
id|pnp_init_resource_table
c_func
(paren
id|res
)paren
suffix:semicolon
id|isapnp_cfg_begin
c_func
(paren
id|dev-&gt;card-&gt;number
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|ret
op_assign
id|isapnp_read_resources
c_func
(paren
id|dev
comma
id|res
)paren
suffix:semicolon
id|isapnp_cfg_end
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|isapnp_set_resources
r_static
r_int
id|isapnp_set_resources
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_resource_table
op_star
id|res
)paren
(brace
r_int
id|tmp
suffix:semicolon
id|isapnp_cfg_begin
c_func
(paren
id|dev-&gt;card-&gt;number
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|dev-&gt;active
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_PORT
op_logical_and
(paren
id|res-&gt;port_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
(paren
id|IORESOURCE_IO
op_or
id|IORESOURCE_UNSET
)paren
)paren
op_eq
id|IORESOURCE_IO
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_word
c_func
(paren
id|ISAPNP_CFG_PORT
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
comma
id|res-&gt;port_resource
(braket
id|tmp
)braket
dot
id|start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_IRQ
op_logical_and
(paren
id|res-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
(paren
id|IORESOURCE_IRQ
op_or
id|IORESOURCE_UNSET
)paren
)paren
op_eq
id|IORESOURCE_IRQ
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_int
id|irq
op_assign
id|res-&gt;irq_resource
(braket
id|tmp
)braket
dot
id|start
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
l_int|2
)paren
id|irq
op_assign
l_int|9
suffix:semicolon
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_IRQ
op_plus
(paren
id|tmp
op_lshift
l_int|1
)paren
comma
id|irq
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_DMA
op_logical_and
(paren
id|res-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
(paren
id|IORESOURCE_DMA
op_or
id|IORESOURCE_UNSET
)paren
)paren
op_eq
id|IORESOURCE_DMA
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_byte
c_func
(paren
id|ISAPNP_CFG_DMA
op_plus
id|tmp
comma
id|res-&gt;dma_resource
(braket
id|tmp
)braket
dot
id|start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
id|PNP_MAX_MEM
op_logical_and
(paren
id|res-&gt;mem_resource
(braket
id|tmp
)braket
dot
id|flags
op_amp
(paren
id|IORESOURCE_MEM
op_or
id|IORESOURCE_UNSET
)paren
)paren
op_eq
id|IORESOURCE_MEM
suffix:semicolon
id|tmp
op_increment
)paren
id|isapnp_write_word
c_func
(paren
id|ISAPNP_CFG_MEM
op_plus
(paren
id|tmp
op_lshift
l_int|3
)paren
comma
(paren
id|res-&gt;mem_resource
(braket
id|tmp
)braket
dot
id|start
op_rshift
l_int|8
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* FIXME: We aren&squot;t handling 32bit mems properly here */
id|isapnp_activate
c_func
(paren
id|dev-&gt;number
)paren
suffix:semicolon
id|isapnp_cfg_end
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|isapnp_disable_resources
r_static
r_int
id|isapnp_disable_resources
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_or
op_logical_neg
id|dev-&gt;active
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|isapnp_cfg_begin
c_func
(paren
id|dev-&gt;card-&gt;number
comma
id|dev-&gt;number
)paren
suffix:semicolon
id|isapnp_deactivate
c_func
(paren
id|dev-&gt;number
)paren
suffix:semicolon
id|dev-&gt;active
op_assign
l_int|0
suffix:semicolon
id|isapnp_cfg_end
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|isapnp_protocol
r_struct
id|pnp_protocol
id|isapnp_protocol
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ISA Plug and Play&quot;
comma
dot
id|get
op_assign
id|isapnp_get_resources
comma
dot
id|set
op_assign
id|isapnp_set_resources
comma
dot
id|disable
op_assign
id|isapnp_disable_resources
comma
)brace
suffix:semicolon
DECL|function|isapnp_init
r_int
id|__init
id|isapnp_init
c_func
(paren
r_void
)paren
(brace
r_int
id|cards
suffix:semicolon
r_struct
id|pnp_card
op_star
id|card
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_disable
)paren
(brace
id|isapnp_detected
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: ISA Plug &amp; Play support disabled&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef ISAPNP_REGION_OK
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|_PIDXR
comma
l_int|1
comma
l_string|&quot;isapnp index&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: Index Register 0x%x already used&bslash;n&quot;
comma
id|_PIDXR
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|_PNPWRP
comma
l_int|1
comma
l_string|&quot;isapnp write&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: Write Data Register 0x%x already used&bslash;n&quot;
comma
id|_PNPWRP
)paren
suffix:semicolon
macro_line|#ifdef ISAPNP_REGION_OK
id|release_region
c_func
(paren
id|_PIDXR
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pnp_register_protocol
c_func
(paren
op_amp
id|isapnp_protocol
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Print a message. The existing ISAPnP code is hanging machines&n;&t; *&t;so let the user know where.&n;&t; */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: Scanning for PnP cards...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_rdp
op_ge
l_int|0x203
op_logical_and
id|isapnp_rdp
op_le
l_int|0x3ff
)paren
(brace
id|isapnp_rdp
op_or_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|isapnp_rdp
comma
l_int|1
comma
l_string|&quot;isapnp read&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;isapnp: Read Data Register 0x%x already used&bslash;n&quot;
comma
id|isapnp_rdp
)paren
suffix:semicolon
macro_line|#ifdef ISAPNP_REGION_OK
id|release_region
c_func
(paren
id|_PIDXR
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|release_region
c_func
(paren
id|_PNPWRP
comma
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|isapnp_set_rdp
c_func
(paren
)paren
suffix:semicolon
)brace
id|isapnp_detected
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_rdp
template_param
l_int|0x3ff
)paren
(brace
id|cards
op_assign
id|isapnp_isolate
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cards
OL
l_int|0
op_logical_or
(paren
id|isapnp_rdp
template_param
l_int|0x3ff
)paren
)paren
(brace
macro_line|#ifdef ISAPNP_REGION_OK
id|release_region
c_func
(paren
id|_PIDXR
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|release_region
c_func
(paren
id|_PNPWRP
comma
l_int|1
)paren
suffix:semicolon
id|isapnp_detected
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: No Plug &amp; Play device found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|request_region
c_func
(paren
id|isapnp_rdp
comma
l_int|1
comma
l_string|&quot;isapnp read&quot;
)paren
suffix:semicolon
)brace
id|isapnp_build_device_list
c_func
(paren
)paren
suffix:semicolon
id|cards
op_assign
l_int|0
suffix:semicolon
id|protocol_for_each_card
c_func
(paren
op_amp
id|isapnp_protocol
comma
id|card
)paren
(brace
id|cards
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_verbose
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: Card &squot;%s&squot;&bslash;n&quot;
comma
id|card-&gt;name
(braket
l_int|0
)braket
ques
c_cond
id|card-&gt;name
suffix:colon
l_string|&quot;Unknown&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isapnp_verbose
OL
l_int|2
)paren
r_continue
suffix:semicolon
id|card_for_each_dev
c_func
(paren
id|card
comma
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp:   Device &squot;%s&squot;&bslash;n&quot;
comma
id|dev-&gt;name
(braket
l_int|0
)braket
ques
c_cond
id|dev-&gt;name
suffix:colon
l_string|&quot;Unknown&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|cards
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: %i Plug &amp; Play card%s detected total&bslash;n&quot;
comma
id|cards
comma
id|cards
OG
l_int|1
ques
c_cond
l_string|&quot;s&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;isapnp: No Plug &amp; Play card found&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|isapnp_proc_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|isapnp_init
id|device_initcall
c_func
(paren
id|isapnp_init
)paren
suffix:semicolon
multiline_comment|/* format is: noisapnp */
DECL|function|isapnp_setup_disable
r_static
r_int
id|__init
id|isapnp_setup_disable
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|isapnp_disable
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;noisapnp&quot;
comma
id|isapnp_setup_disable
)paren
suffix:semicolon
multiline_comment|/* format is: isapnp=rdp,reset,skip_pci_scan,verbose */
DECL|function|isapnp_setup_isapnp
r_static
r_int
id|__init
id|isapnp_setup_isapnp
c_func
(paren
r_char
op_star
id|str
)paren
(brace
(paren
r_void
)paren
(paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|isapnp_rdp
)paren
op_eq
l_int|2
)paren
op_logical_and
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|isapnp_reset
)paren
op_eq
l_int|2
)paren
op_logical_and
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|isapnp_verbose
)paren
op_eq
l_int|2
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;isapnp=&quot;
comma
id|isapnp_setup_isapnp
)paren
suffix:semicolon
eof
