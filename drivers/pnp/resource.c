multiline_comment|/*&n; * resource.c - contains resource management algorithms&n; *&n; * based on isapnp.c resource management (c) Jaroslav Kysela &lt;perex@suse.cz&gt;&n; * Copyright 2002 Adam Belay &lt;ambx1@neo.rr.com&gt;&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#ifdef CONFIG_PNP_DEBUG
DECL|macro|DEBUG
mdefine_line|#define DEBUG
macro_line|#else
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#endif
macro_line|#include &lt;linux/pnp.h&gt;
macro_line|#include &quot;base.h&quot;
DECL|variable|pnp_allow_dma0
r_int
id|pnp_allow_dma0
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* allow dma 0 during auto activation: -1=off (:default), 0=off (set by user), 1=on */
DECL|variable|pnp_skip_pci_scan
r_int
id|pnp_skip_pci_scan
suffix:semicolon
multiline_comment|/* skip PCI resource scanning */
DECL|variable|pnp_reserve_irq
r_int
id|pnp_reserve_irq
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some IRQ */
DECL|variable|pnp_reserve_dma
r_int
id|pnp_reserve_dma
(braket
l_int|8
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|7
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some DMA */
DECL|variable|pnp_reserve_io
r_int
id|pnp_reserve_io
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some I/O region */
DECL|variable|pnp_reserve_mem
r_int
id|pnp_reserve_mem
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
l_int|15
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* reserve (don&squot;t use) some memory region */
multiline_comment|/* resource information adding functions */
DECL|function|pnp_build_resource
r_struct
id|pnp_resources
op_star
id|pnp_build_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|dependent
)paren
(brace
r_struct
id|pnp_resources
op_star
id|res
comma
op_star
id|ptr
comma
op_star
id|ptra
suffix:semicolon
id|res
op_assign
id|pnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_resources
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|NULL
suffix:semicolon
id|ptr
op_assign
id|dev-&gt;res
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_logical_and
id|ptr-&gt;dependent
op_logical_and
id|dependent
)paren
(brace
multiline_comment|/* add to another list */
id|ptra
op_assign
id|ptr-&gt;dep
suffix:semicolon
r_while
c_loop
(paren
id|ptra
op_logical_and
id|ptra-&gt;dep
)paren
id|ptra
op_assign
id|ptra-&gt;dep
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ptra
)paren
id|ptr-&gt;dep
op_assign
id|res
suffix:semicolon
r_else
id|ptra-&gt;dep
op_assign
id|res
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|ptr
)paren
(brace
id|dev-&gt;res
op_assign
id|res
suffix:semicolon
)brace
r_else
(brace
id|kfree
c_func
(paren
id|res
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dependent
)paren
(brace
id|res-&gt;priority
op_assign
id|dependent
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;priority
OG
id|PNP_RES_PRIORITY_FUNCTIONAL
)paren
id|res-&gt;priority
op_assign
id|PNP_RES_PRIORITY_INVALID
suffix:semicolon
id|res-&gt;dependent
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|res-&gt;priority
op_assign
id|PNP_RES_PRIORITY_PREFERRED
suffix:semicolon
id|res-&gt;dependent
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|pnp_find_resources
r_struct
id|pnp_resources
op_star
id|pnp_find_resources
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|res
op_assign
id|dev-&gt;res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|depnum
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;dep
)paren
id|res
op_assign
id|res-&gt;dep
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|pnp_get_max_depnum
r_int
id|pnp_get_max_depnum
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_int
id|num
op_assign
l_int|0
suffix:semicolon
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|res
op_assign
id|dev-&gt;res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_while
c_loop
(paren
id|res-&gt;dep
)paren
(brace
id|res
op_assign
id|res-&gt;dep
suffix:semicolon
id|num
op_increment
suffix:semicolon
)brace
r_return
id|num
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add IRQ resource to resources list.&n; */
DECL|function|pnp_add_irq_resource
r_int
id|pnp_add_irq_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_irq
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_irq
op_star
id|ptr
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr
op_assign
id|res-&gt;irq
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|data
suffix:semicolon
r_else
id|res-&gt;irq
op_assign
id|data
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|data-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|pcibios_penalize_isa_irq
c_func
(paren
id|i
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add DMA resource to resources list.&n; */
DECL|function|pnp_add_dma_resource
r_int
id|pnp_add_dma_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_dma
op_star
id|data
)paren
(brace
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_dma
op_star
id|ptr
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr
op_assign
id|res-&gt;dma
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|data
suffix:semicolon
r_else
id|res-&gt;dma
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add port resource to resources list.&n; */
DECL|function|pnp_add_port_resource
r_int
id|pnp_add_port_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_port
op_star
id|data
)paren
(brace
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_port
op_star
id|ptr
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|data-&gt;res
op_assign
id|res
suffix:semicolon
id|ptr
op_assign
id|res-&gt;port
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|data
suffix:semicolon
r_else
id|res-&gt;port
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add memory resource to resources list.&n; */
DECL|function|pnp_add_mem_resource
r_int
id|pnp_add_mem_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_mem
op_star
id|data
)paren
(brace
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_mem
op_star
id|ptr
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr
op_assign
id|res-&gt;mem
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|data
suffix:semicolon
r_else
id|res-&gt;mem
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Add 32-bit memory resource to resources list.&n; */
DECL|function|pnp_add_mem32_resource
r_int
id|pnp_add_mem32_resource
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_mem32
op_star
id|data
)paren
(brace
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_mem32
op_star
id|ptr
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ptr
op_assign
id|res-&gt;mem32
suffix:semicolon
r_while
c_loop
(paren
id|ptr
op_logical_and
id|ptr-&gt;next
)paren
id|ptr
op_assign
id|ptr-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|ptr-&gt;next
op_assign
id|data
suffix:semicolon
r_else
id|res-&gt;mem32
op_assign
id|data
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* resource removing functions */
DECL|function|pnp_free_port
r_static
r_void
id|pnp_free_port
c_func
(paren
r_struct
id|pnp_port
op_star
id|port
)paren
(brace
r_struct
id|pnp_port
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|port
)paren
(brace
id|next
op_assign
id|port-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|port
)paren
suffix:semicolon
id|port
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|pnp_free_irq
r_static
r_void
id|pnp_free_irq
c_func
(paren
r_struct
id|pnp_irq
op_star
id|irq
)paren
(brace
r_struct
id|pnp_irq
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|irq
)paren
(brace
id|next
op_assign
id|irq-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|irq
)paren
suffix:semicolon
id|irq
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|pnp_free_dma
r_static
r_void
id|pnp_free_dma
c_func
(paren
r_struct
id|pnp_dma
op_star
id|dma
)paren
(brace
r_struct
id|pnp_dma
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|dma
)paren
(brace
id|next
op_assign
id|dma-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|dma
)paren
suffix:semicolon
id|dma
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|pnp_free_mem
r_static
r_void
id|pnp_free_mem
c_func
(paren
r_struct
id|pnp_mem
op_star
id|mem
)paren
(brace
r_struct
id|pnp_mem
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|mem
)paren
(brace
id|next
op_assign
id|mem-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|mem
)paren
suffix:semicolon
id|mem
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|pnp_free_mem32
r_static
r_void
id|pnp_free_mem32
c_func
(paren
r_struct
id|pnp_mem32
op_star
id|mem32
)paren
(brace
r_struct
id|pnp_mem32
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|mem32
)paren
(brace
id|next
op_assign
id|mem32-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|mem32
)paren
suffix:semicolon
id|mem32
op_assign
id|next
suffix:semicolon
)brace
)brace
DECL|function|pnp_free_resources
r_void
id|pnp_free_resources
c_func
(paren
r_struct
id|pnp_resources
op_star
id|resources
)paren
(brace
r_struct
id|pnp_resources
op_star
id|next
suffix:semicolon
r_while
c_loop
(paren
id|resources
)paren
(brace
id|next
op_assign
id|resources-&gt;dep
suffix:semicolon
id|pnp_free_port
c_func
(paren
id|resources-&gt;port
)paren
suffix:semicolon
id|pnp_free_irq
c_func
(paren
id|resources-&gt;irq
)paren
suffix:semicolon
id|pnp_free_dma
c_func
(paren
id|resources-&gt;dma
)paren
suffix:semicolon
id|pnp_free_mem
c_func
(paren
id|resources-&gt;mem
)paren
suffix:semicolon
id|pnp_free_mem32
c_func
(paren
id|resources-&gt;mem32
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|resources
)paren
suffix:semicolon
id|resources
op_assign
id|next
suffix:semicolon
)brace
)brace
multiline_comment|/* resource validity checking functions */
DECL|function|pnp_check_port
r_static
r_int
id|pnp_check_port
c_func
(paren
r_int
id|port
comma
r_int
id|size
comma
r_int
id|idx
comma
r_struct
id|pnp_cfg
op_star
id|config
)paren
(brace
r_int
id|i
comma
id|tmp
comma
id|rport
comma
id|rsize
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|port
comma
id|size
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rport
op_assign
id|pnp_reserve_io
(braket
id|i
op_lshift
l_int|1
)braket
suffix:semicolon
id|rsize
op_assign
id|pnp_reserve_io
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|rport
op_logical_and
id|port
OL
id|rport
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_plus
id|size
OG
id|rport
op_logical_and
id|port
op_plus
id|size
OL
(paren
id|rport
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|pnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
)paren
(brace
id|rport
op_assign
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|end
op_minus
id|rport
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|rport
op_logical_and
id|port
OL
id|rport
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_plus
id|size
OG
id|rport
op_logical_and
id|port
op_plus
id|size
OL
(paren
id|rport
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|8
op_logical_and
id|tmp
op_ne
id|idx
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
)braket
dot
id|flags
)paren
(brace
id|rport
op_assign
id|config-&gt;request.resource
(braket
id|tmp
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|config-&gt;request.resource
(braket
id|tmp
)braket
dot
id|end
op_minus
id|rport
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_ge
id|rport
op_logical_and
id|port
OL
id|rport
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|port
op_plus
id|size
OG
id|rport
op_logical_and
id|port
op_plus
id|size
OL
(paren
id|rport
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_check_mem
r_static
r_int
id|pnp_check_mem
c_func
(paren
r_int
r_int
id|addr
comma
r_int
r_int
id|size
comma
r_int
id|idx
comma
r_struct
id|pnp_cfg
op_star
id|config
)paren
(brace
r_int
id|i
comma
id|tmp
suffix:semicolon
r_int
r_int
id|raddr
comma
id|rsize
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|raddr
op_assign
(paren
r_int
r_int
)paren
id|pnp_reserve_mem
(braket
id|i
op_lshift
l_int|1
)braket
suffix:semicolon
id|rsize
op_assign
(paren
r_int
r_int
)paren
id|pnp_reserve_mem
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
id|raddr
op_logical_and
id|addr
OL
id|raddr
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_plus
id|size
OG
id|raddr
op_logical_and
id|addr
op_plus
id|size
OL
(paren
id|raddr
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|__check_region
c_func
(paren
op_amp
id|iomem_resource
comma
id|addr
comma
id|size
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|pnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
)paren
(brace
id|raddr
op_assign
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|end
op_minus
id|raddr
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
id|raddr
op_logical_and
id|addr
OL
id|raddr
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_plus
id|size
OG
id|raddr
op_logical_and
id|addr
op_plus
id|size
OL
(paren
id|raddr
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
)brace
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
op_logical_and
id|tmp
op_ne
id|idx
suffix:semicolon
id|tmp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|flags
)paren
(brace
id|raddr
op_assign
id|config-&gt;request.resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
id|rsize
op_assign
(paren
id|config-&gt;request.resource
(braket
id|tmp
op_plus
l_int|8
)braket
dot
id|end
op_minus
id|raddr
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_ge
id|raddr
op_logical_and
id|addr
OL
id|raddr
op_plus
id|rsize
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_plus
id|size
OG
id|raddr
op_logical_and
id|addr
op_plus
id|size
OL
(paren
id|raddr
op_plus
id|rsize
)paren
op_minus
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_test_handler
r_static
r_void
id|pnp_test_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
)brace
DECL|function|pnp_check_interrupt
r_static
r_int
id|pnp_check_interrupt
c_func
(paren
r_int
id|irq
comma
r_struct
id|pnp_cfg
op_star
id|config
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
macro_line|#endif
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
l_int|15
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_reserve_irq
(braket
id|i
)braket
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|pnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
dot
id|flags
op_logical_and
id|dev-&gt;irq_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|irq
)paren
op_logical_or
(paren
id|dev-&gt;irq_resource
(braket
l_int|1
)braket
dot
id|flags
op_logical_and
id|dev-&gt;irq_resource
(braket
l_int|1
)braket
dot
id|start
op_eq
id|irq
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|config-&gt;request.irq_resource
(braket
l_int|0
)braket
dot
id|flags
op_logical_and
id|config-&gt;request.irq_resource
(braket
l_int|1
)braket
dot
id|flags
op_logical_and
(paren
id|config-&gt;request.irq_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|irq
)paren
)paren
r_return
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
op_logical_neg
id|pnp_skip_pci_scan
)paren
(brace
id|pci_for_each_dev
c_func
(paren
id|pci
)paren
(brace
r_if
c_cond
(paren
id|pci-&gt;irq
op_eq
id|irq
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|pnp_test_handler
comma
id|SA_INTERRUPT
comma
l_string|&quot;pnp&quot;
comma
l_int|NULL
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|free_irq
c_func
(paren
id|irq
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_check_dma
r_static
r_int
id|pnp_check_dma
c_func
(paren
r_int
id|dma
comma
r_struct
id|pnp_cfg
op_star
id|config
)paren
(brace
r_int
id|i
comma
id|mindma
op_assign
l_int|1
suffix:semicolon
r_struct
id|pnp_dev
op_star
id|dev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pnp_allow_dma0
op_eq
l_int|1
)paren
id|mindma
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dma
template_param
l_int|7
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_reserve_dma
(braket
id|i
)braket
op_eq
id|dma
)paren
r_return
l_int|1
suffix:semicolon
)brace
id|pnp_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;active
)paren
(brace
r_if
c_cond
(paren
(paren
id|dev-&gt;dma_resource
(braket
l_int|0
)braket
dot
id|flags
op_logical_and
id|dev-&gt;dma_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|dma
)paren
op_logical_or
(paren
id|dev-&gt;dma_resource
(braket
l_int|1
)braket
dot
id|flags
op_logical_and
id|dev-&gt;dma_resource
(braket
l_int|1
)braket
dot
id|start
op_eq
id|dma
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|config-&gt;request.dma_resource
(braket
l_int|0
)braket
dot
id|flags
op_logical_and
id|config-&gt;request.dma_resource
(braket
l_int|1
)braket
dot
id|flags
op_logical_and
(paren
id|config-&gt;request.dma_resource
(braket
l_int|0
)braket
dot
id|start
op_eq
id|dma
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dma
comma
l_string|&quot;pnp&quot;
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|free_dma
c_func
(paren
id|dma
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* config generation functions */
DECL|function|pnp_generate_port
r_static
r_int
id|pnp_generate_port
c_func
(paren
r_struct
id|pnp_cfg
op_star
id|config
comma
r_int
id|num
)paren
(brace
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
comma
op_star
id|value3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
op_logical_or
id|num
template_param
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|port
op_assign
id|config-&gt;port
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port
)paren
r_return
l_int|0
suffix:semicolon
id|value1
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
)braket
dot
id|end
suffix:semicolon
id|value3
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
)braket
dot
id|flags
suffix:semicolon
op_star
id|value1
op_assign
id|port-&gt;min
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|port-&gt;size
op_minus
l_int|1
suffix:semicolon
op_star
id|value3
op_assign
id|port-&gt;flags
op_or
id|IORESOURCE_IO
suffix:semicolon
r_while
c_loop
(paren
id|pnp_check_port
c_func
(paren
op_star
id|value1
comma
id|port-&gt;size
comma
id|num
comma
id|config
)paren
)paren
(brace
op_star
id|value1
op_add_assign
id|port-&gt;align
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|port-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value1
OG
id|port-&gt;max
op_logical_or
op_logical_neg
id|port-&gt;align
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_generate_mem
r_static
r_int
id|pnp_generate_mem
c_func
(paren
r_struct
id|pnp_cfg
op_star
id|config
comma
r_int
id|num
)paren
(brace
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
comma
op_star
id|value3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
op_logical_or
id|num
template_param
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|mem
op_assign
id|config-&gt;mem
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem
)paren
r_return
l_int|0
suffix:semicolon
id|value1
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
op_plus
l_int|8
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
op_plus
l_int|8
)braket
dot
id|end
suffix:semicolon
id|value3
op_assign
op_amp
id|config-&gt;request.resource
(braket
id|num
)braket
dot
id|flags
suffix:semicolon
op_star
id|value1
op_assign
id|mem-&gt;min
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|mem-&gt;size
op_minus
l_int|1
suffix:semicolon
op_star
id|value3
op_assign
id|mem-&gt;flags
op_or
id|IORESOURCE_MEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_WRITEABLE
)paren
)paren
op_star
id|value3
op_or_assign
id|IORESOURCE_READONLY
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_CACHEABLE
)paren
op_star
id|value3
op_or_assign
id|IORESOURCE_CACHEABLE
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_RANGELENGTH
)paren
op_star
id|value3
op_or_assign
id|IORESOURCE_RANGELENGTH
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;flags
op_amp
id|IORESOURCE_MEM_SHADOWABLE
)paren
op_star
id|value3
op_or_assign
id|IORESOURCE_SHADOWABLE
suffix:semicolon
r_while
c_loop
(paren
id|pnp_check_mem
c_func
(paren
op_star
id|value1
comma
id|mem-&gt;size
comma
id|num
comma
id|config
)paren
)paren
(brace
op_star
id|value1
op_add_assign
id|mem-&gt;align
suffix:semicolon
op_star
id|value2
op_assign
op_star
id|value1
op_plus
id|mem-&gt;size
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value1
OG
id|mem-&gt;max
op_logical_or
op_logical_neg
id|mem-&gt;align
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_generate_irq
r_static
r_int
id|pnp_generate_irq
c_func
(paren
r_struct
id|pnp_cfg
op_star
id|config
comma
r_int
id|num
)paren
(brace
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
comma
op_star
id|value3
suffix:semicolon
multiline_comment|/* IRQ priority: this table is good for i386 */
r_static
r_int
r_int
id|xtab
(braket
l_int|16
)braket
op_assign
(brace
l_int|5
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|9
comma
l_int|14
comma
l_int|15
comma
l_int|7
comma
l_int|3
comma
l_int|4
comma
l_int|13
comma
l_int|0
comma
l_int|1
comma
l_int|6
comma
l_int|8
comma
l_int|2
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
op_logical_or
id|num
template_param
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|irq
op_assign
id|config-&gt;irq
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
r_return
l_int|0
suffix:semicolon
id|value1
op_assign
op_amp
id|config-&gt;request.irq_resource
(braket
id|num
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|config-&gt;request.irq_resource
(braket
id|num
)braket
dot
id|end
suffix:semicolon
id|value3
op_assign
op_amp
id|config-&gt;request.irq_resource
(braket
id|num
)braket
dot
id|flags
suffix:semicolon
op_star
id|value3
op_assign
id|irq-&gt;flags
op_or
id|IORESOURCE_IRQ
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|irq-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|xtab
(braket
id|i
)braket
)paren
)paren
(brace
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|xtab
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pnp_check_interrupt
c_func
(paren
op_star
id|value1
comma
id|config
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|pnp_generate_dma
r_static
r_int
id|pnp_generate_dma
c_func
(paren
r_struct
id|pnp_cfg
op_star
id|config
comma
r_int
id|num
)paren
(brace
r_struct
id|pnp_dma
op_star
id|dma
suffix:semicolon
r_int
r_int
op_star
id|value1
comma
op_star
id|value2
comma
op_star
id|value3
suffix:semicolon
multiline_comment|/* DMA priority: this table is good for i386 */
r_static
r_int
r_int
id|xtab
(braket
l_int|16
)braket
op_assign
(brace
l_int|1
comma
l_int|3
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|0
comma
l_int|2
comma
l_int|4
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
op_logical_or
id|num
template_param
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dma
op_assign
id|config-&gt;dma
(braket
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dma
)paren
r_return
l_int|0
suffix:semicolon
id|value1
op_assign
op_amp
id|config-&gt;request.dma_resource
(braket
id|num
)braket
dot
id|start
suffix:semicolon
id|value2
op_assign
op_amp
id|config-&gt;request.dma_resource
(braket
id|num
)braket
dot
id|end
suffix:semicolon
id|value3
op_assign
op_amp
id|config-&gt;request.dma_resource
(braket
id|num
)braket
dot
id|flags
suffix:semicolon
op_star
id|value3
op_assign
id|dma-&gt;flags
op_or
id|IORESOURCE_DMA
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;map
op_amp
(paren
l_int|1
op_lshift
id|xtab
(braket
id|i
)braket
)paren
)paren
(brace
op_star
id|value1
op_assign
op_star
id|value2
op_assign
id|xtab
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pnp_check_dma
c_func
(paren
op_star
id|value1
comma
id|config
)paren
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
DECL|function|pnp_init_res_cfg
r_int
id|pnp_init_res_cfg
c_func
(paren
r_struct
id|pnp_res_cfg
op_star
id|res_config
)paren
(brace
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res_config
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_IRQ
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|res_config-&gt;irq_resource
(braket
id|idx
)braket
dot
id|start
op_assign
op_minus
l_int|1
suffix:semicolon
id|res_config-&gt;irq_resource
(braket
id|idx
)braket
dot
id|end
op_assign
op_minus
l_int|1
suffix:semicolon
id|res_config-&gt;irq_resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_DMA
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|res_config-&gt;dma_resource
(braket
id|idx
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|res_config-&gt;dma_resource
(braket
id|idx
)braket
dot
id|start
op_assign
op_minus
l_int|1
suffix:semicolon
id|res_config-&gt;dma_resource
(braket
id|idx
)braket
dot
id|end
op_assign
op_minus
l_int|1
suffix:semicolon
id|res_config-&gt;dma_resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_RESOURCE
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|res_config-&gt;resource
(braket
id|idx
)braket
dot
id|name
op_assign
l_int|NULL
suffix:semicolon
id|res_config-&gt;resource
(braket
id|idx
)braket
dot
id|start
op_assign
l_int|0
suffix:semicolon
id|res_config-&gt;resource
(braket
id|idx
)braket
dot
id|end
op_assign
l_int|0
suffix:semicolon
id|res_config-&gt;resource
(braket
id|idx
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_prepare_request
r_static
r_int
id|pnp_prepare_request
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_cfg
op_star
id|config
comma
r_struct
id|pnp_res_cfg
op_star
r_template
)paren
(brace
r_int
id|idx
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;lock_resources
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|err
op_assign
id|pnp_init_res_cfg
c_func
(paren
op_amp
id|config-&gt;request
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_template
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_IRQ
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
r_template
op_member_access_from_pointer
id|irq_resource
(braket
id|idx
)braket
dot
id|start
op_ge
l_int|0
)paren
id|config-&gt;request.irq_resource
(braket
id|idx
)braket
op_assign
r_template
op_member_access_from_pointer
id|irq_resource
(braket
id|idx
)braket
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_DMA
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
r_template
op_member_access_from_pointer
id|dma_resource
(braket
id|idx
)braket
dot
id|start
op_ge
l_int|0
)paren
id|config-&gt;request.dma_resource
(braket
id|idx
)braket
op_assign
r_template
op_member_access_from_pointer
id|dma_resource
(braket
id|idx
)braket
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|DEVICE_COUNT_RESOURCE
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
r_template
op_member_access_from_pointer
id|resource
(braket
id|idx
)braket
dot
id|start
OG
l_int|0
)paren
id|config-&gt;request.resource
(braket
id|idx
)braket
op_assign
r_template
op_member_access_from_pointer
id|resource
(braket
id|idx
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_generate_request
r_static
r_int
id|pnp_generate_request
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_cfg
op_star
id|config
comma
r_struct
id|pnp_res_cfg
op_star
r_template
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pnp_prepare_request
c_func
(paren
id|dev
comma
id|config
comma
r_template
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_generate_port
c_func
(paren
id|config
comma
id|i
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_generate_mem
c_func
(paren
id|config
comma
id|i
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_generate_irq
c_func
(paren
id|config
comma
id|i
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pnp_generate_dma
c_func
(paren
id|config
comma
id|i
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pnp_generate_config
r_static
r_struct
id|pnp_cfg
op_star
id|pnp_generate_config
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
)paren
(brace
r_struct
id|pnp_cfg
op_star
id|config
suffix:semicolon
r_int
id|nport
op_assign
l_int|0
comma
id|nirq
op_assign
l_int|0
comma
id|ndma
op_assign
l_int|0
comma
id|nmem
op_assign
l_int|0
suffix:semicolon
r_struct
id|pnp_resources
op_star
id|res
suffix:semicolon
r_struct
id|pnp_port
op_star
id|port
suffix:semicolon
r_struct
id|pnp_mem
op_star
id|mem
suffix:semicolon
r_struct
id|pnp_irq
op_star
id|irq
suffix:semicolon
r_struct
id|pnp_dma
op_star
id|dma
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|depnum
OL
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|config
op_assign
id|pnp_alloc
c_func
(paren
r_sizeof
(paren
r_struct
id|pnp_cfg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* independent */
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_goto
id|fail
suffix:semicolon
id|port
op_assign
id|res-&gt;port
suffix:semicolon
id|mem
op_assign
id|res-&gt;mem
suffix:semicolon
id|irq
op_assign
id|res-&gt;irq
suffix:semicolon
id|dma
op_assign
id|res-&gt;dma
suffix:semicolon
r_while
c_loop
(paren
id|port
)paren
(brace
id|config-&gt;port
(braket
id|nport
)braket
op_assign
id|port
suffix:semicolon
id|nport
op_increment
suffix:semicolon
id|port
op_assign
id|port-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mem
)paren
(brace
id|config-&gt;mem
(braket
id|nmem
)braket
op_assign
id|mem
suffix:semicolon
id|nmem
op_increment
suffix:semicolon
id|mem
op_assign
id|mem-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|irq
)paren
(brace
id|config-&gt;irq
(braket
id|nirq
)braket
op_assign
id|irq
suffix:semicolon
id|nirq
op_increment
suffix:semicolon
id|irq
op_assign
id|irq-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dma
)paren
(brace
id|config-&gt;dma
(braket
id|ndma
)braket
op_assign
id|dma
suffix:semicolon
id|ndma
op_increment
suffix:semicolon
id|dma
op_assign
id|dma-&gt;next
suffix:semicolon
)brace
multiline_comment|/* dependent */
r_if
c_cond
(paren
id|depnum
op_eq
l_int|0
)paren
r_return
id|config
suffix:semicolon
id|res
op_assign
id|pnp_find_resources
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_goto
id|fail
suffix:semicolon
id|port
op_assign
id|res-&gt;port
suffix:semicolon
id|mem
op_assign
id|res-&gt;mem
suffix:semicolon
id|irq
op_assign
id|res-&gt;irq
suffix:semicolon
id|dma
op_assign
id|res-&gt;dma
suffix:semicolon
r_while
c_loop
(paren
id|port
)paren
(brace
id|config-&gt;port
(braket
id|nport
)braket
op_assign
id|port
suffix:semicolon
id|nport
op_increment
suffix:semicolon
id|port
op_assign
id|port-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mem
)paren
(brace
id|config-&gt;mem
(braket
id|nmem
)braket
op_assign
id|mem
suffix:semicolon
id|nmem
op_increment
suffix:semicolon
id|mem
op_assign
id|mem-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|irq
)paren
(brace
id|config-&gt;irq
(braket
id|nirq
)braket
op_assign
id|irq
suffix:semicolon
id|nirq
op_increment
suffix:semicolon
id|irq
op_assign
id|irq-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dma
)paren
(brace
id|config-&gt;dma
(braket
id|ndma
)braket
op_assign
id|dma
suffix:semicolon
id|ndma
op_increment
suffix:semicolon
id|dma
op_assign
id|dma-&gt;next
suffix:semicolon
)brace
r_return
id|config
suffix:semicolon
id|fail
suffix:colon
id|kfree
c_func
(paren
id|config
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* PnP Device Resource Management */
multiline_comment|/**&n; * pnp_activate_dev - activates a PnP device for use&n; * @dev: pointer to the desired device&n; *&n; * finds the best resource configuration and then informs the correct pnp protocol&n; */
DECL|function|pnp_activate_dev
r_int
id|pnp_activate_dev
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_struct
id|pnp_res_cfg
op_star
r_template
)paren
(brace
r_int
id|depnum
comma
id|max
suffix:semicolon
r_struct
id|pnp_cfg
op_star
id|config
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|max
op_assign
id|pnp_get_max_depnum
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;active
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|pnp_dev_has_driver
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;pnp: Automatic configuration failed because the PnP device &squot;%s&squot; is busy&bslash;n&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;protocol-&gt;get
op_logical_or
op_logical_neg
id|dev-&gt;protocol-&gt;set
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|max
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|depnum
op_assign
l_int|1
suffix:semicolon
id|depnum
op_le
id|max
suffix:semicolon
id|depnum
op_increment
)paren
(brace
id|config
op_assign
id|pnp_generate_config
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pnp_generate_request
c_func
(paren
id|dev
comma
id|config
comma
r_template
)paren
op_eq
l_int|0
)paren
r_goto
id|done
suffix:semicolon
id|kfree
c_func
(paren
id|config
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pnp: Automatic configuration failed for device &squot;%s&squot; due to resource conflicts&bslash;n&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
id|done
suffix:colon
id|pnp_dbg
c_func
(paren
l_string|&quot;the device &squot;%s&squot; has been activated&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
id|dev-&gt;protocol
op_member_access_from_pointer
id|set
c_func
(paren
id|dev
comma
id|config
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;protocol-&gt;get
)paren
id|dev-&gt;protocol
op_member_access_from_pointer
id|get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|config
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * pnp_disable_dev - disables device&n; * @dev: pointer to the desired device&n; *&n; * inform the correct pnp protocol so that resources can be used by other devices&n; */
DECL|function|pnp_disable_dev
r_int
id|pnp_disable_dev
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pnp_dev_has_driver
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;pnp: Disable failed becuase the PnP device &squot;%s&squot; is busy&bslash;n&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;lock_resources
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;protocol-&gt;disable
op_logical_or
op_logical_neg
id|dev-&gt;active
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pnp_dbg
c_func
(paren
l_string|&quot;the device &squot;%s&squot; has been disabled&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
id|dev-&gt;protocol
op_member_access_from_pointer
id|disable
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * pnp_raw_set_dev - same as pnp_activate_dev except the resource config can be specified&n; * @dev: pointer to the desired device&n; * @depnum: resource dependent function&n; * @mode: static or dynamic&n; *&n; */
DECL|function|pnp_raw_set_dev
r_int
id|pnp_raw_set_dev
c_func
(paren
r_struct
id|pnp_dev
op_star
id|dev
comma
r_int
id|depnum
comma
r_struct
id|pnp_res_cfg
op_star
r_template
comma
r_int
id|mode
)paren
(brace
r_struct
id|pnp_cfg
op_star
id|config
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pnp_dev_has_driver
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;pnp: Unable to set resources because the PnP device &squot;%s&squot; is busy&bslash;n&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;protocol-&gt;get
op_logical_or
op_logical_neg
id|dev-&gt;protocol-&gt;set
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|config
op_assign
id|pnp_generate_config
c_func
(paren
id|dev
comma
id|depnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|pnp_generate_request
c_func
(paren
id|dev
comma
id|config
comma
r_template
)paren
op_eq
l_int|0
)paren
r_goto
id|done
suffix:semicolon
id|kfree
c_func
(paren
id|config
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;pnp: Manual configuration failed for device &squot;%s&squot; due to resource conflicts&bslash;n&quot;
comma
id|dev-&gt;dev.bus_id
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
id|done
suffix:colon
id|dev-&gt;protocol
op_member_access_from_pointer
id|set
c_func
(paren
id|dev
comma
id|config
comma
id|mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;protocol-&gt;get
)paren
id|dev-&gt;protocol
op_member_access_from_pointer
id|get
c_func
(paren
id|dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|config
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * pnp_resource_change - change one resource&n; * @resource: pointer to resource to be changed&n; * @start: start of region&n; * @size: size of region&n; *&n; */
DECL|function|pnp_resource_change
r_void
id|pnp_resource_change
c_func
(paren
r_struct
id|resource
op_star
id|resource
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|resource
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|resource-&gt;flags
op_and_assign
op_complement
id|IORESOURCE_AUTO
suffix:semicolon
id|resource-&gt;start
op_assign
id|start
suffix:semicolon
id|resource-&gt;end
op_assign
id|start
op_plus
id|size
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|pnp_build_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_build_resource
)paren
suffix:semicolon
DECL|variable|pnp_find_resources
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_find_resources
)paren
suffix:semicolon
DECL|variable|pnp_get_max_depnum
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_get_max_depnum
)paren
suffix:semicolon
DECL|variable|pnp_add_irq_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_add_irq_resource
)paren
suffix:semicolon
DECL|variable|pnp_add_dma_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_add_dma_resource
)paren
suffix:semicolon
DECL|variable|pnp_add_port_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_add_port_resource
)paren
suffix:semicolon
DECL|variable|pnp_add_mem_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_add_mem_resource
)paren
suffix:semicolon
DECL|variable|pnp_add_mem32_resource
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_add_mem32_resource
)paren
suffix:semicolon
DECL|variable|pnp_init_res_cfg
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_init_res_cfg
)paren
suffix:semicolon
DECL|variable|pnp_activate_dev
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_activate_dev
)paren
suffix:semicolon
DECL|variable|pnp_disable_dev
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_disable_dev
)paren
suffix:semicolon
DECL|variable|pnp_raw_set_dev
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_raw_set_dev
)paren
suffix:semicolon
DECL|variable|pnp_resource_change
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_resource_change
)paren
suffix:semicolon
multiline_comment|/* format is: allowdma0 */
DECL|function|pnp_allowdma0
r_static
r_int
id|__init
id|pnp_allowdma0
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|pnp_allow_dma0
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;allowdma0&quot;
comma
id|pnp_allowdma0
)paren
suffix:semicolon
multiline_comment|/* format is: pnp_reserve_irq=irq1[,irq2] .... */
DECL|function|pnp_setup_reserve_irq
r_static
r_int
id|__init
id|pnp_setup_reserve_irq
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|pnp_reserve_irq
(braket
id|i
)braket
)paren
op_ne
l_int|2
)paren
r_break
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;pnp_reserve_irq=&quot;
comma
id|pnp_setup_reserve_irq
)paren
suffix:semicolon
multiline_comment|/* format is: pnp_reserve_dma=dma1[,dma2] .... */
DECL|function|pnp_setup_reserve_dma
r_static
r_int
id|__init
id|pnp_setup_reserve_dma
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|pnp_reserve_dma
(braket
id|i
)braket
)paren
op_ne
l_int|2
)paren
r_break
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;pnp_reserve_dma=&quot;
comma
id|pnp_setup_reserve_dma
)paren
suffix:semicolon
multiline_comment|/* format is: pnp_reserve_io=io1,size1[,io2,size2] .... */
DECL|function|pnp_setup_reserve_io
r_static
r_int
id|__init
id|pnp_setup_reserve_io
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|pnp_reserve_io
(braket
id|i
)braket
)paren
op_ne
l_int|2
)paren
r_break
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;pnp_reserve_io=&quot;
comma
id|pnp_setup_reserve_io
)paren
suffix:semicolon
multiline_comment|/* format is: pnp_reserve_mem=mem1,size1[,mem2,size2] .... */
DECL|function|pnp_setup_reserve_mem
r_static
r_int
id|__init
id|pnp_setup_reserve_mem
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|pnp_reserve_mem
(braket
id|i
)braket
)paren
op_ne
l_int|2
)paren
r_break
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;pnp_reserve_mem=&quot;
comma
id|pnp_setup_reserve_mem
)paren
suffix:semicolon
eof
