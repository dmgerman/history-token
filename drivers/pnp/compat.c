multiline_comment|/*&n; * compat.c - A series of functions to make it easier to convert drivers that use&n; *            the old isapnp APIs. If possible use the new APIs instead.&n; *&n; * Copyright 2002 Adam Belay &lt;ambx1@neo.rr.com&gt;&n; *&n; */
multiline_comment|/* TODO: see if more isapnp functions are needed here */
macro_line|#include &lt;linux/pnp.h&gt;
macro_line|#include &lt;linux/isapnp.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &quot;base.h&quot;
DECL|function|pnp_convert_id
r_static
r_void
id|pnp_convert_id
c_func
(paren
r_char
op_star
id|buf
comma
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
)paren
(brace
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%c%c%c%x%x%x%x&quot;
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|2
)paren
op_amp
l_int|0x3f
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
(paren
id|vendor
op_amp
l_int|3
)paren
op_lshift
l_int|3
)paren
op_or
(paren
(paren
id|vendor
op_rshift
l_int|13
)paren
op_amp
l_int|7
)paren
)paren
op_minus
l_int|1
comma
l_char|&squot;A&squot;
op_plus
(paren
(paren
id|vendor
op_rshift
l_int|8
)paren
op_amp
l_int|0x1f
)paren
op_minus
l_int|1
comma
(paren
id|device
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
comma
id|device
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
comma
(paren
id|device
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|pnp_find_card
r_struct
id|pnp_card
op_star
id|pnp_find_card
c_func
(paren
r_int
r_int
id|vendor
comma
r_int
r_int
id|device
comma
r_struct
id|pnp_card
op_star
id|from
)paren
(brace
r_char
id|id
(braket
l_int|7
)braket
suffix:semicolon
r_char
id|any
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|pnp_convert_id
c_func
(paren
id|id
comma
id|vendor
comma
id|device
)paren
suffix:semicolon
id|pnp_convert_id
c_func
(paren
id|any
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
)paren
suffix:semicolon
id|list
op_assign
id|isapnp_cards.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
id|list
op_assign
id|from-&gt;node.next
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|isapnp_cards
)paren
(brace
r_struct
id|pnp_card
op_star
id|card
op_assign
id|to_pnp_card
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|compare_pnp_id
c_func
(paren
op_amp
id|card-&gt;ids
comma
id|id
)paren
op_logical_or
(paren
id|memcmp
c_func
(paren
id|id
comma
id|any
comma
l_int|7
)paren
op_eq
l_int|0
)paren
)paren
r_return
id|card
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|pnp_find_dev
r_struct
id|pnp_dev
op_star
id|pnp_find_dev
c_func
(paren
r_struct
id|pnp_card
op_star
id|card
comma
r_int
r_int
id|vendor
comma
r_int
r_int
id|function
comma
r_struct
id|pnp_dev
op_star
id|from
)paren
(brace
r_char
id|id
(braket
l_int|7
)braket
suffix:semicolon
r_char
id|any
(braket
l_int|7
)braket
suffix:semicolon
id|pnp_convert_id
c_func
(paren
id|id
comma
id|vendor
comma
id|function
)paren
suffix:semicolon
id|pnp_convert_id
c_func
(paren
id|any
comma
id|ISAPNP_ANY_ID
comma
id|ISAPNP_ANY_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* look for a logical device from all cards */
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
id|pnp_global.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
id|list
op_assign
id|from-&gt;global_list.next
suffix:semicolon
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|pnp_global
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
id|global_to_pnp_dev
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|compare_pnp_id
c_func
(paren
op_amp
id|dev-&gt;ids
comma
id|id
)paren
op_logical_or
(paren
id|memcmp
c_func
(paren
id|id
comma
id|any
comma
l_int|7
)paren
op_eq
l_int|0
)paren
)paren
r_return
id|dev
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|list
op_assign
id|card-&gt;devices.next
suffix:semicolon
r_if
c_cond
(paren
id|from
)paren
(brace
id|list
op_assign
id|from-&gt;card_list.next
suffix:semicolon
r_if
c_cond
(paren
id|from-&gt;card
op_ne
id|card
)paren
multiline_comment|/* something is wrong */
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|list
op_ne
op_amp
id|card-&gt;devices
)paren
(brace
r_struct
id|pnp_dev
op_star
id|dev
op_assign
id|card_to_pnp_dev
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|compare_pnp_id
c_func
(paren
op_amp
id|dev-&gt;ids
comma
id|id
)paren
)paren
r_return
id|dev
suffix:semicolon
id|list
op_assign
id|list-&gt;next
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|variable|pnp_find_card
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_find_card
)paren
suffix:semicolon
DECL|variable|pnp_find_dev
id|EXPORT_SYMBOL
c_func
(paren
id|pnp_find_dev
)paren
suffix:semicolon
eof
