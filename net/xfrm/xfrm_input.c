multiline_comment|/*&n; * xfrm_input.c&n; *&n; * Changes:&n; * &t;YOSHIFUJI Hideaki @USAGI&n; * &t;&t;Split up af-specific portion&n; * &t;&n; */
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
DECL|variable|secpath_cachep
r_static
id|kmem_cache_t
op_star
id|secpath_cachep
suffix:semicolon
DECL|function|__secpath_destroy
r_void
id|__secpath_destroy
c_func
(paren
r_struct
id|sec_path
op_star
id|sp
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sp-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|xfrm_state_put
c_func
(paren
id|sp-&gt;x
(braket
id|i
)braket
dot
id|xvec
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|secpath_cachep
comma
id|sp
)paren
suffix:semicolon
)brace
DECL|variable|__secpath_destroy
id|EXPORT_SYMBOL
c_func
(paren
id|__secpath_destroy
)paren
suffix:semicolon
DECL|function|secpath_dup
r_struct
id|sec_path
op_star
id|secpath_dup
c_func
(paren
r_struct
id|sec_path
op_star
id|src
)paren
(brace
r_struct
id|sec_path
op_star
id|sp
suffix:semicolon
id|sp
op_assign
id|kmem_cache_alloc
c_func
(paren
id|secpath_cachep
comma
id|SLAB_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
r_return
l_int|NULL
suffix:semicolon
id|sp-&gt;len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|src
)paren
(brace
r_int
id|i
suffix:semicolon
id|memcpy
c_func
(paren
id|sp
comma
id|src
comma
r_sizeof
(paren
op_star
id|sp
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sp-&gt;len
suffix:semicolon
id|i
op_increment
)paren
id|xfrm_state_hold
c_func
(paren
id|sp-&gt;x
(braket
id|i
)braket
dot
id|xvec
)paren
suffix:semicolon
)brace
id|atomic_set
c_func
(paren
op_amp
id|sp-&gt;refcnt
comma
l_int|1
)paren
suffix:semicolon
r_return
id|sp
suffix:semicolon
)brace
DECL|variable|secpath_dup
id|EXPORT_SYMBOL
c_func
(paren
id|secpath_dup
)paren
suffix:semicolon
multiline_comment|/* Fetch spi and seq from ipsec header */
DECL|function|xfrm_parse_spi
r_int
id|xfrm_parse_spi
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
id|u8
id|nexthdr
comma
id|u32
op_star
id|spi
comma
id|u32
op_star
id|seq
)paren
(brace
r_int
id|offset
comma
id|offset_seq
suffix:semicolon
r_switch
c_cond
(paren
id|nexthdr
)paren
(brace
r_case
id|IPPROTO_AH
suffix:colon
id|offset
op_assign
m_offsetof
(paren
r_struct
id|ip_auth_hdr
comma
id|spi
)paren
suffix:semicolon
id|offset_seq
op_assign
m_offsetof
(paren
r_struct
id|ip_auth_hdr
comma
id|seq_no
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPPROTO_ESP
suffix:colon
id|offset
op_assign
m_offsetof
(paren
r_struct
id|ip_esp_hdr
comma
id|spi
)paren
suffix:semicolon
id|offset_seq
op_assign
m_offsetof
(paren
r_struct
id|ip_esp_hdr
comma
id|seq_no
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPPROTO_COMP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|ip_comp_hdr
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
id|spi
op_assign
id|ntohl
c_func
(paren
id|ntohs
c_func
(paren
op_star
(paren
id|u16
op_star
)paren
(paren
id|skb-&gt;h.raw
op_plus
l_int|2
)paren
)paren
)paren
suffix:semicolon
op_star
id|seq
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pskb_may_pull
c_func
(paren
id|skb
comma
l_int|16
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
op_star
id|spi
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|skb-&gt;h.raw
op_plus
id|offset
)paren
suffix:semicolon
op_star
id|seq
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|skb-&gt;h.raw
op_plus
id|offset_seq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|xfrm_parse_spi
id|EXPORT_SYMBOL
c_func
(paren
id|xfrm_parse_spi
)paren
suffix:semicolon
DECL|function|xfrm_input_init
r_void
id|__init
id|xfrm_input_init
c_func
(paren
r_void
)paren
(brace
id|secpath_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;secpath_cache&quot;
comma
r_sizeof
(paren
r_struct
id|sec_path
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|secpath_cachep
)paren
id|panic
c_func
(paren
l_string|&quot;XFRM: failed to allocate secpath_cache&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
