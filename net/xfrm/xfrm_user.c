multiline_comment|/* xfrm_user.c: User interface to configure xfrm engine.&n; *&n; * Copyright (C) 2002 David S. Miller (davem@redhat.com)&n; *&n; * Changes:&n; *&t;Mitsuru KANDA @USAGI&n; * &t;Kazunori MIYAZAWA @USAGI&n; * &t;Kunihiro Ishiguro &lt;kunihiro@ipinfusion.com&gt;&n; * &t;&t;IPv6 support&n; * &t;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/pfkeyv2.h&gt;
macro_line|#include &lt;linux/ipsec.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/security.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|variable|xfrm_nl
r_static
r_struct
id|sock
op_star
id|xfrm_nl
suffix:semicolon
DECL|function|verify_one_alg
r_static
r_int
id|verify_one_alg
c_func
(paren
r_struct
id|rtattr
op_star
op_star
id|xfrma
comma
r_enum
id|xfrm_attr_type_t
id|type
)paren
(brace
r_struct
id|rtattr
op_star
id|rt
op_assign
id|xfrma
(braket
id|type
op_minus
l_int|1
)braket
suffix:semicolon
r_struct
id|xfrm_algo
op_star
id|algp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rta_len
op_minus
r_sizeof
(paren
op_star
id|rt
)paren
)paren
OL
r_sizeof
(paren
op_star
id|algp
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|algp
op_assign
id|RTA_DATA
c_func
(paren
id|rt
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|XFRMA_ALG_AUTH
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|algp-&gt;alg_key_len
op_logical_and
id|strcmp
c_func
(paren
id|algp-&gt;alg_name
comma
l_string|&quot;digest_null&quot;
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|XFRMA_ALG_CRYPT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|algp-&gt;alg_key_len
op_logical_and
id|strcmp
c_func
(paren
id|algp-&gt;alg_name
comma
l_string|&quot;cipher_null&quot;
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|XFRMA_ALG_COMP
suffix:colon
multiline_comment|/* Zero length keys are legal.  */
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
id|algp-&gt;alg_name
(braket
id|CRYPTO_MAX_ALG_NAME
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|verify_encap_tmpl
r_static
r_int
id|verify_encap_tmpl
c_func
(paren
r_struct
id|rtattr
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|rtattr
op_star
id|rt
op_assign
id|xfrma
(braket
id|XFRMA_ENCAP
op_minus
l_int|1
)braket
suffix:semicolon
r_struct
id|xfrm_encap_tmpl
op_star
id|encap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rt-&gt;rta_len
op_minus
r_sizeof
(paren
op_star
id|rt
)paren
)paren
OL
r_sizeof
(paren
op_star
id|encap
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|verify_newsa_info
r_static
r_int
id|verify_newsa_info
c_func
(paren
r_struct
id|xfrm_usersa_info
op_star
id|p
comma
r_struct
id|rtattr
op_star
op_star
id|xfrma
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_break
suffix:semicolon
r_case
id|AF_INET6
suffix:colon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_break
suffix:semicolon
macro_line|#else
id|err
op_assign
op_minus
id|EAFNOSUPPORT
suffix:semicolon
r_goto
id|out
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_goto
id|out
suffix:semicolon
)brace
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;id.proto
)paren
(brace
r_case
id|IPPROTO_AH
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|xfrma
(braket
id|XFRMA_ALG_AUTH
op_minus
l_int|1
)braket
op_logical_or
id|xfrma
(braket
id|XFRMA_ALG_CRYPT
op_minus
l_int|1
)braket
op_logical_or
id|xfrma
(braket
id|XFRMA_ALG_COMP
op_minus
l_int|1
)braket
)paren
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPPROTO_ESP
suffix:colon
r_if
c_cond
(paren
(paren
op_logical_neg
id|xfrma
(braket
id|XFRMA_ALG_AUTH
op_minus
l_int|1
)braket
op_logical_and
op_logical_neg
id|xfrma
(braket
id|XFRMA_ALG_CRYPT
op_minus
l_int|1
)braket
)paren
op_logical_or
id|xfrma
(braket
id|XFRMA_ALG_COMP
op_minus
l_int|1
)braket
)paren
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPPROTO_COMP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|xfrma
(braket
id|XFRMA_ALG_COMP
op_minus
l_int|1
)braket
op_logical_or
id|xfrma
(braket
id|XFRMA_ALG_AUTH
op_minus
l_int|1
)braket
op_logical_or
id|xfrma
(braket
id|XFRMA_ALG_CRYPT
op_minus
l_int|1
)braket
)paren
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|out
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|verify_one_alg
c_func
(paren
id|xfrma
comma
id|XFRMA_ALG_AUTH
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|verify_one_alg
c_func
(paren
id|xfrma
comma
id|XFRMA_ALG_CRYPT
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|verify_one_alg
c_func
(paren
id|xfrma
comma
id|XFRMA_ALG_COMP
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|verify_encap_tmpl
c_func
(paren
id|xfrma
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;mode
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|out
suffix:semicolon
)brace
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|attach_one_algo
r_static
r_int
id|attach_one_algo
c_func
(paren
r_struct
id|xfrm_algo
op_star
op_star
id|algpp
comma
id|u8
op_star
id|props
comma
r_struct
id|xfrm_algo_desc
op_star
(paren
op_star
id|get_byname
)paren
(paren
r_char
op_star
comma
r_int
)paren
comma
r_struct
id|rtattr
op_star
id|u_arg
)paren
(brace
r_struct
id|rtattr
op_star
id|rta
op_assign
id|u_arg
suffix:semicolon
r_struct
id|xfrm_algo
op_star
id|p
comma
op_star
id|ualg
suffix:semicolon
r_struct
id|xfrm_algo_desc
op_star
id|algo
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rta
)paren
r_return
l_int|0
suffix:semicolon
id|ualg
op_assign
id|RTA_DATA
c_func
(paren
id|rta
)paren
suffix:semicolon
id|algo
op_assign
id|get_byname
c_func
(paren
id|ualg-&gt;alg_name
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|algo
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
op_star
id|props
op_assign
id|algo-&gt;desc.sadb_alg_id
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ualg
)paren
op_plus
id|ualg-&gt;alg_key_len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|ualg
comma
r_sizeof
(paren
op_star
id|ualg
)paren
op_plus
id|ualg-&gt;alg_key_len
)paren
suffix:semicolon
op_star
id|algpp
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|attach_encap_tmpl
r_static
r_int
id|attach_encap_tmpl
c_func
(paren
r_struct
id|xfrm_encap_tmpl
op_star
op_star
id|encapp
comma
r_struct
id|rtattr
op_star
id|u_arg
)paren
(brace
r_struct
id|rtattr
op_star
id|rta
op_assign
id|u_arg
suffix:semicolon
r_struct
id|xfrm_encap_tmpl
op_star
id|p
comma
op_star
id|uencap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rta
)paren
r_return
l_int|0
suffix:semicolon
id|uencap
op_assign
id|RTA_DATA
c_func
(paren
id|rta
)paren
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|p
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|uencap
comma
r_sizeof
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
op_star
id|encapp
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|copy_from_user_state
r_static
r_void
id|copy_from_user_state
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_struct
id|xfrm_usersa_info
op_star
id|p
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|x-&gt;id
comma
op_amp
id|p-&gt;id
comma
r_sizeof
(paren
id|x-&gt;id
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|x-&gt;sel
comma
op_amp
id|p-&gt;sel
comma
r_sizeof
(paren
id|x-&gt;sel
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|x-&gt;lft
comma
op_amp
id|p-&gt;lft
comma
r_sizeof
(paren
id|x-&gt;lft
)paren
)paren
suffix:semicolon
id|x-&gt;props.mode
op_assign
id|p-&gt;mode
suffix:semicolon
id|x-&gt;props.replay_window
op_assign
id|p-&gt;replay_window
suffix:semicolon
id|x-&gt;props.reqid
op_assign
id|p-&gt;reqid
suffix:semicolon
id|x-&gt;props.family
op_assign
id|p-&gt;family
suffix:semicolon
id|x-&gt;props.saddr
op_assign
id|p-&gt;saddr
suffix:semicolon
id|x-&gt;props.flags
op_assign
id|p-&gt;flags
suffix:semicolon
)brace
DECL|function|xfrm_state_construct
r_static
r_struct
id|xfrm_state
op_star
id|xfrm_state_construct
c_func
(paren
r_struct
id|xfrm_usersa_info
op_star
id|p
comma
r_struct
id|rtattr
op_star
op_star
id|xfrma
comma
r_int
op_star
id|errp
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
op_assign
id|xfrm_state_alloc
c_func
(paren
)paren
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x
)paren
r_goto
id|error_no_put
suffix:semicolon
id|copy_from_user_state
c_func
(paren
id|x
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_one_algo
c_func
(paren
op_amp
id|x-&gt;aalg
comma
op_amp
id|x-&gt;props.aalgo
comma
id|xfrm_aalg_get_byname
comma
id|xfrma
(braket
id|XFRMA_ALG_AUTH
op_minus
l_int|1
)braket
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_one_algo
c_func
(paren
op_amp
id|x-&gt;ealg
comma
op_amp
id|x-&gt;props.ealgo
comma
id|xfrm_ealg_get_byname
comma
id|xfrma
(braket
id|XFRMA_ALG_CRYPT
op_minus
l_int|1
)braket
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_one_algo
c_func
(paren
op_amp
id|x-&gt;calg
comma
op_amp
id|x-&gt;props.calgo
comma
id|xfrm_calg_get_byname
comma
id|xfrma
(braket
id|XFRMA_ALG_COMP
op_minus
l_int|1
)braket
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|attach_encap_tmpl
c_func
(paren
op_amp
id|x-&gt;encap
comma
id|xfrma
(braket
id|XFRMA_ENCAP
op_minus
l_int|1
)braket
)paren
)paren
)paren
r_goto
id|error
suffix:semicolon
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
id|x-&gt;type
op_assign
id|xfrm_get_type
c_func
(paren
id|x-&gt;id.proto
comma
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;type
op_eq
l_int|NULL
)paren
r_goto
id|error
suffix:semicolon
id|err
op_assign
id|x-&gt;type
op_member_access_from_pointer
id|init_state
c_func
(paren
id|x
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
id|x-&gt;curlft.add_time
op_assign
(paren
r_int
r_int
)paren
id|xtime.tv_sec
suffix:semicolon
id|x-&gt;km.state
op_assign
id|XFRM_STATE_VALID
suffix:semicolon
id|x-&gt;km.seq
op_assign
id|p-&gt;seq
suffix:semicolon
r_return
id|x
suffix:semicolon
id|error
suffix:colon
id|x-&gt;km.state
op_assign
id|XFRM_STATE_DEAD
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|error_no_put
suffix:colon
op_star
id|errp
op_assign
id|err
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|xfrm_add_sa
r_static
r_int
id|xfrm_add_sa
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_usersa_info
op_star
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|verify_newsa_info
c_func
(paren
id|p
comma
(paren
r_struct
id|rtattr
op_star
op_star
)paren
id|xfrma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|x
op_assign
id|xfrm_state_construct
c_func
(paren
id|p
comma
(paren
r_struct
id|rtattr
op_star
op_star
)paren
id|xfrma
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_type
op_eq
id|XFRM_MSG_NEWSA
)paren
id|err
op_assign
id|xfrm_state_add
c_func
(paren
id|x
)paren
suffix:semicolon
r_else
id|err
op_assign
id|xfrm_state_update
c_func
(paren
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|x-&gt;km.state
op_assign
id|XFRM_STATE_DEAD
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|xfrm_del_sa
r_static
r_int
id|xfrm_del_sa
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_struct
id|xfrm_usersa_id
op_star
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|x
op_assign
id|xfrm_state_lookup
c_func
(paren
op_amp
id|p-&gt;daddr
comma
id|p-&gt;spi
comma
id|p-&gt;proto
comma
id|p-&gt;family
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
r_if
c_cond
(paren
id|xfrm_state_kern
c_func
(paren
id|x
)paren
)paren
(brace
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|xfrm_state_delete
c_func
(paren
id|x
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|copy_to_user_state
r_static
r_void
id|copy_to_user_state
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_struct
id|xfrm_usersa_info
op_star
id|p
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|p-&gt;id
comma
op_amp
id|x-&gt;id
comma
r_sizeof
(paren
id|p-&gt;id
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;sel
comma
op_amp
id|x-&gt;sel
comma
r_sizeof
(paren
id|p-&gt;sel
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;lft
comma
op_amp
id|x-&gt;lft
comma
r_sizeof
(paren
id|p-&gt;lft
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;curlft
comma
op_amp
id|x-&gt;curlft
comma
r_sizeof
(paren
id|p-&gt;curlft
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;stats
comma
op_amp
id|x-&gt;stats
comma
r_sizeof
(paren
id|p-&gt;stats
)paren
)paren
suffix:semicolon
id|p-&gt;saddr
op_assign
id|x-&gt;props.saddr
suffix:semicolon
id|p-&gt;mode
op_assign
id|x-&gt;props.mode
suffix:semicolon
id|p-&gt;replay_window
op_assign
id|x-&gt;props.replay_window
suffix:semicolon
id|p-&gt;reqid
op_assign
id|x-&gt;props.reqid
suffix:semicolon
id|p-&gt;family
op_assign
id|x-&gt;props.family
suffix:semicolon
id|p-&gt;flags
op_assign
id|x-&gt;props.flags
suffix:semicolon
id|p-&gt;seq
op_assign
id|x-&gt;km.seq
suffix:semicolon
)brace
DECL|struct|xfrm_dump_info
r_struct
id|xfrm_dump_info
(brace
DECL|member|in_skb
r_struct
id|sk_buff
op_star
id|in_skb
suffix:semicolon
DECL|member|out_skb
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
DECL|member|nlmsg_seq
id|u32
id|nlmsg_seq
suffix:semicolon
DECL|member|nlmsg_flags
id|u16
id|nlmsg_flags
suffix:semicolon
DECL|member|start_idx
r_int
id|start_idx
suffix:semicolon
DECL|member|this_idx
r_int
id|this_idx
suffix:semicolon
)brace
suffix:semicolon
DECL|function|dump_one_state
r_static
r_int
id|dump_one_state
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|count
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|xfrm_dump_info
op_star
id|sp
op_assign
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|in_skb
op_assign
id|sp-&gt;in_skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|sp-&gt;out_skb
suffix:semicolon
r_struct
id|xfrm_usersa_info
op_star
id|p
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;this_idx
OL
id|sp-&gt;start_idx
)paren
r_goto
id|out
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|sp-&gt;nlmsg_seq
comma
id|XFRM_MSG_NEWSA
comma
r_sizeof
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
id|sp-&gt;nlmsg_flags
suffix:semicolon
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|copy_to_user_state
c_func
(paren
id|x
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;aalg
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|XFRMA_ALG_AUTH
comma
r_sizeof
(paren
op_star
(paren
id|x-&gt;aalg
)paren
)paren
op_plus
(paren
id|x-&gt;aalg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
comma
id|x-&gt;aalg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;ealg
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|XFRMA_ALG_CRYPT
comma
r_sizeof
(paren
op_star
(paren
id|x-&gt;ealg
)paren
)paren
op_plus
(paren
id|x-&gt;ealg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
comma
id|x-&gt;ealg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;calg
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|XFRMA_ALG_COMP
comma
r_sizeof
(paren
op_star
(paren
id|x-&gt;calg
)paren
)paren
comma
id|x-&gt;calg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;encap
)paren
id|RTA_PUT
c_func
(paren
id|skb
comma
id|XFRMA_ENCAP
comma
r_sizeof
(paren
op_star
id|x-&gt;encap
)paren
comma
id|x-&gt;encap
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
id|out
suffix:colon
id|sp-&gt;this_idx
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|rtattr_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_dump_sa
r_static
r_int
id|xfrm_dump_sa
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|xfrm_dump_info
id|info
suffix:semicolon
id|info.in_skb
op_assign
id|cb-&gt;skb
suffix:semicolon
id|info.out_skb
op_assign
id|skb
suffix:semicolon
id|info.nlmsg_seq
op_assign
id|cb-&gt;nlh-&gt;nlmsg_seq
suffix:semicolon
id|info.nlmsg_flags
op_assign
id|NLM_F_MULTI
suffix:semicolon
id|info.this_idx
op_assign
l_int|0
suffix:semicolon
id|info.start_idx
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
(paren
r_void
)paren
id|xfrm_state_walk
c_func
(paren
id|IPSEC_PROTO_ANY
comma
id|dump_one_state
comma
op_amp
id|info
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|info.this_idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|xfrm_state_netlink
r_static
r_struct
id|sk_buff
op_star
id|xfrm_state_netlink
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|xfrm_state
op_star
id|x
comma
id|u32
id|seq
)paren
(brace
r_struct
id|xfrm_dump_info
id|info
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|info.in_skb
op_assign
id|in_skb
suffix:semicolon
id|info.out_skb
op_assign
id|skb
suffix:semicolon
id|info.nlmsg_seq
op_assign
id|seq
suffix:semicolon
id|info.nlmsg_flags
op_assign
l_int|0
suffix:semicolon
id|info.this_idx
op_assign
id|info.start_idx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dump_one_state
c_func
(paren
id|x
comma
l_int|0
comma
op_amp
id|info
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
DECL|function|xfrm_get_sa
r_static
r_int
id|xfrm_get_sa
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_usersa_id
op_star
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_struct
id|sk_buff
op_star
id|resp_skb
suffix:semicolon
r_int
id|err
suffix:semicolon
id|x
op_assign
id|xfrm_state_lookup
c_func
(paren
op_amp
id|p-&gt;daddr
comma
id|p-&gt;spi
comma
id|p-&gt;proto
comma
id|p-&gt;family
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ESRCH
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_goto
id|out_noput
suffix:semicolon
id|resp_skb
op_assign
id|xfrm_state_netlink
c_func
(paren
id|skb
comma
id|x
comma
id|nlh-&gt;nlmsg_seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|resp_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|resp_skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|xfrm_nl
comma
id|resp_skb
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|out_noput
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|verify_userspi_info
r_static
r_int
id|verify_userspi_info
c_func
(paren
r_struct
id|xfrm_userspi_info
op_star
id|p
)paren
(brace
r_switch
c_cond
(paren
id|p-&gt;info.id.proto
)paren
(brace
r_case
id|IPPROTO_AH
suffix:colon
r_case
id|IPPROTO_ESP
suffix:colon
r_break
suffix:semicolon
r_case
id|IPPROTO_COMP
suffix:colon
multiline_comment|/* IPCOMP spi is 16-bits. */
r_if
c_cond
(paren
id|p-&gt;max
op_ge
l_int|0x10000
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;min
OG
id|p-&gt;max
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xfrm_alloc_userspi
r_static
r_int
id|xfrm_alloc_userspi
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_struct
id|xfrm_userspi_info
op_star
id|p
suffix:semicolon
r_struct
id|sk_buff
op_star
id|resp_skb
suffix:semicolon
id|xfrm_address_t
op_star
id|daddr
suffix:semicolon
r_int
id|family
suffix:semicolon
r_int
id|err
suffix:semicolon
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|err
op_assign
id|verify_userspi_info
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_noput
suffix:semicolon
id|family
op_assign
id|p-&gt;info.family
suffix:semicolon
id|daddr
op_assign
op_amp
id|p-&gt;info.id.daddr
suffix:semicolon
id|x
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;info.seq
)paren
(brace
id|x
op_assign
id|xfrm_find_acq_byseq
c_func
(paren
id|p-&gt;info.seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_logical_and
id|xfrm_addr_cmp
c_func
(paren
op_amp
id|x-&gt;id.daddr
comma
id|daddr
comma
id|family
)paren
)paren
(brace
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|x
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|x
)paren
id|x
op_assign
id|xfrm_find_acq
c_func
(paren
id|p-&gt;info.mode
comma
id|p-&gt;info.reqid
comma
id|p-&gt;info.id.proto
comma
id|daddr
comma
op_amp
id|p-&gt;info.saddr
comma
l_int|1
comma
id|family
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_goto
id|out_noput
suffix:semicolon
id|resp_skb
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;km.state
op_ne
id|XFRM_STATE_DEAD
)paren
(brace
id|xfrm_alloc_spi
c_func
(paren
id|x
comma
id|htonl
c_func
(paren
id|p-&gt;min
)paren
comma
id|htonl
c_func
(paren
id|p-&gt;max
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;id.spi
)paren
id|resp_skb
op_assign
id|xfrm_state_netlink
c_func
(paren
id|skb
comma
id|x
comma
id|nlh-&gt;nlmsg_seq
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|resp_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|resp_skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|xfrm_nl
comma
id|resp_skb
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
id|out
suffix:colon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|out_noput
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|verify_policy_dir
r_static
r_int
id|verify_policy_dir
c_func
(paren
id|__u8
id|dir
)paren
(brace
r_switch
c_cond
(paren
id|dir
)paren
(brace
r_case
id|XFRM_POLICY_IN
suffix:colon
r_case
id|XFRM_POLICY_OUT
suffix:colon
r_case
id|XFRM_POLICY_FWD
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|verify_newpolicy_info
r_static
r_int
id|verify_newpolicy_info
c_func
(paren
r_struct
id|xfrm_userpolicy_info
op_star
id|p
)paren
(brace
r_switch
c_cond
(paren
id|p-&gt;share
)paren
(brace
r_case
id|XFRM_SHARE_ANY
suffix:colon
r_case
id|XFRM_SHARE_SESSION
suffix:colon
r_case
id|XFRM_SHARE_USER
suffix:colon
r_case
id|XFRM_SHARE_UNIQUE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;action
)paren
(brace
r_case
id|XFRM_POLICY_ALLOW
suffix:colon
r_case
id|XFRM_POLICY_BLOCK
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_switch
c_cond
(paren
id|p-&gt;sel.family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_break
suffix:semicolon
r_case
id|AF_INET6
suffix:colon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_break
suffix:semicolon
macro_line|#else
r_return
op_minus
id|EAFNOSUPPORT
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
suffix:semicolon
r_return
id|verify_policy_dir
c_func
(paren
id|p-&gt;dir
)paren
suffix:semicolon
)brace
DECL|function|copy_templates
r_static
r_void
id|copy_templates
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|xfrm_user_tmpl
op_star
id|ut
comma
r_int
id|nr
)paren
(brace
r_int
id|i
suffix:semicolon
id|xp-&gt;xfrm_nr
op_assign
id|nr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr
suffix:semicolon
id|i
op_increment
comma
id|ut
op_increment
)paren
(brace
r_struct
id|xfrm_tmpl
op_star
id|t
op_assign
op_amp
id|xp-&gt;xfrm_vec
(braket
id|i
)braket
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|t-&gt;id
comma
op_amp
id|ut-&gt;id
comma
r_sizeof
(paren
r_struct
id|xfrm_id
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|t-&gt;saddr
comma
op_amp
id|ut-&gt;saddr
comma
r_sizeof
(paren
id|xfrm_address_t
)paren
)paren
suffix:semicolon
id|t-&gt;reqid
op_assign
id|ut-&gt;reqid
suffix:semicolon
id|t-&gt;mode
op_assign
id|ut-&gt;mode
suffix:semicolon
id|t-&gt;share
op_assign
id|ut-&gt;share
suffix:semicolon
id|t-&gt;optional
op_assign
id|ut-&gt;optional
suffix:semicolon
id|t-&gt;aalgos
op_assign
id|ut-&gt;aalgos
suffix:semicolon
id|t-&gt;ealgos
op_assign
id|ut-&gt;ealgos
suffix:semicolon
id|t-&gt;calgos
op_assign
id|ut-&gt;calgos
suffix:semicolon
)brace
)brace
DECL|function|copy_from_user_tmpl
r_static
r_int
id|copy_from_user_tmpl
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|pol
comma
r_struct
id|rtattr
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|rtattr
op_star
id|rt
op_assign
id|xfrma
(braket
id|XFRMA_TMPL
op_minus
l_int|1
)braket
suffix:semicolon
r_struct
id|xfrm_user_tmpl
op_star
id|utmpl
suffix:semicolon
r_int
id|nr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
)paren
(brace
id|pol-&gt;xfrm_nr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|nr
op_assign
(paren
id|rt-&gt;rta_len
op_minus
r_sizeof
(paren
op_star
id|rt
)paren
)paren
op_div
r_sizeof
(paren
op_star
id|utmpl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr
OG
id|XFRM_MAX_DEPTH
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|copy_templates
c_func
(paren
id|pol
comma
id|RTA_DATA
c_func
(paren
id|rt
)paren
comma
id|nr
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|copy_from_user_policy
r_static
r_void
id|copy_from_user_policy
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|xfrm_userpolicy_info
op_star
id|p
)paren
(brace
id|xp-&gt;priority
op_assign
id|p-&gt;priority
suffix:semicolon
id|xp-&gt;index
op_assign
id|p-&gt;index
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|xp-&gt;selector
comma
op_amp
id|p-&gt;sel
comma
r_sizeof
(paren
id|xp-&gt;selector
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|xp-&gt;lft
comma
op_amp
id|p-&gt;lft
comma
r_sizeof
(paren
id|xp-&gt;lft
)paren
)paren
suffix:semicolon
id|xp-&gt;action
op_assign
id|p-&gt;action
suffix:semicolon
id|xp-&gt;flags
op_assign
id|p-&gt;flags
suffix:semicolon
id|xp-&gt;family
op_assign
id|p-&gt;sel.family
suffix:semicolon
multiline_comment|/* XXX xp-&gt;share = p-&gt;share; */
)brace
DECL|function|copy_to_user_policy
r_static
r_void
id|copy_to_user_policy
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|xfrm_userpolicy_info
op_star
id|p
comma
r_int
id|dir
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|p-&gt;sel
comma
op_amp
id|xp-&gt;selector
comma
r_sizeof
(paren
id|p-&gt;sel
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;lft
comma
op_amp
id|xp-&gt;lft
comma
r_sizeof
(paren
id|p-&gt;lft
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|p-&gt;curlft
comma
op_amp
id|xp-&gt;curlft
comma
r_sizeof
(paren
id|p-&gt;curlft
)paren
)paren
suffix:semicolon
id|p-&gt;priority
op_assign
id|xp-&gt;priority
suffix:semicolon
id|p-&gt;index
op_assign
id|xp-&gt;index
suffix:semicolon
id|p-&gt;sel.family
op_assign
id|xp-&gt;family
suffix:semicolon
id|p-&gt;dir
op_assign
id|dir
suffix:semicolon
id|p-&gt;action
op_assign
id|xp-&gt;action
suffix:semicolon
id|p-&gt;flags
op_assign
id|xp-&gt;flags
suffix:semicolon
id|p-&gt;share
op_assign
id|XFRM_SHARE_ANY
suffix:semicolon
multiline_comment|/* XXX xp-&gt;share */
)brace
DECL|function|xfrm_policy_construct
r_static
r_struct
id|xfrm_policy
op_star
id|xfrm_policy_construct
c_func
(paren
r_struct
id|xfrm_userpolicy_info
op_star
id|p
comma
r_struct
id|rtattr
op_star
op_star
id|xfrma
comma
r_int
op_star
id|errp
)paren
(brace
r_struct
id|xfrm_policy
op_star
id|xp
op_assign
id|xfrm_policy_alloc
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xp
)paren
(brace
op_star
id|errp
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|copy_from_user_policy
c_func
(paren
id|xp
comma
id|p
)paren
suffix:semicolon
id|err
op_assign
id|copy_from_user_tmpl
c_func
(paren
id|xp
comma
id|xfrma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
op_star
id|errp
op_assign
id|err
suffix:semicolon
id|kfree
c_func
(paren
id|xp
)paren
suffix:semicolon
id|xp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|xp
suffix:semicolon
)brace
DECL|function|xfrm_add_policy
r_static
r_int
id|xfrm_add_policy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_userpolicy_info
op_star
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|excl
suffix:semicolon
id|err
op_assign
id|verify_newpolicy_info
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_construct
c_func
(paren
id|p
comma
(paren
r_struct
id|rtattr
op_star
op_star
)paren
id|xfrma
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xp
)paren
r_return
id|err
suffix:semicolon
id|excl
op_assign
id|nlh-&gt;nlmsg_type
op_eq
id|XFRM_MSG_NEWPOLICY
suffix:semicolon
id|err
op_assign
id|xfrm_policy_insert
c_func
(paren
id|p-&gt;dir
comma
id|xp
comma
id|excl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|xp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|xfrm_pol_put
c_func
(paren
id|xp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|copy_to_user_tmpl
r_static
r_int
id|copy_to_user_tmpl
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|xfrm_user_tmpl
id|vec
(braket
id|XFRM_MAX_DEPTH
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|xp-&gt;xfrm_nr
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|xp-&gt;xfrm_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_user_tmpl
op_star
id|up
op_assign
op_amp
id|vec
(braket
id|i
)braket
suffix:semicolon
r_struct
id|xfrm_tmpl
op_star
id|kp
op_assign
op_amp
id|xp-&gt;xfrm_vec
(braket
id|i
)braket
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|up-&gt;id
comma
op_amp
id|kp-&gt;id
comma
r_sizeof
(paren
id|up-&gt;id
)paren
)paren
suffix:semicolon
id|up-&gt;family
op_assign
id|xp-&gt;family
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|up-&gt;saddr
comma
op_amp
id|kp-&gt;saddr
comma
r_sizeof
(paren
id|up-&gt;saddr
)paren
)paren
suffix:semicolon
id|up-&gt;reqid
op_assign
id|kp-&gt;reqid
suffix:semicolon
id|up-&gt;mode
op_assign
id|kp-&gt;mode
suffix:semicolon
id|up-&gt;share
op_assign
id|kp-&gt;share
suffix:semicolon
id|up-&gt;optional
op_assign
id|kp-&gt;optional
suffix:semicolon
id|up-&gt;aalgos
op_assign
id|kp-&gt;aalgos
suffix:semicolon
id|up-&gt;ealgos
op_assign
id|kp-&gt;ealgos
suffix:semicolon
id|up-&gt;calgos
op_assign
id|kp-&gt;calgos
suffix:semicolon
)brace
id|RTA_PUT
c_func
(paren
id|skb
comma
id|XFRMA_TMPL
comma
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_tmpl
)paren
op_star
id|xp-&gt;xfrm_nr
)paren
comma
id|vec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|rtattr_failure
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|dump_one_policy
r_static
r_int
id|dump_one_policy
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
r_int
id|count
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|xfrm_dump_info
op_star
id|sp
op_assign
id|ptr
suffix:semicolon
r_struct
id|xfrm_userpolicy_info
op_star
id|p
suffix:semicolon
r_struct
id|sk_buff
op_star
id|in_skb
op_assign
id|sp-&gt;in_skb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|sp-&gt;out_skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;this_idx
OL
id|sp-&gt;start_idx
)paren
r_goto
id|out
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|sp-&gt;nlmsg_seq
comma
id|XFRM_MSG_NEWPOLICY
comma
r_sizeof
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
id|sp-&gt;nlmsg_flags
suffix:semicolon
id|copy_to_user_policy
c_func
(paren
id|xp
comma
id|p
comma
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user_tmpl
c_func
(paren
id|xp
comma
id|skb
)paren
OL
l_int|0
)paren
r_goto
id|nlmsg_failure
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
id|out
suffix:colon
id|sp-&gt;this_idx
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_dump_policy
r_static
r_int
id|xfrm_dump_policy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_struct
id|xfrm_dump_info
id|info
suffix:semicolon
id|info.in_skb
op_assign
id|cb-&gt;skb
suffix:semicolon
id|info.out_skb
op_assign
id|skb
suffix:semicolon
id|info.nlmsg_seq
op_assign
id|cb-&gt;nlh-&gt;nlmsg_seq
suffix:semicolon
id|info.nlmsg_flags
op_assign
id|NLM_F_MULTI
suffix:semicolon
id|info.this_idx
op_assign
l_int|0
suffix:semicolon
id|info.start_idx
op_assign
id|cb-&gt;args
(braket
l_int|0
)braket
suffix:semicolon
(paren
r_void
)paren
id|xfrm_policy_walk
c_func
(paren
id|dump_one_policy
comma
op_amp
id|info
)paren
suffix:semicolon
id|cb-&gt;args
(braket
l_int|0
)braket
op_assign
id|info.this_idx
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
)brace
DECL|function|xfrm_policy_netlink
r_static
r_struct
id|sk_buff
op_star
id|xfrm_policy_netlink
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
id|u32
id|seq
)paren
(brace
r_struct
id|xfrm_dump_info
id|info
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_GOODSIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
suffix:semicolon
id|info.in_skb
op_assign
id|in_skb
suffix:semicolon
id|info.out_skb
op_assign
id|skb
suffix:semicolon
id|info.nlmsg_seq
op_assign
id|seq
suffix:semicolon
id|info.nlmsg_flags
op_assign
l_int|0
suffix:semicolon
id|info.this_idx
op_assign
id|info.start_idx
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dump_one_policy
c_func
(paren
id|xp
comma
id|dir
comma
l_int|0
comma
op_amp
id|info
)paren
OL
l_int|0
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
DECL|function|xfrm_get_policy
r_static
r_int
id|xfrm_get_policy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_struct
id|xfrm_userpolicy_id
op_star
id|p
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_delete
suffix:semicolon
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
r_delete
op_assign
id|nlh-&gt;nlmsg_type
op_eq
id|XFRM_MSG_DELPOLICY
suffix:semicolon
id|err
op_assign
id|verify_policy_dir
c_func
(paren
id|p-&gt;dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;index
)paren
id|xp
op_assign
id|xfrm_policy_byid
c_func
(paren
id|p-&gt;dir
comma
id|p-&gt;index
comma
r_delete
)paren
suffix:semicolon
r_else
id|xp
op_assign
id|xfrm_policy_bysel
c_func
(paren
id|p-&gt;dir
comma
op_amp
id|p-&gt;sel
comma
r_delete
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_delete
)paren
(brace
r_struct
id|sk_buff
op_star
id|resp_skb
suffix:semicolon
id|resp_skb
op_assign
id|xfrm_policy_netlink
c_func
(paren
id|skb
comma
id|xp
comma
id|p-&gt;dir
comma
id|nlh-&gt;nlmsg_seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|resp_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|resp_skb
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|xfrm_nl
comma
id|resp_skb
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
)brace
id|xfrm_pol_put
c_func
(paren
id|xp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|xfrm_flush_sa
r_static
r_int
id|xfrm_flush_sa
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
r_struct
id|xfrm_usersa_flush
op_star
id|p
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|xfrm_state_flush
c_func
(paren
id|p-&gt;proto
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xfrm_flush_policy
r_static
r_int
id|xfrm_flush_policy
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_void
op_star
op_star
id|xfrma
)paren
(brace
id|xfrm_policy_flush
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|xfrm_msg_min
r_static
r_const
r_int
id|xfrm_msg_min
(braket
(paren
id|XFRM_MSG_MAX
op_plus
l_int|1
op_minus
id|XFRM_MSG_BASE
)paren
)braket
op_assign
(brace
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_usersa_info
)paren
)paren
comma
multiline_comment|/* NEW SA */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_usersa_id
)paren
)paren
comma
multiline_comment|/* DEL SA */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_usersa_id
)paren
)paren
comma
multiline_comment|/* GET SA */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_userpolicy_info
)paren
)paren
comma
multiline_comment|/* NEW POLICY */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_userpolicy_id
)paren
)paren
comma
multiline_comment|/* DEL POLICY */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_userpolicy_id
)paren
)paren
comma
multiline_comment|/* GET POLICY */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_userspi_info
)paren
)paren
comma
multiline_comment|/* ALLOC SPI */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_acquire
)paren
)paren
comma
multiline_comment|/* ACQUIRE */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_expire
)paren
)paren
comma
multiline_comment|/* EXPIRE */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_userpolicy_info
)paren
)paren
comma
multiline_comment|/* UPD POLICY */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_usersa_info
)paren
)paren
comma
multiline_comment|/* UPD SA */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_polexpire
)paren
)paren
comma
multiline_comment|/* POLEXPIRE */
id|NLMSG_LENGTH
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_usersa_flush
)paren
)paren
comma
multiline_comment|/* FLUSH SA */
id|NLMSG_LENGTH
c_func
(paren
l_int|0
)paren
comma
multiline_comment|/* FLUSH POLICY */
)brace
suffix:semicolon
DECL|struct|xfrm_link
r_static
r_struct
id|xfrm_link
(brace
DECL|member|doit
r_int
(paren
op_star
id|doit
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|nlmsghdr
op_star
comma
r_void
op_star
op_star
)paren
suffix:semicolon
DECL|member|dump
r_int
(paren
op_star
id|dump
)paren
(paren
r_struct
id|sk_buff
op_star
comma
r_struct
id|netlink_callback
op_star
)paren
suffix:semicolon
DECL|variable|xfrm_dispatch
)brace
id|xfrm_dispatch
(braket
)braket
op_assign
(brace
(brace
dot
id|doit
op_assign
id|xfrm_add_sa
comma
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_del_sa
comma
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_get_sa
comma
dot
id|dump
op_assign
id|xfrm_dump_sa
comma
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_add_policy
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_get_policy
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_get_policy
comma
dot
id|dump
op_assign
id|xfrm_dump_policy
comma
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_alloc_userspi
)brace
comma
(brace
)brace
comma
(brace
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_add_policy
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_add_sa
comma
)brace
comma
(brace
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_flush_sa
)brace
comma
(brace
dot
id|doit
op_assign
id|xfrm_flush_policy
)brace
comma
)brace
suffix:semicolon
DECL|function|xfrm_done
r_static
r_int
id|xfrm_done
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xfrm_user_rcv_msg
r_static
r_int
id|xfrm_user_rcv_msg
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
op_star
id|errp
)paren
(brace
r_struct
id|rtattr
op_star
id|xfrma
(braket
id|XFRMA_MAX
)braket
suffix:semicolon
r_struct
id|xfrm_link
op_star
id|link
suffix:semicolon
r_int
id|type
comma
id|min_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|nlh-&gt;nlmsg_flags
op_amp
id|NLM_F_REQUEST
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|type
op_assign
id|nlh-&gt;nlmsg_type
suffix:semicolon
multiline_comment|/* A control message: ignore them */
r_if
c_cond
(paren
id|type
OL
id|XFRM_MSG_BASE
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Unknown message: reply with EINVAL */
r_if
c_cond
(paren
id|type
OG
id|XFRM_MSG_MAX
)paren
r_goto
id|err_einval
suffix:semicolon
id|type
op_sub_assign
id|XFRM_MSG_BASE
suffix:semicolon
id|link
op_assign
op_amp
id|xfrm_dispatch
(braket
id|type
)braket
suffix:semicolon
multiline_comment|/* All operations require privileges, even GET */
r_if
c_cond
(paren
id|security_netlink_recv
c_func
(paren
id|skb
)paren
)paren
(brace
op_star
id|errp
op_assign
op_minus
id|EPERM
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|type
op_eq
l_int|2
op_logical_or
id|type
op_eq
l_int|5
)paren
op_logical_and
(paren
id|nlh-&gt;nlmsg_flags
op_amp
id|NLM_F_DUMP
)paren
)paren
(brace
id|u32
id|rlen
suffix:semicolon
r_if
c_cond
(paren
id|link-&gt;dump
op_eq
l_int|NULL
)paren
r_goto
id|err_einval
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|errp
op_assign
id|netlink_dump_start
c_func
(paren
id|xfrm_nl
comma
id|skb
comma
id|nlh
comma
id|link-&gt;dump
comma
id|xfrm_done
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|rlen
op_assign
id|NLMSG_ALIGN
c_func
(paren
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rlen
OG
id|skb-&gt;len
)paren
id|rlen
op_assign
id|skb-&gt;len
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|rlen
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|xfrma
comma
l_int|0
comma
r_sizeof
(paren
id|xfrma
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
(paren
id|min_len
op_assign
id|xfrm_msg_min
(braket
id|type
)braket
)paren
)paren
r_goto
id|err_einval
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OG
id|min_len
)paren
(brace
r_int
id|attrlen
op_assign
id|nlh-&gt;nlmsg_len
op_minus
id|NLMSG_ALIGN
c_func
(paren
id|min_len
)paren
suffix:semicolon
r_struct
id|rtattr
op_star
id|attr
op_assign
(paren
r_void
op_star
)paren
id|nlh
op_plus
id|NLMSG_ALIGN
c_func
(paren
id|min_len
)paren
suffix:semicolon
r_while
c_loop
(paren
id|RTA_OK
c_func
(paren
id|attr
comma
id|attrlen
)paren
)paren
(brace
r_int
r_int
id|flavor
op_assign
id|attr-&gt;rta_type
suffix:semicolon
r_if
c_cond
(paren
id|flavor
)paren
(brace
r_if
c_cond
(paren
id|flavor
OG
id|XFRMA_MAX
)paren
r_goto
id|err_einval
suffix:semicolon
id|xfrma
(braket
id|flavor
op_minus
l_int|1
)braket
op_assign
id|attr
suffix:semicolon
)brace
id|attr
op_assign
id|RTA_NEXT
c_func
(paren
id|attr
comma
id|attrlen
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|link-&gt;doit
op_eq
l_int|NULL
)paren
r_goto
id|err_einval
suffix:semicolon
op_star
id|errp
op_assign
id|link
op_member_access_from_pointer
id|doit
c_func
(paren
id|skb
comma
id|nlh
comma
(paren
r_void
op_star
op_star
)paren
op_amp
id|xfrma
)paren
suffix:semicolon
r_return
op_star
id|errp
suffix:semicolon
id|err_einval
suffix:colon
op_star
id|errp
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_user_rcv_skb
r_static
r_int
id|xfrm_user_rcv_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_while
c_loop
(paren
id|skb-&gt;len
op_ge
id|NLMSG_SPACE
c_func
(paren
l_int|0
)paren
)paren
(brace
id|u32
id|rlen
suffix:semicolon
id|nlh
op_assign
(paren
r_struct
id|nlmsghdr
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_len
OL
r_sizeof
(paren
op_star
id|nlh
)paren
op_logical_or
id|skb-&gt;len
OL
id|nlh-&gt;nlmsg_len
)paren
r_return
l_int|0
suffix:semicolon
id|rlen
op_assign
id|NLMSG_ALIGN
c_func
(paren
id|nlh-&gt;nlmsg_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rlen
OG
id|skb-&gt;len
)paren
id|rlen
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|xfrm_user_rcv_msg
c_func
(paren
id|skb
comma
id|nlh
comma
op_amp
id|err
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|netlink_ack
c_func
(paren
id|skb
comma
id|nlh
comma
id|err
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nlh-&gt;nlmsg_flags
op_amp
id|NLM_F_ACK
)paren
id|netlink_ack
c_func
(paren
id|skb
comma
id|nlh
comma
l_int|0
)paren
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|rlen
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xfrm_netlink_rcv
r_static
r_void
id|xfrm_netlink_rcv
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
(brace
r_do
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|down
c_func
(paren
op_amp
id|xfrm_cfg_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|xfrm_user_rcv_skb
c_func
(paren
id|skb
)paren
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;len
)paren
id|skb_queue_head
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
r_else
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|xfrm_cfg_sem
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|xfrm_nl
op_logical_and
id|xfrm_nl-&gt;sk_receive_queue.qlen
)paren
suffix:semicolon
)brace
DECL|function|build_expire
r_static
r_int
id|build_expire
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|hard
)paren
(brace
r_struct
id|xfrm_user_expire
op_star
id|ue
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
l_int|0
comma
l_int|0
comma
id|XFRM_MSG_EXPIRE
comma
r_sizeof
(paren
op_star
id|ue
)paren
)paren
suffix:semicolon
id|ue
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
l_int|0
suffix:semicolon
id|copy_to_user_state
c_func
(paren
id|x
comma
op_amp
id|ue-&gt;state
)paren
suffix:semicolon
id|ue-&gt;hard
op_assign
(paren
id|hard
op_ne
l_int|0
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_send_state_notify
r_static
r_int
id|xfrm_send_state_notify
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|hard
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_expire
)paren
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|build_expire
c_func
(paren
id|skb
comma
id|x
comma
id|hard
)paren
OL
l_int|0
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|XFRMGRP_EXPIRE
suffix:semicolon
r_return
id|netlink_broadcast
c_func
(paren
id|xfrm_nl
comma
id|skb
comma
l_int|0
comma
id|XFRMGRP_EXPIRE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
DECL|function|build_acquire
r_static
r_int
id|build_acquire
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_state
op_star
id|x
comma
r_struct
id|xfrm_tmpl
op_star
id|xt
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
)paren
(brace
r_struct
id|xfrm_user_acquire
op_star
id|ua
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|__u32
id|seq
op_assign
id|xfrm_get_acqseq
c_func
(paren
)paren
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
l_int|0
comma
l_int|0
comma
id|XFRM_MSG_ACQUIRE
comma
r_sizeof
(paren
op_star
id|ua
)paren
)paren
suffix:semicolon
id|ua
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ua-&gt;id
comma
op_amp
id|x-&gt;id
comma
r_sizeof
(paren
id|ua-&gt;id
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ua-&gt;saddr
comma
op_amp
id|x-&gt;props.saddr
comma
r_sizeof
(paren
id|ua-&gt;saddr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ua-&gt;sel
comma
op_amp
id|x-&gt;sel
comma
r_sizeof
(paren
id|ua-&gt;sel
)paren
)paren
suffix:semicolon
id|copy_to_user_policy
c_func
(paren
id|xp
comma
op_amp
id|ua-&gt;policy
comma
id|dir
)paren
suffix:semicolon
id|ua-&gt;aalgos
op_assign
id|xt-&gt;aalgos
suffix:semicolon
id|ua-&gt;ealgos
op_assign
id|xt-&gt;ealgos
suffix:semicolon
id|ua-&gt;calgos
op_assign
id|xt-&gt;calgos
suffix:semicolon
id|ua-&gt;seq
op_assign
id|x-&gt;km.seq
op_assign
id|seq
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user_tmpl
c_func
(paren
id|xp
comma
id|skb
)paren
OL
l_int|0
)paren
r_goto
id|nlmsg_failure
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_send_acquire
r_static
r_int
id|xfrm_send_acquire
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_struct
id|xfrm_tmpl
op_star
id|xt
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|RTA_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_tmpl
)paren
op_star
id|xp-&gt;xfrm_nr
)paren
suffix:semicolon
id|len
op_add_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_acquire
)paren
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|build_acquire
c_func
(paren
id|skb
comma
id|x
comma
id|xt
comma
id|xp
comma
id|dir
)paren
OL
l_int|0
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|XFRMGRP_ACQUIRE
suffix:semicolon
r_return
id|netlink_broadcast
c_func
(paren
id|xfrm_nl
comma
id|skb
comma
l_int|0
comma
id|XFRMGRP_ACQUIRE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
multiline_comment|/* User gives us xfrm_user_policy_info followed by an array of 0&n; * or more templates.&n; */
DECL|function|xfrm_compile_policy
r_static
r_struct
id|xfrm_policy
op_star
id|xfrm_compile_policy
c_func
(paren
id|u16
id|family
comma
r_int
id|opt
comma
id|u8
op_star
id|data
comma
r_int
id|len
comma
r_int
op_star
id|dir
)paren
(brace
r_struct
id|xfrm_userpolicy_info
op_star
id|p
op_assign
(paren
r_struct
id|xfrm_userpolicy_info
op_star
)paren
id|data
suffix:semicolon
r_struct
id|xfrm_user_tmpl
op_star
id|ut
op_assign
(paren
r_struct
id|xfrm_user_tmpl
op_star
)paren
(paren
id|p
op_plus
l_int|1
)paren
suffix:semicolon
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_int
id|nr
suffix:semicolon
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_if
c_cond
(paren
id|opt
op_ne
id|IP_XFRM_POLICY
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
r_if
c_cond
(paren
id|opt
op_ne
id|IPV6_XFRM_POLICY
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
op_star
id|dir
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|dir
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
r_sizeof
(paren
op_star
id|p
)paren
op_logical_or
id|verify_newpolicy_info
c_func
(paren
id|p
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|nr
op_assign
(paren
(paren
id|len
op_minus
r_sizeof
(paren
op_star
id|p
)paren
)paren
op_div
r_sizeof
(paren
op_star
id|ut
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr
OG
id|XFRM_MAX_DEPTH
)paren
r_return
l_int|NULL
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_alloc
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|copy_from_user_policy
c_func
(paren
id|xp
comma
id|p
)paren
suffix:semicolon
id|copy_templates
c_func
(paren
id|xp
comma
id|ut
comma
id|nr
)paren
suffix:semicolon
op_star
id|dir
op_assign
id|p-&gt;dir
suffix:semicolon
r_return
id|xp
suffix:semicolon
)brace
DECL|function|build_polexpire
r_static
r_int
id|build_polexpire
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
r_int
id|hard
)paren
(brace
r_struct
id|xfrm_user_polexpire
op_star
id|upe
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
r_char
op_star
id|b
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
l_int|0
comma
l_int|0
comma
id|XFRM_MSG_POLEXPIRE
comma
r_sizeof
(paren
op_star
id|upe
)paren
)paren
suffix:semicolon
id|upe
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_assign
l_int|0
suffix:semicolon
id|copy_to_user_policy
c_func
(paren
id|xp
comma
op_amp
id|upe-&gt;pol
comma
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user_tmpl
c_func
(paren
id|xp
comma
id|skb
)paren
OL
l_int|0
)paren
r_goto
id|nlmsg_failure
suffix:semicolon
id|upe-&gt;hard
op_assign
op_logical_neg
op_logical_neg
id|hard
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|b
suffix:semicolon
r_return
id|skb-&gt;len
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|skb_trim
c_func
(paren
id|skb
comma
id|b
op_minus
id|skb-&gt;data
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|xfrm_send_policy_notify
r_static
r_int
id|xfrm_send_policy_notify
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
r_int
id|hard
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|RTA_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_tmpl
)paren
op_star
id|xp-&gt;xfrm_nr
)paren
suffix:semicolon
id|len
op_add_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|xfrm_user_polexpire
)paren
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|build_polexpire
c_func
(paren
id|skb
comma
id|xp
comma
id|dir
comma
id|hard
)paren
OL
l_int|0
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|XFRMGRP_EXPIRE
suffix:semicolon
r_return
id|netlink_broadcast
c_func
(paren
id|xfrm_nl
comma
id|skb
comma
l_int|0
comma
id|XFRMGRP_EXPIRE
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
DECL|variable|netlink_mgr
r_static
r_struct
id|xfrm_mgr
id|netlink_mgr
op_assign
(brace
dot
id|id
op_assign
l_string|&quot;netlink&quot;
comma
dot
id|notify
op_assign
id|xfrm_send_state_notify
comma
dot
id|acquire
op_assign
id|xfrm_send_acquire
comma
dot
id|compile_policy
op_assign
id|xfrm_compile_policy
comma
dot
id|notify_policy
op_assign
id|xfrm_send_policy_notify
comma
)brace
suffix:semicolon
DECL|function|xfrm_user_init
r_static
r_int
id|__init
id|xfrm_user_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Initializing IPsec netlink socket&bslash;n&quot;
)paren
suffix:semicolon
id|xfrm_nl
op_assign
id|netlink_kernel_create
c_func
(paren
id|NETLINK_XFRM
comma
id|xfrm_netlink_rcv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xfrm_nl
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|xfrm_register_km
c_func
(paren
op_amp
id|netlink_mgr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|xfrm_user_exit
r_static
r_void
id|__exit
id|xfrm_user_exit
c_func
(paren
r_void
)paren
(brace
id|xfrm_unregister_km
c_func
(paren
op_amp
id|netlink_mgr
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|xfrm_nl-&gt;sk_socket
)paren
suffix:semicolon
)brace
DECL|variable|xfrm_user_init
id|module_init
c_func
(paren
id|xfrm_user_init
)paren
suffix:semicolon
DECL|variable|xfrm_user_exit
id|module_exit
c_func
(paren
id|xfrm_user_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
