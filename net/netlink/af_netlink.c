multiline_comment|/*&n; * NETLINK      Kernel-user communication protocol.&n; *&n; * &t;&t;Authors:&t;Alan Cox &lt;alan@redhat.com&gt;&n; * &t;&t;&t;&t;Alexey Kuznetsov &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; * &n; * Tue Jun 26 14:36:48 MEST 2001 Herbert &quot;herp&quot; Rosmanith&n; *                               added netlink_proto_exit&n; * Tue Jan 22 18:32:44 BRST 2002 Arnaldo C. de Melo &lt;acme@conectiva.com.br&gt;&n; * &t;&t;&t;&t; use nlk_sk, as sk-&gt;protinfo is on a diet 8)&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/un.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;linux/net.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/security.h&gt;
macro_line|#include &lt;linux/jhash.h&gt;
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/scm.h&gt;
DECL|macro|Nprintk
mdefine_line|#define Nprintk(a...)
macro_line|#if defined(CONFIG_NETLINK_DEV) || defined(CONFIG_NETLINK_DEV_MODULE)
DECL|macro|NL_EMULATE_DEV
mdefine_line|#define NL_EMULATE_DEV
macro_line|#endif
DECL|struct|netlink_opt
r_struct
id|netlink_opt
(brace
DECL|member|pid
id|u32
id|pid
suffix:semicolon
DECL|member|groups
r_int
r_int
id|groups
suffix:semicolon
DECL|member|dst_pid
id|u32
id|dst_pid
suffix:semicolon
DECL|member|dst_groups
r_int
r_int
id|dst_groups
suffix:semicolon
DECL|member|state
r_int
r_int
id|state
suffix:semicolon
DECL|member|handler
r_int
(paren
op_star
id|handler
)paren
(paren
r_int
id|unit
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|cb
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
DECL|member|cb_lock
id|spinlock_t
id|cb_lock
suffix:semicolon
DECL|member|data_ready
r_void
(paren
op_star
id|data_ready
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|bytes
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|nlk_sk
mdefine_line|#define nlk_sk(__sk) ((struct netlink_opt *)(__sk)-&gt;sk_protinfo)
DECL|struct|nl_pid_hash
r_struct
id|nl_pid_hash
(brace
DECL|member|table
r_struct
id|hlist_head
op_star
id|table
suffix:semicolon
DECL|member|rehash_time
r_int
r_int
id|rehash_time
suffix:semicolon
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
DECL|member|shift
r_int
r_int
id|shift
suffix:semicolon
DECL|member|entries
r_int
r_int
id|entries
suffix:semicolon
DECL|member|max_shift
r_int
r_int
id|max_shift
suffix:semicolon
DECL|member|rnd
id|u32
id|rnd
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|netlink_table
r_struct
id|netlink_table
(brace
DECL|member|hash
r_struct
id|nl_pid_hash
id|hash
suffix:semicolon
DECL|member|mc_list
r_struct
id|hlist_head
id|mc_list
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|nl_table
r_static
r_struct
id|netlink_table
op_star
id|nl_table
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|nl_table_wait
)paren
suffix:semicolon
DECL|variable|nl_nonroot
r_static
r_int
r_int
id|nl_nonroot
(braket
id|MAX_LINKS
)braket
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
DECL|variable|netlink_kernel
r_static
r_struct
id|socket
op_star
id|netlink_kernel
(braket
id|MAX_LINKS
)braket
suffix:semicolon
macro_line|#endif
r_static
r_int
id|netlink_dump
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
suffix:semicolon
r_static
r_void
id|netlink_destroy_callback
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
suffix:semicolon
DECL|variable|nl_table_lock
r_static
id|rwlock_t
id|nl_table_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|nl_table_users
r_static
id|atomic_t
id|nl_table_users
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|variable|netlink_chain
r_static
r_struct
id|notifier_block
op_star
id|netlink_chain
suffix:semicolon
DECL|function|nl_pid_hashfn
r_static
r_struct
id|hlist_head
op_star
id|nl_pid_hashfn
c_func
(paren
r_struct
id|nl_pid_hash
op_star
id|hash
comma
id|u32
id|pid
)paren
(brace
r_return
op_amp
id|hash-&gt;table
(braket
id|jhash_1word
c_func
(paren
id|pid
comma
id|hash-&gt;rnd
)paren
op_amp
id|hash-&gt;mask
)braket
suffix:semicolon
)brace
DECL|function|netlink_sock_destruct
r_static
r_void
id|netlink_sock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_DEAD
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Freeing alive netlink socket %p&bslash;n&quot;
comma
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
op_logical_neg
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|cb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|nlk_sk
c_func
(paren
id|sk
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This lock without WQ_FLAG_EXCLUSIVE is good on UP and it is _very_ bad on SMP.&n; * Look, when several writers sleep and reader wakes them up, all but one&n; * immediately hit write lock and grab all the cpus. Exclusive sleep solves&n; * this, _but_ remember, it adds useless work on UP machines.&n; */
DECL|function|netlink_table_grab
r_static
r_void
id|netlink_table_grab
c_func
(paren
r_void
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|nl_table_users
)paren
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
op_amp
id|nl_table_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|nl_table_users
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|nl_table_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
)brace
DECL|function|netlink_table_ungrab
r_static
id|__inline__
r_void
id|netlink_table_ungrab
c_func
(paren
r_void
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|nl_table_wait
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|netlink_lock_table
id|netlink_lock_table
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* read_lock() synchronizes us to netlink_table_grab */
id|read_lock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|nl_table_users
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|netlink_unlock_table
id|netlink_unlock_table
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|nl_table_users
)paren
)paren
id|wake_up
c_func
(paren
op_amp
id|nl_table_wait
)paren
suffix:semicolon
)brace
DECL|function|netlink_lookup
r_static
id|__inline__
r_struct
id|sock
op_star
id|netlink_lookup
c_func
(paren
r_int
id|protocol
comma
id|u32
id|pid
)paren
(brace
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|protocol
)braket
dot
id|hash
suffix:semicolon
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
id|head
op_assign
id|nl_pid_hashfn
c_func
(paren
id|hash
comma
id|pid
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|sk
comma
id|node
comma
id|head
)paren
(brace
r_if
c_cond
(paren
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|pid
op_eq
id|pid
)paren
(brace
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|found
suffix:semicolon
)brace
)brace
id|sk
op_assign
l_int|NULL
suffix:semicolon
id|found
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|nl_pid_hash_alloc
r_static
r_inline
r_struct
id|hlist_head
op_star
id|nl_pid_hash_alloc
c_func
(paren
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|PAGE_SIZE
)paren
r_return
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_else
r_return
(paren
r_struct
id|hlist_head
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
)brace
DECL|function|nl_pid_hash_free
r_static
r_inline
r_void
id|nl_pid_hash_free
c_func
(paren
r_struct
id|hlist_head
op_star
id|table
comma
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|PAGE_SIZE
)paren
id|kfree
c_func
(paren
id|table
)paren
suffix:semicolon
r_else
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|table
comma
id|get_order
c_func
(paren
id|size
)paren
)paren
suffix:semicolon
)brace
DECL|function|nl_pid_hash_rehash
r_static
r_int
id|nl_pid_hash_rehash
c_func
(paren
r_struct
id|nl_pid_hash
op_star
id|hash
comma
r_int
id|grow
)paren
(brace
r_int
r_int
id|omask
comma
id|mask
comma
id|shift
suffix:semicolon
r_int
id|osize
comma
id|size
suffix:semicolon
r_struct
id|hlist_head
op_star
id|otable
comma
op_star
id|table
suffix:semicolon
r_int
id|i
suffix:semicolon
id|omask
op_assign
id|mask
op_assign
id|hash-&gt;mask
suffix:semicolon
id|osize
op_assign
id|size
op_assign
(paren
id|mask
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
op_star
id|table
)paren
suffix:semicolon
id|shift
op_assign
id|hash-&gt;shift
suffix:semicolon
r_if
c_cond
(paren
id|grow
)paren
(brace
r_if
c_cond
(paren
op_increment
id|shift
OG
id|hash-&gt;max_shift
)paren
r_return
l_int|0
suffix:semicolon
id|mask
op_assign
id|mask
op_star
l_int|2
op_plus
l_int|1
suffix:semicolon
id|size
op_mul_assign
l_int|2
suffix:semicolon
)brace
id|table
op_assign
id|nl_pid_hash_alloc
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|table
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|table
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|otable
op_assign
id|hash-&gt;table
suffix:semicolon
id|hash-&gt;table
op_assign
id|table
suffix:semicolon
id|hash-&gt;mask
op_assign
id|mask
suffix:semicolon
id|hash-&gt;shift
op_assign
id|shift
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|hash-&gt;rnd
comma
r_sizeof
(paren
id|hash-&gt;rnd
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|omask
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
comma
op_star
id|tmp
suffix:semicolon
id|sk_for_each_safe
c_func
(paren
id|sk
comma
id|node
comma
id|tmp
comma
op_amp
id|otable
(braket
id|i
)braket
)paren
id|__sk_add_node
c_func
(paren
id|sk
comma
id|nl_pid_hashfn
c_func
(paren
id|hash
comma
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|pid
)paren
)paren
suffix:semicolon
)brace
id|nl_pid_hash_free
c_func
(paren
id|otable
comma
id|osize
)paren
suffix:semicolon
id|hash-&gt;rehash_time
op_assign
id|jiffies
op_plus
l_int|10
op_star
l_int|60
op_star
id|HZ
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|nl_pid_hash_dilute
r_static
r_inline
r_int
id|nl_pid_hash_dilute
c_func
(paren
r_struct
id|nl_pid_hash
op_star
id|hash
comma
r_int
id|len
)paren
(brace
r_int
id|avg
op_assign
id|hash-&gt;entries
op_rshift
id|hash-&gt;shift
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|avg
OG
l_int|1
)paren
op_logical_and
id|nl_pid_hash_rehash
c_func
(paren
id|hash
comma
l_int|1
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|len
OG
id|avg
)paren
op_logical_and
id|time_after
c_func
(paren
id|jiffies
comma
id|hash-&gt;rehash_time
)paren
)paren
(brace
id|nl_pid_hash_rehash
c_func
(paren
id|hash
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|netlink_ops
r_static
r_struct
id|proto_ops
id|netlink_ops
suffix:semicolon
DECL|function|netlink_insert
r_static
r_int
id|netlink_insert
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
id|u32
id|pid
)paren
(brace
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|sk-&gt;sk_protocol
)braket
dot
id|hash
suffix:semicolon
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
r_struct
id|sock
op_star
id|osk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_int
id|len
suffix:semicolon
id|netlink_table_grab
c_func
(paren
)paren
suffix:semicolon
id|head
op_assign
id|nl_pid_hashfn
c_func
(paren
id|hash
comma
id|pid
)paren
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
id|sk_for_each
c_func
(paren
id|osk
comma
id|node
comma
id|head
)paren
(brace
r_if
c_cond
(paren
id|nlk_sk
c_func
(paren
id|osk
)paren
op_member_access_from_pointer
id|pid
op_eq
id|pid
)paren
r_break
suffix:semicolon
id|len
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|node
)paren
r_goto
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|pid
)paren
r_goto
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|BITS_PER_LONG
OG
l_int|32
op_logical_and
id|unlikely
c_func
(paren
id|hash-&gt;entries
op_ge
id|UINT_MAX
)paren
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
id|len
op_logical_and
id|nl_pid_hash_dilute
c_func
(paren
id|hash
comma
id|len
)paren
)paren
id|head
op_assign
id|nl_pid_hashfn
c_func
(paren
id|hash
comma
id|pid
)paren
suffix:semicolon
id|hash-&gt;entries
op_increment
suffix:semicolon
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|pid
op_assign
id|pid
suffix:semicolon
id|sk_add_node
c_func
(paren
id|sk
comma
id|head
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|err
suffix:colon
id|netlink_table_ungrab
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|netlink_remove
r_static
r_void
id|netlink_remove
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|netlink_table_grab
c_func
(paren
)paren
suffix:semicolon
id|nl_table
(braket
id|sk-&gt;sk_protocol
)braket
dot
id|hash.entries
op_decrement
suffix:semicolon
id|sk_del_node_init
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|groups
)paren
id|__sk_del_bind_node
c_func
(paren
id|sk
)paren
suffix:semicolon
id|netlink_table_ungrab
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|netlink_create
r_static
r_int
id|netlink_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_RAW
op_logical_and
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|protocol
OL
l_int|0
op_logical_or
id|protocol
op_ge
id|MAX_LINKS
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|netlink_ops
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_NETLINK
comma
id|GFP_KERNEL
comma
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|sk
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|nlk
op_assign
id|sk-&gt;sk_protinfo
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|nlk
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nlk
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|nlk
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|nlk
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|nlk-&gt;wait
)paren
suffix:semicolon
id|sk-&gt;sk_destruct
op_assign
id|netlink_sock_destruct
suffix:semicolon
id|sk-&gt;sk_protocol
op_assign
id|protocol
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_release
r_static
r_int
id|netlink_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
l_int|0
suffix:semicolon
id|netlink_remove
c_func
(paren
id|sk
)paren
suffix:semicolon
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;cb
)paren
(brace
id|nlk-&gt;cb
op_member_access_from_pointer
id|done
c_func
(paren
id|nlk-&gt;cb
)paren
suffix:semicolon
id|netlink_destroy_callback
c_func
(paren
id|nlk-&gt;cb
)paren
suffix:semicolon
id|nlk-&gt;cb
op_assign
l_int|NULL
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
multiline_comment|/* OK. Socket is unlinked, and, therefore,&n;&t;   no new packets will arrive */
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|wake_up_interruptible_all
c_func
(paren
op_amp
id|nlk-&gt;wait
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;sk_write_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;pid
op_logical_and
op_logical_neg
id|nlk-&gt;groups
)paren
(brace
r_struct
id|netlink_notify
id|n
op_assign
(brace
dot
id|protocol
op_assign
id|sk-&gt;sk_protocol
comma
dot
id|pid
op_assign
id|nlk-&gt;pid
comma
)brace
suffix:semicolon
id|notifier_call_chain
c_func
(paren
op_amp
id|netlink_chain
comma
id|NETLINK_URELEASE
comma
op_amp
id|n
)paren
suffix:semicolon
)brace
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_autobind
r_static
r_int
id|netlink_autobind
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|sk-&gt;sk_protocol
)braket
dot
id|hash
suffix:semicolon
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
r_struct
id|sock
op_star
id|osk
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
id|s32
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|s32
id|rover
op_assign
op_minus
l_int|4097
suffix:semicolon
id|retry
suffix:colon
id|cond_resched
c_func
(paren
)paren
suffix:semicolon
id|netlink_table_grab
c_func
(paren
)paren
suffix:semicolon
id|head
op_assign
id|nl_pid_hashfn
c_func
(paren
id|hash
comma
id|pid
)paren
suffix:semicolon
id|sk_for_each
c_func
(paren
id|osk
comma
id|node
comma
id|head
)paren
(brace
r_if
c_cond
(paren
id|nlk_sk
c_func
(paren
id|osk
)paren
op_member_access_from_pointer
id|pid
op_eq
id|pid
)paren
(brace
multiline_comment|/* Bind collision, search negative pid values. */
r_if
c_cond
(paren
id|pid
OG
l_int|0
)paren
id|pid
op_assign
id|rover
suffix:semicolon
r_else
r_if
c_cond
(paren
op_decrement
id|pid
OG
l_int|0
)paren
id|pid
op_assign
op_minus
l_int|4097
suffix:semicolon
id|netlink_table_ungrab
c_func
(paren
)paren
suffix:semicolon
r_goto
id|retry
suffix:semicolon
)brace
)brace
id|netlink_table_ungrab
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|netlink_insert
c_func
(paren
id|sk
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EADDRINUSE
)paren
r_goto
id|retry
suffix:semicolon
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|groups
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_capable
r_static
r_inline
r_int
id|netlink_capable
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|flag
)paren
(brace
r_return
(paren
id|nl_nonroot
(braket
id|sock-&gt;sk-&gt;sk_protocol
)braket
op_amp
id|flag
)paren
op_logical_or
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
suffix:semicolon
)brace
DECL|function|netlink_bind
r_static
r_int
id|netlink_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
id|addr_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|nladdr-&gt;nl_family
op_ne
id|AF_NETLINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Only superuser is allowed to listen multicasts */
r_if
c_cond
(paren
id|nladdr-&gt;nl_groups
op_logical_and
op_logical_neg
id|netlink_capable
c_func
(paren
id|sock
comma
id|NL_NONROOT_RECV
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;pid
)paren
(brace
r_if
c_cond
(paren
id|nladdr-&gt;nl_pid
op_ne
id|nlk-&gt;pid
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|nladdr-&gt;nl_pid
ques
c_cond
id|netlink_insert
c_func
(paren
id|sk
comma
id|nladdr-&gt;nl_pid
)paren
suffix:colon
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
id|nlk-&gt;groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
r_if
c_cond
(paren
id|nladdr-&gt;nl_groups
)paren
id|sk_add_bind_node
c_func
(paren
id|sk
comma
op_amp
id|nl_table
(braket
id|sk-&gt;sk_protocol
)braket
dot
id|mc_list
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_connect
r_static
r_int
id|netlink_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
id|alen
comma
r_int
id|flags
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_eq
id|AF_UNSPEC
)paren
(brace
id|sk-&gt;sk_state
op_assign
id|NETLINK_UNCONNECTED
suffix:semicolon
id|nlk-&gt;dst_pid
op_assign
l_int|0
suffix:semicolon
id|nlk-&gt;dst_groups
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;sa_family
op_ne
id|AF_NETLINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Only superuser is allowed to send multicasts */
r_if
c_cond
(paren
id|nladdr-&gt;nl_groups
op_logical_and
op_logical_neg
id|netlink_capable
c_func
(paren
id|sock
comma
id|NL_NONROOT_SEND
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nlk-&gt;pid
)paren
id|err
op_assign
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
(brace
id|sk-&gt;sk_state
op_assign
id|NETLINK_CONNECTED
suffix:semicolon
id|nlk-&gt;dst_pid
op_assign
id|nladdr-&gt;nl_pid
suffix:semicolon
id|nlk-&gt;dst_groups
op_assign
id|nladdr-&gt;nl_groups
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|netlink_getname
r_static
r_int
id|netlink_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|addr
comma
r_int
op_star
id|addr_len
comma
r_int
id|peer
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|nladdr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|addr
suffix:semicolon
id|nladdr-&gt;nl_family
op_assign
id|AF_NETLINK
suffix:semicolon
id|nladdr-&gt;nl_pad
op_assign
l_int|0
suffix:semicolon
op_star
id|addr_len
op_assign
r_sizeof
(paren
op_star
id|nladdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
id|nladdr-&gt;nl_pid
op_assign
id|nlk-&gt;dst_pid
suffix:semicolon
id|nladdr-&gt;nl_groups
op_assign
id|nlk-&gt;dst_groups
suffix:semicolon
)brace
r_else
(brace
id|nladdr-&gt;nl_pid
op_assign
id|nlk-&gt;pid
suffix:semicolon
id|nladdr-&gt;nl_groups
op_assign
id|nlk-&gt;groups
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_overrun
r_static
r_void
id|netlink_overrun
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_and_set_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|state
)paren
)paren
(brace
id|sk-&gt;sk_err
op_assign
id|ENOBUFS
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
)brace
DECL|function|netlink_getsockbypid
r_struct
id|sock
op_star
id|netlink_getsockbypid
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
id|u32
id|pid
)paren
(brace
r_int
id|protocol
op_assign
id|ssk-&gt;sk_protocol
suffix:semicolon
r_struct
id|sock
op_star
id|sock
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
id|sock
op_assign
id|netlink_lookup
c_func
(paren
id|protocol
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sock
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ECONNREFUSED
)paren
suffix:semicolon
multiline_comment|/* Don&squot;t bother queuing skb if kernel socket has no input function */
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nlk-&gt;pid
op_eq
l_int|0
op_logical_and
op_logical_neg
id|nlk-&gt;data_ready
)paren
op_logical_or
(paren
id|sock-&gt;sk_state
op_eq
id|NETLINK_CONNECTED
op_logical_and
id|nlk-&gt;dst_pid
op_ne
id|nlk_sk
c_func
(paren
id|ssk
)paren
op_member_access_from_pointer
id|pid
)paren
)paren
(brace
id|sock_put
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ECONNREFUSED
)paren
suffix:semicolon
)brace
r_return
id|sock
suffix:semicolon
)brace
DECL|function|netlink_getsockbyfilp
r_struct
id|sock
op_star
id|netlink_getsockbyfilp
c_func
(paren
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|socket
op_star
id|socket
suffix:semicolon
r_struct
id|sock
op_star
id|sock
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_sock
op_logical_or
op_logical_neg
(paren
id|socket
op_assign
id|SOCKET_I
c_func
(paren
id|inode
)paren
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOTSOCK
)paren
suffix:semicolon
id|sock
op_assign
id|socket-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;sk_family
op_ne
id|AF_NETLINK
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
id|sock
suffix:semicolon
)brace
multiline_comment|/*&n; * Attach a skb to a netlink socket.&n; * The caller must hold a reference to the destination socket. On error, the&n; * reference is dropped. The skb is not send to the destination, just all&n; * all error checks are performed and memory in the queue is reserved.&n; * Return values:&n; * &lt; 0: error. skb freed, reference to sock dropped.&n; * 0: continue&n; * 1: repeat lookup - reference dropped while waiting for socket memory.&n; */
DECL|function|netlink_attachskb
r_int
id|netlink_attachskb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|nonblock
comma
r_int
id|timeo
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
r_if
c_cond
(paren
id|nlk-&gt;handler
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
OG
id|sk-&gt;sk_rcvbuf
op_logical_or
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk-&gt;state
)paren
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeo
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|nlk-&gt;pid
)paren
id|netlink_overrun
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|nlk-&gt;wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
OG
id|sk-&gt;sk_rcvbuf
op_logical_or
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk-&gt;state
)paren
)paren
op_logical_and
op_logical_neg
id|sock_flag
c_func
(paren
id|sk
comma
id|SOCK_DEAD
)paren
)paren
id|timeo
op_assign
id|schedule_timeout
c_func
(paren
id|timeo
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|nlk-&gt;wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|sock_intr_errno
c_func
(paren
id|timeo
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_sendskb
r_int
id|netlink_sendskb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|protocol
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
r_if
c_cond
(paren
id|nlk-&gt;handler
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|len
op_assign
id|nlk
op_member_access_from_pointer
id|handler
c_func
(paren
id|protocol
comma
id|skb
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_data_ready
c_func
(paren
id|sk
comma
id|len
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|netlink_detachskb
r_void
id|netlink_detachskb
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
DECL|function|netlink_trim
r_static
r_inline
r_void
id|netlink_trim
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|allocation
)paren
(brace
r_int
id|delta
op_assign
id|skb-&gt;end
op_minus
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* If the packet is charged to a socket, the modification&n;&t; * of truesize below is illegal and will corrupt socket&n;&t; * buffer accounting state.&n;&t; */
id|BUG_ON
c_func
(paren
id|skb-&gt;list
op_ne
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delta
op_star
l_int|2
OL
id|skb-&gt;truesize
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pskb_expand_head
c_func
(paren
id|skb
comma
l_int|0
comma
op_minus
id|delta
comma
id|allocation
)paren
)paren
r_return
suffix:semicolon
id|skb-&gt;truesize
op_sub_assign
id|delta
suffix:semicolon
)brace
DECL|function|netlink_unicast
r_int
id|netlink_unicast
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
r_int
id|nonblock
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|timeo
suffix:semicolon
id|netlink_trim
c_func
(paren
id|skb
comma
id|gfp_any
c_func
(paren
)paren
)paren
suffix:semicolon
id|timeo
op_assign
id|sock_sndtimeo
c_func
(paren
id|ssk
comma
id|nonblock
)paren
suffix:semicolon
id|retry
suffix:colon
id|sk
op_assign
id|netlink_getsockbypid
c_func
(paren
id|ssk
comma
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|sk
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|PTR_ERR
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|err
op_assign
id|netlink_attachskb
c_func
(paren
id|sk
comma
id|skb
comma
id|nonblock
comma
id|timeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|1
)paren
r_goto
id|retry
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
id|netlink_sendskb
c_func
(paren
id|sk
comma
id|skb
comma
id|ssk-&gt;sk_protocol
)paren
suffix:semicolon
)brace
DECL|function|netlink_broadcast_deliver
r_static
id|__inline__
r_int
id|netlink_broadcast_deliver
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
macro_line|#ifdef NL_EMULATE_DEV
r_if
c_cond
(paren
id|nlk-&gt;handler
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|nlk
op_member_access_from_pointer
id|handler
c_func
(paren
id|sk-&gt;sk_protocol
comma
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
op_le
id|sk-&gt;sk_rcvbuf
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk-&gt;state
)paren
)paren
(brace
id|skb_orphan
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
id|skb
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
OG
id|sk-&gt;sk_rcvbuf
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|struct|netlink_broadcast_data
r_struct
id|netlink_broadcast_data
(brace
DECL|member|exclude_sk
r_struct
id|sock
op_star
id|exclude_sk
suffix:semicolon
DECL|member|pid
id|u32
id|pid
suffix:semicolon
DECL|member|group
id|u32
id|group
suffix:semicolon
DECL|member|failure
r_int
id|failure
suffix:semicolon
DECL|member|congested
r_int
id|congested
suffix:semicolon
DECL|member|delivered
r_int
id|delivered
suffix:semicolon
DECL|member|allocation
r_int
id|allocation
suffix:semicolon
DECL|member|skb
DECL|member|skb2
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|skb2
suffix:semicolon
)brace
suffix:semicolon
DECL|function|do_one_broadcast
r_static
r_inline
r_int
id|do_one_broadcast
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|netlink_broadcast_data
op_star
id|p
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;exclude_sk
op_eq
id|sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;pid
op_eq
id|p-&gt;pid
op_logical_or
op_logical_neg
(paren
id|nlk-&gt;groups
op_amp
id|p-&gt;group
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;failure
)paren
(brace
id|netlink_overrun
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;skb2
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|p-&gt;skb-&gt;users
)paren
op_ne
l_int|1
)paren
(brace
id|p-&gt;skb2
op_assign
id|skb_clone
c_func
(paren
id|p-&gt;skb
comma
id|p-&gt;allocation
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;skb2
op_assign
id|p-&gt;skb
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|p-&gt;skb-&gt;users
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;skb2
op_eq
l_int|NULL
)paren
(brace
id|netlink_overrun
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* Clone failed. Notify ALL listeners. */
id|p-&gt;failure
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|val
op_assign
id|netlink_broadcast_deliver
c_func
(paren
id|sk
comma
id|p-&gt;skb2
)paren
)paren
OL
l_int|0
)paren
(brace
id|netlink_overrun
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;congested
op_or_assign
id|val
suffix:semicolon
id|p-&gt;delivered
op_assign
l_int|1
suffix:semicolon
id|p-&gt;skb2
op_assign
l_int|NULL
suffix:semicolon
)brace
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_broadcast
r_int
id|netlink_broadcast
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
id|u32
id|pid
comma
id|u32
id|group
comma
r_int
id|allocation
)paren
(brace
r_struct
id|netlink_broadcast_data
id|info
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|info.exclude_sk
op_assign
id|ssk
suffix:semicolon
id|info.pid
op_assign
id|pid
suffix:semicolon
id|info.group
op_assign
id|group
suffix:semicolon
id|info.failure
op_assign
l_int|0
suffix:semicolon
id|info.congested
op_assign
l_int|0
suffix:semicolon
id|info.delivered
op_assign
l_int|0
suffix:semicolon
id|info.allocation
op_assign
id|allocation
suffix:semicolon
id|info.skb
op_assign
id|skb
suffix:semicolon
id|info.skb2
op_assign
l_int|NULL
suffix:semicolon
id|netlink_trim
c_func
(paren
id|skb
comma
id|allocation
)paren
suffix:semicolon
multiline_comment|/* While we sleep in clone, do not allow to change socket list */
id|netlink_lock_table
c_func
(paren
)paren
suffix:semicolon
id|sk_for_each_bound
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|nl_table
(braket
id|ssk-&gt;sk_protocol
)braket
dot
id|mc_list
)paren
id|do_one_broadcast
c_func
(paren
id|sk
comma
op_amp
id|info
)paren
suffix:semicolon
id|netlink_unlock_table
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.skb2
)paren
id|kfree_skb
c_func
(paren
id|info.skb2
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info.delivered
)paren
(brace
r_if
c_cond
(paren
id|info.congested
op_logical_and
(paren
id|allocation
op_amp
id|__GFP_WAIT
)paren
)paren
id|yield
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info.failure
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
r_return
op_minus
id|ESRCH
suffix:semicolon
)brace
DECL|struct|netlink_set_err_data
r_struct
id|netlink_set_err_data
(brace
DECL|member|exclude_sk
r_struct
id|sock
op_star
id|exclude_sk
suffix:semicolon
DECL|member|pid
id|u32
id|pid
suffix:semicolon
DECL|member|group
id|u32
id|group
suffix:semicolon
DECL|member|code
r_int
id|code
suffix:semicolon
)brace
suffix:semicolon
DECL|function|do_one_set_err
r_static
r_inline
r_int
id|do_one_set_err
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|netlink_set_err_data
op_star
id|p
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
id|p-&gt;exclude_sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;pid
op_eq
id|p-&gt;pid
op_logical_or
op_logical_neg
(paren
id|nlk-&gt;groups
op_amp
id|p-&gt;group
)paren
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;sk_err
op_assign
id|p-&gt;code
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_set_err
r_void
id|netlink_set_err
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
id|u32
id|pid
comma
id|u32
id|group
comma
r_int
id|code
)paren
(brace
r_struct
id|netlink_set_err_data
id|info
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|info.exclude_sk
op_assign
id|ssk
suffix:semicolon
id|info.pid
op_assign
id|pid
suffix:semicolon
id|info.group
op_assign
id|group
suffix:semicolon
id|info.code
op_assign
id|code
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
id|sk_for_each_bound
c_func
(paren
id|sk
comma
id|node
comma
op_amp
id|nl_table
(braket
id|ssk-&gt;sk_protocol
)braket
dot
id|mc_list
)paren
id|do_one_set_err
c_func
(paren
id|sk
comma
op_amp
id|info
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
)brace
DECL|function|netlink_rcv_wake
r_static
r_inline
r_void
id|netlink_rcv_wake
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_len
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
id|clear_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk-&gt;state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
l_int|0
comma
op_amp
id|nlk-&gt;state
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|nlk-&gt;wait
)paren
suffix:semicolon
)brace
DECL|function|netlink_sendmsg
r_static
r_int
id|netlink_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|kiocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
)paren
(brace
r_struct
id|sock_iocb
op_star
id|siocb
op_assign
id|kiocb_to_siocb
c_func
(paren
id|kiocb
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_nl
op_star
id|addr
op_assign
id|msg-&gt;msg_name
suffix:semicolon
id|u32
id|dst_pid
suffix:semicolon
id|u32
id|dst_groups
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|scm_cookie
id|scm
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
id|MSG_OOB
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
id|siocb-&gt;scm
)paren
id|siocb-&gt;scm
op_assign
op_amp
id|scm
suffix:semicolon
id|err
op_assign
id|scm_send
c_func
(paren
id|sock
comma
id|msg
comma
id|siocb-&gt;scm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
)paren
(brace
r_if
c_cond
(paren
id|addr-&gt;nl_family
op_ne
id|AF_NETLINK
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|dst_pid
op_assign
id|addr-&gt;nl_pid
suffix:semicolon
id|dst_groups
op_assign
id|addr-&gt;nl_groups
suffix:semicolon
r_if
c_cond
(paren
id|dst_groups
op_logical_and
op_logical_neg
id|netlink_capable
c_func
(paren
id|sock
comma
id|NL_NONROOT_SEND
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
r_else
(brace
id|dst_pid
op_assign
id|nlk-&gt;dst_pid
suffix:semicolon
id|dst_groups
op_assign
id|nlk-&gt;dst_groups
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|nlk-&gt;pid
)paren
(brace
id|err
op_assign
id|netlink_autobind
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|sk-&gt;sk_sndbuf
op_minus
l_int|32
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
op_assign
id|nlk-&gt;pid
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|groups
op_assign
id|nlk-&gt;groups
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_pid
op_assign
id|dst_pid
suffix:semicolon
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
op_assign
id|dst_groups
suffix:semicolon
id|memcpy
c_func
(paren
id|NETLINK_CREDS
c_func
(paren
id|skb
)paren
comma
op_amp
id|siocb-&gt;scm-&gt;creds
comma
r_sizeof
(paren
r_struct
id|ucred
)paren
)paren
suffix:semicolon
multiline_comment|/* What can I do? Netlink is asynchronous, so that&n;&t;   we will have to save current capabilities to&n;&t;   check them, when this message will be delivered&n;&t;   to corresponding kernel module.   --ANK (980802)&n;&t; */
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|security_netlink_send
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dst_groups
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|sk
comma
id|skb
comma
id|dst_pid
comma
id|dst_groups
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
id|err
op_assign
id|netlink_unicast
c_func
(paren
id|sk
comma
id|skb
comma
id|dst_pid
comma
id|msg-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|netlink_recvmsg
r_static
r_int
id|netlink_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|kiocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock_iocb
op_star
id|siocb
op_assign
id|kiocb_to_siocb
c_func
(paren
id|kiocb
)paren
suffix:semicolon
r_struct
id|scm_cookie
id|scm
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|noblock
op_assign
id|flags
op_amp
id|MSG_DONTWAIT
suffix:semicolon
r_int
id|copied
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MSG_OOB
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|copied
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|noblock
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
l_int|0
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
id|copied
)paren
(brace
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
id|copied
op_assign
id|len
suffix:semicolon
)brace
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|err
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_name
)paren
(brace
r_struct
id|sockaddr_nl
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_nl
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
id|addr-&gt;nl_family
op_assign
id|AF_NETLINK
suffix:semicolon
id|addr-&gt;nl_pad
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;nl_pid
op_assign
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
suffix:semicolon
id|addr-&gt;nl_groups
op_assign
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|dst_groups
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
op_star
id|addr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|NULL
op_eq
id|siocb-&gt;scm
)paren
(brace
id|memset
c_func
(paren
op_amp
id|scm
comma
l_int|0
comma
r_sizeof
(paren
id|scm
)paren
)paren
suffix:semicolon
id|siocb-&gt;scm
op_assign
op_amp
id|scm
suffix:semicolon
)brace
id|siocb-&gt;scm-&gt;creds
op_assign
op_star
id|NETLINK_CREDS
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;cb
op_logical_and
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
op_le
id|sk-&gt;sk_rcvbuf
op_div
l_int|2
)paren
id|netlink_dump
c_func
(paren
id|sk
)paren
suffix:semicolon
id|scm_recv
c_func
(paren
id|sock
comma
id|msg
comma
id|siocb-&gt;scm
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
id|netlink_rcv_wake
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
ques
c_cond
suffix:colon
id|copied
suffix:semicolon
)brace
DECL|function|netlink_data_ready
r_static
r_void
id|netlink_data_ready
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;data_ready
)paren
id|nlk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
id|len
)paren
suffix:semicolon
id|netlink_rcv_wake
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;We export these functions to other modules. They provide a &n; *&t;complete set of kernel non-blocking support for message&n; *&t;queueing.&n; */
r_struct
id|sock
op_star
DECL|function|netlink_kernel_create
id|netlink_kernel_create
c_func
(paren
r_int
id|unit
comma
r_void
(paren
op_star
id|input
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|len
)paren
)paren
(brace
r_struct
id|socket
op_star
id|sock
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nl_table
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|unit
OL
l_int|0
op_logical_or
id|unit
op_ge
id|MAX_LINKS
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sock_create_lite
c_func
(paren
id|PF_NETLINK
comma
id|SOCK_DGRAM
comma
id|unit
comma
op_amp
id|sock
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|netlink_create
c_func
(paren
id|sock
comma
id|unit
)paren
OL
l_int|0
)paren
(brace
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|sk-&gt;sk_data_ready
op_assign
id|netlink_data_ready
suffix:semicolon
r_if
c_cond
(paren
id|input
)paren
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|data_ready
op_assign
id|input
suffix:semicolon
r_if
c_cond
(paren
id|netlink_insert
c_func
(paren
id|sk
comma
l_int|0
)paren
)paren
(brace
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|sk
suffix:semicolon
)brace
DECL|function|netlink_set_nonroot
r_void
id|netlink_set_nonroot
c_func
(paren
r_int
id|protocol
comma
r_int
r_int
id|flags
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|protocol
OL
id|MAX_LINKS
)paren
id|nl_nonroot
(braket
id|protocol
)braket
op_assign
id|flags
suffix:semicolon
)brace
DECL|function|netlink_destroy_callback
r_static
r_void
id|netlink_destroy_callback
c_func
(paren
r_struct
id|netlink_callback
op_star
id|cb
)paren
(brace
r_if
c_cond
(paren
id|cb-&gt;skb
)paren
id|kfree_skb
c_func
(paren
id|cb-&gt;skb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|cb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * It looks a bit ugly.&n; * It would be better to create kernel thread.&n; */
DECL|function|netlink_dump
r_static
r_int
id|netlink_dump
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
r_int
id|len
suffix:semicolon
id|skb
op_assign
id|sock_rmalloc
c_func
(paren
id|sk
comma
id|NLMSG_GOODSIZE
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|cb
op_assign
id|nlk-&gt;cb
suffix:semicolon
r_if
c_cond
(paren
id|cb
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|len
op_assign
id|cb
op_member_access_from_pointer
id|dump
c_func
(paren
id|skb
comma
id|cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_data_ready
c_func
(paren
id|sk
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|nlh
op_assign
id|__nlmsg_put
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|cb-&gt;skb
)paren
dot
id|pid
comma
id|cb-&gt;nlh-&gt;nlmsg_seq
comma
id|NLMSG_DONE
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_flags
op_or_assign
id|NLM_F_MULTI
suffix:semicolon
id|memcpy
c_func
(paren
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
comma
op_amp
id|len
comma
r_sizeof
(paren
id|len
)paren
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_data_ready
c_func
(paren
id|sk
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|cb
op_member_access_from_pointer
id|done
c_func
(paren
id|cb
)paren
suffix:semicolon
id|nlk-&gt;cb
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_dump_start
r_int
id|netlink_dump_start
c_func
(paren
r_struct
id|sock
op_star
id|ssk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
(paren
op_star
id|dump
)paren
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|netlink_callback
op_star
)paren
comma
r_int
(paren
op_star
id|done
)paren
(paren
r_struct
id|netlink_callback
op_star
)paren
)paren
(brace
r_struct
id|netlink_callback
op_star
id|cb
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
suffix:semicolon
id|cb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|memset
c_func
(paren
id|cb
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cb
)paren
)paren
suffix:semicolon
id|cb-&gt;dump
op_assign
id|dump
suffix:semicolon
id|cb-&gt;done
op_assign
id|done
suffix:semicolon
id|cb-&gt;nlh
op_assign
id|nlh
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
id|cb-&gt;skb
op_assign
id|skb
suffix:semicolon
id|sk
op_assign
id|netlink_lookup
c_func
(paren
id|ssk-&gt;sk_protocol
comma
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
(brace
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
r_return
op_minus
id|ECONNREFUSED
suffix:semicolon
)brace
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* A dump is in progress... */
id|spin_lock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nlk-&gt;cb
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|netlink_destroy_callback
c_func
(paren
id|cb
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|nlk-&gt;cb
op_assign
id|cb
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|nlk-&gt;cb_lock
)paren
suffix:semicolon
id|netlink_dump
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_ack
r_void
id|netlink_ack
c_func
(paren
r_struct
id|sk_buff
op_star
id|in_skb
comma
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
id|err
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|rep
suffix:semicolon
r_struct
id|nlmsgerr
op_star
id|errmsg
suffix:semicolon
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
r_else
id|size
op_assign
id|NLMSG_SPACE
c_func
(paren
l_int|4
op_plus
id|NLMSG_ALIGN
c_func
(paren
id|nlh-&gt;nlmsg_len
)paren
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|sk
op_assign
id|netlink_lookup
c_func
(paren
id|in_skb-&gt;sk-&gt;sk_protocol
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|sk-&gt;sk_err
op_assign
id|ENOBUFS
suffix:semicolon
id|sk
op_member_access_from_pointer
id|sk_error_report
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|rep
op_assign
id|__nlmsg_put
c_func
(paren
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|nlh-&gt;nlmsg_seq
comma
id|NLMSG_ERROR
comma
r_sizeof
(paren
r_struct
id|nlmsgerr
)paren
)paren
suffix:semicolon
id|errmsg
op_assign
id|NLMSG_DATA
c_func
(paren
id|rep
)paren
suffix:semicolon
id|errmsg-&gt;error
op_assign
id|err
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|errmsg-&gt;msg
comma
id|nlh
comma
id|err
ques
c_cond
id|nlh-&gt;nlmsg_len
suffix:colon
r_sizeof
(paren
r_struct
id|nlmsghdr
)paren
)paren
suffix:semicolon
id|netlink_unicast
c_func
(paren
id|in_skb-&gt;sk
comma
id|skb
comma
id|NETLINK_CB
c_func
(paren
id|in_skb
)paren
dot
id|pid
comma
id|MSG_DONTWAIT
)paren
suffix:semicolon
)brace
macro_line|#ifdef NL_EMULATE_DEV
DECL|variable|nl_emu_lock
r_static
id|rwlock_t
id|nl_emu_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/*&n; *&t;Backward compatibility.&n; */
DECL|function|netlink_attach
r_int
id|netlink_attach
c_func
(paren
r_int
id|unit
comma
r_int
(paren
op_star
id|function
)paren
(paren
r_int
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|netlink_kernel_create
c_func
(paren
id|unit
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|nlk_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|handler
op_assign
id|function
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
id|netlink_kernel
(braket
id|unit
)braket
op_assign
id|sk-&gt;sk_socket
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_detach
r_void
id|netlink_detach
c_func
(paren
r_int
id|unit
)paren
(brace
r_struct
id|socket
op_star
id|sock
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
id|sock
op_assign
id|netlink_kernel
(braket
id|unit
)braket
suffix:semicolon
id|netlink_kernel
(braket
id|unit
)braket
op_assign
l_int|NULL
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
id|sock_release
c_func
(paren
id|sock
)paren
suffix:semicolon
)brace
DECL|function|netlink_post
r_int
id|netlink_post
c_func
(paren
r_int
id|unit
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|socket
op_star
id|sock
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
id|sock
op_assign
id|netlink_kernel
(braket
id|unit
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|memset
c_func
(paren
id|skb-&gt;cb
comma
l_int|0
comma
r_sizeof
(paren
id|skb-&gt;cb
)paren
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|sk
comma
id|skb
comma
l_int|0
comma
op_complement
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|nl_emu_lock
)paren
suffix:semicolon
r_return
op_minus
id|EUNATCH
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
DECL|struct|nl_seq_iter
r_struct
id|nl_seq_iter
(brace
DECL|member|link
r_int
id|link
suffix:semicolon
DECL|member|hash_idx
r_int
id|hash_idx
suffix:semicolon
)brace
suffix:semicolon
DECL|function|netlink_seq_socket_idx
r_static
r_struct
id|sock
op_star
id|netlink_seq_socket_idx
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
id|pos
)paren
(brace
r_struct
id|nl_seq_iter
op_star
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
id|loff_t
id|off
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LINKS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|i
)braket
dot
id|hash
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
op_le
id|hash-&gt;mask
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sk_for_each
c_func
(paren
id|s
comma
id|node
comma
op_amp
id|hash-&gt;table
(braket
id|j
)braket
)paren
(brace
r_if
c_cond
(paren
id|off
op_eq
id|pos
)paren
(brace
id|iter-&gt;link
op_assign
id|i
suffix:semicolon
id|iter-&gt;hash_idx
op_assign
id|j
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
op_increment
id|off
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|netlink_seq_start
r_static
r_void
op_star
id|netlink_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
r_return
op_star
id|pos
ques
c_cond
id|netlink_seq_socket_idx
c_func
(paren
id|seq
comma
op_star
id|pos
op_minus
l_int|1
)paren
suffix:colon
id|SEQ_START_TOKEN
suffix:semicolon
)brace
DECL|function|netlink_seq_next
r_static
r_void
op_star
id|netlink_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|sock
op_star
id|s
suffix:semicolon
r_struct
id|nl_seq_iter
op_star
id|iter
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
r_return
id|netlink_seq_socket_idx
c_func
(paren
id|seq
comma
l_int|0
)paren
suffix:semicolon
id|s
op_assign
id|sk_next
c_func
(paren
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
)paren
r_return
id|s
suffix:semicolon
id|iter
op_assign
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|i
op_assign
id|iter-&gt;link
suffix:semicolon
id|j
op_assign
id|iter-&gt;hash_idx
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|i
)braket
dot
id|hash
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|j
op_le
id|hash-&gt;mask
suffix:semicolon
id|j
op_increment
)paren
(brace
id|s
op_assign
id|sk_head
c_func
(paren
op_amp
id|hash-&gt;table
(braket
id|j
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
)paren
(brace
id|iter-&gt;link
op_assign
id|i
suffix:semicolon
id|iter-&gt;hash_idx
op_assign
id|j
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
)brace
id|j
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|i
OL
id|MAX_LINKS
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|netlink_seq_stop
r_static
r_void
id|netlink_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|nl_table_lock
)paren
suffix:semicolon
)brace
DECL|function|netlink_seq_show
r_static
r_int
id|netlink_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;sk       Eth Pid    Groups   &quot;
l_string|&quot;Rmem     Wmem     Dump     Locks&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|sock
op_star
id|s
op_assign
id|v
suffix:semicolon
r_struct
id|netlink_opt
op_star
id|nlk
op_assign
id|nlk_sk
c_func
(paren
id|s
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;%p %-3d %-6d %08x %-8d %-8d %p %d&bslash;n&quot;
comma
id|s
comma
id|s-&gt;sk_protocol
comma
id|nlk-&gt;pid
comma
id|nlk-&gt;groups
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;sk_rmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;sk_wmem_alloc
)paren
comma
id|nlk-&gt;cb
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;sk_refcnt
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|netlink_seq_ops
r_static
r_struct
id|seq_operations
id|netlink_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|netlink_seq_start
comma
dot
id|next
op_assign
id|netlink_seq_next
comma
dot
id|stop
op_assign
id|netlink_seq_stop
comma
dot
id|show
op_assign
id|netlink_seq_show
comma
)brace
suffix:semicolon
DECL|function|netlink_seq_open
r_static
r_int
id|netlink_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|seq_file
op_star
id|seq
suffix:semicolon
r_struct
id|nl_seq_iter
op_star
id|iter
suffix:semicolon
r_int
id|err
suffix:semicolon
id|iter
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|iter
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iter
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|netlink_seq_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|iter
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|memset
c_func
(paren
id|iter
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|iter
)paren
)paren
suffix:semicolon
id|seq
op_assign
id|file-&gt;private_data
suffix:semicolon
id|seq
op_member_access_from_pointer
r_private
op_assign
id|iter
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|netlink_seq_fops
r_static
r_struct
id|file_operations
id|netlink_seq_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|netlink_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release_private
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|netlink_register_notifier
r_int
id|netlink_register_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_register
c_func
(paren
op_amp
id|netlink_chain
comma
id|nb
)paren
suffix:semicolon
)brace
DECL|function|netlink_unregister_notifier
r_int
id|netlink_unregister_notifier
c_func
(paren
r_struct
id|notifier_block
op_star
id|nb
)paren
(brace
r_return
id|notifier_chain_unregister
c_func
(paren
op_amp
id|netlink_chain
comma
id|nb
)paren
suffix:semicolon
)brace
DECL|variable|netlink_ops
r_static
r_struct
id|proto_ops
id|netlink_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_NETLINK
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|netlink_release
comma
dot
id|bind
op_assign
id|netlink_bind
comma
dot
id|connect
op_assign
id|netlink_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|sock_no_accept
comma
dot
id|getname
op_assign
id|netlink_getname
comma
dot
id|poll
op_assign
id|datagram_poll
comma
dot
id|ioctl
op_assign
id|sock_no_ioctl
comma
dot
id|listen
op_assign
id|sock_no_listen
comma
dot
id|shutdown
op_assign
id|sock_no_shutdown
comma
dot
id|setsockopt
op_assign
id|sock_no_setsockopt
comma
dot
id|getsockopt
op_assign
id|sock_no_getsockopt
comma
dot
id|sendmsg
op_assign
id|netlink_sendmsg
comma
dot
id|recvmsg
op_assign
id|netlink_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
)brace
suffix:semicolon
DECL|variable|netlink_family_ops
r_static
r_struct
id|net_proto_family
id|netlink_family_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_NETLINK
comma
dot
id|create
op_assign
id|netlink_create
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
multiline_comment|/* for consistency 8) */
)brace
suffix:semicolon
r_extern
r_void
id|netlink_skb_parms_too_large
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|netlink_proto_init
r_static
r_int
id|__init
id|netlink_proto_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sk_buff
op_star
id|dummy_skb
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|max
suffix:semicolon
r_int
r_int
id|order
suffix:semicolon
r_if
c_cond
(paren
r_sizeof
(paren
r_struct
id|netlink_skb_parms
)paren
OG
r_sizeof
(paren
id|dummy_skb-&gt;cb
)paren
)paren
id|netlink_skb_parms_too_large
c_func
(paren
)paren
suffix:semicolon
id|nl_table
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|nl_table
)paren
op_star
id|MAX_LINKS
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nl_table
)paren
(brace
id|enomem
suffix:colon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;netlink_init: Cannot allocate nl_table&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|nl_table
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|nl_table
)paren
op_star
id|MAX_LINKS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_physpages
op_ge
(paren
l_int|128
op_star
l_int|1024
)paren
)paren
id|max
op_assign
id|num_physpages
op_rshift
(paren
l_int|21
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
r_else
id|max
op_assign
id|num_physpages
op_rshift
(paren
l_int|23
op_minus
id|PAGE_SHIFT
)paren
suffix:semicolon
id|order
op_assign
id|get_bitmask_order
c_func
(paren
id|max
)paren
op_minus
l_int|1
op_plus
id|PAGE_SHIFT
suffix:semicolon
id|max
op_assign
(paren
l_int|1UL
op_lshift
id|order
)paren
op_div
r_sizeof
(paren
r_struct
id|hlist_head
)paren
suffix:semicolon
id|order
op_assign
id|get_bitmask_order
c_func
(paren
id|max
OG
id|UINT_MAX
ques
c_cond
id|UINT_MAX
suffix:colon
id|max
)paren
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_LINKS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|nl_pid_hash
op_star
id|hash
op_assign
op_amp
id|nl_table
(braket
id|i
)braket
dot
id|hash
suffix:semicolon
id|hash-&gt;table
op_assign
id|nl_pid_hash_alloc
c_func
(paren
l_int|1
op_star
r_sizeof
(paren
op_star
id|hash-&gt;table
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hash-&gt;table
)paren
(brace
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
id|nl_pid_hash_free
c_func
(paren
id|nl_table
(braket
id|i
)braket
dot
id|hash.table
comma
l_int|1
op_star
r_sizeof
(paren
op_star
id|hash-&gt;table
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|nl_table
)paren
suffix:semicolon
r_goto
id|enomem
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hash-&gt;table
comma
l_int|0
comma
l_int|1
op_star
r_sizeof
(paren
op_star
id|hash-&gt;table
)paren
)paren
suffix:semicolon
id|hash-&gt;max_shift
op_assign
id|order
suffix:semicolon
id|hash-&gt;shift
op_assign
l_int|0
suffix:semicolon
id|hash-&gt;mask
op_assign
l_int|0
suffix:semicolon
id|hash-&gt;rehash_time
op_assign
id|jiffies
suffix:semicolon
)brace
id|sock_register
c_func
(paren
op_amp
id|netlink_family_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_fops_create
c_func
(paren
l_string|&quot;netlink&quot;
comma
l_int|0
comma
op_amp
id|netlink_seq_fops
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* The netlink device handler may be needed early. */
id|rtnetlink_init
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|netlink_proto_exit
r_static
r_void
id|__exit
id|netlink_proto_exit
c_func
(paren
r_void
)paren
(brace
id|sock_unregister
c_func
(paren
id|PF_NETLINK
)paren
suffix:semicolon
id|proc_net_remove
c_func
(paren
l_string|&quot;netlink&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|nl_table
)paren
suffix:semicolon
id|nl_table
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|netlink_proto_init
id|core_initcall
c_func
(paren
id|netlink_proto_init
)paren
suffix:semicolon
DECL|variable|netlink_proto_exit
id|module_exit
c_func
(paren
id|netlink_proto_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|PF_NETLINK
id|MODULE_ALIAS_NETPROTO
c_func
(paren
id|PF_NETLINK
)paren
suffix:semicolon
DECL|variable|netlink_ack
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_ack
)paren
suffix:semicolon
DECL|variable|netlink_broadcast
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_broadcast
)paren
suffix:semicolon
DECL|variable|netlink_dump_start
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_dump_start
)paren
suffix:semicolon
DECL|variable|netlink_kernel_create
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_kernel_create
)paren
suffix:semicolon
DECL|variable|netlink_register_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_register_notifier
)paren
suffix:semicolon
DECL|variable|netlink_set_err
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_set_err
)paren
suffix:semicolon
DECL|variable|netlink_set_nonroot
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_set_nonroot
)paren
suffix:semicolon
DECL|variable|netlink_unicast
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_unicast
)paren
suffix:semicolon
DECL|variable|netlink_unregister_notifier
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_unregister_notifier
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_NETLINK_DEV) || defined(CONFIG_NETLINK_DEV_MODULE)
DECL|variable|netlink_attach
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_attach
)paren
suffix:semicolon
DECL|variable|netlink_detach
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_detach
)paren
suffix:semicolon
DECL|variable|netlink_post
id|EXPORT_SYMBOL
c_func
(paren
id|netlink_post
)paren
suffix:semicolon
macro_line|#endif
eof
