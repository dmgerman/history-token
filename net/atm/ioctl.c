multiline_comment|/* net/atm/common.c - ATM sockets (common part for PVC and SVC) */
multiline_comment|/* Written 1995-2000 by Werner Almesberger, EPFL LRC/ICA */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/net.h&gt;&t;&t;/* struct socket, struct proto_ops */
macro_line|#include &lt;linux/atm.h&gt;&t;&t;/* ATM stuff */
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atmclip.h&gt;&t;/* CLIP_*ENCAP */
macro_line|#include &lt;linux/atmarp.h&gt;&t;/* manifest constants */
macro_line|#include &lt;linux/sonet.h&gt;&t;/* for ioctls */
macro_line|#include &lt;linux/atmsvc.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#ifdef CONFIG_ATM_CLIP
macro_line|#include &lt;net/atmclip.h&gt;&t;/* for clip_create */
macro_line|#endif
macro_line|#include &quot;resources.h&quot;&t;&t;/* atm_find_dev */
macro_line|#include &quot;signaling.h&quot;&t;&t;/* for WAITING and sigd_attach */
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
macro_line|#include &lt;linux/atmlec.h&gt;
macro_line|#include &quot;lec.h&quot;
macro_line|#include &quot;lec_arpc.h&quot;
DECL|variable|atm_lane_ops
r_struct
id|atm_lane_ops
op_star
id|atm_lane_ops
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|atm_lane_ops_mutex
)paren
suffix:semicolon
DECL|function|atm_lane_ops_set
r_void
id|atm_lane_ops_set
c_func
(paren
r_struct
id|atm_lane_ops
op_star
id|hook
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_lane_ops_mutex
)paren
suffix:semicolon
id|atm_lane_ops
op_assign
id|hook
suffix:semicolon
id|up
c_func
(paren
op_amp
id|atm_lane_ops_mutex
)paren
suffix:semicolon
)brace
DECL|function|try_atm_lane_ops
r_int
id|try_atm_lane_ops
c_func
(paren
r_void
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_lane_ops_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_lane_ops
op_logical_and
id|try_module_get
c_func
(paren
id|atm_lane_ops-&gt;owner
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|atm_lane_ops_mutex
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|atm_lane_ops_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ATM_LANE_MODULE) || defined(CONFIG_ATM_MPOA_MODULE)
DECL|variable|atm_lane_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_lane_ops
)paren
suffix:semicolon
DECL|variable|try_atm_lane_ops
id|EXPORT_SYMBOL
c_func
(paren
id|try_atm_lane_ops
)paren
suffix:semicolon
DECL|variable|atm_lane_ops_set
id|EXPORT_SYMBOL
c_func
(paren
id|atm_lane_ops_set
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_MPOA) || defined(CONFIG_ATM_MPOA_MODULE)
macro_line|#include &lt;linux/atmmpc.h&gt;
macro_line|#include &quot;mpc.h&quot;
DECL|variable|atm_mpoa_ops
r_struct
id|atm_mpoa_ops
op_star
id|atm_mpoa_ops
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
DECL|function|atm_mpoa_ops_set
r_void
id|atm_mpoa_ops_set
c_func
(paren
r_struct
id|atm_mpoa_ops
op_star
id|hook
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
id|atm_mpoa_ops
op_assign
id|hook
suffix:semicolon
id|up
c_func
(paren
op_amp
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
)brace
DECL|function|try_atm_mpoa_ops
r_int
id|try_atm_mpoa_ops
c_func
(paren
r_void
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_mpoa_ops
op_logical_and
id|try_module_get
c_func
(paren
id|atm_mpoa_ops-&gt;owner
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|atm_mpoa_ops_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_MPOA_MODULE
DECL|variable|atm_mpoa_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_mpoa_ops
)paren
suffix:semicolon
DECL|variable|try_atm_mpoa_ops
id|EXPORT_SYMBOL
c_func
(paren
id|try_atm_mpoa_ops
)paren
suffix:semicolon
DECL|variable|atm_mpoa_ops_set
id|EXPORT_SYMBOL
c_func
(paren
id|atm_mpoa_ops_set
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_TCP) || defined(CONFIG_ATM_TCP_MODULE)
macro_line|#include &lt;linux/atm_tcp.h&gt;
macro_line|#ifdef CONFIG_ATM_TCP_MODULE
DECL|variable|atm_tcp_ops
r_struct
id|atm_tcp_ops
id|atm_tcp_ops
suffix:semicolon
DECL|variable|atm_tcp_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_tcp_ops
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_CLIP) || defined(CONFIG_ATM_CLIP_MODULE)
macro_line|#include &lt;net/atmclip.h&gt;
DECL|variable|atm_clip_ops
r_struct
id|atm_clip_ops
op_star
id|atm_clip_ops
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|atm_clip_ops_mutex
)paren
suffix:semicolon
DECL|function|atm_clip_ops_set
r_void
id|atm_clip_ops_set
c_func
(paren
r_struct
id|atm_clip_ops
op_star
id|hook
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_clip_ops_mutex
)paren
suffix:semicolon
id|atm_clip_ops
op_assign
id|hook
suffix:semicolon
id|up
c_func
(paren
op_amp
id|atm_clip_ops_mutex
)paren
suffix:semicolon
)brace
DECL|function|try_atm_clip_ops
r_int
id|try_atm_clip_ops
c_func
(paren
r_void
)paren
(brace
id|down
c_func
(paren
op_amp
id|atm_clip_ops_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atm_clip_ops
op_logical_and
id|try_module_get
c_func
(paren
id|atm_clip_ops-&gt;owner
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|atm_clip_ops_mutex
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|atm_clip_ops_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_CLIP_MODULE
DECL|variable|atm_clip_ops
id|EXPORT_SYMBOL
c_func
(paren
id|atm_clip_ops
)paren
suffix:semicolon
DECL|variable|try_atm_clip_ops
id|EXPORT_SYMBOL
c_func
(paren
id|try_atm_clip_ops
)paren
suffix:semicolon
DECL|variable|atm_clip_ops_set
id|EXPORT_SYMBOL
c_func
(paren
id|atm_clip_ops_set
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_PPPOATM) || defined(CONFIG_PPPOATM_MODULE)
r_static
id|DECLARE_MUTEX
c_func
(paren
id|pppoatm_ioctl_mutex
)paren
suffix:semicolon
DECL|variable|pppoatm_ioctl_hook
r_static
r_int
(paren
op_star
id|pppoatm_ioctl_hook
)paren
(paren
r_struct
id|atm_vcc
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
DECL|function|pppoatm_ioctl_set
r_void
id|pppoatm_ioctl_set
c_func
(paren
r_int
(paren
op_star
id|hook
)paren
(paren
r_struct
id|atm_vcc
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|pppoatm_ioctl_mutex
)paren
suffix:semicolon
id|pppoatm_ioctl_hook
op_assign
id|hook
suffix:semicolon
id|up
c_func
(paren
op_amp
id|pppoatm_ioctl_mutex
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PPPOATM_MODULE
DECL|variable|pppoatm_ioctl_set
id|EXPORT_SYMBOL
c_func
(paren
id|pppoatm_ioctl_set
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_BR2684) || defined(CONFIG_ATM_BR2684_MODULE)
r_static
id|DECLARE_MUTEX
c_func
(paren
id|br2684_ioctl_mutex
)paren
suffix:semicolon
DECL|variable|br2684_ioctl_hook
r_static
r_int
(paren
op_star
id|br2684_ioctl_hook
)paren
(paren
r_struct
id|atm_vcc
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
DECL|function|br2684_ioctl_set
r_void
id|br2684_ioctl_set
c_func
(paren
r_int
(paren
op_star
id|hook
)paren
(paren
r_struct
id|atm_vcc
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
)paren
(brace
id|down
c_func
(paren
op_amp
id|br2684_ioctl_mutex
)paren
suffix:semicolon
id|br2684_ioctl_hook
op_assign
id|hook
suffix:semicolon
id|up
c_func
(paren
op_amp
id|br2684_ioctl_mutex
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_BR2684_MODULE
DECL|variable|br2684_ioctl_set
id|EXPORT_SYMBOL
c_func
(paren
id|br2684_ioctl_set
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
DECL|function|vcc_ioctl
r_int
id|vcc_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
id|error
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCOUTQ
suffix:colon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|put_user
c_func
(paren
id|vcc-&gt;sk-&gt;sk_sndbuf
op_minus
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|SIOCINQ
suffix:colon
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
(brace
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|skb
op_assign
id|skb_peek
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_receive_queue
)paren
suffix:semicolon
id|error
op_assign
id|put_user
c_func
(paren
id|skb
ques
c_cond
id|skb-&gt;len
suffix:colon
l_int|0
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_case
id|SIOCGSTAMP
suffix:colon
multiline_comment|/* borrowed from IP */
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;sk-&gt;sk_stamp.tv_sec
)paren
(brace
id|error
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|vcc-&gt;sk-&gt;sk_stamp
comma
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATM_SETSC
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ATM_SETSC is obsolete&bslash;n&quot;
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMSIGD_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * The user/kernel protocol for exchanging signalling&n;&t;&t;&t; * info uses kernel pointers as opaque references,&n;&t;&t;&t; * so the holder of the file descriptor can scribble&n;&t;&t;&t; * on the kernel... so we should make sure that we&n;&t;&t;&t; * have the same privledges that /proc/kcore needs&n;&t;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_RAWIO
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|sigd_attach
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#if defined(CONFIG_ATM_CLIP) || defined(CONFIG_ATM_CLIP_MODULE)
r_case
id|SIOCMKCLIP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_clip_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_clip_ops
op_member_access_from_pointer
id|clip_create
c_func
(paren
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_clip_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARPD_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ATM_CLIP_MODULE)
r_if
c_cond
(paren
op_logical_neg
id|atm_clip_ops
)paren
id|request_module
c_func
(paren
l_string|&quot;clip&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|try_atm_clip_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_clip_ops
op_member_access_from_pointer
id|atm_init_atmarp
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_MKIP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_clip_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_clip_ops
op_member_access_from_pointer
id|clip_mkip
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_clip_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_SETENTRY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_clip_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_clip_ops
op_member_access_from_pointer
id|clip_setentry
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_clip_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMARP_ENCAP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_clip_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_clip_ops
op_member_access_from_pointer
id|clip_encap
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_clip_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
r_case
id|ATMLEC_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ATM_LANE_MODULE)
r_if
c_cond
(paren
op_logical_neg
id|atm_lane_ops
)paren
id|request_module
c_func
(paren
l_string|&quot;lec&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|try_atm_lane_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_lane_ops
op_member_access_from_pointer
id|lecd_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_lane_ops-&gt;owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMLEC_MCAST
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_lane_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_lane_ops
op_member_access_from_pointer
id|mcast_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_lane_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMLEC_DATA
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_lane_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_lane_ops
op_member_access_from_pointer
id|vcc_attach
c_func
(paren
id|vcc
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_lane_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_MPOA) || defined(CONFIG_ATM_MPOA_MODULE)
r_case
id|ATMMPC_CTRL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ATM_MPOA_MODULE)
r_if
c_cond
(paren
op_logical_neg
id|atm_mpoa_ops
)paren
id|request_module
c_func
(paren
l_string|&quot;mpoa&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|try_atm_mpoa_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_mpoa_ops
op_member_access_from_pointer
id|mpoad_attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_mpoa_ops-&gt;owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMMPC_DATA
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|try_atm_mpoa_ops
c_func
(paren
)paren
)paren
(brace
id|error
op_assign
id|atm_mpoa_ops
op_member_access_from_pointer
id|vcc_attach
c_func
(paren
id|vcc
comma
id|arg
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|atm_mpoa_ops-&gt;owner
)paren
suffix:semicolon
)brace
r_else
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_TCP) || defined(CONFIG_ATM_TCP_MODULE)
r_case
id|SIOCSIFATMTCP
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.attach
)paren
(brace
id|error
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|fops_get
c_func
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
id|error
op_assign
id|atm_tcp_ops
dot
id|attach
c_func
(paren
id|vcc
comma
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ge
l_int|0
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_else
id|fops_put
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMTCP_CREATE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.create_persistent
)paren
(brace
id|error
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_tcp_ops
dot
id|create_persistent
c_func
(paren
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
id|fops_put
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|ATMTCP_REMOVE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_tcp_ops.remove_persistent
)paren
(brace
id|error
op_assign
op_minus
id|ENOPKG
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
id|error
op_assign
id|atm_tcp_ops
dot
id|remove_persistent
c_func
(paren
(paren
r_int
)paren
id|arg
)paren
suffix:semicolon
id|fops_put
c_func
(paren
op_amp
id|atm_tcp_ops
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|error
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
macro_line|#if defined(CONFIG_PPPOATM) || defined(CONFIG_PPPOATM_MODULE)
id|down
c_func
(paren
op_amp
id|pppoatm_ioctl_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pppoatm_ioctl_hook
)paren
id|error
op_assign
id|pppoatm_ioctl_hook
c_func
(paren
id|vcc
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|pppoatm_ioctl_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
op_minus
id|ENOIOCTLCMD
)paren
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ATM_BR2684) || defined(CONFIG_ATM_BR2684_MODULE)
id|down
c_func
(paren
op_amp
id|br2684_ioctl_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|br2684_ioctl_hook
)paren
id|error
op_assign
id|br2684_ioctl_hook
c_func
(paren
id|vcc
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|br2684_ioctl_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_ne
op_minus
id|ENOIOCTLCMD
)paren
r_goto
id|done
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|atm_dev_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|done
suffix:colon
r_return
id|error
suffix:semicolon
)brace
eof
