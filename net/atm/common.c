multiline_comment|/* net/atm/common.c - ATM sockets (common part for PVC and SVC) */
multiline_comment|/* Written 1995-2000 by Werner Almesberger, EPFL LRC/ICA */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#include &lt;linux/net.h&gt;&t;&t;/* struct socket, struct proto_ops */
macro_line|#include &lt;linux/atm.h&gt;&t;&t;/* ATM stuff */
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/socket.h&gt;&t;/* SOL_SOCKET */
macro_line|#include &lt;linux/errno.h&gt;&t;/* error codes */
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/mm.h&gt;&t;&t;/* verify_area */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/time.h&gt;&t;&t;/* struct timeval */
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/sock.h&gt;&t;&t;/* struct sock */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/poll.h&gt;
macro_line|#include &quot;resources.h&quot;&t;&t;/* atm_find_dev */
macro_line|#include &quot;common.h&quot;&t;&t;/* prototypes */
macro_line|#include &quot;protocols.h&quot;&t;&t;/* atm_init_&lt;transport&gt; */
macro_line|#include &quot;addr.h&quot;&t;&t;/* address registry */
macro_line|#include &quot;signaling.h&quot;&t;&t;/* for WAITING and sigd_attach */
macro_line|#if 0
mdefine_line|#define DPRINTK(format,args...) printk(KERN_DEBUG format,##args)
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK(format,args...)
macro_line|#endif
DECL|variable|vcc_hash
r_struct
id|hlist_head
id|vcc_hash
(braket
id|VCC_HTABLE_SIZE
)braket
suffix:semicolon
DECL|variable|vcc_sklist_lock
id|rwlock_t
id|vcc_sklist_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|function|__vcc_insert_socket
r_void
id|__vcc_insert_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|hlist_head
op_star
id|head
op_assign
op_amp
id|vcc_hash
(braket
id|vcc-&gt;vci
op_amp
(paren
id|VCC_HTABLE_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|sk-&gt;sk_hashent
op_assign
id|vcc-&gt;vci
op_amp
(paren
id|VCC_HTABLE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|sk_add_node
c_func
(paren
id|sk
comma
id|head
)paren
suffix:semicolon
)brace
DECL|function|vcc_insert_socket
r_void
id|vcc_insert_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
id|__vcc_insert_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
)brace
DECL|function|vcc_remove_socket
r_void
id|vcc_remove_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
id|sk_del_node_init
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
)brace
DECL|function|alloc_tx
r_static
r_struct
id|sk_buff
op_star
id|alloc_tx
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
r_int
id|size
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
op_logical_and
op_logical_neg
id|atm_may_send
c_func
(paren
id|vcc
comma
id|size
)paren
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;Sorry: wmem_alloc = %d, size = %d, sndbuf = %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
comma
id|size
comma
id|vcc-&gt;sk-&gt;sk_sndbuf
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;AlTx %d += %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
comma
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|variable|vcc_hash
id|EXPORT_SYMBOL
c_func
(paren
id|vcc_hash
)paren
suffix:semicolon
DECL|variable|vcc_sklist_lock
id|EXPORT_SYMBOL
c_func
(paren
id|vcc_sklist_lock
)paren
suffix:semicolon
DECL|variable|vcc_insert_socket
id|EXPORT_SYMBOL
c_func
(paren
id|vcc_insert_socket
)paren
suffix:semicolon
DECL|variable|vcc_remove_socket
id|EXPORT_SYMBOL
c_func
(paren
id|vcc_remove_socket
)paren
suffix:semicolon
DECL|function|vcc_sock_destruct
r_static
r_void
id|vcc_sock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_rmem_alloc
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vcc_sock_destruct: rmem leakage (%d bytes) detected.&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_rmem_alloc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;vcc_sock_destruct: wmem leakage (%d bytes) detected.&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sk-&gt;sk_protinfo
)paren
suffix:semicolon
)brace
DECL|function|vcc_def_wakeup
r_static
r_void
id|vcc_def_wakeup
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|vcc_writable
r_static
r_inline
r_int
id|vcc_writable
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
(paren
id|vcc-&gt;qos.txtp.max_sdu
op_plus
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;sk_wmem_alloc
)paren
)paren
op_le
id|sk-&gt;sk_sndbuf
suffix:semicolon
)brace
DECL|function|vcc_write_space
r_static
r_void
id|vcc_write_space
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|read_lock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc_writable
c_func
(paren
id|sk
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_sleep
op_logical_and
id|waitqueue_active
c_func
(paren
id|sk-&gt;sk_sleep
)paren
)paren
id|wake_up_interruptible
c_func
(paren
id|sk-&gt;sk_sleep
)paren
suffix:semicolon
id|sk_wake_async
c_func
(paren
id|sk
comma
l_int|2
comma
id|POLL_OUT
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|sk-&gt;sk_callback_lock
)paren
suffix:semicolon
)brace
DECL|function|vcc_create
r_int
id|vcc_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
comma
r_int
id|family
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|family
comma
id|GFP_KERNEL
comma
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|sk
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|sk-&gt;sk_state_change
op_assign
id|vcc_def_wakeup
suffix:semicolon
id|sk-&gt;sk_write_space
op_assign
id|vcc_write_space
suffix:semicolon
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|sk
)paren
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|vcc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|vcc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|vcc
)paren
)paren
suffix:semicolon
id|vcc-&gt;sk
op_assign
id|sk
suffix:semicolon
id|vcc-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vcc-&gt;local
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_atmsvc
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|vcc-&gt;remote
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|sockaddr_atmsvc
)paren
)paren
suffix:semicolon
id|vcc-&gt;qos.txtp.max_sdu
op_assign
l_int|1
op_lshift
l_int|16
suffix:semicolon
multiline_comment|/* for meta VCs */
id|atomic_set
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
comma
l_int|0
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_rmem_alloc
comma
l_int|0
)paren
suffix:semicolon
id|vcc-&gt;push
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;pop
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;push_oam
op_assign
l_int|NULL
suffix:semicolon
id|vcc-&gt;vpi
op_assign
id|vcc-&gt;vci
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no VCI/VPI yet */
id|vcc-&gt;atm_options
op_assign
id|vcc-&gt;aal_options
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_destruct
op_assign
id|vcc_sock_destruct
suffix:semicolon
id|sock-&gt;sk
op_assign
id|sk
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vcc_destroy_socket
r_static
r_void
id|vcc_destroy_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;dev
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;dev-&gt;ops-&gt;close
)paren
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;push
)paren
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* atmarpd has no push */
id|vcc_remove_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
multiline_comment|/* no more receive */
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_receive_queue
)paren
)paren
)paren
(brace
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|module_put
c_func
(paren
id|vcc-&gt;dev-&gt;ops-&gt;owner
)paren
suffix:semicolon
id|atm_dev_put
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
)brace
)brace
DECL|function|vcc_release
r_int
id|vcc_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|vcc_destroy_socket
c_func
(paren
id|sock-&gt;sk
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vcc_release_async
r_void
id|vcc_release_async
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|reply
)paren
(brace
id|set_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|vcc-&gt;sk-&gt;sk_err
op_assign
op_minus
id|reply
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_WAITING
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|vcc-&gt;sk
op_member_access_from_pointer
id|sk_state_change
c_func
(paren
id|vcc-&gt;sk
)paren
suffix:semicolon
)brace
DECL|variable|vcc_release_async
id|EXPORT_SYMBOL
c_func
(paren
id|vcc_release_async
)paren
suffix:semicolon
DECL|function|adjust_tp
r_static
r_int
id|adjust_tp
c_func
(paren
r_struct
id|atm_trafprm
op_star
id|tp
comma
r_int
r_char
id|aal
)paren
(brace
r_int
id|max_sdu
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;traffic_class
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
id|max_sdu
op_assign
id|ATM_CELL_SIZE
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
id|max_sdu
op_assign
id|ATM_MAX_AAL34_PDU
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ATM: AAL problems ... &quot;
l_string|&quot;(%d)&bslash;n&quot;
comma
id|aal
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ATM_AAL5
suffix:colon
id|max_sdu
op_assign
id|ATM_MAX_AAL5_PDU
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;max_sdu
)paren
id|tp-&gt;max_sdu
op_assign
id|max_sdu
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tp-&gt;max_sdu
OG
id|max_sdu
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;max_cdv
)paren
id|tp-&gt;max_cdv
op_assign
id|ATM_MAX_CDV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_ci
r_static
r_int
id|check_ci
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
op_assign
op_amp
id|vcc_hash
(braket
id|vci
op_amp
(paren
id|VCC_HTABLE_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|walk
suffix:semicolon
id|sk_for_each
c_func
(paren
id|s
comma
id|node
comma
id|head
)paren
(brace
id|walk
op_assign
id|atm_sk
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|walk-&gt;dev
op_ne
id|vcc-&gt;dev
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|walk-&gt;flags
)paren
op_logical_and
id|walk-&gt;vpi
op_eq
id|vpi
op_logical_and
id|walk-&gt;vci
op_eq
id|vci
op_logical_and
(paren
(paren
id|walk-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
op_logical_or
(paren
id|walk-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
)paren
)paren
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
multiline_comment|/* allow VCCs with same VPI/VCI iff they don&squot;t collide on&n;&t;   TX/RX (but we may refuse such sharing for other reasons,&n;&t;   e.g. if protocol requires to have both channels) */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|find_ci
r_static
r_int
id|find_ci
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
op_star
id|vpi
comma
r_int
op_star
id|vci
)paren
(brace
r_static
r_int
id|p
suffix:semicolon
multiline_comment|/* poor man&squot;s per-device cache */
r_static
r_int
id|c
suffix:semicolon
r_int
id|old_p
suffix:semicolon
r_int
id|old_c
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_star
id|vpi
op_ne
id|ATM_VPI_ANY
op_logical_and
op_star
id|vci
op_ne
id|ATM_VCI_ANY
)paren
(brace
id|err
op_assign
id|check_ci
c_func
(paren
id|vcc
comma
op_star
id|vpi
comma
op_star
id|vci
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* last scan may have left values out of bounds for current device */
r_if
c_cond
(paren
op_star
id|vpi
op_ne
id|ATM_VPI_ANY
)paren
id|p
op_assign
op_star
id|vpi
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p
op_ge
l_int|1
op_lshift
id|vcc-&gt;dev-&gt;ci_range.vpi_bits
)paren
id|p
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|vci
op_ne
id|ATM_VCI_ANY
)paren
id|c
op_assign
op_star
id|vci
suffix:semicolon
r_else
r_if
c_cond
(paren
id|c
OL
id|ATM_NOT_RSV_VCI
op_logical_or
id|c
op_ge
l_int|1
op_lshift
id|vcc-&gt;dev-&gt;ci_range.vci_bits
)paren
id|c
op_assign
id|ATM_NOT_RSV_VCI
suffix:semicolon
id|old_p
op_assign
id|p
suffix:semicolon
id|old_c
op_assign
id|c
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|check_ci
c_func
(paren
id|vcc
comma
id|p
comma
id|c
)paren
)paren
(brace
op_star
id|vpi
op_assign
id|p
suffix:semicolon
op_star
id|vci
op_assign
id|c
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|vci
op_eq
id|ATM_VCI_ANY
)paren
(brace
id|c
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|c
op_ge
l_int|1
op_lshift
id|vcc-&gt;dev-&gt;ci_range.vci_bits
)paren
id|c
op_assign
id|ATM_NOT_RSV_VCI
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|c
op_eq
id|ATM_NOT_RSV_VCI
op_logical_or
op_star
id|vci
op_ne
id|ATM_VCI_ANY
)paren
op_logical_and
op_star
id|vpi
op_eq
id|ATM_VPI_ANY
)paren
(brace
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
l_int|1
op_lshift
id|vcc-&gt;dev-&gt;ci_range.vpi_bits
)paren
id|p
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|old_p
op_ne
id|p
op_logical_or
id|old_c
op_ne
id|c
)paren
suffix:semicolon
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
DECL|function|__vcc_connect
r_static
r_int
id|__vcc_connect
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vpi
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vpi
op_ne
id|ATM_VPI_ANY
op_logical_and
id|vpi
op_rshift
id|dev-&gt;ci_range.vpi_bits
)paren
op_logical_or
(paren
id|vci
op_ne
id|ATM_VCI_UNSPEC
op_logical_and
id|vci
op_ne
id|ATM_VCI_ANY
op_logical_and
id|vci
op_rshift
id|dev-&gt;ci_range.vci_bits
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vci
OG
l_int|0
op_logical_and
id|vci
OL
id|ATM_NOT_RSV_VCI
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_BIND_SERVICE
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|dev-&gt;ops-&gt;owner
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|vcc-&gt;dev
op_assign
id|dev
suffix:semicolon
id|write_lock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|find_ci
c_func
(paren
id|vcc
comma
op_amp
id|vpi
comma
op_amp
id|vci
)paren
)paren
)paren
(brace
id|write_unlock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
r_goto
id|fail_module_put
suffix:semicolon
)brace
id|vcc-&gt;vpi
op_assign
id|vpi
suffix:semicolon
id|vcc-&gt;vci
op_assign
id|vci
suffix:semicolon
id|__vcc_insert_socket
c_func
(paren
id|vcc-&gt;sk
)paren
suffix:semicolon
id|write_unlock_irq
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
id|error
op_assign
id|atm_init_aal0
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
id|error
op_assign
id|atm_init_aal34
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal34
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_NO_AAL
suffix:colon
multiline_comment|/* ATM_AAL5 is also used in the &quot;0 for default&quot; case */
id|vcc-&gt;qos.aal
op_assign
id|ATM_AAL5
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ATM_AAL5
suffix:colon
id|error
op_assign
id|atm_init_aal5
c_func
(paren
id|vcc
)paren
suffix:semicolon
id|vcc-&gt;stats
op_assign
op_amp
id|dev-&gt;stats.aal5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|error
op_assign
op_minus
id|EPROTOTYPE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|vcc-&gt;qos.txtp
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|vcc-&gt;qos.rxtp
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;VCC %d.%d, AAL %d&bslash;n&quot;
comma
id|vpi
comma
id|vci
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  TX: %d, PCR %d..%d, SDU %d&bslash;n&quot;
comma
id|vcc-&gt;qos.txtp.traffic_class
comma
id|vcc-&gt;qos.txtp.min_pcr
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.txtp.max_sdu
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  RX: %d, PCR %d..%d, SDU %d&bslash;n&quot;
comma
id|vcc-&gt;qos.rxtp.traffic_class
comma
id|vcc-&gt;qos.rxtp.min_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_sdu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;ops-&gt;open
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|dev-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|vcc
)paren
)paren
)paren
r_goto
id|fail
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|vcc_remove_socket
c_func
(paren
id|vcc-&gt;sk
)paren
suffix:semicolon
id|fail_module_put
suffix:colon
id|module_put
c_func
(paren
id|dev-&gt;ops-&gt;owner
)paren
suffix:semicolon
multiline_comment|/* ensure we get dev module ref count correct */
id|vcc-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|vcc_connect
r_int
id|vcc_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|itf
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;vcc_connect (vpi %d, vci %d)&bslash;n&quot;
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
op_minus
id|EISCONN
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vpi
op_logical_or
id|vci
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vpi
op_ne
id|ATM_VPI_UNSPEC
op_logical_and
id|vci
op_ne
id|ATM_VCI_UNSPEC
)paren
id|clear_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;vcc_connect (TX: cl %d,bw %d-%d,sdu %d; &quot;
l_string|&quot;RX: cl %d,bw %d-%d,sdu %d,AAL %s%d)&bslash;n&quot;
comma
id|vcc-&gt;qos.txtp.traffic_class
comma
id|vcc-&gt;qos.txtp.min_pcr
comma
id|vcc-&gt;qos.txtp.max_pcr
comma
id|vcc-&gt;qos.txtp.max_sdu
comma
id|vcc-&gt;qos.rxtp.traffic_class
comma
id|vcc-&gt;qos.rxtp.min_pcr
comma
id|vcc-&gt;qos.rxtp.max_pcr
comma
id|vcc-&gt;qos.rxtp.max_sdu
comma
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
ques
c_cond
l_string|&quot;&quot;
suffix:colon
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot; ??? code &quot;
comma
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
ques
c_cond
l_int|0
suffix:colon
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_ANYCLASS
op_logical_or
id|vcc-&gt;qos.rxtp.traffic_class
op_eq
id|ATM_ANYCLASS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|itf
op_ne
id|ATM_ITF_ANY
)paren
(brace
id|dev
op_assign
id|atm_dev_lookup
c_func
(paren
id|itf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|error
op_assign
id|__vcc_connect
c_func
(paren
id|vcc
comma
id|dev
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|atm_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_else
(brace
r_struct
id|list_head
op_star
id|p
comma
op_star
id|next
suffix:semicolon
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|p
comma
id|next
comma
op_amp
id|atm_devs
)paren
(brace
id|dev
op_assign
id|list_entry
c_func
(paren
id|p
comma
r_struct
id|atm_dev
comma
id|dev_list
)paren
suffix:semicolon
id|atm_dev_hold
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|__vcc_connect
c_func
(paren
id|vcc
comma
id|dev
comma
id|vpi
comma
id|vci
)paren
)paren
r_break
suffix:semicolon
id|atm_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|atm_dev_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vpi
op_eq
id|ATM_VPI_UNSPEC
op_logical_or
id|vci
op_eq
id|ATM_VCI_UNSPEC
)paren
id|set_bit
c_func
(paren
id|ATM_VF_PARTIAL
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|ATM_SD
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|flags
)paren
)paren
id|sock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vcc_recvmsg
r_int
id|vcc_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|copied
comma
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
)paren
multiline_comment|/* only handle MSG_DONTWAIT */
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|sk-&gt;sk_err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
id|error
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|size
)paren
(brace
id|copied
op_assign
id|size
suffix:semicolon
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
)brace
id|error
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|sock_recv_timestamp
c_func
(paren
id|msg
comma
id|sk
comma
id|skb
)paren
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;RcvM %d -= %d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;rmem_alloc
)paren
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|atm_return
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
suffix:semicolon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_return
id|copied
suffix:semicolon
)brace
DECL|function|vcc_sendmsg
r_int
id|vcc_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|m
comma
r_int
id|total_len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|eff
comma
id|error
suffix:semicolon
r_const
r_void
op_star
id|buff
suffix:semicolon
r_int
id|size
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_CONNECTED
)paren
(brace
id|error
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m-&gt;msg_name
)paren
(brace
id|error
op_assign
op_minus
id|EISCONN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|m-&gt;msg_iovlen
op_ne
l_int|1
)paren
(brace
id|error
op_assign
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* fix this later @@@ */
r_goto
id|out
suffix:semicolon
)brace
id|buff
op_assign
id|m-&gt;msg_iov-&gt;iov_base
suffix:semicolon
id|size
op_assign
id|m-&gt;msg_iov-&gt;iov_len
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|sk-&gt;sk_err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
(brace
id|error
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
template_param
id|vcc-&gt;qos.txtp.max_sdu
)paren
(brace
id|error
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* verify_area is done by net/socket.c */
id|eff
op_assign
(paren
id|size
op_plus
l_int|3
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* align to word boundary */
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|skb
op_assign
id|alloc_tx
c_func
(paren
id|vcc
comma
id|eff
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|m-&gt;msg_flags
op_amp
id|MSG_DONTWAIT
)paren
(brace
id|error
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|error
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|sk-&gt;sk_err
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EPIPE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|prepare_to_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
comma
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
id|skb-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* for paths shared with net_device interfaces */
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|atm_options
op_assign
id|vcc-&gt;atm_options
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|size
)paren
comma
id|buff
comma
id|size
)paren
)paren
(brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|eff
op_ne
id|size
)paren
id|memset
c_func
(paren
id|skb-&gt;data
op_plus
id|size
comma
l_int|0
comma
id|eff
op_minus
id|size
)paren
suffix:semicolon
id|error
op_assign
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|send
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|error
op_assign
id|error
ques
c_cond
id|error
suffix:colon
id|size
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|vcc_poll
r_int
r_int
id|vcc_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|socket
op_star
id|sock
comma
id|poll_table
op_star
id|wait
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
id|sk-&gt;sk_sleep
comma
id|wait
)paren
suffix:semicolon
id|mask
op_assign
l_int|0
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
multiline_comment|/* exceptional events */
r_if
c_cond
(paren
id|sk-&gt;sk_err
)paren
id|mask
op_assign
id|POLLERR
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|ATM_VF_RELEASED
comma
op_amp
id|vcc-&gt;flags
)paren
op_logical_or
id|test_bit
c_func
(paren
id|ATM_VF_CLOSE
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
id|mask
op_or_assign
id|POLLHUP
suffix:semicolon
multiline_comment|/* readable? */
r_if
c_cond
(paren
op_logical_neg
id|skb_queue_empty
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
multiline_comment|/* writable? */
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
op_logical_and
id|test_bit
c_func
(paren
id|ATM_VF_WAITING
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|vcc_writable
c_func
(paren
id|vcc-&gt;sk
)paren
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
op_or
id|POLLWRBAND
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|atm_change_qos
r_static
r_int
id|atm_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t let the QoS change the already connected AAL type nor the&n;&t; * traffic class.&n;&t; */
r_if
c_cond
(paren
id|qos-&gt;aal
op_ne
id|vcc-&gt;qos.aal
op_logical_or
id|qos-&gt;rxtp.traffic_class
op_ne
id|vcc-&gt;qos.rxtp.traffic_class
op_logical_or
id|qos-&gt;txtp.traffic_class
op_ne
id|vcc-&gt;qos.txtp.traffic_class
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|qos-&gt;txtp
comma
id|qos-&gt;aal
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|adjust_tp
c_func
(paren
op_amp
id|qos-&gt;rxtp
comma
id|qos-&gt;aal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;change_qos
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;sk-&gt;sk_family
op_eq
id|AF_ATMPVC
)paren
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|change_qos
c_func
(paren
id|vcc
comma
id|qos
comma
id|ATM_MF_SET
)paren
suffix:semicolon
r_return
id|svc_change_qos
c_func
(paren
id|vcc
comma
id|qos
)paren
suffix:semicolon
)brace
DECL|function|check_tp
r_static
r_int
id|check_tp
c_func
(paren
r_struct
id|atm_trafprm
op_star
id|tp
)paren
(brace
multiline_comment|/* @@@ Should be merged with adjust_tp */
r_if
c_cond
(paren
op_logical_neg
id|tp-&gt;traffic_class
op_logical_or
id|tp-&gt;traffic_class
op_eq
id|ATM_ANYCLASS
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;traffic_class
op_ne
id|ATM_UBR
op_logical_and
op_logical_neg
id|tp-&gt;min_pcr
op_logical_and
op_logical_neg
id|tp-&gt;pcr
op_logical_and
op_logical_neg
id|tp-&gt;max_pcr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;min_pcr
op_eq
id|ATM_MAX_PCR
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|tp-&gt;min_pcr
op_logical_and
id|tp-&gt;max_pcr
op_logical_and
id|tp-&gt;max_pcr
op_ne
id|ATM_MAX_PCR
op_logical_and
id|tp-&gt;min_pcr
OG
id|tp-&gt;max_pcr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/*&n;&t; * We allow pcr to be outside [min_pcr,max_pcr], because later&n;&t; * adjustment may still push it in the valid range.&n;&t; */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_qos
r_static
r_int
id|check_qos
c_func
(paren
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|qos-&gt;txtp.traffic_class
op_logical_and
op_logical_neg
id|qos-&gt;rxtp.traffic_class
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|qos-&gt;txtp.traffic_class
op_ne
id|qos-&gt;rxtp.traffic_class
op_logical_and
id|qos-&gt;txtp.traffic_class
op_logical_and
id|qos-&gt;rxtp.traffic_class
op_logical_and
id|qos-&gt;txtp.traffic_class
op_ne
id|ATM_ANYCLASS
op_logical_and
id|qos-&gt;rxtp.traffic_class
op_ne
id|ATM_ANYCLASS
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|error
op_assign
id|check_tp
c_func
(paren
op_amp
id|qos-&gt;txtp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|check_tp
c_func
(paren
op_amp
id|qos-&gt;rxtp
)paren
suffix:semicolon
)brace
DECL|function|vcc_setsockopt
r_int
id|vcc_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
r_int
id|value
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|__SO_LEVEL_MATCH
c_func
(paren
id|optname
comma
id|level
)paren
op_logical_and
id|optlen
op_ne
id|__SO_SIZE
c_func
(paren
id|optname
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_ATMQOS
suffix:colon
(brace
r_struct
id|atm_qos
id|qos
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|qos
comma
id|optval
comma
r_sizeof
(paren
id|qos
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|error
op_assign
id|check_qos
c_func
(paren
op_amp
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTED
)paren
r_return
id|atm_change_qos
c_func
(paren
id|vcc
comma
op_amp
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
id|vcc-&gt;qos
op_assign
id|qos
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SO_SETCLP
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|value
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|value
)paren
id|vcc-&gt;atm_options
op_or_assign
id|ATM_ATMOPT_CLP
suffix:semicolon
r_else
id|vcc-&gt;atm_options
op_and_assign
op_complement
id|ATM_ATMOPT_CLP
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|level
op_eq
id|SOL_SOCKET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;setsockopt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|setsockopt
c_func
(paren
id|vcc
comma
id|level
comma
id|optname
comma
id|optval
comma
id|optlen
)paren
suffix:semicolon
)brace
DECL|function|vcc_getsockopt
r_int
id|vcc_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|__SO_LEVEL_MATCH
c_func
(paren
id|optname
comma
id|level
)paren
op_logical_and
id|len
op_ne
id|__SO_SIZE
c_func
(paren
id|optname
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|vcc
op_assign
id|ATM_SD
c_func
(paren
id|sock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|SO_ATMQOS
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|vcc-&gt;qos
comma
r_sizeof
(paren
id|vcc-&gt;qos
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SO_SETCLP
suffix:colon
r_return
id|put_user
c_func
(paren
id|vcc-&gt;atm_options
op_amp
id|ATM_ATMOPT_CLP
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
(paren
r_int
r_int
op_star
)paren
id|optval
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SO_ATMPVC
suffix:colon
(brace
r_struct
id|sockaddr_atmpvc
id|pvc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
)paren
r_return
op_minus
id|ENOTCONN
suffix:semicolon
id|pvc.sap_family
op_assign
id|AF_ATMPVC
suffix:semicolon
id|pvc.sap_addr.itf
op_assign
id|vcc-&gt;dev-&gt;number
suffix:semicolon
id|pvc.sap_addr.vpi
op_assign
id|vcc-&gt;vpi
suffix:semicolon
id|pvc.sap_addr.vci
op_assign
id|vcc-&gt;vci
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|pvc
comma
r_sizeof
(paren
id|pvc
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|level
op_eq
id|SOL_SOCKET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|vcc-&gt;dev
op_logical_or
op_logical_neg
id|vcc-&gt;dev-&gt;ops-&gt;getsockopt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|vcc-&gt;dev-&gt;ops
op_member_access_from_pointer
id|getsockopt
c_func
(paren
id|vcc
comma
id|level
comma
id|optname
comma
id|optval
comma
id|len
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE)
macro_line|#if defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE)
r_struct
id|net_bridge
suffix:semicolon
DECL|variable|br_fdb_get_hook
r_struct
id|net_bridge_fdb_entry
op_star
(paren
op_star
id|br_fdb_get_hook
)paren
(paren
r_struct
id|net_bridge
op_star
id|br
comma
r_int
r_char
op_star
id|addr
)paren
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|br_fdb_put_hook
r_void
(paren
op_star
id|br_fdb_put_hook
)paren
(paren
r_struct
id|net_bridge_fdb_entry
op_star
id|ent
)paren
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if defined(CONFIG_ATM_LANE_MODULE) || defined(CONFIG_BRIDGE_MODULE)
DECL|variable|br_fdb_get_hook
id|EXPORT_SYMBOL
c_func
(paren
id|br_fdb_get_hook
)paren
suffix:semicolon
DECL|variable|br_fdb_put_hook
id|EXPORT_SYMBOL
c_func
(paren
id|br_fdb_put_hook
)paren
suffix:semicolon
macro_line|#endif /* defined(CONFIG_ATM_LANE_MODULE) || defined(CONFIG_BRIDGE_MODULE) */
macro_line|#endif /* defined(CONFIG_BRIDGE) || defined(CONFIG_BRIDGE_MODULE) */
macro_line|#endif /* defined(CONFIG_ATM_LANE) || defined(CONFIG_ATM_LANE_MODULE) */
DECL|function|atm_init
r_static
r_int
id|__init
id|atm_init
c_func
(paren
r_void
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|atmpvc_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atmpvc_init() failed with %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|atmsvc_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atmsvc_init() failed with %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|atm_proc_init
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atm_proc_init() failed with %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_goto
id|failure
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|failure
suffix:colon
id|atmsvc_exit
c_func
(paren
)paren
suffix:semicolon
id|atmpvc_exit
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|atm_exit
r_static
r_void
id|__exit
id|atm_exit
c_func
(paren
r_void
)paren
(brace
id|atm_proc_exit
c_func
(paren
)paren
suffix:semicolon
id|atmsvc_exit
c_func
(paren
)paren
suffix:semicolon
id|atmpvc_exit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|atm_init
id|module_init
c_func
(paren
id|atm_init
)paren
suffix:semicolon
DECL|variable|atm_exit
id|module_exit
c_func
(paren
id|atm_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|PF_ATMPVC
id|MODULE_ALIAS_NETPROTO
c_func
(paren
id|PF_ATMPVC
)paren
suffix:semicolon
DECL|variable|PF_ATMSVC
id|MODULE_ALIAS_NETPROTO
c_func
(paren
id|PF_ATMSVC
)paren
suffix:semicolon
eof
