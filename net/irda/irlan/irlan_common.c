multiline_comment|/*********************************************************************&n; *                &n; * Filename:      irlan_common.c&n; * Version:       0.9&n; * Description:   IrDA LAN Access Protocol Implementation&n; * Status:        Experimental.&n; * Author:        Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * Created at:    Sun Aug 31 20:14:37 1997&n; * Modified at:   Sun Dec 26 21:53:10 1999&n; * Modified by:   Dag Brattli &lt;dagb@cs.uit.no&gt;&n; * &n; *     Copyright (c) 1997, 1999 Dag Brattli &lt;dagb@cs.uit.no&gt;, &n; *     All Rights Reserved.&n; *     &n; *     This program is free software; you can redistribute it and/or &n; *     modify it under the terms of the GNU General Public License as &n; *     published by the Free Software Foundation; either version 2 of &n; *     the License, or (at your option) any later version.&n; *&n; *     Neither Dag Brattli nor University of Troms&#xfffd; admit liability nor&n; *     provide warranty for any of this software. This material is &n; *     provided &quot;AS-IS&quot; and at no charge.&n; *&n; ********************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/etherdevice.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;net/irda/irda.h&gt;
macro_line|#include &lt;net/irda/irttp.h&gt;
macro_line|#include &lt;net/irda/irlmp.h&gt;
macro_line|#include &lt;net/irda/iriap.h&gt;
macro_line|#include &lt;net/irda/timer.h&gt;
macro_line|#include &lt;net/irda/irlan_common.h&gt;
macro_line|#include &lt;net/irda/irlan_client.h&gt;
macro_line|#include &lt;net/irda/irlan_provider.h&gt; 
macro_line|#include &lt;net/irda/irlan_eth.h&gt;
macro_line|#include &lt;net/irda/irlan_filter.h&gt;
multiline_comment|/* &n; * Send gratuitous ARP when connected to a new AP or not. May be a clever&n; * thing to do, but for some reason the machine crashes if you use DHCP. So&n; * lets not use it by default.&n; */
DECL|macro|CONFIG_IRLAN_SEND_GRATUITOUS_ARP
macro_line|#undef CONFIG_IRLAN_SEND_GRATUITOUS_ARP
multiline_comment|/* extern char sysctl_devname[]; */
multiline_comment|/*&n; *  Master structure&n; */
r_static
id|LIST_HEAD
c_func
(paren
id|irlans
)paren
suffix:semicolon
DECL|variable|ckey
r_static
r_void
op_star
id|ckey
suffix:semicolon
DECL|variable|skey
r_static
r_void
op_star
id|skey
suffix:semicolon
multiline_comment|/* Module parameters */
DECL|variable|eth
r_static
r_int
id|eth
suffix:semicolon
multiline_comment|/* Use &quot;eth&quot; or &quot;irlan&quot; name for devices */
DECL|variable|access
r_static
r_int
id|access
op_assign
id|ACCESS_PEER
suffix:semicolon
multiline_comment|/* PEER, DIRECT or HOSTED */
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|irlan_access
r_static
r_const
r_char
op_star
id|irlan_access
(braket
)braket
op_assign
(brace
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;DIRECT&quot;
comma
l_string|&quot;PEER&quot;
comma
l_string|&quot;HOSTED&quot;
)brace
suffix:semicolon
DECL|variable|irlan_media
r_static
r_const
r_char
op_star
id|irlan_media
(braket
)braket
op_assign
(brace
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;802.3&quot;
comma
l_string|&quot;802.5&quot;
)brace
suffix:semicolon
r_extern
r_struct
id|proc_dir_entry
op_star
id|proc_irda
suffix:semicolon
r_static
r_int
id|irlan_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
DECL|variable|irlan_fops
r_static
r_struct
id|file_operations
id|irlan_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|irlan_seq_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|seq_release
comma
)brace
suffix:semicolon
r_extern
r_struct
id|proc_dir_entry
op_star
id|proc_irda
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
r_static
r_struct
id|irlan_cb
op_star
id|irlan_open
c_func
(paren
id|__u32
id|saddr
comma
id|__u32
id|daddr
)paren
suffix:semicolon
r_static
r_void
id|__irlan_close
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_int
id|__irlan_insert_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
r_int
id|type
comma
id|__u8
id|value_byte
comma
id|__u16
id|value_short
comma
id|__u8
op_star
id|value_array
comma
id|__u16
id|value_len
)paren
suffix:semicolon
r_static
r_void
id|irlan_open_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
suffix:semicolon
r_static
r_void
id|irlan_get_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
suffix:semicolon
r_void
id|irlan_close_tsaps
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
suffix:semicolon
multiline_comment|/*&n; * Function irlan_init (void)&n; *&n; *    Initialize IrLAN layer&n; *&n; */
DECL|function|irlan_init
r_static
r_int
id|__init
id|irlan_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|irlan_cb
op_star
r_new
suffix:semicolon
id|__u16
id|hints
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
(brace
r_struct
id|proc_dir_entry
op_star
id|proc
suffix:semicolon
id|proc
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;irlan&quot;
comma
l_int|0
comma
id|proc_irda
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;irlan_init: can&squot;t create /proc entry!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|proc-&gt;proc_fops
op_assign
op_amp
id|irlan_fops
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|hints
op_assign
id|irlmp_service_to_hint
c_func
(paren
id|S_LAN
)paren
suffix:semicolon
multiline_comment|/* Register with IrLMP as a client */
id|ckey
op_assign
id|irlmp_register_client
c_func
(paren
id|hints
comma
op_amp
id|irlan_client_discovery_indication
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Register with IrLMP as a service */
id|skey
op_assign
id|irlmp_register_service
c_func
(paren
id|hints
)paren
suffix:semicolon
multiline_comment|/* Start the master IrLAN instance (the only one for now) */
r_new
op_assign
id|irlan_open
c_func
(paren
id|DEV_ADDR_ANY
comma
id|DEV_ADDR_ANY
)paren
suffix:semicolon
multiline_comment|/* The master will only open its (listen) control TSAP */
id|irlan_provider_open_ctrl_tsap
c_func
(paren
r_new
)paren
suffix:semicolon
multiline_comment|/* Do some fast discovery! */
id|irlmp_discovery_request
c_func
(paren
id|DISCOVERY_DEFAULT_SLOTS
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|irlan_cleanup
r_static
r_void
id|__exit
id|irlan_cleanup
c_func
(paren
r_void
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
comma
op_star
id|next
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|irlmp_unregister_client
c_func
(paren
id|ckey
)paren
suffix:semicolon
id|irlmp_unregister_service
c_func
(paren
id|skey
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|remove_proc_entry
c_func
(paren
l_string|&quot;irlan&quot;
comma
id|proc_irda
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/* Cleanup any leftover network devices */
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|list_for_each_entry_safe
c_func
(paren
id|self
comma
id|next
comma
op_amp
id|irlans
comma
id|dev_list
)paren
(brace
id|__irlan_close
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open (void)&n; *&n; *    Open new instance of a client/provider, we should only register the &n; *    network device if this instance is ment for a particular client/provider&n; */
DECL|function|irlan_open
r_static
r_struct
id|irlan_cb
op_star
id|irlan_open
c_func
(paren
id|__u32
id|saddr
comma
id|__u32
id|daddr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* Create network device with irlan */
id|dev
op_assign
id|alloc_irlandev
c_func
(paren
id|eth
ques
c_cond
l_string|&quot;eth%d&quot;
suffix:colon
l_string|&quot;irlan%d&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_return
l_int|NULL
suffix:semicolon
id|self
op_assign
id|dev-&gt;priv
suffix:semicolon
id|self-&gt;dev
op_assign
id|dev
suffix:semicolon
multiline_comment|/*&n;&t; *  Initialize local device structure&n;&t; */
id|self-&gt;magic
op_assign
id|IRLAN_MAGIC
suffix:semicolon
id|self-&gt;saddr
op_assign
id|saddr
suffix:semicolon
id|self-&gt;daddr
op_assign
id|daddr
suffix:semicolon
multiline_comment|/* Provider access can only be PEER, DIRECT, or HOSTED */
id|self-&gt;provider.access_type
op_assign
id|access
suffix:semicolon
r_if
c_cond
(paren
id|access
op_eq
id|ACCESS_DIRECT
)paren
(brace
multiline_comment|/*  &n;&t;&t; * Since we are emulating an IrLAN sever we will have to&n;&t;&t; * give ourself an ethernet address!  &n;&t;&t; */
id|dev-&gt;dev_addr
(braket
l_int|0
)braket
op_assign
l_int|0x40
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|dev-&gt;dev_addr
(braket
l_int|3
)braket
op_assign
l_int|0x00
suffix:semicolon
id|get_random_bytes
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
id|get_random_bytes
c_func
(paren
id|dev-&gt;dev_addr
op_plus
l_int|5
comma
l_int|1
)paren
suffix:semicolon
)brace
id|self-&gt;media
op_assign
id|MEDIA_802_3
suffix:semicolon
id|self-&gt;disconnect_reason
op_assign
id|LM_USER_REQUEST
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|self-&gt;watchdog_timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|self-&gt;client.kick_timer
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|self-&gt;open_wait
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|self-&gt;client.txq
)paren
suffix:semicolon
id|irlan_next_client_state
c_func
(paren
id|self
comma
id|IRLAN_IDLE
)paren
suffix:semicolon
id|irlan_next_provider_state
c_func
(paren
id|self
comma
id|IRLAN_IDLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_netdev
c_func
(paren
id|dev
)paren
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), register_netdev() failed!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|self
op_assign
l_int|NULL
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|list_add_rcu
c_func
(paren
op_amp
id|self-&gt;dev_list
comma
op_amp
id|irlans
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|self
suffix:semicolon
)brace
multiline_comment|/*&n; * Function __irlan_close (self)&n; *&n; *    This function closes and deallocates the IrLAN client instances. Be &n; *    aware that other functions which calls client_close() must&n; *    remove self from irlans list first.&n; */
DECL|function|__irlan_close
r_static
r_void
id|__irlan_close
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT_RTNL
c_func
(paren
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|self-&gt;watchdog_timer
)paren
suffix:semicolon
id|del_timer_sync
c_func
(paren
op_amp
id|self-&gt;client.kick_timer
)paren
suffix:semicolon
multiline_comment|/* Close all open connections and remove TSAPs */
id|irlan_close_tsaps
c_func
(paren
id|self
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;client.iriap
)paren
id|iriap_close
c_func
(paren
id|self-&gt;client.iriap
)paren
suffix:semicolon
multiline_comment|/* Remove frames queued on the control channel */
id|skb_queue_purge
c_func
(paren
op_amp
id|self-&gt;client.txq
)paren
suffix:semicolon
multiline_comment|/* Unregister and free self via destructor */
id|unregister_netdevice
c_func
(paren
id|self-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/* Find any instance of irlan, used for client discovery wakeup */
DECL|function|irlan_get_any
r_struct
id|irlan_cb
op_star
id|irlan_get_any
c_func
(paren
r_void
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|list_for_each_entry_rcu
c_func
(paren
id|self
comma
op_amp
id|irlans
comma
id|dev_list
)paren
(brace
r_return
id|self
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_connect_indication (instance, sap, qos, max_sdu_size, skb)&n; *&n; *    Here we receive the connect indication for the data channel&n; *&n; */
DECL|function|irlan_connect_indication
r_static
r_void
id|irlan_connect_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|qos_info
op_star
id|qos
comma
id|__u32
id|max_sdu_size
comma
id|__u8
id|max_header_size
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
r_struct
id|tsap_cb
op_star
id|tsap
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|instance
suffix:semicolon
id|tsap
op_assign
(paren
r_struct
id|tsap_cb
op_star
)paren
id|sap
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|tsap
op_eq
id|self-&gt;tsap_data
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|self-&gt;max_sdu_size
op_assign
id|max_sdu_size
suffix:semicolon
id|self-&gt;max_header_size
op_assign
id|max_header_size
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s: We are now connected!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|self-&gt;watchdog_timer
)paren
suffix:semicolon
multiline_comment|/* If you want to pass the skb to *both* state machines, you will&n;&t; * need to skb_clone() it, so that you don&squot;t free it twice.&n;&t; * As the state machines don&squot;t need it, git rid of it here...&n;&t; * Jean II */
r_if
c_cond
(paren
id|skb
)paren
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|irlan_do_provider_event
c_func
(paren
id|self
comma
id|IRLAN_DATA_CONNECT_INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
id|irlan_do_client_event
c_func
(paren
id|self
comma
id|IRLAN_DATA_CONNECT_INDICATION
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;provider.access_type
op_eq
id|ACCESS_PEER
)paren
(brace
multiline_comment|/* &n;&t;&t; * Data channel is open, so we are now allowed to&n;&t;&t; * configure the remote filter &n;&t;&t; */
id|irlan_get_unicast_addr
c_func
(paren
id|self
)paren
suffix:semicolon
id|irlan_open_unicast_addr
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
multiline_comment|/* Ready to transfer Ethernet frames (at last) */
id|netif_start_queue
c_func
(paren
id|self-&gt;dev
)paren
suffix:semicolon
multiline_comment|/* Clear reason */
)brace
DECL|function|irlan_connect_confirm
r_static
r_void
id|irlan_connect_confirm
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
r_struct
id|qos_info
op_star
id|qos
comma
id|__u32
id|max_sdu_size
comma
id|__u8
id|max_header_size
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|instance
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|self-&gt;max_sdu_size
op_assign
id|max_sdu_size
suffix:semicolon
id|self-&gt;max_header_size
op_assign
id|max_header_size
suffix:semicolon
multiline_comment|/* TODO: we could set the MTU depending on the max_sdu_size */
id|IRDA_DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s: We are now connected!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|self-&gt;watchdog_timer
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Data channel is open, so we are now allowed to configure the remote&n;&t; * filter &n;&t; */
id|irlan_get_unicast_addr
c_func
(paren
id|self
)paren
suffix:semicolon
id|irlan_open_unicast_addr
c_func
(paren
id|self
)paren
suffix:semicolon
multiline_comment|/* Open broadcast and multicast filter by default */
id|irlan_set_broadcast_filter
c_func
(paren
id|self
comma
id|TRUE
)paren
suffix:semicolon
id|irlan_set_multicast_filter
c_func
(paren
id|self
comma
id|TRUE
)paren
suffix:semicolon
multiline_comment|/* Ready to transfer Ethernet frames */
id|netif_start_queue
c_func
(paren
id|self-&gt;dev
)paren
suffix:semicolon
id|self-&gt;disconnect_reason
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Clear reason */
macro_line|#ifdef CONFIG_IRLAN_SEND_GRATUITOUS_ARP
id|irlan_eth_send_gratuitous_arp
c_func
(paren
op_amp
id|self-&gt;dev
)paren
suffix:semicolon
macro_line|#endif
id|wake_up_interruptible
c_func
(paren
op_amp
id|self-&gt;open_wait
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_client_disconnect_indication (handle)&n; *&n; *    Callback function for the IrTTP layer. Indicates a disconnection of&n; *    the specified connection (handle)&n; */
DECL|function|irlan_disconnect_indication
r_static
r_void
id|irlan_disconnect_indication
c_func
(paren
r_void
op_star
id|instance
comma
r_void
op_star
id|sap
comma
id|LM_REASON
id|reason
comma
r_struct
id|sk_buff
op_star
id|userdata
)paren
(brace
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
r_struct
id|tsap_cb
op_star
id|tsap
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|0
comma
l_string|&quot;%s(), reason=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|reason
)paren
suffix:semicolon
id|self
op_assign
(paren
r_struct
id|irlan_cb
op_star
)paren
id|instance
suffix:semicolon
id|tsap
op_assign
(paren
r_struct
id|tsap_cb
op_star
)paren
id|sap
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|tsap
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|tsap-&gt;magic
op_eq
id|TTP_TSAP_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|tsap
op_eq
id|self-&gt;tsap_data
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;IrLAN, data channel disconnected by peer!&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Save reason so we know if we should try to reconnect or not */
id|self-&gt;disconnect_reason
op_assign
id|reason
suffix:semicolon
r_switch
c_cond
(paren
id|reason
)paren
(brace
r_case
id|LM_USER_REQUEST
suffix:colon
multiline_comment|/* User request */
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), User requested&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LM_LAP_DISCONNECT
suffix:colon
multiline_comment|/* Unexpected IrLAP disconnect */
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), Unexpected IrLAP disconnect&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LM_CONNECT_FAILURE
suffix:colon
multiline_comment|/* Failed to establish IrLAP connection */
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), IrLAP connect failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LM_LAP_RESET
suffix:colon
multiline_comment|/* IrLAP reset */
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), IrLAP reset&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LM_INIT_DISCONNECT
suffix:colon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), IrLMP connect failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ERROR
c_func
(paren
l_string|&quot;%s(), Unknown disconnect reason&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* If you want to pass the skb to *both* state machines, you will&n;&t; * need to skb_clone() it, so that you don&squot;t free it twice.&n;&t; * As the state machines don&squot;t need it, git rid of it here...&n;&t; * Jean II */
r_if
c_cond
(paren
id|userdata
)paren
id|dev_kfree_skb
c_func
(paren
id|userdata
)paren
suffix:semicolon
id|irlan_do_client_event
c_func
(paren
id|self
comma
id|IRLAN_LMP_DISCONNECT
comma
l_int|NULL
)paren
suffix:semicolon
id|irlan_do_provider_event
c_func
(paren
id|self
comma
id|IRLAN_LMP_DISCONNECT
comma
l_int|NULL
)paren
suffix:semicolon
id|wake_up_interruptible
c_func
(paren
op_amp
id|self-&gt;open_wait
)paren
suffix:semicolon
)brace
DECL|function|irlan_open_data_tsap
r_void
id|irlan_open_data_tsap
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|tsap_cb
op_star
id|tsap
suffix:semicolon
id|notify_t
id|notify
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Check if already open */
r_if
c_cond
(paren
id|self-&gt;tsap_data
)paren
r_return
suffix:semicolon
id|irda_notify_init
c_func
(paren
op_amp
id|notify
)paren
suffix:semicolon
id|notify.data_indication
op_assign
id|irlan_eth_receive
suffix:semicolon
id|notify.udata_indication
op_assign
id|irlan_eth_receive
suffix:semicolon
id|notify.connect_indication
op_assign
id|irlan_connect_indication
suffix:semicolon
id|notify.connect_confirm
op_assign
id|irlan_connect_confirm
suffix:semicolon
id|notify.flow_indication
op_assign
id|irlan_eth_flow_indication
suffix:semicolon
id|notify.disconnect_indication
op_assign
id|irlan_disconnect_indication
suffix:semicolon
id|notify.instance
op_assign
id|self
suffix:semicolon
id|strlcpy
c_func
(paren
id|notify.name
comma
l_string|&quot;IrLAN data&quot;
comma
r_sizeof
(paren
id|notify.name
)paren
)paren
suffix:semicolon
id|tsap
op_assign
id|irttp_open_tsap
c_func
(paren
id|LSAP_ANY
comma
id|DEFAULT_INITIAL_CREDIT
comma
op_amp
id|notify
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tsap
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), Got no tsap!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|self-&gt;tsap_data
op_assign
id|tsap
suffix:semicolon
multiline_comment|/* &n;&t; *  This is the data TSAP selector which we will pass to the client&n;&t; *  when the client ask for it.&n;&t; */
id|self-&gt;stsap_sel_data
op_assign
id|self-&gt;tsap_data-&gt;stsap_sel
suffix:semicolon
)brace
DECL|function|irlan_close_tsaps
r_void
id|irlan_close_tsaps
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Disconnect and close all open TSAP connections */
r_if
c_cond
(paren
id|self-&gt;tsap_data
)paren
(brace
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;tsap_data
comma
l_int|NULL
comma
id|P_NORMAL
)paren
suffix:semicolon
id|irttp_close_tsap
c_func
(paren
id|self-&gt;tsap_data
)paren
suffix:semicolon
id|self-&gt;tsap_data
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;client.tsap_ctrl
)paren
(brace
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;client.tsap_ctrl
comma
l_int|NULL
comma
id|P_NORMAL
)paren
suffix:semicolon
id|irttp_close_tsap
c_func
(paren
id|self-&gt;client.tsap_ctrl
)paren
suffix:semicolon
id|self-&gt;client.tsap_ctrl
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|self-&gt;provider.tsap_ctrl
)paren
(brace
id|irttp_disconnect_request
c_func
(paren
id|self-&gt;provider.tsap_ctrl
comma
l_int|NULL
comma
id|P_NORMAL
)paren
suffix:semicolon
id|irttp_close_tsap
c_func
(paren
id|self-&gt;provider.tsap_ctrl
)paren
suffix:semicolon
id|self-&gt;provider.tsap_ctrl
op_assign
l_int|NULL
suffix:semicolon
)brace
id|self-&gt;disconnect_reason
op_assign
id|LM_USER_REQUEST
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_ias_register (self, tsap_sel)&n; *&n; *    Register with LM-IAS&n; *&n; */
DECL|function|irlan_ias_register
r_void
id|irlan_ias_register
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
id|__u8
id|tsap_sel
)paren
(brace
r_struct
id|ias_object
op_star
id|obj
suffix:semicolon
r_struct
id|ias_value
op_star
id|new_value
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* &n;&t; * Check if object has already been registered by a previous provider.&n;&t; * If that is the case, we just change the value of the attribute&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|irias_find_object
c_func
(paren
l_string|&quot;IrLAN&quot;
)paren
)paren
(brace
id|obj
op_assign
id|irias_new_object
c_func
(paren
l_string|&quot;IrLAN&quot;
comma
id|IAS_IRLAN_ID
)paren
suffix:semicolon
id|irias_add_integer_attrib
c_func
(paren
id|obj
comma
l_string|&quot;IrDA:TinyTP:LsapSel&quot;
comma
id|tsap_sel
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
id|irias_insert_object
c_func
(paren
id|obj
)paren
suffix:semicolon
)brace
r_else
(brace
id|new_value
op_assign
id|irias_new_integer_value
c_func
(paren
id|tsap_sel
)paren
suffix:semicolon
id|irias_object_change_attribute
c_func
(paren
l_string|&quot;IrLAN&quot;
comma
l_string|&quot;IrDA:TinyTP:LsapSel&quot;
comma
id|new_value
)paren
suffix:semicolon
)brace
multiline_comment|/* Register PnP object only if not registered before */
r_if
c_cond
(paren
op_logical_neg
id|irias_find_object
c_func
(paren
l_string|&quot;PnP&quot;
)paren
)paren
(brace
id|obj
op_assign
id|irias_new_object
c_func
(paren
l_string|&quot;PnP&quot;
comma
id|IAS_PNP_ID
)paren
suffix:semicolon
macro_line|#if 0
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;Name&quot;
comma
id|sysctl_devname
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
macro_line|#else
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;Name&quot;
comma
l_string|&quot;Linux&quot;
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
macro_line|#endif
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;DeviceID&quot;
comma
l_string|&quot;HWP19F0&quot;
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
id|irias_add_integer_attrib
c_func
(paren
id|obj
comma
l_string|&quot;CompCnt&quot;
comma
l_int|1
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|self-&gt;provider.access_type
op_eq
id|ACCESS_PEER
)paren
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;Comp#01&quot;
comma
l_string|&quot;PNP8389&quot;
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
r_else
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;Comp#01&quot;
comma
l_string|&quot;PNP8294&quot;
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
id|irias_add_string_attrib
c_func
(paren
id|obj
comma
l_string|&quot;Manufacturer&quot;
comma
l_string|&quot;Linux-IrDA Project&quot;
comma
id|IAS_KERNEL_ATTR
)paren
suffix:semicolon
id|irias_insert_object
c_func
(paren
id|obj
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Function irlan_run_ctrl_tx_queue (self)&n; *&n; *    Try to send the next command in the control transmit queue&n; *&n; */
DECL|function|irlan_run_ctrl_tx_queue
r_int
id|irlan_run_ctrl_tx_queue
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irda_lock
c_func
(paren
op_amp
id|self-&gt;client.tx_busy
)paren
op_eq
id|FALSE
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|self-&gt;client.txq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|self-&gt;client.tx_busy
op_assign
id|FALSE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check that it&squot;s really possible to send commands */
r_if
c_cond
(paren
(paren
id|self-&gt;client.tsap_ctrl
op_eq
l_int|NULL
)paren
op_logical_or
(paren
id|self-&gt;client.state
op_eq
id|IRLAN_IDLE
)paren
)paren
(brace
id|self-&gt;client.tx_busy
op_assign
id|FALSE
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), sending ...&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
id|irttp_data_request
c_func
(paren
id|self-&gt;client.tsap_ctrl
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_ctrl_data_request (self, skb)&n; *&n; *    This function makes sure that commands on the control channel is being&n; *    sent in a command/response fashion&n; */
DECL|function|irlan_ctrl_data_request
r_static
r_void
id|irlan_ctrl_data_request
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* Queue command */
id|skb_queue_tail
c_func
(paren
op_amp
id|self-&gt;client.txq
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* Try to send command */
id|irlan_run_ctrl_tx_queue
c_func
(paren
id|self
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_provider_info (self)&n; *&n; *    Send Get Provider Information command to peer IrLAN layer&n; *&n; */
DECL|function|irlan_get_provider_info
r_void
id|irlan_get_provider_info
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_GET_PROVIDER_INFO
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Zero parameters */
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open_data_channel (self)&n; *&n; *    Send an Open Data Command to provider&n; *&n; */
DECL|function|irlan_open_data_channel
r_void
id|irlan_open_data_channel
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build frame */
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_OPEN_DATA_CHANNEL
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* Two parameters */
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;MEDIA&quot;
comma
l_string|&quot;802.3&quot;
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;ACCESS_TYPE&quot;
comma
l_string|&quot;DIRECT&quot;
)paren
suffix:semicolon
multiline_comment|/* irlan_insert_string_param(skb, &quot;MODE&quot;, &quot;UNRELIABLE&quot;); */
multiline_comment|/* &t;self-&gt;use_udata = TRUE; */
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
DECL|function|irlan_close_data_channel
r_void
id|irlan_close_data_channel
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
multiline_comment|/* Check if the TSAP is still there */
r_if
c_cond
(paren
id|self-&gt;client.tsap_ctrl
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build frame */
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_CLOSE_DATA_CHAN
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* Two parameters */
id|irlan_insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_open_unicast_addr (self)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the unicast &n; *    address.&n; *&n; */
DECL|function|irlan_open_unicast_addr
r_static
r_void
id|irlan_open_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|irlan_insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;DIRECTED&quot;
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;FILTER&quot;
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_set_broadcast_filter (self, status)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the broadcast&n; *    address. Be careful with the use of this one, since there may be a lot&n; *    of broadcast traffic out there. We can still function without this&n; *    one but then _we_ have to initiate all communication with other&n; *    hosts, since ARP request for this host will not be answered.&n; */
DECL|function|irlan_set_broadcast_filter
r_void
id|irlan_set_broadcast_filter
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
r_int
id|status
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|irlan_insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;BROADCAST&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;FILTER&quot;
)paren
suffix:semicolon
r_else
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;NONE&quot;
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_set_multicast_filter (self, status)&n; *&n; *    Make IrLAN provider accept ethernet frames addressed to the multicast&n; *    address. &n; *&n; */
DECL|function|irlan_set_multicast_filter
r_void
id|irlan_set_multicast_filter
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
comma
r_int
id|status
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|irlan_insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;MULTICAST&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;ALL&quot;
)paren
suffix:semicolon
r_else
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_MODE&quot;
comma
l_string|&quot;NONE&quot;
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_unicast_addr (self)&n; *&n; *    Retrieves the unicast address from the IrLAN provider. This address&n; *    will be inserted into the devices structure, so the ethernet layer&n; *    can construct its packets.&n; *&n; */
DECL|function|irlan_get_unicast_addr
r_static
r_void
id|irlan_get_unicast_addr
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|128
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_FILTER_OPERATION
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* Three parameters */
id|irlan_insert_byte_param
c_func
(paren
id|skb
comma
l_string|&quot;DATA_CHAN&quot;
comma
id|self-&gt;dtsap_sel_data
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_TYPE&quot;
comma
l_string|&quot;DIRECTED&quot;
)paren
suffix:semicolon
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;FILTER_OPERATION&quot;
comma
l_string|&quot;DYNAMIC&quot;
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_get_media_char (self)&n; *&n; *    &n; *&n; */
DECL|function|irlan_get_media_char
r_void
id|irlan_get_media_char
c_func
(paren
r_struct
id|irlan_cb
op_star
id|self
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|__u8
op_star
id|frame
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
suffix:semicolon
)paren
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
multiline_comment|/* Reserve space for TTP, LMP, and LAP header */
id|skb_reserve
c_func
(paren
id|skb
comma
id|self-&gt;client.max_header_size
)paren
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
l_int|2
)paren
suffix:semicolon
id|frame
op_assign
id|skb-&gt;data
suffix:semicolon
multiline_comment|/* Build frame */
id|frame
(braket
l_int|0
)braket
op_assign
id|CMD_GET_MEDIA_CHAR
suffix:semicolon
id|frame
(braket
l_int|1
)braket
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* One parameter */
id|irlan_insert_string_param
c_func
(paren
id|skb
comma
l_string|&quot;MEDIA&quot;
comma
l_string|&quot;802.3&quot;
)paren
suffix:semicolon
id|irlan_ctrl_data_request
c_func
(paren
id|self
comma
id|skb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_byte_param (skb, param, value)&n; *&n; *    Insert byte parameter into frame&n; *&n; */
DECL|function|irlan_insert_byte_param
r_int
id|irlan_insert_byte_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
id|__u8
id|value
)paren
(brace
r_return
id|__irlan_insert_param
c_func
(paren
id|skb
comma
id|param
comma
id|IRLAN_BYTE
comma
id|value
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|irlan_insert_short_param
r_int
id|irlan_insert_short_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
id|__u16
id|value
)paren
(brace
r_return
id|__irlan_insert_param
c_func
(paren
id|skb
comma
id|param
comma
id|IRLAN_SHORT
comma
l_int|0
comma
id|value
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_string (skb, param, value)&n; *&n; *    Insert string parameter into frame&n; *&n; */
DECL|function|irlan_insert_string_param
r_int
id|irlan_insert_string_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
r_char
op_star
id|string
)paren
(brace
r_int
id|string_len
op_assign
id|strlen
c_func
(paren
id|string
)paren
suffix:semicolon
r_return
id|__irlan_insert_param
c_func
(paren
id|skb
comma
id|param
comma
id|IRLAN_ARRAY
comma
l_int|0
comma
l_int|0
comma
id|string
comma
id|string_len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_array_param(skb, param, value, len_value)&n; *&n; *    Insert array parameter into frame&n; *&n; */
DECL|function|irlan_insert_array_param
r_int
id|irlan_insert_array_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|name
comma
id|__u8
op_star
id|array
comma
id|__u16
id|array_len
)paren
(brace
r_return
id|__irlan_insert_param
c_func
(paren
id|skb
comma
id|name
comma
id|IRLAN_ARRAY
comma
l_int|0
comma
l_int|0
comma
id|array
comma
id|array_len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Function insert_param (skb, param, value, byte)&n; *&n; *    Insert parameter at end of buffer, structure of a parameter is:&n; *&n; *    -----------------------------------------------------------------------&n; *    | Name Length[1] | Param Name[1..255] | Val Length[2] | Value[0..1016]|&n; *    -----------------------------------------------------------------------&n; */
DECL|function|__irlan_insert_param
r_static
r_int
id|__irlan_insert_param
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_char
op_star
id|param
comma
r_int
id|type
comma
id|__u8
id|value_byte
comma
id|__u16
id|value_short
comma
id|__u8
op_star
id|value_array
comma
id|__u16
id|value_len
)paren
(brace
id|__u8
op_star
id|frame
suffix:semicolon
id|__u8
id|param_len
suffix:semicolon
id|__u16
id|tmp_le
suffix:semicolon
multiline_comment|/* Temporary value in little endian format */
r_int
id|n
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), Got NULL skb&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|param_len
op_assign
id|strlen
c_func
(paren
id|param
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IRLAN_BYTE
suffix:colon
id|value_len
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRLAN_SHORT
suffix:colon
id|value_len
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRLAN_ARRAY
suffix:colon
id|ASSERT
c_func
(paren
id|value_array
op_ne
l_int|NULL
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|value_len
OG
l_int|0
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), Unknown parameter type!&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Insert at end of sk-buffer */
id|frame
op_assign
id|skb-&gt;tail
suffix:semicolon
multiline_comment|/* Make space for data */
r_if
c_cond
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
(paren
id|param_len
op_plus
id|value_len
op_plus
l_int|3
)paren
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), No more space at end of skb&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb_put
c_func
(paren
id|skb
comma
id|param_len
op_plus
id|value_len
op_plus
l_int|3
)paren
suffix:semicolon
multiline_comment|/* Insert parameter length */
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|param_len
suffix:semicolon
multiline_comment|/* Insert parameter */
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|param
comma
id|param_len
)paren
suffix:semicolon
id|n
op_add_assign
id|param_len
suffix:semicolon
multiline_comment|/* Insert value length (2 byte little endian format, LSB first) */
id|tmp_le
op_assign
id|cpu_to_le16
c_func
(paren
id|value_len
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
op_amp
id|tmp_le
comma
l_int|2
)paren
suffix:semicolon
id|n
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* To avoid alignment problems */
multiline_comment|/* Insert value */
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|IRLAN_BYTE
suffix:colon
id|frame
(braket
id|n
op_increment
)braket
op_assign
id|value_byte
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRLAN_SHORT
suffix:colon
id|tmp_le
op_assign
id|cpu_to_le16
c_func
(paren
id|value_short
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
op_amp
id|tmp_le
comma
l_int|2
)paren
suffix:semicolon
id|n
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRLAN_ARRAY
suffix:colon
id|memcpy
c_func
(paren
id|frame
op_plus
id|n
comma
id|value_array
comma
id|value_len
)paren
suffix:semicolon
id|n
op_add_assign
id|value_len
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|n
op_eq
(paren
id|param_len
op_plus
id|value_len
op_plus
l_int|3
)paren
comma
r_return
l_int|0
suffix:semicolon
)paren
suffix:semicolon
r_return
id|param_len
op_plus
id|value_len
op_plus
l_int|3
suffix:semicolon
)brace
multiline_comment|/*&n; * Function irlan_extract_param (buf, name, value, len)&n; *&n; *    Extracts a single parameter name/value pair from buffer and updates&n; *    the buffer pointer to point to the next name/value pair. &n; */
DECL|function|irlan_extract_param
r_int
id|irlan_extract_param
c_func
(paren
id|__u8
op_star
id|buf
comma
r_char
op_star
id|name
comma
r_char
op_star
id|value
comma
id|__u16
op_star
id|len
)paren
(brace
id|__u8
id|name_len
suffix:semicolon
id|__u16
id|val_len
suffix:semicolon
r_int
id|n
op_assign
l_int|0
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;%s()&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* get length of parameter name (1 byte) */
id|name_len
op_assign
id|buf
(braket
id|n
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|name_len
OG
l_int|254
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), name_len &gt; 254&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|RSP_INVALID_COMMAND_FORMAT
suffix:semicolon
)brace
multiline_comment|/* get parameter name */
id|memcpy
c_func
(paren
id|name
comma
id|buf
op_plus
id|n
comma
id|name_len
)paren
suffix:semicolon
id|name
(braket
id|name_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|n
op_add_assign
id|name_len
suffix:semicolon
multiline_comment|/*  &n;&t; *  Get length of parameter value (2 bytes in little endian &n;&t; *  format) &n;&t; */
id|memcpy
c_func
(paren
op_amp
id|val_len
comma
id|buf
op_plus
id|n
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* To avoid alignment problems */
id|le16_to_cpus
c_func
(paren
op_amp
id|val_len
)paren
suffix:semicolon
id|n
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|val_len
OG
l_int|1016
)paren
(brace
id|IRDA_DEBUG
c_func
(paren
l_int|2
comma
l_string|&quot;%s(), parameter length to long&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|RSP_INVALID_COMMAND_FORMAT
suffix:semicolon
)brace
op_star
id|len
op_assign
id|val_len
suffix:semicolon
multiline_comment|/* get parameter value */
id|memcpy
c_func
(paren
id|value
comma
id|buf
op_plus
id|n
comma
id|val_len
)paren
suffix:semicolon
id|value
(braket
id|val_len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|n
op_add_assign
id|val_len
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;Parameter: %s &quot;
comma
id|name
)paren
suffix:semicolon
id|IRDA_DEBUG
c_func
(paren
l_int|4
comma
l_string|&quot;Value: %s&bslash;n&quot;
comma
id|value
)paren
suffix:semicolon
r_return
id|n
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/*&n; * Start of reading /proc entries.&n; * Return entry at pos, &n; *&t;or start_token to indicate print header line&n; *&t;or NULL if end of file&n; */
DECL|function|irlan_seq_start
r_static
r_void
op_star
id|irlan_seq_start
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_int
id|i
op_assign
l_int|1
suffix:semicolon
r_struct
id|irlan_cb
op_star
id|self
suffix:semicolon
id|rcu_read_lock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pos
op_eq
l_int|0
)paren
r_return
id|SEQ_START_TOKEN
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|self
comma
op_amp
id|irlans
comma
id|dev_list
)paren
(brace
r_if
c_cond
(paren
op_star
id|pos
op_eq
id|i
)paren
r_return
id|self
suffix:semicolon
op_increment
id|i
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Return entry after v, and increment pos */
DECL|function|irlan_seq_next
r_static
r_void
op_star
id|irlan_seq_next
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_struct
id|list_head
op_star
id|nxt
suffix:semicolon
op_increment
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|nxt
op_assign
id|irlans.next
suffix:semicolon
r_else
id|nxt
op_assign
(paren
(paren
r_struct
id|irlan_cb
op_star
)paren
id|v
)paren
op_member_access_from_pointer
id|dev_list.next
suffix:semicolon
r_return
(paren
id|nxt
op_eq
op_amp
id|irlans
)paren
ques
c_cond
l_int|NULL
suffix:colon
id|list_entry
c_func
(paren
id|nxt
comma
r_struct
id|irlan_cb
comma
id|dev_list
)paren
suffix:semicolon
)brace
multiline_comment|/* End of reading /proc file */
DECL|function|irlan_seq_stop
r_static
r_void
id|irlan_seq_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
id|rcu_read_unlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Show one entry in /proc file.&n; */
DECL|function|irlan_seq_show
r_static
r_int
id|irlan_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
id|v
op_eq
id|SEQ_START_TOKEN
)paren
id|seq_puts
c_func
(paren
id|seq
comma
l_string|&quot;IrLAN instances:&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
r_struct
id|irlan_cb
op_star
id|self
op_assign
id|v
suffix:semicolon
id|ASSERT
c_func
(paren
id|self
op_ne
l_int|NULL
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|self-&gt;magic
op_eq
id|IRLAN_MAGIC
comma
r_return
op_minus
l_int|1
suffix:semicolon
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;ifname: %s,&bslash;n&quot;
comma
id|self-&gt;dev-&gt;name
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;client state: %s, &quot;
comma
id|irlan_state
(braket
id|self-&gt;client.state
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;provider state: %s,&bslash;n&quot;
comma
id|irlan_state
(braket
id|self-&gt;provider.state
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;saddr: %#08x, &quot;
comma
id|self-&gt;saddr
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;daddr: %#08x&bslash;n&quot;
comma
id|self-&gt;daddr
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;version: %d.%d,&bslash;n&quot;
comma
id|self-&gt;version
(braket
l_int|1
)braket
comma
id|self-&gt;version
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;access type: %s&bslash;n&quot;
comma
id|irlan_access
(braket
id|self-&gt;client.access_type
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;media: %s&bslash;n&quot;
comma
id|irlan_media
(braket
id|self-&gt;media
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;local filter:&bslash;n&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;remote filter: &quot;
)paren
suffix:semicolon
id|irlan_print_filter
c_func
(paren
id|seq
comma
id|self-&gt;client.filter_type
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;tx busy: %s&bslash;n&quot;
comma
id|netif_queue_stopped
c_func
(paren
id|self-&gt;dev
)paren
ques
c_cond
l_string|&quot;TRUE&quot;
suffix:colon
l_string|&quot;FALSE&quot;
)paren
suffix:semicolon
id|seq_putc
c_func
(paren
id|seq
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|irlan_seq_ops
r_static
r_struct
id|seq_operations
id|irlan_seq_ops
op_assign
(brace
dot
id|start
op_assign
id|irlan_seq_start
comma
dot
id|next
op_assign
id|irlan_seq_next
comma
dot
id|stop
op_assign
id|irlan_seq_stop
comma
dot
id|show
op_assign
id|irlan_seq_show
comma
)brace
suffix:semicolon
DECL|function|irlan_seq_open
r_static
r_int
id|irlan_seq_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|seq_open
c_func
(paren
id|file
comma
op_amp
id|irlan_seq_ops
)paren
suffix:semicolon
)brace
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Dag Brattli &lt;dagb@cs.uit.no&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;The Linux IrDA LAN protocol&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|eth
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|eth
comma
l_string|&quot;Name devices ethX (0) or irlanX (1)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|access
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|access
comma
l_string|&quot;Access type DIRECT=1, PEER=2, HOSTED=3&quot;
)paren
suffix:semicolon
DECL|variable|irlan_init
id|module_init
c_func
(paren
id|irlan_init
)paren
suffix:semicolon
DECL|variable|irlan_cleanup
id|module_exit
c_func
(paren
id|irlan_cleanup
)paren
suffix:semicolon
eof
