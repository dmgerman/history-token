multiline_comment|/*&n; * net/key/af_key.c&t;An implementation of PF_KEYv2 sockets.&n; *&n; *&t;&t;This program is free software; you can redistribute it and/or&n; *&t;&t;modify it under the terms of the GNU General Public License&n; *&t;&t;as published by the Free Software Foundation; either version&n; *&t;&t;2 of the License, or (at your option) any later version.&n; *&n; * Authors:&t;Maxim Giryaev&t;&lt;gem@asplinux.ru&gt;&n; *&t;&t;David S. Miller&t;&lt;davem@redhat.com&gt;&n; *&t;&t;Alexey Kuznetsov &lt;kuznet@ms2.inr.ac.ru&gt;&n; *&t;&t;Kunihiro Ishiguro &lt;kunihiro@ipinfusion.com&gt;&n; *&t;&t;Kazunori MIYAZAWA / USAGI Project &lt;miyazawa@linux-ipv6.org&gt;&n; *&t;&t;Derek Atkins &lt;derek@ihtfp.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/pfkeyv2.h&gt;
macro_line|#include &lt;linux/ipsec.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/in6.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;net/xfrm.h&gt;
macro_line|#include &lt;net/sock.h&gt;
DECL|macro|_X2KEY
mdefine_line|#define _X2KEY(x) ((x) == XFRM_INF ? 0 : (x))
DECL|macro|_KEY2X
mdefine_line|#define _KEY2X(x) ((x) == 0 ? XFRM_INF : (x))
multiline_comment|/* List of all pfkey sockets. */
DECL|variable|pfkey_table
r_static
r_struct
id|sock
op_star
id|pfkey_table
suffix:semicolon
r_static
id|DECLARE_WAIT_QUEUE_HEAD
c_func
(paren
id|pfkey_table_wait
)paren
suffix:semicolon
DECL|variable|pfkey_table_lock
r_static
id|rwlock_t
id|pfkey_table_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|pfkey_table_users
r_static
id|atomic_t
id|pfkey_table_users
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|variable|pfkey_socks_nr
r_static
id|atomic_t
id|pfkey_socks_nr
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
DECL|struct|pfkey_opt
r_struct
id|pfkey_opt
(brace
DECL|member|registered
r_int
id|registered
suffix:semicolon
DECL|member|promisc
r_int
id|promisc
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|pfkey_sk
mdefine_line|#define pfkey_sk(__sk) ((struct pfkey_opt *)(__sk)-&gt;protinfo)
DECL|function|pfkey_sock_destruct
r_static
r_void
id|pfkey_sock_destruct
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|SOCK_DEAD
comma
op_amp
id|sk-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Attempt to release alive pfkey socket: %p&bslash;n&quot;
comma
id|sk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|BUG_TRAP
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|BUG_TRAP
c_func
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|pfkey_sk
c_func
(paren
id|sk
)paren
)paren
suffix:semicolon
id|atomic_dec
c_func
(paren
op_amp
id|pfkey_socks_nr
)paren
suffix:semicolon
)brace
DECL|function|pfkey_table_grab
r_static
r_void
id|pfkey_table_grab
c_func
(paren
r_void
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|pfkey_table_users
)paren
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
op_amp
id|pfkey_table_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|pfkey_table_users
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|write_lock_bh
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|pfkey_table_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
)brace
)brace
DECL|function|pfkey_table_ungrab
r_static
id|__inline__
r_void
id|pfkey_table_ungrab
c_func
(paren
r_void
)paren
(brace
id|write_unlock_bh
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|pfkey_table_wait
)paren
suffix:semicolon
)brace
DECL|function|pfkey_lock_table
r_static
id|__inline__
r_void
id|pfkey_lock_table
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* read_lock() synchronizes us to pfkey_table_grab */
id|read_lock
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|pfkey_table_users
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
)brace
DECL|function|pfkey_unlock_table
r_static
id|__inline__
r_void
id|pfkey_unlock_table
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|pfkey_table_users
)paren
)paren
id|wake_up
c_func
(paren
op_amp
id|pfkey_table_wait
)paren
suffix:semicolon
)brace
DECL|variable|pfkey_ops
r_static
r_struct
id|proto_ops
id|pfkey_ops
suffix:semicolon
DECL|function|pfkey_insert
r_static
r_void
id|pfkey_insert
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|pfkey_table_grab
c_func
(paren
)paren
suffix:semicolon
id|sk-&gt;next
op_assign
id|pfkey_table
suffix:semicolon
id|pfkey_table
op_assign
id|sk
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|pfkey_table_ungrab
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pfkey_remove
r_static
r_void
id|pfkey_remove
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sock
op_star
op_star
id|skp
suffix:semicolon
id|pfkey_table_grab
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|skp
op_assign
op_amp
id|pfkey_table
suffix:semicolon
op_star
id|skp
suffix:semicolon
id|skp
op_assign
op_amp
(paren
(paren
op_star
id|skp
)paren
op_member_access_from_pointer
id|next
)paren
)paren
(brace
r_if
c_cond
(paren
op_star
id|skp
op_eq
id|sk
)paren
(brace
op_star
id|skp
op_assign
id|sk-&gt;next
suffix:semicolon
id|__sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|pfkey_table_ungrab
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pfkey_create
r_static
r_int
id|pfkey_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|pfkey_opt
op_star
id|pfk
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_RAW
)paren
r_return
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|protocol
op_ne
id|PF_KEY_V2
)paren
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_KEY
comma
id|GFP_KERNEL
comma
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|pfkey_ops
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|sk_set_owner
c_func
(paren
id|sk
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|pfk
op_assign
id|pfkey_sk
c_func
(paren
id|sk
)paren
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|pfk
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pfk
)paren
(brace
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|pfk
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|pfk
)paren
)paren
suffix:semicolon
id|sk-&gt;family
op_assign
id|PF_KEY
suffix:semicolon
id|sk-&gt;destruct
op_assign
id|pfkey_sock_destruct
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|pfkey_socks_nr
)paren
suffix:semicolon
id|pfkey_insert
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|pfkey_release
r_static
r_int
id|pfkey_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_return
l_int|0
suffix:semicolon
id|pfkey_remove
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_broadcast_one
r_static
r_int
id|pfkey_broadcast_one
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sk_buff
op_star
op_star
id|skb2
comma
r_int
id|allocation
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_int
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|skb2
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|skb-&gt;users
)paren
op_ne
l_int|1
)paren
(brace
op_star
id|skb2
op_assign
id|skb_clone
c_func
(paren
id|skb
comma
id|allocation
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|skb2
op_assign
id|skb
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|skb-&gt;users
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_star
id|skb2
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_le
id|sk-&gt;rcvbuf
)paren
(brace
id|skb_orphan
c_func
(paren
op_star
id|skb2
)paren
suffix:semicolon
id|skb_set_owner_r
c_func
(paren
op_star
id|skb2
comma
id|sk
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
op_star
id|skb2
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|data_ready
c_func
(paren
id|sk
comma
(paren
op_star
id|skb2
)paren
op_member_access_from_pointer
id|len
)paren
suffix:semicolon
op_star
id|skb2
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Send SKB to all pfkey sockets matching selected criteria.  */
DECL|macro|BROADCAST_ALL
mdefine_line|#define BROADCAST_ALL&t;&t;0
DECL|macro|BROADCAST_ONE
mdefine_line|#define BROADCAST_ONE&t;&t;1
DECL|macro|BROADCAST_REGISTERED
mdefine_line|#define BROADCAST_REGISTERED&t;2
DECL|macro|BROADCAST_PROMISC_ONLY
mdefine_line|#define BROADCAST_PROMISC_ONLY&t;4
DECL|function|pfkey_broadcast
r_static
r_int
id|pfkey_broadcast
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|allocation
comma
r_int
id|broadcast_flags
comma
r_struct
id|sock
op_star
id|one_sk
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ESRCH
suffix:semicolon
multiline_comment|/* XXX Do we need something like netlink_overrun?  I think&n;&t; * XXX PF_KEY socket apps will not mind current behavior.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pfkey_lock_table
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|pfkey_table
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_struct
id|pfkey_opt
op_star
id|pfk
op_assign
id|pfkey_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|err2
suffix:semicolon
multiline_comment|/* Yes, it means that if you are meant to receive this&n;&t;&t; * pfkey message you receive it twice as promiscuous&n;&t;&t; * socket.&n;&t;&t; */
r_if
c_cond
(paren
id|pfk-&gt;promisc
)paren
id|pfkey_broadcast_one
c_func
(paren
id|skb
comma
op_amp
id|skb2
comma
id|allocation
comma
id|sk
)paren
suffix:semicolon
multiline_comment|/* the exact target will be processed later */
r_if
c_cond
(paren
id|sk
op_eq
id|one_sk
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|broadcast_flags
op_ne
id|BROADCAST_ALL
)paren
(brace
r_if
c_cond
(paren
id|broadcast_flags
op_amp
id|BROADCAST_PROMISC_ONLY
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|broadcast_flags
op_amp
id|BROADCAST_REGISTERED
)paren
op_logical_and
op_logical_neg
id|pfk-&gt;registered
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|broadcast_flags
op_amp
id|BROADCAST_ONE
)paren
r_continue
suffix:semicolon
)brace
id|err2
op_assign
id|pfkey_broadcast_one
c_func
(paren
id|skb
comma
op_amp
id|skb2
comma
id|allocation
comma
id|sk
)paren
suffix:semicolon
multiline_comment|/* Error is cleare after succecful sending to at least one&n;&t;&t; * registered KM */
r_if
c_cond
(paren
(paren
id|broadcast_flags
op_amp
id|BROADCAST_REGISTERED
)paren
op_logical_and
id|err
)paren
id|err
op_assign
id|err2
suffix:semicolon
)brace
id|pfkey_unlock_table
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|one_sk
op_ne
l_int|NULL
)paren
id|err
op_assign
id|pfkey_broadcast_one
c_func
(paren
id|skb
comma
op_amp
id|skb2
comma
id|allocation
comma
id|one_sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb2
)paren
id|kfree_skb
c_func
(paren
id|skb2
)paren
suffix:semicolon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|pfkey_hdr_dup
r_static
r_inline
r_void
id|pfkey_hdr_dup
c_func
(paren
r_struct
id|sadb_msg
op_star
r_new
comma
r_struct
id|sadb_msg
op_star
id|orig
)paren
(brace
op_star
r_new
op_assign
op_star
id|orig
suffix:semicolon
)brace
DECL|function|pfkey_error
r_static
r_int
id|pfkey_error
c_func
(paren
r_struct
id|sadb_msg
op_star
id|orig
comma
r_int
id|err
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
multiline_comment|/* Woe be to the platform trying to support PFKEY yet&n;&t; * having normal errnos outside the 1-255 range, inclusive.&n;&t; */
id|err
op_assign
op_minus
id|err
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
id|ERESTARTSYS
op_logical_or
id|err
op_eq
id|ERESTARTNOHAND
op_logical_or
id|err
op_eq
id|ERESTARTNOINTR
)paren
id|err
op_assign
id|EINTR
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|512
)paren
id|err
op_assign
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|err
op_le
l_int|0
op_logical_or
id|err
op_ge
l_int|256
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|pfkey_hdr_dup
c_func
(paren
id|hdr
comma
id|orig
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_errno
op_assign
(paren
r_uint8
)paren
id|err
suffix:semicolon
id|hdr-&gt;sadb_msg_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|skb
comma
id|GFP_KERNEL
comma
id|BROADCAST_ONE
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sadb_ext_min_len
r_static
id|u8
id|sadb_ext_min_len
(braket
)braket
op_assign
(brace
(braket
id|SADB_EXT_RESERVED
)braket
op_assign
(paren
id|u8
)paren
l_int|0
comma
(braket
id|SADB_EXT_SA
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
comma
(braket
id|SADB_EXT_LIFETIME_CURRENT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
comma
(braket
id|SADB_EXT_LIFETIME_HARD
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
comma
(braket
id|SADB_EXT_LIFETIME_SOFT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
comma
(braket
id|SADB_EXT_ADDRESS_SRC
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
comma
(braket
id|SADB_EXT_ADDRESS_DST
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
comma
(braket
id|SADB_EXT_ADDRESS_PROXY
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
comma
(braket
id|SADB_EXT_KEY_AUTH
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_key
)paren
comma
(braket
id|SADB_EXT_KEY_ENCRYPT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_key
)paren
comma
(braket
id|SADB_EXT_IDENTITY_SRC
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_ident
)paren
comma
(braket
id|SADB_EXT_IDENTITY_DST
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_ident
)paren
comma
(braket
id|SADB_EXT_SENSITIVITY
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_sens
)paren
comma
(braket
id|SADB_EXT_PROPOSAL
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
comma
(braket
id|SADB_EXT_SUPPORTED_AUTH
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_supported
)paren
comma
(braket
id|SADB_EXT_SUPPORTED_ENCRYPT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_supported
)paren
comma
(braket
id|SADB_EXT_SPIRANGE
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_spirange
)paren
comma
(braket
id|SADB_X_EXT_KMPRIVATE
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_kmprivate
)paren
comma
(braket
id|SADB_X_EXT_POLICY
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
comma
(braket
id|SADB_X_EXT_SA2
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_sa2
)paren
comma
(braket
id|SADB_X_EXT_NAT_T_TYPE
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_type
)paren
comma
(braket
id|SADB_X_EXT_NAT_T_SPORT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_port
)paren
comma
(braket
id|SADB_X_EXT_NAT_T_DPORT
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_port
)paren
comma
(braket
id|SADB_X_EXT_NAT_T_OA
)braket
op_assign
(paren
id|u8
)paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* Verify sadb_address_{len,prefixlen} against sa_family.  */
DECL|function|verify_address_len
r_static
r_int
id|verify_address_len
c_func
(paren
r_void
op_star
id|p
)paren
(brace
r_struct
id|sadb_address
op_star
id|sp
op_assign
id|p
suffix:semicolon
r_struct
id|sockaddr
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|sp
op_plus
l_int|1
)paren
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_int
id|len
suffix:semicolon
r_switch
c_cond
(paren
id|addr-&gt;sa_family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|len
op_assign
r_sizeof
(paren
op_star
id|sp
)paren
op_plus
r_sizeof
(paren
op_star
id|sin
)paren
op_plus
(paren
r_sizeof
(paren
r_uint64
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;sadb_address_len
op_ne
id|len
op_logical_or
id|sp-&gt;sadb_address_prefixlen
OG
l_int|32
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|len
op_assign
r_sizeof
(paren
op_star
id|sp
)paren
op_plus
r_sizeof
(paren
op_star
id|sin6
)paren
op_plus
(paren
r_sizeof
(paren
r_uint64
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp-&gt;sadb_address_len
op_ne
id|len
op_logical_or
id|sp-&gt;sadb_address_prefixlen
OG
l_int|128
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
multiline_comment|/* It is user using kernel to keep track of security&n;&t;&t; * associations for another protocol, such as&n;&t;&t; * OSPF/RSVP/RIPV2/MIP.  It is user&squot;s job to verify&n;&t;&t; * lengths.&n;&t;&t; *&n;&t;&t; * XXX Actually, association/policy database is not yet&n;&t;&t; * XXX able to cope with arbitrary sockaddr families.&n;&t;&t; * XXX When it can, remove this -EINVAL.  -DaveM&n;&t;&t; */
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|present_and_same_family
r_static
r_int
id|present_and_same_family
c_func
(paren
r_struct
id|sadb_address
op_star
id|src
comma
r_struct
id|sadb_address
op_star
id|dst
)paren
(brace
r_struct
id|sockaddr
op_star
id|s_addr
comma
op_star
id|d_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src
op_logical_or
op_logical_neg
id|dst
)paren
r_return
l_int|0
suffix:semicolon
id|s_addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|src
op_plus
l_int|1
)paren
suffix:semicolon
id|d_addr
op_assign
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|dst
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s_addr-&gt;sa_family
op_ne
id|d_addr-&gt;sa_family
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s_addr-&gt;sa_family
op_ne
id|AF_INET
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
op_logical_and
id|s_addr-&gt;sa_family
op_ne
id|AF_INET6
macro_line|#endif
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|parse_exthdrs
r_static
r_int
id|parse_exthdrs
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_char
op_star
id|p
op_assign
(paren
r_char
op_star
)paren
id|hdr
suffix:semicolon
r_int
id|len
op_assign
id|skb-&gt;len
suffix:semicolon
id|len
op_sub_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
id|p
op_add_assign
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
r_struct
id|sadb_ext
op_star
id|ehdr
op_assign
(paren
r_struct
id|sadb_ext
op_star
)paren
id|p
suffix:semicolon
r_uint16
id|ext_type
suffix:semicolon
r_int
id|ext_len
suffix:semicolon
id|ext_len
op_assign
id|ehdr-&gt;sadb_ext_len
suffix:semicolon
id|ext_len
op_mul_assign
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|ext_type
op_assign
id|ehdr-&gt;sadb_ext_type
suffix:semicolon
r_if
c_cond
(paren
id|ext_len
template_param
id|len
op_logical_or
id|ext_type
op_eq
id|SADB_EXT_RESERVED
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ext_type
op_le
id|SADB_EXT_MAX
)paren
(brace
r_int
id|min
op_assign
(paren
r_int
)paren
id|sadb_ext_min_len
(braket
id|ext_type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ext_len
OL
id|min
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|ext_type
op_minus
l_int|1
)braket
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|ext_type
op_eq
id|SADB_EXT_ADDRESS_SRC
op_logical_or
id|ext_type
op_eq
id|SADB_EXT_ADDRESS_DST
op_logical_or
id|ext_type
op_eq
id|SADB_EXT_ADDRESS_PROXY
op_logical_or
id|ext_type
op_eq
id|SADB_X_EXT_NAT_T_OA
)paren
(brace
r_if
c_cond
(paren
id|verify_address_len
c_func
(paren
id|p
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ext_hdrs
(braket
id|ext_type
op_minus
l_int|1
)braket
op_assign
id|p
suffix:semicolon
)brace
id|p
op_add_assign
id|ext_len
suffix:semicolon
id|len
op_sub_assign
id|ext_len
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_uint16
DECL|function|pfkey_satype2proto
id|pfkey_satype2proto
c_func
(paren
r_uint8
id|satype
)paren
(brace
r_switch
c_cond
(paren
id|satype
)paren
(brace
r_case
id|SADB_SATYPE_UNSPEC
suffix:colon
r_return
id|IPSEC_PROTO_ANY
suffix:semicolon
r_case
id|SADB_SATYPE_AH
suffix:colon
r_return
id|IPPROTO_AH
suffix:semicolon
r_case
id|SADB_SATYPE_ESP
suffix:colon
r_return
id|IPPROTO_ESP
suffix:semicolon
r_case
id|SADB_X_SATYPE_IPCOMP
suffix:colon
r_return
id|IPPROTO_COMP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* NOTREACHED */
)brace
r_static
r_uint8
DECL|function|pfkey_proto2satype
id|pfkey_proto2satype
c_func
(paren
r_uint16
id|proto
)paren
(brace
r_switch
c_cond
(paren
id|proto
)paren
(brace
r_case
id|IPPROTO_AH
suffix:colon
r_return
id|SADB_SATYPE_AH
suffix:semicolon
r_case
id|IPPROTO_ESP
suffix:colon
r_return
id|SADB_SATYPE_ESP
suffix:semicolon
r_case
id|IPPROTO_COMP
suffix:colon
r_return
id|SADB_X_SATYPE_IPCOMP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* NOTREACHED */
)brace
multiline_comment|/* BTW, this scheme means that there is no way with PFKEY2 sockets to&n; * say specifically &squot;just raw sockets&squot; as we encode them as 255.&n; */
DECL|function|pfkey_proto_to_xfrm
r_static
r_uint8
id|pfkey_proto_to_xfrm
c_func
(paren
r_uint8
id|proto
)paren
(brace
r_return
(paren
id|proto
op_eq
id|IPSEC_PROTO_ANY
ques
c_cond
l_int|0
suffix:colon
id|proto
)paren
suffix:semicolon
)brace
DECL|function|pfkey_proto_from_xfrm
r_static
r_uint8
id|pfkey_proto_from_xfrm
c_func
(paren
r_uint8
id|proto
)paren
(brace
r_return
(paren
id|proto
ques
c_cond
id|proto
suffix:colon
id|IPSEC_PROTO_ANY
)paren
suffix:semicolon
)brace
DECL|function|pfkey_sadb_addr2xfrm_addr
r_static
r_int
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
r_struct
id|sadb_address
op_star
id|addr
comma
id|xfrm_address_t
op_star
id|xaddr
)paren
(brace
r_switch
c_cond
(paren
(paren
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sa_family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|xaddr-&gt;a4
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
suffix:semicolon
r_return
id|AF_INET
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|memcpy
c_func
(paren
id|xaddr-&gt;a6
comma
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_return
id|AF_INET6
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* NOTREACHED */
)brace
DECL|function|pfkey_xfrm_state_lookup
r_static
r_struct
id|xfrm_state
op_star
id|pfkey_xfrm_state_lookup
c_func
(paren
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|sadb_sa
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_address
op_star
id|addr
suffix:semicolon
r_uint16
id|proto
suffix:semicolon
r_int
r_int
id|family
suffix:semicolon
id|xfrm_address_t
op_star
id|xaddr
suffix:semicolon
id|sa
op_assign
(paren
r_struct
id|sadb_sa
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_SA
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sa
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|proto
op_assign
id|pfkey_satype2proto
c_func
(paren
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* sadb_address_len should be checked by caller */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|addr
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|family
op_assign
(paren
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sa_family
suffix:semicolon
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|xaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_addr
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|xaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|xaddr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|xaddr
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|xfrm_state_lookup
c_func
(paren
id|xaddr
comma
id|sa-&gt;sadb_sa_spi
comma
id|proto
comma
id|family
)paren
suffix:semicolon
)brace
DECL|macro|PFKEY_ALIGN8
mdefine_line|#define PFKEY_ALIGN8(a) (1 + (((a) - 1) | (8 - 1)))
r_static
r_int
DECL|function|pfkey_sockaddr_size
id|pfkey_sockaddr_size
c_func
(paren
id|sa_family_t
id|family
)paren
(brace
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_return
id|PFKEY_ALIGN8
c_func
(paren
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
r_return
id|PFKEY_ALIGN8
c_func
(paren
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)paren
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* NOTREACHED */
)brace
DECL|function|pfkey_xfrm_state2msg
r_static
r_struct
id|sk_buff
op_star
id|pfkey_xfrm_state2msg
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|add_keys
comma
r_int
id|hsc
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_struct
id|sadb_sa
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_lifetime
op_star
id|lifetime
suffix:semicolon
r_struct
id|sadb_address
op_star
id|addr
suffix:semicolon
r_struct
id|sadb_key
op_star
id|key
suffix:semicolon
r_struct
id|sadb_x_sa2
op_star
id|sa2
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_int
id|size
suffix:semicolon
r_int
id|auth_key_size
op_assign
l_int|0
suffix:semicolon
r_int
id|encrypt_key_size
op_assign
l_int|0
suffix:semicolon
r_int
id|sockaddr_size
suffix:semicolon
r_struct
id|xfrm_encap_tmpl
op_star
id|natt
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* address family check */
id|sockaddr_size
op_assign
id|pfkey_sockaddr_size
c_func
(paren
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sockaddr_size
)paren
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/* base, SA, (lifetime (HSC),) address(SD), (address(P),)&n;&t;   key(AE), (identity(SD),) (sensitivity)&gt; */
id|size
op_assign
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_plus
(paren
(paren
id|hsc
op_amp
l_int|1
)paren
ques
c_cond
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
suffix:colon
l_int|0
)paren
op_plus
(paren
(paren
id|hsc
op_amp
l_int|2
)paren
ques
c_cond
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
suffix:colon
l_int|0
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_star
l_int|2
op_plus
id|sockaddr_size
op_star
l_int|2
op_plus
r_sizeof
(paren
r_struct
id|sadb_x_sa2
)paren
suffix:semicolon
multiline_comment|/* identity &amp; sensitivity */
r_if
c_cond
(paren
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
op_logical_and
id|x-&gt;sel.saddr.a4
op_ne
id|x-&gt;props.saddr.a4
)paren
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
op_logical_or
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
op_logical_and
id|memcmp
(paren
id|x-&gt;sel.saddr.a6
comma
id|x-&gt;props.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
)paren
macro_line|#endif
)paren
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
suffix:semicolon
r_if
c_cond
(paren
id|add_keys
)paren
(brace
r_if
c_cond
(paren
id|x-&gt;aalg
op_logical_and
id|x-&gt;aalg-&gt;alg_key_len
)paren
(brace
id|auth_key_size
op_assign
id|PFKEY_ALIGN8
c_func
(paren
(paren
id|x-&gt;aalg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|auth_key_size
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x-&gt;ealg
op_logical_and
id|x-&gt;ealg-&gt;alg_key_len
)paren
(brace
id|encrypt_key_size
op_assign
id|PFKEY_ALIGN8
c_func
(paren
(paren
id|x-&gt;ealg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|encrypt_key_size
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|x-&gt;encap
)paren
id|natt
op_assign
id|x-&gt;encap
suffix:semicolon
r_if
c_cond
(paren
id|natt
op_logical_and
id|natt-&gt;encap_type
)paren
(brace
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_type
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_port
)paren
suffix:semicolon
id|size
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_port
)paren
suffix:semicolon
)brace
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOBUFS
)paren
suffix:semicolon
multiline_comment|/* call should fill header later */
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|hdr
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* XXX do we need this ? */
id|hdr-&gt;sadb_msg_len
op_assign
id|size
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
multiline_comment|/* sa */
id|sa
op_assign
(paren
r_struct
id|sadb_sa
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_exttype
op_assign
id|SADB_EXT_SA
suffix:semicolon
id|sa-&gt;sadb_sa_spi
op_assign
id|x-&gt;id.spi
suffix:semicolon
id|sa-&gt;sadb_sa_replay
op_assign
id|x-&gt;props.replay_window
suffix:semicolon
id|sa-&gt;sadb_sa_state
op_assign
id|SADB_SASTATE_DYING
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;km.state
op_eq
id|XFRM_STATE_VALID
op_logical_and
op_logical_neg
id|x-&gt;km.dying
)paren
id|sa-&gt;sadb_sa_state
op_assign
id|SADB_SASTATE_MATURE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x-&gt;km.state
op_eq
id|XFRM_STATE_ACQ
)paren
id|sa-&gt;sadb_sa_state
op_assign
id|SADB_SASTATE_LARVAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x-&gt;km.state
op_eq
id|XFRM_STATE_EXPIRED
)paren
id|sa-&gt;sadb_sa_state
op_assign
id|SADB_SASTATE_DEAD
suffix:semicolon
id|sa-&gt;sadb_sa_auth
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;aalg
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_aalg_get_byname
c_func
(paren
id|x-&gt;aalg-&gt;alg_name
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_auth
op_assign
id|a
ques
c_cond
id|a-&gt;desc.sadb_alg_id
suffix:colon
l_int|0
suffix:semicolon
)brace
id|sa-&gt;sadb_sa_encrypt
op_assign
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
id|x-&gt;ealg
op_logical_and
id|x-&gt;calg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;ealg
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_ealg_get_byname
c_func
(paren
id|x-&gt;ealg-&gt;alg_name
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_encrypt
op_assign
id|a
ques
c_cond
id|a-&gt;desc.sadb_alg_id
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/* KAME compatible: sadb_sa_encrypt is overloaded with calg id */
r_if
c_cond
(paren
id|x-&gt;calg
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_calg_get_byname
c_func
(paren
id|x-&gt;calg-&gt;alg_name
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_encrypt
op_assign
id|a
ques
c_cond
id|a-&gt;desc.sadb_alg_id
suffix:colon
l_int|0
suffix:semicolon
)brace
id|sa-&gt;sadb_sa_flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* hard time */
r_if
c_cond
(paren
id|hsc
op_amp
l_int|2
)paren
(brace
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_HARD
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|_X2KEY
c_func
(paren
id|x-&gt;lft.hard_packet_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|_X2KEY
c_func
(paren
id|x-&gt;lft.hard_byte_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|x-&gt;lft.hard_add_expires_seconds
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|x-&gt;lft.hard_use_expires_seconds
suffix:semicolon
)brace
multiline_comment|/* soft time */
r_if
c_cond
(paren
id|hsc
op_amp
l_int|1
)paren
(brace
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_SOFT
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|_X2KEY
c_func
(paren
id|x-&gt;lft.soft_packet_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|_X2KEY
c_func
(paren
id|x-&gt;lft.soft_byte_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|x-&gt;lft.soft_add_expires_seconds
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|x-&gt;lft.soft_use_expires_seconds
suffix:semicolon
)brace
multiline_comment|/* current time */
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_CURRENT
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|x-&gt;curlft.packets
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|x-&gt;curlft.bytes
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|x-&gt;curlft.add_time
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|x-&gt;curlft.use_time
suffix:semicolon
multiline_comment|/* src address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_SRC
suffix:semicolon
multiline_comment|/* &quot;if the ports are non-zero, then the sadb_address_proto field, &n;&t;   normally zero, MUST be filled in with the transport &n;&t;   protocol&squot;s number.&quot; - RFC2367 */
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;props.saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;props.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* dst address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_DST
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* XXX */
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;id.daddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;sel.saddr.a4
op_ne
id|x-&gt;props.saddr.a4
)paren
(brace
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_PROXY
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
id|pfkey_proto_from_xfrm
c_func
(paren
id|x-&gt;sel.proto
)paren
suffix:semicolon
id|addr-&gt;sadb_address_prefixlen
op_assign
id|x-&gt;sel.prefixlen_s
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;sel.saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|x-&gt;sel.sport
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;id.daddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
(paren
id|x-&gt;sel.saddr.a6
comma
id|x-&gt;props.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
)paren
(brace
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_PROXY
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
id|pfkey_proto_from_xfrm
c_func
(paren
id|x-&gt;sel.proto
)paren
suffix:semicolon
id|addr-&gt;sadb_address_prefixlen
op_assign
id|x-&gt;sel.prefixlen_s
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
id|x-&gt;sel.sport
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;sel.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* auth key */
r_if
c_cond
(paren
id|add_keys
op_logical_and
id|auth_key_size
)paren
(brace
id|key
op_assign
(paren
r_struct
id|sadb_key
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|auth_key_size
)paren
suffix:semicolon
id|key-&gt;sadb_key_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|auth_key_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|key-&gt;sadb_key_exttype
op_assign
id|SADB_EXT_KEY_AUTH
suffix:semicolon
id|key-&gt;sadb_key_bits
op_assign
id|x-&gt;aalg-&gt;alg_key_len
suffix:semicolon
id|key-&gt;sadb_key_reserved
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|key
op_plus
l_int|1
comma
id|x-&gt;aalg-&gt;alg_key
comma
(paren
id|x-&gt;aalg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* encrypt key */
r_if
c_cond
(paren
id|add_keys
op_logical_and
id|encrypt_key_size
)paren
(brace
id|key
op_assign
(paren
r_struct
id|sadb_key
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|encrypt_key_size
)paren
suffix:semicolon
id|key-&gt;sadb_key_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_key
)paren
op_plus
id|encrypt_key_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|key-&gt;sadb_key_exttype
op_assign
id|SADB_EXT_KEY_ENCRYPT
suffix:semicolon
id|key-&gt;sadb_key_bits
op_assign
id|x-&gt;ealg-&gt;alg_key_len
suffix:semicolon
id|key-&gt;sadb_key_reserved
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|key
op_plus
l_int|1
comma
id|x-&gt;ealg-&gt;alg_key
comma
(paren
id|x-&gt;ealg-&gt;alg_key_len
op_plus
l_int|7
)paren
op_div
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* sa */
id|sa2
op_assign
(paren
r_struct
id|sadb_x_sa2
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_x_sa2
)paren
)paren
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_x_sa2
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_exttype
op_assign
id|SADB_X_EXT_SA2
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_mode
op_assign
id|x-&gt;props.mode
op_plus
l_int|1
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_reserved1
op_assign
l_int|0
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_reserved2
op_assign
l_int|0
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_sequence
op_assign
l_int|0
suffix:semicolon
id|sa2-&gt;sadb_x_sa2_reqid
op_assign
id|x-&gt;props.reqid
suffix:semicolon
r_if
c_cond
(paren
id|natt
op_logical_and
id|natt-&gt;encap_type
)paren
(brace
r_struct
id|sadb_x_nat_t_type
op_star
id|n_type
suffix:semicolon
r_struct
id|sadb_x_nat_t_port
op_star
id|n_port
suffix:semicolon
multiline_comment|/* type */
id|n_type
op_assign
(paren
r_struct
id|sadb_x_nat_t_type
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|n_type
)paren
)paren
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_len
op_assign
r_sizeof
(paren
op_star
id|n_type
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_exttype
op_assign
id|SADB_X_EXT_NAT_T_TYPE
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_type
op_assign
id|natt-&gt;encap_type
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_reserved
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_reserved
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|n_type-&gt;sadb_x_nat_t_type_reserved
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* source port */
id|n_port
op_assign
(paren
r_struct
id|sadb_x_nat_t_port
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|n_port
)paren
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_len
op_assign
r_sizeof
(paren
op_star
id|n_port
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_exttype
op_assign
id|SADB_X_EXT_NAT_T_SPORT
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_port
op_assign
id|natt-&gt;encap_sport
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_reserved
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* dest port */
id|n_port
op_assign
(paren
r_struct
id|sadb_x_nat_t_port
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|n_port
)paren
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_len
op_assign
r_sizeof
(paren
op_star
id|n_port
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_exttype
op_assign
id|SADB_X_EXT_NAT_T_DPORT
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_port
op_assign
id|natt-&gt;encap_dport
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_reserved
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
DECL|function|pfkey_msg2xfrm_state
r_static
r_struct
id|xfrm_state
op_star
id|pfkey_msg2xfrm_state
c_func
(paren
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_struct
id|sadb_lifetime
op_star
id|lifetime
suffix:semicolon
r_struct
id|sadb_sa
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_key
op_star
id|key
suffix:semicolon
r_uint16
id|proto
suffix:semicolon
id|sa
op_assign
(paren
r_struct
id|sadb_sa
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_SA
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sa
op_logical_or
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
op_eq
id|SADB_SATYPE_ESP
op_logical_and
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_KEY_ENCRYPT
op_minus
l_int|1
)braket
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
op_eq
id|SADB_SATYPE_AH
op_logical_and
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_KEY_AUTH
op_minus
l_int|1
)braket
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_HARD
op_minus
l_int|1
)braket
op_ne
op_logical_neg
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_SOFT
op_minus
l_int|1
)braket
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|proto
op_assign
id|pfkey_satype2proto
c_func
(paren
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
l_int|0
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/* RFC2367:&n;&n;   Only SADB_SASTATE_MATURE SAs may be submitted in an SADB_ADD message.&n;   SADB_SASTATE_LARVAL SAs are created by SADB_GETSPI and it is not&n;   sensible to add a new SA in the DYING or SADB_SASTATE_DEAD state.&n;   Therefore, the sadb_sa_state field of all submitted SAs MUST be&n;   SADB_SASTATE_MATURE and the kernel MUST return an error if this is&n;   not true.&n;&n;           However, KAME setkey always uses SADB_SASTATE_LARVAL.&n;&t;   Hence, we have to _ignore_ sadb_sa_state, which is also reasonable.&n;&t; */
r_if
c_cond
(paren
id|sa-&gt;sadb_sa_auth
OG
id|SADB_AALG_MAX
op_logical_or
(paren
id|hdr-&gt;sadb_msg_satype
op_eq
id|SADB_X_SATYPE_IPCOMP
op_logical_and
id|sa-&gt;sadb_sa_encrypt
OG
id|SADB_X_CALG_MAX
)paren
op_logical_or
id|sa-&gt;sadb_sa_encrypt
OG
id|SADB_EALG_MAX
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|key
op_assign
(paren
r_struct
id|sadb_key
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_KEY_AUTH
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|key
op_ne
l_int|NULL
op_logical_and
id|sa-&gt;sadb_sa_auth
op_ne
id|SADB_X_AALG_NULL
op_logical_and
(paren
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
op_eq
l_int|0
op_logical_or
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
OG
id|key-&gt;sadb_key_len
op_star
r_sizeof
(paren
r_uint64
)paren
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|key
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_KEY_ENCRYPT
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|key
op_ne
l_int|NULL
op_logical_and
id|sa-&gt;sadb_sa_encrypt
op_ne
id|SADB_EALG_NULL
op_logical_and
(paren
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
op_eq
l_int|0
op_logical_or
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
OG
id|key-&gt;sadb_key_len
op_star
r_sizeof
(paren
r_uint64
)paren
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|x
op_assign
id|xfrm_state_alloc
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOBUFS
)paren
suffix:semicolon
id|x-&gt;id.proto
op_assign
id|proto
suffix:semicolon
id|x-&gt;id.spi
op_assign
id|sa-&gt;sadb_sa_spi
suffix:semicolon
id|x-&gt;props.replay_window
op_assign
id|sa-&gt;sadb_sa_replay
suffix:semicolon
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_HARD
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|lifetime
op_ne
l_int|NULL
)paren
(brace
id|x-&gt;lft.hard_packet_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_allocations
)paren
suffix:semicolon
id|x-&gt;lft.hard_byte_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_bytes
)paren
suffix:semicolon
id|x-&gt;lft.hard_add_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_addtime
suffix:semicolon
id|x-&gt;lft.hard_use_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_usetime
suffix:semicolon
)brace
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_SOFT
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|lifetime
op_ne
l_int|NULL
)paren
(brace
id|x-&gt;lft.soft_packet_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_allocations
)paren
suffix:semicolon
id|x-&gt;lft.soft_byte_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_bytes
)paren
suffix:semicolon
id|x-&gt;lft.soft_add_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_addtime
suffix:semicolon
id|x-&gt;lft.soft_use_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_usetime
suffix:semicolon
)brace
id|key
op_assign
(paren
r_struct
id|sadb_key
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_KEY_AUTH
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sa-&gt;sadb_sa_auth
)paren
(brace
r_int
id|keysize
op_assign
l_int|0
suffix:semicolon
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_aalg_get_byid
c_func
(paren
id|sa-&gt;sadb_sa_auth
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|key
)paren
id|keysize
op_assign
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|x-&gt;aalg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|x-&gt;aalg
)paren
op_plus
id|keysize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;aalg
)paren
r_goto
id|out
suffix:semicolon
id|strcpy
c_func
(paren
id|x-&gt;aalg-&gt;alg_name
comma
id|a-&gt;name
)paren
suffix:semicolon
id|x-&gt;aalg-&gt;alg_key_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|key
)paren
(brace
id|x-&gt;aalg-&gt;alg_key_len
op_assign
id|key-&gt;sadb_key_bits
suffix:semicolon
id|memcpy
c_func
(paren
id|x-&gt;aalg-&gt;alg_key
comma
id|key
op_plus
l_int|1
comma
id|keysize
)paren
suffix:semicolon
)brace
id|x-&gt;props.aalgo
op_assign
id|sa-&gt;sadb_sa_auth
suffix:semicolon
multiline_comment|/* x-&gt;algo.flags = sa-&gt;sadb_sa_flags; */
)brace
r_if
c_cond
(paren
id|sa-&gt;sadb_sa_encrypt
)paren
(brace
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
op_eq
id|SADB_X_SATYPE_IPCOMP
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_calg_get_byid
c_func
(paren
id|sa-&gt;sadb_sa_encrypt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
r_goto
id|out
suffix:semicolon
id|x-&gt;calg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|x-&gt;calg
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;calg
)paren
r_goto
id|out
suffix:semicolon
id|strcpy
c_func
(paren
id|x-&gt;calg-&gt;alg_name
comma
id|a-&gt;name
)paren
suffix:semicolon
id|x-&gt;props.calgo
op_assign
id|sa-&gt;sadb_sa_encrypt
suffix:semicolon
)brace
r_else
(brace
r_int
id|keysize
op_assign
l_int|0
suffix:semicolon
r_struct
id|xfrm_algo_desc
op_star
id|a
op_assign
id|xfrm_ealg_get_byid
c_func
(paren
id|sa-&gt;sadb_sa_encrypt
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
r_goto
id|out
suffix:semicolon
id|key
op_assign
(paren
r_struct
id|sadb_key
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_KEY_ENCRYPT
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|key
)paren
id|keysize
op_assign
(paren
id|key-&gt;sadb_key_bits
op_plus
l_int|7
)paren
op_div
l_int|8
suffix:semicolon
id|x-&gt;ealg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|x-&gt;ealg
)paren
op_plus
id|keysize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;ealg
)paren
r_goto
id|out
suffix:semicolon
id|strcpy
c_func
(paren
id|x-&gt;ealg-&gt;alg_name
comma
id|a-&gt;name
)paren
suffix:semicolon
id|x-&gt;ealg-&gt;alg_key_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|key
)paren
(brace
id|x-&gt;ealg-&gt;alg_key_len
op_assign
id|key-&gt;sadb_key_bits
suffix:semicolon
id|memcpy
c_func
(paren
id|x-&gt;ealg-&gt;alg_key
comma
id|key
op_plus
l_int|1
comma
id|keysize
)paren
suffix:semicolon
)brace
id|x-&gt;props.ealgo
op_assign
id|sa-&gt;sadb_sa_encrypt
suffix:semicolon
)brace
)brace
multiline_comment|/* x-&gt;algo.flags = sa-&gt;sadb_sa_flags; */
id|x-&gt;props.family
op_assign
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
(paren
r_struct
id|sadb_address
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
op_amp
id|x-&gt;props.saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;props.family
)paren
r_goto
id|out
suffix:semicolon
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
(paren
r_struct
id|sadb_address
op_star
)paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
comma
op_amp
id|x-&gt;id.daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|SADB_X_EXT_SA2
op_minus
l_int|1
)braket
)paren
(brace
r_struct
id|sadb_x_sa2
op_star
id|sa2
op_assign
(paren
r_void
op_star
)paren
id|ext_hdrs
(braket
id|SADB_X_EXT_SA2
op_minus
l_int|1
)braket
suffix:semicolon
id|x-&gt;props.mode
op_assign
id|sa2-&gt;sadb_x_sa2_mode
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.mode
)paren
id|x-&gt;props.mode
op_decrement
suffix:semicolon
id|x-&gt;props.reqid
op_assign
id|sa2-&gt;sadb_x_sa2_reqid
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_PROXY
op_minus
l_int|1
)braket
)paren
(brace
r_struct
id|sadb_address
op_star
id|addr
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_PROXY
op_minus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Nobody uses this, but we try. */
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
id|addr
comma
op_amp
id|x-&gt;sel.saddr
)paren
suffix:semicolon
id|x-&gt;sel.prefixlen_s
op_assign
id|addr-&gt;sadb_address_prefixlen
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_TYPE
op_minus
l_int|1
)braket
)paren
(brace
r_struct
id|sadb_x_nat_t_type
op_star
id|n_type
suffix:semicolon
r_struct
id|xfrm_encap_tmpl
op_star
id|natt
suffix:semicolon
id|x-&gt;encap
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|x-&gt;encap
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;encap
)paren
r_goto
id|out
suffix:semicolon
id|natt
op_assign
id|x-&gt;encap
suffix:semicolon
id|n_type
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_TYPE
op_minus
l_int|1
)braket
suffix:semicolon
id|natt-&gt;encap_type
op_assign
id|n_type-&gt;sadb_x_nat_t_type_type
suffix:semicolon
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_SPORT
op_minus
l_int|1
)braket
)paren
(brace
r_struct
id|sadb_x_nat_t_port
op_star
id|n_port
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_SPORT
op_minus
l_int|1
)braket
suffix:semicolon
id|natt-&gt;encap_sport
op_assign
id|n_port-&gt;sadb_x_nat_t_port_port
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_DPORT
op_minus
l_int|1
)braket
)paren
(brace
r_struct
id|sadb_x_nat_t_port
op_star
id|n_port
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_NAT_T_DPORT
op_minus
l_int|1
)braket
suffix:semicolon
id|natt-&gt;encap_dport
op_assign
id|n_port-&gt;sadb_x_nat_t_port_port
suffix:semicolon
)brace
)brace
id|x-&gt;type
op_assign
id|xfrm_get_type
c_func
(paren
id|proto
comma
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;type
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;type
op_member_access_from_pointer
id|init_state
c_func
(paren
id|x
comma
l_int|NULL
)paren
)paren
r_goto
id|out
suffix:semicolon
id|x-&gt;km.seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|x-&gt;km.state
op_assign
id|XFRM_STATE_VALID
suffix:semicolon
r_return
id|x
suffix:semicolon
id|out
suffix:colon
id|x-&gt;km.state
op_assign
id|XFRM_STATE_DEAD
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOBUFS
)paren
suffix:semicolon
)brace
DECL|function|pfkey_reserved
r_static
r_int
id|pfkey_reserved
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
DECL|function|pfkey_getspi
r_static
r_int
id|pfkey_getspi
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|sk_buff
op_star
id|resp_skb
suffix:semicolon
r_struct
id|sadb_x_sa2
op_star
id|sa2
suffix:semicolon
r_struct
id|sadb_address
op_star
id|saddr
comma
op_star
id|daddr
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x
op_assign
l_int|NULL
suffix:semicolon
id|u8
id|mode
suffix:semicolon
id|u16
id|reqid
suffix:semicolon
id|u8
id|proto
suffix:semicolon
r_int
r_int
id|family
suffix:semicolon
id|xfrm_address_t
op_star
id|xsaddr
op_assign
l_int|NULL
comma
op_star
id|xdaddr
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|proto
op_assign
id|pfkey_satype2proto
c_func
(paren
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sa2
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_SA2
op_minus
l_int|1
)braket
)paren
op_ne
l_int|NULL
)paren
(brace
id|mode
op_assign
id|sa2-&gt;sadb_x_sa2_mode
op_minus
l_int|1
suffix:semicolon
id|reqid
op_assign
id|sa2-&gt;sadb_x_sa2_reqid
suffix:semicolon
)brace
r_else
(brace
id|mode
op_assign
l_int|0
suffix:semicolon
id|reqid
op_assign
l_int|0
suffix:semicolon
)brace
id|saddr
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
suffix:semicolon
id|daddr
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
suffix:semicolon
id|family
op_assign
(paren
(paren
r_struct
id|sockaddr
op_star
)paren
(paren
id|saddr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sa_family
suffix:semicolon
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|xdaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|daddr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
suffix:semicolon
id|xsaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|saddr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_addr.s_addr
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|xdaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|daddr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
id|xsaddr
op_assign
(paren
id|xfrm_address_t
op_star
)paren
op_amp
(paren
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|saddr
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin6_addr
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|xdaddr
)paren
id|x
op_assign
id|xfrm_find_acq
c_func
(paren
id|mode
comma
id|reqid
comma
id|proto
comma
id|xdaddr
comma
id|xsaddr
comma
l_int|1
comma
id|family
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|resp_skb
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;km.state
op_ne
id|XFRM_STATE_DEAD
)paren
(brace
r_struct
id|sadb_spirange
op_star
id|range
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_SPIRANGE
op_minus
l_int|1
)braket
suffix:semicolon
id|u32
id|min_spi
comma
id|max_spi
suffix:semicolon
r_if
c_cond
(paren
id|range
op_ne
l_int|NULL
)paren
(brace
id|min_spi
op_assign
id|range-&gt;sadb_spirange_min
suffix:semicolon
id|max_spi
op_assign
id|range-&gt;sadb_spirange_max
suffix:semicolon
)brace
r_else
(brace
id|min_spi
op_assign
id|htonl
c_func
(paren
l_int|0x100
)paren
suffix:semicolon
id|max_spi
op_assign
id|htonl
c_func
(paren
l_int|0x0fffffff
)paren
suffix:semicolon
)brace
id|xfrm_alloc_spi
c_func
(paren
id|x
comma
id|min_spi
comma
id|max_spi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;id.spi
)paren
id|resp_skb
op_assign
id|pfkey_xfrm_state2msg
c_func
(paren
id|x
comma
l_int|0
comma
l_int|3
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|resp_skb
)paren
)paren
(brace
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
id|PTR_ERR
c_func
(paren
id|resp_skb
)paren
suffix:semicolon
)brace
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|resp_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_GETSPI
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|proto
)paren
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|resp_skb
comma
id|GFP_KERNEL
comma
id|BROADCAST_ONE
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_acquire
r_static
r_int
id|pfkey_acquire
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_len
op_ne
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_div
l_int|8
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_seq
op_eq
l_int|0
op_logical_or
id|hdr-&gt;sadb_msg_errno
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|x
op_assign
id|xfrm_find_acq_byseq
c_func
(paren
id|hdr-&gt;sadb_msg_seq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;km.state
op_eq
id|XFRM_STATE_ACQ
)paren
(brace
id|x-&gt;km.state
op_assign
id|XFRM_STATE_ERROR
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|km_waitq
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|x-&gt;lock
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_add
r_static
r_int
id|pfkey_add
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x1
suffix:semicolon
id|xfrm_probe_algs
c_func
(paren
)paren
suffix:semicolon
id|x
op_assign
id|pfkey_msg2xfrm_state
c_func
(paren
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|x
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|x
)paren
suffix:semicolon
multiline_comment|/* XXX there is race condition */
id|x1
op_assign
id|pfkey_xfrm_state_lookup
c_func
(paren
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x1
)paren
(brace
id|x1
op_assign
id|xfrm_find_acq
c_func
(paren
id|x-&gt;props.mode
comma
id|x-&gt;props.reqid
comma
id|x-&gt;id.proto
comma
op_amp
id|x-&gt;id.daddr
comma
op_amp
id|x-&gt;props.saddr
comma
l_int|0
comma
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x1
op_logical_and
id|x1-&gt;id.spi
op_ne
id|x-&gt;id.spi
op_logical_and
id|x1-&gt;id.spi
)paren
(brace
id|xfrm_state_put
c_func
(paren
id|x1
)paren
suffix:semicolon
id|x1
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|x1
op_logical_and
(paren
(paren
id|x1-&gt;id.spi
op_logical_and
id|hdr-&gt;sadb_msg_type
op_eq
id|SADB_ADD
)paren
op_logical_or
(paren
id|hdr-&gt;sadb_msg_type
op_eq
id|SADB_UPDATE
op_logical_and
id|xfrm_state_kern
c_func
(paren
id|x1
)paren
)paren
)paren
)paren
(brace
id|x-&gt;km.state
op_assign
id|XFRM_STATE_DEAD
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x1
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
id|xfrm_state_insert
c_func
(paren
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x1
)paren
(brace
id|xfrm_state_delete
c_func
(paren
id|x1
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x1
)paren
suffix:semicolon
)brace
id|out_skb
op_assign
id|pfkey_xfrm_state2msg
c_func
(paren
id|x
comma
l_int|0
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
multiline_comment|/* XXX Should we return 0 here ? */
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|hdr-&gt;sadb_msg_type
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|x-&gt;id.proto
)paren
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ALL
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_delete
r_static
r_int
id|pfkey_delete
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_SA
op_minus
l_int|1
)braket
op_logical_or
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|x
op_assign
id|pfkey_xfrm_state_lookup
c_func
(paren
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
r_if
c_cond
(paren
id|xfrm_state_kern
c_func
(paren
id|x
)paren
)paren
(brace
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
id|xfrm_state_delete
c_func
(paren
id|x
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_KERNEL
)paren
comma
id|GFP_KERNEL
comma
id|BROADCAST_ALL
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_get
r_static
r_int
id|pfkey_get
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_struct
id|xfrm_state
op_star
id|x
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ext_hdrs
(braket
id|SADB_EXT_SA
op_minus
l_int|1
)braket
op_logical_or
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|x
op_assign
id|pfkey_xfrm_state_lookup
c_func
(paren
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ESRCH
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_state2msg
c_func
(paren
id|x
comma
l_int|1
comma
l_int|3
)paren
suffix:semicolon
id|xfrm_state_put
c_func
(paren
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_DUMP
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|x-&gt;id.proto
)paren
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ONE
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|compose_sadb_supported
r_static
r_struct
id|sk_buff
op_star
id|compose_sadb_supported
c_func
(paren
r_struct
id|sadb_msg
op_star
id|orig
comma
r_int
id|allocation
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_int
id|len
comma
id|auth_len
comma
id|enc_len
comma
id|i
suffix:semicolon
id|auth_len
op_assign
id|xfrm_count_auth_supported
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|auth_len
)paren
(brace
id|auth_len
op_mul_assign
r_sizeof
(paren
r_struct
id|sadb_alg
)paren
suffix:semicolon
id|auth_len
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_supported
)paren
suffix:semicolon
)brace
id|enc_len
op_assign
id|xfrm_count_enc_supported
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enc_len
)paren
(brace
id|enc_len
op_mul_assign
r_sizeof
(paren
r_struct
id|sadb_alg
)paren
suffix:semicolon
id|enc_len
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_supported
)paren
suffix:semicolon
)brace
id|len
op_assign
id|enc_len
op_plus
id|auth_len
op_plus
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
op_plus
l_int|16
comma
id|allocation
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|out_put_algs
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|hdr
)paren
)paren
suffix:semicolon
id|pfkey_hdr_dup
c_func
(paren
id|hdr
comma
id|orig
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;sadb_msg_len
op_assign
id|len
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|auth_len
)paren
(brace
r_struct
id|sadb_supported
op_star
id|sp
suffix:semicolon
r_struct
id|sadb_alg
op_star
id|ap
suffix:semicolon
id|sp
op_assign
(paren
r_struct
id|sadb_supported
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|auth_len
)paren
suffix:semicolon
id|ap
op_assign
(paren
r_struct
id|sadb_alg
op_star
)paren
(paren
id|sp
op_plus
l_int|1
)paren
suffix:semicolon
id|sp-&gt;sadb_supported_len
op_assign
id|auth_len
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|sp-&gt;sadb_supported_exttype
op_assign
id|SADB_EXT_SUPPORTED_AUTH
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|aalg
op_assign
id|xfrm_aalg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aalg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|aalg-&gt;available
)paren
op_star
id|ap
op_increment
op_assign
id|aalg-&gt;desc
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|enc_len
)paren
(brace
r_struct
id|sadb_supported
op_star
id|sp
suffix:semicolon
r_struct
id|sadb_alg
op_star
id|ap
suffix:semicolon
id|sp
op_assign
(paren
r_struct
id|sadb_supported
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|enc_len
)paren
suffix:semicolon
id|ap
op_assign
(paren
r_struct
id|sadb_alg
op_star
)paren
(paren
id|sp
op_plus
l_int|1
)paren
suffix:semicolon
id|sp-&gt;sadb_supported_len
op_assign
id|enc_len
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|sp-&gt;sadb_supported_exttype
op_assign
id|SADB_EXT_SUPPORTED_ENCRYPT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|ealg
op_assign
id|xfrm_ealg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ealg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|ealg-&gt;available
)paren
op_star
id|ap
op_increment
op_assign
id|ealg-&gt;desc
suffix:semicolon
)brace
)brace
id|out_put_algs
suffix:colon
r_return
id|skb
suffix:semicolon
)brace
DECL|function|pfkey_register
r_static
r_int
id|pfkey_register
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|pfkey_opt
op_star
id|pfk
op_assign
id|pfkey_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sk_buff
op_star
id|supp_skb
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
OG
id|SADB_SATYPE_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
op_ne
id|SADB_SATYPE_UNSPEC
)paren
(brace
r_if
c_cond
(paren
id|pfk-&gt;registered
op_amp
(paren
l_int|1
op_lshift
id|hdr-&gt;sadb_msg_satype
)paren
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
id|pfk-&gt;registered
op_or_assign
(paren
l_int|1
op_lshift
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
)brace
id|xfrm_probe_algs
c_func
(paren
)paren
suffix:semicolon
id|supp_skb
op_assign
id|compose_sadb_supported
c_func
(paren
id|hdr
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|supp_skb
)paren
(brace
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_satype
op_ne
id|SADB_SATYPE_UNSPEC
)paren
id|pfk-&gt;registered
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|pfkey_broadcast
c_func
(paren
id|supp_skb
comma
id|GFP_KERNEL
comma
id|BROADCAST_REGISTERED
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_flush
r_static
r_int
id|pfkey_flush
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_int
id|proto
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb_out
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr_out
suffix:semicolon
id|proto
op_assign
id|pfkey_satype2proto
c_func
(paren
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|skb_out
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_out
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|xfrm_state_flush
c_func
(paren
id|proto
)paren
suffix:semicolon
id|hdr_out
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb_out
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|pfkey_hdr_dup
c_func
(paren
id|hdr_out
comma
id|hdr
)paren
suffix:semicolon
id|hdr_out-&gt;sadb_msg_errno
op_assign
(paren
r_uint8
)paren
l_int|0
suffix:semicolon
id|hdr_out-&gt;sadb_msg_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|skb_out
comma
id|GFP_KERNEL
comma
id|BROADCAST_ALL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|pfkey_dump_data
r_struct
id|pfkey_dump_data
(brace
DECL|member|skb
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
DECL|member|hdr
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
DECL|member|sk
r_struct
id|sock
op_star
id|sk
suffix:semicolon
)brace
suffix:semicolon
DECL|function|dump_sa
r_static
r_int
id|dump_sa
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|count
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|pfkey_dump_data
op_star
id|data
op_assign
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_state2msg
c_func
(paren
id|x
comma
l_int|1
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|data-&gt;hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_DUMP
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|x-&gt;id.proto
)paren
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|count
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|data-&gt;hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ONE
comma
id|data-&gt;sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_dump
r_static
r_int
id|pfkey_dump
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
id|u8
id|proto
suffix:semicolon
r_struct
id|pfkey_dump_data
id|data
op_assign
(brace
dot
id|skb
op_assign
id|skb
comma
dot
id|hdr
op_assign
id|hdr
comma
dot
id|sk
op_assign
id|sk
)brace
suffix:semicolon
id|proto
op_assign
id|pfkey_satype2proto
c_func
(paren
id|hdr-&gt;sadb_msg_satype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proto
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|xfrm_state_walk
c_func
(paren
id|proto
comma
id|dump_sa
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|pfkey_promisc
r_static
r_int
id|pfkey_promisc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|pfkey_opt
op_star
id|pfk
op_assign
id|pfkey_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|satype
op_assign
id|hdr-&gt;sadb_msg_satype
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_len
op_eq
(paren
r_sizeof
(paren
op_star
id|hdr
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
)paren
(brace
multiline_comment|/* XXX we mangle packet... */
id|hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|satype
op_ne
l_int|0
op_logical_and
id|satype
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pfk-&gt;promisc
op_assign
id|satype
suffix:semicolon
)brace
id|pfkey_broadcast
c_func
(paren
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_KERNEL
)paren
comma
id|GFP_KERNEL
comma
id|BROADCAST_ALL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_reqid
r_static
r_int
id|check_reqid
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
r_int
id|count
comma
r_void
op_star
id|ptr
)paren
(brace
r_int
id|i
suffix:semicolon
id|u16
id|reqid
op_assign
op_star
(paren
id|u16
op_star
)paren
id|ptr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|xp-&gt;xfrm_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xp-&gt;xfrm_vec
(braket
id|i
)braket
dot
id|reqid
op_eq
id|reqid
)paren
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gen_reqid
r_static
id|u16
id|gen_reqid
c_func
(paren
r_void
)paren
(brace
id|u16
id|start
suffix:semicolon
r_static
id|u16
id|reqid
op_assign
id|IPSEC_MANUAL_REQID_MAX
suffix:semicolon
id|start
op_assign
id|reqid
suffix:semicolon
r_do
(brace
op_increment
id|reqid
suffix:semicolon
r_if
c_cond
(paren
id|reqid
op_eq
l_int|0
)paren
id|reqid
op_assign
id|IPSEC_MANUAL_REQID_MAX
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|xfrm_policy_walk
c_func
(paren
id|check_reqid
comma
(paren
r_void
op_star
)paren
op_amp
id|reqid
)paren
op_ne
op_minus
id|EEXIST
)paren
r_return
id|reqid
suffix:semicolon
)brace
r_while
c_loop
(paren
id|reqid
op_ne
id|start
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|parse_ipsecrequest
id|parse_ipsecrequest
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|sadb_x_ipsecrequest
op_star
id|rq
)paren
(brace
r_struct
id|xfrm_tmpl
op_star
id|t
op_assign
id|xp-&gt;xfrm_vec
op_plus
id|xp-&gt;xfrm_nr
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|xp-&gt;xfrm_nr
op_ge
id|XFRM_MAX_DEPTH
)paren
r_return
op_minus
id|ELOOP
suffix:semicolon
r_if
c_cond
(paren
id|rq-&gt;sadb_x_ipsecrequest_mode
op_eq
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|t-&gt;id.proto
op_assign
id|rq-&gt;sadb_x_ipsecrequest_proto
suffix:semicolon
multiline_comment|/* XXX check proto */
id|t-&gt;mode
op_assign
id|rq-&gt;sadb_x_ipsecrequest_mode
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rq-&gt;sadb_x_ipsecrequest_level
op_eq
id|IPSEC_LEVEL_USE
)paren
id|t-&gt;optional
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rq-&gt;sadb_x_ipsecrequest_level
op_eq
id|IPSEC_LEVEL_UNIQUE
)paren
(brace
id|t-&gt;reqid
op_assign
id|rq-&gt;sadb_x_ipsecrequest_reqid
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;reqid
OG
id|IPSEC_MANUAL_REQID_MAX
)paren
id|t-&gt;reqid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;reqid
op_logical_and
op_logical_neg
(paren
id|t-&gt;reqid
op_assign
id|gen_reqid
c_func
(paren
)paren
)paren
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
multiline_comment|/* addresses present only in tunnel mode */
r_if
c_cond
(paren
id|t-&gt;mode
)paren
(brace
r_switch
c_cond
(paren
id|xp-&gt;family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|sin
op_assign
(paren
r_void
op_star
)paren
(paren
id|rq
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|t-&gt;saddr.a4
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
id|sin
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sin-&gt;sin_family
op_ne
id|AF_INET
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|t-&gt;id.daddr.a4
op_assign
id|sin-&gt;sin_addr.s_addr
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|sin6
op_assign
(paren
r_void
op_star
)paren
(paren
id|rq
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sin6-&gt;sin6_family
op_ne
id|AF_INET6
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
id|t-&gt;saddr.a6
comma
op_amp
id|sin6-&gt;sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sin6-&gt;sin6_family
op_ne
id|AF_INET6
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memcpy
c_func
(paren
id|t-&gt;id.daddr.a6
comma
op_amp
id|sin6-&gt;sin6_addr
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
multiline_comment|/* No way to set this via kame pfkey */
id|t-&gt;aalgos
op_assign
id|t-&gt;ealgos
op_assign
id|t-&gt;calgos
op_assign
op_complement
l_int|0
suffix:semicolon
id|xp-&gt;xfrm_nr
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|parse_ipsecrequests
id|parse_ipsecrequests
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_struct
id|sadb_x_policy
op_star
id|pol
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
id|len
op_assign
id|pol-&gt;sadb_x_policy_len
op_star
l_int|8
op_minus
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
suffix:semicolon
r_struct
id|sadb_x_ipsecrequest
op_star
id|rq
op_assign
(paren
r_void
op_star
)paren
(paren
id|pol
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_ge
r_sizeof
(paren
r_struct
id|sadb_x_ipsecrequest
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|parse_ipsecrequest
c_func
(paren
id|xp
comma
id|rq
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|len
op_sub_assign
id|rq-&gt;sadb_x_ipsecrequest_len
suffix:semicolon
id|rq
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
id|u8
op_star
)paren
id|rq
op_plus
id|rq-&gt;sadb_x_ipsecrequest_len
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_xfrm_policy2msg_size
r_static
r_int
id|pfkey_xfrm_policy2msg_size
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
)paren
(brace
r_int
id|sockaddr_size
op_assign
id|pfkey_sockaddr_size
c_func
(paren
id|xp-&gt;family
)paren
suffix:semicolon
r_int
id|socklen
op_assign
(paren
id|xp-&gt;family
op_eq
id|AF_INET
ques
c_cond
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
suffix:colon
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)paren
suffix:semicolon
r_return
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_star
l_int|3
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_star
l_int|2
)paren
op_plus
(paren
id|sockaddr_size
op_star
l_int|2
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
op_plus
(paren
id|xp-&gt;xfrm_nr
op_star
(paren
r_sizeof
(paren
r_struct
id|sadb_x_ipsecrequest
)paren
op_plus
(paren
id|socklen
op_star
l_int|2
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|pfkey_xfrm_policy2msg_prep
r_static
r_struct
id|sk_buff
op_star
id|pfkey_xfrm_policy2msg_prep
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|size
suffix:semicolon
id|size
op_assign
id|pfkey_xfrm_policy2msg_size
c_func
(paren
id|xp
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOBUFS
)paren
suffix:semicolon
r_return
id|skb
suffix:semicolon
)brace
DECL|function|pfkey_xfrm_policy2msg
r_static
r_void
id|pfkey_xfrm_policy2msg
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
)paren
(brace
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_struct
id|sadb_address
op_star
id|addr
suffix:semicolon
r_struct
id|sadb_lifetime
op_star
id|lifetime
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|sockaddr_size
op_assign
id|pfkey_sockaddr_size
c_func
(paren
id|xp-&gt;family
)paren
suffix:semicolon
r_int
id|socklen
op_assign
(paren
id|xp-&gt;family
op_eq
id|AF_INET
ques
c_cond
r_sizeof
(paren
r_struct
id|sockaddr_in
)paren
suffix:colon
r_sizeof
(paren
r_struct
id|sockaddr_in6
)paren
)paren
suffix:semicolon
id|size
op_assign
id|pfkey_xfrm_policy2msg_size
c_func
(paren
id|xp
)paren
suffix:semicolon
multiline_comment|/* call should fill header later */
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|hdr
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* XXX do we need this ? */
multiline_comment|/* src address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_SRC
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
id|pfkey_proto_from_xfrm
c_func
(paren
id|xp-&gt;selector.proto
)paren
suffix:semicolon
id|addr-&gt;sadb_address_prefixlen
op_assign
id|xp-&gt;selector.prefixlen_s
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* src address */
r_if
c_cond
(paren
id|xp-&gt;family
op_eq
id|AF_INET
)paren
(brace
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|xp-&gt;selector.saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|xp-&gt;selector.sport
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|xp-&gt;family
op_eq
id|AF_INET6
)paren
(brace
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
id|xp-&gt;selector.sport
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|xp-&gt;selector.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* dst address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_DST
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
id|pfkey_proto_from_xfrm
c_func
(paren
id|xp-&gt;selector.proto
)paren
suffix:semicolon
id|addr-&gt;sadb_address_prefixlen
op_assign
id|xp-&gt;selector.prefixlen_d
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|xp-&gt;family
op_eq
id|AF_INET
)paren
(brace
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|xp-&gt;selector.daddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|xp-&gt;selector.dport
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|xp-&gt;family
op_eq
id|AF_INET6
)paren
(brace
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
id|xp-&gt;selector.dport
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|xp-&gt;selector.daddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* hard time */
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_HARD
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|_X2KEY
c_func
(paren
id|xp-&gt;lft.hard_packet_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|_X2KEY
c_func
(paren
id|xp-&gt;lft.hard_byte_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|xp-&gt;lft.hard_add_expires_seconds
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|xp-&gt;lft.hard_use_expires_seconds
suffix:semicolon
multiline_comment|/* soft time */
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_SOFT
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|_X2KEY
c_func
(paren
id|xp-&gt;lft.soft_packet_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|_X2KEY
c_func
(paren
id|xp-&gt;lft.soft_byte_limit
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|xp-&gt;lft.soft_add_expires_seconds
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|xp-&gt;lft.soft_use_expires_seconds
suffix:semicolon
multiline_comment|/* current time */
id|lifetime
op_assign
(paren
r_struct
id|sadb_lifetime
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_lifetime
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_exttype
op_assign
id|SADB_EXT_LIFETIME_CURRENT
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_allocations
op_assign
id|xp-&gt;curlft.packets
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_bytes
op_assign
id|xp-&gt;curlft.bytes
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_addtime
op_assign
id|xp-&gt;curlft.add_time
suffix:semicolon
id|lifetime-&gt;sadb_lifetime_usetime
op_assign
id|xp-&gt;curlft.use_time
suffix:semicolon
id|pol
op_assign
(paren
r_struct
id|sadb_x_policy
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
)paren
suffix:semicolon
id|pol-&gt;sadb_x_policy_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|pol-&gt;sadb_x_policy_exttype
op_assign
id|SADB_X_EXT_POLICY
suffix:semicolon
id|pol-&gt;sadb_x_policy_type
op_assign
id|IPSEC_POLICY_DISCARD
suffix:semicolon
r_if
c_cond
(paren
id|xp-&gt;action
op_eq
id|XFRM_POLICY_ALLOW
)paren
(brace
r_if
c_cond
(paren
id|xp-&gt;xfrm_nr
)paren
id|pol-&gt;sadb_x_policy_type
op_assign
id|IPSEC_POLICY_IPSEC
suffix:semicolon
r_else
id|pol-&gt;sadb_x_policy_type
op_assign
id|IPSEC_POLICY_NONE
suffix:semicolon
)brace
id|pol-&gt;sadb_x_policy_dir
op_assign
id|dir
op_plus
l_int|1
suffix:semicolon
id|pol-&gt;sadb_x_policy_id
op_assign
id|xp-&gt;index
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|xp-&gt;xfrm_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|sadb_x_ipsecrequest
op_star
id|rq
suffix:semicolon
r_struct
id|xfrm_tmpl
op_star
id|t
op_assign
id|xp-&gt;xfrm_vec
op_plus
id|i
suffix:semicolon
r_int
id|req_size
suffix:semicolon
id|req_size
op_assign
r_sizeof
(paren
r_struct
id|sadb_x_ipsecrequest
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;mode
)paren
id|req_size
op_add_assign
l_int|2
op_star
id|socklen
suffix:semicolon
r_else
id|size
op_sub_assign
l_int|2
op_star
id|socklen
suffix:semicolon
id|rq
op_assign
(paren
r_void
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
id|req_size
)paren
suffix:semicolon
id|pol-&gt;sadb_x_policy_len
op_add_assign
id|req_size
op_div
l_int|8
suffix:semicolon
id|rq-&gt;sadb_x_ipsecrequest_len
op_assign
id|req_size
suffix:semicolon
id|rq-&gt;sadb_x_ipsecrequest_proto
op_assign
id|t-&gt;id.proto
suffix:semicolon
id|rq-&gt;sadb_x_ipsecrequest_mode
op_assign
id|t-&gt;mode
op_plus
l_int|1
suffix:semicolon
id|rq-&gt;sadb_x_ipsecrequest_level
op_assign
id|IPSEC_LEVEL_REQUIRE
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;reqid
)paren
id|rq-&gt;sadb_x_ipsecrequest_level
op_assign
id|IPSEC_LEVEL_UNIQUE
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;optional
)paren
id|rq-&gt;sadb_x_ipsecrequest_level
op_assign
id|IPSEC_LEVEL_USE
suffix:semicolon
id|rq-&gt;sadb_x_ipsecrequest_reqid
op_assign
id|t-&gt;reqid
suffix:semicolon
r_if
c_cond
(paren
id|t-&gt;mode
)paren
(brace
r_switch
c_cond
(paren
id|xp-&gt;family
)paren
(brace
r_case
id|AF_INET
suffix:colon
id|sin
op_assign
(paren
r_void
op_star
)paren
(paren
id|rq
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|t-&gt;saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
id|sin
op_increment
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|t-&gt;id.daddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
id|sin6
op_assign
(paren
r_void
op_star
)paren
(paren
id|rq
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|t-&gt;saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
id|sin6
op_increment
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|t-&gt;id.daddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
)brace
id|hdr-&gt;sadb_msg_len
op_assign
id|size
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_reserved
op_assign
id|atomic_read
c_func
(paren
op_amp
id|xp-&gt;refcnt
)paren
suffix:semicolon
)brace
DECL|function|pfkey_spdadd
r_static
r_int
id|pfkey_spdadd
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|sadb_lifetime
op_star
id|lifetime
suffix:semicolon
r_struct
id|sadb_address
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
suffix:semicolon
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
op_logical_or
op_logical_neg
id|ext_hdrs
(braket
id|SADB_X_EXT_POLICY
op_minus
l_int|1
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pol
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_POLICY
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pol-&gt;sadb_x_policy_type
OG
id|IPSEC_POLICY_IPSEC
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pol-&gt;sadb_x_policy_dir
op_logical_or
id|pol-&gt;sadb_x_policy_dir
op_ge
id|IPSEC_DIR_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_alloc
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|xp-&gt;action
op_assign
(paren
id|pol-&gt;sadb_x_policy_type
op_eq
id|IPSEC_POLICY_DISCARD
ques
c_cond
id|XFRM_POLICY_BLOCK
suffix:colon
id|XFRM_POLICY_ALLOW
)paren
suffix:semicolon
id|sa
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|xp-&gt;family
op_assign
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
id|sa
comma
op_amp
id|xp-&gt;selector.saddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|xp-&gt;family
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|xp-&gt;selector.prefixlen_s
op_assign
id|sa-&gt;sadb_address_prefixlen
suffix:semicolon
id|xp-&gt;selector.proto
op_assign
id|pfkey_proto_to_xfrm
c_func
(paren
id|sa-&gt;sadb_address_proto
)paren
suffix:semicolon
id|xp-&gt;selector.sport
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|sa
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_port
suffix:semicolon
r_if
c_cond
(paren
id|xp-&gt;selector.sport
)paren
id|xp-&gt;selector.sport_mask
op_assign
op_complement
l_int|0
suffix:semicolon
id|sa
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
comma
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
id|sa
comma
op_amp
id|xp-&gt;selector.daddr
)paren
suffix:semicolon
id|xp-&gt;selector.prefixlen_d
op_assign
id|sa-&gt;sadb_address_prefixlen
suffix:semicolon
multiline_comment|/* Amusing, we set this twice.  KAME apps appear to set same value&n;&t; * in both addresses.&n;&t; */
id|xp-&gt;selector.proto
op_assign
id|pfkey_proto_to_xfrm
c_func
(paren
id|sa-&gt;sadb_address_proto
)paren
suffix:semicolon
id|xp-&gt;selector.dport
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|sa
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_port
suffix:semicolon
r_if
c_cond
(paren
id|xp-&gt;selector.dport
)paren
id|xp-&gt;selector.dport_mask
op_assign
op_complement
l_int|0
suffix:semicolon
id|xp-&gt;lft.soft_byte_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.hard_byte_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.soft_packet_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.hard_packet_limit
op_assign
id|XFRM_INF
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lifetime
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_HARD
op_minus
l_int|1
)braket
)paren
op_ne
l_int|NULL
)paren
(brace
id|xp-&gt;lft.hard_packet_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_allocations
)paren
suffix:semicolon
id|xp-&gt;lft.hard_byte_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_bytes
)paren
suffix:semicolon
id|xp-&gt;lft.hard_add_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_addtime
suffix:semicolon
id|xp-&gt;lft.hard_use_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_usetime
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|lifetime
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_LIFETIME_SOFT
op_minus
l_int|1
)braket
)paren
op_ne
l_int|NULL
)paren
(brace
id|xp-&gt;lft.soft_packet_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_allocations
)paren
suffix:semicolon
id|xp-&gt;lft.soft_byte_limit
op_assign
id|_KEY2X
c_func
(paren
id|lifetime-&gt;sadb_lifetime_bytes
)paren
suffix:semicolon
id|xp-&gt;lft.soft_add_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_addtime
suffix:semicolon
id|xp-&gt;lft.soft_use_expires_seconds
op_assign
id|lifetime-&gt;sadb_lifetime_usetime
suffix:semicolon
)brace
id|xp-&gt;xfrm_nr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pol-&gt;sadb_x_policy_type
op_eq
id|IPSEC_POLICY_IPSEC
op_logical_and
(paren
id|err
op_assign
id|parse_ipsecrequests
c_func
(paren
id|xp
comma
id|pol
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_policy2msg_prep
c_func
(paren
id|xp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|xfrm_policy_insert
c_func
(paren
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
comma
id|xp
comma
id|hdr-&gt;sadb_msg_type
op_ne
id|SADB_X_SPDUPDATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree_skb
c_func
(paren
id|out_skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pfkey_xfrm_policy2msg
c_func
(paren
id|out_skb
comma
id|xp
comma
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
)paren
suffix:semicolon
id|xfrm_pol_put
c_func
(paren
id|xp
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|hdr-&gt;sadb_msg_type
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ALL
comma
id|sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|xp
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|pfkey_spddelete
r_static
r_int
id|pfkey_spddelete
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|sadb_address
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
suffix:semicolon
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_struct
id|xfrm_selector
id|sel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|present_and_same_family
c_func
(paren
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
)paren
op_logical_or
op_logical_neg
id|ext_hdrs
(braket
id|SADB_X_EXT_POLICY
op_minus
l_int|1
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pol
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_POLICY
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pol-&gt;sadb_x_policy_dir
op_logical_or
id|pol-&gt;sadb_x_policy_dir
op_ge
id|IPSEC_DIR_MAX
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sel
comma
l_int|0
comma
r_sizeof
(paren
id|sel
)paren
)paren
suffix:semicolon
id|sa
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_SRC
op_minus
l_int|1
)braket
comma
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
id|sa
comma
op_amp
id|sel.saddr
)paren
suffix:semicolon
id|sel.prefixlen_s
op_assign
id|sa-&gt;sadb_address_prefixlen
suffix:semicolon
id|sel.proto
op_assign
id|pfkey_proto_to_xfrm
c_func
(paren
id|sa-&gt;sadb_address_proto
)paren
suffix:semicolon
id|sel.sport
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|sa
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_port
suffix:semicolon
r_if
c_cond
(paren
id|sel.sport
)paren
id|sel.sport_mask
op_assign
op_complement
l_int|0
suffix:semicolon
id|sa
op_assign
id|ext_hdrs
(braket
id|SADB_EXT_ADDRESS_DST
op_minus
l_int|1
)braket
comma
id|pfkey_sadb_addr2xfrm_addr
c_func
(paren
id|sa
comma
op_amp
id|sel.daddr
)paren
suffix:semicolon
id|sel.prefixlen_d
op_assign
id|sa-&gt;sadb_address_prefixlen
suffix:semicolon
id|sel.proto
op_assign
id|pfkey_proto_to_xfrm
c_func
(paren
id|sa-&gt;sadb_address_proto
)paren
suffix:semicolon
id|sel.dport
op_assign
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|sa
op_plus
l_int|1
)paren
)paren
op_member_access_from_pointer
id|sin_port
suffix:semicolon
r_if
c_cond
(paren
id|sel.dport
)paren
id|sel.dport_mask
op_assign
op_complement
l_int|0
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_delete
c_func
(paren
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
comma
op_amp
id|sel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_policy2msg_prep
c_func
(paren
id|xp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pfkey_xfrm_policy2msg
c_func
(paren
id|out_skb
comma
id|xp
comma
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_X_SPDDELETE
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ALL
comma
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|xp
)paren
(brace
id|xfrm_policy_kill
c_func
(paren
id|xp
)paren
suffix:semicolon
id|xfrm_pol_put
c_func
(paren
id|xp
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|pfkey_spdget
r_static
r_int
id|pfkey_spdget
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
suffix:semicolon
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pol
op_assign
id|ext_hdrs
(braket
id|SADB_X_EXT_POLICY
op_minus
l_int|1
)braket
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_byid
c_func
(paren
l_int|0
comma
id|pol-&gt;sadb_x_policy_id
comma
id|hdr-&gt;sadb_msg_type
op_eq
id|SADB_X_SPDDELETE2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_policy2msg_prep
c_func
(paren
id|xp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
(brace
id|err
op_assign
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|pfkey_xfrm_policy2msg
c_func
(paren
id|out_skb
comma
id|xp
comma
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|hdr-&gt;sadb_msg_type
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|hdr-&gt;sadb_msg_seq
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ALL
comma
id|sk
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|xp
)paren
(brace
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_type
op_eq
id|SADB_X_SPDDELETE2
)paren
id|xfrm_policy_kill
c_func
(paren
id|xp
)paren
suffix:semicolon
id|xfrm_pol_put
c_func
(paren
id|xp
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|dump_sp
r_static
r_int
id|dump_sp
c_func
(paren
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
comma
r_int
id|count
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|pfkey_dump_data
op_star
id|data
op_assign
id|ptr
suffix:semicolon
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_policy2msg_prep
c_func
(paren
id|xp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
id|pfkey_xfrm_policy2msg
c_func
(paren
id|out_skb
comma
id|xp
comma
id|dir
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|data-&gt;hdr-&gt;sadb_msg_version
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_X_SPDDUMP
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|SADB_SATYPE_UNSPEC
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
id|count
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
id|data-&gt;hdr-&gt;sadb_msg_pid
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_ONE
comma
id|data-&gt;sk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pfkey_spddump
r_static
r_int
id|pfkey_spddump
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|pfkey_dump_data
id|data
op_assign
(brace
dot
id|skb
op_assign
id|skb
comma
dot
id|hdr
op_assign
id|hdr
comma
dot
id|sk
op_assign
id|sk
)brace
suffix:semicolon
r_return
id|xfrm_policy_walk
c_func
(paren
id|dump_sp
comma
op_amp
id|data
)paren
suffix:semicolon
)brace
DECL|function|pfkey_spdflush
r_static
r_int
id|pfkey_spdflush
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb_out
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr_out
suffix:semicolon
id|skb_out
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb_out
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
id|xfrm_policy_flush
c_func
(paren
)paren
suffix:semicolon
id|hdr_out
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb_out
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|pfkey_hdr_dup
c_func
(paren
id|hdr_out
comma
id|hdr
)paren
suffix:semicolon
id|hdr_out-&gt;sadb_msg_errno
op_assign
(paren
r_uint8
)paren
l_int|0
suffix:semicolon
id|hdr_out-&gt;sadb_msg_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|skb_out
comma
id|GFP_KERNEL
comma
id|BROADCAST_ALL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|typedef|pfkey_handler
r_typedef
r_int
(paren
op_star
id|pfkey_handler
)paren
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
comma
r_void
op_star
op_star
id|ext_hdrs
)paren
suffix:semicolon
DECL|variable|pfkey_funcs
r_static
id|pfkey_handler
id|pfkey_funcs
(braket
id|SADB_MAX
op_plus
l_int|1
)braket
op_assign
(brace
(braket
id|SADB_RESERVED
)braket
op_assign
id|pfkey_reserved
comma
(braket
id|SADB_GETSPI
)braket
op_assign
id|pfkey_getspi
comma
(braket
id|SADB_UPDATE
)braket
op_assign
id|pfkey_add
comma
(braket
id|SADB_ADD
)braket
op_assign
id|pfkey_add
comma
(braket
id|SADB_DELETE
)braket
op_assign
id|pfkey_delete
comma
(braket
id|SADB_GET
)braket
op_assign
id|pfkey_get
comma
(braket
id|SADB_ACQUIRE
)braket
op_assign
id|pfkey_acquire
comma
(braket
id|SADB_REGISTER
)braket
op_assign
id|pfkey_register
comma
(braket
id|SADB_EXPIRE
)braket
op_assign
l_int|NULL
comma
(braket
id|SADB_FLUSH
)braket
op_assign
id|pfkey_flush
comma
(braket
id|SADB_DUMP
)braket
op_assign
id|pfkey_dump
comma
(braket
id|SADB_X_PROMISC
)braket
op_assign
id|pfkey_promisc
comma
(braket
id|SADB_X_PCHANGE
)braket
op_assign
l_int|NULL
comma
(braket
id|SADB_X_SPDUPDATE
)braket
op_assign
id|pfkey_spdadd
comma
(braket
id|SADB_X_SPDADD
)braket
op_assign
id|pfkey_spdadd
comma
(braket
id|SADB_X_SPDDELETE
)braket
op_assign
id|pfkey_spddelete
comma
(braket
id|SADB_X_SPDGET
)braket
op_assign
id|pfkey_spdget
comma
(braket
id|SADB_X_SPDACQUIRE
)braket
op_assign
l_int|NULL
comma
(braket
id|SADB_X_SPDDUMP
)braket
op_assign
id|pfkey_spddump
comma
(braket
id|SADB_X_SPDFLUSH
)braket
op_assign
id|pfkey_spdflush
comma
(braket
id|SADB_X_SPDSETIDX
)braket
op_assign
id|pfkey_spdadd
comma
(braket
id|SADB_X_SPDDELETE2
)braket
op_assign
id|pfkey_spdget
comma
)brace
suffix:semicolon
DECL|function|pfkey_process
r_static
r_int
id|pfkey_process
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sadb_msg
op_star
id|hdr
)paren
(brace
r_void
op_star
id|ext_hdrs
(braket
id|SADB_EXT_MAX
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|skb_clone
c_func
(paren
id|skb
comma
id|GFP_KERNEL
)paren
comma
id|GFP_KERNEL
comma
id|BROADCAST_PROMISC_ONLY
comma
l_int|NULL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|ext_hdrs
comma
l_int|0
comma
r_sizeof
(paren
id|ext_hdrs
)paren
)paren
suffix:semicolon
id|err
op_assign
id|parse_exthdrs
c_func
(paren
id|skb
comma
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|pfkey_funcs
(braket
id|hdr-&gt;sadb_msg_type
)braket
)paren
id|err
op_assign
id|pfkey_funcs
(braket
id|hdr-&gt;sadb_msg_type
)braket
(paren
id|sk
comma
id|skb
comma
id|hdr
comma
id|ext_hdrs
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|pfkey_get_base_msg
r_static
r_struct
id|sadb_msg
op_star
id|pfkey_get_base_msg
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
op_star
id|errp
)paren
(brace
r_struct
id|sadb_msg
op_star
id|hdr
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OL
r_sizeof
(paren
op_star
id|hdr
)paren
)paren
(brace
op_star
id|errp
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
)brace
r_else
(brace
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_version
op_ne
id|PF_KEY_V2
op_logical_or
id|hdr-&gt;sadb_msg_reserved
op_ne
l_int|0
op_logical_or
(paren
id|hdr-&gt;sadb_msg_type
op_le
id|SADB_RESERVED
op_logical_or
id|hdr-&gt;sadb_msg_type
OG
id|SADB_MAX
)paren
)paren
(brace
id|hdr
op_assign
l_int|NULL
suffix:semicolon
op_star
id|errp
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|hdr-&gt;sadb_msg_len
op_ne
(paren
id|skb-&gt;len
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
op_logical_or
id|hdr-&gt;sadb_msg_len
OL
(paren
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
)paren
)paren
(brace
id|hdr
op_assign
l_int|NULL
suffix:semicolon
op_star
id|errp
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
)brace
r_else
(brace
op_star
id|errp
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|hdr
suffix:semicolon
)brace
DECL|function|aalg_tmpl_set
r_static
r_inline
r_int
id|aalg_tmpl_set
c_func
(paren
r_struct
id|xfrm_tmpl
op_star
id|t
comma
r_struct
id|xfrm_algo_desc
op_star
id|d
)paren
(brace
r_return
id|t-&gt;aalgos
op_amp
(paren
l_int|1
op_lshift
id|d-&gt;desc.sadb_alg_id
)paren
suffix:semicolon
)brace
DECL|function|ealg_tmpl_set
r_static
r_inline
r_int
id|ealg_tmpl_set
c_func
(paren
r_struct
id|xfrm_tmpl
op_star
id|t
comma
r_struct
id|xfrm_algo_desc
op_star
id|d
)paren
(brace
r_return
id|t-&gt;ealgos
op_amp
(paren
l_int|1
op_lshift
id|d-&gt;desc.sadb_alg_id
)paren
suffix:semicolon
)brace
DECL|function|count_ah_combs
r_static
r_int
id|count_ah_combs
c_func
(paren
r_struct
id|xfrm_tmpl
op_star
id|t
)paren
(brace
r_int
id|i
comma
id|sz
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|aalg
op_assign
id|xfrm_aalg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aalg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|aalg_tmpl_set
c_func
(paren
id|t
comma
id|aalg
)paren
op_logical_and
id|aalg-&gt;available
)paren
id|sz
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
suffix:semicolon
)brace
r_return
id|sz
op_plus
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
suffix:semicolon
)brace
DECL|function|count_esp_combs
r_static
r_int
id|count_esp_combs
c_func
(paren
r_struct
id|xfrm_tmpl
op_star
id|t
)paren
(brace
r_int
id|i
comma
id|k
comma
id|sz
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|ealg
op_assign
id|xfrm_ealg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ealg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ealg_tmpl_set
c_func
(paren
id|t
comma
id|ealg
)paren
op_logical_and
id|ealg-&gt;available
)paren
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|1
suffix:semicolon
suffix:semicolon
id|k
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|aalg
op_assign
id|xfrm_aalg_get_byidx
c_func
(paren
id|k
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aalg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|aalg_tmpl_set
c_func
(paren
id|t
comma
id|aalg
)paren
op_logical_and
id|aalg-&gt;available
)paren
id|sz
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
suffix:semicolon
)brace
)brace
r_return
id|sz
op_plus
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
suffix:semicolon
)brace
DECL|function|dump_ah_combs
r_static
r_void
id|dump_ah_combs
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_tmpl
op_star
id|t
)paren
(brace
r_struct
id|sadb_prop
op_star
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|sadb_prop
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
)paren
suffix:semicolon
id|p-&gt;sadb_prop_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
op_div
l_int|8
suffix:semicolon
id|p-&gt;sadb_prop_exttype
op_assign
id|SADB_EXT_PROPOSAL
suffix:semicolon
id|p-&gt;sadb_prop_replay
op_assign
l_int|32
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|aalg
op_assign
id|xfrm_aalg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aalg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|aalg_tmpl_set
c_func
(paren
id|t
comma
id|aalg
)paren
op_logical_and
id|aalg-&gt;available
)paren
(brace
r_struct
id|sadb_comb
op_star
id|c
suffix:semicolon
id|c
op_assign
(paren
r_struct
id|sadb_comb
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
id|p-&gt;sadb_prop_len
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
op_div
l_int|8
suffix:semicolon
id|c-&gt;sadb_comb_auth
op_assign
id|aalg-&gt;desc.sadb_alg_id
suffix:semicolon
id|c-&gt;sadb_comb_auth_minbits
op_assign
id|aalg-&gt;desc.sadb_alg_minbits
suffix:semicolon
id|c-&gt;sadb_comb_auth_maxbits
op_assign
id|aalg-&gt;desc.sadb_alg_maxbits
suffix:semicolon
id|c-&gt;sadb_comb_hard_addtime
op_assign
l_int|24
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_soft_addtime
op_assign
l_int|20
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_hard_usetime
op_assign
l_int|8
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_soft_usetime
op_assign
l_int|7
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
)brace
)brace
)brace
DECL|function|dump_esp_combs
r_static
r_void
id|dump_esp_combs
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|xfrm_tmpl
op_star
id|t
)paren
(brace
r_struct
id|sadb_prop
op_star
id|p
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
id|p
op_assign
(paren
r_struct
id|sadb_prop
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
)paren
suffix:semicolon
id|p-&gt;sadb_prop_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_prop
)paren
op_div
l_int|8
suffix:semicolon
id|p-&gt;sadb_prop_exttype
op_assign
id|SADB_EXT_PROPOSAL
suffix:semicolon
id|p-&gt;sadb_prop_replay
op_assign
l_int|32
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|xfrm_algo_desc
op_star
id|ealg
op_assign
id|xfrm_ealg_get_byidx
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ealg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ealg_tmpl_set
c_func
(paren
id|t
comma
id|ealg
)paren
op_logical_and
id|ealg-&gt;available
)paren
)paren
r_continue
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|1
suffix:semicolon
suffix:semicolon
id|k
op_increment
)paren
(brace
r_struct
id|sadb_comb
op_star
id|c
suffix:semicolon
r_struct
id|xfrm_algo_desc
op_star
id|aalg
op_assign
id|xfrm_aalg_get_byidx
c_func
(paren
id|k
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|aalg
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|aalg_tmpl_set
c_func
(paren
id|t
comma
id|aalg
)paren
op_logical_and
id|aalg-&gt;available
)paren
)paren
r_continue
suffix:semicolon
id|c
op_assign
(paren
r_struct
id|sadb_comb
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
id|p-&gt;sadb_prop_len
op_add_assign
r_sizeof
(paren
r_struct
id|sadb_comb
)paren
op_div
l_int|8
suffix:semicolon
id|c-&gt;sadb_comb_auth
op_assign
id|aalg-&gt;desc.sadb_alg_id
suffix:semicolon
id|c-&gt;sadb_comb_auth_minbits
op_assign
id|aalg-&gt;desc.sadb_alg_minbits
suffix:semicolon
id|c-&gt;sadb_comb_auth_maxbits
op_assign
id|aalg-&gt;desc.sadb_alg_maxbits
suffix:semicolon
id|c-&gt;sadb_comb_encrypt
op_assign
id|ealg-&gt;desc.sadb_alg_id
suffix:semicolon
id|c-&gt;sadb_comb_encrypt_minbits
op_assign
id|ealg-&gt;desc.sadb_alg_minbits
suffix:semicolon
id|c-&gt;sadb_comb_encrypt_maxbits
op_assign
id|ealg-&gt;desc.sadb_alg_maxbits
suffix:semicolon
id|c-&gt;sadb_comb_hard_addtime
op_assign
l_int|24
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_soft_addtime
op_assign
l_int|20
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_hard_usetime
op_assign
l_int|8
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
id|c-&gt;sadb_comb_soft_usetime
op_assign
l_int|7
op_star
l_int|60
op_star
l_int|60
suffix:semicolon
)brace
)brace
)brace
DECL|function|pfkey_send_notify
r_static
r_int
id|pfkey_send_notify
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_int
id|hard
)paren
(brace
r_struct
id|sk_buff
op_star
id|out_skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|out_hdr
suffix:semicolon
r_int
id|hsc
op_assign
(paren
id|hard
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|out_skb
op_assign
id|pfkey_xfrm_state2msg
c_func
(paren
id|x
comma
l_int|0
comma
id|hsc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|out_skb
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|out_skb
)paren
suffix:semicolon
id|out_hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|out_skb-&gt;data
suffix:semicolon
id|out_hdr-&gt;sadb_msg_version
op_assign
id|PF_KEY_V2
suffix:semicolon
id|out_hdr-&gt;sadb_msg_type
op_assign
id|SADB_EXPIRE
suffix:semicolon
id|out_hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|x-&gt;id.proto
)paren
suffix:semicolon
id|out_hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_seq
op_assign
l_int|0
suffix:semicolon
id|out_hdr-&gt;sadb_msg_pid
op_assign
l_int|0
suffix:semicolon
id|pfkey_broadcast
c_func
(paren
id|out_skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_REGISTERED
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_acqseq
r_static
id|u32
id|get_acqseq
c_func
(paren
r_void
)paren
(brace
id|u32
id|res
suffix:semicolon
r_static
id|u32
id|acqseq
suffix:semicolon
r_static
id|spinlock_t
id|acqseq_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|acqseq_lock
)paren
suffix:semicolon
id|res
op_assign
(paren
op_increment
id|acqseq
ques
c_cond
suffix:colon
op_increment
id|acqseq
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|acqseq_lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|pfkey_send_acquire
r_static
r_int
id|pfkey_send_acquire
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
r_struct
id|xfrm_tmpl
op_star
id|t
comma
r_struct
id|xfrm_policy
op_star
id|xp
comma
r_int
id|dir
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_struct
id|sadb_address
op_star
id|addr
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_int
id|sockaddr_size
suffix:semicolon
r_int
id|size
suffix:semicolon
id|sockaddr_size
op_assign
id|pfkey_sockaddr_size
c_func
(paren
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sockaddr_size
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_star
l_int|2
)paren
op_plus
(paren
id|sockaddr_size
op_star
l_int|2
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;id.proto
op_eq
id|IPPROTO_AH
)paren
id|size
op_add_assign
id|count_ah_combs
c_func
(paren
id|t
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x-&gt;id.proto
op_eq
id|IPPROTO_ESP
)paren
id|size
op_add_assign
id|count_esp_combs
c_func
(paren
id|t
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_version
op_assign
id|PF_KEY_V2
suffix:semicolon
id|hdr-&gt;sadb_msg_type
op_assign
id|SADB_ACQUIRE
suffix:semicolon
id|hdr-&gt;sadb_msg_satype
op_assign
id|pfkey_proto2satype
c_func
(paren
id|x-&gt;id.proto
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_len
op_assign
id|size
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;sadb_msg_seq
op_assign
id|x-&gt;km.seq
op_assign
id|get_acqseq
c_func
(paren
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_pid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* src address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_SRC
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;props.saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;props.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* dst address */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_DST
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;id.daddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;id.daddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|pol
op_assign
(paren
r_struct
id|sadb_x_policy
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
)paren
suffix:semicolon
id|pol-&gt;sadb_x_policy_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_x_policy
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|pol-&gt;sadb_x_policy_exttype
op_assign
id|SADB_X_EXT_POLICY
suffix:semicolon
id|pol-&gt;sadb_x_policy_type
op_assign
id|IPSEC_POLICY_IPSEC
suffix:semicolon
id|pol-&gt;sadb_x_policy_dir
op_assign
id|dir
op_plus
l_int|1
suffix:semicolon
id|pol-&gt;sadb_x_policy_id
op_assign
id|xp-&gt;index
suffix:semicolon
multiline_comment|/* Set sadb_comb&squot;s. */
r_if
c_cond
(paren
id|x-&gt;id.proto
op_eq
id|IPPROTO_AH
)paren
id|dump_ah_combs
c_func
(paren
id|skb
comma
id|t
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|x-&gt;id.proto
op_eq
id|IPPROTO_ESP
)paren
id|dump_esp_combs
c_func
(paren
id|skb
comma
id|t
)paren
suffix:semicolon
r_return
id|pfkey_broadcast
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_REGISTERED
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|pfkey_compile_policy
r_static
r_struct
id|xfrm_policy
op_star
id|pfkey_compile_policy
c_func
(paren
id|u16
id|family
comma
r_int
id|opt
comma
id|u8
op_star
id|data
comma
r_int
id|len
comma
r_int
op_star
id|dir
)paren
(brace
r_struct
id|xfrm_policy
op_star
id|xp
suffix:semicolon
r_struct
id|sadb_x_policy
op_star
id|pol
op_assign
(paren
r_struct
id|sadb_x_policy
op_star
)paren
id|data
suffix:semicolon
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|AF_INET
suffix:colon
r_if
c_cond
(paren
id|opt
op_ne
id|IP_IPSEC_POLICY
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_case
id|AF_INET6
suffix:colon
r_if
c_cond
(paren
id|opt
op_ne
id|IPV6_IPSEC_POLICY
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
op_star
id|dir
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
op_star
id|dir
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|len
template_param
id|len
op_logical_or
id|pol-&gt;sadb_x_policy_type
OG
id|IPSEC_POLICY_BYPASS
op_logical_or
(paren
op_logical_neg
id|pol-&gt;sadb_x_policy_dir
op_logical_or
id|pol-&gt;sadb_x_policy_dir
OG
id|IPSEC_DIR_OUTBOUND
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|xp
op_assign
id|xfrm_policy_alloc
c_func
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xp
op_eq
l_int|NULL
)paren
(brace
op_star
id|dir
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|xp-&gt;action
op_assign
(paren
id|pol-&gt;sadb_x_policy_type
op_eq
id|IPSEC_POLICY_DISCARD
ques
c_cond
id|XFRM_POLICY_BLOCK
suffix:colon
id|XFRM_POLICY_ALLOW
)paren
suffix:semicolon
id|xp-&gt;lft.soft_byte_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.hard_byte_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.soft_packet_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;lft.hard_packet_limit
op_assign
id|XFRM_INF
suffix:semicolon
id|xp-&gt;family
op_assign
id|family
suffix:semicolon
id|xp-&gt;xfrm_nr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pol-&gt;sadb_x_policy_type
op_eq
id|IPSEC_POLICY_IPSEC
op_logical_and
(paren
op_star
id|dir
op_assign
id|parse_ipsecrequests
c_func
(paren
id|xp
comma
id|pol
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
op_star
id|dir
op_assign
id|pol-&gt;sadb_x_policy_dir
op_minus
l_int|1
suffix:semicolon
r_return
id|xp
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|xp
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|pfkey_send_new_mapping
r_static
r_int
id|pfkey_send_new_mapping
c_func
(paren
r_struct
id|xfrm_state
op_star
id|x
comma
id|xfrm_address_t
op_star
id|ipaddr
comma
id|u16
id|sport
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
suffix:semicolon
r_struct
id|sadb_sa
op_star
id|sa
suffix:semicolon
r_struct
id|sadb_address
op_star
id|addr
suffix:semicolon
r_struct
id|sadb_x_nat_t_port
op_star
id|n_port
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
suffix:semicolon
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_struct
id|sockaddr_in6
op_star
id|sin6
suffix:semicolon
macro_line|#endif
r_int
id|sockaddr_size
suffix:semicolon
r_int
id|size
suffix:semicolon
id|__u8
id|satype
op_assign
(paren
id|x-&gt;id.proto
op_eq
id|IPPROTO_ESP
ques
c_cond
id|SADB_SATYPE_ESP
suffix:colon
l_int|0
)paren
suffix:semicolon
r_struct
id|xfrm_encap_tmpl
op_star
id|natt
op_assign
l_int|NULL
suffix:semicolon
id|sockaddr_size
op_assign
id|pfkey_sockaddr_size
c_func
(paren
id|x-&gt;props.family
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sockaddr_size
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|satype
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|x-&gt;encap
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|natt
op_assign
id|x-&gt;encap
suffix:semicolon
multiline_comment|/* Build an SADB_X_NAT_T_NEW_MAPPING message:&n;&t; *&n;&t; * HDR | SA | ADDRESS_SRC (old addr) | NAT_T_SPORT (old port) |&n;&t; * ADDRESS_DST (new addr) | NAT_T_DPORT (new port)&n;&t; */
id|size
op_assign
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
op_plus
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_star
l_int|2
)paren
op_plus
(paren
id|sockaddr_size
op_star
l_int|2
)paren
op_plus
(paren
r_sizeof
(paren
r_struct
id|sadb_x_nat_t_port
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|size
op_plus
l_int|16
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|hdr
op_assign
(paren
r_struct
id|sadb_msg
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_msg
)paren
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_version
op_assign
id|PF_KEY_V2
suffix:semicolon
id|hdr-&gt;sadb_msg_type
op_assign
id|SADB_X_NAT_T_NEW_MAPPING
suffix:semicolon
id|hdr-&gt;sadb_msg_satype
op_assign
id|satype
suffix:semicolon
id|hdr-&gt;sadb_msg_len
op_assign
id|size
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_errno
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;sadb_msg_reserved
op_assign
l_int|0
suffix:semicolon
id|hdr-&gt;sadb_msg_seq
op_assign
id|x-&gt;km.seq
op_assign
id|get_acqseq
c_func
(paren
)paren
suffix:semicolon
id|hdr-&gt;sadb_msg_pid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* SA */
id|sa
op_assign
(paren
r_struct
id|sadb_sa
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_len
op_assign
r_sizeof
(paren
r_struct
id|sadb_sa
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|sa-&gt;sadb_sa_exttype
op_assign
id|SADB_EXT_SA
suffix:semicolon
id|sa-&gt;sadb_sa_spi
op_assign
id|x-&gt;id.spi
suffix:semicolon
id|sa-&gt;sadb_sa_replay
op_assign
l_int|0
suffix:semicolon
id|sa-&gt;sadb_sa_state
op_assign
l_int|0
suffix:semicolon
id|sa-&gt;sadb_sa_auth
op_assign
l_int|0
suffix:semicolon
id|sa-&gt;sadb_sa_encrypt
op_assign
l_int|0
suffix:semicolon
id|sa-&gt;sadb_sa_flags
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ADDRESS_SRC (old addr) */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_SRC
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|x-&gt;props.saddr.a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
id|x-&gt;props.saddr.a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* NAT_T_SPORT (old port) */
id|n_port
op_assign
(paren
r_struct
id|sadb_x_nat_t_port
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|n_port
)paren
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_len
op_assign
r_sizeof
(paren
op_star
id|n_port
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_exttype
op_assign
id|SADB_X_EXT_NAT_T_SPORT
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_port
op_assign
id|natt-&gt;encap_sport
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_reserved
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* ADDRESS_DST (new addr) */
id|addr
op_assign
(paren
r_struct
id|sadb_address
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
suffix:semicolon
id|addr-&gt;sadb_address_len
op_assign
(paren
r_sizeof
(paren
r_struct
id|sadb_address
)paren
op_plus
id|sockaddr_size
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|addr-&gt;sadb_address_exttype
op_assign
id|SADB_EXT_ADDRESS_SRC
suffix:semicolon
id|addr-&gt;sadb_address_proto
op_assign
l_int|0
suffix:semicolon
id|addr-&gt;sadb_address_reserved
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|32
suffix:semicolon
id|sin
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|ipaddr-&gt;a4
suffix:semicolon
id|sin-&gt;sin_port
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|sin-&gt;sin_zero
comma
l_int|0
comma
r_sizeof
(paren
id|sin-&gt;sin_zero
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_IPV6) || defined(CONFIG_IPV6_MODULE)
r_else
r_if
c_cond
(paren
id|x-&gt;props.family
op_eq
id|AF_INET6
)paren
(brace
id|addr-&gt;sadb_address_prefixlen
op_assign
l_int|128
suffix:semicolon
id|sin6
op_assign
(paren
r_struct
id|sockaddr_in6
op_star
)paren
(paren
id|addr
op_plus
l_int|1
)paren
suffix:semicolon
id|sin6-&gt;sin6_family
op_assign
id|AF_INET6
suffix:semicolon
id|sin6-&gt;sin6_port
op_assign
l_int|0
suffix:semicolon
id|sin6-&gt;sin6_flowinfo
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sin6-&gt;sin6_addr
comma
op_amp
id|ipaddr-&gt;a6
comma
r_sizeof
(paren
r_struct
id|in6_addr
)paren
)paren
suffix:semicolon
id|sin6-&gt;sin6_scope_id
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_else
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* NAT_T_DPORT (new port) */
id|n_port
op_assign
(paren
r_struct
id|sadb_x_nat_t_port
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
op_star
id|n_port
)paren
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_len
op_assign
r_sizeof
(paren
op_star
id|n_port
)paren
op_div
r_sizeof
(paren
r_uint64
)paren
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_exttype
op_assign
id|SADB_X_EXT_NAT_T_DPORT
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_port
op_assign
id|sport
suffix:semicolon
id|n_port-&gt;sadb_x_nat_t_port_reserved
op_assign
l_int|0
suffix:semicolon
r_return
id|pfkey_broadcast
c_func
(paren
id|skb
comma
id|GFP_ATOMIC
comma
id|BROADCAST_REGISTERED
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|pfkey_sendmsg
r_static
r_int
id|pfkey_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|kiocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|sadb_msg
op_star
id|hdr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;msg_flags
op_amp
id|MSG_OOB
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
)paren
id|len
OG
id|sk-&gt;sndbuf
op_minus
l_int|32
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|ENOBUFS
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
)paren
r_goto
id|out
suffix:semicolon
id|hdr
op_assign
id|pfkey_get_base_msg
c_func
(paren
id|skb
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
)paren
r_goto
id|out
suffix:semicolon
id|down
c_func
(paren
op_amp
id|xfrm_cfg_sem
)paren
suffix:semicolon
id|err
op_assign
id|pfkey_process
c_func
(paren
id|sk
comma
id|skb
comma
id|hdr
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|xfrm_cfg_sem
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|err
op_logical_and
id|hdr
op_logical_and
id|pfkey_error
c_func
(paren
id|hdr
comma
id|err
comma
id|sk
)paren
op_eq
l_int|0
)paren
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
ques
c_cond
suffix:colon
id|len
suffix:semicolon
)brace
DECL|function|pfkey_recvmsg
r_static
r_int
id|pfkey_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|kiocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|copied
comma
id|err
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
(paren
id|MSG_PEEK
op_or
id|MSG_DONTWAIT
op_or
id|MSG_TRUNC
)paren
)paren
r_goto
id|out
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
l_int|0
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
r_goto
id|out
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|len
)paren
(brace
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
id|copied
op_assign
id|len
suffix:semicolon
)brace
id|skb-&gt;h.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|err
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out_free
suffix:semicolon
id|sock_recv_timestamp
c_func
(paren
id|msg
comma
id|sk
comma
id|skb
)paren
suffix:semicolon
id|err
op_assign
(paren
id|flags
op_amp
id|MSG_TRUNC
)paren
ques
c_cond
id|skb-&gt;len
suffix:colon
id|copied
suffix:semicolon
id|out_free
suffix:colon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|pfkey_ops
r_static
r_struct
id|proto_ops
id|pfkey_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_KEY
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
multiline_comment|/* Operations that make no sense on pfkey sockets. */
dot
id|bind
op_assign
id|sock_no_bind
comma
dot
id|connect
op_assign
id|sock_no_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|sock_no_accept
comma
dot
id|getname
op_assign
id|sock_no_getname
comma
dot
id|ioctl
op_assign
id|sock_no_ioctl
comma
dot
id|listen
op_assign
id|sock_no_listen
comma
dot
id|shutdown
op_assign
id|sock_no_shutdown
comma
dot
id|setsockopt
op_assign
id|sock_no_setsockopt
comma
dot
id|getsockopt
op_assign
id|sock_no_getsockopt
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
multiline_comment|/* Now the operations that really occur. */
dot
id|release
op_assign
id|pfkey_release
comma
dot
id|poll
op_assign
id|datagram_poll
comma
dot
id|sendmsg
op_assign
id|pfkey_sendmsg
comma
dot
id|recvmsg
op_assign
id|pfkey_recvmsg
comma
)brace
suffix:semicolon
DECL|variable|pfkey_family_ops
r_static
r_struct
id|net_proto_family
id|pfkey_family_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_KEY
comma
dot
id|create
op_assign
id|pfkey_create
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|pfkey_read_proc
r_static
r_int
id|pfkey_read_proc
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;sk       RefCnt Rmem   Wmem   User   Inode&bslash;n&quot;
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|pfkey_table
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%p %-6d %-6u %-6u %-6u %-6lu&quot;
comma
id|s
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;refcnt
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;rmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;wmem_alloc
)paren
comma
id|sock_i_uid
c_func
(paren
id|s
)paren
comma
id|sock_i_ino
c_func
(paren
id|s
)paren
)paren
suffix:semicolon
id|buffer
(braket
id|len
op_increment
)braket
op_assign
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
(brace
r_goto
id|done
suffix:semicolon
)brace
)brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
id|done
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|pfkey_table_lock
)paren
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
id|len
op_sub_assign
(paren
id|offset
op_minus
id|begin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|pfkeyv2_mgr
r_static
r_struct
id|xfrm_mgr
id|pfkeyv2_mgr
op_assign
(brace
dot
id|id
op_assign
l_string|&quot;pfkeyv2&quot;
comma
dot
id|notify
op_assign
id|pfkey_send_notify
comma
dot
id|acquire
op_assign
id|pfkey_send_acquire
comma
dot
id|compile_policy
op_assign
id|pfkey_compile_policy
comma
dot
id|new_mapping
op_assign
id|pfkey_send_new_mapping
comma
)brace
suffix:semicolon
DECL|function|ipsec_pfkey_exit
r_static
r_void
id|__exit
id|ipsec_pfkey_exit
c_func
(paren
r_void
)paren
(brace
id|xfrm_unregister_km
c_func
(paren
op_amp
id|pfkeyv2_mgr
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;net/pfkey&quot;
comma
l_int|0
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|PF_KEY
)paren
suffix:semicolon
)brace
DECL|function|ipsec_pfkey_init
r_static
r_int
id|__init
id|ipsec_pfkey_init
c_func
(paren
r_void
)paren
(brace
id|sock_register
c_func
(paren
op_amp
id|pfkey_family_ops
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|create_proc_read_entry
c_func
(paren
l_string|&quot;net/pfkey&quot;
comma
l_int|0
comma
l_int|0
comma
id|pfkey_read_proc
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|xfrm_register_km
c_func
(paren
op_amp
id|pfkeyv2_mgr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ipsec_pfkey_init
id|module_init
c_func
(paren
id|ipsec_pfkey_init
)paren
suffix:semicolon
DECL|variable|ipsec_pfkey_exit
id|module_exit
c_func
(paren
id|ipsec_pfkey_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
