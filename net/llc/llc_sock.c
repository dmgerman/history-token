multiline_comment|/*&n; * llc_sock.c - LLC User Interface SAPs&n; * Description:&n; *   Functions in this module are implementation of socket based llc&n; *   communications for the Linux operating system. Support of llc class&n; *   one and class two is provided via SOCK_DGRAM and SOCK_STREAM&n; *   respectively.&n; *&n; *   An llc2 connection is (mac + sap), only one llc2 sap connection&n; *   is allowed per mac. Though one sap may have multiple mac + sap&n; *   connections.&n; *&n; * Copyright (c) 2001 by Jay Schulist &lt;jschlst@samba.org&gt;&n; *&n; * This program can be redistributed or modified under the terms of the&n; * GNU General Public License as published by the Free Software Foundation.&n; * This program is distributed without any warranty or implied warranty&n; * of merchantability or fitness for a particular purpose.&n; *&n; * See the GNU General Public License for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/sockios.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/inetdevice.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;net/sock.h&gt;
macro_line|#include &lt;net/llc_if.h&gt;
macro_line|#include &lt;net/llc_sap.h&gt;
macro_line|#include &lt;net/llc_pdu.h&gt;
macro_line|#include &lt;net/llc_conn.h&gt;
macro_line|#include &lt;net/llc_mac.h&gt;
macro_line|#include &lt;linux/llc.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/init.h&gt;
multiline_comment|/* remember: uninitialized global data is zeroed because its in .bss */
DECL|variable|llc_ui_sap_last_autoport
r_static
id|u16
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
DECL|variable|llc_ui_sap_link_no_max
r_static
id|u16
id|llc_ui_sap_link_no_max
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|llc_ui_addrnull
r_static
r_struct
id|sockaddr_llc
id|llc_ui_addrnull
suffix:semicolon
DECL|variable|llc_ui_ops
r_static
r_struct
id|proto_ops
id|llc_ui_ops
suffix:semicolon
DECL|variable|llc_ui_sockets
r_static
r_struct
id|sock
op_star
id|llc_ui_sockets
suffix:semicolon
DECL|variable|llc_ui_sockets_lock
r_static
id|rwlock_t
id|llc_ui_sockets_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
r_static
r_int
id|llc_ui_indicate
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_confirm
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_conn
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;llc_ui_next_link_no - return the next unused link number for a sap&n; *&t;@sap: Address of sap to get link number from.&n; *&n; *&t;Return the next unused link number for a given sap.&n; */
DECL|function|llc_ui_next_link_no
r_static
id|__inline__
id|u16
id|llc_ui_next_link_no
c_func
(paren
r_int
id|sap
)paren
(brace
r_return
id|llc_ui_sap_link_no_max
(braket
id|sap
)braket
op_increment
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_addr_null - determines if a address structure is null&n; *&t;@addr: Address to test if null.&n; */
DECL|function|llc_ui_addr_null
r_static
id|__inline__
id|u8
id|llc_ui_addr_null
c_func
(paren
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
r_return
op_logical_neg
id|memcmp
c_func
(paren
id|addr
comma
op_amp
id|llc_ui_addrnull
comma
r_sizeof
(paren
op_star
id|addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_protocol_type - return eth protocol for ARP header type&n; *&t;@arphrd: ARP header type.&n; *&n; *&t;Given an ARP header type return the corresponding ethernet protocol.&n; *&t;Returns  0 if ARP header type not supported or the corresponding&n; *&t;ethernet protocol type.&n; */
DECL|function|llc_ui_protocol_type
r_static
id|__inline__
id|u16
id|llc_ui_protocol_type
c_func
(paren
id|u16
id|arphrd
)paren
(brace
id|u16
id|rc
op_assign
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arphrd
op_eq
id|ARPHRD_IEEE802_TR
)paren
id|rc
op_assign
id|htons
c_func
(paren
id|ETH_P_TR_802_2
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_header_len - return length of llc header based on operation&n; *&t;@sk: Socket which contains a valid llc socket type.&n; *&t;@addr: Complete sockaddr_llc structure received from the user.&n; *&n; *&t;Provide the length of the llc header depending on what kind of&n; *&t;operation the user would like to perform and the type of socket.&n; *&t;Returns the correct llc header length.&n; */
DECL|function|llc_ui_header_len
r_static
id|__inline__
id|u8
id|llc_ui_header_len
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
id|u8
id|rc
op_assign
id|LLC_PDU_LEN_U
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_test
op_logical_or
id|addr-&gt;sllc_xid
)paren
id|rc
op_assign
id|LLC_PDU_LEN_U
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_STREAM
)paren
id|rc
op_assign
id|LLC_PDU_LEN_I
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_send_conn - send connect command for new llc2 connection&n; *&t;@sap : Sap the socket is bound to.&n; *&t;@addr: Source and destination fields provided by the user.&n; *&t;@dev : Device which this connection should use.&n; *&t;@link: Link number to assign to this connection.&n; *&n; *&t;Send a connect command to the llc layer for a new llc2 connection.&n; *&t;Returns 0 upon success, non-zero if action didn&squot;t succeed.&n; */
DECL|function|llc_ui_send_conn
r_static
r_int
id|llc_ui_send_conn
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|llc_sap
op_star
id|sap
comma
r_struct
id|sockaddr_llc
op_star
id|addr
comma
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|link
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_union
id|llc_u_prim_data
id|prim_data
suffix:semicolon
r_struct
id|llc_prim_if_block
id|prim
suffix:semicolon
id|prim.data
op_assign
op_amp
id|prim_data
suffix:semicolon
id|prim.sap
op_assign
id|sap
suffix:semicolon
id|prim.prim
op_assign
id|LLC_CONN_PRIM
suffix:semicolon
id|prim_data.conn.dev
op_assign
id|dev
suffix:semicolon
id|prim_data.conn.link
op_assign
id|link
suffix:semicolon
id|prim_data.conn.sk
op_assign
l_int|NULL
suffix:semicolon
id|prim_data.conn.handler
op_assign
id|sk
suffix:semicolon
id|prim_data.conn.pri
op_assign
l_int|0
suffix:semicolon
id|prim_data.conn.saddr.lsap
op_assign
id|llc_ui-&gt;addr.sllc_ssap
suffix:semicolon
id|prim_data.conn.daddr.lsap
op_assign
id|addr-&gt;sllc_dsap
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.conn.saddr.mac
comma
id|dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.conn.daddr.mac
comma
id|addr-&gt;sllc_dmac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
r_return
id|sap
op_member_access_from_pointer
id|req
c_func
(paren
op_amp
id|prim
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_send_disc - send disc command to llc layer&n; *&t;@sk: Socket with valid llc information.&n; *&n; *&t;Send a disconnect command to the llc layer for an established&n; *&t;llc2 connection.&n; *&t;Returns 0 upon success, non-zero if action did not succeed.&n; */
DECL|function|llc_ui_send_disc
r_static
r_int
id|llc_ui_send_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_union
id|llc_u_prim_data
id|prim_data
suffix:semicolon
r_struct
id|llc_prim_if_block
id|prim
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSING
suffix:semicolon
id|prim.data
op_assign
op_amp
id|prim_data
suffix:semicolon
id|prim.sap
op_assign
id|llc_ui-&gt;sap
suffix:semicolon
id|prim.prim
op_assign
id|LLC_DISC_PRIM
suffix:semicolon
id|prim_data.disc.sk
op_assign
id|llc_ui-&gt;core_sk
suffix:semicolon
id|prim_data.disc.link
op_assign
id|llc_ui-&gt;link
suffix:semicolon
id|rc
op_assign
id|llc_ui-&gt;sap
op_member_access_from_pointer
id|req
c_func
(paren
op_amp
id|prim
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_send_data - send data via reliable llc2 connection&n; *&t;@sap: Sap the socket is bound to.&n; *&t;@sk: Connection the socket is using.&n; *&t;@skb: Data the user wishes to send.&n; *&t;@addr: Source and destination fields provided by the user.&n; *&n; *&t;Send data via reliable llc2 connection.&n; *&t;Returns 0 upon success,  non-zero if action did not succeed.&n; */
DECL|function|llc_ui_send_data
r_static
r_int
id|llc_ui_send_data
c_func
(paren
r_struct
id|llc_sap
op_star
id|sap
comma
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc_core
op_assign
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|llc_ui_protocol_type
c_func
(paren
id|addr-&gt;sllc_arphrd
)paren
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_try
suffix:colon
id|rc
op_assign
id|llc_build_and_send_pkt
c_func
(paren
id|llc_ui-&gt;core_sk
comma
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
op_minus
id|EBUSY
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|wait_event_interruptible
c_func
(paren
id|sk-&gt;socket-&gt;wait
comma
op_logical_neg
id|llc_ui-&gt;core_sk
op_logical_or
op_logical_neg
id|llc_core-&gt;failed_data_req
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
r_goto
r_try
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;core_sk
)paren
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
id|out
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_send_llc1 - send llc1 prim data block to llc layer.&n; *&t;@sap      : Sap the socket is bound to.&n; *&t;@skb      : Data the user wishes to send.&n; *&t;@addr     : Source and destination fields provided by the user.&n; *&t;@primitive: Action the llc layer should perform.&n; *&n; *&t;Send an llc1 primitive data block to the llc layer for processing.&n; *&t;This function is used for test, xid and unit_data messages.&n; *&t;Returns 0 upon success, non-zero if action did not succeed.&n; */
DECL|function|llc_ui_send_llc1
r_static
r_int
id|llc_ui_send_llc1
c_func
(paren
r_struct
id|llc_sap
op_star
id|sap
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|sockaddr_llc
op_star
id|addr
comma
r_int
id|primitive
)paren
(brace
r_union
id|llc_u_prim_data
id|prim_data
suffix:semicolon
r_struct
id|llc_prim_if_block
id|prim
suffix:semicolon
id|prim.data
op_assign
op_amp
id|prim_data
suffix:semicolon
id|prim.sap
op_assign
id|sap
suffix:semicolon
id|prim.prim
op_assign
id|primitive
suffix:semicolon
id|prim_data.test.skb
op_assign
id|skb
suffix:semicolon
id|prim_data.test.saddr.lsap
op_assign
id|sap-&gt;laddr.lsap
suffix:semicolon
id|prim_data.test.daddr.lsap
op_assign
id|addr-&gt;sllc_dsap
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|llc_ui_protocol_type
c_func
(paren
id|addr-&gt;sllc_arphrd
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.test.saddr.mac
comma
id|skb-&gt;dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|prim_data.test.daddr.mac
comma
id|addr-&gt;sllc_dmac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
r_return
id|sap
op_member_access_from_pointer
id|req
c_func
(paren
op_amp
id|prim
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_find_sap - returns sap struct that matches sap number specified&n; *&t;@sap: Sap number to search for.&n; *&n; *&t;Search the local socket list and return the first instance of the sap&n; *&t;structure which matches the sap number the user specified.&n; *&t;Returns llc_sap upon match, %NULL otherwise.&n; */
DECL|function|llc_ui_find_sap
r_static
id|__inline__
r_struct
id|llc_sap
op_star
id|llc_ui_find_sap
c_func
(paren
id|u8
id|sap
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|llc_sap
op_star
id|s
op_assign
l_int|NULL
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|llc_ui_sockets
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;sap
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;sap-&gt;laddr.lsap
op_eq
id|sap
)paren
(brace
id|s
op_assign
id|llc_ui-&gt;sap
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_return
id|s
suffix:semicolon
)brace
DECL|function|__llc_ui_find_sk_by_exact
r_static
r_struct
id|sock
op_star
id|__llc_ui_find_sk_by_exact
c_func
(paren
r_struct
id|llc_addr
op_star
id|laddr
comma
r_struct
id|llc_addr
op_star
id|daddr
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|llc_ui_sockets
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;addr.sllc_ssap
op_eq
id|laddr-&gt;lsap
op_logical_and
id|llc_ui-&gt;addr.sllc_dsap
op_eq
id|daddr-&gt;lsap
op_logical_and
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
op_logical_and
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_smac
comma
id|laddr-&gt;mac
)paren
op_logical_and
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_dmac
comma
id|daddr-&gt;mac
)paren
)paren
r_break
suffix:semicolon
)brace
r_return
id|sk
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;__llc_ui_find_sk_by_addr - return socket matching local mac + sap.&n; *&t;@addr: Local address to match.&n; *&n; *&t;Search the local socket list and return the socket which has a matching&n; *&t;local (mac + sap) address (allows null mac). This search will work on&n; *&t;unconnected and connected sockets, though find_by_link_no is recommend&n; *&t;for connected sockets.&n; *&t;Returns sock upon match, %NULL otherwise.&n; */
DECL|function|__llc_ui_find_sk_by_addr
r_static
r_struct
id|sock
op_star
id|__llc_ui_find_sk_by_addr
c_func
(paren
r_struct
id|llc_addr
op_star
id|laddr
comma
r_struct
id|llc_addr
op_star
id|daddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sock
op_star
id|sk
comma
op_star
id|tmp_sk
suffix:semicolon
r_for
c_loop
(paren
id|sk
op_assign
id|llc_ui_sockets
suffix:semicolon
id|sk
suffix:semicolon
id|sk
op_assign
id|sk-&gt;next
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;addr.sllc_ssap
op_ne
id|laddr-&gt;lsap
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_smac
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
op_logical_and
op_logical_neg
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
comma
id|laddr-&gt;mac
)paren
)paren
r_continue
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_logical_and
op_logical_neg
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
op_logical_and
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
comma
id|laddr-&gt;mac
)paren
op_logical_and
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_smac
comma
id|dev-&gt;dev_addr
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_match
c_func
(paren
id|llc_ui-&gt;addr.sllc_smac
comma
id|laddr-&gt;mac
)paren
)paren
r_continue
suffix:semicolon
id|tmp_sk
op_assign
id|__llc_ui_find_sk_by_exact
c_func
(paren
id|laddr
comma
id|daddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp_sk
)paren
(brace
id|sk
op_assign
id|tmp_sk
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_dmac
)paren
)paren
r_break
suffix:semicolon
)brace
r_return
id|sk
suffix:semicolon
)brace
DECL|function|llc_ui_find_sk_by_addr
r_static
r_struct
id|sock
op_star
id|llc_ui_find_sk_by_addr
c_func
(paren
r_struct
id|llc_addr
op_star
id|addr
comma
r_struct
id|llc_addr
op_star
id|daddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
id|sk
op_assign
id|__llc_ui_find_sk_by_addr
c_func
(paren
id|addr
comma
id|daddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
DECL|function|llc_ui_bh_find_sk_by_addr
r_static
r_struct
id|sock
op_star
id|llc_ui_bh_find_sk_by_addr
c_func
(paren
r_struct
id|llc_addr
op_star
id|addr
comma
r_struct
id|llc_addr
op_star
id|daddr
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
id|read_lock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
id|sk
op_assign
id|__llc_ui_find_sk_by_addr
c_func
(paren
id|addr
comma
id|daddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|read_unlock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_return
id|sk
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_insert_socket - insert socket into list&n; *&t;@sk: Socket to insert.&n; *&n; *&t;Insert a socket into the local llc socket list.&n; */
DECL|function|llc_ui_insert_socket
r_static
id|__inline__
r_void
id|llc_ui_insert_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
id|sk-&gt;next
op_assign
id|llc_ui_sockets
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;next
)paren
id|llc_ui_sockets-&gt;pprev
op_assign
op_amp
id|sk-&gt;next
suffix:semicolon
id|llc_ui_sockets
op_assign
id|sk
suffix:semicolon
id|sk-&gt;pprev
op_assign
op_amp
id|llc_ui_sockets
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|write_unlock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_remove_socket - remove socket from list&n; *&t;@sk: Socket to remove.&n; *&n; *&t;Remove a socket from the local llc socket list.&n; */
DECL|function|llc_ui_remove_socket
r_static
id|__inline__
r_void
id|llc_ui_remove_socket
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|write_lock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;pprev
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;next
)paren
id|sk-&gt;next-&gt;pprev
op_assign
id|sk-&gt;pprev
suffix:semicolon
op_star
id|sk-&gt;pprev
op_assign
id|sk-&gt;next
suffix:semicolon
id|sk-&gt;pprev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* this only makes sense if the socket was inserted on the&n;&t;&t; * list, if sk-&gt;pprev is NULL it wasn&squot;t&n;&t;&t; */
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|write_unlock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_destroy_sk - destroy socket&n; *&t;@data: Socket which is to be destroyed.&n; *&n; *&t;Really destroy the socket.&n; */
DECL|function|llc_ui_destroy_sk
r_static
r_void
id|llc_ui_destroy_sk
c_func
(paren
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
id|skb_queue_purge
c_func
(paren
op_amp
id|sk-&gt;write_queue
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_destroy_timer - try to destroy socket again&n; *&t;@data: Socket which is to be destroyed.&n; *&n; *&t;Attempt to destroy a socket which was previously destroyed but&n; *&t;was still in use at the time.&n; */
DECL|function|llc_ui_destroy_timer
r_static
r_void
id|llc_ui_destroy_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
(paren
r_struct
id|sock
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_logical_and
id|sk-&gt;dead
)paren
id|llc_ui_destroy_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_else
(brace
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|SOCK_DESTROY_TIME
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/**&n; *&t;llc_ui_create - alloc and init a new llc_ui socket&n; *&t;@sock: Socket to initialize and attach allocated sk to.&n; *&t;@protocol: Unused.&n; *&n; *&t;Allocate and initialize a new llc_ui socket, validate the user wants a&n; *&t;socket type we have available.&n; *&t;Returns 0 upon success, negative upon failure.&n; */
DECL|function|llc_ui_create
r_static
r_int
id|llc_ui_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_ne
id|SOCK_DGRAM
op_logical_and
id|sock-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|decmod
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|sk
op_assign
id|sk_alloc
c_func
(paren
id|PF_LLC
comma
id|GFP_KERNEL
comma
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|decmod
suffix:semicolon
id|llc_ui
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|llc_ui
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui
)paren
r_goto
id|outsk
suffix:semicolon
id|memset
c_func
(paren
id|llc_ui
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|llc_ui
)paren
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|sock_init_data
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
id|llc_ui_sk
c_func
(paren
id|sk
)paren
op_assign
id|llc_ui
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|llc_ui_ops
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|outsk
suffix:colon
id|sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|decmod
suffix:colon
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_release - shutdown socket&n; *&t;@sock: Socket to release.&n; *&n; *&t;Shutdown and deallocate an existing socket.&n; */
DECL|function|llc_ui_release
r_static
r_int
id|llc_ui_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;core_sk
op_logical_and
op_logical_neg
id|llc_ui_send_disc
c_func
(paren
id|sk
)paren
)paren
id|llc_ui_wait_for_disc
c_func
(paren
id|sk
comma
id|sk-&gt;rcvtimeo
)paren
suffix:semicolon
id|llc_ui_remove_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;sap
op_logical_and
op_logical_neg
id|llc_ui_find_sap
c_func
(paren
id|llc_ui-&gt;sap-&gt;laddr.lsap
)paren
)paren
id|llc_sap_close
c_func
(paren
id|llc_ui-&gt;sap
)paren
suffix:semicolon
id|sock_orphan
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sock-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;wmem_alloc
)paren
op_logical_and
op_logical_neg
id|atomic_read
c_func
(paren
op_amp
id|sk-&gt;rmem_alloc
)paren
op_logical_and
id|sk-&gt;dead
)paren
id|llc_ui_destroy_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_else
(brace
id|init_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
id|sk-&gt;timer.expires
op_assign
id|jiffies
op_plus
id|SOCK_DESTROY_TIME
suffix:semicolon
id|sk-&gt;timer.function
op_assign
id|llc_ui_destroy_timer
suffix:semicolon
id|sk-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|sk
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sk-&gt;timer
)paren
suffix:semicolon
)brace
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_autoport - provide dynamicly allocate SAP number&n; *&n; *&t;Provide the caller with a dynamicly allocated SAP number according&n; *&t;to the rules that are set in this function. Returns: 0, upon failure,&n; *&t;SAP number otherwise.&n; */
DECL|function|llc_ui_autoport
r_static
r_int
id|llc_ui_autoport
c_func
(paren
r_void
)paren
(brace
r_struct
id|llc_sap
op_star
id|sap
suffix:semicolon
r_int
id|i
comma
id|tries
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|tries
OL
id|LLC_SAP_DYN_TRIES
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|llc_ui_sap_last_autoport
suffix:semicolon
id|i
OL
id|LLC_SAP_DYN_STOP
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|sap
op_assign
id|llc_ui_find_sap
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
(brace
id|llc_ui_sap_last_autoport
op_assign
id|i
op_plus
l_int|2
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
id|tries
op_increment
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_autobind - Bind a socket to a specific address.&n; *&t;@sk: Socket to bind an address to.&n; *&t;@addr: Address the user wants the socket bound to.&n; *&n; *&t;Bind a socket to a specific address. For llc a user is able to bind to&n; *&t;a specific sap only or mac + sap. If the user only specifies a sap and&n; *&t;a null dmac (all zeros) the user is attempting to bind to an entire&n; *&t;sap. This will stop anyone else on the local system from using that&n; *&t;sap.  If someone else has a mac + sap open the bind to null + sap will&n; *&t;fail.&n; *&t;If the user desires to bind to a specific mac + sap, it is possible to&n; *&t;have multiple sap connections via multiple macs.&n; *&t;Bind and autobind for that matter must enforce the correct sap usage&n; *&t;otherwise all hell will break loose.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_autobind
r_static
r_int
id|llc_ui_autobind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|llc_sap
op_star
id|sap
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;zapped
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* bind to a specific mac, optional. */
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_smac
)paren
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
id|llc_ui-&gt;dev
op_assign
id|dev
suffix:semicolon
)brace
multiline_comment|/* bind to a specific sap, optional. */
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;sllc_ssap
)paren
(brace
id|rc
op_assign
op_minus
id|EUSERS
suffix:semicolon
id|addr-&gt;sllc_ssap
op_assign
id|llc_ui_autoport
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;sllc_ssap
)paren
r_goto
id|out
suffix:semicolon
)brace
id|sap
op_assign
id|llc_ui_find_sap
c_func
(paren
id|addr-&gt;sllc_ssap
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
(brace
id|sap
op_assign
id|llc_sap_open
c_func
(paren
id|llc_ui_indicate
comma
id|llc_ui_confirm
comma
id|addr-&gt;sllc_ssap
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* some other network layer is using the sap */
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
r_struct
id|llc_addr
id|laddr
comma
id|daddr
suffix:semicolon
r_struct
id|sock
op_star
id|ask
suffix:semicolon
id|rc
op_assign
op_minus
id|EUSERS
suffix:semicolon
multiline_comment|/* can&squot;t get exclusive use of sap */
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_and
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_mmac
)paren
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|laddr
comma
l_int|0
comma
r_sizeof
(paren
id|laddr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|daddr
comma
l_int|0
comma
r_sizeof
(paren
id|daddr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_mmac
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_DGRAM
)paren
(brace
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|laddr.mac
comma
id|addr-&gt;sllc_mmac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|laddr.mac
comma
id|addr-&gt;sllc_smac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|laddr.lsap
op_assign
id|addr-&gt;sllc_ssap
suffix:semicolon
id|rc
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
multiline_comment|/* mac + sap clash. */
id|ask
op_assign
id|llc_ui_bh_find_sk_by_addr
c_func
(paren
op_amp
id|laddr
comma
op_amp
id|daddr
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ask
)paren
(brace
id|sock_put
c_func
(paren
id|ask
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|memcpy
c_func
(paren
op_amp
id|llc_ui-&gt;addr
comma
id|addr
comma
r_sizeof
(paren
op_star
id|addr
)paren
)paren
suffix:semicolon
id|llc_ui-&gt;sap
op_assign
id|sap
suffix:semicolon
id|rc
op_assign
id|sk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
id|llc_ui_insert_socket
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_bind - bind a socket to a specific address.&n; *&t;@sock: Socket to bind an address to.&n; *&t;@uaddr: Address the user wants the socket bound to.&n; *&t;@addrlen: Length of the uaddr structure.&n; *&n; *&t;Bind a socket to a specific address. For llc a user is able to bind to&n; *&t;a specific sap only or mac + sap. If the user only specifies a sap and&n; *&t;a null dmac (all zeros) the user is attempting to bind to an entire&n; *&t;sap. This will stop anyone else on the local system from using that&n; *&t;sap. If someone else has a mac + sap open the bind to null + sap will&n; *&t;fail.&n; *&t;If the user desires to bind to a specific mac + sap, it is possible to&n; *&t;have multiple sap connections via multiple macs.&n; *&t;Bind and autobind for that matter must enforce the correct sap usage&n; *&t;otherwise all hell will break loose.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_bind
r_static
r_int
id|llc_ui_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addrlen
)paren
(brace
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;zapped
op_logical_or
id|addrlen
op_ne
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAFNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_family
op_ne
id|AF_LLC
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* use autobind, to avoid code replication. */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_shutdown - shutdown a connect llc2 socket.&n; *&t;@sock: Socket to shutdown.&n; *&t;@how: What part of the socket to shutdown.&n; *&n; *&t;Shutdown a connected llc2 socket. Currently this function only supports&n; *&t;shutting down both sends and receives (2), we could probably make this&n; *&t;function such that a user can shutdown only half the connection but not&n; *&t;right now.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_shutdown
r_static
r_int
id|llc_ui_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|how
op_ne
l_int|2
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|llc_ui_send_disc
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|llc_ui_wait_for_disc
c_func
(paren
id|sk
comma
id|sk-&gt;rcvtimeo
)paren
suffix:semicolon
multiline_comment|/* Wake up anyone sleeping in poll */
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_connect - Connect to a remote llc2 mac + sap.&n; *&t;@sock: Socket which will be connected to the remote destination.&n; *&t;@uaddr: Remote and possibly the local address of the new connection.&n; *&t;@addrlen: Size of uaddr structure.&n; *&t;@flags: Operational flags specified by the user.&n; *&n; *&t;Connect to a remote llc2 mac + sap. The caller must specify the&n; *&t;destination mac and address to connect to. If the user previously&n; *&t;called bind(2) with a smac the user does not need to specify the source&n; *&t;address and mac.&n; *&t;This function will autobind if user did not previously call bind.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_connect
r_static
r_int
id|llc_ui_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addrlen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addrlen
op_ne
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAFNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_family
op_ne
id|AF_LLC
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* bind connection to sap if user hasn&squot;t done it. */
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
(brace
multiline_comment|/* bind to sap with null dev, exclusive */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;dev
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
id|dev
op_assign
id|llc_ui-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EALREADY
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
r_goto
id|out
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_SYN_SENT
suffix:semicolon
id|llc_ui-&gt;link
op_assign
id|llc_ui_next_link_no
c_func
(paren
id|llc_ui-&gt;sap-&gt;laddr.lsap
)paren
suffix:semicolon
id|rc
op_assign
id|llc_ui_send_conn
c_func
(paren
id|sk
comma
id|llc_ui-&gt;sap
comma
id|addr
comma
id|dev
comma
id|llc_ui-&gt;link
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|llc_ui_wait_for_conn
c_func
(paren
id|sk
comma
id|sk-&gt;rcvtimeo
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_listen - allow a normal socket to accept incoming connections&n; *&t;@sock: Socket to allow incoming connections on.&n; *&t;@backlog: Number of connections to queue.&n; *&n; *&t;Allow a normal socket to accept incoming connections.&n; *&t;Returns 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_listen
r_static
r_int
id|llc_ui_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
r_int
)paren
id|backlog
)paren
multiline_comment|/* BSDism */
id|backlog
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;max_ack_backlog
op_assign
id|backlog
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
(brace
id|sk-&gt;ack_backlog
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_LISTEN
suffix:semicolon
)brace
id|sk-&gt;socket-&gt;flags
op_or_assign
id|__SO_ACCEPTCON
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_disc
r_static
r_int
id|llc_ui_wait_for_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_CLOSE
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_conn
r_static
r_int
id|llc_ui_wait_for_conn
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;core_sk
)paren
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_break
suffix:semicolon
)brace
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_CLOSE
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_data
r_static
r_int
id|llc_ui_wait_for_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_accept - accept a new incoming connection.&n; *&t;@sock: Socket which connections arrive on.&n; *&t;@newsock: Socket to move incoming connection to.&n; *&t;@flags: User specified operational flags.&n; *&n; *&t;Accept a new incoming connection.&n; *&t;Returns 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_accept
r_static
r_int
id|llc_ui_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
comma
op_star
id|newsk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
comma
op_star
id|newllc_ui
suffix:semicolon
r_struct
id|llc_opt
op_star
id|newllc_core
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* wait for a connection to arrive. */
id|rc
op_assign
id|llc_ui_wait_for_data
c_func
(paren
id|sk
comma
id|sk-&gt;rcvtimeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;receive_queue
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;sk
)paren
r_goto
id|frees
suffix:semicolon
multiline_comment|/* attach connection to a new socket. */
id|rc
op_assign
id|llc_ui_create
c_func
(paren
id|newsock
comma
id|sk-&gt;protocol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|frees
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|newsk
op_assign
id|newsock-&gt;sk
suffix:semicolon
id|newsk-&gt;pair
op_assign
l_int|NULL
suffix:semicolon
id|newsk-&gt;socket
op_assign
id|newsock
suffix:semicolon
id|newsk-&gt;sleep
op_assign
op_amp
id|newsock-&gt;wait
suffix:semicolon
id|newsk-&gt;zapped
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
id|newsock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|newllc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|newllc_ui-&gt;sap
op_assign
id|llc_ui-&gt;sap
suffix:semicolon
id|newllc_ui-&gt;dev
op_assign
id|llc_ui-&gt;dev
suffix:semicolon
id|newllc_ui-&gt;core_sk
op_assign
id|skb-&gt;sk
suffix:semicolon
id|newllc_core
op_assign
id|llc_sk
c_func
(paren
id|newllc_ui-&gt;core_sk
)paren
suffix:semicolon
id|newllc_ui-&gt;link
op_assign
id|newllc_core-&gt;link
suffix:semicolon
id|newllc_core-&gt;handler
op_assign
id|newsk
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|newllc_ui-&gt;addr
comma
op_amp
id|llc_ui-&gt;addr
comma
r_sizeof
(paren
id|newllc_ui-&gt;addr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|newllc_ui-&gt;addr.sllc_dmac
comma
id|newllc_core-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|newllc_ui-&gt;addr.sllc_dsap
op_assign
id|newllc_core-&gt;daddr.lsap
suffix:semicolon
multiline_comment|/* put original socket back into a clean listen state. */
id|sk-&gt;state
op_assign
id|TCP_LISTEN
suffix:semicolon
id|sk-&gt;ack_backlog
op_decrement
suffix:semicolon
id|llc_ui_insert_socket
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|skb-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|frees
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_recvmsg - copy received data to the socket user.&n; *&t;@sock: Socket to copy data from.&n; *&t;@msg: Various user space related information.&n; *&t;@size: Size of user buffer.&n; *&t;@flags: User specified flags.&n; *&t;@scm: Unknown.&n; *&n; *&t;Copy received data to the socket user.&n; *&t;Returns non-negative upon success, negative otherwise.&n; */
DECL|function|llc_ui_recvmsg
r_static
r_int
id|llc_ui_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|uaddr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
comma
id|copied
op_assign
l_int|0
suffix:semicolon
r_int
id|noblock
op_assign
id|flags
op_amp
id|MSG_DONTWAIT
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|skb
op_assign
id|skb_recv_datagram
c_func
(paren
id|sk
comma
id|flags
comma
id|noblock
comma
op_amp
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|out
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|size
)paren
(brace
id|copied
op_assign
id|size
suffix:semicolon
id|msg-&gt;msg_flags
op_or_assign
id|MSG_TRUNC
suffix:semicolon
)brace
id|rc
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|dgram_free
suffix:semicolon
r_if
c_cond
(paren
id|uaddr
)paren
id|memcpy
c_func
(paren
id|uaddr
comma
id|llc_ui_skb_cb
c_func
(paren
id|skb
)paren
comma
r_sizeof
(paren
op_star
id|uaddr
)paren
)paren
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
op_star
id|uaddr
)paren
suffix:semicolon
id|dgram_free
suffix:colon
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
multiline_comment|/* Free the datagram. */
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
ques
c_cond
suffix:colon
id|copied
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_sendmsg - Transmit data provided by the socket user.&n; *&t;@sock: Socket to transmit data from.&n; *&t;@msg: Various user related information.&n; *&t;@len: Length of data to transmit.&n; *&t;@scm: Unknown.&n; *&n; *&t;Transmit data provided by the socket user.&n; *&t;Returns non-negative upon success, negative otherwise.&n; */
DECL|function|llc_ui_sendmsg
r_static
r_int
id|llc_ui_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
comma
r_struct
id|scm_cookie
op_star
id|scm
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_int
id|flags
op_assign
id|msg-&gt;msg_flags
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EOPNOTSUPP
comma
id|size
op_assign
l_int|0
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
id|MSG_DONTWAIT
)paren
r_goto
id|release
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|release
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|llc_ui_addr_null
c_func
(paren
op_amp
id|llc_ui-&gt;addr
)paren
)paren
r_goto
id|release
suffix:semicolon
id|addr
op_assign
op_amp
id|llc_ui-&gt;addr
suffix:semicolon
)brace
multiline_comment|/* must bind connection to sap if user hasn&squot;t done it. */
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
(brace
multiline_comment|/* bind to sap with null dev, exclusive. */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|release
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;dev
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|release
suffix:semicolon
)brace
r_else
id|dev
op_assign
id|llc_ui-&gt;dev
suffix:semicolon
id|size
op_assign
id|dev-&gt;hard_header_len
op_plus
id|len
op_plus
id|llc_ui_header_len
c_func
(paren
id|sk
comma
id|addr
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EMSGSIZE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|dev-&gt;mtu
)paren
r_goto
id|release
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|size
comma
id|flags
op_amp
id|MSG_DONTWAIT
comma
op_amp
id|rc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|release
suffix:semicolon
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|dev-&gt;hard_header_len
op_plus
id|llc_ui_header_len
c_func
(paren
id|sk
comma
id|addr
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|len
)paren
comma
id|msg-&gt;msg_iov
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|release
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_test
)paren
(brace
id|rc
op_assign
id|llc_ui_send_llc1
c_func
(paren
id|llc_ui-&gt;sap
comma
id|skb
comma
id|addr
comma
id|LLC_TEST_PRIM
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;sllc_xid
)paren
(brace
id|rc
op_assign
id|llc_ui_send_llc1
c_func
(paren
id|llc_ui-&gt;sap
comma
id|skb
comma
id|addr
comma
id|LLC_XID_PRIM
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sk-&gt;type
op_eq
id|SOCK_DGRAM
op_logical_or
id|addr-&gt;sllc_ua
)paren
(brace
id|rc
op_assign
id|llc_ui_send_llc1
c_func
(paren
id|llc_ui-&gt;sap
comma
id|skb
comma
id|addr
comma
id|LLC_DATAUNIT_PRIM
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sk-&gt;type
op_eq
id|SOCK_STREAM
op_logical_and
op_logical_neg
id|addr-&gt;sllc_ua
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;core_sk
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|llc_ui_send_data
c_func
(paren
id|llc_ui-&gt;sap
comma
id|sk
comma
id|skb
comma
id|addr
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|rc
)paren
id|skb_free_datagram
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
id|release
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
ques
c_cond
suffix:colon
id|len
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_getname - return the address info of a socket&n; *&t;@sock: Socket to get address of.&n; *&t;@uaddr: Address structure to return information.&n; *&t;@uaddrlen: Length of address structure.&n; *&t;@peer: Does user want local or remote address information.&n; *&n; *&t;Return the address information of a socket.&n; */
DECL|function|llc_ui_getname
r_static
r_int
id|llc_ui_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddrlen
comma
r_int
id|peer
)paren
(brace
r_struct
id|sockaddr_llc
id|sllc
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;zapped
)paren
r_goto
id|out
suffix:semicolon
op_star
id|uaddrlen
op_assign
r_sizeof
(paren
id|sllc
)paren
suffix:semicolon
id|memset
c_func
(paren
id|uaddr
comma
l_int|0
comma
op_star
id|uaddrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;dev
)paren
(brace
id|sllc.sllc_arphrd
op_assign
id|llc_ui-&gt;dev-&gt;type
suffix:semicolon
)brace
id|sllc.sllc_dsap
op_assign
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
op_member_access_from_pointer
id|daddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sllc.sllc_dmac
comma
op_amp
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
op_member_access_from_pointer
id|daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;sap
)paren
r_goto
id|out
suffix:semicolon
id|sllc.sllc_ssap
op_assign
id|llc_ui-&gt;sap-&gt;laddr.lsap
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;dev
)paren
(brace
id|sllc.sllc_arphrd
op_assign
id|llc_ui-&gt;dev-&gt;type
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sllc.sllc_smac
comma
op_amp
id|llc_ui-&gt;dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|sllc.sllc_family
op_assign
id|AF_LLC
suffix:semicolon
id|memcpy
c_func
(paren
id|uaddr
comma
op_amp
id|sllc
comma
r_sizeof
(paren
id|sllc
)paren
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ioctl - io controls for PF_LLC&n; *&t;@sock: Socket to get/set info&n; *&t;@cmd: command&n; *&t;@arg: optional argument for cmd&n; *&n; *&t;get/set info on llc sockets&n; */
DECL|function|llc_ui_ioctl
r_static
r_int
id|llc_ui_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_setsockopt - set various connection specific parameters.&n; *&t;@sock: Socket to set options on.&n; *&t;@level: Socket level user is requesting operations on.&n; *&t;@optname: Operation name.&n; *&t;@optval User provided operation data.&n; *&t;@optlen: Length of optval.&n; *&n; *&t;Set various connection specific parameters.&n; */
DECL|function|llc_ui_setsockopt
r_static
r_int
id|llc_ui_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc_core
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
comma
id|opt
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_LLC
op_logical_or
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;core_sk
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|get_user
c_func
(paren
id|opt
comma
(paren
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|llc_core
op_assign
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|LLC_OPT_RETRY
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_RETRY
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;n2
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_SIZE
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_SIZE
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;n1
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_ACK_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_ACK_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;ack_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_P_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_P_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;pf_cycle_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_REJ_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_REJ_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;rej_sent_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_BUSY_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_BUSY_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;busy_state_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_TX_WIN
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_WIN
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;k
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_RX_WIN
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_WIN
)paren
r_goto
id|out
suffix:semicolon
id|llc_core-&gt;rw
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_getsockopt - get connection specific socket info&n; *&t;@sock: Socket to get information from.&n; *&t;@level: Socket level user is requesting operations on.&n; *&t;@optname: Operation name.&n; *&t;@optval: Variable to return operation data in.&n; *&t;@optlen: Length of optval.&n; *&n; *&t;Get connection specific socket information.&n; */
DECL|function|llc_ui_getsockopt
r_static
r_int
id|llc_ui_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc_core
suffix:semicolon
r_int
id|val
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
comma
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_LLC
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_ui-&gt;core_sk
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_goto
id|out
suffix:semicolon
id|llc_core
op_assign
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|LLC_OPT_RETRY
suffix:colon
id|val
op_assign
id|llc_core-&gt;n2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_SIZE
suffix:colon
id|val
op_assign
id|llc_core-&gt;n1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_ACK_TMR_EXP
suffix:colon
id|val
op_assign
id|llc_core-&gt;ack_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_P_TMR_EXP
suffix:colon
id|val
op_assign
id|llc_core-&gt;pf_cycle_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_REJ_TMR_EXP
suffix:colon
id|val
op_assign
id|llc_core-&gt;rej_sent_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_BUSY_TMR_EXP
suffix:colon
id|val
op_assign
id|llc_core-&gt;busy_state_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_TX_WIN
suffix:colon
id|val
op_assign
id|llc_core-&gt;k
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_RX_WIN
suffix:colon
id|val
op_assign
id|llc_core-&gt;rw
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|len
comma
id|optlen
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|val
comma
id|len
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ind_test - handle TEST indication&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle TEST indication.&n; */
DECL|function|llc_ui_ind_test
r_static
r_void
id|llc_ui_ind_test
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_test
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;test
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|prim_data-&gt;skb
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|llc_ui
op_assign
id|llc_ui_skb_cb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_ui_find_sk_by_addr
c_func
(paren
op_amp
id|prim_data-&gt;daddr
comma
op_amp
id|prim_data-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
r_goto
id|out_put
suffix:semicolon
multiline_comment|/* save primitive for use by the user. */
id|llc_ui-&gt;sllc_family
op_assign
id|AF_LLC
suffix:semicolon
id|llc_ui-&gt;sllc_arphrd
op_assign
id|skb-&gt;dev-&gt;type
suffix:semicolon
id|llc_ui-&gt;sllc_test
op_assign
l_int|1
suffix:semicolon
id|llc_ui-&gt;sllc_xid
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_ua
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_dsap
op_assign
id|prim_data-&gt;daddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_dmac
comma
id|prim_data-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|llc_ui-&gt;sllc_ssap
op_assign
id|prim_data-&gt;saddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_smac
comma
id|prim_data-&gt;saddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
multiline_comment|/* queue skb to the user. */
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ind_xid - handle XID indication&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle XID indication.&n; */
DECL|function|llc_ui_ind_xid
r_static
r_void
id|llc_ui_ind_xid
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_xid
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;xid
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|prim_data-&gt;skb
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|llc_ui
op_assign
id|llc_ui_skb_cb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_ui_find_sk_by_addr
c_func
(paren
op_amp
id|prim_data-&gt;daddr
comma
op_amp
id|prim_data-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
r_goto
id|out_put
suffix:semicolon
multiline_comment|/* save primitive for use by the user. */
id|llc_ui-&gt;sllc_family
op_assign
id|AF_LLC
suffix:semicolon
id|llc_ui-&gt;sllc_arphrd
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_test
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_xid
op_assign
l_int|1
suffix:semicolon
id|llc_ui-&gt;sllc_ua
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_dsap
op_assign
id|prim_data-&gt;daddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_dmac
comma
id|prim_data-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|llc_ui-&gt;sllc_ssap
op_assign
id|prim_data-&gt;saddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_smac
comma
id|prim_data-&gt;saddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
multiline_comment|/* queue skb to the user. */
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ind_dataunit - handle DATAUNIT indication&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle DATAUNIT indication.&n; */
DECL|function|llc_ui_ind_dataunit
r_static
r_void
id|llc_ui_ind_dataunit
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_unit_data
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;udata
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
op_assign
id|prim_data-&gt;skb
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|llc_ui
op_assign
id|llc_ui_skb_cb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_ui_find_sk_by_addr
c_func
(paren
op_amp
id|prim_data-&gt;daddr
comma
op_amp
id|prim_data-&gt;saddr
comma
id|skb-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;state
op_eq
id|TCP_LISTEN
)paren
r_goto
id|out_put
suffix:semicolon
multiline_comment|/* save primitive for use by the user. */
id|llc_ui-&gt;sllc_family
op_assign
id|AF_LLC
suffix:semicolon
id|llc_ui-&gt;sllc_arphrd
op_assign
id|skb-&gt;dev-&gt;type
suffix:semicolon
id|llc_ui-&gt;sllc_test
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_xid
op_assign
l_int|0
suffix:semicolon
id|llc_ui-&gt;sllc_ua
op_assign
l_int|1
suffix:semicolon
id|llc_ui-&gt;sllc_dsap
op_assign
id|prim_data-&gt;daddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_dmac
comma
id|prim_data-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|llc_ui-&gt;sllc_ssap
op_assign
id|prim_data-&gt;saddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc_ui-&gt;sllc_smac
comma
id|prim_data-&gt;saddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
multiline_comment|/* queue skb to the user. */
r_if
c_cond
(paren
id|sock_queue_rcv_skb
c_func
(paren
id|sk
comma
id|skb
)paren
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ind_conn - handle CONNECT indication&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle CONNECT indication.&n; */
DECL|function|llc_ui_ind_conn
r_static
r_void
id|llc_ui_ind_conn
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_conn
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;conn
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|laddr.lsap
op_assign
id|prim-&gt;sap-&gt;laddr.lsap
suffix:semicolon
id|sk
op_assign
id|llc_ui_find_sk_by_addr
c_func
(paren
op_amp
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|laddr
comma
op_amp
id|prim_data-&gt;saddr
comma
id|prim_data-&gt;dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_LISTEN
)paren
r_goto
id|out_put
suffix:semicolon
r_if
c_cond
(paren
id|prim-&gt;data-&gt;conn.status
)paren
r_goto
id|out_put
suffix:semicolon
multiline_comment|/* bad status. */
multiline_comment|/* give this connection a link number. */
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|link
op_assign
id|llc_ui_next_link_no
c_func
(paren
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|laddr.lsap
)paren
suffix:semicolon
id|skb2
op_assign
id|alloc_skb
c_func
(paren
l_int|0
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb2
)paren
r_goto
id|out_put
suffix:semicolon
id|skb2-&gt;sk
op_assign
id|prim_data-&gt;sk
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|sk-&gt;receive_queue
comma
id|skb2
)paren
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ind_disc - handle DISC indication&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle DISC indication.&n; */
DECL|function|llc_ui_ind_disc
r_static
r_void
id|llc_ui_ind_disc
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_disc
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;disc
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|handler
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out_put
suffix:semicolon
id|llc_ui_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|core_sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;shutdown
op_assign
id|SHUTDOWN_MASK
suffix:semicolon
id|sk-&gt;socket-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;dead
)paren
(brace
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|sk-&gt;dead
op_assign
l_int|1
suffix:semicolon
)brace
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_indicate - LLC user interface hook into the LLC layer.&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;LLC user interface hook into the LLC layer, every llc_ui sap references&n; *&t;this function as its indicate handler.&n; *&t;Always returns 0 to indicate reception of primitive.&n; */
DECL|function|llc_ui_indicate
r_static
r_int
id|llc_ui_indicate
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_switch
c_cond
(paren
id|prim-&gt;prim
)paren
(brace
r_case
id|LLC_TEST_PRIM
suffix:colon
id|llc_ui_ind_test
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_XID_PRIM
suffix:colon
id|llc_ui_ind_xid
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_DATAUNIT_PRIM
suffix:colon
id|llc_ui_ind_dataunit
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_CONN_PRIM
suffix:colon
id|llc_ui_ind_conn
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_DATA_PRIM
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: shouldn&squot;t happen, LLC_DATA_PRIM &quot;
l_string|&quot;is gone for -&gt;ind()...&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_DISC_PRIM
suffix:colon
id|llc_ui_ind_disc
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_RESET_PRIM
suffix:colon
r_case
id|LLC_FLOWCONTROL_PRIM
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_conf_conn - handle CONN confirm.&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle CONN confirm.&n; */
DECL|function|llc_ui_conf_conn
r_static
r_void
id|llc_ui_conf_conn
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_conn
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;conn
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc_core
op_assign
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_core-&gt;handler
suffix:semicolon
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_SYN_SENT
)paren
r_goto
id|out_put
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prim-&gt;data-&gt;conn.status
)paren
(brace
id|sk-&gt;socket-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
id|llc_ui-&gt;core_sk
op_assign
id|prim_data-&gt;sk
suffix:semicolon
)brace
r_else
(brace
id|sk-&gt;socket-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|llc_ui-&gt;core_sk
op_assign
l_int|NULL
suffix:semicolon
)brace
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_conf_disc - handle DISC confirm.&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;handle DISC confirm.&n; */
DECL|function|llc_ui_conf_disc
r_static
r_void
id|llc_ui_conf_disc
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_struct
id|llc_prim_disc
op_star
id|prim_data
op_assign
op_amp
id|prim-&gt;data-&gt;disc
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|llc_sk
c_func
(paren
id|prim_data-&gt;sk
)paren
op_member_access_from_pointer
id|handler
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;type
op_ne
id|SOCK_STREAM
op_logical_or
id|sk-&gt;state
op_ne
id|TCP_CLOSING
)paren
r_goto
id|out_put
suffix:semicolon
id|llc_ui_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|core_sk
op_assign
l_int|NULL
suffix:semicolon
id|sk-&gt;socket-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk-&gt;state
op_assign
id|TCP_CLOSE
suffix:semicolon
id|sk
op_member_access_from_pointer
id|state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out_put
suffix:colon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_confirm - LLC user interface hook into the LLC layer&n; *&t;@prim: Primitive block provided by the llc layer.&n; *&n; *&t;LLC user interface hook into the LLC layer, every llc_ui sap references&n; *&t;this function as its confirm handler.&n; *&t;Always returns 0 to indicate reception of primitive.&n; */
DECL|function|llc_ui_confirm
r_static
r_int
id|llc_ui_confirm
c_func
(paren
r_struct
id|llc_prim_if_block
op_star
id|prim
)paren
(brace
r_switch
c_cond
(paren
id|prim-&gt;prim
)paren
(brace
r_case
id|LLC_CONN_PRIM
suffix:colon
id|llc_ui_conf_conn
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_DATA_PRIM
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: shouldn&squot;t happen, LLC_DATA_PRIM &quot;
l_string|&quot;is gone for -&gt;conf()...&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_DISC_PRIM
suffix:colon
id|llc_ui_conf_disc
c_func
(paren
id|prim
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_RESET_PRIM
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unknown prim %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|prim-&gt;prim
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|macro|MAC_FORMATTED_SIZE
mdefine_line|#define MAC_FORMATTED_SIZE 17
DECL|function|llc_ui_format_mac
r_static
r_void
id|llc_ui_format_mac
c_func
(paren
r_char
op_star
id|bf
comma
r_int
r_char
op_star
id|mac
)paren
(brace
id|sprintf
c_func
(paren
id|bf
comma
l_string|&quot;%02X:%02X:%02X:%02X:%02X:%02X&quot;
comma
id|mac
(braket
l_int|0
)braket
comma
id|mac
(braket
l_int|1
)braket
comma
id|mac
(braket
l_int|2
)braket
comma
id|mac
(braket
l_int|3
)braket
comma
id|mac
(braket
l_int|4
)braket
comma
id|mac
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_get_info - return info to procfs&n; *&t;@buffer: where to put the formatted output&n; *&t;@start: starting from&n; *&t;@offset: offset into buffer.&n; *&t;@length: size of the buffer&n; *&n; *&t;Get the output of the local llc ui socket list to the caller.&n; *&t;Returns the length of data wrote to buffer.&n; */
DECL|function|llc_ui_get_info
r_static
r_int
id|llc_ui_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
id|off_t
id|pos
op_assign
l_int|0
suffix:semicolon
id|off_t
id|begin
op_assign
l_int|0
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
r_int
id|len
op_assign
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SocketID SKt Mc local_mac_sap&bslash;t  &quot;
l_string|&quot;remote_mac_sap&bslash;t tx_queue rx_queue st uid &quot;
l_string|&quot;link_no&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Output the LLC socket data for the /proc filesystem */
id|read_lock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|s
op_assign
id|llc_ui_sockets
suffix:semicolon
id|s
suffix:semicolon
id|s
op_assign
id|s-&gt;next
)paren
(brace
r_struct
id|llc_ui_opt
op_star
id|llc_ui
op_assign
id|llc_ui_sk
c_func
(paren
id|s
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%p %02X  %02X &quot;
comma
id|s
comma
id|s-&gt;type
comma
op_logical_neg
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;sap
)paren
(brace
r_if
c_cond
(paren
id|llc_ui-&gt;dev
op_logical_and
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
)paren
id|llc_ui_format_mac
c_func
(paren
id|buffer
op_plus
id|len
comma
id|llc_ui-&gt;dev-&gt;dev_addr
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|llc_ui-&gt;addr.sllc_mmac
)paren
)paren
id|llc_ui_format_mac
c_func
(paren
id|buffer
op_plus
id|len
comma
id|llc_ui-&gt;addr.sllc_mmac
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;00:00:00:00:00:00&quot;
)paren
suffix:semicolon
)brace
id|len
op_add_assign
id|MAC_FORMATTED_SIZE
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;@%02X &quot;
comma
id|llc_ui-&gt;sap-&gt;laddr.lsap
)paren
suffix:semicolon
)brace
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;00:00:00:00:00:00@00 &quot;
)paren
suffix:semicolon
id|llc_ui_format_mac
c_func
(paren
id|buffer
op_plus
id|len
comma
id|llc_ui-&gt;addr.sllc_dmac
)paren
suffix:semicolon
id|len
op_add_assign
id|MAC_FORMATTED_SIZE
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;@%02X %08d:%08d %02d %-3d &quot;
comma
id|llc_ui-&gt;addr.sllc_dsap
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;wmem_alloc
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|s-&gt;rmem_alloc
)paren
comma
id|s-&gt;state
comma
id|SOCK_INODE
c_func
(paren
id|s-&gt;socket
)paren
op_member_access_from_pointer
id|i_uid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc_ui-&gt;core_sk
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;%-7d&bslash;n&quot;
comma
id|llc_sk
c_func
(paren
id|llc_ui-&gt;core_sk
)paren
op_member_access_from_pointer
id|link
)paren
suffix:semicolon
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;no_link&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Are we still dumping unwanted data then discard the record */
id|pos
op_assign
id|begin
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|offset
)paren
(brace
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Keep dumping into the buffer start */
id|begin
op_assign
id|pos
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pos
OG
id|offset
op_plus
id|length
)paren
multiline_comment|/* We have dumped enough */
r_break
suffix:semicolon
)brace
id|read_unlock_bh
c_func
(paren
op_amp
id|llc_ui_sockets_lock
)paren
suffix:semicolon
multiline_comment|/* The data in question runs from begin to begin + len */
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
op_minus
id|begin
suffix:semicolon
multiline_comment|/* Start of wanted data */
id|len
op_sub_assign
id|offset
op_minus
id|begin
suffix:semicolon
multiline_comment|/* Remove unwanted header data from length */
r_if
c_cond
(paren
id|len
OG
id|length
)paren
id|len
op_assign
id|length
suffix:semicolon
multiline_comment|/* Remove unwanted tail data from length */
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
DECL|variable|llc_ui_family_ops
r_static
r_struct
id|net_proto_family
id|llc_ui_family_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_LLC
comma
dot
id|create
op_assign
id|llc_ui_create
comma
)brace
suffix:semicolon
DECL|variable|llc_ui_ops
r_static
r_struct
id|proto_ops
id|SOCKOPS_WRAPPED
c_func
(paren
id|llc_ui_ops
)paren
op_assign
(brace
dot
id|family
op_assign
id|PF_LLC
comma
dot
id|release
op_assign
id|llc_ui_release
comma
dot
id|bind
op_assign
id|llc_ui_bind
comma
dot
id|connect
op_assign
id|llc_ui_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|llc_ui_accept
comma
dot
id|getname
op_assign
id|llc_ui_getname
comma
dot
id|poll
op_assign
id|datagram_poll
comma
dot
id|ioctl
op_assign
id|llc_ui_ioctl
comma
dot
id|listen
op_assign
id|llc_ui_listen
comma
dot
id|shutdown
op_assign
id|llc_ui_shutdown
comma
dot
id|setsockopt
op_assign
id|llc_ui_setsockopt
comma
dot
id|getsockopt
op_assign
id|llc_ui_getsockopt
comma
dot
id|sendmsg
op_assign
id|llc_ui_sendmsg
comma
dot
id|recvmsg
op_assign
id|llc_ui_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
)brace
suffix:semicolon
macro_line|#include &lt;linux/smp_lock.h&gt;
id|SOCKOPS_WRAP
c_func
(paren
id|llc_ui
comma
id|PF_LLC
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|llc_ui_banner
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
l_string|&quot;NET4.0 IEEE 802.2 User Interface SAPs, Jay Schulist, 2001&bslash;n&quot;
suffix:semicolon
DECL|function|llc_ui_init
r_int
id|__init
id|llc_ui_init
c_func
(paren
r_void
)paren
(brace
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
id|sock_register
c_func
(paren
op_amp
id|llc_ui_family_ops
)paren
suffix:semicolon
id|proc_net_create
c_func
(paren
l_string|&quot;llc&quot;
comma
l_int|0
comma
id|llc_ui_get_info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|llc_ui_banner
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|llc_ui_exit
r_void
id|__exit
id|llc_ui_exit
c_func
(paren
r_void
)paren
(brace
id|proc_net_remove
c_func
(paren
l_string|&quot;llc&quot;
)paren
suffix:semicolon
id|sock_unregister
c_func
(paren
id|PF_LLC
)paren
suffix:semicolon
)brace
eof
