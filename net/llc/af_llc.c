multiline_comment|/*&n; * af_llc.c - LLC User Interface SAPs&n; * Description:&n; *   Functions in this module are implementation of socket based llc&n; *   communications for the Linux operating system. Support of llc class&n; *   one and class two is provided via SOCK_DGRAM and SOCK_STREAM&n; *   respectively.&n; *&n; *   An llc2 connection is (mac + sap), only one llc2 sap connection&n; *   is allowed per mac. Though one sap may have multiple mac + sap&n; *   connections.&n; *&n; * Copyright (c) 2001 by Jay Schulist &lt;jschlst@samba.org&gt;&n; *&t;&t; 2002-2003 by Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; *&n; * This program can be redistributed or modified under the terms of the&n; * GNU General Public License as published by the Free Software Foundation.&n; * This program is distributed without any warranty or implied warranty&n; * of merchantability or fitness for a particular purpose.&n; *&n; * See the GNU General Public License for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;net/llc_sap.h&gt;
macro_line|#include &lt;net/llc_pdu.h&gt;
macro_line|#include &lt;net/llc_conn.h&gt;
macro_line|#include &lt;net/llc_mac.h&gt;
macro_line|#include &lt;net/llc_main.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/init.h&gt;
multiline_comment|/* remember: uninitialized global data is zeroed because its in .bss */
DECL|variable|llc_ui_sap_last_autoport
r_static
id|u16
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
DECL|variable|llc_ui_sap_link_no_max
r_static
id|u16
id|llc_ui_sap_link_no_max
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|llc_ui_addrnull
r_static
r_struct
id|sockaddr_llc
id|llc_ui_addrnull
suffix:semicolon
DECL|variable|llc_ui_ops
r_static
r_struct
id|proto_ops
id|llc_ui_ops
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_conn
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
r_static
r_int
id|llc_ui_wait_for_busy_core
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
suffix:semicolon
macro_line|#if 0
mdefine_line|#define dprintk(args...) printk(KERN_DEBUG args)
macro_line|#else
DECL|macro|dprintk
mdefine_line|#define dprintk(args...)
macro_line|#endif
multiline_comment|/**&n; *&t;llc_ui_next_link_no - return the next unused link number for a sap&n; *&t;@sap: Address of sap to get link number from.&n; *&n; *&t;Return the next unused link number for a given sap.&n; */
DECL|function|llc_ui_next_link_no
r_static
id|__inline__
id|u16
id|llc_ui_next_link_no
c_func
(paren
r_int
id|sap
)paren
(brace
r_return
id|llc_ui_sap_link_no_max
(braket
id|sap
)braket
op_increment
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_proto_type - return eth protocol for ARP header type&n; *&t;@arphrd: ARP header type.&n; *&n; *&t;Given an ARP header type return the corresponding ethernet protocol.&n; */
DECL|function|llc_proto_type
r_static
id|__inline__
id|u16
id|llc_proto_type
c_func
(paren
id|u16
id|arphrd
)paren
(brace
r_return
id|arphrd
op_eq
id|ARPHRD_IEEE802_TR
ques
c_cond
id|htons
c_func
(paren
id|ETH_P_TR_802_2
)paren
suffix:colon
id|htons
c_func
(paren
id|ETH_P_802_2
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_addr_null - determines if a address structure is null&n; *&t;@addr: Address to test if null.&n; */
DECL|function|llc_ui_addr_null
r_static
id|__inline__
id|u8
id|llc_ui_addr_null
c_func
(paren
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
r_return
op_logical_neg
id|memcmp
c_func
(paren
id|addr
comma
op_amp
id|llc_ui_addrnull
comma
r_sizeof
(paren
op_star
id|addr
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_header_len - return length of llc header based on operation&n; *&t;@sk: Socket which contains a valid llc socket type.&n; *&t;@addr: Complete sockaddr_llc structure received from the user.&n; *&n; *&t;Provide the length of the llc header depending on what kind of&n; *&t;operation the user would like to perform and the type of socket.&n; *&t;Returns the correct llc header length.&n; */
DECL|function|llc_ui_header_len
r_static
id|__inline__
id|u8
id|llc_ui_header_len
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
id|u8
id|rc
op_assign
id|LLC_PDU_LEN_U
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_test
op_logical_or
id|addr-&gt;sllc_xid
)paren
id|rc
op_assign
id|LLC_PDU_LEN_U
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_STREAM
)paren
id|rc
op_assign
id|LLC_PDU_LEN_I
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_send_data - send data via reliable llc2 connection&n; *&t;@sk: Connection the socket is using.&n; *&t;@skb: Data the user wishes to send.&n; *&t;@addr: Source and destination fields provided by the user.&n; *&t;@noblock: can we block waiting for data?&n; *&n; *&t;Send data via reliable llc2 connection.&n; *&t;Returns 0 upon success, non-zero if action did not succeed.&n; */
DECL|function|llc_ui_send_data
r_static
r_int
id|llc_ui_send_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|noblock
)paren
(brace
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|llc_data_accept_state
c_func
(paren
id|llc-&gt;state
)paren
op_logical_or
id|llc-&gt;p_flag
)paren
(brace
r_int
id|timeout
op_assign
id|sock_sndtimeo
c_func
(paren
id|sk
comma
id|noblock
)paren
suffix:semicolon
id|rc
op_assign
id|llc_ui_wait_for_busy_core
c_func
(paren
id|sk
comma
id|timeout
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|rc
op_assign
id|llc_build_and_send_pkt
c_func
(paren
id|sk
comma
id|skb
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_sk_init
r_static
r_void
id|llc_ui_sk_init
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sock
op_star
id|sk
)paren
(brace
id|sk-&gt;sk_type
op_assign
id|sock-&gt;type
suffix:semicolon
id|sk-&gt;sk_sleep
op_assign
op_amp
id|sock-&gt;wait
suffix:semicolon
id|sk-&gt;sk_socket
op_assign
id|sock
suffix:semicolon
id|sock-&gt;sk
op_assign
id|sk
suffix:semicolon
id|sock-&gt;ops
op_assign
op_amp
id|llc_ui_ops
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_create - alloc and init a new llc_ui socket&n; *&t;@sock: Socket to initialize and attach allocated sk to.&n; *&t;@protocol: Unused.&n; *&n; *&t;Allocate and initialize a new llc_ui socket, validate the user wants a&n; *&t;socket type we have available.&n; *&t;Returns 0 upon success, negative upon failure.&n; */
DECL|function|llc_ui_create
r_static
r_int
id|llc_ui_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|protocol
)paren
(brace
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ESOCKTNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;type
op_eq
id|SOCK_DGRAM
op_logical_or
id|sock-&gt;type
op_eq
id|SOCK_STREAM
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|sk
op_assign
id|llc_sk_alloc
c_func
(paren
id|PF_LLC
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk
)paren
(brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|llc_ui_sk_init
c_func
(paren
id|sock
comma
id|sk
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_release - shutdown socket&n; *&t;@sock: Socket to release.&n; *&n; *&t;Shutdown and deallocate an existing socket.&n; */
DECL|function|llc_ui_release
r_static
r_int
id|llc_ui_release
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk
)paren
r_goto
id|out
suffix:semicolon
id|sock_hold
c_func
(paren
id|sk
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: closing local(%02X) remote(%02X)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc-&gt;laddr.lsap
comma
id|llc-&gt;daddr.lsap
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_send_disc
c_func
(paren
id|sk
)paren
)paren
id|llc_ui_wait_for_disc
c_func
(paren
id|sk
comma
id|sk-&gt;sk_rcvtimeo
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sk_zapped
)paren
id|llc_sap_unassign_sock
c_func
(paren
id|llc-&gt;sap
comma
id|sk
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|llc-&gt;sap
op_logical_and
id|hlist_empty
c_func
(paren
op_amp
id|llc-&gt;sap-&gt;sk_list.list
)paren
)paren
id|llc_sap_close
c_func
(paren
id|llc-&gt;sap
)paren
suffix:semicolon
id|sock_put
c_func
(paren
id|sk
)paren
suffix:semicolon
id|llc_sk_free
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_autoport - provide dynamically allocate SAP number&n; *&n; *&t;Provide the caller with a dynamically allocated SAP number according&n; *&t;to the rules that are set in this function. Returns: 0, upon failure,&n; *&t;SAP number otherwise.&n; */
DECL|function|llc_ui_autoport
r_static
r_int
id|llc_ui_autoport
c_func
(paren
r_void
)paren
(brace
r_struct
id|llc_sap
op_star
id|sap
suffix:semicolon
r_int
id|i
comma
id|tries
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|tries
OL
id|LLC_SAP_DYN_TRIES
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|llc_ui_sap_last_autoport
suffix:semicolon
id|i
OL
id|LLC_SAP_DYN_STOP
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
id|sap
op_assign
id|llc_sap_find
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
(brace
id|llc_ui_sap_last_autoport
op_assign
id|i
op_plus
l_int|2
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
id|tries
op_increment
suffix:semicolon
)brace
id|i
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|i
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_autobind - Bind a socket to a specific address.&n; *&t;@sk: Socket to bind an address to.&n; *&t;@addr: Address the user wants the socket bound to.&n; *&n; *&t;Bind a socket to a specific address. For llc a user is able to bind to&n; *&t;a specific sap only or mac + sap. If the user only specifies a sap and&n; *&t;a null dmac (all zeros) the user is attempting to bind to an entire&n; *&t;sap. This will stop anyone else on the local system from using that&n; *&t;sap.  If someone else has a mac + sap open the bind to null + sap will&n; *&t;fail.&n; *&t;If the user desires to bind to a specific mac + sap, it is possible to&n; *&t;have multiple sap connections via multiple macs.&n; *&t;Bind and autobind for that matter must enforce the correct sap usage&n; *&t;otherwise all hell will break loose.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_autobind
r_static
r_int
id|llc_ui_autobind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr_llc
op_star
id|addr
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|llc_sap
op_star
id|sap
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sk_zapped
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* bind to a specific mac, optional. */
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_smac
)paren
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;dev
op_assign
id|dev
suffix:semicolon
)brace
multiline_comment|/* bind to a specific sap, optional. */
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;sllc_ssap
)paren
(brace
id|rc
op_assign
op_minus
id|EUSERS
suffix:semicolon
id|addr-&gt;sllc_ssap
op_assign
id|llc_ui_autoport
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|addr-&gt;sllc_ssap
)paren
r_goto
id|out
suffix:semicolon
)brace
id|sap
op_assign
id|llc_sap_find
c_func
(paren
id|addr-&gt;sllc_ssap
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
(brace
id|sap
op_assign
id|llc_sap_open
c_func
(paren
id|addr-&gt;sllc_ssap
comma
l_int|NULL
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* some other network layer is using the sap */
r_if
c_cond
(paren
op_logical_neg
id|sap
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
r_struct
id|llc_addr
id|laddr
comma
id|daddr
suffix:semicolon
r_struct
id|sock
op_star
id|ask
suffix:semicolon
id|rc
op_assign
op_minus
id|EUSERS
suffix:semicolon
multiline_comment|/* can&squot;t get exclusive use of sap */
r_if
c_cond
(paren
op_logical_neg
id|dev
op_logical_and
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_mmac
)paren
)paren
r_goto
id|out
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|laddr
comma
l_int|0
comma
r_sizeof
(paren
id|laddr
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|daddr
comma
l_int|0
comma
r_sizeof
(paren
id|daddr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc_mac_null
c_func
(paren
id|addr-&gt;sllc_mmac
)paren
)paren
(brace
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_ne
id|SOCK_DGRAM
)paren
(brace
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|laddr.mac
comma
id|addr-&gt;sllc_mmac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|laddr.mac
comma
id|addr-&gt;sllc_smac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|laddr.lsap
op_assign
id|addr-&gt;sllc_ssap
suffix:semicolon
id|rc
op_assign
op_minus
id|EADDRINUSE
suffix:semicolon
multiline_comment|/* mac + sap clash. */
id|ask
op_assign
id|llc_lookup_established
c_func
(paren
id|sap
comma
op_amp
id|daddr
comma
op_amp
id|laddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ask
)paren
(brace
id|sock_put
c_func
(paren
id|ask
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|llc-&gt;laddr.lsap
op_assign
id|addr-&gt;sllc_ssap
suffix:semicolon
r_if
c_cond
(paren
id|llc-&gt;dev
)paren
id|memcpy
c_func
(paren
id|llc-&gt;laddr.mac
comma
id|llc-&gt;dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|llc-&gt;daddr.lsap
op_assign
id|addr-&gt;sllc_dsap
suffix:semicolon
id|memcpy
c_func
(paren
id|llc-&gt;daddr.mac
comma
id|addr-&gt;sllc_dmac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|llc-&gt;addr
comma
id|addr
comma
r_sizeof
(paren
id|llc-&gt;addr
)paren
)paren
suffix:semicolon
multiline_comment|/* assign new connection to its SAP */
id|llc_sap_assign_sock
c_func
(paren
id|sap
comma
id|sk
)paren
suffix:semicolon
id|rc
op_assign
id|sk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_bind - bind a socket to a specific address.&n; *&t;@sock: Socket to bind an address to.&n; *&t;@uaddr: Address the user wants the socket bound to.&n; *&t;@addrlen: Length of the uaddr structure.&n; *&n; *&t;Bind a socket to a specific address. For llc a user is able to bind to&n; *&t;a specific sap only or mac + sap. If the user only specifies a sap and&n; *&t;a null dmac (all zeros) the user is attempting to bind to an entire&n; *&t;sap. This will stop anyone else on the local system from using that&n; *&t;sap. If someone else has a mac + sap open the bind to null + sap will&n; *&t;fail.&n; *&t;If the user desires to bind to a specific mac + sap, it is possible to&n; *&t;have multiple sap connections via multiple macs.&n; *&t;Bind and autobind for that matter must enforce the correct sap usage&n; *&t;otherwise all hell will break loose.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_bind
r_static
r_int
id|llc_ui_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addrlen
)paren
(brace
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: binding %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|addr-&gt;sllc_ssap
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sk-&gt;sk_zapped
op_logical_or
id|addrlen
op_ne
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAFNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_family
op_ne
id|AF_LLC
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* use autobind, to avoid code replication. */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_shutdown - shutdown a connect llc2 socket.&n; *&t;@sock: Socket to shutdown.&n; *&t;@how: What part of the socket to shutdown.&n; *&n; *&t;Shutdown a connected llc2 socket. Currently this function only supports&n; *&t;shutting down both sends and receives (2), we could probably make this&n; *&t;function such that a user can shutdown only half the connection but not&n; *&t;right now.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_shutdown
r_static
r_int
id|llc_ui_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|how
op_ne
l_int|2
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|llc_send_disc
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|rc
op_assign
id|llc_ui_wait_for_disc
c_func
(paren
id|sk
comma
id|sk-&gt;sk_rcvtimeo
)paren
suffix:semicolon
multiline_comment|/* Wake up anyone sleeping in poll */
id|sk
op_member_access_from_pointer
id|sk_state_change
c_func
(paren
id|sk
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_connect - Connect to a remote llc2 mac + sap.&n; *&t;@sock: Socket which will be connected to the remote destination.&n; *&t;@uaddr: Remote and possibly the local address of the new connection.&n; *&t;@addrlen: Size of uaddr structure.&n; *&t;@flags: Operational flags specified by the user.&n; *&n; *&t;Connect to a remote llc2 mac + sap. The caller must specify the&n; *&t;destination mac and address to connect to. If the user previously&n; *&t;called bind(2) with a smac the user does not need to specify the source&n; *&t;address and mac.&n; *&t;This function will autobind if user did not previously call bind.&n; *&t;Returns: 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_connect
r_static
r_int
id|llc_ui_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
id|addrlen
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|uaddr
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addrlen
op_ne
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAFNOSUPPORT
suffix:semicolon
r_if
c_cond
(paren
id|addr-&gt;sllc_family
op_ne
id|AF_LLC
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* bind connection to sap if user hasn&squot;t done it. */
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
(brace
multiline_comment|/* bind to sap with null dev, exclusive */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|llc-&gt;dev
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;dev
op_assign
id|dev
suffix:semicolon
)brace
r_else
id|dev
op_assign
id|llc-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EALREADY
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_eq
id|SS_CONNECTING
)paren
r_goto
id|out
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_CONNECTING
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_SYN_SENT
suffix:semicolon
id|llc-&gt;link
op_assign
id|llc_ui_next_link_no
c_func
(paren
id|llc-&gt;sap-&gt;laddr.lsap
)paren
suffix:semicolon
id|rc
op_assign
id|llc_establish_connection
c_func
(paren
id|sk
comma
id|dev-&gt;dev_addr
comma
id|addr-&gt;sllc_dmac
comma
id|addr-&gt;sllc_dsap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: llc_ui_send_conn failed :-(&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|sock-&gt;state
op_assign
id|SS_UNCONNECTED
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_CLOSE
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|llc_ui_wait_for_conn
c_func
(paren
id|sk
comma
id|sk-&gt;sk_rcvtimeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: llc_ui_wait_for_conn failed=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|rc
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_listen - allow a normal socket to accept incoming connections&n; *&t;@sock: Socket to allow incoming connections on.&n; *&t;@backlog: Number of connections to queue.&n; *&n; *&t;Allow a normal socket to accept incoming connections.&n; *&t;Returns 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_listen
r_static
r_int
id|llc_ui_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
r_int
)paren
id|backlog
)paren
multiline_comment|/* BSDism */
id|backlog
op_assign
l_int|1
suffix:semicolon
id|sk-&gt;sk_max_ack_backlog
op_assign
id|backlog
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
(brace
id|sk-&gt;sk_ack_backlog
op_assign
l_int|0
suffix:semicolon
id|sk-&gt;sk_state
op_assign
id|TCP_LISTEN
suffix:semicolon
)brace
id|sk-&gt;sk_socket-&gt;flags
op_or_assign
id|__SO_ACCEPTCON
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_disc
r_static
r_int
id|llc_ui_wait_for_disc
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_CLOSE
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_conn
r_static
r_int
id|llc_ui_wait_for_conn
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_eq
id|TCP_CLOSE
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_ESTABLISHED
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_data
r_static
r_int
id|llc_ui_wait_for_data
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|RCV_SHUTDOWN
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Well, if we have backlog, try to process it now.&n;&t;&t; */
r_if
c_cond
(paren
id|sk-&gt;sk_backlog.tail
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|skb_queue_empty
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|llc_ui_wait_for_busy_core
r_static
r_int
id|llc_ui_wait_for_busy_core
c_func
(paren
r_struct
id|sock
op_star
id|sk
comma
r_int
id|timeout
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|add_wait_queue_exclusive
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: looping...&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_shutdown
op_amp
id|RCV_SHUTDOWN
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
id|rc
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|llc_data_accept_state
c_func
(paren
id|llc-&gt;state
)paren
op_logical_or
id|llc-&gt;p_flag
)paren
(brace
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
id|__set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
id|sk-&gt;sk_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_accept - accept a new incoming connection.&n; *&t;@sock: Socket which connections arrive on.&n; *&t;@newsock: Socket to move incoming connection to.&n; *&t;@flags: User specified operational flags.&n; *&n; *&t;Accept a new incoming connection.&n; *&t;Returns 0 upon success, negative otherwise.&n; */
DECL|function|llc_ui_accept
r_static
r_int
id|llc_ui_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
comma
op_star
id|newsk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
comma
op_star
id|newllc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: accepting on %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addr.sllc_ssap
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_ne
id|SOCK_STREAM
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;state
op_ne
id|SS_UNCONNECTED
op_logical_or
id|sk-&gt;sk_state
op_ne
id|TCP_LISTEN
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* wait for a connection to arrive. */
id|rc
op_assign
id|llc_ui_wait_for_data
c_func
(paren
id|sk
comma
id|sk-&gt;sk_rcvtimeo
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: got a new connection on %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addr.sllc_ssap
)paren
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;sk
)paren
r_goto
id|frees
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|newsk
op_assign
id|skb-&gt;sk
suffix:semicolon
multiline_comment|/* attach connection to a new socket. */
id|llc_ui_sk_init
c_func
(paren
id|newsock
comma
id|newsk
)paren
suffix:semicolon
id|newsk-&gt;sk_pair
op_assign
l_int|NULL
suffix:semicolon
id|newsk-&gt;sk_zapped
op_assign
l_int|0
suffix:semicolon
id|newsk-&gt;sk_state
op_assign
id|TCP_ESTABLISHED
suffix:semicolon
id|newsock-&gt;state
op_assign
id|SS_CONNECTED
suffix:semicolon
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
id|newllc
op_assign
id|llc_sk
c_func
(paren
id|newsk
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|newllc-&gt;addr
comma
op_amp
id|llc-&gt;addr
comma
r_sizeof
(paren
id|newllc-&gt;addr
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|newllc-&gt;addr.sllc_dmac
comma
id|newllc-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
id|newllc-&gt;addr.sllc_dsap
op_assign
id|newllc-&gt;daddr.lsap
suffix:semicolon
id|newllc-&gt;link
op_assign
id|llc_ui_next_link_no
c_func
(paren
id|newllc-&gt;laddr.lsap
)paren
suffix:semicolon
multiline_comment|/* put original socket back into a clean listen state. */
id|sk-&gt;sk_state
op_assign
id|TCP_LISTEN
suffix:semicolon
id|sk-&gt;sk_ack_backlog
op_decrement
suffix:semicolon
id|skb-&gt;sk
op_assign
l_int|NULL
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: ok success on %02X, client on %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|addr.sllc_ssap
comma
id|newllc-&gt;addr.sllc_dsap
)paren
suffix:semicolon
id|frees
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_recvmsg - copy received data to the socket user.&n; *&t;@sock: Socket to copy data from.&n; *&t;@msg: Various user space related information.&n; *&t;@size: Size of user buffer.&n; *&t;@flags: User specified flags.&n; *&n; *&t;Copy received data to the socket user.&n; *&t;Returns non-negative upon success, negative otherwise.&n; */
DECL|function|llc_ui_recvmsg
r_static
r_int
id|llc_ui_recvmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|uaddr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENOMEM
comma
id|copied
op_assign
l_int|0
comma
id|timeout
suffix:semicolon
r_int
id|noblock
op_assign
id|flags
op_amp
id|MSG_DONTWAIT
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: receiving in %02X from %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|laddr.lsap
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|daddr.lsap
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|timeout
op_assign
id|sock_rcvtimeo
c_func
(paren
id|sk
comma
id|noblock
)paren
suffix:semicolon
id|rc
op_assign
id|llc_ui_wait_for_data
c_func
(paren
id|sk
comma
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;%s: llc_ui_wait_for_data failed recv &quot;
l_string|&quot;in %02X from %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|laddr.lsap
comma
id|llc_sk
c_func
(paren
id|sk
)paren
op_member_access_from_pointer
id|daddr.lsap
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
multiline_comment|/* shutdown */
r_goto
id|out
suffix:semicolon
id|copied
op_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copied
OG
id|size
)paren
id|copied
op_assign
id|size
suffix:semicolon
id|rc
op_assign
id|skb_copy_datagram_iovec
c_func
(paren
id|skb
comma
l_int|0
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|dgram_free
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|copied
)paren
(brace
id|skb_pull
c_func
(paren
id|skb
comma
id|copied
)paren
suffix:semicolon
id|skb_queue_head
c_func
(paren
op_amp
id|sk-&gt;sk_receive_queue
comma
id|skb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uaddr
)paren
id|memcpy
c_func
(paren
id|uaddr
comma
id|llc_ui_skb_cb
c_func
(paren
id|skb
)paren
comma
r_sizeof
(paren
op_star
id|uaddr
)paren
)paren
suffix:semicolon
id|msg-&gt;msg_namelen
op_assign
r_sizeof
(paren
op_star
id|uaddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb-&gt;list
)paren
(brace
id|dgram_free
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
ques
c_cond
suffix:colon
id|copied
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_sendmsg - Transmit data provided by the socket user.&n; *&t;@sock: Socket to transmit data from.&n; *&t;@msg: Various user related information.&n; *&t;@len: Length of data to transmit.&n; *&n; *&t;Transmit data provided by the socket user.&n; *&t;Returns non-negative upon success, negative otherwise.&n; */
DECL|function|llc_ui_sendmsg
r_static
r_int
id|llc_ui_sendmsg
c_func
(paren
r_struct
id|kiocb
op_star
id|iocb
comma
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|len
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_struct
id|sockaddr_llc
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_llc
op_star
)paren
id|msg-&gt;msg_name
suffix:semicolon
r_int
id|flags
op_assign
id|msg-&gt;msg_flags
suffix:semicolon
r_int
id|noblock
op_assign
id|flags
op_amp
id|MSG_DONTWAIT
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
comma
id|size
op_assign
l_int|0
comma
id|copied
op_assign
l_int|0
comma
id|hdrlen
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: sending from %02X to %02X&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc-&gt;laddr.lsap
comma
id|llc-&gt;daddr.lsap
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
(brace
r_if
c_cond
(paren
id|msg-&gt;msg_namelen
OL
r_sizeof
(paren
op_star
id|addr
)paren
)paren
r_goto
id|release
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|llc_ui_addr_null
c_func
(paren
op_amp
id|llc-&gt;addr
)paren
)paren
r_goto
id|release
suffix:semicolon
id|addr
op_assign
op_amp
id|llc-&gt;addr
suffix:semicolon
)brace
multiline_comment|/* must bind connection to sap if user hasn&squot;t done it. */
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
(brace
multiline_comment|/* bind to sap with null dev, exclusive. */
id|rc
op_assign
id|llc_ui_autobind
c_func
(paren
id|sock
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|release
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|llc-&gt;dev
)paren
(brace
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|dev
op_assign
id|dev_getbyhwaddr
c_func
(paren
id|addr-&gt;sllc_arphrd
comma
id|addr-&gt;sllc_smac
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
r_goto
id|release
suffix:semicolon
)brace
r_else
id|dev
op_assign
id|llc-&gt;dev
suffix:semicolon
id|hdrlen
op_assign
id|dev-&gt;hard_header_len
op_plus
id|llc_ui_header_len
c_func
(paren
id|sk
comma
id|addr
)paren
suffix:semicolon
id|size
op_assign
id|hdrlen
op_plus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|dev-&gt;mtu
)paren
id|size
op_assign
id|dev-&gt;mtu
suffix:semicolon
id|copied
op_assign
id|size
op_minus
id|hdrlen
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
id|skb
op_assign
id|sock_alloc_send_skb
c_func
(paren
id|sk
comma
id|size
comma
id|noblock
comma
op_amp
id|rc
)paren
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|release
suffix:semicolon
id|skb-&gt;sk
op_assign
id|sk
suffix:semicolon
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|llc_proto_type
c_func
(paren
id|addr-&gt;sllc_arphrd
)paren
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hdrlen
)paren
suffix:semicolon
id|rc
op_assign
id|memcpy_fromiovec
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|copied
)paren
comma
id|msg-&gt;msg_iov
comma
id|copied
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_DGRAM
op_logical_or
id|addr-&gt;sllc_ua
)paren
(brace
id|llc_build_and_send_ui_pkt
c_func
(paren
id|llc-&gt;sap
comma
id|skb
comma
id|addr-&gt;sllc_dmac
comma
id|addr-&gt;sllc_dsap
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;sllc_test
)paren
(brace
id|llc_build_and_send_test_pkt
c_func
(paren
id|llc-&gt;sap
comma
id|skb
comma
id|addr-&gt;sllc_dmac
comma
id|addr-&gt;sllc_dsap
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr-&gt;sllc_xid
)paren
(brace
id|llc_build_and_send_xid_pkt
c_func
(paren
id|llc-&gt;sap
comma
id|skb
comma
id|addr-&gt;sllc_dmac
comma
id|addr-&gt;sllc_dsap
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sk-&gt;sk_type
op_eq
id|SOCK_STREAM
op_logical_and
op_logical_neg
id|addr-&gt;sllc_ua
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|llc_ui_send_data
c_func
(paren
id|sk
comma
id|skb
comma
id|noblock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: llc_ui_send_data failed: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|rc
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|rc
)paren
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|release
suffix:colon
r_if
c_cond
(paren
id|rc
)paren
id|dprintk
c_func
(paren
l_string|&quot;%s: failed sending from %02X to %02X: %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|llc-&gt;laddr.lsap
comma
id|llc-&gt;daddr.lsap
comma
id|rc
)paren
suffix:semicolon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
ques
c_cond
suffix:colon
id|copied
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_getname - return the address info of a socket&n; *&t;@sock: Socket to get address of.&n; *&t;@uaddr: Address structure to return information.&n; *&t;@uaddrlen: Length of address structure.&n; *&t;@peer: Does user want local or remote address information.&n; *&n; *&t;Return the address information of a socket.&n; */
DECL|function|llc_ui_getname
r_static
r_int
id|llc_ui_getname
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|uaddr
comma
r_int
op_star
id|uaddrlen
comma
r_int
id|peer
)paren
(brace
r_struct
id|sockaddr_llc
id|sllc
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_zapped
)paren
r_goto
id|out
suffix:semicolon
op_star
id|uaddrlen
op_assign
r_sizeof
(paren
id|sllc
)paren
suffix:semicolon
id|memset
c_func
(paren
id|uaddr
comma
l_int|0
comma
op_star
id|uaddrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|peer
)paren
(brace
id|rc
op_assign
op_minus
id|ENOTCONN
suffix:semicolon
r_if
c_cond
(paren
id|sk-&gt;sk_state
op_ne
id|TCP_ESTABLISHED
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|llc-&gt;dev
)paren
(brace
id|sllc.sllc_arphrd
op_assign
id|llc-&gt;dev-&gt;type
suffix:semicolon
)brace
id|sllc.sllc_dsap
op_assign
id|llc-&gt;daddr.lsap
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sllc.sllc_dmac
comma
op_amp
id|llc-&gt;daddr.mac
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|llc-&gt;sap
)paren
r_goto
id|out
suffix:semicolon
id|sllc.sllc_ssap
op_assign
id|llc-&gt;sap-&gt;laddr.lsap
suffix:semicolon
r_if
c_cond
(paren
id|llc-&gt;dev
)paren
(brace
id|sllc.sllc_arphrd
op_assign
id|llc-&gt;dev-&gt;type
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sllc.sllc_smac
comma
op_amp
id|llc-&gt;dev-&gt;dev_addr
comma
id|IFHWADDRLEN
)paren
suffix:semicolon
)brace
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|sllc.sllc_family
op_assign
id|AF_LLC
suffix:semicolon
id|memcpy
c_func
(paren
id|uaddr
comma
op_amp
id|sllc
comma
r_sizeof
(paren
id|sllc
)paren
)paren
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_ioctl - io controls for PF_LLC&n; *&t;@sock: Socket to get/set info&n; *&t;@cmd: command&n; *&t;@arg: optional argument for cmd&n; *&n; *&t;get/set info on llc sockets&n; */
DECL|function|llc_ui_ioctl
r_static
r_int
id|llc_ui_ioctl
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|dev_ioctl
c_func
(paren
id|cmd
comma
(paren
r_void
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_setsockopt - set various connection specific parameters.&n; *&t;@sock: Socket to set options on.&n; *&t;@level: Socket level user is requesting operations on.&n; *&t;@optname: Operation name.&n; *&t;@optval User provided operation data.&n; *&t;@optlen: Length of optval.&n; *&n; *&t;Set various connection specific parameters.&n; */
DECL|function|llc_ui_setsockopt
r_static
r_int
id|llc_ui_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EINVAL
comma
id|opt
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_LLC
op_logical_or
id|optlen
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|get_user
c_func
(paren
id|opt
comma
(paren
r_int
op_star
)paren
id|optval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|LLC_OPT_RETRY
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_RETRY
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;n2
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_SIZE
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_SIZE
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;n1
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_ACK_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_ACK_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;ack_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_P_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_P_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;pf_cycle_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_REJ_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_REJ_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;rej_sent_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_BUSY_TMR_EXP
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_BUSY_TMR_EXP
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;busy_state_timer.expire
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_TX_WIN
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_WIN
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;k
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_RX_WIN
suffix:colon
r_if
c_cond
(paren
id|opt
OG
id|LLC_OPT_MAX_WIN
)paren
r_goto
id|out
suffix:semicolon
id|llc-&gt;rw
op_assign
id|opt
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;llc_ui_getsockopt - get connection specific socket info&n; *&t;@sock: Socket to get information from.&n; *&t;@level: Socket level user is requesting operations on.&n; *&t;@optname: Operation name.&n; *&t;@optval: Variable to return operation data in.&n; *&t;@optlen: Length of optval.&n; *&n; *&t;Get connection specific socket information.&n; */
DECL|function|llc_ui_getsockopt
r_static
r_int
id|llc_ui_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
comma
r_char
op_star
id|optval
comma
r_int
op_star
id|optlen
)paren
(brace
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|llc_opt
op_star
id|llc
op_assign
id|llc_sk
c_func
(paren
id|sk
)paren
suffix:semicolon
r_int
id|val
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
comma
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ne
id|SOL_LLC
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|get_user
c_func
(paren
id|len
comma
id|optlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_goto
id|out
suffix:semicolon
r_switch
c_cond
(paren
id|optname
)paren
(brace
r_case
id|LLC_OPT_RETRY
suffix:colon
id|val
op_assign
id|llc-&gt;n2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_SIZE
suffix:colon
id|val
op_assign
id|llc-&gt;n1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_ACK_TMR_EXP
suffix:colon
id|val
op_assign
id|llc-&gt;ack_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_P_TMR_EXP
suffix:colon
id|val
op_assign
id|llc-&gt;pf_cycle_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_REJ_TMR_EXP
suffix:colon
id|val
op_assign
id|llc-&gt;rej_sent_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_BUSY_TMR_EXP
suffix:colon
id|val
op_assign
id|llc-&gt;busy_state_timer.expire
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_TX_WIN
suffix:colon
id|val
op_assign
id|llc-&gt;k
suffix:semicolon
r_break
suffix:semicolon
r_case
id|LLC_OPT_RX_WIN
suffix:colon
id|val
op_assign
id|llc-&gt;rw
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
op_minus
id|ENOPROTOOPT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|len
comma
id|optlen
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|optval
comma
op_amp
id|val
comma
id|len
)paren
)paren
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|out
suffix:colon
id|release_sock
c_func
(paren
id|sk
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|llc_ui_family_ops
r_static
r_struct
id|net_proto_family
id|llc_ui_family_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_LLC
comma
dot
id|create
op_assign
id|llc_ui_create
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
DECL|variable|llc_ui_ops
r_static
r_struct
id|proto_ops
id|llc_ui_ops
op_assign
(brace
dot
id|family
op_assign
id|PF_LLC
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|release
op_assign
id|llc_ui_release
comma
dot
id|bind
op_assign
id|llc_ui_bind
comma
dot
id|connect
op_assign
id|llc_ui_connect
comma
dot
id|socketpair
op_assign
id|sock_no_socketpair
comma
dot
id|accept
op_assign
id|llc_ui_accept
comma
dot
id|getname
op_assign
id|llc_ui_getname
comma
dot
id|poll
op_assign
id|datagram_poll
comma
dot
id|ioctl
op_assign
id|llc_ui_ioctl
comma
dot
id|listen
op_assign
id|llc_ui_listen
comma
dot
id|shutdown
op_assign
id|llc_ui_shutdown
comma
dot
id|setsockopt
op_assign
id|llc_ui_setsockopt
comma
dot
id|getsockopt
op_assign
id|llc_ui_getsockopt
comma
dot
id|sendmsg
op_assign
id|llc_ui_sendmsg
comma
dot
id|recvmsg
op_assign
id|llc_ui_recvmsg
comma
dot
id|mmap
op_assign
id|sock_no_mmap
comma
dot
id|sendpage
op_assign
id|sock_no_sendpage
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|llc_ui_banner
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
l_string|&quot;NET4.0 IEEE 802.2 BSD sockets, Jay Schulist, 2001, &quot;
l_string|&quot;Arnaldo C. Melo, 2002-2003&bslash;n&quot;
suffix:semicolon
DECL|function|llc_ui_init
r_int
id|__init
id|llc_ui_init
c_func
(paren
r_void
)paren
(brace
id|llc_ui_sap_last_autoport
op_assign
id|LLC_SAP_DYN_START
suffix:semicolon
id|sock_register
c_func
(paren
op_amp
id|llc_ui_family_ops
)paren
suffix:semicolon
id|printk
c_func
(paren
id|llc_ui_banner
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|llc_ui_exit
r_void
id|__exit
id|llc_ui_exit
c_func
(paren
r_void
)paren
(brace
id|sock_unregister
c_func
(paren
id|PF_LLC
)paren
suffix:semicolon
)brace
eof
