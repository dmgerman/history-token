multiline_comment|/*&n; *  $Id: ipconfig.c,v 1.46 2002/02/01 22:01:04 davem Exp $&n; *&n; *  Automatic Configuration of IP -- use DHCP, BOOTP, RARP, or&n; *  user-supplied information to configure own IP address and routes.&n; *&n; *  Copyright (C) 1996-1998 Martin Mares &lt;mj@atrey.karlin.mff.cuni.cz&gt;&n; *&n; *  Derived from network configuration code in fs/nfs/nfsroot.c,&n; *  originally Copyright (C) 1995, 1996 Gero Kuhlmann and me.&n; *&n; *  BOOTP rewritten to construct and analyse packets itself instead&n; *  of misusing the IP layer. num_bugs_causing_wrong_arp_replies--;&n; *&t;&t;&t;&t;&t;     -- MJ, December 1998&n; *  &n; *  Fixed ip_auto_config_setup calling at startup in the new &quot;Linker Magic&quot;&n; *  initialization scheme.&n; *&t;- Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;, 08/11/1999&n; *&n; *  DHCP support added.  To users this looks like a whole separate&n; *  protocol, but we know it&squot;s just a bag on the side of BOOTP.&n; *&t;&t;-- Chip Salzenberg &lt;chip@valinux.com&gt;, May 2000&n; *&n; *  Ported DHCP support from 2.2.16 to 2.4.0-test4&n; *              -- Eric Biederman &lt;ebiederman@lnxi.com&gt;, 30 Aug 2000&n; *&n; *  Merged changes from 2.2.19 into 2.4.3&n; *              -- Eric Biederman &lt;ebiederman@lnxi.com&gt;, 22 April Aug 2001&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/inet.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/if_arp.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/ip.h&gt;
macro_line|#include &lt;linux/socket.h&gt;
macro_line|#include &lt;linux/route.h&gt;
macro_line|#include &lt;linux/udp.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/root_dev.h&gt;
macro_line|#include &lt;net/arp.h&gt;
macro_line|#include &lt;net/ip.h&gt;
macro_line|#include &lt;net/ipconfig.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;net/checksum.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
multiline_comment|/* Define this to allow debugging output */
DECL|macro|IPCONFIG_DEBUG
macro_line|#undef IPCONFIG_DEBUG
macro_line|#ifdef IPCONFIG_DEBUG
DECL|macro|DBG
mdefine_line|#define DBG(x) printk x
macro_line|#else
DECL|macro|DBG
mdefine_line|#define DBG(x) do { } while(0)
macro_line|#endif
macro_line|#if defined(CONFIG_IP_PNP_DHCP)
DECL|macro|IPCONFIG_DHCP
mdefine_line|#define IPCONFIG_DHCP
macro_line|#endif
macro_line|#if defined(CONFIG_IP_PNP_BOOTP) || defined(CONFIG_IP_PNP_DHCP)
DECL|macro|IPCONFIG_BOOTP
mdefine_line|#define IPCONFIG_BOOTP
macro_line|#endif
macro_line|#if defined(CONFIG_IP_PNP_RARP)
DECL|macro|IPCONFIG_RARP
mdefine_line|#define IPCONFIG_RARP
macro_line|#endif
macro_line|#if defined(IPCONFIG_BOOTP) || defined(IPCONFIG_RARP)
DECL|macro|IPCONFIG_DYNAMIC
mdefine_line|#define IPCONFIG_DYNAMIC
macro_line|#endif
multiline_comment|/* Define the friendly delay before and after opening net devices */
DECL|macro|CONF_PRE_OPEN
mdefine_line|#define CONF_PRE_OPEN&t;&t;(HZ/2)&t;/* Before opening: 1/2 second */
DECL|macro|CONF_POST_OPEN
mdefine_line|#define CONF_POST_OPEN&t;&t;(1*HZ)&t;/* After opening: 1 second */
multiline_comment|/* Define the timeout for waiting for a DHCP/BOOTP/RARP reply */
DECL|macro|CONF_OPEN_RETRIES
mdefine_line|#define CONF_OPEN_RETRIES &t;2&t;/* (Re)open devices twice */
DECL|macro|CONF_SEND_RETRIES
mdefine_line|#define CONF_SEND_RETRIES &t;6&t;/* Send six requests per open */
DECL|macro|CONF_INTER_TIMEOUT
mdefine_line|#define CONF_INTER_TIMEOUT&t;(HZ/2)&t;/* Inter-device timeout: 1/2 second */
DECL|macro|CONF_BASE_TIMEOUT
mdefine_line|#define CONF_BASE_TIMEOUT&t;(HZ*2)&t;/* Initial timeout: 2 seconds */
DECL|macro|CONF_TIMEOUT_RANDOM
mdefine_line|#define CONF_TIMEOUT_RANDOM&t;(HZ)&t;/* Maximum amount of randomization */
DECL|macro|CONF_TIMEOUT_MULT
mdefine_line|#define CONF_TIMEOUT_MULT&t;*7/4&t;/* Rate of timeout growth */
DECL|macro|CONF_TIMEOUT_MAX
mdefine_line|#define CONF_TIMEOUT_MAX&t;(HZ*30)&t;/* Maximum allowed timeout */
multiline_comment|/*&n; * Public IP configuration&n; */
multiline_comment|/* This is used by platforms which might be able to set the ipconfig&n; * variables using firmware environment vars.  If this is set, it will&n; * ignore such firmware variables.&n; */
DECL|variable|__initdata
r_int
id|ic_set_manually
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* IPconfig parameters set manually */
DECL|variable|__initdata
r_int
id|ic_enable
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* IP config enabled? */
multiline_comment|/* Protocol choice */
DECL|variable|__initdata
r_int
id|ic_proto_enabled
id|__initdata
op_assign
l_int|0
macro_line|#ifdef IPCONFIG_BOOTP
op_or
id|IC_BOOTP
macro_line|#endif
macro_line|#ifdef CONFIG_IP_PNP_DHCP
op_or
id|IC_USE_DHCP
macro_line|#endif
macro_line|#ifdef IPCONFIG_RARP
op_or
id|IC_RARP
macro_line|#endif
suffix:semicolon
DECL|variable|__initdata
r_int
id|ic_host_name_set
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Host name set by us? */
DECL|variable|__initdata
id|u32
id|ic_myaddr
id|__initdata
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* My IP address */
DECL|variable|__initdata
id|u32
id|ic_netmask
id|__initdata
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* Netmask for local subnet */
DECL|variable|__initdata
id|u32
id|ic_gateway
id|__initdata
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* Gateway IP address */
DECL|variable|__initdata
id|u32
id|ic_servaddr
id|__initdata
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* Boot server IP address */
DECL|variable|__initdata
id|u32
id|root_server_addr
id|__initdata
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* Address of NFS server */
DECL|variable|__initdata
id|u8
id|root_server_path
(braket
l_int|256
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* Path to mount as root */
multiline_comment|/* Persistent data: */
DECL|variable|ic_proto_used
r_int
id|ic_proto_used
suffix:semicolon
multiline_comment|/* Protocol used, if any */
DECL|variable|ic_nameserver
id|u32
id|ic_nameserver
op_assign
id|INADDR_NONE
suffix:semicolon
multiline_comment|/* DNS Server IP address */
DECL|variable|ic_domain
id|u8
id|ic_domain
(braket
l_int|64
)braket
suffix:semicolon
multiline_comment|/* DNS (not NIS) domain name */
multiline_comment|/*&n; * Private state.&n; */
multiline_comment|/* Name of user-selected boot device */
DECL|variable|__initdata
r_static
r_char
id|user_dev_name
(braket
id|IFNAMSIZ
)braket
id|__initdata
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* Protocols supported by available interfaces */
DECL|variable|__initdata
r_static
r_int
id|ic_proto_have_if
id|__initdata
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef IPCONFIG_DYNAMIC
DECL|variable|ic_recv_lock
r_static
id|spinlock_t
id|ic_recv_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|__initdata
r_static
r_volatile
r_int
id|ic_got_reply
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Proto(s) that replied */
macro_line|#endif
macro_line|#ifdef IPCONFIG_DHCP
DECL|variable|__initdata
r_static
r_int
id|ic_dhcp_msgtype
id|__initdata
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* DHCP msg type received */
macro_line|#endif
multiline_comment|/*&n; *&t;Network devices&n; */
DECL|struct|ic_device
r_struct
id|ic_device
(brace
DECL|member|next
r_struct
id|ic_device
op_star
id|next
suffix:semicolon
DECL|member|dev
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|member|able
r_int
id|able
suffix:semicolon
DECL|member|xid
id|u32
id|xid
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|ic_device
op_star
id|ic_first_dev
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* List of open device */
DECL|variable|__initdata
r_static
r_struct
id|net_device
op_star
id|ic_dev
id|__initdata
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Selected device */
DECL|function|ic_open_devs
r_static
r_int
id|__init
id|ic_open_devs
c_func
(paren
r_void
)paren
(brace
r_struct
id|ic_device
op_star
id|d
comma
op_star
op_star
id|last
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_int
r_int
id|oflags
suffix:semicolon
id|last
op_assign
op_amp
id|ic_first_dev
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
id|dev_base
suffix:semicolon
id|dev
suffix:semicolon
id|dev
op_assign
id|dev-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|user_dev_name
(braket
l_int|0
)braket
ques
c_cond
op_logical_neg
id|strcmp
c_func
(paren
id|dev-&gt;name
comma
id|user_dev_name
)paren
suffix:colon
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_LOOPBACK
)paren
op_logical_and
(paren
id|dev-&gt;flags
op_amp
(paren
id|IFF_POINTOPOINT
op_or
id|IFF_BROADCAST
)paren
)paren
op_logical_and
id|strncmp
c_func
(paren
id|dev-&gt;name
comma
l_string|&quot;dummy&quot;
comma
l_int|5
)paren
)paren
)paren
(brace
r_int
id|able
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;mtu
op_ge
l_int|364
)paren
id|able
op_or_assign
id|IC_BOOTP
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;DHCP/BOOTP: Ignoring device %s, MTU %d too small&quot;
comma
id|dev-&gt;name
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|dev-&gt;flags
op_amp
id|IFF_NOARP
)paren
)paren
id|able
op_or_assign
id|IC_RARP
suffix:semicolon
id|able
op_and_assign
id|ic_proto_enabled
suffix:semicolon
r_if
c_cond
(paren
id|ic_proto_enabled
op_logical_and
op_logical_neg
id|able
)paren
r_continue
suffix:semicolon
id|oflags
op_assign
id|dev-&gt;flags
suffix:semicolon
r_if
c_cond
(paren
id|dev_change_flags
c_func
(paren
id|dev
comma
id|oflags
op_or
id|IFF_UP
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Failed to open %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|d
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ic_device
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|d-&gt;dev
op_assign
id|dev
suffix:semicolon
op_star
id|last
op_assign
id|d
suffix:semicolon
id|last
op_assign
op_amp
id|d-&gt;next
suffix:semicolon
id|d-&gt;flags
op_assign
id|oflags
suffix:semicolon
id|d-&gt;able
op_assign
id|able
suffix:semicolon
r_if
c_cond
(paren
id|able
op_amp
id|IC_BOOTP
)paren
id|get_random_bytes
c_func
(paren
op_amp
id|d-&gt;xid
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_else
id|d-&gt;xid
op_assign
l_int|0
suffix:semicolon
id|ic_proto_have_if
op_or_assign
id|able
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;IP-Config: %s UP (able=%d, xid=%08x)&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|able
comma
id|d-&gt;xid
)paren
)paren
suffix:semicolon
)brace
)brace
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
op_star
id|last
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ic_first_dev
)paren
(brace
r_if
c_cond
(paren
id|user_dev_name
(braket
l_int|0
)braket
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Device `%s&squot; not found.&bslash;n&quot;
comma
id|user_dev_name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: No network devices available.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ic_close_devs
r_static
r_void
id|__init
id|ic_close_devs
c_func
(paren
r_void
)paren
(brace
r_struct
id|ic_device
op_star
id|d
comma
op_star
id|next
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
id|rtnl_shlock
c_func
(paren
)paren
suffix:semicolon
id|next
op_assign
id|ic_first_dev
suffix:semicolon
r_while
c_loop
(paren
(paren
id|d
op_assign
id|next
)paren
)paren
(brace
id|next
op_assign
id|d-&gt;next
suffix:semicolon
id|dev
op_assign
id|d-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ne
id|ic_dev
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;IP-Config: Downing %s&bslash;n&quot;
comma
id|dev-&gt;name
)paren
)paren
suffix:semicolon
id|dev_change_flags
c_func
(paren
id|dev
comma
id|d-&gt;flags
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
id|rtnl_shunlock
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Interface to various network functions.&n; */
r_static
r_inline
r_void
DECL|function|set_sockaddr
id|set_sockaddr
c_func
(paren
r_struct
id|sockaddr_in
op_star
id|sin
comma
id|u32
id|addr
comma
id|u16
id|port
)paren
(brace
id|sin-&gt;sin_family
op_assign
id|AF_INET
suffix:semicolon
id|sin-&gt;sin_addr.s_addr
op_assign
id|addr
suffix:semicolon
id|sin-&gt;sin_port
op_assign
id|port
suffix:semicolon
)brace
DECL|function|ic_dev_ioctl
r_static
r_int
id|__init
id|ic_dev_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_struct
id|ifreq
op_star
id|arg
)paren
(brace
r_int
id|res
suffix:semicolon
id|mm_segment_t
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|res
op_assign
id|devinet_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|ic_route_ioctl
r_static
r_int
id|__init
id|ic_route_ioctl
c_func
(paren
r_int
r_int
id|cmd
comma
r_struct
id|rtentry
op_star
id|arg
)paren
(brace
r_int
id|res
suffix:semicolon
id|mm_segment_t
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|res
op_assign
id|ip_rt_ioctl
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Set up interface addresses and routes.&n; */
DECL|function|ic_setup_if
r_static
r_int
id|__init
id|ic_setup_if
c_func
(paren
r_void
)paren
(brace
r_struct
id|ifreq
id|ir
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|sin
op_assign
(paren
r_void
op_star
)paren
op_amp
id|ir.ifr_ifru.ifru_addr
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ir
comma
l_int|0
comma
r_sizeof
(paren
id|ir
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ir.ifr_ifrn.ifrn_name
comma
id|ic_dev-&gt;name
)paren
suffix:semicolon
id|set_sockaddr
c_func
(paren
id|sin
comma
id|ic_myaddr
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ic_dev_ioctl
c_func
(paren
id|SIOCSIFADDR
comma
op_amp
id|ir
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Unable to set interface address (%d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|set_sockaddr
c_func
(paren
id|sin
comma
id|ic_netmask
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ic_dev_ioctl
c_func
(paren
id|SIOCSIFNETMASK
comma
op_amp
id|ir
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Unable to set interface netmask (%d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|set_sockaddr
c_func
(paren
id|sin
comma
id|ic_myaddr
op_or
op_complement
id|ic_netmask
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ic_dev_ioctl
c_func
(paren
id|SIOCSIFBRDADDR
comma
op_amp
id|ir
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Unable to set interface broadcast address (%d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ic_setup_routes
r_static
r_int
id|__init
id|ic_setup_routes
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* No need to setup device routes, only the default route... */
r_if
c_cond
(paren
id|ic_gateway
op_ne
id|INADDR_NONE
)paren
(brace
r_struct
id|rtentry
id|rm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rm
comma
l_int|0
comma
r_sizeof
(paren
id|rm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ic_gateway
op_xor
id|ic_myaddr
)paren
op_amp
id|ic_netmask
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Gateway not on directly connected network.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|set_sockaddr
c_func
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|rm.rt_dst
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_sockaddr
c_func
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|rm.rt_genmask
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|set_sockaddr
c_func
(paren
(paren
r_struct
id|sockaddr_in
op_star
)paren
op_amp
id|rm.rt_gateway
comma
id|ic_gateway
comma
l_int|0
)paren
suffix:semicolon
id|rm.rt_flags
op_assign
id|RTF_UP
op_or
id|RTF_GATEWAY
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ic_route_ioctl
c_func
(paren
id|SIOCADDRT
comma
op_amp
id|rm
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Cannot add default route (%d).&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Fill in default values for all missing parameters.&n; */
DECL|function|ic_defaults
r_static
r_int
id|__init
id|ic_defaults
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; *&t;At this point we have no userspace running so need not&n;&t; *&t;claim locks on system_utsname&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ic_host_name_set
)paren
id|sprintf
c_func
(paren
id|system_utsname.nodename
comma
l_string|&quot;%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_myaddr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|root_server_addr
op_eq
id|INADDR_NONE
)paren
id|root_server_addr
op_assign
id|ic_servaddr
suffix:semicolon
r_if
c_cond
(paren
id|ic_netmask
op_eq
id|INADDR_NONE
)paren
(brace
r_if
c_cond
(paren
id|IN_CLASSA
c_func
(paren
id|ntohl
c_func
(paren
id|ic_myaddr
)paren
)paren
)paren
id|ic_netmask
op_assign
id|__constant_htonl
c_func
(paren
id|IN_CLASSA_NET
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|IN_CLASSB
c_func
(paren
id|ntohl
c_func
(paren
id|ic_myaddr
)paren
)paren
)paren
id|ic_netmask
op_assign
id|__constant_htonl
c_func
(paren
id|IN_CLASSB_NET
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|IN_CLASSC
c_func
(paren
id|ntohl
c_func
(paren
id|ic_myaddr
)paren
)paren
)paren
id|ic_netmask
op_assign
id|__constant_htonl
c_func
(paren
id|IN_CLASSC_NET
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Unable to guess netmask for address %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_myaddr
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;IP-Config: Guessing netmask %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_netmask
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;RARP support.&n; */
macro_line|#ifdef IPCONFIG_RARP
r_static
r_int
id|ic_rarp_recv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|packet_type
id|rarp_packet_type
id|__initdata
op_assign
(brace
id|type
suffix:colon
id|__constant_htons
c_func
(paren
id|ETH_P_RARP
)paren
comma
id|func
suffix:colon
id|ic_rarp_recv
comma
)brace
suffix:semicolon
DECL|function|ic_rarp_init
r_static
r_inline
r_void
id|ic_rarp_init
c_func
(paren
r_void
)paren
(brace
id|dev_add_pack
c_func
(paren
op_amp
id|rarp_packet_type
)paren
suffix:semicolon
)brace
DECL|function|ic_rarp_cleanup
r_static
r_inline
r_void
id|ic_rarp_cleanup
c_func
(paren
r_void
)paren
(brace
id|dev_remove_pack
c_func
(paren
op_amp
id|rarp_packet_type
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Process received RARP packet.&n; */
r_static
r_int
id|__init
DECL|function|ic_rarp_recv
id|ic_rarp_recv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|arphdr
op_star
id|rarp
op_assign
(paren
r_struct
id|arphdr
op_star
)paren
id|skb-&gt;h.raw
suffix:semicolon
r_int
r_char
op_star
id|rarp_ptr
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|rarp
op_plus
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|sip
comma
id|tip
suffix:semicolon
r_int
r_char
op_star
id|sha
comma
op_star
id|tha
suffix:semicolon
multiline_comment|/* s for &quot;source&quot;, t for &quot;target&quot; */
r_struct
id|ic_device
op_star
id|d
suffix:semicolon
multiline_comment|/* One reply at a time, please. */
id|spin_lock
c_func
(paren
op_amp
id|ic_recv_lock
)paren
suffix:semicolon
multiline_comment|/* If we already have a reply, just drop the packet */
r_if
c_cond
(paren
id|ic_got_reply
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Find the ic_device that the packet arrived on */
id|d
op_assign
id|ic_first_dev
suffix:semicolon
r_while
c_loop
(paren
id|d
op_logical_and
id|d-&gt;dev
op_ne
id|dev
)paren
id|d
op_assign
id|d-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* should never happen */
multiline_comment|/* If this test doesn&squot;t pass, it&squot;s not IP, or we should ignore it anyway */
r_if
c_cond
(paren
id|rarp-&gt;ar_hln
op_ne
id|dev-&gt;addr_len
op_logical_or
id|dev-&gt;type
op_ne
id|ntohs
c_func
(paren
id|rarp-&gt;ar_hrd
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* If it&squot;s not a RARP reply, delete it. */
r_if
c_cond
(paren
id|rarp-&gt;ar_op
op_ne
id|__constant_htons
c_func
(paren
id|ARPOP_RREPLY
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* If it&squot;s not Ethernet, delete it. */
r_if
c_cond
(paren
id|rarp-&gt;ar_pro
op_ne
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Extract variable-width fields */
id|sha
op_assign
id|rarp_ptr
suffix:semicolon
id|rarp_ptr
op_add_assign
id|dev-&gt;addr_len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|sip
comma
id|rarp_ptr
comma
l_int|4
)paren
suffix:semicolon
id|rarp_ptr
op_add_assign
l_int|4
suffix:semicolon
id|tha
op_assign
id|rarp_ptr
suffix:semicolon
id|rarp_ptr
op_add_assign
id|dev-&gt;addr_len
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|tip
comma
id|rarp_ptr
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Discard packets which are not meant for us. */
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|tha
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Discard packets which are not from specified server. */
r_if
c_cond
(paren
id|ic_servaddr
op_ne
id|INADDR_NONE
op_logical_and
id|ic_servaddr
op_ne
id|sip
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* We have a winner! */
id|ic_dev
op_assign
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|ic_myaddr
op_eq
id|INADDR_NONE
)paren
id|ic_myaddr
op_assign
id|tip
suffix:semicolon
id|ic_servaddr
op_assign
id|sip
suffix:semicolon
id|ic_got_reply
op_assign
id|IC_RARP
suffix:semicolon
id|drop
suffix:colon
multiline_comment|/* Show&squot;s over.  Nothing to see here.  */
id|spin_unlock
c_func
(paren
op_amp
id|ic_recv_lock
)paren
suffix:semicolon
multiline_comment|/* Throw the packet out. */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Send RARP request packet over a signle interface.&n; */
DECL|function|ic_rarp_send_if
r_static
r_void
id|__init
id|ic_rarp_send_if
c_func
(paren
r_struct
id|ic_device
op_star
id|d
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d-&gt;dev
suffix:semicolon
id|arp_send
c_func
(paren
id|ARPOP_RREQUEST
comma
id|ETH_P_RARP
comma
l_int|0
comma
id|dev
comma
l_int|0
comma
l_int|NULL
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;dev_addr
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;DHCP/BOOTP support.&n; */
macro_line|#ifdef IPCONFIG_BOOTP
DECL|struct|bootp_pkt
r_struct
id|bootp_pkt
(brace
multiline_comment|/* BOOTP packet format */
DECL|member|iph
r_struct
id|iphdr
id|iph
suffix:semicolon
multiline_comment|/* IP header */
DECL|member|udph
r_struct
id|udphdr
id|udph
suffix:semicolon
multiline_comment|/* UDP header */
DECL|member|op
id|u8
id|op
suffix:semicolon
multiline_comment|/* 1=request, 2=reply */
DECL|member|htype
id|u8
id|htype
suffix:semicolon
multiline_comment|/* HW address type */
DECL|member|hlen
id|u8
id|hlen
suffix:semicolon
multiline_comment|/* HW address length */
DECL|member|hops
id|u8
id|hops
suffix:semicolon
multiline_comment|/* Used only by gateways */
DECL|member|xid
id|u32
id|xid
suffix:semicolon
multiline_comment|/* Transaction ID */
DECL|member|secs
id|u16
id|secs
suffix:semicolon
multiline_comment|/* Seconds since we started */
DECL|member|flags
id|u16
id|flags
suffix:semicolon
multiline_comment|/* Just what it says */
DECL|member|client_ip
id|u32
id|client_ip
suffix:semicolon
multiline_comment|/* Client&squot;s IP address if known */
DECL|member|your_ip
id|u32
id|your_ip
suffix:semicolon
multiline_comment|/* Assigned IP address */
DECL|member|server_ip
id|u32
id|server_ip
suffix:semicolon
multiline_comment|/* (Next, e.g. NFS) Server&squot;s IP address */
DECL|member|relay_ip
id|u32
id|relay_ip
suffix:semicolon
multiline_comment|/* IP address of BOOTP relay */
DECL|member|hw_addr
id|u8
id|hw_addr
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* Client&squot;s HW address */
DECL|member|serv_name
id|u8
id|serv_name
(braket
l_int|64
)braket
suffix:semicolon
multiline_comment|/* Server host name */
DECL|member|boot_file
id|u8
id|boot_file
(braket
l_int|128
)braket
suffix:semicolon
multiline_comment|/* Name of boot file */
DECL|member|exten
id|u8
id|exten
(braket
l_int|312
)braket
suffix:semicolon
multiline_comment|/* DHCP options / BOOTP vendor extensions */
)brace
suffix:semicolon
multiline_comment|/* packet ops */
DECL|macro|BOOTP_REQUEST
mdefine_line|#define BOOTP_REQUEST&t;1
DECL|macro|BOOTP_REPLY
mdefine_line|#define BOOTP_REPLY&t;2
multiline_comment|/* DHCP message types */
DECL|macro|DHCPDISCOVER
mdefine_line|#define DHCPDISCOVER&t;1
DECL|macro|DHCPOFFER
mdefine_line|#define DHCPOFFER&t;2
DECL|macro|DHCPREQUEST
mdefine_line|#define DHCPREQUEST&t;3
DECL|macro|DHCPDECLINE
mdefine_line|#define DHCPDECLINE&t;4
DECL|macro|DHCPACK
mdefine_line|#define DHCPACK&t;&t;5
DECL|macro|DHCPNAK
mdefine_line|#define DHCPNAK&t;&t;6
DECL|macro|DHCPRELEASE
mdefine_line|#define DHCPRELEASE&t;7
DECL|macro|DHCPINFORM
mdefine_line|#define DHCPINFORM&t;8
r_static
r_int
id|ic_bootp_recv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|packet_type
id|bootp_packet_type
id|__initdata
op_assign
(brace
id|type
suffix:colon
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
comma
id|func
suffix:colon
id|ic_bootp_recv
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Initialize DHCP/BOOTP extension fields in the request.&n; */
DECL|variable|ic_bootp_cookie
r_static
r_const
id|u8
id|ic_bootp_cookie
(braket
l_int|4
)braket
op_assign
(brace
l_int|99
comma
l_int|130
comma
l_int|83
comma
l_int|99
)brace
suffix:semicolon
macro_line|#ifdef IPCONFIG_DHCP
r_static
r_void
id|__init
DECL|function|ic_dhcp_init_options
id|ic_dhcp_init_options
c_func
(paren
id|u8
op_star
id|options
)paren
(brace
id|u8
id|mt
op_assign
(paren
(paren
id|ic_servaddr
op_eq
id|INADDR_NONE
)paren
ques
c_cond
id|DHCPDISCOVER
suffix:colon
id|DHCPREQUEST
)paren
suffix:semicolon
id|u8
op_star
id|e
op_assign
id|options
suffix:semicolon
macro_line|#ifdef IPCONFIG_DEBUG
id|printk
c_func
(paren
l_string|&quot;DHCP: Sending message type %d&bslash;n&quot;
comma
id|mt
)paren
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|e
comma
id|ic_bootp_cookie
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* RFC1048 Magic Cookie */
id|e
op_add_assign
l_int|4
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|53
suffix:semicolon
multiline_comment|/* DHCP message type */
op_star
id|e
op_increment
op_assign
l_int|1
suffix:semicolon
op_star
id|e
op_increment
op_assign
id|mt
suffix:semicolon
r_if
c_cond
(paren
id|mt
op_eq
id|DHCPREQUEST
)paren
(brace
op_star
id|e
op_increment
op_assign
l_int|54
suffix:semicolon
multiline_comment|/* Server ID (IP address) */
op_star
id|e
op_increment
op_assign
l_int|4
suffix:semicolon
id|memcpy
c_func
(paren
id|e
comma
op_amp
id|ic_servaddr
comma
l_int|4
)paren
suffix:semicolon
id|e
op_add_assign
l_int|4
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|50
suffix:semicolon
multiline_comment|/* Requested IP address */
op_star
id|e
op_increment
op_assign
l_int|4
suffix:semicolon
id|memcpy
c_func
(paren
id|e
comma
op_amp
id|ic_myaddr
comma
l_int|4
)paren
suffix:semicolon
id|e
op_add_assign
l_int|4
suffix:semicolon
)brace
multiline_comment|/* always? */
(brace
r_static
r_const
id|u8
id|ic_req_params
(braket
)braket
op_assign
(brace
l_int|1
comma
multiline_comment|/* Subnet mask */
l_int|3
comma
multiline_comment|/* Default gateway */
l_int|6
comma
multiline_comment|/* DNS server */
l_int|12
comma
multiline_comment|/* Host name */
l_int|15
comma
multiline_comment|/* Domain name */
l_int|17
comma
multiline_comment|/* Boot path */
l_int|40
comma
multiline_comment|/* NIS domain name */
)brace
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|55
suffix:semicolon
multiline_comment|/* Parameter request list */
op_star
id|e
op_increment
op_assign
r_sizeof
(paren
id|ic_req_params
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|e
comma
id|ic_req_params
comma
r_sizeof
(paren
id|ic_req_params
)paren
)paren
suffix:semicolon
id|e
op_add_assign
r_sizeof
(paren
id|ic_req_params
)paren
suffix:semicolon
)brace
op_star
id|e
op_increment
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* End of the list */
)brace
macro_line|#endif /* IPCONFIG_DHCP */
DECL|function|ic_bootp_init_ext
r_static
r_void
id|__init
id|ic_bootp_init_ext
c_func
(paren
id|u8
op_star
id|e
)paren
(brace
id|memcpy
c_func
(paren
id|e
comma
id|ic_bootp_cookie
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* RFC1048 Magic Cookie */
id|e
op_add_assign
l_int|4
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Subnet mask request */
op_star
id|e
op_increment
op_assign
l_int|4
suffix:semicolon
id|e
op_add_assign
l_int|4
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Default gateway request */
op_star
id|e
op_increment
op_assign
l_int|4
suffix:semicolon
id|e
op_add_assign
l_int|4
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* Name server reqeust */
op_star
id|e
op_increment
op_assign
l_int|8
suffix:semicolon
id|e
op_add_assign
l_int|8
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|12
suffix:semicolon
multiline_comment|/* Host name request */
op_star
id|e
op_increment
op_assign
l_int|32
suffix:semicolon
id|e
op_add_assign
l_int|32
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|40
suffix:semicolon
multiline_comment|/* NIS Domain name request */
op_star
id|e
op_increment
op_assign
l_int|32
suffix:semicolon
id|e
op_add_assign
l_int|32
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|17
suffix:semicolon
multiline_comment|/* Boot path */
op_star
id|e
op_increment
op_assign
l_int|40
suffix:semicolon
id|e
op_add_assign
l_int|40
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|57
suffix:semicolon
multiline_comment|/* set extension buffer size for reply */
op_star
id|e
op_increment
op_assign
l_int|2
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* 128+236+8+20+14, see dhcpd sources */
op_star
id|e
op_increment
op_assign
l_int|150
suffix:semicolon
op_star
id|e
op_increment
op_assign
l_int|255
suffix:semicolon
multiline_comment|/* End of the list */
)brace
multiline_comment|/*&n; *  Initialize the DHCP/BOOTP mechanism.&n; */
DECL|function|ic_bootp_init
r_static
r_inline
r_void
id|ic_bootp_init
c_func
(paren
r_void
)paren
(brace
id|dev_add_pack
c_func
(paren
op_amp
id|bootp_packet_type
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  DHCP/BOOTP cleanup.&n; */
DECL|function|ic_bootp_cleanup
r_static
r_inline
r_void
id|ic_bootp_cleanup
c_func
(paren
r_void
)paren
(brace
id|dev_remove_pack
c_func
(paren
op_amp
id|bootp_packet_type
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Send DHCP/BOOTP request to single interface.&n; */
DECL|function|ic_bootp_send_if
r_static
r_void
id|__init
id|ic_bootp_send_if
c_func
(paren
r_struct
id|ic_device
op_star
id|d
comma
r_int
r_int
id|jiffies_diff
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d-&gt;dev
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|bootp_pkt
op_star
id|b
suffix:semicolon
r_int
id|hh_len
op_assign
(paren
id|dev-&gt;hard_header_len
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
r_struct
id|iphdr
op_star
id|h
suffix:semicolon
multiline_comment|/* Allocate packet */
id|skb
op_assign
id|alloc_skb
c_func
(paren
r_sizeof
(paren
r_struct
id|bootp_pkt
)paren
op_plus
id|hh_len
op_plus
l_int|15
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
id|hh_len
)paren
suffix:semicolon
id|b
op_assign
(paren
r_struct
id|bootp_pkt
op_star
)paren
id|skb_put
c_func
(paren
id|skb
comma
r_sizeof
(paren
r_struct
id|bootp_pkt
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|b
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|bootp_pkt
)paren
)paren
suffix:semicolon
multiline_comment|/* Construct IP header */
id|skb-&gt;nh.iph
op_assign
id|h
op_assign
op_amp
id|b-&gt;iph
suffix:semicolon
id|h-&gt;version
op_assign
l_int|4
suffix:semicolon
id|h-&gt;ihl
op_assign
l_int|5
suffix:semicolon
id|h-&gt;tot_len
op_assign
id|htons
c_func
(paren
r_sizeof
(paren
r_struct
id|bootp_pkt
)paren
)paren
suffix:semicolon
id|h-&gt;frag_off
op_assign
id|__constant_htons
c_func
(paren
id|IP_DF
)paren
suffix:semicolon
id|h-&gt;ttl
op_assign
l_int|64
suffix:semicolon
id|h-&gt;protocol
op_assign
id|IPPROTO_UDP
suffix:semicolon
id|h-&gt;daddr
op_assign
id|INADDR_BROADCAST
suffix:semicolon
id|h-&gt;check
op_assign
id|ip_fast_csum
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|h
comma
id|h-&gt;ihl
)paren
suffix:semicolon
multiline_comment|/* Construct UDP header */
id|b-&gt;udph.source
op_assign
id|__constant_htons
c_func
(paren
l_int|68
)paren
suffix:semicolon
id|b-&gt;udph.dest
op_assign
id|__constant_htons
c_func
(paren
l_int|67
)paren
suffix:semicolon
id|b-&gt;udph.len
op_assign
id|htons
c_func
(paren
r_sizeof
(paren
r_struct
id|bootp_pkt
)paren
op_minus
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
suffix:semicolon
multiline_comment|/* UDP checksum not calculated -- explicitly allowed in BOOTP RFC */
multiline_comment|/* Construct DHCP/BOOTP header */
id|b-&gt;op
op_assign
id|BOOTP_REQUEST
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;type
OL
l_int|256
)paren
multiline_comment|/* check for false types */
id|b-&gt;htype
op_assign
id|dev-&gt;type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;type
op_eq
id|ARPHRD_IEEE802_TR
)paren
multiline_comment|/* fix for token ring */
id|b-&gt;htype
op_assign
id|ARPHRD_IEEE802
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Unknown ARP type 0x%04x for device %s&bslash;n&quot;
comma
id|dev-&gt;type
comma
id|dev-&gt;name
)paren
suffix:semicolon
id|b-&gt;htype
op_assign
id|dev-&gt;type
suffix:semicolon
multiline_comment|/* can cause undefined behavior */
)brace
id|b-&gt;hlen
op_assign
id|dev-&gt;addr_len
suffix:semicolon
id|b-&gt;your_ip
op_assign
id|INADDR_NONE
suffix:semicolon
id|b-&gt;server_ip
op_assign
id|INADDR_NONE
suffix:semicolon
id|memcpy
c_func
(paren
id|b-&gt;hw_addr
comma
id|dev-&gt;dev_addr
comma
id|dev-&gt;addr_len
)paren
suffix:semicolon
id|b-&gt;secs
op_assign
id|htons
c_func
(paren
id|jiffies_diff
op_div
id|HZ
)paren
suffix:semicolon
id|b-&gt;xid
op_assign
id|d-&gt;xid
suffix:semicolon
multiline_comment|/* add DHCP options or BOOTP extensions */
macro_line|#ifdef IPCONFIG_DHCP
r_if
c_cond
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
id|ic_dhcp_init_options
c_func
(paren
id|b-&gt;exten
)paren
suffix:semicolon
r_else
macro_line|#endif
id|ic_bootp_init_ext
c_func
(paren
id|b-&gt;exten
)paren
suffix:semicolon
multiline_comment|/* Chain packet down the line... */
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb-&gt;protocol
op_assign
id|__constant_htons
c_func
(paren
id|ETH_P_IP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dev-&gt;hard_header
op_logical_and
id|dev
op_member_access_from_pointer
id|hard_header
c_func
(paren
id|skb
comma
id|dev
comma
id|ntohs
c_func
(paren
id|skb-&gt;protocol
)paren
comma
id|dev-&gt;broadcast
comma
id|dev-&gt;dev_addr
comma
id|skb-&gt;len
)paren
OL
l_int|0
)paren
op_logical_or
id|dev_queue_xmit
c_func
(paren
id|skb
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;E&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Copy BOOTP-supplied string if not already set.&n; */
DECL|function|ic_bootp_string
r_static
r_int
id|__init
id|ic_bootp_string
c_func
(paren
r_char
op_star
id|dest
comma
r_char
op_star
id|src
comma
r_int
id|len
comma
r_int
id|max
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|max
op_minus
l_int|1
)paren
id|len
op_assign
id|max
op_minus
l_int|1
suffix:semicolon
id|memcpy
c_func
(paren
id|dest
comma
id|src
comma
id|len
)paren
suffix:semicolon
id|dest
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *  Process BOOTP extensions.&n; */
DECL|function|ic_do_bootp_ext
r_static
r_void
id|__init
id|ic_do_bootp_ext
c_func
(paren
id|u8
op_star
id|ext
)paren
(brace
macro_line|#ifdef IPCONFIG_DEBUG
id|u8
op_star
id|c
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DHCP/BOOTP: Got extension %d:&quot;
comma
op_star
id|ext
)paren
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|ext
op_plus
l_int|2
suffix:semicolon
id|c
OL
id|ext
op_plus
l_int|2
op_plus
id|ext
(braket
l_int|1
)braket
suffix:semicolon
id|c
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|c
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
op_star
id|ext
op_increment
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* Subnet mask */
r_if
c_cond
(paren
id|ic_netmask
op_eq
id|INADDR_NONE
)paren
id|memcpy
c_func
(paren
op_amp
id|ic_netmask
comma
id|ext
op_plus
l_int|1
comma
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* Default gateway */
r_if
c_cond
(paren
id|ic_gateway
op_eq
id|INADDR_NONE
)paren
id|memcpy
c_func
(paren
op_amp
id|ic_gateway
comma
id|ext
op_plus
l_int|1
comma
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* DNS server */
r_if
c_cond
(paren
id|ic_nameserver
op_eq
id|INADDR_NONE
)paren
id|memcpy
c_func
(paren
op_amp
id|ic_nameserver
comma
id|ext
op_plus
l_int|1
comma
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
multiline_comment|/* Host name */
id|ic_bootp_string
c_func
(paren
id|system_utsname.nodename
comma
id|ext
op_plus
l_int|1
comma
op_star
id|ext
comma
id|__NEW_UTS_LEN
)paren
suffix:semicolon
id|ic_host_name_set
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|15
suffix:colon
multiline_comment|/* Domain name (DNS) */
id|ic_bootp_string
c_func
(paren
id|ic_domain
comma
id|ext
op_plus
l_int|1
comma
op_star
id|ext
comma
r_sizeof
(paren
id|ic_domain
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|17
suffix:colon
multiline_comment|/* Root path */
r_if
c_cond
(paren
op_logical_neg
id|root_server_path
(braket
l_int|0
)braket
)paren
id|ic_bootp_string
c_func
(paren
id|root_server_path
comma
id|ext
op_plus
l_int|1
comma
op_star
id|ext
comma
r_sizeof
(paren
id|root_server_path
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|40
suffix:colon
multiline_comment|/* NIS Domain name (_not_ DNS) */
id|ic_bootp_string
c_func
(paren
id|system_utsname.domainname
comma
id|ext
op_plus
l_int|1
comma
op_star
id|ext
comma
id|__NEW_UTS_LEN
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Receive BOOTP reply.&n; */
DECL|function|ic_bootp_recv
r_static
r_int
id|__init
id|ic_bootp_recv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|packet_type
op_star
id|pt
)paren
(brace
r_struct
id|bootp_pkt
op_star
id|b
op_assign
(paren
r_struct
id|bootp_pkt
op_star
)paren
id|skb-&gt;nh.iph
suffix:semicolon
r_struct
id|iphdr
op_star
id|h
op_assign
op_amp
id|b-&gt;iph
suffix:semicolon
r_struct
id|ic_device
op_star
id|d
suffix:semicolon
r_int
id|len
suffix:semicolon
multiline_comment|/* One reply at a time, please. */
id|spin_lock
c_func
(paren
op_amp
id|ic_recv_lock
)paren
suffix:semicolon
multiline_comment|/* If we already have a reply, just drop the packet */
r_if
c_cond
(paren
id|ic_got_reply
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Find the ic_device that the packet arrived on */
id|d
op_assign
id|ic_first_dev
suffix:semicolon
r_while
c_loop
(paren
id|d
op_logical_and
id|d-&gt;dev
op_ne
id|dev
)paren
id|d
op_assign
id|d-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* should never happen */
multiline_comment|/* Check whether it&squot;s a BOOTP packet */
r_if
c_cond
(paren
id|skb-&gt;pkt_type
op_eq
id|PACKET_OTHERHOST
op_logical_or
id|skb-&gt;len
OL
r_sizeof
(paren
r_struct
id|udphdr
)paren
op_plus
r_sizeof
(paren
r_struct
id|iphdr
)paren
op_logical_or
id|h-&gt;ihl
op_ne
l_int|5
op_logical_or
id|h-&gt;version
op_ne
l_int|4
op_logical_or
id|ip_fast_csum
c_func
(paren
(paren
r_char
op_star
)paren
id|h
comma
id|h-&gt;ihl
)paren
op_ne
l_int|0
op_logical_or
id|skb-&gt;len
OL
id|ntohs
c_func
(paren
id|h-&gt;tot_len
)paren
op_logical_or
id|h-&gt;protocol
op_ne
id|IPPROTO_UDP
op_logical_or
id|b-&gt;udph.source
op_ne
id|__constant_htons
c_func
(paren
l_int|67
)paren
op_logical_or
id|b-&gt;udph.dest
op_ne
id|__constant_htons
c_func
(paren
l_int|68
)paren
op_logical_or
id|ntohs
c_func
(paren
id|h-&gt;tot_len
)paren
OL
id|ntohs
c_func
(paren
id|b-&gt;udph.len
)paren
op_plus
r_sizeof
(paren
r_struct
id|iphdr
)paren
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Fragments are not supported */
r_if
c_cond
(paren
id|h-&gt;frag_off
op_amp
id|__constant_htons
c_func
(paren
id|IP_OFFSET
op_or
id|IP_MF
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DHCP/BOOTP: Ignoring fragmented reply.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* Is it a reply to our BOOTP request? */
id|len
op_assign
id|ntohs
c_func
(paren
id|b-&gt;udph.len
)paren
op_minus
r_sizeof
(paren
r_struct
id|udphdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|300
op_logical_or
multiline_comment|/* See RFC 951:2.1 */
id|b-&gt;op
op_ne
id|BOOTP_REPLY
op_logical_or
id|b-&gt;xid
op_ne
id|d-&gt;xid
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
multiline_comment|/* Parse extensions */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|b-&gt;exten
comma
id|ic_bootp_cookie
comma
l_int|4
)paren
)paren
(brace
multiline_comment|/* Check magic cookie */
id|u8
op_star
id|end
op_assign
(paren
id|u8
op_star
)paren
id|b
op_plus
id|ntohs
c_func
(paren
id|b-&gt;iph.tot_len
)paren
suffix:semicolon
id|u8
op_star
id|ext
suffix:semicolon
macro_line|#ifdef IPCONFIG_DHCP
r_if
c_cond
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
(brace
id|u32
id|server_id
op_assign
id|INADDR_NONE
suffix:semicolon
r_int
id|mt
op_assign
l_int|0
suffix:semicolon
id|ext
op_assign
op_amp
id|b-&gt;exten
(braket
l_int|4
)braket
suffix:semicolon
r_while
c_loop
(paren
id|ext
OL
id|end
op_logical_and
op_star
id|ext
op_ne
l_int|0xff
)paren
(brace
id|u8
op_star
id|opt
op_assign
id|ext
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|opt
op_eq
l_int|0
)paren
multiline_comment|/* Padding */
r_continue
suffix:semicolon
id|ext
op_add_assign
op_star
id|ext
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ext
op_ge
id|end
)paren
r_break
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|opt
)paren
(brace
r_case
l_int|53
suffix:colon
multiline_comment|/* Message type */
r_if
c_cond
(paren
id|opt
(braket
l_int|1
)braket
)paren
id|mt
op_assign
id|opt
(braket
l_int|2
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|54
suffix:colon
multiline_comment|/* Server ID (IP address) */
r_if
c_cond
(paren
id|opt
(braket
l_int|1
)braket
op_ge
l_int|4
)paren
id|memcpy
c_func
(paren
op_amp
id|server_id
comma
id|opt
op_plus
l_int|2
comma
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
)brace
macro_line|#ifdef IPCONFIG_DEBUG
id|printk
c_func
(paren
l_string|&quot;DHCP: Got message type %d&bslash;n&quot;
comma
id|mt
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|mt
)paren
(brace
r_case
id|DHCPOFFER
suffix:colon
multiline_comment|/* While in the process of accepting one offer,&n;&t;&t;&t;&t; * ignore all others.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|ic_myaddr
op_ne
id|INADDR_NONE
)paren
r_goto
id|drop
suffix:semicolon
multiline_comment|/* Let&squot;s accept that offer. */
id|ic_myaddr
op_assign
id|b-&gt;your_ip
suffix:semicolon
id|ic_servaddr
op_assign
id|server_id
suffix:semicolon
macro_line|#ifdef IPCONFIG_DEBUG
id|printk
c_func
(paren
l_string|&quot;DHCP: Offered address %u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_myaddr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; by server %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_servaddr
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* The DHCP indicated server address takes&n;&t;&t;&t;&t; * precedence over the bootp header one if&n;&t;&t;&t;&t; * they are different.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
(paren
id|server_id
op_ne
id|INADDR_NONE
)paren
op_logical_and
(paren
id|b-&gt;server_ip
op_ne
id|server_id
)paren
)paren
id|b-&gt;server_ip
op_assign
id|ic_servaddr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DHCPACK
suffix:colon
multiline_comment|/* Yeah! */
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Urque.  Forget it*/
id|ic_myaddr
op_assign
id|INADDR_NONE
suffix:semicolon
id|ic_servaddr
op_assign
id|INADDR_NONE
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
suffix:semicolon
id|ic_dhcp_msgtype
op_assign
id|mt
suffix:semicolon
)brace
macro_line|#endif /* IPCONFIG_DHCP */
id|ext
op_assign
op_amp
id|b-&gt;exten
(braket
l_int|4
)braket
suffix:semicolon
r_while
c_loop
(paren
id|ext
OL
id|end
op_logical_and
op_star
id|ext
op_ne
l_int|0xff
)paren
(brace
id|u8
op_star
id|opt
op_assign
id|ext
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_star
id|opt
op_eq
l_int|0
)paren
multiline_comment|/* Padding */
r_continue
suffix:semicolon
id|ext
op_add_assign
op_star
id|ext
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ext
OL
id|end
)paren
id|ic_do_bootp_ext
c_func
(paren
id|opt
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* We have a winner! */
id|ic_dev
op_assign
id|dev
suffix:semicolon
id|ic_myaddr
op_assign
id|b-&gt;your_ip
suffix:semicolon
id|ic_servaddr
op_assign
id|b-&gt;server_ip
suffix:semicolon
r_if
c_cond
(paren
id|ic_gateway
op_eq
id|INADDR_NONE
op_logical_and
id|b-&gt;relay_ip
)paren
id|ic_gateway
op_assign
id|b-&gt;relay_ip
suffix:semicolon
r_if
c_cond
(paren
id|ic_nameserver
op_eq
id|INADDR_NONE
)paren
id|ic_nameserver
op_assign
id|ic_servaddr
suffix:semicolon
id|ic_got_reply
op_assign
id|IC_BOOTP
suffix:semicolon
id|drop
suffix:colon
multiline_comment|/* Show&squot;s over.  Nothing to see here.  */
id|spin_unlock
c_func
(paren
op_amp
id|ic_recv_lock
)paren
suffix:semicolon
multiline_comment|/* Throw the packet out. */
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Dynamic IP configuration -- DHCP, BOOTP, RARP.&n; */
macro_line|#ifdef IPCONFIG_DYNAMIC
DECL|function|ic_dynamic
r_static
r_int
id|__init
id|ic_dynamic
c_func
(paren
r_void
)paren
(brace
r_int
id|retries
suffix:semicolon
r_struct
id|ic_device
op_star
id|d
suffix:semicolon
r_int
r_int
id|start_jiffies
comma
id|timeout
comma
id|jiff
suffix:semicolon
r_int
id|do_bootp
op_assign
id|ic_proto_have_if
op_amp
id|IC_BOOTP
suffix:semicolon
r_int
id|do_rarp
op_assign
id|ic_proto_have_if
op_amp
id|IC_RARP
suffix:semicolon
multiline_comment|/*&n;&t; * If none of DHCP/BOOTP/RARP was selected, return with an error.&n;&t; * This routine gets only called when some pieces of information&n;&t; * are missing, and without DHCP/BOOTP/RARP we are unable to get it.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|ic_proto_enabled
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Incomplete network configuration information.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef IPCONFIG_BOOTP
r_if
c_cond
(paren
(paren
id|ic_proto_enabled
op_xor
id|ic_proto_have_if
)paren
op_amp
id|IC_BOOTP
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DHCP/BOOTP: No suitable device found.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef IPCONFIG_RARP
r_if
c_cond
(paren
(paren
id|ic_proto_enabled
op_xor
id|ic_proto_have_if
)paren
op_amp
id|IC_RARP
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;RARP: No suitable device found.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|ic_proto_have_if
)paren
multiline_comment|/* Error message already printed */
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Setup protocols&n;&t; */
macro_line|#ifdef IPCONFIG_BOOTP
r_if
c_cond
(paren
id|do_bootp
)paren
id|ic_bootp_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef IPCONFIG_RARP
r_if
c_cond
(paren
id|do_rarp
)paren
id|ic_rarp_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Send requests and wait, until we get an answer. This loop&n;&t; * seems to be a terrible waste of CPU time, but actually there is&n;&t; * only one process running at all, so we don&squot;t need to use any&n;&t; * scheduler functions.&n;&t; * [Actually we could now, but the nothing else running note still &n;&t; *  applies.. - AC]&n;&t; */
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Sending %s%s%s requests .&quot;
comma
id|do_bootp
ques
c_cond
(paren
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
ques
c_cond
l_string|&quot;DHCP&quot;
suffix:colon
l_string|&quot;BOOTP&quot;
)paren
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|do_bootp
op_logical_and
id|do_rarp
)paren
ques
c_cond
l_string|&quot; and &quot;
suffix:colon
l_string|&quot;&quot;
comma
id|do_rarp
ques
c_cond
l_string|&quot;RARP&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|start_jiffies
op_assign
id|jiffies
suffix:semicolon
id|d
op_assign
id|ic_first_dev
suffix:semicolon
id|retries
op_assign
id|CONF_SEND_RETRIES
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|timeout
comma
r_sizeof
(paren
id|timeout
)paren
)paren
suffix:semicolon
id|timeout
op_assign
id|CONF_BASE_TIMEOUT
op_plus
(paren
id|timeout
op_mod
(paren
r_int
)paren
id|CONF_TIMEOUT_RANDOM
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
macro_line|#ifdef IPCONFIG_BOOTP
r_if
c_cond
(paren
id|do_bootp
op_logical_and
(paren
id|d-&gt;able
op_amp
id|IC_BOOTP
)paren
)paren
id|ic_bootp_send_if
c_func
(paren
id|d
comma
id|jiffies
op_minus
id|start_jiffies
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef IPCONFIG_RARP
r_if
c_cond
(paren
id|do_rarp
op_logical_and
(paren
id|d-&gt;able
op_amp
id|IC_RARP
)paren
)paren
id|ic_rarp_send_if
c_func
(paren
id|d
)paren
suffix:semicolon
macro_line|#endif
id|jiff
op_assign
id|jiffies
op_plus
(paren
id|d-&gt;next
ques
c_cond
id|CONF_INTER_TIMEOUT
suffix:colon
id|timeout
)paren
suffix:semicolon
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|jiff
)paren
op_logical_and
op_logical_neg
id|ic_got_reply
)paren
(brace
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef IPCONFIG_DHCP
multiline_comment|/* DHCP isn&squot;t done until we get a DHCPACK. */
r_if
c_cond
(paren
(paren
id|ic_got_reply
op_amp
id|IC_BOOTP
)paren
op_logical_and
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
op_logical_and
id|ic_dhcp_msgtype
op_ne
id|DHCPACK
)paren
(brace
id|ic_got_reply
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;,&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif /* IPCONFIG_DHCP */
r_if
c_cond
(paren
id|ic_got_reply
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; OK&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|d
op_assign
id|d-&gt;next
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|retries
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; timed out!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|d
op_assign
id|ic_first_dev
suffix:semicolon
id|timeout
op_assign
id|timeout
id|CONF_TIMEOUT_MULT
suffix:semicolon
r_if
c_cond
(paren
id|timeout
OG
id|CONF_TIMEOUT_MAX
)paren
id|timeout
op_assign
id|CONF_TIMEOUT_MAX
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef IPCONFIG_BOOTP
r_if
c_cond
(paren
id|do_bootp
)paren
id|ic_bootp_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef IPCONFIG_RARP
r_if
c_cond
(paren
id|do_rarp
)paren
id|ic_rarp_cleanup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|ic_got_reply
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IP-Config: Got %s answer from %u.%u.%u.%u, &quot;
comma
(paren
(paren
id|ic_got_reply
op_amp
id|IC_RARP
)paren
ques
c_cond
l_string|&quot;RARP&quot;
suffix:colon
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
ques
c_cond
l_string|&quot;DHCP&quot;
suffix:colon
l_string|&quot;BOOTP&quot;
)paren
comma
id|NIPQUAD
c_func
(paren
id|ic_servaddr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;my address is %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_myaddr
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* IPCONFIG_DYNAMIC */
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|pnp_get_info
r_static
r_int
id|pnp_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|ic_proto_used
op_amp
id|IC_PROTO
)paren
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;#PROTO: %s&bslash;n&quot;
comma
(paren
id|ic_proto_used
op_amp
id|IC_RARP
)paren
ques
c_cond
l_string|&quot;RARP&quot;
suffix:colon
(paren
id|ic_proto_used
op_amp
id|IC_USE_DHCP
)paren
ques
c_cond
l_string|&quot;DHCP&quot;
suffix:colon
l_string|&quot;BOOTP&quot;
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|buffer
comma
l_string|&quot;#MANUAL&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ic_domain
(braket
l_int|0
)braket
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;domain %s&bslash;n&quot;
comma
id|ic_domain
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ic_nameserver
op_ne
id|INADDR_NONE
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buffer
op_plus
id|len
comma
l_string|&quot;nameserver %u.%u.%u.%u&bslash;n&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_nameserver
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offset
OG
id|len
)paren
id|offset
op_assign
id|len
suffix:semicolon
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|offset
op_plus
id|length
OG
id|len
)paren
id|length
op_assign
id|len
op_minus
id|offset
suffix:semicolon
r_return
id|length
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
multiline_comment|/*&n; *&t;IP Autoconfig dispatcher.&n; */
DECL|function|ip_auto_config
r_static
r_int
id|__init
id|ip_auto_config
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|jiff
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|proc_net_create
c_func
(paren
l_string|&quot;pnp&quot;
comma
l_int|0
comma
id|pnp_get_info
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_PROC_FS */
r_if
c_cond
(paren
op_logical_neg
id|ic_enable
)paren
r_return
l_int|0
suffix:semicolon
id|DBG
c_func
(paren
(paren
l_string|&quot;IP-Config: Entered.&bslash;n&quot;
)paren
)paren
suffix:semicolon
macro_line|#ifdef IPCONFIG_DYNAMIC
id|try_try_again
suffix:colon
macro_line|#endif
multiline_comment|/* Give hardware a chance to settle */
id|jiff
op_assign
id|jiffies
op_plus
id|CONF_PRE_OPEN
suffix:semicolon
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|jiff
)paren
)paren
suffix:semicolon
multiline_comment|/* Setup all network devices */
r_if
c_cond
(paren
id|ic_open_devs
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* Give drivers a chance to settle */
id|jiff
op_assign
id|jiffies
op_plus
id|CONF_POST_OPEN
suffix:semicolon
r_while
c_loop
(paren
id|time_before
c_func
(paren
id|jiffies
comma
id|jiff
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If the config information is insufficient (e.g., our IP address or&n;&t; * IP address of the boot server is missing or we have multiple network&n;&t; * interfaces and no default was set), use BOOTP or RARP to get the&n;&t; * missing values.&n;&t; */
r_if
c_cond
(paren
id|ic_myaddr
op_eq
id|INADDR_NONE
op_logical_or
macro_line|#ifdef CONFIG_ROOT_NFS
(paren
id|MAJOR
c_func
(paren
id|ROOT_DEV
)paren
op_eq
id|UNNAMED_MAJOR
op_logical_and
id|root_server_addr
op_eq
id|INADDR_NONE
op_logical_and
id|ic_servaddr
op_eq
id|INADDR_NONE
)paren
op_logical_or
macro_line|#endif
id|ic_first_dev-&gt;next
)paren
(brace
macro_line|#ifdef IPCONFIG_DYNAMIC
r_int
id|retries
op_assign
id|CONF_OPEN_RETRIES
suffix:semicolon
r_if
c_cond
(paren
id|ic_dynamic
c_func
(paren
)paren
OL
l_int|0
)paren
(brace
id|ic_close_devs
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * I don&squot;t know why, but sometimes the&n;&t;&t;&t; * eepro100 driver (at least) gets upset and&n;&t;&t;&t; * doesn&squot;t work the first time it&squot;s opened.&n;&t;&t;&t; * But then if you close it and reopen it, it&n;&t;&t;&t; * works just fine.  So we need to try that at&n;&t;&t;&t; * least once before giving up.&n;&t;&t;&t; *&n;&t;&t;&t; * Also, if the root will be NFS-mounted, we&n;&t;&t;&t; * have nowhere to go if DHCP fails.  So we&n;&t;&t;&t; * just have to keep trying forever.&n;&t;&t;&t; *&n;&t;&t;&t; * &t;&t;&t;&t;-- Chip&n;&t;&t;&t; */
macro_line|#ifdef CONFIG_ROOT_NFS
r_if
c_cond
(paren
id|ROOT_DEV
op_eq
id|Root_NFS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Retrying forever (NFS root)...&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|try_try_again
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_decrement
id|retries
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Reopening network devices...&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|try_try_again
suffix:semicolon
)brace
multiline_comment|/* Oh, well.  At least we tried. */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Auto-configuration of network failed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#else /* !DYNAMIC */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IP-Config: Incomplete network configuration information.&bslash;n&quot;
)paren
suffix:semicolon
id|ic_close_devs
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
macro_line|#endif /* IPCONFIG_DYNAMIC */
)brace
r_else
(brace
multiline_comment|/* Device selected manually or only one device -&gt; use it */
id|ic_dev
op_assign
id|ic_first_dev-&gt;dev
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Use defaults whereever applicable.&n;&t; */
r_if
c_cond
(paren
id|ic_defaults
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Close all network devices except the device we&squot;ve&n;&t; * autoconfigured and set up routes.&n;&t; */
id|ic_close_devs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ic_setup_if
c_func
(paren
)paren
OL
l_int|0
op_logical_or
id|ic_setup_routes
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Record which protocol was actually used.&n;&t; */
macro_line|#ifdef IPCONFIG_DYNAMIC
id|ic_proto_used
op_assign
id|ic_got_reply
op_or
(paren
id|ic_proto_enabled
op_amp
id|IC_USE_DHCP
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef IPCONFIG_SILENT
multiline_comment|/*&n;&t; * Clue in the operator.&n;&t; */
id|printk
c_func
(paren
l_string|&quot;IP-Config: Complete:&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n      device=%s&quot;
comma
id|ic_dev-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, addr=%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_myaddr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, mask=%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_netmask
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, gw=%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_gateway
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;,&bslash;n     host=%s, domain=%s, nis-domain=%s&quot;
comma
id|system_utsname.nodename
comma
id|ic_domain
comma
id|system_utsname.domainname
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;,&bslash;n     bootserver=%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|ic_servaddr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, rootserver=%u.%u.%u.%u&quot;
comma
id|NIPQUAD
c_func
(paren
id|root_server_addr
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;, rootpath=%s&quot;
comma
id|root_server_path
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif /* !SILENT */
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ip_auto_config
id|module_init
c_func
(paren
id|ip_auto_config
)paren
suffix:semicolon
multiline_comment|/*&n; *  Decode any IP configuration options in the &quot;ip=&quot; or &quot;nfsaddrs=&quot; kernel&n; *  command line parameter. It consists of option fields separated by colons in&n; *  the following order:&n; *&n; *  &lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;host name&gt;:&lt;device&gt;:&lt;PROTO&gt;&n; *&n; *  Any of the fields can be empty which means to use a default value:&n; *&t;&lt;client-ip&gt;&t;- address given by BOOTP or RARP&n; *&t;&lt;server-ip&gt;&t;- address of host returning BOOTP or RARP packet&n; *&t;&lt;gw-ip&gt;&t;&t;- none, or the address returned by BOOTP&n; *&t;&lt;netmask&gt;&t;- automatically determined from &lt;client-ip&gt;, or the&n; *&t;&t;&t;  one returned by BOOTP&n; *&t;&lt;host name&gt;&t;- &lt;client-ip&gt; in ASCII notation, or the name returned&n; *&t;&t;&t;  by BOOTP&n; *&t;&lt;device&gt;&t;- use all available devices&n; *&t;&lt;PROTO&gt;:&n; *&t;   off|none&t;    - don&squot;t do autoconfig at all (DEFAULT)&n; *&t;   on|any           - use any configured protocol&n; *&t;   dhcp|bootp|rarp  - use only the specified protocol&n; *&t;   both             - use both BOOTP and RARP (not DHCP)&n; */
DECL|function|ic_proto_name
r_static
r_int
id|__init
id|ic_proto_name
c_func
(paren
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;on&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;any&quot;
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IP_PNP_DHCP
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;dhcp&quot;
)paren
)paren
(brace
id|ic_proto_enabled
op_and_assign
op_complement
id|IC_RARP
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_IP_PNP_BOOTP
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;bootp&quot;
)paren
)paren
(brace
id|ic_proto_enabled
op_and_assign
op_complement
(paren
id|IC_RARP
op_or
id|IC_USE_DHCP
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_IP_PNP_RARP
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;rarp&quot;
)paren
)paren
(brace
id|ic_proto_enabled
op_and_assign
op_complement
(paren
id|IC_BOOTP
op_or
id|IC_USE_DHCP
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef IPCONFIG_DYNAMIC
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;both&quot;
)paren
)paren
(brace
id|ic_proto_enabled
op_and_assign
op_complement
id|IC_USE_DHCP
suffix:semicolon
multiline_comment|/* backward compat :-( */
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ip_auto_config_setup
r_static
r_int
id|__init
id|ip_auto_config_setup
c_func
(paren
r_char
op_star
id|addrs
)paren
(brace
r_char
op_star
id|cp
comma
op_star
id|ip
comma
op_star
id|dp
suffix:semicolon
r_int
id|num
op_assign
l_int|0
suffix:semicolon
id|ic_set_manually
op_assign
l_int|1
suffix:semicolon
id|ic_enable
op_assign
(paren
op_star
id|addrs
op_logical_and
(paren
id|strcmp
c_func
(paren
id|addrs
comma
l_string|&quot;off&quot;
)paren
op_ne
l_int|0
)paren
op_logical_and
(paren
id|strcmp
c_func
(paren
id|addrs
comma
l_string|&quot;none&quot;
)paren
op_ne
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ic_enable
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ic_proto_name
c_func
(paren
id|addrs
)paren
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Parse the whole string */
id|ip
op_assign
id|addrs
suffix:semicolon
r_while
c_loop
(paren
id|ip
op_logical_and
op_star
id|ip
)paren
(brace
r_if
c_cond
(paren
(paren
id|cp
op_assign
id|strchr
c_func
(paren
id|ip
comma
l_char|&squot;:&squot;
)paren
)paren
)paren
op_star
id|cp
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|ip
)paren
OG
l_int|0
)paren
(brace
id|DBG
c_func
(paren
(paren
l_string|&quot;IP-Config: Parameter #%d: `%s&squot;&bslash;n&quot;
comma
id|num
comma
id|ip
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|num
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
(paren
id|ic_myaddr
op_assign
id|in_aton
c_func
(paren
id|ip
)paren
)paren
op_eq
id|INADDR_ANY
)paren
id|ic_myaddr
op_assign
id|INADDR_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
(paren
id|ic_servaddr
op_assign
id|in_aton
c_func
(paren
id|ip
)paren
)paren
op_eq
id|INADDR_ANY
)paren
id|ic_servaddr
op_assign
id|INADDR_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
(paren
id|ic_gateway
op_assign
id|in_aton
c_func
(paren
id|ip
)paren
)paren
op_eq
id|INADDR_ANY
)paren
id|ic_gateway
op_assign
id|INADDR_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
r_if
c_cond
(paren
(paren
id|ic_netmask
op_assign
id|in_aton
c_func
(paren
id|ip
)paren
)paren
op_eq
id|INADDR_ANY
)paren
id|ic_netmask
op_assign
id|INADDR_NONE
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
r_if
c_cond
(paren
(paren
id|dp
op_assign
id|strchr
c_func
(paren
id|ip
comma
l_char|&squot;.&squot;
)paren
)paren
)paren
(brace
op_star
id|dp
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|strncpy
c_func
(paren
id|system_utsname.domainname
comma
id|dp
comma
id|__NEW_UTS_LEN
)paren
suffix:semicolon
id|system_utsname.domainname
(braket
id|__NEW_UTS_LEN
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|system_utsname.nodename
comma
id|ip
comma
id|__NEW_UTS_LEN
)paren
suffix:semicolon
id|system_utsname.nodename
(braket
id|__NEW_UTS_LEN
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|ic_host_name_set
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|strncpy
c_func
(paren
id|user_dev_name
comma
id|ip
comma
id|IFNAMSIZ
)paren
suffix:semicolon
id|user_dev_name
(braket
id|IFNAMSIZ
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|ic_proto_name
c_func
(paren
id|ip
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|ip
op_assign
id|cp
suffix:semicolon
id|num
op_increment
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|nfsaddrs_config_setup
r_static
r_int
id|__init
id|nfsaddrs_config_setup
c_func
(paren
r_char
op_star
id|addrs
)paren
(brace
r_return
id|ip_auto_config_setup
c_func
(paren
id|addrs
)paren
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;ip=&quot;
comma
id|ip_auto_config_setup
)paren
suffix:semicolon
id|__setup
c_func
(paren
l_string|&quot;nfsaddrs=&quot;
comma
id|nfsaddrs_config_setup
)paren
suffix:semicolon
eof
